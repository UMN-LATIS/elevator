$(document).on("ready",function(){if(!$.fullscreen.isNativelySupported()){$("head").append("<style> .canFullscreen { display: none;</style>")}$(".textareaView li div").expander({slicePoint:400});$("#mapModal").on("shown.bs.modal",function(g){var h=$(g.relatedTarget).data("latitude");var f=$(g.relatedTarget).data("longitude");var d=$(g.relatedTarget).html();$("#mapModalLabel").html(d);$("#mapModalContainer").goMap({mapTypeControl:true,maptype:"ROADMAP",mapTypeControlOptions:{position:"TOP_RIGHT",style:"DROPDOWN_MENU"}});if($.goMap.getMarkerCount()>0){$.goMap.clearMarkers()}$.goMap.setMap({latitude:h,longitude:f});$("#mapModalContainer").goMap();var c=$.goMap.createMarker({latitude:h,longitude:f,draggable:false});$.goMap.fitBounds();$("#mapNearby").attr("href",basePath+"search/nearbyAssets/"+h+"/"+f);return false});$(document).on("click",".exifToggle",function(d){d.preventDefault();var c=$(d.target).data("fileobject");$.getJSON(basePath+"fileManager/getMetadataForObject/"+c,{},function(e,g){if(e.exif){var f=$("<ul />");$.each(e.exif,function(h,i){f.append("<li>"+h+" : "+i+"</li>")});bootbox.dialog({title:"EXIF Data",message:f.html(),buttons:{success:{label:"OK",className:"btn-primary"}}})}})});$(document).on("click",".relatedThumbContainer",function(d){d.stopPropagation();var c=$(this).data("objectid");window.location.hash=c});$(document).on("hide.bs.collapse",".relatedListToggle",function(c){$(this).find(".expandRelated").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")});$(document).on("show.bs.collapse",".relatedListToggle",function(f){f.stopPropagation();var d=$(this).data("objectid");var c=this;$(this).find(".expandRelated").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up");if($(c).parents(".relatedAssetContainer").length>0){parentObjectId=$(c).parents(".relatedAssetContainer").eq(0).data("objectid")}else{parentObjectId=$(this).closest(".objectIdHost").data("objectid")}$.get(basePath+"asset/viewAssetMetadataOnly/"+parentObjectId+"/"+d,function(e){$(c).find(".relatedAssetContents").html(e)})});$("#relatedAccordian").on("hide.bs.collapse",function(c){$(this).find(".expandRelated").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")});$("#relatedAccordian").on("show.bs.collapse",function(d){$(this).find(".expandRelated").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up");var c={searchText:objectId};$.post(basePath+"search/searchResults/",{suppressRecent:true,searchRelated:true,searchQuery:JSON.stringify(c)},function(i){try{jsonObject=$.parseJSON(i)}catch(k){alert(k+" "+i);return}if(jsonObject.success===true){$("#relatedAssets").empty();var h=$("#result-template").html();var g=Handlebars.compile(h);var j=false;var f=0;$.each(jsonObject.matches,function(e,m){if(m.objectId!=objectId){m.base_url=basePath;var l=g(m);$("#relatedAssets").append(l);j=true;f++}});if(!j){$("#relatedAssets").append("<p>No Related Assets Found</p>")}}})});var b=$.cookie("lastSearch");$.removeCookie("lastSearch",{path:"/"});$("body").on("click",function(c){$('[data-toggle="popover"]').each(function(){if(!$(this).is(c.target)&&$(this).has(c.target).length===0&&$(".popover").has(c.target).length===0){$(this).popover("hide")}})});if(window.location.hash){nestedObjectId=window.location.hash.replace("#","");var a=$(document).find('[data-fileobjectid="'+nestedObjectId+'"]');if(a.length>0){}else{a=$(document).find('[data-objectid="'+nestedObjectId+'"]').find(".loadView")}if(a.length>0){$(a).trigger("click")}else{loadEmbedViewPointer()}}else{if(b&&$(".rightColumn").find(".loadView").length>1){$.post(basePath+"search/getHighlight",{searchId:b,objectId:objectId},function(f,h,g){var e=$.parseJSON(f);var d=null;var c=false;$.each(e,function(i,j){if(j!=$("#embedView").data("objectid")){d=$(document).find('[data-fileobjectid="'+j+'"]');if(d.length>0){}else{d=$(document).find('[data-objectid="'+j+'"]').find(".loadView")}if(d.length>0){$(d).trigger("click");c=true;return false}}});if(!c){loadEmbedViewPointer()}})}else{loadEmbedViewPointer()}}});$(document).on("mouseover",".relatedThumbToggle",function(){var b=$(this).find(".relatedThumbContainerImage");$(b).data("oldURL",$(b).attr("src"));var a=$(b).data("at2x");$(b).attr("src",a)});$(document).on("mouseout",".relatedThumbToggle",function(){var b=$(this).find(".relatedThumbContainerImage");var a=$(b).data("oldURL");$(b).attr("src",a)});$(document).on("click",".embedControl",function(){$(this).select()});$(document).on("click",".showDetails",function(){$(this).parent().parent().children(".assetDetails").toggle("fast")});$(document).on("click",".loadView",function(){fileObjectId=$(this).data("fileobjectid");var b=$(this).closest("[data-objectid]");var a=false;if(b.length>0){parentObject=b.data("objectid");a=true}else{parentObject=$(this).closest(".objectIdHost").data("objectid")}$.get(basePath+"asset/getEmbed/"+fileObjectId+"/"+objectId,function(c){$("#embedView").html(c);var e=$(window).scrollTop();var d=$("#embedView").offset().top+400;if(e>d){bootbox.alert("<h2>Scroll Up For New Content</h2>");window.setTimeout(function(){bootbox.hideAll()},1200)}if(a){$.get(basePath+"asset/viewAssetMetadataOnly/"+objectId+"/"+parentObject,function(f){$("#embedView").append(f)})}if(typeof loadedCallback=="function"){loadedCallback()}})});function loadEmbedViewPointer(){targetObjectId=$("#embedView").data("objectid");var a=$(document).find('[data-fileobjectid="'+targetObjectId+'"]');if(a.length>0){}else{a=$(document).find('[data-objectid="'+targetObjectId+'"]').find(".loadView")}$(a).trigger("click")}$(document).ready(function(){$("#addToDrawer").on("submit",function(c){c.preventDefault();var a=$(this).serializeArray();if(typeof(excerptId)!="undefined"){a.push({name:"excerptId",value:excerptId})}if(typeof(objectId)!="undefined"){a.push({name:"objectId",value:objectId})}if(typeof(cachedResults)!="undefined"){a.push({name:"objectArray",value:JSON.stringify(cachedResults.searchResults)})}var b=$(this).attr("action");$.ajax({url:b,type:"POST",data:a,success:function(e,f,d){$("#drawerModal").modal("toggle")},error:function(d,f,e){console.log("Error adding Drawer")}})});$("#addNewDrawer").on("submit",function(c){var a=$(this).serializeArray();var b=$(this).attr("action");$.ajax({url:b,type:"POST",data:a,success:function(g,h,f){var e=$.parseJSON(g);var d=parseInt(e.drawerId,10);$("#drawerList").append("<option value='"+d+"'>"+e.drawerTitle+"</option>");$("#drawerList").val(d);$(".drawerAddedSuccess").fadeIn("400");window.setTimeout(function(){$(".drawerAddedSuccess").fadeOut("400")},2000)},error:function(d,f,e){console.log("Error adding Drawer")}});c.preventDefault()})});