(function(d,S,ab){function Q(h,f,l){h.addEventListener?h.addEventListener(f,l,!1):h.attachEvent("on"+f,l)}function W(h){if("keypress"==h.type){var f=String.fromCharCode(h.which);h.shiftKey||(f=f.toLowerCase());return f}return aa[h.which]?aa[h.which]:U[h.which]?U[h.which]:String.fromCharCode(h.which).toLowerCase()}function O(h){h=h||{};var f=!1,l;for(l in X){h[l]?f=!0:X[l]=0}f||(v=!1)}function R(x,w,t,u,s,y){var q,n,r=[],p=t.type;if(!Z[x]){return[]}"keyup"==p&&k(x)&&(w=[x]);for(q=0;q<Z[x].length;++q){if(n=Z[x][q],!(!u&&n.seq&&X[n.seq]!=n.level||p!=n.action||("keypress"!=p||t.metaKey||t.ctrlKey)&&w.sort().join(",")!==n.modifiers.sort().join(","))){var l=u&&n.seq==u&&n.level==y;(!u&&n.combo==s||l)&&Z[x].splice(q,1);r.push(n)}}return r}function c(h){var f=[];h.shiftKey&&f.push("shift");h.altKey&&f.push("alt");h.ctrlKey&&f.push("ctrl");h.metaKey&&f.push("meta");return f}function i(h,f,l,m){Y.stopCallback(f,f.target||f.srcElement,l,m)||!1!==h(f,l)||(f.preventDefault?f.preventDefault():f.returnValue=!1,f.stopPropagation?f.stopPropagation():f.cancelBubble=!0)}function e(h){"number"!==typeof h.which&&(h.which=h.keyCode);var f=W(h);f&&("keyup"==h.type&&b===f?b=!1:Y.handleKey(f,c(h),h))}function k(f){return"shift"==f||"ctrl"==f||"alt"==f||"meta"==f}function a(l,h,r,s){function q(f){return function(){v=f;++X[l];clearTimeout(P);P=setTimeout(O,1000)}}function m(f){i(r,f,l);"keyup"!==s&&(b=W(f));setTimeout(O,10)}for(var n=X[l]=0;n<h.length;++n){var p=n+1===h.length?m:q(s||N(h[n+1]).action);M(h[n],p,s,l,n)}}function N(l,h){var q,r,p,n=[];q="+"===l?["+"]:l.split("+");for(p=0;p<q.length;++p){r=q[p],o[r]&&(r=o[r]),h&&"keypress"!=h&&j[r]&&(r=j[r],n.push("shift")),k(r)&&n.push(r)}q=r;p=h;if(!p){if(!V){V={};for(var m in aa){95<m&&112>m||aa.hasOwnProperty(m)&&(V[aa[m]]=m)}}p=V[q]?"keydown":"keypress"}"keypress"==p&&n.length&&(p="keydown");return{key:r,modifiers:n,action:p}}function M(l,h,p,q,n){T[l+":"+p]=h;l=l.replace(/\s+/g," ");var m=l.split(" ");1<m.length?a(l,m,h,p):(p=N(l,p),Z[p.key]=Z[p.key]||[],R(p.key,p.modifiers,{type:p.action},q,l,n),Z[p.key][q?"unshift":"push"]({callback:h,modifiers:p.modifiers,action:p.action,seq:q,level:n,combo:l}))}var aa={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},U={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},j={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},o={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},V,Z={},T={},X={},P,b=!1,g=!1,v=!1;for(ab=1;20>ab;++ab){aa[111+ab]="f"+ab}for(ab=0;9>=ab;++ab){aa[ab+96]=ab}Q(S,"keypress",e);Q(S,"keydown",e);Q(S,"keyup",e);var Y={bind:function(h,f,l){h=h instanceof Array?h:[h];for(var m=0;m<h.length;++m){M(h[m],f,l)}return this},unbind:function(h,f){return Y.bind(h,function(){},f)},trigger:function(h,f){if(T[h+":"+f]){T[h+":"+f]({},h)}return this},reset:function(){Z={};T={};return this},stopCallback:function(h,f){return -1<(" "+f.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==f.tagName||"SELECT"==f.tagName||"TEXTAREA"==f.tagName||f.isContentEditable},handleKey:function(l,h,q){var r=R(l,h,q),p;h={};var n=0,m=!1;for(p=0;p<r.length;++p){r[p].seq&&(n=Math.max(n,r[p].level))}for(p=0;p<r.length;++p){r[p].seq?r[p].level==n&&(m=!0,h[r[p].seq]=1,i(r[p].callback,q,r[p].combo,r[p].seq)):m||i(r[p].callback,q,r[p].combo)}r="keypress"==q.type&&g;q.type!=v||k(l)||r||O(h);g=m&&"keydown"==q.type}};d.Mousetrap=Y;"function"===typeof define&&define.amd&&define(Y)})(window,document);