var map={},markers={};function loadMap(e){var a=getHostIdForElement(e);map[a]&&(clearMarkers(a),map[a].off(),map[a].remove());var t=L.esri.basemapLayer("Topographic",{detectRetina:!0,maxNativeZoom:18,maxZoom:21}),r=L.esri.basemapLayer("Imagery",{detectRetina:!0,maxNativeZoom:18,maxZoom:20}),o=L.esri.basemapLayer("ImageryLabels");map[a]=L.map(e,{layers:[t]}).setView([40,-94],5),L.control.layers({Topo:t,Satellite:r},{"Satellite Labels":o}).addTo(map[a]),L.control.locate&&L.control.locate({icon:"glyphicon glyphicon-map-marker"}).addTo(map[a]),$(".leaflet-control-layers-overlays").find(".leaflet-control-layers-selector").attr("name","satelliteToggle"),map[a].on("baselayerchange",function(e){"Satellite"==e.name?$(".leaflet-control-layers-overlays").find(".leaflet-control-layers-selector").trigger("click"):1==$(".leaflet-control-layers-overlays").find(".leaflet-control-layers-selector").prop("checked")&&$(".leaflet-control-layers-overlays").find(".leaflet-control-layers-selector").trigger("click")})}function clearMarkers(e){markers[e]&&markers[e].clearLayers()}function createMarker(e,a,t,r,o,l){markers[e]||(markers[e]=new L.layerGroup);var n=new L.Marker([a,t],{draggable:!0});return markers[e].addLayer(n),map[e].addLayer(markers[e]),n.on("dragend",function(e){r.val(e.target.getLatLng().lat),o.val(e.target.getLatLng().lng)}),l&&centerLeafletMapOnMarker(e,n),n}function centerLeafletMapOnMarker(e,a){var t=[a.getLatLng()],r=L.latLngBounds(t);map[e].fitBounds(r,{maxZoom:15})}$(document).on("click",".clearMarker",function(){var e=$(this).closest(".mapContainer").find(".mapWidget");clearMarkers(getHostIdForElement(e))}),$(document).off("click",".searchMap"),$(document).on("click",".searchMap",function(){var e=$(this).closest(".mapContainer").find(".address").first().val(),a=$(this).closest(".mapContainer").find(".mapWidget"),t=$(this).closest(".mapContainer").find(".latitude"),r=$(this).closest(".mapContainer").find(".longitude"),o=getHostIdForElement(a);clearMarkers(o);var l={position:null};(new google.maps.Geocoder).geocode({address:e},function(e,a){if(a==google.maps.GeocoderStatus.OK){l.position=e[0].geometry.location,l.geocode=!0;var n=e[0].geometry.location.lat(),s=e[0].geometry.location.lng();marker=createMarker(o,n,s,t,r,!0),t.val(n),r.val(s),$(t).trigger("change"),$(r).trigger("change")}})}),$(document).on("change",".geoField",function(){var e=$(this).closest(".mapContainer").find(".latitude"),a=$(this).closest(".mapContainer").find(".longitude"),t=$(this).closest(".mapContainer").find(".mapWidget"),r=getHostIdForElement(t);clearMarkers(r),0!==e.val().length&&0!==a.val().length&&createMarker(r,e.val(),a.val(),e,a,!1)}),$(document).on("hidden.bs.collapse",".maphost",function(){var e=$(this).parent().find(".mapWidget"),a=getHostIdForElement(e);clearMarkers(a),map[a].off(),map[a].remove(),$(this).parent().find(".mapToggle").html("Reveal Map")}),$(document).on("shown.bs.collapse",".maphost",function(){$(this).parent().find(".mapToggle").html("Hide Map");var e=$(this).find(".mapWidget"),a=$(this).parent().find(".latitude"),t=$(this).parent().find(".longitude");revealMap(e[0],a,t)});var getHostIdForElement=function(e){return"object"==typeof e?$(e).closest(".maphost").attr("id"):e},revealMap=function(e,a,t){loadMap(e);var r=getHostIdForElement(e);map[r].on("click",function(e){markers[r].getLayers().length>0||(createMarker(r,e.latlng.lat,e.latlng.lng,a,t,!1),a.val(e.latlng.lat),t.val(e.latlng.lng))});var o=t.val(),l=a.val();markers[r]||(markers[r]=new L.layerGroup),""!==o?createMarker(r,l,o,a,t,!0):map[r].setView([46,-94],6)};
//# sourceMappingURL=mapWidget.min.js.map
