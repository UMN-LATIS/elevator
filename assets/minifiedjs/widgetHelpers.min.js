function buildAutocomplete(){var e=$("#autocompleter-template").html();Handlebars.compile(e);$(".tryAutocomplete").length&&$(".tryAutocomplete").each(function(e,t){var n=t;$(t).autocomplete({source:function(e,t){var o=$("#sourceTemplate").val(),a=$(n).closest(".tab-pane").attr("id"),i=e.term;$.post(basePath+"search/autocomplete/",{templateId:o,fieldTitle:a,searchTerm:i},function(e){try{jsonObject=$.parseJSON(e)}catch(n){return void alert(n+" "+e)}t(jsonObject)})},messages:{noResults:"",results:function(){}}})}),buildAssetAutocomplete($(".widgetContents"))}function loadFrameForNestedElement(e){var t=$(e).find(".templateSelector").val(),n=$("#inputCollectionId").val(),o=$(e).find(".targetAsset").val(),a=null;a=o.length>0?basePath+"assetManager/editAsset/"+o+"/true":basePath+"assetManager/addAsset/"+t+"/"+n+"/true";var i=$(e).find(".inlineRelatedAsset"),s=$("<iframe />",{"class":"nestediIFrame",frameborder:0,width:"100%",src:a});s.appendTo(i);var r=$(e).find(".targetAsset");s.load(function(){iframeLoaded(s);var e={status:"open",targetField:r.attr("id")};this.contentWindow.postMessage(JSON.stringify(e),"*")})}function iframeLoaded(e){var t=$(e).closest(".tab-pane"),n=($(t).attr("id"),$(e).contents().find("html").height());$(e).height(n),$("#collectionId").trigger("change")}var markSaveDirty=function(){$(".saveButton").removeClass("btn-primary").addClass("btn-warning"),$("#entryForm").removeClass("clean").addClass("dirty")},markSaveClean=function(){$(".saveButton").removeClass("btn-warning").addClass("btn-primary"),$("#entryForm").removeClass("dirty").addClass("clean")};Handlebars.registerHelper("join",function(e,t,n,o){var a=[].concat(e);return t="string"==typeof t?t:", ",n=n||0,o=void 0===o?a.length:o,a.slice(n,o).join(t)}),Handlebars.registerHelper("random",function(e){return Math.random()}),$(window).bind("beforeunload",function(){return uploadCount>0?"You have uploads in progress. Are you sure you wish to leave the page and cancel these uploads?":void 0});var showHaveEntries=function(){$(".tab-pane").each(function(e,t){var n=$(t).attr("id"),o=!1,a=!1,i=$(t).find(".mainWidgetEntry");$(i).each(function(e,t){$(t).is("input")||$(t).is("textarea")?$(t).val().length>0&&(o=!0):$(t).is("select")?""!==$(t).find(":selected").text()&&(o=!0):o=!0,$(t).prop("required")&&(a=!0)});var s;o?(s=$('a[href="#'+n+'"]').children(".haveContent").show(),$('a[href="#'+n+'"]').find(".requiredContent").hide()):(s=$('a[href="#'+n+'"]').children(".haveContent").hide(),a?$('a[href="#'+n+'"]').find(".requiredContent").show():$('a[href="#'+n+'"]').find(".requiredContent").hide())})};$(document).ready(function(){$(document).on("change",".mainWidgetEntry",function(e){showHaveEntries(),markSaveDirty()})});var addAnother=function(e){$(e).attr("disabled",!0);var t=$(e).parents(".tab-pane").find(".control-group"),n=$(t).attr("id").replace("controlGroup_",""),o=$(t).children(".widget_id").first().val(),a=$(t).children("div").length-1,i=e,s=null;return $.get(basePath+"assetManager/getWidget/"+o+"/"+a,function(e){window.offsetCount[n]++,s=$(e),$(t).append(s),$(t).find(".isPrimary").show(),buildAutocomplete(),$(i).removeAttr("disabled"),t.height()>$(".mainRow").height()&&($(".mainRow").height(t.height()+50),$(".leftPane").height($(".mainRow").height()))}),s};$(document).on("click",".addAnother",function(e){addAnother(this)}),$(document).on("change",".templateSelector",function(e){0===parseInt($(this).val())?$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled","disabled"):$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled",!1)}),$(document).ready(function(){$("#entryForm").parsley({validators:{dateobject:function(){return{validate:function(e,t){return parseDateString(e,t)},priority:2}}},messages:{dateobject:"We couldn't figure out a way to parse this date."}}),$("#collectionId").on("change",function(e){var t=$(this).val();$(".nestediIFrame").each(function(e,n){var o=$(n).contents().find("#collectionId");o.val(t),$(o).trigger("change"),$(n).get(0).contentWindow&&void 0!==$(n).get(0).contentWindow.resetCollection&&$(n).get(0).contentWindow.resetCollection()})}),showHaveEntries(),$(".control-group").each(function(e,t){$(t).find(".isPrimary").length>1&&$(t).find(".isPrimary").show()}),$("input,select").keypress(function(e){return 13!=e.keyCode}),$("#inputAvailableAfter").datepicker(),""!==$("#inputObjectId").val()&&($(".viewAsset").show(),loadPreviewAndUpdateTitle($("#inputObjectId").val())),$(".templateSelector").trigger("change"),$(".relatedAssetSelectedItem").each(function(e,t){var n=$(t).val();relatedAssetPreview(n,this,$(".widgetContents"))}),$("#inputNewTemplateId").on("change",function(){var e=this;targetTemplate=$(e).val(),sourceTemplate=$("#sourceTemplate").val(),jQuery.getJSON(basePath+"assetManager/compareTemplates/"+sourceTemplate+"/"+targetTemplate,{},function(t,n){if(0===t.length)$("#sourceTemplate").val(targetTemplate);else{var o=$("#template-switch").html(),a=Handlebars.compile(o);bootbox.confirm(a(t),function(t){t?$("#sourceTemplate").val(targetTemplate):$(e).val(sourceTemplate)})}})}),$("#newCollectionId").on("change",function(){var e=this;return targetCollection=$(e).val(),sourceCollection=$("#collectionId").val(),"-1"===sourceCollection||""===sourceCollection?($("#collectionId").val(targetCollection),void $("#collectionId").trigger("change")):void jQuery.getJSON(basePath+"assetManager/compareCollections/"+sourceCollection+"/"+targetCollection,{},function(t,n){if(t.migration===!1)$("#collectionId").val(targetCollection),$("#collectionId").trigger("change");else{var o=$("#collection-switch").html(),a=Handlebars.compile(o);bootbox.confirm(a(t),function(t){t?($("#collectionId").val(targetCollection),$("#collectionId").trigger("change"),$("#collectionMigrationInProcess").val("true")):$(e).val(sourceCollection)})}})}),buildAutocomplete(),$("#collectionMigrationInProcess").on("change",function(){"true"==$(this).val()&&($(".saveButton").hide(),bootbox.dialog({message:"Editing is unavailable while collection migration is taking place.",title:"Edits Disabled",backdrop:!0,closeButton:!1}))}),$("#collectionMigrationInProcess").trigger("change")}),$(document).on("click",".autocompletePreview",function(e){var t=$(this).closest(".widgetContents").find(".targetAsset").val();return window.open(basePath+"asset/viewAsset/"+t),!1}),$(document).on("click",".viewAsset",function(){window.open(basePath+"asset/viewAsset/"+$("#inputObjectId").val())}),$(document).on("click",".clearRelated",function(e){confirm("Are you sure you wish to clear this asset?")&&($(this).closest(".widgetContents").find(".relatedAssetInput").val(""),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").val(""),$(this).closest(".widgetContents").find(".relatedAssetInput").trigger("change"),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").trigger("change"),$(this).closest(".widgetContents").find(".autocompletePreview").hide(),$(this).closest(".widgetContents").find(".autocompleteEdit").hide(),$(this).closest(".widgetContents").find(".assetPreview").html(""),$(this).closest(".widgetContents").find(".clearRelated").hide(),$(this).closest(".widgetContents").find(".nestediIFrame").remove(),$(this).closest(".widgetContents").find(".newAssetButton").removeAttr("disabled"))});
//# sourceMappingURL=widgetHelpers.min.js.map
