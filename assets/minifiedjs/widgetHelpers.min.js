function buildAutocomplete(){var e=$("#autocompleter-template").html(),t=Handlebars.compile(e);$(".tryAutocomplete").length&&$(".tryAutocomplete").each(function(e,t){var n=t;$(t).autocomplete({source:function(e,t){var o=$("#sourceTemplate").val(),a=$(n).closest(".tab-pane").attr("id"),s=e.term;$.post(basePath+"search/autocomplete/",{templateId:o,fieldTitle:a,searchTerm:s},function(e){try{jsonObject=$.parseJSON(e)}catch(n){return void alert(n+" "+e)}t(jsonObject)})},messages:{noResults:"",results:function(){}}})}),$(".tryAutocompleteAsset").length&&$(".tryAutocompleteAsset").each(function(e,n){$(n).val().length>0&&($(n).closest(".widgetContents").find(".autocompletePreview").show(),$(n).closest(".widgetContents").find(".autocompleteEdit").show(),$(n).closest(".widgetContents").find(".clearRelated").show()),$(n).autocomplete({source:function(e,t){var o={searchText:e.term},a=$(n).closest(".widgetContents").find(".matchAgainstSelector").val();$.post(basePath+"search/searchResults/",{searchQuery:JSON.stringify(o),templateId:a,suppressRecent:!0,showHidden:!0},function(e){try{jsonObject=$.parseJSON(e)}catch(n){return void alert(n+" "+e)}jsonObject.success===!0&&($.each(jsonObject.matches,function(e,t){return t&&t.objectId!=$("#inputObjectId").val()?(t.value=t.objectId,void(jsonObject.matches[e]=t)):(jsonObject.matches.splice(e,1),!0)}),t(jsonObject.matches))})},messages:{noResults:"",results:function(){}},close:function(e,t){void 0!==e.which&&$(n).val("")},select:function(e,o){$(n).closest(".widgetContents").find(".relatedAssetSelectedItem").val(o.item.objectId);var a=t(o.item);$(this).trigger("change"),$(this).closest(".widgetContents").find(".autocompletePreview").show(),$(this).closest(".widgetContents").find(".autocompleteEdit").show(),$(this).closest(".widgetContents").find(".clearRelated").show(),$(this).closest(".widgetContents").find(".assetPreview").html(a)}}).data("ui-autocomplete")._renderItem=function(e,n){n.base_url=basePath;var o=t(n);return $(o).appendTo(e)}})}function loadFrameForNestedElement(e){var t=$(e).find(".templateSelector").val(),n=$("#inputCollectionId").val(),o=$(e).find(".targetAsset").val(),a=null;a=o.length>0?basePath+"assetManager/editAsset/"+o+"/true":basePath+"assetManager/addAsset/"+t+"/"+n+"/true";var s=$(e).find(".inlineRelatedAsset"),i=$("<iframe />",{"class":"nestediIFrame",frameborder:0,width:"100%",src:a});i.appendTo(s),i.load(function(){iframeLoaded(i)})}function iframeLoaded(e){var t=$(e).closest(".tab-pane"),n=$(t).attr("id");if($(t).hasClass("active")){var o=$(e).contents().find("html").height();$(e).height(o)}else $("a[href=#"+n+"]").on("shown.bs.tab",function(t){var n=$(e).contents().find("html").height();$(e).height(n)});$("#collectionId").trigger("change")}var markSaveDirty=function(){$(".saveButton").removeClass("btn-primary").addClass("btn-warning"),$("#entryForm").removeClass("clean").addClass("dirty")},markSaveClean=function(){$(".saveButton").removeClass("btn-warning").addClass("btn-primary"),$("#entryForm").removeClass("dirty").addClass("clean")};Handlebars.registerHelper("join",function(e,t,n,o){var a=[].concat(e);return t="string"==typeof t?t:", ",n=n||0,o=void 0===o?a.length:o,a.slice(n,o).join(t)}),Handlebars.registerHelper("random",function(e){return Math.random()}),$(window).bind("beforeunload",function(){return uploadCount>0?"You have uploads in progress. Are you sure you wish to leave the page and cancel these uploads?":void 0}),Mousetrap.bind("command+ctrl+t",function(){toggleTabs()});var toggleTabs=function(){$(".rightPane .tab-content>.tab-pane").toggle(),$("#general").toggle(),$(".leftPane").toggle()},showHaveEntries=function(){$(".tab-pane").each(function(e,t){var n=$(t).attr("id"),o=!1,a=!1,s=$(t).find(".mainWidgetEntry");$(s).each(function(e,t){$(t).is("input")||$(t).is("textarea")?$(t).val().length>0&&(o=!0):$(t).is("select")?""!==$(t).find(":selected").text()&&(o=!0):o=!0,$(t).prop("required")&&(a=!0)});var i;o?(i=$('a[href="#'+n+'"]').children(".haveContent").show(),$('a[href="#'+n+'"]').find(".requiredContent").hide()):(i=$('a[href="#'+n+'"]').children(".haveContent").hide(),a?$('a[href="#'+n+'"]').find(".requiredContent").show():$('a[href="#'+n+'"]').find(".requiredContent").hide())})};$(document).on("change",".mainWidgetEntry",function(){showHaveEntries(),markSaveDirty()});var addAnother=function(e){$(e).attr("disabled",!0);var t=$(e).parents(".control-group"),n=$(t).attr("id").replace("controlGroup_",""),o=$(t).children(".widget_id").first().val(),a=$(t).children("div").length-1,s=e,i=null;return $.get(basePath+"assetManager/getWidget/"+o+"/"+a,function(e){window.offsetCount[n]++,i=$(e),$(t).append(i),$(t).find(".isPrimary").show(),buildAutocomplete(),$(s).removeAttr("disabled"),t.height()>$(".mainRow").height()&&($(".mainRow").height(t.height()+50),$(".leftPane").height($(".mainRow").height()))}),i};$(document).on("click",".addAnother",function(e){addAnother(this)}),$(document).on("change",".templateSelector",function(e){0===parseInt($(this).val())?$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled","disabled"):$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled",!1)}),$(document).ready(function(){$("#entryForm").parsley({validators:{dateobject:function(){return{validate:function(e,t){return parseDateString(e,t)},priority:2}}},messages:{dateobject:"We couldn't figure out a way to parse this date."}}),$("#collectionId").on("change",function(e){var t=$(this).val();$(".nestediIFrame").each(function(e,n){var o=$(n).contents().find("#collectionId");o.val(t),$(o).trigger("change"),$(n).get(0).contentWindow.resetCollection()})}),showHaveEntries(),$(".control-group").each(function(e,t){$(t).find(".isPrimary").length>1&&$(t).find(".isPrimary").show()}),$("input,select").keypress(function(e){return 13!=e.keyCode}),$("#inputAvailableAfter").datepicker(),""!==$("#inputObjectId").val()&&($(".viewAsset").show(),loadPreviewAndUpdateTitle($("#inputObjectId").val())),$(".templateSelector").trigger("change"),$(".relatedAssetSelectedItem").each(function(e,t){var n=$(t).val();if(n.length>0){var o=$("#autocompleter-template").html(),a=Handlebars.compile(o),s=this;$.get(basePath+"asset/getAssetPreview/"+n,function(e){try{jsonObject=$.parseJSON(e)}catch(t){return void alert(t+" "+e)}if(jsonObject){var n=jsonObject;n.base_url=basePath;var o=a(n);$(s).closest(".widgetContents").find(".autocompletePreview").show(),$(s).closest(".widgetContents").find(".autocompleteEdit").show(),$(s).closest(".widgetContents").find(".clearRelated").show(),$(s).closest(".widgetContents").find(".assetPreview").html(o)}})}}),$("#inputNewTemplateId").on("change",function(){var e=this;targetTemplate=$(e).val(),sourceTemplate=$("#sourceTemplate").val(),jQuery.getJSON(basePath+"assetManager/compareTemplates/"+sourceTemplate+"/"+targetTemplate,{},function(t,n){if(0===t.length)$("#sourceTemplate").val(targetTemplate);else{var o=$("#template-switch").html(),a=Handlebars.compile(o);bootbox.confirm(a(t),function(t){t?$("#sourceTemplate").val(targetTemplate):$(e).val(sourceTemplate)})}})}),$("#newCollectionId").on("change",function(){var e=this;return targetCollection=$(e).val(),sourceCollection=$("#collectionId").val(),"-1"===sourceCollection||""===sourceCollection?($("#collectionId").val(targetCollection),void $("#collectionId").trigger("change")):void jQuery.getJSON(basePath+"assetManager/compareCollections/"+sourceCollection+"/"+targetCollection,{},function(t,n){if(t.migration===!1)$("#collectionId").val(targetCollection),$("#collectionId").trigger("change");else{var o=$("#collection-switch").html(),a=Handlebars.compile(o);bootbox.confirm(a(t),function(t){t?($("#collectionId").val(targetCollection),$("#collectionId").trigger("change"),$("#collectionMigrationInProcess").val("true")):$(e).val(sourceCollection)})}})}),buildAutocomplete(),$("#collectionMigrationInProcess").on("change",function(){"true"==$(this).val()&&($(".saveButton").hide(),bootbox.dialog({message:"Editing is unavailable while collection migration is taking place.",title:"Edits Disabled",backdrop:!0,closeButton:!1}))}),$("#collectionMigrationInProcess").trigger("change"),$(".toggleTabs").on("click",function(){toggleTabs()})}),$(document).on("click",".autocompletePreview",function(e){var t=$(this).closest(".widgetContents").find(".targetAsset").val();return window.open(basePath+"asset/viewAsset/"+t),!1}),$(document).on("click",".autocompleteEdit",function(e){var t=$(this).closest(".widgetContents").find(".targetAsset").val();return window.open(basePath+"assetManager/editAsset/"+t),!1}),$(document).on("click",".viewAsset",function(){window.open(basePath+"asset/viewAsset/"+$("#inputObjectId").val())}),$(document).on("click",".clearRelated",function(e){confirm("Are you sure you wish to clear this asset?")&&($(this).closest(".widgetContents").find(".relatedAssetInput").val(""),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").val(""),$(this).closest(".widgetContents").find(".relatedAssetInput").trigger("change"),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").trigger("change"),$(this).closest(".widgetContents").find(".autocompletePreview").hide(),$(this).closest(".widgetContents").find(".autocompleteEdit").hide(),$(this).closest(".widgetContents").find(".assetPreview").html(""),$(this).closest(".widgetContents").find(".clearRelated").hide(),$(this).closest(".widgetContents").find(".nestediIFrame").remove())});
//# sourceMappingURL=widgetHelpers.js.map
