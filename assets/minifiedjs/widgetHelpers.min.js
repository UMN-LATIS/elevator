var markSaveDirty=function(){$(".saveButton").removeClass("btn-primary").addClass("btn-warning"),$("#entryForm").removeClass("clean").addClass("dirty")},markSaveClean=function(){$(".saveButton").removeClass("btn-warning").addClass("btn-primary"),$("#entryForm").removeClass("dirty").addClass("clean")},showHaveEntries=(Handlebars.registerHelper("join",function(e,t,n,o){e=[].concat(e);return t="string"==typeof t?t:", ",o=void 0===o?e.length:o,e.slice(n=n||0,o).join(t)}),Handlebars.registerHelper("random",function(e){return Math.random()}),$(window).bind("beforeunload",function(){if(0<uploadCount)return"You have uploads in progress. Are you sure you wish to leave the page and cancel these uploads?"}),$(document).ready(function(){$(document).on("change",".mainWidgetEntry",function(e){showHaveEntries(),markSaveDirty()})}),function(){$(".tab-pane").each(function(e,t){var n=$(t).attr("id"),o=!1,i=!1,t=$(t).find(".mainWidgetEntry");$(t).each(function(e,t){$(t).is("input")||$(t).is("textarea")?0<$(t).val().length&&(o=!0):$(t).is("select")&&""===$(t).find(":selected").text()||(o=!0),$(t).prop("required")&&(i=!0)}),o?($('a[href="#'+n+'"]').children(".haveContent").show(),$('a[href="#'+n+'"]').find(".requiredContent").hide()):($('a[href="#'+n+'"]').children(".haveContent").hide(),i?$('a[href="#'+n+'"]').find(".requiredContent").show():$('a[href="#'+n+'"]').find(".requiredContent").hide())})}),addAnother=($(document).on("click",".addAnother",function(e){addAnother(this)}),function(e,t){t=t||1,$(e).attr("disabled",!0);var n=$(e).parents(".tab-pane").find(".control-group"),o=$(n).attr("id").replace("controlGroup_",""),i=$(n).children(".widget_id").first().val(),a=$(n).children("div").length-1,s=e,r=null;return $.get(basePath+"assetManager/getWidget/"+i+"/"+a+"/"+t,function(e){window.offsetCount[o]+=t,r=$(e),$(n).append(r),$(n).find(".isPrimary").show(),$(n).find(".moveDownButton").show(),$(n).find(".moveUpButton").show(),buildAutocomplete(),buildSortable(),$(s).removeAttr("disabled"),n.height()>$(".mainRow").height()&&($(".mainRow").height(n.height()+50),$(".leftPane").height($(".mainRow").height()))}),r}),buildSortable=function(){$(".sortableBlock").sortable({start:function(e,t){$(t.item).css("max-height","600px"),$(t.item).css("overflow","hidden"),$(t.item).find(".textAreaWidget").each(function(){tinymce.execCommand("mceRemoveEditor",!1,$(this).attr("id"))})},stop:function(e,t){$(t.item).css("max-height",""),$(t.item).css("overflow",""),$(t.item).find(".textAreaWidget").each(function(){tinymce.execCommand("mceAddEditor",!0,$(this).attr("id"))}),updateNames($(this))},revert:!0,cancel:".nestedAsset, .tooltipRow, .sortableBlock p, .sortableBlock label, .mainWidgetEntry, .sortableBlock select, .sortableBlock input, .maphost, .mce-container, .sortableBlock textarea"})};function testUnsetIframes(){var e=!1;return $(".nestedAsset").find("iframe").each(function(){-1===$(this).attr("src").indexOf("editAsset")&&(e=!0)}),!e||(bootbox.dialog({message:"Please save this page and reload before moving nested assets",title:"Reload Rquired",backdrop:!0,closeButton:!0}),!1)}function updateNames(e){e.find(".panel").each(function(e){$(this).find("input, select, textarea").each(function(){this.name=this.name.replace(/(\[\d+\])/,"["+e+"]")}),$(this).find(".isPrimary input").val(e)})}function buildAutocomplete(){var e=$("#autocompleter-template").html();Handlebars.compile(e);$(".tryAutocomplete").length&&$(".tryAutocomplete").each(function(e,t){var o=t;$(t).autocomplete({source:function(e,n){var t=$(o).closest(".tab-pane").attr("id"),e=e.term;$.post(basePath+"search/autocomplete/",{templateId:null,fieldTitle:t,searchTerm:e},function(t){try{jsonObject=$.parseJSON(t)}catch(e){return void alert(e+" "+t)}n(jsonObject)})},messages:{noResults:"",results:function(){}}})}),buildAssetAutocomplete($(".widgetContents"))}function loadFrameForNestedElement(e){var t=$(e).find(".templateSelector").val(),n=$("#inputCollectionId").val(),o=$(e).find(".targetAsset").val(),i=null,i=0<o.length?basePath+"assetManager/editAsset/"+o+"/true":basePath+"assetManager/addAsset/"+t+"/"+n+"/true",o=$(e).find(".inlineRelatedAsset"),a=$("<iframe />",{class:"nestediIFrame",frameborder:0,width:"100%",src:i}),s=(a.appendTo(o),$(e).find(".targetAsset"));a.load(function(){iframeLoaded(a);var e={status:"open",targetField:s.attr("id")};this.contentWindow.postMessage(JSON.stringify(e),"*")})}function iframeLoaded(e){var t=$(e).closest(".tab-pane"),t=($(t).attr("id"),$(e).contents().find("html").height());$(e).height(t),$("#collectionId").trigger("change")}$(document).on("click",".moveUp",function(){var e;testUnsetIframes()&&(e=$(this).closest(".widgetContentsContainer")).prevAll(".widgetContentsContainer:first").before(e)}),$(document).on("click",".moveDown",function(){var e;testUnsetIframes()&&(e=$(this).closest(".widgetContentsContainer")).nextAll(".widgetContentsContainer:first").after(e)}),$(document).on("change",".templateSelector",function(e){0===parseInt($(this).val())?$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled","disabled"):$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled",!1)}),$(document).ready(function(){$("#entryForm").parsley({validators:{dateobject:function(){return{validate:function(e,t){return parseDateString(e,t)},priority:2}}},messages:{dateobject:"We couldn't figure out a way to parse this date."}}),buildSortable(),$("#collectionId").on("change",function(e){var o=$(this).val();$(".nestediIFrame").each(function(e,t){var n=$(t).contents().find("#collectionId");n.val(o),$(n).trigger("change"),$(t).get(0).contentWindow&&void 0!==$(t).get(0).contentWindow.resetCollection&&$(t).get(0).contentWindow.resetCollection()})}),showHaveEntries(),$(".control-group").each(function(e,t){1<$(t).find(".isPrimary").length&&$(t).find(".isPrimary").show(),1<$(t).find(".moveDownButton").length&&$(t).find(".moveDownButton").show(),1<$(t).find(".moveUpButton").length&&$(t).find(".moveUpButton").show()}),$("input,select").keypress(function(e){return 13!=e.keyCode}),$("#inputAvailableAfter").datepicker(),""!==$("#inputObjectId").val()&&($(".viewAsset").show(),loadPreviewAndUpdateTitle($("#inputObjectId").val())),$(".templateSelector").trigger("change"),$(".relatedAssetSelectedItem").each(function(e,t){t=$(t).val();relatedAssetPreview(t,this,$(".widgetContents"))}),$("#inputNewTemplateId").on("change",function(){var o=this;targetTemplate=$(o).val(),sourceTemplate=$("#sourceTemplate").val(),"---"==targetTemplate?$(o).val(sourceTemplate):jQuery.getJSON(basePath+"assetManager/compareTemplates/"+sourceTemplate+"/"+targetTemplate,{},function(e,t){var n;0===e.length?$("#sourceTemplate").val(targetTemplate):(n=$("#template-switch").html(),n=Handlebars.compile(n),bootbox.confirm(n(e),function(e){e?$("#sourceTemplate").val(targetTemplate):$(o).val(sourceTemplate)}))})}),$("#newCollectionId").on("change",function(){var o=this;targetCollection=$(o).val(),"-1"===(sourceCollection=$("#collectionId").val())||""===sourceCollection?($("#collectionId").val(targetCollection),$("#collectionId").trigger("change")):jQuery.getJSON(basePath+"assetManager/compareCollections/"+sourceCollection+"/"+targetCollection,{},function(e,t){var n;!1===e.migration?($("#collectionId").val(targetCollection),$("#collectionId").trigger("change")):(n=$("#collection-switch").html(),n=Handlebars.compile(n),bootbox.confirm(n(e),function(e){e?($("#collectionId").val(targetCollection),$("#collectionId").trigger("change"),$("#collectionMigrationInProcess").val("true")):$(o).val(sourceCollection)}))})}),buildAutocomplete(),$("#collectionMigrationInProcess").on("change",function(){"true"==$(this).val()&&($(".saveButton").hide(),bootbox.dialog({message:"Editing is unavailable while collection migration is taking place.",title:"Edits Disabled",backdrop:!0,closeButton:!1}))}),$("#collectionMigrationInProcess").trigger("change")}),$(document).on("click",".autocompletePreview",function(e){var t=$(this).closest(".widgetContents").find(".targetAsset").val();return window.open(basePath+"asset/viewAsset/"+t),!1}),$(document).on("click",".viewAsset",function(){window.open(basePath+"asset/viewAsset/"+$("#inputObjectId").val())}),$(document).on("click",".clearRelated",function(e){confirm("Are you sure you wish to clear this asset?")&&($(this).closest(".widgetContents").find(".relatedAssetInput").val(""),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").val(""),$(this).closest(".widgetContents").find(".relatedAssetInput").trigger("change"),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").trigger("change"),$(this).closest(".widgetContents").find(".autocompletePreview").hide(),$(this).closest(".widgetContents").find(".autocompleteEdit").hide(),$(this).closest(".widgetContents").find(".assetPreview").html(""),$(this).closest(".widgetContents").find(".clearRelated").hide(),$(this).closest(".widgetContents").find(".nestediIFrame").remove(),$(this).closest(".widgetContents").find(".newAssetButton").removeAttr("disabled"))});var objectId=null;function nextResultLink(e){window.location=basePath+"assetManager/editAsset/"+e}$(document).ready(function(){10<$("#inputObjectId").val().length&&(objectId=$("#inputObjectId").val()),loadLastSearch()}),$(document).on("change",".importTextForSidecar",function(e){var t=$(this).data("target"),e=e.target.files[0],n=new FileReader;n.onload=function(e){$('[name="'+t+'"]').val(e.target.result)},n.readAsText(e)});
//# sourceMappingURL=widgetHelpers.min.js.map
