var markSaveDirty=function(){$(".saveButton").removeClass("btn-primary").addClass("btn-warning"),$("#entryForm").removeClass("clean").addClass("dirty")},markSaveClean=function(){$(".saveButton").removeClass("btn-warning").addClass("btn-primary"),$("#entryForm").removeClass("dirty").addClass("clean")};Handlebars.registerHelper("join",function(e,t,n,i){var o=[].concat(e);return t="string"==typeof t?t:", ",n=n||0,i=void 0===i?o.length:i,o.slice(n,i).join(t)}),Handlebars.registerHelper("random",function(e){return Math.random()}),$(window).bind("beforeunload",function(){if(uploadCount>0)return"You have uploads in progress. Are you sure you wish to leave the page and cancel these uploads?"});var showHaveEntries=function(){$(".tab-pane").each(function(e,t){var n=$(t).attr("id"),i=!1,o=!1,a=$(t).find(".mainWidgetEntry");$(a).each(function(e,t){$(t).is("input")||$(t).is("textarea")?$(t).val().length>0&&(i=!0):$(t).is("select")?""!==$(t).find(":selected").text()&&(i=!0):i=!0,$(t).prop("required")&&(o=!0)}),i?($('a[href="#'+n+'"]').children(".haveContent").show(),$('a[href="#'+n+'"]').find(".requiredContent").hide()):($('a[href="#'+n+'"]').children(".haveContent").hide(),o?$('a[href="#'+n+'"]').find(".requiredContent").show():$('a[href="#'+n+'"]').find(".requiredContent").hide())})};$(document).ready(function(){$(document).on("change",".mainWidgetEntry",function(e){showHaveEntries(),markSaveDirty()})});var addAnother=function(e){$(e).attr("disabled",!0);var t=$(e).parents(".tab-pane").find(".control-group"),n=$(t).attr("id").replace("controlGroup_",""),i=$(t).children(".widget_id").first().val(),o=$(t).children("div").length-1,a=e,s=null;return $.get(basePath+"assetManager/getWidget/"+i+"/"+o,function(e){window.offsetCount[n]++,s=$(e),$(t).append(s),$(t).find(".isPrimary").show(),buildAutocomplete(),buildSortable(),$(a).removeAttr("disabled"),t.height()>$(".mainRow").height()&&($(".mainRow").height(t.height()+50),$(".leftPane").height($(".mainRow").height()))}),s};$(document).on("click",".addAnother",function(e){addAnother(this)});var buildSortable=function(){$(".sortableBlock").sortable({start:function(e,t){$(t.item).css("max-height","600px"),$(t.item).css("overflow","hidden"),$(t.item).find(".textAreaWidget").each(function(){tinymce.execCommand("mceRemoveEditor",!1,$(this).attr("id"))})},stop:function(e,t){$(t.item).css("max-height",""),$(t.item).css("overflow",""),$(t.item).find(".textAreaWidget").each(function(){tinymce.execCommand("mceAddEditor",!0,$(this).attr("id"))}),updateNames($(this))},revert:!0,cancel:".tooltipRow, .sortableBlock p, .sortableBlock label, .mainWidgetEntry, .sortableBlock select, .sortableBlock input, .maphost, .mce-container, .sortableBlock textarea"})};function updateNames(e){e.find(".panel").each(function(e){$(this).find("input, select, textarea").each(function(){this.name=this.name.replace(/(\[\d\])/,"["+e+"]")}),$(this).find(".isPrimary input").val(e)})}function buildAutocomplete(){var e=$("#autocompleter-template").html();Handlebars.compile(e);$(".tryAutocomplete").length&&$(".tryAutocomplete").each(function(e,t){var n=t;$(t).autocomplete({source:function(e,t){var i=$("#sourceTemplate").val(),o=$(n).closest(".tab-pane").attr("id"),a=e.term;$.post(basePath+"search/autocomplete/",{templateId:i,fieldTitle:o,searchTerm:a},function(e){try{jsonObject=$.parseJSON(e)}catch(t){return void alert(t+" "+e)}t(jsonObject)})},messages:{noResults:"",results:function(){}}})}),buildAssetAutocomplete($(".widgetContents"))}function loadFrameForNestedElement(e){var t=$(e).find(".templateSelector").val(),n=$("#inputCollectionId").val(),i=$(e).find(".targetAsset").val(),o=null;o=i.length>0?basePath+"assetManager/editAsset/"+i+"/true":basePath+"assetManager/addAsset/"+t+"/"+n+"/true";var a=$(e).find(".inlineRelatedAsset"),s=$("<iframe />",{class:"nestediIFrame",frameborder:0,width:"100%",src:o});s.appendTo(a);var r=$(e).find(".targetAsset");s.load(function(){iframeLoaded(s);var e={status:"open",targetField:r.attr("id")};this.contentWindow.postMessage(JSON.stringify(e),"*")})}function iframeLoaded(e){var t=$(e).closest(".tab-pane"),n=($(t).attr("id"),$(e).contents().find("html").height());$(e).height(n),$("#collectionId").trigger("change")}$(document).on("change",".templateSelector",function(e){0===parseInt($(this).val())?$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled","disabled"):$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled",!1)}),$(document).ready(function(){$("#entryForm").parsley({validators:{dateobject:function(){return{validate:function(e,t){return parseDateString(e,t)},priority:2}}},messages:{dateobject:"We couldn't figure out a way to parse this date."}}),buildSortable(),$("#collectionId").on("change",function(e){var t=$(this).val();$(".nestediIFrame").each(function(e,n){var i=$(n).contents().find("#collectionId");i.val(t),$(i).trigger("change"),$(n).get(0).contentWindow&&void 0!==$(n).get(0).contentWindow.resetCollection&&$(n).get(0).contentWindow.resetCollection()})}),showHaveEntries(),$(".control-group").each(function(e,t){$(t).find(".isPrimary").length>1&&$(t).find(".isPrimary").show()}),$("input,select").keypress(function(e){return 13!=e.keyCode}),$("#inputAvailableAfter").datepicker(),""!==$("#inputObjectId").val()&&($(".viewAsset").show(),loadPreviewAndUpdateTitle($("#inputObjectId").val())),$(".templateSelector").trigger("change"),$(".relatedAssetSelectedItem").each(function(e,t){var n=$(t).val();relatedAssetPreview(n,this,$(".widgetContents"))}),$("#inputNewTemplateId").on("change",function(){var e=this;targetTemplate=$(e).val(),sourceTemplate=$("#sourceTemplate").val(),jQuery.getJSON(basePath+"assetManager/compareTemplates/"+sourceTemplate+"/"+targetTemplate,{},function(t,n){if(0===t.length)$("#sourceTemplate").val(targetTemplate);else{var i=$("#template-switch").html(),o=Handlebars.compile(i);bootbox.confirm(o(t),function(t){t?$("#sourceTemplate").val(targetTemplate):$(e).val(sourceTemplate)})}})}),$("#newCollectionId").on("change",function(){var e=this;if(targetCollection=$(e).val(),sourceCollection=$("#collectionId").val(),"-1"===sourceCollection||""===sourceCollection)return $("#collectionId").val(targetCollection),void $("#collectionId").trigger("change");jQuery.getJSON(basePath+"assetManager/compareCollections/"+sourceCollection+"/"+targetCollection,{},function(t,n){if(!1===t.migration)$("#collectionId").val(targetCollection),$("#collectionId").trigger("change");else{var i=$("#collection-switch").html(),o=Handlebars.compile(i);bootbox.confirm(o(t),function(t){t?($("#collectionId").val(targetCollection),$("#collectionId").trigger("change"),$("#collectionMigrationInProcess").val("true")):$(e).val(sourceCollection)})}})}),buildAutocomplete(),$("#collectionMigrationInProcess").on("change",function(){"true"==$(this).val()&&($(".saveButton").hide(),bootbox.dialog({message:"Editing is unavailable while collection migration is taking place.",title:"Edits Disabled",backdrop:!0,closeButton:!1}))}),$("#collectionMigrationInProcess").trigger("change")}),$(document).on("click",".autocompletePreview",function(e){var t=$(this).closest(".widgetContents").find(".targetAsset").val();return window.open(basePath+"asset/viewAsset/"+t),!1}),$(document).on("click",".viewAsset",function(){window.open(basePath+"asset/viewAsset/"+$("#inputObjectId").val())}),$(document).on("click",".clearRelated",function(e){confirm("Are you sure you wish to clear this asset?")&&($(this).closest(".widgetContents").find(".relatedAssetInput").val(""),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").val(""),$(this).closest(".widgetContents").find(".relatedAssetInput").trigger("change"),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").trigger("change"),$(this).closest(".widgetContents").find(".autocompletePreview").hide(),$(this).closest(".widgetContents").find(".autocompleteEdit").hide(),$(this).closest(".widgetContents").find(".assetPreview").html(""),$(this).closest(".widgetContents").find(".clearRelated").hide(),$(this).closest(".widgetContents").find(".nestediIFrame").remove(),$(this).closest(".widgetContents").find(".newAssetButton").removeAttr("disabled"))});
//# sourceMappingURL=widgetHelpers.min.js.map
