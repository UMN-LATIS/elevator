var markSaveDirty=function(){$(".saveButton").removeClass("btn-primary").addClass("btn-warning"),$("#entryForm").removeClass("clean").addClass("dirty")},markSaveClean=function(){$(".saveButton").removeClass("btn-warning").addClass("btn-primary"),$("#entryForm").removeClass("dirty").addClass("clean")};Handlebars.registerHelper("join",(function(e,t,n,o){var i=[].concat(e);return t="string"==typeof t?t:", ",n=n||0,o=void 0===o?i.length:o,i.slice(n,o).join(t)})),Handlebars.registerHelper("random",(function(e){return Math.random()})),$(window).bind("beforeunload",(function(){if(uploadCount>0)return"You have uploads in progress. Are you sure you wish to leave the page and cancel these uploads?"})),$(document).ready((function(){$(document).on("change",".mainWidgetEntry",(function(e){showHaveEntries(),markSaveDirty()}))}));var showHaveEntries=function(){$(".tab-pane").each((function(e,t){var n=$(t).attr("id"),o=!1,i=!1,a=$(t).find(".mainWidgetEntry");$(a).each((function(e,t){$(t).is("input")||$(t).is("textarea")?$(t).val().length>0&&(o=!0):$(t).is("select")?""!==$(t).find(":selected").text()&&(o=!0):o=!0,$(t).prop("required")&&(i=!0)})),o?($('a[href="#'+n+'"]').children(".haveContent").show(),$('a[href="#'+n+'"]').find(".requiredContent").hide()):($('a[href="#'+n+'"]').children(".haveContent").hide(),i?$('a[href="#'+n+'"]').find(".requiredContent").show():$('a[href="#'+n+'"]').find(".requiredContent").hide())}))};$(document).on("click",".addAnother",(function(e){addAnother(this)}));var addAnother=function(e,t){t||(t=1),$(e).attr("disabled",!0);var n=$(e).parents(".tab-pane").find(".control-group"),o=$(n).attr("id").replace("controlGroup_",""),i=$(n).children(".widget_id").first().val(),a=$(n).children("div").length-1,s=e,r=null;return $.get(basePath+"assetManager/getWidget/"+i+"/"+a+"/"+t,(function(e){window.offsetCount[o]+=t,r=$(e),$(n).append(r),$(n).find(".isPrimary").show(),$(n).find(".moveDownButton").show(),$(n).find(".moveUpButton").show(),buildAutocomplete(),buildSortable(),$(s).removeAttr("disabled"),n.height()>$(".mainRow").height()&&($(".mainRow").height(n.height()+50),$(".leftPane").height($(".mainRow").height()))})),r},buildSortable=function(){$(".sortableBlock").sortable({start:function(e,t){$(t.item).css("max-height","600px"),$(t.item).css("overflow","hidden"),$(t.item).find(".textAreaWidget").each((function(){tinymce.execCommand("mceRemoveEditor",!1,$(this).attr("id"))}))},stop:function(e,t){$(t.item).css("max-height",""),$(t.item).css("overflow",""),$(t.item).find(".textAreaWidget").each((function(){tinymce.execCommand("mceAddEditor",!0,$(this).attr("id"))})),updateNames($(this))},revert:!0,cancel:".nestedAsset, .tooltipRow, .sortableBlock p, .sortableBlock label, .mainWidgetEntry, .sortableBlock select, .sortableBlock input, .maphost, .mce-container, .sortableBlock textarea"})};function testUnsetIframes(){var e=!1;return $(".nestedAsset").find("iframe").each((function(){-1===$(this).attr("src").indexOf("editAsset")&&(e=!0)})),!e||(bootbox.dialog({message:"Please save this page and reload before moving nested assets",title:"Reload Rquired",backdrop:!0,closeButton:!0}),!1)}function updateNames(e){e.find(".panel").each((function(e){$(this).find("input, select, textarea").each((function(){this.name=this.name.replace(/(\[\d+\])/,"["+e+"]")})),$(this).find(".isPrimary input").val(e)}))}function buildAutocomplete(){var e=$("#autocompleter-template").html();Handlebars.compile(e);$(".tryAutocomplete").length&&$(".tryAutocomplete").each((function(e,t){var n=t;$(t).autocomplete({source:function(e,t){var o=$(n).closest(".tab-pane").attr("id"),i=e.term;$.post(basePath+"search/autocomplete/",{templateId:null,fieldTitle:o,searchTerm:i},(function(e){try{jsonObject=$.parseJSON(e)}catch(t){return void alert(t+" "+e)}t(jsonObject)}))},messages:{noResults:"",results:function(){}}})})),buildAssetAutocomplete($(".widgetContents"))}function loadFrameForNestedElement(e){var t=$(e).find(".templateSelector").val(),n=$("#inputCollectionId").val(),o=$(e).find(".targetAsset").val(),i=null;i=o.length>0?basePath+"assetManager/editAsset/"+o+"/true":basePath+"assetManager/addAsset/"+t+"/"+n+"/true";var a=$(e).find(".inlineRelatedAsset"),s=$("<iframe />",{class:"nestediIFrame",frameborder:0,width:"100%",src:i});s.appendTo(a);var r=$(e).find(".targetAsset");s.load((function(){iframeLoaded(s);var e={status:"open",targetField:r.attr("id")};this.contentWindow.postMessage(JSON.stringify(e),"*")}))}function iframeLoaded(e){var t=$(e).closest(".tab-pane"),n=($(t).attr("id"),$(e).contents().find("html").height());$(e).height(n),$("#collectionId").trigger("change")}$(document).on("click",".moveUp",(function(){if(testUnsetIframes()){var e=$(this).closest(".widgetContentsContainer");e.prevAll(".widgetContentsContainer:first").before(e)}})),$(document).on("click",".moveDown",(function(){if(testUnsetIframes()){var e=$(this).closest(".widgetContentsContainer");e.nextAll(".widgetContentsContainer:first").after(e)}})),$(document).on("change",".templateSelector",(function(e){0===parseInt($(this).val())?$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled","disabled"):$(this).closest(".widgetContents").find(".newAssetButton").attr("disabled",!1)})),$(document).ready((function(){$("#entryForm").parsley({validators:{dateobject:function(){return{validate:function(e,t){return parseDateString(e,t)},priority:2}}},messages:{dateobject:"We couldn't figure out a way to parse this date."}}),buildSortable(),$("#collectionId").on("change",(function(e){var t=$(this).val();$(".nestediIFrame").each((function(e,n){var o=$(n).contents().find("#collectionId");o.val(t),$(o).trigger("change"),$(n).get(0).contentWindow&&void 0!==$(n).get(0).contentWindow.resetCollection&&$(n).get(0).contentWindow.resetCollection()}))})),showHaveEntries(),$(".control-group").each((function(e,t){$(t).find(".isPrimary").length>1&&$(t).find(".isPrimary").show(),$(t).find(".moveDownButton").length>1&&$(t).find(".moveDownButton").show(),$(t).find(".moveUpButton").length>1&&$(t).find(".moveUpButton").show()})),$("input,select").keypress((function(e){return 13!=e.keyCode})),$("#inputAvailableAfter").datepicker(),""!==$("#inputObjectId").val()&&($(".viewAsset").show(),loadPreviewAndUpdateTitle($("#inputObjectId").val())),$(".templateSelector").trigger("change"),$(".relatedAssetSelectedItem").each((function(e,t){var n=$(t).val();relatedAssetPreview(n,this,$(".widgetContents"))})),$("#inputNewTemplateId").on("change",(function(){var e=this;targetTemplate=$(e).val(),sourceTemplate=$("#sourceTemplate").val(),"---"!=targetTemplate&&jQuery.getJSON(basePath+"assetManager/compareTemplates/"+sourceTemplate+"/"+targetTemplate,{},(function(t,n){if(0===t.length)$("#sourceTemplate").val(targetTemplate);else{var o=$("#template-switch").html(),i=Handlebars.compile(o);bootbox.confirm(i(t),(function(t){t?$("#sourceTemplate").val(targetTemplate):$(e).val(sourceTemplate)}))}}))})),$("#newCollectionId").on("change",(function(){var e=this;if(targetCollection=$(e).val(),sourceCollection=$("#collectionId").val(),"-1"===sourceCollection||""===sourceCollection)return $("#collectionId").val(targetCollection),void $("#collectionId").trigger("change");jQuery.getJSON(basePath+"assetManager/compareCollections/"+sourceCollection+"/"+targetCollection,{},(function(t,n){if(!1===t.migration)$("#collectionId").val(targetCollection),$("#collectionId").trigger("change");else{var o=$("#collection-switch").html(),i=Handlebars.compile(o);bootbox.confirm(i(t),(function(t){t?($("#collectionId").val(targetCollection),$("#collectionId").trigger("change"),$("#collectionMigrationInProcess").val("true")):$(e).val(sourceCollection)}))}}))})),buildAutocomplete(),$("#collectionMigrationInProcess").on("change",(function(){"true"==$(this).val()&&($(".saveButton").hide(),bootbox.dialog({message:"Editing is unavailable while collection migration is taking place.",title:"Edits Disabled",backdrop:!0,closeButton:!1}))})),$("#collectionMigrationInProcess").trigger("change")})),$(document).on("click",".autocompletePreview",(function(e){var t=$(this).closest(".widgetContents").find(".targetAsset").val();return window.open(basePath+"asset/viewAsset/"+t),!1})),$(document).on("click",".viewAsset",(function(){window.open(basePath+"asset/viewAsset/"+$("#inputObjectId").val())})),$(document).on("click",".clearRelated",(function(e){confirm("Are you sure you wish to clear this asset?")&&($(this).closest(".widgetContents").find(".relatedAssetInput").val(""),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").val(""),$(this).closest(".widgetContents").find(".relatedAssetInput").trigger("change"),$(this).closest(".widgetContents").find(".relatedAssetSelectedItem").trigger("change"),$(this).closest(".widgetContents").find(".autocompletePreview").hide(),$(this).closest(".widgetContents").find(".autocompleteEdit").hide(),$(this).closest(".widgetContents").find(".assetPreview").html(""),$(this).closest(".widgetContents").find(".clearRelated").hide(),$(this).closest(".widgetContents").find(".nestediIFrame").remove(),$(this).closest(".widgetContents").find(".newAssetButton").removeAttr("disabled"))}));var objectId=null;function nextResultLink(e){window.location=basePath+"assetManager/editAsset/"+e}$(document).ready((function(){$("#inputObjectId").val().length>10&&(objectId=$("#inputObjectId").val()),loadLastSearch()}));
//# sourceMappingURL=widgetHelpers.min.js.map
