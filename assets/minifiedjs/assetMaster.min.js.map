{"version":3,"sources":["assetView.js","drawers.js"],"names":["loadEmbedViewPointer","targetObjectId","$","data","targetAsset","document","find","length","first","trigger","nextResultLink","targetId","window","location","basePath","ajaxPrefilter","options","originalOptions","jqXHR","dataType","cache","on","loadLastSearch","fullscreen","isNativelySupported","append","slicePoint","slicePointDefault","expander","e","latitude","relatedTarget","longitude","label","html","loadMap","markers","clearLayer","map","setView","L","layerGroup","localMarker","marker","addLayer","attr","preventDefault","fileObject","target","Handlebars","registerHelper","item","fn","this","inverse","getJSON","json","textStatus","exif","registerPartial","source","template","compile","baseDiv","bootbox","dialog","title","message","buttons","success","className","stopPropagation","nestedObjectId","undefined","hash","removeClass","addClass","targetElement","parents","parentObjectId","eq","closest","get","lazyElements","lazyInstance","addItems","update","searchRequest","searchText","objectId","post","suppressRecent","searchRelated","searchQuery","JSON","stringify","jsonObject","parseJSON","alert","empty","foundRelated","each","matches","index","value","base_url","resultCount","is","has","popover","cookie","searchId","path","replace","xhr","haveSelectedTarget","element","image","Mousetrap","bind","prev","next","select","parent","children","toggle","originalEvent","fileObjectId","needLoadNestedView","hasClass","parentObject","el","scrollTop","offset","top","animate","loadedCallback","ready","postData","serializeArray","push","name","excerptId","cachedResults","searchResults","formURL","ajax","url","type","modal","error","errorThrown","console","log","newDrawer","drawerId","parseInt","drawerTitle","val","fadeIn","setTimeout","fadeOut"],"mappings":"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","file":"assetMaster.min.js","sourcesContent":["\n// disable cache-busted of embedded JS by jquery\n$.ajaxPrefilter(function( options, originalOptions, jqXHR ) {\n  if ( options.dataType == 'script' || originalOptions.dataType == 'script' ) {\n      options.cache = true;\n  }\n});\n\n\n\n$(document).on(\"ready\", function() {\n\n\t// registered in template.js\n\tloadLastSearch();\n\n\t// if we don't support fullscreen, hide hte button entirely\n\tif(!$.fullscreen.isNativelySupported()) {\n\t\t$(\"head\").append('<style> .canFullscreen { display: none;</style>');\n\t}\n\n\tslicePoint = 400;\n\tif(typeof slicePointDefault !== 'undefined') {\n\t\tslicePoint = slicePointDefault;\n\t}\n\t$(\".textareaView li div\").expander({\n\t\tslicePoint: slicePoint\n\t});\n\n\t// show nearby assets\n\t$(\"#mapModal\").on(\"shown.bs.modal\",  function(e) {\n\t\tvar latitude = $(e.relatedTarget).data(\"latitude\");\n\t\tvar longitude = $(e.relatedTarget).data(\"longitude\");\n\t\tvar label = $(e.relatedTarget).html();\n\n\t\t$(\"#mapModalLabel\").html(label);\n\t\t\n\t\tloadMap(\"mapModalContainer\");\n\t\tif(markers) {\n\t\t\tmarkers.clearLayer();\n\t\t}\n\t\t\n\t\tmap.setView([latitude, longitude], 10);\n\n\t\t\n\t\tif(!markers) {\n\t\t\tmarkers = new L.layerGroup();\n\t\t}\n\t\tlocalMarker = L.marker([latitude, longitude]);  \n\t\tmarkers.addLayer(localMarker);\n\t\tmap.addLayer(markers);\n\n\n\t\t$(\"#mapNearby\").attr(\"href\", basePath + \"search/nearbyAssets/\" + latitude + \"/\" + longitude);\n\n\t\treturn false;\n\t});\n\n\n\t// show Exif data for images\n\t$(document).on(\"click\", \".exifToggle\", function(e) {\n\t\te.preventDefault();\n\t\tvar fileObject = $(e.target).data(\"fileobject\");\n\t\tHandlebars.registerHelper('ifObject', function(item, options) {\n  \t\t\tif(typeof item === \"object\") {\n    \t\t\treturn options.fn(this);\n  \t\t\t} else {\n    \t\t\treturn options.inverse(this);\n  \t\t\t}\n\t\t});\n\t\t$.getJSON(basePath + 'fileManager/getMetadataForObject/' + fileObject, {}, function(json, textStatus) {\n\t\t\tif(json.exif) {\n\t\t\t\tHandlebars.registerPartial( \"exif-template\", $( \"#exif-template\" ).html() );\n\t\t\t\tvar source   = $(\"#exif-template\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\t\t\t\tvar baseDiv = $(\"<div class='exifDisplay' />\");\n\t\t\t\t// $.each(, function(index, value) {\n\t\t\t\t\tvar html    = template(json.exif);\n\t\t\t\t\tbaseDiv.append(html);\n\t\t\t\t// });\n\t\t\t\t\n\t\t\t\tbootbox.dialog(\n\t\t\t\t{\n\t\t\t\t\ttitle: \"EXIF Data\",\n\t\t\t\t\tmessage: baseDiv.html(),\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\n\t$(document).on(\"click\", \".relatedThumbContainer\", function(e) {\n\t\te.stopPropagation();\n\t\tvar nestedObjectId = $(this).data(\"objectid\");\n\t\tif(nestedObjectId !== undefined) {\n\t\t\twindow.location.hash = nestedObjectId;\n\t\t}\n\t\telse {\n\t\t\tnestedObjectId = $(this).data(\"fileobjectid\");\n\t\t\tif(nestedObjectId !== undefined) {\n\t\t\t\twindow.location.hash = nestedObjectId;\n\t\t\t}\n\t\t}\n\n\t});\n\n\t// flip chevrons\n\t$(document).on(\"hide.bs.collapse\", \".relatedListToggle\", function(e) {\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');\n\t});\n\n\n\t$(document).on(\"show.bs.collapse\", \".relatedListToggle\", function(e) {\n\t\te.stopPropagation();\n\t\tvar nestedObjectId = $(this).data(\"objectid\");\n\t\tvar targetElement = this;\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');\n\n\t\tif($(targetElement).parents(\".relatedAssetContainer\").length > 0) {\n\t\t\tparentObjectId = $(targetElement).parents(\".relatedAssetContainer\").eq(0).data(\"objectid\");\n\t\t}\n\t\telse {\n\t\t\tparentObjectId = $(this).closest(\".objectIdHost\").data(\"objectid\");\n\t\t}\n\n\t\t$.get(basePath+\"asset/viewAssetMetadataOnly/\"+parentObjectId + \"/\" + nestedObjectId, function(data) {\n\t\t\t$(targetElement).find('.relatedAssetContents').html(data);\n\t\t\tlazyElements = $(targetElement).find('.relatedAssetContents').find(\".lazy\");\n\t\t\tlazyInstance.addItems(lazyElements);\n\t\t\tlazyInstance.update();\n\t\t});\n\t});\n\n\t$('#relatedAccordian').on('hide.bs.collapse', function (e) {\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');\n\t});\n\n\t$('#relatedAccordian').on('show.bs.collapse', function (e) {\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');\n\t\tvar searchRequest = { \"searchText\": objectId};\n\n\t\t// get related results via search\n\t\t$.post( basePath + \"search/searchResults/\", {\"suppressRecent\": true, \"searchRelated\": true, searchQuery:JSON.stringify(searchRequest)}, function( data ) {\n\t\t\ttry{\n\t\t\t\tjsonObject = $.parseJSON(data);\n\t\t\t}\n\t\t\tcatch(e){\n\t\t\t\talert(e + \" \" + data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(jsonObject.success === true) {\n\n\t\t\t\t$(\"#relatedAssets\").empty();\n\t\t\t\tvar source   = $(\"#result-template\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\t\t\t\tvar foundRelated = false;\n\t\t\t\tvar resultCount = 0;\n\t\t\t\t$.each(jsonObject.matches, function(index, value) {\n\t\t\t\t\tif(value.objectId != objectId) {\n\t\t\t\t\t\tvalue.base_url = basePath;\n\t\t\t\t\t\tvar html    = template(value);\n\t\t\t\t\t\t$(\"#relatedAssets\").append(html);\n\t\t\t\t\t\tfoundRelated = true;\n\t\t\t\t\t\tresultCount++;\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t\tif(!foundRelated) {\n\t\t\t\t\t$(\"#relatedAssets\").append(\"<p>No Related Assets Found</p>\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\t// hide popovers when you click elsehwere on the page\n\t$('body').on('click', function (e) {\n\t\t$('[data-toggle=\"popover\"]').each(function () {\n\t\t\t//the 'is' for buttons that trigger popups\n\t\t\t//the 'has' for icons within a button that triggers a popup\n\t\t\tif (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {\n\t\t\t\t$(this).popover('hide');\n\t\t\t}\n\t\t});\n\t});\n\n\n\t// reset the last search on edit so we can do forward/next in that case too\n\t$(document).on(\"click\", \".editAssetLink\", function (e) {\n\t\t$.cookie('lastSearch', searchId, {\n\t\t\tpath: \"/\"\n\t\t});\n\t});\n\n\n\t// if they came in with a hash, let's find and load that asset.\n\tif(window.location.hash) {\n\t\tnestedObjectId = window.location.hash.replace(\"#\",\"\");\n\t\tvar targetAsset = $(document).find('[data-fileobjectid=\"' + nestedObjectId + '\"]');\n\t\tif(targetAsset.length>0) {\n\n\t\t}\n\t\telse { // maybe it's a related asset, try that\n\t\t\ttargetAsset = $(document).find('[data-objectid=\"' + nestedObjectId + '\"]').find(\".loadView\");\n\t\t}\n\n\t\tif(targetAsset.length>0) {\n\t\t\t$(targetAsset).trigger(\"click\");\n\t\t}\n\t\telse {\n\t\t\t// load a default element\n\t\t\tloadEmbedViewPointer();\n\t\t}\n\n\t}\n\telse if(searchId && $(\".rightColumn\").find(\".loadView\").length>1) {\n\t\t// we have multiple subviews, let's ask the search engine if there's one we should highlight\n\t\t$.post(basePath + \"search/getHighlight\", {searchId: searchId, objectId: objectId}, function(data, textStatus, xhr) {\n\t\t\tvar json = $.parseJSON(data);\n\n\t\t\tvar targetAsset = null;\n\t\t\tvar haveSelectedTarget = false;\n\t\t\t$.each(json, function(index, element) {\n\t\t\t\tif(element != $(\"#embedView\").data(\"objectid\")) {\n\t\t\t\t\ttargetAsset = $(document).find('[data-fileobjectid=\"' + element + '\"]');\n\t\t\t\t\tif(targetAsset.length>0) {\n\n\t\t\t\t\t}\n\t\t\t\t\telse { // maybe it's a related asset, try that\n\t\t\t\t\t\ttargetAsset = $(document).find('[data-objectid=\"' + element + '\"]').find(\".loadView\");\n\t\t\t\t\t}\n\t\t\t\t\tif(targetAsset.length>0) {\n\t\t\t\t\t\t$(targetAsset).trigger(\"click\");\n\t\t\t\t\t\thaveSelectedTarget = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t});\n\t\t\tif(!haveSelectedTarget) {\n\t\t\t\t// just load a default\n\t\t\t\tloadEmbedViewPointer();\n\t\t\t}\n\n\t\t});\n\t}\n\telse {\n\t\tloadEmbedViewPointer();\n\t}\n});\n\n// use the 2x image for mouseovers\n$(document).on(\"mouseover\", \".relatedThumbToggle\", function() {\n\tvar image = $(this).find(\".relatedThumbContainerImage\");\n\t$(image).data(\"oldURL\", $(image).attr(\"src\"));\n\tvar data = $(image).data(\"hover\");\n\t$(image).attr(\"src\", data);\n\n});\n\n// hide the 2x image\n$(document).on(\"mouseout\", \".relatedThumbToggle\", function() {\n\tvar image = $(this).find(\".relatedThumbContainerImage\");\n\tvar data = $(image).data(\"oldURL\");\n\t$(image).attr(\"src\", data);\n\n});\n\n\nMousetrap.bind('left', function() {\n\t$(\".relatedThumbHighlight\").closest(\".col-sm-2\").prev().find(\"img\").trigger(\"click\");\n});\n\nMousetrap.bind('right', function() {\n\t$(\".relatedThumbHighlight\").closest(\".col-sm-2\").next().find(\"img\").trigger(\"click\");\n});\n\n$(document).on(\"click\", \".embedControl\", function() {\n\t$(this).select();\n});\n\n$(document).on(\"click\", \".showDetails\", function() {\n\t$(this).parent().parent().children('.assetDetails').toggle(\"fast\");\n});\n\n// main handler for loading assets\n$(document).on(\"click\", \".loadView\", function(e) {\n\tif (e.originalEvent === undefined) {\n\t\te.preventDefault();\n\t}\n\tfileObjectId = $(this).data(\"fileobjectid\");\n\n\tvar parent = $(this).closest(\"[data-objectid]\");\n\n\tvar needLoadNestedView = false;\n\n\tif(parent.length>0 && (!parent.hasClass('objectIdHost') || (parent.hasClass('objectIdHost') && parent.hasClass('sidebarContainer')))) {\n\t\t// we're within a nested asset, rather than a straight thumbnail, let's also load the content for that.\n\t\t// if we've been loaded in the left column, as a nested view, we want to make sure we load both the view and reload the metadata, which is why\n\t\t// we check for the sdiebar container\n\t\tparentObject = parent.data(\"objectid\");\n\t\tneedLoadNestedView = true;\n\t}\n\telse {\n\t\tparentObject = $(this).closest(\".objectIdHost\").data(\"objectid\");\n\t}\n\n\t// we pass in the page's objectId so that assets inside drawers load properly.\n\n\n\t$.get(basePath+\"asset/getEmbed/\"+fileObjectId + \"/\" + objectId, function(data){\n\t\t$(\"#embedView\").html(data);\n\t\t$(\"#embedView\").data(\"objectid\", fileObjectId);\n\n\t\t$(document).find(\".relatedThumbHighlight\").removeClass(\"relatedThumbHighlight\");\n\t\tif($(\".rightColumn\").find('[data-fileobjectid]').length > 1) {\n\t\t\tvar parentContainer = $(document).find('[data-fileobjectid=\"' + fileObjectId + '\"]').parent();\n\t\t\tparentContainer.each(function(index, el) {\n\t\t\t\tif($(el).is('div')) {\n\t\t\t\t\t$(el).addClass(\"relatedThumbHighlight\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvar y = $(window).scrollTop();\n\t\tvar z = $('#embedView').offset().top + 400;\n\t\tif(y>z) {\n\t\t\t$(\"html, body\").animate({ scrollTop: 0 }, \"fast\");\n\t\t}\n\n\t\tlazyElements = $(\"#embedView\").find(\".lazy\");\n\t\tlazyInstance.addItems(lazyElements);\n\t\tlazyInstance.update();\n\n\t\tif(needLoadNestedView) {\n\t\t\t$.get(basePath+\"asset/viewAssetMetadataOnly/\"+objectId + \"/\" + parentObject, function(data) {\n\t\t\t\t$(\"#embedView\").append(data);\n\t\t\t\tlazyElements = $(\"#embedView\").find(\".lazy\");\n\t\t\t\tlazyInstance.addItems(lazyElements);\n\t\t\t\tlazyInstance.update();\n\t\t\t});\n\t\t}\n\t\tlazyInstance.update();\n\n\t\tif (typeof loadedCallback == 'function') {\n\t\t\tloadedCallback();\n\t\t}\n\t});\n});\n\nfunction loadEmbedViewPointer() {\n\n\ttargetObjectId = $(\"#embedView\").data(\"objectid\");\n\t\tvar targetAsset = $(document).find('[data-fileobjectid=\"' + targetObjectId + '\"]');\n\t\tif(targetAsset.length>0) {\n\n\t\t}\n\t\telse { // maybe it's a related asset, try that\n\t\t\ttargetAsset = $(document).find('[data-objectid=\"' + targetObjectId + '\"]').find(\".loadView\");\n\t\t}\n\n\t\tif(targetAsset.length > 1) {\n\t\t\ttargetAsset = targetAsset.first();\n\t\t}\n\n\t\t$(targetAsset).trigger(\"click\");\n}\n\n// handle \"next\" and \"previous\" while browsing results\nfunction nextResultLink(targetId) {\n\twindow.location = basePath + \"asset/viewAsset/\" + targetId;\n}","\n$(document).ready(function () {\n\n\t$(\"#addToDrawer\").on(\"submit\", function(e) {\n\n\t\te.preventDefault(); //STOP default action\n\t\tvar postData = $(this).serializeArray();\n\n\t\tif(typeof(excerptId) != 'undefined') {\n\t\t\tpostData.push({name: 'excerptId', value: excerptId});\n\t\t}\n\n\t\tif(typeof(objectId) != 'undefined') {\n\t\t\tpostData.push({name: 'objectId', value: objectId});\n\t\t}\n\n\t\tif(typeof(cachedResults) != \"undefined\") {\n\t\t\tpostData.push({name: 'objectArray', value: JSON.stringify(cachedResults.searchResults)});\n\t\t}\n\n\t\tvar formURL = $(this).attr(\"action\");\n\t\t$.ajax({\n\t\t\turl : formURL,\n\t\t\ttype: \"POST\",\n\t\t\tdata : postData,\n\t\t\tsuccess:function(data, textStatus, jqXHR)\n\t\t\t{\n\t\t\t\t$(\"#drawerModal\").modal('toggle');\n\t\t\t},\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t{\n\t\t\t\tconsole.log(\"Error adding Drawer\");\n\t\t\t}\n\t\t});\n\n\n\n\t});\n\n\t$(\"#addNewDrawer\").on(\"submit\", function(e) {\n\t\tvar postData = $(this).serializeArray();\n\t\tvar formURL = $(this).attr(\"action\");\n\t\t$.ajax({\n\t\t\turl : formURL,\n\t\t\ttype: \"POST\",\n\t\t\tdata : postData,\n\t\t\tsuccess:function(data, textStatus, jqXHR)\n\t\t\t{\n\t\t\t\tvar newDrawer = $.parseJSON(data);\n\n\t\t\t\tvar drawerId = parseInt(newDrawer.drawerId,10);\n\t\t\t\t$(\"#drawerList\").append(\"<option value='\" + drawerId + \"'>\" + newDrawer.drawerTitle + \"</option>\");\n\n\t\t\t\t$('#drawerList').val(drawerId);\n\t\t\t\t$(\".drawerAddedSuccess\").fadeIn('400');\n\t\t\t\twindow.setTimeout(function() { $(\".drawerAddedSuccess\").fadeOut('400'); }, 2000);\n\t\t\t},\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t{\n\t\t\t\tconsole.log(\"Error adding Drawer\");\n\t\t\t}\n\t\t});\n\t\te.preventDefault(); //STOP default action\n\t});\n\n});\n"]}