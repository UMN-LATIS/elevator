{"version":3,"sources":["assetView.js","drawers.js"],"names":["nextResultLink","targetId","window","location","basePath","loadEmbedViewPointer","targetObjectId","$","data","targetAsset","document","find","length","first","trigger","ajaxPrefilter","options","originalOptions","jqXHR","dataType","cache","Mousetrap","bind","closest","prev","next","on","registerHandlers","loadLastSearch","fullscreen","isNativelySupported","append","slicePoint","slicePointDefault","expander","hash","nestedObjectId","replace","searchId","post","objectId","textStatus","xhr","json","parseJSON","haveSelectedTarget","each","index","element","resize","resizeElement","loadView","e","this","removeClass","addClass","loadRelatedList","stopPropagation","undefined","loadMapModal","select","parent","children","toggle","loadExif","loadMoreLikeThis","is","target","has","popover","cookie","path","ratio","isNaN","targetHeight","width","height","originalEvent","preventDefault","fileObjectId","needLoadNestedView","hasClass","parentObject","get","html","el","scrollTop","offset","top","animate","lazyElements","lazyInstance","addItems","update","loadedCallback","targetElement","parents","parentObjectId","eq","fileObject","Handlebars","registerHelper","item","fn","inverse","getJSON","exif","registerPartial","source","template","compile","baseDiv","bootbox","dialog","title","message","buttons","success","label","className","latitude","relatedTarget","longitude","loadMap","markers","clearLayer","map","setView","L","layerGroup","localMarker","marker","addLayer","attr","image","searchRequest","searchText","suppressRecent","searchRelated","searchQuery","JSON","stringify","jsonObject","alert","empty","foundRelated","matches","value","base_url","resultCount","ready","postData","serializeArray","push","name","excerptId","cachedResults","searchResults","formURL","ajax","url","type","modal","error","errorThrown","console","log","newDrawer","drawerId","parseInt","drawerTitle","val","fadeIn","setTimeout","fadeOut"],"mappings":"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","file":"assetMaster.min.js","sourcesContent":["\n// disable cache-busted of embedded JS by jquery\n$.ajaxPrefilter(function( options, originalOptions, jqXHR ) {\n  if ( options.dataType == 'script' || originalOptions.dataType == 'script' ) {\n      options.cache = true;\n  }\n});\n\n\nMousetrap.bind('left', function () {\n\t$(\".relatedThumbHighlight\").closest(\".col-sm-2\").prev().find(\"img\").trigger(\"click\");\n});\n\nMousetrap.bind('right', function () {\n\t$(\".relatedThumbHighlight\").closest(\".col-sm-2\").next().find(\"img\").trigger(\"click\");\n});\n\n\n// handle \"next\" and \"previous\" while browsing results\nfunction nextResultLink(targetId) {\n\twindow.location = basePath + \"asset/viewAsset/\" + targetId;\n}\n\n$(document).on(\"ready\", function() {\n\tregisterHandlers();\n\t// registered in template.js\n\tloadLastSearch();\n\n\t// if we don't support fullscreen, hide hte button entirely\n\tif(!$.fullscreen.isNativelySupported()) {\n\t\t$(\"head\").append('<style> .canFullscreen { display: none;</style>');\n\t}\n\n\tslicePoint = 400;\n\tif(typeof slicePointDefault !== 'undefined') {\n\t\tslicePoint = slicePointDefault;\n\t}\n\t$(\".textareaView li div\").expander({\n\t\tslicePoint: slicePoint\n\t});\n\n\t// if they came in with a hash, let's find and load that asset.\n\tif(window.location.hash) {\n\t\tnestedObjectId = window.location.hash.replace(\"#\",\"\");\n\t\tvar targetAsset = $(document).find('[data-fileobjectid=\"' + nestedObjectId + '\"]');\n\t\tif(targetAsset.length>0) {\n\n\t\t}\n\t\telse { // maybe it's a related asset, try that\n\t\t\ttargetAsset = $(document).find('[data-objectid=\"' + nestedObjectId + '\"]').find(\".loadView\");\n\t\t}\n\n\t\tif(targetAsset.length>0) {\n\t\t\t$(targetAsset).trigger(\"click\");\n\t\t}\n\t\telse {\n\t\t\t// load a default element\n\t\t\tloadEmbedViewPointer();\n\t\t}\n\n\t}\n\telse if(searchId && $(\".rightColumn\").find(\".loadView\").length>1) {\n\t\t// we have multiple subviews, let's ask the search engine if there's one we should highlight\n\t\t$.post(basePath + \"search/getHighlight\", {searchId: searchId, objectId: objectId}, function(data, textStatus, xhr) {\n\t\t\tvar json = $.parseJSON(data);\n\n\t\t\tvar targetAsset = null;\n\t\t\tvar haveSelectedTarget = false;\n\t\t\t$.each(json, function(index, element) {\n\t\t\t\tif(element != $(\"#embedView\").data(\"objectid\")) {\n\t\t\t\t\ttargetAsset = $(document).find('[data-fileobjectid=\"' + element + '\"]');\n\t\t\t\t\tif(targetAsset.length>0) {\n\n\t\t\t\t\t}\n\t\t\t\t\telse { // maybe it's a related asset, try that\n\t\t\t\t\t\ttargetAsset = $(document).find('[data-objectid=\"' + element + '\"]').find(\".loadView\");\n\t\t\t\t\t}\n\t\t\t\t\tif(targetAsset.length>0) {\n\t\t\t\t\t\t$(targetAsset).trigger(\"click\");\n\t\t\t\t\t\thaveSelectedTarget = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t});\n\t\t\tif(!haveSelectedTarget) {\n\t\t\t\t// just load a default\n\t\t\t\tloadEmbedViewPointer();\n\t\t\t}\n\n\t\t});\n\t}\n\telse {\n\t\tloadEmbedViewPointer();\n\t}\n});\n\n\nfunction loadEmbedViewPointer() {\n\n\ttargetObjectId = $(\"#embedView\").data(\"objectid\");\n\tvar targetAsset = $(document).find('[data-fileobjectid=\"' + targetObjectId + '\"]');\n\tif(targetAsset.length>0) {\n\n\t}\n\telse { // maybe it's a related asset, try that\n\t\ttargetAsset = $(document).find('[data-objectid=\"' + targetObjectId + '\"]').find(\".loadView\");\n\t}\n\n\tif(targetAsset.length > 1) {\n\t\ttargetAsset = targetAsset.first();\n\t}\n\n\t$(targetAsset).trigger(\"click\");\n}\n\n\nvar registerHandlers = function() {\n\t$(window).resize(resizeElement);\n\n\t/**\n\t * Metadata Handlers\n\t */\n\n\t$(document).on(\"click\", \".loadView\", loadView);\n\n\t// flip chevrons for related asset\n\t$(document).on(\"hide.bs.collapse\", \".relatedListToggle\", function (e) {\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');\n\t});\n\t// load related asset\n\t$(document).on(\"show.bs.collapse\", \".relatedListToggle\", loadRelatedList);\n\n\t// update hash when loading a related asset\n\t$(document).on(\"click\", \".relatedThumbContainer\", function(e) {\n\t\te.stopPropagation();\n\t\tvar nestedObjectId = $(this).data(\"objectid\");\n\t\tif(nestedObjectId !== undefined) {\n\t\t\twindow.location.hash = nestedObjectId;\n\t\t}\n\t\telse {\n\t\t\tnestedObjectId = $(this).data(\"fileobjectid\");\n\t\t\tif(nestedObjectId !== undefined) {\n\t\t\t\twindow.location.hash = nestedObjectId;\n\t\t\t}\n\t\t}\n\t});\n\n\t$(\"#mapModal\").on(\"shown.bs.modal\", loadMapModal);\n\n\t/**\n\t * Digital Asset Handlers\n\t */\n\t$(document).on(\"click\", \".embedControl\", function () {\n\t\t$(this).select();\n\t});\n\n\t$(document).on(\"click\", \".showDetails\", function () {\n\t\t$(this).parent().parent().children('.assetDetails').toggle(\"fast\");\n\t});\n\n\t$(document).on(\"click\", \".exifToggle\", loadExif);\n\n\t/**\n\t * Page Level Handlers\n\t */\n\n\t// flip chevron on 'more like this' accordion\n \t$('#relatedAccordian').on('hide.bs.collapse', function (e) {\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');\n\t});\n\t\n\t$('#relatedAccordian').on('show.bs.collapse', loadMoreLikeThis);\n\n\t// hide popovers when you click elsehwere on the page\n\t$('body').on('click', function (e) {\n\t\t$('[data-toggle=\"popover\"]').each(function () {\n\t\t\t//the 'is' for buttons that trigger popups\n\t\t\t//the 'has' for icons within a button that triggers a popup\n\t\t\tif (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {\n\t\t\t\t$(this).popover('hide');\n\t\t\t}\n\t\t});\n\t});\n\n\t// reset the last search on edit so we can do forward/next in that case too\n\t$(document).on(\"click\", \".editAssetLink\", function (e) {\n\t\t$.cookie('lastSearch', searchId, {\n\t\t\tpath: \"/\"\n\t\t});\n\t});\n};\n\n\n/**\n * Digital Asset Methods\n */\n\n\nvar resizeElement = function() {\n\tvar ratio = $(\".embedAsset\").data(\"ratio\");\n\tif(!isNaN(ratio)) {\n\t\ttargetHeight = $(\".embedAsset\").width() / ratio;\n\t\tif(targetHeight > $(window).height() * 0.7) {\n\t\t\ttargetHeight = $(window).height() * 0.7;\n\t\t}\n\t\t$(\".embedAsset\").height(targetHeight);\n\t}\n};\n\n/**\n * Metadata Methods\n */\n\n\n// main handler for loading assets\nvar loadView = function (e) {\n\tif (e.originalEvent === undefined) {\n\t\te.preventDefault();\n\t}\n\tfileObjectId = $(this).data(\"fileobjectid\");\n\n\tvar parent = $(this).closest(\"[data-objectid]\");\n\n\tvar needLoadNestedView = false;\n\n\tif (parent.length > 0 && (!parent.hasClass('objectIdHost') || (parent.hasClass('objectIdHost') && parent.hasClass('sidebarContainer')))) {\n\t\t// we're within a nested asset, rather than a straight thumbnail, let's also load the content for that.\n\t\t// if we've been loaded in the left column, as a nested view, we want to make sure we load both the view and reload the metadata, which is why\n\t\t// we check for the sdiebar container\n\t\tparentObject = parent.data(\"objectid\");\n\t\tneedLoadNestedView = true;\n\t}\n\telse {\n\t\tparentObject = $(this).closest(\".objectIdHost\").data(\"objectid\");\n\t}\n\n\t// we pass in the page's objectId so that assets inside drawers load properly.\n\n\n\t$.get(basePath + \"asset/getEmbedWithChrome/\" + fileObjectId + \"/\" + objectId, function (data) {\n\t\t$(\"#embedView\").html(data);\n\t\t$(\"#embedView\").data(\"objectid\", fileObjectId);\n\n\t\t$(document).find(\".relatedThumbHighlight\").removeClass(\"relatedThumbHighlight\");\n\t\tif ($(\".rightColumn\").find('[data-fileobjectid]').length > 1) {\n\t\t\tvar parentContainer = $(document).find('[data-fileobjectid=\"' + fileObjectId + '\"]').parent();\n\t\t\tparentContainer.each(function (index, el) {\n\t\t\t\tif ($(el).is('div')) {\n\t\t\t\t\t$(el).addClass(\"relatedThumbHighlight\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvar y = $(window).scrollTop();\n\t\tvar z = $('#embedView').offset().top + 400;\n\t\tif (y > z) {\n\t\t\t$(\"html, body\").animate({ scrollTop: 0 }, \"fast\");\n\t\t}\n\n\t\tlazyElements = $(\"#embedView\").find(\".lazy\");\n\t\tlazyInstance.addItems(lazyElements);\n\t\tlazyInstance.update();\n\n\t\tif (needLoadNestedView) {\n\t\t\t$.get(basePath + \"asset/viewAssetMetadataOnly/\" + objectId + \"/\" + parentObject, function (data) {\n\t\t\t\t$(\"#embedView\").append(data);\n\t\t\t\tlazyElements = $(\"#embedView\").find(\".lazy\");\n\t\t\t\tlazyInstance.addItems(lazyElements);\n\t\t\t\tlazyInstance.update();\n\t\t\t});\n\t\t}\n\t\tlazyInstance.update();\n\n\t\tif (typeof loadedCallback == 'function') {\n\t\t\tloadedCallback();\n\t\t}\n\t});\n};\n\n\nvar loadRelatedList = function (e) {\n\te.stopPropagation();\n\tvar nestedObjectId = $(this).data(\"objectid\");\n\tvar targetElement = this;\n\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');\n\n\tif ($(targetElement).parents(\".relatedAssetContainer\").length > 0) {\n\t\tparentObjectId = $(targetElement).parents(\".relatedAssetContainer\").eq(0).data(\"objectid\");\n\t}\n\telse {\n\t\tparentObjectId = $(this).closest(\".objectIdHost\").data(\"objectid\");\n\t}\n\n\t$.get(basePath + \"asset/viewAssetMetadataOnly/\" + parentObjectId + \"/\" + nestedObjectId, function (data) {\n\t\t$(targetElement).find('.relatedAssetContents').html(data);\n\t\tlazyElements = $(targetElement).find('.relatedAssetContents').find(\".lazy\");\n\t\tlazyInstance.addItems(lazyElements);\n\t\tlazyInstance.update();\n\t});\n};\n\n\n// show Exif data for images\nvar loadExif = function (e) {\n\te.preventDefault();\n\tvar fileObject = $(e.target).data(\"fileobject\");\n\tHandlebars.registerHelper('ifObject', function (item, options) {\n\t\tif (typeof item === \"object\") {\n\t\t\treturn options.fn(this);\n\t\t} else {\n\t\t\treturn options.inverse(this);\n\t\t}\n\t});\n\t$.getJSON(basePath + 'fileManager/getMetadataForObject/' + fileObject, {}, function (json, textStatus) {\n\t\tif (json.exif) {\n\t\t\tHandlebars.registerPartial(\"exif-template\", $(\"#exif-template\").html());\n\t\t\tvar source = $(\"#exif-template\").html();\n\t\t\tvar template = Handlebars.compile(source);\n\t\t\tvar baseDiv = $(\"<div class='exifDisplay' />\");\n\t\t\t// $.each(, function(index, value) {\n\t\t\tvar html = template(json.exif);\n\t\t\tbaseDiv.append(html);\n\t\t\t// });\n\n\t\t\tbootbox.dialog(\n\t\t\t\t{\n\t\t\t\t\ttitle: \"EXIF Data\",\n\t\t\t\t\tmessage: baseDiv.html(),\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t});\n};\n\n\n// load map modal\nvar loadMapModal = function (e) {\n\tvar latitude = $(e.relatedTarget).data(\"latitude\");\n\tvar longitude = $(e.relatedTarget).data(\"longitude\");\n\tvar label = $(e.relatedTarget).html();\n\n\t$(\"#mapModalLabel\").html(label);\n\n\tloadMap(\"mapModalContainer\");\n\tif (markers) {\n\t\tmarkers.clearLayer();\n\t}\n\n\tmap.setView([latitude, longitude], 10);\n\n\n\tif (!markers) {\n\t\tmarkers = new L.layerGroup();\n\t}\n\tlocalMarker = L.marker([latitude, longitude]);\n\tmarkers.addLayer(localMarker);\n\tmap.addLayer(markers);\n\n\n\t$(\"#mapNearby\").attr(\"href\", basePath + \"search/nearbyAssets/\" + latitude + \"/\" + longitude);\n\n\treturn false;\n};\n\n\n\n\n\n/**\n * Document level listeners\n */\n\n// use the 2x image for mouseovers\n$(document).on(\"mouseover\", \".relatedThumbToggle\", function () {\n\tvar image = $(this).find(\".relatedThumbContainerImage\");\n\t$(image).data(\"oldURL\", $(image).attr(\"src\"));\n\tvar data = $(image).data(\"hover\");\n\t$(image).attr(\"src\", data);\n\n});\n\n// hide the 2x image\n$(document).on(\"mouseout\", \".relatedThumbToggle\", function () {\n\tvar image = $(this).find(\".relatedThumbContainerImage\");\n\tvar data = $(image).data(\"oldURL\");\n\t$(image).attr(\"src\", data);\n\n});\n\n\n/**\n * Page level methods\n */\n\nvar loadMoreLikeThis = function (e) {\n\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');\n\tvar searchRequest = { \"searchText\": objectId};\n\n\t// get related results via search\n\t$.post( basePath + \"search/searchResults/\", {\"suppressRecent\": true, \"searchRelated\": true, searchQuery:JSON.stringify(searchRequest)}, function( data ) {\n\t\ttry{\n\t\t\tjsonObject = $.parseJSON(data);\n\t\t}\n\t\tcatch(e){\n\t\t\talert(e + \" \" + data);\n\t\t\treturn;\n\t\t}\n\n\t\tif(jsonObject.success === true) {\n\n\t\t\t$(\"#relatedAssets\").empty();\n\t\t\tvar source   = $(\"#result-template\").html();\n\t\t\tvar template = Handlebars.compile(source);\n\t\t\tvar foundRelated = false;\n\t\t\tvar resultCount = 0;\n\t\t\t$.each(jsonObject.matches, function(index, value) {\n\t\t\t\tif(value.objectId != objectId) {\n\t\t\t\t\tvalue.base_url = basePath;\n\t\t\t\t\tvar html    = template(value);\n\t\t\t\t\t$(\"#relatedAssets\").append(html);\n\t\t\t\t\tfoundRelated = true;\n\t\t\t\t\tresultCount++;\n\t\t\t\t}\n\n\t\t\t});\n\t\t\tif(!foundRelated) {\n\t\t\t\t$(\"#relatedAssets\").append(\"<p>No Related Assets Found</p>\");\n\t\t\t}\n\t\t}\n\t});\n};\n","\n$(document).ready(function () {\n\n\t$(\"#addToDrawer\").on(\"submit\", function(e) {\n\n\t\te.preventDefault(); //STOP default action\n\t\tvar postData = $(this).serializeArray();\n\n\t\tif(typeof(excerptId) != 'undefined') {\n\t\t\tpostData.push({name: 'excerptId', value: excerptId});\n\t\t}\n\n\t\tif(typeof(objectId) != 'undefined') {\n\t\t\tpostData.push({name: 'objectId', value: objectId});\n\t\t}\n\n\t\tif(typeof(cachedResults) != \"undefined\") {\n\t\t\tpostData.push({name: 'objectArray', value: JSON.stringify(cachedResults.searchResults)});\n\t\t}\n\n\t\tvar formURL = $(this).attr(\"action\");\n\t\t$.ajax({\n\t\t\turl : formURL,\n\t\t\ttype: \"POST\",\n\t\t\tdata : postData,\n\t\t\tsuccess:function(data, textStatus, jqXHR)\n\t\t\t{\n\t\t\t\t$(\"#drawerModal\").modal('toggle');\n\t\t\t},\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t{\n\t\t\t\tconsole.log(\"Error adding Drawer\");\n\t\t\t}\n\t\t});\n\n\n\n\t});\n\n\t$(\"#addNewDrawer\").on(\"submit\", function(e) {\n\t\tvar postData = $(this).serializeArray();\n\t\tvar formURL = $(this).attr(\"action\");\n\t\t$.ajax({\n\t\t\turl : formURL,\n\t\t\ttype: \"POST\",\n\t\t\tdata : postData,\n\t\t\tsuccess:function(data, textStatus, jqXHR)\n\t\t\t{\n\t\t\t\tvar newDrawer = $.parseJSON(data);\n\n\t\t\t\tvar drawerId = parseInt(newDrawer.drawerId,10);\n\t\t\t\t$(\"#drawerList\").append(\"<option value='\" + drawerId + \"'>\" + newDrawer.drawerTitle + \"</option>\");\n\n\t\t\t\t$('#drawerList').val(drawerId);\n\t\t\t\t$(\".drawerAddedSuccess\").fadeIn('400');\n\t\t\t\twindow.setTimeout(function() { $(\".drawerAddedSuccess\").fadeOut('400'); }, 2000);\n\t\t\t},\n\t\t\terror: function(jqXHR, textStatus, errorThrown)\n\t\t\t{\n\t\t\t\tconsole.log(\"Error adding Drawer\");\n\t\t\t}\n\t\t});\n\t\te.preventDefault(); //STOP default action\n\t});\n\n});\n"]}