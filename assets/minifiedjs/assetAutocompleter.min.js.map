{"version":3,"file":"assetAutocompleter.min.js","sources":["assetAutocompleter.js"],"sourcesContent":["\nvar relatedAssetPreview = function(relatedAssetId, targetContainer, targetParent) {\n\tif(relatedAssetId.length > 0) {\n\t\tvar source   = $(\"#autocompleter-template\").html();\n\t\tvar template = Handlebars.compile(source);\n\t\tvar self = targetContainer;\n\t\t$.get( basePath + \"asset/getAssetPreview/\" + relatedAssetId,  function( data ) {\n\t\t\ttry{\n\t\t\t\tjsonObject = $.parseJSON(data);\n\t\t\t}\n\t\t\tcatch(e){\n\t\t\t\talert(e + \" \" + data);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(jsonObject) {\n\t\t\t\tvar responseObject = jsonObject;\n\t\t\t\tresponseObject.base_url = basePath;\n\t\t\t\tvar html = template(responseObject);\n\t\t\t\t$(self).closest(targetParent).find(\".autocompletePreview\").show();\n\t\t\t\t$(self).closest(targetParent).find(\".autocompleteEdit\").show();\n\t\t\t\t$(self).closest(targetParent).find(\".clearRelated\").show();\n\t\t\t\t$(self).closest(targetParent).find(\".assetPreview\").html(html);\n\t\t\t\t$(self).closest(targetParent).find(\".newAssetButton\").attr(\"disabled\", true);\n\n\n\t\t\t}\n\t\t});\n\t}\n};\n\n/**\n * special autocompleter that does full text search\n */\n\n\n var buildAssetAutocomplete = function(targetContainer) {\n \tvar source   = $(\"#autocompleter-template\").html();\n\tvar template = Handlebars.compile(source);\n\n \tif($(\".tryAutocompleteAsset\").length) {\n \t\t$(\".tryAutocompleteAsset\").each(function(index, value) {\n \t\t\tif($(value).val().length>0) {\n \t\t\t\t$(value).closest(targetContainer).find(\".autocompletePreview\").show();\n \t\t\t\t$(value).closest(targetContainer).find(\".autocompleteEdit\").show();\n \t\t\t\t$(value).closest(targetContainer).find(\".clearRelated\").show();\n \t\t\t\t$(value).closest(targetContainer).find(\".newAssetButton\").attr(\"disabled\",true);\n \t\t\t}\n \t\t\t$(value).autocomplete({\n \t\t\t\tsource: function(request, response) {\n \t\t\t\t\tvar searchRequest = { \"searchText\": request.term};\n \t\t\t\t\tvar templateId = $(value).closest(targetContainer).find(\".matchAgainstSelector\").val();\n\t\t\t\t\t// todo: there's no reason this should be saving a new search query teach time to begin with\n \t\t\t\t\t$.post( basePath + \"search/searchResults/\", {searchQuery:JSON.stringify(searchRequest), templateId: templateId, suppressRecent:true, showHidden:true}, function( data ) {\n \t\t\t\t\t\ttry{\n\t\t\t\t\t\t\t\tjsonObject = data;\n \t\t\t\t\t\t}\n \t\t\t\t\t\tcatch(e){\n \t\t\t\t\t\t\talert(e + \" \" + data);\n \t\t\t\t\t\t\treturn;\n \t\t\t\t\t\t}\n\n \t\t\t\t\t\tif(jsonObject.success === true) {\n \t\t\t\t\t\t\t$.each(jsonObject.matches, function(index, value) {\n \t\t\t\t\t\t\t\tif(!value || value.objectId == $(\"#inputObjectId\").val()) {\n \t\t\t\t\t\t\t\t\tjsonObject.matches.splice(index,1);\n \t\t\t\t\t\t\t\t\treturn true;\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\tvalue.value = value.objectId;\n \t\t\t\t\t\t\t\tjsonObject.matches[index] = value;\n \t\t\t\t\t\t\t});\n\n \t\t\t\t\t\t\tresponse(jsonObject.matches);\n \t\t\t\t\t\t}\n \t\t\t\t\t}).fail(function (e) {\n \t\t\t\t\t\tif (e.readyState > 0) {\n \t\t\t\t\t\t\talert(JSON.stringify(e));\n \t\t\t\t\t\t}\n\n \t\t\t\t\t});\n \t\t\t\t},\n \t\t\t\tmessages: {\n \t\t\t\t\tnoResults: '',\n \t\t\t\t\tresults: function() {}\n \t\t\t\t},\n \t\t\t\tclose: function(event, ui){\n \t\t\t\t\tif(event.which !== undefined) {\n \t\t\t\t\t\t// if we're not using the same field to query and store the id, clear the query field\n \t\t\t\t\t\tif(!$(value).hasClass(\"relatedAssetSelectedItem\")) {\n \t\t\t\t\t\t\t$(value).val('');\t\n \t\t\t\t\t\t}\n \t\t\t\t\t\t\n \t\t\t\t\t}\n\n \t\t\t\t},\n \t\t\t\tselect: function(event, ui){\n \t\t\t\t\t$(value).closest(targetContainer).find(\".relatedAssetSelectedItem\").val(ui.item.objectId);\n \t\t\t\t\tvar html = template(ui.item);\n \t\t\t\t\t$(this).trigger(\"change\");\n \t\t\t\t\t$(this).closest(targetContainer).find(\".autocompletePreview\").show();\n \t\t\t\t\t$(this).closest(targetContainer).find(\".autocompleteEdit\").show();\n \t\t\t\t\t$(this).closest(targetContainer).find(\".clearRelated\").show();\n \t\t\t\t\t$(this).closest(targetContainer).find(\".newAssetButton\").attr(\"disabled\",true);\n \t\t\t\t\t$(this).closest(targetContainer).find(\".assetPreview\").html(html);\n \t\t\t\t}\n \t\t\t}).data(\"ui-autocomplete\")._renderItem = function( ul, item ) {\n \t\t\t\titem.base_url = basePath;\n \t\t\t\tvar html = template(item);\n \t\t\t\treturn $(html).appendTo(ul);\n \t\t\t};\n \t\t});\n \t}\n };"],"names":["relatedAssetPreview","relatedAssetId","targetContainer","targetParent","source","template","self","length","$","html","Handlebars","compile","get","basePath","data","jsonObject","parseJSON","e","alert","responseObject","base_url","closest","find","show","attr","buildAssetAutocomplete","each","index","value","val","autocomplete","request","response","searchRequest","searchText","term","templateId","post","searchQuery","JSON","stringify","suppressRecent","showHidden","success","matches","objectId","splice","fail","readyState","messages","noResults","results","close","event","ui","undefined","which","hasClass","select","item","this","trigger","_renderItem","ul","appendTo"],"mappings":"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"}