{"version":3,"sources":["assetView.js"],"names":["loadEmbedViewPointer","targetObjectId","$","data","targetAsset","document","find","length","first","trigger","ajaxPrefilter","options","originalOptions","jqXHR","dataType","cache","on","fullscreen","isNativelySupported","append","slicePoint","undefined","slicePointDefault","expander","e","latitude","relatedTarget","longitude","label","html","goMap","mapTypeControl","maptype","mapTypeControlOptions","position","style","getMarkerCount","clearMarkers","setMap","createMarker","draggable","fitBounds","attr","basePath","preventDefault","fileObject","target","getJSON","json","textStatus","exif","baseUL","each","index","el","bootbox","dialog","title","message","buttons","success","className","stopPropagation","nestedObjectId","this","window","location","hash","removeClass","addClass","targetElement","parents","parentObjectId","eq","closest","get","lazyElements","lazyInstance","addItems","update","searchRequest","searchText","objectId","post","suppressRecent","searchRelated","searchQuery","JSON","stringify","jsonObject","parseJSON","alert","empty","source","template","Handlebars","compile","foundRelated","resultCount","matches","value","base_url","searchId","cookie","removeCookie","path","is","has","popover","replace","xhr","haveSelectedTarget","element","image","Mousetrap","bind","prev","next","select","parent","children","toggle","originalEvent","fileObjectId","needLoadNestedView","hasClass","parentObject","parentContainer","y","scrollTop","z","offset","top","animate","loadedCallback"],"mappings":"AAsVA,QAASA,wBAERC,eAAiBC,EAAE,cAAcC,KAAK,WACrC,IAAIC,GAAcF,EAAEG,UAAUC,KAAK,uBAAyBL,eAAiB,KAC1EG,GAAYG,OAAO,IAIrBH,EAAcF,EAAEG,UAAUC,KAAK,mBAAqBL,eAAiB,MAAMK,KAAK,cAG9EF,EAAYG,OAAS,IACvBH,EAAcA,EAAYI,SAG3BN,EAAEE,GAAaK,QAAQ,SAnWzBP,EAAEQ,cAAc,SAAUC,EAASC,EAAiBC,GACzB,UAApBF,EAAQG,UAAoD,UAA5BF,EAAgBE,WACjDH,EAAQI,OAAQ,KAMtBb,EAAEG,UAAUW,GAAG,QAAS,WAGnBd,EAAEe,WAAWC,uBAChBhB,EAAE,QAAQiB,OAAO,mDAGlBC,WAAa,IACYC,SAAtBC,oBACFF,WAAaE,mBAEdpB,EAAE,wBAAwBqB,UACzBH,WAAYA,aAIblB,EAAE,aAAac,GAAG,iBAAmB,SAASQ,GAC7C,GAAIC,GAAWvB,EAAEsB,EAAEE,eAAevB,KAAK,YACnCwB,EAAYzB,EAAEsB,EAAEE,eAAevB,KAAK,aACpCyB,EAAQ1B,EAAEsB,EAAEE,eAAeG,MAE/B3B,GAAE,kBAAkB2B,KAAKD,GACzB1B,EAAE,sBAAsB4B,OACvBC,gBAAe,EACfC,QAAS,UACTC,uBACCC,SAAU,YACVC,MAAO,mBAINjC,EAAE4B,MAAMM,iBAAiB,GAC3BlC,EAAE4B,MAAMO,eAETnC,EAAE4B,MAAMQ,QACPb,SAAUA,EACVE,UAAWA,IAGZzB,EAAE,sBAAsB4B,OACX5B,GAAE4B,MAAMS,cACpBd,SAAUA,EACVE,UAAWA,EACXa,WAAW,GAMZ,OAJAtC,GAAE4B,MAAMW,YAERvC,EAAE,cAAcwC,KAAK,OAAQC,SAAW,uBAAyBlB,EAAW,IAAME,IAE3E,IAKRzB,EAAEG,UAAUW,GAAG,QAAS,cAAe,SAASQ,GAC/CA,EAAEoB,gBACF,IAAIC,GAAa3C,EAAEsB,EAAEsB,QAAQ3C,KAAK,aAElCD,GAAE6C,QAAQJ,SAAW,oCAAsCE,KAAgB,SAASG,EAAMC,GACzF,GAAGD,EAAKE,KAAM,CACb,GAAIC,GAASjD,EAAE,SACfA,GAAEkD,KAAKJ,EAAKE,KAAM,SAASG,EAAOC,GACjCH,EAAOhC,OAAO,OAASkC,EAAQ,MAAQC,EAAK,WAE7CC,QAAQC,QAEPC,MAAO,YACPC,QAASP,EAAOtB,OAChB8B,SACCC,SACChC,MAAO,KACPiC,UAAW,uBAQjB3D,EAAEG,UAAUW,GAAG,QAAS,yBAA0B,SAASQ,GAC1DA,EAAEsC,iBACF,IAAIC,GAAiB7D,EAAE8D,MAAM7D,KAAK,WACZkB,UAAnB0C,EACFE,OAAOC,SAASC,KAAOJ,GAGvBA,EAAiB7D,EAAE8D,MAAM7D,KAAK,gBACRkB,SAAnB0C,IACFE,OAAOC,SAASC,KAAOJ,MAO1B7D,EAAEG,UAAUW,GAAG,mBAAoB,qBAAsB,SAASQ,GACjEtB,EAAE8D,MAAM1D,KAAK,kBAAkB8D,YAAY,wBAAwBC,SAAS,4BAI7EnE,EAAEG,UAAUW,GAAG,mBAAoB,qBAAsB,SAASQ,GACjEA,EAAEsC,iBACF,IAAIC,GAAiB7D,EAAE8D,MAAM7D,KAAK,YAC9BmE,EAAgBN,IACpB9D,GAAE8D,MAAM1D,KAAK,kBAAkB8D,YAAY,0BAA0BC,SAAS,wBAE3EnE,EAAEoE,GAAeC,QAAQ,0BAA0BhE,OAAS,EAC9DiE,eAAiBtE,EAAEoE,GAAeC,QAAQ,0BAA0BE,GAAG,GAAGtE,KAAK,YAG/EqE,eAAiBtE,EAAE8D,MAAMU,QAAQ,iBAAiBvE,KAAK,YAGxDD,EAAEyE,IAAIhC,SAAS,+BAA+B6B,eAAiB,IAAMT,EAAgB,SAAS5D,GAC7FD,EAAEoE,GAAehE,KAAK,yBAAyBuB,KAAK1B,GACpDyE,aAAe1E,EAAEoE,GAAehE,KAAK,yBAAyBA,KAAK,SACnEuE,aAAaC,SAASF,cACtBC,aAAaE,aAIf7E,EAAE,qBAAqBc,GAAG,mBAAoB,SAAUQ,GACvDtB,EAAE8D,MAAM1D,KAAK,kBAAkB8D,YAAY,wBAAwBC,SAAS,4BAG7EnE,EAAE,qBAAqBc,GAAG,mBAAoB,SAAUQ,GACvDtB,EAAE8D,MAAM1D,KAAK,kBAAkB8D,YAAY,0BAA0BC,SAAS,uBAC9E,IAAIW,IAAkBC,WAAcC,SAGpChF,GAAEiF,KAAMxC,SAAW,yBAA0ByC,gBAAkB,EAAMC,eAAiB,EAAMC,YAAYC,KAAKC,UAAUR,IAAiB,SAAU7E,GACjJ,IACCsF,WAAavF,EAAEwF,UAAUvF,GAE1B,MAAMqB,GAEL,WADAmE,OAAMnE,EAAI,IAAMrB,GAIjB,GAAGsF,WAAW7B,WAAY,EAAM,CAE/B1D,EAAE,kBAAkB0F,OACpB,IAAIC,GAAW3F,EAAE,oBAAoB2B,OACjCiE,EAAWC,WAAWC,QAAQH,GAC9BI,GAAe,EACfC,EAAc,CAClBhG,GAAEkD,KAAKqC,WAAWU,QAAS,SAAS9C,EAAO+C,GAC1C,GAAGA,EAAMlB,UAAYA,SAAU,CAC9BkB,EAAMC,SAAW1D,QACjB,IAAId,GAAUiE,EAASM,EACvBlG,GAAE,kBAAkBiB,OAAOU,GAC3BoE,GAAe,EACfC,OAIED,GACH/F,EAAE,kBAAkBiB,OAAO,sCAM/B,IAAImF,GAAWpG,EAAEqG,OAAO,aAexB,IAdArG,EAAEsG,aAAa,cAAiBC,KAAM,MAGtCvG,EAAE,QAAQc,GAAG,QAAS,SAAUQ,GAC/BtB,EAAE,2BAA2BkD,KAAK,WAG5BlD,EAAE8D,MAAM0C,GAAGlF,EAAEsB,SAA4C,IAAjC5C,EAAE8D,MAAM2C,IAAInF,EAAEsB,QAAQvC,QAAuD,IAAvCL,EAAE,YAAYyG,IAAInF,EAAEsB,QAAQvC,QAC9FL,EAAE8D,MAAM4C,QAAQ,YAMhB3C,OAAOC,SAASC,KAAM,CACxBJ,eAAiBE,OAAOC,SAASC,KAAK0C,QAAQ,IAAI,GAClD,IAAIzG,GAAcF,EAAEG,UAAUC,KAAK,uBAAyByD,eAAiB,KAC1E3D,GAAYG,OAAO,IAIrBH,EAAcF,EAAEG,UAAUC,KAAK,mBAAqByD,eAAiB,MAAMzD,KAAK,cAG9EF,EAAYG,OAAO,EACrBL,EAAEE,GAAaK,QAAQ,SAIvBT,2BAIMsG,IAAYpG,EAAE,gBAAgBI,KAAK,aAAaC,OAAO,EAE9DL,EAAEiF,KAAKxC,SAAW,uBAAwB2D,SAAUA,EAAUpB,SAAUA,UAAW,SAAS/E,EAAM8C,EAAY6D,GAC7G,GAAI9D,GAAO9C,EAAEwF,UAAUvF,GAEnBC,EAAc,KACd2G,GAAqB,CACzB7G,GAAEkD,KAAKJ,EAAM,SAASK,EAAO2D,GAC5B,GAAGA,GAAW9G,EAAE,cAAcC,KAAK,cAClCC,EAAcF,EAAEG,UAAUC,KAAK,uBAAyB0G,EAAU,MAC/D5G,EAAYG,OAAO,IAIrBH,EAAcF,EAAEG,UAAUC,KAAK,mBAAqB0G,EAAU,MAAM1G,KAAK,cAEvEF,EAAYG,OAAO,GAGrB,MAFAL,GAAEE,GAAaK,QAAQ,SACvBsG,GAAqB,GACd,IAKNA,GAEH/G,yBAMFA,yBAKFE,EAAEG,UAAUW,GAAG,YAAa,sBAAuB,WAClD,GAAIiG,GAAQ/G,EAAE8D,MAAM1D,KAAK,8BACzBJ,GAAE+G,GAAO9G,KAAK,SAAUD,EAAE+G,GAAOvE,KAAK,OACtC,IAAIvC,GAAOD,EAAE+G,GAAO9G,KAAK,QACzBD,GAAE+G,GAAOvE,KAAK,MAAOvC,KAKtBD,EAAEG,UAAUW,GAAG,WAAY,sBAAuB,WACjD,GAAIiG,GAAQ/G,EAAE8D,MAAM1D,KAAK,+BACrBH,EAAOD,EAAE+G,GAAO9G,KAAK,SACzBD,GAAE+G,GAAOvE,KAAK,MAAOvC,KAKtB+G,UAAUC,KAAK,OAAQ,WACtBjH,EAAE,0BAA0BwE,QAAQ,aAAa0C,OAAO9G,KAAK,OAAOG,QAAQ,WAG7EyG,UAAUC,KAAK,QAAS,WACvBjH,EAAE,0BAA0BwE,QAAQ,aAAa2C,OAAO/G,KAAK,OAAOG,QAAQ,WAG7EP,EAAEG,UAAUW,GAAG,QAAS,gBAAiB,WACxCd,EAAE8D,MAAMsD,WAGTpH,EAAEG,UAAUW,GAAG,QAAS,eAAgB,WACvCd,EAAE8D,MAAMuD,SAASA,SAASC,SAAS,iBAAiBC,OAAO,UAI5DvH,EAAEG,UAAUW,GAAG,QAAS,YAAa,SAASQ,GACrBH,SAApBG,EAAEkG,eACLlG,EAAEoB,iBAEH+E,aAAezH,EAAE8D,MAAM7D,KAAK,eAE5B,IAAIoH,GAASrH,EAAE8D,MAAMU,QAAQ,mBAEzBkD,GAAqB,CAEtBL,GAAOhH,OAAO,KAAOgH,EAAOM,SAAS,iBAAoBN,EAAOM,SAAS,iBAAmBN,EAAOM,SAAS,sBAI9GC,aAAeP,EAAOpH,KAAK,YAC3ByH,GAAqB,GAGrBE,aAAe5H,EAAE8D,MAAMU,QAAQ,iBAAiBvE,KAAK,YAMtDD,EAAEyE,IAAIhC,SAAS,kBAAkBgF,aAAe,IAAMzC,SAAU,SAAS/E,GAKxE,GAJAD,EAAE,cAAc2B,KAAK1B,GACrBD,EAAE,cAAcC,KAAK,WAAYwH,cAEjCzH,EAAEG,UAAUC,KAAK,0BAA0B8D,YAAY,yBACpDlE,EAAE,gBAAgBI,KAAK,uBAAuBC,OAAS,EAAG,CAC5D,GAAIwH,GAAkB7H,EAAEG,UAAUC,KAAK,uBAAyBqH,aAAe,MAAMJ,QACrFQ,GAAgB3E,KAAK,SAASC,EAAOC,GACjCpD,EAAEoD,GAAIoD,GAAG,QACXxG,EAAEoD,GAAIe,SAAS,2BAKlB,GAAI2D,GAAI9H,EAAE+D,QAAQgE,YACdC,EAAIhI,EAAE,cAAciI,SAASC,IAAM,GACpCJ,GAAEE,GACJhI,EAAE,cAAcmI,SAAUJ,UAAW,GAAK,QAG3CrD,aAAe1E,EAAE,cAAcI,KAAK,SACpCuE,aAAaC,SAASF,cACtBC,aAAaE,SAEV6C,GACF1H,EAAEyE,IAAIhC,SAAS,+BAA+BuC,SAAW,IAAM4C,aAAc,SAAS3H,GACrFD,EAAE,cAAciB,OAAOhB,GACvByE,aAAe1E,EAAE,cAAcI,KAAK,SACpCuE,aAAaC,SAASF,cACtBC,aAAaE,WAGfF,aAAaE,SAEgB,kBAAlBuD,iBACVA","file":"assetView.min.js","sourcesContent":["\n// disable cache-busted of embedded JS by jquery\n$.ajaxPrefilter(function( options, originalOptions, jqXHR ) {\n  if ( options.dataType == 'script' || originalOptions.dataType == 'script' ) {\n      options.cache = true;\n  }\n});\n\n\n\n$(document).on(\"ready\", function() {\n\n\t// if we don't support fullscreen, hide hte button entirely\n\tif(!$.fullscreen.isNativelySupported()) {\n\t\t$(\"head\").append('<style> .canFullscreen { display: none;</style>');\n\t}\n\n\tslicePoint = 400;\n\tif(slicePointDefault !== undefined) {\n\t\tslicePoint = slicePointDefault;\n\t}\n\t$(\".textareaView li div\").expander({\n\t\tslicePoint: slicePoint\n\t});\n\n\t// show nearby assets\n\t$(\"#mapModal\").on(\"shown.bs.modal\",  function(e) {\n\t\tvar latitude = $(e.relatedTarget).data(\"latitude\");\n\t\tvar longitude = $(e.relatedTarget).data(\"longitude\");\n\t\tvar label = $(e.relatedTarget).html();\n\n\t\t$(\"#mapModalLabel\").html(label);\n\t\t$(\"#mapModalContainer\").goMap({\n\t\t\tmapTypeControl:true,\n\t\t\tmaptype: 'ROADMAP',\n\t\t\tmapTypeControlOptions: {\n\t\t\t\tposition: 'TOP_RIGHT',\n\t\t\t\tstyle: 'DROPDOWN_MENU'\n\t\t\t}\n\t\t});\n\n\t\tif($.goMap.getMarkerCount()>0) {\n\t\t\t$.goMap.clearMarkers();\n\t\t}\n\t\t$.goMap.setMap({\n\t\t\tlatitude: latitude,\n\t\t\tlongitude: longitude\n\t\t});\n\n\t\t$(\"#mapModalContainer\").goMap();\n\t\tvar marker = $.goMap.createMarker({\n\t\t\tlatitude: latitude,\n\t\t\tlongitude: longitude,\n\t\t\tdraggable: false\n\t\t});\n\t\t$.goMap.fitBounds();\n\n\t\t$(\"#mapNearby\").attr(\"href\", basePath + \"search/nearbyAssets/\" + latitude + \"/\" + longitude);\n\n\t\treturn false;\n\t});\n\n\n\t// show Exif data for images\n\t$(document).on(\"click\", \".exifToggle\", function(e) {\n\t\te.preventDefault();\n\t\tvar fileObject = $(e.target).data(\"fileobject\");\n\n\t\t$.getJSON(basePath + 'fileManager/getMetadataForObject/' + fileObject, {}, function(json, textStatus) {\n\t\t\tif(json.exif) {\n\t\t\t\tvar baseUL = $(\"<ul />\");\n\t\t\t\t$.each(json.exif, function(index, el) {\n\t\t\t\t\tbaseUL.append(\"<li>\" + index + \" : \" + el + \"</li>\");\n\t\t\t\t});\n\t\t\t\tbootbox.dialog(\n\t\t\t\t{\n\t\t\t\t\ttitle: \"EXIF Data\",\n\t\t\t\t\tmessage: baseUL.html(),\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\n\t$(document).on(\"click\", \".relatedThumbContainer\", function(e) {\n\t\te.stopPropagation();\n\t\tvar nestedObjectId = $(this).data(\"objectid\");\n\t\tif(nestedObjectId !== undefined) {\n\t\t\twindow.location.hash = nestedObjectId;\n\t\t}\n\t\telse {\n\t\t\tnestedObjectId = $(this).data(\"fileobjectid\");\n\t\t\tif(nestedObjectId !== undefined) {\n\t\t\t\twindow.location.hash = nestedObjectId;\n\t\t\t}\n\t\t}\n\n\t});\n\n\t// flip chevrons\n\t$(document).on(\"hide.bs.collapse\", \".relatedListToggle\", function(e) {\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');\n\t});\n\n\n\t$(document).on(\"show.bs.collapse\", \".relatedListToggle\", function(e) {\n\t\te.stopPropagation();\n\t\tvar nestedObjectId = $(this).data(\"objectid\");\n\t\tvar targetElement = this;\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');\n\n\t\tif($(targetElement).parents(\".relatedAssetContainer\").length > 0) {\n\t\t\tparentObjectId = $(targetElement).parents(\".relatedAssetContainer\").eq(0).data(\"objectid\");\n\t\t}\n\t\telse {\n\t\t\tparentObjectId = $(this).closest(\".objectIdHost\").data(\"objectid\");\n\t\t}\n\n\t\t$.get(basePath+\"asset/viewAssetMetadataOnly/\"+parentObjectId + \"/\" + nestedObjectId, function(data) {\n\t\t\t$(targetElement).find('.relatedAssetContents').html(data);\n\t\t\tlazyElements = $(targetElement).find('.relatedAssetContents').find(\".lazy\");\n\t\t\tlazyInstance.addItems(lazyElements);\n\t\t\tlazyInstance.update();\n\t\t});\n\t});\n\n\t$('#relatedAccordian').on('hide.bs.collapse', function (e) {\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');\n\t});\n\n\t$('#relatedAccordian').on('show.bs.collapse', function (e) {\n\t\t$(this).find(\".expandRelated\").removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');\n\t\tvar searchRequest = { \"searchText\": objectId};\n\n\t\t// get related results via search\n\t\t$.post( basePath + \"search/searchResults/\", {\"suppressRecent\": true, \"searchRelated\": true, searchQuery:JSON.stringify(searchRequest)}, function( data ) {\n\t\t\ttry{\n\t\t\t\tjsonObject = $.parseJSON(data);\n\t\t\t}\n\t\t\tcatch(e){\n\t\t\t\talert(e + \" \" + data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(jsonObject.success === true) {\n\n\t\t\t\t$(\"#relatedAssets\").empty();\n\t\t\t\tvar source   = $(\"#result-template\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\t\t\t\tvar foundRelated = false;\n\t\t\t\tvar resultCount = 0;\n\t\t\t\t$.each(jsonObject.matches, function(index, value) {\n\t\t\t\t\tif(value.objectId != objectId) {\n\t\t\t\t\t\tvalue.base_url = basePath;\n\t\t\t\t\t\tvar html    = template(value);\n\t\t\t\t\t\t$(\"#relatedAssets\").append(html);\n\t\t\t\t\t\tfoundRelated = true;\n\t\t\t\t\t\tresultCount++;\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t\tif(!foundRelated) {\n\t\t\t\t\t$(\"#relatedAssets\").append(\"<p>No Related Assets Found</p>\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\tvar searchId = $.cookie(\"lastSearch\");\n\t$.removeCookie(\"lastSearch\",  { path: '/' });\n\n\t// hide popovers when you click elsehwere on the page\n\t$('body').on('click', function (e) {\n\t\t$('[data-toggle=\"popover\"]').each(function () {\n\t\t\t//the 'is' for buttons that trigger popups\n\t\t\t//the 'has' for icons within a button that triggers a popup\n\t\t\tif (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {\n\t\t\t\t$(this).popover('hide');\n\t\t\t}\n\t\t});\n\t});\n\n\t// if they came in with a hash, let's find and load that asset.\n\tif(window.location.hash) {\n\t\tnestedObjectId = window.location.hash.replace(\"#\",\"\");\n\t\tvar targetAsset = $(document).find('[data-fileobjectid=\"' + nestedObjectId + '\"]');\n\t\tif(targetAsset.length>0) {\n\n\t\t}\n\t\telse { // maybe it's a related asset, try that\n\t\t\ttargetAsset = $(document).find('[data-objectid=\"' + nestedObjectId + '\"]').find(\".loadView\");\n\t\t}\n\n\t\tif(targetAsset.length>0) {\n\t\t\t$(targetAsset).trigger(\"click\");\n\t\t}\n\t\telse {\n\t\t\t// load a default element\n\t\t\tloadEmbedViewPointer();\n\t\t}\n\n\t}\n\telse if(searchId && $(\".rightColumn\").find(\".loadView\").length>1) {\n\t\t// we have multiple subviews, let's ask the search engine if there's one we should highlight\n\t\t$.post(basePath + \"search/getHighlight\", {searchId: searchId, objectId: objectId}, function(data, textStatus, xhr) {\n\t\t\tvar json = $.parseJSON(data);\n\n\t\t\tvar targetAsset = null;\n\t\t\tvar haveSelectedTarget = false;\n\t\t\t$.each(json, function(index, element) {\n\t\t\t\tif(element != $(\"#embedView\").data(\"objectid\")) {\n\t\t\t\t\ttargetAsset = $(document).find('[data-fileobjectid=\"' + element + '\"]');\n\t\t\t\t\tif(targetAsset.length>0) {\n\n\t\t\t\t\t}\n\t\t\t\t\telse { // maybe it's a related asset, try that\n\t\t\t\t\t\ttargetAsset = $(document).find('[data-objectid=\"' + element + '\"]').find(\".loadView\");\n\t\t\t\t\t}\n\t\t\t\t\tif(targetAsset.length>0) {\n\t\t\t\t\t\t$(targetAsset).trigger(\"click\");\n\t\t\t\t\t\thaveSelectedTarget = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t});\n\t\t\tif(!haveSelectedTarget) {\n\t\t\t\t// just load a default\n\t\t\t\tloadEmbedViewPointer();\n\t\t\t}\n\n\t\t});\n\t}\n\telse {\n\t\tloadEmbedViewPointer();\n\t}\n});\n\n// use the 2x image for mouseovers\n$(document).on(\"mouseover\", \".relatedThumbToggle\", function() {\n\tvar image = $(this).find(\".relatedThumbContainerImage\");\n\t$(image).data(\"oldURL\", $(image).attr(\"src\"));\n\tvar data = $(image).data(\"hover\");\n\t$(image).attr(\"src\", data);\n\n});\n\n// hide the 2x image\n$(document).on(\"mouseout\", \".relatedThumbToggle\", function() {\n\tvar image = $(this).find(\".relatedThumbContainerImage\");\n\tvar data = $(image).data(\"oldURL\");\n\t$(image).attr(\"src\", data);\n\n});\n\n\nMousetrap.bind('left', function() {\n\t$(\".relatedThumbHighlight\").closest(\".col-sm-2\").prev().find(\"img\").trigger(\"click\");\n});\n\nMousetrap.bind('right', function() {\n\t$(\".relatedThumbHighlight\").closest(\".col-sm-2\").next().find(\"img\").trigger(\"click\");\n});\n\n$(document).on(\"click\", \".embedControl\", function() {\n\t$(this).select();\n});\n\n$(document).on(\"click\", \".showDetails\", function() {\n\t$(this).parent().parent().children('.assetDetails').toggle(\"fast\");\n});\n\n// main handler for loading assets\n$(document).on(\"click\", \".loadView\", function(e) {\n\tif (e.originalEvent === undefined) {\n\t\te.preventDefault();\n\t}\n\tfileObjectId = $(this).data(\"fileobjectid\");\n\n\tvar parent = $(this).closest(\"[data-objectid]\");\n\n\tvar needLoadNestedView = false;\n\n\tif(parent.length>0 && (!parent.hasClass('objectIdHost') || (parent.hasClass('objectIdHost') && parent.hasClass('sidebarContainer')))) {\n\t\t// we're within a nested asset, rather than a straight thumbnail, let's also load the content for that.\n\t\t// if we've been loaded in the left column, as a nested view, we want to make sure we load both the view and reload the metadata, which is why\n\t\t// we check for the sdiebar container\n\t\tparentObject = parent.data(\"objectid\");\n\t\tneedLoadNestedView = true;\n\t}\n\telse {\n\t\tparentObject = $(this).closest(\".objectIdHost\").data(\"objectid\");\n\t}\n\n\t// we pass in the page's objectId so that assets inside drawers load properly.\n\n\n\t$.get(basePath+\"asset/getEmbed/\"+fileObjectId + \"/\" + objectId, function(data){\n\t\t$(\"#embedView\").html(data);\n\t\t$(\"#embedView\").data(\"objectid\", fileObjectId);\n\n\t\t$(document).find(\".relatedThumbHighlight\").removeClass(\"relatedThumbHighlight\");\n\t\tif($(\".rightColumn\").find('[data-fileobjectid]').length > 1) {\n\t\t\tvar parentContainer = $(document).find('[data-fileobjectid=\"' + fileObjectId + '\"]').parent();\n\t\t\tparentContainer.each(function(index, el) {\n\t\t\t\tif($(el).is('div')) {\n\t\t\t\t\t$(el).addClass(\"relatedThumbHighlight\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvar y = $(window).scrollTop();\n\t\tvar z = $('#embedView').offset().top + 400;\n\t\tif(y>z) {\n\t\t\t$(\"html, body\").animate({ scrollTop: 0 }, \"fast\");\n\t\t}\n\n\t\tlazyElements = $(\"#embedView\").find(\".lazy\");\n\t\tlazyInstance.addItems(lazyElements);\n\t\tlazyInstance.update();\n\n\t\tif(needLoadNestedView) {\n\t\t\t$.get(basePath+\"asset/viewAssetMetadataOnly/\"+objectId + \"/\" + parentObject, function(data) {\n\t\t\t\t$(\"#embedView\").append(data);\n\t\t\t\tlazyElements = $(\"#embedView\").find(\".lazy\");\n\t\t\t\tlazyInstance.addItems(lazyElements);\n\t\t\t\tlazyInstance.update();\n\t\t\t});\n\t\t}\n\t\tlazyInstance.update();\n\n\t\tif (typeof loadedCallback == 'function') {\n\t\t\tloadedCallback();\n\t\t}\n\t});\n});\n\nfunction loadEmbedViewPointer() {\n\n\ttargetObjectId = $(\"#embedView\").data(\"objectid\");\n\t\tvar targetAsset = $(document).find('[data-fileobjectid=\"' + targetObjectId + '\"]');\n\t\tif(targetAsset.length>0) {\n\n\t\t}\n\t\telse { // maybe it's a related asset, try that\n\t\t\ttargetAsset = $(document).find('[data-objectid=\"' + targetObjectId + '\"]').find(\".loadView\");\n\t\t}\n\n\t\tif(targetAsset.length > 1) {\n\t\t\ttargetAsset = targetAsset.first();\n\t\t}\n\n\t\t$(targetAsset).trigger(\"click\");\n}"]}