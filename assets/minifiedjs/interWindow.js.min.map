{"version":3,"sources":["interWindow.js"],"names":["notifyParentOfSave","objectId","statusNotice","status","targetFieldId","window","opener","postMessage","JSON","stringify","listener","event","data","String","messageObject","parse","hasParent","targetField","$","val","unsavedChildren","submitForm","document","on","preventDefault","targetTemplate","this","closest","find","first","targetCollection","attr","windowPointer","open","basePath","onload","targetInfo","unload","addEventListener","console","log","attachEvent"],"mappings":"AAmBA,QAASA,oBAAmBC,GAC3B,GAAIC,IAAiBD,SAAYA,EAAUE,OAAS,QAASC,cAAiBA,cAC9EC,QAAOC,OAAOC,YAAYC,KAAKC,UAAUP,GAAe,KAYzD,QAASQ,UAASC,GACjB,GAA2B,gBAAfA,GAAMC,MAAqBD,EAAMC,eAAgBC,QAA7D,CAGA,GAAIC,GAAgBN,KAAKO,MAAMJ,EAAMC,KAClCD,GAAMC,OAEmB,QAAxBE,EAAcX,SAChBa,WAAY,EACZZ,cAAgBU,EAAcG,aAGJ,SAAxBH,EAAcX,SAEbe,EAAE,IAAIJ,EAAcV,eAAee,OAASL,EAAcb,UAC5DmB,kBAEDF,EAAE,IAAIJ,EAAcV,eAAee,IAAIL,EAAcb,UACrDoB,cAE0B,UAAxBP,EAAcX,QACgC,KAA7Ce,EAAE,IAAIJ,EAAcV,eAAee,OACrCC,oBAtDJ,GAAIhB,eAAgB,GAChBY,WAAY,EACZI,gBAAkB,CAEtBF,GAAEI,UAAUC,GAAG,QAAS,kBAAmB,SAASZ,GACnDA,EAAMa,gBACN,IAAIC,GAAiBP,EAAEQ,MAAMC,QAAQ,mBAAmBC,KAAK,qBAAqBC,QAAQV,MACtFW,EAAmBZ,EAAE,iBAAiBC,MACtCF,EAAcC,EAAEQ,MAAMC,QAAQ,mBAAmBC,KAAK,gBAAgBC,QAAQE,KAAK,KACvFX,kBACA,IAAIY,GAAgB3B,OAAO4B,KAAKC,SAAU,yBAAyBT,EAAiB,IAAMK,EAC1FE,GAAcG,OAAS,WACtB,GAAIC,IAAejC,OAAS,OAAQc,YAAeA,EACnDe,GAAczB,YAAYC,KAAKC,UAAU2B,GAAa,QAUxDlB,EAAGb,QAASgC,OAAO,WAClB,GAAGrB,UAAW,CACb,GAAId,IAAiBD,SAAY,KAAME,OAAS,SAAUC,cAAiBA,cAC3EC,QAAOC,OAAOC,YAAYC,KAAKC,UAAUP,GAAe,QAqCtDG,OAAOiC,kBAERA,iBAAiB,UAAW5B,UAAU,GACtC6B,QAAQC,IAAI,mBAGbC,YAAY,YAAa/B","file":"interWindow.js","sourcesContent":["\nvar targetFieldId = \"\";\nvar hasParent = false;\nvar unsavedChildren = 0;\n\n$(document).on(\"click\", \".newAssetButton\", function(event) {\n\tevent.preventDefault();\n\tvar targetTemplate = $(this).closest(\".widgetContents\").find(\".templateSelector\").first().val();\n\tvar targetCollection = $(\"#collectionId\").val();\n\tvar targetField = $(this).closest(\".widgetContents\").find(\".targetAsset\").first().attr('id');\n\tunsavedChildren++;\n\tvar windowPointer = window.open(basePath +\"assetManager/addAsset/\"+targetTemplate + \"/\" + targetCollection);\n\twindowPointer.onload = function( ){\n\t\tvar targetInfo = { 'status':'open', 'targetField': targetField };\n\t\twindowPointer.postMessage(JSON.stringify(targetInfo), \"*\");\n\t};\n\n});\n\nfunction notifyParentOfSave(objectId) {\n\tvar statusNotice = { 'objectId': objectId, 'status':'saved', 'targetFieldId': targetFieldId};\n\twindow.opener.postMessage(JSON.stringify(statusNotice), \"*\");\n}\n\n$( window ).unload(function() {\n\tif(hasParent) {\n\t\tvar statusNotice = { 'objectId': null, 'status':'closed', 'targetFieldId': targetFieldId};\n\t\twindow.opener.postMessage(JSON.stringify(statusNotice), \"*\");\n\t}\n\n});\n\n\nfunction listener(event) {\n\tif(!(typeof event.data === 'string' || event.data instanceof String)) {\n\t\treturn;\n\t}\n\tvar messageObject = JSON.parse(event.data);\n\tif(event.data ) {\n\n\t\tif(messageObject.status == 'open') {\n\t\t\thasParent = true;\n\t\t\ttargetFieldId = messageObject.targetField;\n\t\t}\n\t\t// TODO, update the UI with this info\n\t\tif(messageObject.status == 'saved') {\n\t\t\t// First Save, don't need to count this one anymore\n\t\t\tif($(\"#\"+messageObject.targetFieldId).val() != messageObject.objectId) {\n\t\t\t\tunsavedChildren--;\n\t\t\t}\n\t\t\t$(\"#\"+messageObject.targetFieldId).val(messageObject.objectId);\n\t\t\tsubmitForm();\n\t\t}\n\t\tif(messageObject.status == 'closed') {\n\t\t\tif($(\"#\"+messageObject.targetFieldId).val() === \"\") {\n\t\t\t\tunsavedChildren--;\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nif (window.addEventListener){\n\n  \taddEventListener(\"message\", listener, false);\n  \tconsole.log(\"listener added\");\n\n} else {\n  attachEvent(\"onmessage\", listener);\n}\n"],"sourceRoot":"/source/"}