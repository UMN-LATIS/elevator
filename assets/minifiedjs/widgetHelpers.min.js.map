{"version":3,"sources":["widgetHelpers.js"],"names":["markSaveDirty","$","removeClass","addClass","markSaveClean","Handlebars","registerHelper","val","delimiter","start","end","arry","concat","undefined","length","slice","join","options","Math","random","window","bind","uploadCount","showHaveEntries","each","index","el","targetId","attr","show","requiredContent","mainWidgets","find","mainWidgetElement","is","text","prop","children","hide","document","ready","on","e","addAnother","target","needed","parentGroup","parents","widgetTitle","replace","widgetId","first","offsetCount","self","returnInfo","get","basePath","data","append","buildAutocomplete","buildSortable","removeAttr","height","this","sortable","event","ui","item","css","tinymce","execCommand","stop","updateNames","revert","cancel","testUnsetIframes","fail","indexOf","bootbox","dialog","message","title","backdrop","closeButton","$list","idx","name","source","html","compile","value","autocomplete","request","response","fieldTitle","closest","searchTerm","term","post","templateId","jsonObject","parseJSON","alert","messages","noResults","results","buildAssetAutocomplete","loadFrameForNestedElement","collectionId","assetId","targetURL","targetElement","element","class","frameborder","width","src","appendTo","targetField","load","iframeLoaded","targetInfo","status","contentWindow","postMessage","JSON","stringify","iFrame","contents","trigger","current","prevAll","before","nextAll","after","parseInt","parsley","validators","dateobject","validate","parseDateString","priority","targetCollection","sourceCollection","resetCollection","keypress","keyCode","datepicker","loadPreviewAndUpdateTitle","relatedAssetId","relatedAssetPreview","sourceReference","targetTemplate","sourceTemplate","jQuery","getJSON","json","textStatus","template","confirm","result","migration","targetItem","open","remove"],"mappings":"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","file":"widgetHelpers.min.js","sourcesContent":["\n/**\n * register various helpers\n */\n\nvar markSaveDirty = function() {\n\t$(\".saveButton\").removeClass(\"btn-primary\").addClass(\"btn-warning\");\n\t$(\"#entryForm\").removeClass(\"clean\").addClass(\"dirty\");\n};\n\nvar markSaveClean = function() {\n\t$(\".saveButton\").removeClass(\"btn-warning\").addClass(\"btn-primary\");\n\t$(\"#entryForm\").removeClass(\"dirty\").addClass(\"clean\");\n};\n\nHandlebars.registerHelper('join', function(val, delimiter, start, end) {\n\tvar arry = [].concat(val);\n\tdelimiter = ( typeof delimiter == \"string\" ? delimiter : ', ' );\n\tstart = start || 0;\n\tend = ( end === undefined ? arry.length : end );\n\treturn arry.slice(start, end).join(delimiter);\n});\n\n\nHandlebars.registerHelper('random', function(options) {\n\treturn Math.random();\n});\n\n$(window).bind('beforeunload', function(){\n\tif(uploadCount > 0) {\n\t\treturn \"You have uploads in progress. Are you sure you wish to leave the page and cancel these uploads?\";\n\t}\n});\n\n/**\n * Add checkmarks to sidebar if there's content in their\n */\nvar showHaveEntries = function() {\n\n\t$(\".tab-pane\").each(function(index, el) {\n\t\tvar targetId = $(el).attr(\"id\");\n\t\tvar show = false;\n\t\tvar requiredContent = false;\n\t\tvar mainWidgets = $(el).find(\".mainWidgetEntry\");\n\t\t$(mainWidgets).each(function(index, mainWidgetElement) {\n\t\t\tif($(mainWidgetElement).is(\"input\") || $(mainWidgetElement).is(\"textarea\")) {\n\t\t\t\tif($(mainWidgetElement).val().length> 0) {\n\t\t\t\t\tshow = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if($(mainWidgetElement).is(\"select\")) {\n\t\t\t\tif($(mainWidgetElement).find(\":selected\").text() !== \"\") {\n\t\t\t\t\tshow = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tshow = true;\n\t\t\t}\n\n\t\t\tif($(mainWidgetElement).prop('required')) {\n\t\t\t\trequiredContent = true;\n\n\t\t\t}\n\n\t\t});\n\n\t\tvar targetHref;\n\t\tif(show) {\n\t\t\ttargetHref = $('a[href=\"#' + targetId+ '\"]').children('.haveContent').show();\n\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').hide();\n\t\t}\n\t\telse {\n\t\t\ttargetHref = $('a[href=\"#' + targetId+ '\"]').children('.haveContent').hide();\n\t\t\tif(requiredContent) {\n\t\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').show();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').hide();\n\t\t\t}\n\t\t}\n\n\n\t});\n\n};\n\n$(document).ready(function() {\n\t$(document).on(\"change\", \".mainWidgetEntry\", function(e) {\n\t\tshowHaveEntries();\n\t\tmarkSaveDirty();\n\t});\n\n});\n\n\nvar addAnother = function(target, needed) {\n\tif(!needed) {\n\t\tneeded = 1;\n\t}\n\t$(target).attr(\"disabled\",true);\n\tvar parentGroup = $(target).parents(\".tab-pane\").find(\".control-group\");\n\tvar widgetTitle = $(parentGroup).attr('id').replace(\"controlGroup_\", '');\n\tvar widgetId = $(parentGroup).children(\".widget_id\").first().val();\n\tvar offsetCount = $(parentGroup).children(\"div\").length-1;\n\n\tvar self = target;\n\tvar returnInfo = null;\n\t$.get(basePath+\"assetManager/getWidget/\"+widgetId+\"/\"+offsetCount + \"/\" + needed, function(data){\n\n\t\twindow.offsetCount[widgetTitle] += needed;\n\t\treturnInfo = $(data);\n\n\t\t$(parentGroup).append(returnInfo);\n\n\t\t$(parentGroup).find('.isPrimary').show();\n\t\t$(parentGroup).find('.moveDownButton').show();\n\t\t$(parentGroup).find('.moveUpButton').show();\n\t\tbuildAutocomplete();\n\t\tbuildSortable();\n\t\t$(self).removeAttr(\"disabled\");\n\n\t\tif(parentGroup.height() > $(\".mainRow\").height()) {\n\t\t\t$(\".mainRow\").height(parentGroup.height() + 50);\n\t\t\t$(\".leftPane\").height($(\".mainRow\").height());\n\t\t}\n\n\t});\n\treturn returnInfo; // only returns if this is sync\n};\n\n\n/**\n * Add an additional element\n */\n$(document).on(\"click\", \".addAnother\",function(e) { addAnother(this); });\n\n\n// we disable tincyMCE while dragging, otherwise it fails after the drag.\n// \nvar buildSortable = function() {\n\t$( \".sortableBlock\" ).sortable({\n\t\t//handle: \".handle\"\n\t\tstart: function(event, ui) {\n\t\t\t$(ui.item).css(\"max-height\", \"600px\");\n\t\t\t$(ui.item).css(\"overflow\", \"hidden\");\n\t\t\t$(ui.item).find('.textAreaWidget').each(function () {\n     \t\t\ttinymce.execCommand('mceRemoveEditor', false, $(this).attr('id'));\n  \t\t\t});\n\t\t},\n\t\tstop: function(event, ui) {\n\t\t\t$(ui.item).css(\"max-height\", \"\");\n\t\t\t$(ui.item).css(\"overflow\", \"\");\n\t\t\t$(ui.item).find('.textAreaWidget').each(function () {\n     \t\t\ttinymce.execCommand('mceAddEditor', true, $(this).attr('id'));\n  \t\t\t});\n\t\t\tupdateNames($(this));\n\t\t},\n\t\trevert: true,\n\t\tcancel: \".nestedAsset, .tooltipRow, .sortableBlock p, .sortableBlock label, .mainWidgetEntry, .sortableBlock select, .sortableBlock input, .maphost, .mce-container, .sortableBlock textarea\"\n    });\n}\n\nfunction testUnsetIframes() {\n\tvar fail = false;\n\t$(\".nestedAsset\").find(\"iframe\").each(function() {\n\t\tif($(this).attr(\"src\").indexOf(\"editAsset\") === -1) {\n\t\t\tfail = true;\n\t\t}\n\t\t\n\n\t});\n\tif(fail) {\n\t\tbootbox.dialog({\n\t\t\t\tmessage: \"Please save this page and reload before moving nested assets\",\n\t\t\t\ttitle: \"Reload Rquired\",\n\t\t\t\tbackdrop: true,\n\t\t\t\tcloseButton: true\n\t\t\t});\n\t\treturn false;\n\t}\n\treturn true;\n}\n\n$(document).on(\"click\", \".moveUp\", function() {\n\tif(testUnsetIframes()) {\n\t\tvar current = $(this).closest(\".widgetContentsContainer\");\n\t\tcurrent.prevAll(\".widgetContentsContainer:first\").before(current);\n\t}\n\t\t\n\n});\n\n$(document).on(\"click\", \".moveDown\", function() {\n\tif(testUnsetIframes()) {\n\t\tvar current = $(this).closest(\".widgetContentsContainer\");\n\t\tcurrent.nextAll(\".widgetContentsContainer:first\").after(current);\t\n\t}\n\t\n\n});\n\nfunction updateNames($list) {\n    $list.find('.panel').each(function (idx) {\n        var $inp = $(this).find('input, select, textarea');\n        $inp.each(function () {\n            this.name = this.name.replace(/(\\[\\d+\\])/, '[' + idx + ']');            \n        });\n\n\t\t$(this).find(\".isPrimary input\").val(idx);\n    });\n}\n\n\n$(document).on(\"change\", \".templateSelector\", function(e) {\n\tif(parseInt($(this).val()) === 0) {\n\t\t$(this).closest(\".widgetContents\").find('.newAssetButton').attr('disabled', \"disabled\");\n\t}\n\telse {\n\t\t$(this).closest(\".widgetContents\").find('.newAssetButton').attr('disabled', false);\n\t}\n\n});\n\n\n$(document).ready(function() {\n\t/**\n\t * Enable Parseley\n\t */\n\t$(\"#entryForm\").parsley({\n\t\tvalidators: {\n\t\t\tdateobject: function() {\n\t\t\t\treturn {\n\t\t\t\t\tvalidate: function(val, element) {\n\t\t\t\t\t\treturn parseDateString(val, element);\n\t\t\t\t\t},\n\t\t\t\t\tpriority: 2\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tmessages: {\n\t\t\tdateobject: \"We couldn't figure out a way to parse this date.\"\n\t\t}\n\t});\n\n\tbuildSortable();\n\n\t// make sure nested items have the same collection\n\t$(\"#collectionId\").on(\"change\", function(e) {\n\t\tvar targetCollection = $(this).val();\n\t\t$(\".nestediIFrame\").each(function(index, el) {\n\t\t\tvar sourceCollection = $(el).contents().find(\"#collectionId\");\n\t\t\tsourceCollection.val(targetCollection);\n\t\t\t$(sourceCollection).trigger(\"change\");\n\t\t\tif($(el).get(0).contentWindow && $(el).get(0).contentWindow.resetCollection !== undefined) {\n\t\t\t\t$(el).get(0).contentWindow.resetCollection();\n\t\t\t}\n\n\t\t});\n\n\t});\n\n\tshowHaveEntries();\n\n\t$(\".control-group\").each(function(index, el) {\n\t\tif($(el).find('.isPrimary').length > 1) {\n\t\t\t$(el).find('.isPrimary').show();\n\t\t}\n\t\tif($(el).find('.moveDownButton').length > 1) {\n\t\t\t$(el).find('.moveDownButton').show();\n\t\t}\n\t\tif($(el).find('.moveUpButton').length > 1) {\n\t\t\t$(el).find('.moveUpButton').show();\n\t\t}\n\t});\n\n\t$('input,select').keypress(function(event) { return event.keyCode != 13; });\n\n\t$(\"#inputAvailableAfter\").datepicker();\n\n\tif($(\"#inputObjectId\").val() !== \"\") {\n\t\t$(\".viewAsset\").show();\n\t\tloadPreviewAndUpdateTitle($(\"#inputObjectId\").val());\n\t}\n\n\n\t$(\".templateSelector\").trigger(\"change\");\n\n\t/**\n\t * preload the previews for any related assets\n\t */\n\t$(\".relatedAssetSelectedItem\").each(function(index, el) {\n\n\t\tvar relatedAssetId = $(el).val();\n\t\trelatedAssetPreview(relatedAssetId, this, $(\".widgetContents\"));\n\t});\n\n\n\t$(\"#inputNewTemplateId\").on(\"change\", function() {\n\t\tvar sourceReference = this;\n\t\ttargetTemplate = $(sourceReference).val();\n\t\tsourceTemplate = $(\"#sourceTemplate\").val();\n\t\tjQuery.getJSON(basePath + \"assetManager/compareTemplates/\" + sourceTemplate + \"/\" + targetTemplate, {}, function(json, textStatus) {\n\n\t\t\tif(json.length === 0) {\n\t\t\t\t$(\"#sourceTemplate\").val(targetTemplate);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar source   = $(\"#template-switch\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\n\t\t\t\tbootbox.confirm(template(json), function(result) {\n\t\t\t\t\tif(result) {\n\t\t\t\t\t\t$(\"#sourceTemplate\").val(targetTemplate);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$(sourceReference).val(sourceTemplate);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\n\t});\n\n\n\t$(\"#newCollectionId\").on(\"change\", function() {\n\t\tvar sourceReference = this;\n\t\ttargetCollection = $(sourceReference).val();\n\t\tsourceCollection = $(\"#collectionId\").val();\n\t\tif(sourceCollection === \"-1\" || sourceCollection === \"\") {\n\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\treturn;\n\t\t}\n\n\t\tjQuery.getJSON(basePath + \"assetManager/compareCollections/\" + sourceCollection + \"/\" + targetCollection, {}, function(json, textStatus) {\n\n\t\t\tif(json.migration === false) {\n\t\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar source   = $(\"#collection-switch\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\n\t\t\t\tbootbox.confirm(template(json), function(result) {\n\t\t\t\t\tif(result) {\n\t\t\t\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\t\t\t\t$(\"#collectionMigrationInProcess\").val(\"true\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$(sourceReference).val(sourceCollection);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\n\t});\n\n\n\n\tbuildAutocomplete();\n\n\n\t$(\"#collectionMigrationInProcess\").on(\"change\", function() {\n\t\tif($(this).val() == \"true\") {\n\t\t\t\t$(\".saveButton\").hide();\n\t\t\t\tbootbox.dialog({\n\t\t\t\tmessage: \"Editing is unavailable while collection migration is taking place.\",\n\t\t\t\ttitle: \"Edits Disabled\",\n\t\t\t\tbackdrop: true,\n\t\t\t\tcloseButton: false\n\t\t\t});\n\t\t}\n\t\telse {\n\n\t\t}\n\n\t});\n\n\t$(\"#collectionMigrationInProcess\").trigger('change');\n});\n\n\n\n\n\n$(document).on(\"click\", \".autocompletePreview\", function(event) {\n\tvar targetItem = $(this).closest(\".widgetContents\").find(\".targetAsset\").val();\n\twindow.open(basePath+ \"asset/viewAsset/\"+targetItem);\n\treturn false;\n});\n\n\n\nfunction buildAutocomplete() {\n\tvar source   = $(\"#autocompleter-template\").html();\n\tvar template = Handlebars.compile(source);\n\n\t/**\n\t * This performs the actual autocomplete, doing prefix only search against the same template and field title.\n\t */\n\tif($(\".tryAutocomplete\").length) {\n\t\t$(\".tryAutocomplete\").each(function(index, value) {\n\t\t\tvar self = value;\n\t\t\t$(value).autocomplete({\n\t\t\t\tsource: function(request, response) {\n\t\t\t\t\tvar templateId = null;\n\t\t\t\t\tvar fieldTitle = $(self).closest(\".tab-pane\").attr(\"id\");\n\t\t\t\t\tvar searchTerm = request.term;\n\t\t\t\t\t$.post( basePath + \"search/autocomplete/\", {templateId: templateId, fieldTitle:fieldTitle, searchTerm:searchTerm}, function( data ) {\n\t\t\t\t\ttry{\n\t\t\t\t\t\tjsonObject = $.parseJSON(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e){\n\t\t\t\t\t\talert(e + \" \" + data);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresponse(jsonObject);\n\t\t\t\t});\n\t\t\t},\n\t\t\tmessages: {\n\t\t\t\tnoResults: '',\n\t\t\t\tresults: function() {}\n\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tbuildAssetAutocomplete($(\".widgetContents\"));\n}\n\n\n/**\n * related asset helpers\n */\n\n$(document).on(\"click\", \".viewAsset\", function() {\n\t\twindow.open(basePath+ \"asset/viewAsset/\"+$(\"#inputObjectId\").val());\n});\n\n\n$(document).on(\"click\", \".clearRelated\", function(e) {\n\tif(confirm(\"Are you sure you wish to clear this asset?\")) {\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetInput\").val(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetSelectedItem\").val(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetInput\").trigger(\"change\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetSelectedItem\").trigger(\"change\");\n\t\t$(this).closest(\".widgetContents\").find(\".autocompletePreview\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".autocompleteEdit\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".assetPreview\").html(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".clearRelated\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".nestediIFrame\").remove();\n\t\t$(this).closest(\".widgetContents\").find(\".newAssetButton\").removeAttr(\"disabled\");\n\t}\n});\n\n\n/**\n * nested asset helper\n */\n\n\nfunction loadFrameForNestedElement(el) {\n\tvar templateId = $(el).find(\".templateSelector\").val();\n\t\tvar collectionId = $(\"#inputCollectionId\").val();\n\n\t\tvar assetId = $(el).find(\".targetAsset\").val();\n\t\tvar targetURL = null;\n\n\t\tif(assetId.length > 0) {\n\t\t\ttargetURL = basePath + \"assetManager/editAsset/\" + assetId + \"/true\";\n\t\t}\n\t\telse {\n\t\t\ttargetURL = basePath + \"assetManager/addAsset/\" + templateId + \"/\" + collectionId + \"/true\";\n\t\t}\n\n\n\t\tvar targetElement = $(el).find(\".inlineRelatedAsset\");\n\n\t\tvar element = $(\"<iframe />\", {\n\t\t\tclass: \"nestediIFrame\",\n\t\t\tframeborder: 0,\n\t\t\twidth: \"100%\",\n\t\t\tsrc: targetURL\n\t\t});\n\n\t\telement.appendTo(targetElement);\n\n\t\tvar targetField = $(el).find(\".targetAsset\");\n\t\telement.load(function() {\n\t\t\tiframeLoaded(element);\n\t\t\tvar targetInfo = { 'status':'open', 'targetField': targetField.attr('id') };\n\t\t\tthis.contentWindow.postMessage(JSON.stringify(targetInfo), \"*\");\n\t\t});\n\n}\n\nfunction iframeLoaded(iFrame) {\n\n\t\tvar element = $(iFrame).closest(\".tab-pane\");\n\t\tvar id = $(element).attr(\"id\");\n\n\t\tvar height = $(iFrame).contents().find(\"html\").height();\n\n\t\t$(iFrame).height(height);\n\t\t$(\"#collectionId\").trigger(\"change\");\n\n\n}\n"]}