{"version":3,"sources":["widgetHelpers.js"],"names":["buildAutocomplete","source","$","html","template","Handlebars","compile","length","each","index","value","self","autocomplete","request","response","templateId","val","fieldTitle","closest","attr","searchTerm","term","post","basePath","data","jsonObject","parseJSON","e","alert","messages","noResults","results","find","show","searchRequest","searchText","searchQuery","JSON","stringify","suppressRecent","showHidden","success","matches","objectId","splice","close","event","ui","undefined","which","select","item","this","trigger","_renderItem","ul","base_url","appendTo","loadFrameForNestedElement","el","collectionId","assetId","targetURL","targetElement","element","class","frameborder","width","src","load","iframeLoaded","iFrame","id","hasClass","height","contents","on","markSaveDirty","removeClass","addClass","markSaveClean","registerHelper","delimiter","start","end","arry","concat","slice","join","options","Math","random","window","bind","uploadCount","Mousetrap","toggleTabs","toggle","relatedAssetPreview","relatedAssetId","targetContainer","get","responseObject","showHaveEntries","targetId","requiredContent","mainWidgets","mainWidgetElement","is","text","prop","targetHref","children","hide","document","addAnother","target","parentGroup","parents","widgetTitle","replace","widgetId","first","offsetCount","returnInfo","append","removeAttr","parseInt","ready","parsley","validators","dateobject","validate","parseDateString","priority","targetCollection","sourceCollection","contentWindow","resetCollection","keypress","keyCode","datepicker","loadPreviewAndUpdateTitle","sourceReference","targetTemplate","sourceTemplate","jQuery","getJSON","json","textStatus","bootbox","confirm","result","migration","dialog","message","title","backdrop","closeButton","targetItem","open","remove"],"mappings":"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","file":"widgetHelpers.min.js","sourcesContent":["\n/**\n * register various helpers\n */\n\nvar markSaveDirty = function() {\n\t$(\".saveButton\").removeClass(\"btn-primary\").addClass(\"btn-warning\");\n\t$(\"#entryForm\").removeClass(\"clean\").addClass(\"dirty\");\n};\n\nvar markSaveClean = function() {\n\t$(\".saveButton\").removeClass(\"btn-warning\").addClass(\"btn-primary\");\n\t$(\"#entryForm\").removeClass(\"dirty\").addClass(\"clean\");\n};\n\nHandlebars.registerHelper('join', function(val, delimiter, start, end) {\n\tvar arry = [].concat(val);\n\tdelimiter = ( typeof delimiter == \"string\" ? delimiter : ', ' );\n\tstart = start || 0;\n\tend = ( end === undefined ? arry.length : end );\n\treturn arry.slice(start, end).join(delimiter);\n});\n\n\nHandlebars.registerHelper('random', function(options) {\n\treturn Math.random();\n});\n\n$(window).bind('beforeunload', function(){\n\tif(uploadCount > 0) {\n\t\treturn \"You have uploads in progress. Are you sure you wish to leave the page and cancel these uploads?\";\n\t}\n});\n\n// command-control-h reveals hidden content (anything flagged advancedContent)\nMousetrap.bind('command+ctrl+t', function() {\n\ttoggleTabs();\n});\n\n\n// very simple toggle - we'll make this better eventually right?\nvar toggleTabs = function() {\n  $(\".rightPane .tab-content>.tab-pane\").toggle();\n  $(\"#general\").toggle();\n  $(\".leftPane\").toggle();\n};\n\nvar relatedAssetPreview = function(relatedAssetId, targetContainer) {\n\tif(relatedAssetId.length > 0) {\n\t\tvar source   = $(\"#autocompleter-template\").html();\n\t\tvar template = Handlebars.compile(source);\n\t\tvar self = targetContainer;\n\t\t$.get( basePath + \"asset/getAssetPreview/\" + relatedAssetId,  function( data ) {\n\t\t\t\ttry{\n\t\t\t\t\tjsonObject = $.parseJSON(data);\n\t\t\t\t}\n\t\t\t\tcatch(e){\n\t\t\t\t\talert(e + \" \" + data);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(jsonObject) {\n\t\t\t\t\tvar responseObject = jsonObject;\n\t\t\t\t\tresponseObject.base_url = basePath;\n\t\t\t\t\tvar html = template(responseObject);\n\t\t\t\t\t$(self).closest(\".widgetContents\").find(\".autocompletePreview\").show();\n\t\t\t\t\t$(self).closest(\".widgetContents\").find(\".autocompleteEdit\").show();\n\t\t\t\t\t$(self).closest(\".widgetContents\").find(\".clearRelated\").show();\n\t\t\t\t\t$(self).closest(\".widgetContents\").find(\".assetPreview\").html(html);\n\t\t\t\t\t$(self).closest(\".widgetContents\").find(\".newAssetButton\").attr(\"disabled\", true);\n\n\n\t\t\t\t}\n\t\t\t});\n\t}\n};\n\n\n/**\n * Add checkmarks to sidebar if there's content in their\n */\nvar showHaveEntries = function() {\n\n\t$(\".tab-pane\").each(function(index, el) {\n\t\tvar targetId = $(el).attr(\"id\");\n\t\tvar show = false;\n\t\tvar requiredContent = false;\n\t\tvar mainWidgets = $(el).find(\".mainWidgetEntry\");\n\t\t$(mainWidgets).each(function(index, mainWidgetElement) {\n\t\t\tif($(mainWidgetElement).is(\"input\") || $(mainWidgetElement).is(\"textarea\")) {\n\t\t\t\tif($(mainWidgetElement).val().length> 0) {\n\t\t\t\t\tshow = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if($(mainWidgetElement).is(\"select\")) {\n\t\t\t\tif($(mainWidgetElement).find(\":selected\").text() !== \"\") {\n\t\t\t\t\tshow = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tshow = true;\n\t\t\t}\n\n\t\t\tif($(mainWidgetElement).prop('required')) {\n\t\t\t\trequiredContent = true;\n\n\t\t\t}\n\n\t\t});\n\n\t\tvar targetHref;\n\t\tif(show) {\n\t\t\ttargetHref = $('a[href=\"#' + targetId+ '\"]').children('.haveContent').show();\n\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').hide();\n\t\t}\n\t\telse {\n\t\t\ttargetHref = $('a[href=\"#' + targetId+ '\"]').children('.haveContent').hide();\n\t\t\tif(requiredContent) {\n\t\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').show();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').hide();\n\t\t\t}\n\t\t}\n\n\n\t});\n\n};\n\n\n$(document).on(\"change\", \".mainWidgetEntry\", function() {\n\tshowHaveEntries();\n\tmarkSaveDirty();\n});\n\n\nvar addAnother = function(target) {\n\t$(target).attr(\"disabled\",true);\n\tvar parentGroup = $(target).parents(\".control-group\");\n\tvar widgetTitle = $(parentGroup).attr('id').replace(\"controlGroup_\", '');\n\tvar widgetId = $(parentGroup).children(\".widget_id\").first().val();\n\tvar offsetCount = $(parentGroup).children(\"div\").length-1;\n\n\tvar self = target;\n\tvar returnInfo = null;\n\t$.get(basePath+\"assetManager/getWidget/\"+widgetId+\"/\"+offsetCount, function(data){\n\n\t\twindow.offsetCount[widgetTitle]++;\n\t\treturnInfo = $(data);\n\n\t\t$(parentGroup).append(returnInfo);\n\n\t\t$(parentGroup).find('.isPrimary').show();\n\t\tbuildAutocomplete();\n\t\t$(self).removeAttr(\"disabled\");\n\n\t\tif(parentGroup.height() > $(\".mainRow\").height()) {\n\t\t\t$(\".mainRow\").height(parentGroup.height() + 50);\n\t\t\t$(\".leftPane\").height($(\".mainRow\").height());\n\t\t}\n\n\t});\n\treturn returnInfo; // only returns if this is sync\n};\n\n\n/**\n * Add an additional element\n */\n$(document).on(\"click\", \".addAnother\",function(e) { addAnother(this); });\n\n\n$(document).on(\"change\", \".templateSelector\", function(e) {\n\tif(parseInt($(this).val()) === 0) {\n\t\t$(this).closest(\".widgetContents\").find('.newAssetButton').attr('disabled', \"disabled\");\n\t}\n\telse {\n\t\t$(this).closest(\".widgetContents\").find('.newAssetButton').attr('disabled', false);\n\t}\n\n});\n\n\n$(document).ready(function() {\n\t/**\n\t * Enable Parseley\n\t */\n\t$(\"#entryForm\").parsley({\n\t\tvalidators: {\n\t\t\tdateobject: function() {\n\t\t\t\treturn {\n\t\t\t\t\tvalidate: function(val, element) {\n\t\t\t\t\t\treturn parseDateString(val, element);\n\t\t\t\t\t},\n\t\t\t\t\tpriority: 2\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tmessages: {\n\t\t\tdateobject: \"We couldn't figure out a way to parse this date.\"\n\t\t}\n\t});\n\n\n\t// make sure nested items have the same collection\n\t$(\"#collectionId\").on(\"change\", function(e) {\n\t\tvar targetCollection = $(this).val();\n\t\t$(\".nestediIFrame\").each(function(index, el) {\n\t\t\tvar sourceCollection = $(el).contents().find(\"#collectionId\");\n\t\t\tsourceCollection.val(targetCollection);\n\t\t\t$(sourceCollection).trigger(\"change\");\n\t\t\t$(el).get(0).contentWindow.resetCollection();\n\t\t});\n\n\t});\n\n\tshowHaveEntries();\n\n\t$(\".control-group\").each(function(index, el) {\n\t\tif($(el).find('.isPrimary').length > 1) {\n\t\t\t$(el).find('.isPrimary').show();\n\t\t}\n\t});\n\n\t$('input,select').keypress(function(event) { return event.keyCode != 13; });\n\n\t$(\"#inputAvailableAfter\").datepicker();\n\n\tif($(\"#inputObjectId\").val() !== \"\") {\n\t\t$(\".viewAsset\").show();\n\t\tloadPreviewAndUpdateTitle($(\"#inputObjectId\").val());\n\t}\n\n\n\t$(\".templateSelector\").trigger(\"change\");\n\n\t/**\n\t * preload the previews for any related assets\n\t */\n\t$(\".relatedAssetSelectedItem\").each(function(index, el) {\n\n\t\tvar relatedAssetId = $(el).val();\n\t\trelatedAssetPreview(relatedAssetId, this);\n\t});\n\n\n\t$(\"#inputNewTemplateId\").on(\"change\", function() {\n\t\tvar sourceReference = this;\n\t\ttargetTemplate = $(sourceReference).val();\n\t\tsourceTemplate = $(\"#sourceTemplate\").val();\n\t\tjQuery.getJSON(basePath + \"assetManager/compareTemplates/\" + sourceTemplate + \"/\" + targetTemplate, {}, function(json, textStatus) {\n\n\t\t\tif(json.length === 0) {\n\t\t\t\t$(\"#sourceTemplate\").val(targetTemplate);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar source   = $(\"#template-switch\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\n\t\t\t\tbootbox.confirm(template(json), function(result) {\n\t\t\t\t\tif(result) {\n\t\t\t\t\t\t$(\"#sourceTemplate\").val(targetTemplate);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$(sourceReference).val(sourceTemplate);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\n\t});\n\n\n\t$(\"#newCollectionId\").on(\"change\", function() {\n\t\tvar sourceReference = this;\n\t\ttargetCollection = $(sourceReference).val();\n\t\tsourceCollection = $(\"#collectionId\").val();\n\t\tif(sourceCollection === \"-1\" || sourceCollection === \"\") {\n\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\treturn;\n\t\t}\n\n\t\tjQuery.getJSON(basePath + \"assetManager/compareCollections/\" + sourceCollection + \"/\" + targetCollection, {}, function(json, textStatus) {\n\n\t\t\tif(json.migration === false) {\n\t\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar source   = $(\"#collection-switch\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\n\t\t\t\tbootbox.confirm(template(json), function(result) {\n\t\t\t\t\tif(result) {\n\t\t\t\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\t\t\t\t$(\"#collectionMigrationInProcess\").val(\"true\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$(sourceReference).val(sourceCollection);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\n\t});\n\n\n\n\tbuildAutocomplete();\n\n\n\t$(\"#collectionMigrationInProcess\").on(\"change\", function() {\n\t\tif($(this).val() == \"true\") {\n\t\t\t\t$(\".saveButton\").hide();\n\t\t\t\tbootbox.dialog({\n\t\t\t\tmessage: \"Editing is unavailable while collection migration is taking place.\",\n\t\t\t\ttitle: \"Edits Disabled\",\n\t\t\t\tbackdrop: true,\n\t\t\t\tcloseButton: false\n\t\t\t});\n\t\t}\n\t\telse {\n\n\t\t}\n\n\t});\n\n\t$(\"#collectionMigrationInProcess\").trigger('change');\n\n\t$(\".toggleTabs\").on(\"click\", function() {\n\t\ttoggleTabs();\n\t});\n\n});\n\n\n\n\n\n$(document).on(\"click\", \".autocompletePreview\", function(event) {\n\tvar targetItem = $(this).closest(\".widgetContents\").find(\".targetAsset\").val();\n\twindow.open(basePath+ \"asset/viewAsset/\"+targetItem);\n\treturn false;\n});\n\n$(document).on(\"click\", \".autocompleteEdit\", function(event) {\n\tvar targetItem = $(this).closest(\".widgetContents\").find(\".targetAsset\").val();\n\twindow.open(basePath+ \"assetManager/editAsset/\"+targetItem);\n\treturn false;\n});\n\n\nfunction buildAutocomplete() {\n\tvar source   = $(\"#autocompleter-template\").html();\n\tvar template = Handlebars.compile(source);\n\n\t/**\n\t * This performs the actual autocomplete, doing prefix only search against the same template and field title.\n\t */\n\tif($(\".tryAutocomplete\").length) {\n\t\t$(\".tryAutocomplete\").each(function(index, value) {\n\t\t\tvar self = value;\n\t\t\t$(value).autocomplete({\n\t\t\t\tsource: function(request, response) {\n\t\t\t\t\tvar templateId = $(\"#sourceTemplate\").val();\n\t\t\t\t\tvar fieldTitle = $(self).closest(\".tab-pane\").attr(\"id\");\n\t\t\t\t\tvar searchTerm = request.term;\n\t\t\t\t\t$.post( basePath + \"search/autocomplete/\", {templateId: templateId, fieldTitle:fieldTitle, searchTerm:searchTerm}, function( data ) {\n\t\t\t\t\ttry{\n\t\t\t\t\t\tjsonObject = $.parseJSON(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e){\n\t\t\t\t\t\talert(e + \" \" + data);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresponse(jsonObject);\n\t\t\t\t});\n\t\t\t},\n\t\t\tmessages: {\n\t\t\t\tnoResults: '',\n\t\t\t\tresults: function() {}\n\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\n\t/**\n\t * special autocompleter that does full text search\n\t */\n\tif($(\".tryAutocompleteAsset\").length) {\n\t\t$(\".tryAutocompleteAsset\").each(function(index, value) {\n\t\t\tif($(value).val().length>0) {\n\t\t\t\t$(value).closest(\".widgetContents\").find(\".autocompletePreview\").show();\n\t\t\t\t$(value).closest(\".widgetContents\").find(\".autocompleteEdit\").show();\n\t\t\t\t$(value).closest(\".widgetContents\").find(\".clearRelated\").show();\n\t\t\t\t$(value).closest(\".widgetContents\").find(\".newAssetButton\").attr(\"disabled\",true);\n\t\t\t}\n\t\t\t$(value).autocomplete({\n\t\t\tsource: function(request, response) {\n\t\t\t\tvar searchRequest = { \"searchText\": request.term};\n\t\t\t\tvar templateId = $(value).closest(\".widgetContents\").find(\".matchAgainstSelector\").val();\n\n\t\t\t\t$.post( basePath + \"search/searchResults/\", {searchQuery:JSON.stringify(searchRequest), templateId: templateId, suppressRecent:true, showHidden:true}, function( data ) {\n\t\t\t\t\ttry{\n\t\t\t\t\t\tjsonObject = $.parseJSON(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e){\n\t\t\t\t\t\talert(e + \" \" + data);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(jsonObject.success === true) {\n\t\t\t\t\t\t$.each(jsonObject.matches, function(index, value) {\n\t\t\t\t\t\t\tif(!value || value.objectId == $(\"#inputObjectId\").val()) {\n\t\t\t\t\t\t\t\tjsonObject.matches.splice(index,1);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue.value = value.objectId;\n\t\t\t\t\t\t\tjsonObject.matches[index] = value;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tresponse(jsonObject.matches);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tmessages: {\n\t\t\t\tnoResults: '',\n\t\t\t\tresults: function() {}\n\t\t\t},\n\t\t\tclose: function(event, ui){\n\t\t\t\tif(event.which !== undefined) {\n\t\t\t\t\t$(value).val('');\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tselect: function(event, ui){\n\t\t\t\t$(value).closest(\".widgetContents\").find(\".relatedAssetSelectedItem\").val(ui.item.objectId);\n\t\t\t\tvar html = template(ui.item);\n\t\t\t\t$(this).trigger(\"change\");\n\t\t\t\t$(this).closest(\".widgetContents\").find(\".autocompletePreview\").show();\n\t\t\t\t$(this).closest(\".widgetContents\").find(\".autocompleteEdit\").show();\n\t\t\t\t$(this).closest(\".widgetContents\").find(\".clearRelated\").show();\n\t\t\t\t$(this).closest(\".widgetContents\").find(\".newAssetButton\").attr(\"disabled\",true);\n\t\t\t\t$(this).closest(\".widgetContents\").find(\".assetPreview\").html(html);\n\t\t\t}\n\t\t}).data(\"ui-autocomplete\")._renderItem = function( ul, item ) {\n\t\t\titem.base_url = basePath;\n\t\t\tvar html = template(item);\n\t\t\treturn $(html).appendTo(ul);\n\t\t};\n\t});\n\t}\n}\n\n\n/**\n * related asset helpers\n */\n\n$(document).on(\"click\", \".viewAsset\", function() {\n\t\twindow.open(basePath+ \"asset/viewAsset/\"+$(\"#inputObjectId\").val());\n});\n\n\n$(document).on(\"click\", \".clearRelated\", function(e) {\n\tif(confirm(\"Are you sure you wish to clear this asset?\")) {\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetInput\").val(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetSelectedItem\").val(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetInput\").trigger(\"change\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetSelectedItem\").trigger(\"change\");\n\t\t$(this).closest(\".widgetContents\").find(\".autocompletePreview\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".autocompleteEdit\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".assetPreview\").html(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".clearRelated\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".nestediIFrame\").remove();\n\t\t$(this).closest(\".widgetContents\").find(\".newAssetButton\").removeAttr(\"disabled\");\n\t}\n});\n\n\n/**\n * nested asset helper\n */\n\n\nfunction loadFrameForNestedElement(el) {\n\tvar templateId = $(el).find(\".templateSelector\").val();\n\t\tvar collectionId = $(\"#inputCollectionId\").val();\n\n\t\tvar assetId = $(el).find(\".targetAsset\").val();\n\t\tvar targetURL = null;\n\n\t\tif(assetId.length > 0) {\n\t\t\ttargetURL = basePath + \"assetManager/editAsset/\" + assetId + \"/true\";\n\t\t}\n\t\telse {\n\t\t\ttargetURL = basePath + \"assetManager/addAsset/\" + templateId + \"/\" + collectionId + \"/true\";\n\t\t}\n\n\n\t\tvar targetElement = $(el).find(\".inlineRelatedAsset\");\n\n\t\tvar element = $(\"<iframe />\", {\n\t\t\tclass: \"nestediIFrame\",\n\t\t\tframeborder: 0,\n\t\t\twidth: \"100%\",\n\t\t\tsrc: targetURL\n\t\t});\n\n\t\telement.appendTo(targetElement);\n\n\t\telement.load(function() {\n\t\t\tiframeLoaded(element);\n\t\t});\n\n}\n\nfunction iframeLoaded(iFrame) {\n\n\t\tvar element = $(iFrame).closest(\".tab-pane\");\n\t\tvar id = $(element).attr(\"id\");\n\n\t\tif($(element).hasClass(\"active\")) {\n\t\t\tvar height = $(iFrame).contents().find(\"html\").height();\n\n\t\t\t$(iFrame).height(height);\n\t\t}\n\t\telse {\n\t\t\t$(\"a[href=#\" + id + \"]\").on('shown.bs.tab', function(e) {\n\n\t\t\t\tvar height = $(iFrame).contents().find(\"html\").height();\n\n\t\t\t\t$(iFrame).height(height);\n\n\t\t\t});\n\n\t\t}\n\t\t$(\"#collectionId\").trigger(\"change\");\n\n\n}\n"],"sourceRoot":"/source/"}