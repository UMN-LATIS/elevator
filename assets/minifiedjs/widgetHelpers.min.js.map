{"version":3,"sources":["widgetHelpers.js"],"names":["buildAutocomplete","source","$","html","Handlebars","compile","length","each","index","value","self","autocomplete","request","response","templateId","val","fieldTitle","closest","attr","searchTerm","term","post","basePath","data","jsonObject","parseJSON","e","alert","messages","noResults","results","buildAssetAutocomplete","loadFrameForNestedElement","el","find","collectionId","assetId","targetURL","targetElement","element","class","frameborder","width","src","appendTo","targetField","load","iframeLoaded","targetInfo","status","this","contentWindow","postMessage","JSON","stringify","iFrame","height","contents","trigger","markSaveDirty","removeClass","addClass","markSaveClean","registerHelper","delimiter","start","end","arry","concat","undefined","slice","join","options","Math","random","window","bind","uploadCount","showHaveEntries","targetId","show","requiredContent","mainWidgets","mainWidgetElement","is","text","prop","targetHref","children","hide","document","ready","on","addAnother","target","parentGroup","parents","widgetTitle","replace","widgetId","first","offsetCount","returnInfo","get","append","removeAttr","parseInt","parsley","validators","dateobject","validate","parseDateString","priority","targetCollection","sourceCollection","resetCollection","keypress","event","keyCode","datepicker","loadPreviewAndUpdateTitle","relatedAssetId","relatedAssetPreview","sourceReference","targetTemplate","sourceTemplate","jQuery","getJSON","json","textStatus","template","bootbox","confirm","result","migration","dialog","message","title","backdrop","closeButton","targetItem","open","remove"],"mappings":"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","file":"widgetHelpers.min.js","sourcesContent":["\n/**\n * register various helpers\n */\n\nvar markSaveDirty = function() {\n\t$(\".saveButton\").removeClass(\"btn-primary\").addClass(\"btn-warning\");\n\t$(\"#entryForm\").removeClass(\"clean\").addClass(\"dirty\");\n};\n\nvar markSaveClean = function() {\n\t$(\".saveButton\").removeClass(\"btn-warning\").addClass(\"btn-primary\");\n\t$(\"#entryForm\").removeClass(\"dirty\").addClass(\"clean\");\n};\n\nHandlebars.registerHelper('join', function(val, delimiter, start, end) {\n\tvar arry = [].concat(val);\n\tdelimiter = ( typeof delimiter == \"string\" ? delimiter : ', ' );\n\tstart = start || 0;\n\tend = ( end === undefined ? arry.length : end );\n\treturn arry.slice(start, end).join(delimiter);\n});\n\n\nHandlebars.registerHelper('random', function(options) {\n\treturn Math.random();\n});\n\n$(window).bind('beforeunload', function(){\n\tif(uploadCount > 0) {\n\t\treturn \"You have uploads in progress. Are you sure you wish to leave the page and cancel these uploads?\";\n\t}\n});\n\n/**\n * Add checkmarks to sidebar if there's content in their\n */\nvar showHaveEntries = function() {\n\n\t$(\".tab-pane\").each(function(index, el) {\n\t\tvar targetId = $(el).attr(\"id\");\n\t\tvar show = false;\n\t\tvar requiredContent = false;\n\t\tvar mainWidgets = $(el).find(\".mainWidgetEntry\");\n\t\t$(mainWidgets).each(function(index, mainWidgetElement) {\n\t\t\tif($(mainWidgetElement).is(\"input\") || $(mainWidgetElement).is(\"textarea\")) {\n\t\t\t\tif($(mainWidgetElement).val().length> 0) {\n\t\t\t\t\tshow = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if($(mainWidgetElement).is(\"select\")) {\n\t\t\t\tif($(mainWidgetElement).find(\":selected\").text() !== \"\") {\n\t\t\t\t\tshow = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tshow = true;\n\t\t\t}\n\n\t\t\tif($(mainWidgetElement).prop('required')) {\n\t\t\t\trequiredContent = true;\n\n\t\t\t}\n\n\t\t});\n\n\t\tvar targetHref;\n\t\tif(show) {\n\t\t\ttargetHref = $('a[href=\"#' + targetId+ '\"]').children('.haveContent').show();\n\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').hide();\n\t\t}\n\t\telse {\n\t\t\ttargetHref = $('a[href=\"#' + targetId+ '\"]').children('.haveContent').hide();\n\t\t\tif(requiredContent) {\n\t\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').show();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('a[href=\"#' + targetId+ '\"]').find('.requiredContent').hide();\n\t\t\t}\n\t\t}\n\n\n\t});\n\n};\n\n$(document).ready(function() {\n\t$(document).on(\"change\", \".mainWidgetEntry\", function(e) {\n\t\tshowHaveEntries();\n\t\tmarkSaveDirty();\n\t});\n\n});\n\n\nvar addAnother = function(target) {\n\t$(target).attr(\"disabled\",true);\n\tvar parentGroup = $(target).parents(\".tab-pane\").find(\".control-group\");\n\tvar widgetTitle = $(parentGroup).attr('id').replace(\"controlGroup_\", '');\n\tvar widgetId = $(parentGroup).children(\".widget_id\").first().val();\n\tvar offsetCount = $(parentGroup).children(\"div\").length-1;\n\n\tvar self = target;\n\tvar returnInfo = null;\n\t$.get(basePath+\"assetManager/getWidget/\"+widgetId+\"/\"+offsetCount, function(data){\n\n\t\twindow.offsetCount[widgetTitle]++;\n\t\treturnInfo = $(data);\n\n\t\t$(parentGroup).append(returnInfo);\n\n\t\t$(parentGroup).find('.isPrimary').show();\n\t\tbuildAutocomplete();\n\t\t$(self).removeAttr(\"disabled\");\n\n\t\tif(parentGroup.height() > $(\".mainRow\").height()) {\n\t\t\t$(\".mainRow\").height(parentGroup.height() + 50);\n\t\t\t$(\".leftPane\").height($(\".mainRow\").height());\n\t\t}\n\n\t});\n\treturn returnInfo; // only returns if this is sync\n};\n\n\n/**\n * Add an additional element\n */\n$(document).on(\"click\", \".addAnother\",function(e) { addAnother(this); });\n\n\n$(document).on(\"change\", \".templateSelector\", function(e) {\n\tif(parseInt($(this).val()) === 0) {\n\t\t$(this).closest(\".widgetContents\").find('.newAssetButton').attr('disabled', \"disabled\");\n\t}\n\telse {\n\t\t$(this).closest(\".widgetContents\").find('.newAssetButton').attr('disabled', false);\n\t}\n\n});\n\n\n$(document).ready(function() {\n\t/**\n\t * Enable Parseley\n\t */\n\t$(\"#entryForm\").parsley({\n\t\tvalidators: {\n\t\t\tdateobject: function() {\n\t\t\t\treturn {\n\t\t\t\t\tvalidate: function(val, element) {\n\t\t\t\t\t\treturn parseDateString(val, element);\n\t\t\t\t\t},\n\t\t\t\t\tpriority: 2\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tmessages: {\n\t\t\tdateobject: \"We couldn't figure out a way to parse this date.\"\n\t\t}\n\t});\n\n\n\t// make sure nested items have the same collection\n\t$(\"#collectionId\").on(\"change\", function(e) {\n\t\tvar targetCollection = $(this).val();\n\t\t$(\".nestediIFrame\").each(function(index, el) {\n\t\t\tvar sourceCollection = $(el).contents().find(\"#collectionId\");\n\t\t\tsourceCollection.val(targetCollection);\n\t\t\t$(sourceCollection).trigger(\"change\");\n\t\t\tif($(el).get(0).contentWindow && $(el).get(0).contentWindow.resetCollection !== undefined) {\n\t\t\t\t$(el).get(0).contentWindow.resetCollection();\n\t\t\t}\n\n\t\t});\n\n\t});\n\n\tshowHaveEntries();\n\n\t$(\".control-group\").each(function(index, el) {\n\t\tif($(el).find('.isPrimary').length > 1) {\n\t\t\t$(el).find('.isPrimary').show();\n\t\t}\n\t});\n\n\t$('input,select').keypress(function(event) { return event.keyCode != 13; });\n\n\t$(\"#inputAvailableAfter\").datepicker();\n\n\tif($(\"#inputObjectId\").val() !== \"\") {\n\t\t$(\".viewAsset\").show();\n\t\tloadPreviewAndUpdateTitle($(\"#inputObjectId\").val());\n\t}\n\n\n\t$(\".templateSelector\").trigger(\"change\");\n\n\t/**\n\t * preload the previews for any related assets\n\t */\n\t$(\".relatedAssetSelectedItem\").each(function(index, el) {\n\n\t\tvar relatedAssetId = $(el).val();\n\t\trelatedAssetPreview(relatedAssetId, this, $(\".widgetContents\"));\n\t});\n\n\n\t$(\"#inputNewTemplateId\").on(\"change\", function() {\n\t\tvar sourceReference = this;\n\t\ttargetTemplate = $(sourceReference).val();\n\t\tsourceTemplate = $(\"#sourceTemplate\").val();\n\t\tjQuery.getJSON(basePath + \"assetManager/compareTemplates/\" + sourceTemplate + \"/\" + targetTemplate, {}, function(json, textStatus) {\n\n\t\t\tif(json.length === 0) {\n\t\t\t\t$(\"#sourceTemplate\").val(targetTemplate);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar source   = $(\"#template-switch\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\n\t\t\t\tbootbox.confirm(template(json), function(result) {\n\t\t\t\t\tif(result) {\n\t\t\t\t\t\t$(\"#sourceTemplate\").val(targetTemplate);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$(sourceReference).val(sourceTemplate);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\n\t});\n\n\n\t$(\"#newCollectionId\").on(\"change\", function() {\n\t\tvar sourceReference = this;\n\t\ttargetCollection = $(sourceReference).val();\n\t\tsourceCollection = $(\"#collectionId\").val();\n\t\tif(sourceCollection === \"-1\" || sourceCollection === \"\") {\n\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\treturn;\n\t\t}\n\n\t\tjQuery.getJSON(basePath + \"assetManager/compareCollections/\" + sourceCollection + \"/\" + targetCollection, {}, function(json, textStatus) {\n\n\t\t\tif(json.migration === false) {\n\t\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar source   = $(\"#collection-switch\").html();\n\t\t\t\tvar template = Handlebars.compile(source);\n\n\t\t\t\tbootbox.confirm(template(json), function(result) {\n\t\t\t\t\tif(result) {\n\t\t\t\t\t\t$(\"#collectionId\").val(targetCollection);\n\t\t\t\t\t\t$(\"#collectionId\").trigger(\"change\");\n\t\t\t\t\t\t$(\"#collectionMigrationInProcess\").val(\"true\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$(sourceReference).val(sourceCollection);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\n\t});\n\n\n\n\tbuildAutocomplete();\n\n\n\t$(\"#collectionMigrationInProcess\").on(\"change\", function() {\n\t\tif($(this).val() == \"true\") {\n\t\t\t\t$(\".saveButton\").hide();\n\t\t\t\tbootbox.dialog({\n\t\t\t\tmessage: \"Editing is unavailable while collection migration is taking place.\",\n\t\t\t\ttitle: \"Edits Disabled\",\n\t\t\t\tbackdrop: true,\n\t\t\t\tcloseButton: false\n\t\t\t});\n\t\t}\n\t\telse {\n\n\t\t}\n\n\t});\n\n\t$(\"#collectionMigrationInProcess\").trigger('change');\n});\n\n\n\n\n\n$(document).on(\"click\", \".autocompletePreview\", function(event) {\n\tvar targetItem = $(this).closest(\".widgetContents\").find(\".targetAsset\").val();\n\twindow.open(basePath+ \"asset/viewAsset/\"+targetItem);\n\treturn false;\n});\n\n\n\nfunction buildAutocomplete() {\n\tvar source   = $(\"#autocompleter-template\").html();\n\tvar template = Handlebars.compile(source);\n\n\t/**\n\t * This performs the actual autocomplete, doing prefix only search against the same template and field title.\n\t */\n\tif($(\".tryAutocomplete\").length) {\n\t\t$(\".tryAutocomplete\").each(function(index, value) {\n\t\t\tvar self = value;\n\t\t\t$(value).autocomplete({\n\t\t\t\tsource: function(request, response) {\n\t\t\t\t\tvar templateId = $(\"#sourceTemplate\").val();\n\t\t\t\t\tvar fieldTitle = $(self).closest(\".tab-pane\").attr(\"id\");\n\t\t\t\t\tvar searchTerm = request.term;\n\t\t\t\t\t$.post( basePath + \"search/autocomplete/\", {templateId: templateId, fieldTitle:fieldTitle, searchTerm:searchTerm}, function( data ) {\n\t\t\t\t\ttry{\n\t\t\t\t\t\tjsonObject = $.parseJSON(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e){\n\t\t\t\t\t\talert(e + \" \" + data);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresponse(jsonObject);\n\t\t\t\t});\n\t\t\t},\n\t\t\tmessages: {\n\t\t\t\tnoResults: '',\n\t\t\t\tresults: function() {}\n\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tbuildAssetAutocomplete($(\".widgetContents\"));\n}\n\n\n/**\n * related asset helpers\n */\n\n$(document).on(\"click\", \".viewAsset\", function() {\n\t\twindow.open(basePath+ \"asset/viewAsset/\"+$(\"#inputObjectId\").val());\n});\n\n\n$(document).on(\"click\", \".clearRelated\", function(e) {\n\tif(confirm(\"Are you sure you wish to clear this asset?\")) {\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetInput\").val(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetSelectedItem\").val(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetInput\").trigger(\"change\");\n\t\t$(this).closest(\".widgetContents\").find(\".relatedAssetSelectedItem\").trigger(\"change\");\n\t\t$(this).closest(\".widgetContents\").find(\".autocompletePreview\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".autocompleteEdit\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".assetPreview\").html(\"\");\n\t\t$(this).closest(\".widgetContents\").find(\".clearRelated\").hide();\n\t\t$(this).closest(\".widgetContents\").find(\".nestediIFrame\").remove();\n\t\t$(this).closest(\".widgetContents\").find(\".newAssetButton\").removeAttr(\"disabled\");\n\t}\n});\n\n\n/**\n * nested asset helper\n */\n\n\nfunction loadFrameForNestedElement(el) {\n\tvar templateId = $(el).find(\".templateSelector\").val();\n\t\tvar collectionId = $(\"#inputCollectionId\").val();\n\n\t\tvar assetId = $(el).find(\".targetAsset\").val();\n\t\tvar targetURL = null;\n\n\t\tif(assetId.length > 0) {\n\t\t\ttargetURL = basePath + \"assetManager/editAsset/\" + assetId + \"/true\";\n\t\t}\n\t\telse {\n\t\t\ttargetURL = basePath + \"assetManager/addAsset/\" + templateId + \"/\" + collectionId + \"/true\";\n\t\t}\n\n\n\t\tvar targetElement = $(el).find(\".inlineRelatedAsset\");\n\n\t\tvar element = $(\"<iframe />\", {\n\t\t\tclass: \"nestediIFrame\",\n\t\t\tframeborder: 0,\n\t\t\twidth: \"100%\",\n\t\t\tsrc: targetURL\n\t\t});\n\n\t\telement.appendTo(targetElement);\n\n\t\tvar targetField = $(el).find(\".targetAsset\");\n\t\telement.load(function() {\n\t\t\tiframeLoaded(element);\n\t\t\tvar targetInfo = { 'status':'open', 'targetField': targetField.attr('id') };\n\t\t\tthis.contentWindow.postMessage(JSON.stringify(targetInfo), \"*\");\n\t\t});\n\n}\n\nfunction iframeLoaded(iFrame) {\n\n\t\tvar element = $(iFrame).closest(\".tab-pane\");\n\t\tvar id = $(element).attr(\"id\");\n\n\t\tvar height = $(iFrame).contents().find(\"html\").height();\n\n\t\t$(iFrame).height(height);\n\t\t$(\"#collectionId\").trigger(\"change\");\n\n\n}\n"],"sourceRoot":"/source/"}