{"version":3,"sources":["galleria-1.3.3.js"],"names":["$","window","Galleria","undef","doc","document","$doc","$win","protoArray","Array","prototype","VERSION","DEBUG","TIMEOUT","DUMMY","NAV","navigator","userAgent","toLowerCase","HASH","location","hash","replace","PROT","protocol","M","Math","F","FALSE","IE","v","div","createElement","all","getElementsByTagName","innerHTML","documentMode","DOM","html","documentElement","body","head","title","IFRAME","parent","self","_eventlist","_events","evs","each","split","i","ev","push","test","_legacyOptions","options","n","key","value","k","substr","toUpperCase","_patchEvent","type","inArray","_video","youtube","reg","embed","this","id","getUrl","get_thumb","data","entry","media$group","media$thumbnail","url","get_image","yt$hd","vimeo","thumbnail_medium","thumbnail_large","dailymotion","thumbnail_240_url","thumbnail_720_url","_inst","Video","length","readys","extend","getJSON","fn","getMedia","callback","fail","success","e","_videoTest","match","provider","_nativeFullscreen","support","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","enter","instance","elem","exit","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","listen","handler","fs","_fullscreen","fullscreen","mozFullScreen","webkitIsFullScreen","_enter","_exit","addEventListener","_galleries","_instances","_hasError","_canvas","_pool","_themeLoad","theme","_initialized","_init","call","Utils","clearTimer","get","addTimer","array","obj","slice","create","className","nodeName","removeFromArray","arr","el","splice","getScriptPath","src","attr","slices","pop","join","animate","change","strings","easing","syntax","revert","form","css","transition","style","props","opera","endEvent","MozTransition","OTransition","WebkitTransition","easings","_default","galleria","galleriaIn","galleriaOut","ease","linear","ease-in","ease-out","ease-in-out","setStyle","suffix","clearStyle","WEBKIT","TOUCH","to","duration","complete","stop","off","val","parseValue","setTimeout","one","m","p","removeAlpha","jQuery","currentStyle","filter","forceStyles","styles","removeAttr","revertStyles","arguments","moveOut","position","left","moveIn","apply","hide","speed","$elem","opacity","visibility","show","saved","parseFloat","wait","_waiters","until","error","raise","timeout","elapsed","now","tid","start","timestamp","toggleQuality","img","force","msInterpolationMode","insertStyleTag","appendChild","styleSheet","cssText","createTextNode","loadScript","done","script","async","onload","onreadystatechange","readyState","constructor","Date","getTime","loadCSS","href","link","RegExp","styleSheets","rel","parentNode","insertBefore","$loader","appendTo","height","remove","QUIRK","_playIcon","container","click","siblings","mouseup","_transitions","_slide","params","fade","door","getOptions","distance","getStageWidth","from","rewind","next","elems","add","prev","queue","active","init","effect","effects","hasOwnProperty","flash","pulse","slide","fadeslide","concat","doorslide","event","special","propagate","handleObj","on","x","y","originalEvent","dist","touches","pageX","pageY","f","ft","max","abs","resize","_options","_playing","_playtime","_active","_queue","_data","_dom","_thumbnails","_layers","_firstrun","_stageWidth","_stageHeight","_target","_binds","_id","parseInt","random","divs","spans","elemId","keyboard","_keyboard","keys","UP","DOWN","LEFT","RIGHT","RETURN","ESCAPE","BACKSPACE","SPACE","map","bound","press","keyCode","which","attach","up","detach","controls","_controls",0,1,"swap","getActive","swipe","slides","getNext","frames","layers","carousel","_carousel","width","current","hooks","update","w","h","thumb","ready","outerWidth","containerWidth","floor","outerHeight","setClasses","toggleClass","bindControls","preventDefault","carouselSteps","set","getLast","follow","last","num","isNaN","carouselSpeed","tooltip","_tooltip","initialized","open","timer","swapTimer","display","move","mouseX","getMousePosition","mouseY","limitY","maxX","maxY","min","top","bind","mouseout","hover","define","trigger","elemID","text","s","scrolled","crop","beforeEnter","beforeExit","keymap","parseCallback","_scaleImage","trueFullscreen","rescale","MAC","SAFARI","scale","addClass","scrollTop","scrollTo","iframe","refer","referrer","loc","hostname","port","pd","find","idoc","contentDocument","contentWindow","getActiveImage","getData","inBrowser","htmlbody","overflow","margin","padding","zIndex","border","attachKeyboard","escape","right","imageCrop","fullscreenCrop","big","image","Picture","cached","isCached","index","getIndex","LOADSTART","imageTarget","thumbTarget","galleriaData","load","LOADFINISH","FULLSCREEN_ENTER","$container","removeClass","prepend","insertAfter","frame","detachKeyboard","FULLSCREEN_EXIT","idle","_idle","trunk","addEvent","extract","busy","not","removeEvent","showAll","idleMode","idleTime","IDLE_ENTER","len","idleSpeed","IDLE_EXIT","lightbox","_lightbox","op","prefix","cssMap","overlay","overlayOpacity","overlayBackground","box","shadow","content","info","close","prevholder","nextholder","counter","appends","addElement","prop","append","dir","$d","$e","fadeOut","IPAD","lightboxTransitionSpeed","ratio","destWidth","round","destHeight","margin-top","ceil","margin-left","lightboxFadeSpeed","LIGHTBOX_IMAGE","LIGHTBOX_CLOSE","showNext","showPrev","getPrev","LIGHTBOX_OPEN","ndata","total","getDataLength","preload","isIframe","cw","ch","video","maxVideoSize","r","original","bottom","$icon","fadeIn","_timer","delay","loop","clear","old","del","clearTimeout","target","_original","autoplay","carouselFollow","clicknext","foreground","highlight","background","logo","hideInfos","dataConfig","dataSelector","dataSort","dataSource","debug","dummy","fullscreenDoubleTap","fullscreenTransition","imageMargin","imagePan","imagePanSmoothness","imagePosition","imageTimeout","initialTransition","keepSource","layerFollow","linkSourceImages","maxScaleRatio","minScaleRatio","pauseOnInteraction","popupLinks","responsive","showInfo","showCounter","showImagenav","thumbCrop","thumbEventType","thumbMargin","thumbQuality","thumbDisplayOrder","thumbPosition","thumbnails","touchTransition","transitionInitial","transitionSpeed","useCanvas","variation","videoPoster","byline","portrait","color","modestbranding","autohide","hd","showinfo","children","defaults","configure","can","context","getContext","cache","DATA","screen","forEach","density","devicePixelRatio","_userRatio","_ratio","testHeight","_getWH","_width","_height","_run","info-text","image-nav","stage","thumbnails-list","thumbnails-container","setCounter","finger","Finger","onchange","page","setInfo","pause","oncomplete","RESCALE","setup","isPlaying","iframelimit","IMAGE","preloads","filtered","loadme","d","isFullscreen","stopPropagation","count","THUMBNAIL","updateCarousel","cx","cy","lx","ly","toggleFullscreen","binds","$target","_createThumbnails","o","chunk","thumbchunk","loadindex","gif","a","optval","getStyle","defaultView","getComputedStyle","fake","onThumbEvent","currentTarget","thumbComplete","order","onThumbLoad","canvas","measure","lazy","th","displayed","empty","lazyLoad","loaded","ind","thumbload","lazyLoadChunks","size","temp","shift","OPERA","$images","PLAY","History","history","go","READY","callbacks","source","selector","config","isPlainObject","isArray","validate","hasClass","toString","description","sort","_parseData","loading","result","str","destroy","args","_getActive","proxy","unbind","scope","addIdleState","removeIdleState","enterIdleMode","exitIdleMode","enterFullscreen","bindTooltip","defineTooltip","refreshTooltip","openLightbox","closeLightbox","hasVariation","getActiveThumb","offset","addPan","destX","destY","curX","curY","distX","distY","ts","cur","pos","calculate","scrollLeft","removePan","dom","blueprint","parentID","childID","prependChild","j","scaleLayer","measures","refreshImage","_history","stalled","evObj","layer","_playCheck","_show","mousetrigger","win","imageQuality","cursor","initial","touch","arg","base","getStageHeight","setOptions","play","PAUSE","playToggle","played","interval","timer_id","PROGRESS","percent","seconds","milliseconds","setPlaytime","setIndex","hasInfo","check","ret","trim","jQ","IE9","IE8","IE7","IE6","CHROME","compatMode","platform","IPHONE","ANDROID","addTheme","name","retryCount","tryLoadCss","loadTheme","err","unloadTheme","opts","run","isFunction","addTransition","utils","log","console","alert","gallery","msg","fatal","echo","cont","Error","version","requires","Image","frameborder","allowfullscreen","reload","resort","$image","onerror","indexOf","HAS3D","MozTransform","webkitTransform","nw","nh","newWidth","newHeight","cropMap","true","false","landscape","canvasKey","drawImage","toDataURL","mix","getPosition","flt","positionMap","_","t","b","c","has3d","undefined","removeChild","requestFrame","requestAnimationFrame","easeout","child","touching","anim","caller","setX","ontouchstart","animloop","setPosition","time","isScrolling","deltaX","ontouchmove","ontouchend","isValidSlide","isPastBounds","moveTo","factor","destination","module","exports","amd"],"mappings":"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","file":"galleria-1.3.3.min.js","sourcesContent":["/**\n * Galleria v 1.3.3 2013-11-18\n * http://galleria.io\n *\n * Licensed under the MIT license\n * https://raw.github.com/aino/galleria/master/LICENSE\n *\n */\n\n(function( $, window, Galleria, undef ) {\n\n/*global jQuery, navigator, Image, module, define */\n\n// some references\nvar doc    = window.document,\n    $doc   = $( doc ),\n    $win   = $( window ),\n\n// native prototypes\n    protoArray = Array.prototype,\n\n// internal constants\n    VERSION = 1.33,\n    DEBUG = true,\n    TIMEOUT = 30000,\n    DUMMY = false,\n    NAV = navigator.userAgent.toLowerCase(),\n    HASH = window.location.hash.replace(/#\\//, ''),\n    PROT = window.location.protocol,\n    M = Math,\n    F = function(){},\n    FALSE = function() { return false; },\n    IE = (function() {\n\n        var v = 3,\n            div = doc.createElement( 'div' ),\n            all = div.getElementsByTagName( 'i' );\n\n        do {\n            div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->';\n        } while ( all[0] );\n\n        return v > 4 ? v : doc.documentMode || undef;\n\n    }() ),\n    DOM = function() {\n        return {\n            html:  doc.documentElement,\n            body:  doc.body,\n            head:  doc.getElementsByTagName('head')[0],\n            title: doc.title\n        };\n    },\n    IFRAME = window.parent !== window.self,\n\n    // list of Galleria events\n    _eventlist = 'data ready thumbnail loadstart loadfinish image play pause progress ' +\n                 'fullscreen_enter fullscreen_exit idle_enter idle_exit rescale ' +\n                 'lightbox_open lightbox_close lightbox_image',\n\n    _events = (function() {\n\n        var evs = [];\n\n        $.each( _eventlist.split(' '), function( i, ev ) {\n            evs.push( ev );\n\n            // legacy events\n            if ( /_/.test( ev ) ) {\n                evs.push( ev.replace( /_/g, '' ) );\n            }\n        });\n\n        return evs;\n\n    }()),\n\n    // legacy options\n    // allows the old my_setting syntax and converts it to camel case\n\n    _legacyOptions = function( options ) {\n\n        var n;\n\n        if ( typeof options !== 'object' ) {\n\n            // return whatever it was...\n            return options;\n        }\n\n        $.each( options, function( key, value ) {\n            if ( /^[a-z]+_/.test( key ) ) {\n                n = '';\n                $.each( key.split('_'), function( i, k ) {\n                    n += i > 0 ? k.substr( 0, 1 ).toUpperCase() + k.substr( 1 ) : k;\n                });\n                options[ n ] = value;\n                delete options[ key ];\n            }\n        });\n\n        return options;\n    },\n\n    _patchEvent = function( type ) {\n\n        // allow 'image' instead of Galleria.IMAGE\n        if ( $.inArray( type, _events ) > -1 ) {\n            return Galleria[ type.toUpperCase() ];\n        }\n\n        return type;\n    },\n\n    // video providers\n    _video = {\n        youtube: {\n            reg: /https?:\\/\\/(?:[a-zA_Z]{2,3}.)?(?:youtube\\.com\\/watch\\?)((?:[\\w\\d\\-\\_\\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\\-\\_]+))/i,\n            embed: function() {\n                return 'http://www.youtube.com/embed/' + this.id;\n            },\n            getUrl: function() {\n                return PROT + '//gdata.youtube.com/feeds/api/videos/' + this.id + '?v=2&alt=json-in-script&callback=?';\n            },\n            get_thumb: function(data) {\n                return data.entry.media$group.media$thumbnail[2].url;\n            },\n            get_image: function(data) {\n                if ( data.entry.yt$hd ) {\n                    return PROT + '//img.youtube.com/vi/'+this.id+'/maxresdefault.jpg';\n                }\n                return data.entry.media$group.media$thumbnail[3].url;\n            }\n        },\n        vimeo: {\n            reg: /https?:\\/\\/(?:www\\.)?(vimeo\\.com)\\/(?:hd#)?([0-9]+)/i,\n            embed: function() {\n                return 'http://player.vimeo.com/video/' + this.id;\n            },\n            getUrl: function() {\n                return PROT + '//vimeo.com/api/v2/video/' + this.id + '.json?callback=?';\n            },\n            get_thumb: function( data ) {\n                return data[0].thumbnail_medium;\n            },\n            get_image: function( data ) {\n                return data[0].thumbnail_large;\n            }\n        },\n        dailymotion: {\n            reg: /https?:\\/\\/(?:www\\.)?(dailymotion\\.com)\\/video\\/([^_]+)/,\n            embed: function() {\n                return PROT + '//www.dailymotion.com/embed/video/' + this.id;\n            },\n            getUrl: function() {\n                return 'https://api.dailymotion.com/video/' + this.id + '?fields=thumbnail_240_url,thumbnail_720_url&callback=?';\n            },\n            get_thumb: function( data ) {\n                return data.thumbnail_240_url;\n            },\n            get_image: function( data ) {\n                return data.thumbnail_720_url;\n            }\n        },\n        _inst: []\n    },\n    Video = function( type, id ) {\n\n        for( var i=0; i<_video._inst.length; i++ ) {\n            if ( _video._inst[i].id === id && _video._inst[i].type == type ) {\n                return _video._inst[i];\n            }\n        }\n\n        this.type = type;\n        this.id = id;\n        this.readys = [];\n\n        _video._inst.push(this);\n\n        var self = this;\n\n        $.extend( this, _video[type] );\n\n        $.getJSON( this.getUrl(), function(data) {\n            self.data = data;\n            $.each( self.readys, function( i, fn ) {\n                fn( self.data );\n            });\n            self.readys = [];\n        });\n\n        this.getMedia = function( type, callback, fail ) {\n            fail = fail || F;\n            var self = this;\n            var success = function( data ) {\n                callback( self['get_'+type]( data ) );\n            };\n            try {\n                if ( self.data ) {\n                    success( self.data );\n                } else {\n                    self.readys.push( success );\n                }\n            } catch(e) {\n                fail();\n            }\n        };\n    },\n\n    // utility for testing the video URL and getting the video ID\n    _videoTest = function( url ) {\n        var match;\n        for ( var v in _video ) {\n            match = url && _video[v].reg && url.match( _video[v].reg );\n            if( match && match.length ) {\n                return {\n                    id: match[2],\n                    provider: v\n                };\n            }\n        }\n        return false;\n    },\n\n    // native fullscreen handler\n    _nativeFullscreen = {\n\n        support: (function() {\n            var html = DOM().html;\n            return !IFRAME && ( html.requestFullscreen || html.mozRequestFullScreen || html.webkitRequestFullScreen );\n        }()),\n\n        callback: F,\n\n        enter: function( instance, callback, elem ) {\n\n            this.instance = instance;\n\n            this.callback = callback || F;\n\n            elem = elem || DOM().html;\n            if ( elem.requestFullscreen ) {\n                elem.requestFullscreen();\n            }\n            else if ( elem.mozRequestFullScreen ) {\n                elem.mozRequestFullScreen();\n            }\n            else if ( elem.webkitRequestFullScreen ) {\n                elem.webkitRequestFullScreen();\n            }\n        },\n\n        exit: function( callback ) {\n\n            this.callback = callback || F;\n\n            if ( doc.exitFullscreen ) {\n                doc.exitFullscreen();\n            }\n            else if ( doc.mozCancelFullScreen ) {\n                doc.mozCancelFullScreen();\n            }\n            else if ( doc.webkitCancelFullScreen ) {\n                doc.webkitCancelFullScreen();\n            }\n        },\n\n        instance: null,\n\n        listen: function() {\n\n            if ( !this.support ) {\n                return;\n            }\n\n            var handler = function() {\n\n                if ( !_nativeFullscreen.instance ) {\n                    return;\n                }\n                var fs = _nativeFullscreen.instance._fullscreen;\n\n                if ( doc.fullscreen || doc.mozFullScreen || doc.webkitIsFullScreen ) {\n                    fs._enter( _nativeFullscreen.callback );\n                } else {\n                    fs._exit( _nativeFullscreen.callback );\n                }\n            };\n            doc.addEventListener( 'fullscreenchange', handler, false );\n            doc.addEventListener( 'mozfullscreenchange', handler, false );\n            doc.addEventListener( 'webkitfullscreenchange', handler, false );\n        }\n    },\n\n    // the internal gallery holder\n    _galleries = [],\n\n    // the internal instance holder\n    _instances = [],\n\n    // flag for errors\n    _hasError = false,\n\n    // canvas holder\n    _canvas = false,\n\n    // instance pool, holds the galleries until themeLoad is triggered\n    _pool = [],\n\n    // themeLoad trigger\n    _themeLoad = function( theme ) {\n\n        Galleria.theme = theme;\n\n        // run the instances we have in the pool\n        $.each( _pool, function( i, instance ) {\n            if ( !instance._initialized ) {\n                instance._init.call( instance );\n            }\n        });\n\n        _pool = [];\n    },\n\n    // the Utils singleton\n    Utils = (function() {\n\n        return {\n\n            // legacy support for clearTimer\n            clearTimer: function( id ) {\n                $.each( Galleria.get(), function() {\n                    this.clearTimer( id );\n                });\n            },\n\n            // legacy support for addTimer\n            addTimer: function( id ) {\n                $.each( Galleria.get(), function() {\n                    this.addTimer( id );\n                });\n            },\n\n            array : function( obj ) {\n                return protoArray.slice.call(obj, 0);\n            },\n\n            create : function( className, nodeName ) {\n                nodeName = nodeName || 'div';\n                var elem = doc.createElement( nodeName );\n                elem.className = className;\n                return elem;\n            },\n\n            removeFromArray : function( arr, elem ) {\n                $.each(arr, function(i, el) {\n                    if ( el == elem ) {\n                        arr.splice(i, 1);\n                        return false;\n                    }\n                });\n                return arr;\n            },\n\n            getScriptPath : function( src ) {\n\n                // the currently executing script is always the last\n                src = src || $('script:last').attr('src');\n                var slices = src.split('/');\n\n                if (slices.length == 1) {\n                    return '';\n                }\n\n                slices.pop();\n\n                return slices.join('/') + '/';\n            },\n\n            // CSS3 transitions, added in 1.2.4\n            animate : (function() {\n\n                // detect transition\n                var transition = (function( style ) {\n                    var props = 'transition WebkitTransition MozTransition OTransition'.split(' '),\n                        i;\n\n                    // disable css3 animations in opera until stable\n                    if ( window.opera ) {\n                        return false;\n                    }\n\n                    for ( i = 0; props[i]; i++ ) {\n                        if ( typeof style[ props[ i ] ] !== 'undefined' ) {\n                            return props[ i ];\n                        }\n                    }\n                    return false;\n                }(( doc.body || doc.documentElement).style ));\n\n                // map transitionend event\n                var endEvent = {\n                    MozTransition: 'transitionend',\n                    OTransition: 'oTransitionEnd',\n                    WebkitTransition: 'webkitTransitionEnd',\n                    transition: 'transitionend'\n                }[ transition ];\n\n                // map bezier easing conversions\n                var easings = {\n                    _default: [0.25, 0.1, 0.25, 1],\n                    galleria: [0.645, 0.045, 0.355, 1],\n                    galleriaIn: [0.55, 0.085, 0.68, 0.53],\n                    galleriaOut: [0.25, 0.46, 0.45, 0.94],\n                    ease: [0.25, 0, 0.25, 1],\n                    linear: [0.25, 0.25, 0.75, 0.75],\n                    'ease-in': [0.42, 0, 1, 1],\n                    'ease-out': [0, 0, 0.58, 1],\n                    'ease-in-out': [0.42, 0, 0.58, 1]\n                };\n\n                // function for setting transition css for all browsers\n                var setStyle = function( elem, value, suffix ) {\n                    var css = {};\n                    suffix = suffix || 'transition';\n                    $.each( 'webkit moz ms o'.split(' '), function() {\n                        css[ '-' + this + '-' + suffix ] = value;\n                    });\n                    elem.css( css );\n                };\n\n                // clear styles\n                var clearStyle = function( elem ) {\n                    setStyle( elem, 'none', 'transition' );\n                    if ( Galleria.WEBKIT && Galleria.TOUCH ) {\n                        setStyle( elem, 'translate3d(0,0,0)', 'transform' );\n                        if ( elem.data('revert') ) {\n                            elem.css( elem.data('revert') );\n                            elem.data('revert', null);\n                        }\n                    }\n                };\n\n                // various variables\n                var change, strings, easing, syntax, revert, form, css;\n\n                // the actual animation method\n                return function( elem, to, options ) {\n\n                    // extend defaults\n                    options = $.extend({\n                        duration: 400,\n                        complete: F,\n                        stop: false\n                    }, options);\n\n                    // cache jQuery instance\n                    elem = $( elem );\n\n                    if ( !options.duration ) {\n                        elem.css( to );\n                        options.complete.call( elem[0] );\n                        return;\n                    }\n\n                    // fallback to jQuery's animate if transition is not supported\n                    if ( !transition ) {\n                        elem.animate(to, options);\n                        return;\n                    }\n\n                    // stop\n                    if ( options.stop ) {\n                        // clear the animation\n                        elem.off( endEvent );\n                        clearStyle( elem );\n                    }\n\n                    // see if there is a change\n                    change = false;\n                    $.each( to, function( key, val ) {\n                        css = elem.css( key );\n                        if ( Utils.parseValue( css ) != Utils.parseValue( val ) ) {\n                            change = true;\n                        }\n                        // also add computed styles for FF\n                        elem.css( key, css );\n                    });\n                    if ( !change ) {\n                        window.setTimeout( function() {\n                            options.complete.call( elem[0] );\n                        }, options.duration );\n                        return;\n                    }\n\n                    // the css strings to be applied\n                    strings = [];\n\n                    // the easing bezier\n                    easing = options.easing in easings ? easings[ options.easing ] : easings._default;\n\n                    // the syntax\n                    syntax = ' ' + options.duration + 'ms' + ' cubic-bezier('  + easing.join(',') + ')';\n\n                    // add a tiny timeout so that the browsers catches any css changes before animating\n                    window.setTimeout( (function(elem, endEvent, to, syntax) {\n                        return function() {\n\n                            // attach the end event\n                            elem.one(endEvent, (function( elem ) {\n                                return function() {\n\n                                    // clear the animation\n                                    clearStyle(elem);\n\n                                    // run the complete method\n                                    options.complete.call(elem[0]);\n                                };\n                            }( elem )));\n\n                            // do the webkit translate3d for better performance on iOS\n                            if( Galleria.WEBKIT && Galleria.TOUCH ) {\n\n                                revert = {};\n                                form = [0,0,0];\n\n                                $.each( ['left', 'top'], function(i, m) {\n                                    if ( m in to ) {\n                                        form[ i ] = ( Utils.parseValue( to[ m ] ) - Utils.parseValue(elem.css( m )) ) + 'px';\n                                        revert[ m ] = to[ m ];\n                                        delete to[ m ];\n                                    }\n                                });\n\n                                if ( form[0] || form[1]) {\n\n                                    elem.data('revert', revert);\n\n                                    strings.push('-webkit-transform' + syntax);\n\n                                    // 3d animate\n                                    setStyle( elem, 'translate3d(' + form.join(',') + ')', 'transform');\n                                }\n                            }\n\n                            // push the animation props\n                            $.each(to, function( p, val ) {\n                                strings.push(p + syntax);\n                            });\n\n                            // set the animation styles\n                            setStyle( elem, strings.join(',') );\n\n                            // animate\n                            elem.css( to );\n\n                        };\n                    }(elem, endEvent, to, syntax)), 2);\n                };\n            }()),\n\n            removeAlpha : function( elem ) {\n                if ( elem instanceof jQuery ) {\n                    elem = elem[0];\n                }\n                if ( IE < 9 && elem ) {\n\n                    var style = elem.style,\n                        currentStyle = elem.currentStyle,\n                        filter = currentStyle && currentStyle.filter || style.filter || \"\";\n\n                    if ( /alpha/.test( filter ) ) {\n                        style.filter = filter.replace( /alpha\\([^)]*\\)/i, '' );\n                    }\n                }\n            },\n\n            forceStyles : function( elem, styles ) {\n                elem = $(elem);\n                if ( elem.attr( 'style' ) ) {\n                    elem.data( 'styles', elem.attr( 'style' ) ).removeAttr( 'style' );\n                }\n                elem.css( styles );\n            },\n\n            revertStyles : function() {\n                $.each( Utils.array( arguments ), function( i, elem ) {\n\n                    elem = $( elem );\n                    elem.removeAttr( 'style' );\n\n                    elem.attr('style',''); // \"fixes\" webkit bug\n\n                    if ( elem.data( 'styles' ) ) {\n                        elem.attr( 'style', elem.data('styles') ).data( 'styles', null );\n                    }\n                });\n            },\n\n            moveOut : function( elem ) {\n                Utils.forceStyles( elem, {\n                    position: 'absolute',\n                    left: -10000\n                });\n            },\n\n            moveIn : function() {\n                Utils.revertStyles.apply( Utils, Utils.array( arguments ) );\n            },\n\n            hide : function( elem, speed, callback ) {\n\n                callback = callback || F;\n\n                var $elem = $(elem);\n                elem = $elem[0];\n\n                // save the value if not exist\n                if (! $elem.data('opacity') ) {\n                    $elem.data('opacity', $elem.css('opacity') );\n                }\n\n                // always hide\n                var style = { opacity: 0 };\n\n                if (speed) {\n\n                    var complete = IE < 9 && elem ? function() {\n                        Utils.removeAlpha( elem );\n                        elem.style.visibility = 'hidden';\n                        callback.call( elem );\n                    } : callback;\n\n                    Utils.animate( elem, style, {\n                        duration: speed,\n                        complete: complete,\n                        stop: true\n                    });\n                } else {\n                    if ( IE < 9 && elem ) {\n                        Utils.removeAlpha( elem );\n                        elem.style.visibility = 'hidden';\n                    } else {\n                        $elem.css( style );\n                    }\n                }\n            },\n\n            show : function( elem, speed, callback ) {\n\n                callback = callback || F;\n\n                var $elem = $(elem);\n                elem = $elem[0];\n\n                // bring back saved opacity\n                var saved = parseFloat( $elem.data('opacity') ) || 1,\n                    style = { opacity: saved };\n\n                // animate or toggle\n                if (speed) {\n\n                    if ( IE < 9 ) {\n                        $elem.css('opacity', 0);\n                        elem.style.visibility = 'visible';\n                    }\n\n                    var complete = IE < 9 && elem ? function() {\n                        if ( style.opacity == 1 ) {\n                            Utils.removeAlpha( elem );\n                        }\n                        callback.call( elem );\n                    } : callback;\n\n                    Utils.animate( elem, style, {\n                        duration: speed,\n                        complete: complete,\n                        stop: true\n                    });\n                } else {\n                    if ( IE < 9 && style.opacity == 1 && elem ) {\n                        Utils.removeAlpha( elem );\n                        elem.style.visibility = 'visible';\n                    } else {\n                        $elem.css( style );\n                    }\n                }\n            },\n\n            wait : function(options) {\n\n                Galleria._waiters = Galleria._waiters || [];\n\n                options = $.extend({\n                    until : FALSE,\n                    success : F,\n                    error : function() { Galleria.raise('Could not complete wait function.'); },\n                    timeout: 3000\n                }, options);\n\n                var start = Utils.timestamp(),\n                    elapsed,\n                    now,\n                    tid,\n                    fn = function() {\n                        now = Utils.timestamp();\n                        elapsed = now - start;\n                        Utils.removeFromArray( Galleria._waiters, tid );\n                        if ( options.until( elapsed ) ) {\n                            options.success();\n                            return false;\n                        }\n                        if (typeof options.timeout == 'number' && now >= start + options.timeout) {\n                            options.error();\n                            return false;\n                        }\n                        Galleria._waiters.push( tid = window.setTimeout(fn, 10) );\n                    };\n                Galleria._waiters.push( tid = window.setTimeout(fn, 10) );\n            },\n\n            toggleQuality : function( img, force ) {\n\n                if ( ( IE !== 7 && IE !== 8 ) || !img || img.nodeName.toUpperCase() != 'IMG' ) {\n                    return;\n                }\n\n                if ( typeof force === 'undefined' ) {\n                    force = img.style.msInterpolationMode === 'nearest-neighbor';\n                }\n\n                img.style.msInterpolationMode = force ? 'bicubic' : 'nearest-neighbor';\n            },\n\n            insertStyleTag : function( styles, id ) {\n\n                if ( id && $( '#'+id ).length ) {\n                    return;\n                }\n\n                var style = doc.createElement( 'style' );\n                if ( id ) {\n                    style.id = id;\n                }\n\n                DOM().head.appendChild( style );\n\n                if ( style.styleSheet ) { // IE\n                    style.styleSheet.cssText = styles;\n                } else {\n                    var cssText = doc.createTextNode( styles );\n                    style.appendChild( cssText );\n                }\n            },\n\n            // a loadscript method that works for local scripts\n            loadScript: function( url, callback ) {\n\n                var done = false,\n                    script = $('<scr'+'ipt>').attr({\n                        src: url,\n                        async: true\n                    }).get(0);\n\n               // Attach handlers for all browsers\n               script.onload = script.onreadystatechange = function() {\n                   if ( !done && (!this.readyState ||\n                       this.readyState === 'loaded' || this.readyState === 'complete') ) {\n\n                       done = true;\n\n                       // Handle memory leak in IE\n                       script.onload = script.onreadystatechange = null;\n\n                       if (typeof callback === 'function') {\n                           callback.call( this, this );\n                       }\n                   }\n               };\n\n               DOM().head.appendChild( script );\n            },\n\n            // parse anything into a number\n            parseValue: function( val ) {\n                if (typeof val === 'number') {\n                    return val;\n                } else if (typeof val === 'string') {\n                    var arr = val.match(/\\-?\\d|\\./g);\n                    return arr && arr.constructor === Array ? arr.join('')*1 : 0;\n                } else {\n                    return 0;\n                }\n            },\n\n            // timestamp abstraction\n            timestamp: function() {\n                return new Date().getTime();\n            },\n\n            loadCSS : function( href, id, callback ) {\n\n                var link,\n                    length;\n\n                // look for manual css\n                $('link[rel=stylesheet]').each(function() {\n                    if ( new RegExp( href ).test( this.href ) ) {\n                        link = this;\n                        return false;\n                    }\n                });\n\n                if ( typeof id === 'function' ) {\n                    callback = id;\n                    id = undef;\n                }\n\n                callback = callback || F; // dirty\n\n                // if already present, return\n                if ( link ) {\n                    callback.call( link, link );\n                    return link;\n                }\n\n                // save the length of stylesheets to check against\n                length = doc.styleSheets.length;\n\n                // check for existing id\n                if( $( '#' + id ).length ) {\n\n                    $( '#' + id ).attr( 'href', href );\n                    length--;\n\n                } else {\n                    link = $( '<link>' ).attr({\n                        rel: 'stylesheet',\n                        href: href,\n                        id: id\n                    }).get(0);\n\n                    var styles = $('link[rel=\"stylesheet\"], style');\n                    if ( styles.length ) {\n                        styles.get(0).parentNode.insertBefore( link, styles[0] );\n                    } else {\n                        DOM().head.appendChild( link );\n                    }\n\n                    if ( IE && length >= 31 ) {\n                        Galleria.raise( 'You have reached the browser stylesheet limit (31)', true );\n                        return;\n                    }\n                }\n\n                if ( typeof callback === 'function' ) {\n\n                    // First check for dummy element (new in 1.2.8)\n                    var $loader = $('<s>').attr( 'id', 'galleria-loader' ).hide().appendTo( DOM().body );\n\n                    Utils.wait({\n                        until: function() {\n                            return $loader.height() == 1;\n                        },\n                        success: function() {\n                            $loader.remove();\n                            callback.call( link, link );\n                        },\n                        error: function() {\n                            $loader.remove();\n\n                            // If failed, tell the dev to download the latest theme\n                            Galleria.raise( 'Theme CSS could not load after 20 sec. ' + ( Galleria.QUIRK ?\n                                'Your browser is in Quirks Mode, please add a correct doctype.' :\n                                'Please download the latest theme at http://galleria.io/customer/.' ), true );\n                        },\n                        timeout: 5000\n                    });\n                }\n                return link;\n            }\n        };\n    }()),\n\n    // play icon\n    _playIcon = function( container ) {\n\n        var css = '.galleria-videoicon{width:60px;height:60px;position:absolute;top:50%;left:50%;z-index:1;' +\n                  'margin:-30px 0 0 -30px;cursor:pointer;background:#000;background:rgba(0,0,0,.8);border-radius:3px;-webkit-transition:all 150ms}' +\n                  '.galleria-videoicon i{width:0px;height:0px;border-style:solid;border-width:10px 0 10px 16px;display:block;' +\n                  'border-color:transparent transparent transparent #ffffff;margin:20px 0 0 22px}.galleria-image:hover .galleria-videoicon{background:#000}';\n\n        Utils.insertStyleTag( css, 'galleria-videoicon' );\n\n        return $( Utils.create( 'galleria-videoicon' ) ).html( '<i></i>' ).appendTo( container )\n            .click( function() { $( this ).siblings( 'img' ).mouseup(); });\n    },\n\n    // the transitions holder\n    _transitions = (function() {\n\n        var _slide = function(params, complete, fade, door) {\n\n            var easing = this.getOptions('easing'),\n                distance = this.getStageWidth(),\n                from = { left: distance * ( params.rewind ? -1 : 1 ) },\n                to = { left: 0 };\n\n            if ( fade ) {\n                from.opacity = 0;\n                to.opacity = 1;\n            } else {\n                from.opacity = 1;\n            }\n\n            $(params.next).css(from);\n\n            Utils.animate(params.next, to, {\n                duration: params.speed,\n                complete: (function( elems ) {\n                    return function() {\n                        complete();\n                        elems.css({\n                            left: 0\n                        });\n                    };\n                }( $( params.next ).add( params.prev ) )),\n                queue: false,\n                easing: easing\n            });\n\n            if (door) {\n                params.rewind = !params.rewind;\n            }\n\n            if (params.prev) {\n\n                from = { left: 0 };\n                to = { left: distance * ( params.rewind ? 1 : -1 ) };\n\n                if ( fade ) {\n                    from.opacity = 1;\n                    to.opacity = 0;\n                }\n\n                $(params.prev).css(from);\n                Utils.animate(params.prev, to, {\n                    duration: params.speed,\n                    queue: false,\n                    easing: easing,\n                    complete: function() {\n                        $(this).css('opacity', 0);\n                    }\n                });\n            }\n        };\n\n        return {\n\n            active: false,\n\n            init: function( effect, params, complete ) {\n                if ( _transitions.effects.hasOwnProperty( effect ) ) {\n                    _transitions.effects[ effect ].call( this, params, complete );\n                }\n            },\n\n            effects: {\n\n                fade: function(params, complete) {\n                    $(params.next).css({\n                        opacity: 0,\n                        left: 0\n                    });\n                    Utils.animate(params.next, {\n                        opacity: 1\n                    },{\n                        duration: params.speed,\n                        complete: complete\n                    });\n                    if (params.prev) {\n                        $(params.prev).css('opacity',1).show();\n                        Utils.animate(params.prev, {\n                            opacity: 0\n                        },{\n                            duration: params.speed\n                        });\n                    }\n                },\n\n                flash: function(params, complete) {\n                    $(params.next).css({\n                        opacity: 0,\n                        left: 0\n                    });\n                    if (params.prev) {\n                        Utils.animate( params.prev, {\n                            opacity: 0\n                        },{\n                            duration: params.speed/2,\n                            complete: function() {\n                                Utils.animate( params.next, {\n                                    opacity:1\n                                },{\n                                    duration: params.speed,\n                                    complete: complete\n                                });\n                            }\n                        });\n                    } else {\n                        Utils.animate( params.next, {\n                            opacity: 1\n                        },{\n                            duration: params.speed,\n                            complete: complete\n                        });\n                    }\n                },\n\n                pulse: function(params, complete) {\n                    if (params.prev) {\n                        $(params.prev).hide();\n                    }\n                    $(params.next).css({\n                        opacity: 0,\n                        left: 0\n                    }).show();\n                    Utils.animate(params.next, {\n                        opacity:1\n                    },{\n                        duration: params.speed,\n                        complete: complete\n                    });\n                },\n\n                slide: function(params, complete) {\n                    _slide.apply( this, Utils.array( arguments ) );\n                },\n\n                fadeslide: function(params, complete) {\n                    _slide.apply( this, Utils.array( arguments ).concat( [true] ) );\n                },\n\n                doorslide: function(params, complete) {\n                    _slide.apply( this, Utils.array( arguments ).concat( [false, true] ) );\n                }\n            }\n        };\n    }());\n\n// listen to fullscreen\n_nativeFullscreen.listen();\n\n// create special click:fast event for fast touch interaction\n$.event.special['click:fast'] = {\n    propagate: true,\n    add: function(handleObj) {\n        var prop = this.propagate;\n        if ( Galleria.TOUCH ) {\n            $(this).on('touchstart.fast', function start(e) {\n                var ev = e.originalEvent,\n                    x, y, dist = 0;\n                if ( ev.touches.length == 1 ) {\n                    x = ev.touches[0].pageX;\n                    y = ev.touches[0].pageY;\n                    $(this).on('touchmove.fast', function(f) {\n                        var ft = f.originalEvent.touches;\n                        if ( ft.length == 1 ) {\n                            dist = M.max(\n                                M.abs( x - ft[0].pageX ),\n                                M.abs( y - ft[0].pageY )\n                            );\n                        }\n                    });\n                    $(this).on('touchend.fast', function() {\n                        if( dist > 4 ) {\n                            return $(this).off('touchend.fast touchmove.fast');\n                        }\n                        handleObj.handler.call(this, e);\n                        $(this).off('touchend.fast touchmove.fast');\n                    });\n                }\n            });\n        } else {\n            $(this).on('click.fast', handleObj.handler);\n        }\n    },\n    remove: function(handleObj) {\n        if ( Galleria.TOUCH ) {\n            $(this).off('touchstart.fast touchmove.fast touchend.fast');\n        } else {\n            $(this).off('click.fast', handleObj.handler);\n        }\n    }\n};\n\n// trigger resize on orientationchange (IOS7)\n$win.on( 'orientationchange', function() {\n    $(this).resize();\n});\n\n/**\n    The main Galleria class\n\n    @class\n    @constructor\n\n    @example var gallery = new Galleria();\n\n    @author http://aino.se\n\n    @requires jQuery\n\n*/\n\nGalleria = function() {\n\n    var self = this;\n\n    // internal options\n    this._options = {};\n\n    // flag for controlling play/pause\n    this._playing = false;\n\n    // internal interval for slideshow\n    this._playtime = 5000;\n\n    // internal variable for the currently active image\n    this._active = null;\n\n    // the internal queue, arrayified\n    this._queue = { length: 0 };\n\n    // the internal data array\n    this._data = [];\n\n    // the internal dom collection\n    this._dom = {};\n\n    // the internal thumbnails array\n    this._thumbnails = [];\n\n    // the internal layers array\n    this._layers = [];\n\n    // internal init flag\n    this._initialized = false;\n\n    // internal firstrun flag\n    this._firstrun = false;\n\n    // global stagewidth/height\n    this._stageWidth = 0;\n    this._stageHeight = 0;\n\n    // target holder\n    this._target = undef;\n\n    // bind hashes\n    this._binds = [];\n\n    // instance id\n    this._id = parseInt(M.random()*10000, 10);\n\n    // add some elements\n    var divs =  'container stage images image-nav image-nav-left image-nav-right ' +\n                'info info-text info-title info-description ' +\n                'thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right ' +\n                'loader counter tooltip',\n        spans = 'current total';\n\n    $.each( divs.split(' '), function( i, elemId ) {\n        self._dom[ elemId ] = Utils.create( 'galleria-' + elemId );\n    });\n\n    $.each( spans.split(' '), function( i, elemId ) {\n        self._dom[ elemId ] = Utils.create( 'galleria-' + elemId, 'span' );\n    });\n\n    // the internal keyboard object\n    // keeps reference of the keybinds and provides helper methods for binding keys\n    var keyboard = this._keyboard = {\n\n        keys : {\n            'UP': 38,\n            'DOWN': 40,\n            'LEFT': 37,\n            'RIGHT': 39,\n            'RETURN': 13,\n            'ESCAPE': 27,\n            'BACKSPACE': 8,\n            'SPACE': 32\n        },\n\n        map : {},\n\n        bound: false,\n\n        press: function(e) {\n            var key = e.keyCode || e.which;\n            if ( key in keyboard.map && typeof keyboard.map[key] === 'function' ) {\n                keyboard.map[key].call(self, e);\n            }\n        },\n\n        attach: function(map) {\n\n            var key, up;\n\n            for( key in map ) {\n                if ( map.hasOwnProperty( key ) ) {\n                    up = key.toUpperCase();\n                    if ( up in keyboard.keys ) {\n                        keyboard.map[ keyboard.keys[up] ] = map[key];\n                    } else {\n                        keyboard.map[ up ] = map[key];\n                    }\n                }\n            }\n            if ( !keyboard.bound ) {\n                keyboard.bound = true;\n                $doc.on('keydown', keyboard.press);\n            }\n        },\n\n        detach: function() {\n            keyboard.bound = false;\n            keyboard.map = {};\n            $doc.off('keydown', keyboard.press);\n        }\n    };\n\n    // internal controls for keeping track of active / inactive images\n    var controls = this._controls = {\n\n        0: undef,\n\n        1: undef,\n\n        active : 0,\n\n        swap : function() {\n            controls.active = controls.active ? 0 : 1;\n        },\n\n        getActive : function() {\n            return self._options.swipe ? controls.slides[ self._active ] : controls[ controls.active ];\n        },\n\n        getNext : function() {\n            return self._options.swipe ? controls.slides[ self.getNext( self._active ) ] : controls[ 1 - controls.active ];\n        },\n\n        slides : [],\n\n        frames: [],\n\n        layers: []\n    };\n\n    // internal carousel object\n    var carousel = this._carousel = {\n\n        // shortcuts\n        next: self.$('thumb-nav-right'),\n        prev: self.$('thumb-nav-left'),\n\n        // cache the width\n        width: 0,\n\n        // track the current position\n        current: 0,\n\n        // cache max value\n        max: 0,\n\n        // save all hooks for each width in an array\n        hooks: [],\n\n        // update the carousel\n        // you can run this method anytime, f.ex on window.resize\n        update: function() {\n            var w = 0,\n                h = 0,\n                hooks = [0];\n\n            $.each( self._thumbnails, function( i, thumb ) {\n                if ( thumb.ready ) {\n                    w += thumb.outerWidth || $( thumb.container ).outerWidth( true );\n                    // Due to a bug in jquery, outerwidth() returns the floor of the actual outerwidth,\n                    // if the browser is zoom to a value other than 100%. height() returns the floating point value.\n                    var containerWidth = $( thumb.container).width();\n                    w += containerWidth - M.floor(containerWidth);\n\n                    hooks[ i+1 ] = w;\n                    h = M.max( h, thumb.outerHeight || $( thumb.container).outerHeight( true ) );\n                }\n            });\n\n            self.$( 'thumbnails' ).css({\n                width: w,\n                height: h\n            });\n\n            carousel.max = w;\n            carousel.hooks = hooks;\n            carousel.width = self.$( 'thumbnails-list' ).width();\n            carousel.setClasses();\n\n            self.$( 'thumbnails-container' ).toggleClass( 'galleria-carousel', w > carousel.width );\n\n            // one extra calculation\n            carousel.width = self.$( 'thumbnails-list' ).width();\n\n            // todo: fix so the carousel moves to the left\n        },\n\n        bindControls: function() {\n\n            var i;\n\n            carousel.next.on( 'click:fast', function(e) {\n                e.preventDefault();\n\n                if ( self._options.carouselSteps === 'auto' ) {\n\n                    for ( i = carousel.current; i < carousel.hooks.length; i++ ) {\n                        if ( carousel.hooks[i] - carousel.hooks[ carousel.current ] > carousel.width ) {\n                            carousel.set(i - 2);\n                            break;\n                        }\n                    }\n\n                } else {\n                    carousel.set( carousel.current + self._options.carouselSteps);\n                }\n            });\n\n            carousel.prev.on( 'click:fast', function(e) {\n                e.preventDefault();\n\n                if ( self._options.carouselSteps === 'auto' ) {\n\n                    for ( i = carousel.current; i >= 0; i-- ) {\n                        if ( carousel.hooks[ carousel.current ] - carousel.hooks[i] > carousel.width ) {\n                            carousel.set( i + 2 );\n                            break;\n                        } else if ( i === 0 ) {\n                            carousel.set( 0 );\n                            break;\n                        }\n                    }\n                } else {\n                    carousel.set( carousel.current - self._options.carouselSteps );\n                }\n            });\n        },\n\n        // calculate and set positions\n        set: function( i ) {\n            i = M.max( i, 0 );\n            while ( carousel.hooks[i - 1] + carousel.width >= carousel.max && i >= 0 ) {\n                i--;\n            }\n            carousel.current = i;\n            carousel.animate();\n        },\n\n        // get the last position\n        getLast: function(i) {\n            return ( i || carousel.current ) - 1;\n        },\n\n        // follow the active image\n        follow: function(i) {\n\n            //don't follow if position fits\n            if ( i === 0 || i === carousel.hooks.length - 2 ) {\n                carousel.set( i );\n                return;\n            }\n\n            // calculate last position\n            var last = carousel.current;\n            while( carousel.hooks[last] - carousel.hooks[ carousel.current ] <\n                   carousel.width && last <= carousel.hooks.length ) {\n                last ++;\n            }\n\n            // set position\n            if ( i - 1 < carousel.current ) {\n                carousel.set( i - 1 );\n            } else if ( i + 2 > last) {\n                carousel.set( i - last + carousel.current + 2 );\n            }\n        },\n\n        // helper for setting disabled classes\n        setClasses: function() {\n            carousel.prev.toggleClass( 'disabled', !carousel.current );\n            carousel.next.toggleClass( 'disabled', carousel.hooks[ carousel.current ] + carousel.width >= carousel.max );\n        },\n\n        // the animation method\n        animate: function(to) {\n            carousel.setClasses();\n            var num = carousel.hooks[ carousel.current ] * -1;\n\n            if ( isNaN( num ) ) {\n                return;\n            }\n\n            // FF 24 bug\n            self.$( 'thumbnails' ).css('left', function() {\n                return $(this).css('left');\n            });\n\n            Utils.animate(self.get( 'thumbnails' ), {\n                left: num\n            },{\n                duration: self._options.carouselSpeed,\n                easing: self._options.easing,\n                queue: false\n            });\n        }\n    };\n\n    // tooltip control\n    // added in 1.2\n    var tooltip = this._tooltip = {\n\n        initialized : false,\n\n        open: false,\n\n        timer: 'tooltip' + self._id,\n\n        swapTimer: 'swap' + self._id,\n\n        init: function() {\n\n            tooltip.initialized = true;\n\n            var css = '.galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3;' +\n                      'opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}';\n\n            Utils.insertStyleTag( css, 'galleria-tooltip' );\n\n            self.$( 'tooltip' ).css({\n                opacity: 0.8,\n                visibility: 'visible',\n                display: 'none'\n            });\n\n        },\n\n        // move handler\n        move: function( e ) {\n            var mouseX = self.getMousePosition(e).x,\n                mouseY = self.getMousePosition(e).y,\n                $elem = self.$( 'tooltip' ),\n                x = mouseX,\n                y = mouseY,\n                height = $elem.outerHeight( true ) + 1,\n                width = $elem.outerWidth( true ),\n                limitY = height + 15;\n\n            var maxX = self.$( 'container' ).width() - width - 2,\n                maxY = self.$( 'container' ).height() - height - 2;\n\n            if ( !isNaN(x) && !isNaN(y) ) {\n\n                x += 10;\n                y -= ( height+8 );\n\n                x = M.max( 0, M.min( maxX, x ) );\n                y = M.max( 0, M.min( maxY, y ) );\n\n                if( mouseY < limitY ) {\n                    y = limitY;\n                }\n\n                $elem.css({ left: x, top: y });\n            }\n        },\n\n        // bind elements to the tooltip\n        // you can bind multiple elementIDs using { elemID : function } or { elemID : string }\n        // you can also bind single DOM elements using bind(elem, string)\n        bind: function( elem, value ) {\n\n            // todo: revise if alternative tooltip is needed for mobile devices\n            if (Galleria.TOUCH) {\n                return;\n            }\n\n            if (! tooltip.initialized ) {\n                tooltip.init();\n            }\n\n            var mouseout = function() {\n                self.$( 'container' ).off( 'mousemove', tooltip.move );\n                self.clearTimer( tooltip.timer );\n\n                self.$( 'tooltip' ).stop().animate({\n                    opacity: 0\n                }, 200, function() {\n\n                    self.$( 'tooltip' ).hide();\n\n                    self.addTimer( tooltip.swapTimer, function() {\n                        tooltip.open = false;\n                    }, 1000);\n                });\n            };\n\n            var hover = function( elem, value) {\n\n                tooltip.define( elem, value );\n\n                $( elem ).hover(function() {\n\n                    self.clearTimer( tooltip.swapTimer );\n                    self.$('container').off( 'mousemove', tooltip.move ).on( 'mousemove', tooltip.move ).trigger( 'mousemove' );\n                    tooltip.show( elem );\n\n                    self.addTimer( tooltip.timer, function() {\n                        self.$( 'tooltip' ).stop().show().animate({\n                            opacity: 1\n                        });\n                        tooltip.open = true;\n\n                    }, tooltip.open ? 0 : 500);\n\n                }, mouseout).click(mouseout);\n            };\n\n            if ( typeof value === 'string' ) {\n                hover( ( elem in self._dom ? self.get( elem ) : elem ), value );\n            } else {\n                // asume elemID here\n                $.each( elem, function( elemID, val ) {\n                    hover( self.get(elemID), val );\n                });\n            }\n        },\n\n        show: function( elem ) {\n\n            elem = $( elem in self._dom ? self.get(elem) : elem );\n\n            var text = elem.data( 'tt' ),\n                mouseup = function( e ) {\n\n                    // attach a tiny settimeout to make sure the new tooltip is filled\n                    window.setTimeout( (function( ev ) {\n                        return function() {\n                            tooltip.move( ev );\n                        };\n                    }( e )), 10);\n\n                    elem.off( 'mouseup', mouseup );\n\n                };\n\n            text = typeof text === 'function' ? text() : text;\n\n            if ( ! text ) {\n                return;\n            }\n\n            self.$( 'tooltip' ).html( text.replace(/\\s/, '&#160;') );\n\n            // trigger mousemove on mouseup in case of click\n            elem.on( 'mouseup', mouseup );\n        },\n\n        define: function( elem, value ) {\n\n            // we store functions, not strings\n            if (typeof value !== 'function') {\n                var s = value;\n                value = function() {\n                    return s;\n                };\n            }\n\n            elem = $( elem in self._dom ? self.get(elem) : elem ).data('tt', value);\n\n            tooltip.show( elem );\n\n        }\n    };\n\n    // internal fullscreen control\n    var fullscreen = this._fullscreen = {\n\n        scrolled: 0,\n\n        crop: undef,\n\n        active: false,\n\n        prev: $(),\n\n        beforeEnter: function(fn){ fn(); },\n        beforeExit:  function(fn){ fn(); },\n\n        keymap: self._keyboard.map,\n\n        parseCallback: function( callback, enter ) {\n\n            return _transitions.active ? function() {\n                if ( typeof callback == 'function' ) {\n                    callback.call(self);\n                }\n                var active = self._controls.getActive(),\n                    next = self._controls.getNext();\n\n                self._scaleImage( next );\n                self._scaleImage( active );\n\n                if ( enter && self._options.trueFullscreen ) {\n                    // Firefox bug, revise later\n                    $( active.container ).add( next.container ).trigger( 'transitionend' );\n                }\n\n            } : callback;\n\n        },\n\n        enter: function( callback ) {\n\n            fullscreen.beforeEnter(function() {\n\n                callback = fullscreen.parseCallback( callback, true );\n\n                if ( self._options.trueFullscreen && _nativeFullscreen.support ) {\n\n                    // do some stuff prior animation for wmoother transitions\n\n                    fullscreen.active = true;\n\n                    Utils.forceStyles( self.get('container'), {\n                        width: '100%',\n                        height: '100%'\n                    });\n\n                    self.rescale();\n\n                    if ( Galleria.MAC ) {\n                        if ( !( Galleria.SAFARI && /version\\/[1-5]/.test(NAV)) ) {\n                            self.$('container').css('opacity', 0).addClass('fullscreen');\n                            window.setTimeout(function() {\n                                fullscreen.scale();\n                                self.$('container').css('opacity', 1);\n                            }, 50);\n                        } else {\n                            self.$('stage').css('opacity', 0);\n                            window.setTimeout(function() {\n                                fullscreen.scale();\n                                self.$('stage').css('opacity', 1);\n                            },4);\n                        }\n                    } else {\n                        self.$('container').addClass('fullscreen');\n                    }\n\n                    $win.resize( fullscreen.scale );\n\n                    _nativeFullscreen.enter( self, callback, self.get('container') );\n\n                } else {\n\n                    fullscreen.scrolled = $win.scrollTop();\n                    if( !Galleria.TOUCH ) {\n                        window.scrollTo(0, 0);\n                    }\n\n                    fullscreen._enter( callback );\n                }\n            });\n\n        },\n\n        _enter: function( callback ) {\n\n            fullscreen.active = true;\n\n            if ( IFRAME ) {\n\n                fullscreen.iframe = (function() {\n\n                    var elem,\n                        refer = doc.referrer,\n                        test = doc.createElement('a'),\n                        loc = window.location;\n\n                    test.href = refer;\n\n                    if( test.protocol != loc.protocol ||\n                        test.hostname != loc.hostname ||\n                        test.port != loc.port ) {\n                            Galleria.raise('Parent fullscreen not available. Iframe protocol, domains and ports must match.');\n                            return false;\n                        }\n\n                    fullscreen.pd = window.parent.document;\n\n                    $( fullscreen.pd ).find('iframe').each(function() {\n                        var idoc = this.contentDocument || this.contentWindow.document;\n                        if ( idoc === doc ) {\n                            elem = this;\n                            return false;\n                        }\n                    });\n\n                    return elem;\n                }());\n\n            }\n\n            // hide the image until rescale is complete\n            Utils.hide( self.getActiveImage() );\n\n            if ( IFRAME && fullscreen.iframe ) {\n                fullscreen.iframe.scrolled = $( window.parent ).scrollTop();\n                window.parent.scrollTo(0, 0);\n            }\n\n            var data = self.getData(),\n                options = self._options,\n                inBrowser = !self._options.trueFullscreen || !_nativeFullscreen.support,\n                htmlbody = {\n                    height: '100%',\n                    overflow: 'hidden',\n                    margin:0,\n                    padding:0\n                };\n\n            if (inBrowser) {\n\n                self.$('container').addClass('fullscreen');\n                fullscreen.prev = self.$('container').prev();\n\n                if ( !fullscreen.prev.length ) {\n                    fullscreen.parent = self.$( 'container' ).parent();\n                }\n\n                // move\n                self.$( 'container' ).appendTo( 'body' );\n\n                // begin styleforce\n\n                Utils.forceStyles(self.get('container'), {\n                    position: Galleria.TOUCH ? 'absolute' : 'fixed',\n                    top: 0,\n                    left: 0,\n                    width: '100%',\n                    height: '100%',\n                    zIndex: 10000\n                });\n                Utils.forceStyles( DOM().html, htmlbody );\n                Utils.forceStyles( DOM().body, htmlbody );\n            }\n\n            if ( IFRAME && fullscreen.iframe ) {\n                Utils.forceStyles( fullscreen.pd.documentElement, htmlbody );\n                Utils.forceStyles( fullscreen.pd.body, htmlbody );\n                Utils.forceStyles( fullscreen.iframe, $.extend( htmlbody, {\n                    width: '100%',\n                    height: '100%',\n                    top: 0,\n                    left: 0,\n                    position: 'fixed',\n                    zIndex: 10000,\n                    border: 'none'\n                }));\n            }\n\n            // temporarily attach some keys\n            // save the old ones first in a cloned object\n            fullscreen.keymap = $.extend({}, self._keyboard.map);\n\n            self.attachKeyboard({\n                escape: self.exitFullscreen,\n                right: self.next,\n                left: self.prev\n            });\n\n            // temporarily save the crop\n            fullscreen.crop = options.imageCrop;\n\n            // set fullscreen options\n            if ( options.fullscreenCrop != undef ) {\n                options.imageCrop = options.fullscreenCrop;\n            }\n\n            // swap to big image if it's different from the display image\n            if ( data && data.big && data.image !== data.big ) {\n                var big    = new Galleria.Picture(),\n                    cached = big.isCached( data.big ),\n                    index  = self.getIndex(),\n                    thumb  = self._thumbnails[ index ];\n\n                self.trigger( {\n                    type: Galleria.LOADSTART,\n                    cached: cached,\n                    rewind: false,\n                    index: index,\n                    imageTarget: self.getActiveImage(),\n                    thumbTarget: thumb,\n                    galleriaData: data\n                });\n\n                big.load( data.big, function( big ) {\n                    self._scaleImage( big, {\n                        complete: function( big ) {\n                            self.trigger({\n                                type: Galleria.LOADFINISH,\n                                cached: cached,\n                                index: index,\n                                rewind: false,\n                                imageTarget: big.image,\n                                thumbTarget: thumb\n                            });\n                            var image = self._controls.getActive().image;\n                            if ( image ) {\n                                $( image ).width( big.image.width ).height( big.image.height )\n                                    .attr( 'style', $( big.image ).attr('style') )\n                                    .attr( 'src', big.image.src );\n                            }\n                        }\n                    });\n                });\n            }\n\n            // init the first rescale and attach callbacks\n\n            self.rescale(function() {\n\n                self.addTimer(false, function() {\n                    // show the image after 50 ms\n                    if ( inBrowser ) {\n                        Utils.show( self.getActiveImage() );\n                    }\n\n                    if (typeof callback === 'function') {\n                        callback.call( self );\n                    }\n                    self.rescale();\n\n                }, 100);\n\n                self.trigger( Galleria.FULLSCREEN_ENTER );\n            });\n\n            if ( !inBrowser ) {\n                Utils.show( self.getActiveImage() );\n            } else {\n                $win.resize( fullscreen.scale );\n            }\n\n        },\n\n        scale : function() {\n            self.rescale();\n        },\n\n        exit: function( callback ) {\n\n            fullscreen.beforeExit(function() {\n\n                callback = fullscreen.parseCallback( callback );\n\n                if ( self._options.trueFullscreen && _nativeFullscreen.support ) {\n                    _nativeFullscreen.exit( callback );\n                } else {\n                    fullscreen._exit( callback );\n                }\n            });\n        },\n\n        _exit: function( callback ) {\n\n            fullscreen.active = false;\n\n            var inBrowser = !self._options.trueFullscreen || !_nativeFullscreen.support,\n                $container = self.$( 'container' ).removeClass( 'fullscreen' );\n\n            // move back\n            if ( fullscreen.parent ) {\n                fullscreen.parent.prepend( $container );\n            } else {\n                $container.insertAfter( fullscreen.prev );\n            }\n\n            if ( inBrowser ) {\n                Utils.hide( self.getActiveImage() );\n\n                // revert all styles\n                Utils.revertStyles( self.get('container'), DOM().html, DOM().body );\n\n                // scroll back\n                if( !Galleria.TOUCH ) {\n                    window.scrollTo(0, fullscreen.scrolled);\n                }\n\n                // reload iframe src manually\n                var frame = self._controls.frames[ self._controls.active ];\n                if ( frame && frame.image ) {\n                    frame.image.src = frame.image.src;\n                }\n            }\n\n            if ( IFRAME && fullscreen.iframe ) {\n                Utils.revertStyles( fullscreen.pd.documentElement, fullscreen.pd.body, fullscreen.iframe );\n                if ( fullscreen.iframe.scrolled ) {\n                    window.parent.scrollTo(0, fullscreen.iframe.scrolled );\n                }\n            }\n\n            // detach all keyboard events and apply the old keymap\n            self.detachKeyboard();\n            self.attachKeyboard( fullscreen.keymap );\n\n            // bring back cached options\n            self._options.imageCrop = fullscreen.crop;\n\n            // return to original image\n            var big = self.getData().big,\n                image = self._controls.getActive().image;\n\n            if ( !self.getData().iframe && image && big && big == image.src ) {\n\n                window.setTimeout(function(src) {\n                    return function() {\n                        image.src = src;\n                    };\n                }( self.getData().image ), 1 );\n\n            }\n\n            self.rescale(function() {\n                self.addTimer(false, function() {\n\n                    // show the image after 50 ms\n                    if ( inBrowser ) {\n                        Utils.show( self.getActiveImage() );\n                    }\n\n                    if ( typeof callback === 'function' ) {\n                        callback.call( self );\n                    }\n\n                    $win.trigger( 'resize' );\n\n                }, 50);\n                self.trigger( Galleria.FULLSCREEN_EXIT );\n            });\n\n            $win.off('resize', fullscreen.scale);\n        }\n    };\n\n    // the internal idle object for controlling idle states\n    var idle = this._idle = {\n\n        trunk: [],\n\n        bound: false,\n\n        active: false,\n\n        add: function(elem, to, from, hide) {\n            if (!elem) {\n                return;\n            }\n            if (!idle.bound) {\n                idle.addEvent();\n            }\n            elem = $(elem);\n\n            if ( typeof from == 'boolean' ) {\n                hide = from;\n                from = {};\n            }\n\n            from = from || {};\n\n            var extract = {},\n                style;\n\n            for ( style in to ) {\n                if ( to.hasOwnProperty( style ) ) {\n                    extract[ style ] = elem.css( style );\n                }\n            }\n\n            elem.data('idle', {\n                from: $.extend( extract, from ),\n                to: to,\n                complete: true,\n                busy: false\n            });\n\n            if ( !hide ) {\n                idle.addTimer();\n            } else {\n                elem.css( to );\n            }\n            idle.trunk.push(elem);\n        },\n\n        remove: function(elem) {\n\n            elem = $(elem);\n\n            $.each(idle.trunk, function(i, el) {\n                if ( el && el.length && !el.not(elem).length ) {\n                    elem.css( elem.data( 'idle' ).from );\n                    idle.trunk.splice(i, 1);\n                }\n            });\n\n            if (!idle.trunk.length) {\n                idle.removeEvent();\n                self.clearTimer( idle.timer );\n            }\n        },\n\n        addEvent : function() {\n            idle.bound = true;\n            self.$('container').on( 'mousemove click', idle.showAll );\n            if ( self._options.idleMode == 'hover' ) {\n                self.$('container').on( 'mouseleave', idle.hide );\n            }\n        },\n\n        removeEvent : function() {\n            idle.bound = false;\n            self.$('container').on( 'mousemove click', idle.showAll );\n            if ( self._options.idleMode == 'hover' ) {\n                self.$('container').off( 'mouseleave', idle.hide );\n            }\n        },\n\n        addTimer : function() {\n            if( self._options.idleMode == 'hover' ) {\n                return;\n            }\n            self.addTimer( 'idle', function() {\n                idle.hide();\n            }, self._options.idleTime );\n        },\n\n        hide : function() {\n\n            if ( !self._options.idleMode || self.getIndex() === false ) {\n                return;\n            }\n\n            self.trigger( Galleria.IDLE_ENTER );\n\n            var len = idle.trunk.length;\n\n            $.each( idle.trunk, function(i, elem) {\n\n                var data = elem.data('idle');\n\n                if (! data) {\n                    return;\n                }\n\n                elem.data('idle').complete = false;\n\n                Utils.animate( elem, data.to, {\n                    duration: self._options.idleSpeed,\n                    complete: function() {\n                        if ( i == len-1 ) {\n                            idle.active = false;\n                        }\n                    }\n                });\n            });\n        },\n\n        showAll : function() {\n\n            self.clearTimer( 'idle' );\n\n            $.each( idle.trunk, function( i, elem ) {\n                idle.show( elem );\n            });\n        },\n\n        show: function(elem) {\n\n            var data = elem.data('idle');\n\n            if ( !idle.active || ( !data.busy && !data.complete ) ) {\n\n                data.busy = true;\n\n                self.trigger( Galleria.IDLE_EXIT );\n\n                self.clearTimer( 'idle' );\n\n                Utils.animate( elem, data.from, {\n                    duration: self._options.idleSpeed/2,\n                    complete: function() {\n                        idle.active = true;\n                        $(elem).data('idle').busy = false;\n                        $(elem).data('idle').complete = true;\n                    }\n                });\n\n            }\n            idle.addTimer();\n        }\n    };\n\n    // internal lightbox object\n    // creates a predesigned lightbox for simple popups of images in galleria\n    var lightbox = this._lightbox = {\n\n        width : 0,\n\n        height : 0,\n\n        initialized : false,\n\n        active : null,\n\n        image : null,\n\n        elems : {},\n\n        keymap: false,\n\n        init : function() {\n\n            if ( lightbox.initialized ) {\n                return;\n            }\n            lightbox.initialized = true;\n\n            // create some elements to work with\n            var elems = 'overlay box content shadow title info close prevholder prev nextholder next counter image',\n                el = {},\n                op = self._options,\n                css = '',\n                abs = 'position:absolute;',\n                prefix = 'lightbox-',\n                cssMap = {\n                    overlay:    'position:fixed;display:none;opacity:'+op.overlayOpacity+';filter:alpha(opacity='+(op.overlayOpacity*100)+\n                                ');top:0;left:0;width:100%;height:100%;background:'+op.overlayBackground+';z-index:99990',\n                    box:        'position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991',\n                    shadow:     abs+'background:#000;width:100%;height:100%;',\n                    content:    abs+'background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden',\n                    info:       abs+'bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px',\n                    close:      abs+'top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999',\n                    image:      abs+'top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;',\n                    prevholder: abs+'width:50%;top:0;bottom:40px;cursor:pointer;',\n                    nextholder: abs+'width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;',\n                    prev:       abs+'top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif',\n                    next:       abs+'top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000',\n                    title:      'float:left',\n                    counter:    'float:right;margin-left:8px;'\n                },\n                hover = function(elem) {\n                    return elem.hover(\n                        function() { $(this).css( 'color', '#bbb' ); },\n                        function() { $(this).css( 'color', '#444' ); }\n                    );\n                },\n                appends = {};\n\n            // IE8 fix for IE's transparent background event \"feature\"\n            if ( IE && IE > 7 ) {\n                cssMap.nextholder += 'background:#000;filter:alpha(opacity=0);';\n                cssMap.prevholder += 'background:#000;filter:alpha(opacity=0);';\n            }\n\n            // create and insert CSS\n            $.each(cssMap, function( key, value ) {\n                css += '.galleria-'+prefix+key+'{'+value+'}';\n            });\n\n            css += '.galleria-'+prefix+'box.iframe .galleria-'+prefix+'prevholder,'+\n                   '.galleria-'+prefix+'box.iframe .galleria-'+prefix+'nextholder{'+\n                   'width:100px;height:100px;top:50%;margin-top:-70px}';\n\n            Utils.insertStyleTag( css, 'galleria-lightbox' );\n\n            // create the elements\n            $.each(elems.split(' '), function( i, elemId ) {\n                self.addElement( 'lightbox-' + elemId );\n                el[ elemId ] = lightbox.elems[ elemId ] = self.get( 'lightbox-' + elemId );\n            });\n\n            // initiate the image\n            lightbox.image = new Galleria.Picture();\n\n            // append the elements\n            $.each({\n                    box: 'shadow content close prevholder nextholder',\n                    info: 'title counter',\n                    content: 'info image',\n                    prevholder: 'prev',\n                    nextholder: 'next'\n                }, function( key, val ) {\n                    var arr = [];\n                    $.each( val.split(' '), function( i, prop ) {\n                        arr.push( prefix + prop );\n                    });\n                    appends[ prefix+key ] = arr;\n            });\n\n            self.append( appends );\n\n            $( el.image ).append( lightbox.image.container );\n\n            $( DOM().body ).append( el.overlay, el.box );\n\n            // add the prev/next nav and bind some controls\n\n            hover( $( el.close ).on( 'click:fast', lightbox.hide ).html('&#215;') );\n\n            $.each( ['Prev','Next'], function(i, dir) {\n\n                var $d = $( el[ dir.toLowerCase() ] ).html( /v/.test( dir ) ? '&#8249;&#160;' : '&#160;&#8250;' ),\n                    $e = $( el[ dir.toLowerCase()+'holder'] );\n\n                $e.on( 'click:fast', function() {\n                    lightbox[ 'show' + dir ]();\n                });\n\n                // IE7 and touch devices will simply show the nav\n                if ( IE < 8 || Galleria.TOUCH ) {\n                    $d.show();\n                    return;\n                }\n\n                $e.hover( function() {\n                    $d.show();\n                }, function(e) {\n                    $d.stop().fadeOut( 200 );\n                });\n\n            });\n            $( el.overlay ).on( 'click:fast', lightbox.hide );\n\n            // the lightbox animation is slow on ipad\n            if ( Galleria.IPAD ) {\n                self._options.lightboxTransitionSpeed = 0;\n            }\n\n        },\n\n        rescale: function(event) {\n\n            // calculate\n             var width = M.min( $win.width()-40, lightbox.width ),\n                height = M.min( $win.height()-60, lightbox.height ),\n                ratio = M.min( width / lightbox.width, height / lightbox.height ),\n                destWidth = M.round( lightbox.width * ratio ) + 40,\n                destHeight = M.round( lightbox.height * ratio ) + 60,\n                to = {\n                    width: destWidth,\n                    height: destHeight,\n                    'margin-top': M.ceil( destHeight / 2 ) *- 1,\n                    'margin-left': M.ceil( destWidth / 2 ) *- 1\n                };\n\n            // if rescale event, don't animate\n            if ( event ) {\n                $( lightbox.elems.box ).css( to );\n            } else {\n                $( lightbox.elems.box ).animate( to, {\n                    duration: self._options.lightboxTransitionSpeed,\n                    easing: self._options.easing,\n                    complete: function() {\n                        var image = lightbox.image,\n                            speed = self._options.lightboxFadeSpeed;\n\n                        self.trigger({\n                            type: Galleria.LIGHTBOX_IMAGE,\n                            imageTarget: image.image\n                        });\n\n                        $( image.container ).show();\n\n                        $( image.image ).animate({ opacity: 1 }, speed);\n                        Utils.show( lightbox.elems.info, speed );\n                    }\n                });\n            }\n        },\n\n        hide: function() {\n\n            // remove the image\n            lightbox.image.image = null;\n\n            $win.off('resize', lightbox.rescale);\n\n            $( lightbox.elems.box ).hide().find( 'iframe' ).remove();\n\n            Utils.hide( lightbox.elems.info );\n\n            self.detachKeyboard();\n            self.attachKeyboard( lightbox.keymap );\n\n            lightbox.keymap = false;\n\n            Utils.hide( lightbox.elems.overlay, 200, function() {\n                $( this ).hide().css( 'opacity', self._options.overlayOpacity );\n                self.trigger( Galleria.LIGHTBOX_CLOSE );\n            });\n        },\n\n        showNext: function() {\n            lightbox.show( self.getNext( lightbox.active ) );\n        },\n\n        showPrev: function() {\n            lightbox.show( self.getPrev( lightbox.active ) );\n        },\n\n        show: function(index) {\n\n            lightbox.active = index = typeof index === 'number' ? index : self.getIndex() || 0;\n\n            if ( !lightbox.initialized ) {\n                lightbox.init();\n            }\n\n            // trigger the event\n            self.trigger( Galleria.LIGHTBOX_OPEN );\n\n            // temporarily attach some keys\n            // save the old ones first in a cloned object\n            if ( !lightbox.keymap ) {\n\n                lightbox.keymap = $.extend({}, self._keyboard.map);\n\n                self.attachKeyboard({\n                    escape: lightbox.hide,\n                    right: lightbox.showNext,\n                    left: lightbox.showPrev\n                });\n            }\n\n            $win.off('resize', lightbox.rescale );\n\n            var data = self.getData(index),\n                total = self.getDataLength(),\n                n = self.getNext( index ),\n                ndata, p, i;\n\n            Utils.hide( lightbox.elems.info );\n\n            try {\n                for ( i = self._options.preload; i > 0; i-- ) {\n                    p = new Galleria.Picture();\n                    ndata = self.getData( n );\n                    p.preload( ndata.big ? ndata.big : ndata.image );\n                    n = self.getNext( n );\n                }\n            } catch(e) {}\n\n            lightbox.image.isIframe = ( data.iframe && !data.image );\n\n            $( lightbox.elems.box ).toggleClass( 'iframe', lightbox.image.isIframe );\n\n            $( lightbox.image.container ).find( '.galleria-videoicon' ).remove();\n\n            lightbox.image.load( data.big || data.image || data.iframe, function( image ) {\n\n                if ( image.isIframe ) {\n\n                    var cw = $(window).width(),\n                        ch = $(window).height();\n\n                    if ( image.video && self._options.maxVideoSize ) {\n                        var r = M.min( self._options.maxVideoSize/cw, self._options.maxVideoSize/ch );\n                        if ( r < 1 ) {\n                            cw *= r;\n                            ch *= r;\n                        }\n                    }\n                    lightbox.width = cw;\n                    lightbox.height = ch;\n\n                } else {\n                    lightbox.width = image.original.width;\n                    lightbox.height = image.original.height;\n                }\n\n                $( image.image ).css({\n                    width: image.isIframe ? '100%' : '100.1%',\n                    height: image.isIframe ? '100%' : '100.1%',\n                    top: 0,\n                    bottom: 0,\n                    zIndex: 99998,\n                    opacity: 0,\n                    visibility: 'visible'\n                }).parent().height('100%');\n\n                lightbox.elems.title.innerHTML = data.title || '';\n                lightbox.elems.counter.innerHTML = (index + 1) + ' / ' + total;\n                $win.resize( lightbox.rescale );\n                lightbox.rescale();\n\n                if( data.image && data.iframe ) {\n\n                    $( lightbox.elems.box ).addClass('iframe');\n\n                    if ( data.video ) {\n                        var $icon = _playIcon( image.container ).hide();\n                        window.setTimeout(function() {\n                            $icon.fadeIn(200);\n                        }, 200);\n                    }\n\n                    $( image.image ).css( 'cursor', 'pointer' ).mouseup((function(data, image) {\n                        return function(e) {\n                            $( lightbox.image.container ).find( '.galleria-videoicon' ).remove();\n                            e.preventDefault();\n                            image.isIframe = true;\n                            image.load( data.iframe + ( data.video ? '&autoplay=1' : '' ), {\n                                width: '100%',\n                                height: IE < 8 ? $( lightbox.image.container ).height() : '100%'\n                            });\n                        };\n                    }(data, image)));\n                }\n            });\n\n            $( lightbox.elems.overlay ).show().css( 'visibility', 'visible' );\n            $( lightbox.elems.box ).show();\n        }\n    };\n\n    // the internal timeouts object\n    // provides helper methods for controlling timeouts\n\n    var _timer = this._timer = {\n\n        trunk: {},\n\n        add: function( id, fn, delay, loop ) {\n            id = id || new Date().getTime();\n            loop = loop || false;\n            this.clear( id );\n            if ( loop ) {\n                var old = fn;\n                fn = function() {\n                    old();\n                    _timer.add( id, fn, delay );\n                };\n            }\n            this.trunk[ id ] = window.setTimeout( fn, delay );\n        },\n\n        clear: function( id ) {\n\n            var del = function( i ) {\n                window.clearTimeout( this.trunk[ i ] );\n                delete this.trunk[ i ];\n            }, i;\n\n            if ( !!id && id in this.trunk ) {\n                del.call( this, id );\n\n            } else if ( typeof id === 'undefined' ) {\n                for ( i in this.trunk ) {\n                    if ( this.trunk.hasOwnProperty( i ) ) {\n                        del.call( this, i );\n                    }\n                }\n            }\n        }\n    };\n\n    return this;\n};\n\n// end Galleria constructor\n\nGalleria.prototype = {\n\n    // bring back the constructor reference\n\n    constructor: Galleria,\n\n    /**\n        Use this function to initialize the gallery and start loading.\n        Should only be called once per instance.\n\n        @param {HTMLElement} target The target element\n        @param {Object} options The gallery options\n\n        @returns Instance\n    */\n\n    init: function( target, options ) {\n\n        options = _legacyOptions( options );\n\n        // save the original ingredients\n        this._original = {\n            target: target,\n            options: options,\n            data: null\n        };\n\n        // save the target here\n        this._target = this._dom.target = target.nodeName ? target : $( target ).get(0);\n\n        // save the original content for destruction\n        this._original.html = this._target.innerHTML;\n\n        // push the instance\n        _instances.push( this );\n\n        // raise error if no target is detected\n        if ( !this._target ) {\n             Galleria.raise('Target not found', true);\n             return;\n        }\n\n        // apply options\n        this._options = {\n            autoplay: false,\n            carousel: true,\n            carouselFollow: true, // legacy, deprecate at 1.3\n            carouselSpeed: 400,\n            carouselSteps: 'auto',\n            clicknext: false,\n            dailymotion: {\n                foreground: '%23EEEEEE',\n                highlight: '%235BCEC5',\n                background: '%23222222',\n                logo: 0,\n                hideInfos: 1\n            },\n            dataConfig : function( elem ) { return {}; },\n            dataSelector: 'img',\n            dataSort: false,\n            dataSource: this._target,\n            debug: undef,\n            dummy: undef, // 1.2.5\n            easing: 'galleria',\n            extend: function(options) {},\n            fullscreenCrop: undef, // 1.2.5\n            fullscreenDoubleTap: true, // 1.2.4 toggles fullscreen on double-tap for touch devices\n            fullscreenTransition: undef, // 1.2.6\n            height: 0,\n            idleMode: true, // 1.2.4 toggles idleMode\n            idleTime: 3000,\n            idleSpeed: 200,\n            imageCrop: false,\n            imageMargin: 0,\n            imagePan: false,\n            imagePanSmoothness: 12,\n            imagePosition: '50%',\n            imageTimeout: undef, // 1.2.5\n            initialTransition: undef, // 1.2.4, replaces transitionInitial\n            keepSource: false,\n            layerFollow: true, // 1.2.5\n            lightbox: false, // 1.2.3\n            lightboxFadeSpeed: 200,\n            lightboxTransitionSpeed: 200,\n            linkSourceImages: true,\n            maxScaleRatio: undef,\n            maxVideoSize: undef, // 1.2.9\n            minScaleRatio: undef, // deprecated in 1.2.9\n            overlayOpacity: 0.85,\n            overlayBackground: '#0b0b0b',\n            pauseOnInteraction: true,\n            popupLinks: false,\n            preload: 2,\n            queue: true,\n            responsive: true,\n            show: 0,\n            showInfo: true,\n            showCounter: true,\n            showImagenav: true,\n            swipe: true, // 1.2.4 -> revised in 1.3\n            thumbCrop: true,\n            thumbEventType: 'click:fast',\n            thumbMargin: 0,\n            thumbQuality: 'auto',\n            thumbDisplayOrder: true, // 1.2.8\n            thumbPosition: '50%', // 1.3\n            thumbnails: true,\n            touchTransition: undef, // 1.2.6\n            transition: 'fade',\n            transitionInitial: undef, // legacy, deprecate in 1.3. Use initialTransition instead.\n            transitionSpeed: 400,\n            trueFullscreen: true, // 1.2.7\n            useCanvas: false, // 1.2.4\n            variation: '', // 1.3.2\n            videoPoster: true, // 1.3\n            vimeo: {\n                title: 0,\n                byline: 0,\n                portrait: 0,\n                color: 'aaaaaa'\n            },\n            wait: 5000, // 1.2.7\n            width: 'auto',\n            youtube: {\n                modestbranding: 1,\n                autohide: 1,\n                color: 'white',\n                hd: 1,\n                rel: 0,\n                showinfo: 0\n            }\n        };\n\n        // legacy support for transitionInitial\n        this._options.initialTransition = this._options.initialTransition || this._options.transitionInitial;\n\n        // turn off debug\n        if ( options && options.debug === false ) {\n            DEBUG = false;\n        }\n\n        // set timeout\n        if ( options && typeof options.imageTimeout === 'number' ) {\n            TIMEOUT = options.imageTimeout;\n        }\n\n        // set dummy\n        if ( options && typeof options.dummy === 'string' ) {\n            DUMMY = options.dummy;\n        }\n\n        // disable swipe if no touch\n        if ( !Galleria.TOUCH ) {\n           this._options.swipe = false;\n        }\n\n        // hide all content\n        $( this._target ).children().hide();\n\n        // Warn for quirks mode\n        if ( Galleria.QUIRK ) {\n            Galleria.raise('Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML and add a correct doctype.');\n        }\n\n        // now we just have to wait for the theme...\n        if ( typeof Galleria.theme === 'object' ) {\n            this._init();\n        } else {\n            // push the instance into the pool and run it when the theme is ready\n            _pool.push( this );\n        }\n\n        return this;\n    },\n\n    // this method should only be called once per instance\n    // for manipulation of data, use the .load method\n\n    _init: function() {\n\n        var self = this,\n            options = this._options;\n\n        if ( this._initialized ) {\n            Galleria.raise( 'Init failed: Gallery instance already initialized.' );\n            return this;\n        }\n\n        this._initialized = true;\n\n        if ( !Galleria.theme ) {\n            Galleria.raise( 'Init failed: No theme found.', true );\n            return this;\n        }\n\n        // merge the theme & caller options\n        $.extend( true, options, Galleria.theme.defaults, this._original.options, Galleria.configure.options );\n\n        // disable options that arent compatible with swipe\n        if ( options.swipe ) {\n            options.clicknext = false;\n            options.imagePan = false;\n        }\n\n        // check for canvas support\n        (function( can ) {\n\n            if ( !( 'getContext' in can ) ) {\n                can = null;\n                return;\n            }\n\n            _canvas = _canvas || {\n                elem: can,\n                context: can.getContext( '2d' ),\n                cache: {},\n                length: 0\n            };\n\n        }( doc.createElement( 'canvas' ) ) );\n\n        // bind the gallery to run when data is ready\n        this.bind( Galleria.DATA, function() {\n\n            // remove big if total pixels are less than 1024 (most phones)\n            if ( window.screen && window.screen.width && Array.prototype.forEach ) {\n\n                this._data.forEach(function(data) {\n\n                    var density = 'devicePixelRatio' in window ? window.devicePixelRatio : 1,\n                        m = M.max( window.screen.width, window.screen.height );\n\n                    if ( m*density < 1024 ) {\n                        data.big = data.image;\n                    }\n                });\n            }\n\n            // save the new data\n            this._original.data = this._data;\n\n            // lets show the counter here\n            this.get('total').innerHTML = this.getDataLength();\n\n            // cache the container\n            var $container = this.$( 'container' );\n\n            // set ratio if height is < 2\n            if ( self._options.height < 2 ) {\n                self._userRatio = self._ratio = self._options.height;\n            }\n\n            // the gallery is ready, let's just wait for the css\n            var num = { width: 0, height: 0 };\n            var testHeight = function() {\n                return self.$( 'stage' ).height();\n            };\n\n            // check container and thumbnail height\n            Utils.wait({\n                until: function() {\n\n                    // keep trying to get the value\n                    num = self._getWH();\n                    $container.width( num.width ).height( num.height );\n                    return testHeight() && num.width && num.height > 50;\n\n                },\n                success: function() {\n\n                    self._width = num.width;\n                    self._height = num.height;\n                    self._ratio = self._ratio || num.height/num.width;\n\n                    // for some strange reason, webkit needs a single setTimeout to play ball\n                    if ( Galleria.WEBKIT ) {\n                        window.setTimeout( function() {\n                            self._run();\n                        }, 1);\n                    } else {\n                        self._run();\n                    }\n                },\n                error: function() {\n\n                    // Height was probably not set, raise hard errors\n\n                    if ( testHeight() ) {\n                        Galleria.raise('Could not extract sufficient width/height of the gallery container. Traced measures: width:' + num.width + 'px, height: ' + num.height + 'px.', true);\n                    } else {\n                        Galleria.raise('Could not extract a stage height from the CSS. Traced height: ' + testHeight() + 'px.', true);\n                    }\n                },\n                timeout: typeof this._options.wait == 'number' ? this._options.wait : false\n            });\n        });\n\n        // build the gallery frame\n        this.append({\n            'info-text' :\n                ['info-title', 'info-description'],\n            'info' :\n                ['info-text'],\n            'image-nav' :\n                ['image-nav-right', 'image-nav-left'],\n            'stage' :\n                ['images', 'loader', 'counter', 'image-nav'],\n            'thumbnails-list' :\n                ['thumbnails'],\n            'thumbnails-container' :\n                ['thumb-nav-left', 'thumbnails-list', 'thumb-nav-right'],\n            'container' :\n                ['stage', 'thumbnails-container', 'info', 'tooltip']\n        });\n\n        Utils.hide( this.$( 'counter' ).append(\n            this.get( 'current' ),\n            doc.createTextNode(' / '),\n            this.get( 'total' )\n        ) );\n\n        this.setCounter('&#8211;');\n\n        Utils.hide( self.get('tooltip') );\n\n        // add a notouch class on the container to prevent unwanted :hovers on touch devices\n        this.$( 'container' ).addClass( ( Galleria.TOUCH ? 'touch' : 'notouch' ) + ' ' + this._options.variation );\n\n        // add images to the controls\n        if ( !this._options.swipe ) {\n            $.each( new Array(2), function( i ) {\n\n                // create a new Picture instance\n                var image = new Galleria.Picture();\n\n                // apply some styles, create & prepend overlay\n                $( image.container ).css({\n                    position: 'absolute',\n                    top: 0,\n                    left: 0\n                }).prepend( self._layers[i] = $( Utils.create('galleria-layer') ).css({\n                    position: 'absolute',\n                    top:0, left:0, right:0, bottom:0,\n                    zIndex:2\n                })[0] );\n\n                // append the image\n                self.$( 'images' ).append( image.container );\n\n                // reload the controls\n                self._controls[i] = image;\n\n                // build a frame\n                var frame = new Galleria.Picture();\n                frame.isIframe = true;\n\n                $( frame.container ).attr('class', 'galleria-frame').css({\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    zIndex: 4,\n                    background: '#000',\n                    display: 'none'\n                }).appendTo( image.container );\n\n                self._controls.frames[i] = frame;\n\n            });\n        }\n\n        // some forced generic styling\n        this.$( 'images' ).css({\n            position: 'relative',\n            top: 0,\n            left: 0,\n            width: '100%',\n            height: '100%'\n        });\n\n        if ( options.swipe ) {\n            this.$( 'images' ).css({\n                position: 'absolute',\n                top: 0,\n                left: 0,\n                width: 0,\n                height: '100%'\n            });\n            this.finger = new Galleria.Finger(this.get('stage'), {\n                onchange: function(page) {\n                    self.setCounter( page ).setInfo( page ).pause();\n                    self.show(page);\n                },\n                oncomplete: function(page) {\n\n                    var index = M.max( 0, M.min( parseInt( page, 10 ), self.getDataLength() - 1 ) ),\n                        data = self.getData(index);\n\n                    if ( !data ) {\n                       return;\n                    }\n\n                    self.$( 'images' ).find( 'iframe' ).remove();\n                    self.$( 'images' ).find( '.galleria-frame' ).css('opacity', 0).hide();\n\n                    if ( self._options.carousel && self._options.carouselFollow ) {\n                        self._carousel.follow( index );\n                    }\n                }\n            });\n            this.bind( Galleria.RESCALE, function() {\n                this.finger.setup();\n            });\n            this.$('stage').on('click', function(e) {\n                var data = self.getData();\n                if ( !data ) {\n                    return;\n                }\n                if ( data.iframe ) {\n\n                    if ( self.isPlaying() ) {\n                        self.pause();\n                    }\n                    var frame = self._controls.frames[ self._active ],\n                        w = self._stageWidth,\n                        h = self._stageHeight;\n\n                    if ( $( frame.container ).find( 'iframe' ).length ) {\n                        return;\n                    }\n\n                    $( frame.container ).css({\n                        width: w,\n                        height: h,\n                        opacity: 0\n                    }).show().animate({\n                        opacity: 1\n                    }, 200);\n\n                    window.setTimeout(function() {\n                        frame.load( data.iframe + ( data.video ? '&autoplay=1' : '' ), {\n                            width: w,\n                            height: h\n                        }, function( frame ) {\n                            self.$( 'container' ).addClass( 'videoplay' );\n                            frame.scale({\n                                width: self._stageWidth,\n                                height: self._stageHeight,\n                                iframelimit: data.video ? self._options.maxVideoSize : undef\n                            });\n                        });\n                    }, 100);\n\n                    return;\n                }\n\n                if ( data.link ) {\n                    if ( self._options.popupLinks ) {\n                        var win = window.open( data.link, '_blank' );\n                    } else {\n                        window.location.href = data.link;\n                    }\n                    return;\n                }\n            });\n            this.bind( Galleria.IMAGE, function(e) {\n\n                self.setCounter( e.index );\n                self.setInfo( e.index );\n\n                var next = this.getNext(),\n                    prev = this.getPrev();\n\n                var preloads = [prev,next];\n                preloads.push(this.getNext(next), this.getPrev(prev), self._controls.slides.length-1);\n\n                var filtered = [];\n\n                $.each(preloads, function(i, val) {\n                    if ( $.inArray(val, filtered) == -1 ) {\n                        filtered.push(val);\n                    }\n                });\n\n                $.each(filtered, function(i, loadme) {\n                    var d = self.getData(loadme),\n                        img = self._controls.slides[loadme],\n                        src = self.isFullscreen() && d.big ? d.big : ( d.image || d.iframe );\n\n                    if ( d.iframe && !d.image ) {\n                        img.isIframe = true;\n                    }\n\n                    if ( !img.ready ) {\n                        self._controls.slides[loadme].load(src, function(img) {\n                            if ( !img.isIframe ) {\n                                $(img.image).css('visibility', 'hidden');\n                            }\n                            self._scaleImage(img, {\n                                complete: function(img) {\n                                    if ( !img.isIframe ) {\n                                        $(img.image).css({\n                                            opacity: 0,\n                                            visibility: 'visible'\n                                        }).animate({\n                                            opacity: 1\n                                        }, 200);\n                                    }\n                                }\n                            });\n                        });\n                    }\n                });\n            });\n        }\n\n        this.$( 'thumbnails, thumbnails-list' ).css({\n            overflow: 'hidden',\n            position: 'relative'\n        });\n\n        // bind image navigation arrows\n        this.$( 'image-nav-right, image-nav-left' ).on( 'click:fast', function(e) {\n\n            // pause if options is set\n            if ( options.pauseOnInteraction ) {\n                self.pause();\n            }\n\n            // navigate\n            var fn = /right/.test( this.className ) ? 'next' : 'prev';\n            self[ fn ]();\n\n        }).on('click', function(e) {\n\n            e.preventDefault();\n\n            // tune the clicknext option\n            if ( options.clicknext || options.swipe ) {\n                e.stopPropagation();\n            }\n        });\n\n        // hide controls if chosen to\n        $.each( ['info','counter','image-nav'], function( i, el ) {\n            if ( options[ 'show' + el.substr(0,1).toUpperCase() + el.substr(1).replace(/-/,'') ] === false ) {\n                Utils.moveOut( self.get( el.toLowerCase() ) );\n            }\n        });\n\n        // load up target content\n        this.load();\n\n        // now it's usually safe to remove the content\n        // IE will never stop loading if we remove it, so let's keep it hidden for IE (it's usually fast enough anyway)\n        if ( !options.keepSource && !IE ) {\n            this._target.innerHTML = '';\n        }\n\n        // re-append the errors, if they happened before clearing\n        if ( this.get( 'errors' ) ) {\n            this.appendChild( 'target', 'errors' );\n        }\n\n        // append the gallery frame\n        this.appendChild( 'target', 'container' );\n\n        // parse the carousel on each thumb load\n        if ( options.carousel ) {\n            var count = 0,\n                show = options.show;\n            this.bind( Galleria.THUMBNAIL, function() {\n                this.updateCarousel();\n                if ( ++count == this.getDataLength() && typeof show == 'number' && show > 0 ) {\n                    this._carousel.follow( show );\n                }\n            });\n        }\n\n        // bind window resize for responsiveness\n        if ( options.responsive ) {\n            $win.on( 'resize', function() {\n                if ( !self.isFullscreen() ) {\n                    self.resize();\n                }\n            });\n        }\n\n        // double-tap/click fullscreen toggle\n\n        if ( options.fullscreenDoubleTap ) {\n\n            this.$( 'stage' ).on( 'touchstart', (function() {\n                var last, cx, cy, lx, ly, now,\n                    getData = function(e) {\n                        return e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n                    };\n                self.$( 'stage' ).on('touchmove', function() {\n                    last = 0;\n                });\n                return function(e) {\n                    if( /(-left|-right)/.test(e.target.className) ) {\n                        return;\n                    }\n                    now = Utils.timestamp();\n                    cx = getData(e).pageX;\n                    cy = getData(e).pageY;\n                    if ( e.originalEvent.touches.length < 2 && ( now - last < 300 ) && ( cx - lx < 20) && ( cy - ly < 20) ) {\n                        self.toggleFullscreen();\n                        e.preventDefault();\n                        return;\n                    }\n                    last = now;\n                    lx = cx;\n                    ly = cy;\n                };\n            }()));\n        }\n\n        // bind the ons\n        $.each( Galleria.on.binds, function(i, bind) {\n            // check if already bound\n            if ( $.inArray( bind.hash, self._binds ) == -1 ) {\n                self.bind( bind.type, bind.callback );\n            }\n        });\n\n        return this;\n    },\n\n    addTimer : function() {\n        this._timer.add.apply( this._timer, Utils.array( arguments ) );\n        return this;\n    },\n\n    clearTimer : function() {\n        this._timer.clear.apply( this._timer, Utils.array( arguments ) );\n        return this;\n    },\n\n    // parse width & height from CSS or options\n\n    _getWH : function() {\n\n        var $container = this.$( 'container' ),\n            $target = this.$( 'target' ),\n            self = this,\n            num = {},\n            arr;\n\n        $.each(['width', 'height'], function( i, m ) {\n\n            // first check if options is set\n            if ( self._options[ m ] && typeof self._options[ m ] === 'number') {\n                num[ m ] = self._options[ m ];\n            } else {\n\n                arr = [\n                    Utils.parseValue( $container.css( m ) ),         // the container css height\n                    Utils.parseValue( $target.css( m ) ),            // the target css height\n                    $container[ m ](),                               // the container jQuery method\n                    $target[ m ]()                                   // the target jQuery method\n                ];\n\n                // if first time, include the min-width & min-height\n                if ( !self[ '_'+m ] ) {\n                    arr.splice(arr.length,\n                        Utils.parseValue( $container.css( 'min-'+m ) ),\n                        Utils.parseValue( $target.css( 'min-'+m ) )\n                    );\n                }\n\n                // else extract the measures from different sources and grab the highest value\n                num[ m ] = M.max.apply( M, arr );\n            }\n        });\n\n        // allow setting a height ratio instead of exact value\n        // useful when doing responsive galleries\n\n        if ( self._userRatio ) {\n            num.height = num.width * self._userRatio;\n        }\n\n        return num;\n    },\n\n    // Creates the thumbnails and carousel\n    // can be used at any time, f.ex when the data object is manipulated\n    // push is an optional argument with pushed images\n\n    _createThumbnails : function( push ) {\n\n        this.get( 'total' ).innerHTML = this.getDataLength();\n\n        var src,\n            thumb,\n            data,\n\n            $container,\n\n            self = this,\n            o = this._options,\n\n            i = push ? this._data.length - push.length : 0,\n            chunk = i,\n\n            thumbchunk = [],\n            loadindex = 0,\n\n            gif = IE < 8 ? 'http://upload.wikimedia.org/wikipedia/commons/c/c0/Blank.gif' :\n                           'data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D',\n\n            // get previously active thumbnail, if exists\n            active = (function() {\n                var a = self.$('thumbnails').find('.active');\n                if ( !a.length ) {\n                    return false;\n                }\n                return a.find('img').attr('src');\n            }()),\n\n            // cache the thumbnail option\n            optval = typeof o.thumbnails === 'string' ? o.thumbnails.toLowerCase() : null,\n\n            // move some data into the instance\n            // for some reason, jQuery cant handle css(property) when zooming in FF, breaking the gallery\n            // so we resort to getComputedStyle for browsers who support it\n            getStyle = function( prop ) {\n                return doc.defaultView && doc.defaultView.getComputedStyle ?\n                    doc.defaultView.getComputedStyle( thumb.container, null )[ prop ] :\n                    $container.css( prop );\n            },\n\n            fake = function(image, index, container) {\n                return function() {\n                    $( container ).append( image );\n                    self.trigger({\n                        type: Galleria.THUMBNAIL,\n                        thumbTarget: image,\n                        index: index,\n                        galleriaData: self.getData( index )\n                    });\n                };\n            },\n\n            onThumbEvent = function( e ) {\n\n                // pause if option is set\n                if ( o.pauseOnInteraction ) {\n                    self.pause();\n                }\n\n                // extract the index from the data\n                var index = $( e.currentTarget ).data( 'index' );\n                if ( self.getIndex() !== index ) {\n                    self.show( index );\n                }\n\n                e.preventDefault();\n            },\n\n            thumbComplete = function( thumb, callback ) {\n\n                $( thumb.container ).css( 'visibility', 'visible' );\n                self.trigger({\n                    type: Galleria.THUMBNAIL,\n                    thumbTarget: thumb.image,\n                    index: thumb.data.order,\n                    galleriaData: self.getData( thumb.data.order )\n                });\n\n                if ( typeof callback == 'function' ) {\n                    callback.call( self, thumb );\n                }\n            },\n\n            onThumbLoad = function( thumb, callback ) {\n\n                // scale when ready\n                thumb.scale({\n                    width:    thumb.data.width,\n                    height:   thumb.data.height,\n                    crop:     o.thumbCrop,\n                    margin:   o.thumbMargin,\n                    canvas:   o.useCanvas,\n                    position: o.thumbPosition,\n                    complete: function( thumb ) {\n\n                        // shrink thumbnails to fit\n                        var top = ['left', 'top'],\n                            arr = ['Width', 'Height'],\n                            m,\n                            css,\n                            data = self.getData( thumb.index );\n\n                        // calculate shrinked positions\n                        $.each(arr, function( i, measure ) {\n                            m = measure.toLowerCase();\n                            if ( (o.thumbCrop !== true || o.thumbCrop === m ) ) {\n                                css = {};\n                                css[ m ] = thumb[ m ];\n                                $( thumb.container ).css( css );\n                                css = {};\n                                css[ top[ i ] ] = 0;\n                                $( thumb.image ).css( css );\n                            }\n\n                            // cache outer measures\n                            thumb[ 'outer' + measure ] = $( thumb.container )[ 'outer' + measure ]( true );\n                        });\n\n                        // set high quality if downscale is moderate\n                        Utils.toggleQuality( thumb.image,\n                            o.thumbQuality === true ||\n                            ( o.thumbQuality === 'auto' && thumb.original.width < thumb.width * 3 )\n                        );\n\n                        if ( o.thumbDisplayOrder && !thumb.lazy ) {\n\n                            $.each( thumbchunk, function( i, th ) {\n                                if ( i === loadindex && th.ready && !th.displayed ) {\n\n                                    loadindex++;\n                                    th.displayed = true;\n\n                                    thumbComplete( th, callback );\n\n                                    return;\n                                }\n                            });\n                        } else {\n                            thumbComplete( thumb, callback );\n                        }\n                    }\n                });\n            };\n\n        if ( !push ) {\n            this._thumbnails = [];\n            this.$( 'thumbnails' ).empty();\n        }\n\n        // loop through data and create thumbnails\n        for( ; this._data[ i ]; i++ ) {\n\n            data = this._data[ i ];\n\n            // get source from thumb or image\n            src = data.thumb || data.image;\n\n            if ( ( o.thumbnails === true || optval == 'lazy' ) && ( data.thumb || data.image ) ) {\n\n                // add a new Picture instance\n                thumb = new Galleria.Picture(i);\n\n                // save the index\n                thumb.index = i;\n\n                // flag displayed\n                thumb.displayed = false;\n\n                // flag lazy\n                thumb.lazy = false;\n\n                // flag video\n                thumb.video = false;\n\n                // append the thumbnail\n                this.$( 'thumbnails' ).append( thumb.container );\n\n                // cache the container\n                $container = $( thumb.container );\n\n                // hide it\n                $container.css( 'visibility', 'hidden' );\n\n                thumb.data = {\n                    width  : Utils.parseValue( getStyle( 'width' ) ),\n                    height : Utils.parseValue( getStyle( 'height' ) ),\n                    order  : i,\n                    src    : src\n                };\n\n                // grab & reset size for smoother thumbnail loads\n                if ( o.thumbCrop !== true ) {\n                    $container.css( { width: 'auto', height: 'auto' } );\n                } else {\n                    $container.css( { width: thumb.data.width, height: thumb.data.height } );\n                }\n\n                // load the thumbnail\n                if ( optval == 'lazy' ) {\n\n                    $container.addClass( 'lazy' );\n\n                    thumb.lazy = true;\n\n                    thumb.load( gif, {\n                        height: thumb.data.height,\n                        width: thumb.data.width\n                    });\n\n                } else {\n                    thumb.load( src, onThumbLoad );\n                }\n\n                // preload all images here\n                if ( o.preload === 'all' ) {\n                    thumb.preload( data.image );\n                }\n\n            // create empty spans if thumbnails is set to 'empty'\n            } else if ( data.iframe || optval === 'empty' || optval === 'numbers' ) {\n\n                thumb = {\n                    container: Utils.create( 'galleria-image' ),\n                    image: Utils.create( 'img', 'span' ),\n                    ready: true,\n                    data: {\n                        order: i\n                    }\n                };\n\n                // create numbered thumbnails\n                if ( optval === 'numbers' ) {\n                    $( thumb.image ).text( i + 1 );\n                }\n\n                if ( data.iframe ) {\n                    $( thumb.image ).addClass( 'iframe' );\n                }\n\n                this.$( 'thumbnails' ).append( thumb.container );\n\n                // we need to \"fake\" a loading delay before we append and trigger\n                // 50+ should be enough\n\n                window.setTimeout( ( fake )( thumb.image, i, thumb.container ), 50 + ( i*20 ) );\n\n            // create null object to silent errors\n            } else {\n                thumb = {\n                    container: null,\n                    image: null\n                };\n            }\n\n            // add events for thumbnails\n            // you can control the event type using thumb_event_type\n            // we'll add the same event to the source if it's kept\n\n            $( thumb.container ).add( o.keepSource && o.linkSourceImages ? data.original : null )\n                .data('index', i).on( o.thumbEventType, onThumbEvent )\n                .data('thumbload', onThumbLoad);\n\n            if (active === src) {\n                $( thumb.container ).addClass( 'active' );\n            }\n\n            this._thumbnails.push( thumb );\n        }\n\n        thumbchunk = this._thumbnails.slice( chunk );\n\n        return this;\n    },\n\n    /**\n        Lazy-loads thumbnails.\n        You can call this method to load lazy thumbnails at run time\n\n        @param {Array|Number} index Index or array of indexes of thumbnails to be loaded\n        @param {Function} complete Callback that is called when all lazy thumbnails have been loaded\n\n        @returns Instance\n    */\n\n    lazyLoad: function( index, complete ) {\n\n        var arr = index.constructor == Array ? index : [ index ],\n            self = this,\n            loaded = 0;\n\n        $.each( arr, function(i, ind) {\n\n            if ( ind > self._thumbnails.length - 1 ) {\n                return;\n            }\n\n            var thumb = self._thumbnails[ ind ],\n                data = thumb.data,\n                callback = function() {\n                    if ( ++loaded == arr.length && typeof complete == 'function' ) {\n                        complete.call( self );\n                    }\n                },\n                thumbload = $( thumb.container ).data( 'thumbload' );\n            if ( thumb.video ) {\n                thumbload.call( self, thumb, callback );\n            } else {\n                thumb.load( data.src , function( thumb ) {\n                    thumbload.call( self, thumb, callback );\n                });\n            }\n        });\n\n        return this;\n\n    },\n\n    /**\n        Lazy-loads thumbnails in chunks.\n        This method automatcally chops up the loading process of many thumbnails into chunks\n\n        @param {Number} size Size of each chunk to be loaded\n        @param {Number} [delay] Delay between each loads\n\n        @returns Instance\n    */\n\n    lazyLoadChunks: function( size, delay ) {\n\n        var len = this.getDataLength(),\n            i = 0,\n            n = 0,\n            arr = [],\n            temp = [],\n            self = this;\n\n        delay = delay || 0;\n\n        for( ; i<len; i++ ) {\n            temp.push(i);\n            if ( ++n == size || i == len-1 ) {\n                arr.push( temp );\n                n = 0;\n                temp = [];\n            }\n        }\n\n        var init = function( wait ) {\n            var a = arr.shift();\n            if ( a ) {\n                window.setTimeout(function() {\n                    self.lazyLoad(a, function() {\n                        init( true );\n                    });\n                }, ( delay && wait ) ? delay : 0 );\n            }\n        };\n\n        init( false );\n\n        return this;\n\n    },\n\n    // the internal _run method should be called after loading data into galleria\n    // makes sure the gallery has proper measurements before postrun & ready\n    _run : function() {\n\n        var self = this;\n\n        self._createThumbnails();\n\n        // make sure we have a stageHeight && stageWidth\n\n        Utils.wait({\n\n            timeout: 10000,\n\n            until: function() {\n\n                // Opera crap\n                if ( Galleria.OPERA ) {\n                    self.$( 'stage' ).css( 'display', 'inline-block' );\n                }\n\n                self._stageWidth  = self.$( 'stage' ).width();\n                self._stageHeight = self.$( 'stage' ).height();\n\n                return( self._stageWidth &&\n                        self._stageHeight > 50 ); // what is an acceptable height?\n            },\n\n            success: function() {\n\n                // save the instance\n                _galleries.push( self );\n\n                // postrun some stuff after the gallery is ready\n\n                // create the touch slider\n                if ( self._options.swipe ) {\n\n                    var $images = self.$( 'images' ).width( self.getDataLength() * self._stageWidth );\n                    $.each( new Array( self.getDataLength() ), function(i) {\n\n                        var image = new Galleria.Picture(),\n                            data = self.getData(i);\n\n                        $( image.container ).css({\n                            position: 'absolute',\n                            top: 0,\n                            left: self._stageWidth*i\n                        }).prepend( self._layers[i] = $( Utils.create('galleria-layer') ).css({\n                            position: 'absolute',\n                            top:0, left:0, right:0, bottom:0,\n                            zIndex:2\n                        })[0] ).appendTo( $images );\n\n                        if( data.video ) {\n                            _playIcon( image.container );\n                        }\n\n                        self._controls.slides.push(image);\n\n                        var frame = new Galleria.Picture();\n                        frame.isIframe = true;\n\n                        $( frame.container ).attr('class', 'galleria-frame').css({\n                            position: 'absolute',\n                            top: 0,\n                            left: 0,\n                            zIndex: 4,\n                            background: '#000',\n                            display: 'none'\n                        }).appendTo( image.container );\n\n                        self._controls.frames.push(frame);\n                    });\n\n                    self.finger.setup();\n                }\n\n                // show counter\n                Utils.show( self.get('counter') );\n\n                // bind carousel nav\n                if ( self._options.carousel ) {\n                    self._carousel.bindControls();\n                }\n\n                // start autoplay\n                if ( self._options.autoplay ) {\n\n                    self.pause();\n\n                    if ( typeof self._options.autoplay === 'number' ) {\n                        self._playtime = self._options.autoplay;\n                    }\n\n                    self._playing = true;\n                }\n                // if second load, just do the show and return\n                if ( self._firstrun ) {\n\n                    if ( self._options.autoplay ) {\n                        self.trigger( Galleria.PLAY );\n                    }\n\n                    if ( typeof self._options.show === 'number' ) {\n                        self.show( self._options.show );\n                    }\n                    return;\n                }\n\n                self._firstrun = true;\n\n                // initialize the History plugin\n                if ( Galleria.History ) {\n\n                    // bind the show method\n                    Galleria.History.change(function( value ) {\n\n                        // if ID is NaN, the user pressed back from the first image\n                        // return to previous address\n                        if ( isNaN( value ) ) {\n                            window.history.go(-1);\n\n                        // else show the image\n                        } else {\n                            self.show( value, undef, true );\n                        }\n                    });\n                }\n\n                self.trigger( Galleria.READY );\n\n                // call the theme init method\n                Galleria.theme.init.call( self, self._options );\n\n                // Trigger Galleria.ready\n                $.each( Galleria.ready.callbacks, function(i ,fn) {\n                    if ( typeof fn == 'function' ) {\n                        fn.call( self, self._options );\n                    }\n                });\n\n                // call the extend option\n                self._options.extend.call( self, self._options );\n\n                // show the initial image\n                // first test for permalinks in history\n                if ( /^[0-9]{1,4}$/.test( HASH ) && Galleria.History ) {\n                    self.show( HASH, undef, true );\n\n                } else if( self._data[ self._options.show ] ) {\n                    self.show( self._options.show );\n                }\n\n                // play trigger\n                if ( self._options.autoplay ) {\n                    self.trigger( Galleria.PLAY );\n                }\n            },\n\n            error: function() {\n                Galleria.raise('Stage width or height is too small to show the gallery. Traced measures: width:' + self._stageWidth + 'px, height: ' + self._stageHeight + 'px.', true);\n            }\n\n        });\n    },\n\n    /**\n        Loads data into the gallery.\n        You can call this method on an existing gallery to reload the gallery with new data.\n\n        @param {Array|string} [source] Optional JSON array of data or selector of where to find data in the document.\n        Defaults to the Galleria target or dataSource option.\n\n        @param {string} [selector] Optional element selector of what elements to parse.\n        Defaults to 'img'.\n\n        @param {Function} [config] Optional function to modify the data extraction proceedure from the selector.\n        See the dataConfig option for more information.\n\n        @returns Instance\n    */\n\n    load : function( source, selector, config ) {\n\n        var self = this,\n            o = this._options;\n\n        // empty the data array\n        this._data = [];\n\n        // empty the thumbnails\n        this._thumbnails = [];\n        this.$('thumbnails').empty();\n\n        // shorten the arguments\n        if ( typeof selector === 'function' ) {\n            config = selector;\n            selector = null;\n        }\n\n        // use the source set by target\n        source = source || o.dataSource;\n\n        // use selector set by option\n        selector = selector || o.dataSelector;\n\n        // use the dataConfig set by option\n        config = config || o.dataConfig;\n\n        // if source is a true object, make it into an array\n        if( $.isPlainObject( source ) ) {\n            source = [source];\n        }\n\n        // check if the data is an array already\n        if ( $.isArray( source ) ) {\n            if ( this.validate( source ) ) {\n                this._data = source;\n            } else {\n                Galleria.raise( 'Load failed: JSON Array not valid.' );\n            }\n        } else {\n\n            // add .video and .iframe to the selector (1.2.7)\n            selector += ',.video,.iframe';\n\n            // loop through images and set data\n            $( source ).find( selector ).each( function( i, elem ) {\n\n                elem = $( elem );\n                var data = {},\n                    parent = elem.parent(),\n                    href = parent.attr( 'href' ),\n                    rel  = parent.attr( 'rel' );\n\n                if( href && ( elem[0].nodeName == 'IMG' || elem.hasClass('video') ) && _videoTest( href ) ) {\n                    data.video = href;\n                } else if( href && elem.hasClass('iframe') ) {\n                    data.iframe = href;\n                } else {\n                    data.image = data.big = href;\n                }\n\n                if ( rel ) {\n                    data.big = rel;\n                }\n\n                // alternative extraction from HTML5 data attribute, added in 1.2.7\n                $.each( 'big title description link layer image'.split(' '), function( i, val ) {\n                    if ( elem.data(val) ) {\n                        data[ val ] = elem.data(val).toString();\n                    }\n                });\n\n                if ( !data.big ) {\n                    data.big = data.image;\n                }\n\n                // mix default extractions with the hrefs and config\n                // and push it into the data array\n                self._data.push( $.extend({\n\n                    title:       elem.attr('title') || '',\n                    thumb:       elem.attr('src'),\n                    image:       elem.attr('src'),\n                    big:         elem.attr('src'),\n                    description: elem.attr('alt') || '',\n                    link:        elem.attr('longdesc'),\n                    original:    elem.get(0) // saved as a reference\n\n                }, data, config( elem ) ) );\n\n            });\n        }\n\n        if ( typeof o.dataSort == 'function' ) {\n            protoArray.sort.call( this._data, o.dataSort );\n        } else if ( o.dataSort == 'random' ) {\n            this._data.sort( function() {\n                return M.round(M.random())-0.5;\n            });\n        }\n\n        // trigger the DATA event and return\n        if ( this.getDataLength() ) {\n            this._parseData( function() {\n                this.trigger( Galleria.DATA );\n            } );\n        }\n        return this;\n\n    },\n\n    // make sure the data works properly\n    _parseData : function( callback ) {\n\n        var self = this,\n            current,\n            ready = false,\n            onload = function() {\n                var complete = true;\n                $.each( self._data, function( i, data ) {\n                    if ( data.loading ) {\n                        complete = false;\n                        return false;\n                    }\n                });\n                if ( complete && !ready ) {\n                    ready = true;\n                    callback.call( self );\n                }\n            };\n\n        $.each( this._data, function( i, data ) {\n\n            current = self._data[ i ];\n\n            // copy image as thumb if no thumb exists\n            if ( 'thumb' in data === false ) {\n                current.thumb = data.image;\n            }\n            // copy image as big image if no biggie exists\n            if ( !data.big ) {\n                current.big = data.image;\n            }\n            // parse video\n            if ( 'video' in data ) {\n                var result = _videoTest( data.video );\n\n                if ( result ) {\n                    current.iframe = new Video(result.provider, result.id ).embed() + (function() {\n\n                        // add options\n                        if ( typeof self._options[ result.provider ] == 'object' ) {\n                            var str = '?', arr = [];\n                            $.each( self._options[ result.provider ], function( key, val ) {\n                                arr.push( key + '=' + val );\n                            });\n\n                            // small youtube specifics, perhaps move to _video later\n                            if ( result.provider == 'youtube' ) {\n                                arr = ['wmode=opaque'].concat(arr);\n                            }\n                            return str + arr.join('&');\n                        }\n                        return '';\n                    }());\n\n                    // pre-fetch video providers media\n\n                    if( !current.thumb || !current.image ) {\n                        $.each( ['thumb', 'image'], function( i, type ) {\n                            if ( type == 'image' && !self._options.videoPoster ) {\n                                current.image = undef;\n                                return;\n                            }\n                            var video = new Video( result.provider, result.id );\n                            if ( !current[ type ] ) {\n                                current.loading = true;\n                                video.getMedia( type, (function(current, type) {\n                                    return function(src) {\n                                        current[ type ] = src;\n                                        if ( type == 'image' && !current.big ) {\n                                            current.big = current.image;\n                                        }\n                                        delete current.loading;\n                                        onload();\n                                    };\n                                }( current, type )));\n                            }\n                        });\n                    }\n                }\n            }\n        });\n\n        onload();\n\n        return this;\n    },\n\n    /**\n        Destroy the Galleria instance and recover the original content\n\n        @example this.destroy();\n\n        @returns Instance\n    */\n\n    destroy : function() {\n        this.$( 'target' ).data( 'galleria', null );\n        this.$( 'container' ).off( 'galleria' );\n        this.get( 'target' ).innerHTML = this._original.html;\n        this.clearTimer();\n        Utils.removeFromArray( _instances, this );\n        Utils.removeFromArray( _galleries, this );\n        if ( Galleria._waiters.length ) {\n            $.each( Galleria._waiters, function( i, w ) {\n                if ( w ) window.clearTimeout( w );\n            });\n        }\n        return this;\n    },\n\n    /**\n        Adds and/or removes images from the gallery\n        Works just like Array.splice\n        https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/splice\n\n        @example this.splice( 2, 4 ); // removes 4 images after the second image\n\n        @returns Instance\n    */\n\n    splice : function() {\n        var self = this,\n            args = Utils.array( arguments );\n        window.setTimeout(function() {\n            protoArray.splice.apply( self._data, args );\n            self._parseData( function() {\n                self._createThumbnails();\n            });\n        },2);\n        return self;\n    },\n\n    /**\n        Append images to the gallery\n        Works just like Array.push\n        https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/push\n\n        @example this.push({ image: 'image1.jpg' }); // appends the image to the gallery\n\n        @returns Instance\n    */\n\n    push : function() {\n        var self = this,\n            args = Utils.array( arguments );\n\n        if ( args.length == 1 && args[0].constructor == Array ) {\n            args = args[0];\n        }\n\n        window.setTimeout(function() {\n            protoArray.push.apply( self._data, args );\n            self._parseData( function() {\n                self._createThumbnails( args );\n            });\n        }, 2);\n        return self;\n    },\n\n    _getActive : function() {\n        return this._controls.getActive();\n    },\n\n    validate : function( data ) {\n        // todo: validate a custom data array\n        return true;\n    },\n\n    /**\n        Bind any event to Galleria\n\n        @param {string} type The Event type to listen for\n        @param {Function} fn The function to execute when the event is triggered\n\n        @example this.bind( 'image', function() { Galleria.log('image shown') });\n\n        @returns Instance\n    */\n\n    bind : function(type, fn) {\n\n        // allow 'image' instead of Galleria.IMAGE\n        type = _patchEvent( type );\n\n        this.$( 'container' ).on( type, this.proxy(fn) );\n        return this;\n    },\n\n    /**\n        Unbind any event to Galleria\n\n        @param {string} type The Event type to forget\n\n        @returns Instance\n    */\n\n    unbind : function(type) {\n\n        type = _patchEvent( type );\n\n        this.$( 'container' ).off( type );\n        return this;\n    },\n\n    /**\n        Manually trigger a Galleria event\n\n        @param {string} type The Event to trigger\n\n        @returns Instance\n    */\n\n    trigger : function( type ) {\n\n        type = typeof type === 'object' ?\n            $.extend( type, { scope: this } ) :\n            { type: _patchEvent( type ), scope: this };\n\n        this.$( 'container' ).trigger( type );\n\n        return this;\n    },\n\n    /**\n        Assign an \"idle state\" to any element.\n        The idle state will be applied after a certain amount of idle time\n        Useful to hide f.ex navigation when the gallery is inactive\n\n        @param {HTMLElement|string} elem The Dom node or selector to apply the idle state to\n        @param {Object} styles the CSS styles to apply when in idle mode\n        @param {Object} [from] the CSS styles to apply when in normal\n        @param {Boolean} [hide] set to true if you want to hide it first\n\n        @example addIdleState( this.get('image-nav'), { opacity: 0 });\n        @example addIdleState( '.galleria-image-nav', { top: -200 }, true);\n\n        @returns Instance\n    */\n\n    addIdleState: function( elem, styles, from, hide ) {\n        this._idle.add.apply( this._idle, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Removes any idle state previously set using addIdleState()\n\n        @param {HTMLElement|string} elem The Dom node or selector to remove the idle state from.\n\n        @returns Instance\n    */\n\n    removeIdleState: function( elem ) {\n        this._idle.remove.apply( this._idle, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Force Galleria to enter idle mode.\n\n        @returns Instance\n    */\n\n    enterIdleMode: function() {\n        this._idle.hide();\n        return this;\n    },\n\n    /**\n        Force Galleria to exit idle mode.\n\n        @returns Instance\n    */\n\n    exitIdleMode: function() {\n        this._idle.showAll();\n        return this;\n    },\n\n    /**\n        Enter FullScreen mode\n\n        @param {Function} callback the function to be executed when the fullscreen mode is fully applied.\n\n        @returns Instance\n    */\n\n    enterFullscreen: function( callback ) {\n        this._fullscreen.enter.apply( this, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Exits FullScreen mode\n\n        @param {Function} callback the function to be executed when the fullscreen mode is fully applied.\n\n        @returns Instance\n    */\n\n    exitFullscreen: function( callback ) {\n        this._fullscreen.exit.apply( this, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Toggle FullScreen mode\n\n        @param {Function} callback the function to be executed when the fullscreen mode is fully applied or removed.\n\n        @returns Instance\n    */\n\n    toggleFullscreen: function( callback ) {\n        this._fullscreen[ this.isFullscreen() ? 'exit' : 'enter'].apply( this, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Adds a tooltip to any element.\n        You can also call this method with an object as argument with elemID:value pairs to apply tooltips to (see examples)\n\n        @param {HTMLElement} elem The DOM Node to attach the event to\n        @param {string|Function} value The tooltip message. Can also be a function that returns a string.\n\n        @example this.bindTooltip( this.get('thumbnails'), 'My thumbnails');\n        @example this.bindTooltip( this.get('thumbnails'), function() { return 'My thumbs' });\n        @example this.bindTooltip( { image_nav: 'Navigation' });\n\n        @returns Instance\n    */\n\n    bindTooltip: function( elem, value ) {\n        this._tooltip.bind.apply( this._tooltip, Utils.array(arguments) );\n        return this;\n    },\n\n    /**\n        Note: this method is deprecated. Use refreshTooltip() instead.\n\n        Redefine a tooltip.\n        Use this if you want to re-apply a tooltip value to an already bound tooltip element.\n\n        @param {HTMLElement} elem The DOM Node to attach the event to\n        @param {string|Function} value The tooltip message. Can also be a function that returns a string.\n\n        @returns Instance\n    */\n\n    defineTooltip: function( elem, value ) {\n        this._tooltip.define.apply( this._tooltip, Utils.array(arguments) );\n        return this;\n    },\n\n    /**\n        Refresh a tooltip value.\n        Use this if you want to change the tooltip value at runtime, f.ex if you have a play/pause toggle.\n\n        @param {HTMLElement} elem The DOM Node that has a tooltip that should be refreshed\n\n        @returns Instance\n    */\n\n    refreshTooltip: function( elem ) {\n        this._tooltip.show.apply( this._tooltip, Utils.array(arguments) );\n        return this;\n    },\n\n    /**\n        Open a pre-designed lightbox with the currently active image.\n        You can control some visuals using gallery options.\n\n        @returns Instance\n    */\n\n    openLightbox: function() {\n        this._lightbox.show.apply( this._lightbox, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Close the lightbox.\n\n        @returns Instance\n    */\n\n    closeLightbox: function() {\n        this._lightbox.hide.apply( this._lightbox, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Check if a variation exists\n\n        @returns {Boolean} If the variation has been applied\n    */\n\n    hasVariation: function( variation ) {\n        return $.inArray( variation, this._options.variation.split(/\\s+/) ) > -1;\n    },\n\n    /**\n        Get the currently active image element.\n\n        @returns {HTMLElement} The image element\n    */\n\n    getActiveImage: function() {\n        var active = this._getActive();\n        return active ? active.image : undef;\n    },\n\n    /**\n        Get the currently active thumbnail element.\n\n        @returns {HTMLElement} The thumbnail element\n    */\n\n    getActiveThumb: function() {\n        return this._thumbnails[ this._active ].image || undef;\n    },\n\n    /**\n        Get the mouse position relative to the gallery container\n\n        @param e The mouse event\n\n        @example\n\nvar gallery = this;\n$(document).mousemove(function(e) {\n    console.log( gallery.getMousePosition(e).x );\n});\n\n        @returns {Object} Object with x & y of the relative mouse postion\n    */\n\n    getMousePosition : function(e) {\n        return {\n            x: e.pageX - this.$( 'container' ).offset().left,\n            y: e.pageY - this.$( 'container' ).offset().top\n        };\n    },\n\n    /**\n        Adds a panning effect to the image\n\n        @param [img] The optional image element. If not specified it takes the currently active image\n\n        @returns Instance\n    */\n\n    addPan : function( img ) {\n\n        if ( this._options.imageCrop === false ) {\n            return;\n        }\n\n        img = $( img || this.getActiveImage() );\n\n        // define some variables and methods\n        var self   = this,\n            x      = img.width() / 2,\n            y      = img.height() / 2,\n            destX  = parseInt( img.css( 'left' ), 10 ),\n            destY  = parseInt( img.css( 'top' ), 10 ),\n            curX   = destX || 0,\n            curY   = destY || 0,\n            distX  = 0,\n            distY  = 0,\n            active = false,\n            ts     = Utils.timestamp(),\n            cache  = 0,\n            move   = 0,\n\n            // positions the image\n            position = function( dist, cur, pos ) {\n                if ( dist > 0 ) {\n                    move = M.round( M.max( dist * -1, M.min( 0, cur ) ) );\n                    if ( cache !== move ) {\n\n                        cache = move;\n\n                        if ( IE === 8 ) { // scroll is faster for IE\n                            img.parent()[ 'scroll' + pos ]( move * -1 );\n                        } else {\n                            var css = {};\n                            css[ pos.toLowerCase() ] = move;\n                            img.css(css);\n                        }\n                    }\n                }\n            },\n\n            // calculates mouse position after 50ms\n            calculate = function(e) {\n                if (Utils.timestamp() - ts < 50) {\n                    return;\n                }\n                active = true;\n                x = self.getMousePosition(e).x;\n                y = self.getMousePosition(e).y;\n            },\n\n            // the main loop to check\n            loop = function(e) {\n\n                if (!active) {\n                    return;\n                }\n\n                distX = img.width() - self._stageWidth;\n                distY = img.height() - self._stageHeight;\n                destX = x / self._stageWidth * distX * -1;\n                destY = y / self._stageHeight * distY * -1;\n                curX += ( destX - curX ) / self._options.imagePanSmoothness;\n                curY += ( destY - curY ) / self._options.imagePanSmoothness;\n\n                position( distY, curY, 'Top' );\n                position( distX, curX, 'Left' );\n\n            };\n\n        // we need to use scroll in IE8 to speed things up\n        if ( IE === 8 ) {\n\n            img.parent().scrollTop( curY * -1 ).scrollLeft( curX * -1 );\n            img.css({\n                top: 0,\n                left: 0\n            });\n\n        }\n\n        // unbind and bind event\n        this.$( 'stage' ).off( 'mousemove', calculate ).on( 'mousemove', calculate );\n\n        // loop the loop\n        this.addTimer( 'pan' + self._id, loop, 50, true);\n\n        return this;\n    },\n\n    /**\n        Brings the scope into any callback\n\n        @param fn The callback to bring the scope into\n        @param [scope] Optional scope to bring\n\n        @example $('#fullscreen').click( this.proxy(function() { this.enterFullscreen(); }) )\n\n        @returns {Function} Return the callback with the gallery scope\n    */\n\n    proxy : function( fn, scope ) {\n        if ( typeof fn !== 'function' ) {\n            return F;\n        }\n        scope = scope || this;\n        return function() {\n            return fn.apply( scope, Utils.array( arguments ) );\n        };\n    },\n\n    /**\n        Removes the panning effect set by addPan()\n\n        @returns Instance\n    */\n\n    removePan: function() {\n\n        // todo: doublecheck IE8\n\n        this.$( 'stage' ).off( 'mousemove' );\n\n        this.clearTimer( 'pan' + this._id );\n\n        return this;\n    },\n\n    /**\n        Adds an element to the Galleria DOM array.\n        When you add an element here, you can access it using element ID in many API calls\n\n        @param {string} id The element ID you wish to use. You can add many elements by adding more arguments.\n\n        @example addElement('mybutton');\n        @example addElement('mybutton','mylink');\n\n        @returns Instance\n    */\n\n    addElement : function( id ) {\n\n        var dom = this._dom;\n\n        $.each( Utils.array(arguments), function( i, blueprint ) {\n           dom[ blueprint ] = Utils.create( 'galleria-' + blueprint );\n        });\n\n        return this;\n    },\n\n    /**\n        Attach keyboard events to Galleria\n\n        @param {Object} map The map object of events.\n        Possible keys are 'UP', 'DOWN', 'LEFT', 'RIGHT', 'RETURN', 'ESCAPE', 'BACKSPACE', and 'SPACE'.\n\n        @example\n\nthis.attachKeyboard({\n    right: this.next,\n    left: this.prev,\n    up: function() {\n        console.log( 'up key pressed' )\n    }\n});\n\n        @returns Instance\n    */\n\n    attachKeyboard : function( map ) {\n        this._keyboard.attach.apply( this._keyboard, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Detach all keyboard events to Galleria\n\n        @returns Instance\n    */\n\n    detachKeyboard : function() {\n        this._keyboard.detach.apply( this._keyboard, Utils.array( arguments ) );\n        return this;\n    },\n\n    /**\n        Fast helper for appending galleria elements that you added using addElement()\n\n        @param {string} parentID The parent element ID where the element will be appended\n        @param {string} childID the element ID that should be appended\n\n        @example this.addElement('myElement');\n        this.appendChild( 'info', 'myElement' );\n\n        @returns Instance\n    */\n\n    appendChild : function( parentID, childID ) {\n        this.$( parentID ).append( this.get( childID ) || childID );\n        return this;\n    },\n\n    /**\n        Fast helper for prepending galleria elements that you added using addElement()\n\n        @param {string} parentID The parent element ID where the element will be prepended\n        @param {string} childID the element ID that should be prepended\n\n        @example\n\nthis.addElement('myElement');\nthis.prependChild( 'info', 'myElement' );\n\n        @returns Instance\n    */\n\n    prependChild : function( parentID, childID ) {\n        this.$( parentID ).prepend( this.get( childID ) || childID );\n        return this;\n    },\n\n    /**\n        Remove an element by blueprint\n\n        @param {string} elemID The element to be removed.\n        You can remove multiple elements by adding arguments.\n\n        @returns Instance\n    */\n\n    remove : function( elemID ) {\n        this.$( Utils.array( arguments ).join(',') ).remove();\n        return this;\n    },\n\n    // a fast helper for building dom structures\n    // leave this out of the API for now\n\n    append : function( data ) {\n        var i, j;\n        for( i in data ) {\n            if ( data.hasOwnProperty( i ) ) {\n                if ( data[i].constructor === Array ) {\n                    for( j = 0; data[i][j]; j++ ) {\n                        this.appendChild( i, data[i][j] );\n                    }\n                } else {\n                    this.appendChild( i, data[i] );\n                }\n            }\n        }\n        return this;\n    },\n\n    // an internal helper for scaling according to options\n    _scaleImage : function( image, options ) {\n\n        image = image || this._controls.getActive();\n\n        // janpub (JH) fix:\n        // image might be unselected yet\n        // e.g. when external logics rescales the gallery on window resize events\n        if( !image ) {\n            return;\n        }\n\n        var complete,\n\n            scaleLayer = function( img ) {\n                $( img.container ).children(':first').css({\n                    top: M.max(0, Utils.parseValue( img.image.style.top )),\n                    left: M.max(0, Utils.parseValue( img.image.style.left )),\n                    width: Utils.parseValue( img.image.width ),\n                    height: Utils.parseValue( img.image.height )\n                });\n            };\n\n        options = $.extend({\n            width:       this._stageWidth,\n            height:      this._stageHeight,\n            crop:        this._options.imageCrop,\n            max:         this._options.maxScaleRatio,\n            min:         this._options.minScaleRatio,\n            margin:      this._options.imageMargin,\n            position:    this._options.imagePosition,\n            iframelimit: this._options.maxVideoSize\n        }, options );\n\n        if ( this._options.layerFollow && this._options.imageCrop !== true ) {\n\n            if ( typeof options.complete == 'function' ) {\n                complete = options.complete;\n                options.complete = function() {\n                    complete.call( image, image );\n                    scaleLayer( image );\n                };\n            } else {\n                options.complete = scaleLayer;\n            }\n\n        } else {\n            $( image.container ).children(':first').css({ top: 0, left: 0 });\n        }\n\n        image.scale( options );\n        return this;\n    },\n\n    /**\n        Updates the carousel,\n        useful if you resize the gallery and want to re-check if the carousel nav is needed.\n\n        @returns Instance\n    */\n\n    updateCarousel : function() {\n        this._carousel.update();\n        return this;\n    },\n\n    /**\n        Resize the entire gallery container\n\n        @param {Object} [measures] Optional object with width/height specified\n        @param {Function} [complete] The callback to be called when the scaling is complete\n\n        @returns Instance\n    */\n\n    resize : function( measures, complete ) {\n\n        if ( typeof measures == 'function' ) {\n            complete = measures;\n            measures = undef;\n        }\n\n        measures = $.extend( { width:0, height:0 }, measures );\n\n        var self = this,\n            $container = this.$( 'container' );\n\n        $.each( measures, function( m, val ) {\n            if ( !val ) {\n                $container[ m ]( 'auto' );\n                measures[ m ] = self._getWH()[ m ];\n            }\n        });\n\n        $.each( measures, function( m, val ) {\n            $container[ m ]( val );\n        });\n\n        return this.rescale( complete );\n\n    },\n\n    /**\n        Rescales the gallery\n\n        @param {number} width The target width\n        @param {number} height The target height\n        @param {Function} complete The callback to be called when the scaling is complete\n\n        @returns Instance\n    */\n\n    rescale : function( width, height, complete ) {\n\n        var self = this;\n\n        // allow rescale(fn)\n        if ( typeof width === 'function' ) {\n            complete = width;\n            width = undef;\n        }\n\n        var scale = function() {\n\n            // set stagewidth\n            self._stageWidth = width || self.$( 'stage' ).width();\n            self._stageHeight = height || self.$( 'stage' ).height();\n\n            if ( self._options.swipe ) {\n                $.each( self._controls.slides, function(i, img) {\n                    self._scaleImage( img );\n                    $( img.container ).css('left', self._stageWidth * i);\n                });\n                self.$('images').css('width', self._stageWidth * self.getDataLength());\n            } else {\n                // scale the active image\n                self._scaleImage();\n            }\n\n            if ( self._options.carousel ) {\n                self.updateCarousel();\n            }\n\n            self._controls.frames[ self._controls.active ].scale({\n                width: self._stageWidth,\n                height: self._stageHeight,\n                iframelimit: self._options.maxVideoSize\n            });\n\n            self.trigger( Galleria.RESCALE );\n\n            if ( typeof complete === 'function' ) {\n                complete.call( self );\n            }\n        };\n\n        scale.call( self );\n\n        return this;\n    },\n\n    /**\n        Refreshes the gallery.\n        Useful if you change image options at runtime and want to apply the changes to the active image.\n\n        @returns Instance\n    */\n\n    refreshImage : function() {\n        this._scaleImage();\n        if ( this._options.imagePan ) {\n            this.addPan();\n        }\n        return this;\n    },\n\n    /**\n        Shows an image by index\n\n        @param {number|boolean} index The index to show\n        @param {Boolean} rewind A boolean that should be true if you want the transition to go back\n\n        @returns Instance\n    */\n\n    show : function( index, rewind, _history ) {\n\n        var swipe = this._options.swipe;\n\n        // do nothing queue is long || index is false || queue is false and transition is in progress\n        if ( !swipe &&\n            ( this._queue.length > 3 || index === false || ( !this._options.queue && this._queue.stalled ) ) ) {\n            return;\n        }\n\n        index = M.max( 0, M.min( parseInt( index, 10 ), this.getDataLength() - 1 ) );\n\n        rewind = typeof rewind !== 'undefined' ? !!rewind : index < this.getIndex();\n\n        _history = _history || false;\n\n        // do the history thing and return\n        if ( !_history && Galleria.History ) {\n            Galleria.History.set( index.toString() );\n            return;\n        }\n\n        if ( this.finger && index !== this._active ) {\n            this.finger.to = -( index*this.finger.width );\n            this.finger.index = index;\n        }\n        this._active = index;\n\n        // we do things a bit simpler in swipe:\n        if ( swipe ) {\n\n            var data = this.getData(index),\n                self = this;\n            if ( !data ) {\n                return;\n            }\n\n            var src = this.isFullscreen() && data.big ? data.big : ( data.image || data.iframe ),\n                image = this._controls.slides[index],\n                cached = image.isCached( src ),\n                thumb = this._thumbnails[ index ];\n\n            var evObj = {\n                cached: cached,\n                index: index,\n                rewind: rewind,\n                imageTarget: image.image,\n                thumbTarget: thumb.image,\n                galleriaData: data\n            };\n\n            this.trigger($.extend(evObj, {\n                type: Galleria.LOADSTART\n            }));\n\n            $( self._thumbnails[ index ].container )\n                .addClass( 'active' )\n                .siblings( '.active' )\n                .removeClass( 'active' );\n\n            self.$('container').removeClass( 'videoplay' );\n\n            var complete = function() {\n\n                self._layers[index].innerHTML = self.getData().layer || '';\n\n                self.trigger($.extend(evObj, {\n                    type: Galleria.LOADFINISH\n                }));\n                self._playCheck();\n            };\n\n            window.setTimeout(function() {\n\n                // load if not ready\n                if ( !image.ready ) {\n                    if ( data.iframe && !data.image ) {\n                        image.isIframe = true;\n                    }\n                    image.load(src, function(image) {\n                        self._scaleImage(image, complete).trigger($.extend(evObj, {\n                            type: Galleria.IMAGE\n                        }));\n                        complete();\n                    });\n                } else {\n                    self.trigger($.extend(evObj, {\n                        type: Galleria.IMAGE\n                    }));\n                    complete();\n                }\n            }, 100);\n\n        } else {\n            protoArray.push.call( this._queue, {\n                index : index,\n                rewind : rewind\n            });\n            if ( !this._queue.stalled ) {\n                this._show();\n            }\n        }\n\n        return this;\n    },\n\n    // the internal _show method does the actual showing\n    _show : function() {\n\n        // shortcuts\n        var self = this,\n            queue = this._queue[ 0 ],\n            data = this.getData( queue.index );\n\n        if ( !data ) {\n            return;\n        }\n\n        var src = this.isFullscreen() && data.big ? data.big : ( data.image || data.iframe ),\n            active = this._controls.getActive(),\n            next = this._controls.getNext(),\n            cached = next.isCached( src ),\n            thumb = this._thumbnails[ queue.index ],\n            mousetrigger = function() {\n                $( next.image ).trigger( 'mouseup' );\n            };\n\n        self.$('container').toggleClass('iframe', !!data.isIframe).removeClass( 'videoplay' );\n\n        // to be fired when loading & transition is complete:\n        var complete = (function( data, next, active, queue, thumb ) {\n\n            return function() {\n\n                var win;\n\n                _transitions.active = false;\n\n                // optimize quality\n                Utils.toggleQuality( next.image, self._options.imageQuality );\n\n                // remove old layer\n                self._layers[ self._controls.active ].innerHTML = '';\n\n                // swap\n                $( active.container ).css({\n                    zIndex: 0,\n                    opacity: 0\n                }).show();\n\n                $( active.container ).find( 'iframe, .galleria-videoicon' ).remove();\n                $( self._controls.frames[ self._controls.active ].container ).hide();\n\n                $( next.container ).css({\n                    zIndex: 1,\n                    left: 0,\n                    top: 0\n                }).show();\n\n                self._controls.swap();\n\n                // add pan according to option\n                if ( self._options.imagePan ) {\n                    self.addPan( next.image );\n                }\n\n                // make the image clickable\n                // order of precedence: iframe, link, lightbox, clicknext\n                if ( ( data.iframe && data.image ) || data.link || self._options.lightbox || self._options.clicknext ) {\n\n                    $( next.image ).css({\n                        cursor: 'pointer'\n                    }).on( 'mouseup', function( e ) {\n\n                        // non-left click\n                        if ( typeof e.which == 'number' && e.which > 1 ) {\n                            return;\n                        }\n\n                        // iframe / video\n                        if ( data.iframe ) {\n\n                            if ( self.isPlaying() ) {\n                                self.pause();\n                            }\n                            var frame = self._controls.frames[ self._controls.active ],\n                                w = self._stageWidth,\n                                h = self._stageHeight;\n\n                            $( frame.container ).css({\n                                width: w,\n                                height: h,\n                                opacity: 0\n                            }).show().animate({\n                                opacity: 1\n                            }, 200);\n\n                            window.setTimeout(function() {\n                                frame.load( data.iframe + ( data.video ? '&autoplay=1' : '' ), {\n                                    width: w,\n                                    height: h\n                                }, function( frame ) {\n                                    self.$( 'container' ).addClass( 'videoplay' );\n                                    frame.scale({\n                                        width: self._stageWidth,\n                                        height: self._stageHeight,\n                                        iframelimit: data.video ? self._options.maxVideoSize : undef\n                                    });\n                                });\n                            }, 100);\n\n                            return;\n                        }\n\n                        // clicknext\n                        if ( self._options.clicknext && !Galleria.TOUCH ) {\n                            if ( self._options.pauseOnInteraction ) {\n                                self.pause();\n                            }\n                            self.next();\n                            return;\n                        }\n\n                        // popup link\n                        if ( data.link ) {\n                            if ( self._options.popupLinks ) {\n                                win = window.open( data.link, '_blank' );\n                            } else {\n                                window.location.href = data.link;\n                            }\n                            return;\n                        }\n\n                        if ( self._options.lightbox ) {\n                            self.openLightbox();\n                        }\n\n                    });\n                }\n\n                // check if we are playing\n                self._playCheck();\n\n                // trigger IMAGE event\n                self.trigger({\n                    type: Galleria.IMAGE,\n                    index: queue.index,\n                    imageTarget: next.image,\n                    thumbTarget: thumb.image,\n                    galleriaData: data\n                });\n\n                // remove the queued image\n                protoArray.shift.call( self._queue );\n\n                // remove stalled\n                self._queue.stalled = false;\n\n                // if we still have images in the queue, show it\n                if ( self._queue.length ) {\n                    self._show();\n                }\n\n            };\n        }( data, next, active, queue, thumb ));\n\n        // let the carousel follow\n        if ( this._options.carousel && this._options.carouselFollow ) {\n            this._carousel.follow( queue.index );\n        }\n\n        // preload images\n        if ( this._options.preload ) {\n\n            var p, i,\n                n = this.getNext(),\n                ndata;\n\n            try {\n                for ( i = this._options.preload; i > 0; i-- ) {\n                    p = new Galleria.Picture();\n                    ndata = self.getData( n );\n                    p.preload( this.isFullscreen() && ndata.big ? ndata.big : ndata.image );\n                    n = self.getNext( n );\n                }\n            } catch(e) {}\n        }\n\n        // show the next image, just in case\n        Utils.show( next.container );\n\n        next.isIframe = data.iframe && !data.image;\n\n        // add active classes\n        $( self._thumbnails[ queue.index ].container )\n            .addClass( 'active' )\n            .siblings( '.active' )\n            .removeClass( 'active' );\n\n        // trigger the LOADSTART event\n        self.trigger( {\n            type: Galleria.LOADSTART,\n            cached: cached,\n            index: queue.index,\n            rewind: queue.rewind,\n            imageTarget: next.image,\n            thumbTarget: thumb.image,\n            galleriaData: data\n        });\n\n        // stall the queue\n        self._queue.stalled = true;\n\n        // begin loading the next image\n        next.load( src, function( next ) {\n\n            // add layer HTML\n            var layer = $( self._layers[ 1-self._controls.active ] ).html( data.layer || '' ).hide();\n\n            self._scaleImage( next, {\n\n                complete: function( next ) {\n\n                    // toggle low quality for IE\n                    if ( 'image' in active ) {\n                        Utils.toggleQuality( active.image, false );\n                    }\n                    Utils.toggleQuality( next.image, false );\n\n                    // remove the image panning, if applied\n                    // TODO: rethink if this is necessary\n                    self.removePan();\n\n                    // set the captions and counter\n                    self.setInfo( queue.index );\n                    self.setCounter( queue.index );\n\n                    // show the layer now\n                    if ( data.layer ) {\n                        layer.show();\n                        // inherit click events set on image\n                        if ( ( data.iframe && data.image ) || data.link || self._options.lightbox || self._options.clicknext ) {\n                            layer.css( 'cursor', 'pointer' ).off( 'mouseup' ).mouseup( mousetrigger );\n                        }\n                    }\n\n                    // add play icon\n                    if( data.video && data.image ) {\n                        _playIcon( next.container );\n                    }\n\n                    var transition = self._options.transition;\n\n                    // can JavaScript loop through objects in order? yes.\n                    $.each({\n                        initial: active.image === null,\n                        touch: Galleria.TOUCH,\n                        fullscreen: self.isFullscreen()\n                    }, function( type, arg ) {\n                        if ( arg && self._options[ type + 'Transition' ] !== undef ) {\n                            transition = self._options[ type + 'Transition' ];\n                            return false;\n                        }\n                    });\n\n                    // validate the transition\n                    if ( transition in _transitions.effects === false ) {\n                        complete();\n                    } else {\n                        var params = {\n                            prev: active.container,\n                            next: next.container,\n                            rewind: queue.rewind,\n                            speed: self._options.transitionSpeed || 400\n                        };\n\n                        _transitions.active = true;\n\n                        // call the transition function and send some stuff\n                        _transitions.init.call( self, transition, params, complete );\n\n                    }\n\n                    // trigger the LOADFINISH event\n                    self.trigger({\n                        type: Galleria.LOADFINISH,\n                        cached: cached,\n                        index: queue.index,\n                        rewind: queue.rewind,\n                        imageTarget: next.image,\n                        thumbTarget: self._thumbnails[ queue.index ].image,\n                        galleriaData: self.getData( queue.index )\n                    });\n                }\n            });\n        });\n    },\n\n    /**\n        Gets the next index\n\n        @param {number} [base] Optional starting point\n\n        @returns {number} the next index, or the first if you are at the first (looping)\n    */\n\n    getNext : function( base ) {\n        base = typeof base === 'number' ? base : this.getIndex();\n        return base === this.getDataLength() - 1 ? 0 : base + 1;\n    },\n\n    /**\n        Gets the previous index\n\n        @param {number} [base] Optional starting point\n\n        @returns {number} the previous index, or the last if you are at the first (looping)\n    */\n\n    getPrev : function( base ) {\n        base = typeof base === 'number' ? base : this.getIndex();\n        return base === 0 ? this.getDataLength() - 1 : base - 1;\n    },\n\n    /**\n        Shows the next image in line\n\n        @returns Instance\n    */\n\n    next : function() {\n        if ( this.getDataLength() > 1 ) {\n            this.show( this.getNext(), false );\n        }\n        return this;\n    },\n\n    /**\n        Shows the previous image in line\n\n        @returns Instance\n    */\n\n    prev : function() {\n        if ( this.getDataLength() > 1 ) {\n            this.show( this.getPrev(), true );\n        }\n        return this;\n    },\n\n    /**\n        Retrieve a DOM element by element ID\n\n        @param {string} elemId The delement ID to fetch\n\n        @returns {HTMLElement} The elements DOM node or null if not found.\n    */\n\n    get : function( elemId ) {\n        return elemId in this._dom ? this._dom[ elemId ] : null;\n    },\n\n    /**\n        Retrieve a data object\n\n        @param {number} index The data index to retrieve.\n        If no index specified it will take the currently active image\n\n        @returns {Object} The data object\n    */\n\n    getData : function( index ) {\n        return index in this._data ?\n            this._data[ index ] : this._data[ this._active ];\n    },\n\n    /**\n        Retrieve the number of data items\n\n        @returns {number} The data length\n    */\n    getDataLength : function() {\n        return this._data.length;\n    },\n\n    /**\n        Retrieve the currently active index\n\n        @returns {number|boolean} The active index or false if none found\n    */\n\n    getIndex : function() {\n        return typeof this._active === 'number' ? this._active : false;\n    },\n\n    /**\n        Retrieve the stage height\n\n        @returns {number} The stage height\n    */\n\n    getStageHeight : function() {\n        return this._stageHeight;\n    },\n\n    /**\n        Retrieve the stage width\n\n        @returns {number} The stage width\n    */\n\n    getStageWidth : function() {\n        return this._stageWidth;\n    },\n\n    /**\n        Retrieve the option\n\n        @param {string} key The option key to retrieve. If no key specified it will return all options in an object.\n\n        @returns option or options\n    */\n\n    getOptions : function( key ) {\n        return typeof key === 'undefined' ? this._options : this._options[ key ];\n    },\n\n    /**\n        Set options to the instance.\n        You can set options using a key & value argument or a single object argument (see examples)\n\n        @param {string} key The option key\n        @param {string} value the the options value\n\n        @example setOptions( 'autoplay', true )\n        @example setOptions({ autoplay: true });\n\n        @returns Instance\n    */\n\n    setOptions : function( key, value ) {\n        if ( typeof key === 'object' ) {\n            $.extend( this._options, key );\n        } else {\n            this._options[ key ] = value;\n        }\n        return this;\n    },\n\n    /**\n        Starts playing the slideshow\n\n        @param {number} delay Sets the slideshow interval in milliseconds.\n        If you set it once, you can just call play() and get the same interval the next time.\n\n        @returns Instance\n    */\n\n    play : function( delay ) {\n\n        this._playing = true;\n\n        this._playtime = delay || this._playtime;\n\n        this._playCheck();\n\n        this.trigger( Galleria.PLAY );\n\n        return this;\n    },\n\n    /**\n        Stops the slideshow if currently playing\n\n        @returns Instance\n    */\n\n    pause : function() {\n\n        this._playing = false;\n\n        this.trigger( Galleria.PAUSE );\n\n        return this;\n    },\n\n    /**\n        Toggle between play and pause events.\n\n        @param {number} delay Sets the slideshow interval in milliseconds.\n\n        @returns Instance\n    */\n\n    playToggle : function( delay ) {\n        return ( this._playing ) ? this.pause() : this.play( delay );\n    },\n\n    /**\n        Checks if the gallery is currently playing\n\n        @returns {Boolean}\n    */\n\n    isPlaying : function() {\n        return this._playing;\n    },\n\n    /**\n        Checks if the gallery is currently in fullscreen mode\n\n        @returns {Boolean}\n    */\n\n    isFullscreen : function() {\n        return this._fullscreen.active;\n    },\n\n    _playCheck : function() {\n        var self = this,\n            played = 0,\n            interval = 20,\n            now = Utils.timestamp(),\n            timer_id = 'play' + this._id;\n\n        if ( this._playing ) {\n\n            this.clearTimer( timer_id );\n\n            var fn = function() {\n\n                played = Utils.timestamp() - now;\n                if ( played >= self._playtime && self._playing ) {\n                    self.clearTimer( timer_id );\n                    self.next();\n                    return;\n                }\n                if ( self._playing ) {\n\n                    // trigger the PROGRESS event\n                    self.trigger({\n                        type:         Galleria.PROGRESS,\n                        percent:      M.ceil( played / self._playtime * 100 ),\n                        seconds:      M.floor( played / 1000 ),\n                        milliseconds: played\n                    });\n\n                    self.addTimer( timer_id, fn, interval );\n                }\n            };\n            self.addTimer( timer_id, fn, interval );\n        }\n    },\n\n    /**\n        Modify the slideshow delay\n\n        @param {number} delay the number of milliseconds between slides,\n\n        @returns Instance\n    */\n\n    setPlaytime: function( delay ) {\n        this._playtime = delay;\n        return this;\n    },\n\n    setIndex: function( val ) {\n        this._active = val;\n        return this;\n    },\n\n    /**\n        Manually modify the counter\n\n        @param {number} [index] Optional data index to fectch,\n        if no index found it assumes the currently active index\n\n        @returns Instance\n    */\n\n    setCounter: function( index ) {\n\n        if ( typeof index === 'number' ) {\n            index++;\n        } else if ( typeof index === 'undefined' ) {\n            index = this.getIndex()+1;\n        }\n\n        this.get( 'current' ).innerHTML = index;\n\n        if ( IE ) { // weird IE bug\n\n            var count = this.$( 'counter' ),\n                opacity = count.css( 'opacity' );\n\n            if ( parseInt( opacity, 10 ) === 1) {\n                Utils.removeAlpha( count[0] );\n            } else {\n                this.$( 'counter' ).css( 'opacity', opacity );\n            }\n\n        }\n\n        return this;\n    },\n\n    /**\n        Manually set captions\n\n        @param {number} [index] Optional data index to fectch and apply as caption,\n        if no index found it assumes the currently active index\n\n        @returns Instance\n    */\n\n    setInfo : function( index ) {\n\n        var self = this,\n            data = this.getData( index );\n\n        $.each( ['title','description'], function( i, type ) {\n\n            var elem = self.$( 'info-' + type );\n\n            if ( !!data[type] ) {\n                elem[ data[ type ].length ? 'show' : 'hide' ]().html( data[ type ] );\n            } else {\n               elem.empty().hide();\n            }\n        });\n\n        return this;\n    },\n\n    /**\n        Checks if the data contains any captions\n\n        @param {number} [index] Optional data index to fectch,\n        if no index found it assumes the currently active index.\n\n        @returns {boolean}\n    */\n\n    hasInfo : function( index ) {\n\n        var check = 'title description'.split(' '),\n            i;\n\n        for ( i = 0; check[i]; i++ ) {\n            if ( !!this.getData( index )[ check[i] ] ) {\n                return true;\n            }\n        }\n        return false;\n\n    },\n\n    jQuery : function( str ) {\n\n        var self = this,\n            ret = [];\n\n        $.each( str.split(','), function( i, elemId ) {\n            elemId = $.trim( elemId );\n\n            if ( self.get( elemId ) ) {\n                ret.push( elemId );\n            }\n        });\n\n        var jQ = $( self.get( ret.shift() ) );\n\n        $.each( ret, function( i, elemId ) {\n            jQ = jQ.add( self.get( elemId ) );\n        });\n\n        return jQ;\n\n    },\n\n    /**\n        Converts element IDs into a jQuery collection\n        You can call for multiple IDs separated with commas.\n\n        @param {string} str One or more element IDs (comma-separated)\n\n        @returns jQuery\n\n        @example this.$('info,container').hide();\n    */\n\n    $ : function( str ) {\n        return this.jQuery.apply( this, Utils.array( arguments ) );\n    }\n\n};\n\n// End of Galleria prototype\n\n// Add events as static variables\n$.each( _events, function( i, ev ) {\n\n    // legacy events\n    var type = /_/.test( ev ) ? ev.replace( /_/g, '' ) : ev;\n\n    Galleria[ ev.toUpperCase() ] = 'galleria.'+type;\n\n} );\n\n$.extend( Galleria, {\n\n    // Browser helpers\n    IE9:     IE === 9,\n    IE8:     IE === 8,\n    IE7:     IE === 7,\n    IE6:     IE === 6,\n    IE:      IE,\n    WEBKIT:  /webkit/.test( NAV ),\n    CHROME:  /chrome/.test( NAV ),\n    SAFARI:  /safari/.test( NAV ) && !(/chrome/.test( NAV )),\n    QUIRK:   ( IE && doc.compatMode && doc.compatMode === \"BackCompat\" ),\n    MAC:     /mac/.test( navigator.platform.toLowerCase() ),\n    OPERA:   !!window.opera,\n    IPHONE:  /iphone/.test( NAV ),\n    IPAD:    /ipad/.test( NAV ),\n    ANDROID: /android/.test( NAV ),\n    TOUCH:   ('ontouchstart' in doc)\n\n});\n\n// Galleria static methods\n\n/**\n    Adds a theme that you can use for your Gallery\n\n    @param {Object} theme Object that should contain all your theme settings.\n    <ul>\n        <li>name - name of the theme</li>\n        <li>author - name of the author</li>\n        <li>css - css file name (not path)</li>\n        <li>defaults - default options to apply, including theme-specific options</li>\n        <li>init - the init function</li>\n    </ul>\n\n    @returns {Object} theme\n*/\n\nGalleria.addTheme = function( theme ) {\n\n    // make sure we have a name\n    if ( !theme.name ) {\n        Galleria.raise('No theme name specified');\n    }\n\n    if ( typeof theme.defaults !== 'object' ) {\n        theme.defaults = {};\n    } else {\n        theme.defaults = _legacyOptions( theme.defaults );\n    }\n\n    var css = false,\n        reg;\n\n    if ( typeof theme.css === 'string' ) {\n\n        // look for manually added CSS\n        $('link').each(function( i, link ) {\n            reg = new RegExp( theme.css );\n            if ( reg.test( link.href ) ) {\n\n                // we found the css\n                css = true;\n\n                // the themeload trigger\n                _themeLoad( theme );\n\n                return false;\n            }\n        });\n\n        // else look for the absolute path and load the CSS dynamic\n        if ( !css ) {\n\n\n            $(function() {\n                // Try to determine the css-path from the theme script.\n                // In IE8/9, the script-dom-element seems to be not present\n                // at once, if galleria itself is inserted into the dom\n                // dynamically. We therefore try multiple times before raising\n                // an error.\n                var retryCount = 0;\n                var tryLoadCss = function() {\n                    $('script').each(function (i, script) {\n                        // look for the theme script\n                        reg = new RegExp('galleria\\\\.' + theme.name.toLowerCase() + '\\\\.');\n                        if (reg.test(script.src)) {\n\n                            // we have a match\n                            css = script.src.replace(/[^\\/]*$/, '') + theme.css;\n\n                            window.setTimeout(function () {\n                                Utils.loadCSS(css, 'galleria-theme', function () {\n\n                                    // the themeload trigger\n                                    _themeLoad(theme);\n\n                                });\n                            }, 1);\n                        }\n                    });\n                    if (!css) {\n                        if (retryCount++ > 5) {\n                            Galleria.raise('No theme CSS loaded');\n                        } else {\n                            window.setTimeout(tryLoadCss, 500);\n                        }\n                    }\n                };\n                tryLoadCss();\n            });\n        }\n\n    } else {\n\n        // pass\n        _themeLoad( theme );\n    }\n    return theme;\n};\n\n/**\n    loadTheme loads a theme js file and attaches a load event to Galleria\n\n    @param {string} src The relative path to the theme source file\n\n    @param {Object} [options] Optional options you want to apply\n\n    @returns Galleria\n*/\n\nGalleria.loadTheme = function( src, options ) {\n\n    // Don't load if theme is already loaded\n    if( $('script').filter(function() { return $(this).attr('src') == src; }).length ) {\n        return;\n    }\n\n    var loaded = false,\n        err;\n\n    // start listening for the timeout onload\n    $( window ).load( function() {\n        if ( !loaded ) {\n            // give it another 20 seconds\n            err = window.setTimeout(function() {\n                if ( !loaded && !Galleria.theme ) {\n                    Galleria.raise( \"Galleria had problems loading theme at \" + src + \". Please check theme path or load manually.\", true );\n                }\n            }, 20000);\n        }\n    });\n\n    // first clear the current theme, if exists\n    Galleria.unloadTheme();\n\n    // load the theme\n    Utils.loadScript( src, function() {\n        loaded = true;\n        window.clearTimeout( err );\n    });\n\n    return Galleria;\n};\n\n/**\n    unloadTheme unloads the Galleria theme and prepares for a new theme\n\n    @returns Galleria\n*/\n\nGalleria.unloadTheme = function() {\n\n    if ( typeof Galleria.theme == 'object' ) {\n\n        $('script').each(function( i, script ) {\n\n            if( new RegExp( 'galleria\\\\.' + Galleria.theme.name + '\\\\.' ).test( script.src ) ) {\n                $( script ).remove();\n            }\n        });\n\n        Galleria.theme = undef;\n    }\n\n    return Galleria;\n};\n\n/**\n    Retrieves a Galleria instance.\n\n    @param {number} [index] Optional index to retrieve.\n    If no index is supplied, the method will return all instances in an array.\n\n    @returns Instance or Array of instances\n*/\n\nGalleria.get = function( index ) {\n    if ( !!_instances[ index ] ) {\n        return _instances[ index ];\n    } else if ( typeof index !== 'number' ) {\n        return _instances;\n    } else {\n        Galleria.raise('Gallery index ' + index + ' not found');\n    }\n};\n\n/**\n\n    Configure Galleria options via a static function.\n    The options will be applied to all instances\n\n    @param {string|object} key The options to apply or a key\n\n    @param [value] If key is a string, this is the value\n\n    @returns Galleria\n\n*/\n\nGalleria.configure = function( key, value ) {\n\n    var opts = {};\n\n    if( typeof key == 'string' && value ) {\n        opts[key] = value;\n        key = opts;\n    } else {\n        $.extend( opts, key );\n    }\n\n    Galleria.configure.options = opts;\n\n    $.each( Galleria.get(), function(i, instance) {\n        instance.setOptions( opts );\n    });\n\n    return Galleria;\n};\n\nGalleria.configure.options = {};\n\n/**\n\n    Bind a Galleria event to the gallery\n\n    @param {string} type A string representing the galleria event\n\n    @param {function} callback The function that should run when the event is triggered\n\n    @returns Galleria\n\n*/\n\nGalleria.on = function( type, callback ) {\n    if ( !type ) {\n        return;\n    }\n\n    callback = callback || F;\n\n    // hash the bind\n    var hash = type + callback.toString().replace(/\\s/g,'') + Utils.timestamp();\n\n    // for existing instances\n    $.each( Galleria.get(), function(i, instance) {\n        instance._binds.push( hash );\n        instance.bind( type, callback );\n    });\n\n    // for future instances\n    Galleria.on.binds.push({\n        type: type,\n        callback: callback,\n        hash: hash\n    });\n\n    return Galleria;\n};\n\nGalleria.on.binds = [];\n\n/**\n\n    Run Galleria\n    Alias for $(selector).galleria(options)\n\n    @param {string} selector A selector of element(s) to intialize galleria to\n\n    @param {object} options The options to apply\n\n    @returns Galleria\n\n*/\n\nGalleria.run = function( selector, options ) {\n    if ( $.isFunction( options ) ) {\n        options = { extend: options };\n    }\n    $( selector || '#galleria' ).galleria( options );\n    return Galleria;\n};\n\n/**\n    Creates a transition to be used in your gallery\n\n    @param {string} name The name of the transition that you will use as an option\n\n    @param {Function} fn The function to be executed in the transition.\n    The function contains two arguments, params and complete.\n    Use the params Object to integrate the transition, and then call complete when you are done.\n\n    @returns Galleria\n\n*/\n\nGalleria.addTransition = function( name, fn ) {\n    _transitions.effects[name] = fn;\n    return Galleria;\n};\n\n/**\n    The Galleria utilites\n*/\n\nGalleria.utils = Utils;\n\n/**\n    A helper metod for cross-browser logging.\n    It uses the console log if available otherwise it falls back to alert\n\n    @example Galleria.log(\"hello\", document.body, [1,2,3]);\n*/\n\nGalleria.log = function() {\n    var args = Utils.array( arguments );\n    if( 'console' in window && 'log' in window.console ) {\n        try {\n            return window.console.log.apply( window.console, args );\n        } catch( e ) {\n            $.each( args, function() {\n                window.console.log(this);\n            });\n        }\n    } else {\n        return window.alert( args.join('<br>') );\n    }\n};\n\n/**\n    A ready method for adding callbacks when a gallery is ready\n    Each method is call before the extend option for every instance\n\n    @param {function} callback The function to call\n\n    @returns Galleria\n*/\n\nGalleria.ready = function( fn ) {\n    if ( typeof fn != 'function' ) {\n        return Galleria;\n    }\n    $.each( _galleries, function( i, gallery ) {\n        fn.call( gallery, gallery._options );\n    });\n    Galleria.ready.callbacks.push( fn );\n    return Galleria;\n};\n\nGalleria.ready.callbacks = [];\n\n/**\n    Method for raising errors\n\n    @param {string} msg The message to throw\n\n    @param {boolean} [fatal] Set this to true to override debug settings and display a fatal error\n*/\n\nGalleria.raise = function( msg, fatal ) {\n\n    var type = fatal ? 'Fatal error' : 'Error',\n\n        css = {\n            color: '#fff',\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            zIndex: 100000\n        },\n\n        echo = function( msg ) {\n\n            var html = '<div style=\"padding:4px;margin:0 0 2px;background:#' +\n                ( fatal ? '811' : '222' ) + ';\">' +\n                ( fatal ? '<strong>' + type + ': </strong>' : '' ) +\n                msg + '</div>';\n\n            $.each( _instances, function() {\n\n                var cont = this.$( 'errors' ),\n                    target = this.$( 'target' );\n\n                if ( !cont.length ) {\n\n                    target.css( 'position', 'relative' );\n\n                    cont = this.addElement( 'errors' ).appendChild( 'target', 'errors' ).$( 'errors' ).css(css);\n                }\n                cont.append( html );\n\n            });\n\n            if ( !_instances.length ) {\n                $('<div>').css( $.extend( css, { position: 'fixed' } ) ).append( html ).appendTo( DOM().body );\n            }\n        };\n\n    // if debug is on, display errors and throw exception if fatal\n    if ( DEBUG ) {\n        echo( msg );\n        if ( fatal ) {\n            throw new Error(type + ': ' + msg);\n        }\n\n    // else just echo a silent generic error if fatal\n    } else if ( fatal ) {\n        if ( _hasError ) {\n            return;\n        }\n        _hasError = true;\n        fatal = false;\n        echo( 'Gallery could not load.' );\n    }\n};\n\n// Add the version\nGalleria.version = VERSION;\n\n/**\n    A method for checking what version of Galleria the user has installed and throws a readable error if the user needs to upgrade.\n    Useful when building plugins that requires a certain version to function.\n\n    @param {number} version The minimum version required\n\n    @param {string} [msg] Optional message to display. If not specified, Galleria will throw a generic error.\n\n    @returns Galleria\n*/\n\nGalleria.requires = function( version, msg ) {\n    msg = msg || 'You need to upgrade Galleria to version ' + version + ' to use one or more components.';\n    if ( Galleria.version < version ) {\n        Galleria.raise(msg, true);\n    }\n    return Galleria;\n};\n\n/**\n    Adds preload, cache, scale and crop functionality\n\n    @constructor\n\n    @requires jQuery\n\n    @param {number} [id] Optional id to keep track of instances\n*/\n\nGalleria.Picture = function( id ) {\n\n    // save the id\n    this.id = id || null;\n\n    // the image should be null until loaded\n    this.image = null;\n\n    // Create a new container\n    this.container = Utils.create('galleria-image');\n\n    // add container styles\n    $( this.container ).css({\n        overflow: 'hidden',\n        position: 'relative' // for IE Standards mode\n    });\n\n    // saves the original measurements\n    this.original = {\n        width: 0,\n        height: 0\n    };\n\n    // flag when the image is ready\n    this.ready = false;\n\n    // flag for iframe Picture\n    this.isIframe = false;\n\n};\n\nGalleria.Picture.prototype = {\n\n    // the inherited cache object\n    cache: {},\n\n    // show the image on stage\n    show: function() {\n        Utils.show( this.image );\n    },\n\n    // hide the image\n    hide: function() {\n        Utils.moveOut( this.image );\n    },\n\n    clear: function() {\n        this.image = null;\n    },\n\n    /**\n        Checks if an image is in cache\n\n        @param {string} src The image source path, ex '/path/to/img.jpg'\n\n        @returns {boolean}\n    */\n\n    isCached: function( src ) {\n        return !!this.cache[src];\n    },\n\n    /**\n        Preloads an image into the cache\n\n        @param {string} src The image source path, ex '/path/to/img.jpg'\n\n        @returns Galleria.Picture\n    */\n\n    preload: function( src ) {\n        $( new Image() ).load((function(src, cache) {\n            return function() {\n                cache[ src ] = src;\n            };\n        }( src, this.cache ))).attr( 'src', src );\n    },\n\n    /**\n        Loads an image and call the callback when ready.\n        Will also add the image to cache.\n\n        @param {string} src The image source path, ex '/path/to/img.jpg'\n        @param {Object} [size] The forced size of the image, defined as an object { width: xx, height:xx }\n        @param {Function} callback The function to be executed when the image is loaded & scaled\n\n        @returns The image container (jQuery object)\n    */\n\n    load: function(src, size, callback) {\n\n        if ( typeof size == 'function' ) {\n            callback = size;\n            size = null;\n        }\n\n        if( this.isIframe ) {\n            var id = 'if'+new Date().getTime();\n\n            var iframe = this.image = $('<iframe>', {\n                src: src,\n                frameborder: 0,\n                id: id,\n                allowfullscreen: true,\n                css: { visibility: 'hidden' }\n            })[0];\n\n            if ( size ) {\n                $( iframe ).css( size );\n            }\n\n            $( this.container ).find( 'iframe,img' ).remove();\n\n            this.container.appendChild( this.image );\n\n            $('#'+id).load( (function( self, callback ) {\n                return function() {\n                    window.setTimeout(function() {\n                        $( self.image ).css( 'visibility', 'visible' );\n                        if( typeof callback == 'function' ) {\n                            callback.call( self, self );\n                        }\n                    }, 10);\n                };\n            }( this, callback )));\n\n            return this.container;\n        }\n\n        this.image = new Image();\n\n        // IE8 opacity inherit bug\n        if ( Galleria.IE8 ) {\n            $( this.image ).css( 'filter', 'inherit' );\n        }\n\n        var reload = false,\n            resort = false,\n\n            // some jquery cache\n            $container = $( this.container ),\n            $image = $( this.image ),\n\n            onerror = function() {\n                if ( !reload ) {\n                    reload = true;\n                    // reload the image with a timestamp\n                    window.setTimeout((function(image, src) {\n                        return function() {\n                            image.attr('src', src + (src.indexOf('?') > -1 ? '&' : '?') + Utils.timestamp() );\n                        };\n                    }( $(this), src )), 50);\n                } else {\n                    // apply the dummy image if it exists\n                    if ( DUMMY ) {\n                        $( this ).attr( 'src', DUMMY );\n                    } else {\n                        Galleria.raise('Image not found: ' + src);\n                    }\n                }\n            },\n\n            // the onload method\n            onload = (function( self, callback, src ) {\n\n                return function() {\n\n                    var complete = function() {\n\n                        $( this ).off( 'load' );\n\n                        // save the original size\n                        self.original = size || {\n                            height: this.height,\n                            width: this.width\n                        };\n\n                        // translate3d if needed\n                        if ( Galleria.HAS3D ) {\n                            this.style.MozTransform = this.style.webkitTransform = 'translate3d(0,0,0)';\n                        }\n\n                        $container.append( this );\n\n                        self.cache[ src ] = src; // will override old cache\n\n                        if (typeof callback == 'function' ) {\n                            window.setTimeout(function() {\n                                callback.call( self, self );\n                            },1);\n                        }\n                    };\n\n                    // Delay the callback to \"fix\" the Adblock Bug\n                    // http://code.google.com/p/adblockforchrome/issues/detail?id=3701\n                    if ( ( !this.width || !this.height ) ) {\n                        (function( img ) {\n                            Utils.wait({\n                                until: function() {\n                                    return img.width && img.height;\n                                },\n                                success: function() {\n                                    complete.call( img );\n                                },\n                                error: function() {\n                                    if ( !resort ) {\n                                        $(new Image()).load( onload ).attr( 'src', img.src );\n                                        resort = true;\n                                    } else {\n                                        Galleria.raise('Could not extract width/height from image: ' + img.src +\n                                            '. Traced measures: width:' + img.width + 'px, height: ' + img.height + 'px.');\n                                    }\n                                },\n                                timeout: 100\n                            });\n                        }( this ));\n                    } else {\n                        complete.call( this );\n                    }\n                };\n            }( this, callback, src ));\n\n        // remove any previous images\n        $container.find( 'iframe,img' ).remove();\n\n        // append the image\n        $image.css( 'display', 'block');\n\n        // hide it for now\n        Utils.hide( this.image );\n\n        // remove any max/min scaling\n        $.each('minWidth minHeight maxWidth maxHeight'.split(' '), function(i, prop) {\n            $image.css(prop, (/min/.test(prop) ? '0' : 'none'));\n        });\n\n        // begin load and insert in cache when done\n        $image.load( onload ).on( 'error', onerror ).attr( 'src', src );\n\n        // return the container\n        return this.container;\n    },\n\n    /**\n        Scales and crops the image\n\n        @param {Object} options The method takes an object with a number of options:\n\n        <ul>\n            <li>width - width of the container</li>\n            <li>height - height of the container</li>\n            <li>min - minimum scale ratio</li>\n            <li>max - maximum scale ratio</li>\n            <li>margin - distance in pixels from the image border to the container</li>\n            <li>complete - a callback that fires when scaling is complete</li>\n            <li>position - positions the image, works like the css background-image property.</li>\n            <li>crop - defines how to crop. Can be true, false, 'width' or 'height'</li>\n            <li>canvas - set to true to try a canvas-based rescale</li>\n        </ul>\n\n        @returns The image container object (jQuery)\n    */\n\n    scale: function( options ) {\n\n        var self = this;\n\n        // extend some defaults\n        options = $.extend({\n            width: 0,\n            height: 0,\n            min: undef,\n            max: undef,\n            margin: 0,\n            complete: F,\n            position: 'center',\n            crop: false,\n            canvas: false,\n            iframelimit: undef\n        }, options);\n\n        if( this.isIframe ) {\n\n            var cw = options.width,\n                ch = options.height,\n                nw, nh;\n            if ( options.iframelimit ) {\n                var r = M.min( options.iframelimit/cw, options.iframelimit/ch );\n                if ( r < 1 ) {\n                    nw = cw * r;\n                    nh = ch * r;\n\n                    $( this.image ).css({\n                        top: ch/2-nh/2,\n                        left: cw/2-nw/2,\n                        position: 'absolute'\n                    });\n                } else {\n                    $( this.image ).css({\n                        top: 0,\n                        left: 0\n                    });\n                }\n            }\n            $( this.image ).width( nw || cw ).height( nh || ch ).removeAttr( 'width' ).removeAttr( 'height' );\n            $( this.container ).width( cw ).height( ch );\n            options.complete.call(self, self);\n            try {\n                if( this.image.contentWindow ) {\n                    $( this.image.contentWindow ).trigger('resize');\n                }\n            } catch(e) {}\n            return this.container;\n\n        }\n\n        // return the element if no image found\n        if (!this.image) {\n            return this.container;\n        }\n\n        // store locale variables\n        var width,\n            height,\n            $container = $( self.container ),\n            data;\n\n        // wait for the width/height\n        Utils.wait({\n            until: function() {\n                width  = options.width ||\n                         $container.width() ||\n                         Utils.parseValue( $container.css('width') );\n\n                height = options.height ||\n                         $container.height() ||\n                         Utils.parseValue( $container.css('height') );\n\n                return width && height;\n            },\n            success: function() {\n\n                // calculate some cropping\n                var newWidth = ( width - options.margin * 2 ) / self.original.width,\n                    newHeight = ( height - options.margin * 2 ) / self.original.height,\n                    min = M.min( newWidth, newHeight ),\n                    max = M.max( newWidth, newHeight ),\n                    cropMap = {\n                        'true'  : max,\n                        'width' : newWidth,\n                        'height': newHeight,\n                        'false' : min,\n                        'landscape': self.original.width > self.original.height ? max : min,\n                        'portrait': self.original.width < self.original.height ? max : min\n                    },\n                    ratio = cropMap[ options.crop.toString() ],\n                    canvasKey = '';\n\n                // allow maxScaleRatio\n                if ( options.max ) {\n                    ratio = M.min( options.max, ratio );\n                }\n\n                // allow minScaleRatio\n                if ( options.min ) {\n                    ratio = M.max( options.min, ratio );\n                }\n\n                $.each( ['width','height'], function( i, m ) {\n                    $( self.image )[ m ]( self[ m ] = self.image[ m ] = M.round( self.original[ m ] * ratio ) );\n                });\n\n                $( self.container ).width( width ).height( height );\n\n                if ( options.canvas && _canvas ) {\n\n                    _canvas.elem.width = self.width;\n                    _canvas.elem.height = self.height;\n\n                    canvasKey = self.image.src + ':' + self.width + 'x' + self.height;\n\n                    self.image.src = _canvas.cache[ canvasKey ] || (function( key ) {\n\n                        _canvas.context.drawImage(self.image, 0, 0, self.original.width*ratio, self.original.height*ratio);\n\n                        try {\n\n                            data = _canvas.elem.toDataURL();\n                            _canvas.length += data.length;\n                            _canvas.cache[ key ] = data;\n                            return data;\n\n                        } catch( e ) {\n                            return self.image.src;\n                        }\n\n                    }( canvasKey ) );\n\n                }\n\n                // calculate image_position\n                var pos = {},\n                    mix = {},\n                    getPosition = function(value, measure, margin) {\n                        var result = 0;\n                        if (/\\%/.test(value)) {\n                            var flt = parseInt( value, 10 ) / 100,\n                                m = self.image[ measure ] || $( self.image )[ measure ]();\n\n                            result = M.ceil( m * -1 * flt + margin * flt );\n                        } else {\n                            result = Utils.parseValue( value );\n                        }\n                        return result;\n                    },\n                    positionMap = {\n                        'top': { top: 0 },\n                        'left': { left: 0 },\n                        'right': { left: '100%' },\n                        'bottom': { top: '100%' }\n                    };\n\n                $.each( options.position.toLowerCase().split(' '), function( i, value ) {\n                    if ( value === 'center' ) {\n                        value = '50%';\n                    }\n                    pos[i ? 'top' : 'left'] = value;\n                });\n\n                $.each( pos, function( i, value ) {\n                    if ( positionMap.hasOwnProperty( value ) ) {\n                        $.extend( mix, positionMap[ value ] );\n                    }\n                });\n\n                pos = pos.top ? $.extend( pos, mix ) : mix;\n\n                pos = $.extend({\n                    top: '50%',\n                    left: '50%'\n                }, pos);\n\n                // apply position\n                $( self.image ).css({\n                    position : 'absolute',\n                    top :  getPosition(pos.top, 'height', height),\n                    left : getPosition(pos.left, 'width', width)\n                });\n\n                // show the image\n                self.show();\n\n                // flag ready and call the callback\n                self.ready = true;\n                options.complete.call( self, self );\n\n            },\n            error: function() {\n                Galleria.raise('Could not scale image: '+self.image.src);\n            },\n            timeout: 1000\n        });\n        return this;\n    }\n};\n\n// our own easings\n$.extend( $.easing, {\n\n    galleria: function (_, t, b, c, d) {\n        if ((t/=d/2) < 1) {\n            return c/2*t*t*t + b;\n        }\n        return c/2*((t-=2)*t*t + 2) + b;\n    },\n\n    galleriaIn: function (_, t, b, c, d) {\n        return c*(t/=d)*t + b;\n    },\n\n    galleriaOut: function (_, t, b, c, d) {\n        return -c *(t/=d)*(t-2) + b;\n    }\n\n});\n\n// Forked version of Ainos Finger.js for native-style touch\n\nGalleria.Finger = (function() {\n\n    var abs = M.abs;\n\n    // test for translate3d support\n    var has3d = Galleria.HAS3D = (function() {\n\n        var el = doc.createElement('p'),\n            has3d,\n            t = ['webkit','O','ms','Moz',''],\n            s,\n            i=0,\n            a = 'transform';\n\n        DOM().html.insertBefore(el, null);\n\n        for (; t[i]; i++) {\n            s = t[i] ? t[i]+'Transform' : a;\n            if (el.style[s] !== undefined) {\n                el.style[s] = \"translate3d(1px,1px,1px)\";\n                has3d = $(el).css(t[i] ? '-'+t[i].toLowerCase()+'-'+a : a);\n            }\n        }\n\n        DOM().html.removeChild(el);\n        return (has3d !== undefined && has3d.length > 0 && has3d !== \"none\");\n    }());\n\n    // request animation shim\n    var requestFrame = (function(){\n        var r = 'RequestAnimationFrame';\n        return window.requestAnimationFrame ||\n               window['webkit'+r] ||\n               window['moz'+r] ||\n               window['o'+r] ||\n               window['ms'+r] ||\n               function( callback ) {\n                   window.setTimeout(callback, 1000 / 60);\n               };\n    }());\n\n    var Finger = function(elem, options) {\n\n        // default options\n        this.config = {\n            start: 0,\n            duration: 500,\n            onchange: function() {},\n            oncomplete: function() {},\n            easing: function(x,t,b,c,d) {\n                return -c * ((t=t/d-1)*t*t*t - 1) + b; // easeOutQuart\n            }\n        };\n\n        this.easeout = function (x, t, b, c, d) {\n            return c*((t=t/d-1)*t*t*t*t + 1) + b;\n        };\n\n        if ( !elem.children.length ) {\n            return;\n        }\n\n        var self = this;\n\n        // extend options\n        $.extend(this.config, options);\n\n        this.elem = elem;\n        this.child = elem.children[0];\n        this.to = this.pos = 0;\n        this.touching = false;\n        this.start = {};\n        this.index = this.config.start;\n        this.anim = 0;\n        this.easing = this.config.easing;\n\n        if ( !has3d ) {\n          this.child.style.position = 'absolute';\n          this.elem.style.position = 'relative';\n        }\n\n        // Bind event handlers to context\n        $.each(['ontouchstart','ontouchmove','ontouchend','setup'], function(i, fn) {\n            self[fn] = (function(caller) {\n                return function() {\n                    caller.apply( self, arguments );\n                };\n            }(self[fn]));\n        });\n\n        // the physical animator\n        this.setX = function() {\n\n            var style = self.child.style;\n\n            if (!has3d) {\n                // this is actually faster than CSS3 translate\n                style.left = self.pos+'px';\n                return;\n            }\n            style.MozTransform = style.webkitTransform = 'translate3d(' + self.pos + 'px,0,0)';\n            return;\n        };\n\n        // bind events\n        $(elem).on('touchstart', this.ontouchstart);\n        $(window).on('resize', this.setup);\n        $(window).on('orientationchange', this.setup);\n\n        // set up width\n        this.setup();\n\n        // start the animations\n        (function animloop(){\n          requestFrame(animloop);\n          self.loop.call( self );\n        }());\n\n    };\n\n    Finger.prototype = {\n\n        constructor: Finger,\n\n        setup: function() {\n            this.width = $( this.elem ).width();\n            this.length = M.ceil( $(this.child).width() / this.width );\n            if ( this.index !== 0 ) {\n                this.index = M.max(0, M.min( this.index, this.length-1 ) );\n                this.pos = this.to = -this.width*this.index;\n            }\n        },\n\n        setPosition: function(pos) {\n            this.pos = pos;\n            this.to = pos;\n        },\n\n        ontouchstart: function(e) {\n\n            var touch = e.originalEvent.touches;\n\n            this.start = {\n                pageX: touch[0].pageX,\n                pageY: touch[0].pageY,\n                time:  +new Date()\n            };\n\n            this.isScrolling = null;\n            this.touching = true;\n            this.deltaX = 0;\n\n            $doc.on('touchmove', this.ontouchmove);\n            $doc.on('touchend', this.ontouchend);\n        },\n\n        ontouchmove: function(e) {\n\n            var touch = e.originalEvent.touches;\n\n            // ensure swiping with one touch and not pinching\n            if( touch && touch.length > 1 || e.scale && e.scale !== 1 ) {\n                return;\n            }\n\n            this.deltaX = touch[0].pageX - this.start.pageX;\n\n            // determine if scrolling test has run - one time test\n            if ( this.isScrolling === null ) {\n                this.isScrolling = !!(\n                    this.isScrolling ||\n                    M.abs(this.deltaX) < M.abs(touch[0].pageY - this.start.pageY)\n                );\n            }\n\n            // if user is not trying to scroll vertically\n            if (!this.isScrolling) {\n\n                // prevent native scrolling\n                e.preventDefault();\n\n                // increase resistance if first or last slide\n                this.deltaX /= ( (!this.index && this.deltaX > 0 || this.index == this.length - 1 && this.deltaX < 0 ) ?\n                    ( M.abs(this.deltaX) / this.width + 1.8 )  : 1 );\n                this.to = this.deltaX - this.index * this.width;\n            }\n            e.stopPropagation();\n        },\n\n        ontouchend: function(e) {\n\n            this.touching = false;\n\n            // determine if slide attempt triggers next/prev slide\n            var isValidSlide = +new Date() - this.start.time < 250 &&\n                M.abs(this.deltaX) > 40 ||\n                M.abs(this.deltaX) > this.width/2,\n\n                isPastBounds = !this.index && this.deltaX > 0 ||\n                    this.index == this.length - 1 && this.deltaX < 0;\n\n            // if not scrolling vertically\n            if ( !this.isScrolling ) {\n                this.show( this.index + ( isValidSlide && !isPastBounds ? (this.deltaX < 0 ? 1 : -1) : 0 ) );\n            }\n\n            $doc.off('touchmove', this.ontouchmove);\n            $doc.off('touchend', this.ontouchend);\n        },\n\n        show: function( index ) {\n            if ( index != this.index ) {\n                this.config.onchange.call(this, index);\n            } else {\n                this.to = -( index*this.width );\n            }\n        },\n\n        moveTo: function( index ) {\n            if ( index != this.index ) {\n                this.pos = this.to = -( index*this.width );\n                this.index = index;\n            }\n        },\n\n        loop: function() {\n\n            var distance = this.to - this.pos,\n                factor = 1;\n\n            if ( this.width && distance ) {\n                factor = M.max(0.5, M.min(1.5, M.abs(distance / this.width) ) );\n            }\n\n            // if distance is short or the user is touching, do a 1-1 animation\n            if ( this.touching || M.abs(distance) <= 1 ) {\n                this.pos = this.to;\n                distance = 0;\n                if ( this.anim && !this.touching ) {\n                    this.config.oncomplete( this.index );\n                }\n                this.anim = 0;\n                this.easing = this.config.easing;\n            } else {\n                if ( !this.anim ) {\n                    // save animation parameters\n                    this.anim = { start: this.pos, time: +new Date(), distance: distance, factor: factor, destination: this.to };\n                }\n                // check if to has changed\n                if ( this.anim.destination != this.to ) {\n                    this.anim = 0;\n                    this.easing = this.easeout;\n                    return;\n                }\n                // apply easing\n                this.pos = this.easing(\n                    null,\n                    +new Date() - this.anim.time,\n                    this.anim.start,\n                    this.anim.distance,\n                    this.config.duration*this.anim.factor\n                );\n\n            }\n            this.setX();\n        }\n    };\n\n    return Finger;\n\n}());\n\n// the plugin initializer\n$.fn.galleria = function( options ) {\n\n    var selector = this.selector;\n\n    // try domReady if element not found\n    if ( !$(this).length ) {\n\n        $(function() {\n            if ( $( selector ).length ) {\n\n                // if found on domReady, go ahead\n                $( selector ).galleria( options );\n\n            } else {\n\n                // if not, try fetching the element for 5 secs, then raise a warning.\n                Galleria.utils.wait({\n                    until: function() {\n                        return $( selector ).length;\n                    },\n                    success: function() {\n                        $( selector ).galleria( options );\n                    },\n                    error: function() {\n                        Galleria.raise('Init failed: Galleria could not find the element \"'+selector+'\".');\n                    },\n                    timeout: 5000\n                });\n\n            }\n        });\n        return this;\n    }\n\n    return this.each(function() {\n\n        // destroy previous instance and prepare for new load\n        if ( $.data(this, 'galleria') ) {\n            $.data( this, 'galleria' ).destroy();\n            $( this ).find( '*' ).hide();\n        }\n\n        // load the new gallery\n        $.data( this, 'galleria', new Galleria().init( this, options ) );\n    });\n\n};\n\n// export as AMD or CommonJS\nif ( typeof module === \"object\" && module && typeof module.exports === \"object\" ) {\n    module.exports = Galleria;\n} else {\n    window.Galleria = Galleria;\n    if ( typeof define === \"function\" && define.amd ) {\n        define( \"galleria\", ['jquery'], function() { return Galleria; } );\n    }\n}\n\n// phew\n\n}( jQuery, this ) );"],"sourceRoot":"/source/"}