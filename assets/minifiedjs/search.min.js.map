{"version":3,"sources":["search.js"],"names":["getCurrentSearchId","currentURL","window","location","href","replace","hash","currentHash","length","searchId","history","pushState","substr","lastIndexOf","parseSearch","disableHashChange","$","empty","localLoadAll","loadAll","doSearch","loadCollectionHeader","val","get","basePath","data","html","pageNumber","ignoreResults","previousEventComplete","currentPageNumber","oldMatches","oldResults","cachedResults","matches","searchResults","parseJSON","e","alert","success","totalResults","objectId","cookie","path","pathname","totalLoadedCount","processSearchResults","newArray","merge","parent","hasClass","prepMap","cachedDates","prepTimeline","populateSearchFields","searchEntry","populateSearchResults","dataAvailable","getSuggestions","searchTerm","localSearch","post","textStatus","resultArray","each","index","value","reg","RegExp","search","addClass","append","italics","insert","prop","searchText","sort","Array","isArray","targetField","internalIndex","internalValue","newField","clone","appendTo","remove","targetText","text","searchObject","source","targetTemplate","template","Handlebars","compile","listSource","listTemplate","listTemplateCompiled","base_url","listHTML","show","resultsAvailable","hide","removeData","goMap","mapTypeControl","maptype","mapTypeControlOptions","position","style","addMarker","markerSpiderfier","OverlappingMarkerSpiderfier","map","spiderConfig","getMarkerCount","clearMarkers","locations","index2","value2","entries","index3","value3","loc","coordinates","MarkerTemplate","allMarkers","getMarkers","latlng","google","maps","LatLng","finalLatLng","i","existingMarker","getPosition","marker","createMarker","longitude","lng","latitude","lat","markers","temp","mapId","push","InfoWindow","addListener","markerclusterer","MarkerClusterer","setMaxZoom","fitBounds","earliestDate","latestDate","undefined","Timeline","DateTime","DefaultEventSource","strings","GregorianDateLabeller","monthNames","setTimeout","geoTime","events","dates","dateAsset","start","startTime","parseInt","toString","endTime","formattedStart","formattedEnd","t","GeochronoUnit","wrapMA","Math","abs","Date","setSeconds","utc","create","formattedValue","miscData","title","id","image","link","description","end","durationEvent","eventSource","clear","Event","prototype","fillInfoBubble","elmt","theme","labeller","eventObject","this","div","document","createElement","innerHTML","_obj","appendChild","SimileAjax","EventIndex","loadJSON","ClassicTheme","d","midPoint","range","bigBand","smallBand","smallInterval","MINUTE","HOUR","DAY","MONTH","YEAR","DECADE","CENTURY","MILLENNIUM","MA","EPOCH","History","enabled","bandInfos","Geochrono","createBandInfo","timeZone","getTimezoneOffset","date","width","intervalUnit","intervalPixels","trackGap","trackHeight","eventPainter","CompactEventPainter","eventPainterParams","iconLabelGap","labelRightMargin","iconWidth","iconHeight","stackConcurrentPreciseInstantEvents","limit","moreMessageTemplate","icon","overview","syncWith","highlight","tl","getElementById","HORIZONTAL","MarkerSource","ready","htmlEntities","str","String","scroll","height","scrollTop","getScript","on","find","trigger","tab","target","attr","preventDefault","embedPath","protocol","hostname","iFrameContent","embedContent","bootbox","dialog","message","buttons","label","className","submit","performSearchForButtonPress","first","keepSpiderfied","event","select"],"mappings":"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","file":"search.min.js","sourcesContent":["\nvar MarkerSource;\nvar MarkerTemplate;\nvar cachedResults = \"\";\nvar cachedDates = null;\nvar searchId = null;\nvar currentPageNumber;\nvar eventSource;\nvar resultsAvailable = true;\nvar previousEventComplete = true;\nvar dataAvailable = true;\nvar disableHashChange = false;\nvar totalResults = 0;\n$(document).ready(function() {\n\n\t$(window).scroll(function(){\n\t\tif (resultsAvailable && $(document).height() - 50 <= $(window).scrollTop() + $(window).height()) {\n\t\t\tif(($('.nav-tabs .active').text() == \"Grid\" || $('.nav-tabs .active').text() == \"List\") && previousEventComplete && dataAvailable) {\n\t\t\t\tdoSearch(searchId, currentPageNumber+1);\n\t\t\t}\n\t\t}\n\t});\n\n\n\n\tif($(\"#timelinePane\").length > 0) {\n\t\tsetTimeout(function() {\n\t\t\t$.getScript(\"/assets/timeline_js/ext/geochrono/geochrono-api.js\");\n\t\t}, 1000);\n\t}\n\t\n\n\t$(\".searchText\").on(\"blur\", function() {\n\t\t$(\".advancedSearchText\").val($(\".searchText\").val());\n\t});\n\n\t$(\".advancedSearchText\").on(\"blur\", function() {\n\t\t$(\".searchText\").val($(\".advancedSearchText\").val());\n\t});\n\n\t$('a[href=\"#timeline\"]').on('shown.bs.tab', function() {\n\t\tcachedDates = null;\n\t\tprepTimeline();\n\t});\n\t$('a[href=\"#map\"]').on('shown.bs.tab', function() {\n\t\tprepMap();\n\t});\n\t$('a[href=\"#gallery\"]').on('shown.bs.tab', function() {\n\t});\n\t$('a[href=\"#grid\"]').on('shown.bs.tab', function() {\n\t\t$(\"#results\").find(\"img\").trigger(\"show\");\n\t});\n\t$('a[href=\"#list\"]').on('shown.bs.tab', function() {\n\t\t$(\"#listResults\").find(\"img\").trigger(\"show\");\n\t});\n\n\n\n\n\t$(\".previousPage\").on(\"click\",function() {\n\t\tdoSearch(searchId, currentPageNumber-1);\n\t\treturn false;\n\t});\n\n\t$(\".nextPage\").on(\"click\",function() {\n\t\tdoSearch(searchId, currentPageNumber+1);\n\t\treturn false;\n\t});\n\n\n\tMarkerSource   = $(\"#marker-template\").html();\n\tMarkerTemplate = Handlebars.compile(MarkerSource);\n\n\n\tif (location.hash !== '')  {\n\t\t$('a[href=\"' + location.hash + '\"]').tab('show');\n\t}\n\n    // remember the hash in the URL without jumping\n    $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function(e) {\n       if(history.pushState) {\n            history.pushState(null, null, '#'+$(e.target).attr('href').substr(1));\n       } else {\n            location.hash = '#'+$(e.target).attr('href').substr(1);\n       }\n    });\n\n    function htmlEntities(str) {\n    \treturn String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\t}\n\n    $(\".embedMap\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath = window.location.protocol + \"//\" + window.location.hostname + basePath + \"search/map/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this map\",\n\t\t\tmessage: \"Use the HTML below to embed this map in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    });\n\n});\n\n\nfunction getCurrentSearchId() {\n\tcurrentURL = window.location.href.replace(window.location.hash,\"\");\n\tcurrentHash = window.location.hash.replace(\"#\", \"\");\n\tif(currentHash.length == 36) {\n\t\t// this is an old hash, we need to keep that\n\t\tsearchId = currentHash;\n\t\twindow.history.pushState({}, \"Search Results\", currentURL + \"/s/\" +searchId);\n\t}\n\telse {\n\t\tsearchId = currentURL.substr(currentURL.lastIndexOf('/') + 1);\n\t}\n\treturn searchId;\n}\n\n\nfunction parseSearch() {\n\t\n\tsearchId = getCurrentSearchId();\n\n\tif(searchId && !disableHashChange) {\n\t\t$(\"#results\").empty();\n\t\t$(\"#listResults\").empty();\n\n\n\n\t\t// you can set a global var \"loadAll\" to cause us to load all available results at pageload.\n\t\t// leaving this here just to make it explicit\n\t\tvar localLoadAll = false;\n\t\tif(typeof loadAll !== 'undefined' && loadAll == true) {\n\t\t\tlocalLoadAll = true;\n\t\t}\n\n\t\tdoSearch(searchId, 0, localLoadAll);\n\t}\n\n}\n\nfunction loadCollectionHeader() {\n\tif($(\"input[name='collection[]']\").length == 1 && $(\"input[name='collection[]']\").val() !== \"0\" && $(\"#searchText\").val() == \"\") {\n\t\t$.get(basePath + \"collections/collectionHeader/\" + $(\"input[name='collection[]']\").val(), function(data) {\n\t\t\t$(\".collectonHeader\").html(data);\n\t\t});\n\t}\n\n}\n\n// ignore results is used to force the server to pre-cache the next set of results\nfunction doSearch(searchId, pageNumber, loadAll, ignoreResults) {\n\n\n\tif(!ignoreResults) {\n\t\tpreviousEventComplete = false;\n\t\tcurrentPageNumber = pageNumber;\n\t}\n\n\n\tloadAll = (loadAll)?\"true\":\"false\";\n\n\t$.get(basePath + \"search/searchResults/\" + searchId + \"/\" + pageNumber + \"/\" + loadAll, function(data) {\n\t\t\tif(ignoreResults) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar oldMatches = [];\n\t\t\tvar oldResults = [];\n\t\t\ttry{\n\t\t\t\tif(cachedResults) {\n\t\t\t\t\toldMatches = cachedResults.matches;\n\t\t\t\t\toldResults = cachedResults.searchResults;\n\t\t\t\t}\n\t\t\t\tcachedResults = $.parseJSON(data);\n\n\t\t\t}\n\t\t\tcatch(e){\n\t\t\t\talert(e + \" \" + data);\n\t\t\t}\n\n\t\t\tif(cachedResults.success === true) {\n\n\t\t\t\tif(cachedResults.totalResults == 1 ) {\n\t\t\t\t\t// special case - one match, let's just load it\n\t\t\t\t\tvar objectId = cachedResults.matches[0].objectId;\n\t\t\t\t\t$.cookie('lastSearch', searchId, { path: \"/\"});\n\n\t\t\t\t\t// window.location.hash = \"\";\n\t\t\t\t\twindow.location.pathname = basePath + \"/asset/viewAsset/\" + objectId;\n\t\t\t\t}\n\t\t\t\tcachedResults.totalLoadedCount = cachedResults.matches.length + oldMatches.length;\n\t\t\t\tprocessSearchResults(cachedResults);\n\t\t\t\tnewArray = $.merge(cachedResults.matches, oldMatches);\n\t\t\t\tcachedResults.searchResults = $.merge(cachedResults.searchResults, oldResults);\n\t\t\t\tcachedResults.matches = newArray;\n\n\t\t\t\t// we want these to use the full stored set, not just the curret batch, so we run them after merging.\n\t\t\t\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\t\t\t\tprepMap();\n\t\t\t\t}\n\n\t\t\t\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\t\t\t\tcachedDates = null;\n\t\t\t\t\tprepTimeline();\n\t\t\t\t}\n\n\t\t\t}\n\t\t});\n}\n\nfunction processSearchResults(cachedResults) {\n\tpopulateSearchFields(cachedResults.searchEntry);\n\tloadCollectionHeader();\n\tpopulateSearchResults(cachedResults);\n\tif(cachedResults.matches.length === 0) {\n\t\tdataAvailable = false;\n\t}\n\tpreviousEventComplete = true;\n\t\n}\n\n$(document).on(\"click\", \".assetLink\", function(e) {\n\t$.cookie('lastSearch', searchId, { path: \"/\"});\n\n});\n\n$(document).on(\"click\", \".useSuggest\", function() {\n\n\t$(\".searchText\").val($(this).text());\n\t$(\".searchForm\").submit();\n\n});\n\n$(document).on(\"change\", \".sortBy\", function() {\n\t$(\".hiddenSort\").val($(this).val());\n\tperformSearchForButtonPress($(\".searchForm\").first());\n});\n\n\n$(document).on(\"click\", \"#loadAllResults\", function(e) {\n\te.preventDefault();\n\tif(dataAvailable) {\n\t\tdoSearch(searchId, currentPageNumber+1, true);\n\t\tdataAvailable = false;\n\t\t$(\"#loadAllResults\").hide();\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\n});\n\nfunction getSuggestions(searchTerm) {\n\n\tvar localSearch = searchTerm;\n\t$.post(basePath + \"search/getSuggestion\", {\"searchTerm\":searchTerm}, function(data, textStatus) {\n\t\tvar resultArray = $.parseJSON(data);\n\t\tif(resultArray.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\t$.each(resultArray, function(index, value) {\n\t\t\tvar reg = new RegExp(index, 'ig');\n\t\t\tlocalSearch = localSearch.replace(reg, value);\n\t\t});\n\n\t\tvar search = $(\"<a>\").addClass(\"useSuggest\").append(localSearch);\n\t\tvar italics = $(\"<i>\").append(search);\n\t\tvar insert = $(\"<div>\").addClass('col-sm-12 suggestionText').append(\"Did you mean: \").append(italics).append(\" ?\");\n\t\t$(\".suggest\").empty();\n\t\t$(\".suggest\").append(insert);\n\n\t});\n\n\n}\n\nfunction populateSearchFields(searchEntry) {\n\t$(\".collectionSelector\").prop('checked', false);\n\t$(\"#showHidden\").prop('checked',false);\n\t$(\".advancedOption\").val();\n\n\tif(searchEntry.searchText.length > 0) {\n\t\tgetSuggestions(searchEntry.searchText);\n\t}\n\n\t$(\".sortBy\").val(searchEntry.sort);\n\n\t$.each(searchEntry, function(index, value) {\n\t\tif(Array.isArray(value)) {\n\t\t\tvar targetField = $(\"#\" + index);\n\t\t\t$.each(value, function(internalIndex, internalValue) {\n\t\t\t\tvar newField = targetField.clone();\n\t\t\t\t$(newField).val(internalValue);\n\t\t\t\t$(newField).appendTo($(\"#\" + index).parent());\n\t\t\t});\n\t\t\t$(targetField).remove();\n\t\t}\n\t\telse {\n\t\t\t$(\"#\" + index).val(value);\t\n\t\t}\n\t\n\t});\n\n\tif($(\"#collection\").val() > 0) {\n\t\ttargetText = $('[data-collection-id=\"' + $(\"#collection\").val() + '\"]').text();\n\t    $(\"#search_concept\").text(targetText);\n\t }\n\n}\n\n\n\nfunction populateSearchResults(searchObject) {\n\t// target template is defined by the hosting include - search page versus drawers, etc\n\tvar source   = $(targetTemplate).html();\n\tvar template = Handlebars.compile(source);\n\tvar listSource   = $(listTemplate).html();\n\tvar listTemplateCompiled = Handlebars.compile(listSource);\n\n\t$.each(searchObject.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = searchObject;\n\t\tvar html    = template(value);\n\t\tvar listHTML    = listTemplateCompiled(value);\n\t\t$(\"#results\").append(html);\n\t\t$(\"#listResults\").append(listHTML);\n\t});\n\n\ttotalResults = searchObject.totalResults;\n\t$(\".resultsData\").html(\"<p>Total Results: \"+ searchObject.totalResults + \"</p>\");\n\n\tif(dataAvailable && searchObject.matches.length < searchObject.totalResults && searchObject.totalResults < 1000) {\n\t\t$(\".resultsData p\").append(\" <a href='' id='loadAllResults'>[Load All]</a>\");\n\t}\n\n\n\tif(searchObject.totalResults > searchObject.totalLoadedCount) {\n\t\t$(\".paginationBlock\").show();\n\t\tresultsAvailable = true;\n\t}\n\telse {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\t\n\tif(searchObject.matches.length == 0) {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\tprepMap();\n\t}\n\n\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\tprepTimeline();\n\t}\n\n\t// have the server precache the new results\n\tif(searchId !== null) {\n\t\tdoSearch(searchId, currentPageNumber+1, false, true);\n\t}\n\n\n}\n\n\n\n\n var spiderConfig = {\n    keepSpiderfied: true,\n    event: 'mouseover'\n};\n\nfunction prepMap() {\n\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\n\t$(\"#mapPane\").removeData();\n\n\t$(\"#mapPane\").goMap({\n\t\tmapTypeControl:true,\n\t\tmaptype: 'ROADMAP',\n\t\tmapTypeControlOptions: {\n\t\t\tposition: 'TOP_RIGHT',\n\t\t\tstyle: 'DROPDOWN_MENU'\n\t\t},\n\t\taddMarker: \"single\"\n\n\t});\n\n\tvar markerSpiderfier = new OverlappingMarkerSpiderfier($.goMap.map, spiderConfig);\n\n\tif($.goMap.getMarkerCount()>0) {\n\t\t$.goMap.clearMarkers();\n\t}\n\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tif(value.locations) {\n\t\t\t$.each(value.locations, function (index2, value2) {\n\t\t\t\t$.each(value2.entries, function(index3, value3) {\n\n\t\t\t\t\tloc = value3.loc.coordinates;\n\t\t\t\t\tvalue.base_url = basePath;\n\t\t\t\t\tvar html    = MarkerTemplate(value);\n\t\t\t\t\tvar allMarkers = $.goMap.getMarkers(\"markers\");\n\t\t\t\t\tif(loc[1] === 0 && loc[0] === 0) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tlatlng = new google.maps.LatLng(loc[1], loc[0]);\n\t\t\t\t\tfinalLatLng = latlng;\n\t\t\t\t\tif (allMarkers.length != 0) {\n\t\t\t\t\t\tfor (i=0; i < allMarkers.length; i++) {\n\t\t\t\t\t\t\tvar existingMarker = allMarkers[i];\n\t\t\t\t\t\t\tvar pos = existingMarker.getPosition();\n        \t\t\t\t\t//if a marker already exists in the same position as this marker\n\n        \t\t\t\t\t// if (google.maps.geometry.spherical.computeDistanceBetween(latlng,pos)<1) {\n            \t// \t\t\t\t//update the position of the coincident marker by applying a small multipler to its coordinates\n            \t// \t\t\t\tvar newLat = latlng.lat() + (Math.random() -.5) / 5500;// * (Math.random() * (max - min) + min);\n            \t// \t\t\t\tvar newLng = latlng.lng() + (Math.random() -.5) / 5500;// * (Math.random() * (max - min) + min);\n            \t// \t\t\t\tfinalLatLng = new google.maps.LatLng(newLat,newLng);\n            \t// \t\t\t}\n            \t\t\t}\n            \t\t}\n            \t\telse {\n            \t\t\tfinalLatLng = latlng;\n            \t\t}\n\t\t\t\t\tvar marker = $.goMap.createMarker({\n\t\t\t\t\t\tlongitude: finalLatLng.lng(),\n\t\t\t\t\t\tlatitude: finalLatLng.lat(),\n\t\t\t\t\t\thtml: html\n\t\t\t\t\t});\n\t\t\t\t\tmarkerSpiderfier.addMarker(marker);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t});\n\n\tvar markers = [];\n\n\tfor (var i in $.goMap.markers) {\n\t\tvar temp = $($.goMap.mapId).data($.goMap.markers[i]);\n\t\tmarkers.push(temp);\n\t}\n\tvar iw = new google.maps.InfoWindow();\n\n    markerSpiderfier.addListener('click', function(marker, e) {\n    });\n\n    markerSpiderfier.addListener('spiderfy', function(markers) {\n    });\n\n\tvar markerclusterer = new MarkerClusterer($.goMap.map, markers);\n\tmarkerclusterer.setMaxZoom(15);\n\t$.goMap.fitBounds();\n}\n\n\nfunction prepTimeline() {\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\n\tvar earliestDate = null;\n\tvar latestDate = null;\n\tif(Timeline === undefined || Timeline.DateTime === undefined || Timeline.DefaultEventSource === undefined || Timeline.strings === undefined || Timeline.GregorianDateLabeller.monthNames === undefined) {\n\t\tsetTimeout(function() {\n\t\t\tprepTimeline();\n\t\t}, 1000);\n\t\treturn;\n\t}\n\t$(\"#timelinePane\").empty();\n\n\tvar geoTime = false;\n\n\tif(cachedDates=== null) {\n\t\tcachedDates = {\n//\t\t\t\"dateTimeFormat\": \"iso8601\",\n\t\t\t\"events\": []\n\t\t};\n\n\n\t\t$.each(cachedResults.matches, function(index, value) {\n\t\t\tif(value.dates) {\n\t\t\t\t$.each(value.dates, function(index, value2) {\n\t\t\t\t\t$.each(value2.dateAsset, function(index, value3) {\n\t\t\t\t\t\tif(value3.start) {\n\t\t\t\t\t\t\tstartTime = parseInt(value3.start[\"numeric\"], 10);\n\t\t\t\t\t\t\tif(startTime < -6373557595440) {\n\t\t\t\t\t\t\t\tgeoTime = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$.each(cachedResults.matches, function(index, value) {\n\t\t\tif(value.dates) {\n\t\t\t\t$.each(value.dates, function(index, value2) {\n\t\t\t\t\t$.each(value2.dateAsset, function(index, value3) {\n\t\t\t\t\t\tif(value3.start && value3.start[\"numeric\"].toString().length > 0) {\n\t\t\t\t\t\t\tvar startTime = null;\n\t\t\t\t\t\t\tvar endTime = null;\n\t\t\t\t\t\t\tvar formattedStart = null;\n\t\t\t\t\t\t\tvar formattedEnd = null;\n\t\t\t\t\t\t\tvar t = null;\n\t\t\t\t\t\t\tstartTime = parseInt(value3.start[\"numeric\"], 10);\n\n\t\t\t\t\t\t\tif(geoTime) {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * at this point, let's work in millions of years ago\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tformattedStart = Timeline.GeochronoUnit.wrapMA(Math.abs(startTime / 31556900000000));\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\t\t\t\tt.setSeconds(startTime);\n\t\t\t\t\t\t\t\tformattedStart = Date.utc.create(t);\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tformattedValue = {\n\t\t\t\t\t\t\t\t\"miscData\": value,\n\t\t\t\t\t\t\t\t\"title\": value.title,\n\t\t\t\t\t\t\t\t\"id\": \"/en/\"+value.objectId,\n\t\t\t\t\t\t\t\t\"start\": formattedStart,\n\t\t\t\t\t\t\t\t\"image\": basePath+\"asset/previewImage/\"+value.objectId,\n\t\t\t\t\t\t\t\t\"link\": basePath+\"asset/viewAsset/\"+value.objectId,\n\t\t\t\t\t\t\t\t\"description\": \"Caption goeshere\"\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif(value3.end[\"numeric\"] && value3.end[\"numeric\"].length>0) {\n\t\t\t\t\t\t\t\tendTime = parseInt(value3.end[\"numeric\"], 10);\n\t\t\t\t\t\t\t\tif(geoTime) {\n\t\t\t\t\t\t\t\t\tformattedEnd = Timeline.GeochronoUnit.wrapMA(Math.abs(endTime / 31556900000000));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\t\t\t\t\tt.setSeconds(endTime);\n\t\t\t\t\t\t\t\t\tformattedEnd = Date.utc.create(t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tformattedValue.end = formattedEnd;\n\t\t\t\t\t\t\t\tformattedValue.durationEvent = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(earliestDate === null || startTime < earliestDate) {\n\t\t\t\t\t\t\t\tearliestDate = startTime;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(latestDate === null || startTime > latestDate) {\n\t\t\t\t\t\t\t\tlatestDate = startTime;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (endTime > latestDate) {\n\t\t\t\t\t\t\t\tlatestDate = endTime;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcachedDates.events.push(formattedValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\n\tif(eventSource) {\n\t\teventSource.clear();\n\t}\n\n\n\tvar oldFillInfoBubble = Timeline.DefaultEventSource.Event.prototype.fillInfoBubble;\n\tTimeline.DefaultEventSource.Event.prototype.fillInfoBubble = function(elmt, theme, labeller) {\n\t\t//oldFillInfoBubble.call(this, elmt, theme, labeller);\n\n\t\tvar eventObject = this;\n\n\t\tvar div = document.createElement(\"div\");\n\t\tdiv.innerHTML = MarkerTemplate(eventObject._obj.miscData);\n\t\telmt.appendChild(div);\n\t};\n\n\n\n\n\tif(geoTime) {\n\t\teventSource = new Timeline.DefaultEventSource(new SimileAjax.EventIndex(Timeline.GeochronoUnit));\n\t}\n\telse {\n\t\teventSource = new Timeline.DefaultEventSource(0);\n\t}\n\n\n\teventSource.loadJSON(cachedDates, \"localJson\");\n\n\tvar theme = Timeline.ClassicTheme.create();\n\n\tvar d = null;\n\tvar midPoint = null;\n\tif(geoTime) {\n\t\tmidPoint = Math.abs(((earliestDate + latestDate) / 2) / 31556900000000);\n\t\td = Timeline.GeochronoUnit.wrapMA(midPoint);\n\t}\n\telse {\n\t\tmidPoint = (earliestDate + latestDate)/2;\n\t\tvar t = new Date(1970,0,1);\n\t\tt.setSeconds(midPoint);\n\n\t\td = Date.create(t);\n\t}\n\tvar range = latestDate - earliestDate;\n\tvar bigBand = null;\n\tvar smallBand = null;\n\tvar smallInterval = 200;\n\tif(range < 60*60) { // we're on a day scale\n\t\tbigBand = Timeline.DateTime.MINUTE;\n\t\tsmallBand = Timeline.DateTime.HOUR;\n\t}\n\telse if(range < 60*60*24) { //month scale\n\t\tbigBand = Timeline.DateTime.HOUR;\n\t\tsmallBand = Timeline.DateTime.DAY;\n\t}\n\telse if(range< 60*60*24*30) { //year scale\n\t\tbigBand = Timeline.DateTime.DAY;\n\t\tsmallBand = Timeline.DateTime.MONTH;\n\t}\n\telse if(range< 60*60*24*30*12) { //decade\n\t\tbigBand = Timeline.DateTime.MONTH;\n\t\tsmallBand = Timeline.DateTime.YEAR;\n\t}\n\telse if(range< 60*60*24*30*12*10) { //century\n\t\tbigBand = Timeline.DateTime.YEAR;\n\t\tsmallBand = Timeline.DateTime.DECADE;\n\t}\n\telse if(range< 60*60*24*30*12*10*10) { //millenia\n\t\tbigBand = Timeline.DateTime.DECADE;\n\t\tsmallBand = Timeline.DateTime.CENTURY;\n\t}\n\telse if(range< 60*60*24*30*12*10*10*10) { //bigger\n\t\tbigBand = Timeline.DateTime.CENTURY;\n\t\tsmallBand = Timeline.DateTime.MILLENNIUM;\n\n\t}\n\telse {\n\t\tbigBand = Timeline.DateTime.MILLENNIUM;\n\t\tsmallBand = Timeline.DateTime.MILLENNIUM;\n\t\tsmallInterval = 80;\n\t}\n\n\tif(geoTime) {\n\n\t\tbigBand = Timeline.GeochronoUnit.MA;\n\t\tsmallBand = Timeline.GeochronoUnit.EPOCH;\n\t}\n\n\tSimileAjax.History.enabled = false;\n\tvar bandInfos;\n\tif(geoTime) {\n        bandInfos  = [\n            Timeline.Geochrono.createBandInfo({\n                eventSource:    eventSource,\n                timeZone: -1 * (new Date().getTimezoneOffset()/60),\n                date:           d,\n                width:          \"86%\",\n                intervalUnit:   bigBand,\n                intervalPixels: 100,\n                trackGap:       0.2,\n                trackHeight:    1.3,\n                theme:          theme,\n                eventPainter:   Timeline.CompactEventPainter,\n                eventPainterParams: {\n\t\t\t\t\ticonLabelGap:     5,\n\t\t\t\t\tlabelRightMargin: 20,\n\t\t\t\t\ticonWidth:        80, // These are for per-event custom icons\n\t\t\t\t\ticonHeight:       80,\n\t\t\t\t\tstackConcurrentPreciseInstantEvents: {\n\t\t\t\t\t\tlimit: 5,\n\t\t\t\t\t\tmoreMessageTemplate:    \"%0 More Events\",\n\t\t\t\t\t\ticon:                   \"no-image-80.png\", // default icon in stacks\n\t\t\t\t\t\ticonWidth:              80,\n\t\t\t\t\t\ticonHeight:             80\n\t\t\t\t\t}\n\t\t\t\t}\n            }),\n            Timeline.Geochrono.createBandInfo({\n\t\t\t\twidth:          \"10%\",\n\t\t\t\ttimeZone: -1 * (new Date().getTimezoneOffset()/60),\n\t\t\t\tintervalUnit:   smallBand,\n\t\t\t\tintervalPixels: smallInterval,\n\t\t\t\teventSource:    eventSource,\n\t\t\t\tdate:           d,\n\t\t\t\ttheme:          theme,\n\t\t\t\toverview:         'overview'  // original, overview, detailed\n\t\t\t})\n        ];\n\t\tbandInfos[1].syncWith = 0;\n\t\tbandInfos[1].highlight = true;\n\t}\n\telse {\n\t\tbandInfos = [\n\t\t\tTimeline.createBandInfo({\n\t\t\t\twidth:          \"90%\",\n\t\t\t\tintervalUnit:   bigBand,\n\t\t\t\ttimeZone: -1 * (new Date().getTimezoneOffset()/60),\n\t\t\t\tintervalPixels: 200,\n\t\t\t\teventSource:    eventSource,\n\t\t\t\tdate:           d,\n\t\t\t\ttheme:          theme,\n\t\t\t\teventPainter:   Timeline.CompactEventPainter,\n\t\t\t\teventPainterParams: {\n\t\t\t\t\ticonLabelGap:     5,\n\t\t\t\t\tlabelRightMargin: 20,\n\t\t\t\t\ticonWidth:        80, // These are for per-event custom icons\n\t\t\t\t\ticonHeight:       80,\n\t\t\t\t\tstackConcurrentPreciseInstantEvents: {\n\t\t\t\t\t\tlimit: 5,\n\t\t\t\t\t\tmoreMessageTemplate:    \"%0 More Events\",\n\t\t\t\t\t\ticon:                   \"/assets/timeline_js/images/blue-circle.png\", // default icon in stacks\n\t\t\t\t\t\ticonWidth:              80,\n\t\t\t\t\t\ticonHeight:             80\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}),\n\t\t\tTimeline.createBandInfo({\n\t\t\t\twidth:          \"10%\",\n\t\t\t\ttimeZone: -1 * (new Date().getTimezoneOffset()/60),\n\t\t\t\tintervalUnit:   smallBand,\n\t\t\t\tintervalPixels: smallInterval,\n\t\t\t\teventSource:    eventSource,\n\t\t\t\tdate:           d,\n\t\t\t\ttheme:          theme,\n\t\t\t\toverview:         'overview'  // original, overview, detailed\n\t\t\t})\n\t\t];\n\t\tbandInfos[1].syncWith = 0;\n\t\tbandInfos[1].highlight = true;\n\t}\n\n\n\tif(geoTime) {\n\t\ttl = Timeline.create(document.getElementById(\"timelinePane\"), bandInfos, Timeline.HORIZONTAL, Timeline.GeochronoUnit);\n\t}\n\telse {\n\t\ttl = Timeline.create(document.getElementById(\"timelinePane\"), bandInfos, Timeline.HORIZONTAL);\n\t}\n\n\n}\n\n\n\n$(document).on(\"click\", \".embedControl\", function() {\n\t$(this).select();\n});\n\n\n"]}