{"version":3,"file":"search.min.js","sources":["search.js"],"sourcesContent":["\nvar cachedResults = \"\";\nvar cachedDates = null;\nvar searchId = null;\nvar currentPageNumber;\nvar eventSource;\nvar resultsAvailable = true;\nvar previousEventComplete = true;\nvar dataAvailable = true;\nvar disableHashChange = false;\nvar totalResults = 0;\n\n$(document).ready(function() {\n\n\tregisterScrollHandlers();\n\tregisterClickHandlers();\n\tloadTemplates();\n\t\n\n\t// if we have a specific tab specified (gallery, list, etc) load that\n\tif (location.hash !== '')  {\n\t\t$('a[href=\"' + location.hash + '\"]').tab('show');\n\t}\n\n\t// remember the hash in the URL without jumping\n    $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function(e) {\n       if(history.pushState) {\n            history.pushState(null, null, '#'+$(e.target).attr('href').substr(1));\n       } else {\n            location.hash = '#'+$(e.target).attr('href').substr(1);\n       }\n    });\n});\n\n\nvar registerClickHandlers = function() {\n\n\t$(\".searchText\").on(\"blur\", function() {\n\t\t$(\".advancedSearchText\").val($(\".searchText\").val());\n\t});\n\n\t$(\".advancedSearchText\").on(\"blur\", function() {\n\t\t$(\".searchText\").val($(\".advancedSearchText\").val());\n\t});\n\n\t$('a[href=\"#timeline\"]').on('shown.bs.tab', function() {\n\t\tcachedDates = null;\n\t\tprepTimeline();\n\t});\n\t$('a[href=\"#map\"]').on('shown.bs.tab', function() {\n\t\tprepMap();\n\t});\n\t$('a[href=\"#gallery\"]').on('shown.bs.tab', function() {\n\t\tprepGallery();\n\t});\n\t$('a[href=\"#grid\"]').on('shown.bs.tab', function() {\n\t\t$(\"#results\").find(\"img\").trigger(\"show\");\n\t});\n\t$('a[href=\"#list\"]').on('shown.bs.tab', function() {\n\t\t$(\"#listResults\").find(\"img\").trigger(\"show\");\n\t});\n\n\t$(\".nextPage\").on(\"click\",function() {\n\t\tdoSearch(searchId, currentPageNumber+1);\n\t\treturn false;\n\t});\n\n\t$(\".embedMap\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath =  \"//\" + window.location.hostname + basePath + \"search/map/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this map\",\n\t\t\tmessage: \"Use the HTML below to embed this map in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n    });\n\n\t$(\".embedTimeline\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath = \"//\" + window.location.hostname + basePath + \"search/timeline/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this timeline\",\n\t\t\tmessage: \"Use the HTML below to embed this timeline in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    });\n\n    $(\".embedGallery\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath = \"//\" + window.location.hostname + basePath + \"search/gallery/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this gallery\",\n\t\t\tmessage: \"Use the HTML below to embed this gallery in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    });\n\n\t$(document).on(\"click\", \".embedControl\", function() {\n\t\t$(this).select();\n\t});\n\n\n\t$(document).on(\"click\", \".exportCSV\", function(e) {\n\t\te.preventDefault();\n\t\ttarget = e.target.href;\n\t\twindow.location = target + \"#\" + searchId;\n\n\t});\n\n\t$(document).on(\"click\", \".fullscreen\", function() {\n\t\tif($.fullscreen.isNativelySupported()) {\n\t\t\t$(\".frameFullscreenContainer\").first().fullscreen({ \"toggleClass\": \"imageFullscreen\"});\n\t\t}\n\t});\n\t\n\t$(document).on(\"click\", \".assetLink\", function(e) {\n\t\t$.cookie('lastSearch', searchId, { path: \"/\"});\n\t});\n\n\t$(document).on(\"click\", \".useSuggest\", function() {\n\t\t$(\".searchText\").val($(this).text());\n\t\t$(\".searchForm\").submit();\n\t});\n\n\t$(document).on(\"change\", \".sortBy\", function() {\n\t\t$(\".hiddenSort\").val($(this).val());\n\t\tperformSearchForButtonPress($(\".searchForm\").first());\n\t});\n\n\n\t$(document).on(\"click\", \"#loadAllResults\", function(e) {\n\t\te.preventDefault();\n\t\tif(dataAvailable) {\n\t\t\tdoSearch(searchId, currentPageNumber+1, true);\n\t\t\tdataAvailable = false;\n\t\t\t$(\"#loadAllResults\").hide();\n\t\t\t$(\".paginationBlock\").hide();\n\t\t\tresultsAvailable = false;\n\t\t}\n\t});\n\n\n}\n\nvar registerScrollHandlers = function() {\n\t\t$(window).scroll(function(){\n\t\tif (resultsAvailable && $(document).height() - 50 <= $(window).scrollTop() + $(window).height()) {\n\t\t\tif(($('.nav-tabs .active').text() == \"Grid\" || $('.nav-tabs .active').text() == \"List\") && previousEventComplete && dataAvailable) {\n\t\t\t\tdoSearch(searchId, currentPageNumber+1);\n\t\t\t}\n\t\t}\n\t});\n}\n\n\n\nvar MarkerSource;\nvar MarkerTemplate;\nvar TimelineTemplate;\nvar TimelineTemplate;\nvar targetTemplate = \"#result-template\";\nvar listTemplate = \"#list-template\";\nvar timeline = null;\n\nvar loadTemplates = function() {\n\tMarkerSource   = $(\"#marker-template\").html();\n\tMarkerTemplate = Handlebars.compile(MarkerSource);\n\n\tTimelineSource   = $(\"#timeline-template\").html();\n\tTimelineTemplate = Handlebars.compile(TimelineSource);\n\t\n}\n\nfunction htmlEntities(str) {\n\treturn String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n\nfunction getCurrentSearchId() {\n\tcurrentURL = window.location.href.replace(window.location.hash,\"\").replace(\"#\", \"\");\n\tcurrentHash = window.location.hash.replace(\"#\", \"\");\n\tif(currentHash.length == 36) {\n\t\t// this is an old hash, we need to keep that\n\t\tsearchId = currentHash;\n\t\twindow.history.pushState({}, \"Search Results\", currentURL + \"/s/\" +searchId);\n\t}\n\telse {\n\t\tsearchId = currentURL.substr(currentURL.lastIndexOf('/') + 1);\n\t}\n\treturn searchId;\n}\n\n\nfunction parseSearch() {\n\t\n\tsearchId = getCurrentSearchId();\n\n\tif(searchId && !disableHashChange) {\n\t\tresetSearchFrame();\n\t\t// you can set a global var \"loadAll\" to cause us to load all available results at pageload.\n\t\t// leaving this here just to make it explicit\n\t\tvar localLoadAll = false;\n\t\tif(typeof loadAll !== 'undefined' && loadAll == true) {\n\t\t\tlocalLoadAll = true;\n\t\t}\n\t\tif(searchId.length < 10) {\n\t\t\t// this is a drawer\n\t\t\tif(typeof loadDrawer !== 'undefined') {\n\t\t\t\tloadDrawer();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdoSearch(searchId, 0, localLoadAll);\n\t\t}\n\t\t\n\t}\n\n}\n\nfunction loadCollectionHeader() {\n\tif($(\"input[name='collection[]']\").length == 1 && $(\"input[name='collection[]']\").val() !== \"0\" && $(\"#searchText\").val() == \"\") {\n\t\t$.get(basePath + \"collections/collectionHeader/\" + $(\"input[name='collection[]']\").val(), function(data) {\n\t\t\t$(\".collectionHeader\").html(data);\n\t\t});\n\t}\n\n}\n\n// ignore results is used to force the server to pre-cache the next set of results\nfunction doSearch(searchId, pageNumber, loadAll, ignoreResults) {\n\tif(!ignoreResults) {\n\t\tpreviousEventComplete = false;\n\t\tcurrentPageNumber = pageNumber;\n\t}\n\n\tloadAll = (loadAll)?\"true\":\"false\";\n\n\t$.get(basePath + \"search/searchResults/\" + searchId + \"/\" + pageNumber + \"/\" + loadAll, function (data) {\n\t\tif(ignoreResults) {\n\t\t\treturn;\n\t\t}\n\t\tvar oldMatches = [];\n\t\tvar oldResults = [];\n\t\ttry{\n\t\t\tif(cachedResults) {\n\t\t\t\toldMatches = cachedResults.matches;\n\t\t\t\toldResults = cachedResults.searchResults;\n\t\t\t}\n\t\t\tcachedResults = data;\n\n\t\t}\n\t\tcatch(e){\n\t\t\talert(e + \" \" + data);\n\t\t}\n\n\t\tif(cachedResults.success === true) {\n\n\t\t\tif(cachedResults.totalResults == 1 ) {\n\t\t\t\t// special case - one match, let's just load it\n\t\t\t\tvar objectId = cachedResults.matches[0].objectId;\n\t\t\t\t$.cookie('lastSearch', searchId, { path: \"/\"});\n\n\t\t\t\t// window.location.hash = \"\";\n\t\t\t\twindow.location.pathname = basePath + \"/asset/viewAsset/\" + objectId;\n\t\t\t}\n\t\t\tcachedResults.totalLoadedCount = cachedResults.matches.length + oldMatches.length;\n\t\t\tprocessSearchResults(cachedResults);\n\t\t\tnewArray = $.merge(cachedResults.matches, oldMatches);\n\t\t\tcachedResults.searchResults = $.merge(cachedResults.searchResults, oldResults);\n\t\t\tcachedResults.matches = newArray;\n\n\t\t\t// we want these to use the full stored set, not just the curret batch, so we run them after merging.\n\t\t\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\t\t\tprepMap();\n\t\t\t}\n\n\t\t\t// we want these to use the full stored set, not just the curret batch, so we run them after merging.\n\t\t\t// if($('a[href=\"#gallery\"]').parent().hasClass(\"active\")) {\n\t\t\t// \tprepGallery();\n\t\t\t// }\n\n\t\t\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\t\t\tcachedDates = null;\n\t\t\t\tprepTimeline();\n\t\t\t}\n\n\t\t}\n\t})\n\t\t.fail(function (e) {\n\t\t\tif (e.readyState > 0) {\n\t\t\t\talert(JSON.stringify(e));\n\t\t\t}\n\t\t\t\n\t\t});\n}\n\nfunction processSearchResults(cachedResults) {\n\tpopulateSearchFields(cachedResults.searchEntry);\n\tloadCollectionHeader();\n\tpopulateSearchResults(cachedResults);\n\tif(cachedResults.matches.length === 0) {\n\t\tdataAvailable = false;\n\t}\n\tpreviousEventComplete = true;\n}\n\n\n\nfunction getSuggestions(searchTerm) {\n\tvar localSearch = searchTerm;\n\t$.post(basePath + \"search/getSuggestion\", {\"searchTerm\":searchTerm}, function(data, textStatus) {\n\t\tvar resultArray = data;\n\t\tif(resultArray.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\t$.each(resultArray, function(index, value) {\n\t\t\tvar reg = new RegExp(index, 'ig');\n\t\t\tlocalSearch = localSearch.replace(reg, value);\n\t\t});\n\n\t\tvar search = $(\"<a>\").addClass(\"useSuggest\").append(localSearch);\n\t\tvar italics = $(\"<i>\").append(search);\n\t\tvar insert = $(\"<div>\").addClass('col-sm-12 suggestionText').append(\"Did you mean: \").append(italics).append(\" ?\");\n\t\t$(\".suggest\").empty();\n\t\t$(\".suggest\").append(insert);\n\n\t});\n\n\n}\n\nfunction populateSearchFields(searchEntry) {\n\t$(\".collectionSelector\").prop('checked', false);\n\t$(\"#showHidden\").prop('checked',false);\n\t$(\".advancedOption\").val();\n\n\tif(searchEntry.searchText.length > 0) {\n\t\tgetSuggestions(searchEntry.searchText);\n\t}\n\n\t$(\".sortBy\").val(searchEntry.sort);\n\n\t$.each(searchEntry, function(index, value) {\n\t\tif(Array.isArray(value)) {\n\t\t\tvar targetField = $(\"#\" + index);\n\t\t\t$.each(value, function(internalIndex, internalValue) {\n\t\t\t\tvar newField = targetField.clone();\n\t\t\t\t$(newField).val(internalValue);\n\t\t\t\t$(newField).appendTo($(\"#\" + index).parent());\n\t\t\t});\n\t\t\t$(targetField).remove();\n\t\t}\n\t\telse {\n\t\t\t$(\"#\" + index).val(value);\t\n\t\t}\n\t\n\t});\n\n\tif($(\"#collection\").val() > 0) {\n\t\ttargetText = $('[data-collection-id=\"' + $(\"#collection\").val() + '\"]').text();\n\t    $(\"#search_concept\").text(targetText);\n\t }\n\n}\n\n\n\nfunction populateSearchResults(searchObject) {\n\t// target template is defined by the hosting include - search page versus drawers, etc\n\tvar source   = $(targetTemplate).html();\n\tvar template = Handlebars.compile(source);\n\tvar listSource   = $(listTemplate).html();\n\tvar listTemplateCompiled = Handlebars.compile(listSource);\n\n\t$.each(searchObject.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = searchObject;\n\t\tvar html    = template(value);\n\t\tvar listHTML    = listTemplateCompiled(value);\n\t\t$(\"#results\").append(html);\n\t\t$(\"#listResults\").append(listHTML);\n\t});\n\n\t// todo refactor\n\tvar source   = $(\"#gallery-template\").html();\n\tvar template = Handlebars.compile(source);\n\t\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = cachedResults;\n\t\tvalue.isChild = false;\n\t\tvar hasChildren = false;\n\t\tif(value.fileAssets > 1 && value.fileAssets < 20) {\n\t\t\thasChildren = true;\n\t\t}\n\t\tvalue.hasChildren = hasChildren;\n\t\tvar html    = template(value);\n\t\t$(\"#previewFrame .frame ul\").append(html);\n\t\tif(hasChildren) {\n\t\t\tfor(i=0; i<value.fileAssets-1; i++) {\n\t\t\t\tvalue.primaryHandlerId = null;\n\t\t\t\tvalue.hasChildren = false;\n\t\t\t\tvalue.isChild = true;\n\t\t\t\tvar html    = template(value);\n\t\t\t\t$(\"#previewFrame .frame ul\").append(html);\n\t\t\t}\n\t\t}\n\t});\n\n\ttotalResults = searchObject.totalResults;\n\t$(\".resultsData\").html(\"<p>Total Results: \"+ searchObject.totalResults + \"</p>\");\n\n\tif(dataAvailable && searchObject.matches.length < searchObject.totalResults && searchObject.totalResults < 1000) {\n\t\t$(\".resultsData p\").append(\" <a href='' id='loadAllResults'>[Load All]</a>\");\n\t}\n\n\tif(searchObject.totalResults > searchObject.totalLoadedCount) {\n\t\t$(\".paginationBlock\").show();\n\t\tresultsAvailable = true;\n\t}\n\telse {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\t\n\tif(searchObject.matches.length == 0) {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\tprepMap();\n\t}\n\n\tif($('a[href=\"#gallery\"]').parent().hasClass(\"active\")) {\n\t\tprepGallery();\n\t}\n\n\n\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\tprepTimeline();\n\t}\n\n\t// have the server precache the new results\n\tif(searchId !== null) {\n\t\tdoSearch(searchId, currentPageNumber+1, false, true);\n\t}\n\n\tevent = new Event(\"searchUpdated\");\n  \tdocument.dispatchEvent(event);\n\n}\n\n\n\nvar galleryFrame = null;\nfunction prepGallery() {\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\n\tif(galleryFrame !== null) {\n\t\tgalleryFrame.reload();\n\t}\n\telse {\n\t\tvar assetsWithChildren = $(\".frame ul\").find('[data-haschildren=\"true\"]');\n\n\t\tassetsWithChildren.each(function(index, el) {\n\t\t\tif($(el).data(\"childrenloaded\") == \"true\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar localEl = el;\n\t\t\tvar primaryHandler = $(el).data('primaryhandler');\n\t\t\t// load the metadata for this record\n\t\t\t$.get(basePath + \"asset/viewAsset/\" + $(el).data(\"objectid\") + \"/true\", function(data) {\n\t\t\t\tparsed = data;\n\t\t\t\tvar fileIds = new Array;\n\t\t\t\tfor (var key in parsed) {\n\t\t\t\t\tif(Array.isArray(parsed[key])) {\n\t\t\t\t\t\tvar newIds = parsed[key].map(function(nestedElem) {\n\t\t\t\t\t\tif(nestedElem.hasOwnProperty('fileId')) {\n\t\t\t\t\t\t\treturn nestedElem.fileId;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t}).filter((elem)=>{ return elem!=null}).filter((elem)=>{ return elem != primaryHandler});\n\t\t\t\t\t\tfileIds = fileIds.concat(newIds);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(parsed.relatedAssetCache) {\n\t\t\t\t\tfor (var key in parsed.relatedAssetCache) { \n\t\t\t\t\t\telement = parsed.relatedAssetCache[key];\n\t\t\t\t\t\tif (!element.ignoreForDigitalAsset) {\n\t\t\t\t\t\t\tif (element.primaryHandler && element.primaryHandler.length > 0) {\n\t\t\t\t\t\t\t\tfileIds.push(element.primaryHandler);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor(fileId of fileIds) {\n\t\t\t\t\ttargetElement = $(\".frame ul\").find('[data-objectid=\"' + $(el).data(\"objectid\") + '\"]').filter('[data-ischild=\"true\"]').filter('[data-primaryhandler=\"\"]').first();\n\t\t\t\t\ttargetElement.attr(\"data-primaryhandler\", fileId);\n\t\t\t\t\ttargetElement.children(\"img\").attr(\"src\", basePath+\"fileManager/previewImageByFileId/\" + fileId);\n\t\t\t\t\ttargetElement.children(\"img\").attr(\"srcset\", basePath+\"fileManager/previewImageByFileId/\" + fileId + \"/true 2x\");\n\t\t\t\t}\n\t\t\t\t$(el).data(\"childrenloaded\", \"true\");\n\t\t\t});\n\t\t\t\n\t\t});\n\n\n\t\tsourceFrame = $('#forcecentered');\n\n\t\tvar $wrap  = sourceFrame.parent();\n\n\t\t// Call Sly on frame\n\t\tgalleryFrame = new Sly($('#forcecentered'), {\n\t\t\thorizontal: 1,\n\t\t\titemNav: 'forceCentered',\n\t\t\tkeyboardNavBy: 'items',\n\t\t\tsmart: 1,\n\t\t\tactivateMiddle: 0,\n\t\t\tactivateOn: 'click',\n\t\t\tmouseDragging: 1,\n\t\t\ttouchDragging: 1,\n\t\t\treleaseSwing: 1,\n\t\t\tstartAt: 0,\n\t\t\tscrollBar: $wrap.find('.scrollbar'),\n\t\t\tscrollBy: 1,\n\t\t\tspeed: 300,\n\t\t\telasticBounds: 1,\n\t\t\teasing: 'easeOutExpo',\n\t\t\tdragHandle: 1,\n\t\t\tdynamicHandle: 1,\n\t\t\tclickBar: 1,\n\n\t\t\t// Buttons\n\t\t\tprev: $wrap.find('.prev'),\n\t\t\tnext: $wrap.find('.next')\n\t\t}).init();\n\n\t\tgalleryFrame.on('active', function(event, item) { \n\t\t\tloadGalleryElement(item);\n\t\t});\n\n\t\tloadGalleryElement(0);\n\t}\n}\n\nfunction loadGalleryElement(index) {\n\ttargetItem = galleryFrame.items[index].el;\n\t$(\".frameHeader\").html(\"<a href='\" + basePath + \"asset/viewAsset/\" + $(targetItem).data(\"objectid\") + \"'><h2>\" + $(targetItem).data(\"title\") + \"</h2></a>\" );\n\t$(\".galleryIframe\").attr(\"src\", basePath + \"asset/getEmbed/\" + $(targetItem).data(\"primaryhandler\") + \"/\" + $(targetItem).data(\"objectid\") + \"/true\");\n}\n\n\nfunction prepMap() {\n\t\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\tif(markers[\"mapPane\"]) {\n\t\tmarkers[\"mapPane\"].clearLayers();\t\n\t}\n\t\n\tif(!map[\"mapPane\"]) {\n\t\tloadMap(\"mapPane\");\n\t}\n\tmarkers[\"mapPane\"] = L.markerClusterGroup({ showCoverageOnHover: false});\n\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tif(value.locations) {\n\t\t\t$.each(value.locations, function (index2, value2) {\n\t\t\t\t$.each(value2.entries, function(index3, value3) {\n\n\t\t\t\t\tloc = value3.loc.coordinates;\n\t\t\t\t\tvalue.base_url = basePath;\n\t\t\t\t\tvar html    = MarkerTemplate(value);\n\n\t\t\t\t\tif(loc[1] === 0 && loc[0] === 0) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tlocalMarker = L.marker([loc[1],loc[0]]);  \n\t\t\t\t\tlocalMarker.bindPopup(html);\n  \t\t\t\t\tmarkers[\"mapPane\"].addLayer(localMarker);\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t});\n\n\tmap[\"mapPane\"].addLayer(markers[\"mapPane\"]);\n\tmap[\"mapPane\"].fitBounds(markers[\"mapPane\"].getBounds().pad(0.5)); \n\n}\n\n\nfunction prepTimeline() {\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\n\tvar compiledDate = {};\n\tvar geoTime = false;\n\n\tcompiledDate.events = new Array();\n\tfor (var match of cachedResults.matches) {\n\n\t\t// if we don't have a special dates propery, we can ignore this one\n\t\tif(!match.hasOwnProperty(\"dates\")) {\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\tfor(var dates of match.dates) {\n\t\t\tfor(var date of dates.dateAsset) {\n\t\t\t\tstartTime = parseInt(date.start[\"numeric\"], 10);\n\t\t\t\tif(startTime < -6373557595440) {\n\t\t\t\t\tgeoTime = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\n\t\tfor(var dates of match.dates) {\n\t\t\tfor(var date of dates.dateAsset) {\n\t\t\t\tvar newItem = {};\n\t\t\t\tstartTime = parseInt(date.start[\"numeric\"], 10);\n\t\t\t\tnewItem.start_date = {};\n\t\t\t\tif(geoTime) {\n\t\t\t\t\tstartYear = -1 * Math.round(Math.abs((startTime + (1970*31556900)) / 31556900));\n\t\t\t\t\tnewItem.start_date.year = startYear;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\tt.setSeconds(startTime);\n\t\t\t\t\tformattedStart = Sugar.Date.create(t, {fromUTC: true});\n\t\t\t\t\tnewItem.start_date.display_date = date.start[\"text\"];\n\t\t\t\t\tnewItem.start_date.year = formattedStart.getFullYear();\n\t\t\t\t\tnewItem.start_date.month = formattedStart.getMonth() + 1;\n\t\t\t\t\tnewItem.start_date.day = formattedStart.getDay() + 1;\n\n\t\t\t\t}\n\t\t\t\tif(date.end[\"numeric\"] && date.end[\"numeric\"].toString().length>0) {\n\t\t\t\t\tnewItem.end_date = {};\n\t\t\t\t\tendTime = parseInt(date.end[\"numeric\"], 10);\n\n\t\t\t\t\tif(geoTime) {\n\t\t\t\t\t\tendYear = -1 * Math.round(Math.abs((endTime+ (1970*31556900)) / 31556900));\n\t\t\t\t\t\tnewItem.end_date.year = endYear;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\t\tt.setSeconds(endTime);\n\t\t\t\t\t\tformattedEnd = Sugar.Date.create(t, {fromUTC: true});\n\t\t\t\t\t\tnewItem.end_date.display_date = date.end[\"text\"];\n\t\t\t\t\t\tnewItem.end_date.year = formattedEnd.getFullYear();\n\t\t\t\t\t\tnewItem.end_date.month = formattedEnd.getMonth() + 1;\n\t\t\t\t\t\tnewItem.end_date.day = formattedEnd.getDay() + 1;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvar html    = TimelineTemplate(match);\n\n\t\t\t\tnewItem.text = {};\n\t\t\t\tnewElement = $(\"<a/>\", {\"href\": basePath + \"asset/viewAsset/\" + match.objectId, \"text\": match.title});\n\t\t\t\tnewItem.text.headline = newElement.prop(\"outerHTML\");\n\t\t\t\tnewItem.text.text = html;\n\n\t\t\t\tif(match.hasOwnProperty(\"primaryHandlerThumbnail2x\")) {\n\t\t\t\t\tnewItem.media = {};\n\t\t\t\t\tnewItem.media.thumb = match.primaryHandlerThumbnail2x;\n\t\t\t\t\tnewItem.media.url = match.primaryHandlerThumbnail2x;\t\n\t\t\t\t}\n\n\t\t\t\t// dedupe our array\n\t\t\t\tvar ignoreItem = false;\n\t\t\t\tfor(var existingDate of compiledDate.events) {\n\t\t\t\t\tif(JSON.stringify(existingDate) == JSON.stringify(newItem)) {\n\t\t\t\t\t\tignoreItem = true;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(!ignoreItem) {\n\t\t\t\t\tcompiledDate.events.push(newItem);\t\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t}\n\t\t}\n\n\n\n\t}\n\n\tif(geoTime) {\n\t\tcompiledDate.scale = \"cosmological\"\n\t\tinjectStyles(\".tl-timeaxis-minor { display: none; }\");\n\t}\n\telse {\n\t\t$(\"#hackyGeoStyle\").remove();\n\t}\n\n\ttimeline = new TL.Timeline('timelinePane', compiledDate, {\n        timenav_position: \"bottom\",\n        timenav_height_percentage: \"70\"\n\t});\n\n\n}\n\nfunction injectStyles(rule) {\n  var div = $(\"<div />\", {\n    id: \"hackyGeoStyle\",\n    html: '&shy;<style>' + rule + '</style>'\n  }).appendTo(\"body\");    \n}\n\n\n\n"],"names":["currentPageNumber","eventSource","MarkerSource","MarkerTemplate","TimelineTemplate","cachedResults","cachedDates","searchId","resultsAvailable","previousEventComplete","dataAvailable","disableHashChange","totalResults","registerClickHandlers","$","document","ready","registerScrollHandlers","loadTemplates","location","hash","tab","on","e","history","pushState","target","attr","substr","val","prepTimeline","prepMap","prepGallery","find","trigger","doSearch","preventDefault","embedPath","window","hostname","basePath","getCurrentSearchId","iFrameContent","embedContent","htmlEntities","bootbox","dialog","title","message","buttons","success","label","className","this","select","href","fullscreen","isNativelySupported","first","toggleClass","cookie","path","text","submit","performSearchForButtonPress","hide","scroll","height","scrollTop","targetTemplate","listTemplate","timeline","html","Handlebars","compile","TimelineSource","str","String","replace","currentURL","currentHash","length","lastIndexOf","parseSearch","localLoadAll","resetSearchFrame","loadAll","loadDrawer","loadCollectionHeader","get","data","pageNumber","ignoreResults","oldMatches","oldResults","matches","searchResults","alert","objectId","pathname","totalLoadedCount","processSearchResults","newArray","merge","parent","hasClass","fail","readyState","JSON","stringify","populateSearchFields","searchEntry","populateSearchResults","getSuggestions","searchTerm","localSearch","post","textStatus","each","index","value","reg","RegExp","search","addClass","append","italics","insert","empty","prop","searchText","sort","targetField","Array","isArray","internalIndex","internalValue","newField","clone","appendTo","remove","targetText","searchObject","source","template","listSource","listTemplateCompiled","base_url","listHTML","hasChildren","isChild","fileAssets","i","primaryHandlerId","show","event","Event","dispatchEvent","galleryFrame","$wrap","reload","el","primaryHandler","parsed","newIds","fileIds","key","map","nestedElem","hasOwnProperty","fileId","filter","elem","concat","relatedAssetCache","element","ignoreForDigitalAsset","push","targetElement","children","sourceFrame","Sly","horizontal","itemNav","keyboardNavBy","smart","activateMiddle","activateOn","mouseDragging","touchDragging","releaseSwing","startAt","scrollBar","scrollBy","speed","elasticBounds","easing","dragHandle","dynamicHandle","clickBar","prev","next","init","item","loadGalleryElement","targetItem","items","markers","clearLayers","loadMap","L","markerClusterGroup","showCoverageOnHover","locations","index2","value2","entries","index3","value3","loc","coordinates","localMarker","marker","bindPopup","addLayer","fitBounds","getBounds","pad","match","compiledDate","geoTime","events","dates","date","dateAsset","startTime","parseInt","start","existingDate","newItem","start_date","startYear","Math","round","abs","year","t","Date","setSeconds","formattedStart","Sugar","create","fromUTC","display_date","getFullYear","month","getMonth","day","getDay","end","toString","end_date","endTime","endYear","formattedEnd","ignoreItem","newElement","headline","media","thumb","primaryHandlerThumbnail2x","url","scale","injectStyles","TL","Timeline","timenav_position","timenav_height_percentage","rule","id"],"mappings":"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"}