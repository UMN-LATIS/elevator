{"version":3,"sources":["search.js"],"names":["currentPageNumber","eventSource","cachedResults","cachedDates","searchId","resultsAvailable","previousEventComplete","dataAvailable","disableHashChange","totalResults","$","document","ready","registerScrollHandlers","registerClickHandlers","loadTemplates","location","hash","tab","on","e","history","pushState","target","attr","substr","MarkerSource","MarkerTemplate","TimelineTemplate","val","prepTimeline","prepMap","prepGallery","find","trigger","doSearch","preventDefault","embedPath","window","hostname","basePath","getCurrentSearchId","iFrameContent","embedContent","htmlEntities","bootbox","dialog","title","message","buttons","success","label","className","this","select","href","fullscreen","isNativelySupported","first","toggleClass","cookie","path","text","submit","performSearchForButtonPress","hide","scroll","height","scrollTop","targetTemplate","listTemplate","timeline","html","Handlebars","compile","TimelineSource","str","String","replace","currentURL","currentHash","length","lastIndexOf","parseSearch","resetSearchFrame","localLoadAll","loadAll","loadDrawer","loadCollectionHeader","get","data","pageNumber","ignoreResults","oldMatches","oldResults","matches","searchResults","alert","objectId","pathname","totalLoadedCount","processSearchResults","newArray","merge","parent","hasClass","fail","readyState","JSON","stringify","populateSearchFields","searchEntry","populateSearchResults","getSuggestions","searchTerm","localSearch","post","textStatus","resultArray","each","index","value","reg","RegExp","search","addClass","append","italics","insert","empty","prop","searchText","sort","Array","isArray","targetField","internalIndex","internalValue","newField","clone","appendTo","remove","targetText","searchObject","source","template","listSource","listTemplateCompiled","base_url","listHTML","isChild","hasChildren","fileAssets","i","primaryHandlerId","show","event","Event","dispatchEvent","galleryFrame","reload","el","primaryHandler","parsed","fileIds","key","newIds","map","nestedElem","hasOwnProperty","fileId","filter","elem","concat","relatedAssetCache","element","ignoreForDigitalAsset","push","targetElement","children","sourceFrame","$wrap","Sly","horizontal","itemNav","keyboardNavBy","smart","activateMiddle","activateOn","mouseDragging","touchDragging","releaseSwing","startAt","scrollBar","scrollBy","speed","elasticBounds","easing","dragHandle","dynamicHandle","clickBar","prev","next","init","item","loadGalleryElement","targetItem","items","markers","clearLayers","loadMap","L","markerClusterGroup","showCoverageOnHover","locations","index2","value2","entries","index3","value3","loc","coordinates","localMarker","marker","bindPopup","addLayer","fitBounds","getBounds","pad","compiledDate","geoTime","match","events","dates","date","dateAsset","startTime","parseInt","start","newItem","start_date","startYear","Math","round","abs","year","t","Date","setSeconds","formattedStart","Sugar","create","fromUTC","display_date","getFullYear","month","getMonth","day","getDay","end","toString","end_date","endTime","endYear","formattedEnd","newElement","headline","media","thumb","primaryHandlerThumbnail2x","url","ignoreItem","existingDate","scale","injectStyles","TL","Timeline","timenav_position","timenav_height_percentage","rule","id"],"mappings":"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","file":"search.min.js","sourcesContent":["\nvar cachedResults = \"\";\nvar cachedDates = null;\nvar searchId = null;\nvar currentPageNumber;\nvar eventSource;\nvar resultsAvailable = true;\nvar previousEventComplete = true;\nvar dataAvailable = true;\nvar disableHashChange = false;\nvar totalResults = 0;\n\n$(document).ready(function() {\n\n\tregisterScrollHandlers();\n\tregisterClickHandlers();\n\tloadTemplates();\n\t\n\n\t// if we have a specific tab specified (gallery, list, etc) load that\n\tif (location.hash !== '')  {\n\t\t$('a[href=\"' + location.hash + '\"]').tab('show');\n\t}\n\n\t// remember the hash in the URL without jumping\n    $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function(e) {\n       if(history.pushState) {\n            history.pushState(null, null, '#'+$(e.target).attr('href').substr(1));\n       } else {\n            location.hash = '#'+$(e.target).attr('href').substr(1);\n       }\n    });\n});\n\n\nvar registerClickHandlers = function() {\n\n\t$(\".searchText\").on(\"blur\", function() {\n\t\t$(\".advancedSearchText\").val($(\".searchText\").val());\n\t});\n\n\t$(\".advancedSearchText\").on(\"blur\", function() {\n\t\t$(\".searchText\").val($(\".advancedSearchText\").val());\n\t});\n\n\t$('a[href=\"#timeline\"]').on('shown.bs.tab', function() {\n\t\tcachedDates = null;\n\t\tprepTimeline();\n\t});\n\t$('a[href=\"#map\"]').on('shown.bs.tab', function() {\n\t\tprepMap();\n\t});\n\t$('a[href=\"#gallery\"]').on('shown.bs.tab', function() {\n\t\tprepGallery();\n\t});\n\t$('a[href=\"#grid\"]').on('shown.bs.tab', function() {\n\t\t$(\"#results\").find(\"img\").trigger(\"show\");\n\t});\n\t$('a[href=\"#list\"]').on('shown.bs.tab', function() {\n\t\t$(\"#listResults\").find(\"img\").trigger(\"show\");\n\t});\n\n\t$(\".nextPage\").on(\"click\",function() {\n\t\tdoSearch(searchId, currentPageNumber+1);\n\t\treturn false;\n\t});\n\n\t$(\".embedMap\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath =  \"//\" + window.location.hostname + basePath + \"search/map/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this map\",\n\t\t\tmessage: \"Use the HTML below to embed this map in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n    });\n\n\t$(\".embedTimeline\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath = \"//\" + window.location.hostname + basePath + \"search/timeline/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this timeline\",\n\t\t\tmessage: \"Use the HTML below to embed this timeline in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    });\n\n    $(\".embedGallery\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath = \"//\" + window.location.hostname + basePath + \"search/gallery/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this gallery\",\n\t\t\tmessage: \"Use the HTML below to embed this gallery in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    });\n\n\t$(document).on(\"click\", \".embedControl\", function() {\n\t\t$(this).select();\n\t});\n\n\n\t$(document).on(\"click\", \".exportCSV\", function(e) {\n\t\te.preventDefault();\n\t\ttarget = e.target.href;\n\t\twindow.location = target + \"#\" + searchId;\n\n\t});\n\n\t$(document).on(\"click\", \".fullscreen\", function() {\n\t\tif($.fullscreen.isNativelySupported()) {\n\t\t\t$(\".frameFullscreenContainer\").first().fullscreen({ \"toggleClass\": \"imageFullscreen\"});\n\t\t}\n\t});\n\t\n\t$(document).on(\"click\", \".assetLink\", function(e) {\n\t\t$.cookie('lastSearch', searchId, { path: \"/\"});\n\t});\n\n\t$(document).on(\"click\", \".useSuggest\", function() {\n\t\t$(\".searchText\").val($(this).text());\n\t\t$(\".searchForm\").submit();\n\t});\n\n\t$(document).on(\"change\", \".sortBy\", function() {\n\t\t$(\".hiddenSort\").val($(this).val());\n\t\tperformSearchForButtonPress($(\".searchForm\").first());\n\t});\n\n\n\t$(document).on(\"click\", \"#loadAllResults\", function(e) {\n\t\te.preventDefault();\n\t\tif(dataAvailable) {\n\t\t\tdoSearch(searchId, currentPageNumber+1, true);\n\t\t\tdataAvailable = false;\n\t\t\t$(\"#loadAllResults\").hide();\n\t\t\t$(\".paginationBlock\").hide();\n\t\t\tresultsAvailable = false;\n\t\t}\n\t});\n\n\n}\n\nvar registerScrollHandlers = function() {\n\t\t$(window).scroll(function(){\n\t\tif (resultsAvailable && $(document).height() - 50 <= $(window).scrollTop() + $(window).height()) {\n\t\t\tif(($('.nav-tabs .active').text() == \"Grid\" || $('.nav-tabs .active').text() == \"List\") && previousEventComplete && dataAvailable) {\n\t\t\t\tdoSearch(searchId, currentPageNumber+1);\n\t\t\t}\n\t\t}\n\t});\n}\n\n\n\nvar MarkerSource;\nvar MarkerTemplate;\nvar TimelineTemplate;\nvar TimelineTemplate;\nvar targetTemplate = \"#result-template\";\nvar listTemplate = \"#list-template\";\nvar timeline = null;\n\nvar loadTemplates = function() {\n\tMarkerSource   = $(\"#marker-template\").html();\n\tMarkerTemplate = Handlebars.compile(MarkerSource);\n\n\tTimelineSource   = $(\"#timeline-template\").html();\n\tTimelineTemplate = Handlebars.compile(TimelineSource);\n\t\n}\n\nfunction htmlEntities(str) {\n\treturn String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n\nfunction getCurrentSearchId() {\n\tcurrentURL = window.location.href.replace(window.location.hash,\"\").replace(\"#\", \"\");\n\tcurrentHash = window.location.hash.replace(\"#\", \"\");\n\tif(currentHash.length == 36) {\n\t\t// this is an old hash, we need to keep that\n\t\tsearchId = currentHash;\n\t\twindow.history.pushState({}, \"Search Results\", currentURL + \"/s/\" +searchId);\n\t}\n\telse {\n\t\tsearchId = currentURL.substr(currentURL.lastIndexOf('/') + 1);\n\t}\n\treturn searchId;\n}\n\n\nfunction parseSearch() {\n\t\n\tsearchId = getCurrentSearchId();\n\n\tif(searchId && !disableHashChange) {\n\t\tresetSearchFrame();\n\t\t// you can set a global var \"loadAll\" to cause us to load all available results at pageload.\n\t\t// leaving this here just to make it explicit\n\t\tvar localLoadAll = false;\n\t\tif(typeof loadAll !== 'undefined' && loadAll == true) {\n\t\t\tlocalLoadAll = true;\n\t\t}\n\t\tif(searchId.length < 10) {\n\t\t\t// this is a drawer\n\t\t\tif(typeof loadDrawer !== 'undefined') {\n\t\t\t\tloadDrawer();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdoSearch(searchId, 0, localLoadAll);\n\t\t}\n\t\t\n\t}\n\n}\n\nfunction loadCollectionHeader() {\n\tif($(\"input[name='collection[]']\").length == 1 && $(\"input[name='collection[]']\").val() !== \"0\" && $(\"#searchText\").val() == \"\") {\n\t\t$.get(basePath + \"collections/collectionHeader/\" + $(\"input[name='collection[]']\").val(), function(data) {\n\t\t\t$(\".collectionHeader\").html(data);\n\t\t});\n\t}\n\n}\n\n// ignore results is used to force the server to pre-cache the next set of results\nfunction doSearch(searchId, pageNumber, loadAll, ignoreResults) {\n\tif(!ignoreResults) {\n\t\tpreviousEventComplete = false;\n\t\tcurrentPageNumber = pageNumber;\n\t}\n\n\tloadAll = (loadAll)?\"true\":\"false\";\n\n\t$.get(basePath + \"search/searchResults/\" + searchId + \"/\" + pageNumber + \"/\" + loadAll, function (data) {\n\t\tif(ignoreResults) {\n\t\t\treturn;\n\t\t}\n\t\tvar oldMatches = [];\n\t\tvar oldResults = [];\n\t\ttry{\n\t\t\tif(cachedResults) {\n\t\t\t\toldMatches = cachedResults.matches;\n\t\t\t\toldResults = cachedResults.searchResults;\n\t\t\t}\n\t\t\tcachedResults = data;\n\n\t\t}\n\t\tcatch(e){\n\t\t\talert(e + \" \" + data);\n\t\t}\n\n\t\tif(cachedResults.success === true) {\n\n\t\t\tif(cachedResults.totalResults == 1 ) {\n\t\t\t\t// special case - one match, let's just load it\n\t\t\t\tvar objectId = cachedResults.matches[0].objectId;\n\t\t\t\t$.cookie('lastSearch', searchId, { path: \"/\"});\n\n\t\t\t\t// window.location.hash = \"\";\n\t\t\t\twindow.location.pathname = basePath + \"/asset/viewAsset/\" + objectId;\n\t\t\t}\n\t\t\tcachedResults.totalLoadedCount = cachedResults.matches.length + oldMatches.length;\n\t\t\tprocessSearchResults(cachedResults);\n\t\t\tnewArray = $.merge(cachedResults.matches, oldMatches);\n\t\t\tcachedResults.searchResults = $.merge(cachedResults.searchResults, oldResults);\n\t\t\tcachedResults.matches = newArray;\n\n\t\t\t// we want these to use the full stored set, not just the curret batch, so we run them after merging.\n\t\t\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\t\t\tprepMap();\n\t\t\t}\n\n\t\t\t// we want these to use the full stored set, not just the curret batch, so we run them after merging.\n\t\t\t// if($('a[href=\"#gallery\"]').parent().hasClass(\"active\")) {\n\t\t\t// \tprepGallery();\n\t\t\t// }\n\n\t\t\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\t\t\tcachedDates = null;\n\t\t\t\tprepTimeline();\n\t\t\t}\n\n\t\t}\n\t})\n\t\t.fail(function (e) {\n\t\t\tif (e.readyState > 0) {\n\t\t\t\talert(JSON.stringify(e));\n\t\t\t}\n\t\t\t\n\t\t});\n}\n\nfunction processSearchResults(cachedResults) {\n\tpopulateSearchFields(cachedResults.searchEntry);\n\tloadCollectionHeader();\n\tpopulateSearchResults(cachedResults);\n\tif(cachedResults.matches.length === 0) {\n\t\tdataAvailable = false;\n\t}\n\tpreviousEventComplete = true;\n}\n\n\n\nfunction getSuggestions(searchTerm) {\n\tvar localSearch = searchTerm;\n\t$.post(basePath + \"search/getSuggestion\", {\"searchTerm\":searchTerm}, function(data, textStatus) {\n\t\tvar resultArray = data;\n\t\tif(resultArray.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\t$.each(resultArray, function(index, value) {\n\t\t\tvar reg = new RegExp(index, 'ig');\n\t\t\tlocalSearch = localSearch.replace(reg, value);\n\t\t});\n\n\t\tvar search = $(\"<a>\").addClass(\"useSuggest\").append(localSearch);\n\t\tvar italics = $(\"<i>\").append(search);\n\t\tvar insert = $(\"<div>\").addClass('col-sm-12 suggestionText').append(\"Did you mean: \").append(italics).append(\" ?\");\n\t\t$(\".suggest\").empty();\n\t\t$(\".suggest\").append(insert);\n\n\t});\n\n\n}\n\nfunction populateSearchFields(searchEntry) {\n\t$(\".collectionSelector\").prop('checked', false);\n\t$(\"#showHidden\").prop('checked',false);\n\t$(\".advancedOption\").val();\n\n\tif(searchEntry.searchText.length > 0) {\n\t\tgetSuggestions(searchEntry.searchText);\n\t}\n\n\t$(\".sortBy\").val(searchEntry.sort);\n\n\t$.each(searchEntry, function(index, value) {\n\t\tif(Array.isArray(value)) {\n\t\t\tvar targetField = $(\"#\" + index);\n\t\t\t$.each(value, function(internalIndex, internalValue) {\n\t\t\t\tvar newField = targetField.clone();\n\t\t\t\t$(newField).val(internalValue);\n\t\t\t\t$(newField).appendTo($(\"#\" + index).parent());\n\t\t\t});\n\t\t\t$(targetField).remove();\n\t\t}\n\t\telse {\n\t\t\t$(\"#\" + index).val(value);\t\n\t\t}\n\t\n\t});\n\n\tif($(\"#collection\").val() > 0) {\n\t\ttargetText = $('[data-collection-id=\"' + $(\"#collection\").val() + '\"]').text();\n\t    $(\"#search_concept\").text(targetText);\n\t }\n\n}\n\n\n\nfunction populateSearchResults(searchObject) {\n\t// target template is defined by the hosting include - search page versus drawers, etc\n\tvar source   = $(targetTemplate).html();\n\tvar template = Handlebars.compile(source);\n\tvar listSource   = $(listTemplate).html();\n\tvar listTemplateCompiled = Handlebars.compile(listSource);\n\n\t$.each(searchObject.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = searchObject;\n\t\tvar html    = template(value);\n\t\tvar listHTML    = listTemplateCompiled(value);\n\t\t$(\"#results\").append(html);\n\t\t$(\"#listResults\").append(listHTML);\n\t});\n\n\t// todo refactor\n\tvar source   = $(\"#gallery-template\").html();\n\tvar template = Handlebars.compile(source);\n\t\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = cachedResults;\n\t\tvalue.isChild = false;\n\t\tvar hasChildren = false;\n\t\tif(value.fileAssets > 1 && value.fileAssets < 20) {\n\t\t\thasChildren = true;\n\t\t}\n\t\tvalue.hasChildren = hasChildren;\n\t\tvar html    = template(value);\n\t\t$(\"#previewFrame .frame ul\").append(html);\n\t\tif(hasChildren) {\n\t\t\tfor(i=0; i<value.fileAssets-1; i++) {\n\t\t\t\tvalue.primaryHandlerId = null;\n\t\t\t\tvalue.hasChildren = false;\n\t\t\t\tvalue.isChild = true;\n\t\t\t\tvar html    = template(value);\n\t\t\t\t$(\"#previewFrame .frame ul\").append(html);\n\t\t\t}\n\t\t}\n\t});\n\n\ttotalResults = searchObject.totalResults;\n\t$(\".resultsData\").html(\"<p>Total Results: \"+ searchObject.totalResults + \"</p>\");\n\n\tif(dataAvailable && searchObject.matches.length < searchObject.totalResults && searchObject.totalResults < 1000) {\n\t\t$(\".resultsData p\").append(\" <a href='' id='loadAllResults'>[Load All]</a>\");\n\t}\n\n\tif(searchObject.totalResults > searchObject.totalLoadedCount) {\n\t\t$(\".paginationBlock\").show();\n\t\tresultsAvailable = true;\n\t}\n\telse {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\t\n\tif(searchObject.matches.length == 0) {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\tprepMap();\n\t}\n\n\tif($('a[href=\"#gallery\"]').parent().hasClass(\"active\")) {\n\t\tprepGallery();\n\t}\n\n\n\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\tprepTimeline();\n\t}\n\n\t// have the server precache the new results\n\tif(searchId !== null) {\n\t\tdoSearch(searchId, currentPageNumber+1, false, true);\n\t}\n\n\tevent = new Event(\"searchUpdated\");\n  \tdocument.dispatchEvent(event);\n\n}\n\n\n\nvar galleryFrame = null;\nfunction prepGallery() {\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\n\tif(galleryFrame !== null) {\n\t\tgalleryFrame.reload();\n\t}\n\telse {\n\t\tvar assetsWithChildren = $(\".frame ul\").find('[data-haschildren=\"true\"]');\n\n\t\tassetsWithChildren.each(function(index, el) {\n\t\t\tif($(el).data(\"childrenloaded\") == \"true\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar localEl = el;\n\t\t\tvar primaryHandler = $(el).data('primaryhandler');\n\t\t\t// load the metadata for this record\n\t\t\t$.get(basePath + \"asset/viewAsset/\" + $(el).data(\"objectid\") + \"/true\", function(data) {\n\t\t\t\tparsed = data;\n\t\t\t\tvar fileIds = new Array;\n\t\t\t\tfor (var key in parsed) {\n\t\t\t\t\tif(Array.isArray(parsed[key])) {\n\t\t\t\t\t\tvar newIds = parsed[key].map(function(nestedElem) {\n\t\t\t\t\t\tif(nestedElem.hasOwnProperty('fileId')) {\n\t\t\t\t\t\t\treturn nestedElem.fileId;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t}).filter((elem)=>{ return elem!=null}).filter((elem)=>{ return elem != primaryHandler});\n\t\t\t\t\t\tfileIds = fileIds.concat(newIds);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(parsed.relatedAssetCache) {\n\t\t\t\t\tfor (var key in parsed.relatedAssetCache) { \n\t\t\t\t\t\telement = parsed.relatedAssetCache[key];\n\t\t\t\t\t\tif (!element.ignoreForDigitalAsset) {\n\t\t\t\t\t\t\tif (element.primaryHandler && element.primaryHandler.length > 0) {\n\t\t\t\t\t\t\t\tfileIds.push(element.primaryHandler);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor(fileId of fileIds) {\n\t\t\t\t\ttargetElement = $(\".frame ul\").find('[data-objectid=\"' + $(el).data(\"objectid\") + '\"]').filter('[data-ischild=\"true\"]').filter('[data-primaryhandler=\"\"]').first();\n\t\t\t\t\ttargetElement.attr(\"data-primaryhandler\", fileId);\n\t\t\t\t\ttargetElement.children(\"img\").attr(\"src\", basePath+\"fileManager/previewImageByFileId/\" + fileId);\n\t\t\t\t\ttargetElement.children(\"img\").attr(\"srcset\", basePath+\"fileManager/previewImageByFileId/\" + fileId + \"/true 2x\");\n\t\t\t\t}\n\t\t\t\t$(el).data(\"childrenloaded\", \"true\");\n\t\t\t});\n\t\t\t\n\t\t});\n\n\n\t\tsourceFrame = $('#forcecentered');\n\n\t\tvar $wrap  = sourceFrame.parent();\n\n\t\t// Call Sly on frame\n\t\tgalleryFrame = new Sly($('#forcecentered'), {\n\t\t\thorizontal: 1,\n\t\t\titemNav: 'forceCentered',\n\t\t\tkeyboardNavBy: 'items',\n\t\t\tsmart: 1,\n\t\t\tactivateMiddle: 0,\n\t\t\tactivateOn: 'click',\n\t\t\tmouseDragging: 1,\n\t\t\ttouchDragging: 1,\n\t\t\treleaseSwing: 1,\n\t\t\tstartAt: 0,\n\t\t\tscrollBar: $wrap.find('.scrollbar'),\n\t\t\tscrollBy: 1,\n\t\t\tspeed: 300,\n\t\t\telasticBounds: 1,\n\t\t\teasing: 'easeOutExpo',\n\t\t\tdragHandle: 1,\n\t\t\tdynamicHandle: 1,\n\t\t\tclickBar: 1,\n\n\t\t\t// Buttons\n\t\t\tprev: $wrap.find('.prev'),\n\t\t\tnext: $wrap.find('.next')\n\t\t}).init();\n\n\t\tgalleryFrame.on('active', function(event, item) { \n\t\t\tloadGalleryElement(item);\n\t\t});\n\n\t\tloadGalleryElement(0);\n\t}\n}\n\nfunction loadGalleryElement(index) {\n\ttargetItem = galleryFrame.items[index].el;\n\t$(\".frameHeader\").html(\"<a href='\" + basePath + \"asset/viewAsset/\" + $(targetItem).data(\"objectid\") + \"'><h2>\" + $(targetItem).data(\"title\") + \"</h2></a>\" );\n\t$(\".galleryIframe\").attr(\"src\", basePath + \"asset/getEmbed/\" + $(targetItem).data(\"primaryhandler\") + \"/\" + $(targetItem).data(\"objectid\") + \"/true\");\n}\n\n\nfunction prepMap() {\n\t\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\tif(markers[\"mapPane\"]) {\n\t\tmarkers[\"mapPane\"].clearLayers();\t\n\t}\n\t\n\tif(!map[\"mapPane\"]) {\n\t\tloadMap(\"mapPane\");\n\t}\n\tmarkers[\"mapPane\"] = L.markerClusterGroup({ showCoverageOnHover: false});\n\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tif(value.locations) {\n\t\t\t$.each(value.locations, function (index2, value2) {\n\t\t\t\t$.each(value2.entries, function(index3, value3) {\n\n\t\t\t\t\tloc = value3.loc.coordinates;\n\t\t\t\t\tvalue.base_url = basePath;\n\t\t\t\t\tvar html    = MarkerTemplate(value);\n\n\t\t\t\t\tif(loc[1] === 0 && loc[0] === 0) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tlocalMarker = L.marker([loc[1],loc[0]]);  \n\t\t\t\t\tlocalMarker.bindPopup(html);\n  \t\t\t\t\tmarkers[\"mapPane\"].addLayer(localMarker);\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t});\n\n\tmap[\"mapPane\"].addLayer(markers[\"mapPane\"]);\n\tmap[\"mapPane\"].fitBounds(markers[\"mapPane\"].getBounds().pad(0.5)); \n\n}\n\n\nfunction prepTimeline() {\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\n\tvar compiledDate = {};\n\tvar geoTime = false;\n\n\tcompiledDate.events = new Array();\n\tfor (var match of cachedResults.matches) {\n\n\t\t// if we don't have a special dates propery, we can ignore this one\n\t\tif(!match.hasOwnProperty(\"dates\")) {\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\tfor(var dates of match.dates) {\n\t\t\tfor(var date of dates.dateAsset) {\n\t\t\t\tstartTime = parseInt(date.start[\"numeric\"], 10);\n\t\t\t\tif(startTime < -6373557595440) {\n\t\t\t\t\tgeoTime = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\n\t\tfor(var dates of match.dates) {\n\t\t\tfor(var date of dates.dateAsset) {\n\t\t\t\tvar newItem = {};\n\t\t\t\tstartTime = parseInt(date.start[\"numeric\"], 10);\n\t\t\t\tnewItem.start_date = {};\n\t\t\t\tif(geoTime) {\n\t\t\t\t\tstartYear = -1 * Math.round(Math.abs((startTime + (1970*31556900)) / 31556900));\n\t\t\t\t\tnewItem.start_date.year = startYear;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\tt.setSeconds(startTime);\n\t\t\t\t\tformattedStart = Sugar.Date.create(t, {fromUTC: true});\n\t\t\t\t\tnewItem.start_date.display_date = date.start[\"text\"];\n\t\t\t\t\tnewItem.start_date.year = formattedStart.getFullYear();\n\t\t\t\t\tnewItem.start_date.month = formattedStart.getMonth() + 1;\n\t\t\t\t\tnewItem.start_date.day = formattedStart.getDay() + 1;\n\n\t\t\t\t}\n\t\t\t\tif(date.end[\"numeric\"] && date.end[\"numeric\"].toString().length>0) {\n\t\t\t\t\tnewItem.end_date = {};\n\t\t\t\t\tendTime = parseInt(date.end[\"numeric\"], 10);\n\n\t\t\t\t\tif(geoTime) {\n\t\t\t\t\t\tendYear = -1 * Math.round(Math.abs((endTime+ (1970*31556900)) / 31556900));\n\t\t\t\t\t\tnewItem.end_date.year = endYear;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\t\tt.setSeconds(endTime);\n\t\t\t\t\t\tformattedEnd = Sugar.Date.create(t, {fromUTC: true});\n\t\t\t\t\t\tnewItem.end_date.display_date = date.end[\"text\"];\n\t\t\t\t\t\tnewItem.end_date.year = formattedEnd.getFullYear();\n\t\t\t\t\t\tnewItem.end_date.month = formattedEnd.getMonth() + 1;\n\t\t\t\t\t\tnewItem.end_date.day = formattedEnd.getDay() + 1;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvar html    = TimelineTemplate(match);\n\n\t\t\t\tnewItem.text = {};\n\t\t\t\tnewElement = $(\"<a/>\", {\"href\": basePath + \"asset/viewAsset/\" + match.objectId, \"text\": match.title});\n\t\t\t\tnewItem.text.headline = newElement.prop(\"outerHTML\");\n\t\t\t\tnewItem.text.text = html;\n\n\t\t\t\tif(match.hasOwnProperty(\"primaryHandlerThumbnail2x\")) {\n\t\t\t\t\tnewItem.media = {};\n\t\t\t\t\tnewItem.media.thumb = match.primaryHandlerThumbnail2x;\n\t\t\t\t\tnewItem.media.url = match.primaryHandlerThumbnail2x;\t\n\t\t\t\t}\n\n\t\t\t\t// dedupe our array\n\t\t\t\tvar ignoreItem = false;\n\t\t\t\tfor(var existingDate of compiledDate.events) {\n\t\t\t\t\tif(JSON.stringify(existingDate) == JSON.stringify(newItem)) {\n\t\t\t\t\t\tignoreItem = true;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(!ignoreItem) {\n\t\t\t\t\tcompiledDate.events.push(newItem);\t\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t}\n\t\t}\n\n\n\n\t}\n\n\tif(geoTime) {\n\t\tcompiledDate.scale = \"cosmological\"\n\t\tinjectStyles(\".tl-timeaxis-minor { display: none; }\");\n\t}\n\telse {\n\t\t$(\"#hackyGeoStyle\").remove();\n\t}\n\n\ttimeline = new TL.Timeline('timelinePane', compiledDate, {\n        timenav_position: \"bottom\",\n        timenav_height_percentage: \"70\"\n\t});\n\n\n}\n\nfunction injectStyles(rule) {\n  var div = $(\"<div />\", {\n    id: \"hackyGeoStyle\",\n    html: '&shy;<style>' + rule + '</style>'\n  }).appendTo(\"body\");    \n}\n\n\n\n"]}