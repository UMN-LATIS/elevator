{"version":3,"sources":["mapWidget.js"],"names":["map","markers","loadMap","targetElement","hostElementName","getHostIdForElement","clearMarkers","off","remove","layer1","L","esri","basemapLayer","detectRetina","maxNativeZoom","maxZoom","layer2","layer3","layers","setView","control","Topo","Satellite","Satellite Labels","addTo","locate","icon","$","find","attr","on","e","name","trigger","prop","clearLayers","createMarker","latitude","longitude","latitudeElement","longitudeElement","zoomToElement","layerGroup","newMarker","Marker","draggable","addLayer","val","target","getLatLng","lat","lng","centerLeafletMapOnMarker","marker","latLngs","markerBounds","latLngBounds","fitBounds","document","mapElement","this","closest","address","first","options","position","google","maps","Geocoder","geocode","results","status","GeocoderStatus","OK","geometry","location","length","parent","html","revealMap","element","parentElement","getLayers","latlng"],"mappings":"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","file":"mapWidget.min.js","sourcesContent":["\nvar map = {};\nvar markers = {};\n\nfunction loadMap(targetElement) {\n\tvar hostElementName = getHostIdForElement(targetElement);\n\tif(map[hostElementName]) {\n\t\tclearMarkers(hostElementName);\n\t\tmap[hostElementName].off();\n\t\tmap[hostElementName].remove();\n\t}\n\tvar layer1= L.esri.basemapLayer(\"Topographic\", {\n\t\t\"detectRetina\": true,\n\t\tmaxNativeZoom:18,\n\t\tmaxZoom:21\n\t});\n\tvar layer2= L.esri.basemapLayer(\"Imagery\", \n\t\t{\"detectRetina\": true,\n\t\tmaxNativeZoom:18,\n\t\tmaxZoom:20\n\t}\n\t);\n\n\tvar layer3 = L.esri.basemapLayer('ImageryLabels');\n\n\n\tmap[hostElementName] = L.map(targetElement, {\n\t\tlayers: [layer1],\n\t}).setView([40, -94], 5);\n\n\tL.control.layers({\"Topo\": layer1, \"Satellite\": layer2}, {\"Satellite Labels\": layer3}).addTo(map[hostElementName]);\n\n\tif (L.control.locate) {\n\t\tL.control.locate({\n\t\t\ticon: 'glyphicon glyphicon-map-marker'\n\t\t}).addTo(map[hostElementName]);\n\n\t}\n\t\n\t// parsley freaks out and breaks the page if checkboxes don't have namesm but leaflet doesn't assign one for the toggles\n\t$(\".leaflet-control-layers-overlays\").find(\".leaflet-control-layers-selector\").attr(\"name\",\"satelliteToggle\");\n\t\n\tmap[hostElementName].on('baselayerchange', function(e) {\n\t  if(e.name == \"Satellite\") {\n\t    $(\".leaflet-control-layers-overlays\").find(\".leaflet-control-layers-selector\").trigger(\"click\");\n\t  }\n\t  else {\n\n\t    if($(\".leaflet-control-layers-overlays\").find(\".leaflet-control-layers-selector\").prop(\"checked\") == true) {\n\n\t      $(\".leaflet-control-layers-overlays\").find(\".leaflet-control-layers-selector\").trigger(\"click\"); \n\t    }\n\t   \n\t  }\n\t});\n\n}\n\n\n\n\n$(document).on(\"click\",\".clearMarker\", function() {\n\tvar mapElement = $(this).closest(\".mapContainer\").find(\".mapWidget\");\n\tvar hostElementName = getHostIdForElement(mapElement);\n\tclearMarkers(hostElementName);\n});\n\nfunction clearMarkers(hostElementName) {\n\tif(markers[hostElementName]) {\n\t\tmarkers[hostElementName].clearLayers();\n\t}\n}\n\nfunction createMarker(hostElementName, latitude, longitude, latitudeElement, longitudeElement, zoomToElement) {\n\tif(!markers[hostElementName]) {\n\t\tmarkers[hostElementName] = new L.layerGroup();\n\t}\n\tvar newMarker = new L.Marker([latitude, longitude], {draggable: true});\n\tmarkers[hostElementName].addLayer(newMarker);\n\n\tmap[hostElementName].addLayer(markers[hostElementName]);\n\tnewMarker.on('dragend', function (e) {\n\t\tlatitudeElement.val(e.target.getLatLng().lat);\n\t\tlongitudeElement.val(e.target.getLatLng().lng);\n\t});\n\n\tif(zoomToElement) {\n\t\tcenterLeafletMapOnMarker(hostElementName,newMarker);\n\t}\n\treturn newMarker;\n}\n\n\nfunction centerLeafletMapOnMarker(hostElementName, marker) {\n\tvar latLngs = [ marker.getLatLng() ];\n\tvar markerBounds = L.latLngBounds(latLngs);\n\n\tmap[hostElementName].fitBounds(markerBounds, {maxZoom: 15});\n}\n\n$(document).off(\"click\", \".searchMap\");\n$(document).on(\"click\",\".searchMap\", function() {\n\n\tvar address = $(this).closest(\".mapContainer\").find(\".address\").first().val();\n\tvar mapElement = $(this).closest(\".mapContainer\").find(\".mapWidget\");\n\tvar latitudeElement = $(this).closest(\".mapContainer\").find('.latitude');\n\tvar longitudeElement = $(this).closest(\".mapContainer\").find('.longitude');\n\tvar hostElementName = getHostIdForElement(mapElement);\n\n\tclearMarkers(hostElementName);\n\n\tvar options = {\n\t\tposition: null\n\t};\n\t// TODO: check query limit\n\tvar geocoder = new google.maps.Geocoder();\n\n\tgeocoder.geocode({'address': address}, function(results, status) {\n\t\tif (status == google.maps.GeocoderStatus.OK) {\n\t\t\toptions.position  = results[0].geometry.location;\n\t\t\toptions.geocode   = true;\n\n\t\t\tvar latitude = results[0].geometry.location.lat();\n\t\t\tvar longitude = results[0].geometry.location.lng();\n\n\t\t\tmarker = createMarker(hostElementName, latitude, longitude, latitudeElement, longitudeElement, true);\n\t\t\tlatitudeElement.val(latitude);\n\t\t\tlongitudeElement.val(longitude);\n\t\t\t$(latitudeElement).trigger(\"change\"); // fire change event so sidebar updates\n\t\t\t$(longitudeElement).trigger(\"change\"); // fire change event so sidebar updates\n\n\t\t}\n\t});\n\n\n});\n\n\n$(document).on(\"change\",\".geoField\", function() {\n\t\n\t\n\n\tvar latitudeElement = $(this).closest(\".mapContainer\").find('.latitude');\n\tvar longitudeElement = $(this).closest(\".mapContainer\").find('.longitude');\n\tvar mapElement = $(this).closest(\".mapContainer\").find('.mapWidget');\n\tvar hostElementName = getHostIdForElement(mapElement);\n\tclearMarkers(hostElementName);\n\tif(latitudeElement.val().length===0 || longitudeElement.val().length===0) {\n\t\treturn;\n\t}\n\n\tcreateMarker(hostElementName, latitudeElement.val(), longitudeElement.val(),latitudeElement, longitudeElement, false);\n\n});\n\n$(document).on(\"hidden.bs.collapse\", \".maphost\", function(){\n\tvar mapElement = $(this).parent().find(\".mapWidget\");\n\tvar hostElementName = getHostIdForElement(mapElement);\n\tclearMarkers(hostElementName);\n\tmap[hostElementName].off();\n\tmap[hostElementName].remove();\n\n\tvar mapButton = $(this).parent().find(\".mapToggle\");\n\tmapButton.html(\"Reveal Map\");\n\n});\n\n$(document).on(\"shown.bs.collapse\", \".maphost\", function (){\n\tvar mapButton = $(this).parent().find(\".mapToggle\");\n\tmapButton.html(\"Hide Map\");\n\tvar mapElement = $(this).find(\".mapWidget\");\n\tvar latitudeElement = $(this).parent().find('.latitude');\n\tvar longitudeElement = $(this).parent().find('.longitude');\n\trevealMap(mapElement[0], latitudeElement, longitudeElement);\n\n});\n\nvar getHostIdForElement = function(element) {\n\tif(typeof element == \"object\") {\n\t\treturn $(element).closest(\".maphost\").attr(\"id\");\n\t}\n\telse {\n\t}\n\treturn element;\n\t\n}\n\nvar revealMap = function(parentElement, latitudeElement, longitudeElement) {\n\t\n\tloadMap(parentElement);\n\n\tvar hostElementName = getHostIdForElement(parentElement);\n\n\tmap[hostElementName].on('click', function(e){\n\t\tif(markers[hostElementName].getLayers().length > 0) {\n\t\t\treturn;\n\t\t}\n\t\tcreateMarker(hostElementName, e.latlng.lat, e.latlng.lng, latitudeElement, longitudeElement, false);\n\t\tlatitudeElement.val(e.latlng.lat);\n\t\tlongitudeElement.val(e.latlng.lng);\n\n\t});\n\n\tvar longitude = longitudeElement.val();\n\tvar latitude = latitudeElement.val();\n\n\tif(!markers[hostElementName]) {\n\t\tmarkers[hostElementName] = new L.layerGroup();\n\t}\n\n\tif(longitude!==\"\") {\n\t\tcreateMarker(hostElementName, latitude, longitude, latitudeElement, longitudeElement,true);\n\t}\n\telse {\n\t\tmap[hostElementName].setView([46, -94], 6);\n\t}\n\n\n\n}\n"]}