{"version":3,"file":"mapWidget.min.js","sources":["mapWidget.js"],"sourcesContent":["\nvar map = {};\nvar markers = {};\n\nfunction loadMap(targetElement) {\n\tvar hostElementName = getHostIdForElement(targetElement);\n\tif(map[hostElementName]) {\n\t\tclearMarkers(hostElementName);\n\t\tmap[hostElementName].off();\n\t\tmap[hostElementName].remove();\n\t}\n\tvar layer1= L.esri.basemapLayer(\"Topographic\", {\n\t\t\"detectRetina\": true,\n\t\tmaxNativeZoom:18,\n\t\tmaxZoom:21\n\t});\n\tvar layer2= L.esri.basemapLayer(\"Imagery\", \n\t\t{\"detectRetina\": true,\n\t\tmaxNativeZoom:18,\n\t\tmaxZoom:20\n\t}\n\t);\n\n\tvar layer3 = L.esri.basemapLayer('ImageryLabels');\n\n\n\tmap[hostElementName] = L.map(targetElement, {\n\t\tlayers: [layer1],\n\t}).setView([40, -94], 5);\n\n\tL.control.layers({\"Topo\": layer1, \"Satellite\": layer2}, {\"Satellite Labels\": layer3}).addTo(map[hostElementName]);\n\n\tif (L.control.locate) {\n\t\tL.control.locate({\n\t\t\ticon: 'glyphicon glyphicon-map-marker'\n\t\t}).addTo(map[hostElementName]);\n\n\t}\n\t\n\t// parsley freaks out and breaks the page if checkboxes don't have namesm but leaflet doesn't assign one for the toggles\n\t$(\".leaflet-control-layers-overlays\").find(\".leaflet-control-layers-selector\").attr(\"name\",\"satelliteToggle\");\n\t\n\tmap[hostElementName].on('baselayerchange', function(e) {\n\t  if(e.name == \"Satellite\") {\n\t    $(\".leaflet-control-layers-overlays\").find(\".leaflet-control-layers-selector\").trigger(\"click\");\n\t  }\n\t  else {\n\n\t    if($(\".leaflet-control-layers-overlays\").find(\".leaflet-control-layers-selector\").prop(\"checked\") == true) {\n\n\t      $(\".leaflet-control-layers-overlays\").find(\".leaflet-control-layers-selector\").trigger(\"click\"); \n\t    }\n\t   \n\t  }\n\t});\n\n}\n\n\n\n\n$(document).on(\"click\",\".clearMarker\", function() {\n\tvar mapElement = $(this).closest(\".mapContainer\").find(\".mapWidget\");\n\tvar hostElementName = getHostIdForElement(mapElement);\n\tclearMarkers(hostElementName);\n});\n\nfunction clearMarkers(hostElementName) {\n\tif(markers[hostElementName]) {\n\t\tmarkers[hostElementName].clearLayers();\n\t}\n}\n\nfunction createMarker(hostElementName, latitude, longitude, latitudeElement, longitudeElement, zoomToElement) {\n\tif(!markers[hostElementName]) {\n\t\tmarkers[hostElementName] = new L.layerGroup();\n\t}\n\tvar newMarker = new L.Marker([latitude, longitude], {draggable: true});\n\tmarkers[hostElementName].addLayer(newMarker);\n\n\tmap[hostElementName].addLayer(markers[hostElementName]);\n\tnewMarker.on('dragend', function (e) {\n\t\tlatitudeElement.val(e.target.getLatLng().lat);\n\t\tlongitudeElement.val(e.target.getLatLng().lng);\n\t});\n\n\tif(zoomToElement) {\n\t\tcenterLeafletMapOnMarker(hostElementName,newMarker);\n\t}\n\treturn newMarker;\n}\n\n\nfunction centerLeafletMapOnMarker(hostElementName, marker) {\n\tvar latLngs = [ marker.getLatLng() ];\n\tvar markerBounds = L.latLngBounds(latLngs);\n\n\tmap[hostElementName].fitBounds(markerBounds, {maxZoom: 15});\n}\n\n$(document).off(\"click\", \".searchMap\");\n$(document).on(\"click\",\".searchMap\", function() {\n\n\tvar address = $(this).closest(\".mapContainer\").find(\".address\").first().val();\n\tvar mapElement = $(this).closest(\".mapContainer\").find(\".mapWidget\");\n\tvar latitudeElement = $(this).closest(\".mapContainer\").find('.latitude');\n\tvar longitudeElement = $(this).closest(\".mapContainer\").find('.longitude');\n\tvar hostElementName = getHostIdForElement(mapElement);\n\n\tclearMarkers(hostElementName);\n\n\tvar options = {\n\t\tposition: null\n\t};\n\t// TODO: check query limit\n\tvar geocoder = new google.maps.Geocoder();\n\n\tgeocoder.geocode({'address': address}, function(results, status) {\n\t\tif (status == google.maps.GeocoderStatus.OK) {\n\t\t\toptions.position  = results[0].geometry.location;\n\t\t\toptions.geocode   = true;\n\n\t\t\tvar latitude = results[0].geometry.location.lat();\n\t\t\tvar longitude = results[0].geometry.location.lng();\n\n\t\t\tmarker = createMarker(hostElementName, latitude, longitude, latitudeElement, longitudeElement, true);\n\t\t\tlatitudeElement.val(latitude);\n\t\t\tlongitudeElement.val(longitude);\n\t\t\t$(latitudeElement).trigger(\"change\"); // fire change event so sidebar updates\n\t\t\t$(longitudeElement).trigger(\"change\"); // fire change event so sidebar updates\n\n\t\t}\n\t});\n\n\n});\n\n\n$(document).on(\"change\",\".geoField\", function() {\n\t\n\t\n\n\tvar latitudeElement = $(this).closest(\".mapContainer\").find('.latitude');\n\tvar longitudeElement = $(this).closest(\".mapContainer\").find('.longitude');\n\tvar mapElement = $(this).closest(\".mapContainer\").find('.mapWidget');\n\tvar hostElementName = getHostIdForElement(mapElement);\n\tclearMarkers(hostElementName);\n\tif(latitudeElement.val().length===0 || longitudeElement.val().length===0) {\n\t\treturn;\n\t}\n\n\tcreateMarker(hostElementName, latitudeElement.val(), longitudeElement.val(),latitudeElement, longitudeElement, false);\n\n});\n\n$(document).on(\"hidden.bs.collapse\", \".maphost\", function(){\n\tvar mapElement = $(this).parent().find(\".mapWidget\");\n\tvar hostElementName = getHostIdForElement(mapElement);\n\tclearMarkers(hostElementName);\n\tmap[hostElementName].off();\n\tmap[hostElementName].remove();\n\n\tvar mapButton = $(this).parent().find(\".mapToggle\");\n\tmapButton.html(\"Reveal Map\");\n\n});\n\n$(document).on(\"shown.bs.collapse\", \".maphost\", function (){\n\tvar mapButton = $(this).parent().find(\".mapToggle\");\n\tmapButton.html(\"Hide Map\");\n\tvar mapElement = $(this).find(\".mapWidget\");\n\tvar latitudeElement = $(this).parent().find('.latitude');\n\tvar longitudeElement = $(this).parent().find('.longitude');\n\trevealMap(mapElement[0], latitudeElement, longitudeElement);\n\n});\n\nvar getHostIdForElement = function(element) {\n\tif(typeof element == \"object\") {\n\t\treturn $(element).closest(\".maphost\").attr(\"id\");\n\t}\n\telse {\n\t}\n\treturn element;\n\t\n}\n\nvar revealMap = function(parentElement, latitudeElement, longitudeElement) {\n\t\n\tloadMap(parentElement);\n\n\tvar hostElementName = getHostIdForElement(parentElement);\n\n\tmap[hostElementName].on('click', function(e){\n\t\tif(markers[hostElementName].getLayers().length > 0) {\n\t\t\treturn;\n\t\t}\n\t\tcreateMarker(hostElementName, e.latlng.lat, e.latlng.lng, latitudeElement, longitudeElement, false);\n\t\tlatitudeElement.val(e.latlng.lat);\n\t\tlongitudeElement.val(e.latlng.lng);\n\n\t});\n\n\tvar longitude = longitudeElement.val();\n\tvar latitude = latitudeElement.val();\n\n\tif(!markers[hostElementName]) {\n\t\tmarkers[hostElementName] = new L.layerGroup();\n\t}\n\n\tif(longitude!==\"\") {\n\t\tcreateMarker(hostElementName, latitude, longitude, latitudeElement, longitudeElement,true);\n\t}\n\telse {\n\t\tmap[hostElementName].setView([46, -94], 6);\n\t}\n\n\n\n}\n"],"names":["map","markers","loadMap","targetElement","hostElementName","getHostIdForElement","layer1","clearMarkers","off","remove","L","esri","basemapLayer","detectRetina","maxNativeZoom","maxZoom","layer2","layer3","layers","setView","control","Topo","Satellite","Satellite Labels","addTo","locate","icon","$","find","attr","on","e","name","prop","trigger","clearLayers","createMarker","latitude","longitude","latitudeElement","longitudeElement","zoomToElement","layerGroup","newMarker","Marker","draggable","addLayer","val","target","getLatLng","lat","lng","centerLeafletMapOnMarker","marker","latLngs","markerBounds","latLngBounds","fitBounds","document","mapElement","this","closest","address","first","google","maps","Geocoder","geocode","results","status","GeocoderStatus","OK","geometry","location","length","parent","html","revealMap","element","parentElement","getLayers","latlng"],"mappings":"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"}