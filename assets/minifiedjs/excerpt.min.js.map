{"version":3,"file":"excerpt.min.js","sources":["excerpt.js"],"sourcesContent":["\nvar embeddedStartTimeValue = null;\nvar embeddedEndTimeValue = null;\nvar suppressSeek = false;\nvar suppressCounter = 0;\n$(document).ready(function() {\n\tjwplayer(\"videoElement\").onTime(function (e) {\n\n\t\tif (!embeddedStartTimeValue || !embeddedEndTimeValue) {\n\t\t\treturn;\n\t\t}\n\t\tsuppressCounter++;\n\t\tif (suppressCounter > 10) {\n\t\t\tsuppressCounter = 0;\n\t\t\tsuppressSeek = false;\n\t\t}\n\t\tif (suppressSeek) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.position < (embeddedStartTimeValue - 5)) {\n\t\t\tjwplayer(\"videoElement\").seek(embeddedStartTimeValue);\n\t\t\tsuppressSeek = true;\n\t\t}\n\t\tif (e.position > embeddedEndTimeValue) {\n\t\t\tjwplayer(\"videoElement\").seek(embeddedStartTimeValue);\n\t\t\tsuppressSeek = true;\n\t\t}\n\t});\n});\n\n\nfunction setPlayBounds(startTime, endTime) {\n\tembeddedStartTimeValue = startTime;\n\tembeddedEndTimeValue = endTime;\n}\n\nfunction getTime() {\n\treturn jwplayer(\"videoElement\").getPosition();\n}\n\n/**\n * The excerpt media player is loaded in an iframe, and we'll\n * need to communicate with the parent window to set the play bounds\n * and get the current scrubber position.\n * This sets up some some simple request/response messaging between\n * between the iframe and the parent window.\n */\n(function setupIframeMessaging() {\n\tconst log = (...args) => console.log('[IFRAME] ', ...args);\n\n\tconst requests = {\n\t\tSET_PLAY_BOUNDS: 'SET_PLAY_BOUNDS',\n\t\tGET_SCRUBBER_POSITION: 'GET_SCRUBBER_POSITION',\n\t\tPAUSE_PLAYER: 'PAUSE_PLAYER',\n\t}\n\n\tconst responses = {\n\t\tMEDIAPLAYER_READY: 'MEDIAPLAYER_READY',\n\t\tCURRENT_SCRUBBER_POSITION: 'CURRENT_SCRUBBER_POSITION',\n\t\tSET_PLAY_BOUNDS_SUCCESS: 'SET_PLAY_BOUNDS_SUCCESS',\n\t\tPAUSE_PLAYER_SUCCESS: 'PAUSE_PLAYER_SUCCESS',\n\t}\n\n\tfunction requestHandler(event) {\n\t\t// commenting this out because grunt doesnt like it\n\t\t// log('message received:', event.data?.type ?? 'unknown' , event.data?.payload ?? '');\n\t\tconst { type } = event.data;\n\t\tif (type === requests.SET_PLAY_BOUNDS) {\n\t\t\treturn setPlayBounds(event.data.payload.startTime, event.data.payload.endTime);\n\t\t}\n\t\tif (type === requests.GET_SCRUBBER_POSITION) {\n\t\t\treturn sendScrubberPosition();\n\t\t}\n\t\tif (type === requests.PAUSE_PLAYER) {\n\t\t\treturn pausePlayer();\n\t\t}\n\t}\n\n\tfunction pausePlayer() {\n\t\tconst player = jwplayer(\"videoElement\");\n\t\tif (player.getState() === 'playing') {\n\t\t\tplayer.pause();\n\t\t}\n\t\twindow.parent.postMessage({\n\t\t\ttype: responses.PAUSE_PLAYER_SUCCESS,\n\t\t\tpayload: player.getState(),\n\t\t}, '*');\n\t}\n\n\tfunction sendScrubberPosition() {\n\t\twindow.parent.postMessage({\n\t\t\ttype: responses.CURRENT_SCRUBBER_POSITION,\n\t\t\tpayload: getTime(),\n\t\t}, '*');\n\t}\n\n\tfunction setPlayBounds(startTime, endTime) {\n\t\tembeddedStartTimeValue = startTime;\n\t\tembeddedEndTimeValue = endTime;\n\t\tconst player = jwplayer(\"videoElement\");\n\t\tplayer.once('play', () => player.seek(startTime));\n\n\t\twindow.parent.postMessage({\n\t\t\ttype: responses.SET_PLAY_BOUNDS_SUCCESS,\n\t\t}, '*');\n\t}\n\n\tfunction sendMediaPlayerReady() {\n\t\twindow.parent.postMessage({\n\t\t\ttype: responses.MEDIAPLAYER_READY,\n\t\t}, '*');\n\t}\n\n\t// sends the current scrubber position to the parent window\n\t// if changes are detected\n\tlet previousScrubberPosition = null;\n\tfunction sendScrubberChanges(ms = 1000) {\n\t\tconst currentScubberPosition = getTime();\n\t\tif (currentScubberPosition === previousScrubberPosition) {\n\t\t\treturn setTimeout(sendScrubberChanges, ms);\n\t\t}\n\t\tsendScrubberPosition();\n\t\tpreviousScrubberPosition = currentScubberPosition;\n\t\treturn setTimeout(sendScrubberChanges, ms);\n\t}\n\n\t$(function () {\n\t\t// once the document is ready, setup the iframe messaging\n\t\twindow.addEventListener('message', requestHandler);\n\t\t\n\t\t// send any current scrubber position to parent window\n\t\tsendScrubberChanges();\n\n\t\t// let parent window knows the media player is ready\n\t\tsendMediaPlayerReady();\n\t});\n})();\n"],"names":["embeddedStartTimeValue","embeddedEndTimeValue","suppressSeek","suppressCounter","setPlayBounds","startTime","endTime","getTime","jwplayer","getPosition","$","document","ready","onTime","e","position","seek","requests","SET_PLAY_BOUNDS","GET_SCRUBBER_POSITION","PAUSE_PLAYER","responses","MEDIAPLAYER_READY","CURRENT_SCRUBBER_POSITION","SET_PLAY_BOUNDS_SUCCESS","PAUSE_PLAYER_SUCCESS","requestHandler","event","type","data","payload","player","once","window","parent","postMessage","sendScrubberPosition","getState","pause","let","previousScrubberPosition","sendScrubberChanges","ms","currentScubberPosition","setTimeout","addEventListener"],"mappings":"AACA,IAAIA,uBAAyB,KACzBC,qBAAuB,KACvBC,aAAe,CAAA,EACfC,gBAAkB,EA4BtB,SAASC,cAAcC,EAAWC,GACjCN,uBAAyBK,EACzBJ,qBAAuBK,CACxB,CAEA,SAASC,UACR,OAAOC,SAAS,cAAc,EAAEC,YAAY,CAC7C,CAlCAC,EAAEC,QAAQ,EAAEC,MAAM,WACjBJ,SAAS,cAAc,EAAEK,OAAO,SAAUC,GAEpCd,wBAA2BC,uBAIV,GADtBE,EAAAA,kBAECA,gBAAkB,EAClBD,aAAe,CAAA,GAEZA,eAIAY,EAAEC,SAAYf,uBAAyB,IAC1CQ,SAAS,cAAc,EAAEQ,KAAKhB,sBAAsB,EACpDE,aAAe,CAAA,GAECD,qBAAba,EAAEC,WACLP,SAAS,cAAc,EAAEQ,KAAKhB,sBAAsB,EACpDE,aAAe,CAAA,IAEjB,CAAC,CACF,CAAC,GAmBD,KAGC,IAAMe,EAAW,CAChBC,gBAAiB,kBACjBC,sBAAuB,wBACvBC,aAAc,cACf,EAEMC,EAAY,CACjBC,kBAAmB,oBACnBC,0BAA2B,4BAC3BC,wBAAyB,0BACzBC,qBAAsB,sBACvB,EAEA,SAASC,EAAeC,GAGvB,IAAQC,EAASD,EAAME,KAAV,KACb,GAAID,IAASX,EAASC,gBACdd,CAAAA,IA4BcC,EA5BAsB,EAAME,KAAKC,QAAQzB,UAAjCD,IA4ByBE,EA5BmBqB,EAAME,KAAKC,QAAQxB,QA6BvEN,uBAAyBK,EACzBJ,qBAAuBK,EACvB,IAAMyB,EAASvB,SAAS,cAAc,EACtCuB,EAAOC,KAAK,OAAQ,IAAMD,EAAOf,KAAKX,CAAS,CAAC,EAEhD4B,OAAOC,OAAOC,YAAY,CACzBP,KAAMP,EAAUG,uBACjB,EAAG,GAAG,CApCwE,KAD9E,CAGA,GAAII,IAASX,EAASE,sBACrB,OAAOiB,EAAqB,EAEzBR,IAASX,EAASG,eAOI,aADpBW,EAASvB,SAAS,cAAc,GAC3B6B,SAAS,GACnBN,EAAOO,MAAM,EAEdL,OAAOC,OAAOC,YAAY,CACzBP,KAAMP,EAAUI,qBAChBK,QAASC,EAAOM,SAAS,CAC1B,EAAG,GAAG,EAjBN,CAOD,CAaA,SAASD,IACRH,OAAOC,OAAOC,YAAY,CACzBP,KAAMP,EAAUE,0BAChBO,QAASvB,QAAQ,CAClB,EAAG,GAAG,CACP,CAqBAgC,IAAIC,EAA2B,KAC/B,SAASC,EAAoBC,EAAK,KACjC,IAAMC,EAAyBpC,QAAQ,EAMvC,OALIoC,IAA2BH,IAG/BJ,EAAqB,EACrBI,EAA2BG,GACpBC,WAAWH,EAAqBC,CAAE,CAC1C,CAEAhC,EAAE,WAEDuB,OAAOY,iBAAiB,UAAWnB,CAAc,EAGjDe,EAAoB,EAvBpBR,OAAOC,OAAOC,YAAY,CACzBP,KAAMP,EAAUC,iBACjB,EAAG,GAAG,CAyBP,CAAC,CACD,GAAE"}