!function(e){"use strict";e.Crocodoc=function(e){return"object"!=typeof exports?e(jQuery):void(module.exports=e)}(function(t){function n(){e.loadSVG=function(t){var n=new e.DOMParser,a=n.parseFromString(t,"image/svg+xml"),o=document.importNode(a.documentElement,!0);o.setAttribute("width","100%"),o.setAttribute("height","100%"),document.body?document.body.appendChild(o):document.documentElement.appendChild(o)}}var a="crocodoc-",o="data-svg-version",i=a+"viewer",r=a+"doc",s=a+"viewport",l=a+"viewer-logo",u=a+"draggable",c=a+"dragging",d=a+"text-selected",g=a+"text-disabled",f=a+"links-disabled",h=a+"mobile",p=a+"ielt9",m=a+"supports-svg",v=a+"window-as-viewport",y=a+"layout-",b=a+"current-page",P=a+"preceding-page",T=a+"page",w=T+"-inner",x=T+"-content",S=T+"-svg",C=T+"-text",L=T+"-link",O=T+"-links",R=T+"-autoscale",E=T+"-loading",Z=T+"-error",U=T+"-visible",R=T+"-autoscale",z=T+"-prev",M=T+"-next",A=T+"-before",_=T+"-after",H=T+"-before-buffer",I=T+"-after-buffer",k=[M,_,z,A,H,I].join(" "),V='<div tabindex="-1" class="'+s+'"><div class="'+r+'"></div></div><div class="'+l+'"></div>',D='<div class="'+T+" "+E+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+w+'"><div class="'+x+'"><div class="'+S+'"></div><div class="'+R+'"><div class="'+C+'"></div><div class="'+O+'"></div></div></div></div></div>',W=1024,N="fitwidth",F="fitheight",$="auto",q="in",X="out",j="previous",G="next",B="vertical",Q="vertical-single-column",J="horizontal",Y="presentation",K="presentation-two-page",ee="text",te="converting",ne="not loaded",ae="loading",oe="loaded",ie="error",re="padding-",se=re+"top",le=re+"right",ue=re+"left",ce=re+"bottom",de=.95,ge=.99,fe=100,he=32,pe=8,me=1e3,ve="image/svg+xml",ye="<style>html,body{width:100%;height:100%;margin:0;overflow:hidden;}</style>",be='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+n+")()]]></script></svg>",Pe=1,Te=2,we=3,xe=4,Se=5,Ce=6,Le=7,Oe=8;if("undefined"==typeof t)throw new Error("jQuery is required");var Re=function(){function e(n,a,o){var i;for(o=o||n,i=0;i<a.length;++i){if(n===a[i])throw new Error("Circular dependency detected: "+o+"->"+a[i]);t[a[i]]&&e(n,t[a[i]].mixins,o+"->"+a[i])}}var t={},n={};return{ZOOM_FIT_WIDTH:N,ZOOM_FIT_HEIGHT:F,ZOOM_AUTO:$,ZOOM_IN:q,ZOOM_OUT:X,SCROLL_PREVIOUS:j,SCROLL_NEXT:G,LAYOUT_VERTICAL:B,LAYOUT_VERTICAL_SINGLE_COLUMN:Q,LAYOUT_HORIZONTAL:J,LAYOUT_PRESENTATION:Y,LAYOUT_PRESENTATION_TWO_PAGE:K,LAYOUT_TEXT:ee,ASSET_REQUEST_RETRIES:1,viewerTemplate:V,pageTemplate:D,components:t,utilities:n,createViewer:function(e,t){return new Re.Viewer(e,t)},getViewer:function(e){return Re.Viewer.get(e)},addComponent:function(n,a,o){a instanceof Function&&(o=a,a=[]),e(n,a),t[n]={mixins:a,creator:o}},createComponent:function(e,n){var a=t[e];if(a){for(var o=[],i=0;i<a.mixins.length;++i)o.push(this.createComponent(a.mixins[i],n));return o.unshift(n),a.creator.apply(a.creator,o)}return null},addPlugin:function(e,t){this.addComponent("plugin-"+e,t)},addDataProvider:function(e,t){this.addComponent("data-provider-"+e,t)},addUtility:function(e,t){n[e]={creator:t,instance:null}},getUtility:function(e){var t=n[e];return t?(t.instance||(t.instance=t.creator(this)),t.instance):null}}}();return function(){Re.Scope=function(e){function n(e,t){var n,a,o,s;for(n=0,a=r.length;a>n;++n)o=r[n],o&&(s=o.messages||[],-1!==i.inArray(e,s)&&i.isFn(o.onmessage)&&o.onmessage.call(o,e,t))}function a(){for(var e;s.length;)e=s.shift(),n(e.name,e.data);s=null}function o(e){i.isFn(e.destroy)&&!e._destroyed&&(e.destroy(),e._destroyed=!0)}var i=Re.getUtility("common"),r=[],s=[],l={},u=!1;e.dataProviders=e.dataProviders||{},this.createComponent=function(e){var t=Re.createComponent(e,this);return t&&(t.componentName=e,r.push(t)),t},this.destroyComponent=function(e){var t,n;for(t=0,n=r.length;n>t;++t)if(e===r[t]){o(e),r.splice(t,1);break}},this.destroy=function(){var e,t,n,a=r.slice();for(e=0,t=a.length;t>e;++e)n=a[e],o(n);r=[],l={}},this.broadcast=function(e,t){u?n(e,t):s.push({name:e,data:t})},this.getUtility=function(e){return Re.getUtility(e)},this.getConfig=function(){return e},this.ready=function(){u||(u=!0,a())},this.get=function(n,a){var o=e.dataProviders[n]||n,i=this.getDataProvider(o);return i?i.get(n,a):t.Deferred().reject("data-provider not found").promise()},this.getDataProvider=function(e){var t;return l[e]?t=l[e]:(t=this.createComponent("data-provider-"+e),l[e]=t),t}}}(),function(){function e(e,t){var n=!1;return{type:e,data:t,preventDefault:function(){n=!0},isDefaultPrevented:function(){return n}}}Re.EventTarget=function(){this._handlers={}},Re.EventTarget.prototype={constructor:Re.EventTarget,on:function(e,t){"undefined"==typeof this._handlers[e]&&(this._handlers[e]=[]),this._handlers[e].push(t)},fire:function(t,n){var a,o,i,r=e(t,n);if(a=this._handlers[r.type],a instanceof Array)for(a=a.concat(),o=0,i=a.length;i>o;o++)a[o]&&a[o].call(this,r);if(a=this._handlers.all,a instanceof Array)for(a=a.concat(),o=0,i=a.length;i>o;o++)a[o]&&a[o].call(this,r);return r},off:function(e,t){var n,a,o=this._handlers[e];if(o instanceof Array){if(!t)return void(o.length=0);for(n=0,a=o.length;a>n;n++)if(o[n]===t||o[n].handler===t){o.splice(n,1);break}}},one:function(e,t){var n=this,a=function(o){n.off(e,a),t.call(n,o)};a.handler=t,this.on(e,a)}}}(),function(){var e=0,n={};Re.Viewer=function(a,o){function i(){d.init()}Re.EventTarget.call(this);var r,s=Re.getUtility("common"),l=t(a),u=s.extend(!0,{},Re.Viewer.defaults,o),c=new Re.Scope(u),d=c.createComponent("viewer-base");if(0===l.length)throw new Error("Invalid container element");this.id=u.id=++e,u.api=this,u.$el=l,n[this.id]=this,this.destroy=function(){delete n[u.id],c.broadcast("destroy"),c.destroy()},this.load=function(){d.loadAssets()},this.setLayout=function(e){r=null,r=d.setLayout(e)},this.zoom=function(e){var t=parseFloat(e);r&&(t&&(e=t/(u.pageScale||1)),r.setZoom(e))},this.scrollTo=function(e){r&&s.isFn(r.scrollTo)&&r.scrollTo(e)},this.scrollBy=function(e,t){r&&r.scrollBy(e,t)},this.focus=function(){r&&r.focus()},this.enableTextSelection=function(){l.toggleClass(g,!1),u.enableTextSelection||(u.enableTextSelection=!0,c.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){l.toggleClass(g,!0),u.enableTextSelection&&(u.enableTextSelection=!1,c.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){u.enableLinks||(l.removeClass(f),u.enableLinks=!0)},this.disableLinks=function(){u.enableLinks&&(l.addClass(f),u.enableLinks=!1)},this.updateLayout=function(){r&&r.update()},i()},Re.Viewer.prototype=new Re.EventTarget,Re.Viewer.prototype.constructor=Re.Viewer,Re.Viewer.get=function(e){return n[e]},Re.Viewer.defaults={url:null,layout:B,zoom:$,page:1,enableTextSelection:!0,enableLinks:!0,enableDragging:!1,queryParams:null,plugins:{},useWindowAsViewport:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},dataProviders:{metadata:"metadata",stylesheet:"stylesheet","page-svg":"page-svg","page-text":"page-text","page-img":"page-img"},pageStart:null,pageEnd:null,autoloadFirstPage:!0,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),Re.addDataProvider("metadata",function(e){function t(e){return a.parseJSON(e)}var n=e.getUtility("ajax"),a=e.getUtility("common"),o=e.getConfig();return{get:function(){var e=this.getURL(),a=n.fetch(e,Re.ASSET_REQUEST_RETRIES);return a.then(t).promise({abort:a.abort})},getURL:function(){var e=o.template.json;return o.url+e+o.queryString}}}),Re.addDataProvider("page-img",function(e){var n=e.getUtility("common"),a=e.getConfig();return{get:function(e,n){function a(){i.setAttribute("src",l)}function o(){i.removeAttribute("src")}var i=this.getImage(),r=Re.ASSET_REQUEST_RETRIES,s=!1,l=this.getURL(n),u=t.Deferred();return i.onload=function(){s=!0,u.resolve(i)},i.onerror=function(){r>0?(r--,o(),a()):(i=null,s=!1,u.reject({error:"image failed to load",resource:l}))},a(),u.promise({abort:function(){s||(o(),u.reject())}})},getURL:function(e){var t=n.template(a.template.img,{page:e});return a.url+t+a.queryString},getImage:function(){return new Image}}}),Re.addDataProvider("page-svg",function(e){function t(e,t){var n="<style>"+t+"</style>";return r.firefox&&!s.isSubpxSupported()&&(n+="<style>text { text-rendering: geometricPrecision; }</style>"),e=e.replace(d,n)}function n(n){if(!u){var i,r=l.queryString.replace("&","&#38;");return i=o.countInStr(n,'xlink:href="data:image'),i>a&&(n=n.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),n=n.replace(/href="([^"#:]*)"/g,function(e,t){return'href="'+l.url+t+r+'"'}),e.get("stylesheet").then(function(e){return t(n,e)})}}var a=1e3,o=e.getUtility("common"),i=e.getUtility("ajax"),r=e.getUtility("browser"),s=e.getUtility("subpx"),l=e.getConfig(),u=!1,c={},d=/<xhtml:link[^>]*>(\s*<\/xhtml:link>)?/i;return{get:function(e,t){var a,o=this.getURL(t);return c[t]?c[t]:(a=i.fetch(o,Re.ASSET_REQUEST_RETRIES),c[t]=a.then(n).promise({abort:function(){a.abort(),c&&delete c[t]}}),c[t])},getURL:function(e){var t=o.template(l.template.svg,{page:e});return l.url+t+l.queryString},destroy:function(){u=!0,o=i=s=r=l=c=null}}}),Re.addDataProvider("page-text",function(e){function t(e){if(!r){var t=a.countInStr(e,"<div");return t>n?"":e=e.replace(/<link rel="stylesheet".*/,"")}}var n=256,a=e.getUtility("common"),o=e.getUtility("ajax"),i=e.getConfig(),r=!1,s={};return{get:function(e,n){var a,i=this.getURL(n);return s[n]?s[n]:(a=o.fetch(i,Re.ASSET_REQUEST_RETRIES),s[n]=a.then(t).promise({abort:function(){a.abort(),s&&delete s[n]}}),s[n])},getURL:function(e){var t=a.template(i.template.html,{page:e});return i.url+t+i.queryString},destroy:function(){r=!0,a=o=i=s=null}}}),Re.addDataProvider("stylesheet",function(e){function t(e){return o.ie&&(e=e.replace(/font-family:[\s\"\']*([\w-]+)\b/g,"$0-"+i.id)),e}var n,a=e.getUtility("ajax"),o=e.getUtility("browser"),i=e.getConfig();return{get:function(){if(n)return n;var e=a.fetch(this.getURL(),Re.ASSET_REQUEST_RETRIES);return n=e.then(t).promise({abort:function(){e.abort(),n=null}})},getURL:function(){var e=i.template.css;return i.url+e+i.queryString},destroy:function(){a=o=i=null,n=null}}}),Re.addUtility("ajax",function(e){function n(e){var t,n,a;try{t=e.status,n=e.statusText,a=e.responseText}catch(o){t=0,n="",a=null}return{status:t,statusText:n,responseText:a,rawRequest:e}}function a(e){return"file:"===d.parse(e).protocol}function o(e){return e>=200&&300>e||304===e}function i(e){return e=u.extend(!0,{},e||{}),e.method=e.method||"GET",e.headers=e.headers||[],e.data=e.data||"","string"!=typeof e.data&&(e.data=t.param(e.data),"GET"!==e.method&&(e.data=e.data,e.headers.push(["Content-Type","application/x-www-form-urlencoded"]))),e}function r(e,t){var n;for(n=0;n<t.length;++n)e.setRequestHeader(t[n][0],t[n][1])}function s(e,t,n,i,s,l){var u=c.getXHR();return u.open(t,e,!0),u.onreadystatechange=function(){var t;if(4===u.readyState){u.onreadystatechange=function(){};try{t=u.status}catch(n){return void l(u)}0===t&&a(e)&&(t=200),o(t)?s(u):l(u)}},r(u,i),u.send(n),u}function l(e,t,n,a,o){var i=c.getXDR();try{i.open(t,e),i.onload=function(){a(i)},i.onerror=function(){o(i)},i.ontimeout=function(){o(i)},i.onprogress=function(){},i.send(n)}catch(r){return o({status:0,statusText:r.message})}return i}var u=e.getUtility("common"),c=e.getUtility("support"),d=e.getUtility("url");return{request:function(e,t){function a(e){return u.isFn(r.success)&&r.success.call(n(e)),e}function o(e){return u.isFn(r.fail)&&r.fail.call(n(e)),e}var r=i(t),g=r.method,f=r.data,h=r.headers;return"GET"===g&&f&&(e=d.appendQueryParams(e,f),f=""),c.isXHRSupported()?d.isCrossDomain(e)&&!c.isCORSSupported()?l(e,g,f,a,o):s(e,g,f,h,a,o):r.fail({status:0,statusText:"AJAX not supported"})},fetch:function(e,n){function a(e){n>0?(n--,i=o()):l.reject(e)}function o(){return s.request(e,{success:function(){r||(this.responseText?l.resolve(this.responseText):a({error:"empty response",status:this.status,resource:e}))},fail:function(){r||a({error:this.statusText,status:this.status,resource:e})}})}var i,r=!1,s=this,l=t.Deferred();return i=o(),l.promise({abort:function(){r=!0,i.abort()}})}}}),Re.addUtility("browser",function(){var e,t=navigator.userAgent,n={},a=/ip(hone|od|ad)/i.test(t),o=/android/i.test(t),i=/blackberry/i.test(t),r=/webos/i.test(t),s=/silk|kindle/i.test(t),l=/MSIE|Trident/i.test(t);return l&&(n.ie=!0,e=/MSIE/i.test(t)?/MSIE\s+(\d+\.\d+)/i.exec(t):/Trident.*rv[ :](\d+\.\d+)/.exec(t),n.version=e&&parseFloat(e[1]),n.ielt9=n.version<9,n.ielt10=n.version<10,n.ielt11=n.version<11),a&&(n.ios=!0,e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n.version=e&&parseFloat(e[1]+"."+e[2])),n.mobile=/mobile/i.test(t)||a||o||i||r||s,n.firefox=/firefox/i.test(t),/safari/i.test(t)&&(n.chrome=/chrome/i.test(t),n.safari=!n.chrome),n.safari&&(e=navigator.appVersion.match(/Version\/(\d+(\.\d+)?)/),n.version=e&&parseFloat(e[1])),n}),Re.addUtility("common",function(){var n=1.33333,a={};return a.extend=t.extend,a.each=t.each,a.map=t.map,a.param=t.param,a.parseJSON=t.parseJSON,a.stringifyJSON="undefined"!=typeof e.JSON?e.JSON.stringify:function(){throw new Error("JSON.stringify not supported")},t.extend(a,{bisectLeft:function(e,t,n){for(var a,o,i=0,r=e.length;r>i;)o=Math.floor((i+r)/2),a=n?e[o][n]:e[o],t>a?i=o+1:r=o;return i},bisectRight:function(e,t,n){for(var a,o,i=0,r=e.length;r>i;)o=Math.floor((i+r)/2),a=n?e[o][n]:e[o],a>t?r=o:i=o+1;return i},clamp:function(e,t,n){return t>e?t:e>n?n:e},sign:function(e){var t=parseInt(e,10);return t?0>t?-1:1:t},isFn:function(e){return"function"==typeof e},inArray:function(e,n){return a.isFn(n.indexOf)?n.indexOf(e):t.inArray(e,n)},constrainRange:function(e,t,n){var o=t-e;return 0>o?{min:-1,max:-1}:(e=a.clamp(e,0,n),t=a.clamp(e+o,0,n),o>t-e&&(e=a.clamp(t-o,0,n)),{min:e,max:t})},now:function(){return(new Date).getTime()},throttle:function(e,t){function n(){l=a.now(),r=null,s=t.apply(o,i)}var o,i,r,s,l=0;return function(){var u=a.now(),c=e-(u-l);return o=this,i=arguments,0>=c?(clearTimeout(r),r=null,l=u,s=t.apply(o,i)):r||(r=setTimeout(n,c)),s}},debounce:function(e,t){function n(){var u=a.now()-s;e>u?r=setTimeout(n,e-u):(r=null,l=t.apply(o,i),o=i=null)}var o,i,r,s,l;return function(){return o=this,i=arguments,s=a.now(),r||(r=setTimeout(n,e)),l}},insertCSS:function(e){var t=document.createElement("style"),n=document.createTextNode(e);try{t.setAttribute("type","text/css"),t.appendChild(n)}catch(a){}return document.getElementsByTagName("head")[0].appendChild(t),t},appendCSSRule:function(e,t,n){var a;return e.insertRule?e.insertRule(t+"{"+n+"}",e.cssRules.length):(a=e.addRule(t,n,e.rules.length),0>a&&(a=e.rules.length-1),a)},deleteCSSRule:function(e,t){e.deleteRule?e.deleteRule(t):e.removeRule(t)},getSelectedNode:function(){var t,n,a;return e.getSelection?(n=e.getSelection(),n.rangeCount&&(a=n.getRangeAt(0),a.collapsed||(t=n.anchorNode.parentNode))):document.selection&&(t=document.selection.createRange().parentElement()),t},getComputedStyle:function(t){return"getComputedStyle"in e?e.getComputedStyle(t):t.currentStyle},calculatePtSize:function(){var e,t,o=1e4,i=document.createElement("div");return i.style.display="block",i.style.position="absolute",i.style.width=o+"pt",document.body.appendChild(i),e=a.getComputedStyle(i),t=e&&e.width?parseFloat(e.width)/o:n,document.body.removeChild(i),t},countInStr:function(e,t){for(var n,a=0;n=e.indexOf(t,n)+1;)a++;return a},template:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e=e.replace(new RegExp("\\{\\{"+n+"\\}\\}","g"),t[n]));return e}})}),Re.addUtility("subpx",function(n){function a(){if(!t.support.leadingWhitespace)return!1;var n=t(r.template(i,{size:12.5})).appendTo(document.documentElement).get(0),a=t(n).css("font-size"),o=t(n).width();t(n).remove(),n=t(r.template(i,{size:12.6})).appendTo(document.documentElement).get(0);var s=t(n).css("font-size"),l=t(n).width();if(t(n).remove(),!("ontouchstart"in e)){if(a===s)return!1;if(o===l)return!1}return!0}var o="crocodoc-subpx-fix",i='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",r=n.getUtility("common"),s=a();return{fix:function(e){if(!s&&void 0!==document.body.style.zoom){var n=t("<div>").addClass(o);t(e).wrap(n)}return e},isSubpxSupported:function(){return s}}}),Re.addUtility("support",function(){function t(e){var t,o,i,r=document.createElement("div");if(e in r.style)return e;if(t=e.charAt(0).toUpperCase()+e.substr(1),e in r.style)return e;for(o=0;o<a.length;++o)if(i=a[o]+t,i in r.style)return 0===i.indexOf("ms")&&(i="-"+i),n(i);return!1}function n(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}var a=["Moz","Webkit","O","ms"],o=null,i=null;return{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:t("transform"),csstransition:t("transition"),csszoom:t("zoom"),isXHRSupported:function(){return null===o&&(o=!!this.getXHR()),o},isCORSSupported:function(){return null===i&&(i=this.isXHRSupported()&&"withCredentials"in this.getXHR()),i},isXDRSupported:function(){return"undefined"!=typeof e.XDomainRequest},getXHR:function(){if(e.XMLHttpRequest)return new e.XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}},getXDR:function(){return this.isXDRSupported()?new e.XDomainRequest:null}}}),Re.addUtility("url",function(t){var n,a=t.getUtility("browser");return{getCurrentURL:function(){return e.location.href},makeAbsolute:function(e){return this.parse(e).href},isCrossDomain:function(e){var t=this.parse(e);return n||(n=this.parse(this.getCurrentURL())),t.hostname?t.protocol!==n.protocol||t.hostname!==n.hostname||t.port!==n.port:!1},appendQueryParams:function(e,t){return e.indexOf("?")>-1?e+"&"+t:e+"?"+t},parse:function(e){var t,n=document.createElement("a");return n.href=e,a.ie&&e!==n.href&&(e=n.href,n.href=e),t=n.pathname,/^\//.test(t)||(t="/"+t),{href:n.href,protocol:n.protocol,host:n.host,hostname:n.hostname,port:n.port,pathname:t,hash:n.hash,search:n.search}}}}),Re.addComponent("controller-paged",function(e){function n(){var e=u.metadata;u.numPages=e.numpages,u.pageStart?u.pageStart<0&&(u.pageStart=e.numpages+u.pageStart):u.pageStart=1,u.pageStart=f.clamp(u.pageStart,1,e.numpages),u.pageEnd?u.pageEnd<0&&(u.pageEnd=e.numpages+u.pageEnd):u.pageEnd=e.numpages,u.pageEnd=f.clamp(u.pageEnd,u.pageStart,e.numpages),u.numPages=u.pageEnd-u.pageStart+1}function a(){var e,n,a,o,i,r,s,l,c=f.calculatePtSize(),d=u.metadata.dimensions,g="";for(u.pageScale=W/(d.width*c),a=u.zoomLevels[u.zoomLevels.length-1],o=3/u.pageScale;o>a;)a+=a/2,u.zoomLevels.push(a);for(d.exceptions=d.exceptions||{},e=u.pageStart-1;e<u.pageEnd;e++)n=e+1,n in d.exceptions?(i=d.exceptions[n].width,r=d.exceptions[n].height):(i=d.width,r=d.height),s=i*c,l=r*c,s*=u.pageScale,l*=u.pageScale,g+=f.template(Re.pageTemplate,{w:s,h:l});u.$pages=t(g).appendTo(u.$doc)}function o(e){return u.conversionIsComplete||0===e&&u.autoloadFirstPage?ne:te}function i(){var t,n,a=[],i=u.pageStart-1,s=u.pageEnd,l=r();for(t=i;s>t;t++)n=e.createComponent("page"),n.init(u.$pages.eq(t-i),{index:t,status:o(t),enableLinks:u.enableLinks,links:l[t],pageScale:u.pageScale}),a.push(n);u.pages=a}function r(){var e,t,n,a,o=u.pageStart,i=u.pageEnd,r=u.metadata.links||[],s=[];for(e=0,t=u.metadata.numpages;t>e;++e)s[e]=[];for(e=0,t=r.length;t>e;++e)if(n=r[e],!(n.pagenum<o||n.pagenum>i)){if(n.destination){if(a=n.destination.pagenum,o>a||a>i)continue;n.destination.pagenum=a-(o-1)}s[n.pagenum-1].push(n)}return s}function s(){l()}function l(){var e=f.getSelectedNode(),n=t(e).closest("."+T);c.find("."+d).removeClass(d),e&&c.has(e)&&n.addClass(d)}var u,c,g,f=e.getUtility("common");return{init:function(){u=e.getConfig(),c=u.$el,t(document).on("mouseup",s),n(),a(),i(),g=e.createComponent("lazy-loader"),g.init(u.pages)},destroy:function(){t(document).off("mouseup",s)}}}),Re.addComponent("controller-text",function(e){var n;return{init:function(){var a=e.getConfig();a.$textContainer=t(),n=e.get("page-text",1).then(function(e){var n=a.$doc.parent();a.$doc=t(e),n.html(a.$doc)})},destroy:function(){n.abort()}}}),Re.addComponent("dragger",function(n){function a(e){r.scrollTop(s.top-(e.clientY-l.y)),r.scrollLeft(s.left-(e.clientX-l.x)),e.preventDefault()}function o(e){n.broadcast("dragend"),u.off("mousemove",a),u.off("mouseup",o),e.preventDefault()}function i(e){n.broadcast("dragstart"),s={top:r.scrollTop(),left:r.scrollLeft()},l={x:e.clientX,y:e.clientY},u.on("mousemove",a),u.on("mouseup",o),e.preventDefault()}var r,s,l,u=t(e);return{init:function(e){r=t(e),r.on("mousedown",i)},destroy:function(){r.off("mousedown",i),r.off("mousemove",a),u.off("mouseup",o)}}}),Re.addComponent("layout-base",function(t){var n=t.getUtility("common");return{messages:["resize","scroll","scrollend"],onmessage:function(e,t){switch(e){case"resize":this.handleResize(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t)}},init:function(){var e=t.getConfig();this.config=e,this.$el=e.$el,this.$doc=e.$doc,this.$viewport=e.$viewport,this.$pages=e.$pages,this.numPages=e.numPages,this.layoutClass=y+e.layout,this.$el.addClass(this.layoutClass),this.initState()},initState:function(){var t=this.$viewport[0],n=t;t===e&&(n=document.documentElement),this.state={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,viewportDimensions:{clientWidth:n.clientWidth,clientHeight:n.clientHeight,offsetWidth:n.offsetWidth,offsetHeight:n.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},initialWidth:0,initialHeight:0,totalWidth:0,totalHeight:0},this.zoomLevels=[]},destroy:function(){this.$doc.removeAttr("style"),this.$el.removeClass(this.layoutClass)},setZoom:function(){},calculateNextZoomLevel:function(e){var t,n=!1,a=this.state.zoomState.zoom,o=this.zoomLevels;if(e===Re.ZOOM_IN){for(t=0;t<o.length;++t)if(o[t]>a){n=o[t];break}}else if(e===Re.ZOOM_OUT)for(t=o.length-1;t>=0;--t)if(o[t]<a){n=o[t];break}return n},isDraggable:function(){var e=this.state;return e.viewportDimensions.clientHeight<e.totalHeight||e.viewportDimensions.clientWidth<e.totalWidth},scrollBy:function(e,t){e=parseInt(e,10)||0,t=parseInt(t,10)||0,this.scrollToOffset(e+this.state.scrollLeft,t+this.state.scrollTop)},scrollToOffset:function(e,t){this.$viewport.scrollLeft(e),this.$viewport.scrollTop(t)},handleScroll:function(e){this.state.scrollTop=e.scrollTop,this.state.scrollLeft=e.scrollLeft},handleResize:function(){},handleScrollEnd:function(){},update:function(){},focus:function(){this.$viewport.focus()},extend:function(e){return n.extend({},this,e)}}}),Re.addComponent("layout-"+J,["layout-paged"],function(e,t){var n=e.getUtility("common"),a=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(N),n=this.calculateZoomValue(F);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(t,n):a.mobile?n:Math.min(1,n)},calculateCurrentPage:function(){var e,t,a=this.state,o=a.pages;return e=n.bisectRight(o,a.scrollLeft,"x0")-1,t=n.bisectRight(o,a.scrollLeft+o[e].width/2,"x0")-1,1+t},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState,n=t.zoom,a=e.sumWidths,o=Math.floor(e.tallestPage.totalActualHeight*n),i=Math.max(a,e.viewportDimensions.clientWidth),r=Math.max(o,e.viewportDimensions.clientHeight);this.$doc.css({height:r,lineHeight:r+"px",width:i})}})}),Re.addComponent("layout-paged",["layout-base"],function(e,t){function n(e,t){var n,a,r,s,l=e.state,u="."+e.config.namespace+" ."+R,c=e.config.stylesheet,d=l.pages,g=t*e.config.pageScale,f=100/g;for(s=i.csstransform?i.csstransform+":scale("+g+");width:"+f+"%;height:"+f+"%;":i.csszoom?"zoom:"+g:"",l.previousStyleIndex&&o.deleteCSSRule(c,l.previousStyleIndex),l.previousStyleIndex=o.appendCSSRule(c,u,s),n=0,a=d.length;a>n;++n)r=d[n],e.$pages.eq(n).css({width:r.actualWidth*t,height:r.actualHeight*t,paddingTop:r.paddingTop*t,paddingRight:r.paddingRight*t,paddingBottom:r.paddingBottom*t,paddingLeft:r.paddingLeft*t})}function a(e,t){if(!t||0===t.length)return 1/0;var n=o.map(t,function(t){return e[t].y1});return Math.max.apply(Math,n)}var o=e.getUtility("common"),i=e.getUtility("support");return t.extend({init:function(){t.init.call(this),this.updatePageStates(),this.updateZoomLevels()},initState:function(){t.initState.call(this),o.extend(this.state,{pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],currentPage:null,visiblePages:[],fullyVisiblePages:[]})},destroy:function(){t.destroy.call(this),this.$pages.css("padding","")},update:function(){this.updatePageStates(!0),this.setZoom()},setZoom:function(t){var n,a,i=this.state,r=this.parseZoomValue(t),s=i.zoomState,l=s.zoom;n=this.calculateZoomMode(t,r),r=o.clamp(r,i.minZoom,i.maxZoom),e.broadcast("beforezoom",o.extend({page:i.currentPage,visiblePages:o.extend([],i.visiblePages),fullyVisiblePages:o.extend([],i.fullyVisiblePages)},s)),s.prevZoom=l,s.zoom=r,s.zoomMode=n,this.applyZoom(r),s.canZoomIn=this.calculateNextZoomLevel(Re.ZOOM_IN)!==!1,s.canZoomOut=this.calculateNextZoomLevel(Re.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),a=t===Re.ZOOM_AUTO||t===Re.ZOOM_FIT_WIDTH||t===Re.ZOOM_FIT_HEIGHT,this.updateScrollPosition(a),this.updatePageStates(),this.updateVisiblePages(!0),e.broadcast("zoom",o.extend({page:i.currentPage,visiblePages:o.extend([],i.visiblePages),fullyVisiblePages:o.extend([],i.fullyVisiblePages),isDraggable:this.isDraggable()},s))},parseZoomValue:function(e){var t=parseFloat(e),n=this.state,a=n.zoomState,o=a.zoom,i=o;if(t)i=t;else switch(e){case Re.ZOOM_FIT_WIDTH:case Re.ZOOM_FIT_HEIGHT:case Re.ZOOM_AUTO:i=this.calculateZoomValue(e);break;case Re.ZOOM_IN:case Re.ZOOM_OUT:i=this.calculateNextZoomLevel(e)||o;break;default:i=o?a.zoomMode?this.calculateZoomValue(a.zoomMode):o:this.calculateZoomValue(this.config.zoom||Re.ZOOM_AUTO)}return i},calculateZoomMode:function(e,t){switch(t){case this.calculateZoomValue(Re.ZOOM_AUTO):return"string"!=typeof e||e!==Re.ZOOM_FIT_WIDTH&&e!==Re.ZOOM_FIT_HEIGHT?Re.ZOOM_AUTO:e;case this.calculateZoomValue(Re.ZOOM_FIT_WIDTH):return Re.ZOOM_FIT_WIDTH;case this.calculateZoomValue(Re.ZOOM_FIT_HEIGHT):return Re.ZOOM_FIT_HEIGHT;default:return null}},updateZoomLevels:function(){function e(e){var t=n/e;return e===n?!1:de>t?!0:o.inArray(e,l)>-1&&ge>t?!0:!1}var t,n,a=this.config.zoomLevels.slice()||[1],i=this.calculateZoomValue(Re.ZOOM_AUTO),r=this.calculateZoomValue(Re.ZOOM_FIT_WIDTH),s=this.calculateZoomValue(Re.ZOOM_FIT_HEIGHT),l=[r,s];for(this.state.minZoom=this.config.minZoom||a[0],this.state.maxZoom=this.config.maxZoom||a[a.length-1],i!==r&&i!==s&&l.push(i),a=a.concat(l),a.sort(function(e,t){return e-t}),this.zoomLevels=[],n=0,t=0;t<a.length;++t)e(a[t])&&(n=a[t],this.zoomLevels.push(n))},calculateZoomValue:function(e){var t=this.state,n=parseFloat(e);return n?n:e===Re.ZOOM_FIT_WIDTH?t.viewportDimensions.clientWidth/t.widestPage.totalActualWidth:e===Re.ZOOM_FIT_HEIGHT?t.viewportDimensions.clientHeight/t.tallestPage.totalActualHeight:e===Re.ZOOM_AUTO?this.calculateZoomAutoValue():t.zoomState.zoom},applyZoom:function(e){n(this,e)},scrollTo:function(e){var t=this.state,n=parseInt(e,10);if("string"==typeof e){if(e===Re.SCROLL_PREVIOUS&&t.currentPage>1)n=this.calculatePreviousPage();else if(e===Re.SCROLL_NEXT&&t.currentPage<this.numPages)n=this.calculateNextPage();else if(!n)return}else if(!n&&0!==n)return;n=o.clamp(n,1,this.numPages),this.scrollToPage(n)},scrollToPage:function(e){var t=this.calculateScrollPositionForPage(e);this.scrollToOffset(t.left,t.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(e){var t=o.clamp(e-1,0,this.numPages-1),n=this.state.pages[t];return{top:n.y0,left:n.x0}},calculateVisibleRange:function(){var e=this.state,t=e.pages,n=e.viewportDimensions.clientHeight,a=e.viewportDimensions.clientWidth;if(0===a||0===n)return{min:-1,max:-1};var i=e.scrollTop,r=i+n,s=e.scrollLeft,l=s+a,u=o.bisectLeft(t,i,"y1"),c=o.bisectRight(t,r,"y0")-1,d=o.bisectLeft(t,s,"x1"),g=o.bisectRight(t,l,"x0")-1,f=Math.max(d,u),h=Math.min(g,c);return o.constrainRange(f,h,this.numPages-1)},calculateFullyVisibleRange:function(){var e=this.state,t=e.pages,n=e.viewportDimensions.clientHeight,a=e.viewportDimensions.clientWidth;if(0===a||0===n)return{min:-1,max:-1};var i=e.scrollTop,r=i+n,s=e.scrollLeft,l=s+a,u=o.bisectLeft(t,i,"y0"),c=o.bisectRight(t,r,"y1")-1,d=o.bisectLeft(t,s,"x0"),g=o.bisectRight(t,l,"x1")-1,f=Math.max(d,u),h=Math.min(g,c);return o.constrainRange(f,h,this.numPages-1)},setCurrentPage:function(t){var n=this.state;n.currentPage!==t?(n.currentPage=t,this.updateVisiblePages(),e.broadcast("pagefocus",{page:n.currentPage,numPages:this.numPages,visiblePages:o.extend([],n.visiblePages),fullyVisiblePages:o.extend([],n.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(e){var t,n,a,o=this.state,i=this.calculateVisibleRange(),r=this.calculateFullyVisibleRange();for(o.visiblePages.length=0,o.fullyVisiblePages.length=0,t=0,n=this.$pages.length;n>t;++t)a=this.$pages.eq(t),t<i.min||t>i.max?e&&a.hasClass(U)&&a.removeClass(U):(e&&!a.hasClass(U)&&a.addClass(U),o.visiblePages.push(t+1)),t>=r.min&&t<=r.max&&o.fullyVisiblePages.push(t+1)},updatePageStates:function(e){var t,n,o,i,r,s=this.state,l=s.pages,u=s.rows,c=this.$viewport.scrollTop(),d=this.$viewport.scrollLeft(),g=0,f=0,h=0,p=0;for(u.length=s.sumWidths=s.sumHeights=s.totalWidth=s.totalHeight=0,s.widestPage.totalActualWidth=s.tallestPage.totalActualHeight=0,t=0,n=this.$pages.length;n>t;++t)r=this.$pages.eq(t),i=r[0],o=l[t],(!o||e)&&(r.css("padding",""),o={index:t,paddingLeft:parseFloat(r.css(ue)),paddingRight:parseFloat(r.css(le)),paddingTop:parseFloat(r.css(se)),paddingBottom:parseFloat(r.css(ce))}),o.actualWidth||(o.actualWidth=parseFloat(i.getAttribute("data-width"))),o.actualHeight||(o.actualHeight=parseFloat(i.getAttribute("data-height"))),o.totalActualWidth=o.actualWidth+o.paddingLeft+o.paddingRight,o.totalActualHeight=o.actualHeight+o.paddingTop+o.paddingBottom,o.width=i.offsetWidth,o.height=i.offsetHeight,o.x0=i.offsetLeft,o.y0=i.offsetTop,o.x1=o.width+o.x0,o.y1=o.height+o.y0,f&&a(l,u[g])<=o.y0+2&&g++,f=o.y1,u[g]||(u[g]=[]),o.totalActualWidth>s.widestPage.totalActualWidth&&(s.widestPage=o),o.totalActualHeight>s.tallestPage.totalActualHeight&&(s.tallestPage=o),s.sumWidths+=o.width,s.sumHeights+=o.height,o.rowIndex=g,l[t]=o,u[g].push(t),l[h].x0+l[h].width<o.x0+o.width&&(h=t),l[p].y0+l[p].height<o.y0+o.height&&(p=t);s.totalWidth=l[h].x0+l[h].width,s.totalHeight=l[p].y0+l[p].height,s.scrollTop=c,s.scrollLeft=d,this.setCurrentPage(this.calculateCurrentPage())},updateCurrentPage:function(){var e=this.calculateCurrentPage();this.setCurrentPage(e)},handleResize:function(e){var t=this.state.zoomState.zoomMode;this.state.viewportDimensions=e,this.updateZoomLevels(),this.setZoom(t)},handleScrollEnd:function(e){this.$doc.find("."+b).removeClass(b),this.$pages.eq(this.state.currentPage-1).addClass(b),this.updateVisiblePages(!0),this.handleScroll(e)},updateScrollPosition:function(e){var t,n,a=this.state,o=a.zoomState,i=o.zoom/o.prevZoom;t=a.scrollLeft*i,n=a.scrollTop*i,e!==!0&&(n+=a.viewportDimensions.offsetHeight*(i-1)/2,t+=a.viewportDimensions.offsetWidth*(i-1)/2),this.scrollToOffset(t,n)},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}})}),Re.addComponent("layout-"+K,["layout-"+Y],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){this.twoPageMode=!0,t.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){
return this.state.currentPage-2},calculateZoomValue:function(e){var n=t.calculateZoomValue.call(this,e);return e===N&&(n/=2),n},scrollToPage:function(e){t.scrollToPage.call(this,e-(e+1)%2)},calculateVisibleRange:function(){var e=this.state.currentPage-1,t=e+1;return n.constrainRange(e,t,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),Re.addComponent("layout-"+Y,["layout-paged"],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){t.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(k)},calculateZoomAutoValue:function(){var e=this.calculateZoomValue(N),t=this.calculateZoomValue(F);return Math.min(e,t)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var e=this.state.currentPage-1;return n.constrainRange(e,e,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(e){var a,o,i=n.clamp(e-1,0,this.numPages);t.setCurrentPage.call(this,e),this.$doc.find("."+P).removeClass(P),a=this.$doc.find("."+b),o=this.$pages.eq(i),a[0]!==o[0]&&(a.addClass(P).removeClass(b),o.addClass(b)),this.updateVisiblePages(!0),this.updatePageClasses(i)},scrollToPage:function(e){this.setCurrentPage(e)},updateLayout:function(){var e,t,n,a,o,i,r,s=this.state,l=s.zoomState,u=l.zoom,c=this.currentPage||1,d=s.pages[c-1],g=this.twoPageMode?s.pages[c]:d,f=s.viewportDimensions.clientWidth,h=s.viewportDimensions.clientHeight;e=g.actualWidth,t=d.actualWidth+(this.twoPageMode?e:0),n=d.actualHeight,a=Math.floor((t+d.paddingLeft+g.paddingRight)*u),o=Math.floor(d.totalActualHeight*u),i=Math.max(a,f),r=Math.max(o,h),this.$doc.css({width:i,height:r}),this.updatePageMargins(),i>f||r>h?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var e,t,n,a,o,i,r,s,l,u=this.state,c=u.viewportDimensions.clientWidth,d=u.viewportDimensions.clientHeight;for(e=0,t=this.$pages.length;t>e;++e)a=this.$pages.eq(e),n=u.pages[e],l=this.twoPageMode?e%2===1?n.paddingRight:n.paddingLeft:n.paddingRight+n.paddingLeft,o=(n.actualWidth+l)*u.zoomState.zoom,i=(n.actualHeight+n.paddingTop+n.paddingBottom)*u.zoomState.zoom,this.twoPageMode?(r=Math.max(0,(c-2*o)/2),e%2===1&&(r+=o)):r=(c-o)/2,s=(d-i)/2,r=Math.max(r,0),s=Math.max(s,0),a.css({marginLeft:r,marginTop:s})},updatePageClasses:function(){var e=this.$pages,t=this.state.currentPage-1,n=t+1,a=t-1,o=20;e.removeClass(k),this.twoPageMode?(n=t+2,a=t-2,e.slice(Math.max(a,0),t).addClass(z),e.slice(n,n+2).addClass(M)):(a>=0&&e.eq(a).addClass(z),n<this.numPages&&e.eq(n).addClass(M)),e.slice(0,t).addClass(A),e.slice(Math.max(0,t-o),t).addClass(H),e.slice(n).addClass(_),e.slice(n,Math.min(this.numPages,n+o)).addClass(I)}})}),Re.addComponent("layout-"+ee,["layout-base"],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.zoomLevels=this.config.zoomLevels.slice(),this.minZoom=this.zoomLevels[0],this.maxZoom=this.zoomLevels[this.zoomLevels.length-1]},setZoom:function(t){var a,o=this.state.zoomState,i=o.zoom;"string"==typeof t?(a=this.calculateNextZoomLevel(t),a||(a="auto"===t||"fitwidth"===t||"fitheight"===t?1:i)):a=parseFloat(t)||i,a=n.clamp(a,this.minZoom,this.maxZoom),this.config.$doc.css("font-size",10*a+"pt"),o.prevZoom=i,o.zoom=a,o.canZoomIn=this.calculateNextZoomLevel(Re.ZOOM_IN)!==!1,o.canZoomOut=this.calculateNextZoomLevel(Re.ZOOM_OUT)!==!1,e.broadcast("zoom",n.extend({isDraggable:this.isDraggable()},o))}})}),Re.addComponent("layout-"+Q,["layout-"+B],function(e,t){return t}),Re.addComponent("layout-"+B,["layout-paged"],function(e,t){var n=e.getUtility("common"),a=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(N),n=this.calculateZoomValue(F);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(1,t,n):a.mobile?t:Math.min(1,t)},calculateCurrentPage:function(){var e,t,a,o,i,r=this.state,s=r.pages;return e=n.bisectRight(s,r.scrollTop,"y0")-1,0>e?1:(i=r.scrollTop+s[e].height/2,t=n.bisectRight(s,i,"y0")-1,a=s[t].rowIndex,o=r.rows[a],1+o[0])},calculateNextPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,a=e.rows[n+1];return a&&a[0]+1||e.currentPage},calculatePreviousPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,a=e.rows[n-1];return a&&a[0]+1||e.currentPage},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e,t,n=this.state,a=n.zoomState.zoom;e=Math.floor(n.widestPage.totalActualWidth*a),t=e<=n.viewportDimensions.clientWidth?"auto":e,this.$doc.css({width:t})}})}),Re.addComponent("lazy-loader",function(e){function n(e){e=e||w;var t=L.page-1,n=t-e,a=t+e;return y.constrainRange(n,a,h-1)}function a(){var e;clearTimeout(v),T.length>0?(e=T.shift(),f[e]?P.loadPage(e,function(e){e===!1?a():v=setTimeout(a,fe)}):a()):i()}function o(){clearTimeout(v),x=!1,v=setTimeout(a,fe)}function i(){clearTimeout(v),x=!0}function r(e){T.push(e),x&&o()}function s(){T.length=0,i()}function l(e,t){var a=n(t);return e>=a.min&&e<=a.max?!0:!1}function u(e){var t=f[e];if(t){if(l(e))return!0;if(d(e))return!0}return!1}function c(e,t){return l(e,t)?!1:d(e)?!1:!0}function d(e){return y.inArray(e+1,L.visiblePages)>-1}function g(e,t){for(var n=y.sign(t-e);e!==t;)P.queuePageToLoad(e),e+=n;P.queuePageToLoad(e)}var f,h,p,m,v,y=e.getUtility("common"),b=e.getUtility("browser"),P={},T=[],w=1,x=!0,S=1,C=!1,L={page:1,visiblePages:[1]};return y.extend(P,{messages:["beforezoom","pageavailable","pagefocus","ready","scroll","scrollend","zoom"],onmessage:function(e,t){switch(e){case"beforezoom":this.handleBeforeZoom(t);break;case"pageavailable":this.handlePageAvailable(t);break;case"pagefocus":this.handlePageFocus(t);break;case"ready":this.handleReady();break;case"scroll":this.handleScroll();break;case"scrollend":this.handleScrollEnd();break;case"zoom":this.handleZoom(t)}},init:function(e){f=e,h=f.length,w=b.mobile||b.ielt10?pe:he,w=Math.min(w,h)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(e){S=y.sign(e.page-L.page),L=e},loadNecessaryPages:y.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(L.page-1),this.loadVisiblePages(),this.loadPagesInRange(w)}),loadPagesInRange:function(e){var t=L.page-1;e>0&&(e=n(e),S>=0?(g(t+1,e.max),g(t-1,e.min)):(g(t-1,e.min),g(t+1,e.max)))},loadVisiblePages:function(){var e,t;for(e=0,t=L.visiblePages.length;t>e;++e)this.queuePageToLoad(L.visiblePages[e]-1)},queuePageToLoad:function(e){u(e)&&(f[e].preload(),r(e))},cancelAllLoading:function(){clearTimeout(m),clearTimeout(p),s()},loadPage:function(e,n){t.when(f[e]&&f[e].load()).always(n)},unloadPage:function(e){var t=f[e];t&&t.unload()},unloadUnnecessaryPages:function(e){var t,n;for(t=0,n=f.length;n>t;++t)c(t,e)&&this.unloadPage(t)},handleReady:function(){C=!0,this.loadVisiblePages(),m=setTimeout(function(){P.loadNecessaryPages()},me)},handlePageAvailable:function(e){if(C){var t;if(e.all===!0&&(e.upto=h),e.page)this.queuePageToLoad(e.page-1);else if(e.upto)for(t=0;t<e.upto;++t)this.queuePageToLoad(t)}},handlePageFocus:function(e){this.updateLayoutState(e),C&&(this.cancelAllLoading(),p=setTimeout(function(){P.loadNecessaryPages()},200))},handleBeforeZoom:function(e){C&&(this.cancelAllLoading(),this.unloadUnnecessaryPages(2*e.visiblePages.length))},handleZoom:function(e){this.updateLayoutState(e),C&&this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){C&&(this.loadNecessaryPages(),this.unloadUnnecessaryPages(w))}})}),Re.addComponent("page-img",function(e){var n,a,o,i,r=e.getUtility("browser"),s=!1,l=r.mobile;return{init:function(e,n){a=t(e),i=n},destroy:function(){l=!0,this.unload(),a.empty()},prepare:function(){},preload:function(){o||(o=e.get("page-img",i))},load:function(){return this.preload(),o.done(function(e){s||(s=!0,n=t(e).appendTo(a))}),o.fail(function(t){s=!1,t&&e.broadcast("asseterror",t)}),o},unload:function(){o&&(o.abort(),o=null),l&&(n&&(n.remove(),n=null),s=!1)}}}),Re.addComponent("page-links",function(e){function n(e){var n=t("<a>").addClass(L),r=e.bbox[0],s=e.bbox[1],l={};if(i.ie&&t("<span>").appendTo(n).on("click",a),n.css({left:r+"pt",top:s+"pt",width:e.bbox[2]-r+"pt",height:e.bbox[3]-s+"pt"}),e.uri){if(!/^http|^mailto/.test(e.uri))return;l.href=encodeURI(e.uri),l.target="_blank"}else e.destination&&(l.href="#page-"+e.destination.pagenum);n.attr(l),n.data("link",e),n.appendTo(o)}function a(n){var a=i.ie?n.target.parentNode:n.target,o=t(a),r=o.data("link");r&&e.broadcast("linkclick",r),n.preventDefault()}var o,i=e.getUtility("browser");return{init:function(e,n){o=t(e),this.createLinks(n),i.ie||o.on("click","."+L,a)},destroy:function(){o.empty().off("click"),o=i=null},createLinks:function(e){var t,a;for(t=0,a=e.length;a>t;++t)n(e[t])}}}),Re.addComponent("page-svg",function(n){function a(){switch(T){case Pe:case Le:return t("<iframe>");case Ce:case Te:return t("<object>").attr({type:ve,data:"data:"+ve+";base64,"+e.btoa(be)});case we:return t("<div>");case xe:return t("<object>");case Se:case Oe:return t("<img>")}}function o(){c&&0!==c.length||(y=!1,c=a()),0===c.parent().length&&c.appendTo(d)}function i(){return y||T===xe||T===Se?t.Deferred().resolve().promise({abort:function(){}}):n.get("page-svg",f)}function r(e){var t=e.querySelectorAll("use");[].forEach.call(t,function(t){var n=t.getAttribute("xlink:href"),a=e.querySelector(n).cloneNode(),o=t.parentNode;a.removeAttribute("id"),a.setAttribute("transform",t.getAttribute("transform")),o.replaceChild(a,t)})}function s(t){var a,o,i,s,l,u=c[0].contentDocument,d=c[0].contentWindow||u&&u.defaultView;switch(T){case Pe:h.ielt10&&(t=t.replace(/<xhtml:link.*/,"")),s=ye+t,h.ielt10?u.body.innerHTML=s:(u.documentElement.innerHTML=s,(h.ios||h.safari)&&h.version<7&&r(u)),i=u.getElementsByTagName("svg")[0];break;case Le:u.documentElement.innerHTML=ye;var g=u.getElementsByTagName("head")[0]||u.documentElement,m=u.createElement("script"),v="("+proxySVG+")()";m.type="text/javascript";try{m.appendChild(document.createTextNode(v))}catch(y){m.text=v}return g.insertBefore(m,g.firstChild),void("complete"===u.readyState?d.loadSVG(t):d.onload=function(){this.loadSVG(t)});case Te:a=new p,o=a.parseFromString(t,ve),i=u.importNode(o.documentElement,!0),u.documentElement.appendChild(i);break;case Ce:d.loadSVG(t),i=u.querySelector("svg");break;case we:a=new p,o=a.parseFromString(t,ve),i=document.importNode(o.documentElement,!0),c.append(i);break;case xe:c.attr({type:ve,data:n.getDataProvider("page-svg").getURL(f)}),i=c[0];break;case Se:i=c[0],i.src=n.getDataProvider("page-svg").getURL(f);break;case Oe:i=c[0],l="data:"+ve,!h.ie&&e.btoa?i.src=l+";base64,"+e.btoa(t):i.src=l+","+encodeURIComponent(t)}i.setAttribute("width","100%"),i.setAttribute("height","100%")}function l(e){m||v||(!y&&e&&(s(e),y=!0,P||(g.abort(),g=null)),0===c.parent().length&&c.appendTo(d))}function u(e){n.broadcast("asseterror",e),y=!1,g&&g.abort()}var c,d,g,f,h=n.getUtility("browser"),p=e.DOMParser,m=!1,v=!1,y=!1,b=n.getConfig(),P=h.mobile||h.ielt10,T=h.ielt11||h.firefox?Oe:Pe;return{init:function(e,t){d=e,f=t,T=b.embedStrategy||T},destroy:function(){m=!0,P=!0,this.unload(),d.empty()},prepare:function(){o()},preload:function(){this.prepare(),g||(g=i())},load:function(){return v=!1,this.preload(),g.done(l).fail(u),g},unload:function(){v=!0,g&&"resolved"!==g.state()&&(g.abort(),g=null),P&&(c&&(c.remove(),c=null),y=!1)}}}),Re.addComponent("page-text",function(e){function n(){return f.enableTextSelection&&!u.ielt9}function a(e){var t,n;!e||g||d||(g=!0,t=document.implementation.createHTMLDocument(""),t.getElementsByTagName("body")[0].innerHTML=e,e=null,n=document.importNode(t.querySelector("."+C),!0),r.attr("class",n.getAttribute("class")),r.html(n.innerHTML),c.fix(r))}function o(t){t&&e.broadcast("asseterror",t)}function i(){return s||(s=n()?e.get("page-text",l):t.Deferred().resolve().promise({abort:function(){}})),s}var r,s,l,u=e.getUtility("browser"),c=e.getUtility("subpx"),d=!1,g=!1,f=e.getConfig();return{init:function(e,t){r=e,l=t},destroy:function(){d=!0,this.unload(),r.empty()},preload:function(){i()},load:function(){return i().done(a).fail(o)},unload:function(){s&&"resolved"!==s.state()&&(s.abort(),s=null)},enable:function(){r.css("display",""),s&&!g&&(s=null)},disable:function(){r.css("display","none")}}}),Re.addComponent("page",function(e){var n,a,o,i,r,s,l,u,c=e.getUtility("support"),d=e.getUtility("common"),g=!1;return{messages:["pageavailable","pagefocus","textenabledchange","zoom"],onmessage:function(e,t){switch(e){case"pageavailable":(t.page===s+1||t.upto>s||t.all===!0)&&u===te&&(u=ne);break;case"textenabledchange":t.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":l=r===t.page||d.inArray(r,t.visiblePages)>-1}},init:function(t,l){var d,g,f;n=t,g=t.find("."+S),d=t.find("."+C),f=t.find("."+O),u=l.status||ne,s=l.index,r=s+1,this.config=l,l.url=l.url||"",a=e.createComponent("page-text"),o=c.svg?e.createComponent("page-svg"):e.createComponent("page-img"),a.init(d,r),o.init(g,r),l.enableLinks&&l.links.length&&(i=e.createComponent("page-links"),i.init(f,l.links))},destroy:function(){this.unload()},preload:function(){o.prepare(),u===ne&&(o.preload(),a.preload())},load:function(){var i=this;return g=!0,u===ie?!1:u===te?!1:(u!==oe&&(u=ae),t.when(o.load(),a.load()).done(function(){g?u!==oe&&(n.removeClass(E),u=oe,e.broadcast("pageload",{page:r})):i.unload()}).fail(function(t){u=ie,n.addClass(Z),e.broadcast("pagefail",{page:s+1,error:t})}))},unload:function(){g=!1,o.unload(),a.unload(),u===oe&&(u=ne,n.addClass(E),n.removeClass(Z),e.broadcast("pageunload",{page:r}))},enableTextSelection:function(){a.enable(),l&&a.load()},disableTextSelection:function(){a.disable()}}}),Re.addComponent("resizer",function(n){function a(){n.broadcast("resize",{width:u,height:c,clientWidth:s,clientHeight:l,offsetWidth:u,offsetHeight:c})}function o(){var e=t('<iframe frameborder="0">'),n=t("<div>");e.add(n).css({opacity:0,visiblility:"hidden",position:"absolute",width:"100%",height:"100%",top:0,left:0,border:0}),e.prependTo(n.prependTo(r)),"static"===d.getComputedStyle(r).position&&t(r).css({position:"relative"}),f=t(e[0].contentWindow),f.on("resize",i)}function i(){var t=r.offsetHeight,o=r.offsetWidth;return m&&0===p&&0!==e.innerWidth?(p=e.innerWidth,void n.broadcast("layoutchange")):void(t&&(t!==c||o!==u)&&(c=t,u=o,l=r.clientHeight,s=r.clientWidth,a()))}var r,s,l,u,c,d=n.getUtility("common"),g=[""," webkit"," moz"," "].join("fullscreenchange")+"MSFullscreenChange",f=t(e),h=t(document),p=0,m=function(){try{return e.self!==e.top}catch(t){return!0}}();return{messages:["layoutchange"],onmessage:function(){c=null,i()},init:function(n){r=t(n).get(0),r===e?(r=document.documentElement,f.on("resize",i)):o(),h.on(g,i),i()},destroy:function(){h.off(g,i),f.off("resize",i)}}}),Re.addComponent("scroller",function(e){function n(){return{scrollTop:u.scrollTop(),scrollLeft:u.scrollLeft()}}function a(){v=!1,w=null,clearTimeout(c),e.broadcast("scrollend",n())}function o(){v||(v=!0,e.broadcast("scrollstart",n())),clearTimeout(c),c=setTimeout(a,m),x()}function i(){y=!0,b=!1,P=!1,o()}function r(){P=!0,o()}function s(){y=!1,b=!0,T=(new Date).getTime(),P&&l()}function l(){return clearTimeout(c),null===w&&(w=(new Date).getTime()),(new Date).getTime()-w>f?void a():(x(),void(c=setTimeout(l,h)))}var u,c,d=e.getUtility("common"),g=e.getUtility("browser"),f=3e3,h=30,p=200,m=g.mobile?500:250,v=!1,y=!1,b=!1,P=!1,T=0,w=null,x=d.throttle(p,function(){e.broadcast("scroll",n())});return{init:function(e){u=t(e),u.on("scroll",o),u.on("touchstart",i),u.on("touchmove",r),u.on("touchend",s)},destroy:function(){clearTimeout(c),u.off("scroll",o),u.off("touchstart",i),u.off("touchmove",r),u.off("touchend",s)}}}),Re.addComponent("viewer-base",function(n){function a(){w.attr(o,T.metadata.version||"0.0.0"),Z.mobile&&w.addClass(h),Z.ielt9&&w.addClass(p),U.svg&&w.addClass(m)}function l(){w.html(Re.viewerTemplate),T.useWindowAsViewport?(T.$viewport=t(e),w.addClass(v)):T.$viewport=w.find("."+s),T.$doc=w.find("."+r)}function d(){var e,t,a=T.plugins||{};for(e in a)t=n.createComponent("plugin-"+e),t&&E.isFn(t.init)&&t.init(T.plugins[e])}function g(){a(),C=n.createComponent("scroller"),C.init(T.$viewport),L=n.createComponent("resizer"),L.init(T.$viewport);var e;switch(T.metadata.type){case"text":e=n.createComponent("controller-text"),T.layout=ee;break;case"paged":default:e=n.createComponent("controller-paged")}e.init(),"text"===T.metadata.type?T.enableTextSelection||P.disableTextSelection():Z.ielt9&&P.disableTextSelection(),(!T.enableLinks||Z.ielt9)&&P.disableLinks(),P.setLayout(T.layout),n.broadcast("ready",{page:T.page||1,numPages:T.numPages}),n.ready()}function f(t){var n=P.fire("linkclick",t);n.isDefaultPrevented()||(t.uri?e.open(t.uri):t.destination&&P.scrollTo(t.destination.pagenum))}function y(e){e?O||(w.addClass(u),O=n.createComponent("dragger"),O.init(T.$viewport)):O&&(w.removeClass(u),n.destroyComponent(O),O=null)}function b(){var e;T.queryParams&&(e="string"==typeof T.queryParams?T.queryParams.replace(/^\?/,""):E.param(T.queryParams)),T.queryString=e?"?"+e:""}var P,T,w,x,S,C,L,O,R,E=n.getUtility("common"),Z=n.getUtility("browser"),U=n.getUtility("support");return{messages:["asseterror","destroy","dragend","dragstart","fail","layoutchange","linkclick","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(e,t){switch(e){case"layoutchange":P.updateLayout();break;case"linkclick":f(t);break;case"zoom":t.zoom*=T.pageScale,t.prevZoom*=T.pageScale,T.enableDragging&&y(t.isDraggable),P.fire(e,t);break;case"dragstart":w.hasClass(c)||w.addClass(c),P.fire(e,t);break;case"dragend":w.hasClass(c)&&w.removeClass(c),P.fire(e,t);break;default:P.fire(e,t)}},init:function(){if(T=n.getConfig(),P=T.api,T.namespace=i+"-"+T.id,w=T.$el,w.addClass(i),w.addClass(T.namespace),!T.url)throw new Error("no URL given for viewer assets");/\/$/.test(T.url)||(T.url+="/"),T.url=n.getUtility("url").makeAbsolute(T.url),b(),l(),d()},destroy:function(){w.empty().removeClass(function(e,t){var n=t.match(new RegExp("crocodoc\\S+","g"));return n&&n.join(" ")}),t(x).remove(),R&&R.abort()},setLayout:function(e){var t,a=T.page,o=T.zoom||1,i=T.layout;if(S){if(e===i)return S;a=S.state.currentPage,o=S.state.zoomState}if(t=n.createComponent("layout-"+e),!t)throw new Error("Invalid layout "+e);return S&&n.destroyComponent(S),T.layout=e,S=t,S.init(),S.setZoom(o.zoomMode||o.zoom||o),E.isFn(S.scrollTo)&&S.scrollTo(a),T.currentLayout=S,n.broadcast("layoutchange",{previousLayout:i,layout:e}),S},loadAssets:function(){var e,a,o,i;R||(a=n.get("metadata"),a.then(function(e){T.metadata=e}),Z.ielt9?(x=E.insertCSS(""),T.stylesheet=x.styleSheet,e=t.when("").promise({abort:function(){}})):(e=n.get("stylesheet"),e.then(function(e){x=E.insertCSS(e),T.stylesheet=x.sheet})),!T.autoloadFirstPage||T.pageStart&&1!==T.pageStart||(U.svg?o=n.get("page-svg",1):T.conversionIsComplete&&(o=n.get("page-img",1)),T.enableTextSelection&&(i=n.get("page-text",1))),R=t.when(a,e).fail(function(e){R&&R.abort(),n.ready(),n.broadcast("asseterror",e),n.broadcast("fail",e)}).then(g).promise({abort:function(){R=null,a.abort(),e.abort(),o&&o.abort(),i&&i.abort()}}))}}}),Re})}("undefined"!=typeof window?window:this);
//# sourceMappingURL=crocodoc.viewer.min.js.map
