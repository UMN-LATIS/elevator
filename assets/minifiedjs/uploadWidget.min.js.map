{"version":3,"sources":["uploadWidget.js"],"names":["loadSidecars","fileIdElement","fileId","$","val","closest","find","html","length","rootFormField","post","basePath","data","append","updateImage","container","ajax","type","url","success","textStatus","attr","show","setTimeout","this","Math","random","get","startUpload","targetFrame","collectionId","parentElement","fileElement","isNumeric","console","log","each","prop","index","el","target","jQuery","ajaxSetup","async","addAnother","file","fileObjectId","filename","name","xhr","uploadSettings","parseJSON","internalTarget","uploadFile","format_size","num_bytes","parseInt","uploadCount","containerElement","last_update","last_uploaded","trigger","localContainer","chunkSize","fastUpload","settings","key","path","split","reverse","join","access_key","bucketKey","ajax_base","bucket","num_workers","chunk_size","content_type","max_size","on_error","prepend","on_select","fileObj","on_start","window","hide","on_progress","bytesUploaded","bytesTotal","Date","percent","width","on_init","on_complete","on_chunk_uploaded","upload","mule_upload","upload_file","resetCollection","document","on","self","bootbox","dialog","message","title","backdrop","buttons","label","className","callback","cancel","fileObjectPreview","targetElement","imageContainer","removeAttr","submitFormWithDelay","e","preventDefault","win","open","focus","ready"],"mappings":"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","file":"uploadWidget.min.js","sourcesContent":["\n\nvar format_size = function(num_bytes) {\n    if(num_bytes <= 1024 * 0.8) {\n        return num_bytes + \" B\";\n    } else if(num_bytes <= 1024 * 1024 * 0.8) {\n        return parseInt(num_bytes / 1024, 10) + \".\" + parseInt(num_bytes / 1024 * 10, 10) % 10 + \" KB\";\n    } else if(num_bytes <= 1024 * 1024 * 1024 * 0.8) {\n        return parseInt(num_bytes / 1024 / 1024, 10) + \".\" + parseInt(num_bytes / 1024 / 1024 * 10, 10) % 10 + \" MB\";\n    } else {\n        return parseInt(num_bytes / 1024 / 1024 / 1024, 10) + \".\" + parseInt(num_bytes / 1024 / 1024 / 1024 * 10, 10) % 10 + \" GB\";\n    }\n};\n\nvar uploadCount=0;\n\nvar uploadFile = function(fileElement, uploadSettings, containerElement) {\n    var last_update = null;\n    var last_uploaded = null;\n    var fileObjectId = uploadSettings.fileObjectId;\n    $(containerElement).find(\".fileObjectId\").val(fileObjectId);\n    $(containerElement).find(\".fileObjectId\").trigger('change');\n    var localContainer = containerElement;\n    var chunkSize = 6*1024*1024;\n    if(fastUpload) { // if we're in fast upload mode, use big chunks\n        chunkSize = 200*1024*1024;\n    }\n    var settings = {\n        key: uploadSettings.path + \"/\" + fileObjectId.split(\"\").reverse().join(\"\") +\"-source\",\n        access_key: uploadSettings.bucketKey,\n        ajax_base: basePath + \"uploadBackend/upload\",\n        bucket: uploadSettings.bucket,\n        collectionId: uploadSettings.collectionId,\n        num_workers: 6,\n        chunk_size: chunkSize,\n        content_type: fileElement.type,\n        max_size: 50 * (1 << 30), // 50gb\n        on_error: function() {\n            console.log(\"ERROR\");\n            $(localContainer).find(\".log\").prepend(\"Error occurred! You can help me fix this by filing a bug report here: https://github.com/cinely/mule-uploader/issues\\n\");\n        },\n        on_select: function(fileObj) {\n            $(localContainer).find(\".log\").prepend(\"File selected\\n\");\n        },\n        on_start: function(fileObj) {\n            window.uploadCount++;\n            $(localContainer).find(\".deleteFile\").hide();\n        },\n        on_progress: function(bytesUploaded, bytesTotal) {\n            if(!last_update || (new Date() - last_update) > 1000) {\n                var percent = bytesUploaded / bytesTotal * 100;\n                var speed = (bytesUploaded - last_uploaded) / (new Date() - last_update) * 1000;\n                last_update = new Date();\n                last_uploaded = bytesUploaded;\n                $(localContainer).find('.progress .progress-bar').width(percent / 100 * $(localContainer).find('.progress').width());\n                // var log = \"Upload progress: \" + format_size(bytesUploaded) + \" / \" + format_size(bytesTotal) + \" (\" + parseInt(percent, 10) + \".\" + parseInt(percent * 10, 10) % 10 + \"%)\";\n                // if(speed) {\n                //     log += \"; speed: \" + format_size(speed) + \"/s\";\n                // }\n                //$(parentElement).find(\".log\").prepend(log + \"\\n\");\n            }\n        },\n        on_init: function() {\n            //$(parentElement).find(\".log\").prepend(\"Uploader initialized\\n\");\n        },\n        on_complete: function() {\n            window.uploadCount--;\n            $.get(basePath+ 'assetManager/completeSourceFile/' + fileObjectId , function(data) {\n                $(localContainer).find(\".uploadProgress\").hide();\n            });\n            $(localContainer).find(\".cancelButton\").hide();\n            $(localContainer).find(\".deleteFile\").show();\n            $(localContainer).find(\".allowResume\").hide();\n\n        },\n        on_chunk_uploaded: function() {\n           // $(parentElement).find(\".log\").prepend(\"Chunk finished uploading\\n\");\n        }\n    };\n    upload = mule_upload(settings);\n    $(\"#collectionId\").attr(\"disabled\", true);\n    $(localContainer).find(\".uploadProgress\").show();\n    upload.upload_file(fileElement, false);\n    return upload;\n};\n\n\nvar resetCollection = function() {\n    if($(\"#collectionId\").val() != \"---\" && $(\"#collectionId\").val() !==\"\" && $(\"#collectionId\").val() != -1) {\n        $(\".uploadInformation\").show();\n        $(\".uploadWarning\").hide();\n    }\n    else {\n        $(\".uploadInformation\").hide();\n        $(\".uploadWarning\").show();\n    }\n};\n\n$(document).on(\"change\", \"#collectionId\", function() {\n    resetCollection();\n});\n\n$(document).on(\"click\", \".deleteData\", function() {\n\n    var fileId = $(this).closest(\".widgetContents\").find(\".fileObjectId\").val();\n    var self = this;\n    $.get(basePath+\"fileManager/removeData/\"+fileId,function(data) {\n        $(self).closest(\".widgetContents\").find(\".extractedData\").val(\"\");\n    });\n});\n\n$(document).on(\"click\", \".deleteFile\", function() {\n\n    var self = this;\n    bootbox.dialog({\n        message: \"Delete this upload object?  This action cannot be undone and will delete the source media and any derivatives.\",\n        title: \"Delete Object?\",\n        backdrop: true,\n        buttons: {\n            success: {\n                label: \"Delete\",\n                className: \"btn-danger\",\n                callback: function() {\n                    var fileObjectId = $(self).closest(\".widgetContents\").find(\".fileObjectId\").val();\n                    $.post(basePath+'fileManager/deleteFileObject', { fileObjectId: fileObjectId }, function(data, textStatus, xhr) {\n                        if(data == \"success\") {\n                            $(self).closest(\".widgetContents\").find(\".fileObjectId\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".fileDescription\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".extractedData\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".deleteFile\").hide();\n                            $(self).closest(\".widgetContents\").find(\".fileLabel\").html(\"Deleted\");\n                            $(\".fileObjectId\").trigger(\"change\");\n                        }\n                        else if(data == \"notfound\") {\n                            $(self).closest(\".widgetContents\").find(\".fileObjectId\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".fileDescription\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".extractedData\").val(\"\");\n                            $(\".fileObjectId\").trigger(\"change\");\n\n                        }\n                        else {\n                            bootbox.dialog({message:\"Deletion Error: please reload and try again.\"});\n\n                        }\n\n                    });\n                }\n            },\n            cancel: {\n                label: \"Cancel\",\n                className: \"btn-default\"\n            }\n        }\n    });\n\n\n});\n\nfunction loadSidecars(fileIdElement) {\n    fileId = $(fileIdElement).val();\n\n    // already have sidecars, don't load another\n    if($(fileIdElement).closest('.widgetContents').find(\".sidecars\").html().length > 0) {\n        return;\n    }\n\n    var rootFormField = $(fileIdElement).closest('.widgetContents').find(\".rootFormField\").val() + \"[sidecars]\";\n\n    $.post(basePath + 'fileManager/getSidecarViewForObject/', {fileId: fileId, rootFormField: rootFormField}, function(data) {\n        $(fileIdElement).closest('.widgetContents').find(\".sidecars\").append(data);\n    });\n\n}\n\n\nfunction updateImage(fileIdElement, container) {\n    fileId = $(fileIdElement).val();\n    $.ajax({\n            type: \"GET\",\n            fileId: fileId,\n            fileIdElement: fileIdElement,\n            container: container,\n            url: basePath + \"fileManager/previewImageAvailable/\" + fileId,\n            success: function(data, textStatus) {\n                if (data == \"false\") {\n                    // data.redirect contains the string URL to redirect to\n                    $(container).find(\"img\").attr(\"src\", \"/assets/images/processing.gif\");\n                    $(container).show();\n                    setTimeout(function() {\n                        updateImage(fileIdElement, container);\n                    }, 2000);\n                }\n                else if(data == \"true\") {\n                    $(container).find(\"img\").attr(\"src\", basePath + \"fileManager/previewImageByFileId/\" + this.fileId + \"?\" + Math.random());\n\n                    $.get(basePath+\"fileManager/extractedData/\"+this.fileId,function(data) {\n                        $(container).closest(\".widgetContents\").find(\".extractedData\").val(data);\n                    });\n\n                    $(container).show();\n                }\n                else if(data == \"icon\") {\n                    // if it's an icon, we say true but keep polling\n                    $(container).find(\"img\").attr(\"src\", basePath + \"fileManager/previewImageByFileId/\" + this.fileId);\n                    $(container).show();\n                    setTimeout(function() {\n                        updateImage(fileIdElement, container);\n                    }, 5000);\n                }\n            }\n        });\n}\n\nvar fileObjectPreview = function(targetElement) {\n    var imageContainer = $(targetElement).closest(\".widgetContents\").find(\".imagePreview\");\n    if($(targetElement).val().length>0) {\n        $(\"#collectionId\").attr(\"disabled\", true);\n        $(targetElement).closest('.widgetContents').find(\".file\").attr(\"disabled\", true);\n        var self = targetElement;\n        updateImage(self,imageContainer);\n        loadSidecars(self);\n    }\n    else {\n        // we emptied the fileObject, let's clear things out.\n        $(targetElement).closest('.widgetContents').find(\".file\").removeAttr(\"disabled\");\n        $(\"#collectionId\").removeAttr(\"disabled\");\n        $(imageContainer).hide();\n    }\n};\n\n\n$(document).on(\"change\", \".fileObjectId\", function() {\n    fileObjectPreview(this);\n    if($(this).val() !== \"\") {\n        submitFormWithDelay(true);\n    }\n    // force a save when the fileobjectId changes\n\n});\n\n$(document).on(\"click\", \".processingLogs\", function(e) {\n     e.preventDefault();\n    var parentElement = $(this).closest(\".widgetContents\");\n    var fileObjectId = $(parentElement).find(\".fileObjectId\").val();\n    var win = window.open(basePath + \"assetManager/processingLogsForAsset/\" + fileObjectId, '_blank');\n    if(win){\n        //Browser has allowed it to be opened\n        win.focus();\n    }\n\n});\n\n$(document).ready(function(){\n    $( \"#collectionId\" ).trigger( \"change\" );\n    $(\".file\").trigger(\"change\");\n    $(\".fileObjectId\").each(function(index, el) {\n        // load previews for all our file objects\n        fileObjectPreview(el);\n\n        if($(el).val() !== \"\") {\n            $(\".deleteFile\").show();\n        }\n\n    });\n\n\n\n    if($(\".allowResume\").length > 0) {\n        $(\".allowResume\").each(function() {\n\n            $(this).closest(\".widgetContents\").find(\".file\").removeAttr(\"disabled\");\n            $(this).closest(\".widgetContents\").find(\".startbutton\").removeAttr(\"disabled\");\n\n        });\n    }\n\n});\n\n$(document).on(\"change\", \".file\", function() {\n    if($(this).val() !== \"\") {\n        $(this).closest(\".widgetContents\").find(\".cancelButton\").show();\n        startUpload(this);\n    }\n    else {\n        $(this).closest(\".widgetContents\").find(\".cancelButton\").hide();\n    }\n\n});\n\n$(document).on(\"click\", \".cancelButton\", function() {\n    var parentElement = $(this).closest(\".widgetContents\");\n    var fileElement = $(parentElement).find(\".file\");\n    var upload = $(fileElement).data(\"uploader\");\n    upload.cancel();\n    window.uploadCount--;\n    $.get(basePath+ 'assetManager/cancelSourceFile/' + $(parentElement).find(\".fileObjectId\").val() , function(data) {\n        $(parentElement).find(\".uploadProgress\").hide();\n    });\n    $(parentElement).find(\".cancelButton\").hide();\n    $(parentElement).find(\".fileObjectId\").val(\"\");\n    $(this).hide();\n    $(fileElement).removeAttr(\"disabled\");\n\n});\n\nfunction startUpload(targetFrame) {\n    // only get the first file for now\n    var collectionId = $(\"#collectionId\").val();\n    var parentElement = $(targetFrame).closest(\".widgetContentsContainer\");\n    var fileElement = $(parentElement).find(\".file\");\n\n    if(!$.isNumeric(collectionId)) {\n        //TODO\n        console.log(\"error\");\n    }\n\n    $.each($(fileElement).prop(\"files\"), function(index, el) {\n        var target = null;\n        if(index === 0) { //operate on the real one\n            target = parentElement;\n        }\n        else {\n            jQuery.ajaxSetup({async:false}); // run sync so we wait for the next element\n            target = addAnother(targetFrame);\n            $(target).find(\".cancelButton\").show();\n        }\n        var file = el;\n        var internalTarget = target;\n        fileObjectId = $(target).find(\".fileObjectId\").val();\n        jQuery.ajaxSetup({async:true});\n        $.post(basePath+ 'assetManager/getFileContainer', {collectionId: collectionId, filename: file.name, fileObjectId: fileObjectId}, function(data, textStatus, xhr) {\n            uploadSettings = $.parseJSON(data);\n            var internalTarget = target;\n\n            $(fileElement).data('uploader', uploadFile(file, uploadSettings, internalTarget));\n\n        });\n\n\n    });\n    return;\n\n\n\n\n}\n"],"sourceRoot":"/source/"}