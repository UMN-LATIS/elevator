{"version":3,"sources":["uploadWidget.js"],"names":["format_size","num_bytes","parseInt","uploadCount","uploadFile","fileElement","uploadSettings","containerElement","last_update","fileObjectId","$","find","val","trigger","localContainer","chunkSize","fastUpload","settings","key","path","split","reverse","join","access_key","bucketKey","ajax_base","basePath","bucket","collectionId","num_workers","chunk_size","content_type","type","max_size","on_error","console","log","prepend","on_select","fileObj","on_start","window","hide","on_progress","bytesUploaded","bytesTotal","Date","percent","width","on_init","on_complete","get","data","show","on_chunk_uploaded","upload","mule_upload","attr","upload_file","resetCollection","loadSidecars","fileIdElement","fileId","closest","html","length","rootFormField","post","append","updateImage","container","ajax","url","success","textStatus","setTimeout","this","Math","random","document","on","self","bootbox","dialog","message","title","backdrop","buttons","label","className","callback","xhr","cancel","fileObjectPreview","targetElement","imageContainer","removeAttr","startUpload","targetFrame","parentElement","isNumeric","each","prop","index","el","target","jQuery","ajaxSetup","async","addAnother","file","filename","name","parseJSON","internalTarget","submitFormWithDelay","e","preventDefault","win","open","focus","ready"],"mappings":"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","file":"uploadWidget.min.js","sourcesContent":["\n\nvar format_size = function(num_bytes) {\n    if(num_bytes <= 1024 * 0.8) {\n        return num_bytes + \" B\";\n    } else if(num_bytes <= 1024 * 1024 * 0.8) {\n        return parseInt(num_bytes / 1024, 10) + \".\" + parseInt(num_bytes / 1024 * 10, 10) % 10 + \" KB\";\n    } else if(num_bytes <= 1024 * 1024 * 1024 * 0.8) {\n        return parseInt(num_bytes / 1024 / 1024, 10) + \".\" + parseInt(num_bytes / 1024 / 1024 * 10, 10) % 10 + \" MB\";\n    } else {\n        return parseInt(num_bytes / 1024 / 1024 / 1024, 10) + \".\" + parseInt(num_bytes / 1024 / 1024 / 1024 * 10, 10) % 10 + \" GB\";\n    }\n};\n\nvar uploadCount=0;\n\nvar uploadFile = function(fileElement, uploadSettings, containerElement) {\n    var last_update = null;\n    var last_uploaded = null;\n    var fileObjectId = uploadSettings.fileObjectId;\n    $(containerElement).find(\".fileObjectId\").val(fileObjectId);\n    $(containerElement).find(\".fileObjectId\").trigger('change');\n    var localContainer = containerElement;\n    var chunkSize = 6*1024*1024;\n    if(fastUpload) { // if we're in fast upload mode, use big chunks\n        chunkSize = 200*1024*1024;\n    }\n    var settings = {\n        key: uploadSettings.path + \"/\" + fileObjectId.split(\"\").reverse().join(\"\") +\"-source\",\n        access_key: uploadSettings.bucketKey,\n        ajax_base: basePath + \"uploadBackend/upload\",\n        bucket: uploadSettings.bucket,\n        collectionId: uploadSettings.collectionId,\n        num_workers: 6,\n        chunk_size: chunkSize,\n        content_type: fileElement.type,\n        max_size: 50 * (1 << 30), // 50gb\n        on_error: function() {\n            console.log(\"ERROR\");\n            $(localContainer).find(\".log\").prepend(\"Error occurred! You can help me fix this by filing a bug report here: https://github.com/cinely/mule-uploader/issues\\n\");\n        },\n        on_select: function(fileObj) {\n            $(localContainer).find(\".log\").prepend(\"File selected\\n\");\n        },\n        on_start: function(fileObj) {\n            window.uploadCount++;\n            $(localContainer).find(\".deleteFile\").hide();\n        },\n        on_progress: function(bytesUploaded, bytesTotal) {\n            if(!last_update || (new Date() - last_update) > 1000) {\n                var percent = bytesUploaded / bytesTotal * 100;\n                var speed = (bytesUploaded - last_uploaded) / (new Date() - last_update) * 1000;\n                last_update = new Date();\n                last_uploaded = bytesUploaded;\n                $(localContainer).find('.progress .progress-bar').width(percent / 100 * $(localContainer).find('.progress').width());\n                // var log = \"Upload progress: \" + format_size(bytesUploaded) + \" / \" + format_size(bytesTotal) + \" (\" + parseInt(percent, 10) + \".\" + parseInt(percent * 10, 10) % 10 + \"%)\";\n                // if(speed) {\n                //     log += \"; speed: \" + format_size(speed) + \"/s\";\n                // }\n                //$(parentElement).find(\".log\").prepend(log + \"\\n\");\n            }\n        },\n        on_init: function() {\n            //$(parentElement).find(\".log\").prepend(\"Uploader initialized\\n\");\n        },\n        on_complete: function() {\n            window.uploadCount--;\n            $.get(basePath+ 'assetManager/completeSourceFile/' + fileObjectId , function(data) {\n                $(localContainer).find(\".uploadProgress\").hide();\n            });\n            $(localContainer).find(\".cancelButton\").hide();\n            $(localContainer).find(\".deleteFile\").show();\n            $(localContainer).find(\".allowResume\").hide();\n\n        },\n        on_chunk_uploaded: function() {\n           // $(parentElement).find(\".log\").prepend(\"Chunk finished uploading\\n\");\n        }\n    };\n    upload = mule_upload(settings);\n    $(\"#collectionId\").attr(\"disabled\", true);\n    $(localContainer).find(\".uploadProgress\").show();\n    upload.upload_file(fileElement, false);\n    return upload;\n};\n\n\nvar resetCollection = function() {\n    if($(\"#collectionId\").val() != \"---\" && $(\"#collectionId\").val() !==\"\" && $(\"#collectionId\").val() != -1) {\n        $(\".uploadInformation\").show();\n        $(\".uploadWarning\").hide();\n    }\n    else {\n        $(\".uploadInformation\").hide();\n        $(\".uploadWarning\").show();\n    }\n};\n\n$(document).on(\"change\", \"#collectionId\", function() {\n    resetCollection();\n});\n\n$(document).on(\"click\", \".deleteData\", function() {\n\n    var fileId = $(this).closest(\".widgetContents\").find(\".fileObjectId\").val();\n    var self = this;\n    $.get(basePath+\"fileManager/removeData/\"+fileId,function(data) {\n        $(self).closest(\".widgetContents\").find(\".extractedData\").val(\"\");\n    });\n});\n\n$(document).on(\"click\", \".deleteFile\", function() {\n\n    var self = this;\n    bootbox.dialog({\n        message: \"Delete this upload object?  This action cannot be undone and will delete the source media and any derivatives.\",\n        title: \"Delete Object?\",\n        backdrop: true,\n        buttons: {\n            success: {\n                label: \"Delete\",\n                className: \"btn-danger\",\n                callback: function() {\n                    var fileObjectId = $(self).closest(\".widgetContents\").find(\".fileObjectId\").val();\n                    $.post(basePath+'fileManager/deleteFileObject', { fileObjectId: fileObjectId }, function(data, textStatus, xhr) {\n                        if(data == \"success\") {\n                            $(self).closest(\".widgetContents\").find(\".fileObjectId\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".fileDescription\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".extractedData\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".deleteFile\").hide();\n                            $(self).closest(\".widgetContents\").find(\".fileLabel\").html(\"Deleted\");\n                            $(\".fileObjectId\").trigger(\"change\");\n                        }\n                        else if(data == \"notfound\") {\n                            $(self).closest(\".widgetContents\").find(\".fileObjectId\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".fileDescription\").val(\"\");\n                            $(self).closest(\".widgetContents\").find(\".extractedData\").val(\"\");\n                            $(\".fileObjectId\").trigger(\"change\");\n\n                        }\n                        else {\n                            bootbox.dialog({message:\"Deletion Error: please reload and try again.\"});\n\n                        }\n\n                    });\n                }\n            },\n            cancel: {\n                label: \"Cancel\",\n                className: \"btn-default\"\n            }\n        }\n    });\n\n\n});\n\nfunction loadSidecars(fileIdElement) {\n    fileId = $(fileIdElement).val();\n\n    // already have sidecars, don't load another\n    if($(fileIdElement).closest('.widgetContents').find(\".sidecars\").html().length > 0) {\n        return;\n    }\n\n    var rootFormField = $(fileIdElement).closest('.widgetContents').find(\".rootFormField\").val() + \"[sidecars]\";\n\n    $.post(basePath + 'fileManager/getSidecarViewForObject/', {fileId: fileId, rootFormField: rootFormField}, function(data) {\n        $(fileIdElement).closest('.widgetContents').find(\".sidecars\").append(data);\n    });\n\n}\n\n\nfunction updateImage(fileIdElement, container) {\n    fileId = $(fileIdElement).val();\n    $.ajax({\n            type: \"GET\",\n            fileId: fileId,\n            fileIdElement: fileIdElement,\n            container: container,\n            url: basePath + \"fileManager/previewImageAvailable/\" + fileId,\n            success: function(data, textStatus) {\n                if (data == \"false\") {\n                    // data.redirect contains the string URL to redirect to\n                    $(container).find(\"img\").attr(\"src\", \"/assets/images/processing.gif\");\n                    $(container).show();\n                    setTimeout(function() {\n                        updateImage(fileIdElement, container);\n                    }, 2000);\n                }\n                else if(data == \"true\") {\n                    $(container).find(\"img\").attr(\"src\", basePath + \"fileManager/previewImageByFileId/\" + this.fileId + \"?\" + Math.random());\n\n                    $.get(basePath+\"fileManager/extractedData/\"+this.fileId,function(data) {\n                        $(container).closest(\".widgetContents\").find(\".extractedData\").val(data);\n                    });\n\n                    $(container).show();\n                }\n                else if(data == \"icon\") {\n                    // if it's an icon, we say true but keep polling\n                    $(container).find(\"img\").attr(\"src\", basePath + \"fileManager/previewImageByFileId/\" + this.fileId);\n                    $(container).show();\n                    setTimeout(function() {\n                        updateImage(fileIdElement, container);\n                    }, 5000);\n                }\n            }\n        });\n}\n\nvar fileObjectPreview = function(targetElement) {\n    var imageContainer = $(targetElement).closest(\".widgetContents\").find(\".imagePreview\");\n    if($(targetElement).val().length>0) {\n        $(\"#collectionId\").attr(\"disabled\", true);\n        $(targetElement).closest('.widgetContents').find(\".file\").attr(\"disabled\", true);\n        var self = targetElement;\n        updateImage(self,imageContainer);\n        loadSidecars(self);\n    }\n    else {\n        // we emptied the fileObject, let's clear things out.\n        $(targetElement).closest('.widgetContents').find(\".file\").removeAttr(\"disabled\");\n        $(\"#collectionId\").removeAttr(\"disabled\");\n        $(imageContainer).hide();\n    }\n};\n\n\n$(document).on(\"change\", \".fileObjectId\", function() {\n    fileObjectPreview(this);\n    if($(this).val() !== \"\") {\n        submitFormWithDelay(true);\n    }\n    // force a save when the fileobjectId changes\n\n});\n\n$(document).on(\"click\", \".processingLogs\", function(e) {\n     e.preventDefault();\n    var parentElement = $(this).closest(\".widgetContents\");\n    var fileObjectId = $(parentElement).find(\".fileObjectId\").val();\n    var win = window.open(basePath + \"assetManager/processingLogsForAsset/\" + fileObjectId, '_blank');\n    if(win){\n        //Browser has allowed it to be opened\n        win.focus();\n    }\n\n});\n\n$(document).ready(function(){\n    $( \"#collectionId\" ).trigger( \"change\" );\n    $(\".file\").trigger(\"change\");\n    $(\".fileObjectId\").each(function(index, el) {\n        // load previews for all our file objects\n        fileObjectPreview(el);\n\n        if($(el).val() !== \"\") {\n            $(el).closest(\".widgetContents\").find(\".deleteFile\").show();\n        }\n\n    });\n\n\n\n    if($(\".allowResume\").length > 0) {\n        $(\".allowResume\").each(function() {\n\n            $(this).closest(\".widgetContents\").find(\".file\").removeAttr(\"disabled\");\n            $(this).closest(\".widgetContents\").find(\".startbutton\").removeAttr(\"disabled\");\n\n        });\n    }\n\n});\n\n$(document).on(\"change\", \".file\", function() {\n    if($(this).val() !== \"\") {\n        $(this).closest(\".widgetContents\").find(\".cancelButton\").show();\n        startUpload(this);\n    }\n    else {\n        $(this).closest(\".widgetContents\").find(\".cancelButton\").hide();\n    }\n\n});\n\n$(document).on(\"click\", \".cancelButton\", function() {\n    var parentElement = $(this).closest(\".widgetContents\");\n    var fileElement = $(parentElement).find(\".file\");\n    var upload = $(fileElement).data(\"uploader\");\n    upload.cancel();\n    window.uploadCount--;\n    $.get(basePath+ 'assetManager/cancelSourceFile/' + $(parentElement).find(\".fileObjectId\").val() , function(data) {\n        $(parentElement).find(\".uploadProgress\").hide();\n    });\n    $(parentElement).find(\".cancelButton\").hide();\n    $(parentElement).find(\".fileObjectId\").val(\"\");\n    $(this).hide();\n    $(fileElement).removeAttr(\"disabled\");\n\n});\n\nfunction startUpload(targetFrame) {\n    // only get the first file for now\n    var collectionId = $(\"#collectionId\").val();\n    var parentElement = $(targetFrame).closest(\".widgetContentsContainer\");\n    var fileElement = $(parentElement).find(\".file\");\n\n    if(!$.isNumeric(collectionId)) {\n        //TODO\n        console.log(\"error\");\n    }\n\n    $.each($(fileElement).prop(\"files\"), function(index, el) {\n        var target = null;\n        if(index === 0) { //operate on the real one\n            target = parentElement;\n        }\n        else {\n            jQuery.ajaxSetup({async:false}); // run sync so we wait for the next element\n            target = addAnother(targetFrame);\n            $(target).find(\".cancelButton\").show();\n        }\n        var file = el;\n        var internalTarget = target;\n        fileObjectId = $(target).find(\".fileObjectId\").val();\n        jQuery.ajaxSetup({async:true});\n        $.post(basePath+ 'assetManager/getFileContainer', {collectionId: collectionId, filename: file.name, fileObjectId: fileObjectId}, function(data, textStatus, xhr) {\n            uploadSettings = $.parseJSON(data);\n            var internalTarget = target;\n\n            $(fileElement).data('uploader', uploadFile(file, uploadSettings, internalTarget));\n\n        });\n\n\n    });\n    return;\n\n\n\n\n}\n"]}