(function(){var e,t={}.hasOwnProperty,r=[].slice;null!=(null!=(e=this.google)?e.maps:void 0)&&(this.OverlappingMarkerSpiderfier=function(){function e(e,r){var n,s,l,a,o,h;this.map=e,null==r&&(r={});for(s in r)t.call(r,s)&&(h=r[s],this[s]=h);for(this.projHelper=new this.constructor.ProjHelper(this.map),this.initMarkerArrays(),this.listeners={},o=["click","zoom_changed","maptypeid_changed"],l=0,a=o.length;a>l;l++)n=o[l],i.addListener(this.map,n,function(e){return function(){return e.unspiderfy()}}(this))}var i,n,s,l,a,o,h,u,p,g,f;for(u=e.prototype,p=[e,u],s=0,o=p.length;o>s;s++)f=p[s],f.VERSION="0.3.3";return n=google.maps,i=n.event,h=n.MapTypeId,g=2*Math.PI,u.keepSpiderfied=!1,u.markersWontHide=!1,u.markersWontMove=!1,u.nearbyDistance=20,u.circleSpiralSwitchover=9,u.circleFootSeparation=23,u.circleStartAngle=g/12,u.spiralFootSeparation=26,u.spiralLengthStart=11,u.spiralLengthFactor=4,u.spiderfiedZIndex=1e3,u.usualLegZIndex=10,u.highlightedLegZIndex=20,u.legWeight=1.5,u.legColors={usual:{},highlighted:{}},a=u.legColors.usual,l=u.legColors.highlighted,a[h.HYBRID]=a[h.SATELLITE]="#fff",l[h.HYBRID]=l[h.SATELLITE]="#f00",a[h.TERRAIN]=a[h.ROADMAP]="#444",l[h.TERRAIN]=l[h.ROADMAP]="#f00",u.initMarkerArrays=function(){return this.markers=[],this.markerListenerRefs=[]},u.addMarker=function(e){var t;return null!=e._oms?this:(e._oms=!0,t=[i.addListener(e,"click",function(t){return function(r){return t.spiderListener(e,r)}}(this))],this.markersWontHide||t.push(i.addListener(e,"visible_changed",function(t){return function(){return t.markerChangeListener(e,!1)}}(this))),this.markersWontMove||t.push(i.addListener(e,"position_changed",function(t){return function(){return t.markerChangeListener(e,!0)}}(this))),this.markerListenerRefs.push(t),this.markers.push(e),this)},u.markerChangeListener=function(e,t){return null==e._omsData||!t&&e.getVisible()||null!=this.spiderfying||null!=this.unspiderfying?void 0:this.unspiderfy(t?e:null)},u.getMarkers=function(){return this.markers.slice(0)},u.removeMarker=function(e){var t,r,n,s,l;if(null!=e._omsData&&this.unspiderfy(),t=this.arrIndexOf(this.markers,e),0>t)return this;for(l=this.markerListenerRefs.splice(t,1)[0],r=0,n=l.length;n>r;r++)s=l[r],i.removeListener(s);return delete e._oms,this.markers.splice(t,1),this},u.clearMarkers=function(){var e,t,r,n,s,l,a,o,h;for(this.unspiderfy(),h=this.markers,e=t=0,r=h.length;r>t;e=++t){for(a=h[e],l=this.markerListenerRefs[e],o=0,n=l.length;n>o;o++)s=l[o],i.removeListener(s);delete a._oms}return this.initMarkerArrays(),this},u.addListener=function(e,t){var r;return(null!=(r=this.listeners)[e]?r[e]:r[e]=[]).push(t),this},u.removeListener=function(e,t){var r;return r=this.arrIndexOf(this.listeners[e],t),0>r||this.listeners[e].splice(r,1),this},u.clearListeners=function(e){return this.listeners[e]=[],this},u.trigger=function(){var e,t,i,n,s,l,a,o;for(t=arguments[0],e=2<=arguments.length?r.call(arguments,1):[],a=null!=(l=this.listeners[t])?l:[],o=[],n=0,s=a.length;s>n;n++)i=a[n],o.push(i.apply(null,e));return o},u.generatePtsCircle=function(e,t){var r,i,s,l,a,o,h,u;for(s=this.circleFootSeparation*(2+e),o=s/g,i=g/e,u=[],l=a=0,h=e;h>=0?h>a:a>h;l=h>=0?++a:--a)r=this.circleStartAngle+l*i,u.push(new n.Point(t.x+o*Math.cos(r),t.y+o*Math.sin(r)));return u},u.generatePtsSpiral=function(e,t){var r,i,s,l,a,o,h;for(l=this.spiralLengthStart,r=0,h=[],i=s=0,o=e;o>=0?o>s:s>o;i=o>=0?++s:--s)r+=this.spiralFootSeparation/l+5e-4*i,a=new n.Point(t.x+l*Math.cos(r),t.y+l*Math.sin(r)),l+=g*this.spiralLengthFactor/r,h.push(a);return h},u.spiderListener=function(e,t){var r,i,n,s,l,a,o,h,u,p,g;if(a=null!=e._omsData,a&&this.keepSpiderfied||this.unspiderfy(),a||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",e,t);for(h=[],u=[],o=this.nearbyDistance,p=o*o,l=this.llToPt(e.position),g=this.markers,r=0,i=g.length;i>r;r++)n=g[r],null!=n.map&&n.getVisible()&&(s=this.llToPt(n.position),this.ptDistanceSq(s,l)<p?h.push({marker:n,markerPt:s}):u.push(n));return 1===h.length?this.trigger("click",e,t):this.spiderfy(h,u)},u.markersNearMarker=function(e,t){var r,i,n,s,l,a,o,h,u,p,g;if(null==t&&(t=!1),null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";for(o=this.nearbyDistance,h=o*o,l=this.llToPt(e.position),a=[],u=this.markers,r=0,i=u.length;i>r&&(n=u[r],!(n!==e&&null!=n.map&&n.getVisible()&&(s=this.llToPt(null!=(p=null!=(g=n._omsData)?g.usualPosition:void 0)?p:n.position),this.ptDistanceSq(s,l)<h&&(a.push(n),t))));r++);return a},u.markersNearAnyOtherMarker=function(){var e,t,r,i,n,s,l,a,o,h,u,p,g,f,c,d,m,k,y,v,L;if(null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";for(c=this.nearbyDistance,d=c*c,g=function(){var e,t,r,i,n,s;for(r=this.markers,s=[],e=0,t=r.length;t>e;e++)a=r[e],s.push({pt:this.llToPt(null!=(i=null!=(n=a._omsData)?n.usualPosition:void 0)?i:a.position),willSpiderfy:!1});return s}.call(this),k=this.markers,t=i=0,n=k.length;n>i;t=++i)if(o=k[t],null!=o.map&&o.getVisible()&&(h=g[t],!h.willSpiderfy))for(y=this.markers,r=f=0,s=y.length;s>f;r=++f)if(u=y[r],r!==t&&null!=u.map&&u.getVisible()&&(p=g[r],(!(t>r)||p.willSpiderfy)&&this.ptDistanceSq(h.pt,p.pt)<d)){h.willSpiderfy=p.willSpiderfy=!0;break}for(v=this.markers,L=[],e=m=0,l=v.length;l>m;e=++m)a=v[e],g[e].willSpiderfy&&L.push(a);return L},u.makeHighlightListenerFuncs=function(e){return{highlight:function(t){return function(){return e._omsData.leg.setOptions({strokeColor:t.legColors.highlighted[t.map.mapTypeId],zIndex:t.highlightedLegZIndex})}}(this),unhighlight:function(t){return function(){return e._omsData.leg.setOptions({strokeColor:t.legColors.usual[t.map.mapTypeId],zIndex:t.usualLegZIndex})}}(this)}},u.spiderfy=function(e,t){var r,s,l,a,o,h,u,p,g,f,c;return this.spiderfying=!0,f=e.length,r=this.ptAverage(function(){var t,r,i;for(i=[],t=0,r=e.length;r>t;t++)p=e[t],i.push(p.markerPt);return i}()),a=f>=this.circleSpiralSwitchover?this.generatePtsSpiral(f,r).reverse():this.generatePtsCircle(f,r),c=function(){var t,r,p;for(p=[],t=0,r=a.length;r>t;t++)l=a[t],s=this.ptToLl(l),g=this.minExtract(e,function(e){return function(t){return e.ptDistanceSq(t.markerPt,l)}}(this)),u=g.marker,h=new n.Polyline({map:this.map,path:[u.position,s],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),u._omsData={usualPosition:u.position,leg:h},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(o=this.makeHighlightListenerFuncs(u),u._omsData.hightlightListeners={highlight:i.addListener(u,"mouseover",o.highlight),unhighlight:i.addListener(u,"mouseout",o.unhighlight)}),u.setPosition(s),u.setZIndex(Math.round(this.spiderfiedZIndex+l.y)),p.push(u);return p}.call(this),delete this.spiderfying,this.spiderfied=!0,this.trigger("spiderfy",c,t)},u.unspiderfy=function(e){var t,r,n,s,l,a,o;if(null==e&&(e=null),null==this.spiderfied)return this;for(this.unspiderfying=!0,o=[],l=[],a=this.markers,t=0,r=a.length;r>t;t++)s=a[t],null!=s._omsData?(s._omsData.leg.setMap(null),s!==e&&s.setPosition(s._omsData.usualPosition),s.setZIndex(null),n=s._omsData.hightlightListeners,null!=n&&(i.removeListener(n.highlight),i.removeListener(n.unhighlight)),delete s._omsData,o.push(s)):l.push(s);return delete this.unspiderfying,delete this.spiderfied,this.trigger("unspiderfy",o,l),this},u.ptDistanceSq=function(e,t){var r,i;return r=e.x-t.x,i=e.y-t.y,r*r+i*i},u.ptAverage=function(e){var t,r,i,s,l,a;for(l=a=0,t=0,r=e.length;r>t;t++)s=e[t],l+=s.x,a+=s.y;return i=e.length,new n.Point(l/i,a/i)},u.llToPt=function(e){return this.projHelper.getProjection().fromLatLngToDivPixel(e)},u.ptToLl=function(e){return this.projHelper.getProjection().fromDivPixelToLatLng(e)},u.minExtract=function(e,t){var r,i,n,s,l,a,o;for(n=l=0,a=e.length;a>l;n=++l)s=e[n],o=t(s),("undefined"==typeof r||null===r||i>o)&&(i=o,r=n);return e.splice(r,1)[0]},u.arrIndexOf=function(e,t){var r,i,n,s;if(null!=e.indexOf)return e.indexOf(t);for(r=i=0,n=e.length;n>i;r=++i)if(s=e[r],s===t)return r;return-1},e.ProjHelper=function(e){return this.setMap(e)},e.ProjHelper.prototype=new n.OverlayView,e.ProjHelper.prototype.draw=function(){},e}())}).call(this);
//# sourceMappingURL=oms.min.js.map
