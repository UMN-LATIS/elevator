{"version":3,"sources":["search.js","searchForm.js"],"names":["MarkerSource","MarkerTemplate","TimelineTemplate","currentPageNumber","eventSource","cachedResults","cachedDates","searchId","resultsAvailable","previousEventComplete","dataAvailable","disableHashChange","totalResults","getCurrentSearchId","currentURL","window","location","href","replace","hash","currentHash","length","history","pushState","substr","lastIndexOf","parseSearch","resetSearchFrame","localLoadAll","loadAll","doSearch","loadCollectionHeader","$","val","get","basePath","data","html","pageNumber","ignoreResults","oldMatches","oldResults","matches","searchResults","parseJSON","e","alert","success","objectId","cookie","path","pathname","totalLoadedCount","processSearchResults","newArray","merge","parent","hasClass","prepMap","prepTimeline","populateSearchFields","searchEntry","populateSearchResults","getSuggestions","searchTerm","localSearch","post","textStatus","resultArray","each","index","value","reg","RegExp","search","addClass","append","italics","insert","empty","prop","searchText","sort","Array","isArray","targetField","internalIndex","internalValue","newField","clone","appendTo","remove","targetText","text","searchObject","source","targetTemplate","template","Handlebars","compile","listSource","listTemplate","listTemplateCompiled","base_url","listHTML","isChild","hasChildren","fileAssets","i","primaryHandlerId","show","hide","prepGallery","event","Event","document","dispatchEvent","ready","htmlEntities","str","String","scroll","height","scrollTop","on","find","trigger","TimelineSource","tab","target","attr","preventDefault","embedPath","protocol","hostname","iFrameContent","embedContent","bootbox","dialog","title","message","buttons","label","className","this","submit","performSearchForButtonPress","first","galleryFrame","el","primaryHandler","parsed","fileIds","key","newIds","map","nestedElem","hasOwnProperty","fileId","filter","elem","concat","relatedAssetCache","element","push","targetElement","children","sourceFrame","$wrap","Sly","horizontal","itemNav","keyboardNavBy","smart","activateMiddle","activateOn","mouseDragging","touchDragging","releaseSwing","startAt","scrollBar","scrollBy","speed","elasticBounds","easing","dragHandle","dynamicHandle","clickBar","prev","next","init","item","loadGalleryElement","targetItem","items","loadNestedAssets","markers","clearLayers","loadMap","L","markerClusterGroup","showCoverageOnHover","locations","index2","value2","entries","index3","value3","loc","coordinates","localMarker","marker","bindPopup","addLayer","fitBounds","getBounds","pad","compiledDate","geoTime","match","events","dates","date","dateAsset","startTime","parseInt","start","newItem","start_date","startYear","Math","round","abs","year","t","Date","setSeconds","formattedStart","utc","create","display_date","getFullYear","month","getMonth","day","getDay","end","toString","end_date","endTime","endYear","formattedEnd","newElement","headline","media","thumb","primaryHandlerThumbnail2x","url","ignoreItem","existingDate","JSON","stringify","scale","injectStyles","TL","Timeline","timenav_position","timenav_height_percentage","rule","id","fullscreen","isNativelySupported","toggleClass","select","destroy","specificSearch","closest","newSpecificSearch","after","collectionCopy","newCollection","selectedOption","content","templateId","targetGroup","fieldTitle","xhr","results","console","log","type","selectElement","values","targetForm","searchQuery","serializeForm","oldSearchId","setTimeout","modal"],"mappings":"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","file":"searchMaster.min.js","sourcesContent":["\nvar MarkerSource;\nvar MarkerTemplate;\nvar TimelineTemplate;\nvar TimelineTemplate;\nvar cachedResults = \"\";\nvar cachedDates = null;\nvar searchId = null;\nvar currentPageNumber;\nvar eventSource;\nvar resultsAvailable = true;\nvar previousEventComplete = true;\nvar dataAvailable = true;\nvar disableHashChange = false;\nvar totalResults = 0;\n$(document).ready(function() {\n\n\t$(window).scroll(function(){\n\t\tif (resultsAvailable && $(document).height() - 50 <= $(window).scrollTop() + $(window).height()) {\n\t\t\tif(($('.nav-tabs .active').text() == \"Grid\" || $('.nav-tabs .active').text() == \"List\") && previousEventComplete && dataAvailable) {\n\t\t\t\tdoSearch(searchId, currentPageNumber+1);\n\t\t\t}\n\t\t}\n\t});\n\n\t$(\".searchText\").on(\"blur\", function() {\n\t\t$(\".advancedSearchText\").val($(\".searchText\").val());\n\t});\n\n\t$(\".advancedSearchText\").on(\"blur\", function() {\n\t\t$(\".searchText\").val($(\".advancedSearchText\").val());\n\t});\n\n\t$('a[href=\"#timeline\"]').on('shown.bs.tab', function() {\n\t\tcachedDates = null;\n\t\tprepTimeline();\n\t});\n\t$('a[href=\"#map\"]').on('shown.bs.tab', function() {\n\t\tprepMap();\n\t});\n\t$('a[href=\"#gallery\"]').on('shown.bs.tab', function() {\n\t\tprepGallery();\n\t});\n\t$('a[href=\"#grid\"]').on('shown.bs.tab', function() {\n\t\t$(\"#results\").find(\"img\").trigger(\"show\");\n\t});\n\t$('a[href=\"#list\"]').on('shown.bs.tab', function() {\n\t\t$(\"#listResults\").find(\"img\").trigger(\"show\");\n\t});\n\n\n\n\n\t$(\".previousPage\").on(\"click\",function() {\n\t\tdoSearch(searchId, currentPageNumber-1);\n\t\treturn false;\n\t});\n\n\t$(\".nextPage\").on(\"click\",function() {\n\t\tdoSearch(searchId, currentPageNumber+1);\n\t\treturn false;\n\t});\n\n\n\tMarkerSource   = $(\"#marker-template\").html();\n\tMarkerTemplate = Handlebars.compile(MarkerSource);\n\n\tTimelineSource   = $(\"#timeline-template\").html();\n\tTimelineTemplate = Handlebars.compile(TimelineSource);\n\n\n\tif (location.hash !== '')  {\n\t\t$('a[href=\"' + location.hash + '\"]').tab('show');\n\t}\n\n    // remember the hash in the URL without jumping\n    $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function(e) {\n       if(history.pushState) {\n            history.pushState(null, null, '#'+$(e.target).attr('href').substr(1));\n       } else {\n            location.hash = '#'+$(e.target).attr('href').substr(1);\n       }\n    });\n\n    function htmlEntities(str) {\n    \treturn String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\t}\n\n    $(\".embedMap\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath = window.location.protocol + \"//\" + window.location.hostname + basePath + \"search/map/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this map\",\n\t\t\tmessage: \"Use the HTML below to embed this map in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    });\n\n    $(\".embedTimeline\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath = window.location.protocol + \"//\" + window.location.hostname + basePath + \"search/timeline/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this timeline\",\n\t\t\tmessage: \"Use the HTML below to embed this timeline in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    });\n\n    $(\".embedGallery\").on(\"click\", function(e) {\n    \te.preventDefault();\n    \tembedPath = window.location.protocol + \"//\" + window.location.hostname + basePath + \"search/gallery/\" + getCurrentSearchId();\n\n    \tiFrameContent = '<iframe width=\"640\" height=\"480\" src=\"' +embedPath + '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n    \tembedContent = '<input size=50 class=\"embedControl\" value=\"' + htmlEntities(iFrameContent) + '\"\">';\n\n    \tbootbox.dialog(\n\t\t{\n\t\t\ttitle: \"Embed this gallery\",\n\t\t\tmessage: \"Use the HTML below to embed this gallery in another page: <br>\" + embedContent,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    });\n\n\n});\n\n\nfunction getCurrentSearchId() {\n\tcurrentURL = window.location.href.replace(window.location.hash,\"\");\n\tcurrentHash = window.location.hash.replace(\"#\", \"\");\n\tif(currentHash.length == 36) {\n\t\t// this is an old hash, we need to keep that\n\t\tsearchId = currentHash;\n\t\twindow.history.pushState({}, \"Search Results\", currentURL + \"/s/\" +searchId);\n\t}\n\telse {\n\t\tsearchId = currentURL.substr(currentURL.lastIndexOf('/') + 1);\n\t}\n\treturn searchId;\n}\n\n\nfunction parseSearch() {\n\t\n\tsearchId = getCurrentSearchId();\n\n\tif(searchId && !disableHashChange) {\n\t\tresetSearchFrame();\n\n\n\n\t\t// you can set a global var \"loadAll\" to cause us to load all available results at pageload.\n\t\t// leaving this here just to make it explicit\n\t\tvar localLoadAll = false;\n\t\tif(typeof loadAll !== 'undefined' && loadAll == true) {\n\t\t\tlocalLoadAll = true;\n\t\t}\n\n\t\tdoSearch(searchId, 0, localLoadAll);\n\t}\n\n}\n\nfunction loadCollectionHeader() {\n\tif($(\"input[name='collection[]']\").length == 1 && $(\"input[name='collection[]']\").val() !== \"0\" && $(\"#searchText\").val() == \"\") {\n\t\t$.get(basePath + \"collections/collectionHeader/\" + $(\"input[name='collection[]']\").val(), function(data) {\n\t\t\t$(\".collectonHeader\").html(data);\n\t\t});\n\t}\n\n}\n\n// ignore results is used to force the server to pre-cache the next set of results\nfunction doSearch(searchId, pageNumber, loadAll, ignoreResults) {\n\n\n\tif(!ignoreResults) {\n\t\tpreviousEventComplete = false;\n\t\tcurrentPageNumber = pageNumber;\n\t}\n\n\n\tloadAll = (loadAll)?\"true\":\"false\";\n\n\t$.get(basePath + \"search/searchResults/\" + searchId + \"/\" + pageNumber + \"/\" + loadAll, function(data) {\n\t\t\tif(ignoreResults) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar oldMatches = [];\n\t\t\tvar oldResults = [];\n\t\t\ttry{\n\t\t\t\tif(cachedResults) {\n\t\t\t\t\toldMatches = cachedResults.matches;\n\t\t\t\t\toldResults = cachedResults.searchResults;\n\t\t\t\t}\n\t\t\t\tcachedResults = $.parseJSON(data);\n\n\t\t\t}\n\t\t\tcatch(e){\n\t\t\t\talert(e + \" \" + data);\n\t\t\t}\n\n\t\t\tif(cachedResults.success === true) {\n\n\t\t\t\tif(cachedResults.totalResults == 1 ) {\n\t\t\t\t\t// special case - one match, let's just load it\n\t\t\t\t\tvar objectId = cachedResults.matches[0].objectId;\n\t\t\t\t\t$.cookie('lastSearch', searchId, { path: \"/\"});\n\n\t\t\t\t\t// window.location.hash = \"\";\n\t\t\t\t\twindow.location.pathname = basePath + \"/asset/viewAsset/\" + objectId;\n\t\t\t\t}\n\t\t\t\tcachedResults.totalLoadedCount = cachedResults.matches.length + oldMatches.length;\n\t\t\t\tprocessSearchResults(cachedResults);\n\t\t\t\tnewArray = $.merge(cachedResults.matches, oldMatches);\n\t\t\t\tcachedResults.searchResults = $.merge(cachedResults.searchResults, oldResults);\n\t\t\t\tcachedResults.matches = newArray;\n\n\t\t\t\t// we want these to use the full stored set, not just the curret batch, so we run them after merging.\n\t\t\t\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\t\t\t\tprepMap();\n\t\t\t\t}\n\n\t\t\t\t// we want these to use the full stored set, not just the curret batch, so we run them after merging.\n\t\t\t\t// if($('a[href=\"#gallery\"]').parent().hasClass(\"active\")) {\n\t\t\t\t// \tprepGallery();\n\t\t\t\t// }\n\n\t\t\t\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\t\t\t\tcachedDates = null;\n\t\t\t\t\tprepTimeline();\n\t\t\t\t}\n\n\t\t\t}\n\t\t});\n}\n\nfunction processSearchResults(cachedResults) {\n\tpopulateSearchFields(cachedResults.searchEntry);\n\tloadCollectionHeader();\n\tpopulateSearchResults(cachedResults);\n\tif(cachedResults.matches.length === 0) {\n\t\tdataAvailable = false;\n\t}\n\tpreviousEventComplete = true;\n\t\n}\n\n$(document).on(\"click\", \".assetLink\", function(e) {\n\t$.cookie('lastSearch', searchId, { path: \"/\"});\n\n});\n\n$(document).on(\"click\", \".useSuggest\", function() {\n\n\t$(\".searchText\").val($(this).text());\n\t$(\".searchForm\").submit();\n\n});\n\n$(document).on(\"change\", \".sortBy\", function() {\n\t$(\".hiddenSort\").val($(this).val());\n\tperformSearchForButtonPress($(\".searchForm\").first());\n});\n\n\n$(document).on(\"click\", \"#loadAllResults\", function(e) {\n\te.preventDefault();\n\tif(dataAvailable) {\n\t\tdoSearch(searchId, currentPageNumber+1, true);\n\t\tdataAvailable = false;\n\t\t$(\"#loadAllResults\").hide();\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\n});\n\nfunction getSuggestions(searchTerm) {\n\n\tvar localSearch = searchTerm;\n\t$.post(basePath + \"search/getSuggestion\", {\"searchTerm\":searchTerm}, function(data, textStatus) {\n\t\tvar resultArray = $.parseJSON(data);\n\t\tif(resultArray.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\t$.each(resultArray, function(index, value) {\n\t\t\tvar reg = new RegExp(index, 'ig');\n\t\t\tlocalSearch = localSearch.replace(reg, value);\n\t\t});\n\n\t\tvar search = $(\"<a>\").addClass(\"useSuggest\").append(localSearch);\n\t\tvar italics = $(\"<i>\").append(search);\n\t\tvar insert = $(\"<div>\").addClass('col-sm-12 suggestionText').append(\"Did you mean: \").append(italics).append(\" ?\");\n\t\t$(\".suggest\").empty();\n\t\t$(\".suggest\").append(insert);\n\n\t});\n\n\n}\n\nfunction populateSearchFields(searchEntry) {\n\t$(\".collectionSelector\").prop('checked', false);\n\t$(\"#showHidden\").prop('checked',false);\n\t$(\".advancedOption\").val();\n\n\tif(searchEntry.searchText.length > 0) {\n\t\tgetSuggestions(searchEntry.searchText);\n\t}\n\n\t$(\".sortBy\").val(searchEntry.sort);\n\n\t$.each(searchEntry, function(index, value) {\n\t\tif(Array.isArray(value)) {\n\t\t\tvar targetField = $(\"#\" + index);\n\t\t\t$.each(value, function(internalIndex, internalValue) {\n\t\t\t\tvar newField = targetField.clone();\n\t\t\t\t$(newField).val(internalValue);\n\t\t\t\t$(newField).appendTo($(\"#\" + index).parent());\n\t\t\t});\n\t\t\t$(targetField).remove();\n\t\t}\n\t\telse {\n\t\t\t$(\"#\" + index).val(value);\t\n\t\t}\n\t\n\t});\n\n\tif($(\"#collection\").val() > 0) {\n\t\ttargetText = $('[data-collection-id=\"' + $(\"#collection\").val() + '\"]').text();\n\t    $(\"#search_concept\").text(targetText);\n\t }\n\n}\n\n\n\nfunction populateSearchResults(searchObject) {\n\t// target template is defined by the hosting include - search page versus drawers, etc\n\tvar source   = $(targetTemplate).html();\n\tvar template = Handlebars.compile(source);\n\tvar listSource   = $(listTemplate).html();\n\tvar listTemplateCompiled = Handlebars.compile(listSource);\n\n\t$.each(searchObject.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = searchObject;\n\t\tvar html    = template(value);\n\t\tvar listHTML    = listTemplateCompiled(value);\n\t\t$(\"#results\").append(html);\n\t\t$(\"#listResults\").append(listHTML);\n\t});\n\n\t// todo refactor\n\tvar source   = $(\"#gallery-template\").html();\n\tvar template = Handlebars.compile(source);\n\t\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = cachedResults;\n\t\tvalue.isChild = false;\n\t\tvar hasChildren = false;\n\t\tif(value.fileAssets > 1 && value.fileAssets < 20) {\n\t\t\thasChildren = true;\n\t\t}\n\t\tvalue.hasChildren = hasChildren;\n\t\tvar html    = template(value);\n\t\t$(\"#previewFrame .frame ul\").append(html);\n\t\tif(hasChildren) {\n\t\t\tfor(i=0; i<value.fileAssets-1; i++) {\n\t\t\t\tvalue.primaryHandlerId = null;\n\t\t\t\tvalue.hasChildren = false;\n\t\t\t\tvalue.isChild = true;\n\t\t\t\tvar html    = template(value);\n\t\t\t\t$(\"#previewFrame .frame ul\").append(html);\n\t\t\t}\n\t\t}\n\t});\n\n\ttotalResults = searchObject.totalResults;\n\t$(\".resultsData\").html(\"<p>Total Results: \"+ searchObject.totalResults + \"</p>\");\n\n\tif(dataAvailable && searchObject.matches.length < searchObject.totalResults && searchObject.totalResults < 1000) {\n\t\t$(\".resultsData p\").append(\" <a href='' id='loadAllResults'>[Load All]</a>\");\n\t}\n\n\n\tif(searchObject.totalResults > searchObject.totalLoadedCount) {\n\t\t$(\".paginationBlock\").show();\n\t\tresultsAvailable = true;\n\t}\n\telse {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\t\n\tif(searchObject.matches.length == 0) {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\tprepMap();\n\t}\n\n\tif($('a[href=\"#gallery\"]').parent().hasClass(\"active\")) {\n\t\tprepGallery();\n\t}\n\n\n\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\tprepTimeline();\n\t}\n\n\t// have the server precache the new results\n\tif(searchId !== null) {\n\t\tdoSearch(searchId, currentPageNumber+1, false, true);\n\t}\n\n\tevent = new Event(\"searchUpdated\");\n  \tdocument.dispatchEvent(event);\n\n}\n\nvar galleryFrame = null;\n\n$(document).on(\"click\", \".fullscreen\", function() {\n\tif($.fullscreen.isNativelySupported()) {\n\t\t$(\".frameFullscreenContainer\").first().fullscreen({ \"toggleClass\": \"imageFullscreen\"});\n\t}\n});\n\nfunction prepGallery() {\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\n\tif(galleryFrame !== null) {\n\t\t// galleryFrame.reload();\n\t}\n\telse {\n\t\tvar assetsWithChildren = $(\".frame ul\").find('[data-haschildren=\"true\"]');\n\n\t\tassetsWithChildren.each(function(index, el) {\n\t\t\tif($(el).data(\"childrenloaded\") == \"true\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar localEl = el;\n\t\t\tvar primaryHandler = $(el).data('primaryhandler');\n\t\t\t// load the metadata for this record\n\t\t\t$.get(basePath + \"asset/viewAsset/\" + $(el).data(\"objectid\") + \"/true\", function(data) {\n\t\t\t\tparsed = data;\n\t\t\t\tvar fileIds = new Array;\n\t\t\t\tfor (var key in parsed) {\n\t\t\t\t\tif(Array.isArray(parsed[key])) {\n\t\t\t\t\t\tvar newIds = parsed[key].map(function(nestedElem) {\n\t\t\t\t\t\tif(nestedElem.hasOwnProperty('fileId')) {\n\t\t\t\t\t\t\treturn nestedElem.fileId;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t}).filter((elem)=>{ return elem!=null}).filter((elem)=>{ return elem != primaryHandler});\n\t\t\t\t\t\tfileIds = fileIds.concat(newIds);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(parsed.relatedAssetCache) {\n\t\t\t\t\tfor (var key in parsed.relatedAssetCache) { \n\t\t\t\t\t\telement = parsed.relatedAssetCache[key];\n\t\t\t\t\t\tif(element.primaryHandler && element.primaryHandler.length > 0) {\n\t\t\t\t\t\t\tfileIds.push(element.primaryHandler);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor(fileId of fileIds) {\n\t\t\t\t\ttargetElement = $(\".frame ul\").find('[data-objectid=\"' + $(el).data(\"objectid\") + '\"]').filter('[data-ischild=\"true\"]').filter('[data-primaryhandler=\"\"]').first();\n\t\t\t\t\ttargetElement.attr(\"data-primaryhandler\", fileId);\n\t\t\t\t\ttargetElement.children(\"img\").attr(\"src\", basePath+\"fileManager/previewImageByFileId/\" + fileId);\n\t\t\t\t\ttargetElement.children(\"img\").attr(\"srcset\", basePath+\"fileManager/previewImageByFileId/\" + fileId + \"/true 2x\");\n\t\t\t\t}\n\t\t\t\t$(el).data(\"childrenloaded\", \"true\");\n\t\t\t});\n\t\t\t\n\t\t});\n\n\n\t\tsourceFrame = $('#forcecentered');\n\n\t\tvar $wrap  = sourceFrame.parent();\n\n\t\t// Call Sly on frame\n\t\tgalleryFrame = new Sly($('#forcecentered'), {\n\t\t\thorizontal: 1,\n\t\t\titemNav: 'forceCentered',\n\t\t\tkeyboardNavBy: 'items',\n\t\t\tsmart: 1,\n\t\t\tactivateMiddle: 0,\n\t\t\tactivateOn: 'click',\n\t\t\tmouseDragging: 1,\n\t\t\ttouchDragging: 1,\n\t\t\treleaseSwing: 1,\n\t\t\tstartAt: 0,\n\t\t\tscrollBar: $wrap.find('.scrollbar'),\n\t\t\tscrollBy: 1,\n\t\t\tspeed: 300,\n\t\t\telasticBounds: 1,\n\t\t\teasing: 'easeOutExpo',\n\t\t\tdragHandle: 1,\n\t\t\tdynamicHandle: 1,\n\t\t\tclickBar: 1,\n\n\t\t\t// Buttons\n\t\t\tprev: $wrap.find('.prev'),\n\t\t\tnext: $wrap.find('.next')\n\t\t}).init();\n\n\t\tgalleryFrame.on('active', function(event, item) { \n\t\t\tloadGalleryElement(item);\n\t\t});\n\n\t\tloadGalleryElement(0);\n\t}\n}\n\nfunction loadGalleryElement(index) {\n\ttargetItem = galleryFrame.items[index].el;\n\t$(\".frameHeader\").html(\"<a href='\" + basePath + \"/asset/viewAsset/\" + $(targetItem).data(\"objectid\") + \"'><h2>\" + $(targetItem).data(\"title\") + \"</h2></a>\" );\n\t$(\".galleryIframe\").attr(\"src\", basePath + \"asset/getEmbed/\" + $(targetItem).data(\"primaryhandler\") + \"/\" + $(targetItem).data(\"objectid\") + \"/true\");\n}\n\nfunction loadNestedAssets(objectId) {\n\n\n}\n\n\nfunction prepMap() {\n\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\tif(markers) {\n\t\tmarkers.clearLayers();\t\n\t}\n\t\n\tif(!map) {\n\t\tloadMap(\"mapPane\");\n\t}\n\tmarkers = L.markerClusterGroup({ showCoverageOnHover: false});\n\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tif(value.locations) {\n\t\t\t$.each(value.locations, function (index2, value2) {\n\t\t\t\t$.each(value2.entries, function(index3, value3) {\n\n\t\t\t\t\tloc = value3.loc.coordinates;\n\t\t\t\t\tvalue.base_url = basePath;\n\t\t\t\t\tvar html    = MarkerTemplate(value);\n\n\t\t\t\t\tif(loc[1] === 0 && loc[0] === 0) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tlocalMarker = L.marker([loc[1],loc[0]]);  \n\t\t\t\t\tlocalMarker.bindPopup(html);\n  \t\t\t\t\tmarkers.addLayer(localMarker);\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t});\n\n\tmap.addLayer(markers);\n\tmap.fitBounds(markers.getBounds().pad(0.5)); \n\n}\n\n\nfunction prepTimeline() {\n\tif(cachedResults === \"\") {\n\t\treturn;\n\t}\n\n\tvar compiledDate = {};\n\tvar geoTime = false;\n\n\tcompiledDate.events = new Array();\n\tfor (var match of cachedResults.matches) {\n\n\t\t// if we don't have a special dates propery, we can ignore this one\n\t\tif(!match.hasOwnProperty(\"dates\")) {\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\tfor(var dates of match.dates) {\n\t\t\tfor(var date of dates.dateAsset) {\n\t\t\t\tstartTime = parseInt(date.start[\"numeric\"], 10);\n\t\t\t\tif(startTime < -6373557595440) {\n\t\t\t\t\tgeoTime = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\n\t\tfor(var dates of match.dates) {\n\t\t\tfor(var date of dates.dateAsset) {\n\t\t\t\tvar newItem = {};\n\t\t\t\tstartTime = parseInt(date.start[\"numeric\"], 10);\n\t\t\t\tnewItem.start_date = {};\n\t\t\t\tif(geoTime) {\n\t\t\t\t\tstartYear = -1 * Math.round(Math.abs((startTime + (1970*31556900)) / 31556900));\n\t\t\t\t\tnewItem.start_date.year = startYear;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\tt.setSeconds(startTime);\n\t\t\t\t\tformattedStart = Date.utc.create(t);\n\t\t\t\t\tnewItem.start_date.display_date = date.start[\"text\"];\n\t\t\t\t\tnewItem.start_date.year = formattedStart.getFullYear();\n\t\t\t\t\tnewItem.start_date.month = formattedStart.getMonth() + 1;\n\t\t\t\t\tnewItem.start_date.day = formattedStart.getDay() + 1;\n\n\t\t\t\t}\n\t\t\t\tif(date.end[\"numeric\"] && date.end[\"numeric\"].toString().length>0) {\n\t\t\t\t\tnewItem.end_date = {};\n\t\t\t\t\tendTime = parseInt(date.end[\"numeric\"], 10);\n\n\t\t\t\t\tif(geoTime) {\n\t\t\t\t\t\tendYear = -1 * Math.round(Math.abs((endTime+ (1970*31556900)) / 31556900));\n\t\t\t\t\t\tnewItem.end_date.year = endYear;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\t\tt.setSeconds(endTime);\n\t\t\t\t\t\tformattedEnd = Date.utc.create(t);\n\t\t\t\t\t\tnewItem.end_date.display_date = date.end[\"text\"];\n\t\t\t\t\t\tnewItem.end_date.year = formattedEnd.getFullYear();\n\t\t\t\t\t\tnewItem.end_date.month = formattedEnd.getMonth() + 1;\n\t\t\t\t\t\tnewItem.end_date.day = formattedEnd.getDay() + 1;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvar html    = TimelineTemplate(match);\n\n\t\t\t\tnewItem.text = {};\n\t\t\t\tnewElement = $(\"<a/>\", {\"href\": basePath + \"asset/viewAsset/\" + match.objectId, \"text\": match.title});\n\t\t\t\tnewItem.text.headline = newElement.prop(\"outerHTML\");\n\t\t\t\tnewItem.text.text = html;\n\n\t\t\t\tif(match.hasOwnProperty(\"primaryHandlerThumbnail2x\")) {\n\t\t\t\t\tnewItem.media = {};\n\t\t\t\t\tnewItem.media.thumb = match.primaryHandlerThumbnail2x;\n\t\t\t\t\tnewItem.media.url = match.primaryHandlerThumbnail2x;\t\n\t\t\t\t}\n\n\t\t\t\t// dedupe our array\n\t\t\t\tvar ignoreItem = false;\n\t\t\t\tfor(var existingDate of compiledDate.events) {\n\t\t\t\t\tif(JSON.stringify(existingDate) == JSON.stringify(newItem)) {\n\t\t\t\t\t\tignoreItem = true;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(!ignoreItem) {\n\t\t\t\t\tcompiledDate.events.push(newItem);\t\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t}\n\t\t}\n\n\n\n\t}\n\n\tif(geoTime) {\n\t\tcompiledDate.scale = \"cosmological\"\n\t\tinjectStyles(\".tl-timeaxis-minor { display: none; }\");\n\t}\n\telse {\n\t\t$(\"#hackyGeoStyle\").remove();\n\t}\n\n\tvar timeline = new TL.Timeline('timelinePane', compiledDate, {\n        timenav_position: \"bottom\",\n        timenav_height_percentage: \"70\"\n\t});\n\n\n}\n\nfunction injectStyles(rule) {\n  var div = $(\"<div />\", {\n    id: \"hackyGeoStyle\",\n    html: '&shy;<style>' + rule + '</style>'\n  }).appendTo(\"body\");    \n}\n\n\n$(document).on(\"click\", \".embedControl\", function() {\n\t$(this).select();\n});\n\n\n$(document).on(\"click\", \".exportCSV\", function(e) {\n\te.preventDefault();\n\ttarget = e.target.href;\n\twindow.location = target + \"#\" + searchId;\n\n});\n","var targetTemplate = \"#result-template\";\nvar listTemplate = \"#list-template\";\n\n\n\n\n$(document).on(\"click\", \".addAnotherSpecific\", function() {\n\n    var specificSearch = $(this).closest('.specificSearch');\n    var newSpecificSearch = $(specificSearch).clone(false);\n    newSpecificSearch.find(\"input[type='text']\").val(\"\");\n    $(specificSearch).after(newSpecificSearch);\n\n});\n\n$(document).on(\"click\", \".addAnotherCollection\", function() {\n    var collectionCopy = $(this).closest('.form-group');\n    var newCollection = $(collectionCopy).clone(false);\n    newCollection.find(\"input[type='text']\").val(\"\");\n    $(collectionCopy).after(newCollection);\n});\n\n\n\n$(document).on(\"change\", \".searchDropdown\", function() {\n    var selectedOption = $(this).find(\":selected\");\n    var content = $(selectedOption).val();\n    var templateId = $(selectedOption).data('templateid');\n    var targetGroup = $(this).closest(\".form-group\").find(\".specificSearchTextContainer\");\n    $.post(basePath + 'search/getFieldInfo', {fieldTitle: content, template: templateId}, function(data, textStatus, xhr) {\n        var results;\n        try {\n            results = $.parseJSON(data);\n        }\n        catch(e) {\n            console.log(\"error occurred\");\n        }\n\n        if(results.type == \"text\") {\n            $(targetGroup).html(\"\");\n            $(targetGroup).html('<input type=\"text\" name=\"specificSearchText[]\"  autocomplete=\"off\" class=\"form-control advancedOption advancedSearchContent\" value=\"\">');\n        }\n        else {\n            $(targetGroup).html(\"\");\n            $(targetGroup).html('<select name=\"specificSearchText[]\"  autocomplete=\"off\" class=\"form-control advancedOption advancedSearchContent\">');\n            selectElement = $(targetGroup).find(\"select\");\n            $.each(results.values, function(index, val) {\n                $(selectElement).append($('<option>', {value: val}).text(val));\n            });\n\n        }\n\n    });\n\n\n\n});\n\n\nfunction resetSearchFrame() {\n    $(\"#results\").empty();\n    $(\"#listResults\").empty();\n    $(\".frame ul\").empty();\n    $(\".suggest\").empty();\n    if(galleryFrame) {\n        galleryFrame.destroy();\n        galleryFrame = null;    \n    }\n    $(\".galleryIframe\").attr(\"src\",\"\");\n    \n}\n\nvar performSearchForButtonPress = function(targetForm) {\n\n    resetSearchFrame();\n    searchId = \"\";\n    if(window.location.hash.length > 0) {\n        // for now, let's try not persisting search results?\n    //    searchId = window.location.hash.substring(1);\n    }\n\n    currentPageNumber = 0;\n    previousEventComplete = false;\n    $.post( basePath + \"search/searchResults/\" + searchId, {searchQuery:JSON.stringify($( targetForm ).serializeForm())}, function( data ) {\n        try{\n            cachedResults = $.parseJSON(data);\n            cachedDates = null;\n        }\n        catch(e){\n            alert(e + \" \" + data);\n        }\n\n\n        if(cachedResults.success === true) {\n\n            if(cachedResults.matches.length == 1) {\n                // special case - one match, let's just load it\n                var objectId = cachedResults.matches[0].objectId;\n                $.cookie('lastSearch', searchId);\n                window.location.hash = \"\";\n                window.location.pathname = basePath + \"/asset/viewAsset/\" + objectId;\n            }\n            searchId = cachedResults.searchId;\n            \n            cachedResults.totalLoadedCount = cachedResults.matches.length;\n            \n            disableHashChange = true;\n            currentURL = window.location.href.replace(window.location.hash,\"\");\n            currentHash = window.location.hash.replace(\"#\", \"\");\n            var oldSearchId = currentURL.substr(currentURL.lastIndexOf('/') + 1);\n            window.history.pushState({}, \"Search Results\", window.location.href.replace(oldSearchId, searchId));\n\n\n            dataAvailable = true;\n            $(\"#loadAllResults\").show();\n            processSearchResults(cachedResults);\n            setTimeout(function() {\n                disableHashChange = false;\n            }, 500);\n\n\n            if($('#advancedSearchModal').hasClass('in')) {\n                $('#advancedSearchModal').modal('hide');\n            }\n\n        }\n    });\n    return false;\n}\n\n\n$(document).ready(function() {\n\n    parseSearch();\n\n    $(document).on(\"submit\", \".searchForm\", function() {\n        if($(this).attr(\"id\") == \"advancedSearchForm\") {\n            // do nothing\n        }\n        else {\n            // when they hit the global search button, it should be a global search.  We might have ended up with a stored collection though, expunge that.\n            // $(this).find(\"#collection\").val('0');\n            $(this).find(\"#specificSearchField\").val('');\n            $(this).find(\"#specificSearchText\").val('');\n            $(\".collectonHeader\").html('');\n        }\n\n        performSearchForButtonPress(this);\n        return false;\n    });\n});"]}