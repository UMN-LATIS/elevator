{"version":3,"sources":["search.js","searchForm.js"],"names":["parseHash","window","location","hash","length","disableHashChange","$","empty","searchId","substring","doSearch","pageNumber","loadAll","ignoreResults","previousEventComplete","currentPageNumber","get","basePath","data","oldMatches","cachedResults","matches","parseJSON","e","alert","success","totalResults","objectId","cookie","pathname","processSearchResults","newArray","merge","populateSearchFields","searchEntry","populateSearchResults","dataAvailable","getSuggestions","searchTerm","localSearch","post","textStatus","resultArray","each","index","value","reg","RegExp","replace","search","addClass","append","italics","insert","prop","val","searchText","searchObject","source","targetTemplate","html","template","Handlebars","compile","listSource","listTemplate","listTemplateCompiled","base_url","listHTML","parent","hasClass","prepMap","prepTimeline","prepGallery","find","el","on","Retina","isRetina","removeAttr","RetinaImage","show","resultsAvailable","hide","carouselLinks","push","image","thumb","title","link","Galleria","loadTheme","galleria","data_source","imageCrop","imageTimeout","popupLinks","extend","options","this","attachKeyboard","left","prev","right","next","setPlaytime","setOptions","bind","removeData","goMap","mapTypeControl","maptype","mapTypeControlOptions","position","style","addMarker","getMarkerCount","clearMarkers","locations","index2","value2","entries","index3","value3","loc","coordinates","MarkerTemplate","allMarkers","getMarkers","latlng","google","maps","LatLng","finalLatLng","i","existingMarker","pos","getPosition","geometry","spherical","computeDistanceBetween","newLat","lat","Math","random","newLng","lng","createMarker","longitude","latitude","markers","temp","mapId","MarkerClusterer","map","fitBounds","earliestDate","latestDate","undefined","Timeline","DateTime","DefaultEventSource","strings","GregorianDateLabeller","monthNames","setTimeout","geoTime","cachedDates","events","dates","dateAsset","start","startTime","parseInt","endTime","formattedStart","formattedEnd","t","GeochronoUnit","wrapMA","abs","Date","setSeconds","utc","create","formattedValue","miscData","id","description","end","durationEvent","console","log","eventSource","clear","Event","prototype","fillInfoBubble","elmt","theme","labeller","eventObject","div","document","createElement","innerHTML","_obj","appendChild","SimileAjax","EventIndex","loadJSON","ClassicTheme","d","midPoint","range","bigBand","smallBand","smallInterval","MINUTE","HOUR","DAY","MONTH","YEAR","DECADE","CENTURY","MILLENNIUM","MA","EPOCH","History","enabled","bandInfos","Geochrono","createBandInfo","timeZone","getTimezoneOffset","date","width","intervalUnit","intervalPixels","trackGap","trackHeight","eventPainter","CompactEventPainter","eventPainterParams","iconLabelGap","labelRightMargin","iconWidth","iconHeight","stackConcurrentPreciseInstantEvents","limit","moreMessageTemplate","icon","overview","syncWith","highlight","tl","getElementById","HORIZONTAL","MarkerSource","ready","scroll","height","scrollTop","text","getScript","trigger","submit","preventDefault","specificSearch","closest","newSpecificSearch","clone","after","collectionCopy","newCollection","selectedOption","content","templateId","targetGroup","fieldTitle","xhr","results","type","selectElement","values","searchQuery","JSON","stringify","serializeForm","modal"],"mappings":"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","file":"searchMaster.min.js","sourcesContent":["\nvar MarkerSource;\nvar MarkerTemplate;\nvar cachedResults = \"\";\nvar cachedDates = null;\nvar searchId = null;\nvar currentPageNumber;\nvar eventSource;\nvar resultsAvailable = true;\nvar previousEventComplete = true;\nvar dataAvailable = true;\nvar disableHashChange = false;\n\n$(document).ready(function() {\n\n\t$(window).scroll(function(){\n\t\tif (resultsAvailable && $(document).height() - 50 <= $(window).scrollTop() + $(window).height()) {\n\t\t\tif(($('.nav-tabs .active').text() == \"Grid\" || $('.nav-tabs .active').text() == \"List\") && previousEventComplete && dataAvailable) {\n\t\t\t\tdoSearch(searchId, currentPageNumber+1);\n\t\t\t}\n\t\t}\n\t});\n\n\t$(window).bind( 'hashchange', function(e) {\n\t\tparseHash();\n\t});\n\n\tsetTimeout(function() {\n\t\t$.getScript(\"/assets/timeline_js/ext/geochrono/geochrono-api.js\");\n\t}, 1000);\n\n\n\t$(\".searchText\").on(\"blur\", function() {\n\t\t$(\".advancedSearchText\").val($(\".searchText\").val());\n\t});\n\n\t$(\".advancedSearchText\").on(\"blur\", function() {\n\t\t$(\".searchText\").val($(\".advancedSearchText\").val());\n\t});\n\n\t$('a[href=\"#timeline\"]').on('shown.bs.tab', function() {\n\t\tcachedDates = null;\n\t\tprepTimeline();\n\t});\n\t$('a[href=\"#map\"]').on('shown.bs.tab', function() {\n\t\tprepMap();\n\t});\n\t$('a[href=\"#gallery\"]').on('shown.bs.tab', function() {\n\t\tprepGallery();\n\t});\n\t$('a[href=\"#grid\"]').on('shown.bs.tab', function() {\n\t\t$(\"#results\").find(\"img\").trigger(\"show\");\n\t});\n\t$('a[href=\"#list\"]').on('shown.bs.tab', function() {\n\t\t$(\"#listResults\").find(\"img\").trigger(\"show\");\n\t});\n\n\n\n\n\t$(\".previousPage\").on(\"click\",function() {\n\t\tdoSearch(searchId, currentPageNumber-1);\n\t\treturn false;\n\t});\n\n\t$(\".nextPage\").on(\"click\",function() {\n\t\tdoSearch(searchId, currentPageNumber+1);\n\t\treturn false;\n\t});\n\n\n\tMarkerSource   = $(\"#marker-template\").html();\n\tMarkerTemplate = Handlebars.compile(MarkerSource);\n\n\n});\n\n\n\n\nfunction parseHash() {\n\tif(window.location.hash.length>0 && !disableHashChange) {\n\t\t$(\"#results\").empty();\n\t\t$(\"#listResults\").empty();\n\t\tsearchId = window.location.hash.substring(1);\n\t\tdoSearch(searchId, 0);\n\t}\n}\n\n// ignore results is used to force the server to pre-cache the next set of results\nfunction doSearch(searchId, pageNumber, loadAll, ignoreResults) {\n\n\n\tif(!ignoreResults) {\n\t\tpreviousEventComplete = false;\n\t\tcurrentPageNumber = pageNumber;\n\t}\n\n\n\tloadAll = (loadAll)?\"true\":\"false\";\n\n\t$.get(basePath + \"search/searchResults/\" + searchId + \"/\" + pageNumber + \"/\" + loadAll, function(data) {\n\t\t\tif(ignoreResults) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar oldMatches = [];\n\t\t\ttry{\n\t\t\t\tif(cachedResults) {\n\t\t\t\t\toldMatches = cachedResults.matches;\n\t\t\t\t}\n\t\t\t\tcachedResults = $.parseJSON(data);\n\n\t\t\t}\n\t\t\tcatch(e){\n\t\t\t\talert(e + \" \" + data);\n\t\t\t}\n\n\t\t\tif(cachedResults.success === true) {\n\n\t\t\t\tif(cachedResults.totalResults == 1 ) {\n\t\t\t\t\t// special case - one match, let's just load it\n\t\t\t\t\tvar objectId = cachedResults.matches[0].objectId;\n\t\t\t\t\t$.cookie('lastSearch', searchId);\n\n\t\t\t\t\twindow.location.hash = \"\";\n\t\t\t\t\twindow.location.pathname = basePath + \"/asset/viewAsset/\" + objectId;\n\t\t\t\t}\n\t\t\t\tprocessSearchResults(cachedResults);\n\t\t\t\tnewArray = $.merge(cachedResults.matches, oldMatches);\n\t\t\t\tcachedResults.matches = newArray;\n\n\t\t\t}\n\t\t});\n}\n\nfunction processSearchResults(cachedResults) {\n\tpopulateSearchFields(cachedResults.searchEntry);\n\tpopulateSearchResults(cachedResults);\n\tif(cachedResults.matches.length === 0) {\n\t\tdataAvailable = false;\n\t}\n\tpreviousEventComplete = true;\n}\n\n$(document).on(\"click\", \".assetLink\", function() {\n\t$.cookie('lastSearch', searchId);\n\n});\n\n$(document).on(\"click\", \".useSuggest\", function() {\n\n\t$(\".searchText\").val($(this).text());\n\t$(\".searchForm\").submit();\n\n});\n\n\n$(document).on(\"click\", \"#loadAllResults\", function(e) {\n\te.preventDefault();\n\tif(dataAvailable) {\n\t\tdoSearch(searchId, currentPageNumber+1, true);\n\t\tdataAvailable = false;\n\t\t$(\"#loadAllResults\").hide();\n\t}\n\n\n});\n\nfunction getSuggestions(searchTerm) {\n\n\tvar localSearch = searchTerm;\n\t$.post(basePath + \"search/getSuggestion\", {\"searchTerm\":searchTerm}, function(data, textStatus) {\n\t\tvar resultArray = $.parseJSON(data);\n\t\tif(resultArray.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\t$.each(resultArray, function(index, value) {\n\t\t\tvar reg = new RegExp(index, 'ig');\n\t\t\tlocalSearch = localSearch.replace(reg, value);\n\t\t});\n\n\t\tvar search = $(\"<a>\").addClass(\"useSuggest\").append(localSearch);\n\t\tvar italics = $(\"<i>\").append(search);\n\t\tvar insert = $(\"<div>\").addClass('col-sm-12 suggestionText').append(\"Did you mean: \").append(italics).append(\" ?\");\n\t\t$(\".suggest\").empty();\n\t\t$(\".suggest\").append(insert);\n\n\t});\n\n\n}\n\nfunction populateSearchFields(searchEntry) {\n\t$(\".collectionSelector\").prop('checked', false);\n\t$(\"#showHidden\").prop('checked',false);\n\t$(\".advancedOption\").val();\n\n\tif(searchEntry.searchText.length > 0) {\n\t\tgetSuggestions(searchEntry.searchText);\n\t}\n\n\t$.each(searchEntry, function(index, value) {\n\t\t$(\"#\" + index).val(value);\n\n\t});\n}\n\n\n\nfunction populateSearchResults(searchObject) {\n\t// target template is defined by the hosting include - search page versus drawers, etc\n\tvar source   = $(targetTemplate).html();\n\tvar template = Handlebars.compile(source);\n\tvar listSource   = $(listTemplate).html();\n\tvar listTemplateCompiled = Handlebars.compile(listSource);\n\n\t$.each(searchObject.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = searchObject;\n\t\tvar html    = template(value);\n\t\tvar listHTML    = listTemplateCompiled(value);\n\t\t$(\"#results\").append(html);\n\t\t$(\"#listResults\").append(listHTML);\n\t});\n\n\n\n\tif($('a[href=\"#map\"]').parent().hasClass(\"active\")) {\n\t\tprepMap();\n\t}\n\n\tif($('a[href=\"#timeline\"]').parent().hasClass(\"active\")) {\n\t\tprepTimeline();\n\t}\n\n\tif($('a[href=\"#gallery\"]').parent().hasClass(\"active\")) {\n\t\tprepGallery();\n\t}\n\n\tif($('a[href=\"#grid\"]').parent().hasClass(\"active\")) {\n\t\t$(\"#results\").find(\"img\").each(function(el, value){\n\t\t\t$(value).on(\"load\", function() {\n\t\t\t\tif(Retina.isRetina()) {\n\t\t\t\t\t$(value).removeAttr(\"width\").removeAttr(\"height\");\n\t\t\t\t\tnew RetinaImage(value);\n\t\t\t\t}\n\n\t\t\t});\n\t\t});\n\t}\n\telse {\n\t\t// This is a bad hack to deal with the fact that handlebar.js and retina.js don't work great\n\t\t// together.  Once the internet has a sane way to do retina images, we can drop this and move to that.\n\t\t$(\"#results\").find(\"img\").each(function(el, value){\n\t\t\t$(value).on(\"show\", function() {\n\t\t\t\tif(Retina.isRetina()) {\n\t\t\t\t\t$(value).removeAttr(\"width\").removeAttr(\"height\");\n\t\t\t\t\tnew RetinaImage(value);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tif($('a[href=\"#list\"]').parent().hasClass(\"active\")) {\n\t\t$(\"#listResults\").find(\"img\").each(function(el, value){\n\t\t\t$(value).on(\"load\", function() {\n\t\t\t\tif(Retina.isRetina()) {\n\t\t\t\t\t$(value).removeAttr(\"width\").removeAttr(\"height\");\n\t\t\t\t\tnew RetinaImage(value);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\telse {\n\t\t// This is a bad hack to deal with the fact that handlebar.js and retina.js don't work great\n\t\t// together.  Once the internet has a sane way to do retina images, we can drop this and move to that.\n\n\t\t$(\"#listResults\").find(\"img\").each(function(el, value){\n\t\t\t$(value).on(\"show\", function() {\n\t\t\t\t$(value).removeAttr(\"width\").removeAttr(\"height\");\n\t\t\t\tif(Retina.isRetina()) {\n\t\t\t\t\t$(value).removeAttr(\"width\").removeAttr(\"height\");\n\t\t\t\t\tnew RetinaImage(value);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t$(\".resultsData\").html(\"<p>Total Results: \"+ searchObject.totalResults + \"</p>\");\n\n\tif(dataAvailable && searchObject.matches.length < searchObject.totalResults && searchObject.totalResults < 1000) {\n\t\t$(\".resultsData p\").append(\" <a href='' id='loadAllResults'>[Load All]</a>\");\n\t}\n\n\n\tif(searchObject.totalResults > searchObject.matches.length) {\n\t\t$(\".paginationBlock\").show();\n\t\tresultsAvailable = true;\n\t}\n\telse {\n\t\t$(\".paginationBlock\").hide();\n\t\tresultsAvailable = false;\n\t}\n\n\t// have the server precache the new results\n\tif(searchId !== null) {\n\t\tdoSearch(searchId, currentPageNumber+1, false, true);\n\t}\n\n\n}\n\n\n\n\nfunction prepGallery() {\n\tvar carouselLinks = [];\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tvalue.base_url = basePath;\n\t\tvalue.searchObject = cachedResults;\n\t\tcarouselLinks.push({\n\t\t\timage: basePath + \"fileManager/bestDerivativeByObjectId/\"+value.objectId+ \"/true\",\n\t\t\tthumb: basePath + \"fileManager/previewImage/\"+value.objectId,\n\t\t\ttitle: value.title,\n\t\t\tlink: basePath+\"asset/viewAsset/\"+value.objectId\n\t\t});\n\n\t});\n\n\tGalleria.loadTheme('/assets/themes/twelve/galleria.twelve.min.js');\n\t$('#galleryFrame').galleria({\n\t\tdata_source: carouselLinks,\n\t\timageCrop:false,\n\t\timageTimeout: 90000,\n\t\tpopupLinks:true,\n\t\textend: function(options) {\n\t\t\tthis.attachKeyboard({\n\t\t\tleft: this.prev, // applies the native prev() function\n\t\t\tright: this.next,\n\t\t});\n\t\t\tthis.setPlaytime(8000);\n\t\t\tthis.setOptions('showInfo', false);\n\t\t\tthis.bind(\"fullscreen_enter\", function(){\n\t\t\t\tthis.$( 'info' ).hide();\n\t\t\t});\n\t\t\tthis.bind(\"fullscreen_exit\", function() {\n\t\t\t\tthis.$( 'info' ).show();\n\t\t\t});\n\t\t// this.bind(\"image\", function(){\n\t\t//\tthis.unbind(\"image\");\n\t\t//\tthis.push(<? $i=0;  $j=0; foreach($assetList as $assetEntry) { if($j>15) { ?>\n\t\t//\t\t<? if($assetEntry->media_type == \"image\") { ?>\n\t\t//\t\t<? if($i>0) { echo \",\"; } $i++;?>\n\t\t//\t    {\n\t\t//\t        image: '<?=site_url(\"mediabank/download/jpg500\".\"/\".$assetEntry->digital_id)?>',\n\t\t//\t        big: '<?=site_url(\"mediabank/download/jpg1280\".\"/\".$assetEntry->digital_id)?>',\n\t\t//\t        thumb: '<?=site_url(\"mediabank/download/thumb\".\"/\".$assetEntry->digital_id)?>',\n\t\t//\t        title: '<?=trim(htmlspecialchars($assetEntry->title, ENT_QUOTES))?>',\n\t\t//\t        description: 'For more information, click on the image',\n\t\t//\t        link: '<?=site_url(\"search/show_details/\" . $assetEntry->digital_id)?>'\n\t\t//\t    }\n\t\t//\t<? } else { ?>\n\t\t//\t\t<? if($i>0) { echo \",\"; } $i++;?>\n\t\t//\t\t{\n\t\t//\t\t  image: '<?=site_url(\"mediabank/download/thumb\".\"/\".$assetEntry->digital_id)?>',\n\t\t//\t      thumb: '<?=site_url(\"mediabank/download/thumb\".\"/\".$assetEntry->digital_id)?>',\n\t\t//\t      title: '<?=trim(htmlspecialchars($assetEntry->title, ENT_QUOTES))?>',\n\t\t//\t      description: 'For more information, click on the image',\n\t\t//\t      link: '<?=site_url(\"search/show_details/\" . $assetEntry->digital_id)?>'\n\t\t//\t\t}\n\t\t//\t\t<? } } $j++; ?>\n\t\t//\t<? } ?>);\n\t\t// });\n}\n});\n\n\n}\n\n\nfunction prepMap() {\n\n\t$(\"#mapPane\").removeData();\n\n\t$(\"#mapPane\").goMap({\n\t\tmapTypeControl:true,\n\t\tmaptype: 'ROADMAP',\n\t\tmapTypeControlOptions: {\n\t\t\tposition: 'TOP_RIGHT',\n\t\t\tstyle: 'DROPDOWN_MENU'\n\t\t},\n\t\taddMarker: \"single\"\n\n\t});\n\tif($.goMap.getMarkerCount()>0) {\n\t\t$.goMap.clearMarkers();\n\t}\n\n\t$.each(cachedResults.matches, function(index, value) {\n\t\tif(value.locations) {\n\t\t\t$.each(value.locations, function (index2, value2) {\n\t\t\t\t$.each(value2.entries, function(index3, value3) {\n\n\t\t\t\t\tloc = value3.loc.coordinates;\n\t\t\t\t\tvalue.base_url = basePath;\n\t\t\t\t\tvar html    = MarkerTemplate(value);\n\t\t\t\t\tvar allMarkers = $.goMap.getMarkers(\"markers\");\n\t\t\t\t\tif(loc[1] === 0 && loc[0] === 0) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tlatlng = new google.maps.LatLng(loc[1], loc[0]);\n\t\t\t\t\tfinalLatLng = latlng;\n\t\t\t\t\tif (allMarkers.length != 0) {\n\t\t\t\t\t\tfor (i=0; i < allMarkers.length; i++) {\n\t\t\t\t\t\t\tvar existingMarker = allMarkers[i];\n\t\t\t\t\t\t\tvar pos = existingMarker.getPosition();\n        \t\t\t\t\t//if a marker already exists in the same position as this marker\n\n        \t\t\t\t\tif (google.maps.geometry.spherical.computeDistanceBetween(latlng,pos)<1) {\n            \t\t\t\t\t//update the position of the coincident marker by applying a small multipler to its coordinates\n            \t\t\t\t\tvar newLat = latlng.lat() + (Math.random() -.5) / 5500;// * (Math.random() * (max - min) + min);\n            \t\t\t\t\tvar newLng = latlng.lng() + (Math.random() -.5) / 5500;// * (Math.random() * (max - min) + min);\n            \t\t\t\t\tfinalLatLng = new google.maps.LatLng(newLat,newLng);\n            \t\t\t\t}\n            \t\t\t}\n            \t\t}\n            \t\telse {\n            \t\t\tfinalLatLng = latlng;\n            \t\t}\n\t\t\t\t\tvar marker = $.goMap.createMarker({\n\t\t\t\t\t\tlongitude: finalLatLng.lng(),\n\t\t\t\t\t\tlatitude: finalLatLng.lat(),\n\t\t\t\t\t\thtml: html\n\t\t\t\t\t});\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t});\n\n\tvar markers = [];\n\n\tfor (var i in $.goMap.markers) {\n\t\tvar temp = $($.goMap.mapId).data($.goMap.markers[i]);\n\t\tmarkers.push(temp);\n\t}\n\n\tvar markerclusterer = new MarkerClusterer($.goMap.map, markers);\n\n\t$.goMap.fitBounds();\n}\n\n\nfunction prepTimeline() {\n\tvar earliestDate = null;\n\tvar latestDate = null;\n\tif(Timeline === undefined || Timeline.DateTime === undefined || Timeline.DefaultEventSource === undefined || Timeline.strings === undefined || Timeline.GregorianDateLabeller.monthNames === undefined) {\n\t\tsetTimeout(function() {\n\t\t\tprepTimeline();\n\t\t}, 1000);\n\t\treturn;\n\t}\n\t$(\"#timelinePane\").empty();\n\n\tvar geoTime = false;\n\n\tif(cachedDates=== null) {\n\t\tcachedDates = {\n//\t\t\t\"dateTimeFormat\": \"iso8601\",\n\t\t\t\"events\": []\n\t\t};\n\n\n\t\t$.each(cachedResults.matches, function(index, value) {\n\t\t\tif(value.dates) {\n\t\t\t\t$.each(value.dates, function(index, value2) {\n\t\t\t\t\t$.each(value2.dateAsset, function(index, value3) {\n\t\t\t\t\t\tif(value3.start) {\n\t\t\t\t\t\t\tstartTime = parseInt(value3.start[\"numeric\"], 10);\n\t\t\t\t\t\t\tif(startTime < -6373557595440) {\n\t\t\t\t\t\t\t\tgeoTime = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$.each(cachedResults.matches, function(index, value) {\n\t\t\tif(value.dates) {\n\t\t\t\t$.each(value.dates, function(index, value2) {\n\t\t\t\t\t$.each(value2.dateAsset, function(index, value3) {\n\t\t\t\t\t\tif(value3.start && value3.start[\"numeric\"].length > 0) {\n\t\t\t\t\t\t\tvar startTime = null;\n\t\t\t\t\t\t\tvar endTime = null;\n\t\t\t\t\t\t\tvar formattedStart = null;\n\t\t\t\t\t\t\tvar formattedEnd = null;\n\t\t\t\t\t\t\tvar t = null;\n\t\t\t\t\t\t\tstartTime = parseInt(value3.start[\"numeric\"], 10);\n\n\t\t\t\t\t\t\tif(geoTime) {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * at this point, let's work in millions of years ago\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tformattedStart = Timeline.GeochronoUnit.wrapMA(Math.abs(startTime / 31556900000000));\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\t\t\t\tt.setSeconds(startTime);\n\t\t\t\t\t\t\t\tformattedStart = Date.utc.create(t);\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tformattedValue = {\n\t\t\t\t\t\t\t\t\"miscData\": value,\n\t\t\t\t\t\t\t\t\"title\": value.title,\n\t\t\t\t\t\t\t\t\"id\": \"/en/\"+value.objectId,\n\t\t\t\t\t\t\t\t\"start\": formattedStart,\n\t\t\t\t\t\t\t\t\"image\": basePath+\"testController/previewImage/\"+value.objectId,\n\t\t\t\t\t\t\t\t\"link\": basePath+\"testController/viewAsset/\"+value.objectId,\n\t\t\t\t\t\t\t\t\"description\": \"Caption goeshere\"\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif(value3.end[\"numeric\"].length>0) {\n\t\t\t\t\t\t\t\tendTime = parseInt(value3.end[\"numeric\"], 10);\n\t\t\t\t\t\t\t\tif(geoTime) {\n\t\t\t\t\t\t\t\t\tformattedEnd = Timeline.GeochronoUnit.wrapMA(Math.abs(endTime / 31556900000000));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tt = new Date(1970,0,1);\n\t\t\t\t\t\t\t\t\tt.setSeconds(endTime);\n\t\t\t\t\t\t\t\t\tformattedEnd = Date.utc.create(t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tformattedValue.end = formattedEnd;\n\t\t\t\t\t\t\t\tformattedValue.durationEvent = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(earliestDate === null || startTime < earliestDate) {\n\t\t\t\t\t\t\t\tearliestDate = startTime;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(latestDate === null || startTime > latestDate) {\n\t\t\t\t\t\t\t\tlatestDate = startTime;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (endTime > latestDate) {\n\t\t\t\t\t\t\t\tlatestDate = endTime;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcachedDates.events.push(formattedValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\nconsole.log(cachedDates);\n\n\tif(eventSource) {\n\t\teventSource.clear();\n\t}\n\n\n\tvar oldFillInfoBubble = Timeline.DefaultEventSource.Event.prototype.fillInfoBubble;\n\tTimeline.DefaultEventSource.Event.prototype.fillInfoBubble = function(elmt, theme, labeller) {\n\t\t//oldFillInfoBubble.call(this, elmt, theme, labeller);\n\n\t\tvar eventObject = this;\n\n\t\tvar div = document.createElement(\"div\");\n\t\tdiv.innerHTML = MarkerTemplate(eventObject._obj.miscData);\n\t\telmt.appendChild(div);\n\t};\n\n\n\n\n\tif(geoTime) {\n\t\teventSource = new Timeline.DefaultEventSource(new SimileAjax.EventIndex(Timeline.GeochronoUnit));\n\t}\n\telse {\n\t\teventSource = new Timeline.DefaultEventSource(0);\n\t}\n\n\n\teventSource.loadJSON(cachedDates, \"localJson\");\n\n\tvar theme = Timeline.ClassicTheme.create();\n\n\tvar d = null;\n\tvar midPoint = null;\n\tif(geoTime) {\n\t\tmidPoint = Math.abs(((earliestDate + latestDate) / 2) / 31556900000000);\n\t\td = Timeline.GeochronoUnit.wrapMA(midPoint);\n\t}\n\telse {\n\t\tmidPoint = (earliestDate + latestDate)/2;\n\t\tvar t = new Date(1970,0,1);\n\t\tt.setSeconds(midPoint);\n\n\t\td = Date.create(t);\n\t}\n\tvar range = latestDate - earliestDate;\n\tvar bigBand = null;\n\tvar smallBand = null;\n\tvar smallInterval = 200;\n\tif(range < 60*60) { // we're on a day scale\n\t\tbigBand = Timeline.DateTime.MINUTE;\n\t\tsmallBand = Timeline.DateTime.HOUR;\n\t}\n\telse if(range < 60*60*24) { //month scale\n\t\tbigBand = Timeline.DateTime.HOUR;\n\t\tsmallBand = Timeline.DateTime.DAY;\n\t}\n\telse if(range< 60*60*24*30) { //year scale\n\t\tbigBand = Timeline.DateTime.DAY;\n\t\tsmallBand = Timeline.DateTime.MONTH;\n\t}\n\telse if(range< 60*60*24*30*12) { //decade\n\t\tbigBand = Timeline.DateTime.MONTH;\n\t\tsmallBand = Timeline.DateTime.YEAR;\n\t}\n\telse if(range< 60*60*24*30*12*10) { //century\n\t\tbigBand = Timeline.DateTime.YEAR;\n\t\tsmallBand = Timeline.DateTime.DECADE;\n\t}\n\telse if(range< 60*60*24*30*12*10*10) { //millenia\n\t\tbigBand = Timeline.DateTime.DECADE;\n\t\tsmallBand = Timeline.DateTime.CENTURY;\n\t}\n\telse if(range< 60*60*24*30*12*10*10*10) { //bigger\n\t\tbigBand = Timeline.DateTime.CENTURY;\n\t\tsmallBand = Timeline.DateTime.MILLENNIUM;\n\n\t}\n\telse {\n\t\tbigBand = Timeline.DateTime.MILLENNIUM;\n\t\tsmallBand = Timeline.DateTime.MILLENNIUM;\n\t\tsmallInterval = 80;\n\t}\n\n\tif(geoTime) {\n\n\t\tbigBand = Timeline.GeochronoUnit.MA;\n\t\tsmallBand = Timeline.GeochronoUnit.EPOCH;\n\t}\n\n\tSimileAjax.History.enabled = false;\n\tvar bandInfos;\n\tif(geoTime) {\n        bandInfos  = [\n            Timeline.Geochrono.createBandInfo({\n                eventSource:    eventSource,\n                timeZone: -1 * (new Date().getTimezoneOffset()/60),\n                date:           d,\n                width:          \"86%\",\n                intervalUnit:   bigBand,\n                intervalPixels: 100,\n                trackGap:       0.2,\n                trackHeight:    1.3,\n                theme:          theme,\n                eventPainter:   Timeline.CompactEventPainter,\n                eventPainterParams: {\n\t\t\t\t\ticonLabelGap:     5,\n\t\t\t\t\tlabelRightMargin: 20,\n\t\t\t\t\ticonWidth:        80, // These are for per-event custom icons\n\t\t\t\t\ticonHeight:       80,\n\t\t\t\t\tstackConcurrentPreciseInstantEvents: {\n\t\t\t\t\t\tlimit: 5,\n\t\t\t\t\t\tmoreMessageTemplate:    \"%0 More Events\",\n\t\t\t\t\t\ticon:                   \"no-image-80.png\", // default icon in stacks\n\t\t\t\t\t\ticonWidth:              80,\n\t\t\t\t\t\ticonHeight:             80\n\t\t\t\t\t}\n\t\t\t\t}\n            }),\n            Timeline.Geochrono.createBandInfo({\n\t\t\t\twidth:          \"10%\",\n\t\t\t\ttimeZone: -1 * (new Date().getTimezoneOffset()/60),\n\t\t\t\tintervalUnit:   smallBand,\n\t\t\t\tintervalPixels: smallInterval,\n\t\t\t\teventSource:    eventSource,\n\t\t\t\tdate:           d,\n\t\t\t\ttheme:          theme,\n\t\t\t\toverview:         'overview'  // original, overview, detailed\n\t\t\t})\n        ];\n\t\tbandInfos[1].syncWith = 0;\n\t\tbandInfos[1].highlight = true;\n\t}\n\telse {\n\t\tbandInfos = [\n\t\t\tTimeline.createBandInfo({\n\t\t\t\twidth:          \"90%\",\n\t\t\t\tintervalUnit:   bigBand,\n\t\t\t\ttimeZone: -1 * (new Date().getTimezoneOffset()/60),\n\t\t\t\tintervalPixels: 200,\n\t\t\t\teventSource:    eventSource,\n\t\t\t\tdate:           d,\n\t\t\t\ttheme:          theme,\n\t\t\t\teventPainter:   Timeline.CompactEventPainter,\n\t\t\t\teventPainterParams: {\n\t\t\t\t\ticonLabelGap:     5,\n\t\t\t\t\tlabelRightMargin: 20,\n\t\t\t\t\ticonWidth:        80, // These are for per-event custom icons\n\t\t\t\t\ticonHeight:       80,\n\t\t\t\t\tstackConcurrentPreciseInstantEvents: {\n\t\t\t\t\t\tlimit: 5,\n\t\t\t\t\t\tmoreMessageTemplate:    \"%0 More Events\",\n\t\t\t\t\t\ticon:                   \"/assets/timeline_js/images/blue-circle.png\", // default icon in stacks\n\t\t\t\t\t\ticonWidth:              80,\n\t\t\t\t\t\ticonHeight:             80\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}),\n\t\t\tTimeline.createBandInfo({\n\t\t\t\twidth:          \"10%\",\n\t\t\t\ttimeZone: -1 * (new Date().getTimezoneOffset()/60),\n\t\t\t\tintervalUnit:   smallBand,\n\t\t\t\tintervalPixels: smallInterval,\n\t\t\t\teventSource:    eventSource,\n\t\t\t\tdate:           d,\n\t\t\t\ttheme:          theme,\n\t\t\t\toverview:         'overview'  // original, overview, detailed\n\t\t\t})\n\t\t];\n\t\tbandInfos[1].syncWith = 0;\n\t\tbandInfos[1].highlight = true;\n\t}\n\n\n\tif(geoTime) {\n\t\ttl = Timeline.create(document.getElementById(\"timelinePane\"), bandInfos, Timeline.HORIZONTAL, Timeline.GeochronoUnit);\n\t}\n\telse {\n\t\ttl = Timeline.create(document.getElementById(\"timelinePane\"), bandInfos, Timeline.HORIZONTAL);\n\t}\n\n\n}\n\n\n","var targetTemplate = \"#result-template\";\nvar listTemplate = \"#list-template\";\n\n\n\n\n$(document).on(\"click\", \".addAnotherSpecific\", function() {\n\n    var specificSearch = $(this).closest('.specificSearch');\n    var newSpecificSearch = $(specificSearch).clone(false);\n    newSpecificSearch.find(\"input[type='text']\").val(\"\");\n    $(specificSearch).after(newSpecificSearch);\n\n});\n\n$(document).on(\"click\", \".addAnotherCollection\", function() {\n    var collectionCopy = $(this).closest('.form-group');\n    var newCollection = $(collectionCopy).clone(false);\n    newCollection.find(\"input[type='text']\").val(\"\");\n    $(collectionCopy).after(newCollection);\n});\n\n\n\n$(document).on(\"change\", \".searchDropdown\", function() {\n    var selectedOption = $(this).find(\":selected\");\n    var content = $(selectedOption).val();\n    var templateId = $(selectedOption).data('templateid');\n    var targetGroup = $(this).closest(\".form-group\").find(\".specificSearchTextContainer\");\n    $.post(basePath + 'search/getFieldInfo', {fieldTitle: content, template: templateId}, function(data, textStatus, xhr) {\n        var results;\n        try {\n            results = $.parseJSON(data);\n        }\n        catch(e) {\n            console.log(\"error occurred\");\n        }\n\n        if(results.type == \"text\") {\n            $(targetGroup).html(\"\");\n            $(targetGroup).html('<input type=\"text\" name=\"specificSearchText[]\"  autocomplete=\"off\" class=\"form-control advancedOption advancedSearchContent\" value=\"\">');\n        }\n        else {\n            $(targetGroup).html(\"\");\n            $(targetGroup).html('<select name=\"specificSearchText[]\"  autocomplete=\"off\" class=\"form-control advancedOption advancedSearchContent\">');\n            selectElement = $(targetGroup).find(\"select\");\n            $.each(results.values, function(index, val) {\n                $(selectElement).append($('<option>', {value: val}).text(val));\n            });\n\n        }\n\n    });\n\n\n\n});\n\n\n\n$(document).ready(function() {\n\n    parseHash();\n\n    $(document).on(\"submit\", \".searchForm\", function() {\n        $(\"#results\").empty();\n        $(\"#listResults\").empty();\n        $(\".suggest\").empty();\n        searchId = \"\";\n        if(window.location.hash.length > 0) {\n            // for now, let's try not persisting search results?\n        //    searchId = window.location.hash.substring(1);\n        }\n\n        currentPageNumber = 0;\n        previousEventComplete = false;\n\n        $.post( basePath + \"search/searchResults/\" + searchId, {searchQuery:JSON.stringify($( this ).serializeForm())}, function( data ) {\n            try{\n                cachedResults = $.parseJSON(data);\n                cachedDates = null;\n            }\n            catch(e){\n                alert(e + \" \" + data);\n            }\n\n            if(cachedResults.success === true) {\n\n                if(cachedResults.matches.length == 1) {\n                    // special case - one match, let's just load it\n                    var objectId = cachedResults.matches[0].objectId;\n                    $.cookie('lastSearch', searchId);\n                    window.location.hash = \"\";\n                    window.location.pathname = basePath + \"/asset/viewAsset/\" + objectId;\n                }\n                searchId = cachedResults.searchId;\n                disableHashChange = true;\n                window.location.hash = searchId;\n\n                dataAvailable = true;\n                $(\"#loadAllResults\").show();\n                processSearchResults(cachedResults);\n                setTimeout(function() {\n                    disableHashChange = false;\n                }, 500);\n\n\n                if($('#advancedSearchModal').hasClass('in')) {\n                    $('#advancedSearchModal').modal('hide');\n                }\n\n            }\n\n        });\n        return false;\n    });\n});"],"sourceRoot":"/source/"}