function parseHash(){window.location.hash.length>0&&!disableHashChange&&($("#results").empty(),$("#listResults").empty(),searchId=window.location.hash.substring(1),doSearch(searchId,0))}function doSearch(e,t,a,n){n||(previousEventComplete=!1,currentPageNumber=t),a=a?"true":"false",$.get(basePath+"search/searchResults/"+e+"/"+t+"/"+a,function(t){if(!n){var a=[],i=[];try{cachedResults&&(a=cachedResults.matches,i=cachedResults.searchResults),cachedResults=$.parseJSON(t)}catch(s){alert(s+" "+t)}if(cachedResults.success===!0){if(1==cachedResults.totalResults){var l=cachedResults.matches[0].objectId;$.cookie("lastSearch",e),window.location.hash="",window.location.pathname=basePath+"/asset/viewAsset/"+l}processSearchResults(cachedResults),newArray=$.merge(cachedResults.matches,a),cachedResults.searchResults=$.merge(cachedResults.searchResults,i),cachedResults.matches=newArray}}})}function processSearchResults(e){populateSearchFields(e.searchEntry),populateSearchResults(e),0===e.matches.length&&(dataAvailable=!1),previousEventComplete=!0}function getSuggestions(e){var t=e;$.post(basePath+"search/getSuggestion",{searchTerm:e},function(e,a){var n=$.parseJSON(e);if(0!==n.length){$.each(n,function(e,a){var n=new RegExp(e,"ig");t=t.replace(n,a)});var i=$("<a>").addClass("useSuggest").append(t),s=$("<i>").append(i),l=$("<div>").addClass("col-sm-12 suggestionText").append("Did you mean: ").append(s).append(" ?");$(".suggest").empty(),$(".suggest").append(l)}})}function populateSearchFields(e){$(".collectionSelector").prop("checked",!1),$("#showHidden").prop("checked",!1),$(".advancedOption").val(),e.searchText.length>0&&getSuggestions(e.searchText),$.each(e,function(e,t){$("#"+e).val(t)})}function populateSearchResults(e){var t=$(targetTemplate).html(),a=Handlebars.compile(t),n=$(listTemplate).html(),i=Handlebars.compile(n);$.each(e.matches,function(t,n){n.base_url=basePath,n.searchObject=e;var s=a(n),l=i(n);$("#results").append(s),$("#listResults").append(l)}),$('a[href="#map"]').parent().hasClass("active")&&prepMap(),$('a[href="#timeline"]').parent().hasClass("active")&&prepTimeline(),$('a[href="#gallery"]').parent().hasClass("active"),$('a[href="#grid"]').parent().hasClass("active"),$('a[href="#list"]').parent().hasClass("active"),$(".resultsData").html("<p>Total Results: "+e.totalResults+"</p>"),dataAvailable&&e.matches.length<e.totalResults&&e.totalResults<1e3&&$(".resultsData p").append(" <a href='' id='loadAllResults'>[Load All]</a>"),e.totalResults>e.matches.length?($(".paginationBlock").show(),resultsAvailable=!0):($(".paginationBlock").hide(),resultsAvailable=!1),null!==searchId&&doSearch(searchId,currentPageNumber+1,!1,!0)}function prepMap(){$("#mapPane").removeData(),$("#mapPane").goMap({mapTypeControl:!0,maptype:"ROADMAP",mapTypeControlOptions:{position:"TOP_RIGHT",style:"DROPDOWN_MENU"},addMarker:"single"});var e=new OverlappingMarkerSpiderfier($.goMap.map,spiderConfig);$.goMap.getMarkerCount()>0&&$.goMap.clearMarkers(),$.each(cachedResults.matches,function(t,n){n.locations&&$.each(n.locations,function(t,i){$.each(i.entries,function(t,i){loc=i.loc.coordinates,n.base_url=basePath;var s=MarkerTemplate(n),l=$.goMap.getMarkers("markers");if(0===loc[1]&&0===loc[0])return!0;if(latlng=new google.maps.LatLng(loc[1],loc[0]),finalLatLng=latlng,0!=l.length)for(a=0;a<l.length;a++){var r=l[a];r.getPosition()}else finalLatLng=latlng;var o=$.goMap.createMarker({longitude:finalLatLng.lng(),latitude:finalLatLng.lat(),html:s});e.addMarker(o)})})});var t=[];for(var a in $.goMap.markers){var n=$($.goMap.mapId).data($.goMap.markers[a]);t.push(n)}new google.maps.InfoWindow;e.addListener("click",function(e,t){}),e.addListener("spiderfy",function(e){});var i=new MarkerClusterer($.goMap.map,t);i.setMaxZoom(15),$.goMap.fitBounds()}function prepTimeline(){var e=null,t=null;if(void 0===Timeline||void 0===Timeline.DateTime||void 0===Timeline.DefaultEventSource||void 0===Timeline.strings||void 0===Timeline.GregorianDateLabeller.monthNames)return void setTimeout(function(){prepTimeline()},1e3);$("#timelinePane").empty();var a=!1;null===cachedDates&&(cachedDates={events:[]},$.each(cachedResults.matches,function(e,t){t.dates&&$.each(t.dates,function(e,t){$.each(t.dateAsset,function(e,t){t.start&&(startTime=parseInt(t.start.numeric,10),startTime<-6373557595440&&(a=!0))})})}),$.each(cachedResults.matches,function(n,i){i.dates&&$.each(i.dates,function(n,s){$.each(s.dateAsset,function(n,s){if(s.start&&s.start.numeric.toString().length>0){var l=null,r=null,o=null,c=null,u=null;l=parseInt(s.start.numeric,10),a?o=Timeline.GeochronoUnit.wrapMA(Math.abs(l/315569e8)):(u=new Date(1970,0,1),u.setSeconds(l),o=Date.utc.create(u)),formattedValue={miscData:i,title:i.title,id:"/en/"+i.objectId,start:o,image:basePath+"asset/previewImage/"+i.objectId,link:basePath+"asset/viewAsset/"+i.objectId,description:"Caption goeshere"},s.end.numeric&&s.end.numeric.length>0&&(r=parseInt(s.end.numeric,10),a?c=Timeline.GeochronoUnit.wrapMA(Math.abs(r/315569e8)):(u=new Date(1970,0,1),u.setSeconds(r),c=Date.utc.create(u)),formattedValue.end=c,formattedValue.durationEvent=!0),(null===e||l<e)&&(e=l),(null===t||l>t)&&(t=l),r>t&&(t=r),cachedDates.events.push(formattedValue)}})})})),eventSource&&eventSource.clear();Timeline.DefaultEventSource.Event.prototype.fillInfoBubble;Timeline.DefaultEventSource.Event.prototype.fillInfoBubble=function(e,t,a){var n=this,i=document.createElement("div");i.innerHTML=MarkerTemplate(n._obj.miscData),e.appendChild(i)},eventSource=a?new Timeline.DefaultEventSource(new SimileAjax.EventIndex(Timeline.GeochronoUnit)):new Timeline.DefaultEventSource(0),eventSource.loadJSON(cachedDates,"localJson");var n=Timeline.ClassicTheme.create(),i=null,s=null;if(a)s=Math.abs((e+t)/2/315569e8),i=Timeline.GeochronoUnit.wrapMA(s);else{s=(e+t)/2;var l=new Date(1970,0,1);l.setSeconds(s),i=Date.create(l)}var r=t-e,o=null,c=null,u=200;r<3600?(o=Timeline.DateTime.MINUTE,c=Timeline.DateTime.HOUR):r<86400?(o=Timeline.DateTime.HOUR,c=Timeline.DateTime.DAY):r<2592e3?(o=Timeline.DateTime.DAY,c=Timeline.DateTime.MONTH):r<31104e3?(o=Timeline.DateTime.MONTH,c=Timeline.DateTime.YEAR):r<31104e4?(o=Timeline.DateTime.YEAR,c=Timeline.DateTime.DECADE):r<31104e5?(o=Timeline.DateTime.DECADE,c=Timeline.DateTime.CENTURY):r<31104e6?(o=Timeline.DateTime.CENTURY,c=Timeline.DateTime.MILLENNIUM):(o=Timeline.DateTime.MILLENNIUM,c=Timeline.DateTime.MILLENNIUM,u=80),a&&(o=Timeline.GeochronoUnit.MA,c=Timeline.GeochronoUnit.EPOCH),SimileAjax.History.enabled=!1;var h;a?(h=[Timeline.Geochrono.createBandInfo({eventSource:eventSource,timeZone:-1*((new Date).getTimezoneOffset()/60),date:i,width:"86%",intervalUnit:o,intervalPixels:100,trackGap:.2,trackHeight:1.3,theme:n,eventPainter:Timeline.CompactEventPainter,eventPainterParams:{iconLabelGap:5,labelRightMargin:20,iconWidth:80,iconHeight:80,stackConcurrentPreciseInstantEvents:{limit:5,moreMessageTemplate:"%0 More Events",icon:"no-image-80.png",iconWidth:80,iconHeight:80}}}),Timeline.Geochrono.createBandInfo({width:"10%",timeZone:-1*((new Date).getTimezoneOffset()/60),intervalUnit:c,intervalPixels:u,eventSource:eventSource,date:i,theme:n,overview:"overview"})],h[1].syncWith=0,h[1].highlight=!0):(h=[Timeline.createBandInfo({width:"90%",intervalUnit:o,timeZone:-1*((new Date).getTimezoneOffset()/60),intervalPixels:200,eventSource:eventSource,date:i,theme:n,eventPainter:Timeline.CompactEventPainter,eventPainterParams:{iconLabelGap:5,labelRightMargin:20,iconWidth:80,iconHeight:80,stackConcurrentPreciseInstantEvents:{limit:5,moreMessageTemplate:"%0 More Events",icon:"/assets/timeline_js/images/blue-circle.png",iconWidth:80,iconHeight:80}}}),Timeline.createBandInfo({width:"10%",timeZone:-1*((new Date).getTimezoneOffset()/60),intervalUnit:c,intervalPixels:u,eventSource:eventSource,date:i,theme:n,overview:"overview"})],h[1].syncWith=0,h[1].highlight=!0),a?tl=Timeline.create(document.getElementById("timelinePane"),h,Timeline.HORIZONTAL,Timeline.GeochronoUnit):tl=Timeline.create(document.getElementById("timelinePane"),h,Timeline.HORIZONTAL)}var MarkerSource,MarkerTemplate,cachedResults="",cachedDates=null,searchId=null,currentPageNumber,eventSource,resultsAvailable=!0,previousEventComplete=!0,dataAvailable=!0,disableHashChange=!1;$(document).ready(function(){$(window).scroll(function(){resultsAvailable&&$(document).height()-50<=$(window).scrollTop()+$(window).height()&&("Grid"==$(".nav-tabs .active").text()||"List"==$(".nav-tabs .active").text())&&previousEventComplete&&dataAvailable&&doSearch(searchId,currentPageNumber+1)}),$(window).bind("hashchange",function(e){parseHash()}),setTimeout(function(){$.getScript("/assets/timeline_js/ext/geochrono/geochrono-api.js")},1e3),$(".searchText").on("blur",function(){$(".advancedSearchText").val($(".searchText").val())}),$(".advancedSearchText").on("blur",function(){$(".searchText").val($(".advancedSearchText").val())}),$('a[href="#timeline"]').on("shown.bs.tab",function(){cachedDates=null,prepTimeline()}),$('a[href="#map"]').on("shown.bs.tab",function(){prepMap()}),$('a[href="#gallery"]').on("shown.bs.tab",function(){}),$('a[href="#grid"]').on("shown.bs.tab",function(){$("#results").find("img").trigger("show")}),$('a[href="#list"]').on("shown.bs.tab",function(){$("#listResults").find("img").trigger("show")}),$(".previousPage").on("click",function(){return doSearch(searchId,currentPageNumber-1),!1}),$(".nextPage").on("click",function(){return doSearch(searchId,currentPageNumber+1),!1}),MarkerSource=$("#marker-template").html(),MarkerTemplate=Handlebars.compile(MarkerSource)}),$(document).on("click",".assetLink",function(){$.cookie("lastSearch",searchId)}),$(document).on("click",".useSuggest",function(){$(".searchText").val($(this).text()),$(".searchForm").submit()}),$(document).on("change",".sortBy",function(){$(".hiddenSort").val($(this).val()),$(".searchForm").submit()}),$(document).on("click","#loadAllResults",function(e){e.preventDefault(),dataAvailable&&(doSearch(searchId,currentPageNumber+1,!0),dataAvailable=!1,$("#loadAllResults").hide())});var spiderConfig={keepSpiderfied:!0,event:"mouseover"};
//# sourceMappingURL=search.min.js.map
