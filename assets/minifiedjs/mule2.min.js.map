{"version":3,"sources":["mule2.js"],"names":["namespace","h","s","CryptoJS","f","t","lib","g","j","Base","extend","a","prototype","this","c","mixIn","hasOwnProperty","init","$super","apply","arguments","create","toString","clone","q","WordArray","words","sigBytes","length","u","stringify","concat","d","b","clamp","e","push","ceil","call","slice","random","v","enc","Hex","join","parse","parseInt","substr","k","Latin1","String","fromCharCode","charCodeAt","l","Utf8","decodeURIComponent","escape","Error","unescape","encodeURIComponent","x","BufferedBlockAlgorithm","reset","_data","_nDataBytes","_append","_process","blockSize","max","_minBufferSize","min","m","_doProcessBlock","splice","Hasher","cfg","_doReset","update","finalize","_doFinalize","_createHelper","_createHmacHelper","w","HMAC","algo","Math","sqrt","pow","SHA256","_hash","p","n","r","floor","HmacSHA256","_hasher","_oKey","_iKey","undefined","ArrayBuffer","Uint8Array","Int8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","buffer","byteOffset","byteLength","XHR","args","headers","method","xhr","XMLHttpRequest","load_callback","addEventListener","error_callback","state_change_callback","progress_callback","upload","timeout_callback","url","extra_params","param_name","indexOf","header","open","setRequestHeader","body","send","mule_upload","settings","log","console","i","GB","File","webkitSlice","mozSlice","FileList","Blob","navigator","userAgent","Uploader","input","file_input","file","chunk_size","max_size","num_workers","key","bucket","host","location","protocol","access_key","content_type","acl","on_progress","on_chunk_progress","on_select","on_error","on_complete","on_init","on_start","on_chunk_uploaded","ajax_base","accepted_extensions","set_state","onchange","force","get_state","target","files","upload_file","setTimeout","lastModifiedDate","lastModified","round","Date","now","size","alert","file_extension","name","replace","split","pop","extensions_array","file_accepted","filename","filesize","mime_type","collectionId","last_modified","json","JSON","responseText","date","auth","upload_id","chunks","backup_key","load_file","AmazonXHR","list","parts","chunk","set_progress","get_chunk_size","set_chunk_finished","set_chunk_uploading","_loaded_chunks","_progress","_total_progress","_uploading_chunks","_chunks","xml","responseXML","getElementsByTagName","textContent","_start_fired","get_total_progress","next_chunk","get_next_chunk","upload_chunk","upload_finished","finish_upload","get_chunk_uploading","is_chunk_loaded","start","end","last_progress_time","_intervals","error_handled","error_handler","error_arguments","check_already_uploaded","notify_upload_finished","abort","clearInterval","loaded","readyState","DONE","status","notify_chunk_uploaded","interval","setInterval","_chunk_xhr","handler","update_chunks","cancel","num_chunks","finish","callback","path","_init_chunks","part_number","add_loaded_chunk","is_selected","_state","state","log_status","val","is_last_chunk","querystring","uploadId","data","payload","marker","window","debug","xml_parts","etag","part_marker","new_parts","chunk_num","callbacks","xhr_callback","readystate_callback","Object","partNumber","uploads","x-amz-acl","Content-Disposition","Content-Type","request_date","date_string","getUTCFullYear","utils","zfill","getUTCMonth","getUTCDate","uriencode","iso8601","region","header_keys","sort","get_authorization_header","first","get_sorted_keys","signed_headers","toLowerCase","canonical_request","get_canonical_request","string_to_sign","get_string_to_sign","sign_request","request","toUpperCase","value","querystring_keys","trim","time","to_sign","signature","string","output","ch","obj","keys","getUTCHours","getUTCMinutes","getUTCSeconds","str","num"],"mappings":"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","file":"mule2.min.js","sourcesContent":["/**\n * mule-uploader.js\n *\n * Copyright 2012-2014, Gabriel Purcaru\n * Released under GPL License.\n * License: http://www.gnu.org/copyleft/gpl.html\n */\n\n\n(function(namespace){\n    /*\n    CryptoJS v3.1.2\n    code.google.com/p/crypto-js\n    (c) 2009-2013 by Jeff Mott. All rights reserved.\n    code.google.com/p/crypto-js/wiki/License\n    */\n    var CryptoJS=CryptoJS||function(h,s){var f={},t=f.lib={},g=function(){},j=t.Base={extend:function(a){g.prototype=this;var c=new g;a&&c.mixIn(a);c.hasOwnProperty(\"init\")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty(\"toString\")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},\n    q=t.WordArray=j.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=s?c:4*a.length},toString:function(a){return(a||u).stringify(this)},concat:function(a){var c=this.words,d=a.words,b=this.sigBytes;a=a.sigBytes;this.clamp();if(b%4)for(var e=0;e<a;e++)c[b+e>>>2]|=(d[e>>>2]>>>24-8*(e%4)&255)<<24-8*((b+e)%4);else if(65535<d.length)for(e=0;e<a;e+=4)c[b+e>>>2]=d[e>>>2];else c.push.apply(c,d);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<\n    32-8*(c%4);a.length=h.ceil(c/4)},clone:function(){var a=j.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],d=0;d<a;d+=4)c.push(4294967296*h.random()|0);return new q.init(c,a)}}),v=f.enc={},u=v.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++){var e=c[b>>>2]>>>24-8*(b%4)&255;d.push((e>>>4).toString(16));d.push((e&15).toString(16))}return d.join(\"\")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b+=2)d[b>>>3]|=parseInt(a.substr(b,\n    2),16)<<24-4*(b%8);return new q.init(d,c/2)}},k=v.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++)d.push(String.fromCharCode(c[b>>>2]>>>24-8*(b%4)&255));return d.join(\"\")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b++)d[b>>>2]|=(a.charCodeAt(b)&255)<<24-8*(b%4);return new q.init(d,c)}},l=v.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch(c){throw Error(\"Malformed UTF-8 data\");}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},\n    x=t.BufferedBlockAlgorithm=j.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(a){\"string\"==typeof a&&(a=l.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,d=c.words,b=c.sigBytes,e=this.blockSize,f=b/(4*e),f=a?h.ceil(f):h.max((f|0)-this._minBufferSize,0);a=f*e;b=h.min(4*a,b);if(a){for(var m=0;m<a;m+=e)this._doProcessBlock(d,m);m=d.splice(0,a);c.sigBytes-=b}return new q.init(m,b)},clone:function(){var a=j.clone.call(this);\n    a._data=this._data.clone();return a},_minBufferSize:0});t.Hasher=x.extend({cfg:j.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){x.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,d){return(new a.init(d)).finalize(c)}},_createHmacHelper:function(a){return function(c,d){return(new w.HMAC.init(a,\n    d)).finalize(c)}}});var w=f.algo={};return f}(Math);\n    (function(h){for(var s=CryptoJS,f=s.lib,t=f.WordArray,g=f.Hasher,f=s.algo,j=[],q=[],v=function(a){return 4294967296*(a-(a|0))|0},u=2,k=0;64>k;){var l;a:{l=u;for(var x=h.sqrt(l),w=2;w<=x;w++)if(!(l%w)){l=!1;break a}l=!0}l&&(8>k&&(j[k]=v(h.pow(u,0.5))),q[k]=v(h.pow(u,1/3)),k++);u++}var a=[],f=f.SHA256=g.extend({_doReset:function(){this._hash=new t.init(j.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],m=b[2],h=b[3],p=b[4],j=b[5],k=b[6],l=b[7],n=0;64>n;n++){if(16>n)a[n]=\n    c[d+n]|0;else{var r=a[n-15],g=a[n-2];a[n]=((r<<25|r>>>7)^(r<<14|r>>>18)^r>>>3)+a[n-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+a[n-16]}r=l+((p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25))+(p&j^~p&k)+q[n]+a[n];g=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&m^f&m);l=k;k=j;j=p;p=h+r|0;h=m;m=f;f=e;e=r+g|0}b[0]=b[0]+e|0;b[1]=b[1]+f|0;b[2]=b[2]+m|0;b[3]=b[3]+h|0;b[4]=b[4]+p|0;b[5]=b[5]+j|0;b[6]=b[6]+k|0;b[7]=b[7]+l|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;\n        d[e>>>5]|=128<<24-e%32;d[(e+64>>>9<<4)+14]=h.floor(b/4294967296);d[(e+64>>>9<<4)+15]=b;a.sigBytes=4*d.length;this._process();return this._hash},clone:function(){var a=g.clone.call(this);a._hash=this._hash.clone();return a}});s.SHA256=g._createHelper(f);s.HmacSHA256=g._createHmacHelper(f)})(Math);\n    (function(h){for(var s=CryptoJS,f=s.lib,g=f.WordArray,q=f.Hasher,f=s.algo,m=[],r=[],l=function(a){return 4294967296*(a-(a|0))|0},k=2,n=0;64>n;){var j;a:{j=k;for(var u=h.sqrt(j),t=2;t<=u;t++)if(!(j%t)){j=!1;break a}j=!0}j&&(8>n&&(m[n]=l(h.pow(k,0.5))),r[n]=l(h.pow(k,1/3)),n++);k++}var a=[],f=f.SHA256=q.extend({_doReset:function(){this._hash=new g.init(m.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],g=b[2],j=b[3],h=b[4],m=b[5],n=b[6],q=b[7],p=0;64>p;p++){if(16>p)a[p]=\n    c[d+p]|0;else{var k=a[p-15],l=a[p-2];a[p]=((k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3)+a[p-7]+((l<<15|l>>>17)^(l<<13|l>>>19)^l>>>10)+a[p-16]}k=q+((h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25))+(h&m^~h&n)+r[p]+a[p];l=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&g^f&g);q=n;n=m;m=h;h=j+k|0;j=g;g=f;f=e;e=k+l|0}b[0]=b[0]+e|0;b[1]=b[1]+f|0;b[2]=b[2]+g|0;b[3]=b[3]+j|0;b[4]=b[4]+h|0;b[5]=b[5]+m|0;b[6]=b[6]+n|0;b[7]=b[7]+q|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;\n    d[e>>>5]|=128<<24-e%32;d[(e+64>>>9<<4)+14]=h.floor(b/4294967296);d[(e+64>>>9<<4)+15]=b;a.sigBytes=4*d.length;this._process();return this._hash},clone:function(){var a=q.clone.call(this);a._hash=this._hash.clone();return a}});s.SHA256=q._createHelper(f);s.HmacSHA256=q._createHmacHelper(f)})(Math);\n    (function(){var h=CryptoJS,s=h.enc.Utf8;h.algo.HMAC=h.lib.Base.extend({init:function(f,g){f=this._hasher=new f.init;\"string\"==typeof g&&(g=s.parse(g));var h=f.blockSize,m=4*h;g.sigBytes>m&&(g=f.finalize(g));g.clamp();for(var r=this._oKey=g.clone(),l=this._iKey=g.clone(),k=r.words,n=l.words,j=0;j<h;j++)k[j]^=1549556828,n[j]^=909522486;r.sigBytes=l.sigBytes=m;this.reset()},reset:function(){var f=this._hasher;f.reset();f.update(this._iKey)},update:function(f){this._hasher.update(f);return this},finalize:function(f){var g=\n    this._hasher;f=g.finalize(f);g.reset();return g.finalize(this._oKey.clone().concat(f))}})})();\n    (function(){if(undefined!==typeof ArrayBuffer){var b=CryptoJS.lib.WordArray,e=b.init;(b.init=function(a){a instanceof ArrayBuffer&&(a=new Uint8Array(a));if(a instanceof Int8Array||a instanceof Uint8ClampedArray||a instanceof Int16Array||a instanceof Uint16Array||a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array)a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);if(a instanceof Uint8Array){for(var b=a.byteLength,d=[],c=0;c<b;c++)d[c>>>2]|=a[c]<<\n    24-8*(c%4);e.call(this,d,b)}else e.apply(this,arguments)}).prototype=b}})();\n\n    // AJAX helper. It takes an object that contains load_callback, error_callback,\n    // url, method, headers, state_change_callback, progress_callback\n    var XHR = function(args) {\n        // the user may or may not pass any headers\n        args.headers = args.headers || {};\n\n        // if no method is given, default to GET\n        args.method = args.method || \"GET\";\n\n        var xhr = new XMLHttpRequest();\n\n        // set the \"load\" callback if given\n        if(args.load_callback && typeof args.load_callback == 'function') {\n            xhr.addEventListener(\"load\", args.load_callback, true);\n        }\n\n        // set the \"error\" callback if given\n        if(args.error_callback && typeof args.error_callback == 'function') {\n            xhr.addEventListener(\"error\", args.error_callback, true);\n        }\n\n        // set the \"readystatechange\" callback if given\n        if(args.state_change_callback && typeof args.state_change_callback == 'function') {\n            xhr.addEventListener(\"readystatechange\", args.state_change_callback);\n        }\n\n        // set the \"progress\" callback if given\n        if(args.progress_callback && typeof args.progress_callback == 'function') {\n            xhr.upload.addEventListener(\"progress\", args.progress_callback);\n        }\n\n        // set the \"timeout\" callback if given\n        if(args.timeout_callback && typeof args.timeout_callback == 'function') {\n            xhr.addEventListener('timeout', args.timeout_callback);\n        }\n\n        // adding extra params as needed\n        var url = args.url;\n        if(args.extra_params) {\n            for(var param_name in args.extra_params) {\n                if(args.extra_params.hasOwnProperty(param_name)) {\n                    if(url.indexOf('?') !== -1) {\n                        url += \"&\";\n                    } else {\n                        url += \"?\";\n                    }\n\n                    url += encodeURIComponent(param_name) + \"=\";\n                    url += encodeURIComponent(args.extra_params[param_name]);\n                }\n            }\n        }\n\n        // open the xhr connection\n        xhr.open(args.method, url);\n\n        // set the headers\n        for(var header in args.headers) {\n            if(args.headers.hasOwnProperty(header)) {\n                xhr.setRequestHeader(header, args.headers[header]);\n            }\n        }\n\n        // send the ajax call\n        if(args.body) {\n            xhr.send(args.body);\n        } else {\n            xhr.send();\n        }\n        return xhr;\n    };\n\n    namespace.mule_upload = function(settings) {\n        var debug = true;\n\n        // custom logging function that prepends a text for easy identification;\n        // it is also toggled by the `debug` flag\n        var log = function() {};\n        if(debug && console && console.log) {\n            log = function() {\n                var args = [\"[MuleUploader]\"];\n                for(var i=0; i<arguments.length; i++) {\n                    args.push(arguments[i]);\n                }\n                return console.log.apply(console, args);\n            };\n        }\n\n        // helper constants for more readable code\n        var KB = 1024;\n        var MB = 1024 * KB;\n        var GB = 1024 * MB;\n\n        // for new webkit browsers, the .slice() method is named .webkitSlice()\n        // similar for mozilla\n        File.prototype.slice = File.prototype.webkitSlice || File.prototype.mozSlice || File.prototype.slice;\n\n        // verify that the browser has the needed HTML5 capabilities\n        if(!(namespace.File && namespace.FileList && namespace.Blob)) {\n            log(\"HTML5 APIs not available.\");\n            return -1;\n        }\n        if(navigator.userAgent.indexOf(\"Firefox\") !== -1) {\n            try {\n                new Blob([\"something\"]);\n            } catch(e) {\n                return -1;\n            }\n        }\n        log(\"OK\");\n\n        function Uploader(settings) {\n            // `u` is often used as an alias for `this` to be used in nested closures\n            var u = this;\n\n            settings = settings || {};\n\n            // make the input element another possible setting\n            // in some cases (e.g. drag & drop) there is no input element\n            u.input = settings.file_input;\n            u.file  = settings.file;\n\n            // NOTE: For Amazon S3, the minimum chunk size is 5MB\n            // we are using 6 for safe measure. Note that the maximum number of chunks\n            // is 10,000, so for example, if the chunk size is 6MB, the maximum\n            // possible file size is 6MB * 10,000 = ~58GB\n            settings.chunk_size = settings.chunk_size || (6 * MB); // default 6MB\n            settings.max_size = settings.max_size || 5 * GB; // 5GB\n\n            // the number of parallel upload xhr's\n            settings.num_workers = settings.num_workers || 4;\n\n            // the S3 object key; I recommend to generate this dynamically (e.g.\n            // a random string) to avoid unwanted overwrites.\n            settings.key = settings.key || \"the_key\";\n\n            // the Amazon S3 bucket where you'll store the uploads\n            settings.bucket = settings.bucket;\n            settings.host = settings.host || location.protocol + \"//\" + settings.bucket + \".s3.amazonaws.com\";\n\n            // the Amazon S3 access key. DO NOT give the AWS Secret code!\n            settings.access_key = settings.access_key;\n\n            // the Mime-Type of the content. You must match this with the backend value\n            // or you'll get an Invalid Signature error. If unsure about the\n            // mime type, use application/octet-stream\n            settings.content_type = settings.content_type || \"application/octet-stream\";\n\n\n            // acl can be set to:\n            // private\n            // public-read (* default)\n            // public-read-write\n            // authenticated-read\n            // bucket-owner-read\n            // bucket-owner-full-control\n            // log-delivery-write\n            settings.acl = settings.acl || 'public-read';\n\n            // various callbacks\n            settings.on_progress = settings.on_progress || function() {};\n            settings.on_chunk_progress = settings.on_chunk_progress || function() {};\n            settings.on_select = settings.on_select || function() {};\n            settings.on_error = settings.on_error || function() {};\n            settings.on_complete = settings.on_complete || function() {};\n            settings.on_init = settings.on_init || function() {};\n            settings.on_start = settings.on_start || function() {};\n            settings.on_chunk_uploaded = settings.on_chunk_uploaded || function() {};\n\n            // extra parameters to give to the backend\n            settings.extra_params = settings.extra_params || {};\n\n            // the location prefix of the uploader's backend\n            settings.ajax_base = settings.ajax_base || \"/upload-backend\";\n\n            //extensions comma delimited without period (jpg,jpeg,png,gif)\n            settings.accepted_extensions = settings.accepted_extensions || \"\";\n\n            // set the values so that they can be used everywhere, as needed\n            u.settings = settings;\n\n            // the \"waiting\" state means the uploader is waiting for the user\n            // to select a file\n            u.set_state(\"waiting\");\n\n            if (u.input) {\n                u.input.onchange = function(e, force) {\n                    // the `onchange` event may be triggered multiple times, so we\n                    // must ensure that the callback is only executed the first time\n                    if(u.get_state() != \"waiting\") {\n                        return false;\n                    }\n\n                    // the uploader doesn't support multiple uploads at this time,\n                    // so we get the first file\n                    var file = e.target.files[0];\n                    u.upload_file(file, force);\n                    return true;\n                };\n            }\n\n            // trigger the init event callback\n            setTimeout(function() {\n                u.settings.on_init.apply(u);\n            }, 100);\n        }\n\n        Uploader.prototype.upload_file = function(file, force) {\n            var u = this;\n            // the `onchange` event may be triggered multiple times, so we\n            // must ensure that the callback is only executed the first time\n            // also make sure the file is not already set.\n            if(u.get_state() != \"waiting\") {\n                return false;\n            }\n\n            if (file) {\n                u.file = file;\n            }\n\n            if (!u.file) {\n                return false;\n            }\n\n            // we use the lastModifiedDate, the file name and size to uniquely\n            // identify a file. There may be false positives and negatives,\n            // but the chance for a false positive is basically zero\n            // some browsers don't report the last modified date, so we default\n            // to a blank date\n            u.file.lastModifiedDate = u.file.lastModified || Math.round(Date.now() / 1000);\n\n            if(u.file.size > u.settings.max_size) {\n                alert(\n                    [\"The maximum allowed file size is \",\n                    (u.settings.max_size / GB),\n                    \"GB. Please select another file.\"].join('')\n                );\n                return false;\n            }\n\n            // check for accepted extensions, if applicable\n            if(u.settings.accepted_extensions) {\n                // get the file extension\n                var file_extension = file.name.replace(/[^A-Za-z 0-9 \\.,\\?\"\"!@#\\$%\\^&\\*\\(\\)-_=\\+;:<>\\/\\\\\\|\\}\\{\\[\\]`~]*/g, '').split('.').pop();\n\n                // split the given extensions into an array\n                var extensions_array = u.settings.accepted_extensions.split(',');\n\n                // and match the extension against the given extension list\n                var file_accepted = false;\n                for(var i=0; i<extensions_array.length; i++) {\n                    if(file_extension == extensions_array[i]) {\n                        file_accepted = true;\n                        break;\n                    }\n                }\n\n                // if the file is not accepted, notify the user and return\n                if(!file_accepted) {\n                    alert(\n                        [\"This file format is not accepted. \",\n                        \"Please use a file with an extension like \",\n                        u.settings.accepted_extensions].join('')\n                    );\n                    return false;\n                }\n            }\n\n            // initialize the file upload\n            u.settings.on_select.call(u, file);\n            var args = {\n                filename: file.name.replace(/[^A-Za-z 0-9 \\.,\\?\"\"!@#\\$%\\^&\\*\\(\\)-_=\\+;:<>\\/\\\\\\|\\}\\{\\[\\]`~]*/g, '').replace(/\\s\\s+/g, ' '),\n                filesize: file.size,\n                key: u.settings.key,\n                mime_type: u.settings.content_type,\n                collectionId: u.settings.collectionId,\n                last_modified: file.lastModifiedDate\n            };\n            if(force) {\n                args.force = true;\n            }\n\n            // get the signing key. It will also return\n            // a file key + upload_id pair if the selected file\n            // is already uploading. It also returns a\n            // backup_key in case that file upload already completed.\n            // The signing key is valid for 7 days\n            XHR({\n                url: u.settings.ajax_base + \"/signing_key/\",\n                extra_params: args,\n                load_callback: function(e) {\n                    var json = JSON.parse(e.target.responseText);\n                    json.date = new Date(json.date  + '.000Z');\n                    u.auth = json;\n                    u.upload_id = json.upload_id;\n                    u.chunks = json.chunks;\n                    u.settings.key = json.key || u.settings.key;\n                    u.settings.backup_key = u.settings.key;\n                    if(!u.upload_id) {\n                        console.log(json);\n                        AmazonXHR.init(json, u.settings.key, file, function(e) {\n                            var xml = e.target.responseXML;\n                            // get the given upload id\n                            u.upload_id = xml.getElementsByTagName('UploadId')[0].textContent;\n\n                            u.load_file();\n                        });\n                    } else {\n                        // resume a previus upload\n                        if(!force) {\n                            // get the uploaded parts from S3\n                            AmazonXHR.list(u.auth, u.file, u.settings.key, u.upload_id, u.settings.chunk_size, function(parts) {\n                                for(var i=0; i<parts.length; i++) {\n                                    var chunk = parts[i][0] - 1;\n                                    u.set_progress(chunk, u.get_chunk_size(chunk));\n                                    u.set_chunk_finished(chunk);\n                                    u.set_chunk_uploading(chunk, false);\n                                }\n                                u.load_file();\n                            }, function() {\n                                // if it fails, re-initiate the upload, and force\n                                // it to start a new upload\n                                u.upload_id = null;\n                                this._loaded_chunks = null;\n                                u._progress = null;\n                                u._total_progress = null;\n                                u._loaded_chunks = null;\n                                u._uploading_chunks = null;\n                                u._chunks = null;\n                                u.settings.key = u.settings.backup_key;\n                                u.upload_file(file, true); // force reload\n                            });\n                        } else {\n                            // force-start the upload\n                            u.load_file();\n                        }\n                    }\n                }\n            });\n        };\n\n        // this initiates the file upload\n        Uploader.prototype.load_file = function() {\n            var u = this;\n\n            // we can't start the upload if we are waiting for user input\n            if(u.get_state() != \"waiting\") {\n                return;\n            }\n\n            // make sure we only trigger the start event once\n            if(!u._start_fired) {\n                // trigger the start event callback\n                u.settings.on_start.call(u, u.file);\n\n                // and also trigger a progress callback with 0%\n                u.settings.on_progress.call(u, 0, u.file.size);\n                u._start_fired = true;\n            }\n\n            // from now on, we are \"processing\" the file upload\n            u.set_state(\"processing\");\n\n            // at this point we may have some chunks already uploaded,\n            // so we may trigger a progress callback with the reported progress\n            u.settings.on_progress.call(u, u.get_total_progress(), u.file.size);\n\n            // get the next chunk\n            var next_chunk = u.get_next_chunk();\n\n            if(next_chunk != -1) {\n                // and start uploading it\n                u.upload_chunk(next_chunk);\n            } else if(u.upload_finished()) {\n                // if we finished, trigger the upload finish sequence\n                log(\"All done; finish upload\");\n                u.finish_upload();\n            }\n\n            for(var i=0; i < u.settings.num_workers - 1; i++) {\n                next_chunk = u.get_next_chunk();\n                if(next_chunk !== -1) {\n                    u.upload_chunk(next_chunk);\n                } else {\n                    break;\n                }\n            }\n        };\n\n        // this uploads a single chunk to S3\n        Uploader.prototype.upload_chunk = function(chunk) {\n            var u = this;\n            // make sure we're in processing mode\n            if(u.get_state() != \"processing\") {\n                log(\"NOT processing; return\");\n                return;\n            }\n\n            // also make sure we're not already uploading this chunk\n            if(u.get_chunk_uploading(chunk)) {\n                log(\"Already Uploading\");\n                setTimeout(function() {\n                    var next_chunk = u.get_next_chunk();\n                    if(next_chunk !== -1) {\n                        u.upload_chunk(u.get_next_chunk());\n                    }\n                }, 1000);\n                return;\n            } else {\n                // mark this chunk as uploading\n                u.set_chunk_uploading(chunk);\n            }\n            log(\"Uploading Chunk: \" + chunk);\n\n            // if we already uploaded this chunk, get to the next one\n            // if there is no next chunk, finish the upload\n            if(u.is_chunk_loaded(chunk)) {\n                var next_chunk = u.get_next_chunk();\n                if(next_chunk != -1) {\n                    u.upload_chunk(next_chunk);\n                } else {\n                    if(u.upload_finished()) {\n                        log(\"No next chunk; finish upload\");\n                        u.finish_upload();\n                    }\n                }\n            }\n\n            var length = u.settings.chunk_size;\n\n            // get the start and end bytes for the needed chunk\n            var start = chunk * length;\n            var end = Math.min(start + length, u.file.size);\n\n            // we need the last progress time in order to detect hanging\n            // uploads\n            var last_progress_time = new Date();\n            u._intervals = u._intervals || {};\n\n\n            // the \"readystatechange\" handler\n            var handler = function(e) {\n                // we care about the \"done\" event triggered while processing\n                if(e.target.readyState != this.DONE || u.get_state() != \"processing\") {\n                    log(e);\n                    return;\n                }\n\n                // if we don't receive a 2XX response, trigger an error\n                if(e.target.status / 100 != 2) {\n                    return error_handler();\n                }\n\n                // at this point, we know that this chunk finished uploading\n                log(\"Chunk uploaded: \" + chunk);\n\n                // notify the server of the uploaded chunk\n                u.notify_chunk_uploaded(chunk);\n\n                // and also trigger the chunk_uploaded callback\n                u.settings.on_chunk_uploaded.call(u, chunk);\n\n                // cancel the xhr watcher interval\n                clearInterval(u._intervals[chunk]);\n\n                // mark the chunk as finished\n                u.set_progress(chunk, u.get_chunk_size(chunk));\n                u.set_chunk_finished(chunk);\n                u.set_chunk_uploading(chunk, false);\n\n                // get next chunk; if we're out of chunks,\n                // finish the upload\n                var next_chunk = u.get_next_chunk();\n                if(next_chunk != -1) {\n                    u.upload_chunk(next_chunk);\n                } else if(u.upload_finished()) {\n                    log(\"Done\");\n                    u.finish_upload();\n                } else {\n                    var interval = setInterval(function() {\n                        var chunk = u.get_next_chunk();\n                        if(chunk != -1) {\n                            clearInterval(interval);\n                            u.upload_chunk(chunk);\n                        } else if(u.upload_finished()) {\n                            clearInterval(interval);\n                            u.finish_upload();\n                        }\n                    }, 1000);\n                }\n            };\n\n            // the upload progress handler\n            var progress_handler = function(e) {\n                // set the internal chunk's progress value to the reported amount\n                u.set_progress(chunk, e.loaded);\n\n                // trigger the progress event callback\n                u.settings.on_progress.call(u, u.get_total_progress(), u.file.size);\n\n                // update the last_progress_time for the watcher interval\n                last_progress_time = new Date();\n            };\n            var error_handled = false;\n            var error_handler = function() {\n                var error_arguments = arguments;\n                var xhr = this;\n                // the upload may have finished, so check for that\n                u.check_already_uploaded(function() {\n                    // if already uploaded\n                    u.set_state(\"finished\");\n\n                    u.notify_upload_finished();\n\n                    // trigger a final progress event callback, with 100%\n                    u.settings.on_progress.call(u, u.file.size, u.file.size);\n\n                    // also trigger the complete event callback\n                    u.settings.on_complete.call(u);\n                }, function() {\n                    // we have a genuine error\n                    log(\"Error: \");\n                    log(error_arguments);\n\n                    // make sure we don't handle the same error more than once\n                    if(error_handled) {\n                        return;\n                    }\n                    error_handled = true;\n\n                    // abort the chunk upload\n                    u.set_chunk_uploading(chunk, false);\n                    u.set_chunk_finished(chunk, false);\n                    u.set_progress(chunk, 0);\n                    log(\"Abort\");\n                    try {\n                        xhr.abort();\n                    } catch(e) {\n                        log(e);\n                    }\n\n                    log(\"Retry chunk: \" + chunk);\n\n                    // clear the watcher interval\n                    clearInterval(u._intervals[chunk]);\n\n                    // re-try the upload\n                    setTimeout(function() {\n                        if(u.get_state() == \"processing\") {\n                            // and proceed\n                            var next_chunk = u.get_next_chunk(chunk);\n                            if(next_chunk !== -1) {\n                                u.upload_chunk(next_chunk);\n                            }\n                        }\n                    }, 1000);\n                });\n            };\n\n            AmazonXHR.upload_chunk(u.auth, u.settings.key, u.upload_id, chunk, u.file.slice(start, end), {\n                progress_callback: progress_handler,\n                state_change_callback: handler,\n                error_callback: error_handler,\n                timeout_callback: error_handler\n            }, function(xhr) {\n                u._chunk_xhr = u._chunk_xhr || [];\n                u._chunk_xhr.push(xhr);\n\n                // the watcher interval; it cancels the xhr if it times out\n                u._intervals[chunk] = setInterval(function() {\n                    if(last_progress_time && (new Date() - last_progress_time) > 120000) { // 15s\n                        log(\"Chunk Failed; retry\");\n                        clearInterval(u._intervals[chunk]);\n                        if(u.get_state() == \"processing\") {\n                            xhr.abort();\n                            error_handler.call(xhr);\n                            u._chunk_xhr[u._chunk_xhr.indexOf(xhr)] = null;\n                        }\n                    }\n                }, 4000); // every 4s\n            });\n        };\n\n        // initiates the upload finish sequence\n        Uploader.prototype.finish_upload = function() {\n            var u = this;\n\n            // make sure it's not triggered when not processing (e.g. multiple times)\n            if(u.get_state() != \"processing\") {\n                return;\n            }\n\n            // change the upload's state\n            u.set_state(\"finishing\");\n\n            u.settings.on_progress.call(u, u.file.size, u.file.size); // 100% done.\n\n\n            var handler = function(e) {\n                // i.e. if it's a 2XX response\n                if(e.target.status / 100 == 2) {\n                    log(\"Finished file.\");\n                    u.set_state(\"finished\");\n                    u.settings.on_progress.call(u, u.file.size, u.file.size); // it's 100% done\n\n                    // trigger the complete event callback\n                    u.settings.on_complete.call(u);\n                } else if(e.target.status == 400 &&\n                    e.target.responseText.indexOf(\"EntityTooSmall\") !== -1) {\n                    // an \"EntityTooSmall\" error means that we missed a chunk\n                    AmazonXHR.list(u.auth, u.file, u.settings.key, u.upload_id, u.settings.chunk_size, function(parts) {\n                        u.update_chunks(parts);\n                        var next_chunk = u.get_next_chunk();\n                        u.set_state(\"processing\");\n                        u.upload_chunk(next_chunk);\n                    });\n                } else if(e.target.status == 404) {\n                    // 404 = NoSuchUpload = check if already finished\n                    // if so, start a new upload\n                    u.cancel(function() {\n                        u.upload_file(u.file, true);\n                    });\n                } else {\n                    u.check_already_uploaded(function() {\n                        handler({\n                            target: {\n                                status: 200\n                            }\n                        });\n                    }, function() {\n                        handler({\n                            target: {\n                                status: 404\n                            }\n                        });\n                    });\n                }\n            };\n\n            AmazonXHR.list(u.auth, u.file, u.settings.key, u.upload_id, u.settings.chunk_size, function(parts) {\n                var num_chunks = Math.ceil(u.file.size / u.settings.chunk_size);\n\n                // check that we uploaded all the chunks; if we didn't,\n                // start uploading the missing ones\n                if(parts.length != num_chunks) {\n                    u.update_chunks(parts);\n                    var next_chunk = u.get_next_chunk();\n                    u.set_state(\"processing\");\n                    u.upload_chunk(next_chunk);\n                    return;\n                }\n\n                AmazonXHR.finish(u.auth, u.file, u.settings.key, u.upload_id, parts, u.settings.chunk_size, handler, handler);\n            });\n        };\n\n\n        // notify the server that a chunk finished uploading. This is needed for\n        // upload resumes\n        Uploader.prototype.notify_chunk_uploaded = function(chunk) {\n            var u = this;\n            if(u.get_state() != \"processing\") {\n                return;\n            }\n            var key = u.settings.key;\n            var upload_id = u.upload_id;\n            var url = u.settings.ajax_base + '/chunk_loaded/';\n            XHR({\n                url: url,\n                extra_params: {\n                    chunk: chunk,\n                    key: key,\n                    upload_id: upload_id,\n                    filename: u.file.name.replace(/[^A-Za-z 0-9 \\.,\\?\"\"!@#\\$%\\^&\\*\\(\\)-_=\\+;:<>\\/\\\\\\|\\}\\{\\[\\]`~]*/g, '').replace(/\\s\\s+/g, ' '),\n                    filesize: u.file.size,\n                    mime_type: u.settings.content_type,\n                    collectionId: u.settings.collectionId,\n                    last_modified: u.file.lastModifiedDate\n                }\n            });\n        };\n\n        // check whether the file is already uploaded\n        Uploader.prototype.check_already_uploaded = function(callback, error_callback) {\n            var u = this;\n            var method = \"HEAD\";\n            var path = \"/\" + u.settings.key;\n            var inner_handler = function(e) {\n                // the handler only checks for status code;\n                // if the HEAD returns 404, re-upload,\n                // else, it returns 200 and finish the upload\n                if(e.target.status / 100 == 2) {\n                    log(\"Already Uploaded\");\n                    callback();\n                } else {\n                    log(\"Error!\");\n                    error_callback();\n                }\n            };\n\n            if(!error_callback && typeof(error_callback) !== \"function\") {\n                error_callback = function() {\n                    setTimeout(function() {\n                        return u.check_already_uploaded(callback, error_callback);\n                    }, 2500);\n                };\n            }\n\n            XHR({\n                url: u.settings.host + path,\n                method: method,\n                load_callback: inner_handler,\n                error_callback: error_callback\n            });\n        };\n\n        // cancels an upload\n        Uploader.prototype.cancel = function(callback) {\n            // empty all fields, cancel all intervals, abort all xhr's\n            var u = this;\n            for(var i=0; i < u._chunk_xhr.length; i++) {\n                log(\"Abort chunk: \" + u._chunk_xhr[i]);\n                u._chunk_xhr[i].abort();\n            }\n            u._intervals = u._intervals || {};\n            for(var x in u._intervals) {\n                if(u._intervals.hasOwnProperty(x)) {\n                    clearInterval(u._intervals[x]);\n                }\n            }\n            callback = callback || function() {};\n            u.set_state(\"canceled\");\n            u._chunk_xhr = u._chunk_xhr || [];\n            u.settings.on_progress.call(u, 0, 0);\n            u._chunk_xhr = null;\n            u._chunks = null;\n            u._uploading_chunks = null;\n            u._loaded_chunks = null;\n            u._start_fired = false;\n            u.upload_id = null;\n            u._progress = null;\n            u.set_state(\"waiting\"); // wait for a new upload\n            callback();\n        };\n\n        // updates the chunk history with the given chunks\n        Uploader.prototype.update_chunks = function(parts) {\n            var u = this;\n            var loaded = [];\n            var num_chunks = Math.ceil(u.file.size / u.settings.chunk_size);\n\n            u._init_chunks(true);\n            u._uploading_chunks = [];\n            u._loaded_chunks = [];\n\n            var i;\n            for(i=0; i < parts.length; i++) {\n                var part_number = parseInt(parts[i][0], 10);\n                u.add_loaded_chunk(part_number - 1);\n                u.set_chunk_finished(part_number - 1);\n                loaded.push(part_number - 1);\n            }\n            for(i=0; i < num_chunks; i++) {\n                if(loaded.indexOf(i) === -1) {\n                    log(\"Chunk not uploaded: \", i);\n                    u.set_progress(i, 0);\n                }\n            }\n        };\n\n        // returns true if a file is selected\n        Uploader.prototype.is_selected = function() {\n            return !!this.file;\n        };\n\n        // returns the uploader's state\n        Uploader.prototype.get_state = function() {\n            return this._state;\n        };\n\n        // sets the uploader's state\n        Uploader.prototype.set_state = function(state) {\n            this._state = state;\n            return state;\n        };\n\n        // set a chunk's progress\n        Uploader.prototype.set_progress = function(chunk, loaded) {\n            this.log_status();\n            this._progress = this._progress || {};\n            this._total_progress = (this._total_progress || 0 ) + loaded - (this._progress[chunk] || 0);\n            this._progress[chunk] = loaded;\n            this.settings.on_chunk_progress.call(\n                this, chunk, loaded, this.get_chunk_size(chunk));\n        };\n\n        // gets the total bytes uploaded\n        Uploader.prototype.get_total_progress = function() {\n            return this._total_progress || 0;\n        };\n\n        // returns true if a chunk is already uploaded\n        Uploader.prototype.is_chunk_loaded = function(chunk) {\n            this._loaded_chunks = this._loaded_chunks || [];\n            return this._loaded_chunks.indexOf(chunk) !== -1;\n        };\n\n        // adds a chunk to the uploaded list\n        Uploader.prototype.add_loaded_chunk = function(chunk) {\n            this._loaded_chunks = this._loaded_chunks || [];\n            this._loaded_chunks.push(chunk);\n            this.set_progress(chunk, this.get_chunk_size(chunk));\n        };\n\n        // returns true if the chunk is currently uploading\n        Uploader.prototype.get_chunk_uploading = function(chunk) {\n            this._uploading_chunks = this._uploading_chunks || [];\n            return this._uploading_chunks.indexOf(chunk) !== -1;\n        };\n\n        // sets whether a chunk is currently uploading or not\n        Uploader.prototype.set_chunk_uploading = function(chunk, val) {\n            if(typeof val == \"undefined\") {\n                val = true;\n            }\n            this._uploading_chunks = this._uploading_chunks || [];\n            if(val) {\n                this._uploading_chunks.push(chunk);\n            } else {\n                var list = [];\n                for(var i=0; i < this._uploading_chunks.length; i++) {\n                    if(this._uploading_chunks[i] != chunk) {\n                        list.push(this._uploading_chunks[i]);\n                    }\n                }\n                this._uploading_chunks = list;\n            }\n        };\n\n        // initialize inner representation of chunks\n        Uploader.prototype._init_chunks = function(force) {\n            var u = this;\n            if(!u._chunks || force) {\n                u._chunks = [];\n                var num_chunks = Math.ceil(u.file.size / u.settings.chunk_size);\n                for(var i=0; i < num_chunks; i++) {\n                    u._chunks.push(false);\n                }\n            }\n        };\n\n        // sets whether a chunk finished uploading\n        Uploader.prototype.set_chunk_finished = function(chunk, val) {\n            if(typeof val == \"undefined\") {\n                val = true;\n            }\n            var u = this;\n            u._init_chunks();\n            u._chunks[chunk] = val;\n        };\n\n        // get next chunk to be uploaded; if all chunks are done, return -1\n        Uploader.prototype.get_next_chunk = function(chunk) {\n            var u = this;\n            u._init_chunks();\n            if(chunk && !u._chunks[chunk] && !u.get_chunk_uploading(chunk)) {\n                return chunk;\n            }\n            for(var i=0; i < u._chunks.length; i++) {\n                if(!u._chunks[i] && !u.get_chunk_uploading(i)) {\n                    return i;\n                }\n            }\n            return -1;\n        };\n\n        // returns true if all chunks finished uploaded\n        Uploader.prototype.upload_finished = function() {\n            var u = this;\n            u._init_chunks();\n            for(var i=0; i < u._chunks.length; i++) {\n                if(!u._chunks[i] || u.get_chunk_uploading(i)) {\n                    return false;\n                }\n            }\n            return true;\n        };\n\n        Uploader.prototype.is_last_chunk = function(chunk) {\n            return Math.ceil(this.file.size / this.settings.chunk_size) - 1 == chunk;\n        };\n\n        Uploader.prototype.get_chunk_size = function(chunk) {\n            if(this.is_last_chunk(chunk)) {\n                return this.file.size % this.settings.chunk_size;\n            } else {\n                return this.settings.chunk_size;\n            }\n        };\n\n        Uploader.prototype.log_status = function() {\n            // log(this.get_total_progress() / this.file.size * 100);\n        };\n\n        Uploader.prototype.on_chunk_progress = function(f) { this.settings.on_chunk_progress = f; };\n        Uploader.prototype.on_progress = function(f) { this.settings.on_progress = f; };\n        Uploader.prototype.on_select = function(f) { this.settings.on_select = f; };\n        Uploader.prototype.on_error = function(f) { this.settings.on_error = f; };\n        Uploader.prototype.on_complete = function(f) { this.settings.on_complete = f; };\n        Uploader.prototype.on_init = function(f) { this.settings.on_init = f; };\n        Uploader.prototype.on_start = function(f) { this.settings.on_start = f; };\n        Uploader.prototype.on_chunk_uploaded = function(f) { this.settings.on_chunk_uploaded = f; };\n\n        return new Uploader(settings);\n    };\n\n\n    var AmazonXHR = function(settings) {\n        this.settings = settings;\n    };\n    AmazonXHR.finish = function(auth, file, key, upload_id, parts, chunk_size, callback) {\n        var querystring = {\"uploadId\": upload_id};\n\n        // compose the CompleteMultipartUpload request for putting\n        // the chunks together\n        var data = \"<CompleteMultipartUpload>\";\n        for(var i=0; i<parts.length; i++) {\n            data += \"<Part>\";\n            data += \"<PartNumber>\" + parts[i][0] + \"</PartNumber>\";\n            data += \"<ETag>\" + parts[i][1] + \"</ETag>\";\n            data += \"</Part>\";\n        }\n        data += \"</CompleteMultipartUpload>\";\n\n        // firefox requires a small hack\n        if(navigator.userAgent.indexOf(\"Firefox\") !== -1) {\n            data = new Blob([data]);\n        }\n\n        return new AmazonXHR({\n            auth: auth,\n            key: key,\n            method: \"POST\",\n            querystring: querystring,\n            headers: {},\n            payload: data,\n            load_callback: callback\n        }).send();\n    };\n    AmazonXHR.list = function(auth, file, key, upload_id, chunk_size, callback, error_callback, marker) {\n        var querystring = {\"uploadId\": upload_id};\n        if(marker) {\n            querystring['part-number-marker'] = marker;\n        }\n        return new AmazonXHR({\n            auth: auth,\n            key: key,\n            method: \"GET\",\n            querystring: querystring,\n            headers: {},\n            payload: \"\",\n            error_callback: error_callback,\n            load_callback: function(e) {\n                if(e.target.status === 404) {\n                    // i.e. the file was already uploaded; start fresh\n                    if(error_callback) {\n                        error_callback();\n                    }\n                    return;\n                }\n\n                // process the parts, and return an array of\n                // [part_number, etag, size] through the given callback\n                window.debug = e;\n                var xml = e.target.responseXML;\n                var parts = [];\n                var xml_parts = xml.getElementsByTagName(\"Part\");\n                var num_chunks = Math.ceil(file.size / chunk_size);\n                for(var i=0; i < xml_parts.length; i++) {\n                    var part_number = parseInt(xml_parts[i].getElementsByTagName(\"PartNumber\")[0].textContent, 10);\n                    var etag = xml_parts[i].getElementsByTagName(\"ETag\")[0].textContent;\n                    var size = parseInt(xml_parts[i].getElementsByTagName(\"Size\")[0].textContent, 10);\n\n                    if(part_number != num_chunks && size != chunk_size) {\n                        continue; // chunk corrupted\n                    } else if(part_number == num_chunks &&\n                            size != file.size % chunk_size) {\n                        continue; // final chunk corrupted\n                    }\n\n                    parts.push([\n                        part_number,\n                        etag,\n                        size\n                    ]);\n                }\n                var is_truncated = xml.getElementsByTagName(\"IsTruncated\")[0].textContent;\n                if(is_truncated === \"true\") {\n                    var part_marker = xml.getElementsByTagName(\"NextPartNumberMarker\")[0].textContent;\n                    AmazonXHR.list(auth, file, key, upload_id, chunk_size, function(new_parts) {\n                        callback(parts.concat(new_parts));\n                    }, error_callback, part_marker);\n                } else {\n                    callback(parts);\n                }\n            }\n        }).send();\n    };\n\n    AmazonXHR.upload_chunk = function(auth, key, upload_id, chunk_num, chunk, callbacks, xhr_callback) {\n        var callback, error_callback, progress_callback, readystate_callback;\n        if(callbacks instanceof Object) {\n            callback = callbacks.load_callback;\n            error_callback = callbacks.error_callback;\n            progress_callback = callbacks.progress_callback;\n            readystate_callback = callbacks.state_change_callback;\n        } else {\n            callback = callbacks;\n        }\n        var querystring = {\n            partNumber: chunk_num + 1,\n            uploadId: upload_id\n        };\n        return (new AmazonXHR({\n            auth: auth,\n            key: key,\n            method: \"PUT\",\n            querystring: querystring,\n            headers: {},\n            payload: chunk,\n            load_callback: callback,\n            error_callback: error_callback,\n            progress_callback: progress_callback,\n            state_change_callback: readystate_callback\n        })).send(xhr_callback);\n    };\n    AmazonXHR.init = function(auth, key, file, callback) {\n        return new AmazonXHR({\n            auth: auth,\n            key: key,\n            method: \"POST\",\n            querystring: {\n                \"uploads\": \"\"\n            },\n            headers: {\n                \"x-amz-acl\": \"private\",\n                \"Content-Disposition\": \"attachment; filename=\" + file.name.replace(/[^A-Za-z 0-9 \\.,\\?\"\"!@#\\$%\\^&\\*\\(\\)-_=\\+;:<>\\/\\\\\\|\\}\\{\\[\\]`~]*/g, '').replace(/\\s\\s+/g, ' '),\n                \"Content-Type\": auth.content_type || \"application/octet-stream\"\n            },\n            payload: \"\",\n            load_callback: callback\n        }).send();\n    };\n    AmazonXHR.prototype = {\n        send: function(callback) {\n            var self = this;\n            self.request_date = new Date();\n\n            self.headers = self.settings.headers;\n            self.headers['host'] = self.settings.auth.bucket + \".s3.amazonaws.com\";\n\n            var date_string = [\n                self.settings.auth.date.getUTCFullYear(),\n                utils.zfill(self.settings.auth.date.getUTCMonth() + 1, 2),\n                utils.zfill(self.settings.auth.date.getUTCDate(), 2)\n            ].join('');\n\n            self.settings.querystring['X-Amz-Date'] = utils.uriencode(utils.iso8601(self.request_date));\n            self.settings.querystring[\"X-Amz-Algorithm\"] = \"AWS4-HMAC-SHA256\";\n            self.settings.querystring[\"X-Amz-Expires\"] =  86400;\n            self.settings.querystring[\"X-Amz-Credential\"] = utils.uriencode([\n                self.settings.auth.access_key,\n                \"/\" + date_string + \"/\",\n                self.settings.auth.region + \"/s3/aws4_request\"\n            ].join(''));\n            self.settings.querystring[\"X-Amz-SignedHeaders\"] = \"\";\n\n            var header_keys = []\n            for(var key in self.headers) {\n                header_keys.push(key);\n            }\n            header_keys.sort();\n            self.settings.querystring[\"X-Amz-SignedHeaders\"] = utils.uriencode(header_keys.join(';'));\n\n            self.settings.querystring[\"X-Amz-Signature\"] = self.get_authorization_header();\n\n            delete self.headers['host'];  // keep this header only for hashing\n\n            var url = location.protocol + \"//\" + self.settings.auth.bucket + \".s3.amazonaws.com/\" + self.settings.key;\n            var first = true;\n            for(var key in self.settings.querystring) {\n                if(self.settings.querystring.hasOwnProperty(key)) {\n                    if(first) {\n                        url += \"?\";\n                    }\n                    first = false;\n                    url += key + \"=\" + self.settings.querystring[key] + \"&\";\n                }\n            }\n            url = url.slice(0, -1);  // remove extra ampersand\n\n            var xhr = XHR({\n                url: url,\n                method: self.settings.method,\n                headers: self.headers,\n                body: self.settings.payload,\n\n                load_callback: self.settings.load_callback,\n                progress_callback: self.settings.progress_callback,\n                state_change_callback: self.settings.state_change_callback,\n                error_callback: self.settings.error_callback,\n                timeout_callback: self.settings.timeout_callback\n            });\n            if(callback) {\n                callback(xhr);\n            }\n        },\n        get_authorization_header: function() {\n            if(!this.settings.auth.date) {\n                throw \"Invalid date given.\";\n            }\n\n            var header = \"\";\n\n            var header_keys = utils.get_sorted_keys(this.headers);\n\n            // signed headers\n            var signed_headers = \"\";\n            for(var i=0; i<header_keys.length; i++) {\n                signed_headers += header_keys[i].toLowerCase() + \";\";\n            }\n            signed_headers = signed_headers.slice(0, -1);\n\n            var canonical_request = this.get_canonical_request();\n            var string_to_sign = this.get_string_to_sign(canonical_request, this.request_date);\n            var signature = this.sign_request(string_to_sign);\n\n            return signature;\n        },\n        get_canonical_request: function() {\n            var request = \"\";\n\n            // verb\n            request += this.settings.method.toUpperCase() + \"\\n\";\n\n            // path\n            request += \"/\" + utils.uriencode(this.settings.key).replace(/%2F/g, \"/\") + \"\\n\";\n\n            // querystring\n            var querystring_keys = utils.get_sorted_keys(this.settings.querystring);\n            var key, value, i;\n            for(i=0; i<querystring_keys.length; i++) {\n                key = querystring_keys[i];\n                value = this.settings.querystring[key];\n                request += utils.uriencode(key) + \"=\" + value + \"&amp;\";\n            }\n            request = request.slice(0, -\"&amp;\".length) + \"\\n\";  // remove extra ampersand\n\n            // headers\n            var header_keys = utils.get_sorted_keys(this.headers);\n            for(i=0; i<header_keys.length; i++) {\n                key = header_keys[i];\n                value = this.headers[key];\n                request += key.toLowerCase() + \":\" + value.trim() + \"\\n\";\n            }\n            request += \"\\n\";\n\n            // signed headers\n            for(i=0; i<header_keys.length; i++) {\n                request += header_keys[i].toLowerCase() + \";\";\n            }\n\n            request = request.slice(0, -1) + \"\\n\";\n            request += \"UNSIGNED-PAYLOAD\";\n\n            return request;\n        },\n        get_string_to_sign: function(canonical_request, time) {\n            var to_sign = \"\";\n            to_sign += \"AWS4-HMAC-SHA256\\n\";\n            to_sign += utils.iso8601(time) + \"\\n\";\n            to_sign += [\n                time.getUTCFullYear(),\n                utils.zfill(time.getUTCMonth() + 1, 2),\n                utils.zfill(time.getUTCDate(), 2),\n                \"/\" + this.settings.auth.region + \"/s3/aws4_request\\n\"\n            ].join('');\n\n            to_sign += CryptoJS.SHA256(canonical_request.replace(/&amp;/g, \"&\")).toString();\n\n            return to_sign;\n        },\n        sign_request: function(string_to_sign) {\n            if(!this.settings.auth.signature) {\n                throw \"No signature provided.\";\n            }\n\n            var res = CryptoJS.HmacSHA256(\n                string_to_sign,\n                CryptoJS.enc.Hex.parse(this.settings.auth.signature)\n            ).toString();\n            return res;\n        }\n    };\n\n    var utils = {\n        uriencode: function(string) {\n            var output = encodeURIComponent(string);\n            output = output.replace(/[^A-Za-z0-9_.~\\-%]+/g, escape);\n            output = output.replace(/;/g, \"%3B\");\n\n            // AWS percent-encodes some extra non-standard characters in a URI\n            output = output.replace(/[*]/g, function(ch) {\n              return '%' + ch.charCodeAt(0).toString(16).toUpperCase();\n            });\n\n            return output;\n        },\n        get_sorted_keys: function(obj) {\n            var keys = [];\n            for(var key in obj) {\n                if(obj.hasOwnProperty(key)) {\n                    keys.push(key);\n                }\n            }\n            return keys.sort();\n        },\n        iso8601: function(date) {\n            return [\n                date.getUTCFullYear(),\n                utils.zfill(date.getUTCMonth() + 1, 2),\n                utils.zfill(date.getUTCDate(), 2),\n                \"T\",\n                utils.zfill(date.getUTCHours(), 2),\n                utils.zfill(date.getUTCMinutes(), 2),\n                utils.zfill(date.getUTCSeconds(), 2),\n                \"Z\"\n            ].join(\"\")\n        },\n        zfill: function(str, num) {\n            return (\"00000000000\" + str).substr(-num);\n        }\n    };\n\n})(this);"]}