((e,n)=>{"function"==typeof define&&define.amd?define(["jquery","./pointertouch"],function(t){return n(e,t)}):"object"==typeof exports?n(e,require("jquery"),require("./pointertouch")):n(e,e.jQuery)})("undefined"!=typeof window?window:this,function(t,v){var b=t.document,o="__pz__",a=Array.prototype.slice,_=!!t.PointerEvent,h=((t=b.createElement("input")).setAttribute("oninput","return"),"function"==typeof t.oninput),r=/([A-Z])/g,c=/^http:[\w\.\/]+svg$/,p=/^inline/,t="(\\-?[\\d\\.e]+)",e="\\,?\\s*",n=new RegExp("^matrix\\("+t+e+t+e+t+e+t+e+t+e+t+"\\)$");function i(t){var e={range:!0,animate:!0};return"boolean"==typeof t?e.animate=t:v.extend(e,t),e}function m(t,e,n,i,s,o,a,r,h){"array"===v.type(t)?this.elements=[+t[0],+t[2],+t[4],+t[1],+t[3],+t[5],0,0,1]:this.elements=[t,e,n,i,s,o,a||0,r||0,h||1]}function u(t,e,n){this.elements=[t,e,n]}function l(t,n){if(!(this instanceof l))return new l(t,n);1!==t.nodeType&&v.error("Panzoom called on non-Element node"),v.contains(b,t)||v.error("Panzoom element must be attached to the document");var e=v.data(t,o);if(e)return e;this.options=n=v.extend({},l.defaults,n),this.elem=t;var e=this.$elem=v(t),i=(this.$set=n.$set&&n.$set.length?n.$set:e,this.$doc=v(t.ownerDocument||b),this.$parent=e.parent(),this.isSVG=c.test(t.namespaceURI)&&"svg"!==t.nodeName.toLowerCase(),this.panning=!1,this._buildTransform(),this._transform=!this.isSVG&&v.cssProps.transform.replace(r,"-$1").toLowerCase(),this._buildTransition(),this.resetDimensions(),v()),s=this;v.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(t,e){s[e]=n[e]||i}),this.enable(),v.data(t,o,this)}return u.prototype.e=(m.prototype={x:function(t){var e=this.elements,n=t.elements;return t instanceof u&&3===n.length?new u(e[0]*n[0]+e[1]*n[1]+e[2]*n[2],e[3]*n[0]+e[4]*n[1]+e[5]*n[2],e[6]*n[0]+e[7]*n[1]+e[8]*n[2]):n.length===e.length&&new m(e[0]*n[0]+e[1]*n[3]+e[2]*n[6],e[0]*n[1]+e[1]*n[4]+e[2]*n[7],e[0]*n[2]+e[1]*n[5]+e[2]*n[8],e[3]*n[0]+e[4]*n[3]+e[5]*n[6],e[3]*n[1]+e[4]*n[4]+e[5]*n[7],e[3]*n[2]+e[4]*n[5]+e[5]*n[8],e[6]*n[0]+e[7]*n[3]+e[8]*n[6],e[6]*n[1]+e[7]*n[4]+e[8]*n[7],e[6]*n[2]+e[7]*n[5]+e[8]*n[8])},inverse:function(){var t=1/this.determinant(),e=this.elements;return new m(t*(e[8]*e[4]-e[7]*e[5]),t*-(e[8]*e[1]-e[7]*e[2]),t*(e[5]*e[1]-e[4]*e[2]),t*-(e[8]*e[3]-e[6]*e[5]),t*(e[8]*e[0]-e[6]*e[2]),t*-(e[5]*e[0]-e[3]*e[2]),t*(e[7]*e[3]-e[6]*e[4]),t*-(e[7]*e[0]-e[6]*e[1]),t*(e[4]*e[0]-e[3]*e[1]))},determinant:function(){var t=this.elements;return t[0]*(t[8]*t[4]-t[7]*t[5])-t[3]*(t[8]*t[1]-t[7]*t[2])+t[6]*(t[5]*t[1]-t[4]*t[2])}}).e=function(t){return this.elements[t]},l.rmatrix=n,l.events=v.pointertouch,l.defaults={eventNamespace:".panzoom",transition:!0,cursor:"move",disablePan:!1,disableZoom:!1,increment:.3,minScale:.4,maxScale:5,rangeStep:.05,duration:200,easing:"ease-in-out",contain:!1},l.prototype={constructor:l,instance:function(){return this},enable:function(){this._initStyle(),this._bind(),this.disabled=!1},disable:function(){this.disabled=!0,this._resetStyle(),this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable(),v.removeData(this.elem,o)},resetDimensions:function(){var t=this.$parent,t=(this.container={width:t.innerWidth(),height:t.innerHeight()},t.offset()),e=this.elem,n=this.$elem,i=this.isSVG?{left:(i=e.getBoundingClientRect()).left-t.left,top:i.top-t.top,width:i.width,height:i.height,margin:{left:0,top:0}}:{left:v.css(e,"left",!0)||0,top:v.css(e,"top",!0)||0,width:n.innerWidth(),height:n.innerHeight(),margin:{top:v.css(e,"marginTop",!0)||0,left:v.css(e,"marginLeft",!0)||0}};i.widthBorder=v.css(e,"borderLeftWidth",!0)+v.css(e,"borderRightWidth",!0)||0,i.heightBorder=v.css(e,"borderTopWidth",!0)+v.css(e,"borderBottomWidth",!0)||0,this.dimensions=i},reset:function(t){t=i(t);var e=this.setMatrix(this._origTransform,t);t.silent||this._trigger("reset",e)},resetZoom:function(t){t=i(t);var e=this.getMatrix(this._origTransform);t.dValue=e[3],this.zoom(e[0],t)},resetPan:function(t){var e=this.getMatrix(this._origTransform);this.pan(e[4],e[5],i(t))},setTransform:function(t){for(var e=this.isSVG?"attr":"style",n=this.$set,i=n.length;i--;)v[e](n[i],"transform",t)},getTransform:function(t){var e=this.$set[0];return t?this.setTransform(t):t=v[this.isSVG?"attr":"style"](e,"transform"),"none"===t||n.test(t)||this.setTransform(t=v.css(e,"transform")),t||"none"},getMatrix:function(t){t=n.exec(t||this.getTransform());return t&&t.shift(),t||[1,0,0,1,0,0]},setMatrix:function(t,e){var n,i,s,o,a,r,h,c,l,m,u,f,d;if(!this.disabled)return e=e||{},u=+(t="string"==typeof t?this.getMatrix(t):t)[0],f=this.$parent,(d=(void 0!==e.contain?e:this.options).contain)&&(n=this._checkDims(),i=this.container,l=n.width+n.widthBorder,m=n.height+n.heightBorder,s=(l*Math.abs(u)-i.width)/2,o=(m*Math.abs(u)-i.height)/2,h=n.left+n.margin.left,c=n.top+n.margin.top,"invert"===d?(a=l>i.width?l-i.width:0,r=m>i.height?m-i.height:0,s+=(i.width-l)/2,o+=(i.height-m)/2,t[4]=Math.max(Math.min(t[4],s-h),-s-h-a),t[5]=Math.max(Math.min(t[5],o-c),-o-c-r+n.heightBorder)):(o+=n.heightBorder/2,a=i.width>l?i.width-l:0,r=i.height>m?i.height-m:0,"center"===f.css("textAlign")&&p.test(v.css(this.elem,"display"))?a=0:s=o=0,t[4]=Math.min(Math.max(t[4],s-h),-s-h+a),t[5]=Math.min(Math.max(t[5],o-c),-o-c+r))),"skip"!==e.animate&&this.transition(!e.animate),e.range&&this.$zoomRange.val(u),this.setTransform("matrix("+t.join(",")+")"),e.silent||this._trigger("change",t),t},isPanning:function(){return this.panning},transition:function(t){if(this._transition)for(var e=t||!this.options.transition?"none":this._transition,n=this.$set,i=n.length;i--;)v.style(n[i],"transition")!==e&&v.style(n[i],"transition",e)},pan:function(t,e,n){var i;this.options.disablePan||(i=(i=(n=n||{}).matrix)||this.getMatrix(),n.relative&&(t+=+i[4],e+=+i[5]),i[4]=t,i[5]=e,this.setMatrix(i,n),n.silent)||this._trigger("pan",i[4],i[5])},zoom:function(t,e){"object"==typeof t?(e=t,t=null):e=e||{};var n,i,s,o,a,r,h,c,l,e=v.extend({},this.options,e);e.disableZoom||(n=!1,i=e.matrix||this.getMatrix(),"number"!=typeof t&&(t=+i[0]+e.increment*(t?-1:1),n=!0),e.maxScale<t?t=e.maxScale:t<e.minScale&&(t=e.minScale),(o=e.focal)&&!e.disablePan&&(l=this._checkDims(),s=o.clientX,o=o.clientY,this.isSVG||(s-=(l.width+l.widthBorder)/2,o-=(l.height+l.heightBorder)/2),l=new u(s,o,1),c=new m(i),a=new m(1,0,(a=this.parentOffset||this.$parent.offset()).left-this.$doc.scrollLeft(),0,1,a.top-this.$doc.scrollTop()),r=c.inverse().x(a.inverse().x(l)),h=t/i[0],c=c.x(new m([h,0,0,h,0,0])),l=a.x(c.x(r)),i[4]=+i[4]+(s-l.e(0)),i[5]=+i[5]+(o-l.e(1))),i[0]=t,i[3]="number"==typeof e.dValue?e.dValue:t,this.setMatrix(i,{animate:"boolean"==typeof e.animate?e.animate:n,range:!e.noSetRange}),e.silent)||this._trigger("zoom",i[0],e)},option:function(t,e){var n;if(!t)return v.extend({},this.options);if("string"==typeof t){if(1===arguments.length)return void 0!==this.options[t]?this.options[t]:null;(n={})[t]=e}else n=t;this._setOptions(n)},_setOptions:function(t){v.each(t,v.proxy(function(t,e){switch(t){case"disablePan":this._resetStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._unbind()}switch(this.options[t]=e,t){case"disablePan":this._initStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":this[t]=e;case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._bind();break;case"cursor":v.style(this.elem,"cursor",e);break;case"minScale":this.$zoomRange.attr("min",e);break;case"maxScale":this.$zoomRange.attr("max",e);break;case"rangeStep":this.$zoomRange.attr("step",e);break;case"startTransform":this._buildTransform();break;case"duration":case"easing":this._buildTransition();case"transition":this.transition();break;case"$set":e instanceof v&&e.length&&(this.$set=e,this._initStyle(),this._buildTransform())}},this))},_initStyle:function(){var t={"backface-visibility":"hidden","transform-origin":this.isSVG?"0 0":"50% 50%"},e=(this.options.disablePan||(t.cursor=this.options.cursor),this.$set.css(t),this.$parent);e.length&&!v.nodeName(e[0],"body")&&(t={overflow:"hidden"},"static"===e.css("position")&&(t.position="relative"),e.css(t))},_resetStyle:function(){this.$elem.css({cursor:"",transition:""}),this.$parent.css({overflow:"",position:""})},_bind:function(){var n=this,i=this.options,e=i.eventNamespace,t=_?"pointerdown"+e:"touchstart"+e+" mousedown"+e,s=_?"pointerup"+e:"touchend"+e+" click"+e,o={},a=this.$reset,r=this.$zoomRange;v.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var t=i["on"+this];v.isFunction(t)&&(o["panzoom"+this.toLowerCase()+e]=t)}),i.disablePan&&i.disableZoom||(o[t]=function(t){var e;("touchstart"===t.type?!(e=t.touches)||(1!==e.length||i.disablePan)&&2!==e.length:i.disablePan||1!==t.which)||(t.preventDefault(),t.stopPropagation(),n._startMove(t,e))}),this.$elem.on(o),a.length&&a.on(s,function(t){t.preventDefault(),n.reset()}),r.length&&r.attr({step:i.rangeStep===l.defaults.rangeStep&&r.attr("step")||i.rangeStep,min:i.minScale,max:i.maxScale}).prop({value:this.getMatrix()[0]}),i.disableZoom||(t=this.$zoomIn,a=this.$zoomOut,t.length&&a.length&&(t.on(s,function(t){t.preventDefault(),n.zoom()}),a.on(s,function(t){t.preventDefault(),n.zoom(!0)})),r.length&&((o={})[(_?"pointerdown":"mousedown")+e]=function(){n.transition(!0)},o[(h?"input":"change")+e]=function(){n.zoom(+this.value,{noSetRange:!0})},r.on(o)))},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){var t;this._transform&&(t=this.options,this._transition=this._transform+" "+t.duration+"ms "+t.easing)},_checkDims:function(){var t=this.dimensions;return t.width&&t.height||this.resetDimensions(),this.dimensions},_getDistance:function(t){var e=t[0],t=t[1];return Math.sqrt(Math.pow(Math.abs(t.clientX-e.clientX),2)+Math.pow(Math.abs(t.clientY-e.clientY),2))},_getMiddle:function(t){var e=t[0],t=t[1];return{clientX:(t.clientX-e.clientX)/2+e.clientX,clientY:(t.clientY-e.clientY)/2+e.clientY}},_trigger:function(t){this.$elem.triggerHandler(t="string"==typeof t?"panzoom"+t:t,[this].concat(a.call(arguments,1)))},_startMove:function(t,n){var e,i,s,o,a,r,h=this,c=this.options,l=c.eventNamespace,m=this.getMatrix(),u=m.slice(0),f=+u[4],d=+u[5],p={matrix:m,animate:"skip"},g=_?(e="pointermove","pointerup"):"touchstart"===t.type?(e="touchmove","touchend"):(e="mousemove","mouseup");e+=l,g+=l,this.transition(!0),this.panning=!0,this._trigger("start",t,n),t=n&&2===n.length?(i=this._getDistance(n),s=+m[0],o=this._getMiddle(n),function(t){t.preventDefault();var t=h._getMiddle(n=t.touches),e=h._getDistance(n)-i;h.zoom(e*(c.increment/100)+s,{focal:t,matrix:m,animate:!1}),h.pan(+m[4]+t.clientX-o.clientX,+m[5]+t.clientY-o.clientY,p),o=t}):(a=t.pageX,r=t.pageY,function(t){t.preventDefault(),h.pan(f+t.pageX-a,d+t.pageY-r,p)}),v(b).off(l).on(e,t).on(g,function(t){t.preventDefault(),v(this).off(l),h.panning=!1,t.type="panzoomend",h._trigger(t,m,!((t,e)=>{for(var n=t.length;--n;)if(+t[n]!=+e[n])return;return 1})(m,u))})}},v.Panzoom=l,v.fn.panzoom=function(t){var e,n,i,s;return"string"==typeof t?(s=[],n=a.call(arguments,1),this.each(function(){(e=v.data(this,o))?"_"!==t.charAt(0)&&"function"==typeof(i=e[t])&&void 0!==(i=i.apply(e,n))&&s.push(i):s.push(void 0)}),s.length?1===s.length?s[0]:s:this):this.each(function(){new l(this,t)})},l});
//# sourceMappingURL=panzoom.min.js.map
