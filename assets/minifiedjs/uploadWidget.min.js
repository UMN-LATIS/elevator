var format_size=function(e){return e<=819.2?e+" B":e<=838860.8?parseInt(e/1024,10)+"."+parseInt(e/1024*10,10)%10+" KB":e<=858993459.2?parseInt(e/1024/1024,10)+"."+parseInt(e/1024/1024*10,10)%10+" MB":parseInt(e/1024/1024/1024,10)+"."+parseInt(e/1024/1024/1024*10,10)%10+" GB"},uploadCount=0,uploadFile=function(e,t,n){var i=null,a=t.fileObjectId;$(n).find(".fileObjectId").val(a),$(n).find(".fileObjectId").trigger("change");var o=n,l=6291456;pollingForNewImage||checkForNewImages(),fastUpload&&(l=209715200);var c={key:t.path+"/"+a.split("").reverse().join("")+"-source",access_key:t.bucketKey,ajax_base:basePath+"uploadBackend/upload",bucket:t.bucket,collectionId:t.collectionId,num_workers:6,chunk_size:l,content_type:e.type,max_size:50*(1<<30),on_error:function(){console.log("ERROR"),$(o).find(".log").prepend("Error occurred! You can help me fix this by filing a bug report here: https://github.com/cinely/mule-uploader/issues\n")},on_select:function(e){$(o).find(".log").prepend("File selected\n")},on_start:function(e){window.uploadCount++,$(o).find(".deleteFile").hide()},on_progress:function(e,t){if(!i||new Date-i>1e3){var n=e/t*100;new Date;i=new Date,e,$(o).find(".progress .progress-bar").width(n/100*$(o).find(".progress").width())}},on_init:function(){},on_complete:function(){window.uploadCount--,$.get(basePath+"assetManager/completeSourceFile/"+a,(function(e){$(o).find(".uploadProgress").hide()})),$(o).find(".cancelButton").hide(),$(o).find(".deleteFile").show(),$(o).find(".allowResume").hide()},on_chunk_uploaded:function(){}};return upload=mule_upload(c),$("#collectionId").attr("disabled",!0),$(o).find(".uploadProgress").show(),upload.upload_file(e,!1),upload},resetCollection=function(){"---"!=$("#collectionId").val()&&""!==$("#collectionId").val()&&-1!=$("#collectionId").val()?($(".uploadInformation").show(),$(".uploadWarning").hide()):($(".uploadInformation").hide(),$(".uploadWarning").show())};function loadSidecars(e){if(fileId=$(e).val(),!($(e).closest(".widgetContents").find(".sidecars").html().length>0)){var t=$(e).closest(".widgetContents").find(".rootFormField").val()+"[sidecars]";$.post(basePath+"fileManager/getSidecarViewForObject/",{fileId:fileId,rootFormField:t},(function(t){$(e).closest(".widgetContents").find(".sidecars").append(t)}))}}$(document).on("change","#collectionId",(function(){resetCollection()})),$(document).on("click",".deleteData",(function(){var e=$(this).closest(".widgetContents").find(".fileObjectId").val(),t=this;$.get(basePath+"fileManager/removeData/"+e,(function(e){$(t).closest(".widgetContents").find(".extractedData").val("")}))})),$(document).on("click",".deleteFile",(function(){var e=this;bootbox.dialog({message:"Delete this upload object?  This action cannot be undone and will delete the source media and any derivatives.",title:"Delete Object?",backdrop:!0,buttons:{success:{label:"Delete",className:"btn-danger",callback:function(){var t=$(e).closest(".widgetContents").find(".fileObjectId").val();$.post(basePath+"fileManager/deleteFileObject",{fileObjectId:t},(function(t,n,i){"success"==t?($(e).closest(".widgetContents").find(".fileObjectId").val(""),$(e).closest(".widgetContents").find(".fileDescription").val(""),$(e).closest(".widgetContents").find(".extractedData").val(""),$(e).closest(".widgetContents").find(".deleteFile").hide(),$(e).closest(".widgetContents").find(".fileLabel").html("Deleted"),$(".fileObjectId").trigger("change")):"notfound"==t?($(e).closest(".widgetContents").find(".fileObjectId").val(""),$(e).closest(".widgetContents").find(".fileDescription").val(""),$(e).closest(".widgetContents").find(".extractedData").val(""),$(".fileObjectId").trigger("change")):bootbox.dialog({message:"Deletion Error: please reload and try again."})}))}},cancel:{label:"Cancel",className:"btn-default"}}})}));var fileObjectPreview=function(e){var t=$(e).closest(".widgetContents").find(".imagePreview");$(e).val().length>0?($("#collectionId").attr("disabled",!0),$(e).closest(".widgetContents").find(".file").attr("disabled",!0),loadSidecars(e)):($(e).closest(".widgetContents").find(".file").removeAttr("disabled"),$("#collectionId").removeAttr("disabled"),$(t).hide())},pollingForNewImage=!1,checkForNewImages=function(){pollingForNewImage=!0,checkArray=new Array,$(".imagePreview img").each((function(e,t){if(!0!==$(t).data("fileready")){var n=$(t).closest(".widgetContents").find(".fileObjectId").val();n&&checkArray.push(n)}else container=$(t).closest(".widgetContents").find(".imagePreview"),$(container).show()})),checkArray.length>0?$.post(basePath+"fileManager/previewImageAvailable/",{checkArray:JSON.stringify(checkArray)},(function(e){decoded=JSON.parse(e),decoded&&($(decoded).each((function(e,t){container=$(".fileObjectId").filter((function(e){return $(this).val()==t.fileId})).closest(".widgetContents").find(".imagePreview"),"false"==t.status?($(container).find("img").attr("src","/assets/images/processing.gif"),$(container).show()):"true"==t.status?($(container).find("img").attr("src",basePath+"fileManager/previewImageByFileId/"+t.fileId+"?"+Math.random()),$(container).find("img").data("fileready",!0),$.get(basePath+"fileManager/extractedData/"+t.fileId,(function(e){$(container).closest(".widgetContents").find(".extractedData").val(e)})),$(container).show()):"icon"==t.status&&($(container).find("img").data("icon")||($(container).find("img").data("icon",!0),$(container).find("img").attr("src",basePath+"fileManager/previewImageByFileId/"+t.fileId),$(container).show()))})),setTimeout(checkForNewImages,4e3))})):pollingForNewImage=!1};function startUpload(e){var t=$("#collectionId").val(),n=$(e).closest(".widgetContentsContainer"),i=$(n).find(".file");$.isNumeric(t)||console.log("error"),jQuery.ajaxSetup({async:!1}),$(i).prop("files").length>1&&(l=addAnother(e,$(i).prop("files").length-1)),$(l).find(".cancelButton").show(),jQuery.ajaxSetup({async:!0});var a=[],o=[],l=null;$.each($(i).prop("files"),(function(e,i){var c=i,s=l=0===e?n:l.nextAll(".panel").eq(0);fileObjectId=$(l).find(".fileObjectId").val(),o[e]={index:e,collectionId:t,filename:c.name,fileObjectId:fileObjectId,file:c},a[e]={index:e,collectionId:t,filename:c.name,fileObjectId:fileObjectId,target:s,file:c}})),$.post(basePath+"assetManager/getFileContainer",{containers:JSON.stringify(o)},(function(e,t,n){uploadSettings=$.parseJSON(e),$(uploadSettings).each((function(e,t){var n=a[t.index];$(i).data("uploader",uploadFile(n.file,t,n.target))}))}))}$(document).on("change",".fileObjectId",(function(){fileObjectPreview(this),""!==$(this).val()&&submitFormWithDelay(!0)})),$(document).on("click",".processingLogs",(function(e){e.preventDefault();var t=$(this).closest(".widgetContents"),n=$(t).find(".fileObjectId").val(),i=window.open(basePath+"assetManager/processingLogsForAsset/"+n,"_blank");i&&i.focus()})),$(document).ready((function(){$("#collectionId").trigger("change"),$(".file").trigger("change"),checkForNewImages(),$(".fileObjectId").each((function(e,t){fileObjectPreview(t),""!==$(t).val()&&$(t).closest(".widgetContents").find(".deleteFile").show()})),$(".allowResume").length>0&&$(".allowResume").each((function(){$(this).closest(".widgetContents").find(".file").removeAttr("disabled"),$(this).closest(".widgetContents").find(".startbutton").removeAttr("disabled")}))})),$(document).on("change",".file",(function(){""!==$(this).val()?($(this).closest(".widgetContents").find(".cancelButton").show(),startUpload(this)):$(this).closest(".widgetContents").find(".cancelButton").hide()})),$(document).on("click",".cancelButton",(function(){var e=$(this).closest(".widgetContents"),t=$(e).find(".file");$(t).data("uploader").cancel(),window.uploadCount--,$.get(basePath+"assetManager/cancelSourceFile/"+$(e).find(".fileObjectId").val(),(function(t){$(e).find(".uploadProgress").hide()})),$(e).find(".cancelButton").hide(),$(e).find(".fileObjectId").val(""),$(this).hide(),$(t).removeAttr("disabled")}));
//# sourceMappingURL=uploadWidget.min.js.map
