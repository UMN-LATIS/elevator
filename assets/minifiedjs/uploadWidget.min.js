var format_size=function(e){return e<=819.2?e+" B":e<=838860.8?parseInt(e/1024,10)+"."+parseInt(e/1024*10,10)%10+" KB":e<=858993459.2?parseInt(e/1024/1024,10)+"."+parseInt(e/1024/1024*10,10)%10+" MB":parseInt(e/1024/1024/1024,10)+"."+parseInt(e/1024/1024/1024*10,10)%10+" GB"},uploadCount=0,uploadFile=function(e,t,n){var i=null,o=t.fileObjectId,a=($(n).find(".fileObjectId").val(o),$(n).find(".fileObjectId").trigger("change"),n),n=6291456,t=(pollingForNewImage||checkForNewImages(),fastUpload&&(n=209715200),{key:t.path+"/"+o.split("").reverse().join("")+"-source",access_key:t.bucketKey,ajax_base:basePath+"uploadBackend/upload",bucket:t.bucket,collectionId:t.collectionId,num_workers:6,chunk_size:n,content_type:e.type,max_size:50*(1<<30),on_error:function(){console.log("ERROR"),$(a).find(".log").prepend("Error occurred! You can help me fix this by filing a bug report here: https://github.com/cinely/mule-uploader/issues\n")},on_select:function(e){$(a).find(".log").prepend("File selected\n")},on_start:function(e){window.uploadCount++,$(a).find(".deleteFile").hide()},on_progress:function(e,t){(!i||1e3<new Date-i)&&(t=e/t*100,new Date,i=new Date,$(a).find(".progress .progress-bar").width(t/100*$(a).find(".progress").width()))},on_init:function(){},on_complete:function(){window.uploadCount--,$.get(basePath+"assetManager/completeSourceFile/"+o,function(e){$(a).find(".uploadProgress").hide()}),$(a).find(".cancelButton").hide(),$(a).find(".deleteFile").show(),$(a).find(".allowResume").hide()},on_chunk_uploaded:function(){}});return upload=mule_upload(t),$("#collectionId").attr("disabled",!0),$(a).find(".uploadProgress").show(),upload.upload_file(e,!1),upload},resetCollection=function(){"---"!=$("#collectionId").val()&&""!==$("#collectionId").val()&&-1!=$("#collectionId").val()?($(".uploadInformation").show(),$(".uploadWarning").hide()):($(".uploadInformation").hide(),$(".uploadWarning").show())};function loadSidecars(t){var e;fileId=$(t).val(),0<$(t).closest(".widgetContents").find(".sidecars").html().length||(e=$(t).closest(".widgetContents").find(".rootFormField").val()+"[sidecars]",$.post(basePath+"fileManager/getSidecarViewForObject/",{fileId:fileId,rootFormField:e},function(e){$(t).closest(".widgetContents").find(".sidecars").append(e)}))}$(document).on("change","#collectionId",function(){resetCollection()}),$(document).on("click",".deleteData",function(){var e=$(this).closest(".widgetContents").find(".fileObjectId").val(),t=this;$.get(basePath+"fileManager/removeData/"+e,function(e){$(t).closest(".widgetContents").find(".extractedData").val("")})}),$(document).on("click",".deleteFile",function(){var i=this;bootbox.dialog({message:"Delete this upload object?  This action cannot be undone and will delete the source media and any derivatives.",title:"Delete Object?",backdrop:!0,buttons:{success:{label:"Delete",className:"btn-danger",callback:function(){var e=$(i).closest(".widgetContents").find(".fileObjectId").val();$.post(basePath+"fileManager/deleteFileObject",{fileObjectId:e},function(e,t,n){"success"==e?($(i).closest(".widgetContents").find(".fileObjectId").val(""),$(i).closest(".widgetContents").find(".fileDescription").val(""),$(i).closest(".widgetContents").find(".extractedData").val(""),$(i).closest(".widgetContents").find(".deleteFile").hide(),$(i).closest(".widgetContents").find(".fileLabel").html("Deleted"),$(".fileObjectId").trigger("change")):"notfound"==e?($(i).closest(".widgetContents").find(".fileObjectId").val(""),$(i).closest(".widgetContents").find(".fileDescription").val(""),$(i).closest(".widgetContents").find(".extractedData").val(""),$(".fileObjectId").trigger("change")):bootbox.dialog({message:"Deletion Error: please reload and try again."})})}},cancel:{label:"Cancel",className:"btn-default"}}})});var fileObjectPreview=function(e){var t=$(e).closest(".widgetContents").find(".imagePreview");0<$(e).val().length?($("#collectionId").attr("disabled",!0),$(e).closest(".widgetContents").find(".file").attr("disabled",!0),loadSidecars(e)):($(e).closest(".widgetContents").find(".file").removeAttr("disabled"),$("#collectionId").removeAttr("disabled"),$(t).hide())},pollingForNewImage=!1,checkForNewImages=function(){pollingForNewImage=!0,checkArray=new Array,$(".imagePreview img").each(function(e,t){var n;!0!==$(t).data("fileready")?(n=$(t).closest(".widgetContents").find(".fileObjectId").val())&&checkArray.push(n):(container=$(t).closest(".widgetContents").find(".imagePreview"),$(container).show())}),0<checkArray.length?$.post(basePath+"fileManager/previewImageAvailable/",{checkArray:JSON.stringify(checkArray)},function(e){(decoded=JSON.parse(e))&&($(decoded).each(function(e,t){container=$(".fileObjectId").filter(function(e){return $(this).val()==t.fileId}).closest(".widgetContents").find(".imagePreview"),"false"==t.status?($(container).find("img").attr("src","/assets/images/processing.gif"),$(container).show()):"true"==t.status?($(container).find("img").attr("src",basePath+"fileManager/previewImageByFileId/"+t.fileId+"?"+Math.random()),$(container).find("img").data("fileready",!0),$.get(basePath+"fileManager/extractedData/"+t.fileId,function(e){$(container).closest(".widgetContents").find(".extractedData").val(e)}),$(container).show()):"icon"!=t.status||$(container).find("img").data("icon")||($(container).find("img").data("icon",!0),$(container).find("img").attr("src",basePath+"fileManager/previewImageByFileId/"+t.fileId),$(container).show())}),setTimeout(checkForNewImages,4e3))}):pollingForNewImage=!1};function startUpload(e){var i=$("#collectionId").val(),o=$(e).closest(".widgetContentsContainer"),a=$(o).find(".file"),l=($.isNumeric(i)||console.log("error"),jQuery.ajaxSetup({async:!1}),1<$(a).prop("files").length&&(s=addAnother(e,$(a).prop("files").length-1)),$(s).find(".cancelButton").show(),jQuery.ajaxSetup({async:!0}),[]),c=[],s=null;$.each($(a).prop("files"),function(e,t){var n=s=0===e?o:s.nextAll(".panel").eq(0);fileObjectId=$(s).find(".fileObjectId").val(),c[e]={index:e,collectionId:i,filename:t.name,fileObjectId:fileObjectId,file:t},l[e]={index:e,collectionId:i,filename:t.name,fileObjectId:fileObjectId,target:n,file:t}}),$.post(basePath+"assetManager/getFileContainer",{containers:JSON.stringify(c)},function(e,t,n){uploadSettings=$.parseJSON(e),$(uploadSettings).each(function(e,t){var n=l[t.index];$(a).data("uploader",uploadFile(n.file,t,n.target))})})}$(document).on("change",".fileObjectId",function(){fileObjectPreview(this),""!==$(this).val()&&submitFormWithDelay(!0)}),$(document).on("click",".processingLogs",function(e){e.preventDefault();e=$(this).closest(".widgetContents"),e=$(e).find(".fileObjectId").val(),e=window.open(basePath+"assetManager/processingLogsForAsset/"+e,"_blank");e&&e.focus()}),$(document).ready(function(){$("#collectionId").trigger("change"),$(".file").trigger("change"),checkForNewImages(),$(".fileObjectId").each(function(e,t){fileObjectPreview(t),""!==$(t).val()&&$(t).closest(".widgetContents").find(".deleteFile").show()}),0<$(".allowResume").length&&$(".allowResume").each(function(){$(this).closest(".widgetContents").find(".file").removeAttr("disabled"),$(this).closest(".widgetContents").find(".startbutton").removeAttr("disabled")})}),$(document).on("change",".file",function(){""!==$(this).val()?($(this).closest(".widgetContents").find(".cancelButton").show(),startUpload(this)):$(this).closest(".widgetContents").find(".cancelButton").hide()}),$(document).on("click",".cancelButton",function(){var t=$(this).closest(".widgetContents"),e=$(t).find(".file");$(e).data("uploader").cancel(),window.uploadCount--,$.get(basePath+"assetManager/cancelSourceFile/"+$(t).find(".fileObjectId").val(),function(e){$(t).find(".uploadProgress").hide()}),$(t).find(".cancelButton").hide(),$(t).find(".fileObjectId").val(""),$(this).hide(),$(e).removeAttr("disabled")});
//# sourceMappingURL=uploadWidget.min.js.map
