function loadSidecars(e){if(fileId=$(e).val(),!($(e).closest(".widgetContents").find(".sidecars").html().length>0)){var t=$(e).closest(".widgetContents").find(".rootFormField").val()+"[sidecars]";$.post(basePath+"fileManager/getSidecarViewForObject/",{fileId:fileId,rootFormField:t},function(t){$(e).closest(".widgetContents").find(".sidecars").append(t)})}}function updateImage(e,t){fileId=$(e).val(),$.ajax({type:"GET",fileId:fileId,fileIdElement:e,container:t,url:basePath+"fileManager/previewImageAvailable/"+fileId,success:function(n,i){"false"==n?($(t).find("img").attr("src","/assets/images/processing.gif"),$(t).show(),setTimeout(function(){updateImage(e,t)},2e3)):"true"==n?($(t).find("img").attr("src",basePath+"fileManager/previewImageByFileId/"+this.fileId+"?"+Math.random()),$.get(basePath+"fileManager/extractedData/"+this.fileId,function(e){$(t).closest(".widgetContents").find(".extractedData").val(e)}),$(t).show()):"icon"==n&&($(t).find("img").attr("src",basePath+"fileManager/previewImageByFileId/"+this.fileId),$(t).show(),setTimeout(function(){updateImage(e,t)},5e3))}})}function startUpload(e){var t=$("#collectionId").val(),n=$(e).closest(".widgetContentsContainer"),i=$(n).find(".file");$.isNumeric(t)||console.log("error"),$.each($(i).prop("files"),function(a,o){var l=null;0===a?l=n:(jQuery.ajaxSetup({async:!1}),l=addAnother(e),$(l).find(".cancelButton").show());var s=o;fileObjectId=$(l).find(".fileObjectId").val(),jQuery.ajaxSetup({async:!0}),$.post(basePath+"assetManager/getFileContainer",{collectionId:t,filename:s.name,fileObjectId:fileObjectId},function(e,t,n){uploadSettings=$.parseJSON(e);var a=l;$(i).data("uploader",uploadFile(s,uploadSettings,a))})})}var format_size=function(e){return 819.2>=e?e+" B":838860.8>=e?parseInt(e/1024,10)+"."+parseInt(e/1024*10,10)%10+" KB":858993459.2>=e?parseInt(e/1024/1024,10)+"."+parseInt(e/1024/1024*10,10)%10+" MB":parseInt(e/1024/1024/1024,10)+"."+parseInt(e/1024/1024/1024*10,10)%10+" GB"},uploadCount=0,uploadFile=function(e,t,n){var i=null,a=null,o=t.fileObjectId;$(n).find(".fileObjectId").val(o),$(n).find(".fileObjectId").trigger("change");var l=n,s=6291456;fastUpload&&(s=209715200);var d={key:t.path+"/"+o.split("").reverse().join("")+"-source",access_key:t.bucketKey,ajax_base:basePath+"uploadBackend/upload",bucket:t.bucket,collectionId:t.collectionId,num_workers:6,chunk_size:s,content_type:e.type,max_size:50*(1<<30),on_error:function(){console.log("ERROR"),$(l).find(".log").prepend("Error occurred! You can help me fix this by filing a bug report here: https://github.com/cinely/mule-uploader/issues\n")},on_select:function(e){$(l).find(".log").prepend("File selected\n")},on_start:function(e){window.uploadCount++,$(l).find(".deleteFile").hide()},on_progress:function(e,t){if(!i||new Date-i>1e3){var n=e/t*100;(e-a)/(new Date-i)*1e3;i=new Date,a=e,$(l).find(".progress .progress-bar").width(n/100*$(l).find(".progress").width())}},on_init:function(){},on_complete:function(){window.uploadCount--,$.get(basePath+"assetManager/completeSourceFile/"+o,function(e){$(l).find(".uploadProgress").hide()}),$(l).find(".cancelButton").hide(),$(l).find(".deleteFile").show(),$(l).find(".allowResume").hide()},on_chunk_uploaded:function(){}};return upload=mule_upload(d),$("#collectionId").attr("disabled",!0),$(l).find(".uploadProgress").show(),upload.upload_file(e,!1),upload},resetCollection=function(){"---"!=$("#collectionId").val()&&""!==$("#collectionId").val()&&-1!=$("#collectionId").val()?($(".uploadInformation").show(),$(".uploadWarning").hide()):($(".uploadInformation").hide(),$(".uploadWarning").show())};$(document).on("change","#collectionId",function(){resetCollection()}),$(document).on("click",".deleteData",function(){var e=$(this).closest(".widgetContents").find(".fileObjectId").val(),t=this;$.get(basePath+"fileManager/removeData/"+e,function(e){$(t).closest(".widgetContents").find(".extractedData").val("")})}),$(document).on("click",".deleteFile",function(){var e=this;bootbox.dialog({message:"Delete this upload object?  This action cannot be undone and will delete the source media and any derivatives.",title:"Delete Object?",backdrop:!0,buttons:{success:{label:"Delete",className:"btn-danger",callback:function(){var t=$(e).closest(".widgetContents").find(".fileObjectId").val();$.post(basePath+"fileManager/deleteFileObject",{fileObjectId:t},function(t,n,i){"success"==t?($(e).closest(".widgetContents").find(".fileObjectId").val(""),$(e).closest(".widgetContents").find(".fileDescription").val(""),$(e).closest(".widgetContents").find(".extractedData").val(""),$(e).closest(".widgetContents").find(".deleteFile").hide(),$(e).closest(".widgetContents").find(".fileLabel").html("Deleted"),$(".fileObjectId").trigger("change")):"notfound"==t?($(e).closest(".widgetContents").find(".fileObjectId").val(""),$(e).closest(".widgetContents").find(".fileDescription").val(""),$(e).closest(".widgetContents").find(".extractedData").val(""),$(".fileObjectId").trigger("change")):bootbox.dialog({message:"Deletion Error: please reload and try again."})})}},cancel:{label:"Cancel",className:"btn-default"}}})});var fileObjectPreview=function(e){var t=$(e).closest(".widgetContents").find(".imagePreview");if($(e).val().length>0){$("#collectionId").attr("disabled",!0),$(e).closest(".widgetContents").find(".file").attr("disabled",!0);var n=e;updateImage(n,t),loadSidecars(n)}else $(e).closest(".widgetContents").find(".file").removeAttr("disabled"),$("#collectionId").removeAttr("disabled"),$(t).hide()};$(document).on("change",".fileObjectId",function(){fileObjectPreview(this),""!==$(this).val()&&submitForm(!0)}),$(document).on("click",".processingLogs",function(e){e.preventDefault();var t=$(this).closest(".widgetContents"),n=$(t).find(".fileObjectId").val(),i=window.open(basePath+"/assetManager/processingLogsForAsset/"+n,"_blank");i&&i.focus()}),$(document).ready(function(){$("#collectionId").trigger("change"),$(".file").trigger("change"),$(".fileObjectId").each(function(e,t){fileObjectPreview(t),""!==$(t).val()&&$(".deleteFile").show()}),$(".allowResume").length>0&&$(".allowResume").each(function(){$(this).closest(".widgetContents").find(".file").removeAttr("disabled"),$(this).closest(".widgetContents").find(".startbutton").removeAttr("disabled")})}),$(document).on("change",".file",function(){""!==$(this).val()?($(this).closest(".widgetContents").find(".cancelButton").show(),startUpload(this)):$(this).closest(".widgetContents").find(".cancelButton").hide()}),$(document).on("click",".cancelButton",function(){var e=$(this).closest(".widgetContents"),t=$(e).find(".file"),n=$(t).data("uploader");n.cancel(),window.uploadCount--,$.get(basePath+"assetManager/cancelSourceFile/"+$(e).find(".fileObjectId").val(),function(t){$(e).find(".uploadProgress").hide()}),$(e).find(".cancelButton").hide(),$(e).find(".fileObjectId").val(""),$(this).hide(),$(t).removeAttr("disabled")});
//# sourceMappingURL=uploadWidget.min.js.map
