(n=>{o=Math,g=(A={}).lib={},e=g.Base={extend:function(t){h.prototype=this;var e=new h;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),(e.init.prototype=e).$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},l=g.WordArray=e.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||s).stringify(this)},concat:function(t){var e=this.words,n=t.words,s=this.sigBytes;if(t=t.sigBytes,this.clamp(),s%4)for(var i=0;i<t;i++)e[s+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(s+i)%4*8;else if(65535<n.length)for(i=0;i<t;i+=4)e[s+i>>>2]=n[i>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var t=this.words,e=this.sigBytes;t[e>>>2]&=4294967295<<32-e%4*8,t.length=o.ceil(e/4)},clone:function(){var t=e.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(4294967296*o.random()|0);return new l.init(e,t)}}),B=A.enc={},s=B.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],s=0;s<t;s++){var i=e[s>>>2]>>>24-s%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],s=0;s<e;s+=2)n[s>>>3]|=parseInt(t.substr(s,2),16)<<24-s%8*4;return new l.init(n,e/2)}},i=B.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],s=0;s<t;s++)n.push(String.fromCharCode(e[s>>>2]>>>24-s%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],s=0;s<e;s++)n[s>>>2]|=(255&t.charCodeAt(s))<<24-s%4*8;return new l.init(n,e)}},a=B.Utf8={stringify:function(t){try{return decodeURIComponent(escape(i.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return i.parse(unescape(encodeURIComponent(t)))}},t=g.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=a.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var e=this._data,n=e.words,s=this.blockSize,i=(a=e.sigBytes)/(4*s),i=t?o.ceil(i):o.max((0|i)-this._minBufferSize,0),a=o.min(4*(t=i*s),a);if(t){for(var r=0;r<t;r+=s)this._doProcessBlock(n,r);r=n.splice(0,t),e.sigBytes-=a}return new l.init(r,a)},clone:function(){var t=e.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),g.Hasher=t.extend({cfg:e.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){t.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,e){return new n.init(e).finalize(t)}},_createHmacHelper:function(n){return function(t,e){return new r.HMAC.init(n,e).finalize(t)}}}),r=A.algo={};var o,e,l,s,i,a,t,r,c,u,_=A;function h(){}for(var p=Math,O=(g=(B=_).lib).WordArray,d=g.Hasher,g=B.algo,f=[],k=[],y=function(t){return 4294967296*(t-(0|t))|0},m=2,v=0;v<64;){t:{for(var b=m,D=p.sqrt(b),z=2;z<=D;z++)if(!(b%z)){b=!1;break t}b=!0}b&&(v<8&&(f[v]=y(p.pow(m,.5))),k[v]=y(p.pow(m,1/3)),v++),m++}for(var x=[],g=g.SHA256=d.extend({_doReset:function(){this._hash=new O.init(f.slice(0))},_doProcessBlock:function(t,e){for(var n,s,i=this._hash.words,a=i[0],r=i[1],o=i[2],l=i[3],c=i[4],u=i[5],_=i[6],h=i[7],p=0;p<64;p++)x[p]=p<16?0|t[e+p]:(((n=x[p-15])<<25|n>>>7)^(n<<14|n>>>18)^n>>>3)+x[p-7]+(((s=x[p-2])<<15|s>>>17)^(s<<13|s>>>19)^s>>>10)+x[p-16],n=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&_)+k[p]+x[p],s=((a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22))+(a&r^a&o^r&o),h=_,_=u,u=c,c=l+n|0,l=o,o=r,r=a,a=n+s|0;i[0]=i[0]+a|0,i[1]=i[1]+r|0,i[2]=i[2]+o|0,i[3]=i[3]+l|0,i[4]=i[4]+c|0,i[5]=i[5]+u|0,i[6]=i[6]+_|0,i[7]=i[7]+h|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[14+(64+s>>>9<<4)]=p.floor(n/4294967296),e[15+(64+s>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=d.clone.call(this);return t._hash=this._hash.clone(),t}}),w=(B.SHA256=d._createHelper(g),B.HmacSHA256=d._createHmacHelper(g),Math),A=_,P=(B=A.lib).WordArray,C=B.Hasher,B=A.algo,N=[],F=[],L=function(t){return 4294967296*(t-(0|t))|0},T=2,S=0;S<64;){t:{for(var H=T,j=w.sqrt(H),I=2;I<=j;I++)if(!(H%I)){H=!1;break t}H=!0}H&&(S<8&&(N[S]=L(w.pow(T,.5))),F[S]=L(w.pow(T,1/3)),S++),T++}function U(t){t.headers=t.headers||{},t.method=t.method||"GET";var e,n=new XMLHttpRequest,s=(t.load_callback&&"function"==typeof t.load_callback&&n.addEventListener("load",t.load_callback,!0),t.error_callback&&"function"==typeof t.error_callback&&n.addEventListener("error",t.error_callback,!0),t.state_change_callback&&"function"==typeof t.state_change_callback&&n.addEventListener("readystatechange",t.state_change_callback),t.progress_callback&&"function"==typeof t.progress_callback&&n.upload.addEventListener("progress",t.progress_callback),t.timeout_callback&&"function"==typeof t.timeout_callback&&n.addEventListener("timeout",t.timeout_callback),t.url);if(t.extra_params)for(var i in t.extra_params)t.extra_params.hasOwnProperty(i)&&(-1!==s.indexOf("?")?s+="&":s+="?",s=(s+=encodeURIComponent(i)+"=")+encodeURIComponent(t.extra_params[i]));for(e in n.open(t.method,s),t.headers)t.headers.hasOwnProperty(e)&&n.setRequestHeader(e,t.headers[e]);return t.body?n.send(t.body):n.send(),n}var M=[],B=B.SHA256=C.extend({_doReset:function(){this._hash=new P.init(N.slice(0))},_doProcessBlock:function(t,e){for(var n,s,i=this._hash.words,a=i[0],r=i[1],o=i[2],l=i[3],c=i[4],u=i[5],_=i[6],h=i[7],p=0;p<64;p++)M[p]=p<16?0|t[e+p]:(((n=M[p-15])<<25|n>>>7)^(n<<14|n>>>18)^n>>>3)+M[p-7]+(((s=M[p-2])<<15|s>>>17)^(s<<13|s>>>19)^s>>>10)+M[p-16],n=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&_)+F[p]+M[p],s=((a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22))+(a&r^a&o^r&o),h=_,_=u,u=c,c=l+n|0,l=o,o=r,r=a,a=n+s|0;i[0]=i[0]+a|0,i[1]=i[1]+r|0,i[2]=i[2]+o|0,i[3]=i[3]+l|0,i[4]=i[4]+c|0,i[5]=i[5]+u|0,i[6]=i[6]+_|0,i[7]=i[7]+h|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[14+(64+s>>>9<<4)]=w.floor(n/4294967296),e[15+(64+s>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=C.clone.call(this);return t._hash=this._hash.clone(),t}}),q=(A.SHA256=C._createHelper(B),A.HmacSHA256=C._createHmacHelper(B),c=(g=_).enc.Utf8,g.algo.HMAC=g.lib.Base.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=c.parse(e));var n=t.blockSize,s=4*n;(e=e.sigBytes>s?t.finalize(e):e).clamp();for(var t=this._oKey=e.clone(),e=this._iKey=e.clone(),i=t.words,a=e.words,r=0;r<n;r++)i[r]^=1549556828,a[r]^=909522486;t.sigBytes=e.sigBytes=s,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}}),A=_.lib.WordArray,u=A.init,(A.init=function(t){if((t=(t=t instanceof ArrayBuffer?new Uint8Array(t):t)instanceof Int8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t)instanceof Uint8Array){for(var e=t.byteLength,n=[],s=0;s<e;s++)n[s>>>2]|=t[s]<<24-s%4*8;u.call(this,n,e)}else u.apply(this,arguments)}).prototype=A,n.mule_upload=function(t){var o=function(){},l=(console&&console.log&&(o=function(){for(var t=["[MuleUploader]"],e=0;e<arguments.length;e++)t.push(arguments[e]);return console.log.apply(console,t)}),1073741824);if(File.prototype.slice=File.prototype.webkitSlice||File.prototype.mozSlice||File.prototype.slice,!(n.File&&n.FileList&&n.Blob))return o("HTML5 APIs not available."),-1;if(-1!==navigator.userAgent.indexOf("Firefox"))try{new Blob(["something"])}catch(t){return-1}function e(t){var n=this;n.input=(t=t||{}).file_input,n.file=t.file,t.chunk_size=t.chunk_size||6291456,t.max_size=t.max_size||5*l,t.num_workers=t.num_workers||4,t.key=t.key||"the_key",t.bucket=t.bucket,t.host=t.host||location.protocol+"//"+t.bucket+".s3.amazonaws.com",t.access_key=t.access_key,t.content_type=t.content_type||"application/octet-stream",t.acl=t.acl||"public-read",t.on_progress=t.on_progress||function(){},t.on_chunk_progress=t.on_chunk_progress||function(){},t.on_select=t.on_select||function(){},t.on_error=t.on_error||function(){},t.on_complete=t.on_complete||function(){},t.on_init=t.on_init||function(){},t.on_start=t.on_start||function(){},t.on_chunk_uploaded=t.on_chunk_uploaded||function(){},t.extra_params=t.extra_params||{},t.ajax_base=t.ajax_base||"/upload-backend",t.accepted_extensions=t.accepted_extensions||"",n.settings=t,n.set_state("waiting"),n.input&&(n.input.onchange=function(t,e){return"waiting"==n.get_state()&&(t=t.target.files[0],n.upload_file(t,e),!0)}),setTimeout(function(){n.settings.on_init.apply(n)},100)}return o("OK"),e.prototype.upload_file=function(e,n){var s=this;if("waiting"!=s.get_state())return!1;if(e&&(s.file=e),!s.file)return!1;if(s.file.lastModifiedDate=s.file.lastModified||Math.round(Date.now()/1e3),s.file.size>s.settings.max_size)return alert(["The maximum allowed file size is ",s.settings.max_size/l,"GB. Please select another file."].join("")),!1;if(s.settings.accepted_extensions){for(var t=e.name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").split(".").pop(),i=s.settings.accepted_extensions.split(","),a=!1,r=0;r<i.length;r++)if(t==i[r]){a=!0;break}if(!a)return alert(["This file format is not accepted. ","Please use a file with an extension like ",s.settings.accepted_extensions].join("")),!1}s.settings.on_select.call(s,e);var o={filename:e.name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").replace(/\s\s+/g," "),filesize:e.size,key:s.settings.key,mime_type:s.settings.content_type,collectionId:s.settings.collectionId,last_modified:e.lastModifiedDate};n&&(o.force=!0),U({url:s.settings.ajax_base+"/signing_key/",extra_params:o,load_callback:function(t){t=JSON.parse(t.target.responseText);t.date=new Date(t.date+".000Z"),s.auth=t,s.upload_id=t.upload_id,s.chunks=t.chunks,s.settings.key=t.key||s.settings.key,s.settings.backup_key=s.settings.key,s.upload_id?n?s.load_file():q.list(s.auth,s.file,s.settings.key,s.upload_id,s.settings.chunk_size,function(t){for(var e=0;e<t.length;e++){var n=t[e][0]-1;s.set_progress(n,s.get_chunk_size(n)),s.set_chunk_finished(n),s.set_chunk_uploading(n,!1)}s.load_file()},function(){s.upload_id=null,this._loaded_chunks=null,s._progress=null,s._total_progress=null,s._loaded_chunks=null,s._uploading_chunks=null,s._chunks=null,s.settings.key=s.settings.backup_key,s.upload_file(e,!0)}):(console.log(t),q.init(t,s.settings.key,e,function(t){t=t.target.responseXML;s.upload_id=t.getElementsByTagName("UploadId")[0].textContent,s.load_file()}))}})},e.prototype.load_file=function(){var t=this;if("waiting"==t.get_state()){t._start_fired||(t.settings.on_start.call(t,t.file),t.settings.on_progress.call(t,0,t.file.size),t._start_fired=!0),t.set_state("processing"),t.settings.on_progress.call(t,t.get_total_progress(),t.file.size);var e=t.get_next_chunk();-1!=e?t.upload_chunk(e):t.upload_finished()&&(o("All done; finish upload"),t.finish_upload());for(var n=0;n<t.settings.num_workers-1&&-1!==(e=t.get_next_chunk());n++)t.upload_chunk(e)}},e.prototype.upload_chunk=function(n){var t,e,s,i,a,r=this;"processing"!=r.get_state()?o("NOT processing; return"):r.get_chunk_uploading(n)?(o("Already Uploading"),setTimeout(function(){-1!==r.get_next_chunk()&&r.upload_chunk(r.get_next_chunk())},1e3)):(r.set_chunk_uploading(n),o("Uploading Chunk: "+n),r.is_chunk_loaded(n)&&(-1!=(e=r.get_next_chunk())?r.upload_chunk(e):r.upload_finished()&&(o("No next chunk; finish upload"),r.finish_upload())),e=r.settings.chunk_size,t=n*e,e=Math.min(t+e,r.file.size),s=new Date,r._intervals=r._intervals||{},i=!function(t){if(t.target.readyState!=this.DONE||"processing"!=r.get_state())o(t);else{if(t.target.status/100!=2)return a();o("Chunk uploaded: "+n),r.notify_chunk_uploaded(n),r.settings.on_chunk_uploaded.call(r,n),clearInterval(r._intervals[n]),r.set_progress(n,r.get_chunk_size(n)),r.set_chunk_finished(n),r.set_chunk_uploading(n,!1);var e,t=r.get_next_chunk();-1!=t?r.upload_chunk(t):r.upload_finished()?(o("Done"),r.finish_upload()):e=setInterval(function(){var t=r.get_next_chunk();-1!=t?(clearInterval(e),r.upload_chunk(t)):r.upload_finished()&&(clearInterval(e),r.finish_upload())},1e3)}},a=function(){var t=arguments,e=this;r.check_already_uploaded(function(){r.set_state("finished"),r.notify_upload_finished(),r.settings.on_progress.call(r,r.file.size,r.file.size),r.settings.on_complete.call(r)},function(){if(o("Error: "),o(t),!i){i=!0,r.set_chunk_uploading(n,!1),r.set_chunk_finished(n,!1),r.set_progress(n,0),o("Abort");try{e.abort()}catch(t){o(t)}o("Retry chunk: "+n),clearInterval(r._intervals[n]),setTimeout(function(){var t;"processing"==r.get_state()&&-1!==(t=r.get_next_chunk(n))&&r.upload_chunk(t)},1e3)}})},q.upload_chunk(r.auth,r.settings.key,r.upload_id,n,r.file.slice(t,e),{progress_callback:function(t){r.set_progress(n,t.loaded),r.settings.on_progress.call(r,r.get_total_progress(),r.file.size),s=new Date},state_change_callback:function(t){if(t.target.readyState!=this.DONE||"processing"!=r.get_state())o(t);else{if(t.target.status/100!=2)return a();o("Chunk uploaded: "+n),r.notify_chunk_uploaded(n),r.settings.on_chunk_uploaded.call(r,n),clearInterval(r._intervals[n]),r.set_progress(n,r.get_chunk_size(n)),r.set_chunk_finished(n),r.set_chunk_uploading(n,!1);var e,t=r.get_next_chunk();-1!=t?r.upload_chunk(t):r.upload_finished()?(o("Done"),r.finish_upload()):e=setInterval(function(){var t=r.get_next_chunk();-1!=t?(clearInterval(e),r.upload_chunk(t)):r.upload_finished()&&(clearInterval(e),r.finish_upload())},1e3)}},error_callback:a,timeout_callback:a},function(t){r._chunk_xhr=r._chunk_xhr||[],r._chunk_xhr.push(t),r._intervals[n]=setInterval(function(){s&&12e4<new Date-s&&(o("Chunk Failed; retry"),clearInterval(r._intervals[n]),"processing"==r.get_state())&&(t.abort(),a.call(t),r._chunk_xhr[r._chunk_xhr.indexOf(t)]=null)},4e3)}))},e.prototype.finish_upload=function(){var n,s=this;"processing"==s.get_state()&&(s.set_state("finishing"),s.settings.on_progress.call(s,s.file.size,s.file.size),n=function(t){t.target.status/100==2?(o("Finished file."),s.set_state("finished"),s.settings.on_progress.call(s,s.file.size,s.file.size),s.settings.on_complete.call(s)):400==t.target.status&&-1!==t.target.responseText.indexOf("EntityTooSmall")?q.list(s.auth,s.file,s.settings.key,s.upload_id,s.settings.chunk_size,function(t){s.update_chunks(t);t=s.get_next_chunk();s.set_state("processing"),s.upload_chunk(t)}):404==t.target.status?s.cancel(function(){s.upload_file(s.file,!0)}):s.check_already_uploaded(function(){n({target:{status:200}})},function(){n({target:{status:404}})})},q.list(s.auth,s.file,s.settings.key,s.upload_id,s.settings.chunk_size,function(t){var e=Math.ceil(s.file.size/s.settings.chunk_size);t.length!=e?(s.update_chunks(t),e=s.get_next_chunk(),s.set_state("processing"),s.upload_chunk(e)):q.finish(s.auth,s.file,s.settings.key,s.upload_id,t,s.settings.chunk_size,n,n)}))},e.prototype.notify_chunk_uploaded=function(t){var e,n,s,i=this;"processing"==i.get_state()&&(e=i.settings.key,n=i.upload_id,s=i.settings.ajax_base+"/chunk_loaded/",U({url:s,extra_params:{chunk:t,key:e,upload_id:n,filename:i.file.name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").replace(/\s\s+/g," "),filesize:i.file.size,mime_type:i.settings.content_type,collectionId:i.settings.collectionId,last_modified:i.file.lastModifiedDate}}))},e.prototype.check_already_uploaded=function(e,n){var t=this,s="/"+t.settings.key;n||"function"==typeof n||(n=function(){setTimeout(function(){return t.check_already_uploaded(e,n)},2500)}),U({url:t.settings.host+s,method:"HEAD",load_callback:function(t){(t.target.status/100==2?(o("Already Uploaded"),e):(o("Error!"),n))()},error_callback:n})},e.prototype.cancel=function(t){for(var e,n=this,s=0;s<n._chunk_xhr.length;s++)o("Abort chunk: "+n._chunk_xhr[s]),n._chunk_xhr[s].abort();for(e in n._intervals=n._intervals||{},n._intervals)n._intervals.hasOwnProperty(e)&&clearInterval(n._intervals[e]);t=t||function(){},n.set_state("canceled"),n._chunk_xhr=n._chunk_xhr||[],n.settings.on_progress.call(n,0,0),n._chunk_xhr=null,n._chunks=null,n._uploading_chunks=null,n._loaded_chunks=null,n._start_fired=!1,n.upload_id=null,n._progress=null,n.set_state("waiting"),t()},e.prototype.update_chunks=function(t){var e,n=this,s=[],i=Math.ceil(n.file.size/n.settings.chunk_size);for(n._init_chunks(!0),n._uploading_chunks=[],n._loaded_chunks=[],e=0;e<t.length;e++){var a=parseInt(t[e][0],10);n.add_loaded_chunk(a-1),n.set_chunk_finished(a-1),s.push(a-1)}for(e=0;e<i;e++)-1===s.indexOf(e)&&(o("Chunk not uploaded: ",e),n.set_progress(e,0))},e.prototype.is_selected=function(){return!!this.file},e.prototype.get_state=function(){return this._state},e.prototype.set_state=function(t){return this._state=t},e.prototype.set_progress=function(t,e){this.log_status(),this._progress=this._progress||{},this._total_progress=(this._total_progress||0)+e-(this._progress[t]||0),this._progress[t]=e,this.settings.on_chunk_progress.call(this,t,e,this.get_chunk_size(t))},e.prototype.get_total_progress=function(){return this._total_progress||0},e.prototype.is_chunk_loaded=function(t){return this._loaded_chunks=this._loaded_chunks||[],-1!==this._loaded_chunks.indexOf(t)},e.prototype.add_loaded_chunk=function(t){this._loaded_chunks=this._loaded_chunks||[],this._loaded_chunks.push(t),this.set_progress(t,this.get_chunk_size(t))},e.prototype.get_chunk_uploading=function(t){return this._uploading_chunks=this._uploading_chunks||[],-1!==this._uploading_chunks.indexOf(t)},e.prototype.set_chunk_uploading=function(t,e){if(void 0===e&&(e=!0),this._uploading_chunks=this._uploading_chunks||[],e)this._uploading_chunks.push(t);else{for(var n=[],s=0;s<this._uploading_chunks.length;s++)this._uploading_chunks[s]!=t&&n.push(this._uploading_chunks[s]);this._uploading_chunks=n}},e.prototype._init_chunks=function(t){var e=this;if(!e._chunks||t){e._chunks=[];for(var n=Math.ceil(e.file.size/e.settings.chunk_size),s=0;s<n;s++)e._chunks.push(!1)}},e.prototype.set_chunk_finished=function(t,e){void 0===e&&(e=!0);this._init_chunks(),this._chunks[t]=e},e.prototype.get_next_chunk=function(t){var e=this;if(e._init_chunks(),t&&!e._chunks[t]&&!e.get_chunk_uploading(t))return t;for(var n=0;n<e._chunks.length;n++)if(!e._chunks[n]&&!e.get_chunk_uploading(n))return n;return-1},e.prototype.upload_finished=function(){this._init_chunks();for(var t=0;t<this._chunks.length;t++)if(!this._chunks[t]||this.get_chunk_uploading(t))return!1;return!0},e.prototype.is_last_chunk=function(t){return Math.ceil(this.file.size/this.settings.chunk_size)-1==t},e.prototype.get_chunk_size=function(t){return this.is_last_chunk(t)?this.file.size%this.settings.chunk_size:this.settings.chunk_size},e.prototype.log_status=function(){},e.prototype.on_chunk_progress=function(t){this.settings.on_chunk_progress=t},e.prototype.on_progress=function(t){this.settings.on_progress=t},e.prototype.on_select=function(t){this.settings.on_select=t},e.prototype.on_error=function(t){this.settings.on_error=t},e.prototype.on_complete=function(t){this.settings.on_complete=t},e.prototype.on_init=function(t){this.settings.on_init=t},e.prototype.on_start=function(t){this.settings.on_start=t},e.prototype.on_chunk_uploaded=function(t){this.settings.on_chunk_uploaded=t},new e(t)},function(t){this.settings=t}),E=(q.finish=function(t,e,n,s,i,a,r){for(var s={uploadId:s},o="<CompleteMultipartUpload>",l=0;l<i.length;l++)o=(o=(o+="<Part>")+"<PartNumber>"+i[l][0]+"</PartNumber>")+"<ETag>"+i[l][1]+"</ETag></Part>";return o+="</CompleteMultipartUpload>",-1!==navigator.userAgent.indexOf("Firefox")&&(o=new Blob([o])),new q({auth:t,key:n,method:"POST",querystring:s,headers:{},payload:o,load_callback:r}).send()},q.list=function(l,c,u,_,h,p,d,t){var e={uploadId:_};return t&&(e["part-number-marker"]=t),new q({auth:l,key:u,method:"GET",querystring:e,headers:{},payload:"",error_callback:d,load_callback:function(t){if(404===t.target.status)d&&d();else{for(var t=(window.debug=t).target.responseXML,e=[],n=t.getElementsByTagName("Part"),s=Math.ceil(c.size/h),i=0;i<n.length;i++){var a=parseInt(n[i].getElementsByTagName("PartNumber")[0].textContent,10),r=n[i].getElementsByTagName("ETag")[0].textContent,o=parseInt(n[i].getElementsByTagName("Size")[0].textContent,10);a!=s&&o!=h||a==s&&o!=c.size%h||e.push([a,r,o])}"true"===t.getElementsByTagName("IsTruncated")[0].textContent?(t=t.getElementsByTagName("NextPartNumberMarker")[0].textContent,q.list(l,c,u,_,h,function(t){p(e.concat(t))},d,t)):p(e)}}}).send()},q.upload_chunk=function(t,e,n,s,i,a,r){var o,l,c,u;return a instanceof Object?(o=a.load_callback,l=a.error_callback,c=a.progress_callback,u=a.state_change_callback):o=a,new q({auth:t,key:e,method:"PUT",querystring:{partNumber:s+1,uploadId:n},headers:{},payload:i,load_callback:o,error_callback:l,progress_callback:c,state_change_callback:u}).send(r)},q.init=function(t,e,n,s){return new q({auth:t,key:e,method:"POST",querystring:{uploads:""},headers:{"x-amz-acl":"private","Content-Disposition":"attachment; filename="+n.name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").replace(/\s\s+/g," "),"Content-Type":t.content_type||"application/octet-stream"},payload:"",load_callback:s}).send()},q.prototype={send:function(t){var e=this,n=(e.request_date=new Date,e.headers=e.settings.headers,e.headers.host=e.settings.auth.bucket+".s3.amazonaws.com",[e.settings.auth.date.getUTCFullYear(),E.zfill(e.settings.auth.date.getUTCMonth()+1,2),E.zfill(e.settings.auth.date.getUTCDate(),2)].join("")),s=(e.settings.querystring["X-Amz-Date"]=E.uriencode(E.iso8601(e.request_date)),e.settings.querystring["X-Amz-Algorithm"]="AWS4-HMAC-SHA256",e.settings.querystring["X-Amz-Expires"]=86400,e.settings.querystring["X-Amz-Credential"]=E.uriencode([e.settings.auth.access_key,"/"+n+"/",e.settings.auth.region+"/s3/aws4_request"].join("")),e.settings.querystring["X-Amz-SignedHeaders"]="",[]);for(i in e.headers)s.push(i);s.sort(),e.settings.querystring["X-Amz-SignedHeaders"]=E.uriencode(s.join(";")),e.settings.querystring["X-Amz-Signature"]=e.get_authorization_header(),delete e.headers.host;var i,a=location.protocol+"//"+e.settings.auth.bucket+".s3.amazonaws.com/"+e.settings.key,r=!0;for(i in e.settings.querystring)e.settings.querystring.hasOwnProperty(i)&&(r&&(a+="?"),r=!1,a+=i+"="+e.settings.querystring[i]+"&");a=a.slice(0,-1),n=U({url:a,method:e.settings.method,headers:e.headers,body:e.settings.payload,load_callback:e.settings.load_callback,progress_callback:e.settings.progress_callback,state_change_callback:e.settings.state_change_callback,error_callback:e.settings.error_callback,timeout_callback:e.settings.timeout_callback});t&&t(n)},get_authorization_header:function(){if(!this.settings.auth.date)throw"Invalid date given.";for(var t=E.get_sorted_keys(this.headers),e="",n=0;n<t.length;n++)e+=t[n].toLowerCase()+";";var e=e.slice(0,-1),s=this.get_canonical_request(),s=this.get_string_to_sign(s,this.request_date);return this.sign_request(s)},get_canonical_request:function(){for(var t,e,n="",s=(n=(n+=this.settings.method.toUpperCase()+"\n")+("/"+E.uriencode(this.settings.key).replace(/%2F/g,"/")+"\n"),E.get_sorted_keys(this.settings.querystring)),i=0;i<s.length;i++)t=s[i],e=this.settings.querystring[t],n+=E.uriencode(t)+"="+e+"&amp;";var n=n.slice(0,-"&amp;".length)+"\n",a=E.get_sorted_keys(this.headers);for(i=0;i<a.length;i++)t=a[i],e=this.headers[t],n+=t.toLowerCase()+":"+e.trim()+"\n";for(n+="\n",i=0;i<a.length;i++)n+=a[i].toLowerCase()+";";return n=n.slice(0,-1)+"\n",n+="UNSIGNED-PAYLOAD"},get_string_to_sign:function(t,e){var n="";return(n+="AWS4-HMAC-SHA256\n")+(E.iso8601(e)+"\n")+[e.getUTCFullYear(),E.zfill(e.getUTCMonth()+1,2),E.zfill(e.getUTCDate(),2),"/"+this.settings.auth.region+"/s3/aws4_request\n"].join("")+_.SHA256(t.replace(/&amp;/g,"&")).toString()},sign_request:function(t){if(this.settings.auth.signature)return _.HmacSHA256(t,_.enc.Hex.parse(this.settings.auth.signature)).toString();throw"No signature provided."}},{uriencode:function(t){t=encodeURIComponent(t);return t=(t=(t=t.replace(/[^A-Za-z0-9_.~\-%]+/g,escape)).replace(/;/g,"%3B")).replace(/[*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})},get_sorted_keys:function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e);return n.sort()},iso8601:function(t){return[t.getUTCFullYear(),E.zfill(t.getUTCMonth()+1,2),E.zfill(t.getUTCDate(),2),"T",E.zfill(t.getUTCHours(),2),E.zfill(t.getUTCMinutes(),2),E.zfill(t.getUTCSeconds(),2),"Z"].join("")},zfill:function(t,e){return("00000000000"+t).substr(-e)}})})(this);
//# sourceMappingURL=mule2.min.js.map
