!function(t){var e,n,s=s||function(t,e){var n={},s=n.lib={},i=function(){},r=s.Base={extend:function(t){i.prototype=this;var e=new i;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=s.WordArray=r.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,s=this.sigBytes;if(t=t.sigBytes,this.clamp(),s%4)for(var i=0;i<t;i++)e[s+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(s+i)%4*8;else if(65535<n.length)for(i=0;i<t;i+=4)e[s+i>>>2]=n[i>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=r.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],s=0;s<e;s+=4)n.push(4294967296*t.random()|0);return new a.init(n,e)}}),o=n.enc={},l=o.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],s=0;s<t;s++){var i=e[s>>>2]>>>24-s%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],s=0;s<e;s+=2)n[s>>>3]|=parseInt(t.substr(s,2),16)<<24-s%8*4;return new a.init(n,e/2)}},c=o.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],s=0;s<t;s++)n.push(String.fromCharCode(e[s>>>2]>>>24-s%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],s=0;s<e;s++)n[s>>>2]|=(255&t.charCodeAt(s))<<24-s%4*8;return new a.init(n,e)}},u=o.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},_=s.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,s=n.words,i=n.sigBytes,r=this.blockSize,o=i/(4*r);if(e=(o=e?t.ceil(o):t.max((0|o)-this._minBufferSize,0))*r,i=t.min(4*e,i),e){for(var l=0;l<e;l+=r)this._doProcessBlock(s,l);l=s.splice(0,e),n.sigBytes-=i}return new a.init(l,i)},clone:function(){var t=r.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});s.Hasher=_.extend({cfg:r.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=n.algo={};return n}(Math);!function(t){for(var e=s,n=(r=e.lib).WordArray,i=r.Hasher,r=e.algo,a=[],o=[],l=function(t){return 4294967296*(t-(0|t))|0},c=2,u=0;64>u;){var _;t:{_=c;for(var h=t.sqrt(_),p=2;p<=h;p++)if(!(_%p)){_=!1;break t}_=!0}_&&(8>u&&(a[u]=l(t.pow(c,.5))),o[u]=l(t.pow(c,1/3)),u++),c++}var d=[];r=r.SHA256=i.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,s=n[0],i=n[1],r=n[2],a=n[3],l=n[4],c=n[5],u=n[6],_=n[7],h=0;64>h;h++){if(16>h)d[h]=0|t[e+h];else{var p=d[h-15],g=d[h-2];d[h]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+d[h-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+d[h-16]}p=_+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&c^~l&u)+o[h]+d[h],g=((s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22))+(s&i^s&r^i&r),_=u,u=c,c=l,l=a+p|0,a=r,r=i,i=s,s=p+g|0}n[0]=n[0]+s|0,n[1]=n[1]+i|0,n[2]=n[2]+r|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0,n[5]=n[5]+c|0,n[6]=n[6]+u|0,n[7]=n[7]+_|0},_doFinalize:function(){var e=this._data,n=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=t.floor(s/4294967296),n[15+(i+64>>>9<<4)]=s,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=i._createHelper(r),e.HmacSHA256=i._createHmacHelper(r)}(Math),function(t){for(var e=s,n=(r=e.lib).WordArray,i=r.Hasher,r=e.algo,a=[],o=[],l=function(t){return 4294967296*(t-(0|t))|0},c=2,u=0;64>u;){var _;t:{_=c;for(var h=t.sqrt(_),p=2;p<=h;p++)if(!(_%p)){_=!1;break t}_=!0}_&&(8>u&&(a[u]=l(t.pow(c,.5))),o[u]=l(t.pow(c,1/3)),u++),c++}var d=[];r=r.SHA256=i.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,s=n[0],i=n[1],r=n[2],a=n[3],l=n[4],c=n[5],u=n[6],_=n[7],h=0;64>h;h++){if(16>h)d[h]=0|t[e+h];else{var p=d[h-15],g=d[h-2];d[h]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+d[h-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+d[h-16]}p=_+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&c^~l&u)+o[h]+d[h],g=((s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22))+(s&i^s&r^i&r),_=u,u=c,c=l,l=a+p|0,a=r,r=i,i=s,s=p+g|0}n[0]=n[0]+s|0,n[1]=n[1]+i|0,n[2]=n[2]+r|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0,n[5]=n[5]+c|0,n[6]=n[6]+u|0,n[7]=n[7]+_|0},_doFinalize:function(){var e=this._data,n=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=t.floor(s/4294967296),n[15+(i+64>>>9<<4)]=s,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=i._createHelper(r),e.HmacSHA256=i._createHmacHelper(r)}(Math),n=(e=s).enc.Utf8,e.algo.HMAC=e.lib.Base.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=n.parse(e));var s=t.blockSize,i=4*s;e.sigBytes>i&&(e=t.finalize(e)),e.clamp();for(var r=this._oKey=e.clone(),a=this._iKey=e.clone(),o=r.words,l=a.words,c=0;c<s;c++)o[c]^=1549556828,l[c]^=909522486;r.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}}),function(){if(void 0!==typeof ArrayBuffer){var t=s.lib.WordArray,e=t.init;(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,s=[],i=0;i<n;i++)s[i>>>2]|=t[i]<<24-i%4*8;e.call(this,s,n)}else e.apply(this,arguments)}).prototype=t}}();var i=function(t){t.headers=t.headers||{},t.method=t.method||"GET";var e=new XMLHttpRequest;t.load_callback&&"function"==typeof t.load_callback&&e.addEventListener("load",t.load_callback,!0),t.error_callback&&"function"==typeof t.error_callback&&e.addEventListener("error",t.error_callback,!0),t.state_change_callback&&"function"==typeof t.state_change_callback&&e.addEventListener("readystatechange",t.state_change_callback),t.progress_callback&&"function"==typeof t.progress_callback&&e.upload.addEventListener("progress",t.progress_callback),t.timeout_callback&&"function"==typeof t.timeout_callback&&e.addEventListener("timeout",t.timeout_callback);var n=t.url;if(t.extra_params)for(var s in t.extra_params)t.extra_params.hasOwnProperty(s)&&(-1!==n.indexOf("?")?n+="&":n+="?",n+=encodeURIComponent(s)+"=",n+=encodeURIComponent(t.extra_params[s]));for(var i in e.open(t.method,n),t.headers)t.headers.hasOwnProperty(i)&&e.setRequestHeader(i,t.headers[i]);return t.body?e.send(t.body):e.send(),e};t.mule_upload=function(e){var n=function(){};console&&console.log&&(n=function(){for(var t=["[MuleUploader]"],e=0;e<arguments.length;e++)t.push(arguments[e]);return console.log.apply(console,t)});var s=1048576,a=1024*s;if(File.prototype.slice=File.prototype.webkitSlice||File.prototype.mozSlice||File.prototype.slice,!(t.File&&t.FileList&&t.Blob))return n("HTML5 APIs not available."),-1;if(-1!==navigator.userAgent.indexOf("Firefox"))try{new Blob(["something"])}catch(t){return-1}function o(t){var e=this;t=t||{},e.input=t.file_input,e.file=t.file,t.chunk_size=t.chunk_size||6*s,t.max_size=t.max_size||5*a,t.num_workers=t.num_workers||4,t.key=t.key||"the_key",t.bucket=t.bucket,t.host=t.host||location.protocol+"//"+t.bucket+".s3.amazonaws.com",t.access_key=t.access_key,t.content_type=t.content_type||"application/octet-stream",t.acl=t.acl||"public-read",t.on_progress=t.on_progress||function(){},t.on_chunk_progress=t.on_chunk_progress||function(){},t.on_select=t.on_select||function(){},t.on_error=t.on_error||function(){},t.on_complete=t.on_complete||function(){},t.on_init=t.on_init||function(){},t.on_start=t.on_start||function(){},t.on_chunk_uploaded=t.on_chunk_uploaded||function(){},t.extra_params=t.extra_params||{},t.ajax_base=t.ajax_base||"/upload-backend",t.accepted_extensions=t.accepted_extensions||"",e.settings=t,e.set_state("waiting"),e.input&&(e.input.onchange=function(t,n){if("waiting"!=e.get_state())return!1;var s=t.target.files[0];return e.upload_file(s,n),!0}),setTimeout(function(){e.settings.on_init.apply(e)},100)}return n("OK"),o.prototype.upload_file=function(t,e){var n=this;if("waiting"!=n.get_state())return!1;if(t&&(n.file=t),!n.file)return!1;if(n.file.lastModifiedDate=n.file.lastModified||Math.round(Date.now()/1e3),n.file.size>n.settings.max_size)return alert(["The maximum allowed file size is ",n.settings.max_size/a,"GB. Please select another file."].join("")),!1;if(n.settings.accepted_extensions){for(var s=t.name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").split(".").pop(),o=n.settings.accepted_extensions.split(","),l=!1,c=0;c<o.length;c++)if(s==o[c]){l=!0;break}if(!l)return alert(["This file format is not accepted. ","Please use a file with an extension like ",n.settings.accepted_extensions].join("")),!1}n.settings.on_select.call(n,t);var u={filename:t.name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").replace(/\s\s+/g," "),filesize:t.size,key:n.settings.key,mime_type:n.settings.content_type,collectionId:n.settings.collectionId,last_modified:t.lastModifiedDate};e&&(u.force=!0),i({url:n.settings.ajax_base+"/signing_key/",extra_params:u,load_callback:function(s){var i=JSON.parse(s.target.responseText);i.date=new Date(i.date+".000Z"),n.auth=i,n.upload_id=i.upload_id,n.chunks=i.chunks,n.settings.key=i.key||n.settings.key,n.settings.backup_key=n.settings.key,n.upload_id?e?n.load_file():r.list(n.auth,n.file,n.settings.key,n.upload_id,n.settings.chunk_size,function(t){for(var e=0;e<t.length;e++){var s=t[e][0]-1;n.set_progress(s,n.get_chunk_size(s)),n.set_chunk_finished(s),n.set_chunk_uploading(s,!1)}n.load_file()},function(){n.upload_id=null,this._loaded_chunks=null,n._progress=null,n._total_progress=null,n._loaded_chunks=null,n._uploading_chunks=null,n._chunks=null,n.settings.key=n.settings.backup_key,n.upload_file(t,!0)}):(console.log(i),r.init(i,n.settings.key,t,function(t){var e=t.target.responseXML;n.upload_id=e.getElementsByTagName("UploadId")[0].textContent,n.load_file()}))}})},o.prototype.load_file=function(){var t=this;if("waiting"==t.get_state()){t._start_fired||(t.settings.on_start.call(t,t.file),t.settings.on_progress.call(t,0,t.file.size),t._start_fired=!0),t.set_state("processing"),t.settings.on_progress.call(t,t.get_total_progress(),t.file.size);var e=t.get_next_chunk();-1!=e?t.upload_chunk(e):t.upload_finished()&&(n("All done; finish upload"),t.finish_upload());for(var s=0;s<t.settings.num_workers-1&&-1!==(e=t.get_next_chunk());s++)t.upload_chunk(e)}},o.prototype.upload_chunk=function(t){var e=this;if("processing"==e.get_state()){if(e.get_chunk_uploading(t))return n("Already Uploading"),void setTimeout(function(){-1!==e.get_next_chunk()&&e.upload_chunk(e.get_next_chunk())},1e3);if(e.set_chunk_uploading(t),n("Uploading Chunk: "+t),e.is_chunk_loaded(t)){var s=e.get_next_chunk();-1!=s?e.upload_chunk(s):e.upload_finished()&&(n("No next chunk; finish upload"),e.finish_upload())}var i=e.settings.chunk_size,a=t*i,o=Math.min(a+i,e.file.size),l=new Date;e._intervals=e._intervals||{};var c=!1,u=function(){var s=arguments,i=this;e.check_already_uploaded(function(){e.set_state("finished"),e.notify_upload_finished(),e.settings.on_progress.call(e,e.file.size,e.file.size),e.settings.on_complete.call(e)},function(){if(n("Error: "),n(s),!c){c=!0,e.set_chunk_uploading(t,!1),e.set_chunk_finished(t,!1),e.set_progress(t,0),n("Abort");try{i.abort()}catch(t){n(t)}n("Retry chunk: "+t),clearInterval(e._intervals[t]),setTimeout(function(){if("processing"==e.get_state()){var n=e.get_next_chunk(t);-1!==n&&e.upload_chunk(n)}},1e3)}})};r.upload_chunk(e.auth,e.settings.key,e.upload_id,t,e.file.slice(a,o),{progress_callback:function(n){e.set_progress(t,n.loaded),e.settings.on_progress.call(e,e.get_total_progress(),e.file.size),l=new Date},state_change_callback:function(s){if(s.target.readyState==this.DONE&&"processing"==e.get_state()){if(s.target.status/100!=2)return u();n("Chunk uploaded: "+t),e.notify_chunk_uploaded(t),e.settings.on_chunk_uploaded.call(e,t),clearInterval(e._intervals[t]),e.set_progress(t,e.get_chunk_size(t)),e.set_chunk_finished(t),e.set_chunk_uploading(t,!1);var i=e.get_next_chunk();if(-1!=i)e.upload_chunk(i);else if(e.upload_finished())n("Done"),e.finish_upload();else var r=setInterval(function(){var t=e.get_next_chunk();-1!=t?(clearInterval(r),e.upload_chunk(t)):e.upload_finished()&&(clearInterval(r),e.finish_upload())},1e3)}else n(s)},error_callback:u,timeout_callback:u},function(s){e._chunk_xhr=e._chunk_xhr||[],e._chunk_xhr.push(s),e._intervals[t]=setInterval(function(){l&&new Date-l>12e4&&(n("Chunk Failed; retry"),clearInterval(e._intervals[t]),"processing"==e.get_state()&&(s.abort(),u.call(s),e._chunk_xhr[e._chunk_xhr.indexOf(s)]=null))},4e3)})}else n("NOT processing; return")},o.prototype.finish_upload=function(){var t=this;if("processing"==t.get_state()){t.set_state("finishing"),t.settings.on_progress.call(t,t.file.size,t.file.size);var e=function(s){s.target.status/100==2?(n("Finished file."),t.set_state("finished"),t.settings.on_progress.call(t,t.file.size,t.file.size),t.settings.on_complete.call(t)):400==s.target.status&&-1!==s.target.responseText.indexOf("EntityTooSmall")?r.list(t.auth,t.file,t.settings.key,t.upload_id,t.settings.chunk_size,function(e){t.update_chunks(e);var n=t.get_next_chunk();t.set_state("processing"),t.upload_chunk(n)}):404==s.target.status?t.cancel(function(){t.upload_file(t.file,!0)}):t.check_already_uploaded(function(){e({target:{status:200}})},function(){e({target:{status:404}})})};r.list(t.auth,t.file,t.settings.key,t.upload_id,t.settings.chunk_size,function(n){var s=Math.ceil(t.file.size/t.settings.chunk_size);if(n.length!=s){t.update_chunks(n);var i=t.get_next_chunk();return t.set_state("processing"),void t.upload_chunk(i)}r.finish(t.auth,t.file,t.settings.key,t.upload_id,n,t.settings.chunk_size,e,e)})}},o.prototype.notify_chunk_uploaded=function(t){var e=this;if("processing"==e.get_state()){var n=e.settings.key,s=e.upload_id,r=e.settings.ajax_base+"/chunk_loaded/";i({url:r,extra_params:{chunk:t,key:n,upload_id:s,filename:e.file.name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").replace(/\s\s+/g," "),filesize:e.file.size,mime_type:e.settings.content_type,collectionId:e.settings.collectionId,last_modified:e.file.lastModifiedDate}})}},o.prototype.check_already_uploaded=function(t,e){var s=this,r="/"+s.settings.key;e||"function"==typeof e||(e=function(){setTimeout(function(){return s.check_already_uploaded(t,e)},2500)}),i({url:s.settings.host+r,method:"HEAD",load_callback:function(s){s.target.status/100==2?(n("Already Uploaded"),t()):(n("Error!"),e())},error_callback:e})},o.prototype.cancel=function(t){for(var e=this,s=0;s<e._chunk_xhr.length;s++)n("Abort chunk: "+e._chunk_xhr[s]),e._chunk_xhr[s].abort();for(var i in e._intervals=e._intervals||{},e._intervals)e._intervals.hasOwnProperty(i)&&clearInterval(e._intervals[i]);t=t||function(){},e.set_state("canceled"),e._chunk_xhr=e._chunk_xhr||[],e.settings.on_progress.call(e,0,0),e._chunk_xhr=null,e._chunks=null,e._uploading_chunks=null,e._loaded_chunks=null,e._start_fired=!1,e.upload_id=null,e._progress=null,e.set_state("waiting"),t()},o.prototype.update_chunks=function(t){var e,s=this,i=[],r=Math.ceil(s.file.size/s.settings.chunk_size);for(s._init_chunks(!0),s._uploading_chunks=[],s._loaded_chunks=[],e=0;e<t.length;e++){var a=parseInt(t[e][0],10);s.add_loaded_chunk(a-1),s.set_chunk_finished(a-1),i.push(a-1)}for(e=0;e<r;e++)-1===i.indexOf(e)&&(n("Chunk not uploaded: ",e),s.set_progress(e,0))},o.prototype.is_selected=function(){return!!this.file},o.prototype.get_state=function(){return this._state},o.prototype.set_state=function(t){return this._state=t,t},o.prototype.set_progress=function(t,e){this.log_status(),this._progress=this._progress||{},this._total_progress=(this._total_progress||0)+e-(this._progress[t]||0),this._progress[t]=e,this.settings.on_chunk_progress.call(this,t,e,this.get_chunk_size(t))},o.prototype.get_total_progress=function(){return this._total_progress||0},o.prototype.is_chunk_loaded=function(t){return this._loaded_chunks=this._loaded_chunks||[],-1!==this._loaded_chunks.indexOf(t)},o.prototype.add_loaded_chunk=function(t){this._loaded_chunks=this._loaded_chunks||[],this._loaded_chunks.push(t),this.set_progress(t,this.get_chunk_size(t))},o.prototype.get_chunk_uploading=function(t){return this._uploading_chunks=this._uploading_chunks||[],-1!==this._uploading_chunks.indexOf(t)},o.prototype.set_chunk_uploading=function(t,e){if(void 0===e&&(e=!0),this._uploading_chunks=this._uploading_chunks||[],e)this._uploading_chunks.push(t);else{for(var n=[],s=0;s<this._uploading_chunks.length;s++)this._uploading_chunks[s]!=t&&n.push(this._uploading_chunks[s]);this._uploading_chunks=n}},o.prototype._init_chunks=function(t){var e=this;if(!e._chunks||t){e._chunks=[];for(var n=Math.ceil(e.file.size/e.settings.chunk_size),s=0;s<n;s++)e._chunks.push(!1)}},o.prototype.set_chunk_finished=function(t,e){void 0===e&&(e=!0);this._init_chunks(),this._chunks[t]=e},o.prototype.get_next_chunk=function(t){var e=this;if(e._init_chunks(),t&&!e._chunks[t]&&!e.get_chunk_uploading(t))return t;for(var n=0;n<e._chunks.length;n++)if(!e._chunks[n]&&!e.get_chunk_uploading(n))return n;return-1},o.prototype.upload_finished=function(){var t=this;t._init_chunks();for(var e=0;e<t._chunks.length;e++)if(!t._chunks[e]||t.get_chunk_uploading(e))return!1;return!0},o.prototype.is_last_chunk=function(t){return Math.ceil(this.file.size/this.settings.chunk_size)-1==t},o.prototype.get_chunk_size=function(t){return this.is_last_chunk(t)?this.file.size%this.settings.chunk_size:this.settings.chunk_size},o.prototype.log_status=function(){},o.prototype.on_chunk_progress=function(t){this.settings.on_chunk_progress=t},o.prototype.on_progress=function(t){this.settings.on_progress=t},o.prototype.on_select=function(t){this.settings.on_select=t},o.prototype.on_error=function(t){this.settings.on_error=t},o.prototype.on_complete=function(t){this.settings.on_complete=t},o.prototype.on_init=function(t){this.settings.on_init=t},o.prototype.on_start=function(t){this.settings.on_start=t},o.prototype.on_chunk_uploaded=function(t){this.settings.on_chunk_uploaded=t},new o(e)};var r=function(t){this.settings=t};r.finish=function(t,e,n,s,i,a,o){for(var l={uploadId:s},c="<CompleteMultipartUpload>",u=0;u<i.length;u++)c+="<Part>",c+="<PartNumber>"+i[u][0]+"</PartNumber>",c+="<ETag>"+i[u][1]+"</ETag>",c+="</Part>";return c+="</CompleteMultipartUpload>",-1!==navigator.userAgent.indexOf("Firefox")&&(c=new Blob([c])),new r({auth:t,key:n,method:"POST",querystring:l,headers:{},payload:c,load_callback:o}).send()},r.list=function(t,e,n,s,i,a,o,l){var c={uploadId:s};return l&&(c["part-number-marker"]=l),new r({auth:t,key:n,method:"GET",querystring:c,headers:{},payload:"",error_callback:o,load_callback:function(l){if(404!==l.target.status){window.debug=l;for(var c=l.target.responseXML,u=[],_=c.getElementsByTagName("Part"),h=Math.ceil(e.size/i),p=0;p<_.length;p++){var d=parseInt(_[p].getElementsByTagName("PartNumber")[0].textContent,10),g=_[p].getElementsByTagName("ETag")[0].textContent,f=parseInt(_[p].getElementsByTagName("Size")[0].textContent,10);d!=h&&f!=i||(d==h&&f!=e.size%i||u.push([d,g,f]))}if("true"===c.getElementsByTagName("IsTruncated")[0].textContent){var k=c.getElementsByTagName("NextPartNumberMarker")[0].textContent;r.list(t,e,n,s,i,function(t){a(u.concat(t))},o,k)}else a(u)}else o&&o()}}).send()},r.upload_chunk=function(t,e,n,s,i,a,o){var l,c,u,_;return a instanceof Object?(l=a.load_callback,c=a.error_callback,u=a.progress_callback,_=a.state_change_callback):l=a,new r({auth:t,key:e,method:"PUT",querystring:{partNumber:s+1,uploadId:n},headers:{},payload:i,load_callback:l,error_callback:c,progress_callback:u,state_change_callback:_}).send(o)},r.init=function(t,e,n,s){return new r({auth:t,key:e,method:"POST",querystring:{uploads:""},headers:{"x-amz-acl":"private","Content-Disposition":"attachment; filename="+n.name.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").replace(/\s\s+/g," "),"Content-Type":t.content_type||"application/octet-stream"},payload:"",load_callback:s}).send()},r.prototype={send:function(t){this.request_date=new Date,this.headers=this.settings.headers,this.headers.host=this.settings.auth.bucket+".s3.amazonaws.com";var e=[this.settings.auth.date.getUTCFullYear(),a.zfill(this.settings.auth.date.getUTCMonth()+1,2),a.zfill(this.settings.auth.date.getUTCDate(),2)].join("");this.settings.querystring["X-Amz-Date"]=a.uriencode(a.iso8601(this.request_date)),this.settings.querystring["X-Amz-Algorithm"]="AWS4-HMAC-SHA256",this.settings.querystring["X-Amz-Expires"]=86400,this.settings.querystring["X-Amz-Credential"]=a.uriencode([this.settings.auth.access_key,"/"+e+"/",this.settings.auth.region+"/s3/aws4_request"].join("")),this.settings.querystring["X-Amz-SignedHeaders"]="";var n=[];for(var s in this.headers)n.push(s);n.sort(),this.settings.querystring["X-Amz-SignedHeaders"]=a.uriencode(n.join(";")),this.settings.querystring["X-Amz-Signature"]=this.get_authorization_header(),delete this.headers.host;var r=location.protocol+"//"+this.settings.auth.bucket+".s3.amazonaws.com/"+this.settings.key,o=!0;for(var s in this.settings.querystring)this.settings.querystring.hasOwnProperty(s)&&(o&&(r+="?"),o=!1,r+=s+"="+this.settings.querystring[s]+"&");r=r.slice(0,-1);var l=i({url:r,method:this.settings.method,headers:this.headers,body:this.settings.payload,load_callback:this.settings.load_callback,progress_callback:this.settings.progress_callback,state_change_callback:this.settings.state_change_callback,error_callback:this.settings.error_callback,timeout_callback:this.settings.timeout_callback});t&&t(l)},get_authorization_header:function(){if(!this.settings.auth.date)throw"Invalid date given.";for(var t=a.get_sorted_keys(this.headers),e="",n=0;n<t.length;n++)e+=t[n].toLowerCase()+";";e=e.slice(0,-1);var s=this.get_canonical_request(),i=this.get_string_to_sign(s,this.request_date);return this.sign_request(i)},get_canonical_request:function(){var t="";t+=this.settings.method.toUpperCase()+"\n",t+="/"+a.uriencode(this.settings.key).replace(/%2F/g,"/")+"\n";var e,n,s,i=a.get_sorted_keys(this.settings.querystring);for(s=0;s<i.length;s++)e=i[s],n=this.settings.querystring[e],t+=a.uriencode(e)+"="+n+"&amp;";t=t.slice(0,-"&amp;".length)+"\n";var r=a.get_sorted_keys(this.headers);for(s=0;s<r.length;s++)e=r[s],n=this.headers[e],t+=e.toLowerCase()+":"+n.trim()+"\n";for(t+="\n",s=0;s<r.length;s++)t+=r[s].toLowerCase()+";";return t=t.slice(0,-1)+"\n",t+="UNSIGNED-PAYLOAD"},get_string_to_sign:function(t,e){var n="";return n+="AWS4-HMAC-SHA256\n",n+=a.iso8601(e)+"\n",n+=[e.getUTCFullYear(),a.zfill(e.getUTCMonth()+1,2),a.zfill(e.getUTCDate(),2),"/"+this.settings.auth.region+"/s3/aws4_request\n"].join(""),n+=s.SHA256(t.replace(/&amp;/g,"&")).toString()},sign_request:function(t){if(!this.settings.auth.signature)throw"No signature provided.";return s.HmacSHA256(t,s.enc.Hex.parse(this.settings.auth.signature)).toString()}};var a={uriencode:function(t){var e=encodeURIComponent(t);return e=(e=(e=e.replace(/[^A-Za-z0-9_.~\-%]+/g,escape)).replace(/;/g,"%3B")).replace(/[*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})},get_sorted_keys:function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e.sort()},iso8601:function(t){return[t.getUTCFullYear(),a.zfill(t.getUTCMonth()+1,2),a.zfill(t.getUTCDate(),2),"T",a.zfill(t.getUTCHours(),2),a.zfill(t.getUTCMinutes(),2),a.zfill(t.getUTCSeconds(),2),"Z"].join("")},zfill:function(t,e){return("00000000000"+t).substr(-e)}}}(this);
//# sourceMappingURL=mule2.min.js.map
