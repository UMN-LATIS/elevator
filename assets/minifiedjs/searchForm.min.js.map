{"version":3,"sources":["searchForm.js"],"names":["targetTemplate","listTemplate","resetSearchFrame","$","empty","galleryFrame","destroy","attr","document","on","removeClass","specificSearch","this","closest","newSpecificSearch","clone","find","val","after","collectionCopy","newCollection","selectedOption","content","templateId","data","targetGroup","post","basePath","fieldTitle","template","textStatus","xhr","results","parseJSON","e","console","log","type","html","selectElement","each","values","index","append","value","text","performSearchForButtonPress","targetForm","searchId","window","location","hash","length","currentPageNumber","previousEventComplete","searchQuery","JSON","stringify","serializeForm","cachedResults","cachedDates","alert","success","matches","objectId","cookie","pathname","totalLoadedCount","disableHashChange","currentURL","href","replace","currentHash","oldSearchId","substr","lastIndexOf","history","pushState","dataAvailable","show","processSearchResults","setTimeout","hasClass","modal","ready","parseSearch"],"mappings":"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","file":"searchForm.min.js","sourcesContent":["var targetTemplate = \"#result-template\";\nvar listTemplate = \"#list-template\";\n\n\n\n\n$(document).on(\"click\", \".addAnotherSpecific\", function() {\n    $(\".searchCombine\").removeClass(\"hide\");\n    var specificSearch = $(this).closest('.specificSearch');\n    var newSpecificSearch = $(specificSearch).clone(false);\n    newSpecificSearch.find(\"input[type='text']\").val(\"\");\n    $(specificSearch).after(newSpecificSearch);\n\n});\n\n$(document).on(\"click\", \".addAnotherCollection\", function() {\n    var collectionCopy = $(this).closest('.form-group');\n    var newCollection = $(collectionCopy).clone(false);\n    newCollection.find(\"input[type='text']\").val(\"\");\n    $(collectionCopy).after(newCollection);\n});\n\n\n\n$(document).on(\"change\", \".searchDropdown\", function() {\n    var selectedOption = $(this).find(\":selected\");\n    var content = $(selectedOption).val();\n    var templateId = $(selectedOption).data('templateid');\n    var targetGroup = $(this).closest(\".form-group\").find(\".specificSearchTextContainer\");\n    $.post(basePath + 'search/getFieldInfo', {fieldTitle: content, template: templateId}, function(data, textStatus, xhr) {\n        var results;\n        try {\n            results = $.parseJSON(data);\n        }\n        catch(e) {\n            console.log(\"error occurred\");\n        }\n\n        if(results.type == \"text\") {\n            $(targetGroup).html(\"\");\n            $(targetGroup).html('<input type=\"text\" name=\"specificSearchText[]\"  autocomplete=\"off\" class=\"form-control advancedOption advancedSearchContent\" value=\"\">');\n        }\n        else {\n            $(targetGroup).html(\"\");\n            $(targetGroup).html('<select name=\"specificSearchText[]\"  autocomplete=\"off\" class=\"form-control advancedOption advancedSearchContent\">');\n            selectElement = $(targetGroup).find(\"select\");\n            $.each(results.values, function(index, val) {\n                if(typeof index == \"string\") {\n                    $(selectElement).append($('<option>', {value: index}).text(val));\n                }\n                else {\n                    $(selectElement).append($('<option>', {value: val}).text(val));\n                }\n                \n            });\n\n        }\n\n    });\n\n\n\n});\n\n\nfunction resetSearchFrame() {\n    $(\"#results\").empty();\n    $(\"#listResults\").empty();\n    $(\".frame ul\").empty();\n    $(\".suggest\").empty();\n    if(galleryFrame) {\n        galleryFrame.destroy();\n        galleryFrame = null;    \n    }\n    $(\".galleryIframe\").attr(\"src\",\"\");\n    \n}\n\nvar performSearchForButtonPress = function(targetForm) {\n\n    resetSearchFrame();\n    searchId = \"\";\n    if(window.location.hash.length > 0) {\n        // for now, let's try not persisting search results?\n    //    searchId = window.location.hash.substring(1);\n    }\n\n    currentPageNumber = 0;\n    previousEventComplete = false;\n    $.post( basePath + \"search/searchResults/\" + searchId, {searchQuery:JSON.stringify($( targetForm ).serializeForm())}, function( data ) {\n        try{\n            cachedResults = $.parseJSON(data);\n            cachedDates = null;\n        }\n        catch(e){\n            alert(e + \" \" + data);\n        }\n\n\n        if(cachedResults.success === true) {\n\n            if(cachedResults.matches.length == 1) {\n                // special case - one match, let's just load it\n                var objectId = cachedResults.matches[0].objectId;\n                $.cookie('lastSearch', searchId);\n                window.location.hash = \"\";\n                window.location.pathname = basePath + \"/asset/viewAsset/\" + objectId;\n            }\n            searchId = cachedResults.searchId;\n            \n            cachedResults.totalLoadedCount = cachedResults.matches.length;\n            \n            disableHashChange = true;\n            currentURL = window.location.href.replace(window.location.hash,\"\");\n            currentHash = window.location.hash.replace(\"#\", \"\");\n            var oldSearchId = currentURL.substr(currentURL.lastIndexOf('/') + 1);\n            window.history.pushState({}, \"Search Results\", window.location.href.replace(oldSearchId, searchId));\n\n\n            dataAvailable = true;\n            $(\"#loadAllResults\").show();\n            processSearchResults(cachedResults);\n            setTimeout(function() {\n                disableHashChange = false;\n            }, 500);\n\n\n            if($('#advancedSearchModal').hasClass('in')) {\n                $('#advancedSearchModal').modal('hide');\n            }\n\n        }\n    });\n    return false;\n}\n\n\n$(document).ready(function() {\n\n    parseSearch();\n\n    $(document).on(\"submit\", \".searchForm\", function() {\n        if($(this).attr(\"id\") == \"advancedSearchForm\") {\n            // do nothing\n        }\n        else {\n            // when they hit the global search button, it should be a global search.  We might have ended up with a stored collection though, expunge that.\n            // $(this).find(\"#collection\").val('0');\n            $(this).find(\"#specificSearchField\").val('');\n            $(this).find(\"#specificSearchText\").val('');\n            $(\".collectionHeader\").html('');\n        }\n\n        performSearchForButtonPress(this);\n        return false;\n    });\n});"]}