var MarkerSource,MarkerTemplate,TimelineTemplate,currentPageNumber,eventSource,cachedResults="",cachedDates=null,searchId=null,resultsAvailable=!0,previousEventComplete=!0,dataAvailable=!0,disableHashChange=!1,totalResults=0;function getCurrentSearchId(){return currentURL=window.location.href.replace(window.location.hash,""),currentHash=window.location.hash.replace("#",""),36==currentHash.length?(searchId=currentHash,window.history.pushState({},"Search Results",currentURL+"/s/"+searchId)):searchId=currentURL.substr(currentURL.lastIndexOf("/")+1),searchId}function parseSearch(){if((searchId=getCurrentSearchId())&&!disableHashChange){$("#results").empty(),$("#listResults").empty();var e=!1;"undefined"!=typeof loadAll&&1==loadAll&&(e=!0),doSearch(searchId,0,e)}}function loadCollectionHeader(){1==$("input[name='collection[]']").length&&"0"!==$("input[name='collection[]']").val()&&""==$("#searchText").val()&&$.get(basePath+"collections/collectionHeader/"+$("input[name='collection[]']").val(),function(e){$(".collectonHeader").html(e)})}function doSearch(e,t,a,r){r||(previousEventComplete=!1,currentPageNumber=t),a=a?"true":"false",$.get(basePath+"search/searchResults/"+e+"/"+t+"/"+a,function(t){if(!r){var a=[],n=[];try{cachedResults&&(a=cachedResults.matches,n=cachedResults.searchResults),cachedResults=$.parseJSON(t)}catch(e){alert(e+" "+t)}if(!0===cachedResults.success){if(1==cachedResults.totalResults){var s=cachedResults.matches[0].objectId;$.cookie("lastSearch",e,{path:"/"}),window.location.pathname=basePath+"/asset/viewAsset/"+s}cachedResults.totalLoadedCount=cachedResults.matches.length+a.length,processSearchResults(cachedResults),newArray=$.merge(cachedResults.matches,a),cachedResults.searchResults=$.merge(cachedResults.searchResults,n),cachedResults.matches=newArray,$('a[href="#map"]').parent().hasClass("active")&&prepMap(),$('a[href="#timeline"]').parent().hasClass("active")&&(cachedDates=null,prepTimeline())}}})}function processSearchResults(e){populateSearchFields(e.searchEntry),loadCollectionHeader(),populateSearchResults(e),0===e.matches.length&&(dataAvailable=!1),previousEventComplete=!0}function getSuggestions(e){var t=e;$.post(basePath+"search/getSuggestion",{searchTerm:e},function(e,a){var r=$.parseJSON(e);if(0!==r.length){$.each(r,function(e,a){var r=new RegExp(e,"ig");t=t.replace(r,a)});var n=$("<a>").addClass("useSuggest").append(t),s=$("<i>").append(n),l=$("<div>").addClass("col-sm-12 suggestionText").append("Did you mean: ").append(s).append(" ?");$(".suggest").empty(),$(".suggest").append(l)}})}function populateSearchFields(e){$(".collectionSelector").prop("checked",!1),$("#showHidden").prop("checked",!1),$(".advancedOption").val(),e.searchText.length>0&&getSuggestions(e.searchText),$(".sortBy").val(e.sort),$.each(e,function(e,t){if(Array.isArray(t)){var a=$("#"+e);$.each(t,function(t,r){var n=a.clone();$(n).val(r),$(n).appendTo($("#"+e).parent())}),$(a).remove()}else $("#"+e).val(t)}),$("#collection").val()>0&&(targetText=$('[data-collection-id="'+$("#collection").val()+'"]').text(),$("#search_concept").text(targetText))}function populateSearchResults(e){var t=$(targetTemplate).html(),a=Handlebars.compile(t),r=$(listTemplate).html(),n=Handlebars.compile(r);$.each(e.matches,function(t,r){r.base_url=basePath,r.searchObject=e;var s=a(r),l=n(r);$("#results").append(s),$("#listResults").append(l)}),totalResults=e.totalResults,$(".resultsData").html("<p>Total Results: "+e.totalResults+"</p>"),dataAvailable&&e.matches.length<e.totalResults&&e.totalResults<1e3&&$(".resultsData p").append(" <a href='' id='loadAllResults'>[Load All]</a>"),e.totalResults>e.totalLoadedCount?($(".paginationBlock").show(),resultsAvailable=!0):($(".paginationBlock").hide(),resultsAvailable=!1),0==e.matches.length&&($(".paginationBlock").hide(),resultsAvailable=!1),$('a[href="#map"]').parent().hasClass("active")&&prepMap(),$('a[href="#timeline"]').parent().hasClass("active")&&prepTimeline(),null!==searchId&&doSearch(searchId,currentPageNumber+1,!1,!0)}$(document).ready(function(){function e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}$(window).scroll(function(){resultsAvailable&&$(document).height()-50<=$(window).scrollTop()+$(window).height()&&("Grid"==$(".nav-tabs .active").text()||"List"==$(".nav-tabs .active").text())&&previousEventComplete&&dataAvailable&&doSearch(searchId,currentPageNumber+1)}),$(".searchText").on("blur",function(){$(".advancedSearchText").val($(".searchText").val())}),$(".advancedSearchText").on("blur",function(){$(".searchText").val($(".advancedSearchText").val())}),$('a[href="#timeline"]').on("shown.bs.tab",function(){cachedDates=null,prepTimeline()}),$('a[href="#map"]').on("shown.bs.tab",function(){prepMap()}),$('a[href="#gallery"]').on("shown.bs.tab",function(){}),$('a[href="#grid"]').on("shown.bs.tab",function(){$("#results").find("img").trigger("show")}),$('a[href="#list"]').on("shown.bs.tab",function(){$("#listResults").find("img").trigger("show")}),$(".previousPage").on("click",function(){return doSearch(searchId,currentPageNumber-1),!1}),$(".nextPage").on("click",function(){return doSearch(searchId,currentPageNumber+1),!1}),MarkerSource=$("#marker-template").html(),MarkerTemplate=Handlebars.compile(MarkerSource),TimelineSource=$("#timeline-template").html(),TimelineTemplate=Handlebars.compile(TimelineSource),""!==location.hash&&$('a[href="'+location.hash+'"]').tab("show"),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){history.pushState?history.pushState(null,null,"#"+$(e.target).attr("href").substr(1)):location.hash="#"+$(e.target).attr("href").substr(1)}),$(".embedMap").on("click",function(t){t.preventDefault(),embedPath=window.location.protocol+"//"+window.location.hostname+basePath+"search/map/"+getCurrentSearchId(),iFrameContent='<iframe width="640" height="480" src="'+embedPath+'" frameborder="0" allowfullscreen></iframe>',embedContent='<input size=50 class="embedControl" value="'+e(iFrameContent)+'"">',bootbox.dialog({title:"Embed this map",message:"Use the HTML below to embed this map in another page: <br>"+embedContent,buttons:{success:{label:"OK",className:"btn-primary"}}})}),$(".embedTimeline").on("click",function(t){t.preventDefault(),embedPath=window.location.protocol+"//"+window.location.hostname+basePath+"search/timeline/"+getCurrentSearchId(),iFrameContent='<iframe width="640" height="480" src="'+embedPath+'" frameborder="0" allowfullscreen></iframe>',embedContent='<input size=50 class="embedControl" value="'+e(iFrameContent)+'"">',bootbox.dialog({title:"Embed this timeline",message:"Use the HTML below to embed this timeline in another page: <br>"+embedContent,buttons:{success:{label:"OK",className:"btn-primary"}}})})}),$(document).on("click",".assetLink",function(e){$.cookie("lastSearch",searchId,{path:"/"})}),$(document).on("click",".useSuggest",function(){$(".searchText").val($(this).text()),$(".searchForm").submit()}),$(document).on("change",".sortBy",function(){$(".hiddenSort").val($(this).val()),performSearchForButtonPress($(".searchForm").first())}),$(document).on("click","#loadAllResults",function(e){e.preventDefault(),dataAvailable&&(doSearch(searchId,currentPageNumber+1,!0),dataAvailable=!1,$("#loadAllResults").hide(),$(".paginationBlock").hide(),resultsAvailable=!1)});var spiderConfig={keepSpiderfied:!0,event:"mouseover"};function prepMap(){if(""!==cachedResults){$("#mapPane").removeData(),$("#mapPane").goMap({mapTypeControl:!0,maptype:"ROADMAP",mapTypeControlOptions:{position:"TOP_RIGHT",style:"DROPDOWN_MENU"},addMarker:"single"});var e=new OverlappingMarkerSpiderfier($.goMap.map,spiderConfig);$.goMap.getMarkerCount()>0&&$.goMap.clearMarkers(),$.each(cachedResults.matches,function(t,r){r.locations&&$.each(r.locations,function(t,n){$.each(n.entries,function(t,n){loc=n.loc.coordinates,r.base_url=basePath;var s=MarkerTemplate(r),l=$.goMap.getMarkers("markers");if(0===loc[1]&&0===loc[0])return!0;if(latlng=new google.maps.LatLng(loc[1],loc[0]),finalLatLng=latlng,0!=l.length)for(a=0;a<l.length;a++)l[a].getPosition();else finalLatLng=latlng;var o=$.goMap.createMarker({longitude:finalLatLng.lng(),latitude:finalLatLng.lat(),html:s});e.addMarker(o)})})});var t=[];for(var a in $.goMap.markers){var r=$($.goMap.mapId).data($.goMap.markers[a]);t.push(r)}new google.maps.InfoWindow;e.addListener("click",function(e,t){}),e.addListener("spiderfy",function(e){}),new MarkerClusterer($.goMap.map,t).setMaxZoom(15),$.goMap.fitBounds()}}function prepTimeline(){if(""!==cachedResults){var e={},a=!1;for(var r of(e.events=new Array,cachedResults.matches))if(r.hasOwnProperty("dates")){for(var n of r.dates)for(var s of n.dateAsset)startTime=parseInt(s.start.numeric,10),startTime<-6373557595440&&(a=!0);for(var n of r.dates)for(var s of n.dateAsset){var l={};startTime=parseInt(s.start.numeric,10),l.start_date={},a?(startYear=-1*Math.round(Math.abs((startTime+62167093e3)/31556900)),l.start_date.year=startYear):(t=new Date(1970,0,1),t.setSeconds(startTime),formattedStart=Date.utc.create(t),l.start_date.display_date=s.start.text,l.start_date.year=formattedStart.getFullYear(),l.start_date.month=formattedStart.getMonth()+1,l.start_date.day=formattedStart.getDay()+1),s.end.numeric&&s.end.numeric.toString().length>0&&(l.end_date={},endTime=parseInt(s.end.numeric,10),a?(endYear=-1*Math.round(Math.abs((endTime+62167093e3)/31556900)),l.end_date.year=endYear):(t=new Date(1970,0,1),t.setSeconds(endTime),formattedEnd=Date.utc.create(t),l.end_date.display_date=s.end.text,l.end_date.year=formattedEnd.getFullYear(),l.end_date.month=formattedEnd.getMonth()+1,l.end_date.day=formattedEnd.getDay()+1));var o=TimelineTemplate(r);l.text={},newElement=$("<a/>",{href:basePath+"asset/viewAsset/"+r.objectId,text:r.title}),l.text.headline=newElement.prop("outerHTML"),l.text.text=o,r.hasOwnProperty("primaryHandlerThumbnail2x")&&(l.media={},l.media.thumb=r.primaryHandlerThumbnail2x,l.media.url=r.primaryHandlerThumbnail2x);var c=!1;for(var i of e.events)JSON.stringify(i)==JSON.stringify(l)&&(c=!0);c||e.events.push(l)}}a?(e.scale="cosmological",injectStyles(".tl-timeaxis-minor { display: none; }")):$("#hackyGeoStyle").remove();new TL.Timeline("timelinePane",e,{timenav_position:"bottom",timenav_height_percentage:"70"})}}function injectStyles(e){$("<div />",{id:"hackyGeoStyle",html:"&shy;<style>"+e+"</style>"}).appendTo("body")}$(document).on("click",".embedControl",function(){$(this).select()});
var targetTemplate="#result-template",listTemplate="#list-template";$(document).on("click",".addAnotherSpecific",function(){var e=$(this).closest(".specificSearch"),t=$(e).clone(!1);t.find("input[type='text']").val(""),$(e).after(t)}),$(document).on("click",".addAnotherCollection",function(){var e=$(this).closest(".form-group"),t=$(e).clone(!1);t.find("input[type='text']").val(""),$(e).after(t)}),$(document).on("change",".searchDropdown",function(){var e=$(this).find(":selected"),t=$(e).val(),a=$(e).data("templateid"),c=$(this).closest(".form-group").find(".specificSearchTextContainer");$.post(basePath+"search/getFieldInfo",{fieldTitle:t,template:a},function(e,t,a){var s;try{s=$.parseJSON(e)}catch(e){console.log("error occurred")}"text"==s.type?($(c).html(""),$(c).html('<input type="text" name="specificSearchText[]"  autocomplete="off" class="form-control advancedOption advancedSearchContent" value="">')):($(c).html(""),$(c).html('<select name="specificSearchText[]"  autocomplete="off" class="form-control advancedOption advancedSearchContent">'),selectElement=$(c).find("select"),$.each(s.values,function(e,t){$(selectElement).append($("<option>",{value:t}).text(t))}))})});var performSearchForButtonPress=function(e){return $("#results").empty(),$("#listResults").empty(),$(".suggest").empty(),searchId="",window.location.hash.length,currentPageNumber=0,previousEventComplete=!1,$.post(basePath+"search/searchResults/"+searchId,{searchQuery:JSON.stringify($(e).serializeForm())},function(e){try{cachedResults=$.parseJSON(e),cachedDates=null}catch(t){alert(t+" "+e)}if(!0===cachedResults.success){if(1==cachedResults.matches.length){var t=cachedResults.matches[0].objectId;$.cookie("lastSearch",searchId),window.location.hash="",window.location.pathname=basePath+"/asset/viewAsset/"+t}searchId=cachedResults.searchId,cachedResults.totalLoadedCount=cachedResults.matches.length,disableHashChange=!0,currentURL=window.location.href.replace(window.location.hash,""),currentHash=window.location.hash.replace("#","");var a=currentURL.substr(currentURL.lastIndexOf("/")+1);window.history.pushState({},"Search Results",window.location.href.replace(a,searchId)),dataAvailable=!0,$("#loadAllResults").show(),processSearchResults(cachedResults),setTimeout(function(){disableHashChange=!1},500),$("#advancedSearchModal").hasClass("in")&&$("#advancedSearchModal").modal("hide")}}),!1};$(document).ready(function(){parseSearch(),$(document).on("submit",".searchForm",function(){return"advancedSearchForm"==$(this).attr("id")||($(this).find("#specificSearchField").val(""),$(this).find("#specificSearchText").val(""),$(".collectonHeader").html("")),performSearchForButtonPress(this),!1})});
//# sourceMappingURL=searchMaster.min.js.map
