function getCurrentSearchId(){return currentURL=window.location.href.replace(window.location.hash,""),currentHash=window.location.hash.replace("#",""),36==currentHash.length?(searchId=currentHash,window.history.pushState({},"Search Results",currentURL+"/s/"+searchId)):searchId=currentURL.substr(currentURL.lastIndexOf("/")+1),searchId}function parseSearch(){if(searchId=getCurrentSearchId(),searchId&&!disableHashChange){$("#results").empty(),$("#listResults").empty();var e=!1;"undefined"!=typeof loadAll&&1==loadAll&&(e=!0),doSearch(searchId,0,e)}}function loadCollectionHeader(){1==$("input[name='collection[]']").length&&"0"!==$("input[name='collection[]']").val()&&$.get(basePath+"collections/collectionHeader/"+$("input[name='collection[]']").val(),function(e){$(".collectonHeader").html(e)})}function doSearch(e,t,a,n){n||(previousEventComplete=!1,currentPageNumber=t),a=a?"true":"false",$.get(basePath+"search/searchResults/"+e+"/"+t+"/"+a,function(t){if(!n){var a=[],i=[];try{cachedResults&&(a=cachedResults.matches,i=cachedResults.searchResults),cachedResults=$.parseJSON(t)}catch(l){alert(l+" "+t)}if(cachedResults.success===!0){if(1==cachedResults.totalResults){var r=cachedResults.matches[0].objectId;$.cookie("lastSearch",e,{path:"/"}),window.location.pathname=basePath+"/asset/viewAsset/"+r}cachedResults.totalLoadedCount=cachedResults.matches.length+a.length,processSearchResults(cachedResults),newArray=$.merge(cachedResults.matches,a),cachedResults.searchResults=$.merge(cachedResults.searchResults,i),cachedResults.matches=newArray,$('a[href="#map"]').parent().hasClass("active")&&prepMap(),$('a[href="#timeline"]').parent().hasClass("active")&&(cachedDates=null,prepTimeline())}}})}function processSearchResults(e){populateSearchFields(e.searchEntry),loadCollectionHeader(),populateSearchResults(e),0===e.matches.length&&(dataAvailable=!1),previousEventComplete=!0}function getSuggestions(e){var t=e;$.post(basePath+"search/getSuggestion",{searchTerm:e},function(e,a){var n=$.parseJSON(e);if(0!==n.length){$.each(n,function(e,a){var n=new RegExp(e,"ig");t=t.replace(n,a)});var i=$("<a>").addClass("useSuggest").append(t),l=$("<i>").append(i),r=$("<div>").addClass("col-sm-12 suggestionText").append("Did you mean: ").append(l).append(" ?");$(".suggest").empty(),$(".suggest").append(r)}})}function populateSearchFields(e){$(".collectionSelector").prop("checked",!1),$("#showHidden").prop("checked",!1),$(".advancedOption").val(),e.searchText.length>0&&getSuggestions(e.searchText),$(".sortBy").val(e.sort),$.each(e,function(e,t){if(Array.isArray(t)){var a=$("#"+e);$.each(t,function(t,n){var i=a.clone();$(i).val(n),$(i).appendTo($("#"+e).parent())}),$(a).remove()}else $("#"+e).val(t)})}function populateSearchResults(e){var t=$(targetTemplate).html(),a=Handlebars.compile(t),n=$(listTemplate).html(),i=Handlebars.compile(n);$.each(e.matches,function(t,n){n.base_url=basePath,n.searchObject=e;var l=a(n),r=i(n);$("#results").append(l),$("#listResults").append(r)}),totalResults=e.totalResults,$(".resultsData").html("<p>Total Results: "+e.totalResults+"</p>"),dataAvailable&&e.matches.length<e.totalResults&&e.totalResults<1e3&&$(".resultsData p").append(" <a href='' id='loadAllResults'>[Load All]</a>"),e.totalResults>e.totalLoadedCount?($(".paginationBlock").show(),resultsAvailable=!0):($(".paginationBlock").hide(),resultsAvailable=!1),0==e.matches.length&&($(".paginationBlock").hide(),resultsAvailable=!1),$('a[href="#map"]').parent().hasClass("active")&&prepMap(),$('a[href="#timeline"]').parent().hasClass("active")&&prepTimeline(),null!==searchId&&doSearch(searchId,currentPageNumber+1,!1,!0)}function prepMap(){if(""!==cachedResults){$("#mapPane").removeData(),$("#mapPane").goMap({mapTypeControl:!0,maptype:"ROADMAP",mapTypeControlOptions:{position:"TOP_RIGHT",style:"DROPDOWN_MENU"},addMarker:"single"});var e=new OverlappingMarkerSpiderfier($.goMap.map,spiderConfig);$.goMap.getMarkerCount()>0&&$.goMap.clearMarkers(),$.each(cachedResults.matches,function(t,n){n.locations&&$.each(n.locations,function(t,i){$.each(i.entries,function(t,i){loc=i.loc.coordinates,n.base_url=basePath;var l=MarkerTemplate(n),r=$.goMap.getMarkers("markers");if(0===loc[1]&&0===loc[0])return!0;if(latlng=new google.maps.LatLng(loc[1],loc[0]),finalLatLng=latlng,0!=r.length)for(a=0;a<r.length;a++){var s=r[a];s.getPosition()}else finalLatLng=latlng;var o=$.goMap.createMarker({longitude:finalLatLng.lng(),latitude:finalLatLng.lat(),html:l});e.addMarker(o)})})});var t=[];for(var a in $.goMap.markers){var n=$($.goMap.mapId).data($.goMap.markers[a]);t.push(n)}new google.maps.InfoWindow;e.addListener("click",function(e,t){}),e.addListener("spiderfy",function(e){});var i=new MarkerClusterer($.goMap.map,t);i.setMaxZoom(15),$.goMap.fitBounds()}}function prepTimeline(){if(""!==cachedResults){var e=null,t=null;if(void 0===Timeline||void 0===Timeline.DateTime||void 0===Timeline.DefaultEventSource||void 0===Timeline.strings||void 0===Timeline.GregorianDateLabeller.monthNames)return void setTimeout(function(){prepTimeline()},1e3);$("#timelinePane").empty();var a=!1;null===cachedDates&&(cachedDates={events:[]},$.each(cachedResults.matches,function(e,t){t.dates&&$.each(t.dates,function(e,t){$.each(t.dateAsset,function(e,t){t.start&&(startTime=parseInt(t.start.numeric,10),startTime<-6373557595440&&(a=!0))})})}),$.each(cachedResults.matches,function(n,i){i.dates&&$.each(i.dates,function(n,l){$.each(l.dateAsset,function(n,l){if(l.start&&l.start.numeric.toString().length>0){var r=null,s=null,o=null,c=null,u=null;r=parseInt(l.start.numeric,10),a?o=Timeline.GeochronoUnit.wrapMA(Math.abs(r/315569e8)):(u=new Date(1970,0,1),u.setSeconds(r),o=Date.utc.create(u)),formattedValue={miscData:i,title:i.title,id:"/en/"+i.objectId,start:o,image:basePath+"asset/previewImage/"+i.objectId,link:basePath+"asset/viewAsset/"+i.objectId,description:"Caption goeshere"},l.end.numeric&&l.end.numeric.length>0&&(s=parseInt(l.end.numeric,10),a?c=Timeline.GeochronoUnit.wrapMA(Math.abs(s/315569e8)):(u=new Date(1970,0,1),u.setSeconds(s),c=Date.utc.create(u)),formattedValue.end=c,formattedValue.durationEvent=!0),(null===e||r<e)&&(e=r),(null===t||r>t)&&(t=r),s>t&&(t=s),cachedDates.events.push(formattedValue)}})})})),eventSource&&eventSource.clear();Timeline.DefaultEventSource.Event.prototype.fillInfoBubble;Timeline.DefaultEventSource.Event.prototype.fillInfoBubble=function(e,t,a){var n=this,i=document.createElement("div");i.innerHTML=MarkerTemplate(n._obj.miscData),e.appendChild(i)},eventSource=a?new Timeline.DefaultEventSource(new SimileAjax.EventIndex(Timeline.GeochronoUnit)):new Timeline.DefaultEventSource(0),eventSource.loadJSON(cachedDates,"localJson");var n=Timeline.ClassicTheme.create(),i=null,l=null;if(a)l=Math.abs((e+t)/2/315569e8),i=Timeline.GeochronoUnit.wrapMA(l);else{l=(e+t)/2;var r=new Date(1970,0,1);r.setSeconds(l),i=Date.create(r)}var s=t-e,o=null,c=null,u=200;s<3600?(o=Timeline.DateTime.MINUTE,c=Timeline.DateTime.HOUR):s<86400?(o=Timeline.DateTime.HOUR,c=Timeline.DateTime.DAY):s<2592e3?(o=Timeline.DateTime.DAY,c=Timeline.DateTime.MONTH):s<31104e3?(o=Timeline.DateTime.MONTH,c=Timeline.DateTime.YEAR):s<31104e4?(o=Timeline.DateTime.YEAR,c=Timeline.DateTime.DECADE):s<31104e5?(o=Timeline.DateTime.DECADE,c=Timeline.DateTime.CENTURY):s<31104e6?(o=Timeline.DateTime.CENTURY,c=Timeline.DateTime.MILLENNIUM):(o=Timeline.DateTime.MILLENNIUM,c=Timeline.DateTime.MILLENNIUM,u=80),a&&(o=Timeline.GeochronoUnit.MA,c=Timeline.GeochronoUnit.EPOCH),SimileAjax.History.enabled=!1;var h;a?(h=[Timeline.Geochrono.createBandInfo({eventSource:eventSource,timeZone:-1*((new Date).getTimezoneOffset()/60),date:i,width:"86%",intervalUnit:o,intervalPixels:100,trackGap:.2,trackHeight:1.3,theme:n,eventPainter:Timeline.CompactEventPainter,eventPainterParams:{iconLabelGap:5,labelRightMargin:20,iconWidth:80,iconHeight:80,stackConcurrentPreciseInstantEvents:{limit:5,moreMessageTemplate:"%0 More Events",icon:"no-image-80.png",iconWidth:80,iconHeight:80}}}),Timeline.Geochrono.createBandInfo({width:"10%",timeZone:-1*((new Date).getTimezoneOffset()/60),intervalUnit:c,intervalPixels:u,eventSource:eventSource,date:i,theme:n,overview:"overview"})],h[1].syncWith=0,h[1].highlight=!0):(h=[Timeline.createBandInfo({width:"90%",intervalUnit:o,timeZone:-1*((new Date).getTimezoneOffset()/60),intervalPixels:200,eventSource:eventSource,date:i,theme:n,eventPainter:Timeline.CompactEventPainter,eventPainterParams:{iconLabelGap:5,labelRightMargin:20,iconWidth:80,iconHeight:80,stackConcurrentPreciseInstantEvents:{limit:5,moreMessageTemplate:"%0 More Events",icon:"/assets/timeline_js/images/blue-circle.png",iconWidth:80,iconHeight:80}}}),Timeline.createBandInfo({width:"10%",timeZone:-1*((new Date).getTimezoneOffset()/60),intervalUnit:c,intervalPixels:u,eventSource:eventSource,date:i,theme:n,overview:"overview"})],h[1].syncWith=0,h[1].highlight=!0),a?tl=Timeline.create(document.getElementById("timelinePane"),h,Timeline.HORIZONTAL,Timeline.GeochronoUnit):tl=Timeline.create(document.getElementById("timelinePane"),h,Timeline.HORIZONTAL)}}var MarkerSource,MarkerTemplate,cachedResults="",cachedDates=null,searchId=null,currentPageNumber,eventSource,resultsAvailable=!0,previousEventComplete=!0,dataAvailable=!0,disableHashChange=!1,totalResults=0;$(document).ready(function(){function e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}$(window).scroll(function(){resultsAvailable&&$(document).height()-50<=$(window).scrollTop()+$(window).height()&&("Grid"==$(".nav-tabs .active").text()||"List"==$(".nav-tabs .active").text())&&previousEventComplete&&dataAvailable&&doSearch(searchId,currentPageNumber+1)}),$("#timelinePane").length>0&&setTimeout(function(){$.getScript("/assets/timeline_js/ext/geochrono/geochrono-api.js")},1e3),$(".searchText").on("blur",function(){$(".advancedSearchText").val($(".searchText").val())}),$(".advancedSearchText").on("blur",function(){$(".searchText").val($(".advancedSearchText").val())}),$('a[href="#timeline"]').on("shown.bs.tab",function(){cachedDates=null,prepTimeline()}),$('a[href="#map"]').on("shown.bs.tab",function(){prepMap()}),$('a[href="#gallery"]').on("shown.bs.tab",function(){}),$('a[href="#grid"]').on("shown.bs.tab",function(){$("#results").find("img").trigger("show")}),$('a[href="#list"]').on("shown.bs.tab",function(){$("#listResults").find("img").trigger("show")}),$(".previousPage").on("click",function(){return doSearch(searchId,currentPageNumber-1),!1}),$(".nextPage").on("click",function(){return doSearch(searchId,currentPageNumber+1),!1}),MarkerSource=$("#marker-template").html(),MarkerTemplate=Handlebars.compile(MarkerSource),""!==location.hash&&$('a[href="'+location.hash+'"]').tab("show"),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){history.pushState?history.pushState(null,null,"#"+$(e.target).attr("href").substr(1)):location.hash="#"+$(e.target).attr("href").substr(1)}),$(".embedMap").on("click",function(t){t.preventDefault(),embedPath=window.location.protocol+"//"+window.location.hostname+basePath+"search/map/"+getCurrentSearchId(),iFrameContent='<iframe width="640" height="480" src="'+embedPath+'" frameborder="0" allowfullscreen></iframe>',embedContent='<input size=50 class="embedControl" value="'+e(iFrameContent)+'"">',bootbox.dialog({title:"Embed this map",message:"Use the HTML below to embed this map in another page: <br>"+embedContent,buttons:{success:{label:"OK",className:"btn-primary"}}})})}),$(document).on("click",".assetLink",function(e){$.cookie("lastSearch",searchId,{path:"/"})}),$(document).on("click",".useSuggest",function(){$(".searchText").val($(this).text()),$(".searchForm").submit()}),$(document).on("change",".sortBy",function(){$(".hiddenSort").val($(this).val()),performSearchForButtonPress($(".searchForm").first())}),$(document).on("click","#loadAllResults",function(e){e.preventDefault(),dataAvailable&&(doSearch(searchId,currentPageNumber+1,!0),dataAvailable=!1,$("#loadAllResults").hide(),$(".paginationBlock").hide(),resultsAvailable=!1)});var spiderConfig={keepSpiderfied:!0,event:"mouseover"};$(document).on("click",".embedControl",function(){$(this).select()});
var targetTemplate="#result-template",listTemplate="#list-template";$(document).on("click",".addAnotherSpecific",function(){var e=$(this).closest(".specificSearch"),t=$(e).clone(!1);t.find("input[type='text']").val(""),$(e).after(t)}),$(document).on("click",".addAnotherCollection",function(){var e=$(this).closest(".form-group"),t=$(e).clone(!1);t.find("input[type='text']").val(""),$(e).after(t)}),$(document).on("change",".searchDropdown",function(){var e=$(this).find(":selected"),t=$(e).val(),a=$(e).data("templateid"),c=$(this).closest(".form-group").find(".specificSearchTextContainer");$.post(basePath+"search/getFieldInfo",{fieldTitle:t,template:a},function(e,t,a){var s;try{s=$.parseJSON(e)}catch(o){console.log("error occurred")}"text"==s.type?($(c).html(""),$(c).html('<input type="text" name="specificSearchText[]"  autocomplete="off" class="form-control advancedOption advancedSearchContent" value="">')):($(c).html(""),$(c).html('<select name="specificSearchText[]"  autocomplete="off" class="form-control advancedOption advancedSearchContent">'),selectElement=$(c).find("select"),$.each(s.values,function(e,t){$(selectElement).append($("<option>",{value:t}).text(t))}))})});var performSearchForButtonPress=function(e){return $("#results").empty(),$("#listResults").empty(),$(".suggest").empty(),searchId="",window.location.hash.length>0,currentPageNumber=0,previousEventComplete=!1,$.post(basePath+"search/searchResults/"+searchId,{searchQuery:JSON.stringify($(e).serializeForm())},function(e){try{cachedResults=$.parseJSON(e),cachedDates=null}catch(t){alert(t+" "+e)}if(cachedResults.success===!0){if(1==cachedResults.matches.length){var a=cachedResults.matches[0].objectId;$.cookie("lastSearch",searchId),window.location.hash="",window.location.pathname=basePath+"/asset/viewAsset/"+a}searchId=cachedResults.searchId,disableHashChange=!0,currentURL=window.location.href.replace(window.location.hash,""),currentHash=window.location.hash.replace("#","");var c=currentURL.substr(currentURL.lastIndexOf("/")+1);window.history.pushState({},"Search Results",window.location.href.replace(c,searchId)),dataAvailable=!0,$("#loadAllResults").show(),processSearchResults(cachedResults),setTimeout(function(){disableHashChange=!1},500),$("#advancedSearchModal").hasClass("in")&&$("#advancedSearchModal").modal("hide")}}),!1};$(document).ready(function(){parseSearch(),$(document).on("submit",".searchForm",function(){return"advancedSearchForm"==$(this).attr("id")||($(this).find("#collection").val("0"),$(this).find("#specificSearchField").val(""),$(this).find("#specificSearchText").val(""),$(".collectonHeader").html("")),performSearchForButtonPress(this),!1})});
//# sourceMappingURL=searchMaster.min.js.map
