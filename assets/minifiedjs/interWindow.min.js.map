{"version":3,"file":"interWindow.min.js","sources":["interWindow.js"],"sourcesContent":["\nvar targetFieldId = \"\";\nvar hasParent = false;\nvar unsavedChildren = 0;\n\n$(document).on(\"click\", \".newAssetButton\", function(event) {\n\tevent.preventDefault();\n\tvar targetTemplate = $(this).closest(\".widgetContents\").find(\".templateSelector\").first().val();\n\tvar targetCollection = $(\"#collectionId\").val();\n\tvar targetField = $(this).closest(\".widgetContents\").find(\".targetAsset\").first().attr('id');\n\t$(this).attr(\"disabled\", true);\n\tunsavedChildren++;\n\tvar windowPointer = window.open(basePath +\"assetManager/addAsset/\"+targetTemplate + \"/\" + targetCollection);\n\twindowPointer.onload = function( ){\n\t\tvar targetInfo = { 'status':'open', 'targetField': targetField };\n\t\twindowPointer.postMessage(JSON.stringify(targetInfo), \"*\");\n\t};\n\n});\n\n$(document).on(\"click\", \".autocompleteEdit\", function(event) {\n\tvar targetItem = $(this).closest(\".widgetContents\").find(\".targetAsset\").val();\n\tvar targetField = $(this).closest(\".widgetContents\").find(\".targetAsset\").first().attr('id');\n\tvar windowPointer = window.open(basePath+ \"assetManager/editAsset/\"+targetItem);\n\twindowPointer.onload = function( ){\n\t\tvar targetInfo = { 'status':'open', 'targetField': targetField };\n\t\twindowPointer.postMessage(JSON.stringify(targetInfo), \"*\");\n\t};\n\n\treturn false;\n});\n\n\nfunction notifyParentOfSave(objectId) {\n\n\tvar statusNotice = { 'objectId': objectId, 'status':'saved', 'targetFieldId': targetFieldId};\n\tvar targetElement;\n\n\tif(window.opener !== null) {\n\t\ttargetElement = window.opener;\n\t}\n\telse {\n\t\t// we're in an iframe!\n\t\ttargetElement = parent;\n\t}\n\tif(targetElement == window) {\n\t\t// our parent is gone!\n\t}\n\telse {\n\t\ttargetElement.postMessage(JSON.stringify(statusNotice), \"*\");\n\t}\n\n}\n\n$( window ).unload(function() {\n\tif(hasParent) {\n\t\tvar statusNotice = { 'objectId': null, 'status':'closed', 'targetFieldId': targetFieldId};\n\t\twindow.opener.postMessage(JSON.stringify(statusNotice), \"*\");\n\t}\n\n});\n\n\nfunction listener(event) {\n\tif(!(typeof event.data === 'string' || event.data instanceof String)) {\n\t\treturn;\n\t}\n\tvar messageObject = JSON.parse(event.data);\n\tif(event.data ) {\n\t\tif(messageObject.status == 'open') {\n\t\t\thasParent = true;\n\t\t\ttargetFieldId = messageObject.targetField;\n\t\t}\n\t\t// TODO, update the UI with this info\n\t\tif(messageObject.status == 'saved') {\n\t\t\t// First Save, don't need to count this one anymore\n\t\t\tif($(\"#\"+messageObject.targetFieldId).val() != messageObject.objectId) {\n\t\t\t\tunsavedChildren--;\n\t\t\t}\n\n\t\t\t$(\"#\"+messageObject.targetFieldId).val(messageObject.objectId);\n\t\t\trelatedAssetPreview(messageObject.objectId, $(\"#\"+messageObject.targetFieldId), $(\".widgetContents\"));\n\t\t\tsubmitFormWithDelay(true,true);\n\t\t}\n\t\tif(messageObject.status == 'closed') {\n\t\t\tif($(\"#\"+messageObject.targetFieldId).val() === \"\") {\n\t\t\t\tunsavedChildren--;\n\t\t\t\t$(\"#\"+messageObject.targetFieldId).closest(\".widgetContents\").find(\".newAssetButton\").removeAttr(\"disabled\");\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nif (window.addEventListener){\n\n\taddEventListener(\"message\", listener, false);\n\tconsole.log(\"listener added\");\n\n} else {\n  attachEvent(\"onmessage\", listener);\n}\n"],"names":["targetFieldId","hasParent","unsavedChildren","notifyParentOfSave","objectId","statusNotice","status","targetElement","window","opener","parent","postMessage","JSON","stringify","listener","event","messageObject","data","String","parse","targetField","$","val","relatedAssetPreview","submitFormWithDelay","closest","find","removeAttr","document","on","preventDefault","targetTemplate","this","first","targetCollection","attr","windowPointer","open","basePath","onload","targetItem","unload","addEventListener","console","log","attachEvent"],"mappings":"AACA,IAAIA,cAAgB,GAChBC,UAAY,CAAA,EACZC,gBAAkB,EA8BtB,SAASC,mBAAmBC,GAE3B,IAAIC,EAAe,CAAED,SAAYA,EAAUE,OAAS,QAASN,cAAiBA,aAAa,EAI1FO,EADoB,OAAlBC,OAAOC,OACOD,OAAOC,OAIPC,OAEdH,GAAiBC,QAInBD,EAAcI,YAAYC,KAAKC,UAAUR,CAAY,EAAG,GAAG,CAG7D,CAWA,SAASS,SAASC,GACjB,IAGIC,GAHuB,UAAtB,OAAOD,EAAME,MAAqBF,EAAME,gBAAgBC,UAGzDF,EAAgBJ,KAAKO,MAAMJ,EAAME,IAAI,EACtCF,EAAME,QACmB,QAAxBD,EAAcV,SAChBL,UAAY,CAAA,EACZD,cAAgBgB,EAAcI,aAGJ,SAAxBJ,EAAcV,SAEbe,EAAE,IAAIL,EAAchB,aAAa,EAAEsB,IAAI,GAAKN,EAAcZ,UAC5DF,eAAe,GAGhBmB,EAAE,IAAIL,EAAchB,aAAa,EAAEsB,IAAIN,EAAcZ,QAAQ,EAC7DmB,oBAAoBP,EAAcZ,SAAUiB,EAAE,IAAIL,EAAchB,aAAa,EAAGqB,EAAE,iBAAiB,CAAC,EACpGG,oBAAoB,CAAA,EAAK,CAAA,CAAI,GAEH,UAAxBR,EAAcV,SACgC,KAA7Ce,EAAE,IAAIL,EAAchB,aAAa,EAAEsB,IAAI,IACzCpB,eAAe,GACfmB,EAAE,IAAIL,EAAchB,aAAa,EAAEyB,QAAQ,iBAAiB,EAAEC,KAAK,iBAAiB,EAAEC,WAAW,UAAU,EAO/G,CAzFAN,EAAEO,QAAQ,EAAEC,GAAG,QAAS,kBAAmB,SAASd,GACnDA,EAAMe,eAAe,EACrB,IAAIC,EAAiBV,EAAEW,IAAI,EAAEP,QAAQ,iBAAiB,EAAEC,KAAK,mBAAmB,EAAEO,MAAM,EAAEX,IAAI,EAC1FY,EAAmBb,EAAE,eAAe,EAAEC,IAAI,EAC1CF,EAAcC,EAAEW,IAAI,EAAEP,QAAQ,iBAAiB,EAAEC,KAAK,cAAc,EAAEO,MAAM,EAAEE,KAAK,IAAI,EAGvFC,GAFJf,EAAEW,IAAI,EAAEG,KAAK,WAAY,CAAA,CAAI,EAC7BjC,eAAe,GACKM,OAAO6B,KAAKC,SAAU,yBAAyBP,EAAiB,IAAMG,CAAgB,GAC1GE,EAAcG,OAAS,WAEtBH,EAAczB,YAAYC,KAAKC,UADd,CAAEP,OAAS,OAAQc,YAAeA,CAAY,CACZ,EAAG,GAAG,CAC1D,CAED,CAAC,EAEDC,EAAEO,QAAQ,EAAEC,GAAG,QAAS,oBAAqB,SAASd,GACrD,IAAIyB,EAAanB,EAAEW,IAAI,EAAEP,QAAQ,iBAAiB,EAAEC,KAAK,cAAc,EAAEJ,IAAI,EACzEF,EAAcC,EAAEW,IAAI,EAAEP,QAAQ,iBAAiB,EAAEC,KAAK,cAAc,EAAEO,MAAM,EAAEE,KAAK,IAAI,EACvFC,EAAgB5B,OAAO6B,KAAKC,SAAU,0BAA0BE,CAAU,EAM9E,MAAO,EALPJ,EAAcG,OAAS,WAEtBH,EAAczB,YAAYC,KAAKC,UADd,CAAEP,OAAS,OAAQc,YAAeA,CAAY,CACZ,EAAG,GAAG,CAC1D,EAGD,CAAC,EAwBDC,EAAGb,MAAO,EAAEiC,OAAO,WAClB,IACKpC,EADFJ,YACEI,EAAe,CAAED,SAAY,KAAME,OAAS,SAAUN,cAAiBA,aAAa,EACxFQ,OAAOC,OAAOE,YAAYC,KAAKC,UAAUR,CAAY,EAAG,GAAG,EAG7D,CAAC,EAoCGG,OAAOkC,kBAEVA,iBAAiB,UAAW5B,SAAU,CAAA,CAAK,EAC3C6B,QAAQC,IAAI,gBAAgB,GAG3BC,YAAY,YAAa/B,QAAQ"}