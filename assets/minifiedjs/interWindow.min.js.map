{"version":3,"sources":["interWindow.js"],"names":["notifyParentOfSave","objectId","targetElement","statusNotice","status","targetFieldId","window","opener","parent","postMessage","JSON","stringify","listener","event","data","String","messageObject","parse","hasParent","targetField","$","val","unsavedChildren","relatedAssetPreview","closest","submitFormWithDelay","find","removeAttr","document","on","preventDefault","targetTemplate","this","first","targetCollection","attr","windowPointer","open","basePath","onload","targetInfo","targetItem","unload","addEventListener","console","log","attachEvent"],"mappings":"AAiCA,QAASA,oBAAmBC,GAE3B,GACIC,GADAC,GAAiBF,SAAYA,EAAUG,OAAS,QAASC,cAAiBA,cAI7EH,GADoB,OAAlBI,OAAOC,OACOD,OAAOC,OAIPC,OAEdN,GAAiBI,QAInBJ,EAAcO,YAAYC,KAAKC,UAAUR,GAAe,KAc1D,QAASS,UAASC,GACjB,GAA2B,gBAAfA,GAAMC,MAAqBD,EAAMC,eAAgBC,QAA7D,CAGA,GAAIC,GAAgBN,KAAKO,MAAMJ,EAAMC,KAClCD,GAAMC,OACmB,QAAxBE,EAAcZ,SAChBc,WAAY,EACZb,cAAgBW,EAAcG,aAGJ,SAAxBH,EAAcZ,SAEbgB,EAAE,IAAIJ,EAAcX,eAAegB,OAASL,EAAcf,UAC5DqB,kBAGDF,EAAE,IAAIJ,EAAcX,eAAegB,IAAIL,EAAcf,UACrDsB,oBAAoBP,EAAcf,SAAUmB,EAAE,IAAIJ,EAAcX,eAAemB,QAAQ,oBACvFC,qBAAoB,GAAK,IAEC,UAAxBT,EAAcZ,QACgC,KAA7CgB,EAAE,IAAIJ,EAAcX,eAAegB,QACrCC,kBACAF,EAAE,IAAIJ,EAAcX,eAAemB,QAAQ,mBAAmBE,KAAK,mBAAmBC,WAAW,eAtFrG,GAAItB,eAAgB,GAChBa,WAAY,EACZI,gBAAkB,CAEtBF,GAAEQ,UAAUC,GAAG,QAAS,kBAAmB,SAAShB,GACnDA,EAAMiB,gBACN,IAAIC,GAAiBX,EAAEY,MAAMR,QAAQ,mBAAmBE,KAAK,qBAAqBO,QAAQZ,MACtFa,EAAmBd,EAAE,iBAAiBC,MACtCF,EAAcC,EAAEY,MAAMR,QAAQ,mBAAmBE,KAAK,gBAAgBO,QAAQE,KAAK,KACvFf,GAAEY,MAAMG,KAAK,YAAY,GACzBb,iBACA,IAAIc,GAAgB9B,OAAO+B,KAAKC,SAAU,yBAAyBP,EAAiB,IAAMG,EAC1FE,GAAcG,OAAS,WACtB,GAAIC,IAAepC,OAAS,OAAQe,YAAeA,EACnDiB,GAAc3B,YAAYC,KAAKC,UAAU6B,GAAa,QAKxDpB,EAAEQ,UAAUC,GAAG,QAAS,oBAAqB,SAAShB,GACrD,GAAI4B,GAAarB,EAAEY,MAAMR,QAAQ,mBAAmBE,KAAK,gBAAgBL,MACrEF,EAAcC,EAAEY,MAAMR,QAAQ,mBAAmBE,KAAK,gBAAgBO,QAAQE,KAAK,MACnFC,EAAgB9B,OAAO+B,KAAKC,SAAU,0BAA0BG,EAMpE,OALAL,GAAcG,OAAS,WACtB,GAAIC,IAAepC,OAAS,OAAQe,YAAeA,EACnDiB,GAAc3B,YAAYC,KAAKC,UAAU6B,GAAa,OAGhD,IAyBRpB,EAAGd,QAASoC,OAAO,WAClB,GAAGxB,UAAW,CACb,GAAIf,IAAiBF,SAAY,KAAMG,OAAS,SAAUC,cAAiBA,cAC3EC,QAAOC,OAAOE,YAAYC,KAAKC,UAAUR,GAAe,QAuCtDG,OAAOqC,kBAEVA,iBAAiB,UAAW/B,UAAU,GACtCgC,QAAQC,IAAI,mBAGXC,YAAY,YAAalC","file":"interWindow.min.js","sourcesContent":["\nvar targetFieldId = \"\";\nvar hasParent = false;\nvar unsavedChildren = 0;\n\n$(document).on(\"click\", \".newAssetButton\", function(event) {\n\tevent.preventDefault();\n\tvar targetTemplate = $(this).closest(\".widgetContents\").find(\".templateSelector\").first().val();\n\tvar targetCollection = $(\"#collectionId\").val();\n\tvar targetField = $(this).closest(\".widgetContents\").find(\".targetAsset\").first().attr('id');\n\t$(this).attr(\"disabled\", true);\n\tunsavedChildren++;\n\tvar windowPointer = window.open(basePath +\"assetManager/addAsset/\"+targetTemplate + \"/\" + targetCollection);\n\twindowPointer.onload = function( ){\n\t\tvar targetInfo = { 'status':'open', 'targetField': targetField };\n\t\twindowPointer.postMessage(JSON.stringify(targetInfo), \"*\");\n\t};\n\n});\n\n$(document).on(\"click\", \".autocompleteEdit\", function(event) {\n\tvar targetItem = $(this).closest(\".widgetContents\").find(\".targetAsset\").val();\n\tvar targetField = $(this).closest(\".widgetContents\").find(\".targetAsset\").first().attr('id');\n\tvar windowPointer = window.open(basePath+ \"assetManager/editAsset/\"+targetItem);\n\twindowPointer.onload = function( ){\n\t\tvar targetInfo = { 'status':'open', 'targetField': targetField };\n\t\twindowPointer.postMessage(JSON.stringify(targetInfo), \"*\");\n\t};\n\n\treturn false;\n});\n\n\nfunction notifyParentOfSave(objectId) {\n\n\tvar statusNotice = { 'objectId': objectId, 'status':'saved', 'targetFieldId': targetFieldId};\n\tvar targetElement;\n\n\tif(window.opener !== null) {\n\t\ttargetElement = window.opener;\n\t}\n\telse {\n\t\t// we're in an iframe!\n\t\ttargetElement = parent;\n\t}\n\tif(targetElement == window) {\n\t\t// our parent is gone!\n\t}\n\telse {\n\t\ttargetElement.postMessage(JSON.stringify(statusNotice), \"*\");\n\t}\n\n}\n\n$( window ).unload(function() {\n\tif(hasParent) {\n\t\tvar statusNotice = { 'objectId': null, 'status':'closed', 'targetFieldId': targetFieldId};\n\t\twindow.opener.postMessage(JSON.stringify(statusNotice), \"*\");\n\t}\n\n});\n\n\nfunction listener(event) {\n\tif(!(typeof event.data === 'string' || event.data instanceof String)) {\n\t\treturn;\n\t}\n\tvar messageObject = JSON.parse(event.data);\n\tif(event.data ) {\n\t\tif(messageObject.status == 'open') {\n\t\t\thasParent = true;\n\t\t\ttargetFieldId = messageObject.targetField;\n\t\t}\n\t\t// TODO, update the UI with this info\n\t\tif(messageObject.status == 'saved') {\n\t\t\t// First Save, don't need to count this one anymore\n\t\t\tif($(\"#\"+messageObject.targetFieldId).val() != messageObject.objectId) {\n\t\t\t\tunsavedChildren--;\n\t\t\t}\n\n\t\t\t$(\"#\"+messageObject.targetFieldId).val(messageObject.objectId);\n\t\t\trelatedAssetPreview(messageObject.objectId, $(\"#\"+messageObject.targetFieldId).closest(\".widgetContents\"));\n\t\t\tsubmitFormWithDelay(true,true);\n\t\t}\n\t\tif(messageObject.status == 'closed') {\n\t\t\tif($(\"#\"+messageObject.targetFieldId).val() === \"\") {\n\t\t\t\tunsavedChildren--;\n\t\t\t\t$(\"#\"+messageObject.targetFieldId).closest(\".widgetContents\").find(\".newAssetButton\").removeAttr(\"disabled\");\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nif (window.addEventListener){\n\n\taddEventListener(\"message\", listener, false);\n\tconsole.log(\"listener added\");\n\n} else {\n  attachEvent(\"onmessage\", listener);\n}\n"],"sourceRoot":"/source/"}