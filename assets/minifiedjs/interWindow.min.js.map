{"version":3,"sources":["interWindow.js"],"names":["notifyParentOfSave","objectId","statusNotice","status","targetFieldId","window","opener","postMessage","JSON","stringify","listener","event","data","String","messageObject","parse","hasParent","targetField","$","val","unsavedChildren","relatedAssetPreview","closest","submitForm","find","removeAttr","document","on","preventDefault","targetTemplate","this","first","targetCollection","attr","windowPointer","open","basePath","onload","targetInfo","unload","addEventListener","console","log","attachEvent"],"mappings":"AAoBA,QAASA,oBAAmBC,GAC3B,GAAIC,IAAiBD,SAAYA,EAAUE,OAAS,QAASC,cAAiBA,cAC9EC,QAAOC,OAAOC,YAAYC,KAAKC,UAAUP,GAAe,KAYzD,QAASQ,UAASC,GACjB,GAA2B,gBAAfA,GAAMC,MAAqBD,EAAMC,eAAgBC,QAA7D,CAGA,GAAIC,GAAgBN,KAAKO,MAAMJ,EAAMC,KAClCD,GAAMC,OAEmB,QAAxBE,EAAcX,SAChBa,WAAY,EACZZ,cAAgBU,EAAcG,aAGJ,SAAxBH,EAAcX,SAEbe,EAAE,IAAIJ,EAAcV,eAAee,OAASL,EAAcb,UAC5DmB,kBAEDF,EAAE,IAAIJ,EAAcV,eAAee,IAAIL,EAAcb,UACrDoB,oBAAoBP,EAAcb,SAAUiB,EAAE,IAAIJ,EAAcV,eAAekB,QAAQ,oBACvFC,cAE0B,UAAxBT,EAAcX,QACgC,KAA7Ce,EAAE,IAAIJ,EAAcV,eAAee,QACrCC,kBACAF,EAAE,IAAIJ,EAAcV,eAAekB,QAAQ,mBAAmBE,KAAK,mBAAmBC,WAAW,eAzDrG,GAAIrB,eAAgB,GAChBY,WAAY,EACZI,gBAAkB,CAEtBF,GAAEQ,UAAUC,GAAG,QAAS,kBAAmB,SAAShB,GACnDA,EAAMiB,gBACN,IAAIC,GAAiBX,EAAEY,MAAMR,QAAQ,mBAAmBE,KAAK,qBAAqBO,QAAQZ,MACtFa,EAAmBd,EAAE,iBAAiBC,MACtCF,EAAcC,EAAEY,MAAMR,QAAQ,mBAAmBE,KAAK,gBAAgBO,QAAQE,KAAK,KACvFf,GAAEY,MAAMG,KAAK,YAAY,GACzBb,iBACA,IAAIc,GAAgB7B,OAAO8B,KAAKC,SAAU,yBAAyBP,EAAiB,IAAMG,EAC1FE,GAAcG,OAAS,WACtB,GAAIC,IAAenC,OAAS,OAAQc,YAAeA,EACnDiB,GAAc3B,YAAYC,KAAKC,UAAU6B,GAAa,QAUxDpB,EAAGb,QAASkC,OAAO,WAClB,GAAGvB,UAAW,CACb,GAAId,IAAiBD,SAAY,KAAME,OAAS,SAAUC,cAAiBA,cAC3EC,QAAOC,OAAOC,YAAYC,KAAKC,UAAUP,GAAe,QAuCtDG,OAAOmC,kBAEVA,iBAAiB,UAAW9B,UAAU,GACtC+B,QAAQC,IAAI,mBAGXC,YAAY,YAAajC","file":"interWindow.min.js","sourcesContent":["\nvar targetFieldId = \"\";\nvar hasParent = false;\nvar unsavedChildren = 0;\n\n$(document).on(\"click\", \".newAssetButton\", function(event) {\n\tevent.preventDefault();\n\tvar targetTemplate = $(this).closest(\".widgetContents\").find(\".templateSelector\").first().val();\n\tvar targetCollection = $(\"#collectionId\").val();\n\tvar targetField = $(this).closest(\".widgetContents\").find(\".targetAsset\").first().attr('id');\n\t$(this).attr(\"disabled\", true);\n\tunsavedChildren++;\n\tvar windowPointer = window.open(basePath +\"assetManager/addAsset/\"+targetTemplate + \"/\" + targetCollection);\n\twindowPointer.onload = function( ){\n\t\tvar targetInfo = { 'status':'open', 'targetField': targetField };\n\t\twindowPointer.postMessage(JSON.stringify(targetInfo), \"*\");\n\t};\n\n});\n\nfunction notifyParentOfSave(objectId) {\n\tvar statusNotice = { 'objectId': objectId, 'status':'saved', 'targetFieldId': targetFieldId};\n\twindow.opener.postMessage(JSON.stringify(statusNotice), \"*\");\n}\n\n$( window ).unload(function() {\n\tif(hasParent) {\n\t\tvar statusNotice = { 'objectId': null, 'status':'closed', 'targetFieldId': targetFieldId};\n\t\twindow.opener.postMessage(JSON.stringify(statusNotice), \"*\");\n\t}\n\n});\n\n\nfunction listener(event) {\n\tif(!(typeof event.data === 'string' || event.data instanceof String)) {\n\t\treturn;\n\t}\n\tvar messageObject = JSON.parse(event.data);\n\tif(event.data ) {\n\n\t\tif(messageObject.status == 'open') {\n\t\t\thasParent = true;\n\t\t\ttargetFieldId = messageObject.targetField;\n\t\t}\n\t\t// TODO, update the UI with this info\n\t\tif(messageObject.status == 'saved') {\n\t\t\t// First Save, don't need to count this one anymore\n\t\t\tif($(\"#\"+messageObject.targetFieldId).val() != messageObject.objectId) {\n\t\t\t\tunsavedChildren--;\n\t\t\t}\n\t\t\t$(\"#\"+messageObject.targetFieldId).val(messageObject.objectId);\n\t\t\trelatedAssetPreview(messageObject.objectId, $(\"#\"+messageObject.targetFieldId).closest(\".widgetContents\"));\n\t\t\tsubmitForm();\n\t\t}\n\t\tif(messageObject.status == 'closed') {\n\t\t\tif($(\"#\"+messageObject.targetFieldId).val() === \"\") {\n\t\t\t\tunsavedChildren--;\n\t\t\t\t$(\"#\"+messageObject.targetFieldId).closest(\".widgetContents\").find(\".newAssetButton\").removeAttr(\"disabled\");\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nif (window.addEventListener){\n\n\taddEventListener(\"message\", listener, false);\n\tconsole.log(\"listener added\");\n\n} else {\n  attachEvent(\"onmessage\", listener);\n}\n"],"sourceRoot":"/source/"}