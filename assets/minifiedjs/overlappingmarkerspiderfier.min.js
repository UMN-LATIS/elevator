(function(){var t=!0,e=null,i=!1;(function(){var r,s={}.hasOwnProperty,n=[].slice;((r=this.google)!=e?r.maps:void 0)!=e&&(this.OverlappingMarkerSpiderfier=function(){function r(t,i){var r,n,h,a,u=this;this.map=t,i==e&&(i={});for(r in i)s.call(i,r)&&(n=i[r],this[r]=n);for(this.e=new this.constructor.g(this.map),this.n(),this.b={},a=["click","zoom_changed","maptypeid_changed"],n=0,h=a.length;h>n;n++)r=a[n],o.addListener(this.map,r,function(){return u.unspiderfy()})}var o,h,a,u,l,p,f,g;for(p=r.prototype,g=[r,p],u=0,l=g.length;l>u;u++)a=g[u],a.VERSION="0.3.3";return h=google.maps,o=h.event,l=h.MapTypeId,f=2*Math.PI,p.keepSpiderfied=i,p.markersWontHide=i,p.markersWontMove=i,p.nearbyDistance=20,p.circleSpiralSwitchover=9,p.circleFootSeparation=23,p.circleStartAngle=f/12,p.spiralFootSeparation=26,p.spiralLengthStart=11,p.spiralLengthFactor=4,p.spiderfiedZIndex=1e3,p.usualLegZIndex=10,p.highlightedLegZIndex=20,p.legWeight=1.5,p.legColors={usual:{},highlighted:{}},u=p.legColors.usual,a=p.legColors.highlighted,u[l.HYBRID]=u[l.SATELLITE]="#fff",a[l.HYBRID]=a[l.SATELLITE]="#f00",u[l.TERRAIN]=u[l.ROADMAP]="#444",a[l.TERRAIN]=a[l.ROADMAP]="#f00",p.n=function(){this.a=[],this.j=[]},p.addMarker=function(r){var s,n=this;return r._oms!=e?this:(r._oms=t,s=[o.addListener(r,"click",function(t){return n.F(r,t)})],this.markersWontHide||s.push(o.addListener(r,"visible_changed",function(){return n.o(r,i)})),this.markersWontMove||s.push(o.addListener(r,"position_changed",function(){return n.o(r,t)})),this.j.push(s),this.a.push(r),this)},p.o=function(t,i){return t._omsData==e||!i&&t.getVisible()||this.s!=e||this.t!=e?void 0:this.unspiderfy(i?t:e)},p.getMarkers=function(){return this.a.slice(0)},p.removeMarker=function(t){var i,r,s,n,h;if(t._omsData!=e&&this.unspiderfy(),i=this.m(this.a,t),0>i)return this;for(s=this.j.splice(i,1)[0],n=0,h=s.length;h>n;n++)r=s[n],o.removeListener(r);return delete t._oms,this.a.splice(i,1),this},p.clearMarkers=function(){var t,e,i,r,s,n,h,a;for(this.unspiderfy(),a=this.a,t=r=0,n=a.length;n>r;t=++r){for(i=a[t],e=this.j[t],s=0,h=e.length;h>s;s++)t=e[s],o.removeListener(t);delete i._oms}return this.n(),this},p.addListener=function(t,i){var r,s;return((s=(r=this.b)[t])!=e?s:r[t]=[]).push(i),this},p.removeListener=function(t,e){var i;return i=this.m(this.b[t],e),0>i||this.b[t].splice(i,1),this},p.clearListeners=function(t){return this.b[t]=[],this},p.trigger=function(){var t,i,r,s,o,h;for(i=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],i=(r=this.b[i])!=e?r:[],h=[],s=0,o=i.length;o>s;s++)r=i[s],h.push(r.apply(e,t));return h},p.u=function(t,e){var i,r,s,n,o;for(s=this.circleFootSeparation*(2+t)/f,r=f/t,o=[],i=n=0;t>=0?t>n:n>t;i=t>=0?++n:--n)i=this.circleStartAngle+i*r,o.push(new h.Point(e.x+s*Math.cos(i),e.y+s*Math.sin(i)));return o},p.v=function(t,e){var i,r,s,n,o;for(s=this.spiralLengthStart,i=0,o=[],r=n=0;t>=0?t>n:n>t;r=t>=0?++n:--n)i+=this.spiralFootSeparation/s+5e-4*r,r=new h.Point(e.x+s*Math.cos(i),e.y+s*Math.sin(i)),s+=f*this.spiralLengthFactor/i,o.push(r);return o},p.F=function(t,i){var r,s,n,o,h,a,u,l,p;if(o=t._omsData!=e,(!o||!this.keepSpiderfied)&&this.unspiderfy(),o||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",t,i);for(o=[],h=[],r=this.nearbyDistance,a=r*r,n=this.c(t.position),p=this.a,u=0,l=p.length;l>u;u++)r=p[u],r.map!=e&&r.getVisible()&&(s=this.c(r.position),this.f(s,n)<a?o.push({A:r,p:s}):h.push(r));return 1===o.length?this.trigger("click",t,i):this.G(o,h)},p.markersNearMarker=function(t,r){var s,n,o,h,a,u,l,p,f,g;if(r==e&&(r=i),this.e.getProjection()==e)throw"Must wait for 'idle' event on map before calling markersNearMarker";for(s=this.nearbyDistance,a=s*s,o=this.c(t.position),h=[],p=this.a,u=0,l=p.length;l>u&&(s=p[u],s===t||s.map==e||!s.getVisible()||(n=this.c((f=(g=s._omsData)!=e?g.l:void 0)!=e?f:s.position),!(this.f(n,o)<a&&(h.push(s),r))));u++);return h},p.markersNearAnyOtherMarker=function(){var r,s,n,o,h,a,u,l,p,f,g,c;if(this.e.getProjection()==e)throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";for(a=this.nearbyDistance,r=a*a,o=this.a,a=[],g=0,n=o.length;n>g;g++)s=o[g],a.push({q:this.c((u=(p=s._omsData)!=e?p.l:void 0)!=e?u:s.position),d:i});for(g=this.a,s=u=0,p=g.length;p>u;s=++u)if(n=g[s],n.map!=e&&n.getVisible()&&(o=a[s],!o.d))for(c=this.a,n=l=0,f=c.length;f>l;n=++l)if(h=c[n],n!==s&&h.map!=e&&h.getVisible()&&(h=a[n],(!(s>n)||h.d)&&this.f(o.q,h.q)<r)){o.d=h.d=t;break}for(g=this.a,n=[],r=u=0,p=g.length;p>u;r=++u)s=g[r],a[r].d&&n.push(s);return n},p.z=function(t){var e=this;return{h:function(){return t._omsData.i.setOptions({strokeColor:e.legColors.highlighted[e.map.mapTypeId],zIndex:e.highlightedLegZIndex})},k:function(){return t._omsData.i.setOptions({strokeColor:e.legColors.usual[e.map.mapTypeId],zIndex:e.usualLegZIndex})}}},p.G=function(e,i){var r,s,n,a,u,l,p,f,g,c;return this.s=t,c=e.length,r=this.C(function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)f=e[t],r.push(f.p);return r}()),a=c>=this.circleSpiralSwitchover?this.v(c,r).reverse():this.u(c,r),r=function(){var t,i,r,f=this;for(r=[],t=0,i=a.length;i>t;t++)n=a[t],s=this.D(n),g=this.B(e,function(t){return f.f(t.p,n)}),p=g.A,l=new h.Polyline({map:this.map,path:[p.position,s],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),p._omsData={l:p.position,i:l},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(u=this.z(p),p._omsData.w={h:o.addListener(p,"mouseover",u.h),k:o.addListener(p,"mouseout",u.k)}),p.setPosition(s),p.setZIndex(Math.round(this.spiderfiedZIndex+n.y)),r.push(p);return r}.call(this),delete this.s,this.r=t,this.trigger("spiderfy",r,i)},p.unspiderfy=function(i){var r,s,n,h,a,u,l;if(i==e&&(i=e),this.r==e)return this;for(this.t=t,h=[],n=[],l=this.a,a=0,u=l.length;u>a;a++)s=l[a],s._omsData!=e?(s._omsData.i.setMap(e),s!==i&&s.setPosition(s._omsData.l),s.setZIndex(e),r=s._omsData.w,r!=e&&(o.removeListener(r.h),o.removeListener(r.k)),delete s._omsData,h.push(s)):n.push(s);return delete this.t,delete this.r,this.trigger("unspiderfy",h,n),this},p.f=function(t,e){var i,r;return i=t.x-e.x,r=t.y-e.y,i*i+r*r},p.C=function(t){var e,i,r,s,n;for(s=i=r=0,n=t.length;n>s;s++)e=t[s],i+=e.x,r+=e.y;return t=t.length,new h.Point(i/t,r/t)},p.c=function(t){return this.e.getProjection().fromLatLngToDivPixel(t)},p.D=function(t){return this.e.getProjection().fromDivPixelToLatLng(t)},p.B=function(t,i){var r,s,n,o,h,a;for(n=h=0,a=t.length;a>h;n=++h)o=t[n],o=i(o),("undefined"==typeof r||r===e||s>o)&&(s=o,r=n);return t.splice(r,1)[0]},p.m=function(t,i){var r,s,n,o;if(t.indexOf!=e)return t.indexOf(i);for(r=n=0,o=t.length;o>n;r=++n)if(s=t[r],s===i)return r;return-1},r.g=function(t){return this.setMap(t)},r.g.prototype=new h.OverlayView,r.g.prototype.draw=function(){},r}())}).call(this)}).call(this);
//# sourceMappingURL=overlappingmarkerspiderfier.js.map
