{"version":3,"sources":["formSubmission.js"],"names":["submitTimer","submitFormWithDelay","ignoreWarnings","supressAlertAndBlock","clearTimeout","setTimeout","submitFormProtected","submitForm","window","unsavedChildren","bootbox","dialog","message","title","backdrop","buttons","success","label","className","callback","cancel","$","parsley","each","index","el","frameForm","contents","find","hasClass","contentWindow","iFrameObjectId","val","closest","showHaveEntries","ajaxSetup","async","post","basePath","formData","JSON","stringify","serializeForm","data","jsonObject","parseJSON","e","alert","objectId","prop","hideAll","trigger","hasParent","notifyParentOfSave","loadPreviewAndUpdateTitle","markSaveClean","text","show","removeAttr","history","pushState","pathAddition","newurl","location","protocol","host","path","fail","source","html","template","Handlebars","compile","get","responseObject","base_url","replaceableTitle","document","split"],"mappings":"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","file":"formSubmission.min.js","sourcesContent":["\nvar submitTimer = null;\n\n\n// wait a tick before we fire so we can coalesce saves\nfunction submitFormWithDelay(ignoreWarnings, supressAlertAndBlock) {\n\tclearTimeout(submitTimer);\n\tsubmitTimer = setTimeout(function() {\n\t\tsubmitFormProtected(ignoreWarnings, supressAlertAndBlock);\n\t}, 1000);\n}\n\nfunction submitForm(ignoreWarnings, supressAlertAndBlock) {\n\tclearTimeout(submitTimer);\n\tsubmitFormProtected(ignoreWarnings, supressAlertAndBlock);\n}\n\nfunction submitFormProtected(ignoreWarnings, supressAlertAndBlock) {\n\tif(window.unsavedChildren>0 && !ignoreWarnings) {\n\t\tbootbox.dialog({\n\t\t\tmessage: \"You have unsaved nested assets.  Please save or close them before submitting the parent.\",\n\t\t\ttitle: \"Unsaved Assets\",\n\t\t\tbackdrop: true,\n\t\t\tbuttons: {\n\t\t\t\tsuccess: {\n\t\t\t\t\tlabel: \"Ignore and Save\",\n\t\t\t\t\tclassName: \"btn-warning\",\n\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\tsubmitForm(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcancel: {\n\t\t\t\t\tlabel: \"Cancel\",\n\t\t\t\t\tclassName: \"btn-default\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t}\n\n\t$(\"#entryForm\").parsley( 'validate' );\n\n\t$(\".nestediIFrame\").each(function(index, el) {\n\n\t\tvar frameForm = $(el).contents().find(\"form\");\n\t\tif($(frameForm).hasClass('dirty')) {\n\n\t\t\t$(el)[0].contentWindow.submitForm(true, true);\n\t\t\tvar iFrameObjectId = $(el).contents().find(\"#inputObjectId\").val();\n\t\t\t$(el).closest(\".widgetContents\").find(\".targetAsset\").val(iFrameObjectId);\n\t\t}\n\n\t});\n\tshowHaveEntries();\n\n\tif($(\"#collectionId\").val() == -1) {\n\t\tbootbox.dialog({\n\t\t\tmessage: \"Collection cannot be empty.\",\n\t\t\ttitle: \"Invalid Collction\",\n\t\t\tbackdrop: true,\n\t\t\tbuttons: {\n\n\t\t\t\tcancel: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn;\n\t}\n\n\tif(!$(\"#entryForm\").parsley('isValid')) {\n\t\tbootbox.dialog({\n\t\t\tmessage: \"You have errors or missing/invalid values in your asset.  Your asset cannot be saved until these issues are corrected.\",\n\t\t\ttitle: \"Invalid Entry\",\n\t\t\tbackdrop: true,\n\t\t\tbuttons: {\n\n\t\t\t\tcancel: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t}\n\n\t// make these operations blocking\n\tif(supressAlertAndBlock) {\n\t\t$.ajaxSetup({\n\t\t\tasync: false\n\t\t});\n\t}\n\telse {\n\t\t$.ajaxSetup({\n\t\t\tasync: true\n\t\t});\t\n\t}\n\n\t$.post( basePath + \"assetManager/submission\", {formData: JSON.stringify($( \"#entryForm\" ).serializeForm())}, function( data ) {\n\n\t\ttry{\n\t\t\tjsonObject = $.parseJSON(data);\n\t\t}\n\t\tcatch(e){\n\t\t\talert(e + \" \" + data);\n\t\t}\n\t\tif(jsonObject.success === true) {\n\t\t\tobjectId = jsonObject.objectId;\n\t\t\t$(\".regenerateDerivatives\").prop(\"checked\", false);\n\t\t\tif(!supressAlertAndBlock) {\n\t\t\t\tbootbox.alert(\"<h2>Saved</h2>\");\n\t\t\t\twindow.setTimeout(function(){\n\t\t\t\t\tbootbox.hideAll();\n\t\t\t\t\t// trigger the alert that they can't make changes if they just altered a collection\n\t\t\t\t\t$(\"#collectionMigrationInProcess\").trigger('change');\n\t\t\t\t}, 1500);\n\n\t\t\t}\n\n\t\t\tif(hasParent) {\n\t\t\t\t/**\n\t\t\t\t * If we've been opened in a window.open, we don't want to redirect, just let the parent know\n\t\t\t\t */\n\t\t\t\tnotifyParentOfSave(objectId);\n\t\t\t}\n\n\t\t\tloadPreviewAndUpdateTitle(objectId);\n\t\t\tmarkSaveClean();\n\n\n\t\t\t$(\".objectIdText\").text(objectId);\n\t\t\t$(\"#inputObjectId\").val(objectId);\n\t\t\t$(\".viewAsset\").show();\n\t\t\t$(\".deleteFile\").removeAttr(\"disabled\");\n\t\t\tif (history.pushState) {\n\t\t\t\tpathAddition = \"\";\n\t\t\t\tif(basePath != \"/\") {\n\t\t\t\t\tpathAddition = basePath;\n\t\t\t\t}\n\t\t\t\tvar newurl = window.location.protocol + \"//\" + window.location.host + pathAddition + \"/assetManager/editAsset/\"  + objectId;\n\t\t\t\twindow.history.pushState({path:newurl},'',newurl);\n\t\t\t}\n\n\t\t}\n\t\telse {\n\t\t\tbootbox.dialog({\n\t\t\t\tmessage: \"An error was returned while saving your asset.  Check your internet connection and try saving again.  If it continues to fail, you may need to refresh the page.  Any unsaved changes will be lost.\",\n\t\t\t\ttitle: \"Error Occured During Save\",\n\t\t\t\tbackdrop: true,\n\t\t\t\tbuttons: {\n\n\t\t\t\t\tcancel: {\n\t\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}).fail(function() {\n\t\tbootbox.dialog({\n\t\t\tmessage: \"An error was returned while saving your asset.  Check your internet connection and try saving again.  If it continues to fail, you may need to refresh the page.  Any unsaved changes will be lost.\",\n\t\t\ttitle: \"Error Occured During Save\",\n\t\t\tbackdrop: true,\n\t\t\tbuttons: {\n\n\t\t\t\tcancel: {\n\t\t\t\t\tlabel: \"OK\",\n\t\t\t\t\tclassName: \"btn-primary\"\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n}\n\nfunction loadPreviewAndUpdateTitle(objectId) {\n\tvar source   = $(\"#minipreview-template\").html();\n\tvar template = Handlebars.compile(source);\n\t$.get( basePath + \"asset/getAssetPreview/\" + objectId,  function( data ) {\n\t\ttry{\n\t\t\tjsonObject = $.parseJSON(data);\n\t\t}\n\t\tcatch(e){\n\t\t\talert(e + \" \" + data);\n\t\t\treturn;\n\t\t}\n\t\tif(jsonObject) {\n\t\t\tvar responseObject = jsonObject;\n\t\t\tresponseObject.base_url = basePath;\n\n\t\t\tvar html = template(responseObject);\n\t\t\t$(\".miniPreview\").html(html);\n\n\t\t\tvar title = responseObject.title;\n\t\t\tif(!title) {\n\t\t\t\ttitle = \"\";\n\t\t\t}\n\n\t\t\tvar replaceableTitle  = document.title.split(\" | \");\n\n\t\t\tdocument.title = \"Edit Asset: \" + title + \" | \" + replaceableTitle[1];\n\n\n\t\t}\n\t});\n}\n"]}