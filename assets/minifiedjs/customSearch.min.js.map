{"version":3,"sources":["customSearch.js"],"names":["templateList","$","document","ready","jQuery","getJSON","basePath","json","textStatus","prepopulate","on","result","serializeForm","searchId","val","searchTitle","post","searchData","customSearchId","data","xhr","pathAddition","newurl","window","location","protocol","host","history","pushState","path","bootbox","alert","setTimeout","hideAll","event","preventDefault","addNewGroup","storeAndSearch","e","keyCode","presetInfo","templates","specificTemplateId","searchFieldValues","specificSearchField","each","index","targetElement","templateSelector","find","loadSearchFields","injectObject","source","html","Handlebars","compile","template","insertObject","before","templateId","parentGroup","targetValue","targetGroup","empty","append","value","text","trigger","this","closest","fieldTitle","buildSearchForm"],"mappings":"AAAA,IAAIA,aAAe,GAGnBC,EAAEC,UAAUC,OAAM,WAGjBC,OAAOC,QAAQC,SAAW,sBAAuB,IAAI,SAASC,EAAMC,GACnER,aAAeO,EACfE,iBAIDR,EAAE,qBAAqBS,GAAG,SAAS,WAClC,IAAIC,EAASV,EAAE,qBAAqBW,gBAChCC,EAAWZ,EAAE,aAAaa,MAC1BC,EAAcd,EAAE,qBAAqBa,MACzCb,EAAEe,KAAKV,SAAW,oBAAqB,CAAES,YAAaA,EAAaE,WAAYN,EAAQO,eAAgBL,IAAY,SAASM,EAAMX,EAAYY,GAC7I,GAAGD,EAAM,CACRlB,EAAE,aAAaa,IAAIK,GACnBE,aAAe,GACA,KAAZf,WACFe,aAAef,UAEhB,IAAIgB,EAASC,OAAOC,SAASC,SAAW,KAAOF,OAAOC,SAASE,KAAOL,aAAe,yBAA4BF,EACjHI,OAAOI,QAAQC,UAAU,CAACC,KAAKP,GAAQ,GAAGA,GAC1CQ,QAAQC,MAAM,kBACdR,OAAOS,YAAW,WACjBF,QAAQG,YACN,aAMNhC,EAAE,aAAaS,GAAG,SAAS,SAASwB,GACnCA,EAAMC,iBACNC,iBAIDnC,EAAE,iBAAiBS,GAAG,SAAS,SAASwB,GAEvCG,eAAe,GAAIpC,EAAE,4BASvBA,EAAEC,UAAUQ,GAAG,WAAY,SAAS,SAAS4B,GACzC,GAAiB,IAAbA,EAAEC,QAEF,OADAF,eAAe,GAAIpC,EAAE,uBACd,KAKf,IAAIQ,YAAc,WACjB,GAAG+B,WAAY,CAEd,IAAIC,EAAYD,WAAWE,mBACvBC,EAAoBH,WAAWI,oBAEnC3C,EAAE4C,KAAKJ,GAAW,SAASK,EAAOhC,GAEjC,IAAIiC,EAAgBX,cAChBY,EAAmB/C,EAAE8C,GAAeE,KAAK,qBAC3BhD,EAAE8C,GAAeE,KAAK,gBAExChD,EAAE+C,GAAkBlC,IAAIA,GACxBoC,iBAAiBjD,EAAE+C,GAAkBlC,MAAOiC,EAAeJ,EAAkBG,SAQ5EV,YAAc,WACjB,IAAIe,EAAe,GACnBA,EAAaV,UAAYzC,aACzB,IAAIoD,EAAWnD,EAAE,iBAAiBoD,OAE9BA,EADWC,WAAWC,QAAQH,EACvBI,CAASL,GAChBM,EAAexD,EAAEoD,GACRpD,EAAE,mBAAmByD,OAAOD,GACzC,OAAOxD,EAAEwD,IAGNP,iBAAmB,SAASS,EAAYC,EAAaC,GACxD5D,EAAEI,QAAQC,SAAW,oBAAsBqD,EAAY,IAAI,SAASpD,EAAMC,GACzE,IAAIsD,EAAc7D,EAAE2D,GAAaX,KAAK,gBACtChD,EAAE6D,GAAaC,QACf9D,EAAE4C,KAAKtC,GAAM,SAASuC,EAAOhC,GAC5Bb,EAAE6D,GAAaE,OAAO/D,EAAE,WAAY,CAACgE,MAAOnB,IAAQoB,KAAKpD,OAEvD+C,IACF5D,EAAE6D,GAAahD,IAAI+C,GACnB5D,EAAE6D,GAAaK,QAAQ,eAK1BlE,EAAEC,UAAUQ,GAAG,SAAU,qBAAqB,SAASwB,GAEtD,IAAIyB,EAAa1D,EAAEmE,MAAMtD,MACrB8C,EAAc3D,EAAEmE,MAAMC,QAAQ,gBAClCnB,iBAAiBS,EAAYC,EAAa,SAG3C3D,EAAEC,UAAUQ,GAAG,SAAU,gBAAgB,SAASwB,GACjD,IAAI0B,EAAc3D,EAAEmE,MAAMC,QAAQ,gBAC9BC,EAAarE,EAAEmE,MAAMtD,MACrB6C,EAAa1D,EAAE2D,GAAaX,KAAK,qBAAqBnC,MACtDgD,EAAc7D,EAAE2D,GAAaX,KAAK,gCACtCsB,gBAAgBD,EAAWX,EAAYG","file":"customSearch.min.js","sourcesContent":["var templateList = \"\";\n\n\n$(document).ready(function() {\n\n\n\tjQuery.getJSON(basePath + 'search/getTemplates', {}, function(json, textStatus) {\n\t\ttemplateList = json;\n\t\tprepopulate();\n\t});\n\n\n\t$(\"#customSaveButton\").on(\"click\", function() {\n\t\tvar result = $(\"#customSearchForm\").serializeForm();\n\t\tvar searchId = $(\"#searchId\").val();\n\t\tvar searchTitle = $(\"#inputSearchTitle\").val();\n\t\t$.post(basePath + \"search/saveSearch\", { searchTitle: searchTitle, searchData: result, customSearchId: searchId }, function(data, textStatus, xhr) {\n\t\t\tif(data) {\n\t\t\t\t$(\"#searchId\").val(data);\n\t\t\t\tpathAddition = \"\";\n\t\t\t\tif(basePath != \"/\") {\n\t\t\t\t\tpathAddition = basePath;\n\t\t\t\t}\n\t\t\t\tvar newurl = window.location.protocol + \"//\" + window.location.host + pathAddition + \"/search/searchBuilder/\"  + data;\n\t\t\t\twindow.history.pushState({path:newurl},'',newurl);\n\t\t\t\tbootbox.alert(\"<h2>Saved</h2>\");\n\t\t\t\twindow.setTimeout(function(){\n\t\t\t\t\tbootbox.hideAll();\n\t\t\t\t}, 1500);\n\t\t\t}\n\t\t});\n\t});\n\n\n\t$(\".addGroup\").on('click', function(event) {\n\t\tevent.preventDefault();\n\t\taddNewGroup();\n\t});\n\n\n\t$(\"#searchButton\").on('click', function(event) {\n\n\t\tstoreAndSearch(\"\", $(\"#customSearchForm\"));\n\n\t});\n\n\n\n\n});\n\n$(document).on(\"keypress\", 'input', function(e) {\n    if (e.keyCode == 13) {\n        storeAndSearch(\"\", $(\"#customSearchForm\"));\n        return false;\n    }\n});\n\n\nvar prepopulate = function() {\n\tif(presetInfo) {\n\n\t\tvar templates = presetInfo.specificTemplateId;\n\t\tvar searchFieldValues = presetInfo.specificSearchField;\n\n\t\t$.each(templates, function(index, val) {\n\n\t\t\tvar targetElement = addNewGroup();\n\t\t\tvar templateSelector = $(targetElement).find(\".templateSelector\");\n\t\t\tvar searchField = $(targetElement).find(\".searchField\");\n\n\t\t\t$(templateSelector).val(val);\n\t\t\tloadSearchFields($(templateSelector).val(), targetElement, searchFieldValues[index]);\n\n\t\t});\n\n\t}\n\n};\n\nvar addNewGroup = function() {\n\tvar injectObject = {};\n\tinjectObject.templates = templateList;\n\tvar source   = $(\"#search-entry\").html();\n\tvar template = Handlebars.compile(source);\n\tvar html = template(injectObject);\n\tvar insertObject = $(html);\n\tvar result = $(\".addButtonGroup\").before(insertObject);\n\treturn $(insertObject);\n};\n\nvar loadSearchFields = function(templateId, parentGroup, targetValue) {\n\t$.getJSON(basePath + 'search/getFields/' + templateId, {}, function(json, textStatus) {\n\t\tvar targetGroup = $(parentGroup).find(\".searchField\");\n\t\t$(targetGroup).empty();\n\t\t$.each(json, function(index, val) {\n\t\t\t$(targetGroup).append($('<option>', {value: index}).text(val));\n\t\t});\n\t\tif(targetValue) {\n\t\t\t$(targetGroup).val(targetValue);\n\t\t\t$(targetGroup).trigger(\"change\");\n\t\t}\n\t});\n};\n\n$(document).on('change', \".templateSelector\", function(event) {\n\n\tvar templateId = $(this).val();\n\tvar parentGroup = $(this).closest('.searchGroup');\n\tloadSearchFields(templateId, parentGroup, null);\n});\n\n$(document).on('change', \".searchField\", function(event) {\n\tvar parentGroup = $(this).closest('.searchGroup');\n\tvar fieldTitle = $(this).val();\n\tvar templateId = $(parentGroup).find(\".templateSelector\").val();\n\tvar targetGroup = $(parentGroup).find(\".specificSearchTextContainer\");\n\tbuildSearchForm(fieldTitle,templateId, targetGroup);\n});\n"]}