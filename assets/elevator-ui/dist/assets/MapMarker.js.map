{"version":3,"file":"MapMarker.js","sources":["../../src/components/MapMarker/MapMarker.vue"],"sourcesContent":["<template>\n  <div class=\"map-marker\">\n    <slot></slot>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { watch, ref, unref } from \"vue\";\nimport { Marker } from \"maplibre-gl\";\nimport { inject, provide } from \"vue\";\nimport { MapInjectionKey, MarkerInjectionKey } from \"@/constants/mapConstants\";\nimport { LngLat } from \"@/types\";\n\ninterface Props {\n  lng: number;\n  lat: number;\n  color?: string;\n  draggable?: boolean;\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  color: \"#f43f5e\",\n  draggable: false,\n});\n\ninterface Emits {\n  (eventName: \"drag\", coords: LngLat);\n}\nconst emit = defineEmits<Emits>();\n\nconst mapRef = inject(MapInjectionKey);\nconst marker = ref<Marker | null>(null);\n\nwatch(\n  [mapRef, () => props],\n  () => {\n    const map = unref(mapRef);\n\n    // if no map yet, nothing to do\n    if (!map) {\n      console.log(\"Cannot add marker yet. No map.\");\n      return;\n    }\n\n    // remove old marker if it exists\n    const oldMarker = unref(marker);\n    if (oldMarker) oldMarker.remove();\n\n    marker.value = new Marker({\n      color: props.color,\n      draggable: props.draggable,\n    })\n      .setLngLat([props.lng, props.lat])\n      .addTo(map)\n      .on(\"dragend\", () => {\n        const lngLat = marker.value?.getLngLat();\n        if (!lngLat) return;\n        emit(\"drag\", {\n          lng: lngLat.lng,\n          lat: lngLat.lat,\n        });\n      });\n  },\n  { immediate: true }\n);\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nprovide(MarkerInjectionKey, marker);\n// @ts-check\n</script>\n"],"names":["mapRef","inject","MapInjectionKey","marker","ref","watch","props","map","unref","oldMarker","Marker","lngLat","_a","emit","provide","MarkerInjectionKey"],"mappings":"obA6BMA,EAASC,EAAOC,CAAe,EAC/BC,EAASC,EAAmB,IAAI,EAEtC,OAAAC,EACE,CAACL,EAAQ,IAAMM,CAAK,EACpB,IAAM,CACE,MAAAC,EAAMC,EAAMR,CAAM,EAGxB,GAAI,CAACO,EAAK,CACR,QAAQ,IAAI,gCAAgC,EAC5C,MACF,CAGM,MAAAE,EAAYD,EAAML,CAAM,EAC1BM,GAAWA,EAAU,OAAO,EAEzBN,EAAA,MAAQ,IAAIO,iBAAO,CACxB,MAAOJ,EAAM,MACb,UAAWA,EAAM,SAClB,CAAA,EACE,UAAU,CAACA,EAAM,IAAKA,EAAM,GAAG,CAAC,EAChC,MAAMC,CAAG,EACT,GAAG,UAAW,IAAM,OACb,MAAAI,GAASC,EAAAT,EAAO,QAAP,YAAAS,EAAc,YACzB,CAACD,GACLE,EAAK,OAAQ,CACX,IAAKF,EAAO,IACZ,IAAKA,EAAO,GAAA,CACb,CAAA,CACF,CACL,EACA,CAAE,UAAW,EAAK,CAAA,EAKpBG,EAAQC,EAAoBZ,CAAM"}