/*! cornerstoneTools - v0.7.9 - 2016-07-13 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneTools */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof dicomParser&&(dicomParser={}),"undefined"==typeof cornerstoneTools&&(cornerstoneTools={referenceLines:{},orientation:{}}),function(a,b,c){"use strict";function d(c){clearTimeout(g),g=setTimeout(function(){if(!("mousewheel"===c.originalEvent.type&&0===c.originalEvent.wheelDeltaY||"DOMMouseScroll"===c.originalEvent.type&&1===c.originalEvent.axis)){var d,e,f=c.currentTarget;void 0!==c.pageX&&void 0!==c.pageY?(d=c.pageX,e=c.pageY):c.originalEvent&&void 0!==c.originalEvent.pageX&&void 0!==c.originalEvent.pageY?(d=c.originalEvent.pageX,e=c.originalEvent.pageY):(d=c.x,e=c.y);var g=b.pageToPixel(f,d,e);c=window.event||c;var h=c.wheelDelta||-c.detail||-c.originalEvent.detail||-c.originalEvent.deltaY,i=Math.max(-1,Math.min(1,h)),j={element:f,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,direction:i,pageX:d,pageY:e,imageX:g.x,imageY:g.y};a(f).trigger("CornerstoneToolsMouseWheel",j)}},h)}function e(b){f(b),a(b).on(i,d)}function f(b){a(b).unbind(i,d)}var g,h=1,i="mousewheel DOMMouseScroll";c.mouseWheelInput={enable:e,disable:f}}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(){l=!1}function f(b){a(b.element).trigger("CornerstoneToolsMouseDownActivate",b)}function g(e){var f=e.currentTarget,g="CornerstoneToolsMouseDoubleClick",h={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};h.canvas=b.pixelToCanvas(f,h.image);var i=d.copyPoints(h),j={event:e,which:e.which,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:h,lastPoints:i,currentPoints:h,deltaPoints:{x:0,y:0},type:g},k=a.Event(g,j);a(j.element).trigger(k,j)}function h(g){function h(e){var f="CornerstoneToolsMouseDrag",g={page:c.point.pageToPoint(e),image:b.pageToPixel(k,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};g.canvas=b.pixelToCanvas(k,g.image);var h={page:c.point.subtract(g.page,q.page),image:c.point.subtract(g.image,q.image),client:c.point.subtract(g.client,q.client),canvas:c.point.subtract(g.canvas,q.canvas)},i={which:t,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:g,deltaPoints:h,type:f};return a(i.element).trigger(f,i),q=d.copyPoints(g),d.pauseEvent(e)}function j(d){clearTimeout(m);var e="CornerstoneToolsMouseUp";l&&(e="CornerstoneToolsMouseClick");var f={page:c.point.pageToPoint(d),image:b.pageToPixel(k,d.pageX,d.pageY),client:{x:d.clientX,y:d.clientY}};f.canvas=b.pixelToCanvas(k,f.image);var g={page:c.point.subtract(f.page,q.page),image:c.point.subtract(f.image,q.image),client:c.point.subtract(f.client,q.client),canvas:c.point.subtract(f.canvas,q.canvas)},n={event:d,which:t,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:f,deltaPoints:g,type:e},o=a.Event(e,n);a(n.element).trigger(o,n),a(document).off("mousemove",h),a(document).off("mouseup",j),a(n.element).on("mousemove",i),l=!0}m=setTimeout(e,n);var k=g.currentTarget,o="CornerstoneToolsMouseDown";a(k).off("mousemove",i);var p={page:c.point.pageToPoint(g),image:b.pageToPixel(k,g.pageX,g.pageY),client:{x:g.clientX,y:g.clientY}};p.canvas=b.pixelToCanvas(k,p.image);var q=d.copyPoints(p),r={event:g,which:g.which,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:p,deltaPoints:{x:0,y:0},type:o},s=a.Event(o,r);if(a(r.element).trigger(s,r),s.isImmediatePropagationStopped()===!1&&f(r)===!0)return d.pauseEvent(g);var t=g.which;return a(document).on("mousemove",h),a(document).on("mouseup",j),d.pauseEvent(g)}function i(e){var f=e.currentTarget,g="CornerstoneToolsMouseMove",h={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};h.canvas=b.pixelToCanvas(f,h.image);var i=d.copyPoints(h),j=e.which,k={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};k.canvas=b.pixelToCanvas(f,k.image);var l={page:c.point.subtract(k.page,i.page),image:c.point.subtract(k.image,i.image),client:c.point.subtract(k.client,i.client),canvas:c.point.subtract(k.canvas,i.canvas)},m={which:j,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:h,lastPoints:i,currentPoints:k,deltaPoints:l,type:g};a(f).trigger(g,m),i=d.copyPoints(k)}function j(b){a(b).off("mousedown",h),a(b).off("mousemove",i),a(b).off("dblclick",g)}function k(b){j(b),a(b).on("mousedown",h),a(b).on("mousemove",i),a(b).on("dblclick",g)}var l,m,n=200;d.mouseInput={enable:k,disable:j}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(e){console.log(e.type);var f,g,v=e.target.parentNode;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(s=!1,clearTimeout(n)),e.type){case"tap":s=!1,clearTimeout(n),i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),g="CornerstoneToolsTap",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);break;case"doubletap":s=!1,clearTimeout(n),i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),g="CornerstoneToolsDoubleTap",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);break;case"pinchstart":s=!1,clearTimeout(n),p=1;break;case"pinchmove":if(s=!1,clearTimeout(n),u===!0){p=e.scale,u=!1;break}var w=(e.scale-p)/p;h={page:e.center,image:b.pageToPixel(v,e.center.x,e.center.y)},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchPinch",l={event:e,startPoints:h,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,direction:e.scale<1?1:-1,scaleChange:w,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),p=e.scale;break;case"touchstart":p=1,clearTimeout(n),clearTimeout(m),m=setTimeout(function(){h={page:c.point.pageToPoint(e.originalEvent.touches[0]),image:b.pageToPixel(v,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchStart",e.originalEvent.touches.length>1&&(g="CornerstoneToolsMultiTouchStart"),l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,currentPoints:h,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),f.isImmediatePropagationStopped()===!1&&(g="CornerstoneToolsTouchStartActive",e.originalEvent.touches.length>1&&(g="CornerstoneToolsMultiTouchStartActive"),l.type=g,a(v).trigger(g,l)),j=d.copyPoints(h)},50),s=!0,o=0,n=setTimeout(function(){s&&(i={page:c.point.pageToPoint(e.originalEvent.touches[0]),image:b.pageToPixel(v,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},i.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchPress",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l))},r);break;case"touchend":p=1,s=!1,clearTimeout(n),setTimeout(function(){h={page:c.point.pageToPoint(e.originalEvent.changedTouches[0]),image:b.pageToPixel(v,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),client:{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchEnd",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,currentPoints:h,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l)},50);break;case"panmove":i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),k={page:c.point.subtract(i.page,j.page),image:c.point.subtract(i.image,j.image),client:c.point.subtract(i.client,j.client),canvas:c.point.subtract(i.canvas,j.canvas)},o+=Math.sqrt(k.page.x*k.page.x+k.page.y*k.page.y),o>t&&(s=!1,clearTimeout(n)),g="CornerstoneToolsTouchDrag",e.pointers.length>1&&(g="CornerstoneToolsMultiTouchDrag"),l={viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,lastPoints:j,currentPoints:i,deltaPoints:k,numPointers:e.pointers.length,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),j=d.copyPoints(i);break;case"panstart":i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),j=d.copyPoints(i);break;case"panend":if(s=!1,clearTimeout(n),!j)return!1;i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),k={page:c.point.subtract(i.page,j.page),image:c.point.subtract(i.image,j.image),client:c.point.subtract(i.client,j.client),canvas:c.point.subtract(i.canvas,j.canvas)},g="CornerstoneToolsDragEnd",l={event:e.srcEvent,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,lastPoints:j,currentPoints:i,deltaPoints:k,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);var x=e.pointers.length-e.changedPointers.length;return 2===x&&(u=!0),d.pauseEvent(e);case"rotatemove":s=!1,clearTimeout(n);var y=e.rotation-q;q=e.rotation,g="CornerstoneToolsTouchRotate",l={event:e.srcEvent,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,rotation:y,type:g},f=a.Event(g,l),a(v).trigger(f,l)}return!1}function f(b){g(b);var c={inputClass:Hammer.SUPPORT_POINTER_EVENTS?Hammer.PointerEventInput:Hammer.TouchInput},f=new Hammer.Manager(b,c),h={pointers:0,direction:Hammer.DIRECTION_ALL,threshold:0},i=new Hammer.Pan(h),j=new Hammer.Pinch({threshold:0}),k=new Hammer.Rotate({threshold:0});j.recognizeWith(i),j.recognizeWith(k),k.recognizeWith(i);var l=new Hammer.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(i),f.add([l,i,k,j]),f.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",e),d.preventGhostClick.enable(b),a(b).on("touchstart touchend",e),a(b).data("hammer",f)}function g(b){d.preventGhostClick.disable(b),a(b).off("touchstart touchend",e);var c=a(b).data("hammer");c&&c.off("tap doubletap panstart panmove panend pinchmove rotatemove",e)}var h,i,j,k,l,m,n,o,p=1,q=0,r=700,s=!1,t=5,u=!1;d.touchInput={enable:f,disable:g}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d={activate:function(c,d,e){a(c).off("CornerstoneToolsMouseDownActivate",b);var f={mouseButtonMask:d,options:e};a(c).on("CornerstoneToolsMouseDownActivate",f,b)},disable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},enable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return d}c.simpleMouseButtonTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(c){function e(e){var i=e.element,j=c.createNewMeasurement(e);if(j){var k={mouseButtonMask:e.which};d.addToolState(e.element,c.toolType,j),a(i).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(i).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(i).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&a(i).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),b.updateImage(i);var l;l=1===Object.keys(j.handles).length?d.moveHandle:d.moveNewHandle;var m;m=c.options&&void 0!==c.options.preventHandleOutsideImage?c.options.preventHandleOutsideImage:!1,l(e,c.toolType,j,j.handles.end,function(){j.active=!1,j.invalidated=!0,d.anyHandlesOutsideImage(e,j.handles)&&d.removeToolState(i,c.toolType,j),a(i).on("CornerstoneToolsMouseMove",k,c.mouseMoveCallback||g),a(i).on("CornerstoneToolsMouseDown",k,c.mouseDownCallback||h),a(i).on("CornerstoneToolsMouseDownActivate",k,c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&a(i).on("CornerstoneToolsMouseDoubleClick",k,c.mouseDoubleClickCallback),b.updateImage(i)},m)}}function f(a,b){return d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask)?(c.addNewMeasurement?c.addNewMeasurement(b):e(b),!1):void 0}function g(a,e){if(d.toolCoordinates.setCoords(e),0===e.which){var f=d.getToolState(e.element,c.toolType);if(f){for(var g=!1,h=0;h<f.data.length;h++){var i=e.currentPoints.canvas,j=f.data[h];d.handleActivator(e.element,j.handles,i)===!0&&(g=!0),(c.pointNearTool(e.element,j,i)&&!j.active||!c.pointNearTool(e.element,j,i)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(e.element)}}}function h(e,f){function h(){i.invalidated=!0,d.anyHandlesOutsideImage(f,i.handles)&&d.removeToolState(j,c.toolType,i),b.updateImage(j),a(j).on("CornerstoneToolsMouseMove",f,c.mouseMoveCallback||g)}var i,j=f.element;if(d.isMouseButtonEnabled(f.which,e.data.mouseButtonMask)){var k=f.startPoints.canvas,l=d.getToolState(e.currentTarget,c.toolType);if(l){var m,n;for(n=c.options&&void 0!==c.options.preventHandleOutsideImage?c.options.preventHandleOutsideImage:!1,m=0;m<l.data.length;m++){i=l.data[m];var o=6,p=d.getHandleNearImagePoint(j,i.handles,k,o);if(p)return a(j).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),i.active=!0,d.moveHandle(f,c.toolType,i,p,h,n),e.stopImmediatePropagation(),!1}if(c.pointNearTool){var q=c.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(m=0;m<l.data.length;m++)if(i=l.data[m],i.active=!1,c.pointNearTool(j,i,k))return i.active=!0,a(j).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),d.moveAllHandles(e,i,l,c.toolType,q,h),e.stopImmediatePropagation(),!1}}}}function i(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),b.updateImage(d)}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function k(d,e){var i={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",i,c.mouseMoveCallback||g),a(d).on("CornerstoneToolsMouseDown",i,c.mouseDownCallback||h),a(d).on("CornerstoneToolsMouseDownActivate",i,c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&(a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneToolsMouseDoubleClick",i,c.mouseDoubleClickCallback)),b.updateImage(d)}function l(d,e){var i={mouseButtonMask:e},j="CornerstoneToolsToolDeactivated",k={mouseButtonMask:e,toolType:c.toolType,type:j},l=a.Event(j,k);a(d).trigger(l,k),a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",i,c.mouseMoveCallback||g),a(d).on("CornerstoneToolsMouseDown",i,c.mouseDownCallback||h),c.mouseDoubleClickCallback&&(a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneToolsMouseDoubleClick",i,c.mouseDoubleClickCallback)),b.updateImage(d)}function m(){return o}function n(a){o=a}var o={},p={enable:j,disable:i,activate:k,deactivate:l,getConfiguration:m,setConfiguration:n,mouseDownCallback:h,mouseMoveCallback:g,mouseDownActivateCallback:f};return c.pointNearTool&&(p.pointNearTool=c.pointNearTool),c.mouseDoubleClickCallback&&(p.mouseDoubleClickCallback=c.mouseDoubleClickCallback),c.addNewMeasurement&&(p.addNewMeasurement=c.addNewMeasurement),p}d.mouseButtonTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(c,e){function f(b){var f=c.createNewMeasurement(b);f&&(d.addToolState(b.element,c.toolType,f),a(b.element).off("CornerstoneToolsMouseMove",h),d.moveHandle(b,c.toolType,f,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(b,f.handles)&&d.removeToolState(b.element,c.toolType,f),a(b.element).on("CornerstoneToolsMouseMove",h)},e))}function g(a,b){return d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask)?(f(b),!1):void 0}function h(a,e){if(d.toolCoordinates.setCoords(e),0===e.which){var f=d.getToolState(e.element,c.toolType);if(void 0!==f){for(var g=!1,h=e.currentPoints.canvas,i=0;i<f.data.length;i++){var j=f.data[i];d.handleActivator(e.element,j.handles,h)===!0&&(g=!0),(c.pointInsideRect(e.element,j,h)&&!j.active||!c.pointInsideRect(e.element,j,h)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(e.element)}}}function i(f,g){function i(){j.active=!1,d.anyHandlesOutsideImage(g,j.handles)&&d.removeToolState(g.element,c.toolType,j),b.updateImage(g.element),a(g.element).on("CornerstoneToolsMouseMove",h)}var j;if(d.isMouseButtonEnabled(g.which,f.data.mouseButtonMask)){var k,l=g.startPoints.canvas,m=d.getToolState(f.currentTarget,c.toolType),n=25;if(void 0!==m)for(k=0;k<m.data.length;k++){j=m.data[k];var o=d.getHandleNearImagePoint(g.element,j.handles,l,n);if(void 0!==o)return a(g.element).off("CornerstoneToolsMouseMove",h),j.active=!0,d.moveHandle(g,c.toolType,j,o,i,e),f.stopImmediatePropagation(),!1}var p={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:e};if(void 0!==m&&void 0!==c.pointInsideRect)for(k=0;k<m.data.length;k++)if(j=m.data[k],c.pointInsideRect(g.element,j,l))return a(g.element).off("CornerstoneToolsMouseMove",h),d.moveAllHandles(f,j,m,c.toolType,p,i),a(g.element).on("CornerstoneToolsMouseMove",h),f.stopImmediatePropagation(),!1}}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),b.updateImage(d)}function k(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function l(d,e){var f={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",f,h),a(d).on("CornerstoneToolsMouseDown",f,i),a(d).on("CornerstoneToolsMouseDownActivate",f,g),b.updateImage(d)}function m(d,e){var f={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",f,h),a(d).on("CornerstoneToolsMouseDown",f,i),b.updateImage(d)}var n={enable:k,disable:j,activate:l,deactivate:m};return n}d.mouseButtonRectangleTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsMouseWheel",b);var d={};a(c).on("CornerstoneToolsMouseWheel",d,b)},disable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},enable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseWheel",b)}};return c}c.mouseWheelTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){var d="CornerstoneToolsTouchDrag";c&&c.fireOnTouchStart===!0&&(d+=" CornerstoneToolsTouchStart");var e={activate:function(e){a(e).off(d,b),c&&c.eventData?a(e).on(d,c.eventData,b):a(e).on(d,b),c&&c.activateCallback&&c.activateCallback(e)},disable:function(e){a(e).off(d,b),c&&c.disableCallback&&c.disableCallback(e)},enable:function(e){a(e).off(d,b),c&&c.enableCallback&&c.enableCallback(e)},deactivate:function(e){a(e).off(d,b),c&&c.deactivateCallback&&c.deactivateCallback(e)}};return e}c.touchDragTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchPinch",b);var d={};a(c).on("CornerstoneToolsTouchPinch",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},enable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchPinch",b)}};return c}c.touchPinchTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){Object.keys(a).forEach(function(b){var c=a[b];c.active=!1})}function f(a){if(a)for(var b=0;b<a.data.length;b++){var c=a.data[b];c.active=!1,c.handles&&e(c.handles)}}function g(c){function e(e){var f=e.element,j=c.createNewMeasurement(e);if(j){if(d.addToolState(f,c.toolType,j),1===Object.keys(j.handles).length&&"CornerstoneToolsTap"===e.type)return j.active=!1,j.handles.end.active=!1,j.handles.end.highlight=!1,j.invalidated=!0,d.anyHandlesOutsideImage(e,j.handles)&&d.removeToolState(f,c.toolType,j),void b.updateImage(f);a(f).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(f).off("CornerstoneToolsTap",c.tapCallback||h),a(f).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),b.updateImage(f),d.moveNewHandleTouch(e,c.toolType,j,j.handles.end,function(){j.active=!1,j.invalidated=!0,d.anyHandlesOutsideImage(e,j.handles)&&d.removeToolState(f,c.toolType,j),a(f).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(f).on("CornerstoneToolsTap",c.tapCallback||h),a(f).on("CornerstoneToolsTouchStart",c.touchStartCallback||i),b.updateImage(f)})}}function g(a,b){return c.addNewMeasurement?c.addNewMeasurement(b):e(b),!1}function h(e,i){function j(){f(o),d.anyHandlesOutsideImage(i,k.handles)&&d.removeToolState(m,c.toolType,k),b.updateImage(m),a(m).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).on("CornerstoneToolsTap",c.tapCallback||h)}var k,l,m=i.element,n=i.currentPoints.canvas,o=d.getToolState(e.currentTarget,c.toolType);if(f(o),o)for(l=0;l<o.data.length;l++){k=o.data[l];var p=25,q=d.getHandleNearImagePoint(m,k.handles,n,p);if(q)return a(m).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).off("CornerstoneToolsTap",c.tapCallback||h),k.active=!0,q.active=!0,b.updateImage(m),d.touchMoveHandle(e,c.toolType,k,q,j),e.stopImmediatePropagation(),!1}if(o&&c.pointNearTool)for(l=0;l<o.data.length;l++)if(k=o.data[l],c.pointNearTool(m,k,n))return a(m).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).off("CornerstoneToolsTap",c.tapCallback||h),k.active=!0,b.updateImage(m),d.touchMoveAllHandles(e,k,o,c.toolType,!0,j),e.stopImmediatePropagation(),!1;return c.touchDownActivateCallback?c.touchDownActivateCallback(e,i):g(e,i),!1}function i(e,f){function i(e,i){if(j.active=!1,j.invalidated=!0,d.anyHandlesOutsideImage(f,j.handles)&&d.removeToolState(f.element,c.toolType,j),b.updateImage(f.element),a(l).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).on("CornerstoneToolsTap",c.tapCallback||h),c.pressCallback&&a(l).on("CornerstoneToolsTouchPress",c.pressCallback),e&&"CornerstoneToolsTouchPress"===e.type){var k=a.Event(e.type,i);a(l).trigger(k,i)}}var j,k,l=f.element,m=f.startPoints.canvas,n=d.getToolState(e.currentTarget,c.toolType),o=28;if(n){for(k=0;k<n.data.length;k++){j=n.data[k];var p=d.getHandleNearImagePoint(f.element,j.handles,m,o);if(p)return a(l).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).off("CornerstoneToolsTap",c.tapCallback||h),c.pressCallback&&a(l).off("CornerstoneToolsTouchPress",c.pressCallback),j.active=!0,d.touchMoveHandle(e,c.toolType,j,p,i),e.stopImmediatePropagation(),!1}if(c.pointNearTool)for(k=0;k<n.data.length;k++)if(j=n.data[k],c.pointNearTool(f.element,j,m))return a(l).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).off("CornerstoneToolsTap",c.tapCallback||h),c.pressCallback&&a(l).off("CornerstoneToolsTouchPress",c.pressCallback),d.touchMoveAllHandles(e,j,n,c.toolType,!0,i),e.stopImmediatePropagation(),!1}}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),c.doubleTapCallback&&a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),c.pressCallback&&a(d).off("CornerstoneToolsTouchPress",c.pressCallback),b.updateImage(d)}function k(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),c.doubleTapCallback&&a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),c.pressCallback&&a(d).off("CornerstoneToolsTouchPress",c.pressCallback),b.updateImage(d)}function l(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).on("CornerstoneToolsTap",c.tapCallback||h),c.doubleTapCallback&&(a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),a(d).on("CornerstoneToolsDoubleTap",c.doubleTapCallback)),c.pressCallback&&(a(d).off("CornerstoneToolsTouchPress",c.pressCallback),a(d).on("CornerstoneToolsTouchPress",c.pressCallback)),b.updateImage(d)}function m(d){var e="CornerstoneToolsToolDeactivated",f={toolType:c.toolType,type:e},j=a.Event(e,f);a(d).trigger(j,f),a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),c.doubleTapCallback&&a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),c.pressCallback&&a(d).off("CornerstoneToolsTouchPress",c.pressCallback),b.updateImage(d)}var n={enable:k,disable:j,activate:l,deactivate:m,touchStartCallback:c.touchStartCallback||i,touchDownActivateCallback:c.touchDownActivateCallback||g,tapCallback:c.tapCallback||h};return c.pointNearTool&&(n.pointNearTool=c.pointNearTool),c.doubleTapCallback&&(n.doubleTapCallback=c.doubleTapCallback),c.pressCallback&&(n.pressCallback=c.pressCallback),c.addNewMeasurement&&(n.addNewMeasurement=c.addNewMeasurement),n}d.touchTool=g}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},start2:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:a.currentPoints.image.x,y:a.currentPoints.image.y+20,highlight:!0,active:!1}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.end)},g=c.lineSegment.distanceToPoint(f,e);return 5>g?!0:(f.start=b.pixelToCanvas(a,d.handles.start2),f.end=b.pixelToCanvas(a,d.handles.end2),g=c.lineSegment.distanceToPoint(f,e),5>g)}function g(a,c){var e=d.getToolState(a.currentTarget,h);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=d.angle.getConfiguration(),l=0;l<e.data.length;l++){f.save(),k&&k.shadow&&(f.shadowColor=k.shadowColor||"#000000",f.shadowOffsetX=k.shadowOffsetX||1,f.shadowOffsetY=k.shadowOffsetY||1);var m=e.data[l];g=m.active?d.toolColors.getActiveColor():d.toolColors.getToolColor(),f.beginPath(),f.strokeStyle=g,f.lineWidth=i;var n=b.pixelToCanvas(c.element,m.handles.start),o=b.pixelToCanvas(c.element,m.handles.end);f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),n=b.pixelToCanvas(c.element,m.handles.start2),o=b.pixelToCanvas(c.element,m.handles.end2),f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),f.stroke(),d.drawHandles(f,c,m.handles),f.fillStyle=g;var p=(Math.ceil(m.handles.start.x)-Math.ceil(m.handles.end.x))*c.image.columnPixelSpacing,q=(Math.ceil(m.handles.start.y)-Math.ceil(m.handles.end.y))*c.image.rowPixelSpacing,r=(Math.ceil(m.handles.start2.x)-Math.ceil(m.handles.end2.x))*c.image.columnPixelSpacing,s=(Math.ceil(m.handles.start2.y)-Math.ceil(m.handles.end2.y))*c.image.rowPixelSpacing,t=Math.acos(Math.abs((p*r+q*s)/(Math.sqrt(p*p+q*q)*Math.sqrt(r*r+s*s))));t*=180/Math.PI;var u=d.roundToDecimal(t,2),v="00B0",w=u.toString()+String.fromCharCode(parseInt(v,16)),x=(n.x+o.x)/2,y=(n.y+o.y)/2;f.font=j,d.drawTextBox(f,w,x,y,g),f.restore()}}}var h="angle";d.angle=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d.angleTouch=d.touchTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){a(prompt("Enter your annotation:"))}function f(a,b,c){c(prompt("Change your annotation:"))}function g(c){function e(e){null!==e?f.text=e:d.removeToolState(c.element,n,f),f.active=!1,b.updateImage(c.element),a(c.element).on("CornerstoneToolsMouseMove",g,d.arrowAnnotate.mouseMoveCallback),a(c.element).on("CornerstoneToolsMouseDown",g,d.arrowAnnotate.mouseDownCallback),a(c.element).on("CornerstoneToolsMouseDownActivate",g,d.arrowAnnotate.mouseDownActivateCallback),a(c.element).on("CornerstoneToolsMouseDoubleClick",g,d.arrowAnnotate.mouseDoubleClickCallback)}var f=h(c),g={mouseButtonMask:c.which};d.addToolState(c.element,n,f),a(c.element).off("CornerstoneToolsMouseMove",d.arrowAnnotate.mouseMoveCallback),a(c.element).off("CornerstoneToolsMouseDown",d.arrowAnnotate.mouseDownCallback),a(c.element).off("CornerstoneToolsMouseDownActivate",d.arrowAnnotate.mouseDownActivateCallback),a(c.element).off("CornerstoneToolsMouseDoubleClick",d.arrowAnnotate.mouseDoubleClickCallback),b.updateImage(c.element),d.moveNewHandle(c,n,f,f.handles.end,function(){d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(c.element,n,f);var a=d.arrowAnnotate.getConfiguration();void 0===f.text&&a.getTextCallback(e),b.updateImage(c.element)})}function h(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,
highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};return b}function i(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.end)},g=c.lineSegment.distanceToPoint(f,e);return 25>g}function j(a,e){var f=d.getToolState(a.currentTarget,n);if(f){var g=e.enabledElement,h=e.canvasContext.canvas.getContext("2d");h.setTransform(1,0,0,1,0,0);for(var i,j=d.toolStyle.getToolWidth(),k=d.textStyle.getFont(),l=d.arrowAnnotate.getConfiguration(),m=0;m<f.data.length;m++){h.save(),l&&l.shadow&&(h.shadowColor=l.shadowColor||"#000000",h.shadowOffsetX=l.shadowOffsetX||1,h.shadowOffsetY=l.shadowOffsetY||1);var o=f.data[m];i=o.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var p=b.pixelToCanvas(e.element,o.handles.start),q=b.pixelToCanvas(e.element,o.handles.end);l.arrowFirst?d.drawArrow(h,q,p,i,j):d.drawArrow(h,p,q,i,j);var r={drawHandlesIfActive:l&&l.drawHandlesOnHover};if(l.drawHandles&&d.drawHandles(h,e,o.handles,i,r),o.text&&""!==o.text){h.font=k;var s=h.measureText(o.text).width+10,t=d.textStyle.getFontSize()+10,u=Math.max(s,t)/2+5;q.x<p.x&&(u=-u);var v;if(!o.handles.textBox.hasMoved){v=l.arrowFirst?{x:q.x-s/2+u,y:q.y-t/2}:{x:p.x-s/2-u,y:p.y-t/2};var w=b.internal.getTransform(g);w.invert();var x=w.transformPoint(v.x,v.y);o.handles.textBox.x=x.x,o.handles.textBox.y=x.y}v=b.pixelToCanvas(e.element,o.handles.textBox);var y=d.drawTextBox(h,o.text,v.x,v.y,i);if(o.handles.textBox.boundingBox=y,o.handles.textBox.hasMoved){var z={start:{},end:{}},A={x:(p.x+q.x)/2,y:(p.y+q.y)/2},B=[p,q,A];z.end.x=v.x,z.end.y=v.y,z.start=c.point.findClosestPoint(B,z.end);var C=[{x:y.left+y.width/2,y:y.top},{x:y.left,y:y.top+y.height/2},{x:y.left+y.width/2,y:y.top+y.height},{x:y.left+y.width,y:y.top+y.height/2}];z.end=c.point.findClosestPoint(C,z.start),h.beginPath(),h.strokeStyle=i,h.lineWidth=j,h.setLineDash([2,3]),h.moveTo(z.start.x,z.start.y),h.lineTo(z.end.x,z.end.y),h.stroke()}}h.restore()}}}function k(c){function e(c){null!==c?g.text=c:d.removeToolState(f,n,g),g.active=!1,b.updateImage(f),a(f).on("CornerstoneToolsTouchPress",d.arrowAnnotateTouch.pressCallback),a(f).on("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(f).on("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback)}var f=c.element,g=h(c);d.addToolState(f,n,g),a(f).off("CornerstoneToolsTouchPress",d.arrowAnnotateTouch.pressCallback),a(f).off("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(f).off("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback),b.updateImage(f),d.moveNewHandleTouch(c,n,g,g.handles.end,function(){b.updateImage(f),d.anyHandlesOutsideImage(c,g.handles)&&d.removeToolState(f,n,g);var a=d.arrowAnnotate.getConfiguration();void 0===g.text&&a.getTextCallback(e)})}function l(a,c){function e(a,c,e){e===!0?d.removeToolState(g,n,a):a.text=c,a.active=!1,b.updateImage(g)}var f,g=c.element;if(a.data&&a.data.mouseButtonMask&&!d.isMouseButtonEnabled(c.which,a.data.mouseButtonMask))return!1;var h=d.arrowAnnotate.getConfiguration(),j=c.currentPoints.canvas,k=d.getToolState(g,n);if(!k)return!1;for(var l=0;l<k.data.length;l++)if(f=k.data[l],i(g,f,j)||d.pointInsideBoundingBox(f.handles.textBox,j))return f.active=!0,b.updateImage(g),h.changeTextCallback(f,c,e),a.stopImmediatePropagation(),!1;return!1}function m(c,e){function f(c,e,f){console.log("pressCallback doneChangingTextCallback"),f===!0?d.removeToolState(h,n,c):c.text=e,c.active=!1,b.updateImage(h),a(h).on("CornerstoneToolsTouchStart",d.arrowAnnotateTouch.touchStartCallback),a(h).on("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(h).on("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback)}var g,h=e.element;if(c.data&&c.data.mouseButtonMask&&!d.isMouseButtonEnabled(e.which,c.data.mouseButtonMask))return!1;var j=d.arrowAnnotate.getConfiguration(),k=e.currentPoints.canvas,l=d.getToolState(h,n);if(!l)return!1;if(e.handlePressed)return a(h).off("CornerstoneToolsTouchStart",d.arrowAnnotateTouch.touchStartCallback),a(h).off("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(h).off("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback),j.changeTextCallback(e.handlePressed,e,f),c.stopImmediatePropagation(),!1;for(var m=0;m<l.data.length;m++)if(g=l.data[m],i(h,g,k)||d.pointInsideBoundingBox(g.handles.textBox,k))return g.active=!0,b.updateImage(h),a(h).off("CornerstoneToolsTouchStart",d.arrowAnnotateTouch.touchStartCallback),a(h).off("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(h).off("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback),j.changeTextCallback(g,e,f),c.stopImmediatePropagation(),!1;return!1}var n="arrowAnnotate",o={getTextCallback:e,changeTextCallback:f,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0};d.arrowAnnotate=d.mouseButtonTool({addNewMeasurement:g,createNewMeasurement:h,onImageRendered:j,pointNearTool:i,toolType:n,mouseDoubleClickCallback:l}),d.arrowAnnotate.setConfiguration(o),d.arrowAnnotateTouch=d.touchTool({addNewMeasurement:k,createNewMeasurement:h,onImageRendered:j,pointNearTool:i,toolType:n,pressCallback:m})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){d.stopImmediatePropagation();var f=c.getToolState(d.currentTarget,o);if(f){var g=d.currentTarget,h=b.getEnabledElement(g),i=h.image.imageId,j=c.metaData.get("imagePlane",i),k=e.currentPoints.image,l=c.imagePointToPatientPoint(k,j),m=f.data[0].synchronizationContext,n=m.getSourceElements();a.each(n,function(d,e){if(e!==g){var f=Number.MAX_VALUE,h=-1,i=c.getToolState(e,"stack");if(void 0!==i){var j=i.data[0];if(a.each(j.imageIds,function(a,b){var d=c.metaData.get("imagePlane",b),e=d.imagePositionPatient,g=d.rowCosines.clone(),i=d.columnCosines.clone(),j=i.clone().cross(g.clone()),k=Math.abs(j.clone().dot(e)-j.clone().dot(l));f>k&&(f=k,h=a)}),h!==j.currentImageIdIndex&&-1!==h&&void 0!==j.imageIds[h]){var k=c.loadHandlerManager.getStartLoadHandler(),m=c.loadHandlerManager.getEndLoadHandler(),n=c.loadHandlerManager.getErrorLoadingHandler();k&&k(e);var o;o=j.preventCache===!0?b.loadImage(j.imageIds[h]):b.loadAndCacheImage(j.imageIds[h]),o.then(function(a){var c=b.getViewport(e);j.currentImageIdIndex=h,b.displayImage(e,a,c),m&&m(e)},function(a){var b=j.imageIds[h];n&&n(e,b,a)})}}}})}}function e(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",e)}function f(b,f){return c.isMouseButtonEnabled(f.which,b.data.mouseButtonMask)?(a(f.element).on("CornerstoneToolsMouseDrag",g),a(f.element).on("CornerstoneToolsMouseUp",e),d(b,f),!1):void 0}function g(a,b){return d(a,b),!1}function h(b,d,e){var g={mouseButtonMask:d},h=c.getToolState(b,o);h=[],c.addToolState(b,o,{synchronizationContext:e}),a(b).off("CornerstoneToolsMouseDown",f),a(b).on("CornerstoneToolsMouseDown",g,f)}function i(b){a(b).off("CornerstoneToolsMouseDown",f)}function j(b,c){a(c.element).off("CornerstoneToolsTouchDrag",l),a(c.element).off("CornerstoneToolsDragEnd",j)}function k(b,c){return a(c.element).on("CornerstoneToolsTouchDrag",l),a(c.element).on("CornerstoneToolsDragEnd",j),d(b,c),!1}function l(a,b){return d(a,b),!1}function m(b,d){var e=c.getToolState(b,o);e=[],c.addToolState(b,o,{synchronizationContext:d}),a(b).off("CornerstoneToolsTouchStart",k),a(b).on("CornerstoneToolsTouchStart",k)}function n(b){a(b).off("CornerstoneToolsTouchStart",k)}var o="crosshairs";c.crosshairs={activate:h,deactivate:i,enable:h,disable:i},c.crosshairsTouch={activate:m,deactivate:n,enable:m,disable:n}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c){var d={},e={disable:function(b){a(b).off("CornerstoneImageRendered",c)},enable:function(d){a(d).off("CornerstoneImageRendered",c),a(d).on("CornerstoneImageRendered",c),b.updateImage(d)},getConfiguration:function(){return d},setConfiguration:function(a){d=a}};return e}c.displayTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsDoubleTap",b);var d={};a(c).on("CornerstoneToolsDoubleTap",d,b)},disable:function(c){a(c).off("CornerstoneToolsDoubleTap",b)},enable:function(c){a(c).off("CornerstoneToolsDoubleTap",b)},deactivate:function(c){a(c).off("CornerstoneToolsDoubleTap",b)}};return c}c.doubleTapTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){b.fitToWindow(a.element)}function e(a,b){return c.doubleTapZoom.strategy(b),!1}c.doubleTapZoom=c.doubleTapTool(e),c.doubleTapZoom.strategies={"default":d},c.doubleTapZoom.strategy=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a.element);b.updateImage(a.element);var e=d.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0);var f=c.toolColors.getActiveColor(),g=c.textStyle.getFont(),h=c.textStyle.getFontSize(),i=c.dragProbe.getConfiguration();e.save(),i&&i.shadow&&(e.shadowColor=i.shadowColor||"#000000",e.shadowOffsetX=i.shadowOffsetX||1,e.shadowOffsetY=i.shadowOffsetY||1);var j,k,l,m=Math.round(a.currentPoints.image.x),n=Math.round(a.currentPoints.image.y);if(!(0>m||0>n||m>=a.image.columns||n>=a.image.rows)){if(a.image.color)j=c.getRGBPixels(a.element,m,n,1,1),k=""+m+", "+n,l="R: "+j[0]+" G: "+j[1]+" B: "+j[2]+" A: "+j[3];else{j=b.getStoredPixels(a.element,m,n,1,1);var o=j[0],p=o*a.image.slope+a.image.intercept,q=c.calculateSUV(a.image,o);k=""+m+", "+n,l="SP: "+o+" MO: "+parseFloat(p.toFixed(3)),q&&(l+=" SUV: "+parseFloat(q.toFixed(3)))}var r={x:a.currentPoints.image.x+3,y:a.currentPoints.image.y-3},s=b.pixelToCanvas(a.element,r);e.font=g,e.fillStyle=f,c.drawTextBox(e,l,s.x,s.y+h+5,f),c.drawTextBox(e,k,s.x,s.y,f),e.restore()}}function e(a){var d=a.element,e=b.getEnabledElement(d),f=e.image;b.updateImage(d);var g=e.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);var h=c.toolColors.getActiveColor(),i=c.textStyle.getFont(),j=c.dragProbe.getConfiguration();g.save(),j&&j.shadow&&(g.shadowColor=j.shadowColor||"#000000",g.shadowOffsetX=j.shadowOffsetX||1,g.shadowOffsetY=j.shadowOffsetY||1);var k;k=a.isTouchEvent===!0?b.pageToPixel(d,a.currentPoints.page.x,a.currentPoints.page.y-4*c.textStyle.getFontSize()):b.pageToPixel(d,a.currentPoints.page.x,a.currentPoints.page.y-c.textStyle.getFontSize()/2);var l,m="";if(!(k.x<0||k.y<0||k.x>=f.columns||k.y>=f.rows)){if(f.color)l=c.getRGBPixels(d,k.x,k.y,1,1),m="R: "+l[0]+" G: "+l[1]+" B: "+l[2];else{l=b.getStoredPixels(d,k.x,k.y,1,1);var n,o=l[0],p=o*a.image.slope+a.image.intercept,q=c.calculateSUV(a.image,o),r="x00080060";a.image.data&&(n=a.image.data.string(r)),"CT"===n&&(m+="HU: "),m+=parseFloat(p.toFixed(2)),q&&(m+=" SUV: "+parseFloat(q.toFixed(2)))}var s=b.pixelToCanvas(d,k);g.font=i,g.fillStyle=h;var t,u=6,v=g.measureText(m).width;t=a.isTouchEvent===!0?{x:-v/2-5,y:-c.textStyle.getFontSize()-10-2*u}:{x:12,y:-(c.textStyle.getFontSize()+10)/2},g.beginPath(),g.strokeStyle=h,g.arc(s.x,s.y,u,0,2*Math.PI),g.stroke(),c.drawTextBox(g,m,s.x+t.x,s.y+t.y,h),g.restore()}}function f(c,d){a(d.element).off("CornerstoneToolsMouseDrag",h),a(d.element).off("CornerstoneToolsMouseUp",f),a(d.element).off("CornerstoneToolsMouseClick",f),b.updateImage(d.element)}function g(b,d){return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(a(d.element).on("CornerstoneToolsMouseDrag",h),a(d.element).on("CornerstoneToolsMouseUp",f),a(d.element).on("CornerstoneToolsMouseClick",f),c.dragProbe.strategy(d),!1):void 0}function h(a,b){return c.dragProbe.strategy(b),!1}c.dragProbe=c.simpleMouseButtonTool(g),c.dragProbe.strategies={"default":d,minimal:e},c.dragProbe.strategy=d;var i={fireOnTouchStart:!0};c.dragProbeTouch=c.touchDragTool(h,i)}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,invalidated:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};return b}function f(a,b){var c=a.width/2,d=a.height/2;if(0>=c||0>=d)return!1;var e={x:a.left+c,y:a.top+d},f={x:b.x-e.x,y:b.y-e.y},g=f.x*f.x/(c*c)+f.y*f.y/(d*d)<=1;return g}function g(a,b){for(var c=0,d=0,e=0,g=0,h=b.top;h<b.top+b.height;h++)for(var i=b.left;i<b.left+b.width;i++)f(b,{x:i,y:h})===!0&&(c+=a[g],d+=a[g]*a[g],e++),g++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var j=c/e,k=d/e-j*j;return{count:e,mean:j,variance:k,stdDev:Math.sqrt(k)}}function h(a,c,d,e){var g=b.pixelToCanvas(a,c.handles.start),h=b.pixelToCanvas(a,c.handles.end),i={left:Math.min(g.x,h.x)+e/2,top:Math.min(g.y,h.y)+e/2,width:Math.abs(g.x-h.x)-e,height:Math.abs(g.y-h.y)-e},j={left:Math.min(g.x,h.x)-e/2,top:Math.min(g.y,h.y)-e/2,width:Math.abs(g.x-h.x)+e,height:Math.abs(g.y-h.y)+e},k=f(i,d),l=f(j,d);return!(!l||k)}function i(a,b,c){return h(a,b,c,15)}function j(a,b,c){return h(a,b,c,25)}function k(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")}function l(a,e){var f=d.getToolState(a.currentTarget,m);if(f){var h=e.image,i=e.element,j=d.toolStyle.getToolWidth(),l=d.ellipticalRoi.getConfiguration(),n=e.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);var o,p="x00080060";h.data&&(o=h.data.string(p));for(var q=0;q<f.data.length;q++){n.save();var r=f.data[q];l&&l.shadow&&(n.shadowColor=l.shadowColor||"#000000",n.shadowOffsetX=l.shadowOffsetX||1,n.shadowOffsetY=l.shadowOffsetY||1);var s=d.toolColors.getColorIfActive(r.active),t=b.pixelToCanvas(i,r.handles.start),u=b.pixelToCanvas(i,r.handles.end),v=Math.min(t.x,u.x),w=Math.min(t.y,u.y),x=Math.abs(t.x-u.x),y=Math.abs(t.y-u.y);if(n.beginPath(),n.strokeStyle=s,n.lineWidth=j,d.drawEllipse(n,v,w,x,y),n.closePath(),l&&l.drawHandlesOnHover)if(r.active===!0)d.drawHandles(n,e,r.handles,s);else{var z={drawHandlesIfActive:!0};d.drawHandles(n,e,r.handles,s,z)}else d.drawHandles(n,e,r.handles,s);var A,B,C;if(r.invalidated){var D={left:Math.min(r.handles.start.x,r.handles.end.x),top:Math.min(r.handles.start.y,r.handles.end.y),width:Math.abs(r.handles.start.x-r.handles.end.x),height:Math.abs(r.handles.start.y-r.handles.end.y)};if(!h.color){var E=b.getPixels(i,D.left,D.top,D.width,D.height);B=g(E,D),"PT"===o&&(C={mean:d.calculateSUV(h,(B.mean-h.intercept)/h.slope),stdDev:d.calculateSUV(h,(B.stdDev-h.intercept)/h.slope)}),B&&!isNaN(B.mean)&&(r.meanStdDev=B,r.meanStdDevSUV=C)}var F=h.columnPixelSpacing||1,G=h.rowPixelSpacing||1;A=Math.PI*(D.width*F/2)*(D.height*G/2),isNaN(A)||(r.area=A),r.invalidated=!1}else B=r.meanStdDev,C=r.meanStdDevSUV,A=r.area;var H=[];if(B&&B.mean){var I="";"CT"===o&&(I=" HU");var J="Mean: "+k(B.mean.toFixed(2))+I,K="StdDev: "+k(B.stdDev.toFixed(2))+I;if(C&&void 0!==C.mean){var L=" SUV: ";J+=L+k(C.mean.toFixed(2)),K+=L+k(C.stdDev.toFixed(2))}H.push(J),H.push(K)}if(A){var M=" mm"+String.fromCharCode(178);h.rowPixelSpacing&&h.columnPixelSpacing||(M=" pixels"+String.fromCharCode(178));var N="Area: "+k(A.toFixed(2))+M;H.push(N)}r.handles.textBox.hasMoved||(r.handles.textBox.x=Math.max(r.handles.start.x,r.handles.end.x),r.handles.textBox.y=(r.handles.start.y+r.handles.end.y)/2);var O=b.pixelToCanvas(i,r.handles.textBox),P={centering:{x:!1,y:!0}},Q=d.drawTextBox(n,H,O.x,O.y,s,P);if(r.handles.textBox.boundingBox=Q,r.handles.textBox.hasMoved){var R={start:{},end:{x:O.x,y:O.y}},S=[{x:v+x/2,y:w},{x:v,y:w+y/2},{x:v+x/2,y:w+y},{x:v+x,y:w+y/2}];R.start=c.point.findClosestPoint(S,R.end);var T=[{x:Q.left+Q.width/2,y:Q.top},{x:Q.left,y:Q.top+Q.height/2},{x:Q.left+Q.width/2,y:Q.top+Q.height},{x:Q.left+Q.width,y:Q.top+Q.height/2}];R.end=c.point.findClosestPoint(T,R.start),n.beginPath(),n.strokeStyle=s,n.lineWidth=j,n.setLineDash([2,3]),n.moveTo(R.start.x,R.start.y),n.lineTo(R.end.x,R.end.y),n.stroke()}n.restore()}}}var m="ellipticalRoi";d.ellipticalRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:l,pointNearTool:i,toolType:m}),d.ellipticalRoiTouch=d.touchTool({createNewMeasurement:e,onImageRendered:l,pointNearTool:j,toolType:m})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var c=d.getToolState(a.element,t);if(void 0!==c){var e=d.freehand.getConfiguration(),f=c.data[e.currentTool],g={x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0,lines:[]};f.handles.length&&f.handles[e.currentHandle-1].lines.push(a.currentPoints.image),f.handles.push(g),e.currentHandle+=1,e.freehand=!1,b.updateImage(a.element)}}function f(a,e){var f=d.getToolState(a.element,t);if(void 0!==f){var g=f.data[e];if(void 0!==g.handles)for(var h=a.currentPoints.canvas,i=0;i<g.handles.length;i++){var j=b.pixelToCanvas(a.element,g.handles[i]);if(c.point.distance(j,h)<5)return i}}}function g(a){var b=d.getToolState(a.element,t);if(b)for(var c,e=0;e<b.data.length;e++)if(c=f(a,e),void 0!==c)return{handleNearby:c,toolIndex:e}}function h(c,e){a(e.element).off("CornerstoneToolsMouseUp",h);var f=d.getToolState(e.element,t);if(void 0!==f){var g=d.freehand.getConfiguration();e.event.shiftKey||(g.freehand=!1),b.updateImage(e.element)}}function i(a,c){var e=d.getToolState(c.element,t);if(e){var g=d.freehand.getConfiguration(),h=e.data[g.currentTool],i=Math.max(c.currentPoints.image.x,0);i=Math.min(i,c.image.width),g.mouseLocation.handles.start.x=i;var j=Math.max(c.currentPoints.image.y,0);j=Math.min(j,c.image.height),g.mouseLocation.handles.start.y=j;var k=g.currentHandle;if(g.modifying&&(h.active=!0,h.highlight=!0,h.handles[k].x=g.mouseLocation.handles.start.x,h.handles[k].y=g.mouseLocation.handles.start.y,k)){var l=h.handles[k-1].lines.length-1,m=h.handles[k-1].lines[l];m.x=g.mouseLocation.handles.start.x,m.y=g.mouseLocation.handles.start.y}if(g.freehand)h.handles[k-1].lines.push(c.currentPoints.image);else{var n=f(c,g.currentTool);void 0!==n&&n<h.handles.length-1&&(g.mouseLocation.handles.start.x=h.handles[n].x,g.mouseLocation.handles.start.y=h.handles[n].y)}b.updateImage(c.element)}}function j(b){a(b.element).on("CornerstoneToolsMouseMove",i),a(b.element).on("CornerstoneToolsMouseUp",h);var c={visible:!0,active:!0,handles:[]},e=d.freehand.getConfiguration();e.mouseLocation.handles.start.x=b.currentPoints.image.x,e.mouseLocation.handles.start.y=b.currentPoints.image.y,d.addToolState(b.element,t,c);var f=d.getToolState(b.element,t);e.currentTool=f.data.length-1}function k(c,e){var f=d.getToolState(c.element,t);if(f){var g=d.freehand.getConfiguration(),h=f.data[g.currentTool];h.active=!1,h.highlight=!1,void 0!==e&&h.handles[g.currentHandle-1].lines.push(h.handles[e]),g.modifying&&(g.modifying=!1),g.currentHandle=0,g.currentTool=-1,a(c.element).off("CornerstoneToolsMouseMove",i),b.updateImage(c.element)}}function l(b,c){if(d.isMouseButtonEnabled(c.which,b.data.mouseButtonMask)){var l,m,n=d.getToolState(c.element,t),o=d.freehand.getConfiguration(),p=o.currentTool;if(o.modifying)return void k(c);if(0>p){var q=g(c);q?(l=q.handleNearby,m=q.toolIndex,void 0!==l&&(a(c.element).on("CornerstoneToolsMouseMove",i),a(c.element).on("CornerstoneToolsMouseUp",h),o.modifying=!0,o.currentHandle=l,o.currentTool=m)):(j(c),e(c))}else p>=0&&n.data[p].active&&(l=f(c,p),void 0!==l?k(c,l):c.event.shiftKey?o.freehand=!0:e(c));return!1}}function m(a,c){var e=d.getToolState(a.currentTarget,t);if(void 0!==e){var f=d.freehand.getConfiguration(),g=c.canvasContext.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.toolColors.getFillColor(),k=0;k<e.data.length;k++){g.save();var l=e.data[k];l.active?(h=d.toolColors.getActiveColor(),j=d.toolColors.getFillColor()):(h=d.toolColors.getToolColor(),j=d.toolColors.getToolColor());var m;if(l.handles.length)for(var n=0;n<l.handles.length;n++){m=l.handles[n];var o=b.pixelToCanvas(c.element,m);g.beginPath(),g.strokeStyle=h,g.lineWidth=i,g.moveTo(o.x,o.y);for(var p=0;p<l.handles[n].lines.length;p++){var q=b.pixelToCanvas(c.element,l.handles[n].lines[p]);g.lineTo(q.x,q.y),g.stroke()}var r=b.pixelToCanvas(c.element,f.mouseLocation.handles.start);n===l.handles.length-1&&(!l.active||f.freehand||f.modifying||(g.lineTo(r.x,r.y),g.stroke()))}var s={fill:j};l.active&&d.drawHandles(g,c,f.mouseLocation.handles,h,s),d.drawHandles(g,c,l.handles,h,s),g.restore()}}}function n(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function o(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),b.updateImage(c)}function p(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneToolsMouseDown",e,l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),a(c).on("CornerstoneToolsMouseDown",e,l),b.updateImage(c)}function q(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function r(){return u}function s(a){u=a}var t="freehand",u={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1};d.freehand={enable:n,disable:o,activate:p,deactivate:q,getConfiguration:r,setConfiguration:s}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b=d.getToolState(a.event.currentTarget,i);if(!(b&&b.data&&b.data.length>0)){var c={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return c}}function f(a,c,d){var e=b.pixelToCanvas(a,c.handles.start),f=b.pixelToCanvas(a,c.handles.end),g={left:Math.min(e.x,f.x),top:Math.min(e.y,f.y),width:Math.abs(e.x-f.x),height:Math.abs(e.y-f.y)},h=!1;return d.x>=g.left&&d.x<=g.left+g.width&&d.y>=g.top&&d.y<=g.top+g.height&&(h=!0),h}function g(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return 5>i}function h(a,c){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);var g,h=d.toolStyle.getToolWidth();f.save();var j=e.data[0];if(j){g=j.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var k=b.pixelToCanvas(c.element,j.handles.start),l=b.pixelToCanvas(c.element,j.handles.end),m={left:Math.min(k.x,l.x),top:Math.min(k.y,l.y),width:Math.abs(k.x-l.x),height:Math.abs(k.y-l.y)};f.beginPath(),f.strokeStyle="transparent",f.rect(0,0,f.canvas.clientWidth,f.canvas.clientHeight),f.rect(m.width+m.left,m.top,-m.width,m.height),f.stroke(),f.fillStyle="rgba(0,0,0,0.7)",f.fill(),f.closePath(),f.beginPath(),f.strokeStyle=g,f.lineWidth=h,f.setLineDash([4]),f.strokeRect(m.left,m.top,m.width,m.height),f.setLineDash([]),d.drawHandles(f,c,j.handles,g),f.restore()}}}var i="highlight",j=!0;d.highlight=d.mouseButtonRectangleTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:g,pointInsideRect:f,toolType:i},j),d.highlightTouch=d.touchTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:g,pointInsideRect:f,toolType:i},j)}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d={activate:function(c){a(c).off("CornerstoneToolsKeyDown",b),a(c).on("CornerstoneToolsKeyDown",b)},disable:function(c){a(c).off("CornerstoneToolsKeyDown",b)},enable:function(c){a(c).off("CornerstoneToolsKeyDown",b)},deactivate:function(c){a(c).off("CornerstoneToolsKeyDown",b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return d}c.keyboardTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.end)},g=c.lineSegment.distanceToPoint(f,e);return 25>g}function g(a,e){var f=d.getToolState(a.currentTarget,h);if(f){var g=e.canvasContext.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);for(var i=d.toolStyle.getToolWidth(),j=d.length.getConfiguration(),k=0;k<f.data.length;k++){g.save(),j&&j.shadow&&(g.shadowColor=j.shadowColor||"#000000",g.shadowOffsetX=j.shadowOffsetX||1,g.shadowOffsetY=j.shadowOffsetY||1);var l=f.data[k],m=d.toolColors.getColorIfActive(l.active),n=b.pixelToCanvas(e.element,l.handles.start),o=b.pixelToCanvas(e.element,l.handles.end);g.beginPath(),g.strokeStyle=m,g.lineWidth=i,g.moveTo(n.x,n.y),g.lineTo(o.x,o.y),g.stroke();var p={drawHandlesIfActive:j&&j.drawHandlesOnHover};d.drawHandles(g,e,l.handles,m,p),g.fillStyle=m;var q=(l.handles.end.x-l.handles.start.x)*(e.image.columnPixelSpacing||1),r=(l.handles.end.y-l.handles.start.y)*(e.image.rowPixelSpacing||1),s=Math.sqrt(q*q+r*r);l.length=s;var t=" mm";e.image.rowPixelSpacing&&e.image.columnPixelSpacing||(t=" pixels");var u=""+s.toFixed(2)+t;if(!l.handles.textBox.hasMoved){var v={x:Math.max(l.handles.start.x,l.handles.end.x)};v.x===l.handles.start.x?v.y=l.handles.start.y:v.y=l.handles.end.y,l.handles.textBox.x=v.x,l.handles.textBox.y=v.y}var w=b.pixelToCanvas(e.element,l.handles.textBox);w.x+=10;var x={centering:{x:!1,y:!0}},y=d.drawTextBox(g,u,w.x,w.y,m,x);if(l.handles.textBox.boundingBox=y,l.handles.textBox.hasMoved){var z={start:{},end:{}},A={x:(n.x+o.x)/2,y:(n.y+o.y)/2},B=[n,o,A];z.end.x=w.x,z.end.y=w.y,z.start=c.point.findClosestPoint(B,z.end);var C=[{x:y.left+y.width/2,y:y.top},{x:y.left,y:y.top+y.height/2},{x:y.left+y.width/2,y:y.top+y.height},{x:y.left+y.width,y:y.top+y.height/2}];z.end=c.point.findClosestPoint(C,z.start),g.beginPath(),g.strokeStyle=m,g.lineWidth=i,g.setLineDash([2,3]),g.moveTo(z.start.x,z.start.y),g.lineTo(z.end.x,z.end.y),g.stroke()}g.restore()}}}var h="length";d.length=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d.lengthTouch=d.touchTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",h),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d),e(c)}function e(b){a(b.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function f(b,e){return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",e,h),a(e.element).on("CornerstoneToolsMouseUp",e,d),a(e.element).on("CornerstoneToolsMouseClick",e,d),i(e),!1):void 0}function g(b,c){a(c.element).off("CornerstoneToolsDragEnd",g),a(c.element).off("CornerstoneToolsTouchEnd",g),e(c)}function h(b,c){return i(c),c.isTouchEvent===!0&&(a(c.element).on("CornerstoneToolsDragEnd",g),a(c.element).on("CornerstoneToolsTouchEnd",g)),!1}function i(d){var e=a(d.element).find(".magnifyTool").get(0);e||j(d.element);var f=c.magnify.getConfiguration(),g=f.magnifySize,h=f.magnificationLevel,i=a(d.element).find("canvas").not(".magnifyTool").get(0),k=i.getContext("2d");k.setTransform(1,0,0,1,0,0);var l=e.getContext("2d");l.setTransform(1,0,0,1,0,0);var m=g/h,n=b.pixelToCanvas(d.element,d.currentPoints.image);d.isTouchEvent===!0&&(n.y-=1.25*m),n.x=Math.max(n.x,0),n.x=Math.min(n.x,i.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,i.height),l.clearRect(0,0,g,g),l.fillStyle="transparent",l.fillRect(0,0,g,g);var o={x:n.x-.5*m,y:n.y-.5*m};"Safari"===q&&(o.x=Math.max(o.x,0),o.y=Math.max(o.y,0)),o.x=Math.min(o.x,i.width),o.y=Math.min(o.y,i.height);var p={x:(i.width-o.x)*h,y:(i.height-o.y)*h};l.drawImage(i,o.x,o.y,i.width-o.x,i.height-o.y,0,0,p.x,p.y),e.style.top=n.y-.5*g+"px",e.style.left=n.x-.5*g+"px",e.style.display="block",document.body.style.cursor="none"}function j(b){if(0===a(b).find(".magnifyTool").length){var d=document.createElement("canvas");d.classList.add("magnifyTool");var e=c.magnify.getConfiguration();d.width=e.magnifySize,d.height=e.magnifySize,d.style.position="absolute",b.appendChild(d)}}function k(b){a(b).find(".magnifyTool").remove()}function l(b){a(b).off("CornerstoneToolsMouseDown",f),k(b)}function m(a){var b=c.magnify.getConfiguration(b);if(!q){var d=c.getBrowserInfo(),e=d.split(" ");q=e[0]}j(a)}function n(b,c){var d={mouseButtonMask:c};a(b).off("CornerstoneToolsMouseDown",f),a(b).on("CornerstoneToolsMouseDown",d,f),j(b)}function o(){return r}function p(a){r=a}var q,r={magnifySize:100,magnificationLevel:2};c.magnify={enable:m,activate:n,deactivate:l,disable:l,getConfiguration:o,setConfiguration:p};var s={fireOnTouchStart:!0,activateCallback:j,disableCallback:k};c.magnifyTouchDrag=c.touchDragTool(h,s)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){var d={},e="CornerstoneToolsMultiTouchDrag";c&&c.fireOnTouchStart===!0&&(e+=" CornerstoneToolsMultiTouchStart");var f={activate:function(d){a(d).off(e,b),c&&c.eventData?a(d).on(e,c.eventData,b):a(d).on(e,b),c&&c.activateCallback&&c.activateCallback(d)},disable:function(d){a(d).off(e,b),c&&c.disableCallback&&c.disableCallback(d)},enable:function(d){a(d).off(e,b),c&&c.enableCallback&&c.enableCallback(d)},deactivate:function(d){a(d).off(e,b),c&&c.deactivateCallback&&c.deactivateCallback(d)},getConfiguration:function(){return d},setConfiguration:function(a){d=a}};return f}c.multiTouchDragTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a),e=c.metaData.get("imagePlane",d.image.imageId);if(e&&e.rowCosines&&e.columnCosines){var f=c.orientation.getOrientationString(e.rowCosines),g=c.orientation.getOrientationString(e.columnCosines),h=c.orientation.invertOrientationString(f),i=c.orientation.invertOrientationString(g);return{top:i,bottom:g,left:h,right:f}}}function e(a){var c,d=b.getEnabledElement(a);c={x:d.image.width/2,y:5};var e=b.pixelToCanvas(a,c);c={x:d.image.width/2,y:d.image.height-5};var f=b.pixelToCanvas(a,c);c={x:5,y:d.image.height/2};var g=b.pixelToCanvas(a,c);c={x:d.image.width-10,y:d.image.height/2};var h=b.pixelToCanvas(a,c);return{top:e,bottom:f,left:g,right:h}}function f(a,b){var f=b.element,g=d(f);if(g){var h=e(f,g),i=b.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);var j=c.toolColors.getToolColor(),k={top:i.measureText(g.top).width,left:i.measureText(g.left).width,right:i.measureText(g.right).width,bottom:i.measureText(g.bottom).width};c.drawTextBox(i,g.top,h.top.x-k.top/2,h.top.y,j),c.drawTextBox(i,g.left,h.left.x-k.left/2,h.left.y,j);var l=c.orientationMarkers.getConfiguration();l&&l.drawAllMarkers&&(c.drawTextBox(i,g.right,h.right.x-k.right/2,h.right.y,j),c.drawTextBox(i,g.bottom,h.bottom.x-k.bottom/2,h.bottom.y,j))}}c.orientationMarkers=c.displayTool(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",f),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),!1):void 0}function f(a,c){return c.viewport.translation.x+=c.deltaPoints.page.x/c.viewport.scale,c.viewport.translation.y+=c.deltaPoints.page.y/c.viewport.scale,
b.setViewport(c.element,c.viewport),!1}c.pan=c.simpleMouseButtonTool(e),c.panTouchDrag=c.touchDragTool(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d){var e=c.panMultiTouch.getConfiguration();return e&&e.testPointers(d)?(d.viewport.translation.x+=d.deltaPoints.page.x/d.viewport.scale,d.viewport.translation.y+=d.deltaPoints.page.y/d.viewport.scale,b.setViewport(d.element,d.viewport),!1):void 0}var e={testPointers:function(a){return a.numPointers>=2}};c.panMultiTouch=c.multiTouchDragTool(d),c.panMultiTouch.setConfiguration(e)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b={visible:!0,active:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function e(a,c,d){var e=b.pixelToCanvas(a,c.handles.end);return cornerstoneMath.point.distance(e,d)<5}function f(a,d){var e=c.getToolState(a.currentTarget,g);if(e){var f=d.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=c.textStyle.getFont(),j=c.textStyle.getFontSize(),k=0;k<e.data.length;k++){f.save();var l=e.data[k];h=l.active?c.toolColors.getActiveColor():c.toolColors.getToolColor(),c.drawHandles(f,d,l.handles,h);var m,n,o,p=Math.round(l.handles.end.x),q=Math.round(l.handles.end.y);if(0>p||0>q||p>=d.image.columns||q>=d.image.rows)return;if(d.image.color)n=""+p+", "+q,m=c.getRGBPixels(d.element,p,q,1,1),o="R: "+m[0]+" G: "+m[1]+" B: "+m[2];else{m=b.getStoredPixels(d.element,p,q,1,1);var r=m[0],s=r*d.image.slope+d.image.intercept,t=c.calculateSUV(d.image,r);n=""+p+", "+q,o="SP: "+r+" MO: "+parseFloat(s.toFixed(3)),t&&(o+=" SUV: "+parseFloat(t.toFixed(3)))}var u={x:l.handles.end.x+3,y:l.handles.end.y-3},v=b.pixelToCanvas(d.element,u);f.font=i,f.fillStyle=h,c.drawTextBox(f,o,v.x,v.y+j+5,h),c.drawTextBox(f,n,v.x,v.y,h),f.restore()}}}var g="probe";c.probe=c.mouseButtonTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:g}),c.probeTouch=c.touchTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:g})}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return 5>i}function g(a,b){for(var c=0,d=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)c+=a[f],d+=a[f]*a[f],e++,f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var i=c/e,j=d/e-i*i;return{count:e,mean:i,variance:j,stdDev:Math.sqrt(j)}}function h(a,c){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,j=d.toolStyle.getToolWidth(),k=d.textStyle.getFont(),l=d.textStyle.getFontSize(),m=d.rectangleRoi.getConfiguration(),n=0;n<e.data.length;n++){f.save();var o=e.data[n];m&&m.shadow&&(f.shadowColor=m.shadowColor||"#000000",f.shadowOffsetX=m.shadowOffsetX||1,f.shadowOffsetY=m.shadowOffsetY||1),h=o.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var p=b.pixelToCanvas(c.element,o.handles.start),q=b.pixelToCanvas(c.element,o.handles.end),r=Math.abs(p.x-q.x),s=Math.abs(p.y-q.y),t=Math.min(p.x,q.x),u=Math.min(p.y,q.y),v=(p.x+q.x)/2,w=(p.y+q.y)/2;f.beginPath(),f.strokeStyle=h,f.lineWidth=j,f.rect(t,u,r,s),f.stroke(),d.drawHandles(f,c,o.handles,h);var x=Math.abs(o.handles.start.x-o.handles.end.x),y=Math.abs(o.handles.start.y-o.handles.end.y),z=Math.min(o.handles.start.x,o.handles.end.x),A=Math.min(o.handles.start.y,o.handles.end.y),B=b.getPixels(c.element,z,A,x,y),C={left:z,top:A,width:x,height:y},D=g(B,C),E=x*c.image.columnPixelSpacing*(y*c.image.rowPixelSpacing),F="Area: "+E.toFixed(2)+" mm^2";f.font=k;var G=f.measureText(E),H=v<c.image.columns/2?v+r/2:v-r/2-G.width,I=w<c.image.rows/2?w+s/2:w-s/2;f.fillStyle=h,d.drawTextBox(f,"Mean: "+D.mean.toFixed(2),H,I-l-5,h),d.drawTextBox(f,"StdDev: "+D.stdDev.toFixed(2),H,I,h),d.drawTextBox(f,F,H,I+l+5,h),f.restore()}}}var i="rectangleRoi";d.rectangleRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i}),d.rectangleRoiTouch=d.touchTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a){var c=a.element.getBoundingClientRect(a.element),d={x:a.currentPoints.client.x,y:a.currentPoints.client.y},e=a.element.clientWidth,f=a.element.clientHeight,g={x:d.x-c.left-e/2,y:-1*(d.y-c.top-f/2)},h=Math.atan2(g.y,g.x),i=h*(180/Math.PI),j=-1*i+90;a.viewport.rotation=j,b.setViewport(a.element,a.viewport)}function e(a){a.viewport.rotation+=a.deltaPoints.page.x/a.viewport.scale,b.setViewport(a.element,a.viewport)}function f(a){a.viewport.rotation+=a.deltaPoints.page.y/a.viewport.scale,b.setViewport(a.element,a.viewport)}function g(b,c){a(c.element).off("CornerstoneToolsMouseDrag",i),a(c.element).off("CornerstoneToolsMouseUp",g),a(c.element).off("CornerstoneToolsMouseClick",g)}function h(b,d){return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(a(d.element).on("CornerstoneToolsMouseDrag",i),a(d.element).on("CornerstoneToolsMouseUp",g),a(d.element).on("CornerstoneToolsMouseClick",g),!1):void 0}function i(a,d){return c.rotate.strategy(d),b.setViewport(d.element,d.viewport),!1}c.rotate=c.simpleMouseButtonTool(h),c.rotate.strategies={"default":d,horizontal:e,vertical:f},c.rotate.strategy=d,c.rotateTouchDrag=c.touchDragTool(i)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c){return c.viewport.rotation+=c.rotation,b.setViewport(c.element,c.viewport),!1}function e(b){a(b).off("CornerstoneToolsTouchRotate",d)}function f(b){a(b).off("CornerstoneToolsTouchRotate",d),a(b).on("CornerstoneToolsTouchRotate",d)}c.rotateTouch={activate:f,disable:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){var d=a(b).find("canvas").get(0),e=document.createElement("a");if(e.download=c,e.href=d.toDataURL(),document.createEvent){var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(f)}else e.fireEvent&&e.fireEvent("onclick")}c.saveAs=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},middle:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.middle)},g=c.lineSegment.distanceToPoint(f,e);return 25>g?!0:(f.start=b.pixelToCanvas(a,d.handles.middle),f.end=b.pixelToCanvas(a,d.handles.end),g=c.lineSegment.distanceToPoint(f,e),25>g)}function g(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))}function h(a,e){var f=d.getToolState(a.currentTarget,k);if(f){var h=e.enabledElement,i=e.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);for(var j,l=d.toolStyle.getToolWidth(),m=d.textStyle.getFont(),n=d.simpleAngle.getConfiguration(),o=0;o<f.data.length;o++){i.save(),n&&n.shadow&&(i.shadowColor=n.shadowColor||"#000000",i.shadowOffsetX=n.shadowOffsetX||1,i.shadowOffsetY=n.shadowOffsetY||1);var p=f.data[o];j=p.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var q=b.pixelToCanvas(e.element,p.handles.start),r=b.pixelToCanvas(e.element,p.handles.middle),s=b.pixelToCanvas(e.element,p.handles.end);i.beginPath(),i.strokeStyle=j,i.lineWidth=l,i.moveTo(q.x,q.y),i.lineTo(r.x,r.y),i.lineTo(s.x,s.y),i.stroke();var t={drawHandlesIfActive:n&&n.drawHandlesOnHover};d.drawHandles(i,e,p.handles,j,t),i.fillStyle=j;var u=e.image.columnPixelSpacing||1,v=e.image.rowPixelSpacing||1,w="";e.image.rowPixelSpacing&&e.image.columnPixelSpacing||(w=" (isotropic)");var x={x:(Math.ceil(p.handles.middle.x)-Math.ceil(p.handles.start.x))*u,y:(Math.ceil(p.handles.middle.y)-Math.ceil(p.handles.start.y))*v},y={x:(Math.ceil(p.handles.end.x)-Math.ceil(p.handles.middle.x))*u,y:(Math.ceil(p.handles.end.y)-Math.ceil(p.handles.middle.y))*v},z={x:(Math.ceil(p.handles.end.x)-Math.ceil(p.handles.start.x))*u,y:(Math.ceil(p.handles.end.y)-Math.ceil(p.handles.start.y))*v},A=g(x),B=g(y),C=g(z),D=Math.acos((Math.pow(A,2)+Math.pow(B,2)-Math.pow(C,2))/(2*A*B));D*=180/Math.PI;var E=d.roundToDecimal(D,2);if(E){var F,G="00B0",H=E.toString()+String.fromCharCode(parseInt(G,16))+w,I=15;if(p.handles.textBox.hasMoved)F=b.pixelToCanvas(e.element,p.handles.textBox);else{F={x:r.x,y:r.y},i.font=m;var J=i.measureText(H).width;r.x<q.x?F.x-=I+J+10:F.x+=I;var K=b.internal.getTransform(h);K.invert();var L=K.transformPoint(F.x,F.y);p.handles.textBox.x=L.x,p.handles.textBox.y=L.y}var M={centering:{x:!1,y:!0}},N=d.drawTextBox(i,H,F.x,F.y,j,M);if(p.handles.textBox.boundingBox=N,p.handles.textBox.hasMoved){var O={start:{},end:{}},P=[q,s,r];O.end.x=F.x,O.end.y=F.y,O.start=c.point.findClosestPoint(P,O.end);var Q=[{x:N.left+N.width/2,y:N.top},{x:N.left,y:N.top+N.height/2},{x:N.left+N.width/2,y:N.top+N.height},{x:N.left+N.width,y:N.top+N.height/2}];O.end=c.point.findClosestPoint(Q,O.start),i.beginPath(),i.strokeStyle=j,i.lineWidth=l,i.setLineDash([2,3]),i.moveTo(O.start.x,O.start.y),i.lineTo(O.end.x,O.end.y),i.stroke()}}i.restore()}}}function i(c){var f=e(c),g=c.element,h={mouseButtonMask:c.which};d.addToolState(g,k,f),a(g).off("CornerstoneToolsMouseMove",d.simpleAngle.mouseMoveCallback),a(g).off("CornerstoneToolsMouseDrag",d.simpleAngle.mouseMoveCallback),a(g).off("CornerstoneToolsMouseDown",d.simpleAngle.mouseDownCallback),a(g).off("CornerstoneToolsMouseDownActivate",d.simpleAngle.mouseDownActivateCallback),b.updateImage(g),d.moveNewHandle(c,k,f,f.handles.middle,function(){return f.active=!1,d.anyHandlesOutsideImage(c,f.handles)?(d.removeToolState(g,k,f),a(g).on("CornerstoneToolsMouseMove",d.simpleAngle.mouseMoveCallback),a(g).on("CornerstoneToolsMouseDrag",d.simpleAngle.mouseMoveCallback),a(g).on("CornerstoneToolsMouseDown",h,d.simpleAngle.mouseDownCallback),a(g).on("CornerstoneToolsMouseDownActivate",h,d.simpleAngle.mouseDownActivateCallback),void b.updateImage(g)):(f.handles.end.active=!0,b.updateImage(g),void d.moveNewHandle(c,k,f,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),a(g).on("CornerstoneToolsMouseMove",d.simpleAngle.mouseMoveCallback),a(g).on("CornerstoneToolsMouseDrag",d.simpleAngle.mouseMoveCallback),a(g).on("CornerstoneToolsMouseDown",h,d.simpleAngle.mouseDownCallback),a(g).on("CornerstoneToolsMouseDownActivate",h,d.simpleAngle.mouseDownActivateCallback),b.updateImage(g)}))})}function j(c){var f=e(c),g=c.element;d.addToolState(g,k,f),a(g).off("CornerstoneToolsTouchDrag",d.simpleAngleTouch.touchMoveCallback),a(g).off("CornerstoneToolsTouchStartActive",d.simpleAngleTouch.touchDownActivateCallback),a(g).off("CornerstoneToolsTouchStart",d.simpleAngleTouch.touchStartCallback),a(g).off("CornerstoneToolsTap",d.simpleAngleTouch.tapCallback),b.updateImage(g),d.moveNewHandleTouch(c,k,f,f.handles.middle,function(){return d.anyHandlesOutsideImage(c,f.handles)?(d.removeToolState(g,k,f),a(g).on("CornerstoneToolsTouchDrag",d.simpleAngleTouch.touchMoveCallback),a(g).on("CornerstoneToolsTouchStart",d.simpleAngleTouch.touchStartCallback),a(g).on("CornerstoneToolsTouchStartActive",d.simpleAngleTouch.touchDownActivateCallback),a(g).on("CornerstoneToolsTap",d.simpleAngleTouch.tapCallback),void b.updateImage(g)):void d.moveNewHandleTouch(c,k,f,f.handles.end,function(){d.anyHandlesOutsideImage(c,f.handles)&&(d.removeToolState(g,k,f),b.updateImage(g)),a(g).on("CornerstoneToolsTouchDrag",d.simpleAngleTouch.touchMoveCallback),a(g).on("CornerstoneToolsTouchStart",d.simpleAngleTouch.touchStartCallback),a(g).on("CornerstoneToolsTouchStartActive",d.simpleAngleTouch.touchDownActivateCallback),a(g).on("CornerstoneToolsTap",d.simpleAngleTouch.tapCallback)})})}var k="simpleAngle";d.simpleAngle=d.mouseButtonTool({createNewMeasurement:e,addNewMeasurement:i,onImageRendered:h,pointNearTool:f,toolType:k}),d.simpleAngleTouch=d.touchTool({createNewMeasurement:e,addNewMeasurement:j,onImageRendered:h,pointNearTool:f,toolType:k})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b=c.textMarker.getConfiguration();if(b.current){var d={visible:!0,active:!0,text:b.current,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},e={left:0,top:0,width:a.image.width,height:a.image.height};if(cornerstoneMath.point.insideRect(d.handles.end,e)){var f=b.markers.indexOf(b.current);return b.ascending?(f+=1,f>=b.markers.length&&(b.loop?f-=b.markers.length:f=-1)):(f-=1,0>f&&(b.loop?f+=b.markers.length:f=-1)),b.current=b.markers[f],d}}}function e(a,b,d){if(b.handles.end.boundingBox){var e=cornerstoneMath.rect.distanceToPoint(b.handles.end.boundingBox,d),f=c.pointInsideBoundingBox(b.handles.end,d);return 10>e||f}}function f(a,d){var e=c.getToolState(d.element,i);if(e){var f=d.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g=c.textMarker.getConfiguration(),h=0;h<e.data.length;h++){var j=e.data[h],k=c.toolColors.getToolColor();j.active&&(k=c.toolColors.getActiveColor()),f.save(),g&&g.shadow&&(f.shadowColor=g.shadowColor||"#000000",f.shadowOffsetX=g.shadowOffsetX||1,f.shadowOffsetY=g.shadowOffsetY||1),f.fillStyle=k;var l=f.measureText(j.text);j.textWidth=l.width+10;var m=b.pixelToCanvas(d.element,j.handles.end),n={centering:{x:!0,y:!0}},o=c.drawTextBox(f,j.text,m.x,m.y-10,k,n);j.handles.end.boundingBox=o,f.restore()}}}function g(d,f){function g(e,f,g){g===!0?c.removeToolState(j,i,e):e.text=f,e.active=!1,b.updateImage(j);var h={mouseButtonMask:d.data.mouseButtonMask};a(j).on("CornerstoneToolsMouseMove",h,c.textMarker.mouseMoveCallback),a(j).on("CornerstoneToolsMouseDown",h,c.textMarker.mouseDownCallback),a(j).on("CornerstoneToolsMouseDownActivate",h,c.textMarker.mouseDownActivateCallback),a(j).on("CornerstoneToolsMouseDoubleClick",h,c.textMarker.mouseDoubleClickCallback)}var h,j=f.element;if(d.data&&d.data.mouseButtonMask&&!c.isMouseButtonEnabled(f.which,d.data.mouseButtonMask))return!1;var k=c.textMarker.getConfiguration(),l=f.currentPoints.canvas,m=c.getToolState(j,i);if(!m)return!1;for(var n=0;n<m.data.length;n++)if(h=m.data[n],e(j,h,l))return h.active=!0,b.updateImage(j),a(j).off("CornerstoneToolsMouseMove",c.textMarker.mouseMoveCallback),a(j).off("CornerstoneToolsMouseDown",c.textMarker.mouseDownCallback),a(j).off("CornerstoneToolsMouseDownActivate",c.textMarker.mouseDownActivateCallback),a(j).off("CornerstoneToolsMouseDoubleClick",c.textMarker.mouseDoubleClickCallback),k.changeTextCallback(h,f,g),d.stopImmediatePropagation(),!1;return!1}function h(d,f){function g(d,e,f){f===!0?c.removeToolState(j,i,d):d.text=e,d.active=!1,b.updateImage(j),a(j).on("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).on("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).on("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).on("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).on("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback)}var h,j=f.element,k=c.textMarker.getConfiguration(),l=f.currentPoints.canvas,m=c.getToolState(j,i);if(!m)return!1;if(f.handlePressed)return f.handlePressed.active=!0,b.updateImage(j),a(j).off("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).off("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).off("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).off("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).off("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback),k.changeTextCallback(f.handlePressed,f,g),d.stopImmediatePropagation(),!1;for(var n=0;n<m.data.length;n++)if(h=m.data[n],e(j,h,l))return h.active=!0,b.updateImage(j),a(j).off("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).off("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).off("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).off("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).off("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback),k.changeTextCallback(h,f,g),d.stopImmediatePropagation(),!1;return!1}var i="textMarker";c.textMarker=c.mouseButtonTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:i,mouseDoubleClickCallback:g}),c.textMarkerTouch=c.touchTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:i,pressCallback:h})}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",g),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),!1):void 0}function f(a){var b=a.image.maxPixelValue*a.image.slope+a.image.intercept,c=a.image.minPixelValue*a.image.slope+a.image.intercept,d=b-c,e=d/1024,f=a.deltaPoints.page.x*e,g=a.deltaPoints.page.y*e;a.viewport.voi.windowWidth+=f,a.viewport.voi.windowCenter+=g}function g(a,d){return c.wwwc.strategy(d),b.setViewport(d.element,d.viewport),!1}function h(a,d){a.stopImmediatePropagation();var e=d,f=e.image.maxPixelValue*e.image.slope+e.image.intercept,g=e.image.minPixelValue*e.image.slope+e.image.intercept,h=f-g,i=h/1024,j=e.deltaPoints.page.x*i,k=e.deltaPoints.page.y*i,l=c.wwwc.getConfiguration();l.orientation?0===l.orientation?(e.viewport.voi.windowWidth+=j,e.viewport.voi.windowCenter+=k):(e.viewport.voi.windowWidth+=k,e.viewport.voi.windowCenter+=j):(e.viewport.voi.windowWidth+=j,e.viewport.voi.windowCenter+=k),b.setViewport(e.element,e.viewport)}c.wwwc=c.simpleMouseButtonTool(e),c.wwwc.strategies={"default":f},c.wwwc.strategy=f,c.wwwcTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,b,c){var d=a.length;if(2>d)return{min:b,max:c,mean:(b+c)/2};for(var e=c,f=b,g=0,h=0;d>h;h++){var i=a[h];e=Math.min(e,i),f=Math.max(f,i),g+=i}return{min:e,max:f,mean:g/d}}function f(b,c){a(c.element).off("CornerstoneToolsMouseMove",k),a(c.element).off("CornerstoneToolsMouseDrag",k),a(c.element).off("CornerstoneToolsMouseUp",f),a(c.element).off("CornerstoneToolsMouseClick",f);var e=d.getToolState(c.element,s);if(e&&e.data.length){var h={x:c.currentPoints.image.x,y:c.currentPoints.image.y};e.data[0].endPoint=h,g(c);var j={mouseButtonMask:c.which};a(c.element).on("CornerstoneToolsMouseDown",j,i)}}function g(a){var c=d.getToolState(a.element,s);if(c&&c.data.length){var f=c.data[0].startPoint,g=c.data[0].endPoint,h=Math.abs(f.x-g.x),i=Math.abs(f.y-g.y),j=Math.min(f.x,g.x),k=Math.min(f.y,g.y);j=Math.max(j,0),j=Math.min(j,a.image.width),k=Math.max(k,0),k=Math.min(k,a.image.height),h=Math.floor(Math.min(h,Math.abs(a.image.width-j))),i=Math.floor(Math.min(i,Math.abs(a.image.height-k)));var l=d.getLuminance(a.element,j,k,h,i),m=e(l,a.image.minPixelValue,a.image.maxPixelValue),n=d.wwwcRegion.getConfiguration(),o=b.getViewport(a.element);void 0===n.minWindowWidth&&(n.minWindowWidth=10),o.voi.windowWidth=Math.max(Math.abs(m.max-m.min),n.minWindowWidth),o.voi.windowCenter=m.mean,b.setViewport(a.element,o),c.data=[],b.updateImage(a.element)}}function h(b,c){var d=c.element;a(d).off("CornerstoneToolsMouseMove"),a(d).off("CornerstoneToolsMouseDrag"),a(d).on("CornerstoneToolsMouseMove",k),a(d).on("CornerstoneToolsMouseDrag",k),a(d).on("CornerstoneToolsMouseClick",f),"CornerstoneToolsMouseDrag"===b.type&&a(d).on("CornerstoneToolsMouseUp",f)}function i(b,c){return d.isMouseButtonEnabled(c.which,b.data.mouseButtonMask)?(a(c.element).on("CornerstoneToolsMouseDrag",c,h),a(c.element).on("CornerstoneToolsMouseMove",c,h),a(c.element).on("CornerstoneToolsMouseUp",f),a(c.element).off("CornerstoneToolsMouseDown"),j(c),!1):void 0}function j(a){var b=d.getToolState(a.element,s);b&&b.data&&(b.data=[]);var c={startPoint:{x:a.currentPoints.image.x,y:a.currentPoints.image.y}};d.addToolState(a.element,s,c)}function k(a,c){var e=d.getToolState(c.element,s);if(void 0!==e&&e.data.length){var f={x:c.currentPoints.image.x,y:c.currentPoints.image.y};e.data[0].endPoint=f,b.updateImage(c.element)}}function l(c,e){var f=d.getToolState(e.element,s);if(f&&f.data.length){var g=f.data[0].startPoint,h=f.data[0].endPoint;if(g&&h){var i=a(e.element).find("canvas").get(0),j=i.getContext("2d");j.setTransform(1,0,0,1,0,0);var k=d.toolColors.getActiveColor(),l=b.pixelToCanvas(e.element,g),m=b.pixelToCanvas(e.element,h),n=Math.min(l.x,m.x),o=Math.min(l.y,m.y),p=Math.abs(l.x-m.x),q=Math.abs(l.y-m.y),r=d.toolStyle.getToolWidth(),t=d.wwwcRegion.getConfiguration();j.save(),t&&t.shadow&&(j.shadowColor=t.shadowColor||"#000000",j.shadowOffsetX=t.shadowOffsetX||1,j.shadowOffsetY=t.shadowOffsetY||1),j.beginPath(),j.strokeStyle=k,j.lineWidth=r,j.rect(n,o,p,q),j.stroke(),j.restore()}}}function m(c){a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneImageRendered",l),b.updateImage(c)}function n(c,e){var g={mouseButtonMask:e},h=d.getToolState(c,s);if(!h){var j=[];d.addToolState(c,s,j)}a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseUp",f),a(c).off("CornerstoneToolsMouseDrag",k),a(c).off("CornerstoneImageRendered",l),a(c).on("CornerstoneToolsMouseDown",g,i),a(c).on("CornerstoneImageRendered",l),b.updateImage(c)}function o(b){a(b).off("CornerstoneToolsTouchDrag",k),a(b).off("CornerstoneToolsTouchStart",j),a(b).off("CornerstoneToolsDragEnd",g),a(b).off("CornerstoneImageRendered",l)}function p(b){var c=d.getToolState(b,s);if(void 0===c){var e=[];d.addToolState(b,s,e)}a(b).off("CornerstoneToolsTouchDrag",k),a(b).off("CornerstoneToolsTouchStart",j),a(b).off("CornerstoneToolsDragEnd",g),a(b).off("CornerstoneImageRendered",l),a(b).on("CornerstoneToolsTouchDrag",k),a(b).on("CornerstoneToolsTouchStart",j),a(b).on("CornerstoneToolsDragEnd",g),a(b).on("CornerstoneImageRendered",l)}function q(){return t}function r(a){t=a}var s="wwwcRegion",t={minWindowWidth:10};d.wwwcRegion={activate:n,deactivate:m,disable:m,setConfiguration:r,getConfiguration:q},d.wwwcRegionTouch={activate:p,deactivate:o,disable:o}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var d=c.zoom.getConfiguration(),e=1.7,f=Math.log(a.scale)/Math.log(e),g=f+b,h=Math.pow(e,g);return d.maxScale&&h>d.maxScale?a.scale=d.maxScale:d.minScale&&h<d.minScale?a.scale=d.minScale:a.scale=h,a}function e(a,b,c){return a.x=Math.max(a.x,0),a.y=Math.max(a.y,0),a.x=Math.min(a.x,b),a.y=Math.min(a.y,c),a}function f(a,b){if(0!==b.rotation){var c=b.rotation*Math.PI/180,d=Math.cos(c),e=Math.sin(c),f=a.x*d-a.y*e,g=a.x*e+a.y*d;a.x=f,a.y=g}return b.hflip&&(a.x*=-1),b.vflip&&(a.y*=-1),a}function g(a,c){var e=a.element,g=d(a.viewport,c);b.setViewport(e,g);var h=b.pageToPixel(e,a.startPoints.page.x,a.startPoints.page.y),i={x:a.startPoints.image.x-h.x,y:a.startPoints.image.y-h.y};i=f(i,g),g.translation.x-=i.x,g.translation.y-=i.y,b.setViewport(e,g)}function h(a,g){var h=a.element,i=a.image,j=d(a.viewport,g);b.setViewport(h,j);var k,l,m=c.zoom.getConfiguration(),o=8,p=8,q=3,r=.01;if(0>g){if(k={x:j.scale<q?j.translation.x/o:0,y:j.scale<q?j.translation.y/o:0},Math.abs(j.translation.x)<r)j.translation.x=0,k.x=0;else if(Math.abs(j.translation.y)<r)j.translation.y=0,k.y=0;else if(Math.abs(j.translation.x)<r&&Math.abs(j.translation.y)<r)return b.setViewport(h,j),!1}else{l=b.pageToPixel(h,n.page.x,n.page.y),m&&m.preventZoomOutsideImage&&(n.image=e(n.image,i.width,i.height),l=e(l,i.width,i.height));var s={x:i.width/2-n.image.x,y:i.height/2-n.image.y},t={x:j.translation.x-s.x,y:j.translation.y-s.y};if(k={x:t.x/p,y:t.y/p},Math.abs(t.x)<r)j.translation.x=s.x,k.x=0;else if(Math.abs(t.y)<r)j.translation.y=s.y,k.y=0;else if(Math.abs(t.x)<r&&Math.abs(t.y)<r)return b.setViewport(h,j),!1}return k=f(k,j),k.x||k.y?(j.translation.x-=k.x,j.translation.y-=k.y,void b.setViewport(h,j)):!1}function i(b,c){a(c.element).off("CornerstoneToolsMouseDrag",k),a(c.element).off("CornerstoneToolsMouseUp",i),a(c.element).off("CornerstoneToolsMouseClick",i)}function j(b,d){return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(n=d.startPoints,a(d.element).on("CornerstoneToolsMouseDrag",k),a(d.element).on("CornerstoneToolsMouseUp",i),a(d.element).on("CornerstoneToolsMouseClick",i),!1):void 0}function k(a,b){if(!b.deltaPoints.page.y)return!1;var d=b.deltaPoints.page.y/100;return c.zoom.strategy(b,d),!1}function l(a,e){var f=-e.direction/4,g=c.zoom.getConfiguration();g&&g.invert&&(f*=-1);var h=d(e.viewport,f);b.setViewport(e.element,h)}function m(a,d){var e=c.zoom.getConfiguration(),g=d.viewport,h=d.element;g.scale+=d.scaleChange*g.scale,e.maxScale&&g.scale>e.maxScale?g.scale=e.maxScale:e.minScale&&g.scale<e.minScale&&(g.scale=e.minScale),b.setViewport(h,g);var i=b.pageToPixel(h,d.startPoints.page.x,d.startPoints.page.y),j={x:d.startPoints.image.x-i.x,y:d.startPoints.image.y-i.y};j=f(j,g),g.translation.x-=j.x,g.translation.y-=j.y,b.setViewport(h,g)}var n;c.zoom=c.simpleMouseButtonTool(j),c.zoom.strategies={"default":g,translate:h},c.zoom.strategy=g,c.zoomWheel=c.mouseWheelTool(l),c.zoomTouchPinch=c.touchPinchTool(m),c.zoomTouchDrag=c.touchDragTool(k)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c){var d=c.currentTarget,e={event:window.event||c,element:d,viewport:b.getViewport(d),image:b.getEnabledElement(d).image,currentPoints:{page:{x:h,y:i},image:b.pageToPixel(d,h,i)},keyCode:c.keyCode,which:c.which};e.currentPoints.canvas=b.pixelToCanvas(d,e.currentPoints.image);var f={keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"};a(d).trigger(f[c.type],e)}function e(a){h=a.pageX||a.originalEvent.pageX,i=a.pageY||a.originalEvent.pageY}function f(b){g(b),a(b).on(j,d),a(b).on("mousemove",e)}function g(b){a(b).off(j,d),a(b).off("mousemove",e)}var h,i,j="keydown keypress keyup";c.keyboardInput={enable:f,disable:g}}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(a,b){var c=Date.now();if(a!==g){if(i>=c-h)return b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation(),!1;g=a}h=c}function c(a,b,c){var d=c?k:l;b.forEach(function(b){a.addEventListener(b,d,!0)})}function d(a,b,c){var d=c?k:l;b.forEach(function(b){a.removeEventListener(b,d,!0)})}function e(a){d(a,m,j.mouse),d(a,n,j.touch)}function f(a){e(a),c(a,m,j.mouse),c(a,n,j.touch)}var g,h,i=2e3,j={mouse:0,touch:1},k=b.bind(null,j.mouse),l=b.bind(null,j.touch),m=["mousedown","mouseup"],n=["touchstart","touchend"];a.preventGhostClick={enable:f,disable:e}}(cornerstoneTools),function(a,b,c,d){"use strict";function e(a,b){var d=a.image,e={left:0,top:0,width:d.width,height:d.height},f=!1;return Object.keys(b).forEach(function(a){var d=b[a];d.allowedOutsideImage!==!0&&c.point.insideRect(d,e)===!1&&(f=!0)}),f}d.anyHandlesOutsideImage=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b){"use strict";function c(c,e,f,g,h){c.strokeStyle=g,Object.keys(f).forEach(function(g){var i=f[g];if(i.drawnIndependently!==!0&&(!h||h.drawHandlesIfActive!==!0||i.active)){c.beginPath(),i.active?c.lineWidth=b.toolStyle.getActiveWidth():c.lineWidth=b.toolStyle.getToolWidth();var j=a.pixelToCanvas(e.element,i);c.arc(j.x,j.y,d,0,2*Math.PI),h&&h.fill&&(c.fillStyle=h.fill,c.fill()),c.stroke()}})}var d=6;b.drawHandles=c}(cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,e,f,g){var h;if(e)return Object.keys(e).forEach(function(i){var j=e[i];if(j.hasOwnProperty("pointNearHandle")){if(j.pointNearHandle(a,j,f))return void(h=j)}else if(j.hasBoundingBox===!0){if(d.pointInsideBoundingBox(j,f))return void(h=j)}else{var k=b.pixelToCanvas(a,j),l=c.point.distance(k,f);if(g>=l)return void(h=j)}}),h}d.getHandleNearImagePoint=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b;return Object.keys(a).forEach(function(c){var d=a[c];return d.active===!0?void(b=d):void 0}),b}function f(a,b,c,f){f||(f=6);var g=e(b),h=d.getHandleNearImagePoint(a,b,c,f);return g!==h?(void 0!==h&&(h.active=!0),void 0!==g&&(g.active=!1),!0):!1}d.handleActivator=f}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(c,e,f,g,h,i){function j(c,d){e.active=!0,Object.keys(e.handles).forEach(function(a){var b=e.handles[a];b.movesIndependently!==!0&&(b.x+=d.deltaPoints.image.x,b.y+=d.deltaPoints.image.y,h.preventHandleOutsideImage===!0&&(b.x=Math.max(b.x,0),b.x=Math.min(b.x,d.image.width),b.y=Math.max(b.y,0),b.y=Math.min(b.y,d.image.height)))}),b.updateImage(l);var f="CornerstoneToolsMeasurementModified",i={toolType:g,element:l,measurementData:e};return a(l).trigger(f,i),!1}function k(c,f){e.invalidated=!0,a(l).off("CornerstoneToolsMouseDrag",j),a(l).off("CornerstoneToolsMouseUp",k),a(l).off("CornerstoneToolsMouseClick",k),h.deleteIfHandleOutsideImage===!0&&d.anyHandlesOutsideImage(f,e.handles)&&d.removeToolState(l,g,e),b.updateImage(l),"function"==typeof i&&i()}var l=c.element;return a(l).on("CornerstoneToolsMouseDrag",j),a(l).on("CornerstoneToolsMouseUp",k),a(l).on("CornerstoneToolsMouseClick",k),!0}d.moveAllHandles=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.hasMoved===!1&&(f.hasMoved=!0),f.active=!0,f.x=g.currentPoints.image.x+l.x,f.y=g.currentPoints.image.y+l.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(k);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:k,measurementData:e};a(k).trigger(i,j)}function j(){f.active=!1,a(k).off("CornerstoneToolsMouseDrag",i),a(k).off("CornerstoneToolsMouseUp",j),a(k).off("CornerstoneToolsMouseClick",j),b.updateImage(k),"function"==typeof g&&g()}var k=c.element,l={x:f.x-c.currentPoints.image.x,y:f.y-c.currentPoints.image.y};a(k).on("CornerstoneToolsMouseDrag",i),a(k).on("CornerstoneToolsMouseUp",j),a(k).on("CornerstoneToolsMouseClick",j)}c.moveHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.active=!0,f.x=g.currentPoints.image.x,f.y=g.currentPoints.image.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(n);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:n,measurementData:e};a(n).trigger(i,j)}function j(b){a(n).off("CornerstoneToolsMouseMove"),a(n).off("CornerstoneToolsMouseDrag"),a(n).on("CornerstoneToolsMouseMove",i),a(n).on("CornerstoneToolsMouseDrag",i),a(n).on("CornerstoneToolsMouseClick",m),"CornerstoneToolsMouseDrag"===b.type&&a(n).on("CornerstoneToolsMouseUp",m)}function k(a,b){b.measurementData===e&&m()}function l(c,e){e.toolType===d&&(a(n).off("CornerstoneToolsMouseMove",i),a(n).off("CornerstoneToolsMouseDrag",i),a(n).off("CornerstoneToolsMouseClick",m),a(n).off("CornerstoneToolsMouseUp",m),a(n).off("CornerstoneToolsMeasurementRemoved",k),a(n).off("CornerstoneToolsToolDeactivated",l),f.active=!1,b.updateImage(n))}function m(){a(n).off("CornerstoneToolsMouseMove",i),a(n).off("CornerstoneToolsMouseDrag",i),a(n).off("CornerstoneToolsMouseClick",m),a(n).off("CornerstoneToolsMouseUp",m),a(n).off("CornerstoneToolsMeasurementRemoved",k),a(n).off("CornerstoneToolsToolDeactivated",l),f.active=!1,b.updateImage(n),
"function"==typeof g&&g()}var n=c.element;a(n).on("CornerstoneToolsMouseDrag",j),a(n).on("CornerstoneToolsMouseMove",j),a(n).on("CornerstoneToolsMeasurementRemoved",k),a(n).on("CornerstoneToolsToolDeactivated",l)}c.moveNewHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.x=g.currentPoints.image.x+o.x,f.y=g.currentPoints.image.y+o.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(m);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:m,measurementData:e};a(m).trigger(i,j)}function j(c,d){return a(m).off("CornerstoneToolsTouchDrag",i),a(m).off("CornerstoneToolsTouchPinch",j),a(m).off("CornerstoneToolsTouchEnd",j),a(m).off("CornerstoneToolsTap",j),a(m).off("CornerstoneToolsTouchStart",k),a(m).off("CornerstoneToolsToolDeactivated",l),"CornerstoneToolsTouchPinch"===c.type||"CornerstoneToolsTouchPress"===c.type?(f.active=!1,b.updateImage(m),void g()):(f.active=!1,e.active=!1,f.x=d.currentPoints.image.x+o.x,f.y=d.currentPoints.image.y+o.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,d.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,d.image.height)),b.updateImage(m),void("function"==typeof g&&g()))}function k(a){return a.stopImmediatePropagation(),!1}function l(){a(m).off("CornerstoneToolsTouchDrag",i),a(m).off("CornerstoneToolsTouchPinch",j),a(m).off("CornerstoneToolsTouchEnd",j),a(m).off("CornerstoneToolsTap",j),a(m).off("CornerstoneToolsTouchStart",k),a(m).off("CornerstoneToolsToolDeactivated",l),f.active=!1,e.active=!1,f.x=c.currentPoints.image.x+o.x,f.y=c.currentPoints.image.y+o.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,c.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,c.image.height)),b.updateImage(m)}var m=c.element,n=b.pageToPixel(m,c.currentPoints.page.x,c.currentPoints.page.y+50),o={x:f.x-n.x,y:f.y-n.y};f.active=!0,e.active=!0,a(m).on("CornerstoneToolsTouchDrag",i),a(m).on("CornerstoneToolsTouchPinch",j),a(m).on("CornerstoneToolsTouchEnd",j),a(m).on("CornerstoneToolsTap",j),a(m).on("CornerstoneToolsTouchStart",k),a(m).on("CornerstoneToolsToolDeactivated",l)}c.moveNewHandleTouch=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(c,e,f,g,h,i){function j(c,d){e.active=!0,Object.keys(e.handles).forEach(function(a){var b=e.handles[a];b.movesIndependently!==!0&&(b.x+=d.deltaPoints.image.x,b.y+=d.deltaPoints.image.y)}),b.updateImage(l);var f="CornerstoneToolsMeasurementModified",h={toolType:g,element:l,measurementData:e};return a(l).trigger(f,h),!1}function k(c,f){e.active=!1,e.invalidated=!1,a(l).off("CornerstoneToolsTouchDrag",j),a(l).off("CornerstoneToolsTouchPinch",k),a(l).off("CornerstoneToolsTouchPress",k),a(l).off("CornerstoneToolsTouchEnd",k),a(l).off("CornerstoneToolsDragEnd",k),a(l).off("CornerstoneToolsTap",k),h===!0&&d.anyHandlesOutsideImage(f,e.handles)&&d.toolState.removeToolState(l,g,e),b.updateImage(l),"function"==typeof i&&i(c,f)}var l=c.element;return a(l).on("CornerstoneToolsTouchDrag",j),a(l).on("CornerstoneToolsTouchPinch",k),a(l).on("CornerstoneToolsTouchPress",k),a(l).on("CornerstoneToolsTouchEnd",k),a(l).on("CornerstoneToolsDragEnd",k),a(l).on("CornerstoneToolsTap",k),!0}d.touchMoveAllHandles=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a,e,f,g,h){if(f.value){var i=(new Date).getTime(),j=Math.abs(e.y-h.y),k=j/10;if(console.log("distanceRemaining: "+j),1>j)return e.y=h.y,void(f.value=!1);e.y>h.y?e.y-=k:e.y<h.y&&(e.y+=k),b.updateImage(g.element),c.requestAnimFrame(function(){d(i,e,f,g,h)})}}function e(c,e,h,i,j){function k(c,d){console.log("touchMoveHandle touchDragCallback: "+c.type),f.value=!1,i.hasMoved===!1&&(i.hasMoved=!0),i.active=!0;var g=d.currentPoints,j={x:g.page.x,y:g.page.y+p};r=b.pageToPixel(m,j.x,j.y),i.x=r.x,i.y=r.y,b.updateImage(m);var k="CornerstoneToolsMeasurementModified",l={toolType:e,element:m,measurementData:h};a(m).trigger(k,l)}function l(d,e){console.log("touchMoveHandle touchEndCallback: "+d.type),f.value=!1,i.active=!1,a(m).off("CornerstoneToolsTouchDrag",k),a(m).off(g,l),b.updateImage(m),"CornerstoneToolsTouchPress"===d.type&&(e.handlePressed=h,i.x=c.currentPoints.image.x,i.y=c.currentPoints.image.y),"function"==typeof j&&j(d,e)}f.value=!0;var m=c.element,n=b.getEnabledElement(m),o=(new Date).getTime(),p=-57,q={x:c.currentPoints.page.x,y:c.currentPoints.page.y+p},r=b.pageToPixel(m,q.x,q.y);a(m).on("CornerstoneToolsTouchDrag",k),a(m).on(g,l),d(o,i,f,n,r)}var f={value:!1},g=["CornerstoneToolsTouchEnd","CornerstoneToolsDragEnd","CornerstoneToolsTouchPinch","CornerstoneToolsTouchPress","CornerstoneToolsTap"].join(" ");c.touchMoveHandle=e}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){var b=this;b.samples=[],this.set=function(c){b.samples=c,a(b).trigger("CornerstoneLineSampleUpdated")}}b.LineSampleMeasurement=c}($,cornerstoneTools),function(a,b){"use strict";function c(){var b=this;b.measurements=[],this.add=function(c){var d=b.measurements.push(c),e={index:d,measurement:c};a(b).trigger("CornerstoneMeasurementAdded",e)},this.remove=function(c){var d=b.measurements[c];b.measurements.splice(c,1);var e={index:c,measurement:d};a(b).trigger("CornerstoneMeasurementRemoved",e)}}b.MeasurementManager=new c}($,cornerstoneTools),function(a,b,c){"use strict";function d(a){g.push(a)}function e(a){var b=g.indexOf(a);-1!==b&&g.splice(b,1)}function f(b,c){var d;return a.each(g,function(a,e){return d=e(b,c),void 0!==d?!0:void 0}),d}var g=[];c.metaData={addProvider:d,removeProvider:e,get:f}}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b){for(var c="",d=b.x<0?"R":"L",e=b.y<0?"A":"P",f=b.z<0?"F":"H",g=new a.Vector3(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z)),h=0;3>h;h++)if(g.x>1e-4&&g.x>g.y&&g.x>g.z)c+=d,g.x=0;else if(g.y>1e-4&&g.y>g.x&&g.y>g.z)c+=e,g.y=0;else{if(!(g.z>1e-4&&g.z>g.x&&g.z>g.y))break;c+=f,g.z=0}return c}b.orientation.getOrientationString=c}(cornerstoneMath,cornerstoneTools),function(a){"use strict";function b(a){var b=a.replace("H","f");return b=b.replace("F","h"),b=b.replace("R","l"),b=b.replace("L","r"),b=b.replace("A","p"),b=b.replace("P","a"),b=b.toUpperCase()}a.orientation.invertOrientationString=b}(cornerstoneTools),function(a){"use strict";function b(b,c){var d=a.planePlaneIntersection(b,c);if(d)return{start:a.projectPatientPointToImagePlane(d.start,b),end:a.projectPatientPointToImagePlane(d.end,b)}}a.referenceLines.calculateReferenceLine=b}(cornerstoneTools),function(a,b,c){"use strict";function d(d,e){var f=c.getToolState(d.currentTarget,g);if(void 0!==f){var h=f.data[0].synchronizationContext,i=h.getSourceElements(),j=f.data[0].renderer,k=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,k),a.each(i,function(a,b){b!==d.currentTarget&&j(k,e,d.currentTarget,b)})}}function e(e,f,h){h=h||c.referenceLines.renderActiveReferenceLine,c.addToolState(e,g,{synchronizationContext:f,renderer:h}),a(e).on("CornerstoneImageRendered",d),b.updateImage(e)}function f(c){a(c).off("CornerstoneImageRendered",d),b.updateImage(c)}var g="referenceLines";c.referenceLines.tool={enable:e,disable:f}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f){var g=b.getEnabledElement(e).image,h=b.getEnabledElement(f).image;if(g&&h){var i=c.metaData.get("imagePlane",g.imageId),j=c.metaData.get("imagePlane",h.imageId);if(i&&j&&i.frameOfReferenceUID===j.frameOfReferenceUID){var k=i.rowCosines.clone().cross(i.columnCosines),l=j.rowCosines.clone().cross(j.columnCosines),m=k.angleTo(l);if(m=Math.abs(m),!(.5>m)){var n=c.referenceLines.calculateReferenceLine(i,j);if(n){var o=b.pixelToCanvas(d.element,n.start),p=b.pixelToCanvas(d.element,n.end),q=c.toolColors.getActiveColor(),r=c.toolStyle.getToolWidth();a.setTransform(1,0,0,1,0,0),a.save(),a.beginPath(),a.strokeStyle=q,a.lineWidth=r,a.moveTo(o.x,o.y),a.lineTo(p.x,p.y),a.stroke(),a.restore()}}}}}c.referenceLines.renderActiveReferenceLine=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){function c(b,c,f,g,h,i){if(!e.hasOwnProperty(f))throw"Request type must be one of interaction, thumbnail, or prefetch";if(b&&c){var j={type:f,imageId:c,preventCache:g,doneCallback:h,failCallback:i},k=a.imageCache.getImagePromise(c);if(k)return void k.then(function(a){h(a)},function(a){i(a)});e[f].push(j),"interaction"===f&&(d=b)}}function j(a){if(!e.hasOwnProperty(a))throw"Request type must be one of interaction, thumbnail, or prefetch";e[a]=[]}function k(){h&&setTimeout(function(){var a=n();a&&l(a)},i)}function l(b){var c=b.type;f[c]++,h=!0;var d=b.imageId,e=b.doneCallback,g=b.failCallback,i=a.imageCache.getImagePromise(d);if(i)return void i.then(function(a){f[c]--,e(a),k()},function(a){f[c]--,g(a),k()});var j;j=b.preventCache===!0?a.loadImage(d):a.loadAndCacheImage(d),j.then(function(a){f[c]--,e(a),k()},function(a){f[c]--,g(a),k()})}function m(){if(!h){var a=b.getMaxSimultaneousRequests();g={interaction:Math.max(a,1),thumbnail:Math.max(a-2,1),prefetch:Math.max(a-1,1)};for(var c=0;a>c;c++){var d=n();d&&l(d)}}}function n(){return e.interaction.length&&f.interaction<g.interaction?e.interaction.shift():e.thumbnail.length&&f.thumbnail<g.thumbnail?e.thumbnail.shift():e.prefetch.length&&f.prefetch<g.prefetch?e.prefetch.shift():(e.interaction.length||e.thumbnail.length||e.prefetch.length||(h=!1),!1)}function o(){return e}var p={addRequest:c,clearRequestStack:j,startGrabbing:m,getRequestPool:o};return p}var d,e={interaction:[],thumbnail:[],prefetch:[]},f={interaction:0,thumbnail:0,prefetch:0},g={interaction:6,thumbnail:6,prefetch:5},h=!1,i=20;b.requestPoolManager=c()}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){if(void 0===d)throw"playClip: element must not be undefined";var g=c.getToolState(d,"stack");if(g&&g.data&&g.data.length){var h,i=g.data[0],j=c.getToolState(d,f);j&&j.data&&j.data.length?h=j.data[0]:(h={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,loop:!0},c.addToolState(d,f,h)),e&&(h.framesPerSecond=e),void 0===h.intervalId&&(h.intervalId=setInterval(function(){var e=i.currentImageIdIndex;if(h.framesPerSecond>0?e++:e--,!h.loop&&(e>=i.imageIds.length||0>e)){var f={element:d},g=a.Event("CornerstoneToolsClipStopped",f);return a(d).trigger(g,f),clearInterval(h.intervalId),void(h.intervalId=void 0)}if(e>=i.imageIds.length&&(e=0),0>e&&(e=i.imageIds.length-1),e!==i.currentImageIdIndex){var j=c.loadHandlerManager.getStartLoadHandler(),k=c.loadHandlerManager.getEndLoadHandler(),l=c.loadHandlerManager.getErrorLoadingHandler();j&&j(d);var m,n=b.getViewport(d);m=i.preventCache===!0?b.loadImage(i.imageIds[e]):b.loadAndCacheImage(i.imageIds[e]),m.then(function(a){i.currentImageIdIndex=e,b.displayImage(d,a,n),k&&k(d)},function(a){var b=i.imageIds[e];l&&l(d,b,a)})}},1e3/Math.abs(h.framesPerSecond)))}}function e(a){var b=c.getToolState(a,f);if(b&&b.data&&b.data.length){var d=b.data[0];clearInterval(d.intervalId),d.intervalId=void 0}}var f="playClip";c.playClip=d,c.stopClip=e}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var d=b.element,f=b.enabledElement.canvas.width,g=b.enabledElement.canvas.height;if(!f||!g)return!1;var h=b.enabledElement.canvas.getContext("2d");h.setTransform(1,0,0,1,0,0),h.save();var i=c.scrollIndicator.getConfiguration();h.fillStyle=i.backgroundColor,h.fillRect(0,g-e,f,e);var j=c.getToolState(d,"stack");if(j&&j.data&&j.data.length){var k=j.data[0].imageIds,l=j.data[0].currentImageIdIndex,m=f/k.length,n=m*l;h.fillStyle=i.fillColor,h.fillRect(n,g-e,m,e),h.restore()}}var e=6,f={backgroundColor:"rgb(19, 63, 141)",fillColor:"white"};c.scrollIndicator=c.displayTool(d),c.scrollIndicator.setConfiguration(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){return a-b}function e(a,b){a=Math.round(a)||0,b=Math.round(b)||0;var c=[],d=b-a+1;if(0>=d)return c;for(;d--;)c[d]=b--;return c}function f(a,b){var c=[],d=[];return a.forEach(function(a){b>a?c.push(a):a>b&&d.push(a)}),{low:a.indexOf(t(c)),high:a.indexOf(u(d))}}function g(a){function e(a){var b=l.indicesToRequest.indexOf(a);b>-1&&l.indicesToRequest.splice(b,1)}function g(a){var b=j.imageIds.indexOf(a.imageId);e(b)}function h(b){console.log("prefetch errored: "+b),u&&u(a,o,b,"stackPrefetch")}var i=c.getToolState(a,"stack");if(i&&i.data&&i.data.length){var j=i.data[0],k=c.getToolState(a,q);if(k){var l=k.data[0];if(l&&l.indicesToRequest&&l.indicesToRequest.length||(l.enabled=!1),l.enabled!==!1){k.data[0].indicesToRequest.sort(d);var m=l.indicesToRequest.slice();if(m.forEach(function(a){var c=j.imageIds[a];if(c){var d=b.imageCache.getImagePromise(c);d&&"resolved"===d.state()&&e(a)}}),l.indicesToRequest.length){var n=c.requestPoolManager;n.clearRequestStack(r);for(var o,p,s=f(l.indicesToRequest,j.currentImageIdIndex),t=!1,u=c.loadHandlerManager.getErrorLoadingHandler(),v=s.low,w=s.high;v>0||w<l.indicesToRequest.length;)v>=0&&(p=l.indicesToRequest[v--],o=j.imageIds[p],n.addRequest(a,o,r,t,g,h)),w<l.indicesToRequest.length&&(p=l.indicesToRequest[w++],o=j.imageIds[p],n.addRequest(a,o,r,t,g,h));n.startGrabbing()}}}}}function h(a){var b=a.data.element,d=c.getToolState(b,q);d&&d.data&&d.data.length&&c.requestPoolManager.clearRequestStack(r)}function i(a,b){var d=a.data.element,e=c.getToolState(d,"stack");if(e&&e.data&&e.data.length){var f=e.data[0],g=f.imageIds.indexOf(b.imageId);if(!(0>g)){var h=c.getToolState(d,q);h&&h.data&&h.data.length&&h.data[0].indicesToRequest.push(g)}}}function j(a){clearTimeout(o),o=setTimeout(function(){var b=a.target;g(b)},p)}function k(d){var f=c.getToolState(d,q);f.data=[];var k=c.getToolState(d,"stack");if(k&&k.data&&k.data.length){var l=k.data[0];if(l.preventCache===!0)return void console.warn("A stack that should not be cached was given the stackPrefetch");var m={indicesToRequest:e(0,l.imageIds.length-1),enabled:!0,direction:1},n=m.indicesToRequest.indexOf(l.currentImageIdIndex);m.indicesToRequest.splice(n,1),c.addToolState(d,q,m),g(d),a(d).off("CornerstoneNewImage",j),a(d).on("CornerstoneNewImage",j),a(b).off("CornerstoneImageCacheFull",h),a(b).on("CornerstoneImageCacheFull",{element:d},h),a(b).off("CornerstoneImageCachePromiseRemoved",i),a(b).on("CornerstoneImageCachePromiseRemoved",{element:d},i)}}function l(d){clearTimeout(o),a(d).off("CornerstoneNewImage",j),a(b).off("CornerstoneImageCacheFull",h),a(b).off("CornerstoneImageCachePromiseRemoved",i);var e=c.getToolState(d,q);e&&e.data.length&&(e.data[0].enabled=!1,c.requestPoolManager.clearRequestStack(r))}function m(){return s}function n(a){s=a}var o,p,q="stackPrefetch",r="prefetch",s={},t=function(a){return Math.max.apply(null,a)},u=function(a){return Math.min.apply(null,a)};c.stackPrefetch={enable:k,disable:l,getConfiguration:m,setConfiguration:n}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)){var f={deltaY:0};return a(e.element).on("CornerstoneToolsMouseDrag",f,g),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),b.stopImmediatePropagation(),!1}}function f(a,b){var d=-b.direction;c.scroll(b.element,d)}function g(b,d){var e=d.element,f=c.getToolState(e,"stack");if(f&&f.data&&f.data.length){var g=f.data[0],h=c.stackScroll.getConfiguration(),i=a(e).height()/Math.max(g.imageIds.length,8);if(h&&h.stackScrollSpeed&&(i=h.stackScrollSpeed),b.data.deltaY=b.data.deltaY||0,b.data.deltaY+=d.deltaPoints.page.y,Math.abs(b.data.deltaY)>=i){var j=b.data.deltaY/i,k=Math.round(j),l=b.data.deltaY%i;b.data.deltaY=l,c.scroll(e,k)}return!1}}function h(a,b){var d=c.stackScrollMultiTouch.getConfiguration();d&&d.testPointers(b)&&g(a,b)}c.stackScroll=c.simpleMouseButtonTool(e),c.stackScrollWheel=c.mouseWheelTool(f);var i={eventData:{deltaY:0}};c.stackScrollTouchDrag=c.touchDragTool(g,i);var j={testPointers:function(a){return a.numPointers>=3}};c.stackScrollMultiTouch=c.multiTouchDragTool(h,i),c.stackScrollMultiTouch.setConfiguration(j)}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(b,d){var e=d.keyCode;if(e===c.UP||e===c.DOWN){var f=1;e===c.DOWN&&(f=-1),a.scroll(d.element,f)}}var c={UP:38,DOWN:40};a.stackScrollKeyboard=a.keyboardTool(b)}(cornerstoneTools),function(a,b,c){"use strict";function d(a){var d={imageIdToolState:c.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return a.forEach(function(a){var e=c.getElementToolStateManager(a);e!==c.globalImageIdSpecificToolStateManager&&(d.elementToolState[a.id]=e.saveToolState(),d.elementViewport[a.id]=b.getViewport(a))}),d}function e(a){return a.hasOwnProperty("imageIdToolState")&&a.hasOwnProperty("elementToolState")&&a.hasOwnProperty("elementViewport")?(c.globalImageIdSpecificToolStateManager.restoreToolState(a.imageIdToolState),Object.keys(a.elementViewport).forEach(function(d){var e=document.getElementById(d);if(e&&a.elementToolState.hasOwnProperty(d)){var f=c.getElementToolStateManager(e);if(f!==c.globalImageIdSpecificToolStateManager){f.restoreToolState(a.elementToolState[d]);var g=a.elementViewport[d];b.setViewport(e,g),b.updateImage(e)}}}),a):void 0}c.appState={save:d,restore:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(){function a(a,b,c){d.hasOwnProperty(a)===!1&&(d[a]={});var e=d[a];e.hasOwnProperty(b)===!1&&(e[b]={data:[]});var f=e[b];f.data.push(c)}function b(a,b){if(d.hasOwnProperty(a)!==!1){var c=d[a];if(c.hasOwnProperty(b)!==!1){var e=c[b];return e}}}function c(a,b,c){if(d.hasOwnProperty(a)!==!1){var e=d[a];if(e.hasOwnProperty(b)!==!1){for(var f=e[b],g=-1,h=0;h<f.data.length;h++)f.data[h]===c&&(g=h);-1!==g&&f.data.splice(g,1)}}}var d={},e={get:b,add:a,remove:c};return e}var e=d();c.newFrameOfReferenceSpecificToolStateManager=d,c.globalFrameOfReferenceSpecificToolStateManager=e}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){function b(a){return i[a]}function c(a,b){i[a]=b}function d(){return i}function e(a){i=a}function f(b,c,d){var e=a.getEnabledElement(b);e.image&&i.hasOwnProperty(e.image.imageId)!==!1||(i[e.image.imageId]={});var f=i[e.image.imageId];f.hasOwnProperty(c)===!1&&(f[c]={data:[]});var g=f[c];g.data.push(d)}function g(b,c){var d=a.getEnabledElement(b);if(d.image&&i.hasOwnProperty(d.image.imageId)!==!1){var e=i[d.image.imageId];if(e.hasOwnProperty(c)!==!1){var f=e[c];return f}}}function h(b){var c=a.getEnabledElement(b);c.image&&i.hasOwnProperty(c.image.imageId)!==!1&&delete i[c.image.imageId]}var i={},j={get:g,add:f,clear:h,saveImageIdToolState:b,restoreImageIdToolState:c,saveToolState:d,restoreToolState:e,toolState:i};return j}var d=c();b.newImageIdSpecificToolStateManager=c,b.globalImageIdSpecificToolStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){g=a}function b(){return g}function c(a){h=a}function d(){return h}function e(a){i=a}function f(){return i}var g,h,i,j={setStartLoadHandler:a,getStartLoadHandler:b,setEndLoadHandler:c,getEndLoadHandler:d,setErrorLoadingHandler:e,getErrorLoadingHandler:f};return j}a.loadHandlerManager=b()}(cornerstoneTools),function(a,b){"use strict";function c(a,b){function c(){return g}function d(a){g=a}function e(c,d,e){if(!(a.indexOf(d)>=0))return b.add(c,d,e);g.hasOwnProperty(d)===!1&&(g[d]={data:[]});var f=g[d];f.data.push(e)}function f(c,d){if(a.indexOf(d)>=0){g.hasOwnProperty(d)===!1&&(g[d]={data:[]});var e=g[d];return e}return b.get(c,d)}var g={},h={get:f,add:e,saveToolState:c,restoreToolState:d,toolState:g};return h}function d(a){var c=b.getElementToolStateManager(a);c||(c=b.globalImageIdSpecificToolStateManager);var d=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs"],f=b.newStackSpecificToolStateManager(d,c);e.push(f),b.setElementToolStateManager(a,f)}var e=[];b.newStackSpecificToolStateManager=c,b.addStackStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){h=a}function b(){return h}function c(a){g=a}function d(){return g}function e(a){i=a}function f(){return i}var g=15,h=g+"px Arial",i="transparent",j={setFont:a,getFont:b,setFontSize:c,getFontSize:d,setBackgroundColor:e,getBackgroundColor:f};return j}a.textStyle=b()}(cornerstoneTools),function(a,b){"use strict";function c(a,b){function c(c,d,f){if(!(a.indexOf(d)>=0))return b.add(c,d,f);e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var g=e[d];g.data.push(f)}function d(c,d){if(a.indexOf(d)>=0){e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var f=e[d];return f}return b.get(c,d)}var e={},f={get:d,add:c};return f}function d(a,c){c=c||["timeSeries"];var d=b.getElementToolStateManager(a);void 0===d&&(d=b.globalImageIdSpecificToolStateManager);var f=b.newTimeSeriesSpecificToolStateManager(c,d);e.push(f),b.setElementToolStateManager(a,f)}var e=[];b.newTimeSeriesSpecificToolStateManager=c,b.addTimeSeriesStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){j=a}function b(){return j}function c(a){h=a}function d(){return h}function e(a){i=a}function f(){return i}function g(a){return a?i:h}var h="white",i="greenyellow",j="transparent",k={setFillColor:a,getFillColor:b,setToolColor:c,getToolColor:d,setActiveColor:e,getActiveColor:f,getColorIfActive:g};return k}a.toolColors=b()}(cornerstoneTools),function(a){"use strict";function b(){function a(a){c=a.currentPoints.canvas}function b(){return c}var c="",d={setCoords:a,getCoords:b};return d}a.toolCoordinates=b()}(cornerstoneTools),function(a,b){"use strict";function c(c){var d=a.getEnabledElement(c);return void 0===d.toolStateManager&&(d.toolStateManager=b.globalImageIdSpecificToolStateManager),d.toolStateManager}function d(a,b,d){var e=c(a);e.add(a,b,d);var f="CornerstoneToolsMeasurementAdded",g={toolType:b,element:a,measurementData:d};$(a).trigger(f,g)}function e(a,b){var d=c(a);return d.get(a,b)}function f(a,b,d){for(var e=c(a),f=e.get(a,b),g=-1,h=0;h<f.data.length;h++)f.data[h]===d&&(g=h);if(-1!==g){f.data.splice(g,1);var i="CornerstoneToolsMeasurementRemoved",j={toolType:b,element:a,measurementData:d};$(a).trigger(i,j)}}function g(a,b){var d=c(a),e=d.get(a,b);void 0!==e&&(e.data=[])}function h(b,c){var d=a.getEnabledElement(b);d.toolStateManager=c}b.addToolState=d,b.getToolState=e,b.removeToolState=f,b.clearToolState=g,b.setElementToolStateManager=h,b.getElementToolStateManager=c}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){e=a}function b(){return e}function c(a){f=a}function d(){return f}var e=1,f=2,g={setToolWidth:a,getToolWidth:b,setActiveWidth:c,getActiveWidth:d};return g}a.toolStyle=b()}(cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){if(d!==c){var e=b.getViewport(c),f=b.getViewport(d);f.scale===e.scale&&f.translation.x===e.translation.x&&f.translation.y===e.translation.y||(f.scale=e.scale,f.translation.x=e.translation.x,f.translation.y=e.translation.y,a.setViewport(d,f))}}c.panZoomSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e){if(e!==d){var f=c.getToolState(d,"stack"),g=f.data[0],h=c.getToolState(e,"stack"),i=h.data[0],j=g.currentImageIdIndex;if(j=Math.min(Math.max(j,0),i.imageIds.length-1),j!==i.currentImageIdIndex){var k=c.loadHandlerManager.getStartLoadHandler(),l=c.loadHandlerManager.getEndLoadHandler(),m=c.loadHandlerManager.getErrorLoadingHandler();k&&k(e);var n;n=i.preventCache===!0?b.loadImage(i.imageIds[j]):b.loadAndCacheImage(i.imageIds[j]),n.then(function(c){var d=b.getViewport(e);i.currentImageIdIndex=j,a.displayImage(e,c,d),l&&l(e)},function(a){var b=i.imageIds[j];m&&m(e,b,a)})}}}c.stackImageIndexSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f,g){if(e!==d){var h=b.getEnabledElement(d),i=c.metaData.get("imagePlane",h.image.imageId),j=i.imagePositionPatient,k=c.getToolState(e,"stack"),l=k.data[0],m=Number.MAX_VALUE,n=-1;if(g){var o=j.clone().add(g);if(l.imageIds.forEach(function(a,b){var d=c.metaData.get("imagePlane",a),e=d.imagePositionPatient,f=o.distanceToSquared(e);m>f&&(m=f,n=b)}),n!==l.currentImageIdIndex&&-1!==n){var p=c.loadHandlerManager.getStartLoadHandler(),q=c.loadHandlerManager.getEndLoadHandler(),r=c.loadHandlerManager.getErrorLoadingHandler();p&&p(e);var s;s=l.preventCache===!0?b.loadImage(l.imageIds[n]):b.loadAndCacheImage(l.imageIds[n]),s.then(function(c){var d=b.getViewport(e);l.currentImageIdIndex=n,a.displayImage(e,c,d),q&&q(e)},function(a){var b=l.imageIds[n];r&&r(e,b,a)})}}}}c.stackImagePositionOffsetSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e,f){if(f!==e){var g=b.getEnabledElement(e).image,h=c.metaData.get("imagePlane",g.imageId),i=h.imagePositionPatient,j=c.getToolState(f,"stack"),k=j.data[0],l=Number.MAX_VALUE,m=-1;if(a.each(k.imageIds,function(a,b){var d=c.metaData.get("imagePlane",b),e=d.imagePositionPatient,f=e.distanceToSquared(i);l>f&&(l=f,m=a)}),m!==k.currentImageIdIndex){var n=c.loadHandlerManager.getStartLoadHandler(),o=c.loadHandlerManager.getEndLoadHandler(),p=c.loadHandlerManager.getErrorLoadingHandler();if(n&&n(f),-1!==m){var q;q=k.preventCache===!0?b.loadImage(k.imageIds[m]):b.loadAndCacheImage(k.imageIds[m]),q.then(function(a){var c=b.getViewport(f);k.currentImageIdIndex=m,d.displayImage(f,a,c),o&&o(f)},function(a){var b=k.imageIds[m];p&&p(f,b,a)})}}}}c.stackImagePositionSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f){if(d!==e&&f&&f.direction){var g=c.getToolState(e,"stack"),h=g.data[0],i=h.currentImageIdIndex+f.direction;if(i=Math.min(Math.max(i,0),h.imageIds.length-1),h.currentImageIdIndex!==i){var j=c.loadHandlerManager.getStartLoadHandler(),k=c.loadHandlerManager.getEndLoadHandler(),l=c.loadHandlerManager.getErrorLoadingHandler();j&&j(e);var m;m=h.preventCache===!0?b.loadImage(h.imageIds[i]):b.loadAndCacheImage(h.imageIds[i]),m.then(function(c){var d=b.getViewport(e);h.currentImageIdIndex=i,a.displayImage(e,c,d),k&&k(e)},function(a){var b=h.imageIds[i];l&&l(e,b,a)})}}}c.stackScrollSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){function f(a,b){j.length&&k.length&&(l=!0,k.forEach(function(c){var d=k.indexOf(c);if(-1!==d){var e=m.imageIds.targetElements[d],f=j.indexOf(a);if(-1!==f){var g,h=m.imageIds.sourceElements[f];g=h===e?0:m.distances[h][e],n(i,a,c,b,g)}}}),l=!1)}function g(a,b){l!==!0&&f(a.currentTarget,b)}function h(a,b){var c=b.element;i.remove(c)}var i=this,j=[],k=[],l=!1,m={},n=e;this.setHandler=function(a){n=a},this.getHandler=function(){return n},this.getDistances=function(){j.length&&k.length&&(m.distances={},m.imageIds={sourceElements:[],targetElements:[]},j.forEach(function(a){var d=b.getEnabledElement(a);if(d&&d.image){var e=d.image.imageId,f=c.metaData.get("imagePlane",e);if(f&&f.imagePositionPatient){var g=f.imagePositionPatient;m.hasOwnProperty(d)||(m.distances[e]={},m.imageIds.sourceElements.push(e),k.forEach(function(d){var f=b.getEnabledElement(d);if(f&&f.image){var h=f.image.imageId;if(m.imageIds.targetElements.push(h),a!==d&&e!==h&&!m.distances[e].hasOwnProperty(h)){var i=c.metaData.get("imagePlane",h);if(i&&i.imagePositionPatient){var j=i.imagePositionPatient;m.distances[e][h]=j.clone().sub(g)}}}}),Object.keys(m.distances[e]).length||delete m.distances[e])}}}))},this.addSource=function(b){var c=j.indexOf(b);-1===c&&(j.push(b),a(b).on(d,g),i.getDistances(),i.updateDisableHandlers())},this.addTarget=function(a){var b=k.indexOf(a);-1===b&&(k.push(a),i.getDistances(),n(i,a,a,0),i.updateDisableHandlers())},this.add=function(a){i.addSource(a),i.addTarget(a)},this.removeSource=function(b){var c=j.indexOf(b);-1!==c&&(j.splice(c,1),a(b).off(d,g),i.getDistances(),f(b),i.updateDisableHandlers())},this.removeTarget=function(a){var b=k.indexOf(a);-1!==b&&(k.splice(b,1),i.getDistances(),n(i,a,a,0),i.updateDisableHandlers())},this.remove=function(a){i.removeTarget(a),i.removeSource(a)},this.getSourceElements=function(){return j},this.getTargetElements=function(){return k},this.displayImage=function(a,c,d){l=!0,b.displayImage(a,c,d),l=!1},this.setViewport=function(a,c){l=!0,b.setViewport(a,c),l=!1},this.updateDisableHandlers=function(){var b=a.unique(j.concat(k));b.forEach(function(b){a(b).off("CornerstoneElementDisabled",h),a(b).on("CornerstoneElementDisabled",h)})},this.destroy=function(){var b=a.unique(j.concat(k));b.forEach(function(a){i.remove(a)})}}c.Synchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){d!==c&&b.updateImage(d)}c.updateImageSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){if(d!==c){var e=b.getViewport(c),f=b.getViewport(d);f.voi.windowWidth===e.voi.windowWidth&&f.voi.windowCenter===e.voi.windowCenter&&f.invert===e.invert||(f.voi.windowWidth=e.voi.windowWidth,f.voi.windowCenter=e.voi.windowCenter,f.invert=e.invert,a.setViewport(d,f))}}c.wwwcSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var c=[];a.timeSeries.stacks.forEach(function(d){var e;e=d.preventCache===!0?b.loadImage(d.imageIds[a.imageIdIndex]):b.loadAndCacheImage(d.imageIds[a.imageIdIndex]),e.then(function(b){var d=Math.round(a.handles.end.x)+Math.round(a.handles.end.y)*b.width,e=b.getPixelData()[d];c.push(e)})}),a.lineSample.set(c)}function e(a){var b=c.getToolState(a.element,"timeSeries");if(void 0!==b&&void 0!==b.data&&0!==b.data.length){var e=b.data[0],f={timeSeries:e,lineSample:new c.LineSampleMeasurement,imageIdIndex:e.stacks[e.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return d(f),c.MeasurementManager.add(f),f}}function f(a,d){var e=c.getToolState(a.currentTarget,g);if(void 0!==e){var f=d.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(d.enabledElement,f);for(var h="white",i=0;i<e.data.length;i++){f.save();var j=e.data[i];f.beginPath(),c.drawHandles(f,d,j.handles,h),f.stroke();var k=c.setContextToDisplayFontSize(d.enabledElement,d.canvasContext,15);f.font=""+k.fontSize+"px Arial";var l=Math.round(j.handles.end.x),m=Math.round(j.handles.end.y),n=j.handles.end.x+3,o=j.handles.end.y-3;f.fillStyle=h,f.fillText(""+l+","+m,n,o),f.restore()}}}var g="probe4D";c.probeTool4D=c.mouseButtonTool({createNewMeasurement:e,onImageRendered:f,toolType:g})}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e){var f=c.getToolState(a,"timeSeries");if(void 0!==f&&void 0!==f.data&&0!==f.data.length){var g=f.data[0],h=g.stacks[g.currentStackIndex],i=h.currentImageIdIndex,j=g.currentStackIndex+d;if(e?(j>=g.stacks.length&&(j=0),0>j&&(j=g.stacks.length-1)):(j=Math.min(g.stacks.length-1,j),j=Math.max(0,j)),j!==g.currentStackIndex){var k=b.getViewport(a),l=g.stacks[j],m=c.loadHandlerManager.getStartLoadHandler(),n=c.loadHandlerManager.getEndLoadHandler(),o=c.loadHandlerManager.getErrorLoadingHandler();m&&m(a);var p;p=l.preventCache===!0?b.loadImage(l.imageIds[i]):b.loadAndCacheImage(l.imageIds[i]),p.then(function(c){g.currentImageIdIndex!==i&&(l.currentImageIdIndex=i,g.currentStackIndex=j,b.displayImage(a,c,k),n&&n(a))},function(b){var c=l.imageIds[i];o&&o(a,c,b)})}}}c.incrementTimePoint=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){if(void 0===a)throw"playClip: element must not be undefined";void 0===b&&(b=30);var d=c.getToolState(a,"timeSeries");if(void 0!==d&&void 0!==d.data&&0!==d.data.length){var e,g=c.getToolState(a,f);void 0===g||0===g.data.length?(e={intervalId:void 0,framesPerSecond:b,lastFrameTimeStamp:void 0,frameRate:0},c.addToolState(a,f,e)):(e=g.data[0],e.framesPerSecond=b),void 0===e.intervalId&&(e.intervalId=setInterval(function(){e.framesPerSecond>0?c.incrementTimePoint(a,1,!0):c.incrementTimePoint(a,-1,!0)},1e3/Math.abs(e.framesPerSecond)))}}function e(a){var b,d=c.getToolState(a,f);
void 0!==d&&0!==d.data.length&&(b=d.data[0],clearInterval(b.intervalId),b.intervalId=void 0)}var f="timeSeriesPlayer";c.timeSeriesPlayer={start:d,stop:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)){var g={deltaY:0,options:b.data.options};return a(e.element).on("CornerstoneToolsMouseDrag",g,f),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),b.stopImmediatePropagation(),!1}}function f(b,d){b.data.deltaY+=d.deltaPoints.page.y;var e=c.getToolState(d.element,"timeSeries");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0],g=a(d.element).height()/f.stacks.length;if(void 0!==b.data.options&&void 0!==b.data.options.timeSeriesScrollSpeed&&(g=b.data.options.timeSeriesScrollSpeed),b.data.deltaY>=g||b.data.deltaY<=-g){var h=Math.round(b.data.deltaY/g),i=b.data.deltaY%g;c.incrementTimePoint(d.element,h),b.data.deltaY=i}return!1}}function g(a,b){var d=-b.direction;c.incrementTimePoint(b.element,d)}function h(a){var b=a.originalEvent.detail,d={deltaY:0};d.deltaY+=b.deltaPoints.page.y;var e=c.getToolState(b.element,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){if(d.deltaY>=3||d.deltaY<=-3){var f=d.deltaY/3,g=d.deltaY%3;c.setTimePoint(d.element,f),d.deltaY=g}return!1}}c.timeSeriesScroll=c.simpleMouseButtonTool(e),c.timeSeriesScrollWheel=c.mouseWheelTool(g),c.timeSeriesScrollTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}c.roundToDecimal=d}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(a){return parseFloat("."+a)}function c(a,c){if(dicomParser&&void 0!==a.data&&"PT"===a.data.string("x00080060")){var d=c*a.slope+a.intercept,e=a.data.floatString("x00101030");if(void 0!==e){var f=a.data.elements.x00540016;if(void 0!==f){f=f.items[0].dataSet;var g=dicomParser.parseTM(f.string("x00181072")),h=f.floatString("x00181074"),i=f.floatString("x00181075"),j=dicomParser.parseTM(a.data.string("x00080031"));if(g&&h&&i&&j){var k=b(j.fractionalSeconds)+j.seconds+60*j.minutes+60*j.hours*60,l=b(g.fractionalSeconds)+g.seconds+60*g.minutes+60*g.hours*60,m=k-l,n=h*Math.exp(-m*Math.log(2)/i),o=d*e/n*1e3;return o}}}}}a.calculateSUV=c}(cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b=c.point.copy(a.page),d=c.point.copy(a.image),e=c.point.copy(a.client),f=c.point.copy(a.canvas);return{page:b,image:d,client:e,canvas:f}}d.copyPoints=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a){"use strict";function b(a,b,c,d,e){var f=10,g=Math.atan2(c.y-b.y,c.x-b.x);a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.strokeStyle=d,a.lineWidth=e,a.stroke(),a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(c.x-f*Math.cos(g-Math.PI/7),c.y-f*Math.sin(g-Math.PI/7)),a.lineTo(c.x-f*Math.cos(g+Math.PI/7),c.y-f*Math.sin(g+Math.PI/7)),a.lineTo(c.x,c.y),a.lineTo(c.x-f*Math.cos(g-Math.PI/7),c.y-f*Math.sin(g-Math.PI/7)),a.strokeStyle=d,a.lineWidth=e,a.stroke(),a.fillStyle=d,a.fill()}a.drawArrow=b}(cornerstoneTools),function(a){"use strict";function b(a,b,c,d,e){var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.beginPath(),a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l),a.closePath(),a.stroke()}a.drawEllipse=b}(cornerstoneTools),function(a){"use strict";function b(b,c,d,e,f,g){"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);var h=5,i=a.textStyle.getFont(),j=a.textStyle.getFontSize(),k=a.textStyle.getBackgroundColor();b.save(),b.font=i,b.textBaseline="top",b.strokeStyle=f;var l=0;c.forEach(function(a){var c=b.measureText(a).width;l=Math.max(l,c)}),b.fillStyle=k;var m={width:l+2*h,height:h+c.length*(j+h)};return g&&g.centering&&g.centering.x===!0&&(d-=m.width/2),g&&g.centering&&g.centering.y===!0&&(e-=m.height/2),m.left=d,m.top=e,g&&g.debug===!0&&(b.fillStyle="#FF0000"),b.fillRect(m.left,m.top,m.width,m.height),c.forEach(function(a,c){b.fillStyle=f;var g;g=0===c?e+c*(j+h):e+c*(j+2*h),b.fillText(a,d+h,e+h+c*(j+h))}),b.restore(),m}a.drawTextBox=b}(cornerstoneTools),function(a,b){"use strict";function c(b,c,d,e,f){if(!b)throw"getLuminance: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);var g,h,i,j=a.getEnabledElement(b),k=j.image,l=[],m=0,n=k.getPixelData();if(k.color)for(h=0;f>h;h++)for(i=0;e>i;i++){g=4*((h+d)*k.columns+(i+c));var o=n[g],p=n[g+1],q=n[g+2];l[m++]=.2126*o+.7152*p+.0722*q}else for(h=0;f>h;h++)for(i=0;e>i;i++)g=(h+d)*k.columns+(i+c),l[m++]=n[g]*k.slope+k.intercept;return l}b.getLuminance=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\b(OPR|Edge)\/(\d+)/),null!==a)?a.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c.join(" "))}function d(){var a=b.stackPrefetch.getConfiguration();if(a.maxSimultaneousRequests)return a.maxSimultaneousRequests;var d=c(),e=d.split(" "),g=e[0],h=e[1],i=f[g];return i?i[h]?i[h]:i["default"]:f["default"]}function e(){var a=new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini");return!!a.test(navigator.userAgent)}var f={"default":6,IE:{9:6,10:8,"default":8},Firefox:{"default":6},Opera:{10:8,11:6,12:6,"default":6},Chrome:{"default":6},Safari:{"default":6}};b.getMaxSimultaneousRequests=d,b.getBrowserInfo=c,b.isMobileDevice=e}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b,c,d,e,f){if(!b)throw"getRGBPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);var g,h,i,j=a.getEnabledElement(b),k=[],l=0,m=j.image.getPixelData();if(j.image.color)for(h=0;f>h;h++)for(i=0;e>i;i++){g=4*((h+d)*j.image.columns+(i+c));var n=m[g],o=m[g+1],p=m[g+2],q=m[g+3];k[l++]=n,k[l++]=o,k[l++]=p,k[l++]=q}return k}b.getRGBPixels=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(a,b){var c=1<<a-1;return 0!==(b&c)}b.isMouseButtonEnabled=c}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}c.pauseEvent=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b,c){return b.boundingBox?a.point.insideRect(c,b.boundingBox):void 0}b.pointInsideBoundingBox=c}(cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var c=a.clone().sub(b.imagePositionPatient),d=b.rowCosines.dot(c)/b.columnPixelSpacing,e=b.columnCosines.dot(c)/b.rowPixelSpacing;return{x:d,y:e}}function e(a,b){var c=b.rowCosines.clone().multiplyScalar(a.x);c.multiplyScalar(b.columnPixelSpacing);var d=b.columnCosines.clone().multiplyScalar(a.y);d.multiplyScalar(b.rowPixelSpacing);var e=c.add(d);return e.add(b.imagePositionPatient),e}function f(a){var b=e({x:0,y:0},a),c=e({x:a.columns,y:0},a),d=e({x:0,y:a.rows},a),f=e({x:a.columns,y:a.rows},a),g={top:new cornerstoneMath.Line3(b,c),left:new cornerstoneMath.Line3(b,d),right:new cornerstoneMath.Line3(c,f),bottom:new cornerstoneMath.Line3(d,f)};return g}function g(a,b){var c=[];return Object.keys(b).forEach(function(d){var e=b[d],f=a.intersectLine(e);f&&c.push(f)}),c}function h(a,b){var c=a.rowCosines.clone().cross(a.columnCosines),d=new cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(c,a.imagePositionPatient);var h=b.rowCosines.clone().cross(b.columnCosines),i=new cornerstoneMath.Plane;i.setFromNormalAndCoplanarPoint(h,b.imagePositionPatient);var j=i.clone().intersectPlane(d),k=j.origin,l=j.direction,m=e({x:b.columns,y:b.rows},b),n=b.imagePositionPatient.distanceTo(m),o=new cornerstoneMath.Line3;o.start=k,o.end=k.clone().add(l.multiplyScalar(n));var p=f(b),q=g(o,p);if(2===q.length){var r={start:q[0],end:q[1]};return r}}c.projectPatientPointToImagePlane=d,c.imagePointToPatientPoint=e,c.planePlaneIntersection=h}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(a){window.setTimeout(a,1e3/60)}function c(a){return window.requestAnimationFrame(a)||window.webkitRequestAnimationFrame(a)||window.mozRequestAnimationFrame(a)||window.oRequestAnimationFrame(a)||window.msRequestAnimationFrame(a)||b(a)}a.requestAnimFrame=c}(cornerstoneTools),function(a,b){"use strict";function c(a,c){var d=b.getToolState(a,"stack");if(void 0!==d&&void 0!==d.data&&0!==d.data.length){var e=d.data[0],f=e.currentImageIdIndex+c;f=Math.min(e.imageIds.length-1,f),f=Math.max(0,f),b.scrollToIndex(a,f)}}b.scroll=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(c,d){function e(b){h.currentImageIdIndex===d&&(a.displayImage(c,b,l),j&&j(c))}function f(a){var b=h.imageIds[d];k&&k(c,b,a)}var g=b.getToolState(c,"stack");if(g&&g.data&&g.data.length){var h=g.data[0];0>d&&(d+=h.imageIds.length);var i=b.loadHandlerManager.getStartLoadHandler(),j=b.loadHandlerManager.getEndLoadHandler(),k=b.loadHandlerManager.getErrorLoadingHandler(),l=a.getViewport(c);if(d!==h.currentImageIdIndex){i&&i(c);var m={newImageIdIndex:d,direction:d-h.currentImageIdIndex};h.currentImageIdIndex=d;var n=h.imageIds[d],o=b.stackScroll.getConfiguration();if(o&&o.retryLoadOnScroll===!0){var p=a.imageCache.getImagePromise(n);p&&"rejected"===p.state()&&a.imageCache.removeImagePromise(n)}var q=b.requestPoolManager,r="interaction";q.clearRequestStack(r);var s=!!h.preventCache;q.addRequest(c,n,r,s,e,f),q.startGrabbing(),$(c).trigger("CornerstoneStackScroll",m)}}}b.scrollToIndex=c,b.loadHandlers={}}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b,c,d){var e=.1;a.setToPixelCoordinateSystem(b,c,e);var f=d/b.viewport.scale/e,g=d/b.viewport.scale/e;return{fontSize:f,lineHeight:g,fontScale:e}}b.setContextToDisplayFontSize=c}(cornerstone,cornerstoneTools);