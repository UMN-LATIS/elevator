/*
3DHOP - 3D Heritage Online Presenter
Copyright (c) 2014, Marco Callieri - Visual Computing Lab, ISTI - CNR
All rights reserved.    

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
function init3dhop(){var e,t,i,r=0
$("#toolbar img").mouseenter(function(e){t=$(this).attr("id"),i?$(this).css("opacity","1.0"):$(this).css("opacity","0.8")}).mouseout(function(t){clearInterval(e),$(this).css("opacity","0.5")}).mousedown(function(n){i=!0,n.button==r&&(actionsToolbar(t),"zoomin"==t||"zoomout"==t?e=setInterval(function(){actionsToolbar(t)},100):clearInterval(e),$(this).css("opacity","1.0"),r=0)}).mouseup(function(t){i=!1,t.button==r&&(clearInterval(e),$(this).css("opacity","0.8"),r=0)}).on("touchstart",function(e){r=2}).on("touchend",function(e){r=0}),$("#measure-output").on("contextmenu",function(e){e.stopPropagation()}),$("#3dhop").on("contextmenu",function(e){return!1}).on("touchstart",function(e){$("#toolbar img").css("opacity","0.5")}).on("touchend",function(t){clearInterval(e)}).on("touchmove",function(t){clearInterval(e),$("#toolbar img").css("opacity","0.5")}),$("#draw-canvas").mousedown(function(){$("#toolbar img").css("opacity","0.5")}),window.navigator.userAgent.indexOf("Trident/")>0&&($("#full").click(function(e){enterFullscreen()}),$("#full_on").click(function(e){exitFullscreen()})),resizeCanvas($("#3dhop").parent().width(),$("#3dhop").parent().height()),set3dhlg()}function lightSwitch(){var e=presenter.isLightTrackballEnabled()
e?($("#light").css("visibility","hidden"),$("#light_on").css("visibility","visible"),$("#light_on").css("opacity","1.0")):($("#light_on").css("visibility","hidden"),$("#light").css("visibility","visible"),$("#light").css("opacity","1.0"))}function measurementSwitch(){var e=presenter.isMeasurementToolEnabled()
e?($("#measure").css("visibility","hidden"),$("#measure_on").css("visibility","visible"),$("#measure_on").css("opacity","1.0"),$("#measurebox").css("visibility","visible"),$("#draw-canvas").css("cursor","crosshair")):($("#measure_on").css("visibility","hidden"),$("#measure").css("visibility","visible"),$("#measure").css("opacity","1.0"),$("#measurebox").css("visibility","hidden"),$("#measure-output").html("0.0"),$("#draw-canvas").css("cursor","default"))}function hotspotSwitch(){var e=presenter.isSpotVisibilityEnabled()
e?($("#hotspot").css("visibility","hidden"),$("#hotspot_on").css("visibility","visible"),$("#hotspot_on").css("opacity","1.0")):($("#hotspot_on").css("visibility","hidden"),$("#hotspot").css("visibility","visible"),$("#hotspot").css("opacity","1.0"))}function fullscreenSwitch(){"visible"==$("#full").css("visibility")?window.navigator.userAgent.indexOf("Trident/")<0&&enterFullscreen():window.navigator.userAgent.indexOf("Trident/")<0&&exitFullscreen()}function enterFullscreen(){var e=document.getElementById("3dhop")
presenter.native_width=presenter.ui.width,presenter.native_height=presenter.ui.height,$("#full").css("visibility","hidden"),$("#full_on").css("visibility","visible"),$("#full_on").css("opacity","0.5"),resizeCanvas(screen.width,screen.height),e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),presenter.ui.postDrawEvent()}function exitFullscreen(){$("#full_on").css("visibility","hidden"),$("#full").css("visibility","visible"),$("#full").css("opacity","0.5"),resizeCanvas(presenter.native_width,presenter.native_height),document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),presenter.ui.postDrawEvent()}function moveToolbar(e,t){$("#toolbar").css("left",e),$("#toolbar").css("top",t)}function moveMeasurebox(e,t){$("#measurebox").css("right",e),$("#measurebox").css("top",t)}function resizeCanvas(e,t){$("#draw-canvas").attr("width",e),$("#draw-canvas").attr("height",t),$("#3dhop").css("width",e),$("#3dhop").css("height",t)}function set3dhlg(){$("#tdhlg").html("Powered by 3DHOP</br>&nbsp;C.N.R. &nbsp;&ndash;&nbsp; I.S.T.I."),$("#tdhlg").mouseover(function(){$("#tdhlg").animate({height:"25px"},"fast")}).mouseout(function(){$("#tdhlg").animate({height:"13px"},"slow")}),$("#tdhlg").click(function(){window.open("http://vcg.isti.cnr.it/3dhop/","_blank")})}function Tunstall(e,t){this.wordsize=e?e:8,this.lookup_size=t?t:8}function MeshCoder(e,t,i){this.sig=e,this.node=t,this.patches=i,this.last=new Int32Array(this.node.nvert),this.last_count=0}function PanTiltTrackball(){}function SphereTrackball(){}function TurnTableTrackball(){}function TurntablePanTrackball(){}document.addEventListener("MSFullscreenChange",function(){document.msFullscreenElement||exitFullscreen()},!1),document.addEventListener("mozfullscreenchange",function(){document.mozFullScreen||exitFullscreen()},!1),document.addEventListener("webkitfullscreenchange",function(){document.webkitIsFullScreen||exitFullscreen()},!1),!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document")
return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function i(e){var t=e.length,i=ne.type(e)
return"function"===i||ne.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e}function r(e,t,i){if(ne.isFunction(t))return ne.grep(e,function(e,r){return!!t.call(e,r,e)!==i})
if(t.nodeType)return ne.grep(e,function(e){return e===t!==i})
if("string"==typeof t){if(de.test(t))return ne.filter(t,e,i)
t=ne.filter(t,e)}return ne.grep(e,function(e){return ne.inArray(e,t)>=0!==i})}function n(e,t){do e=e[t]
while(e&&1!==e.nodeType)
return e}function a(e){var t=be[e]={}
return ne.each(e.match(Le)||[],function(e,i){t[i]=!0}),t}function s(){fe.addEventListener?(fe.removeEventListener("DOMContentLoaded",o,!1),e.removeEventListener("load",o,!1)):(fe.detachEvent("onreadystatechange",o),e.detachEvent("onload",o))}function o(){(fe.addEventListener||"load"===event.type||"complete"===fe.readyState)&&(s(),ne.ready())}function u(e,t,i){if(void 0===i&&1===e.nodeType){var r="data-"+t.replace(Me,"-$1").toLowerCase()
if(i=e.getAttribute(r),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:Ge.test(i)?ne.parseJSON(i):i}catch(n){}ne.data(e,t,i)}else i=void 0}return i}function c(e){var t
for(t in e)if(("data"!==t||!ne.isEmptyObject(e[t]))&&"toJSON"!==t)return!1
return!0}function l(e,t,i,r){if(ne.acceptData(e)){var n,a,s=ne.expando,o=e.nodeType,u=o?ne.cache:e,c=o?e[s]:e[s]&&s
if(c&&u[c]&&(r||u[c].data)||void 0!==i||"string"!=typeof t)return c||(c=o?e[s]=$.pop()||ne.guid++:s),u[c]||(u[c]=o?{}:{toJSON:ne.noop}),("object"==typeof t||"function"==typeof t)&&(r?u[c]=ne.extend(u[c],t):u[c].data=ne.extend(u[c].data,t)),a=u[c],r||(a.data||(a.data={}),a=a.data),void 0!==i&&(a[ne.camelCase(t)]=i),"string"==typeof t?(n=a[t],null==n&&(n=a[ne.camelCase(t)])):n=a,n}}function h(e,t,i){if(ne.acceptData(e)){var r,n,a=e.nodeType,s=a?ne.cache:e,o=a?e[ne.expando]:ne.expando
if(s[o]){if(t&&(r=i?s[o]:s[o].data)){ne.isArray(t)?t=t.concat(ne.map(t,ne.camelCase)):t in r?t=[t]:(t=ne.camelCase(t),t=t in r?[t]:t.split(" ")),n=t.length
for(;n--;)delete r[t[n]]
if(i?!c(r):!ne.isEmptyObject(r))return}(i||(delete s[o].data,c(s[o])))&&(a?ne.cleanData([e],!0):ie.deleteExpando||s!=s.window?delete s[o]:s[o]=null)}}}function d(){return!0}function p(){return!1}function f(){try{return fe.activeElement}catch(e){}}function _(e){var t=Oe.split("|"),i=e.createDocumentFragment()
if(i.createElement)for(;t.length;)i.createElement(t.pop())
return i}function g(e,t){var i,r,n=0,a=typeof e.getElementsByTagName!==Te?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==Te?e.querySelectorAll(t||"*"):void 0
if(!a)for(a=[],i=e.childNodes||e;null!=(r=i[n]);n++)!t||ne.nodeName(r,t)?a.push(r):ne.merge(a,g(r,t))
return void 0===t||t&&ne.nodeName(e,t)?ne.merge([e],a):a}function m(e){Ne.test(e.type)&&(e.defaultChecked=e.checked)}function S(e,t){return ne.nodeName(e,"table")&&ne.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function L(e){return e.type=(null!==ne.find.attr(e,"type"))+"/"+e.type,e}function b(e){var t=Ye.exec(e.type)
return t?e.type=t[1]:e.removeAttribute("type"),e}function v(e,t){for(var i,r=0;null!=(i=e[r]);r++)ne._data(i,"globalEval",!t||ne._data(t[r],"globalEval"))}function x(e,t){if(1===t.nodeType&&ne.hasData(e)){var i,r,n,a=ne._data(e),s=ne._data(t,a),o=a.events
if(o){delete s.handle,s.events={}
for(i in o)for(r=0,n=o[i].length;n>r;r++)ne.event.add(t,i,o[i][r])}s.data&&(s.data=ne.extend({},s.data))}}function T(e,t){var i,r,n
if(1===t.nodeType){if(i=t.nodeName.toLowerCase(),!ie.noCloneEvent&&t[ne.expando]){n=ne._data(t)
for(r in n.events)ne.removeEvent(t,r,n.handle)
t.removeAttribute(ne.expando)}"script"===i&&t.text!==e.text?(L(t).text=e.text,b(t)):"object"===i?(t.parentNode&&(t.outerHTML=e.outerHTML),ie.html5Clone&&e.innerHTML&&!ne.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===i&&Ne.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===i?t.defaultSelected=t.selected=e.defaultSelected:("input"===i||"textarea"===i)&&(t.defaultValue=e.defaultValue)}}function G(t,i){var r,n=ne(i.createElement(t)).appendTo(i.body),a=e.getDefaultComputedStyle&&(r=e.getDefaultComputedStyle(n[0]))?r.display:ne.css(n[0],"display")
return n.detach(),a}function M(e){var t=fe,i=Je[e]
return i||(i=G(e,t),"none"!==i&&i||(Qe=(Qe||ne("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Qe[0].contentWindow||Qe[0].contentDocument).document,t.write(),t.close(),i=G(e,t),Qe.detach()),Je[e]=i),i}function y(e,t){return{get:function(){var i=e()
return null!=i?i?void delete this.get:(this.get=t).apply(this,arguments):void 0}}}function E(e,t){if(t in e)return t
for(var i=t.charAt(0).toUpperCase()+t.slice(1),r=t,n=dt.length;n--;)if(t=dt[n]+i,t in e)return t
return r}function A(e,t){for(var i,r,n,a=[],s=0,o=e.length;o>s;s++)r=e[s],r.style&&(a[s]=ne._data(r,"olddisplay"),i=r.style.display,t?(a[s]||"none"!==i||(r.style.display=""),""===r.style.display&&Ae(r)&&(a[s]=ne._data(r,"olddisplay",M(r.nodeName)))):(n=Ae(r),(i&&"none"!==i||!n)&&ne._data(r,"olddisplay",n?i:ne.css(r,"display"))))
for(s=0;o>s;s++)r=e[s],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?a[s]||"":"none"))
return e}function P(e,t,i){var r=ut.exec(t)
return r?Math.max(0,r[1]-(i||0))+(r[2]||"px"):t}function N(e,t,i,r,n){for(var a=i===(r?"border":"content")?4:"width"===t?1:0,s=0;4>a;a+=2)"margin"===i&&(s+=ne.css(e,i+Ee[a],!0,n)),r?("content"===i&&(s-=ne.css(e,"padding"+Ee[a],!0,n)),"margin"!==i&&(s-=ne.css(e,"border"+Ee[a]+"Width",!0,n))):(s+=ne.css(e,"padding"+Ee[a],!0,n),"padding"!==i&&(s+=ne.css(e,"border"+Ee[a]+"Width",!0,n)))
return s}function C(e,t,i){var r=!0,n="width"===t?e.offsetWidth:e.offsetHeight,a=et(e),s=ie.boxSizing&&"border-box"===ne.css(e,"boxSizing",!1,a)
if(0>=n||null==n){if(n=tt(e,t,a),(0>n||null==n)&&(n=e.style[t]),rt.test(n))return n
r=s&&(ie.boxSizingReliable()||n===e.style[t]),n=parseFloat(n)||0}return n+N(e,t,i||(s?"border":"content"),r,a)+"px"}function D(e,t,i,r,n){return new D.prototype.init(e,t,i,r,n)}function R(){return setTimeout(function(){pt=void 0}),pt=ne.now()}function I(e,t){var i,r={height:e},n=0
for(t=t?1:0;4>n;n+=2-t)i=Ee[n],r["margin"+i]=r["padding"+i]=e
return t&&(r.opacity=r.width=e),r}function w(e,t,i){for(var r,n=(Lt[t]||[]).concat(Lt["*"]),a=0,s=n.length;s>a;a++)if(r=n[a].call(i,t,e))return r}function O(e,t,i){var r,n,a,s,o,u,c,l,h=this,d={},p=e.style,f=e.nodeType&&Ae(e),_=ne._data(e,"fxshow")
i.queue||(o=ne._queueHooks(e,"fx"),null==o.unqueued&&(o.unqueued=0,u=o.empty.fire,o.empty.fire=function(){o.unqueued||u()}),o.unqueued++,h.always(function(){h.always(function(){o.unqueued--,ne.queue(e,"fx").length||o.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],c=ne.css(e,"display"),l="none"===c?ne._data(e,"olddisplay")||M(e.nodeName):c,"inline"===l&&"none"===ne.css(e,"float")&&(ie.inlineBlockNeedsLayout&&"inline"!==M(e.nodeName)?p.zoom=1:p.display="inline-block")),i.overflow&&(p.overflow="hidden",ie.shrinkWrapBlocks()||h.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}))
for(r in t)if(n=t[r],_t.exec(n)){if(delete t[r],a=a||"toggle"===n,n===(f?"hide":"show")){if("show"!==n||!_||void 0===_[r])continue
f=!0}d[r]=_&&_[r]||ne.style(e,r)}else c=void 0
if(ne.isEmptyObject(d))"inline"===("none"===c?M(e.nodeName):c)&&(p.display=c)
else{_?"hidden"in _&&(f=_.hidden):_=ne._data(e,"fxshow",{}),a&&(_.hidden=!f),f?ne(e).show():h.done(function(){ne(e).hide()}),h.done(function(){var t
ne._removeData(e,"fxshow")
for(t in d)ne.style(e,t,d[t])})
for(r in d)s=w(f?_[r]:0,r,h),r in _||(_[r]=s.start,f&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}}function F(e,t){var i,r,n,a,s
for(i in e)if(r=ne.camelCase(i),n=t[r],a=e[i],ne.isArray(a)&&(n=a[1],a=e[i]=a[0]),i!==r&&(e[r]=a,delete e[i]),s=ne.cssHooks[r],s&&"expand"in s){a=s.expand(a),delete e[r]
for(i in a)i in e||(e[i]=a[i],t[i]=n)}else t[r]=n}function j(e,t,i){var r,n,a=0,s=St.length,o=ne.Deferred().always(function(){delete u.elem}),u=function(){if(n)return!1
for(var t=pt||R(),i=Math.max(0,c.startTime+c.duration-t),r=i/c.duration||0,a=1-r,s=0,u=c.tweens.length;u>s;s++)c.tweens[s].run(a)
return o.notifyWith(e,[c,a,i]),1>a&&u?i:(o.resolveWith(e,[c]),!1)},c=o.promise({elem:e,props:ne.extend({},t),opts:ne.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:pt||R(),duration:i.duration,tweens:[],createTween:function(t,i){var r=ne.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing)
return c.tweens.push(r),r},stop:function(t){var i=0,r=t?c.tweens.length:0
if(n)return this
for(n=!0;r>i;i++)c.tweens[i].run(1)
return t?o.resolveWith(e,[c,t]):o.rejectWith(e,[c,t]),this}}),l=c.props
for(F(l,c.opts.specialEasing);s>a;a++)if(r=St[a].call(c,e,l,c.opts))return r
return ne.map(l,w,c),ne.isFunction(c.opts.start)&&c.opts.start.call(e,c),ne.fx.timer(ne.extend(u,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function U(e){return function(t,i){"string"!=typeof t&&(i=t,t="*")
var r,n=0,a=t.toLowerCase().match(Le)||[]
if(ne.isFunction(i))for(;r=a[n++];)"+"===r.charAt(0)?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(i)):(e[r]=e[r]||[]).push(i)}}function B(e,t,i,r){function n(o){var u
return a[o]=!0,ne.each(e[o]||[],function(e,o){var c=o(t,i,r)
return"string"!=typeof c||s||a[c]?s?!(u=c):void 0:(t.dataTypes.unshift(c),n(c),!1)}),u}var a={},s=e===Wt
return n(t.dataTypes[0])||!a["*"]&&n("*")}function V(e,t){var i,r,n=ne.ajaxSettings.flatOptions||{}
for(r in t)void 0!==t[r]&&((n[r]?e:i||(i={}))[r]=t[r])
return i&&ne.extend(!0,e,i),e}function k(e,t,i){for(var r,n,a,s,o=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"))
if(n)for(s in o)if(o[s]&&o[s].test(n)){u.unshift(s)
break}if(u[0]in i)a=u[0]
else{for(s in i){if(!u[0]||e.converters[s+" "+u[0]]){a=s
break}r||(r=s)}a=a||r}return a?(a!==u[0]&&u.unshift(a),i[a]):void 0}function W(e,t,i,r){var n,a,s,o,u,c={},l=e.dataTypes.slice()
if(l[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s]
for(a=l.shift();a;)if(e.responseFields[a]&&(i[e.responseFields[a]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=a,a=l.shift())if("*"===a)a=u
else if("*"!==u&&u!==a){if(s=c[u+" "+a]||c["* "+a],!s)for(n in c)if(o=n.split(" "),o[1]===a&&(s=c[u+" "+o[0]]||c["* "+o[0]])){s===!0?s=c[n]:c[n]!==!0&&(a=o[0],l.unshift(o[1]))
break}if(s!==!0)if(s&&e["throws"])t=s(t)
else try{t=s(t)}catch(h){return{state:"parsererror",error:s?h:"No conversion from "+u+" to "+a}}}return{state:"success",data:t}}function X(e,t,i,r){var n
if(ne.isArray(t))ne.each(t,function(t,n){i||Yt.test(e)?r(e,n):X(e+"["+("object"==typeof n?t:"")+"]",n,i,r)})
else if(i||"object"!==ne.type(t))r(e,t)
else for(n in t)X(e+"["+n+"]",t[n],i,r)}function H(){try{return new e.XMLHttpRequest}catch(t){}}function q(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Y(e){return ne.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var $=[],z=$.slice,Z=$.concat,K=$.push,Q=$.indexOf,J={},ee=J.toString,te=J.hasOwnProperty,ie={},re="1.11.1",ne=function(e,t){return new ne.fn.init(e,t)},ae=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,se=/^-ms-/,oe=/-([\da-z])/gi,ue=function(e,t){return t.toUpperCase()}
ne.fn=ne.prototype={jquery:re,constructor:ne,selector:"",length:0,toArray:function(){return z.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:z.call(this)},pushStack:function(e){var t=ne.merge(this.constructor(),e)
return t.prevObject=this,t.context=this.context,t},each:function(e,t){return ne.each(this,e,t)},map:function(e){return this.pushStack(ne.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(z.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0)
return this.pushStack(i>=0&&t>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:K,sort:$.sort,splice:$.splice},ne.extend=ne.fn.extend=function(){var e,t,i,r,n,a,s=arguments[0]||{},o=1,u=arguments.length,c=!1
for("boolean"==typeof s&&(c=s,s=arguments[o]||{},o++),"object"==typeof s||ne.isFunction(s)||(s={}),o===u&&(s=this,o--);u>o;o++)if(null!=(n=arguments[o]))for(r in n)e=s[r],i=n[r],s!==i&&(c&&i&&(ne.isPlainObject(i)||(t=ne.isArray(i)))?(t?(t=!1,a=e&&ne.isArray(e)?e:[]):a=e&&ne.isPlainObject(e)?e:{},s[r]=ne.extend(c,a,i)):void 0!==i&&(s[r]=i))
return s},ne.extend({expando:"jQuery"+(re+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===ne.type(e)},isArray:Array.isArray||function(e){return"array"===ne.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!ne.isArray(e)&&e-parseFloat(e)>=0},isEmptyObject:function(e){var t
for(t in e)return!1
return!0},isPlainObject:function(e){var t
if(!e||"object"!==ne.type(e)||e.nodeType||ne.isWindow(e))return!1
try{if(e.constructor&&!te.call(e,"constructor")&&!te.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}if(ie.ownLast)for(t in e)return te.call(e,t)
for(t in e);return void 0===t||te.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?J[ee.call(e)]||"object":typeof e},globalEval:function(t){t&&ne.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(se,"ms-").replace(oe,ue)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,r){var n,a=0,s=e.length,o=i(e)
if(r){if(o)for(;s>a&&(n=t.apply(e[a],r),n!==!1);a++);else for(a in e)if(n=t.apply(e[a],r),n===!1)break}else if(o)for(;s>a&&(n=t.call(e[a],a,e[a]),n!==!1);a++);else for(a in e)if(n=t.call(e[a],a,e[a]),n===!1)break
return e},trim:function(e){return null==e?"":(e+"").replace(ae,"")},makeArray:function(e,t){var r=t||[]
return null!=e&&(i(Object(e))?ne.merge(r,"string"==typeof e?[e]:e):K.call(r,e)),r},inArray:function(e,t,i){var r
if(t){if(Q)return Q.call(t,e,i)
for(r=t.length,i=i?0>i?Math.max(0,r+i):i:0;r>i;i++)if(i in t&&t[i]===e)return i}return-1},merge:function(e,t){for(var i=+t.length,r=0,n=e.length;i>r;)e[n++]=t[r++]
if(i!==i)for(;void 0!==t[r];)e[n++]=t[r++]
return e.length=n,e},grep:function(e,t,i){for(var r,n=[],a=0,s=e.length,o=!i;s>a;a++)r=!t(e[a],a),r!==o&&n.push(e[a])
return n},map:function(e,t,r){var n,a=0,s=e.length,o=i(e),u=[]
if(o)for(;s>a;a++)n=t(e[a],a,r),null!=n&&u.push(n)
else for(a in e)n=t(e[a],a,r),null!=n&&u.push(n)
return Z.apply([],u)},guid:1,proxy:function(e,t){var i,r,n
return"string"==typeof t&&(n=e[t],t=e,e=n),ne.isFunction(e)?(i=z.call(arguments,2),r=function(){return e.apply(t||this,i.concat(z.call(arguments)))},r.guid=e.guid=e.guid||ne.guid++,r):void 0},now:function(){return+new Date},support:ie}),ne.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){J["[object "+t+"]"]=t.toLowerCase()})
var ce=function(e){function t(e,t,i,r){var n,a,s,o,u,c,h,p,f,_
if((t?t.ownerDocument||t:B)!==D&&C(t),t=t||D,i=i||[],!e||"string"!=typeof e)return i
if(1!==(o=t.nodeType)&&9!==o)return[]
if(I&&!r){if(n=Se.exec(e))if(s=n[1]){if(9===o){if(a=t.getElementById(s),!a||!a.parentNode)return i
if(a.id===s)return i.push(a),i}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(s))&&j(t,a)&&a.id===s)return i.push(a),i}else{if(n[2])return J.apply(i,t.getElementsByTagName(e)),i
if((s=n[3])&&v.getElementsByClassName&&t.getElementsByClassName)return J.apply(i,t.getElementsByClassName(s)),i}if(v.qsa&&(!w||!w.test(e))){if(p=h=U,f=t,_=9===o&&e,1===o&&"object"!==t.nodeName.toLowerCase()){for(c=M(e),(h=t.getAttribute("id"))?p=h.replace(be,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",u=c.length;u--;)c[u]=p+d(c[u])
f=Le.test(e)&&l(t.parentNode)||t,_=c.join(",")}if(_)try{return J.apply(i,f.querySelectorAll(_)),i}catch(g){}finally{h||t.removeAttribute("id")}}}return E(e.replace(ue,"$1"),t,i,r)}function i(){function e(i,r){return t.push(i+" ")>x.cacheLength&&delete e[t.shift()],e[i+" "]=r}var t=[]
return e}function r(e){return e[U]=!0,e}function n(e){var t=D.createElement("div")
try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function a(e,t){for(var i=e.split("|"),r=e.length;r--;)x.attrHandle[i[r]]=t}function s(e,t){var i=t&&e,r=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||$)-(~e.sourceIndex||$)
if(r)return r
if(i)for(;i=i.nextSibling;)if(i===t)return-1
return e?1:-1}function o(e){return function(t){var i=t.nodeName.toLowerCase()
return"input"===i&&t.type===e}}function u(e){return function(t){var i=t.nodeName.toLowerCase()
return("input"===i||"button"===i)&&t.type===e}}function c(e){return r(function(t){return t=+t,r(function(i,r){for(var n,a=e([],i.length,t),s=a.length;s--;)i[n=a[s]]&&(i[n]=!(r[n]=i[n]))})})}function l(e){return e&&typeof e.getElementsByTagName!==Y&&e}function h(){}function d(e){for(var t=0,i=e.length,r="";i>t;t++)r+=e[t].value
return r}function p(e,t,i){var r=t.dir,n=i&&"parentNode"===r,a=k++
return t.first?function(t,i,a){for(;t=t[r];)if(1===t.nodeType||n)return e(t,i,a)}:function(t,i,s){var o,u,c=[V,a]
if(s){for(;t=t[r];)if((1===t.nodeType||n)&&e(t,i,s))return!0}else for(;t=t[r];)if(1===t.nodeType||n){if(u=t[U]||(t[U]={}),(o=u[r])&&o[0]===V&&o[1]===a)return c[2]=o[2]
if(u[r]=c,c[2]=e(t,i,s))return!0}}}function f(e){return e.length>1?function(t,i,r){for(var n=e.length;n--;)if(!e[n](t,i,r))return!1
return!0}:e[0]}function _(e,i,r){for(var n=0,a=i.length;a>n;n++)t(e,i[n],r)
return r}function g(e,t,i,r,n){for(var a,s=[],o=0,u=e.length,c=null!=t;u>o;o++)(a=e[o])&&(!i||i(a,r,n))&&(s.push(a),c&&t.push(o))
return s}function m(e,t,i,n,a,s){return n&&!n[U]&&(n=m(n)),a&&!a[U]&&(a=m(a,s)),r(function(r,s,o,u){var c,l,h,d=[],p=[],f=s.length,m=r||_(t||"*",o.nodeType?[o]:o,[]),S=!e||!r&&t?m:g(m,d,e,o,u),L=i?a||(r?e:f||n)?[]:s:S
if(i&&i(S,L,o,u),n)for(c=g(L,p),n(c,[],o,u),l=c.length;l--;)(h=c[l])&&(L[p[l]]=!(S[p[l]]=h))
if(r){if(a||e){if(a){for(c=[],l=L.length;l--;)(h=L[l])&&c.push(S[l]=h)
a(null,L=[],c,u)}for(l=L.length;l--;)(h=L[l])&&(c=a?te.call(r,h):d[l])>-1&&(r[c]=!(s[c]=h))}}else L=g(L===s?L.splice(f,L.length):L),a?a(null,s,L,u):J.apply(s,L)})}function S(e){for(var t,i,r,n=e.length,a=x.relative[e[0].type],s=a||x.relative[" "],o=a?1:0,u=p(function(e){return e===t},s,!0),c=p(function(e){return te.call(t,e)>-1},s,!0),l=[function(e,i,r){return!a&&(r||i!==A)||((t=i).nodeType?u(e,i,r):c(e,i,r))}];n>o;o++)if(i=x.relative[e[o].type])l=[p(f(l),i)]
else{if(i=x.filter[e[o].type].apply(null,e[o].matches),i[U]){for(r=++o;n>r&&!x.relative[e[r].type];r++);return m(o>1&&f(l),o>1&&d(e.slice(0,o-1).concat({value:" "===e[o-2].type?"*":""})).replace(ue,"$1"),i,r>o&&S(e.slice(o,r)),n>r&&S(e=e.slice(r)),n>r&&d(e))}l.push(i)}return f(l)}function L(e,i){var n=i.length>0,a=e.length>0,s=function(r,s,o,u,c){var l,h,d,p=0,f="0",_=r&&[],m=[],S=A,L=r||a&&x.find.TAG("*",c),b=V+=null==S?1:Math.random()||.1,v=L.length
for(c&&(A=s!==D&&s);f!==v&&null!=(l=L[f]);f++){if(a&&l){for(h=0;d=e[h++];)if(d(l,s,o)){u.push(l)
break}c&&(V=b)}n&&((l=!d&&l)&&p--,r&&_.push(l))}if(p+=f,n&&f!==p){for(h=0;d=i[h++];)d(_,m,s,o)
if(r){if(p>0)for(;f--;)_[f]||m[f]||(m[f]=K.call(u))
m=g(m)}J.apply(u,m),c&&!r&&m.length>0&&p+i.length>1&&t.uniqueSort(u)}return c&&(V=b,A=S),_}
return n?r(s):s}var b,v,x,T,G,M,y,E,A,P,N,C,D,R,I,w,O,F,j,U="sizzle"+-new Date,B=e.document,V=0,k=0,W=i(),X=i(),H=i(),q=function(e,t){return e===t&&(N=!0),0},Y="undefined",$=1<<31,z={}.hasOwnProperty,Z=[],K=Z.pop,Q=Z.push,J=Z.push,ee=Z.slice,te=Z.indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]===e)return t
return-1},ie="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",re="[\\x20\\t\\r\\n\\f]",ne="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ae=ne.replace("w","w#"),se="\\["+re+"*("+ne+")(?:"+re+"*([*^$|!~]?=)"+re+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ae+"))|)"+re+"*\\]",oe=":("+ne+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+se+")*)|.*)\\)|)",ue=new RegExp("^"+re+"+|((?:^|[^\\\\])(?:\\\\.)*)"+re+"+$","g"),ce=new RegExp("^"+re+"*,"+re+"*"),le=new RegExp("^"+re+"*([>+~]|"+re+")"+re+"*"),he=new RegExp("="+re+"*([^\\]'\"]*?)"+re+"*\\]","g"),de=new RegExp(oe),pe=new RegExp("^"+ae+"$"),fe={ID:new RegExp("^#("+ne+")"),CLASS:new RegExp("^\\.("+ne+")"),TAG:new RegExp("^("+ne.replace("w","w*")+")"),ATTR:new RegExp("^"+se),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+re+"*(even|odd|(([+-]|)(\\d*)n|)"+re+"*(?:([+-]|)"+re+"*(\\d+)|))"+re+"*\\)|)","i"),bool:new RegExp("^(?:"+ie+")$","i"),needsContext:new RegExp("^"+re+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+re+"*((?:-\\d)?\\d*)"+re+"*\\)|)(?=[^-]|$)","i")},_e=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,me=/^[^{]+\{\s*\[native \w/,Se=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Le=/[+~]/,be=/'|\\/g,ve=new RegExp("\\\\([\\da-f]{1,6}"+re+"?|("+re+")|.)","ig"),xe=function(e,t,i){var r="0x"+t-65536
return r!==r||i?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)}
try{J.apply(Z=ee.call(B.childNodes),B.childNodes),Z[B.childNodes.length].nodeType}catch(Te){J={apply:Z.length?function(e,t){Q.apply(e,ee.call(t))}:function(e,t){for(var i=e.length,r=0;e[i++]=t[r++];);e.length=i-1}}}v=t.support={},G=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement
return t?"HTML"!==t.nodeName:!1},C=t.setDocument=function(e){var t,i=e?e.ownerDocument||e:B,r=i.defaultView
return i!==D&&9===i.nodeType&&i.documentElement?(D=i,R=i.documentElement,I=!G(i),r&&r!==r.top&&(r.addEventListener?r.addEventListener("unload",function(){C()},!1):r.attachEvent&&r.attachEvent("onunload",function(){C()})),v.attributes=n(function(e){return e.className="i",!e.getAttribute("className")}),v.getElementsByTagName=n(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),v.getElementsByClassName=me.test(i.getElementsByClassName)&&n(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),v.getById=n(function(e){return R.appendChild(e).id=U,!i.getElementsByName||!i.getElementsByName(U).length}),v.getById?(x.find.ID=function(e,t){if(typeof t.getElementById!==Y&&I){var i=t.getElementById(e)
return i&&i.parentNode?[i]:[]}},x.filter.ID=function(e){var t=e.replace(ve,xe)
return function(e){return e.getAttribute("id")===t}}):(delete x.find.ID,x.filter.ID=function(e){var t=e.replace(ve,xe)
return function(e){var i=typeof e.getAttributeNode!==Y&&e.getAttributeNode("id")
return i&&i.value===t}}),x.find.TAG=v.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==Y?t.getElementsByTagName(e):void 0}:function(e,t){var i,r=[],n=0,a=t.getElementsByTagName(e)
if("*"===e){for(;i=a[n++];)1===i.nodeType&&r.push(i)
return r}return a},x.find.CLASS=v.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==Y&&I?t.getElementsByClassName(e):void 0},O=[],w=[],(v.qsa=me.test(i.querySelectorAll))&&(n(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&w.push("[*^$]="+re+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||w.push("\\["+re+"*(?:value|"+ie+")"),e.querySelectorAll(":checked").length||w.push(":checked")}),n(function(e){var t=i.createElement("input")
t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&w.push("name"+re+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||w.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),w.push(",.*:")})),(v.matchesSelector=me.test(F=R.matches||R.webkitMatchesSelector||R.mozMatchesSelector||R.oMatchesSelector||R.msMatchesSelector))&&n(function(e){v.disconnectedMatch=F.call(e,"div"),F.call(e,"[s!='']:x"),O.push("!=",oe)}),w=w.length&&new RegExp(w.join("|")),O=O.length&&new RegExp(O.join("|")),t=me.test(R.compareDocumentPosition),j=t||me.test(R.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode
return e===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0
return!1},q=t?function(e,t){if(e===t)return N=!0,0
var r=!e.compareDocumentPosition-!t.compareDocumentPosition
return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!v.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===B&&j(B,e)?-1:t===i||t.ownerDocument===B&&j(B,t)?1:P?te.call(P,e)-te.call(P,t):0:4&r?-1:1)}:function(e,t){if(e===t)return N=!0,0
var r,n=0,a=e.parentNode,o=t.parentNode,u=[e],c=[t]
if(!a||!o)return e===i?-1:t===i?1:a?-1:o?1:P?te.call(P,e)-te.call(P,t):0
if(a===o)return s(e,t)
for(r=e;r=r.parentNode;)u.unshift(r)
for(r=t;r=r.parentNode;)c.unshift(r)
for(;u[n]===c[n];)n++
return n?s(u[n],c[n]):u[n]===B?-1:c[n]===B?1:0},i):D},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==D&&C(e),i=i.replace(he,"='$1']"),!(!v.matchesSelector||!I||O&&O.test(i)||w&&w.test(i)))try{var r=F.call(e,i)
if(r||v.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(n){}return t(i,D,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==D&&C(e),j(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==D&&C(e)
var i=x.attrHandle[t.toLowerCase()],r=i&&z.call(x.attrHandle,t.toLowerCase())?i(e,t,!I):void 0
return void 0!==r?r:v.attributes||!I?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],r=0,n=0
if(N=!v.detectDuplicates,P=!v.sortStable&&e.slice(0),e.sort(q),N){for(;t=e[n++];)t===e[n]&&(r=i.push(n))
for(;r--;)e.splice(i[r],1)}return P=null,e},T=t.getText=function(e){var t,i="",r=0,n=e.nodeType
if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent
for(e=e.firstChild;e;e=e.nextSibling)i+=T(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[r++];)i+=T(t)
return i},x=t.selectors={cacheLength:50,createPseudo:r,match:fe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ve,xe),e[3]=(e[3]||e[4]||e[5]||"").replace(ve,xe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2]
return fe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&de.test(i)&&(t=M(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ve,xe).toLowerCase()
return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=W[e+" "]
return t||(t=new RegExp("(^|"+re+")"+e+"("+re+"|$)"))&&W(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==Y&&e.getAttribute("class")||"")})},ATTR:function(e,i,r){return function(n){var a=t.attr(n,e)
return null==a?"!="===i:i?(a+="","="===i?a===r:"!="===i?a!==r:"^="===i?r&&0===a.indexOf(r):"*="===i?r&&a.indexOf(r)>-1:"$="===i?r&&a.slice(-r.length)===r:"~="===i?(" "+a+" ").indexOf(r)>-1:"|="===i?a===r||a.slice(0,r.length+1)===r+"-":!1):!0}},CHILD:function(e,t,i,r,n){var a="nth"!==e.slice(0,3),s="last"!==e.slice(-4),o="of-type"===t
return 1===r&&0===n?function(e){return!!e.parentNode}:function(t,i,u){var c,l,h,d,p,f,_=a!==s?"nextSibling":"previousSibling",g=t.parentNode,m=o&&t.nodeName.toLowerCase(),S=!u&&!o
if(g){if(a){for(;_;){for(h=t;h=h[_];)if(o?h.nodeName.toLowerCase()===m:1===h.nodeType)return!1
f=_="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?g.firstChild:g.lastChild],s&&S){for(l=g[U]||(g[U]={}),c=l[e]||[],p=c[0]===V&&c[1],d=c[0]===V&&c[2],h=p&&g.childNodes[p];h=++p&&h&&h[_]||(d=p=0)||f.pop();)if(1===h.nodeType&&++d&&h===t){l[e]=[V,p,d]
break}}else if(S&&(c=(t[U]||(t[U]={}))[e])&&c[0]===V)d=c[1]
else for(;(h=++p&&h&&h[_]||(d=p=0)||f.pop())&&((o?h.nodeName.toLowerCase()!==m:1!==h.nodeType)||!++d||(S&&((h[U]||(h[U]={}))[e]=[V,d]),h!==t)););return d-=n,d===r||d%r===0&&d/r>=0}}},PSEUDO:function(e,i){var n,a=x.pseudos[e]||x.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e)
return a[U]?a(i):a.length>1?(n=[e,e,"",i],x.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,n=a(e,i),s=n.length;s--;)r=te.call(e,n[s]),e[r]=!(t[r]=n[s])}):function(e){return a(e,0,n)}):a}},pseudos:{not:r(function(e){var t=[],i=[],n=y(e.replace(ue,"$1"))
return n[U]?r(function(e,t,i,r){for(var a,s=n(e,null,r,[]),o=e.length;o--;)(a=s[o])&&(e[o]=!(t[o]=a))}):function(e,r,a){return t[0]=e,n(t,null,a,i),!i.pop()}}),has:r(function(e){return function(i){return t(e,i).length>0}}),contains:r(function(e){return function(t){return(t.textContent||t.innerText||T(t)).indexOf(e)>-1}}),lang:r(function(e){return pe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(ve,xe).toLowerCase(),function(t){var i
do if(i=I?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-")
while((t=t.parentNode)&&1===t.nodeType)
return!1}}),target:function(t){var i=e.location&&e.location.hash
return i&&i.slice(1)===t.id},root:function(e){return e===R},focus:function(e){return e===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase()
return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1
return!0},parent:function(e){return!x.pseudos.empty(e)},header:function(e){return ge.test(e.nodeName)},input:function(e){return _e.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase()
return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t
return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,i){return[0>i?i+t:i]}),even:c(function(e,t){for(var i=0;t>i;i+=2)e.push(i)
return e}),odd:c(function(e,t){for(var i=1;t>i;i+=2)e.push(i)
return e}),lt:c(function(e,t,i){for(var r=0>i?i+t:i;--r>=0;)e.push(r)
return e}),gt:c(function(e,t,i){for(var r=0>i?i+t:i;++r<t;)e.push(r)
return e})}},x.pseudos.nth=x.pseudos.eq
for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[b]=o(b)
for(b in{submit:!0,reset:!0})x.pseudos[b]=u(b)
return h.prototype=x.filters=x.pseudos,x.setFilters=new h,M=t.tokenize=function(e,i){var r,n,a,s,o,u,c,l=X[e+" "]
if(l)return i?0:l.slice(0)
for(o=e,u=[],c=x.preFilter;o;){(!r||(n=ce.exec(o)))&&(n&&(o=o.slice(n[0].length)||o),u.push(a=[])),r=!1,(n=le.exec(o))&&(r=n.shift(),a.push({value:r,type:n[0].replace(ue," ")}),o=o.slice(r.length))
for(s in x.filter)!(n=fe[s].exec(o))||c[s]&&!(n=c[s](n))||(r=n.shift(),a.push({value:r,type:s,matches:n}),o=o.slice(r.length))
if(!r)break}return i?o.length:o?t.error(e):X(e,u).slice(0)},y=t.compile=function(e,t){var i,r=[],n=[],a=H[e+" "]
if(!a){for(t||(t=M(e)),i=t.length;i--;)a=S(t[i]),a[U]?r.push(a):n.push(a)
a=H(e,L(n,r)),a.selector=e}return a},E=t.select=function(e,t,i,r){var n,a,s,o,u,c="function"==typeof e&&e,h=!r&&M(e=c.selector||e)
if(i=i||[],1===h.length){if(a=h[0]=h[0].slice(0),a.length>2&&"ID"===(s=a[0]).type&&v.getById&&9===t.nodeType&&I&&x.relative[a[1].type]){if(t=(x.find.ID(s.matches[0].replace(ve,xe),t)||[])[0],!t)return i
c&&(t=t.parentNode),e=e.slice(a.shift().value.length)}for(n=fe.needsContext.test(e)?0:a.length;n--&&(s=a[n],!x.relative[o=s.type]);)if((u=x.find[o])&&(r=u(s.matches[0].replace(ve,xe),Le.test(a[0].type)&&l(t.parentNode)||t))){if(a.splice(n,1),e=r.length&&d(a),!e)return J.apply(i,r),i
break}}return(c||y(e,h))(r,t,!I,i,Le.test(e)&&l(t.parentNode)||t),i},v.sortStable=U.split("").sort(q).join("")===U,v.detectDuplicates=!!N,C(),v.sortDetached=n(function(e){return 1&e.compareDocumentPosition(D.createElement("div"))}),n(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||a("type|href|height|width",function(e,t,i){return i?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),v.attributes&&n(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||a("value",function(e,t,i){return i||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),n(function(e){return null==e.getAttribute("disabled")})||a(ie,function(e,t,i){var r
return i?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(e)
ne.find=ce,ne.expr=ce.selectors,ne.expr[":"]=ne.expr.pseudos,ne.unique=ce.uniqueSort,ne.text=ce.getText,ne.isXMLDoc=ce.isXML,ne.contains=ce.contains
var le=ne.expr.match.needsContext,he=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,de=/^.[^:#\[\.,]*$/
ne.filter=function(e,t,i){var r=t[0]
return i&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ne.find.matchesSelector(r,e)?[r]:[]:ne.find.matches(e,ne.grep(t,function(e){return 1===e.nodeType}))},ne.fn.extend({find:function(e){var t,i=[],r=this,n=r.length
if("string"!=typeof e)return this.pushStack(ne(e).filter(function(){for(t=0;n>t;t++)if(ne.contains(r[t],this))return!0}))
for(t=0;n>t;t++)ne.find(e,r[t],i)
return i=this.pushStack(n>1?ne.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(r(this,e||[],!1))},not:function(e){return this.pushStack(r(this,e||[],!0))},is:function(e){return!!r(this,"string"==typeof e&&le.test(e)?ne(e):e||[],!1).length}})
var pe,fe=e.document,_e=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ge=ne.fn.init=function(e,t){var i,r
if(!e)return this
if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:_e.exec(e),!i||!i[1]&&t)return!t||t.jquery?(t||pe).find(e):this.constructor(t).find(e)
if(i[1]){if(t=t instanceof ne?t[0]:t,ne.merge(this,ne.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:fe,!0)),he.test(i[1])&&ne.isPlainObject(t))for(i in t)ne.isFunction(this[i])?this[i](t[i]):this.attr(i,t[i])
return this}if(r=fe.getElementById(i[2]),r&&r.parentNode){if(r.id!==i[2])return pe.find(e)
this.length=1,this[0]=r}return this.context=fe,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):ne.isFunction(e)?"undefined"!=typeof pe.ready?pe.ready(e):e(ne):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),ne.makeArray(e,this))}
ge.prototype=ne.fn,pe=ne(fe)
var me=/^(?:parents|prev(?:Until|All))/,Se={children:!0,contents:!0,next:!0,prev:!0}
ne.extend({dir:function(e,t,i){for(var r=[],n=e[t];n&&9!==n.nodeType&&(void 0===i||1!==n.nodeType||!ne(n).is(i));)1===n.nodeType&&r.push(n),n=n[t]
return r},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e)
return i}}),ne.fn.extend({has:function(e){var t,i=ne(e,this),r=i.length
return this.filter(function(){for(t=0;r>t;t++)if(ne.contains(this,i[t]))return!0})},closest:function(e,t){for(var i,r=0,n=this.length,a=[],s=le.test(e)||"string"!=typeof e?ne(e,t||this.context):0;n>r;r++)for(i=this[r];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&ne.find.matchesSelector(i,e))){a.push(i)
break}return this.pushStack(a.length>1?ne.unique(a):a)},index:function(e){return e?"string"==typeof e?ne.inArray(this[0],ne(e)):ne.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ne.unique(ne.merge(this.get(),ne(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ne.each({parent:function(e){var t=e.parentNode
return t&&11!==t.nodeType?t:null},parents:function(e){return ne.dir(e,"parentNode")},parentsUntil:function(e,t,i){return ne.dir(e,"parentNode",i)},next:function(e){return n(e,"nextSibling")},prev:function(e){return n(e,"previousSibling")},nextAll:function(e){return ne.dir(e,"nextSibling")},prevAll:function(e){return ne.dir(e,"previousSibling")},nextUntil:function(e,t,i){return ne.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return ne.dir(e,"previousSibling",i)},siblings:function(e){return ne.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ne.sibling(e.firstChild)},contents:function(e){return ne.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ne.merge([],e.childNodes)}},function(e,t){ne.fn[e]=function(i,r){var n=ne.map(this,t,i)
return"Until"!==e.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=ne.filter(r,n)),this.length>1&&(Se[e]||(n=ne.unique(n)),me.test(e)&&(n=n.reverse())),this.pushStack(n)}})
var Le=/\S+/g,be={}
ne.Callbacks=function(e){e="string"==typeof e?be[e]||a(e):ne.extend({},e)
var t,i,r,n,s,o,u=[],c=!e.once&&[],l=function(a){for(i=e.memory&&a,r=!0,s=o||0,o=0,n=u.length,t=!0;u&&n>s;s++)if(u[s].apply(a[0],a[1])===!1&&e.stopOnFalse){i=!1
break}t=!1,u&&(c?c.length&&l(c.shift()):i?u=[]:h.disable())},h={add:function(){if(u){var r=u.length
!function a(t){ne.each(t,function(t,i){var r=ne.type(i)
"function"===r?e.unique&&h.has(i)||u.push(i):i&&i.length&&"string"!==r&&a(i)})}(arguments),t?n=u.length:i&&(o=r,l(i))}return this},remove:function(){return u&&ne.each(arguments,function(e,i){for(var r;(r=ne.inArray(i,u,r))>-1;)u.splice(r,1),t&&(n>=r&&n--,s>=r&&s--)}),this},has:function(e){return e?ne.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],n=0,this},disable:function(){return u=c=i=void 0,this},disabled:function(){return!u},lock:function(){return c=void 0,i||h.disable(),this},locked:function(){return!c},fireWith:function(e,i){return!u||r&&!c||(i=i||[],i=[e,i.slice?i.slice():i],t?c.push(i):l(i)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!r}}
return h},ne.extend({Deferred:function(e){var t=[["resolve","done",ne.Callbacks("once memory"),"resolved"],["reject","fail",ne.Callbacks("once memory"),"rejected"],["notify","progress",ne.Callbacks("memory")]],i="pending",r={state:function(){return i},always:function(){return n.done(arguments).fail(arguments),this},then:function(){var e=arguments
return ne.Deferred(function(i){ne.each(t,function(t,a){var s=ne.isFunction(e[t])&&e[t]
n[a[1]](function(){var e=s&&s.apply(this,arguments)
e&&ne.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[a[0]+"With"](this===r?i.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?ne.extend(e,r):r}},n={}
return r.pipe=r.then,ne.each(t,function(e,a){var s=a[2],o=a[3]
r[a[1]]=s.add,o&&s.add(function(){i=o},t[1^e][2].disable,t[2][2].lock),n[a[0]]=function(){return n[a[0]+"With"](this===n?r:this,arguments),this},n[a[0]+"With"]=s.fireWith}),r.promise(n),e&&e.call(n,n),n},when:function(e){var t,i,r,n=0,a=z.call(arguments),s=a.length,o=1!==s||e&&ne.isFunction(e.promise)?s:0,u=1===o?e:ne.Deferred(),c=function(e,i,r){return function(n){i[e]=this,r[e]=arguments.length>1?z.call(arguments):n,r===t?u.notifyWith(i,r):--o||u.resolveWith(i,r)}}
if(s>1)for(t=new Array(s),i=new Array(s),r=new Array(s);s>n;n++)a[n]&&ne.isFunction(a[n].promise)?a[n].promise().done(c(n,r,a)).fail(u.reject).progress(c(n,i,t)):--o
return o||u.resolveWith(r,a),u.promise()}})
var ve
ne.fn.ready=function(e){return ne.ready.promise().done(e),this},ne.extend({isReady:!1,readyWait:1,holdReady:function(e){e?ne.readyWait++:ne.ready(!0)},ready:function(e){if(e===!0?!--ne.readyWait:!ne.isReady){if(!fe.body)return setTimeout(ne.ready)
ne.isReady=!0,e!==!0&&--ne.readyWait>0||(ve.resolveWith(fe,[ne]),ne.fn.triggerHandler&&(ne(fe).triggerHandler("ready"),ne(fe).off("ready")))}}}),ne.ready.promise=function(t){if(!ve)if(ve=ne.Deferred(),"complete"===fe.readyState)setTimeout(ne.ready)
else if(fe.addEventListener)fe.addEventListener("DOMContentLoaded",o,!1),e.addEventListener("load",o,!1)
else{fe.attachEvent("onreadystatechange",o),e.attachEvent("onload",o)
var i=!1
try{i=null==e.frameElement&&fe.documentElement}catch(r){}i&&i.doScroll&&!function n(){if(!ne.isReady){try{i.doScroll("left")}catch(e){return setTimeout(n,50)}s(),ne.ready()}}()}return ve.promise(t)}
var xe,Te="undefined"
for(xe in ne(ie))break
ie.ownLast="0"!==xe,ie.inlineBlockNeedsLayout=!1,ne(function(){var e,t,i,r
i=fe.getElementsByTagName("body")[0],i&&i.style&&(t=fe.createElement("div"),r=fe.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(r).appendChild(t),typeof t.style.zoom!==Te&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",ie.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(i.style.zoom=1)),i.removeChild(r))}),function(){var e=fe.createElement("div")
if(null==ie.deleteExpando){ie.deleteExpando=!0
try{delete e.test}catch(t){ie.deleteExpando=!1}}e=null}(),ne.acceptData=function(e){var t=ne.noData[(e.nodeName+" ").toLowerCase()],i=+e.nodeType||1
return 1!==i&&9!==i?!1:!t||t!==!0&&e.getAttribute("classid")===t}
var Ge=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Me=/([A-Z])/g
ne.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?ne.cache[e[ne.expando]]:e[ne.expando],!!e&&!c(e)},data:function(e,t,i){return l(e,t,i)},removeData:function(e,t){return h(e,t)},_data:function(e,t,i){return l(e,t,i,!0)},_removeData:function(e,t){return h(e,t,!0)}}),ne.fn.extend({data:function(e,t){var i,r,n,a=this[0],s=a&&a.attributes
if(void 0===e){if(this.length&&(n=ne.data(a),1===a.nodeType&&!ne._data(a,"parsedAttrs"))){for(i=s.length;i--;)s[i]&&(r=s[i].name,0===r.indexOf("data-")&&(r=ne.camelCase(r.slice(5)),u(a,r,n[r])))
ne._data(a,"parsedAttrs",!0)}return n}return"object"==typeof e?this.each(function(){ne.data(this,e)}):arguments.length>1?this.each(function(){ne.data(this,e,t)}):a?u(a,e,ne.data(a,e)):void 0},removeData:function(e){return this.each(function(){ne.removeData(this,e)})}}),ne.extend({queue:function(e,t,i){var r
return e?(t=(t||"fx")+"queue",r=ne._data(e,t),i&&(!r||ne.isArray(i)?r=ne._data(e,t,ne.makeArray(i)):r.push(i)),r||[]):void 0},dequeue:function(e,t){t=t||"fx"
var i=ne.queue(e,t),r=i.length,n=i.shift(),a=ne._queueHooks(e,t),s=function(){ne.dequeue(e,t)}
"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===t&&i.unshift("inprogress"),delete a.stop,n.call(e,s,a)),!r&&a&&a.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks"
return ne._data(e,i)||ne._data(e,i,{empty:ne.Callbacks("once memory").add(function(){ne._removeData(e,t+"queue"),ne._removeData(e,i)})})}}),ne.fn.extend({queue:function(e,t){var i=2
return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?ne.queue(this[0],e):void 0===t?this:this.each(function(){var i=ne.queue(this,e,t)
ne._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&ne.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ne.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,r=1,n=ne.Deferred(),a=this,s=this.length,o=function(){--r||n.resolveWith(a,[a])}
for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)i=ne._data(a[s],e+"queueHooks"),i&&i.empty&&(r++,i.empty.add(o))
return o(),n.promise(t)}})
var ye=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ee=["Top","Right","Bottom","Left"],Ae=function(e,t){return e=t||e,"none"===ne.css(e,"display")||!ne.contains(e.ownerDocument,e)},Pe=ne.access=function(e,t,i,r,n,a,s){var o=0,u=e.length,c=null==i
if("object"===ne.type(i)){n=!0
for(o in i)ne.access(e,t,o,i[o],!0,a,s)}else if(void 0!==r&&(n=!0,ne.isFunction(r)||(s=!0),c&&(s?(t.call(e,r),t=null):(c=t,t=function(e,t,i){return c.call(ne(e),i)})),t))for(;u>o;o++)t(e[o],i,s?r:r.call(e[o],o,t(e[o],i)))
return n?e:c?t.call(e):u?t(e[0],i):a},Ne=/^(?:checkbox|radio)$/i
!function(){var e=fe.createElement("input"),t=fe.createElement("div"),i=fe.createDocumentFragment()
if(t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",ie.leadingWhitespace=3===t.firstChild.nodeType,ie.tbody=!t.getElementsByTagName("tbody").length,ie.htmlSerialize=!!t.getElementsByTagName("link").length,ie.html5Clone="<:nav></:nav>"!==fe.createElement("nav").cloneNode(!0).outerHTML,e.type="checkbox",e.checked=!0,i.appendChild(e),ie.appendChecked=e.checked,t.innerHTML="<textarea>x</textarea>",ie.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,i.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",ie.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,ie.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){ie.noCloneEvent=!1}),t.cloneNode(!0).click()),null==ie.deleteExpando){ie.deleteExpando=!0
try{delete t.test}catch(r){ie.deleteExpando=!1}}}(),function(){var t,i,r=fe.createElement("div")
for(t in{submit:!0,change:!0,focusin:!0})i="on"+t,(ie[t+"Bubbles"]=i in e)||(r.setAttribute(i,"t"),ie[t+"Bubbles"]=r.attributes[i].expando===!1)
r=null}()
var Ce=/^(?:input|select|textarea)$/i,De=/^key/,Re=/^(?:mouse|pointer|contextmenu)|click/,Ie=/^(?:focusinfocus|focusoutblur)$/,we=/^([^.]*)(?:\.(.+)|)$/
ne.event={global:{},add:function(e,t,i,r,n){var a,s,o,u,c,l,h,d,p,f,_,g=ne._data(e)
if(g){for(i.handler&&(u=i,i=u.handler,n=u.selector),i.guid||(i.guid=ne.guid++),(s=g.events)||(s=g.events={}),(l=g.handle)||(l=g.handle=function(e){return typeof ne===Te||e&&ne.event.triggered===e.type?void 0:ne.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(Le)||[""],o=t.length;o--;)a=we.exec(t[o])||[],p=_=a[1],f=(a[2]||"").split(".").sort(),p&&(c=ne.event.special[p]||{},p=(n?c.delegateType:c.bindType)||p,c=ne.event.special[p]||{},h=ne.extend({type:p,origType:_,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&ne.expr.match.needsContext.test(n),namespace:f.join(".")},u),(d=s[p])||(d=s[p]=[],d.delegateCount=0,c.setup&&c.setup.call(e,r,f,l)!==!1||(e.addEventListener?e.addEventListener(p,l,!1):e.attachEvent&&e.attachEvent("on"+p,l))),c.add&&(c.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,h):d.push(h),ne.event.global[p]=!0)
e=null}},remove:function(e,t,i,r,n){var a,s,o,u,c,l,h,d,p,f,_,g=ne.hasData(e)&&ne._data(e)
if(g&&(l=g.events)){for(t=(t||"").match(Le)||[""],c=t.length;c--;)if(o=we.exec(t[c])||[],p=_=o[1],f=(o[2]||"").split(".").sort(),p){for(h=ne.event.special[p]||{},p=(r?h.delegateType:h.bindType)||p,d=l[p]||[],o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=a=d.length;a--;)s=d[a],!n&&_!==s.origType||i&&i.guid!==s.guid||o&&!o.test(s.namespace)||r&&r!==s.selector&&("**"!==r||!s.selector)||(d.splice(a,1),s.selector&&d.delegateCount--,h.remove&&h.remove.call(e,s))
u&&!d.length&&(h.teardown&&h.teardown.call(e,f,g.handle)!==!1||ne.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)ne.event.remove(e,p+t[c],i,r,!0)
ne.isEmptyObject(l)&&(delete g.handle,ne._removeData(e,"events"))}},trigger:function(t,i,r,n){var a,s,o,u,c,l,h,d=[r||fe],p=te.call(t,"type")?t.type:t,f=te.call(t,"namespace")?t.namespace.split("."):[]
if(o=l=r=r||fe,3!==r.nodeType&&8!==r.nodeType&&!Ie.test(p+ne.event.triggered)&&(p.indexOf(".")>=0&&(f=p.split("."),p=f.shift(),f.sort()),s=p.indexOf(":")<0&&"on"+p,t=t[ne.expando]?t:new ne.Event(p,"object"==typeof t&&t),t.isTrigger=n?2:3,t.namespace=f.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),i=null==i?[t]:ne.makeArray(i,[t]),c=ne.event.special[p]||{},n||!c.trigger||c.trigger.apply(r,i)!==!1)){if(!n&&!c.noBubble&&!ne.isWindow(r)){for(u=c.delegateType||p,Ie.test(u+p)||(o=o.parentNode);o;o=o.parentNode)d.push(o),l=o
l===(r.ownerDocument||fe)&&d.push(l.defaultView||l.parentWindow||e)}for(h=0;(o=d[h++])&&!t.isPropagationStopped();)t.type=h>1?u:c.bindType||p,a=(ne._data(o,"events")||{})[t.type]&&ne._data(o,"handle"),a&&a.apply(o,i),a=s&&o[s],a&&a.apply&&ne.acceptData(o)&&(t.result=a.apply(o,i),t.result===!1&&t.preventDefault())
if(t.type=p,!n&&!t.isDefaultPrevented()&&(!c._default||c._default.apply(d.pop(),i)===!1)&&ne.acceptData(r)&&s&&r[p]&&!ne.isWindow(r)){l=r[s],l&&(r[s]=null),ne.event.triggered=p
try{r[p]()}catch(_){}ne.event.triggered=void 0,l&&(r[s]=l)}return t.result}},dispatch:function(e){e=ne.event.fix(e)
var t,i,r,n,a,s=[],o=z.call(arguments),u=(ne._data(this,"events")||{})[e.type]||[],c=ne.event.special[e.type]||{}
if(o[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=ne.event.handlers.call(this,e,u),t=0;(n=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=n.elem,a=0;(r=n.handlers[a++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(r.namespace))&&(e.handleObj=r,e.data=r.data,i=((ne.event.special[r.origType]||{}).handle||r.handler).apply(n.elem,o),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()))
return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var i,r,n,a,s=[],o=t.delegateCount,u=e.target
if(o&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!=this;u=u.parentNode||this)if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(n=[],a=0;o>a;a++)r=t[a],i=r.selector+" ",void 0===n[i]&&(n[i]=r.needsContext?ne(i,this).index(u)>=0:ne.find(i,this,null,[u]).length),n[i]&&n.push(r)
n.length&&s.push({elem:u,handlers:n})}return o<t.length&&s.push({elem:this,handlers:t.slice(o)}),s},fix:function(e){if(e[ne.expando])return e
var t,i,r,n=e.type,a=e,s=this.fixHooks[n]
for(s||(this.fixHooks[n]=s=Re.test(n)?this.mouseHooks:De.test(n)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new ne.Event(a),t=r.length;t--;)i=r[t],e[i]=a[i]
return e.target||(e.target=a.srcElement||fe),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,r,n,a=t.button,s=t.fromElement
return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||fe,n=r.documentElement,i=r.body,e.pageX=t.clientX+(n&&n.scrollLeft||i&&i.scrollLeft||0)-(n&&n.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||i&&i.scrollTop||0)-(n&&n.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?t.toElement:s),e.which||void 0===a||(e.which=1&a?1:2&a?3:4&a?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==f()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===f()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return ne.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return ne.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,r){var n=ne.extend(new ne.Event,i,{type:e,isSimulated:!0,originalEvent:{}})
r?ne.event.trigger(n,null,t):ne.event.dispatch.call(t,n),n.isDefaultPrevented()&&i.preventDefault()}},ne.removeEvent=fe.removeEventListener?function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)}:function(e,t,i){var r="on"+t
e.detachEvent&&(typeof e[r]===Te&&(e[r]=null),e.detachEvent(r,i))},ne.Event=function(e,t){return this instanceof ne.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?d:p):this.type=e,t&&ne.extend(this,t),this.timeStamp=e&&e.timeStamp||ne.now(),void(this[ne.expando]=!0)):new ne.Event(e,t)},ne.Event.prototype={isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,preventDefault:function(){var e=this.originalEvent
this.isDefaultPrevented=d,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent
this.isPropagationStopped=d,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent
this.isImmediatePropagationStopped=d,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},ne.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){ne.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,r=this,n=e.relatedTarget,a=e.handleObj
return(!n||n!==r&&!ne.contains(r,n))&&(e.type=a.origType,i=a.handler.apply(this,arguments),e.type=t),i}}}),ie.submitBubbles||(ne.event.special.submit={setup:function(){return ne.nodeName(this,"form")?!1:void ne.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,i=ne.nodeName(t,"input")||ne.nodeName(t,"button")?t.form:void 0
i&&!ne._data(i,"submitBubbles")&&(ne.event.add(i,"submit._submit",function(e){e._submit_bubble=!0}),ne._data(i,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&ne.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return ne.nodeName(this,"form")?!1:void ne.event.remove(this,"._submit")}}),ie.changeBubbles||(ne.event.special.change={setup:function(){return Ce.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(ne.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),ne.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),ne.event.simulate("change",this,e,!0)})),!1):void ne.event.add(this,"beforeactivate._change",function(e){var t=e.target
Ce.test(t.nodeName)&&!ne._data(t,"changeBubbles")&&(ne.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||ne.event.simulate("change",this.parentNode,e,!0)}),ne._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target
return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return ne.event.remove(this,"._change"),!Ce.test(this.nodeName)}}),ie.focusinBubbles||ne.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){ne.event.simulate(t,e.target,ne.event.fix(e),!0)}
ne.event.special[t]={setup:function(){var r=this.ownerDocument||this,n=ne._data(r,t)
n||r.addEventListener(e,i,!0),ne._data(r,t,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=ne._data(r,t)-1
n?ne._data(r,t,n):(r.removeEventListener(e,i,!0),ne._removeData(r,t))}}}),ne.fn.extend({on:function(e,t,i,r,n){var a,s
if("object"==typeof e){"string"!=typeof t&&(i=i||t,t=void 0)
for(a in e)this.on(a,t,i,e[a],n)
return this}if(null==i&&null==r?(r=t,i=t=void 0):null==r&&("string"==typeof t?(r=i,i=void 0):(r=i,i=t,t=void 0)),r===!1)r=p
else if(!r)return this
return 1===n&&(s=r,r=function(e){return ne().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=ne.guid++)),this.each(function(){ne.event.add(this,e,r,i,t)})},one:function(e,t,i,r){return this.on(e,t,i,r,1)},off:function(e,t,i){var r,n
if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ne(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this
if("object"==typeof e){for(n in e)this.off(n,t,e[n])
return this}return(t===!1||"function"==typeof t)&&(i=t,t=void 0),i===!1&&(i=p),this.each(function(){ne.event.remove(this,e,i,t)})},trigger:function(e,t){return this.each(function(){ne.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0]
return i?ne.event.trigger(e,t,i,!0):void 0}})
var Oe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Fe=/ jQuery\d+="(?:null|\d+)"/g,je=new RegExp("<(?:"+Oe+")[\\s/>]","i"),Ue=/^\s+/,Be=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ve=/<([\w:]+)/,ke=/<tbody/i,We=/<|&#?\w+;/,Xe=/<(?:script|style|link)/i,He=/checked\s*(?:[^=]|=\s*.checked.)/i,qe=/^$|\/(?:java|ecma)script/i,Ye=/^true\/(.*)/,$e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ze={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ie.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Ze=_(fe),Ke=Ze.appendChild(fe.createElement("div"))
ze.optgroup=ze.option,ze.tbody=ze.tfoot=ze.colgroup=ze.caption=ze.thead,ze.th=ze.td,ne.extend({clone:function(e,t,i){var r,n,a,s,o,u=ne.contains(e.ownerDocument,e)
if(ie.html5Clone||ne.isXMLDoc(e)||!je.test("<"+e.nodeName+">")?a=e.cloneNode(!0):(Ke.innerHTML=e.outerHTML,Ke.removeChild(a=Ke.firstChild)),!(ie.noCloneEvent&&ie.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ne.isXMLDoc(e)))for(r=g(a),o=g(e),s=0;null!=(n=o[s]);++s)r[s]&&T(n,r[s])
if(t)if(i)for(o=o||g(e),r=r||g(a),s=0;null!=(n=o[s]);s++)x(n,r[s])
else x(e,a)
return r=g(a,"script"),r.length>0&&v(r,!u&&g(e,"script")),r=o=n=null,a},buildFragment:function(e,t,i,r){for(var n,a,s,o,u,c,l,h=e.length,d=_(t),p=[],f=0;h>f;f++)if(a=e[f],a||0===a)if("object"===ne.type(a))ne.merge(p,a.nodeType?[a]:a)
else if(We.test(a)){for(o=o||d.appendChild(t.createElement("div")),u=(Ve.exec(a)||["",""])[1].toLowerCase(),l=ze[u]||ze._default,o.innerHTML=l[1]+a.replace(Be,"<$1></$2>")+l[2],n=l[0];n--;)o=o.lastChild
if(!ie.leadingWhitespace&&Ue.test(a)&&p.push(t.createTextNode(Ue.exec(a)[0])),!ie.tbody)for(a="table"!==u||ke.test(a)?"<table>"!==l[1]||ke.test(a)?0:o:o.firstChild,n=a&&a.childNodes.length;n--;)ne.nodeName(c=a.childNodes[n],"tbody")&&!c.childNodes.length&&a.removeChild(c)
for(ne.merge(p,o.childNodes),o.textContent="";o.firstChild;)o.removeChild(o.firstChild)
o=d.lastChild}else p.push(t.createTextNode(a))
for(o&&d.removeChild(o),ie.appendChecked||ne.grep(g(p,"input"),m),f=0;a=p[f++];)if((!r||-1===ne.inArray(a,r))&&(s=ne.contains(a.ownerDocument,a),o=g(d.appendChild(a),"script"),s&&v(o),i))for(n=0;a=o[n++];)qe.test(a.type||"")&&i.push(a)
return o=null,d},cleanData:function(e,t){for(var i,r,n,a,s=0,o=ne.expando,u=ne.cache,c=ie.deleteExpando,l=ne.event.special;null!=(i=e[s]);s++)if((t||ne.acceptData(i))&&(n=i[o],a=n&&u[n])){if(a.events)for(r in a.events)l[r]?ne.event.remove(i,r):ne.removeEvent(i,r,a.handle)
u[n]&&(delete u[n],c?delete i[o]:typeof i.removeAttribute!==Te?i.removeAttribute(o):i[o]=null,$.push(n))}}}),ne.fn.extend({text:function(e){return Pe(this,function(e){return void 0===e?ne.text(this):this.empty().append((this[0]&&this[0].ownerDocument||fe).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=S(this,e)
t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=S(this,e)
t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,r=e?ne.filter(e,this):this,n=0;null!=(i=r[n]);n++)t||1!==i.nodeType||ne.cleanData(g(i)),i.parentNode&&(t&&ne.contains(i.ownerDocument,i)&&v(g(i,"script")),i.parentNode.removeChild(i))
return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&ne.cleanData(g(e,!1));e.firstChild;)e.removeChild(e.firstChild)
e.options&&ne.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return ne.clone(this,e,t)})},html:function(e){return Pe(this,function(e){var t=this[0]||{},i=0,r=this.length
if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(Fe,""):void 0
if(!("string"!=typeof e||Xe.test(e)||!ie.htmlSerialize&&je.test(e)||!ie.leadingWhitespace&&Ue.test(e)||ze[(Ve.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Be,"<$1></$2>")
try{for(;r>i;i++)t=this[i]||{},1===t.nodeType&&(ne.cleanData(g(t,!1)),t.innerHTML=e)
t=0}catch(n){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0]
return this.domManip(arguments,function(t){e=this.parentNode,ne.cleanData(g(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=Z.apply([],e)
var i,r,n,a,s,o,u=0,c=this.length,l=this,h=c-1,d=e[0],p=ne.isFunction(d)
if(p||c>1&&"string"==typeof d&&!ie.checkClone&&He.test(d))return this.each(function(i){var r=l.eq(i)
p&&(e[0]=d.call(this,i,r.html())),r.domManip(e,t)})
if(c&&(o=ne.buildFragment(e,this[0].ownerDocument,!1,this),i=o.firstChild,1===o.childNodes.length&&(o=i),i)){for(a=ne.map(g(o,"script"),L),n=a.length;c>u;u++)r=o,u!==h&&(r=ne.clone(r,!0,!0),n&&ne.merge(a,g(r,"script"))),t.call(this[u],r,u)
if(n)for(s=a[a.length-1].ownerDocument,ne.map(a,b),u=0;n>u;u++)r=a[u],qe.test(r.type||"")&&!ne._data(r,"globalEval")&&ne.contains(s,r)&&(r.src?ne._evalUrl&&ne._evalUrl(r.src):ne.globalEval((r.text||r.textContent||r.innerHTML||"").replace($e,"")))
o=i=null}return this}}),ne.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ne.fn[e]=function(e){for(var i,r=0,n=[],a=ne(e),s=a.length-1;s>=r;r++)i=r===s?this:this.clone(!0),ne(a[r])[t](i),K.apply(n,i.get())
return this.pushStack(n)}})
var Qe,Je={}
!function(){var e
ie.shrinkWrapBlocks=function(){if(null!=e)return e
e=!1
var t,i,r
return i=fe.getElementsByTagName("body")[0],i&&i.style?(t=fe.createElement("div"),r=fe.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(r).appendChild(t),typeof t.style.zoom!==Te&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(fe.createElement("div")).style.width="5px",e=3!==t.offsetWidth),i.removeChild(r),e):void 0}}()
var et,tt,it=/^margin/,rt=new RegExp("^("+ye+")(?!px)[a-z%]+$","i"),nt=/^(top|right|bottom|left)$/
e.getComputedStyle?(et=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},tt=function(e,t,i){var r,n,a,s,o=e.style
return i=i||et(e),s=i?i.getPropertyValue(t)||i[t]:void 0,i&&(""!==s||ne.contains(e.ownerDocument,e)||(s=ne.style(e,t)),rt.test(s)&&it.test(t)&&(r=o.width,n=o.minWidth,a=o.maxWidth,o.minWidth=o.maxWidth=o.width=s,s=i.width,o.width=r,o.minWidth=n,o.maxWidth=a)),void 0===s?s:s+""}):fe.documentElement.currentStyle&&(et=function(e){return e.currentStyle},tt=function(e,t,i){var r,n,a,s,o=e.style
return i=i||et(e),s=i?i[t]:void 0,null==s&&o&&o[t]&&(s=o[t]),rt.test(s)&&!nt.test(t)&&(r=o.left,n=e.runtimeStyle,a=n&&n.left,a&&(n.left=e.currentStyle.left),o.left="fontSize"===t?"1em":s,s=o.pixelLeft+"px",o.left=r,a&&(n.left=a)),void 0===s?s:s+""||"auto"}),!function(){function t(){var t,i,r,n
i=fe.getElementsByTagName("body")[0],i&&i.style&&(t=fe.createElement("div"),r=fe.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(r).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",a=s=!1,u=!0,e.getComputedStyle&&(a="1%"!==(e.getComputedStyle(t,null)||{}).top,s="4px"===(e.getComputedStyle(t,null)||{width:"4px"}).width,n=t.appendChild(fe.createElement("div")),n.style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",t.style.width="1px",u=!parseFloat((e.getComputedStyle(n,null)||{}).marginRight)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",n=t.getElementsByTagName("td"),n[0].style.cssText="margin:0;border:0;padding:0;display:none",o=0===n[0].offsetHeight,o&&(n[0].style.display="",n[1].style.display="none",o=0===n[0].offsetHeight),i.removeChild(r))}var i,r,n,a,s,o,u
i=fe.createElement("div"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=i.getElementsByTagName("a")[0],(r=n&&n.style)&&(r.cssText="float:left;opacity:.5",ie.opacity="0.5"===r.opacity,ie.cssFloat=!!r.cssFloat,i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",ie.clearCloneStyle="content-box"===i.style.backgroundClip,ie.boxSizing=""===r.boxSizing||""===r.MozBoxSizing||""===r.WebkitBoxSizing,ne.extend(ie,{reliableHiddenOffsets:function(){return null==o&&t(),o},boxSizingReliable:function(){return null==s&&t(),s},pixelPosition:function(){return null==a&&t(),a},reliableMarginRight:function(){return null==u&&t(),u}}))}(),ne.swap=function(e,t,i,r){var n,a,s={}
for(a in t)s[a]=e.style[a],e.style[a]=t[a]
n=i.apply(e,r||[])
for(a in t)e.style[a]=s[a]
return n}
var at=/alpha\([^)]*\)/i,st=/opacity\s*=\s*([^)]*)/,ot=/^(none|table(?!-c[ea]).+)/,ut=new RegExp("^("+ye+")(.*)$","i"),ct=new RegExp("^([+-])=("+ye+")","i"),lt={position:"absolute",visibility:"hidden",display:"block"},ht={letterSpacing:"0",fontWeight:"400"},dt=["Webkit","O","Moz","ms"]
ne.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=tt(e,"opacity")
return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ie.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,a,s,o=ne.camelCase(t),u=e.style
if(t=ne.cssProps[o]||(ne.cssProps[o]=E(u,o)),s=ne.cssHooks[t]||ne.cssHooks[o],void 0===i)return s&&"get"in s&&void 0!==(n=s.get(e,!1,r))?n:u[t]
if(a=typeof i,"string"===a&&(n=ct.exec(i))&&(i=(n[1]+1)*n[2]+parseFloat(ne.css(e,t)),a="number"),null!=i&&i===i&&("number"!==a||ne.cssNumber[o]||(i+="px"),ie.clearCloneStyle||""!==i||0!==t.indexOf("background")||(u[t]="inherit"),!(s&&"set"in s&&void 0===(i=s.set(e,i,r)))))try{u[t]=i}catch(c){}}},css:function(e,t,i,r){var n,a,s,o=ne.camelCase(t)
return t=ne.cssProps[o]||(ne.cssProps[o]=E(e.style,o)),s=ne.cssHooks[t]||ne.cssHooks[o],s&&"get"in s&&(a=s.get(e,!0,i)),void 0===a&&(a=tt(e,t,r)),"normal"===a&&t in ht&&(a=ht[t]),""===i||i?(n=parseFloat(a),i===!0||ne.isNumeric(n)?n||0:a):a}}),ne.each(["height","width"],function(e,t){ne.cssHooks[t]={get:function(e,i,r){return i?ot.test(ne.css(e,"display"))&&0===e.offsetWidth?ne.swap(e,lt,function(){return C(e,t,r)}):C(e,t,r):void 0},set:function(e,i,r){var n=r&&et(e)
return P(e,i,r?N(e,t,r,ie.boxSizing&&"border-box"===ne.css(e,"boxSizing",!1,n),n):0)}}}),ie.opacity||(ne.cssHooks.opacity={get:function(e,t){return st.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var i=e.style,r=e.currentStyle,n=ne.isNumeric(t)?"alpha(opacity="+100*t+")":"",a=r&&r.filter||i.filter||""
i.zoom=1,(t>=1||""===t)&&""===ne.trim(a.replace(at,""))&&i.removeAttribute&&(i.removeAttribute("filter"),""===t||r&&!r.filter)||(i.filter=at.test(a)?a.replace(at,n):a+" "+n)}}),ne.cssHooks.marginRight=y(ie.reliableMarginRight,function(e,t){return t?ne.swap(e,{display:"inline-block"},tt,[e,"marginRight"]):void 0}),ne.each({margin:"",padding:"",border:"Width"},function(e,t){ne.cssHooks[e+t]={expand:function(i){for(var r=0,n={},a="string"==typeof i?i.split(" "):[i];4>r;r++)n[e+Ee[r]+t]=a[r]||a[r-2]||a[0]
return n}},it.test(e)||(ne.cssHooks[e+t].set=P)}),ne.fn.extend({css:function(e,t){return Pe(this,function(e,t,i){var r,n,a={},s=0
if(ne.isArray(t)){for(r=et(e),n=t.length;n>s;s++)a[t[s]]=ne.css(e,t[s],!1,r)
return a}return void 0!==i?ne.style(e,t,i):ne.css(e,t)},e,t,arguments.length>1)},show:function(){return A(this,!0)},hide:function(){return A(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ae(this)?ne(this).show():ne(this).hide()})}}),ne.Tween=D,D.prototype={constructor:D,init:function(e,t,i,r,n,a){this.elem=e,this.prop=i,this.easing=n||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=a||(ne.cssNumber[i]?"":"px")},cur:function(){var e=D.propHooks[this.prop]
return e&&e.get?e.get(this):D.propHooks._default.get(this)},run:function(e){var t,i=D.propHooks[this.prop]
return this.pos=t=this.options.duration?ne.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):D.propHooks._default.set(this),this}},D.prototype.init.prototype=D.prototype,D.propHooks={_default:{get:function(e){var t
return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=ne.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){ne.fx.step[e.prop]?ne.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ne.cssProps[e.prop]]||ne.cssHooks[e.prop])?ne.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},D.propHooks.scrollTop=D.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ne.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},ne.fx=D.prototype.init,ne.fx.step={}
var pt,ft,_t=/^(?:toggle|show|hide)$/,gt=new RegExp("^(?:([+-])=|)("+ye+")([a-z%]*)$","i"),mt=/queueHooks$/,St=[O],Lt={"*":[function(e,t){var i=this.createTween(e,t),r=i.cur(),n=gt.exec(t),a=n&&n[3]||(ne.cssNumber[e]?"":"px"),s=(ne.cssNumber[e]||"px"!==a&&+r)&&gt.exec(ne.css(i.elem,e)),o=1,u=20
if(s&&s[3]!==a){a=a||s[3],n=n||[],s=+r||1
do o=o||".5",s/=o,ne.style(i.elem,e,s+a)
while(o!==(o=i.cur()/r)&&1!==o&&--u)}return n&&(s=i.start=+s||+r||0,i.unit=a,i.end=n[1]?s+(n[1]+1)*n[2]:+n[2]),i}]}
ne.Animation=ne.extend(j,{tweener:function(e,t){ne.isFunction(e)?(t=e,e=["*"]):e=e.split(" ")
for(var i,r=0,n=e.length;n>r;r++)i=e[r],Lt[i]=Lt[i]||[],Lt[i].unshift(t)},prefilter:function(e,t){t?St.unshift(e):St.push(e)}}),ne.speed=function(e,t,i){var r=e&&"object"==typeof e?ne.extend({},e):{complete:i||!i&&t||ne.isFunction(e)&&e,duration:e,easing:i&&t||t&&!ne.isFunction(t)&&t}
return r.duration=ne.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in ne.fx.speeds?ne.fx.speeds[r.duration]:ne.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){ne.isFunction(r.old)&&r.old.call(this),r.queue&&ne.dequeue(this,r.queue)},r},ne.fn.extend({fadeTo:function(e,t,i,r){return this.filter(Ae).css("opacity",0).show().end().animate({opacity:t},e,i,r)},animate:function(e,t,i,r){var n=ne.isEmptyObject(e),a=ne.speed(t,i,r),s=function(){var t=j(this,ne.extend({},e),a);(n||ne._data(this,"finish"))&&t.stop(!0)}
return s.finish=s,n||a.queue===!1?this.each(s):this.queue(a.queue,s)},stop:function(e,t,i){var r=function(e){var t=e.stop
delete e.stop,t(i)}
return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",a=ne.timers,s=ne._data(this)
if(n)s[n]&&s[n].stop&&r(s[n])
else for(n in s)s[n]&&s[n].stop&&mt.test(n)&&r(s[n])
for(n=a.length;n--;)a[n].elem!==this||null!=e&&a[n].queue!==e||(a[n].anim.stop(i),t=!1,a.splice(n,1));(t||!i)&&ne.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=ne._data(this),r=i[e+"queue"],n=i[e+"queueHooks"],a=ne.timers,s=r?r.length:0
for(i.finish=!0,ne.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1))
for(t=0;s>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this)
delete i.finish})}}),ne.each(["toggle","show","hide"],function(e,t){var i=ne.fn[t]
ne.fn[t]=function(e,r,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(I(t,!0),e,r,n)}}),ne.each({slideDown:I("show"),slideUp:I("hide"),slideToggle:I("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ne.fn[e]=function(e,i,r){return this.animate(t,e,i,r)}}),ne.timers=[],ne.fx.tick=function(){var e,t=ne.timers,i=0
for(pt=ne.now();i<t.length;i++)e=t[i],e()||t[i]!==e||t.splice(i--,1)
t.length||ne.fx.stop(),pt=void 0},ne.fx.timer=function(e){ne.timers.push(e),e()?ne.fx.start():ne.timers.pop()},ne.fx.interval=13,ne.fx.start=function(){ft||(ft=setInterval(ne.fx.tick,ne.fx.interval))},ne.fx.stop=function(){clearInterval(ft),ft=null},ne.fx.speeds={slow:600,fast:200,_default:400},ne.fn.delay=function(e,t){return e=ne.fx?ne.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var r=setTimeout(t,e)
i.stop=function(){clearTimeout(r)}})},function(){var e,t,i,r,n
t=fe.createElement("div"),t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=t.getElementsByTagName("a")[0],i=fe.createElement("select"),n=i.appendChild(fe.createElement("option")),e=t.getElementsByTagName("input")[0],r.style.cssText="top:1px",ie.getSetAttribute="t"!==t.className,ie.style=/top/.test(r.getAttribute("style")),ie.hrefNormalized="/a"===r.getAttribute("href"),ie.checkOn=!!e.value,ie.optSelected=n.selected,ie.enctype=!!fe.createElement("form").enctype,i.disabled=!0,ie.optDisabled=!n.disabled,e=fe.createElement("input"),e.setAttribute("value",""),ie.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),ie.radioValue="t"===e.value}()
var bt=/\r/g
ne.fn.extend({val:function(e){var t,i,r,n=this[0]
return arguments.length?(r=ne.isFunction(e),this.each(function(i){var n
1===this.nodeType&&(n=r?e.call(this,i,ne(this).val()):e,null==n?n="":"number"==typeof n?n+="":ne.isArray(n)&&(n=ne.map(n,function(e){return null==e?"":e+""})),t=ne.valHooks[this.type]||ne.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))})):n?(t=ne.valHooks[n.type]||ne.valHooks[n.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(n,"value"))?i:(i=n.value,"string"==typeof i?i.replace(bt,""):null==i?"":i)):void 0}}),ne.extend({valHooks:{option:{get:function(e){var t=ne.find.attr(e,"value")
return null!=t?t:ne.trim(ne.text(e))}},select:{get:function(e){for(var t,i,r=e.options,n=e.selectedIndex,a="select-one"===e.type||0>n,s=a?null:[],o=a?n+1:r.length,u=0>n?o:a?n:0;o>u;u++)if(i=r[u],!(!i.selected&&u!==n||(ie.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&ne.nodeName(i.parentNode,"optgroup"))){if(t=ne(i).val(),a)return t
s.push(t)}return s},set:function(e,t){for(var i,r,n=e.options,a=ne.makeArray(t),s=n.length;s--;)if(r=n[s],ne.inArray(ne.valHooks.option.get(r),a)>=0)try{r.selected=i=!0}catch(o){r.scrollHeight}else r.selected=!1
return i||(e.selectedIndex=-1),n}}}}),ne.each(["radio","checkbox"],function(){ne.valHooks[this]={set:function(e,t){return ne.isArray(t)?e.checked=ne.inArray(ne(e).val(),t)>=0:void 0}},ie.checkOn||(ne.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})
var vt,xt,Tt=ne.expr.attrHandle,Gt=/^(?:checked|selected)$/i,Mt=ie.getSetAttribute,yt=ie.input
ne.fn.extend({attr:function(e,t){return Pe(this,ne.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ne.removeAttr(this,e)})}}),ne.extend({attr:function(e,t,i){var r,n,a=e.nodeType
return e&&3!==a&&8!==a&&2!==a?typeof e.getAttribute===Te?ne.prop(e,t,i):(1===a&&ne.isXMLDoc(e)||(t=t.toLowerCase(),r=ne.attrHooks[t]||(ne.expr.match.bool.test(t)?xt:vt)),void 0===i?r&&"get"in r&&null!==(n=r.get(e,t))?n:(n=ne.find.attr(e,t),null==n?void 0:n):null!==i?r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:(e.setAttribute(t,i+""),i):void ne.removeAttr(e,t)):void 0},removeAttr:function(e,t){var i,r,n=0,a=t&&t.match(Le)
if(a&&1===e.nodeType)for(;i=a[n++];)r=ne.propFix[i]||i,ne.expr.match.bool.test(i)?yt&&Mt||!Gt.test(i)?e[r]=!1:e[ne.camelCase("default-"+i)]=e[r]=!1:ne.attr(e,i,""),e.removeAttribute(Mt?i:r)},attrHooks:{type:{set:function(e,t){if(!ie.radioValue&&"radio"===t&&ne.nodeName(e,"input")){var i=e.value
return e.setAttribute("type",t),i&&(e.value=i),t}}}}}),xt={set:function(e,t,i){return t===!1?ne.removeAttr(e,i):yt&&Mt||!Gt.test(i)?e.setAttribute(!Mt&&ne.propFix[i]||i,i):e[ne.camelCase("default-"+i)]=e[i]=!0,i}},ne.each(ne.expr.match.bool.source.match(/\w+/g),function(e,t){var i=Tt[t]||ne.find.attr
Tt[t]=yt&&Mt||!Gt.test(t)?function(e,t,r){var n,a
return r||(a=Tt[t],Tt[t]=n,n=null!=i(e,t,r)?t.toLowerCase():null,Tt[t]=a),n}:function(e,t,i){return i?void 0:e[ne.camelCase("default-"+t)]?t.toLowerCase():null}}),yt&&Mt||(ne.attrHooks.value={set:function(e,t,i){return ne.nodeName(e,"input")?void(e.defaultValue=t):vt&&vt.set(e,t,i)}}),Mt||(vt={set:function(e,t,i){var r=e.getAttributeNode(i)
return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(i)),r.value=t+="","value"===i||t===e.getAttribute(i)?t:void 0}},Tt.id=Tt.name=Tt.coords=function(e,t,i){var r
return i?void 0:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},ne.valHooks.button={get:function(e,t){var i=e.getAttributeNode(t)
return i&&i.specified?i.value:void 0},set:vt.set},ne.attrHooks.contenteditable={set:function(e,t,i){vt.set(e,""===t?!1:t,i)}},ne.each(["width","height"],function(e,t){ne.attrHooks[t]={set:function(e,i){return""===i?(e.setAttribute(t,"auto"),i):void 0}}})),ie.style||(ne.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}})
var Et=/^(?:input|select|textarea|button|object)$/i,At=/^(?:a|area)$/i
ne.fn.extend({prop:function(e,t){return Pe(this,ne.prop,e,t,arguments.length>1)},removeProp:function(e){return e=ne.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),ne.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,i){var r,n,a,s=e.nodeType
return e&&3!==s&&8!==s&&2!==s?(a=1!==s||!ne.isXMLDoc(e),a&&(t=ne.propFix[t]||t,n=ne.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:e[t]=i:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]):void 0},propHooks:{tabIndex:{get:function(e){var t=ne.find.attr(e,"tabindex")
return t?parseInt(t,10):Et.test(e.nodeName)||At.test(e.nodeName)&&e.href?0:-1}}}}),ie.hrefNormalized||ne.each(["href","src"],function(e,t){ne.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),ie.optSelected||(ne.propHooks.selected={get:function(e){var t=e.parentNode
return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),ne.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ne.propFix[this.toLowerCase()]=this}),ie.enctype||(ne.propFix.enctype="encoding")
var Pt=/[\t\r\n\f]/g
ne.fn.extend({addClass:function(e){var t,i,r,n,a,s,o=0,u=this.length,c="string"==typeof e&&e
if(ne.isFunction(e))return this.each(function(t){ne(this).addClass(e.call(this,t,this.className))})
if(c)for(t=(e||"").match(Le)||[];u>o;o++)if(i=this[o],r=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Pt," "):" ")){for(a=0;n=t[a++];)r.indexOf(" "+n+" ")<0&&(r+=n+" ")
s=ne.trim(r),i.className!==s&&(i.className=s)}return this},removeClass:function(e){var t,i,r,n,a,s,o=0,u=this.length,c=0===arguments.length||"string"==typeof e&&e
if(ne.isFunction(e))return this.each(function(t){ne(this).removeClass(e.call(this,t,this.className))})
if(c)for(t=(e||"").match(Le)||[];u>o;o++)if(i=this[o],r=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Pt," "):"")){for(a=0;n=t[a++];)for(;r.indexOf(" "+n+" ")>=0;)r=r.replace(" "+n+" "," ")
s=e?ne.trim(r):"",i.className!==s&&(i.className=s)}return this},toggleClass:function(e,t){var i=typeof e
return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):this.each(ne.isFunction(e)?function(i){ne(this).toggleClass(e.call(this,i,this.className,t),t)}:function(){if("string"===i)for(var t,r=0,n=ne(this),a=e.match(Le)||[];t=a[r++];)n.hasClass(t)?n.removeClass(t):n.addClass(t)
else(i===Te||"boolean"===i)&&(this.className&&ne._data(this,"__className__",this.className),this.className=this.className||e===!1?"":ne._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,r=this.length;r>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(Pt," ").indexOf(t)>=0)return!0
return!1}}),ne.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ne.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),ne.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,r){return this.on(t,e,i,r)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}})
var Nt=ne.now(),Ct=/\?/,Dt=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g
ne.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"")
var i,r=null,n=ne.trim(t+"")
return n&&!ne.trim(n.replace(Dt,function(e,t,n,a){return i&&t&&(r=0),0===r?e:(i=n||t,r+=!a-!n,"")}))?Function("return "+n)():ne.error("Invalid JSON: "+t)},ne.parseXML=function(t){var i,r
if(!t||"string"!=typeof t)return null
try{e.DOMParser?(r=new DOMParser,i=r.parseFromString(t,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(t))}catch(n){i=void 0}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||ne.error("Invalid XML: "+t),i}
var Rt,It,wt=/#.*$/,Ot=/([?&])_=[^&]*/,Ft=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,jt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ut=/^(?:GET|HEAD)$/,Bt=/^\/\//,Vt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,kt={},Wt={},Xt="*/".concat("*")
try{It=location.href}catch(Ht){It=fe.createElement("a"),It.href="",It=It.href}Rt=Vt.exec(It.toLowerCase())||[],ne.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:It,type:"GET",isLocal:jt.test(Rt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Xt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ne.parseJSON,"text xml":ne.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?V(V(e,ne.ajaxSettings),t):V(ne.ajaxSettings,e)},ajaxPrefilter:U(kt),ajaxTransport:U(Wt),ajax:function(e,t){function i(e,t,i,r){var n,l,m,S,b,x=t
2!==L&&(L=2,o&&clearTimeout(o),c=void 0,s=r||"",v.readyState=e>0?4:0,n=e>=200&&300>e||304===e,i&&(S=k(h,v,i)),S=W(h,S,v,n),n?(h.ifModified&&(b=v.getResponseHeader("Last-Modified"),b&&(ne.lastModified[a]=b),b=v.getResponseHeader("etag"),b&&(ne.etag[a]=b)),204===e||"HEAD"===h.type?x="nocontent":304===e?x="notmodified":(x=S.state,l=S.data,m=S.error,n=!m)):(m=x,(e||!x)&&(x="error",0>e&&(e=0))),v.status=e,v.statusText=(t||x)+"",n?f.resolveWith(d,[l,x,v]):f.rejectWith(d,[v,x,m]),v.statusCode(g),g=void 0,u&&p.trigger(n?"ajaxSuccess":"ajaxError",[v,h,n?l:m]),_.fireWith(d,[v,x]),u&&(p.trigger("ajaxComplete",[v,h]),--ne.active||ne.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{}
var r,n,a,s,o,u,c,l,h=ne.ajaxSetup({},t),d=h.context||h,p=h.context&&(d.nodeType||d.jquery)?ne(d):ne.event,f=ne.Deferred(),_=ne.Callbacks("once memory"),g=h.statusCode||{},m={},S={},L=0,b="canceled",v={readyState:0,getResponseHeader:function(e){var t
if(2===L){if(!l)for(l={};t=Ft.exec(s);)l[t[1].toLowerCase()]=t[2]
t=l[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===L?s:null},setRequestHeader:function(e,t){var i=e.toLowerCase()
return L||(e=S[i]=S[i]||e,m[e]=t),this},overrideMimeType:function(e){return L||(h.mimeType=e),this},statusCode:function(e){var t
if(e)if(2>L)for(t in e)g[t]=[g[t],e[t]]
else v.always(e[v.status])
return this},abort:function(e){var t=e||b
return c&&c.abort(t),i(0,t),this}}
if(f.promise(v).complete=_.add,v.success=v.done,v.error=v.fail,h.url=((e||h.url||It)+"").replace(wt,"").replace(Bt,Rt[1]+"//"),h.type=t.method||t.type||h.method||h.type,h.dataTypes=ne.trim(h.dataType||"*").toLowerCase().match(Le)||[""],null==h.crossDomain&&(r=Vt.exec(h.url.toLowerCase()),h.crossDomain=!(!r||r[1]===Rt[1]&&r[2]===Rt[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(Rt[3]||("http:"===Rt[1]?"80":"443")))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=ne.param(h.data,h.traditional)),B(kt,h,t,v),2===L)return v
u=h.global,u&&0===ne.active++&&ne.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Ut.test(h.type),a=h.url,h.hasContent||(h.data&&(a=h.url+=(Ct.test(a)?"&":"?")+h.data,delete h.data),h.cache===!1&&(h.url=Ot.test(a)?a.replace(Ot,"$1_="+Nt++):a+(Ct.test(a)?"&":"?")+"_="+Nt++)),h.ifModified&&(ne.lastModified[a]&&v.setRequestHeader("If-Modified-Since",ne.lastModified[a]),ne.etag[a]&&v.setRequestHeader("If-None-Match",ne.etag[a])),(h.data&&h.hasContent&&h.contentType!==!1||t.contentType)&&v.setRequestHeader("Content-Type",h.contentType),v.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+Xt+"; q=0.01":""):h.accepts["*"])
for(n in h.headers)v.setRequestHeader(n,h.headers[n])
if(h.beforeSend&&(h.beforeSend.call(d,v,h)===!1||2===L))return v.abort()
b="abort"
for(n in{success:1,error:1,complete:1})v[n](h[n])
if(c=B(Wt,h,t,v)){v.readyState=1,u&&p.trigger("ajaxSend",[v,h]),h.async&&h.timeout>0&&(o=setTimeout(function(){v.abort("timeout")},h.timeout))
try{L=1,c.send(m,i)}catch(x){if(!(2>L))throw x
i(-1,x)}}else i(-1,"No Transport")
return v},getJSON:function(e,t,i){return ne.get(e,t,i,"json")},getScript:function(e,t){return ne.get(e,void 0,t,"script")}}),ne.each(["get","post"],function(e,t){ne[t]=function(e,i,r,n){return ne.isFunction(i)&&(n=n||r,r=i,i=void 0),ne.ajax({url:e,type:t,dataType:n,data:i,success:r})}}),ne.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ne.fn[t]=function(e){return this.on(t,e)}}),ne._evalUrl=function(e){return ne.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},ne.fn.extend({wrapAll:function(e){if(ne.isFunction(e))return this.each(function(t){ne(this).wrapAll(e.call(this,t))})
if(this[0]){var t=ne(e,this[0].ownerDocument).eq(0).clone(!0)
this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild
return e}).append(this)}return this},wrapInner:function(e){return this.each(ne.isFunction(e)?function(t){ne(this).wrapInner(e.call(this,t))}:function(){var t=ne(this),i=t.contents()
i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=ne.isFunction(e)
return this.each(function(i){ne(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){ne.nodeName(this,"body")||ne(this).replaceWith(this.childNodes)}).end()}}),ne.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!ie.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||ne.css(e,"display"))},ne.expr.filters.visible=function(e){return!ne.expr.filters.hidden(e)}
var qt=/%20/g,Yt=/\[\]$/,$t=/\r?\n/g,zt=/^(?:submit|button|image|reset|file)$/i,Zt=/^(?:input|select|textarea|keygen)/i
ne.param=function(e,t){var i,r=[],n=function(e,t){t=ne.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)}
if(void 0===t&&(t=ne.ajaxSettings&&ne.ajaxSettings.traditional),ne.isArray(e)||e.jquery&&!ne.isPlainObject(e))ne.each(e,function(){n(this.name,this.value)})
else for(i in e)X(i,e[i],t,n)
return r.join("&").replace(qt,"+")},ne.fn.extend({serialize:function(){return ne.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ne.prop(this,"elements")
return e?ne.makeArray(e):this}).filter(function(){var e=this.type
return this.name&&!ne(this).is(":disabled")&&Zt.test(this.nodeName)&&!zt.test(e)&&(this.checked||!Ne.test(e))}).map(function(e,t){var i=ne(this).val()
return null==i?null:ne.isArray(i)?ne.map(i,function(e){return{name:t.name,value:e.replace($t,"\r\n")}}):{name:t.name,value:i.replace($t,"\r\n")}}).get()}}),ne.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&H()||q()}:H
var Kt=0,Qt={},Jt=ne.ajaxSettings.xhr()
e.ActiveXObject&&ne(e).on("unload",function(){for(var e in Qt)Qt[e](void 0,!0)}),ie.cors=!!Jt&&"withCredentials"in Jt,Jt=ie.ajax=!!Jt,Jt&&ne.ajaxTransport(function(e){if(!e.crossDomain||ie.cors){var t
return{send:function(i,r){var n,a=e.xhr(),s=++Kt
if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(n in e.xhrFields)a[n]=e.xhrFields[n]
e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest")
for(n in i)void 0!==i[n]&&a.setRequestHeader(n,i[n]+"")
a.send(e.hasContent&&e.data||null),t=function(i,n){var o,u,c
if(t&&(n||4===a.readyState))if(delete Qt[s],t=void 0,a.onreadystatechange=ne.noop,n)4!==a.readyState&&a.abort()
else{c={},o=a.status,"string"==typeof a.responseText&&(c.text=a.responseText)
try{u=a.statusText}catch(l){u=""}o||!e.isLocal||e.crossDomain?1223===o&&(o=204):o=c.text?200:404}c&&r(o,u,c,a.getAllResponseHeaders())},e.async?4===a.readyState?setTimeout(t):a.onreadystatechange=Qt[s]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),ne.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return ne.globalEval(e),e}}}),ne.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),ne.ajaxTransport("script",function(e){if(e.crossDomain){var t,i=fe.head||ne("head")[0]||fe.documentElement
return{send:function(r,n){t=fe.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,i){(i||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,i||n(200,"success"))},i.insertBefore(t,i.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}})
var ei=[],ti=/(=)\?(?=&|$)|\?\?/
ne.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=ei.pop()||ne.expando+"_"+Nt++
return this[e]=!0,e}}),ne.ajaxPrefilter("json jsonp",function(t,i,r){var n,a,s,o=t.jsonp!==!1&&(ti.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&ti.test(t.data)&&"data")
return o||"jsonp"===t.dataTypes[0]?(n=t.jsonpCallback=ne.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(ti,"$1"+n):t.jsonp!==!1&&(t.url+=(Ct.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return s||ne.error(n+" was not called"),s[0]},t.dataTypes[0]="json",a=e[n],e[n]=function(){s=arguments},r.always(function(){e[n]=a,t[n]&&(t.jsonpCallback=i.jsonpCallback,ei.push(n)),s&&ne.isFunction(a)&&a(s[0]),s=a=void 0}),"script"):void 0}),ne.parseHTML=function(e,t,i){if(!e||"string"!=typeof e)return null
"boolean"==typeof t&&(i=t,t=!1),t=t||fe
var r=he.exec(e),n=!i&&[]
return r?[t.createElement(r[1])]:(r=ne.buildFragment([e],t,n),n&&n.length&&ne(n).remove(),ne.merge([],r.childNodes))}
var ii=ne.fn.load
ne.fn.load=function(e,t,i){if("string"!=typeof e&&ii)return ii.apply(this,arguments)
var r,n,a,s=this,o=e.indexOf(" ")
return o>=0&&(r=ne.trim(e.slice(o,e.length)),e=e.slice(0,o)),ne.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(a="POST"),s.length>0&&ne.ajax({url:e,type:a,dataType:"html",data:t}).done(function(e){n=arguments,s.html(r?ne("<div>").append(ne.parseHTML(e)).find(r):e)}).complete(i&&function(e,t){s.each(i,n||[e.responseText,t,e])}),this},ne.expr.filters.animated=function(e){return ne.grep(ne.timers,function(t){return e===t.elem}).length}
var ri=e.document.documentElement
ne.offset={setOffset:function(e,t,i){var r,n,a,s,o,u,c,l=ne.css(e,"position"),h=ne(e),d={}
"static"===l&&(e.style.position="relative"),o=h.offset(),a=ne.css(e,"top"),u=ne.css(e,"left"),c=("absolute"===l||"fixed"===l)&&ne.inArray("auto",[a,u])>-1,c?(r=h.position(),s=r.top,n=r.left):(s=parseFloat(a)||0,n=parseFloat(u)||0),ne.isFunction(t)&&(t=t.call(e,i,o)),null!=t.top&&(d.top=t.top-o.top+s),null!=t.left&&(d.left=t.left-o.left+n),"using"in t?t.using.call(e,d):h.css(d)}},ne.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){ne.offset.setOffset(this,e,t)})
var t,i,r={top:0,left:0},n=this[0],a=n&&n.ownerDocument
return a?(t=a.documentElement,ne.contains(t,n)?(typeof n.getBoundingClientRect!==Te&&(r=n.getBoundingClientRect()),i=Y(a),{top:r.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r):void 0},position:function(){if(this[0]){var e,t,i={top:0,left:0},r=this[0]
return"fixed"===ne.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ne.nodeName(e[0],"html")||(i=e.offset()),i.top+=ne.css(e[0],"borderTopWidth",!0),i.left+=ne.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-ne.css(r,"marginTop",!0),left:t.left-i.left-ne.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||ri;e&&!ne.nodeName(e,"html")&&"static"===ne.css(e,"position");)e=e.offsetParent
return e||ri})}}),ne.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i=/Y/.test(t)
ne.fn[e]=function(r){return Pe(this,function(e,r,n){var a=Y(e)
return void 0===n?a?t in a?a[t]:a.document.documentElement[r]:e[r]:void(a?a.scrollTo(i?ne(a).scrollLeft():n,i?n:ne(a).scrollTop()):e[r]=n)},e,r,arguments.length,null)}}),ne.each(["top","left"],function(e,t){ne.cssHooks[t]=y(ie.pixelPosition,function(e,i){return i?(i=tt(e,t),rt.test(i)?ne(e).position()[t]+"px":i):void 0})}),ne.each({Height:"height",Width:"width"},function(e,t){ne.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,r){ne.fn[r]=function(r,n){var a=arguments.length&&(i||"boolean"!=typeof r),s=i||(r===!0||n===!0?"margin":"border")
return Pe(this,function(t,i,r){var n
return ne.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(n=t.documentElement,Math.max(t.body["scroll"+e],n["scroll"+e],t.body["offset"+e],n["offset"+e],n["client"+e])):void 0===r?ne.css(t,i,s):ne.style(t,i,r,s)},t,a?r:void 0,a,null)}})}),ne.fn.size=function(){return this.length},ne.fn.andSelf=ne.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ne})
var ni=e.jQuery,ai=e.$
return ne.noConflict=function(t){return e.$===ne&&(e.$=ai),t&&e.jQuery===ne&&(e.jQuery=ni),ne},typeof t===Te&&(e.jQuery=e.$=ne),ne}),onmessage=function(e){if("string"!=typeof e.data){for(var t,i=e.data.node,r=e.data.signature,n=e.data.patches,a=(new Date).getTime(),s=(i.buffer.byteLength,0);1>s;s++){var o=new MeshCoder(r,i,n)
t=o.decode(i.buffer)}i.buffer=t;(new Date).getTime()-a,i.nface
postMessage(i)}},BitStream=function(e){this.a=e
for(var t=0;t<e.length;t+=2){var i=e[t]
e[t]=e[t+1],e[t+1]=i}this.position=0,this.bitsPending=0},BitStream.prototype={read:function(e){for(var t=0;e>0;){var i,r
if(this.bitsPending>0){var n=(this.a[this.position-1]&4294967295>>>32-this.bitsPending)>>>0
r=Math.min(this.bitsPending,e),this.bitsPending-=r,i=n>>>this.bitsPending}else r=Math.min(32,e),this.bitsPending=32-r,i=this.a[this.position++]>>>this.bitsPending
e-=r,t=(t<<r|i)>>>0}return t},replace:function(e,t){return t=(t&4294967295>>>32-e)>>>0,t=(t|read(e))>>>0}},Stream=function(e){this.data=e,this.buffer=new Uint8Array(e),this.pos=0},Stream.prototype={readChar:function(){var e=this.buffer[this.pos++]
return e>127&&(e-=256),e},readUChar:function(){return this.buffer[this.pos++]},readInt:function(){var e=this.buffer[this.pos+3]
return e<<=8,e|=this.buffer[this.pos+2],e<<=8,e|=this.buffer[this.pos+1],e<<=8,e|=this.buffer[this.pos+0],this.pos+=4,e},readArray:function(e){var t=this.buffer.subarray(this.pos,this.pos+e)
return this.pos+=e,t},readBitStream:function(){var e=this.readInt(),t=3&this.pos
0!=t&&(this.pos+=4-t)
var i=new BitStream(new Uint32Array(this.data,this.pos,2*e))
return this.pos+=8*e,i}},Tunstall.prototype={decompress:function(e){var t=e.readUChar()
this.probabilities=e.readArray(2*t),this.createDecodingTables()
var i=e.readInt(),r=new Uint8Array(i),n=e.readInt(),a=e.readArray(n)
return i&&this._decompress(a,n,r,i),r},createDecodingTables:function(){var e=this.probabilities.length/2
if(!(1>=e)){for(var t=[],i=[],r=0;e>r;r++){var n=this.probabilities[2*r],a=[this.probabilities[2*r+1]<<8,i.length,1]
t[r]=[a],i.push(this.probabilities[2*r])}for(var s=1<<this.wordsize,o=e,u=e;s-e+1>o;){for(var c=0,l=0,r=0;e>r;r++){var h=t[r][0][0]
h>l&&(c=r,l=h)}for(var n=t[c][0],d=i.length,r=0;e>r;r++){for(var p=this.probabilities[2*r],f=this.probabilities[2*r+1]<<8,a=[f*n[0]>>>16,d,n[2]+1],_=0;_<n[2];_++)i[d+_]=i[n[1]+_]
d+=n[2],i[d++]=p,t[r].push(a)}u+=(e-1)*(n[2]+1)+1,o+=e-1,t[c].shift()}this.index=new Uint32Array(o),this.lengths=new Uint32Array(o),this.table=new Uint8Array(u)
var g=0,d=0
for(r=0;r<t.length;r++)for(var m=t[r],_=0;_<m.length;_++){var a=m[_]
this.index[g]=d,this.lengths[g]=a[2],g++
for(var S=0;S<a[2];S++)this.table[d+S]=i[a[1]+S]
d+=a[2]}}},_decompress:function(e,t,i,r){var n=0,a=0
if(2!=this.probabilities.length){for(;t-1>n;)for(var s=e[n++],o=this.index[s],u=o+this.lengths[s],c=o;u>c;c++)i[a++]=this.table[c]
for(var s=e[n],o=this.index[s],u=o+r-a,c=o;u>c;c++)i[a++]=this.table[c]
return i}for(var s=this.probabilities[0],c=0;r>c;c++)i[c]=s}},ZPoint=function(e,t){this.lo=t,this.hi=e},ZPoint.prototype={copy:function(e){this.lo=e.lo,this.hi=e.hi},setBit:function(e){32>e?this.lo=(this.lo|1<<e)>>>0:this.hi=(this.hi|1<<e-32)>>>0},toPoint:function(e,t,i,r){var n=this.morton3(this.lo,this.hi>>>1),a=this.morton3(this.lo>>>1,this.hi>>>2),s=this.morton3((this.lo>>>2|(1&this.hi)<<30)>>>0,this.hi>>>3)
i[r+0]=(n+e[0])*t,i[r+1]=(a+e[1])*t,i[r+2]=(s+e[2])*t},morton3:function(e,t){return e=(1227133513&e)>>>0,e=(3272356035&(e|e>>>2))>>>0,e=(251719695&(e|e>>>4))>>>0,e=(4278190335&(e|e>>>8))>>>0,e=(65535&(e|e>>>16))>>>0,t=(1227133513&t)>>>0,t=(3272356035&(t|t>>2))>>>0,t=(251719695&(t|t>>4))>>>0,t=(4278190335&(t|t>>8))>>>0,t=(65535&(t|t>>16))>>>0,(t<<11|e)>>>0}},MeshCoder.prototype={decode:function(e){var t=this
t.buffer=new ArrayBuffer(t.node.nvert*(12+6*t.sig.normals+4*t.sig.colors)+t.node.nface*t.sig.indices*6)
var i=12*t.node.nvert
return t.coords=new Float32Array(t.buffer,0,3*t.node.nvert),t.sig.normals&&(t.normals=new Int16Array(t.buffer,i,3*t.node.nvert),i+=6*t.node.nvert),t.sig.colors&&(t.colors=new Uint8ClampedArray(t.buffer,i,4*t.node.nvert),i+=4*t.node.nvert),t.sig.indices&&(t.faces=new Uint16Array(t.buffer,i,3*t.node.nface),i+=6*t.node.nface),t.stream=new Stream(e),t.stack=new Float32Array(7),t.stack[3]=t.stream.readInt(),t.stack[4]=t.stream.readInt(),t.stack[5]=t.stream.readInt(),t.coord_q=t.stream.readChar(),t.coord_bits=3*t.stream.readChar(),t.stack[6]=Math.pow(2,t.coord_q),t.sig.indices?t.decodeFaces():t.decodeCoordinates(),t.sig.normals&&t.decodeNormals(),t.sig.colors&&t.decodeColors(),t.buffer},decodeCoordinates:function(){var e=this,t=Math.pow(2,e.coord_q),i=Math.max(e.coord_bits-32,0),r=Math.min(e.coord_bits,32),n=e.stream.readBitStream(),a=new Tunstall,s=a.decompress(e.stream),o=n.read(i),u=n.read(r),c=new ZPoint(o,u),l=0
c.toPoint(e.min,t,e.coords,l),l+=3
for(var h=1;h<e.node.nvert;h++){var d=s[h-1]
if(c.setBit(d,1),d>32){c.hi=(c.hi&~((1<<d-32)-1))>>>0
var p=n.read(d-32)
c.hi=(c.hi|p)>>>0,c.lo=n.read(32)}else if(32==d)c.lo=n.read(d)
else{var p=n.read(d)
c.lo=(c.lo&~((1<<d)-1))>>>0,c.lo=(c.lo|p)>>>0}c.toPoint(e.min,t,e.coords,l),l+=3}},decodeFaces:function(){Math.random()
if(this.node.nface){this.vertex_count=0
for(var e=0,t=0;t<this.patches.length;t++){var i=this.patches[t]
this.decodeConnectivity(i-e,3*e),e=i}for(var r=3*this.node.nvert,n=this.coords,a=this.stack,s=0;r>s;)n[s]=(n[s]+a[3])*a[6],s++,n[s]=(n[s]+a[4])*a[6],s++,n[s]=(n[s]+a[5])*a[6],s++}},decodeNormals:function(){var e=this.stream.readChar(),t=new Tunstall,i=t.decompress(this.stream),r=new Tunstall,n=r.decompress(this.stream),a=this.stream.readBitStream(),s=1<<16-e>>>0,o=0,u=0
if(this.sig.indices){var c=this.markBoundary()
this.computeNormals()
for(var l=0;l<this.node.nvert;l++)if(c[l]){var h=3*l,d=this.normals[h+0]/s,p=this.normals[h+1]/s,f=this.decodeDiff(i[o++],a),_=this.decodeDiff(i[o++],a)
d=(d+f)*s,p=(p+_)*s
var g=1073676289-d*d-p*p
0>g&&(g=0),g=Math.sqrt(g),g>32767&&(g=32767)
var m=n[u++];(this.normals[h+2]<0&&0==m||this.normals[h+2]>0&&1==m)&&(g=-g),this.normals[h+0]=d,this.normals[h+1]=p,this.normals[h+2]=g}}else{for(var S=0;2>S;S++)for(var L=0,l=0;l<this.node.nvert;l++){var b=this.decodeDiff(i[o++],a)
L+=b,this.normals[3*l+S]=L*s}for(var l=0;l<this.node.nvert;l++){var h=3*l,d=this.normals[h+0],p=this.normals[h+1],g=1073676289-d*d-p*p
0>g&&(g=0),g=Math.sqrt(g),g>32767&&(g=32767),0==n[l]&&(g=-g),this.normals[h+2]=g}}},decodeColors:function(){for(var e=[],t=0;4>t;t++)e[t]=this.stream.readChar()
for(var i=[],t=0;4>t;t++){var r=new Tunstall
i[t]=r.decompress(this.stream)}var n=this.stream.readBitStream(),a=0
if(this.sig.indices)for(var s=0;s<this.node.nvert;s++){for(var o=4*this.last[s],u=4*s,t=0;4>t;t++){var c=this.decodeDiff(i[t][a],n)
o>=0&&(c+=this.colors[o+t]),this.colors[u]=c,u++}a++}else{for(var t=0;4>t;t++)this.colors[t]=this.decodeDiff(i[t][a],n)
a++
for(var u=4,s=1;s<this.node.nvert;s++){for(var t=0;4>t;t++){var l=this.decodeDiff(i[t][a],n)
this.colors[u]=this.colors[u-4]+l,u++}a++}}for(var h=[],t=0;4>t;t++)h[t]=1<<8-e[t]
for(var s=0;s<this.node.nvert;s++){var u=4*s,d=this.colors[u+0]*h[0],p=this.colors[u+1]*h[1],f=this.colors[u+2]*h[2]
this.colors[u+0]=f+d&255,this.colors[u+1]=d,this.colors[u+2]=p+d&255}},markBoundary:function(){for(var e=new Uint32Array(this.node.nvert),t=0,i=0;i<this.node.nface;i++)e[this.faces[t+0]]+=this.faces[t+1]-this.faces[t+2],e[this.faces[t+1]]+=this.faces[t+2]-this.faces[t+0],e[this.faces[t+2]]+=this.faces[t+0]-this.faces[t+1],t+=3
return e},norm:function(e,t,i,r){var n=e[i+0]-e[t+0],a=e[i+1]-e[t+1],s=e[i+2]-e[t+2],o=e[r+0]-e[t+0],u=e[r+1]-e[t+1],c=e[r+2]-e[t+2],l=[]
return l[0]=a*c-s*u,l[1]=s*o-n*c,l[2]=n*u-a*o,l},normalize:function(e,t){var i=e[t+0],r=e[t+1],n=e[t+2],a=Math.sqrt(i*i+r*r+n*n)
a>0&&(e[t+0]=i/a,e[t+1]=r/a,e[t+2]=n/a)},computeNormals:function(){for(var e=new Float32Array(3*this.node.nvert),t=0,i=0;i<this.node.nface;i++){var r=3*this.faces[t+0],n=3*this.faces[t+1],a=3*this.faces[t+2],s=this.coords,o=s[n+0]-s[r+0],u=s[n+1]-s[r+1],c=s[n+2]-s[r+2],l=s[a+0]-s[r+0],h=s[a+1]-s[r+1],d=s[a+2]-s[r+2],p=u*d-c*h,f=c*l-o*d,_=o*h-u*l
e[r+0]+=p,e[r+1]+=f,e[r+2]+=_,e[n+0]+=p,e[n+1]+=f,e[n+2]+=_,e[a+0]+=p,e[a+1]+=f,e[a+2]+=_,t+=3}for(var t=0,i=0;i<this.node.nvert;i++){var g=e[t+0],m=e[t+1],S=e[t+2],L=Math.sqrt(g*g+m*m+S*S)
L>0&&(e[t+0]=g/L,e[t+1]=m/L,e[t+2]=S/L),this.normals[t+0]=32767*e[t+0],this.normals[t+1]=32767*e[t+1],this.normals[t+2]=32767*e[t+2],t+=3}},decodeDiff:function(e,t){var i
return 0==e?i=1:(i=1<<e,i|=t.read(e)),i--,1&i?i=-(i+1>>1):i>>=1,i},decodeConnectivity:function(e,t){function i(e){return e++,3==e&&(e=0),e}function r(e){return e--,-1==e&&(e=2),e}for(var n=new Tunstall,a=n.decompress(this.stream),s=0,o=new Tunstall,u=o.decompress(this.stream),c=0,l=this.stream.readBitStream(l),h=0,d=new Uint32Array(12*this.node.nface),p=0,f=[],_=[],g=t,m=e,S=this.stack,L=this.coords;m>0;)if(_.length||f.length){var b
b=_.length?_.shift():f.pop()
var v=b
if(!d[v+5]){d[v+5]=1
var x=a[s++]
if(4!=x){var T=d[v+0],G=d[v+1],M=d[v+2],y=d[v+3],E=d[v+4],A=p,P=-1
if(0==x){for(var N=0;3>N;N++)S[N]=L[3*T+N]+L[3*G+N]-L[3*M+N]
var C=u[c++]
P=this.decodeVertex(l,C),0!=C&&(this.last[this.last_count++]=G),d[y+4]=A,d[E+3]=A+6,_.unshift(p),d[p++]=T,d[p++]=P,d[p++]=G,d[p++]=y,d[p++]=A+6,p++,_.push(p),d[p++]=P,d[p++]=G,d[p++]=T,d[p++]=A,d[p++]=E,p++}else if(3==x)d[y+5]=1,d[E+5]=1,d[d[y+3]+4]=d[E+4],d[d[E+4]+3]=d[y+3],P=d[y+0]
else if(1==x)d[y+5]=1,d[d[y+3]+4]=A,d[E+3]=A,P=d[y+0],_.unshift(p),d[p++]=P,d[p++]=G,d[p++]=T,d[p++]=d[y+3],d[p++]=E,p++
else if(2==x)d[E+5]=1,d[d[E+4]+3]=A,d[y+4]=A,P=d[E+1],_.unshift(p),d[p++]=T,d[p++]=P,d[p++]=G,d[p++]=y,d[p++]=d[E+4],p++
else if(5==x){d[v+5]=0,f.push(v)
continue}this.faces[g++]=G,this.faces[g++]=T,this.faces[g++]=P,m--}}}else{if(h==this.node.nface)break
S[0]=S[1]=S[2]=0
for(var D=-1,R=[],N=0;3>N;N++){this.last[this.last_count++]=D
var I=this.decodeVertex(l,u[c++])
R[N]=I,this.faces[g++]=I,S[0]=L[3*I],S[1]=L[3*I+1],S[2]=L[3*I+2],D=I}for(var w=p,N=0;3>N;N++)_.push(p),d[p++]=R[i(N)],d[p++]=R[r(N)],d[p++]=R[N],d[p++]=w+6*r(N),d[p++]=w+6*i(N),p++
h++,m--}},decodeVertex:function(e,t){if(0==t)return e.read(16)
for(var i=this.vertex_count++,r=1<<t-1,n=0;3>n;n++){var a=e.read(t)-r
this.coords[3*i+n]=this.stack[n]+a}return i},decodeDiff:function(e,t){var i
return 0==e?0:(i=1<<e,i+=t.read(e),1&i?i>>>=1:i=-(i>>>1),i)}}
var Nexus={}
Nexus.LITTLE_ENDIAN_DATA=!0,Nexus.PADDING=256,Nexus.Debug={nodes:!1,culling:!1,draw:!1,extract:!1,request:!1,worker:!1},Nexus.Attribute=function(){this.size=0,this.type=Nexus.Attribute.NONE,this.glType=Nexus.Attribute._typeGLMap[this.type],this.normalized=Nexus.Attribute._typeNormalized[this.type],this.stride=0,this.offset=0},Nexus.Attribute.NONE=0,Nexus.Attribute.BYTE=1,Nexus.Attribute.UNSIGNED_BYTE=2,Nexus.Attribute.SHORT=3,Nexus.Attribute.UNSIGNED_SHORT=4,Nexus.Attribute.INT=5,Nexus.Attribute.UNSIGNED_INT=6,Nexus.Attribute.FLOAT=7,Nexus.Attribute.DOUBLE=8,Nexus.Attribute._typeSizeMap={},Nexus.Attribute._typeSizeMap[Nexus.Attribute.NONE]=0,Nexus.Attribute._typeSizeMap[Nexus.Attribute.BYTE]=1,Nexus.Attribute._typeSizeMap[Nexus.Attribute.UNSIGNED_BYTE]=1,Nexus.Attribute._typeSizeMap[Nexus.Attribute.SHORT]=2,Nexus.Attribute._typeSizeMap[Nexus.Attribute.UNSIGNED_SHORT]=2,Nexus.Attribute._typeSizeMap[Nexus.Attribute.INT]=4,Nexus.Attribute._typeSizeMap[Nexus.Attribute.UNSIGNED_INT]=4,Nexus.Attribute._typeSizeMap[Nexus.Attribute.FLOAT]=4,Nexus.Attribute._typeSizeMap[Nexus.Attribute.DOUBLE]=8,Nexus.Attribute._typeGLMap={},Nexus.Attribute._typeGLMap[Nexus.Attribute.NONE]=WebGLRenderingContext.prototype.NONE,Nexus.Attribute._typeGLMap[Nexus.Attribute.BYTE]=WebGLRenderingContext.prototype.BYTE,Nexus.Attribute._typeGLMap[Nexus.Attribute.UNSIGNED_BYTE]=WebGLRenderingContext.prototype.UNSIGNED_BYTE,Nexus.Attribute._typeGLMap[Nexus.Attribute.SHORT]=WebGLRenderingContext.prototype.SHORT,Nexus.Attribute._typeGLMap[Nexus.Attribute.UNSIGNED_SHORT]=WebGLRenderingContext.prototype.UNSIGNED_SHORT,Nexus.Attribute._typeGLMap[Nexus.Attribute.INT]=WebGLRenderingContext.prototype.INT,Nexus.Attribute._typeGLMap[Nexus.Attribute.UNSIGNED_INT]=WebGLRenderingContext.prototype.UNSIGNED_INT,Nexus.Attribute._typeGLMap[Nexus.Attribute.FLOAT]=WebGLRenderingContext.prototype.FLOAT,Nexus.Attribute._typeGLMap[Nexus.Attribute.DOUBLE]=WebGLRenderingContext.prototype.DOUBLE,Nexus.Attribute._typeNormalized={},Nexus.Attribute._typeNormalized[Nexus.Attribute.NONE]=!0,Nexus.Attribute._typeNormalized[Nexus.Attribute.BYTE]=!0,Nexus.Attribute._typeNormalized[Nexus.Attribute.UNSIGNED_BYTE]=!0,Nexus.Attribute._typeNormalized[Nexus.Attribute.SHORT]=!0,Nexus.Attribute._typeNormalized[Nexus.Attribute.UNSIGNED_SHORT]=!0,Nexus.Attribute._typeNormalized[Nexus.Attribute.INT]=!0,Nexus.Attribute._typeNormalized[Nexus.Attribute.UNSIGNED_INT]=!0,Nexus.Attribute._typeNormalized[Nexus.Attribute.FLOAT]=!1,Nexus.Attribute._typeNormalized[Nexus.Attribute.DOUBLE]=!1,Nexus.Attribute.prototype={get isNull(){return this.type==Nexus.Attribute.NONE},get byteLength(){return Nexus.Attribute._typeSizeMap[this.type]*this.size},"import":function(e,t,i){var r=0
return this.type=e.getUint8(t+r,i),r+=Uint8Array.BYTES_PER_ELEMENT,this.size=e.getUint8(t+r,i),r+=Uint8Array.BYTES_PER_ELEMENT,this.glType=Nexus.Attribute._typeGLMap[this.type],this.normalized=Nexus.Attribute._typeNormalized[this.type],this.stride=Nexus.Attribute._typeSizeMap[this.type]*this.size,this.offset=0,r}},Nexus.Attribute.SIZEOF=2*Uint8Array.BYTES_PER_ELEMENT,Nexus.Element=function(){this.attributes=new Array(8)
for(var e=0;8>e;++e)this.attributes[e]=new Nexus.Attribute
this.lastAttribute=-1},Nexus.Element.prototype={get byteLength(){for(var e=0,t=0;t<this.attributes.length;++t)e+=this.attributes[t].byteLength
return e},"import":function(e,t,i){for(var r=0,n=0;n<this.attributes.length;++n){var a=this.attributes[n]
r+=a["import"](e,t+r,i),a.isNull||(this.lastAttribute=n)}return r}},Nexus.Element.SIZEOF=8*Nexus.Attribute.SIZEOF,Nexus.VertexElement=function(){Nexus.Element.call(this)},Nexus.VertexElement.SIZEOF=Nexus.Element.SIZEOF,Nexus.VertexElement.POSITION=0,Nexus.VertexElement.NORMAL=1,Nexus.VertexElement.COLOR=2,Nexus.VertexElement.TEXCOORD=3,Nexus.VertexElement.DATA0=4,Nexus.VertexElement.prototype={get hasPosition(){return!this.attributes[Nexus.VertexElement.POSITION].isNull},get hasNormal(){return!this.attributes[Nexus.VertexElement.NORMAL].isNull},get hasColor(){return!this.attributes[Nexus.VertexElement.COLOR].isNull},get hasTexCoord(){return!this.attributes[Nexus.VertexElement.TEXCOORD].isNull},hasData:function(e){return!this.attributes[Nexus.VertexElement.DATA0+e].isNull},"import":function(e,t,i){var r=Nexus.Element.prototype["import"].apply(this,arguments),n=this.attributes[Nexus.VertexElement.COLOR]
return n.isNull||n.type==Nexus.Attribute.BYTE&&(n.type=Nexus.Attribute.UNSIGNED_BYTE,n.glType=Nexus.Attribute._typeGLMap[n.type]),r}},sglExtend(Nexus.VertexElement,Nexus.Element),Nexus.FaceElement=function(){Nexus.Element.call(this)},Nexus.FaceElement.SIZEOF=Nexus.Element.SIZEOF,Nexus.FaceElement.INDEX=0,Nexus.FaceElement.NORMAL=1,Nexus.FaceElement.COLOR=2,Nexus.FaceElement.TEXCOORD=3,Nexus.FaceElement.DATA0=4,Nexus.FaceElement.prototype={get hasIndex(){return!this.attributes[Nexus.FaceElement.INDEX].isNull},get hasNormal(){return!this.attributes[Nexus.FaceElement.NORMAL].isNull},get hasColor(){return!this.attributes[Nexus.FaceElement.COLOR].isNull},get hasTexCoord(){return!this.attributes[Nexus.FaceElement.TEXCOORD].isNull},hasData:function(e){return!this.attributes[Nexus.FaceElement.DATA0+e].isNull},"import":function(e,t,i){var r=Nexus.Element.prototype["import"].apply(this,arguments),n=this.attributes[Nexus.FaceElement.COLOR]
return n.isNull||n.type==Nexus.Attribute.BYTE&&(n.type=Nexus.Attribute.UNSIGNED_BYTE,n.glType=Nexus.Attribute._typeGLMap[n.type]),r}},sglExtend(Nexus.FaceElement,Nexus.Element),Nexus.Signature=function(){this.vertex=new Nexus.VertexElement,this.face=new Nexus.FaceElement,this.flags=Nexus.Signature.UNCOMPRESSED},Nexus.Signature.SIZEOF=Nexus.VertexElement.SIZEOF+Nexus.FaceElement.SIZEOF+Uint32Array.BYTES_PER_ELEMENT,Nexus.Signature.PTEXTURE=1,Nexus.Signature.MECO=2,Nexus.Signature.CTM1=4,Nexus.Signature.CTM2=8,Nexus.Signature.prototype={"import":function(e,t,i){var r=0
return r+=this.vertex["import"](e,t+r,i),r+=this.face["import"](e,t+r,i),this.flags=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT}},Nexus.Sphere3f=function(){this.center=[0,0,0],this.radius=1},Nexus.Sphere3f.SIZEOF=4*Float32Array.BYTES_PER_ELEMENT,Nexus.Sphere3f.prototype={"import":function(e,t,i){for(var r=0,n=0;3>n;++n)this.center[n]=e.getFloat32(t+r,i),r+=Float32Array.BYTES_PER_ELEMENT
return this.radius=e.getFloat32(t+r,i),r+=Float32Array.BYTES_PER_ELEMENT}},Nexus.Header=function(){this.reset()},Nexus.Header.SIZEOF=5*Uint32Array.BYTES_PER_ELEMENT+4*Uint32Array.BYTES_PER_ELEMENT+Nexus.Signature.SIZEOF+Nexus.Sphere3f.SIZEOF,Nexus.Header.MAGIC=1316516640,Nexus.Header.prototype={_getUint64:function(e,t,i){var r=0,n=e.getUint32(t+r,i)
r+=Uint32Array.BYTES_PER_ELEMENT
var a=e.getUint32(t+r,i)
return r+=Uint32Array.BYTES_PER_ELEMENT,1*a+n},get isValid(){return this.version>0},reset:function(){this.magic=0,this.version=0,this.verticesCount=0,this.facesCount=0,this.signature=new Nexus.Signature,this.nodesCount=0,this.patchesCount=0,this.texturesCount=0,this.sphere=new Nexus.Sphere3f},"import":function(e,t,i){this.reset()
var r=0
return this.magic=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT,this.magic!=Nexus.Header.MAGIC?0:(this.version=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT,this.verticesCount=this._getUint64(e,t+r,i),r+=2*Uint32Array.BYTES_PER_ELEMENT,this.facesCount=this._getUint64(e,t+r,i),r+=2*Uint32Array.BYTES_PER_ELEMENT,r+=this.signature["import"](e,t+r,i),this.nodesCount=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT,this.patchesCount=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT,this.texturesCount=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT,r+=this.sphere["import"](e,t+r,i))}},Nexus.Cone3s=function(){this.n=[0,0,0,0]},Nexus.Cone3s.SIZEOF=4*Uint16Array.BYTES_PER_ELEMENT,Nexus.Cone3s.prototype={backFace:function(e,t){for(var i=this.n,r=[i[0]/32766,i[1]/32766,i[2]/32766],n=[0,0,0],a=0,s=0,o=0;3>o;++o)n[o]=e.center[o]-r[o]*e.radius-t[o],r[o]*=i[3]/32766,a+=n[o]*r[o],s=n[o]*n[o]
return!(.001>a||s>a*a)},frontFace:function(e,t){for(var i=this.n,r=[i[0]/32766,i[1]/32766,i[2]/32766],n=[0,0,0],a=0,s=0,o=0;3>o;++o)n[o]=e.center[o]+r[o]*e.radius-t[o],r[o]*=i[3]/32766,a+=-n[o]*r[o],s=n[o]*n[o]
return!(.001>a||s>a*a)},"import":function(e,t,i){for(var r=0,n=0;4>n;++n)this.n[n]=e.getInt16(t+r,i),r+=Uint16Array.BYTES_PER_ELEMENT
return r}},Nexus.Node=function(){this.offset=0,this.verticesCount=0,this.facesCount=0,this.error=0,this.cone=new Nexus.Cone3s,this.sphere=new Nexus.Sphere3f,this.tightRadius=0,this.firstPatch=0,this.lastPatch=0,this.lastByte=0},Nexus.Node.SIZEOF=2*Uint32Array.BYTES_PER_ELEMENT+2*Uint16Array.BYTES_PER_ELEMENT+2*Float32Array.BYTES_PER_ELEMENT+Nexus.Sphere3f.SIZEOF+Nexus.Cone3s.SIZEOF,Nexus.Node.prototype={get isEmpty(){return this.end==this.outBegin},"import":function(e,t,i){var r=0
return this.offset=Nexus.PADDING*e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT,this.verticesCount=e.getUint16(t+r,i),r+=Uint16Array.BYTES_PER_ELEMENT,this.facesCount=e.getUint16(t+r,i),r+=Uint16Array.BYTES_PER_ELEMENT,this.error=e.getFloat32(t+r,i),r+=Float32Array.BYTES_PER_ELEMENT,r+=this.cone["import"](e,t+r,i),r+=this.sphere["import"](e,t+r,i),this.tightRadius=e.getFloat32(t+r,i),r+=Float32Array.BYTES_PER_ELEMENT,this.firstPatch=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT}},Nexus.NodeIndex=function(){this.items=[]},Nexus.NodeIndex.prototype={get length(){return this.items.length},get sink(){return this.items.length-1},"import":function(e,t,i,r){this.items=new Array(e)
for(var n=0,a=0;e>a;++a){var s=new Nexus.Node
n+=s["import"](t,i+n,r),s.index=a,this.items[a]=s}for(var a=0;e-1>a;++a){var o=this.items[a],u=this.items[a+1]
o.lastPatch=u.firstPatch,o.lastByte=u.offset-1}return n}},Nexus.Patch=function(){this.node=0,this.lastTriangle=0,this.texture=0},Nexus.Patch.SIZEOF=3*Uint32Array.BYTES_PER_ELEMENT,Nexus.Patch.prototype={"import":function(e,t,i){var r=0
return this.node=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT,this.lastTriangle=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT,this.texture=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT}},Nexus.PatchIndex=function(){this.items=[]},Nexus.PatchIndex.prototype={get length(){return this.items.length},"import":function(e,t,i,r){this.items=new Array(e)
for(var n=0,a=0;e>a;++a){var s=new Nexus.Patch
n+=s["import"](t,i+n,r),this.items[a]=s}return n}},Nexus.Texture=function(){this.offset=0,this.matrix=new Array(16),this.lastByte=0},Nexus.Texture.SIZEOF=1*Uint32Array.BYTES_PER_ELEMENT+16*Float32Array.BYTES_PER_ELEMENT,Nexus.Texture.prototype={"import":function(e,t,i){var r=0
this.offset=e.getUint32(t+r,i),r+=Uint32Array.BYTES_PER_ELEMENT
for(var n=0;16>n;++n)this.matrix[n]=e.getFloat32(t+r,i),r+=Float32Array.BYTES_PER_ELEMENT
return r}},Nexus.TextureIndex=function(){this.items=[]},Nexus.TextureIndex.prototype={get length(){return this.items.length},"import":function(e,t,i,r){this.items=new Array(e)
for(var n=0,a=0;e>a;++a){var s=new Nexus.Texture
n+=s["import"](t,i+n,r),this.items[a]=s}for(var a=0;e-1>a;++a){var o=this.items[a],u=this.items[a+1]
o.lastByte=u.offset-1}return n}},Nexus.PriorityQueue=function(){this.content=[]},Nexus.PriorityQueue.prototype={push:function(e){this.bubbleUp(this.content.push(e)-1)},pop:function(){var e=this.content[0],t=this.content.pop()
return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var i=(e+1>>1)-1,r=this.content[i]
if(r.node.renderError>t.node.renderError)break
this.content[i]=t,this.content[e]=r,e=i}},sinkDown:function(e){for(var t=this.content.length,i=this.content[e];;){var r=2*(e+1),n=r-1,a=null
if(t>n){var s=this.content[n]
s.node.renderError>i.node.renderError&&(a=n)}if(t>r){var o=this.content[r]
o.node.renderError>(null==a?i.node.renderError:s.node.renderError)&&(a=r)}if(null==a)break
this.content[e]=this.content[a],this.content[a]=i,e=a}}},Nexus.Plane3f=function(e,t,i){this._normal=SglVec3.normalize(SglVec3.cross(SglVec3.sub(t,e),SglVec3.sub(i,e))),this._offset=SglVec3.dot(e,this._normal)},Nexus.Plane3f.prototype={get normal(){return this._normal.slice()},get offset(){return this._offset},signedDistanceToPoint:function(e){return SglVec3.dot(this._normal,e)-this._offset}},Nexus.Renderer=function(e){this._gl=e,this._targetError=Nexus.Renderer.DEFAULT_TARGET_ERROR,this._targetFps=null,this._maxPendingRequests=Nexus.Renderer.DEFAULT_MAX_PENDING_REQUESTS,this._maxCacheSize=Nexus.Renderer.DEFAULT_CACHE_SIZE,this._drawBudget=Nexus.Renderer.DEFAULT_DRAW_BUDGET,this._minDrawBudget=Nexus.Renderer.DEFAULT_DRAW_BUDGET/4,this._onUpdate=null,this._onSceneReady=null,this._mmat=SglMat4.identity(),this._vmat=SglMat4.identity(),this._pmat=SglMat4.identity(),this._vp=[0,0,1,1],this._reset(),this._updateView()},Nexus.Renderer.STATUS_NONE=0,Nexus.Renderer.STATUS_OPENING=1,Nexus.Renderer.STATUS_OPEN=2,Nexus.Renderer.DEFAULT_TARGET_ERROR=1,Nexus.Renderer.DEFAULT_TARGET_FPS=20,Nexus.Renderer.DEFAULT_MAX_PENDING_REQUESTS=3,Nexus.Renderer.DEFAULT_CACHE_SIZE=268435456,Nexus.Renderer.DEFAULT_DRAW_BUDGET=2097152,Nexus.Renderer._NODE_NONE=0,Nexus.Renderer._NODE_PENDING=1,Nexus.Renderer._NODE_READY=2,Nexus.Renderer._sortPatchesFunction=function(e,t){return e.frame!=t.frame?t.frame-e.frame:t.error-e.error},Nexus.Renderer._sortNodesFunction=function(e,t){return e.node.renderError-t.node.renderError},Nexus.Renderer._sortNodeCacheFunction=function(e,t){return e.renderFrame!=t.renderFrame?t.renderFrame-e.renderFrame:t.renderError-e.renderError},Nexus.Renderer.prototype={_reset:function(){this._status=Nexus.Renderer.STATUS_NONE,this._inBegin=!1,this._url=null,this._header=null,this._nodes=null,this._patches=null,this._textures=null,this._visitedNodes=null,this._blockedNodes=null,this._selectedNodes=null,this._drawSize=0,this._rendered=0,this._estimatedTpS=2e5,this._cacheSize=0,this._cachedNodes=null,this._readyNodes=null,this._frame=0,this._pendingRequests=0,this._candidateNodes=null,this._redrawOnNewNodes=!0
var e,t=this
$("script").each(function(t){var i=$(this).attr("src")
i&&i.search("nexus.js")>=0&&(e=i)}),e=e.replace("nexus.js","meshcoder_worker.js"),this._worker=new Worker(e),this._worker.onmessage=function(e){t._workerFinished(e)}},_requestHeader:function(){var e=0,t=Nexus.Header.SIZEOF,i=this,r=this._url;-1!=navigator.userAgent.toLowerCase().indexOf("safari")&&-1==navigator.userAgent.toLowerCase().indexOf("chrome")&&(r=this._url+"?"+Math.random())
var n=new SglBinaryRequest(r,{range:[e,e+t-1],onSuccess:function(){i._handleHeader(n.buffer),i._requestIndex()}})},_handleHeader:function(e){var t=new DataView(e),i=0,r=Nexus.LITTLE_ENDIAN_DATA,n=new Nexus.Header
n["import"](t,i,r),this._header=n},_requestIndex:function(){var e=this._header,t=Nexus.Header.SIZEOF,i=e.nodesCount*Nexus.Node.SIZEOF+e.patchesCount*Nexus.Patch.SIZEOF+e.texturesCount*Nexus.Texture.SIZEOF,r=this,n=this._url;-1!=navigator.userAgent.toLowerCase().indexOf("safari")&&-1==navigator.userAgent.toLowerCase().indexOf("chrome")&&(n=this._url+"?"+Math.random())
var a=new SglBinaryRequest(n,{range:[t,t+i-1],onSuccess:function(){r._handleIndex(a.buffer),r._openReady()}})},_handleIndex:function(e){var t=this._header,i=new DataView(e),r=0,n=Nexus.LITTLE_ENDIAN_DATA,r=0
this._nodes=new Nexus.NodeIndex,r+=this._nodes["import"](t.nodesCount,i,r,n),this._patches=new Nexus.PatchIndex,r+=this._patches["import"](t.patchesCount,i,r,n),this._textures=new Nexus.TextureIndex,r+=this._textures["import"](t.texturesCount,i,r,n)},_openReady:function(){for(var e=this._nodes.length,t=this._nodes.items,i=0;e>i;++i){var r=t[i]
r.status=Nexus.Renderer._NODE_NONE,r.request=null,r.vbo=null,r.ibo=null,r.color=[sglRandom01(),sglRandom01(),sglRandom01(),1],r.renderError=0,r.renderFrame=0}this._cachedNodes=[],this._readyNodes=[],this._pendingNodes=[]
var e=this._header.nodesCount
this._visitedNodes=new Uint8Array(e),this._blockedNodes=new Uint8Array(e),this._selectedNodes=new Uint8Array(e),this._status=Nexus.Renderer.STATUS_OPEN,this._onSceneReady&&this._onSceneReady()},_signalUpdate:function(){var e=this._onUpdate
e&&e()},get gl(){return this._gl},get isValid(){return!!this._gl},get onSceneReady(){return this._onSceneReady},set onSceneReady(e){this._onSceneReady=e},get onUpdate(){return this._onUpdate},set onUpdate(e){this._onUpdate=e},get status(){return this._status},get isClosed(){return this._status==Nexus.Renderer.STATUS_NONE},get isOpening(){return this._status==Nexus.Renderer.STATUS_OPENING},get isOpen(){return this._status==Nexus.Renderer.STATUS_OPEN},get url(){return this._url},get isReady(){return this.isOpen},get datasetCenter(){return this.isReady?this._header.sphere.center.slice(0,3):[0,0,0]},get datasetRadius(){return this.isReady?this._header.sphere.radius:1},get inBegin(){return this._inBegin},get maxPendingRequests(){return this._maxPendingRequests},set maxPendingRequests(e){this._maxPendingRequests=e},get targetError(){return this._targetError},set targetError(e){this._targetError=e},get drawBudget(){return this._drawBudget},set drawBudget(e){this._drawBudget=e},get modelMatrix(){return this._mmat.slice(0,16)},set modelMatrix(e){this.inBegin||(this._mmat=e.slice(0,16))},get viewMatrix(){return this._vmat.slice(0,16)},set viewMatrix(e){this.inBegin||(this._vmat=e.slice(0,16))},get projectionMatrix(){return this._pmat.slice(0,16)},set projectionMatrix(e){this.inBegin||(this._pmat=e.slice(0,16))},get viewport(){return this._vp.slice(0,4)},set viewport(e){this.inBegin||(this._vp=e.slice(0,4))},destroy:function(){this.close()},open:function(e){this.isValid&&(this.close(),this._status=Nexus.Renderer.STATUS_OPENING,this._url=e,this._requestHeader())},close:function(){this.isClosed||(this.isOpening||this.isOpen,this._reset())},_updateCache:function(){var e=this._readyNodes
if(!(e.length<=0)){var t=this._cachedNodes,i=t.concat(e)
i.sort(Nexus.Renderer._sortNodeCacheFunction)
for(var r=this._maxCacheSize,n=0,a=-1,s=[],o=0,u=i.length;u>o;++o){var c=i[o],l=c.lastByte-c.offset+1
if(n+l>r){a=o
break}c.request?s.push(c):n+=l}if(a>=0){for(var o=a,u=i.length;u>o;++o){var c=i[o]
c.vbo&&(c.vbo.destroy(),c.vbo=null),c.ibo&&(c.ibo.destroy(),c.ibo=null),c.request=null,c.status=Nexus.Renderer._NODE_NONE}i=i.slice(0,a)}for(var h=this._header.signature.vertex.byteLength,d=this._header.signature.face.byteLength,p=(Nexus.LITTLE_ENDIAN_DATA,this._gl),o=0,u=s.length;u>o;++o){var c=s[o],f=Nexus.Signature.MECO+Nexus.Signature.CTM1+Nexus.Signature.CTM2
if(Nexus.Debug.worker&&this._header.signature.flags&f){for(var _=c.request,g=_.buffer,m={normals:this._header.signature.vertex.hasNormal,colors:this._header.signature.vertex.hasColor,indices:this._header.signature.face.hasIndex},S={nvert:c.verticesCount,nface:c.facesCount,firstPatch:0,lastPatch:c.lastPatch-c.firstPatch,buffer:c.request.buffer},L=[],b=c.firstPatch;b<c.lastPatch;b++)L.push(this._patches.items[b].lastTriangle)
if(this._header.signature.flags&Nexus.Signature.MECO){var v=new MeshCoder(m,S,L)
c.buffer=v.decode(g)}else c.buffer=ctmDecode(m,S,L)}var x=0,T=c.verticesCount,G=c.facesCount,M=x,y=T*h,E=M+y,A=G*d,P=new Uint8Array(c.buffer,M,y),N=new Uint8Array(c.buffer,E,A)
c.vbo=new SglVertexBuffer(p,{data:P}),this._header.signature.face.hasIndex&&(c.ibo=new SglIndexBuffer(p,{data:N})),c.request=null,c.status=Nexus.Renderer._NODE_READY
var l=c.lastByte-c.offset+1
n+=l}this._readyNodes=[],this._cachedNodes=i,this._cacheSize=n}},_hierarchyVisit_isVisible:function(e,t){if(Nexus.Debug.culling)return!0
for(var i=this._planes,r=0;4>r;++r){var n=i[r],a=n._normal,s=a[0]*e[0]+a[1]*e[1]+a[2]*e[2]
if(s-n._offset+t<0)return!1}return!0},_hierarchyVisit_nodeError:function(e){var t=this._nodes.items[e],i=t.sphere,r=i.center,n=this._viewPoint,a=r[0]-n[0],s=r[1]-n[1],o=r[2]-n[2],u=Math.sqrt(a*a+s*s+o*o)-i.radius;.1>u&&(u=.1)
var c=this._resolution*u,l=t.error/c
return this._hierarchyVisit_isVisible(i.center,i.radius)||(l/=1e3),l},_hierarchyVisit_insertNode:function(e,t){if(e!=this._nodes.sink&&!this._visitedNodes[e]){this._visitedNodes[e]=1
var i=this._hierarchyVisit_nodeError(e)
if(!(i<.8*this._targetError)){var r=this._nodes.items[e]
r.renderError=i,r.renderFrame=this._frame
var n={node:r,index:e}
t.push(n)}}},_hierarchyVisit_expandNode:function(e){var t=e.node
if(t.renderError<this._targetError)return!1
if(this._drawSize>this._drawBudget)return!1
var i=t.sphere
return this._hierarchyVisit_isVisible(i.center,t.tightRadius)&&(this._drawSize+=t.verticesCount/2),t.status!=Nexus.Renderer._NODE_READY?(this._redrawOnNewNodes=!0,!1):!0},_hierarchyVisit_insertChildren:function(e,t,i){for(var r=this._nodes.items,n=r[e],a=this._patches.items,s=this._blockedNodes,o=n.firstPatch;o<n.lastPatch;++o){var u=a[o],c=u.node
i&&(s[c]=1),this._hierarchyVisit_insertNode(c,t)}},_hierarchyVisit:function(){if(1!=Nexus.Debug.extract){this._redrawOnNewNodes=!1
for(var e=new Nexus.PriorityQueue,t=this._nodes.length,i=0;t>i;i++)this._visitedNodes[i]=0,this._blockedNodes[i]=0,this._selectedNodes[i]=0
this._hierarchyVisit_insertNode(0,e)
var r=(this._nodes.items,0)
this._candidateNodes=[]
var n=this._candidateNodes
this.currentError=1e20,this._drawSize=0
for(var a=0;e.size()&&a<this._maxPendingRequests;){var s=e.pop(),o=s.index,u=s.node
r<this._maxPendingRequests&&u.status==Nexus.Renderer._NODE_NONE&&(r++,n.push(u))
var c=this._blockedNodes[o]||!this._hierarchyVisit_expandNode(s)
c?a++:(this._selectedNodes[o]=1,this.currentError=s.node.renderError),this._hierarchyVisit_insertChildren(o,e,c)}}},_createNodeHandler:function(e){var t=this
return function(){t._header.signature.flags&i
var i=Nexus.Signature.MECO+Nexus.Signature.CTM1+Nexus.Signature.CTM2
if(!Nexus.Debug.worker&&t._header.signature.flags&i){for(var r={normals:t._header.signature.vertex.hasNormal,colors:t._header.signature.vertex.hasColor,indices:t._header.signature.face.hasIndex},n={index:e.index,nvert:e.verticesCount,nface:e.facesCount,firstPatch:0,lastPatch:e.lastPatch-e.firstPatch,buffer:e.request.buffer},a=[],s=e.firstPatch;s<e.lastPatch;s++)a.push(t._patches.items[s].lastTriangle)
t._header.signature.flags&Nexus.Signature.MECO&&t._worker.postMessage({signature:r,node:n,patches:a})}else t._workerFinished({data:{index:e.index,buffer:e.request.buffer}})}},_workerFinished:function(e){var t=this._nodes.items[e.data.index]
t.buffer=e.data.buffer,this._readyNodes.push(t),this._redrawOnNewNodes&&this._signalUpdate()},_requestNodes:function(){if(Nexus.Debug.request)return void(this._candidateNodes=[])
var e=this._candidateNodes
if(!(e.length<=0)){var t=this._cachedNodes.slice()
t.sort(Nexus.Renderer._sortNodeCacheFunction)
for(var i=0,r=this._cacheSize,n=0,a=e.length;a>n;++n){var s=e[n],o=this._maxCacheSize-r,u=0,c=s.lastByte-s.offset+1,l=t.length
if(c>o)for(var h=t.length-1;h>=0;--h){var d=t[h],p=d.lastByte-d.offset+1
if(l=h,Nexus.Renderer._sortNodeCacheFunction(s,d)>=0)break
if(o+=p,u+=p,o>=c)break}if(!(o>=c))break
i++,t=t.slice(0,l),t.push(s),r-=u,r+=c}for(var f=this._url,n=0;i>n;++n){-1!=navigator.userAgent.toLowerCase().indexOf("safari")&&-1==navigator.userAgent.toLowerCase().indexOf("chrome")&&(f=this._url+"?"+Math.random())
var _=e[n]
_.status=Nexus.Renderer._NODE_PENDING,_.request=new SglBinaryRequest(f,{range:[_.offset,_.lastByte],onSuccess:this._createNodeHandler(_)})}this._candidateNodes=[]}},_unproject:function(e){var t=[(e[0]-this._vp[0])/(this._vp[2]/2)-1,(e[1]-this._vp[1])/(this._vp[3]/2)-1,2*e[2]-1,1]
return t=SglMat4.mul4(this._mvpmati,t),t=SglVec3.divs(SglVec4.to3(t),t[3])},_updateView:function(){this._mvmat=SglMat4.mul(this._vmat,this._mmat),this._mvpmat=SglMat4.mul(this._pmat,this._mvmat),this._mvpmati=SglMat4.inverse(this._mvpmat),this._viewPoint=SglVec4.to3(SglMat4.col(SglMat4.inverse(this._mvmat),3))
var e=this._vp[0],t=this._vp[0]+this._vp[2],i=this._vp[1],r=this._vp[1]+this._vp[3],n=this._unproject([e,i,0]),a=this._unproject([t,i,0]),s=this._unproject([e,r,0]),o=this._unproject([t,r,0]),u=this._unproject([e,i,1]),c=this._unproject([t,i,1]),l=this._unproject([e,r,1]),h=this._unproject([t,r,1]),d=new Array(6)
this._planes=d,d[0]=new Nexus.Plane3f(s,n,l),d[1]=new Nexus.Plane3f(a,o,c),d[2]=new Nexus.Plane3f(n,a,u),d[3]=new Nexus.Plane3f(o,s,h),d[4]=new Nexus.Plane3f(u,c,l),d[5]=new Nexus.Plane3f(a,n,o),this._resolution=SglVec3.length(SglVec3.sub(SglVec3.divs(SglVec3.add(a,c),2),SglVec3.divs(SglVec3.add(n,u),2)))/(this._vp[2]*SglVec3.length(SglVec3.sub(SglVec3.divs(SglVec3.add(a,SglVec3.add(c,SglVec3.add(n,u))),4),this._viewPoint)))},_prepare:function(){this._updateView(),this._updateCache(),this._hierarchyVisit(),this._requestNodes()},_beginRender:function(){},_endRender:function(){},_render:function(){var e=this._gl
e.glDrawElements=e._spidergl.wn._ext.glFunctions.drawElements
for(var t=(this._header.signature.vertex.byteLength,this._header.signature.vertex.attributes),i=this._header.signature.vertex.lastAttribute+1,r=0;i>r;++r)t[r].isNull||e.enableVertexAttribArray(r)
e.vertexAttrib4fv(Nexus.VertexElement.COLOR,[.8,.8,.8,1]),Nexus.Debug.nodes&&(t[Nexus.VertexElement.COLOR].isNull||e.disableVertexAttribArray(Nexus.VertexElement.COLOR))
var n=this._nodes.items,a=this._patches.items,s=this._selectedNodes,o=n.length
this._rendered=0
for(var r=0;o>r;++r)if(s[r]){var u=n[r]
if(this._header.signature.face.hasIndex){for(var c=!0,l=u.firstPatch;l<u.lastPatch;++l){var h=a[l]
if(!s[h.node]){c=!1
break}}if(c)continue}if(this._hierarchyVisit_isVisible(u.sphere.center,u.tightRadius)){u.vbo.bind(),u.ibo&&u.ibo.bind()
for(var d=0,p=0;i>p;++p){var f=t[p]
f.isNull||(e.vertexAttribPointer(p,f.size,f.glType,f.normalized,f.stride,f.offset+d),d+=f.offset+f.stride*u.verticesCount)}if(Nexus.Debug.nodes&&e.vertexAttrib4fv(Nexus.VertexElement.COLOR,u.color),!this._header.signature.face.hasIndex){var _=Math.floor(.3*u.renderError)
_>3&&(_=3),e.vertexAttrib1fv(Nexus.VertexElement.DATA0,[_])}if(!Nexus.Debug.draw)if(this._header.signature.face.hasIndex)for(var g=0,m=0,l=u.firstPatch;l<u.lastPatch;++l){var h=a[l]
!s[h.node]&&(m=h.lastTriangle,l<u.lastPatch-1)||(m>g&&(e.glDrawElements(e.TRIANGLES,3*(m-g),e.UNSIGNED_SHORT,3*g*Uint16Array.BYTES_PER_ELEMENT),this._rendered+=m-g),g=h.lastTriangle)}else{var S=u.renderError/this.currentError-1
S>1&&(S=1)
var L=S*u.verticesCount
e.drawArrays(e.POINTS,0,L),this._rendered+=L}}}for(var r=0;i>r;++r)t[r].isNull||e.disableVertexAttribArray(r)
SglVertexBuffer.unbind(e),SglIndexBuffer.unbind(e)},begin:function(){this.isOpen&&(this.inBegin||(this._inBegin=!0,this._header.nodesCount<=0||this._prepare()))},end:function(){this.inBegin&&(this._frame++,this._inBegin=!1)},render:function(){this.inBegin&&(this._beginRender(),this._render(),this._endRender())}}
var parsePly=function(){function trim(e){for(var t=e,i=t.length,r=0,n=" \n\r	";i>r&&n.indexOf(t.charAt(r))>=0;)r++
for(t=t.substring(r,t.length),r=t.length-1;r>0&&n.indexOf(t.charAt(r))>=0;)r--
return t=t.substring(0,r+1)}function extractHeader(e){if(!e||!e.view||!e.view.buffer)return null
var t=new Uint8Array(e.view.buffer),i="end_header",r="",n=!1,a=null,s=null,o=e.pos,u=0,c=0
for(o=0,c=t.byteLength;c>o;++o){if(a=String.fromCharCode(t[o]),r+=a,"\n"===a&&o>=i.length&&(u=o-i.length,"\r"==s&&u--,r.substring(u,u+i.length)==i)){n=!0
break}s=a}return e.pos=o,n?(e.pos++,r):null}function splitHeader(e){for(var t=e.split("\n"),i=[],r=null,n=null,a=0,s=t.length;s>a;++a)if(n=trim(t[a]),n&&(r=n.split(" "),r.length>0)){for(var o=0,u=r.length;u>o;++o)r[o]=trim(r[o])
i.push(r)}return i}function parseHeader(e){if(!e||e.length<=0)return null
if("ply"!=e[0][0])return null
for(var t=null,i=null,r=null,n=null,a=0,s={format:null,elements:[],elementMap:{},comments:[],others:[]},o=1;o<e.length-1;++o)switch(r=e[o],a=r.length,n=r[0].toLowerCase()){case"format":a>=3&&(s.format={name:r[1],version:r[2],binary:r[1].toLowerCase().indexOf("binary")>=0,littleEndian:"binary_little_endian"==r[1].toLowerCase()})
break
case"comment":s.comments.push(r.slice(1))
break
case"element":a>=3&&(t={name:r[1],count:parseInt(r[2]),properties:[],propertyMap:{}},s.elements.push(t),s.elementMap[t.name.toLowerCase()]=t)
break
case"property":t&&a>=3&&(i={name:r[a-1],type:r.slice(1,a-1)},t.properties.push(i),t.propertyMap[i.name.toLowerCase()]=i)
break
default:s.others.push(r.slice())}return s.format?s:!1}function setupLines(e,t){for(var i=0,r=e.length;r>i;++i)e[i]=t+e[i]
return e}function generateReadValue(e,t,i,r,n,a,s,o){var u=[],c=t[i]
if("list"==c.toLowerCase()){var l="n"+s,h="v"+s,d="i"+s
o[l]=!0,o[h]=!0,o[d]=!0,s++,i++,u=u.concat(u,generateReadValue(""+l,t,i,r,n,"",s,o)),i++,u.push(h+" = new Array("+l+");"),u.push("for ("+d+"=0; "+d+"<"+l+"; ++"+d+") {"),u=u.concat(generateReadValue(h+"["+d+"]",t,i,r,n,tabStr,s,o)),u.push("}"),u.push(e+" = "+h+";")}else if(r)switch(c){case"char":case"int8":u.push(e+" = view.getInt8(pos, "+n+");"),u.push("pos += 1;")
break
case"uchar":case"uint8":u.push(e+" = view.getUint8(pos, "+n+");"),u.push("pos += 1;")
break
case"short":case"int16":u.push(e+" = view.getInt16(pos, "+n+");"),u.push("pos += 2;")
break
case"ushort":case"uint16":u.push(e+" = view.getUint16(pos, "+n+");"),u.push("pos += 2;")
break
case"int":case"int32":u.push(e+" = view.getInt32(pos, "+n+");"),u.push("pos += 4;")
break
case"uint":case"uint32":u.push(e+" = view.getUint32(pos, "+n+");"),u.push("pos += 4;")
break
case"float":case"float32":u.push(e+" = view.getFloat32(pos, "+n+");"),u.push("pos += 4;")
break
case"double":case"float64":u.push(e+" = view.getFloat64(pos, "+n+");"),u.push("pos += 8;")}else switch(c){case"char":case"int8":case"uchar":case"uint8":case"short":case"int16":case"ushort":case"uint16":case"int":case"int32":case"uint":case"uint32":u.push(e+" = parseInt(view[pos]);"),u.push("pos += 1;")
break
case"float":case"float32":case"double":case"float64":u.push(e+" = parseFloat(view[pos]);"),u.push("pos += 1;")}return setupLines(u,a),u}function generateReadProperty(e,t,i,r,n,a,s){var o=generateReadValue(e,t,0,i,r,"",a,s)
return o}function generateReadElement(e,t,i,r,n,a,s){for(var o=null,u=[],c=0,l=t.length;l>c;++c)o=t[c],u=u.concat(generateReadProperty(e+'["'+o.name+'"]',o.type,i,r,"",a,s)),u.push("")
return setupLines(u,n),u}function generateReadElements(e,t,i,r,n,a,s){var o=[],u="n"+a,c="i"+a
return a++,s[u]=!0,s[c]=!0,s.element=!0,s.elem=!0,s.args=!0,o.push("element = info.elements["+e+"];"),o.push(u+" = element.count;"),o.push("elem = { };"),o.push("args = [ info, element, 0, elem];"),o.push("callbacks.onBeginElements.call(handler, info, element);"),o.push("for ("+c+"=0; "+c+"<"+u+"; ++"+c+") {"),o=o.concat(generateReadElement("elem",t.properties,i,r,tabStr,a,s)),o.push(tabStr+"args[2] = "+c+";"),o.push(tabStr+"callbacks.onElement.apply(handler, args);"),o.push("}"),o.push("callbacks.onEndElements.call(handler, info, element);"),setupLines(o,n),o}function generateReadMesh(e,t,i){var r=[]
r.push("function (data, info, callbacks, handler) {"),r.push(tabStr+"var view = data.view;"),r.push(tabStr+"var pos  = data.pos;"),r.push("")
for(var n={},a=[],s=0,o=e.length;o>s;++s)a=a.concat(generateReadElements(s,e[s],t,i,tabStr,0,n)),a.push("")
var u=[]
for(var c in n)u.push(c)
u.sort(),r.push(tabStr+"var "+u.join(", ")+";"),r.push(""),r.push(tabStr+"callbacks.onBeginContent.call(handler, info);"),r=r.concat(a),r.push(tabStr+"callbacks.onEndContent.call(handler, info);"),r.push(tabStr+"data.pos = pos;"),r.push("}"),setupLines(r,"")
for(var l="",s=0,o=r.length;o>s;++s)l+=r[s]+"\n"
return l}function getMeshInfo(e){if(!e)return null
var t=extractHeader(e)
if(!t)return null
var i=splitHeader(t)
if(!i)return null
var r=parseHeader(i)
return r?r:null}function mainParsePly(buffer,handler){function emptyFunc(){}if(!buffer)return null
handler=handler||{}
var callbacks={onBegin:handler.onBegin||emptyFunc,onHeader:handler.onHeader||emptyFunc,onBeginContent:handler.onBeginContent||emptyFunc,onBeginElements:handler.onBeginElements||emptyFunc,onElement:handler.onElement||emptyFunc,onEndElements:handler.onEndElements||emptyFunc,onEndContent:handler.onEndContent||emptyFunc,onEnd:handler.onEnd||emptyFunc},dataView=new DataView(buffer),data={view:dataView,pos:0},info=getMeshInfo(data)
if(!info)return!1
info.format.binary||(data.view=Array.prototype.map.call(new Uint8Array(buffer,data.pos),function(e){return String.fromCharCode(e)}).join("").split(" "),data.pos=0)
var readMeshStr=generateReadMesh(info.elements,info.format.binary,info.format.littleEndian),readMeshFunc=eval("("+readMeshStr+")")
for(var e in info.elements)for(var p in info.elements[e].propertyMap)info.elements[e].propertyMap[p].canonicType=canonicTypes[info.elements[e].propertyMap[p].type]
return callbacks.onBegin.call(handler),callbacks.onHeader.call(handler,info),readMeshFunc(data,info,callbacks,handler),callbacks.onEnd.call(handler),!0}var canonicTypes={"char":"int8",int8:"int8",uchar:"uint8",uint8:"uint8","short":"int16",int16:"int16",ushort:"uint16",uint16:"uint16","int":"int32",int32:"int32",uint:"uint32",uint32:"uint32","float":"float32",float32:"float32","double":"float64",float64:"float64"},tabStr="	"
return mainParsePly}(),importPly=function(){function emptyFunction(){}function propertiesTypes(){for(var e=[],t={},i=null,r=0;r<arguments.length;++r){if(i=arguments[r],!i)return e
t[i.canonicType]=1}for(var n in t)e.push(n)
return e}function PlyHandler(e){this._buffer=e,this._modelDescriptor=null,this._verticesCount=0,this._vertexAttributes=null,this._vertexStride=0,this._vertexBuffer=null,this._handleVertex=emptyFunction,this._facesCount=0,this._indexBuffer=null,this._handleFace=emptyFunction,this._view=null,this._boundingBox={min:[1e6,1e6,1e6],max:[-1e6,-1e6,-1e6]}}function mainImportPly(e,t){var i=new PlyHandler(e,t)
parsePly(e,i)
var r=i.modelDescriptor
return r}return PlyHandler.prototype={get modelDescriptor(){return this._modelDescriptor},onBegin:function(){},onHeader:function(header){var tabStr="	",elem=null,props=null,ptypes=null,verticesCount=0,vertexLines=null,vertexAttributes={},vertexStride=0
if(elem=header.elementMap.vertex,elem&&elem.count>0){if(verticesCount=elem.count,props=elem.propertyMap,vertexLines=[],vertexLines.push("function (header, elementInfo, index, element) {"),vertexLines.push(tabStr+"var littleEndian = SpiderGL.Type.LITTLE_ENDIAN;"),vertexLines.push(tabStr+"var sf32         = SpiderGL.Type.SIZEOF_FLOAT32;"),vertexLines.push(tabStr+"var sui8         = SpiderGL.Type.SIZEOF_UINT8;"),vertexLines.push(tabStr+"var offset       = index * this._vertexStride;"),vertexLines.push(tabStr+"var view         = this._view;"),vertexLines.push(""),ptypes=propertiesTypes(props.x,props.y,props.z),1==ptypes.length)switch(ptypes[0]){case"float32":vertexLines.push(tabStr+"view.setFloat32(offset, element.x, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.y, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.z, littleEndian); offset += sf32;"),vertexLines.push(""),vertexAttributes.position={size:3,type:SpiderGL.Type.FLOAT32,offset:vertexStride},vertexStride+=3*SpiderGL.Type.SIZEOF_FLOAT32}if(ptypes=propertiesTypes(props.nx,props.ny,props.nz),1==ptypes.length)switch(ptypes[0]){case"float32":vertexLines.push(tabStr+"view.setFloat32(offset, element.nx, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.ny, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.nz, littleEndian); offset += sf32;"),vertexLines.push(""),vertexAttributes.normal={size:3,type:SpiderGL.Type.FLOAT32,offset:vertexStride},vertexStride+=3*SpiderGL.Type.SIZEOF_FLOAT32}if(ptypes=propertiesTypes(props.red,props.green,props.blue),1==ptypes.length)switch(ptypes[0]){case"uint8":vertexLines.push(tabStr+"view.setUint8(offset, element.red  ); offset += sui8;"),vertexLines.push(tabStr+"view.setUint8(offset, element.green); offset += sui8;"),vertexLines.push(tabStr+"view.setUint8(offset, element.blue ); offset += sui8;"),vertexLines.push(tabStr+"view.setUint8(offset, 255          ); offset += sui8;"),vertexLines.push(""),vertexAttributes.color={size:4,type:SpiderGL.Type.UINT8,offset:vertexStride,normalized:!0},vertexStride+=4*SpiderGL.Type.SIZEOF_UINT8
break
case"float32":vertexLines.push(tabStr+"view.setFloat32(offset, element.red,   littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.green, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.blue,  littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, 1.0,           littleEndian); offset += sf32;"),vertexLines.push(""),vertexAttributes.color={size:4,type:SpiderGL.Type.FLOAT32,offset:vertexStride},vertexStride+=4*SpiderGL.Type.SIZEOF_FLOAT32}if(ptypes=propertiesTypes(props.texture_u,props.texture_v),1==ptypes.length)switch(ptypes[0]){case"float32":vertexLines.push(tabStr+"view.setFloat32(offset, element.texture_u, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.texture_v, littleEndian); offset += sf32;"),vertexLines.push(""),vertexAttributes.texcoord={size:2,type:SpiderGL.Type.FLOAT32,offset:vertexStride},vertexStride+=2*SpiderGL.Type.SIZEOF_FLOAT32}vertexLines.push("}")}var facesCount=0,faceLines=null
if(elem=header.elementMap.face,elem&&elem.count>0&&(facesCount=elem.count,props=elem.propertyMap,faceLines=[],faceLines.push("function (header, elementInfo, index, element) {"),faceLines.push(tabStr+"var littleEndian = SpiderGL.Type.LITTLE_ENDIAN;"),faceLines.push(tabStr+"var sui32        = SpiderGL.Type.SIZEOF_UINT32;"),faceLines.push(tabStr+"var offset       = index * 3 * sui32;"),faceLines.push(tabStr+"var view         = this._view;"),faceLines.push(""),props.vertex_indices?(faceLines.push(tabStr+"view.setUint32(offset, element.vertex_indices[0], littleEndian); offset += sui32;"),faceLines.push(tabStr+"view.setUint32(offset, element.vertex_indices[1], littleEndian); offset += sui32;"),faceLines.push(tabStr+"view.setUint32(offset, element.vertex_indices[2], littleEndian); offset += sui32;")):facesCount=0,faceLines.push("}")),this._mesh=null,this._verticesCount=verticesCount,this._vertexAttributes=vertexAttributes,this._vertexStride=vertexStride,this._vertexBuffer=null,this._handleVertex=emptyFunction,vertexStride>0){var vertexFuncStr=vertexLines.join("\n")
this._handleVertex=eval("("+vertexFuncStr+")")}if(this._facesCount=facesCount,this._indexBuffer=null,this._handleFace=emptyFunction,facesCount>0){var faceFuncStr=faceLines.join("\n")
this._handleFace=eval("("+faceFuncStr+")")}},onBeginContent:function(e){},onBeginElements:function(e,t){switch(t.name){case"vertex":this._vertexBuffer=new ArrayBuffer(this._verticesCount*this._vertexStride),this._view=new DataView(this._vertexBuffer),this._handleElement=this._handleVertex
break
case"face":this._indexBuffer=new ArrayBuffer(3*this._facesCount*SpiderGL.Type.SIZEOF_UINT32),this._view=new DataView(this._indexBuffer),this._handleElement=this._handleFace
break
default:this._view=null,this._handleElement=emptyFunction}},onElement:function(e,t,i,r){"vertex"==t.name&&(r.x<this._boundingBox.min[0]&&(this._boundingBox.min[0]=r.x),r.y<this._boundingBox.min[1]&&(this._boundingBox.min[1]=r.y),r.z<this._boundingBox.min[2]&&(this._boundingBox.min[2]=r.z),r.x>this._boundingBox.max[0]&&(this._boundingBox.max[0]=r.x),r.y>this._boundingBox.max[1]&&(this._boundingBox.max[1]=r.y),r.z>this._boundingBox.max[2]&&(this._boundingBox.max[2]=r.z)),this._handleElement(e,t,i,r)},onEndElements:function(e,t){this._view=null,this._handleElement=emptyFunction},onEndContent:function(){},onEnd:function(){if(!(this._verticesCount<=0&&this._facesCount<=0)){var e=(this._gl,{version:"0.0.1.0 EXP",meta:{},data:{vertexBuffers:{},indexBuffers:{}},access:{vertexStreams:{},primitiveStreams:{}},semantic:{bindings:{},chunks:{}},logic:{parts:{}},control:{},extra:{}}),t=e.data.vertexBuffers,i=e.data.indexBuffers,r=e.access.vertexStreams,n=e.access.primitiveStreams,a=e.semantic.bindings,s=e.semantic.chunks,o=e.logic.parts
e.extra.boundingBox=this._boundingBox
var u=65535,c="mainVertexBuffer",l="mainIndexBuffer",h="mainBinding",d="mainChunk",p="vertices",f="triangles",_="mainPart"
if(this._facesCount>0){for(var g=(SpiderGL.Type.LITTLE_ENDIAN,SpiderGL.Type.SIZEOF_UINT32,Float64Array.BYTES_PER_ELEMENT,this._vertexStride),m=new Uint8Array(this._vertexBuffer),S=new Uint32Array(this._indexBuffer),L=0,b=[],v=[],x=[],T=[],G=this._facesCount,M=0,y=new Uint32Array(3*this._facesCount);G>0;){for(var E=new Uint32Array(this._verticesCount),A=new Uint32Array(u),P=0,N=0,C=0;u-3>=P&&G>0;){for(var D=0;3>D;++D,++M){var R=S[M],I=E[R]
I||(A[P++]=R,E[R]=P),y[N++]=R}G--,C++}if(!(0>=C)){for(var w=new ArrayBuffer(P*g),O=new Uint8Array(w),F=new Uint16Array(N),j=0;N>j;++j)F[j]=E[y[j]]-1
for(var U=0,j=0,B=0;P>j;++j,B+=g)U=A[j]*g,O.set(m.subarray(U,U+g),B)
b.push(w),v.push(P),x.push(F),T.push(N),L++}}for(var V=new Array(L),j=0;L>j;++j){var k=c+j,W=l+j,X=h+j,H=d+j
t[k]={typedArray:b[j]}
var q={vertexStreams:{},primitiveStreams:{}}
a[X]=q
for(var Y in this._vertexAttributes){var $=this._vertexAttributes[Y],z=Y+j
r[z]={buffer:k,size:$.size,type:$.type,stride:this._vertexStride,offset:$.offset,normalized:!!$.normalized},q.vertexStreams[Y.toUpperCase()]=[z]}i[W]={typedArray:x[j]}
var Z=p+j
n[Z]={mode:SpiderGL.Type.POINTS,count:v[j]},q.primitiveStreams.POINT=[Z]
var K=f+j
n[K]={buffer:W,mode:SpiderGL.Type.TRIANGLES,count:T[j],type:SpiderGL.Type.UINT16,offset:0},q.primitiveStreams.FILL=[K]
var Q={techniques:{common:{binding:X}}}
s[H]=Q,V[j]=H}o[_]={chunks:V}}else{var q={vertexStreams:{},primitiveStreams:{}}
if(a[h]=q,this._verticesCount>0){var k=c
t[k]={typedArray:this._vertexBuffer}
for(var Y in this._vertexAttributes){var $=this._vertexAttributes[Y]
r[Y]={buffer:k,size:$.size,type:$.type,stride:this._vertexStride,offset:$.offset,normalized:!!$.normalized},q.vertexStreams[Y.toUpperCase()]=[Y]}n[p]={mode:SpiderGL.Type.POINTS,count:this._verticesCount},q.primitiveStreams.POINT=[p]}(this._verticesCount>0||this._facesCount>0)&&(s[d]={techniques:{common:{binding:h}}},o[_]={chunks:[d]})}this._modelDescriptor=e}}},mainImportPly}()
SpiderGL.openNamespace()
const SGL_TRACKBALL_NO_ACTION=0,SGL_TRACKBALL_ROTATE=1,SGL_TRACKBALL_PAN=2,SGL_TRACKBALL_DOLLY=3,SGL_TRACKBALL_SCALE=4,HOP_ALL=256
Presenter=function(e){this._isDebugging=!1,this._lightDirection=[0,0,-1],this._supportsWebGL=sglHandleCanvas(e,this)},Presenter.prototype={_parseScene:function(e){e=e||{}
var t={background:this._parseBackground(e.background),meshes:this._parseMeshes(e.meshes),texturedQuads:this._parseTexturedQuads(e.texturedQuads),modelInstances:this._parseModelInstances(e.modelInstances),spots:this._parseSpots(e.spots),trackball:this._parseTrackball(e.trackball),space:this._parseSpace(e.space)}
return t},_parseBackground:function(e){e=e||{}
var t=sglGetDefaultObject({image:null,isEnvironment:!1,color:[0,0,0,0]},e)
return t},_parseMeshes:function(e){var t={}
for(var i in e)t[i]=this._parseMesh(e[i])
return t},_parseMesh:function(e){var t=sglGetDefaultObject({url:null,transform:null},e)
return t.transform=this._parseTransform(t.transform),t},_parseTexturedQuads:function(e){var t={}
for(var i in e)t[i]=this._parseTexturedQuad(e[i])
return t},_parseTexturedQuad:function(e){return e},_parseModelInstances:function(e){var t={}
for(var i in e)t[i]=this._parseModelInstance(e[i])
return t},_parseModelInstance:function(e){var t=sglGetDefaultObject({mesh:null,color:[1,1,1],useSolidColor:!1,alpha:.5,useTransparency:!1,cursor:"default",ID:0,transform:null,visible:!0,tags:[]},e)
return t.transform=this._parseTransform(t.transform),t.ID=this._instancesProgressiveID,t.color[3]&&(t.alpha=t.color[3]),this._instancesProgressiveID+=1,t},_parseSpots:function(e){var t={}
for(var i in e)t[i]=this._parseSpot(e[i])
return t},_parseSpot:function(e){var t=sglGetDefaultObject({mesh:null,color:[0,.25,1],useSolidColor:!0,alpha:.5,useTransparency:!0,cursor:"pointer",ID:0,transform:null,visible:!0,tags:[]},e)
return t.transform=this._parseTransform(t.transform),t.ID=this._spotsProgressiveID,t.color[3]&&(t.alpha=t.color[3]),this._spotsProgressiveID+=1,t},_parseTrackball:function(e){var t=sglGetDefaultObject({type:TurnTableTrackball,trackOptions:{}},e)
return t},_parseSpace:function(e){e=e||{}
var t=sglGetDefaultObject({centerMode:"first",radiusMode:"first",whichInstanceCenter:"",whichInstanceRadius:"",explicitCenter:[0,0,0],explicitRadius:1,transform:null,cameraFOV:60,cameraNearFar:[.1,10]},e)
return t.transform=this._parseTransform(t.transform),t.cameraFOV<2&&(t.cameraFOV=2),t.cameraFOV>88&&(t.cameraFOV=88),t},_parseTransform:function(e){var t=sglGetDefaultObject({matrix:SglMat4.identity()},e)
return t},_createStandardPointNXSProgram:function(){var e=this.ui.gl,t=new SglVertexShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   mat4 uWorldViewProjectionMatrix;                            \n            uniform   mat3 uViewSpaceNormalMatrix;                                \n                                                                                  \n            attribute vec3 aPosition;                                             \n            attribute vec3 aNormal;                                               \n            attribute vec3 aColor;                                                \n            attribute float aPointSize;                                           \n                                                                                  \n            varying   vec3 vNormal;                                               \n            varying   vec3 vColor;                                                \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                vNormal     = uViewSpaceNormalMatrix * aNormal;                   \n                vColor      = aColor;                                             \n                                                                                  \n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n				gl_PointSize = 1.5 * aPointSize;								  \n            }                                                                     \n        ")
this._isDebugging&&console.log("NXS POINT Vertex Shader Log:\n"+t.log)
var i=new SglFragmentShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   vec3 uViewSpaceLightDirection;                              \n            uniform   float uAlpha;                                               \n            uniform   bool uUseSolidColor;                                        \n            uniform   vec3 uSolidColor;                                           \n                                                                                  \n            varying   vec3 vNormal;                                               \n            varying   vec3 vColor;                                                \n			#extension GL_EXT_frag_depth : enable								  \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n        		float a = pow(2.0*(gl_PointCoord.x - 0.5), 2.0);				  \n		        float b = pow(2.0*(gl_PointCoord.y - 0.5), 2.0);				  \n        		float c = 1.0 - (a + b);										  \n        		if(c < 0.0) { discard; }										  \n						                                                          \n				vec3 diffuse;                                                     \n				if(uUseSolidColor)                                                \n                  diffuse = uSolidColor;                                          \n				else                                                              \n                  diffuse = vColor;                                               \n				if(vNormal[0] != 0.0 || vNormal[1] != 0.0 || vNormal[2] != 0.0) { \n  				  vec3  normal  = normalize(vNormal);                             \n                  float nDotL   = dot(normal, -uViewSpaceLightDirection);         \n                  float lambert = max(0.0, nDotL);                                \n                  diffuse = diffuse * lambert;        						      \n                }                                                                 \n                gl_FragColor  = vec4(diffuse, uAlpha);                            \n	       		gl_FragDepthEXT = gl_FragCoord.z + 0.0001*(1.0-pow(c, 2.0));	  \n            }                                                                     \n        ")
this._isDebugging&&console.log("NXS POINT Fragment Shader Log:\n"+i.log)
var r=new SglProgram(e,{shaders:[t,i],attributes:{aPosition:0,aNormal:1,aColor:2,aPointSize:4},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uViewSpaceNormalMatrix:SglMat3.identity(),uViewSpaceLightDirection:this._lightDirection,uAlpha:1,uUseSolidColor:!1,uSolidColor:[1,1,1]}})
return this._isDebugging&&console.log("NXS POINT Program Log:\n"+r.log),r},_createStandardNXSProgram:function(){var e=this.ui.gl,t=new SglVertexShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   mat4 uWorldViewProjectionMatrix;                            \n            uniform   mat3 uViewSpaceNormalMatrix;                                \n                                                                                  \n            attribute vec3 aPosition;                                             \n            attribute vec3 aNormal;                                               \n            attribute vec3 aColor;                                                \n                                                                                  \n            varying   vec3 vNormal;                                               \n            varying   vec3 vColor;                                                \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                vNormal     = uViewSpaceNormalMatrix * aNormal;                   \n                vColor      = aColor;                                             \n                                                                                  \n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n            }                                                                     \n        ")
this._isDebugging&&console.log("NXS Vertex Shader Log:\n"+t.log)
var i=new SglFragmentShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   vec3 uViewSpaceLightDirection;                              \n            uniform   float uAlpha;                                               \n            uniform   bool uUseSolidColor;                                        \n            uniform   vec3 uSolidColor;                                           \n                                                                        		  \n            varying   vec3 vNormal;                                               \n            varying   vec3 vColor;                                                \n			#extension GL_EXT_frag_depth : enable								  \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                vec3  normal  = normalize(vNormal);                               \n                float nDotL   = dot(normal, -uViewSpaceLightDirection);           \n				                                                                  \n				vec3  diffuse;                                                    \n				if(uUseSolidColor)                                                \n                  diffuse = uSolidColor;                                          \n				else                                                              \n                  diffuse = vColor;                                               \n                if(gl_FrontFacing)                                                \n                  diffuse = diffuse * max(0.0, nDotL);                            \n				else                                                              \n                  diffuse = diffuse * vec3(0.4, 0.3, 0.3) * abs(nDotL);           \n				                                                                  \n                gl_FragColor  = vec4(diffuse, uAlpha);                            \n            }                                                                     \n        ")
this._isDebugging&&console.log("NXS Fragment Shader Log:\n"+i.log)
var r=new SglProgram(e,{shaders:[t,i],attributes:{aPosition:0,aNormal:1,aColor:2},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uViewSpaceNormalMatrix:SglMat3.identity(),uViewSpaceLightDirection:this._lightDirection,uAlpha:1,uUseSolidColor:!1,uSolidColor:[1,1,1]}})
return this._isDebugging&&console.log("NXS Program Log:\n"+r.log),r},_createXYZPointNXSProgram:function(){var e=this.ui.gl,t=new SglVertexShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   mat4 uWorldViewProjectionMatrix;                            \n                                                                                  \n            attribute vec3 aPosition;                                             \n            attribute vec3 aNormal;                                               \n            attribute vec3 aColor;                                                \n            attribute float aPointSize;                                           \n                                                                                  \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n				gl_PointSize = 1.5 * aPointSize;								  \n            }                                                                     \n        ")
this._isDebugging&&console.log("Vertex Shader Log:\n"+t.log)
var i=new SglFragmentShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   vec4 uColorID;                                              \n			#extension GL_EXT_frag_depth : enable								  \n                                                                                  \n			vec4 pack_depth(const in float depth)                                         \n			{                                                                             \n				const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);  \n				const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);        \n				vec4 res = fract(depth * bit_shift);                                      \n				res -= res.xxyz * bit_mask;                                               \n				return res;                                                               \n			}                                                                             \n																				  \n            void main(void)                                                       \n            {                                                                     \n        		float a = pow(2.0*(gl_PointCoord.x - 0.5), 2.0);				  \n		        float b = pow(2.0*(gl_PointCoord.y - 0.5), 2.0);				  \n        		float c = 1.0 - (a + b);										  \n        		if(c < 0.0) { discard; }										  \n                vec4 myColor;                                                     \n				myColor = pack_depth(gl_FragCoord.z);                             \n				gl_FragColor  = myColor;                                          \n	       		gl_FragDepthEXT = gl_FragCoord.z + 0.0001*(1.0-pow(c, 2.0));	  \n            }                                                                     \n        ")
this._isDebugging&&console.log("NXS Fragment Shader Log:\n"+i.log)
var r=new SglProgram(e,{shaders:[t,i],attributes:{aPosition:0,aNormal:1,aColor:2,aPointSize:4},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity()}})
return this._isDebugging&&console.log("NXS Program Log:\n"+r.log),r},_createXYZNXSProgram:function(){var e=this.ui.gl,t=new SglVertexShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   mat4 uWorldViewProjectionMatrix;                            \n                                                                                  \n            attribute vec3 aPosition;                                             \n            attribute vec3 aNormal;                                               \n            attribute vec3 aColor;                                                \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n            }                                                                     \n        ")
this._isDebugging&&console.log("Vertex Shader Log:\n"+t.log)
var i=new SglFragmentShader(e,"            precision highp float;                                                \n                                                                                  \n			vec4 pack_depth(const in float depth)                                         \n			{                                                                             \n				const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);  \n				const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);        \n				vec4 res = fract(depth * bit_shift);                                      \n				res -= res.xxyz * bit_mask;                                               \n				return res;                                                               \n			}                                                                             \n																				  \n            void main(void)                                                       \n            {                                                                     \n                vec4 myColor;                                                     \n				myColor = pack_depth(gl_FragCoord.z);                             \n				gl_FragColor  = myColor;                                          \n            }                                                                     \n        ")
this._isDebugging&&console.log("NXS Fragment Shader Log:\n"+i.log)
var r=new SglProgram(e,{shaders:[t,i],attributes:{aPosition:0,aNormal:1,aColor:2},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity()}})
return this._isDebugging&&console.log("NXS Program Log:\n"+r.log),r},_createColorCodedIDPointNXSProgram:function(){var e=this.ui.gl,t=new SglVertexShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   mat4 uWorldViewProjectionMatrix;                            \n                                                                                  \n            attribute vec3 aPosition;                                             \n            attribute vec3 aNormal;                                               \n            attribute vec3 aColor;                                                \n            attribute float aPointSize;                                           \n                                                                                  \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n				gl_PointSize = 1.5 * aPointSize;								  \n            }                                                                     \n        ")
this._isDebugging&&console.log("Vertex Shader Log:\n"+t.log)
var i=new SglFragmentShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   vec3 uViewSpaceLightDirection;                              \n                                                                                  \n            uniform   vec4 uColorID;                                              \n			#extension GL_EXT_frag_depth : enable								  \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n        		float a = pow(2.0*(gl_PointCoord.x - 0.5), 2.0);				  \n		        float b = pow(2.0*(gl_PointCoord.y - 0.5), 2.0);				  \n        		float c = 1.0 - (a + b);										  \n        		if(c < 0.0) { discard; }										  \n																				  \n                gl_FragColor  = uColorID;                                         \n	       		gl_FragDepthEXT = gl_FragCoord.z + 0.0001*(1.0-pow(c, 2.0));	  \n            }                                                                     \n        ")
this._isDebugging&&console.log("Fragment Shader Log:\n"+i.log)
var r=new SglProgram(e,{shaders:[t,i],attributes:{aPosition:0,aNormal:1,aColor:2,aPointSize:4},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uColorID:[1,.5,0,1]}})
return this._isDebugging&&console.log("Program Log:\n"+r.log),r},_createColorCodedIDNXSProgram:function(){var e=this.ui.gl,t=new SglVertexShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   mat4 uWorldViewProjectionMatrix;                            \n                                                                                  \n            attribute vec3 aPosition;                                             \n            attribute vec3 aNormal;                                               \n            attribute vec3 aColor;                                                \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n            }                                                                     \n        ")
this._isDebugging&&console.log("Vertex Shader Log:\n"+t.log)
var i=new SglFragmentShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   vec4 uColorID;                                              \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                gl_FragColor  = uColorID;                                         \n            }                                                                     \n        ")
this._isDebugging&&console.log("Fragment Shader Log:\n"+i.log)
var r=new SglProgram(e,{shaders:[t,i],attributes:{aPosition:0,aNormal:1,aColor:2},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uColorID:[1,.5,0,1]}})
return this._isDebugging&&console.log("Program Log:\n"+r.log),r},_createColorShadedPointNXSProgram:function(){var e=this.ui.gl,t=new SglVertexShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   mat4 uWorldViewProjectionMatrix;                            \n            uniform   mat3 uViewSpaceNormalMatrix;                                \n                                                                                  \n            attribute vec3 aPosition;                                             \n            attribute vec3 aNormal;                                               \n            attribute vec3 aColor;                                                \n            attribute float aPointSize;                                           \n                                                                                  \n            varying   vec3 vNormal;                                               \n            varying   vec3 vColor;                                                \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                vNormal     = uViewSpaceNormalMatrix * aNormal;                   \n                vColor      = aColor;                                             \n                                                                                  \n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n				gl_PointSize = 1.5 * aPointSize;								  \n            }                                                                     \n        ")
this._isDebugging&&console.log("Vertex Shader Log:\n"+t.log)
var i=new SglFragmentShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   vec3 uViewSpaceLightDirection;                              \n            uniform   vec4 uColorID;                                              \n                                                                                  \n            varying   vec3 vNormal;                                               \n            varying   vec3 vColor;                                                \n			#extension GL_EXT_frag_depth : enable								  \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n        		float a = pow(2.0*(gl_PointCoord.x - 0.5), 2.0);				  \n		        float b = pow(2.0*(gl_PointCoord.y - 0.5), 2.0);				  \n        		float c = 1.0 - (a + b);										  \n        		if(c < 0.0) { discard; }										  \n						                                                          \n				vec3 diffuse = vec3(uColorID[0], uColorID[1], uColorID[2]);       \n				if(vNormal[0] != 0.0 || vNormal[1] != 0.0 || vNormal[2] != 0.0) { \n  				  vec3  normal  = normalize(vNormal);                             \n                  float nDotL   = dot(normal, -uViewSpaceLightDirection);         \n                  float lambert = max(-nDotL, nDotL);                             \n                  diffuse = (diffuse*0.5) + (diffuse * lambert * 0.5);            \n                }                                                                 \n                gl_FragColor  = vec4(diffuse, uColorID[3]);                       \n	       		gl_FragDepthEXT = gl_FragCoord.z + 0.0001*(1.0-pow(c, 2.0));	  \n            }                                                                     \n        ")
this._isDebugging&&console.log("Fragment Shader Log:\n"+i.log)
var r=new SglProgram(e,{shaders:[t,i],attributes:{aPosition:0,aNormal:1,aColor:2,aPointSize:4},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uViewSpaceNormalMatrix:SglMat3.identity(),uViewSpaceLightDirection:this._lightDirection,uColorID:[1,.5,0,1]}})
return this._isDebugging&&console.log("Program Log:\n"+r.log),r},_createColorShadedNXSProgram:function(){var e=this.ui.gl,t=new SglVertexShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   mat4 uWorldViewProjectionMatrix;                            \n            uniform   mat3 uViewSpaceNormalMatrix;                                \n                                                                                  \n            attribute vec3 aPosition;                                             \n            attribute vec3 aNormal;                                               \n            attribute vec3 aColor;                                                \n                                                                                  \n            varying   vec3 vNormal;                                               \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                vNormal     = uViewSpaceNormalMatrix * aNormal;                   \n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n            }                                                                     \n        ")
this._isDebugging&&console.log("Vertex Shader Log:\n"+t.log)
var i=new SglFragmentShader(e,"            precision highp float;                                                \n                                                                                  \n            uniform   vec3 uViewSpaceLightDirection;                              \n            uniform   vec4 uColorID;                                              \n                                                                                  \n            varying   vec3 vNormal;                                               \n                                                                                  \n            void main(void)                                                       \n            {                                                                     \n                vec3  normal  = normalize(vNormal);                               \n                float nDotL   = dot(normal, -uViewSpaceLightDirection);           \n				float lambert   = max(-nDotL, nDotL);                             \n																				  \n				vec3  baseColor = vec3(uColorID[0], uColorID[1], uColorID[2]);    \n				vec3  diffuse   = (baseColor*0.5) + (baseColor * lambert * 0.5);  \n                                                                                  \n                gl_FragColor  = vec4(diffuse, uColorID[3]);                       \n            }                                                                     \n        ")
this._isDebugging&&console.log("Fragment Shader Log:\n"+i.log)
var r=new SglProgram(e,{shaders:[t,i],attributes:{aPosition:0,aNormal:1,aColor:2},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uViewSpaceNormalMatrix:SglMat3.identity(),uViewSpaceLightDirection:this._lightDirection,uColorID:[1,.5,0,1]}})
return this._isDebugging&&console.log("Program Log:\n"+r.log),r},_createStandardPLYtechnique:function(){var e=this.ui.gl,t=new SglTechnique(e,{vertexShader:"				precision highp float;                                                \n																					  \n				uniform   mat4 uWorldViewProjectionMatrix;                            \n				uniform   mat3 uViewSpaceNormalMatrix;                                \n																					  \n				attribute vec3 aPosition;                                             \n				attribute vec3 aNormal;                                               \n				attribute vec3 aColor;                                                \n																					  \n				varying   vec3 vNormal;                                               \n				varying   vec3 vColor;                                                \n																					  \n				void main(void)                                                       \n				{                                                                     \n					vNormal     = uViewSpaceNormalMatrix * aNormal;                   \n					vColor      = aColor;                                             \n																					  \n					gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n				}                                                                     \n			",fragmentShader:"				precision highp float;                                                \n																					  \n				uniform   vec3      uViewSpaceLightDirection;                         \n				uniform   float     uAlpha;                                           \n                uniform   bool uUseSolidColor;                                        \n                uniform   vec3 uSolidColor;                                           \n																					  \n				varying   vec3 vNormal;                                               \n				varying   vec3 vColor;                                                \n																					  \n				void main(void)                                                       \n				{                                                                     \n					vec3  normal    = normalize(vNormal);                             \n					float nDotL     = dot(normal, -uViewSpaceLightDirection);         \n																					  \n					vec3 diffuse;                                                     \n				    if(uUseSolidColor)                                                \n                      diffuse = uSolidColor;                                          \n				    else                                                              \n                      diffuse = vColor;                                               \n                    if(gl_FrontFacing)                                                \n                      diffuse = diffuse * max(0.0, nDotL);                            \n				    else                                                              \n                      diffuse = diffuse * vec3(0.4, 0.3, 0.3) * abs(nDotL);           \n																					  \n					gl_FragColor    = vec4(diffuse, uAlpha);                          \n				}                                                                     \n			",vertexStreams:{aNormal:[0,0,1,0],aColor:[.4,.4,.8,1]},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uViewSpaceNormalMatrix:{semantic:"uViewSpaceNormalMatrix",value:SglMat3.identity()},uViewSpaceLightDirection:{semantic:"uViewSpaceLightDirection",value:[0,0,-1]},uAlpha:{semantic:"uAlpha",value:1},uUseSolidColor:{semantic:"uUseSolidColor",value:!0},uSolidColor:{semantic:"uSolidColor",value:[1,1,1]}}})
return t},_createXYZPLYtechnique:function(){var e=this.ui.gl,t=new SglTechnique(e,{vertexShader:"				precision highp float;                                                \n																					  \n				uniform   mat4 uWorldViewProjectionMatrix;                            \n																					  \n				attribute vec3 aPosition;                                             \n				attribute vec3 aNormal;                                               \n				attribute vec3 aColor;                                                \n																					  \n				void main(void)                                                       \n				{                                                                     \n					gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n				}                                                                     \n			",fragmentShader:"				precision highp float;                                                \n																					  \n				vec4 pack_depth(const in float depth)                                         \n				{                                                                             \n					const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);  \n					const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);        \n					vec4 res = fract(depth * bit_shift);                                      \n					res -= res.xxyz * bit_mask;                                               \n					return res;                                                               \n				}                                                                             \n																					  \n				void main(void)                                                       \n				{                                                                     \n					vec4 myColor;                                                     \n					myColor = pack_depth(gl_FragCoord.z);                             \n					gl_FragColor  = myColor;                                          \n				}                                                                     \n			",vertexStreams:{aNormal:[0,0,1,0],aColor:[.4,.4,.8,1]},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()}}})
return t},_createColorCodedIDPLYtechnique:function(){var e=this.ui.gl,t=new SglTechnique(e,{vertexShader:"				precision highp float;                                                \n																					  \n				uniform   mat4 uWorldViewProjectionMatrix;                            \n																					  \n				attribute vec3 aPosition;                                             \n				attribute vec3 aNormal;                                               \n				attribute vec3 aColor;                                                \n																					  \n				void main(void)                                                       \n				{                                                                     \n					gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n				}                                                                     \n			",fragmentShader:"				precision highp float;                                                \n																					  \n                uniform   vec4 uColorID;                                              \n																					  \n				void main(void)                                                       \n				{                                                                     \n					gl_FragColor    = uColorID;                                       \n				}                                                                     \n			",vertexStreams:{aNormal:[0,0,1,0],aColor:[.4,.4,.8,1]},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uColorID:{semantic:"uColorID",value:[1,.5,.25,1]}}})
return t},_createColorShadedPLYtechnique:function(){var e=this.ui.gl,t=new SglTechnique(e,{vertexShader:"				precision highp float;                                                \n																					  \n				uniform   mat4 uWorldViewProjectionMatrix;                            \n				uniform   mat3 uViewSpaceNormalMatrix;                                \n																					  \n				attribute vec3 aPosition;                                             \n				attribute vec3 aNormal;                                               \n				attribute vec3 aColor;                                                \n																					  \n				varying   vec3 vNormal;                                               \n																					  \n				void main(void)                                                       \n				{                                                                     \n					vNormal     = uViewSpaceNormalMatrix * aNormal;                   \n					gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n				}                                                                     \n			",fragmentShader:"				precision highp float;                                                \n																					  \n                uniform   vec4 uColorID;                                              \n				uniform   vec3 uViewSpaceLightDirection;                              \n																					  \n				varying   vec3 vNormal;                                               \n				varying   vec3 vColor;                                                \n																					  \n				void main(void)                                                       \n				{                                                                     \n					vec3  normal    = normalize(vNormal);                             \n					float nDotL     = dot(normal, -uViewSpaceLightDirection);         \n					float lambert   = max(-nDotL, nDotL);                             \n																					  \n					vec3  baseColor = vec3(uColorID[0], uColorID[1], uColorID[2]);    \n					vec3  diffuse   = (baseColor*0.5) + (baseColor * lambert * 0.5);  \n																					  \n					gl_FragColor    = vec4(diffuse, uColorID[3]);                     \n				}                                                                     \n			",vertexStreams:{aNormal:[0,0,1,0],aColor:[.4,.4,.8,1]},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uViewSpaceNormalMatrix:{semantic:"uViewSpaceNormalMatrix",value:SglMat3.identity()},uViewSpaceLightDirection:{semantic:"uViewSpaceLightDirection",value:[0,0,-1]},uColorID:{semantic:"uColorID",value:[1,.5,.25,1]}}})
return t},_createSimpleLinetechnique:function(){var e=this.ui.gl,t=new SglTechnique(e,{vertexShader:"				precision highp float;                                                \n																					  \n				uniform   mat4 uWorldViewProjectionMatrix;                            \n				uniform vec3 uPointA;                                                 \n				uniform vec3 uPointB;                                                 \n																					  \n				attribute vec3 aPosition;                                             \n				attribute vec3 aNormal;                                               \n				attribute vec3 aColor;                                                \n																					  \n				void main(void)                                                       \n				{                                                                     \n					vec3 newPos;                                                      \n					if(aPosition[0]==0.0)                                             \n						newPos = uPointA;                                             \n					else                                                              \n						newPos = uPointB;                                             \n					gl_Position = uWorldViewProjectionMatrix * vec4(newPos, 1.0);     \n					gl_PointSize = 8.0;	                 							  \n				}                                                                     \n			",fragmentShader:"				precision highp float;                                                \n																					  \n                uniform   vec4 uLineColor;                                            \n																					  \n				void main(void)                                                       \n				{                                                                     \n					gl_FragColor    = uLineColor;                                     \n				}                                                                     \n			",vertexStreams:{aNormal:[0,0,1,0],aColor:[1,0,0,1]},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uLineColor:{semantic:"uLineColor",value:[0,1,.5,1]},uPointA:{semantic:"uPointA",value:[0,0,0]},uPointB:{semantic:"uPointB",value:[1,1,1]}}})
return t},_isSceneReady:function(){var e=this._scene&&this._sceneParsed&&0==this._objectsToLoad
return e},_testReady:function(){0==this._objectsToLoad&&(this._onLoadedEvent&&"null"!=this._onLoadedEvent&&this._onLoadedEvent(),this.trackball.track(SglMat4.identity(),0,0,0),this.ui.postDrawEvent())},_objectLoaded:function(){this._objectsToLoad--,this._testReady()},_onMeshReady:function(){this._objectLoaded()},_onTextureReady:function(){this._objectLoaded()},_onBackgroundReady:function(){this._objectLoaded()},_pickingRefresh:function(e,t){this._pickpoint[0]=e,this._pickpoint[1]=t
var i,r,n
if((this._onEndMeasurement||this._onPickedSpot||this._onEnterSpot||this._onLeaveSpot)&&(i=this._drawScenePickingSpots(),r=this._Color2ID(i),this._lastSpotID!=r)){var a=this._scene.spots
if(0!=r){for(var s in a)if(a[s].ID==r){this._pickedSpot=s,this._onHover&&(a[this._lastPickedSpot]&&(a[this._lastPickedSpot].alpha-=.2),a[this._pickedSpot].alpha+=.2,n=a[s].cursor,this._isMeasuring||(this._lastCursor=document.getElementById(this.ui.canvas.id).style.cursor,document.getElementById(this.ui.canvas.id).style.cursor=n),this.ui.postDrawEvent(),this._onLeaveSpot&&null!=this._lastPickedSpot&&this._onLeaveSpot(this._lastPickedSpot),this._onEnterSpot&&null!=this._pickedSpot&&this._onEnterSpot(this._pickedSpot)),this._lastPickedSpot=s
break}this._lastSpotID=r}else this._pickedSpot=null,this._onHover&&(a[this._lastPickedSpot]&&(a[this._lastPickedSpot].alpha-=.2),this._isMeasuring||(document.getElementById(this.ui.canvas.id).style.cursor="default"),this.ui.postDrawEvent(),this._onLeaveSpot&&null!=this._lastPickedSpot&&this._onLeaveSpot(this._lastPickedSpot),this._lastPickedSpot=null),this._lastSpotID=r}if(this._onEndMeasurement||this._onPickedInstance||this._onEnterInstance||this._onLeaveInstance){if(i=this._drawScenePickingInstances(),r=this._Color2ID(i),this._lastInstanceID==r&&!(this._onPickedSpot||this._onEnterSpot||this._onLeaveSpot))return
if(0!=r){var o=this._scene.modelInstances
for(var u in o)if(o[u].ID==r){this._pickedInstance=u,this._onHover&&(n=o[u].cursor,this._isMeasuring||(this._lastCursor=n,null==this._pickedSpot&&(document.getElementById(this.ui.canvas.id).style.cursor=n)),this._onLeaveInstance&&null!=this._lastPickedInstance&&this._onLeaveInstance(this._lastPickedInstance),this._onEnterInstance&&null!=this._pickedInstance&&this._onEnterInstance(this._pickedInstance)),this._lastPickedInstance=u
break}}else this._pickedInstance=null,this._onHover&&(this._lastCursor="default",this._isMeasuring||null!=this._pickedSpot||(document.getElementById(this.ui.canvas.id).style.cursor="default"),this._onLeaveInstance&&null!=this._lastPickedInstance&&this._onLeaveInstance(this._lastPickedInstance)),this._lastPickedInstance=null
this._lastInstanceID=r}},_measureRefresh:function(e,t,i,r){if(r.target.id==this.ui.gl.canvas.id&&this._isMeasuring){this._pickpoint[0]=t,this._pickpoint[1]=i
var n=this._drawScenePickingXYZ()
null!=n&&2!=this._measurementStage?(this._pointA=n,this._measurementStage=2,this.ui.postDrawEvent()):null!=n&&2==this._measurementStage&&(this._pointB=n,this.measurement=SglVec3.length(SglVec3.sub(this._pointA,this._pointB)),this._measurementStage=3,this.ui.postDrawEvent(),this._onEndMeasurement&&this._onEndMeasurement(this.measurement))}},_startMeasurement:function(){this._isMeasuring||(this._isMeasuring=!0,this._measurementStage=1,this._pointA=[0,0,0],this._pointB=[0,0,0],this.measurement=0,this.ui.postDrawEvent())},_stopMeasurement:function(){this._isMeasuring=!1,this._measurementStage=0,this._pointA=[0,0,0],this._pointB=[0,0,0],this.measurement=0,this.ui.postDrawEvent()},_setSceneCenterRadius:function(){var e=this._scene.meshes,t=this._scene.modelInstances
if(this.sceneCenter=[0,0,0],this.sceneRadiusInv=1,"explicit"==this._scene.space.centerMode)this.sceneCenter=this._scene.space.explicitCenter
else if("specific"==this._scene.space.centerMode&&""!=this._scene.space.whichInstanceCenter){var i=e[t[this._scene.space.whichInstanceCenter].mesh]
if(i&&i.renderable){var r=SglVec3.to4(i.renderable.datasetCenter,1)
r=SglMat4.mul4(i.transform.matrix,r),r=SglMat4.mul4(t[this._scene.space.whichInstanceCenter].transform.matrix,r),r=SglVec4.to3(r),this.sceneCenter=r}}else if("scene"==this._scene.space.centerMode){var n=SglVec3.maxNumber(),a=SglVec3.minNumber(),s=[0,0,0],o=[0,0,0]
for(var u in t){var i=e[t[u].mesh]
if(i&&i.renderable){var r=SglVec3.to4(i.renderable.datasetCenter,1)
r=SglMat4.mul4(i.transform.matrix,r),r=SglMat4.mul4(t[u].transform.matrix,r),r=SglVec4.to3(r)
var c=i.renderable.datasetRadius,l=SglVec3.one()
l=SglMat3.mul3(SglMat4.to33(i.transform.matrix),l),l=SglMat3.mul3(SglMat4.to33(t[u].transform.matrix),l)
var h=SglVec3.length(l)/SglVec3.length([1,1,1])
c*=h,s[0]=r[0]-c,s[1]=r[1]-c,s[2]=r[2]-c,o[0]=r[0]+c,o[1]=r[1]+c,o[2]=r[2]+c,s[0]<n[0]&&(n[0]=s[0]),s[1]<n[1]&&(n[1]=s[1]),s[2]<n[2]&&(n[2]=s[2]),o[0]>a[0]&&(a[0]=o[0]),o[1]>a[1]&&(a[1]=o[1]),o[2]>a[2]&&(a[2]=o[2])}}this.sceneCenter=[(a[0]+n[0])/2,(a[1]+n[1])/2,(a[2]+n[2])/2]}else for(var u in t){var i=e[t[u].mesh]
if(i&&i.renderable){var r=SglVec3.to4(i.renderable.datasetCenter,1)
r=SglMat4.mul4(i.transform.matrix,r),r=SglMat4.mul4(t[u].transform.matrix,r),r=SglVec4.to3(r),this.sceneCenter=r
break}}if("explicit"==this._scene.space.radiusMode)this.sceneRadiusInv=1/this._scene.space.explicitRadius
else if("specific"==this._scene.space.radiusMode&&""!=this._scene.space.whichInstanceRadius){var i=e[t[this._scene.space.whichInstanceRadius].mesh]
if(i&&i.renderable){var c=i.renderable.datasetRadius,l=SglVec3.one()
l=SglMat3.mul3(SglMat4.to33(i.transform.matrix),l),l=SglMat3.mul3(SglMat4.to33(t[this._scene.space.whichInstanceRadius].transform.matrix),l)
var h=SglVec3.length(l)/SglVec3.length([1,1,1])
this.sceneRadiusInv=1/(c*h)}}else if("scene"==this._scene.space.radiusMode){var n=SglVec3.maxNumber(),a=SglVec3.minNumber(),s=[0,0,0],o=[0,0,0]
for(var u in t){var i=e[t[u].mesh]
if(i&&i.renderable){var r=SglVec3.to4(i.renderable.datasetCenter,1)
r=SglMat4.mul4(i.transform.matrix,r),r=SglMat4.mul4(t[u].transform.matrix,r),r=SglVec4.to3(r)
var c=i.renderable.datasetRadius,l=SglVec3.one()
l=SglMat3.mul3(SglMat4.to33(i.transform.matrix),l),l=SglMat3.mul3(SglMat4.to33(t[u].transform.matrix),l)
var h=SglVec3.length(l)/SglVec3.length([1,1,1])
c*=h,s[0]=r[0]-c,s[1]=r[1]-c,s[2]=r[2]-c,o[0]=r[0]+c,o[1]=r[1]+c,o[2]=r[2]+c,s[0]<n[0]&&(n[0]=s[0]),s[1]<n[1]&&(n[1]=s[1]),s[2]<n[2]&&(n[2]=s[2]),o[0]>a[0]&&(a[0]=o[0]),o[1]>a[1]&&(a[1]=o[1]),o[2]>a[2]&&(a[2]=o[2])}}var d=[(a[0]+n[0])/2,(a[1]+n[1])/2,(a[2]+n[2])/2]
this.sceneRadiusInv=1/SglVec3.length(SglVec3.sub(a,d))}else for(var u in t){var i=e[t[u].mesh]
if(i&&i.renderable){var c=i.renderable.datasetRadius,l=SglVec3.one()
l=SglMat3.mul3(SglMat4.to33(i.transform.matrix),l),l=SglMat3.mul3(SglMat4.to33(t[u].transform.matrix),l)
var h=SglVec3.length(l)/SglVec3.length([1,1,1])
this.sceneRadiusInv=1/(c*h)
break}}},_destroyPickFramebuffer:function(){this.pickFramebuffer&&(this.pickFramebuffer.destroy(),this.pickFramebuffer=null),this.pickColorTexture&&(this.pickColorTexture.destroy(),this.pickColorTexture=null),this.pickDepthRenderbuffer&&(this.pickDepthRenderbuffer.destroy(),this.pickDepthRenderbuffer=null)},_createPickFramebuffer:function(e,t){if(!this.pickFramebuffer||this.pickFramebuffer.width!=e||this.pickFramebuffer.height!=t){this._destroyPickFramebuffer()
var i=this.ui.gl
this.pickColorTexture=new SglTexture2D(i,{internalFormat:i.RGBA,width:e,height:t}),this.pickDepthRenderbuffer=new SglRenderbuffer(i,{internalFormat:i.DEPTH_COMPONENT16,width:e,height:t}),this.pickFramebuffer=new SglFramebuffer(i,{color:this.pickColorTexture,depth:this.pickDepthRenderbuffer,autoViewport:!0})}},_setupDraw:function(){var e=this.ui.gl,t=this.ui.width,i=this.ui.height,r=this.xform,n=this._scene.space
e.viewport(0,0,t,i)
var a=n.cameraFOV,s=n.cameraNearFar[0],o=n.cameraNearFar[1]
r.projection.loadIdentity(),r.projection.perspective(sglDegToRad(a),t/i,s,o),r.view.loadIdentity(),r.view.lookAt([0,0,0],[0,0,-1],[0,1,0]),this.viewMatrix=r.viewMatrix,r.model.loadIdentity(),r.model.multiply(this.trackball.matrix),this._setSceneCenterRadius(),r.model.scale([this.sceneRadiusInv,this.sceneRadiusInv,this.sceneRadiusInv]),r.model.translate(SglVec3.neg(this.sceneCenter))},_ID2Color:function(e){var t=0|e,i=t%5,r=(t-i)/5%5,n=((t-i)/5-r)/5%5,a=[.2*i,.2*r,.2*n,1]
return a},_Color2ID:function(e){var t=(e[0]+2)/255/.2|0,i=(e[1]+2)/255/.2*5|0,r=(e[2]+2)/255/.2*25|0,n=t+i+r|0
return n},_onPlyLoaded:function(e,t,i){var r=e.buffer,n=importPly(r)
t.renderable=new SglModel(i,n),t.renderable.boundingBox=n.extra.boundingBox
var a=t.renderable
a.datasetCenter=[0,0,0],a.datasetRadius=1,a.datasetCenter[0]=(a.boundingBox.max[0]+a.boundingBox.min[0])/2,a.datasetCenter[1]=(a.boundingBox.max[1]+a.boundingBox.min[1])/2,a.datasetCenter[2]=(a.boundingBox.max[2]+a.boundingBox.min[2])/2,a.datasetRadius=Math.sqrt(Math.pow(a.boundingBox.max[0]-a.boundingBox.min[0],2)+Math.pow(a.boundingBox.max[1]-a.boundingBox.min[1],2)+Math.pow(a.boundingBox.max[2]-a.boundingBox.min[2],2))/2,this._onMeshReady()},_drawScene:function(){var e=this.ui.gl,t=this.ui.width,i=this.ui.height,r=this.xform,n=this.renderer,a=this.basicNXSProgram,s=this.pointNXSProgram,o=this.basicPLYTechnique,u=this.colorShadedNXSProgram,c=this.colorShadedPointNXSProgram,l=this.colorShadedPLYtechnique,h=this.simpleLinetechnique,d=this._scene.meshes,p=this._scene.modelInstances,f=this._scene.spots,_=this._scene.space,g=this._scene.background.color
this._setupDraw(),e.clearColor(g[0],g[1],g[2],g[3]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)
for(var m in p){var S=p[m],L=d[S.mesh]
if(L){var b=L.renderable
if(b&&S.visible&&!S.useTransparency){e.enable(e.DEPTH_TEST),r.model.push(),r.model.multiply(_.transform.matrix),r.model.multiply(S.transform.matrix),r.model.multiply(L.transform.matrix)
var v={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix,uViewSpaceNormalMatrix:r.viewSpaceNormalMatrix,uViewSpaceLightDirection:this._lightDirection,uAlpha:1,uUseSolidColor:S.useSolidColor,uSolidColor:[S.color[0],S.color[1],S.color[2]]}
if(L.isNexus){if(!b.isReady)continue
var x=b
if(x.modelMatrix=r.modelMatrix,x.viewMatrix=r.viewMatrix,x.projectionMatrix=r.projectionMatrix,x.viewport=[0,0,t,i],x._targetFps&&this.ui.framesPerSecond){var T=x._drawBudget*this.ui.framesPerSecond/x._targetFps
T>x._minDrawBudget&&(T<x._drawBudget||x._drawSize>x._drawBudget)&&(x._drawBudget=.9*x._drawBudget+.1*T)}var G
G=x._header.signature.face.hasIndex?a:s,G.bind(),G.setUniforms(v),x.begin(),x.render(),x.end(),G.unbind()}else n.begin(),n.setTechnique(o),n.setDefaultGlobals(),n.setPrimitiveMode("FILL"),n.setGlobals(v),n.setModel(b),n.renderModel(),n.end()
e.disable(e.DEPTH_TEST),r.model.pop()}}}for(var m in p){var S=p[m],L=d[S.mesh]
if(L){var b=L.renderable
if(b&&S.visible&&S.useTransparency){e.enable(e.DEPTH_TEST),e.depthMask(!1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),r.model.push(),r.model.multiply(_.transform.matrix),r.model.multiply(S.transform.matrix),r.model.multiply(L.transform.matrix)
var v={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix,uViewSpaceNormalMatrix:r.viewSpaceNormalMatrix,uViewSpaceLightDirection:this._lightDirection,uAlpha:S.alpha,uUseSolidColor:S.useSolidColor,uSolidColor:[S.color[0],S.color[1],S.color[2]]}
if(L.isNexus){if(!b.isReady)continue
var x=b
if(x.modelMatrix=r.modelMatrix,x.viewMatrix=r.viewMatrix,x.projectionMatrix=r.projectionMatrix,x.viewport=[0,0,t,i],x._targetFps&&this.ui.framesPerSecond){var T=x._drawBudget*this.ui.framesPerSecond/x._targetFps
T>x._minDrawBudget&&(T<x._drawBudget||x._drawSize>x._drawBudget)&&(x._drawBudget=.9*x._drawBudget+.1*T)}var G
G=x._header.signature.face.hasIndex?a:s,G.bind(),G.setUniforms(v),x.begin(),x.render(),x.end(),G.unbind()}else n.begin(),n.setTechnique(o),n.setDefaultGlobals(),n.setPrimitiveMode("FILL"),n.setGlobals(v),n.setModel(b),n.renderModel(),n.end()
e.disable(e.BLEND),e.depthMask(!0),e.disable(e.DEPTH_TEST),r.model.pop()}}}if(this._measurementStage>=2){e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),r.model.push()
var M={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix,uLineColor:[.5,1,.5,1],uPointA:this._pointA,uPointB:2==this._measurementStage?this._pointA:this._pointB}
n.begin(),n.setTechnique(h),n.setDefaultGlobals(),n.setGlobals(M),n.setPrimitiveMode("LINE"),n.setModel(this.simpleLineModel),n.renderModel(),n.setPrimitiveMode("POINT"),n.setModel(this.simpleLineModel),n.renderModel(),n.end(),M={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix,uLineColor:[.2,.4,.2,.5],uPointA:this._pointA,uPointB:2==this._measurementStage?this._pointA:this._pointB},e.depthFunc(e.GREATER),e.depthMask(!1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),n.begin(),n.setTechnique(h),n.setDefaultGlobals(),n.setGlobals(M),n.setPrimitiveMode("LINE"),n.setModel(this.simpleLineModel),n.renderModel(),n.setPrimitiveMode("POINT"),n.setModel(this.simpleLineModel),n.renderModel(),n.end(),e.disable(e.BLEND),e.depthMask(!0),e.depthFunc(e.LESS),e.disable(e.DEPTH_TEST),r.model.pop()}for(var y in f){var E=f[y],L=d[E.mesh]
if(L){var b=L.renderable
if(b&&E.visible){e.enable(e.DEPTH_TEST),e.depthMask(!1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),r.model.push(),r.model.multiply(_.transform.matrix),r.model.multiply(E.transform.matrix),r.model.multiply(L.transform.matrix)
var v={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix,uViewSpaceNormalMatrix:r.viewSpaceNormalMatrix,uViewSpaceLightDirection:this._lightDirection,uColorID:[E.color[0],E.color[1],E.color[2],E.alpha]}
if(L.isNexus){if(!b.isReady)continue
var x=b
x.modelMatrix=r.modelMatrix,x.viewMatrix=r.viewMatrix,x.projectionMatrix=r.projectionMatrix,x.viewport=[0,0,t,i]
var G
G=x._header.signature.face.hasIndex?u:c,G.bind(),G.setUniforms(v),x.begin(),x.render(),x.end(),G.unbind()}else n.begin(),n.setTechnique(l),n.setDefaultGlobals(),n.setPrimitiveMode("FILL"),n.setGlobals(v),n.setModel(b),n.renderModel(),n.end()
e.disable(e.BLEND),e.depthMask(!0),e.disable(e.DEPTH_TEST),r.model.pop()}}}},_drawScenePickingXYZ:function(){var e=this.ui.gl,t=this.ui.width,i=this.ui.height,r=this.xform,n=this.renderer,a=this.colorCodedXYZNXSProgram,s=this.colorCodedXYZPointNXSProgram,o=this.colorCodedXYZPLYtechnique,u=this._scene.meshes,c=this._scene.modelInstances,l=this._scene.space,h=new Uint8Array(4)
this._createPickFramebuffer(t,i),this._setupDraw(),this.pickFramebuffer.bind(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this.pickFramebuffer.unbind()
for(var d in c){var p=c[d],f=u[p.mesh]
if(f){var _=f.renderable
if(_&&p.visible){e.enable(e.DEPTH_TEST),r.model.push(),r.model.multiply(l.transform.matrix),r.model.multiply(p.transform.matrix),r.model.multiply(f.transform.matrix)
var g={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix}
if(f.isNexus){if(!_.isReady)continue
var m=_
m.modelMatrix=r.modelMatrix,m.viewMatrix=r.viewMatrix,m.projectionMatrix=r.projectionMatrix,m.viewport=[0,0,t,i],this.pickFramebuffer.bind()
var S
S=m._header.signature.face.hasIndex?a:s,S.bind(),S.setUniforms(g),m.begin(),m.render(),m.end(),S.unbind(),this.pickFramebuffer.unbind()}else n.begin(),n.setFramebuffer(this.pickFramebuffer),n.setTechnique(o),n.setDefaultGlobals(),n.setPrimitiveMode("FILL"),n.setGlobals(g),n.setModel(_),n.renderModel(),n.end()
e.disable(e.DEPTH_TEST),r.model.pop()}}}this.pickFramebuffer.readPixels(h,{x:this._pickpoint[0],y:this._pickpoint[1],width:1,height:1,format:e.RGBA,type:e.UNSIGNED_BYTE})
var L,b=h[0]/255,v=h[1]/255,x=h[2]/255,T=h[3]/255,G=T+x/256+v/65536+b/16777216
return 0==b&&0==v&&0==x?null:(L=r.unproject([this._pickpoint[0]/t,this._pickpoint[1]/i,G]),[L[0],L[1],L[2]])},_drawScenePickingInstances:function(){var e=this.ui.gl,t=this.ui.width,i=this.ui.height,r=this.xform,n=this.renderer,a=this.colorCodedIDNXSProgram,s=this.colorCodedIDPointNXSProgram,o=this.colorCodedIDPLYtechnique,u=this._scene.meshes,c=this._scene.modelInstances,l=this._scene.space,h=new Uint8Array(4)
this._createPickFramebuffer(t,i),this._setupDraw(),this.pickFramebuffer.bind(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this.pickFramebuffer.unbind()
for(var d in c){var p=c[d],f=u[p.mesh]
if(f){var _=f.renderable
if(_&&p.visible){e.enable(e.DEPTH_TEST),r.model.push(),r.model.multiply(l.transform.matrix),r.model.multiply(p.transform.matrix),r.model.multiply(f.transform.matrix)
var g=this._ID2Color(p.ID),m={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix,uColorID:g}
if(f.isNexus){if(!_.isReady)continue
var S=_
S.modelMatrix=r.modelMatrix,S.viewMatrix=r.viewMatrix,S.projectionMatrix=r.projectionMatrix,S.viewport=[0,0,t,i],this.pickFramebuffer.bind()
var L
L=S._header.signature.face.hasIndex?a:s,L.bind(),L.setUniforms(m),S.begin(),S.render(),S.end(),L.unbind(),this.pickFramebuffer.unbind()}else n.begin(),n.setFramebuffer(this.pickFramebuffer),n.setTechnique(o),n.setDefaultGlobals(),n.setPrimitiveMode("FILL"),n.setGlobals(m),n.setModel(_),n.renderModel(),n.end()
e.disable(e.DEPTH_TEST),r.model.pop()}}}return this.pickFramebuffer.readPixels(h,{x:this._pickpoint[0],y:this._pickpoint[1],width:1,height:1,format:e.RGBA,type:e.UNSIGNED_BYTE}),h},_drawScenePickingSpots:function(){var e=this.ui.gl,t=this.ui.width,i=this.ui.height,r=this.xform,n=this.renderer,a=this.colorCodedIDNXSProgram,s=this.colorCodedIDPointNXSProgram,o=this.colorCodedIDPLYtechnique,u=this._scene.meshes,c=this._scene.spots,l=this._scene.modelInstances,h=this._scene.space,d=new Uint8Array(4)
this._createPickFramebuffer(t,i),this._setupDraw(),this.pickFramebuffer.bind(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this.pickFramebuffer.unbind()
for(var p in l){var f=l[p],_=u[f.mesh]
if(_){var g=_.renderable
if(g&&f.visible){e.enable(e.DEPTH_TEST),r.model.push(),r.model.multiply(h.transform.matrix),r.model.multiply(f.transform.matrix),r.model.multiply(_.transform.matrix)
var m={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix,uColorID:[0,0,0,0]}
if(_.isNexus){if(!g.isReady)continue
var S=g
S.modelMatrix=r.modelMatrix,S.viewMatrix=r.viewMatrix,S.projectionMatrix=r.projectionMatrix,S.viewport=[0,0,t,i],this.pickFramebuffer.bind()
var L
L=S._header.signature.face.hasIndex?a:s,L.bind(),L.setUniforms(m),S.begin(),S.render(),S.end(),L.unbind(),this.pickFramebuffer.unbind()}else n.begin(),n.setFramebuffer(this.pickFramebuffer),n.setTechnique(o),n.setDefaultGlobals(),n.setPrimitiveMode("FILL"),n.setGlobals(m),n.setModel(g),n.renderModel(),n.end()
e.disable(e.DEPTH_TEST),r.model.pop()}}}for(var b in c){var v=c[b],_=u[v.mesh]
if(_){var g=_.renderable
if(g&&v.visible){e.enable(e.DEPTH_TEST),r.model.push(),r.model.multiply(h.transform.matrix),r.model.multiply(v.transform.matrix),r.model.multiply(_.transform.matrix)
var x=this._ID2Color(v.ID),m={uWorldViewProjectionMatrix:r.modelViewProjectionMatrix,uColorID:x}
if(_.isNexus){if(!g.isReady)continue
var S=g
S.modelMatrix=r.modelMatrix,S.viewMatrix=r.viewMatrix,S.projectionMatrix=r.projectionMatrix,S.viewport=[0,0,t,i],this.pickFramebuffer.bind()
var L
L=S._header.signature.face.hasIndex?a:s,L.bind(),L.setUniforms(m),S.begin(),S.render(),S.end(),L.unbind(),this.pickFramebuffer.unbind()}else n.begin(),n.setFramebuffer(this.pickFramebuffer),n.setTechnique(o),n.setDefaultGlobals(),n.setPrimitiveMode("FILL"),n.setGlobals(m),n.setModel(g),n.renderModel(),n.end()
e.disable(e.DEPTH_TEST),r.model.pop()}}}return this.pickFramebuffer.readPixels(d,{x:this._pickpoint[0],y:this._pickpoint[1],width:1,height:1,format:e.RGBA,type:e.UNSIGNED_BYTE}),d},_drawNull:function(){var e=this.ui.gl
e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)},_createLineModel:function(){var e=this.ui.gl
this.simpleLineModel=new SglModel(e,{vertices:{position:[0,0,0,1,1,1],normal:[0,0,0,0,0,0],color:{value:[1,0,0]}},primitives:["lines","points"]})},onInitialize:function(){var e=this.ui.gl
e.getExtension("EXT_frag_depth"),e.clearColor(.5,.5,.5,1)
var t=new SglTransformationStack,i=new SglModelRenderer(e),r=SglMat4.identity()
this.basicNXSProgram=this._createStandardNXSProgram(),this.pointNXSProgram=this._createStandardPointNXSProgram(),this.colorCodedIDNXSProgram=this._createColorCodedIDNXSProgram(),this.colorCodedIDPointNXSProgram=this._createColorCodedIDPointNXSProgram(),this.colorCodedXYZNXSProgram=this._createXYZNXSProgram(),this.colorCodedXYZPointNXSProgram=this._createXYZPointNXSProgram(),this.basicPLYTechnique=this._createStandardPLYtechnique(),this.colorCodedIDPLYtechnique=this._createColorCodedIDPLYtechnique(),this.colorCodedXYZPLYtechnique=this._createXYZPLYtechnique(),this.colorShadedNXSProgram=this._createColorShadedNXSProgram(),this.colorShadedPointNXSProgram=this._createColorShadedPointNXSProgram(),this.colorShadedPLYtechnique=this._createColorShadedPLYtechnique(),this.simpleLinetechnique=this._createSimpleLinetechnique(),this.renderer=i,this.xform=t,this.viewMatrix=r,this.sceneCenter=[0,0,0],this.sceneRadiusInv=1,this.ui.animateRate=0,this.diff=0,this.x=0,this.y=0,this.dstartx=0,this.dstarty=0,this.dendx=0,this.dendy=0,this.ax1=0,this.ay1=0,this._scene=null,this._sceneParsed=!1,this._objectsToLoad=0,this._targetInstanceName=null,this._targetHotSpotName=null,this._instancesProgressiveID=1,this._spotsProgressiveID=1,this._animating=!1,this._movingLight=!1,this._clickable=!1,this._onHover=!1,this._lastCursor="default",this._pickedInstance=null,this._pickedSpot=null,this._lastPickedInstance=null,this._lastPickedSpot=null,this._lastInstanceID=0,this._lastSpotID=0,this._pickpoint=[10,10],this._isMeasuring=!1,this._measurementStage=0,this._pointA=[0,0,0],this._pointB=[0,0,0],this.measurement=0,this._onPickedInstance=0,this._onPickedSpot=0,this._onEnterInstance=0,this._onEnterSpot=0,this._onLeaveInstance=0,this._onLeaveSpot=0,this._onEndMeasurement=0},onDrag:function(e,t,i,r){var n=this.ui
if(this.ax1=t/(n.width-1)*2-1,this.ay1=i/(n.height-1)*2-1,this._movingLight&&n.isMouseButtonDown(0))return void this.rotateLight(this.ax1/2,this.ay1/2)
this.dstartx==n.dragStartX(e)&&(this.diff=n.dragEndX(e)-this.dendx,0!=n.dragDeltaX(e)&&(this.x+=this.diff/500)),this.dstarty==n.dragStartY(e)&&(this.diff=n.dragEndY(e)-this.dendy,0!=n.dragDeltaY(e)&&(this.y+=this.diff/500))
var a=SGL_TRACKBALL_NO_ACTION
n.isMouseButtonDown(0)&&n.isKeyDown(17)||n.isMouseButtonDown(1)?a=SGL_TRACKBALL_PAN:n.isMouseButtonDown(0)&&(a=SGL_TRACKBALL_ROTATE)
var s=this.trackball._matrix.slice()
this.trackball.action=a,this.trackball.track(this.viewMatrix,this.x,this.y,0)
for(var o,u=0;u<s.length;u++)if(s[u]!=this.trackball._matrix[u]){o=!0
break}o&&n.postDrawEvent(),this.dstartx=n.dragStartX(e),this.dstarty=n.dragStartY(e),this.dendx=n.dragEndX(e),this.dendy=n.dragEndY(e)},onMouseMove:function(e,t,i){i.target.id==this.ui.gl.canvas.id&&(!this._onHover||this.ui.isDragging(0)||this.isAnimate()||this._pickingRefresh(e,t))},onMouseOut:function(e,t){this._onHover&&!this.ui.isDragging(0)&&this._pickingRefresh()},onMouseButtonDown:function(e,t,i,r){this._clickable=!0},onMouseButtonUp:function(e,t,i,r){this._clickable&&!this.ui.isDragging(0)&&0==e&&-1!=r.detail&&(this._pickingRefresh(t,i),this._onPickedSpot&&null!=this._pickedSpot&&this._onPickedSpot(this._pickedSpot),this._onPickedInstance&&null!=this._pickedInstance&&this._onPickedInstance(this._pickedInstance),this._measureRefresh(e,t,i,r)),this._clickable=!1},onKeyPress:function(e,t){this._isDebugging&&(("80"==t.charCode||"112"==t.charCode)&&console.log(this.trackball.getState()),"49"==t.charCode&&(Nexus.Debug.nodes=!Nexus.Debug.nodes,this.ui.postDrawEvent()))},onMouseWheel:function(e,t,i,r){var n=this.ui,a=SGL_TRACKBALL_SCALE,s=0>e?.9:1.1,o=this.trackball._matrix.slice()
this.trackball.action=a,this.trackball.track(this.viewMatrix,0,0,s),this.trackball.action=SGL_TRACKBALL_NO_ACTION
for(var u,c=0;c<o.length;c++)if(o[c]!=this.trackball._matrix[c]){u=!0
break}u&&n.postDrawEvent()},onAnimate:function(e){this._isSceneReady()&&(this.trackball.tick(e)?this.ui.postDrawEvent():(this.ui.animateRate=0,this._onHover&&!this.ui.isDragging(0)&&this._pickingRefresh(this.ui.cursorX,this.ui.cursorY)))},onDraw:function(){this._isSceneReady()?this._drawScene():this._drawNull()},supportsWebGL:function(){return this._supportsWebGL},toggleDebugMode:function(){this._isDebugging=!this._isDebugging},setScene:function(e){if(e){var t=this._parseScene(e)
if(t){this._scene=t,this._objectsToLoad=0
for(var i in t.meshes){var r=t.meshes[i]
r.url&&this._objectsToLoad++}for(var n in t.texturedQuads){var a=t.texturedQuads[n]
a.url&&this._objectsToLoad++}t.background.image&&this._objectsToLoad++
var s=new this._scene.trackball.type
s.setup(this._scene.trackball.trackOptions),this.trackball=s
var o=this,u=this.ui.gl
for(var i in t.meshes){var r=t.meshes[i]
if(r.url)if(String(r.url).lastIndexOf(".nxs")==String(r.url).length-4){var c=new Nexus.Renderer(u)
r.renderable=c,r.isNexus=!0,c.targetError=1,c._targetFps=25,c.onSceneReady=function(){o._onMeshReady()},c.onUpdate=this.ui.postDrawEvent,c.open(r.url)}else r.renderable=null,r.isNexus=!1,sglRequestBinary(r.url,{onSuccess:function(e){return function(t){o._onPlyLoaded(t,e,u)}}(r)})}for(var n in t.texturedQuads){var a=t.texturedQuads[n]
a.url&&(t.background.texture=new SglTexture2D(u,{internalFormat:u.RGBA,format:u.RGBA,type:u.UNSIGNED_BYTE,generateMipmap:!0,onSuccess:function(){o._onTextureReady()},url:a.url}))}t.background.image&&(t.background.texture=new SglTexture2D(u,{internalFormat:u.RGBA,format:u.RGBA,type:u.UNSIGNED_BYTE,generateMipmap:!0,onSuccess:function(){o._onBackgroundReady()},url:t.background.image})),this._createLineModel(),this._testReady(),this._sceneParsed=!0}}},resetTrackball:function(){this.trackball.reset(),this.trackball.track(SglMat4.identity(),0,0,0),this._lightDirection=[0,0,-1],this.ui.postDrawEvent()},getTrackballPosition:function(){return this.trackball.getState()},setTrackballPosition:function(e){this.trackball.setState(e),this.ui.postDrawEvent()},animateToTrackballPosition:function(e){this.ui.animateRate=30,this.trackball.animateToState(e),this.ui.postDrawEvent()},isAnimate:function(){return this.ui.animateRate>0?this._animating=!0:this._animating=!1,this._animating},setInstanceSolidColorByName:function(e,t,i,r){var n=this.ui,a=this._scene.modelInstances
if(e==HOP_ALL){for(var s in a)a[s].useSolidColor=t
r&&(a[e].color=r)}else a[e]&&(a[e].useSolidColor=t,r&&(a[e].color=r))
i&&n.postDrawEvent()},setInstanceSolidColor:function(e,t,i,r){var n=this.ui,a=this._scene.modelInstances
for(var s in a)if(e==HOP_ALL)a[s].useSolidColor=t,r&&(a[s].color=r)
else for(var o in a[s].tags)a[s].tags[o]==e&&(a[s].useSolidColor=t,r&&(a[s].color=r))
i&&n.postDrawEvent()},toggleInstanceSolidColorByName:function(e,t){var i=this.ui,r=this._scene.modelInstances
if(e==HOP_ALL)for(var n in r)r[n].useSolidColor=!r[n].useSolidColor
else r[e]&&(r[e].useSolidColor=!r[e].useSolidColor)
t&&i.postDrawEvent()},toggleInstanceSolidColor:function(e,t){var i=this.ui,r=this._scene.modelInstances
for(var n in r)if(e==HOP_ALL)r[n].useSolidColor=!r[n].useSolidColor
else for(var a in r[n].tags)r[n].tags[a]==e&&(r[n].useSolidColor=!r[n].useSolidColor)
t&&i.postDrawEvent()},setInstanceTransparencyByName:function(e,t,i,r){var n=this.ui,a=this._scene.modelInstances
if(e==HOP_ALL){for(var s in a)a[s].useTransparency=t
r&&(a[s].alpha=r)}else a[e]&&(a[e].useTransparency=t,r&&(a[e].alpha=r))
i&&n.postDrawEvent()},setInstanceTransparency:function(e,t,i,r){var n=this.ui,a=this._scene.modelInstances
for(var s in a)if(e==HOP_ALL)a[s].useTransparency=t,r&&(a[s].alpha=r)
else for(var o in a[s].tags)a[s].tags[o]==e&&(a[s].useTransparency=t,r&&(a[s].alpha=r))
i&&n.postDrawEvent()},toggleInstanceTransparencyByName:function(e,t){var i=this.ui,r=this._scene.modelInstances
if(e==HOP_ALL)for(var n in r)r[n].useTransparency=!r[n].useTransparency
else r[e]&&(r[e].useTransparency=!r[e].useTransparency)
t&&i.postDrawEvent()},toggleInstanceTransparency:function(e,t){var i=this.ui,r=this._scene.modelInstances
for(var n in r)if(e==HOP_ALL)r[n].useTransparency=!r[n].useTransparency
else for(var a in r[n].tags)r[n].tags[a]==e&&(r[n].useTransparency=!r[n].useTransparency)
t&&i.postDrawEvent()},setInstanceVisibilityByName:function(e,t,i){var r=this.ui,n=this._scene.modelInstances
if(e==HOP_ALL)for(var a in n)n[a].visible=t
else n[e]&&(n[e].visible=t)
i&&r.postDrawEvent()},setInstanceVisibility:function(e,t,i){var r=this.ui,n=this._scene.modelInstances
for(var a in n)if(e==HOP_ALL)n[a].visible=t
else for(var s in n[a].tags)n[a].tags[s]==e&&(n[a].visible=t)
i&&r.postDrawEvent()},toggleInstanceVisibilityByName:function(e,t){var i=this.ui,r=this._scene.modelInstances
if(e==HOP_ALL)for(var n in r)r[n].visible=!r[n].visible
else r[e]&&(r[e].visible=!r[e].visible)
t&&i.postDrawEvent()},toggleInstanceVisibility:function(e,t){var i=this.ui,r=this._scene.modelInstances
for(var n in r)if(e==HOP_ALL)r[n].visible=!r[n].visible
else for(var a in r[n].tags)r[n].tags[a]==e&&(r[n].visible=!r[n].visible)
t&&i.postDrawEvent()},isInstanceVisibilityEnabledByName:function(e){var t=!1,i=this._scene.modelInstances
if(e&&e!=HOP_ALL){if(i[e]&&i[e].visible)return t=!0}else for(var r in i)if(i[r].visible)return t=!0
return t},isInstanceVisibilityEnabled:function(e){var t=!1,i=this._scene.modelInstances
for(var r in i)if(e&&e!=HOP_ALL){for(var n in i[r].tags)if(i[r].tags[n]==e&&i[r].visible)return t=!0}else if(i[r].visible)return t=!0
return t},setSpotVisibilityByName:function(e,t,i){var r=this.ui,n=this._scene.spots
if(e==HOP_ALL)for(var a in n)n[a].visible=t
else n[e]&&(n[e].visible=t)
i&&r.postDrawEvent()},setSpotVisibility:function(e,t,i){var r=this.ui,n=this._scene.spots
for(var a in n)if(e==HOP_ALL)n[a].visible=t
else for(var s in n[a].tags)n[a].tags[s]==e&&(n[a].visible=t)
i&&r.postDrawEvent()},toggleSpotVisibilityByName:function(e,t){var i=this.ui,r=this._scene.spots
if(e==HOP_ALL)for(var n in r)r[n].visible=!r[n].visible
else r[e]&&(r[e].visible=!r[e].visible)
t&&i.postDrawEvent()},toggleSpotVisibility:function(e,t){var i=this.ui,r=this._scene.spots
for(var n in r)if(e==HOP_ALL)r[n].visible=!r[n].visible
else for(var a in r[n].tags)r[n].tags[a]==e&&(r[n].visible=!r[n].visible)
t&&i.postDrawEvent()},isSpotVisibilityEnabledByName:function(e){var t=!1,i=this._scene.spots
if(e&&e!=HOP_ALL){if(i[e]&&i[e].visible)return t=!0}else for(var r in i)if(i[r].visible)return t=!0
return t},isSpotVisibilityEnabled:function(e){var t=!1,i=this._scene.spots
for(var r in i)if(e&&e!=HOP_ALL){for(var n in i[r].tags)if(i[r].tags[n]==e&&i[r].visible)return t=!0}else if(i[r].visible)return t=!0
return t},zoomIn:function(){this.onMouseWheel(-1)},zoomOut:function(){this.onMouseWheel(1)},rotateLight:function(e,t){e*=2,t*=2
var i=Math.sqrt(e*e+t*t)
i>=1&&(e/=i,t/=i,i=.999)
var r=Math.sqrt(1-i*i)
this._lightDirection=[-e,-t,-r],this.ui.postDrawEvent()},enableLightTrackball:function(e){this._movingLight=e},isLightTrackballEnabled:function(){return this._movingLight},enableOnHover:function(e){this._onHover=e},isOnHoverEnabled:function(){return this._onHover},enableMeasurementTool:function(e){this._isMeasuring=e,e?this._startMeasurement():this._stopMeasurement()},isMeasurementToolEnabled:function(){return this._isMeasuring}}
var SpiderGL={}
SpiderGL.TAG=0,SpiderGL.openNamespace=function(e){function t(e){return s.test(e)}function i(e){return o.test(e)&&!t(e)}function r(e){return u.test(e)}function n(e){return e.substr(0,1).toUpperCase()+e.substr(1)}function a(e){if(e)for(var n in e)if("_"!=n.substr(0,1)){var a=e[n]
i(n)?c[n]=a:r(n)?l[n]=a:t(n)&&(h[n]=a)}}e=SpiderGL.Utility.getDefaultObject({globalObject:SpiderGL.openNamespace.DEFAULT_GLOBAL_OBJECT,constantPrefix:SpiderGL.openNamespace.DEFAULT_CONSTANT_PREFIX,functionPrefix:SpiderGL.openNamespace.DEFAULT_FUNCTION_PREFIX,classPrefix:SpiderGL.openNamespace.DEFAULT_CLASS_PREFIX},e)
var s=new RegExp("^(([_$0-9A-Z])+)$"),o=new RegExp("^([A-Z])"),u=new RegExp("^(([a-z])+([_$0-9A-Za-z])*)$"),c={},l={},h={},d=["Core","DOM","IO","Math","Mesh","Model","Semantic","Space","Type","UserInterface","Utility","Version","WebGL"]
for(var p in d)a(SpiderGL[d[p]])
for(var p in c){var f=e.classPrefix+n(p)
e.globalObject[f]=c[p]}for(var p in l){var f=e.functionPrefix+n(p)
e.globalObject[f]=l[p]}for(var p in h){var f=e.constantPrefix+n(p)
e.globalObject[f]=h[p]}},SpiderGL.openNamespace.DEFAULT_GLOBAL_OBJECT=window,SpiderGL.openNamespace.DEFAULT_CONSTANT_PREFIX="SGL_",SpiderGL.openNamespace.DEFAULT_FUNCTION_PREFIX="sgl",SpiderGL.openNamespace.DEFAULT_CLASS_PREFIX="Sgl",SpiderGL.Version={},SpiderGL.Version.VERSION_MAJOR=0,SpiderGL.Version.VERSION_MINOR=2,SpiderGL.Version.VERSION_REVISION=1,SpiderGL.Version.VERSION_STRING=SpiderGL.Version.VERSION_MAJOR+"."+SpiderGL.Version.VERSION_MINOR+"."+SpiderGL.Version.VERSION_REVISION,SpiderGL.Core={},SpiderGL.Core.DEFAULT={},SpiderGL.Core.DONT_CARE={},SpiderGL.Core.EMPTY_STRING="",SpiderGL.Core.EMPTY_OBJECT={},SpiderGL.Core.EMPTY_ARRAY=[],SpiderGL.Core.EMPTY_FUNCTION=function(){},SpiderGL.Core.generateUID=function(){return SpiderGL.Core.generateUID._lastUID++,SpiderGL.Core.generateUID._lastUID},SpiderGL.Core.generateUID._lastUID=0,SpiderGL.Core.ObjectBase=function(){this._uid=SpiderGL.Core.generateUID()},SpiderGL.Core.ObjectBase.prototype={get uid(){return this._uid}},SpiderGL.Type={},SpiderGL.Type.LITTLE_ENDIAN=function(){var e=new Uint8Array([18,52]),t=new Uint16Array(e.buffer)
return 13330==t[0]}(),SpiderGL.Type.BIG_ENDIAN=!SpiderGL.Type.BIG_ENDIAN,SpiderGL.Type.NO_TYPE=0,SpiderGL.Type.INT8=1,SpiderGL.Type.UINT8=2,SpiderGL.Type.INT16=3,SpiderGL.Type.UINT16=4,SpiderGL.Type.INT32=5,SpiderGL.Type.UINT32=6,SpiderGL.Type.FLOAT32=7,SpiderGL.Type.SIZEOF_INT8=Int8Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_UINT8=Uint8Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_INT16=Int16Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_UINT16=Uint16Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_INT32=Int32Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_UINT32=Uint32Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_FLOAT32=Float32Array.BYTES_PER_ELEMENT,SpiderGL.Type.typeSize=function(){var e={}
return e[SpiderGL.Type.NO_TYPE]=0,e[SpiderGL.Type.INT8]=SpiderGL.Type.SIZEOF_INT8,e[SpiderGL.Type.UINT8]=SpiderGL.Type.SIZEOF_UINT8,e[SpiderGL.Type.INT16]=SpiderGL.Type.SIZEOF_INT16,e[SpiderGL.Type.UINT16]=SpiderGL.Type.SIZEOF_UINT16,e[SpiderGL.Type.INT32]=SpiderGL.Type.SIZEOF_INT32,e[SpiderGL.Type.UINT32]=SpiderGL.Type.SIZEOF_UINT32,e[SpiderGL.Type.FLOAT32]=SpiderGL.Type.SIZEOF_FLOAT32,function(t){return e[t]}}(),SpiderGL.Type.typeToGL=function(){var e={}
return e[SpiderGL.Type.NO_TYPE]=WebGLRenderingContext.prototype.NONE,e[SpiderGL.Type.INT8]=WebGLRenderingContext.prototype.BYTE,e[SpiderGL.Type.UINT8]=WebGLRenderingContext.prototype.UNSIGNED_BYTE,e[SpiderGL.Type.INT16]=WebGLRenderingContext.prototype.SHORT,e[SpiderGL.Type.UINT16]=WebGLRenderingContext.prototype.UNSIGNED_SHORT,e[SpiderGL.Type.INT32]=WebGLRenderingContext.prototype.INT,e[SpiderGL.Type.UINT32]=WebGLRenderingContext.prototype.UNSIGNED_INT,e[SpiderGL.Type.FLOAT32]=WebGLRenderingContext.prototype.FLOAT,function(t){return e[t]}}(),SpiderGL.Type.typeFromGL=function(){var e={}
return e[WebGLRenderingContext.prototype.NONE]=SpiderGL.Type.NO_TYPE,e[WebGLRenderingContext.prototype.BYTE]=SpiderGL.Type.INT8,e[WebGLRenderingContext.prototype.UNSIGNED_BYTE]=SpiderGL.Type.UINT8,e[WebGLRenderingContext.prototype.SHORT]=SpiderGL.Type.INT16,e[WebGLRenderingContext.prototype.UNSIGNED_SHORT]=SpiderGL.Type.UINT16,e[WebGLRenderingContext.prototype.INT]=SpiderGL.Type.INT32,e[WebGLRenderingContext.prototype.UNSIGNED_INT]=SpiderGL.Type.UINT32,e[WebGLRenderingContext.prototype.FLOAT]=SpiderGL.Type.FLOAT32,function(t){return e[t]}}(),SpiderGL.Type.typeSizeFromGL=function(e){var t=SpiderGL.Type.typeFromGL(e)
return SpiderGL.Type.typeSize(t)},SpiderGL.Type.typeToTypedArrayConstructor=function(){var e={}
return e[SpiderGL.Type.NO_TYPE]=ArrayBuffer,e[SpiderGL.Type.INT8]=Int8Array,e[SpiderGL.Type.UINT8]=Uint8Array,e[SpiderGL.Type.INT16]=Int16Array,e[SpiderGL.Type.UINT16]=Uint16Array,e[SpiderGL.Type.INT32]=Int32Array,e[SpiderGL.Type.UINT32]=Uint32Array,e[SpiderGL.Type.FLOAT32]=Float32Array,function(t){return e[t]}}(),SpiderGL.Type.POINTS=0,SpiderGL.Type.LINES=1,SpiderGL.Type.LINE_LOOP=2,SpiderGL.Type.LINE_STRIP=3,SpiderGL.Type.TRIANGLES=4,SpiderGL.Type.TRIANGLE_FAN=5,SpiderGL.Type.TRIANGLE_STRIP=6,SpiderGL.Type.primitiveToGL=function(){var e={}
return e[SpiderGL.Type.POINTS]=WebGLRenderingContext.prototype.POINTS,e[SpiderGL.Type.LINES]=WebGLRenderingContext.prototype.LINES,e[SpiderGL.Type.LINE_LOOP]=WebGLRenderingContext.prototype.LINE_LOOP,e[SpiderGL.Type.LINE_STRIP]=WebGLRenderingContext.prototype.LINE_STRIP,e[SpiderGL.Type.TRIANGLES]=WebGLRenderingContext.prototype.TRIANGLES,e[SpiderGL.Type.TRIANGLE_FAN]=WebGLRenderingContext.prototype.TRIANGLE_FAN,e[SpiderGL.Type.TRIANGLE_STRIP]=WebGLRenderingContext.prototype.TRIANGLE_STRIP,function(t){return e[t]}}(),SpiderGL.Type.instanceOf=function(e,t){return e instanceof t},SpiderGL.Type.isNumber=function(e){return"number"==typeof e},SpiderGL.Type.isString=function(e){return"string"==typeof e},SpiderGL.Type.isFunction=function(e){return"function"==typeof e},SpiderGL.Type.isArray=function(e){return e&&e.constructor===Array},SpiderGL.Type.isTypedArray=function(e){return e&&"undefined"!=typeof e.buffer&&e.buffer instanceof ArrayBuffer},SpiderGL.Type.extend=function(e,t){function i(){}i.prototype=t.prototype
var r=e.prototype,n=new i
n.constructor=e
var a=null,s=null
for(var o in r)a=r.__lookupGetter__(o),a&&n.__defineGetter__(o,a),s=r.__lookupSetter__(o),s&&n.__defineSetter__(o,s),a||s||(n[o]=r[o])
e.prototype=n},SpiderGL.Type.defineClassGetter=function(e,t,i){e.prototype.__defineGetter__(t,i)},SpiderGL.Type.defineClassSetter=function(e,t,i){e.prototype.__defineSetter__(t,i)},SpiderGL.Type.defineObjectGetter=function(e,t,i){e.__defineGetter__(t,i)},SpiderGL.Type.defineObjectSetter=function(e,t,i){e.__defineSetter__(t,i)},SpiderGL.Utility={},SpiderGL.Utility.getDefaultValue=function(e,t){return void 0===e||e===SpiderGL.Core.DEFAULT?t:e},SpiderGL.Utility.getDefaultObject=function(e,t){if(t){var i=SpiderGL.Core.DEFAULT
for(var r in t)t[r]!=i&&(e[r]=t[r])}return e},SpiderGL.Utility.setDefaultValues=function(e,t){if(!t)return e
var i=SpiderGL.Core.DEFAULT
for(var r in t)t[r]==i&&"undefined"!=typeof e[r]&&(t[r]=e[r])
for(var r in e)"undefined"==typeof t[r]&&(t[r]=e[r])
return t},SpiderGL.Utility.getAttrib4fv=function(e){return SpiderGL.Type.isNumber(e)?[e,0,0,1]:e?[void 0!=e[0]?e[0]:0,void 0!=e[1]?e[1]:0,void 0!=e[2]?e[2]:0,void 0!=e[3]?e[3]:1]:[0,0,0,1]},SpiderGL.Utility.getTime=function(){return(new Date).getTime()},SpiderGL.Utility.Timer=function(){this._tStart=-1,this._tElapsed=0},SpiderGL.Utility.Timer.prototype={_accumElapsed:function(){this._tElapsed+=this.now-this._tStart},get now(){return Date.now()},start:function(){this.isStarted||this.isPaused||(this._tStart=this.now,this._tElapsed=0)},restart:function(){var e=this.elapsed
return this._tStart=this.now,this._tElapsed=0,e},stop:function(){this.isStarted&&(this.isPaused||(this._accumElapsed(),this._tStart=-1))},get isStarted(){return this._tStart>=0},pause:function(){this.isStarted&&(this.isPaused||(this._accumElapsed(),this._tStart=-2))},resume:function(){this.isStarted&&this.isPaused&&(this._tStart=this.now)},get isPaused(){return-2==this._tStart},get elapsed(){return this.isStarted?this._tElapsed+(this.now-this._tStart):this._tElapsed}},SpiderGL.DOM={},SpiderGL.DOM.getElementById=function(e){return document.getElementById(e)},SpiderGL.DOM.getElementText=function(e){var t=document.getElementById(e)
if(!t)return null
var i=""
for(t=t.firstChild;t;)3==t.nodeType&&(i+=t.textContent),t=t.nextSibling
return i},SpiderGL.IO={},SpiderGL.IO.Request=function(e,t){SpiderGL.Core.ObjectBase.call(this),t=SpiderGL.Utility.getDefaultObject({async:SpiderGL.IO.Request.DEFAULT_ASYNC,send:SpiderGL.IO.Request.DEFAULT_SEND,onProgress:null,onCancel:null,onError:null,onSuccess:null,onFinish:null},t),this._url=e,this._async=t.async,this._status=SpiderGL.IO.Request.NONE,this._sent=!1,this._aborted=!1,this._data=null,this._loaded=0,this._total=0,this._events={progress:{main:null,listeners:[]},cancel:{main:null,listeners:[]},error:{main:null,listeners:[]},success:{main:null,listeners:[]},finish:{main:null,listeners:[]}},this.onProgress=t.onProgress,this.onCancel=t.onCancel,this.onError=t.onError,this.onSuccess=t.onSuccess,this.onFinish=t.onFinish},SpiderGL.IO.Request.NONE=0,SpiderGL.IO.Request.ONGOING=1,SpiderGL.IO.Request.CANCELLED=2,SpiderGL.IO.Request.FAILED=3,SpiderGL.IO.Request.SUCCEEDED=4,SpiderGL.IO.Request.DEFAULT_ASYNC=!0,SpiderGL.IO.Request.DEFAULT_SEND=!0,SpiderGL.IO.Request.prototype={_indexOf:function(e,t){for(var i=0,r=e.length;r>i;++i)if(e[i]==t)return i
return-1},_setMainListener:function(e,t){var i=this._events[e]
i&&i.main!=t&&(t?this.addEventListener(e,t):this.removeEventListener(e,t),i.main=t)},_dispatch:function(){var e=arguments[0],t=this._events[e]
if(t){var i=Array.prototype.slice.call(arguments,1)
i.push(this)
for(var r=t.listeners,n=0,a=r.length;a>n;++n)r[n].apply(null,i)}},_doPostProgress:function(){},_doPostCancel:function(){},_doPostError:function(){},_doPostSuccess:function(){},_doPostFinish:function(){},_doOnProgress:function(e,t){this._aborted||(this._loaded=e,this._total=t,this._doPostProgress(),this._dispatch("progress",this._loaded,this._total))},_doOnCancel:function(){this._aborted||(this._status=SpiderGL.IO.Request.CANCELLED,this._finishTime=SpiderGL.Utility.getTime(),this._doPostCancel(),this._dispatch("cancel"))},_doOnError:function(){this._aborted||(this._status=SpiderGL.IO.Request.FAILED,this._finishTime=SpiderGL.Utility.getTime(),this._doPostError(),this._dispatch("error"))},_doOnSuccess:function(){this._aborted||(this._status=SpiderGL.IO.Request.SUCCEEDED,this._finishTime=SpiderGL.Utility.getTime(),this._doPostSuccess(),this._dispatch("success"))},_doOnFinish:function(){this._doPostFinish(),this._dispatch("finish")},_doSend:function(){return!1},_doCancel:function(){return!1},get canSend(){return this._url&&!this._sent},get url(){return this._url},set url(e){this.cancel(),this._url=e},get status(){return this._status},get data(){return this._data},get bytesLoaded(){return this._loaded},get bytesTotal(){return this._total},get sent(){return this._sent},get ongoing(){return this._status==SpiderGL.IO.Request.ONGOING},get cancelled(){return this._status==SpiderGL.IO.Request.CANCELLED},get failed(){return this._status==SpiderGL.IO.Request.FAILED},get succeeded(){return this._status==SpiderGL.IO.Request.SUCCEEDED},get finished(){return this.succeeded||this.failed||this.cancelled},get startTime(){return this._startTime},get finishTime(){return this._finishTime},get elapsedTime(){return this._startTime<0?0:this._finishTime<0?SpiderGL.Utility.getTime()-this._startTime:this._finishTime-this._startTime},addEventListener:function(e,t){if(t){var i=this._events[e]
if(i){var r=this._indexOf(i.listeners,t)
r>=0||i.listeners.push(t)}}},removeEventListener:function(e,t){var i=this._events[e]
if(i){var r=this._indexOf(i.listeners,t)
0>r||i.listeners.splice(r,1)}},get onProgress(){return this._events.progress.main},set onProgress(e){this._setMainListener("progress",e)},get onCancel(){return this._events.cancel.main},set onCancel(e){this._setMainListener("cancel",e)},get onError(){return this._events.error.main},set onError(e){this._setMainListener("error",e)},get onSuccess(){return this._events.success.main},set onSuccess(e){this._setMainListener("success",e)},get onFinish(){return this._events.finish.main},set onFinish(e){this._setMainListener("finish",e)},cancel:function(){if(!this.ongoing)return!1
this._status=SpiderGL.IO.Request.CANCELLED,this._aborted=!0
var e=this._doCancel()
return this._finishTime=SpiderGL.Utility.getTime(),e},send:function(){if(!this.canSend)return!1
this._data=null,this._status=SpiderGL.IO.Request.ONGOING,this._aborted=!1,this._sent=!0,this._finishTime=-1,this._startTime=SpiderGL.Utility.getTime()
var e=this._doSend()
return e||(this._startTime=-1,this._status=SpiderGL.IO.Request.NONE,this._sent=!1),e}},SpiderGL.Type.extend(SpiderGL.IO.Request,SpiderGL.Core.ObjectBase),SpiderGL.IO.XHRRequestBase=function(e,t){t=t||{},SpiderGL.IO.Request.call(this,e,t)
var i=this,r=new XMLHttpRequest
if(this._xhr=r,r.onprogress=function(e){i._xhrOnProgress(e)},r.onabort=function(){i._doOnCancel(),i._doOnFinish()},r.onerror=function(){i._doOnError(),i._doOnFinish()},r.onload=function(){var e=r.status
0===e||200===e||i._range&&206==e?i._doOnSuccess():i._doOnError(),i._doOnFinish()},this._range=null,this._xhr.open("GET",this._url,this._async),"range"in t){this._range=[t.range[0],t.range[1]]
var n="bytes="+t.range[0]+"-"+t.range[1]
r.setRequestHeader("Range",n)}this._prepareXHR()
var a=SpiderGL.Utility.getDefaultValue(t.send,SpiderGL.IO.Request.DEFAULT_SEND)
a&&this.send()},SpiderGL.IO.XHRRequestBase.prototype={_prepareXHR:function(){},_doCancel:function(){return this._xhr.abort(),this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._url,this._async),this._prepareXHR(),!0},_doSend:function(){return this._xhr.send(),!0},_xhrOnProgress:function(e){var t=0,i=0
e&&e.lengthComputable&&(t=e.loaded,i=e.total),this._doOnProgress(t,i)}},SpiderGL.Type.extend(SpiderGL.IO.XHRRequestBase,SpiderGL.IO.Request),SpiderGL.IO.XHRRequest=function(e,t){SpiderGL.IO.XHRRequestBase.call(this,e,t)},SpiderGL.IO.XHRRequest.prototype={_doPostSuccess:function(){this._data=this._xhr.responseText},get xhr(){return this._xhr},get response(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.XHRRequest,SpiderGL.IO.XHRRequestBase),SpiderGL.IO.TextRequest=function(e,t){SpiderGL.IO.XHRRequestBase.call(this,e,t)},SpiderGL.IO.TextRequest.prototype={_doPostSuccess:function(){this._data=this._xhr.responseText},get text(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.TextRequest,SpiderGL.IO.XHRRequestBase),SpiderGL.IO.readText=function(e){var t=new SpiderGL.IO.TextRequest(e,{async:!1})
return t.text},SpiderGL.IO.requestText=function(e,t){t=SpiderGL.Utility.getDefaultObject({},t),t.async=!0,t.send=!0
var i=new SpiderGL.IO.TextRequest(e,t)
return i},SpiderGL.IO.JSONRequest=function(e,t){SpiderGL.IO.XHRRequestBase.call(this,e,t)},SpiderGL.IO.JSONRequest.prototype={_doPostSuccess:function(){this._data=JSON.parse(this._xhr.responseText)},get text(){return this._xhr.responseText},get json(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.JSONRequest,SpiderGL.IO.XHRRequestBase),SpiderGL.IO.readJSON=function(e){var t=new SpiderGL.IO.JSONRequest(e,{async:!1})
return t.json},SpiderGL.IO.requestJSON=function(e,t){t=SpiderGL.Utility.getDefaultObject({},t),t.async=!0,t.send=!0
var i=new SpiderGL.IO.JSONRequest(e,t)
return i},SpiderGL.IO.BinaryRequest=function(e,t){SpiderGL.IO.XHRRequestBase.call(this,e,t)},SpiderGL.IO.BinaryRequest.prototype={_prepareXHR:function(){var e=this._xhr,t=!1
t&&e.overrideMimeType("text/plain; charset=x-user-defined"),e.responseType="arraybuffer"},_setArrayBuffer:function(){var e=this._xhr
if("arraybuffer"==e.responseType)this._data=e.response
else if(null!=e.mozResponseArrayBuffer)this._data=e.mozResponseArrayBuffer
else if(null!=e.responseText){for(var t=new String(e.responseText),i=new Array(t.length),r=0,n=t.length;n>r;++r)i[r]=255&t.charCodeAt(r)
this._data=new Uint8Array(i).buffer}else this._data=null},_doPostSuccess:function(){this._setArrayBuffer()},get data(){return this.ongoing&&this._setArrayBuffer(),this._data},get buffer(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.BinaryRequest,SpiderGL.IO.XHRRequestBase),SpiderGL.IO.readBinary=function(e){var t=new SpiderGL.IO.BinaryRequest(e,{async:!1})
return t.buffer},SpiderGL.IO.requestBinary=function(e,t){t=SpiderGL.Utility.getDefaultObject({},t),t.async=!0,t.send=!0
var i=new SpiderGL.IO.BinaryRequest(e,t)
return i},SpiderGL.IO.ImageRequest=function(e,t){t=t||{},SpiderGL.IO.Request.call(this,e,t)
var i=this,r=new Image
this._img=r,this._data=r,r.onabort=function(){i._doOnCancel(),i._doOnFinish()},r.onerror=function(){i._doOnError(),i._doOnFinish()},r.onload=function(){i._doOnSuccess(),i._doOnFinish()},"undefined"!=typeof r.onprogress&&(r.onprogress=function(e){i._imgOnProgress(e)})
var n=SpiderGL.Utility.getDefaultValue(t.send,SpiderGL.IO.Request.DEFAULT_SEND)
n&&this.send()},SpiderGL.IO.ImageRequest.prototype={_doPostSuccess:function(){this._data=this._img},_doCancel:function(){return this._img.src=null,this._img=new Image,!0},_doSend:function(){return this._img.src=this._url,!0},_imgOnProgress:function(e){var t=0,i=0
e&&e.lengthComputable&&(t=e.loaded,i=e.total),this._doOnProgress(t,i)},get image(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.ImageRequest,SpiderGL.IO.Request),SpiderGL.IO.requestImage=function(e,t){t=SpiderGL.Utility.getDefaultObject({},t),t.async=!0,t.send=!0
var i=new SpiderGL.IO.ImageRequest(e,t)
return i},SpiderGL.IO.AggregateRequest=function(e){e=e||{},SpiderGL.IO.Request.call(this,"*",e)
var t=this
this._proxyOnProgress=function(e,i,r){t._reqOnProgress(e,i,r)},this._proxyOnCancel=function(e){t._reqOnCancel(e)},this._proxyOnError=function(e){t._reqOnError(e)},this._proxyOnSuccess=function(e){t._reqOnSuccess(e)},this._proxyOnFinish=function(e){t._reqOnFinish(e)},this._aggrStartTime=-1,this._aggrFinishTime=-1,this._eventReq=null,this._cancelledReqs=0,this._failedReqs=0,this._succeededReqs=0,this._requests=[]
var i=e.requests
if(i)for(var r=0,n=i.length;n>r;++r){var a=i[r]
a&&!a.sent&&(this._installProxies(a),this.addRequest(a))}var s=SpiderGL.Utility.getDefaultValue(e.send,SpiderGL.IO.Request.DEFAULT_SEND)
s&&this.send()},SpiderGL.IO.AggregateRequest.prototype={_doPostCancel:function(){this._requestsFinished||(this._status=SpiderGL.IO.Request.ONGOING)},_doPostError:function(){this._requestsFinished||(this._status=SpiderGL.IO.Request.ONGOING)},_doPostSuccess:function(){this._requestsFinished||(this._status=SpiderGL.IO.Request.ONGOING)},_doCancel:function(){for(var e=this._requests,t=0,i=e.length;i>t;++t)e[t].cancel()
this._aggrFinishTime=SpiderGL.Utility.getTime()},_doSend:function(){this._aggrStartTime=SpiderGL.Utility.getTime()
for(var e=this._requests,t=0,i=e.length;i>t;++t)e[t].send()},get _requestsFinished(){return this._cancelledReqs+this._failedReqs+this._succeededReqs==this._requests.length},_installProxies:function(e){e.addEventListener("progress",this._proxyOnProgress),e.addEventListener("cancel",this._proxyOnCancel),e.addEventListener("error",this._proxyOnError),e.addEventListener("success",this._proxyOnSuccess),e.addEventListener("finish",this._proxyOnFinish)},_uninstallProxies:function(e){e.removeEventListener("progress",this._proxyOnProgress),e.removeEventListener("cancel",this._proxyOnCancel),e.removeEventListener("error",this._proxyOnError),e.removeEventListener("success",this._proxyOnSuccess),e.removeEventListener("finish",this._proxyOnFinish)},_reqOnProgress:function(e,t,i){var r=this._indexOf(this._requests,i)
0>r||(this._eventReq=i,this._doOnProgress(e,t),this._eventReq=null)},_reqOnCancel:function(e){var t=this._indexOf(this._requests,e)
0>t||(this._eventReq=e,this._cancelledReqs++,this._requestsFinished&&(this._aggrFinishTime=SpiderGL.Utility.getTime(),this._cancelledReqs==this._requests.length&&(this._eventReq=this,this._doOnCancel())),this._eventReq=null)},_reqOnError:function(e){var t=this._indexOf(this._requests,e)
0>t||(this._eventReq=e,this._failedReqs++,this._requestsFinished&&(this._aggrFinishTime=SpiderGL.Utility.getTime(),this._eventReq=this,this._doOnError()),this._eventReq=null)},_reqOnSuccess:function(e){var t=this._indexOf(this._requests,e)
0>t||(this._eventReq=e,this._succeededReqs++,this._requestsFinished&&(this._aggrFinishTime=SpiderGL.Utility.getTime(),this._eventReq=this,this._failedReqs>0?this._doOnError():this._doOnSuccess()),this._eventReq=null)},_reqOnFinish:function(e){var t=this._indexOf(this._requests,e)
0>t||(this._uninstallProxies(e),this._eventReq=e,this._requestsFinished&&(this._eventReq=this,this._doOnFinish()),this._eventReq=null)},get eventSenderRequest(){return this._eventReq},get requests(){return this._requests.slice()},get requests$(){return this._requests},get startTime(){return this._aggrStartTime},get finishTime(){return this._aggrFinishTime},get elapsedTime(){return this._aggrStartTime<0?0:this._aggrFinishTime<0?SpiderGL.Utility.getTime()-this._aggrStartTime:this._aggrFinishTime-this._aggrStartTime},addRequest:function(e){if(e&&!this._sent){var t=this._indexOf(this._requests,e)
t>=0||this._requests.push(e)}},removeRequest:function(e){if(e&&!this._sent){var t=this._indexOf(this._requests,e)
0>t||this._requests.splice(t,1)}}},SpiderGL.Type.extend(SpiderGL.IO.AggregateRequest,SpiderGL.IO.Request),SpiderGL.Math={},SpiderGL.Math.DEG_TO_RAD=Math.PI/180,SpiderGL.Math.E=Math.E,SpiderGL.Math.LN2=Math.LN2,SpiderGL.Math.LN10=Math.LN10,SpiderGL.Math.LOG2E=Math.LOG2E,SpiderGL.Math.LOG10E=Math.LOG10E,SpiderGL.Math.PI=Math.PI,SpiderGL.Math.RAD_TO_DEG=180/Math.PI,SpiderGL.Math.SQRT2=Math.SQRT2,SpiderGL.Math.MAX_VALUE=Number.MAX_VALUE,SpiderGL.Math.MIN_VALUE=Number.MIN_VALUE,SpiderGL.Math.MAX_NUMBER=SpiderGL.Math.MAX_VALUE,SpiderGL.Math.MIN_NUMBER=-SpiderGL.Math.MAX_VALUE,SpiderGL.Math.NAN=Number.NaN,SpiderGL.Math.INFINITY=1/0,SpiderGL.Math.abs=function(e){return Math.abs(e)},SpiderGL.Math.acos=function(e){return Math.acos(e)},SpiderGL.Math.asin=function(e){return Math.asin(e)},SpiderGL.Math.atan=function(e){return Math.atan(e)},SpiderGL.Math.atan2=function(e,t){return Math.atan2(e,t)},SpiderGL.Math.ceil=function(e){return Math.ceil(e)},SpiderGL.Math.clamp=function(e,t,i){return t>=e?t:e>=i?i:e},SpiderGL.Math.cos=function(e){return Math.cos(e)},SpiderGL.Math.degToRad=function(e){return e*SpiderGL.Math.DEG_TO_RAD},SpiderGL.Math.exp=function(e){return Math.exp(e)},SpiderGL.Math.floor=function(e){return Math.floor(e)},SpiderGL.Math.lerp=function(e,t,i){return e+i*(t-e)},SpiderGL.Math.ln=function(e){return Math.log(e)},SpiderGL.Math.log=function(e){return Math.log(e)},SpiderGL.Math.log2=function(e){return SpiderGL.Math.log(e)/SpiderGL.Math.LN2},SpiderGL.Math.log10=function(e){return SpiderGL.Math.log(e)/SpiderGL.Math.LN10},SpiderGL.Math.max=function(e){return Math.max.apply(Math,arguments)},SpiderGL.Math.min=function(e){return Math.min.apply(Math,arguments)},SpiderGL.Math.pow=function(e,t){return Math.pow(e,t)},SpiderGL.Math.radToDeg=function(e){return e*SpiderGL.Math.RAD_TO_DEG},SpiderGL.Math.random=function(){return Math.random()},SpiderGL.Math.random01=function(){return SpiderGL.Math.random()},SpiderGL.Math.random11=function(){return 2*SpiderGL.Math.random()-1},SpiderGL.Math.randomRange=function(e,t){return e+SpiderGL.Math.random()*(t-e)},SpiderGL.Math.round=function(e){return Math.sqrt(e)},SpiderGL.Math.sin=function(e){return Math.sin(e)},SpiderGL.Math.sqrt=function(e){return Math.sqrt(e)},SpiderGL.Math.tan=function(e){return Math.tan(e)},SpiderGL.Math.Vec2={},SpiderGL.Math.Vec2.dup=function(e){return e.slice(0,2)},SpiderGL.Math.Vec2.scalar=function(e){return[e,e]},SpiderGL.Math.Vec2.zero=function(){return[0,0]},SpiderGL.Math.Vec2.one=function(){return[1,1]},SpiderGL.Math.Vec2.maxNumber=function(){return[SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER]},SpiderGL.Math.Vec2.minNumber=function(){return[SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER]},SpiderGL.Math.Vec2.to3=function(e,t){return[e[0],e[1],void 0!=t?t:0]},SpiderGL.Math.Vec2.to4=function(e,t,i){return[e[0],e[1],e[2],void 0!=t?t:0,void 0!=i?i:1]},SpiderGL.Math.Vec2.neg=function(e){return[-e[0],-e[1]]},SpiderGL.Math.Vec2.add=function(e,t){return[e[0]+t[0],e[1]+t[1]]},SpiderGL.Math.Vec2.adds=function(e,t){return[e[0]+t,e[1]+t]},SpiderGL.Math.Vec2.sub=function(e,t){return[e[0]-t[0],e[1]-t[1]]},SpiderGL.Math.Vec2.subs=function(e,t){return[e[0]-t,e[1]-t]},SpiderGL.Math.Vec2.ssub=function(e,t){return[e-t[0],e-t[1]]},SpiderGL.Math.Vec2.mul=function(e,t){return[e[0]*t[0],e[1]*t[1]]},SpiderGL.Math.Vec2.muls=function(e,t){return[e[0]*t,e[1]*t]},SpiderGL.Math.Vec2.div=function(e,t){return[e[0]/t[0],e[1]/t[1]]},SpiderGL.Math.Vec2.divs=function(e,t){return[e[0]/t,e[1]/t]},SpiderGL.Math.Vec2.sdiv=function(e,t){return[e/t[0],e/t[1]]},SpiderGL.Math.Vec2.rcp=function(e){return[1/e[0],1/e[1]]},SpiderGL.Math.Vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},SpiderGL.Math.Vec2.cross=function(e,t){return e[0]*t[1]-e[1]*t[0]},SpiderGL.Math.Vec2.perp=function(e){return[e[1],-e[0]]},SpiderGL.Math.Vec2.sqLength=function(e){return SpiderGL.Math.Vec2.dot(e,e)},SpiderGL.Math.Vec2.length=function(e){return SpiderGL.Math.sqrt(SpiderGL.Math.Vec2.sqLength(e))},SpiderGL.Math.Vec2.normalize=function(e){var t=1/SpiderGL.Math.Vec2.length(e)
return SpiderGL.Math.Vec2.muls(e,t)},SpiderGL.Math.Vec2.abs=function(e){return[SpiderGL.Math.abs(e[0]),SpiderGL.Math.abs(e[1])]},SpiderGL.Math.Vec2.acos=function(e){return[SpiderGL.Math.acos(e[0]),SpiderGL.Math.acos(e[1])]},SpiderGL.Math.Vec2.asin=function(e){return[SpiderGL.Math.asin(e[0]),SpiderGL.Math.asin(e[1])]},SpiderGL.Math.Vec2.atan=function(e){return[SpiderGL.Math.atan(e[0]),SpiderGL.Math.atan(e[1])]},SpiderGL.Math.Vec2.atan2=function(e,t){return[SpiderGL.Math.atan2(e[0],t[0]),SpiderGL.Math.atan2(e[1],t[1])]},SpiderGL.Math.Vec2.ceil=function(e){return[SpiderGL.Math.ceil(e[0]),SpiderGL.Math.ceil(e[1])]},SpiderGL.Math.Vec2.clamp=function(e,t,i){return[SpiderGL.Math.clamp(e[0],t[0],i[0]),SpiderGL.Math.clamp(e[1],t[1],i[1])]},SpiderGL.Math.Vec2.cos=function(e){return[SpiderGL.Math.cos(e[0]),SpiderGL.Math.cos(e[1])]},SpiderGL.Math.Vec2.degToRad=function(e){return[SpiderGL.Math.degToRad(e[0]),SpiderGL.Math.degToRad(e[1])]},SpiderGL.Math.Vec2.exp=function(e){return[SpiderGL.Math.exp(e[0]),SpiderGL.Math.exp(e[1])]},SpiderGL.Math.Vec2.floor=function(e){return[SpiderGL.Math.floor(e[0]),SpiderGL.Math.floor(e[1])]},SpiderGL.Math.Vec2.lerp=function(e,t,i){return[SpiderGL.Math.lerp(e[0],t[0],i),SpiderGL.Math.lerp(e[1],t[1],i)]},SpiderGL.Math.Vec2.ln=function(e){return[SpiderGL.Math.ln(e[0]),SpiderGL.Math.ln(e[1])]},SpiderGL.Math.Vec2.log=function(e){return[SpiderGL.Math.log(e[0]),SpiderGL.Math.log(e[1])]},SpiderGL.Math.Vec2.log2=function(e){return[SpiderGL.Math.log2(e[0]),SpiderGL.Math.log2(e[1])]},SpiderGL.Math.Vec2.log10=function(e){return[SpiderGL.Math.log10(e[0]),SpiderGL.Math.log10(e[1])]},SpiderGL.Math.Vec2.max=function(e,t){return[SpiderGL.Math.max(e[0],t[0]),SpiderGL.Math.max(e[1],t[1])]},SpiderGL.Math.Vec2.min=function(e,t){return[SpiderGL.Math.min(e[0],t[0]),SpiderGL.Math.min(e[1],t[1])]},SpiderGL.Math.Vec2.pow=function(e,t){return[SpiderGL.Math.pow(e[0],t[0]),SpiderGL.Math.pow(e[1],t[1])]},SpiderGL.Math.Vec2.radToDeg=function(e){return[SpiderGL.Math.radToDeg(e[0]),SpiderGL.Math.radToDeg(e[1])]},SpiderGL.Math.Vec2.random=function(){return[SpiderGL.Math.random(),SpiderGL.Math.random()]},SpiderGL.Math.Vec2.random01=function(){return[SpiderGL.Math.random01(),SpiderGL.Math.random01()]},SpiderGL.Math.Vec2.random11=function(){return[SpiderGL.Math.random11(),SpiderGL.Math.random11()]},SpiderGL.Math.Vec2.randomRange=function(e,t){return[SpiderGL.Math.randomRange(e[0],t[0]),SpiderGL.Math.randomRange(e[1],t[1])]},SpiderGL.Math.Vec2.round=function(e){return[SpiderGL.Math.round(e[0]),SpiderGL.Math.round(e[1])]},SpiderGL.Math.Vec2.sin=function(e){return[SpiderGL.Math.sin(e[0]),SpiderGL.Math.sin(e[1])]},SpiderGL.Math.Vec2.sqrt=function(e){return[SpiderGL.Math.sqrt(e[0]),SpiderGL.Math.sqrt(e[1])]},SpiderGL.Math.Vec2.tan=function(e){return[SpiderGL.Math.tan(e[0]),SpiderGL.Math.tan(e[1])]},SpiderGL.Math.Vec2.copy$=function(e,t){return e[0]=t[0],e[1]=t[1],e},SpiderGL.Math.Vec2.neg$=function(e){return e[0]=-e[0],e[1]=-e[1],e},SpiderGL.Math.Vec2.add$=function(e,t){return e[0]+=t[0],e[1]+=t[1],e},SpiderGL.Math.Vec2.adds$=function(e,t){return e[0]+=t,e[1]+=t,e},SpiderGL.Math.Vec2.sub$=function(e,t){return e[0]-=t[0],e[1]-=t[1],e},SpiderGL.Math.Vec2.subs$=function(e,t){return e[0]-=t,e[1]-=t,e},SpiderGL.Math.Vec2.ssub$=function(e,t){return t[0]=e-t[0],t[1]=e-t[1],t},SpiderGL.Math.Vec2.mul$=function(e,t){return e[0]*=t[0],e[1]*=t[1],e},SpiderGL.Math.Vec2.muls$=function(e,t){return e[0]*=t,e[1]*=t,e},SpiderGL.Math.Vec2.div$=function(e,t){return e[0]/=t[0],e[1]/=t[1],e},SpiderGL.Math.Vec2.divs$=function(e,t){return e[0]/=t,e[1]/=t,e},SpiderGL.Math.Vec2.sdiv$=function(e,t){return e[0]=t/e[0],e[1]=t/e[1],e},SpiderGL.Math.Vec2.perp$=function(e){var t=e[0]
return e[0]=e[1],e[1]=-t,e},SpiderGL.Math.Vec2.normalize$=function(e){var t=1/SpiderGL.Math.Vec2.length(e)
return SpiderGL.Math.Vec2.muls$(e,t)},SpiderGL.Math.Vec3={},SpiderGL.Math.Vec3.dup=function(e){return e.slice(0,3)},SpiderGL.Math.Vec3.scalar=function(e){return[e,e,e]},SpiderGL.Math.Vec3.zero=function(){return[0,0,0]},SpiderGL.Math.Vec3.one=function(){return[1,1,1]},SpiderGL.Math.Vec3.maxNumber=function(){return[SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER]},SpiderGL.Math.Vec3.minNumber=function(){return[SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER]},SpiderGL.Math.Vec3.to2=function(e){return[e[0],e[1]]},SpiderGL.Math.Vec3.to4=function(e,t){return[e[0],e[1],e[2],void 0!=t?t:1]},SpiderGL.Math.Vec3.neg=function(e){return[-e[0],-e[1],-e[2]]},SpiderGL.Math.Vec3.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},SpiderGL.Math.Vec3.adds=function(e,t){return[e[0]+t,e[1]+t,e[2]+t]},SpiderGL.Math.Vec3.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},SpiderGL.Math.Vec3.subs=function(e,t){return[e[0]-t,e[1]-t,e[2]-t]},SpiderGL.Math.Vec3.ssub=function(e,t){return[e-t[0],e-t[1],e-t[2]]},SpiderGL.Math.Vec3.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},SpiderGL.Math.Vec3.muls=function(e,t){return[e[0]*t,e[1]*t,e[2]*t]},SpiderGL.Math.Vec3.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2]]},SpiderGL.Math.Vec3.divs=function(e,t){return[e[0]/t,e[1]/t,e[2]/t]},SpiderGL.Math.Vec3.sdiv=function(e,t){return[e/t[0],e/t[1],e/t[2]]},SpiderGL.Math.Vec3.rcp=function(e){return[1/e[0],1/e[1],1/e[2]]},SpiderGL.Math.Vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},SpiderGL.Math.Vec3.cross=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},SpiderGL.Math.Vec3.sqLength=function(e){return SpiderGL.Math.Vec3.dot(e,e)},SpiderGL.Math.Vec3.length=function(e){return SpiderGL.Math.sqrt(SpiderGL.Math.Vec3.sqLength(e))},SpiderGL.Math.Vec3.normalize=function(e){var t=1/SpiderGL.Math.Vec3.length(e)
return SpiderGL.Math.Vec3.muls(e,t)},SpiderGL.Math.Vec3.abs=function(e){return[SpiderGL.Math.abs(e[0]),SpiderGL.Math.abs(e[1]),SpiderGL.Math.abs(e[2])]},SpiderGL.Math.Vec3.acos=function(e){return[SpiderGL.Math.acos(e[0]),SpiderGL.Math.acos(e[1]),SpiderGL.Math.acos(e[2])]},SpiderGL.Math.Vec3.asin=function(e){return[SpiderGL.Math.asin(e[0]),SpiderGL.Math.asin(e[1]),SpiderGL.Math.asin(e[2])]},SpiderGL.Math.Vec3.atan=function(e){return[SpiderGL.Math.atan(e[0]),SpiderGL.Math.atan(e[1]),SpiderGL.Math.atan(e[2])]},SpiderGL.Math.Vec3.atan2=function(e,t){return[SpiderGL.Math.atan2(e[0],t[0]),SpiderGL.Math.atan2(e[1],t[1]),SpiderGL.Math.atan2(e[2],t[2])]},SpiderGL.Math.Vec3.ceil=function(e){return[SpiderGL.Math.ceil(e[0]),SpiderGL.Math.ceil(e[1]),SpiderGL.Math.ceil(e[2])]},SpiderGL.Math.Vec3.clamp=function(e,t,i){return[SpiderGL.Math.clamp(e[0],t[0],i[0]),SpiderGL.Math.clamp(e[1],t[1],i[1]),SpiderGL.Math.clamp(e[2],t[2],i[2])]},SpiderGL.Math.Vec3.cos=function(e){return[SpiderGL.Math.cos(e[0]),SpiderGL.Math.cos(e[1]),SpiderGL.Math.cos(e[2])]},SpiderGL.Math.Vec3.degToRad=function(e){return[SpiderGL.Math.degToRad(e[0]),SpiderGL.Math.degToRad(e[1]),SpiderGL.Math.degToRad(e[2])]},SpiderGL.Math.Vec3.exp=function(e){return[SpiderGL.Math.exp(e[0]),SpiderGL.Math.exp(e[1]),SpiderGL.Math.exp(e[2])]},SpiderGL.Math.Vec3.floor=function(e){return[SpiderGL.Math.floor(e[0]),SpiderGL.Math.floor(e[1]),SpiderGL.Math.floor(e[2])]},SpiderGL.Math.Vec3.lerp=function(e,t,i){return[SpiderGL.Math.lerp(e[0],t[0],i),SpiderGL.Math.lerp(e[1],t[1],i),SpiderGL.Math.lerp(e[2],t[2],i)]},SpiderGL.Math.Vec3.ln=function(e){return[SpiderGL.Math.ln(e[0]),SpiderGL.Math.ln(e[1]),SpiderGL.Math.ln(e[2])]},SpiderGL.Math.Vec3.log=function(e){return[SpiderGL.Math.log(e[0]),SpiderGL.Math.log(e[1]),SpiderGL.Math.log(e[2])]},SpiderGL.Math.Vec3.log2=function(e){return[SpiderGL.Math.log2(e[0]),SpiderGL.Math.log2(e[1]),SpiderGL.Math.log2(e[2])]},SpiderGL.Math.Vec3.log10=function(e){return[SpiderGL.Math.log10(e[0]),SpiderGL.Math.log10(e[1]),SpiderGL.Math.log10(e[2])]},SpiderGL.Math.Vec3.max=function(e,t){return[SpiderGL.Math.max(e[0],t[0]),SpiderGL.Math.max(e[1],t[1]),SpiderGL.Math.max(e[2],t[2])]},SpiderGL.Math.Vec3.min=function(e,t){return[SpiderGL.Math.min(e[0],t[0]),SpiderGL.Math.min(e[1],t[1]),SpiderGL.Math.min(e[2],t[2])]},SpiderGL.Math.Vec3.pow=function(e,t){return[SpiderGL.Math.pow(e[0],t[0]),SpiderGL.Math.pow(e[1],t[1]),SpiderGL.Math.pow(e[2],t[2])]},SpiderGL.Math.Vec3.radToDeg=function(e){return[SpiderGL.Math.radToDeg(e[0]),SpiderGL.Math.radToDeg(e[1]),SpiderGL.Math.radToDeg(e[2])]},SpiderGL.Math.Vec3.random=function(){return[SpiderGL.Math.random(),SpiderGL.Math.random(),SpiderGL.Math.random()]},SpiderGL.Math.Vec3.random01=function(){return[SpiderGL.Math.random01(),SpiderGL.Math.random01(),SpiderGL.Math.random01()]},SpiderGL.Math.Vec3.random11=function(){return[SpiderGL.Math.random11(),SpiderGL.Math.random11(),SpiderGL.Math.random11()]},SpiderGL.Math.Vec3.randomRange=function(e,t){return[SpiderGL.Math.randomRange(e[0],t[0]),SpiderGL.Math.randomRange(e[1],t[1]),SpiderGL.Math.randomRange(e[2],t[2])]},SpiderGL.Math.Vec3.round=function(e){return[SpiderGL.Math.round(e[0]),SpiderGL.Math.round(e[1]),SpiderGL.Math.round(e[2])]},SpiderGL.Math.Vec3.sin=function(e){return[SpiderGL.Math.sin(e[0]),SpiderGL.Math.sin(e[1]),SpiderGL.Math.sin(e[2])]},SpiderGL.Math.Vec3.sqrt=function(e){return[SpiderGL.Math.sqrt(e[0]),SpiderGL.Math.sqrt(e[1]),SpiderGL.Math.sqrt(e[2])]},SpiderGL.Math.Vec3.tan=function(e){return[SpiderGL.Math.tan(e[0]),SpiderGL.Math.tan(e[1]),SpiderGL.Math.tan(e[2])]},SpiderGL.Math.Vec3.copy$=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},SpiderGL.Math.Vec3.neg$=function(e){return e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e},SpiderGL.Math.Vec3.add$=function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e},SpiderGL.Math.Vec3.adds$=function(e,t){return e[0]+=t,e[1]+=t,e[2]+=t,e},SpiderGL.Math.Vec3.sub$=function(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e},SpiderGL.Math.Vec3.subs$=function(e,t){return e[0]-=t,e[1]-=t,e[2]-=t,e},SpiderGL.Math.Vec3.ssub$=function(e,t){return t[0]=e-t[0],t[1]=e-t[1],t[2]=e-t[2],t},SpiderGL.Math.Vec3.mul$=function(e,t){return e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e},SpiderGL.Math.Vec3.muls$=function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e},SpiderGL.Math.Vec3.div$=function(e,t){return e[0]/=t[0],e[1]/=t[1],e[2]/=t[2],e},SpiderGL.Math.Vec3.divs$=function(e,t){return e[0]/=t,e[1]/=t,e[2]/=t,e},SpiderGL.Math.Vec3.sdiv$=function(e,t){return e[0]=t/e[0],e[1]=t/e[1],e[2]=t/e[2],e},SpiderGL.Math.Vec3.normalize$=function(e){var t=1/SpiderGL.Math.Vec3.length(e)
return SpiderGL.Math.Vec3.muls$(e,t)},SpiderGL.Math.Vec4={},SpiderGL.Math.Vec4.dup=function(e){return e.slice(0,4)},SpiderGL.Math.Vec4.scalar=function(e){return[e,e,e,e]},SpiderGL.Math.Vec4.zero=function(){return[0,0,0,0]},SpiderGL.Math.Vec4.one=function(){return[1,1,1,1]},SpiderGL.Math.Vec4.maxNumber=function(){return[SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER]},SpiderGL.Math.Vec4.minNumber=function(){return[SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER]},SpiderGL.Math.Vec4.to2=function(e){return[e[0],e[1]]},SpiderGL.Math.Vec4.to3=function(e){return[e[0],e[1],e[2]]},SpiderGL.Math.Vec4.neg=function(e){return[-e[0],-e[1],-e[2],-e[3]]},SpiderGL.Math.Vec4.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3]]},SpiderGL.Math.Vec4.adds=function(e,t){return[e[0]+t,e[1]+t,e[2]+t,e[3]+t]},SpiderGL.Math.Vec4.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3]]},SpiderGL.Math.Vec4.subs=function(e,t){return[e[0]-t,e[1]-t,e[2]-t,e[3]-t]},SpiderGL.Math.Vec4.ssub=function(e,t){return[e-t[0],e-t[1],e-t[2],e-t[3]]},SpiderGL.Math.Vec4.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3]]},SpiderGL.Math.Vec4.muls=function(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]},SpiderGL.Math.Vec4.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3]]},SpiderGL.Math.Vec4.divs=function(e,t){return[e[0]/t,e[1]/t,e[2]/t,e[3]/t]},SpiderGL.Math.Vec4.sdiv=function(e,t){return[e/t[0],e/t[1],e/t[2],e/t[3]]},SpiderGL.Math.Vec4.rcp=function(e){return[1/e[0],1/e[1],1/e[2],1/e[3]]},SpiderGL.Math.Vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},SpiderGL.Math.Vec4.cross=function(e,t,i){var r=t[0]*i[1]-t[1]*i[0],n=t[0]*i[2]-t[2]*i[0],a=t[0]*i[3]-t[3]*i[0],s=t[1]*i[2]-t[2]*i[1],o=t[1]*i[3]-t[3]*i[1],u=t[2]*i[3]-t[3]*i[2]
return[e[1]*u-e[2]*o+e[3]*s,e[0]*u+e[2]*a-e[3]*n,e[0]*o-e[1]*a+e[3]*r,e[0]*s+e[1]*n-e[2]*r]},SpiderGL.Math.Vec4.sqLength=function(e){return SpiderGL.Math.Vec4.dot(e,e)},SpiderGL.Math.Vec4.length=function(e){return SpiderGL.Math.sqrt(SpiderGL.Math.Vec4.sqLength(e))},SpiderGL.Math.Vec4.normalize=function(e){var t=1/SpiderGL.Math.Vec4.length(e)
return SpiderGL.Math.Vec4.muls(e,t)},SpiderGL.Math.Vec4.project=function(e){var t=1/e[3]
return[e[0]*t,e[1]*t,e[2]*t,1]},SpiderGL.Math.Vec4.abs=function(e){return[SpiderGL.Math.abs(e[0]),SpiderGL.Math.abs(e[1]),SpiderGL.Math.abs(e[2]),SpiderGL.Math.abs(e[3])]},SpiderGL.Math.Vec4.acos=function(e){return[SpiderGL.Math.acos(e[0]),SpiderGL.Math.acos(e[1]),SpiderGL.Math.acos(e[2]),SpiderGL.Math.acos(e[3])]},SpiderGL.Math.Vec4.asin=function(e){return[SpiderGL.Math.asin(e[0]),SpiderGL.Math.asin(e[1]),SpiderGL.Math.asin(e[2]),SpiderGL.Math.asin(e[3])]},SpiderGL.Math.Vec4.atan=function(e){return[SpiderGL.Math.atan(e[0]),SpiderGL.Math.atan(e[1]),SpiderGL.Math.atan(e[2]),SpiderGL.Math.atan(e[3])]},SpiderGL.Math.Vec4.atan2=function(e,t){return[SpiderGL.Math.atan2(e[0],t[0]),SpiderGL.Math.atan2(e[1],t[1]),SpiderGL.Math.atan2(e[2],t[2]),SpiderGL.Math.atan2(e[3],t[3])]},SpiderGL.Math.Vec4.ceil=function(e){return[SpiderGL.Math.ceil(e[0]),SpiderGL.Math.ceil(e[1]),SpiderGL.Math.ceil(e[2]),SpiderGL.Math.ceil(e[3])]},SpiderGL.Math.Vec4.clamp=function(e,t,i){return[SpiderGL.Math.clamp(e[0],t[0],i[0]),SpiderGL.Math.clamp(e[1],t[1],i[1]),SpiderGL.Math.clamp(e[2],t[2],i[2]),SpiderGL.Math.clamp(e[3],t[3],i[3])]},SpiderGL.Math.Vec4.cos=function(e){return[SpiderGL.Math.cos(e[0]),SpiderGL.Math.cos(e[1]),SpiderGL.Math.cos(e[2]),SpiderGL.Math.cos(e[3])]},SpiderGL.Math.Vec4.degToRad=function(e){return[SpiderGL.Math.degToRad(e[0]),SpiderGL.Math.degToRad(e[1]),SpiderGL.Math.degToRad(e[2]),SpiderGL.Math.degToRad(e[3])]},SpiderGL.Math.Vec4.exp=function(e){return[SpiderGL.Math.exp(e[0]),SpiderGL.Math.exp(e[1]),SpiderGL.Math.exp(e[2]),SpiderGL.Math.exp(e[3])]},SpiderGL.Math.Vec4.floor=function(e){return[SpiderGL.Math.floor(e[0]),SpiderGL.Math.floor(e[1]),SpiderGL.Math.floor(e[2]),SpiderGL.Math.floor(e[3])]},SpiderGL.Math.Vec4.lerp=function(e,t,i){return[SpiderGL.Math.lerp(e[0],t[0],i),SpiderGL.Math.lerp(e[1],t[1],i),SpiderGL.Math.lerp(e[2],t[2],i),SpiderGL.Math.lerp(e[3],t[3],i)]},SpiderGL.Math.Vec4.ln=function(e){return[SpiderGL.Math.ln(e[0]),SpiderGL.Math.ln(e[1]),SpiderGL.Math.ln(e[2]),SpiderGL.Math.ln(e[3])]},SpiderGL.Math.Vec4.log=function(e){return[SpiderGL.Math.log(e[0]),SpiderGL.Math.log(e[1]),SpiderGL.Math.log(e[2]),SpiderGL.Math.log(e[3])]},SpiderGL.Math.Vec4.log2=function(e){return[SpiderGL.Math.log2(e[0]),SpiderGL.Math.log2(e[1]),SpiderGL.Math.log2(e[2]),SpiderGL.Math.log2(e[3])]},SpiderGL.Math.Vec4.log10=function(e){return[SpiderGL.Math.log10(e[0]),SpiderGL.Math.log10(e[1]),SpiderGL.Math.log10(e[2]),SpiderGL.Math.log10(e[3])]},SpiderGL.Math.Vec4.max=function(e,t){return[SpiderGL.Math.max(e[0],t[0]),SpiderGL.Math.max(e[1],t[1]),SpiderGL.Math.max(e[2],t[2]),SpiderGL.Math.max(e[3],t[3])]},SpiderGL.Math.Vec4.min=function(e,t){return[SpiderGL.Math.min(e[0],t[0]),SpiderGL.Math.min(e[1],t[1]),SpiderGL.Math.min(e[2],t[2]),SpiderGL.Math.min(e[3],t[3])]},SpiderGL.Math.Vec4.pow=function(e,t){return[SpiderGL.Math.pow(e[0],t[0]),SpiderGL.Math.pow(e[1],t[1]),SpiderGL.Math.pow(e[2],t[2]),SpiderGL.Math.pow(e[3],t[3])]},SpiderGL.Math.Vec4.radToDeg=function(e){return[SpiderGL.Math.radToDeg(e[0]),SpiderGL.Math.radToDeg(e[1]),SpiderGL.Math.radToDeg(e[2]),SpiderGL.Math.radToDeg(e[3])]},SpiderGL.Math.Vec4.random=function(){return[SpiderGL.Math.random(),SpiderGL.Math.random(),SpiderGL.Math.random(),SpiderGL.Math.random()]},SpiderGL.Math.Vec4.random01=function(){return[SpiderGL.Math.random01(),SpiderGL.Math.random01(),SpiderGL.Math.random01(),SpiderGL.Math.random01()]},SpiderGL.Math.Vec4.random11=function(){return[SpiderGL.Math.random11(),SpiderGL.Math.random11(),SpiderGL.Math.random11(),SpiderGL.Math.random11()]},SpiderGL.Math.Vec4.randomRange=function(e,t){return[SpiderGL.Math.randomRange(e[0],t[0]),SpiderGL.Math.randomRange(e[1],t[1]),SpiderGL.Math.randomRange(e[2],t[2]),SpiderGL.Math.randomRange(e[3],t[3])]},SpiderGL.Math.Vec4.round=function(e){return[SpiderGL.Math.round(e[0]),SpiderGL.Math.round(e[1]),SpiderGL.Math.round(e[2]),SpiderGL.Math.round(e[3])]},SpiderGL.Math.Vec4.sin=function(e){return[SpiderGL.Math.sin(e[0]),SpiderGL.Math.sin(e[1]),SpiderGL.Math.sin(e[2]),SpiderGL.Math.sin(e[3])]},SpiderGL.Math.Vec4.sqrt=function(e){return[SpiderGL.Math.sqrt(e[0]),SpiderGL.Math.sqrt(e[1]),SpiderGL.Math.sqrt(e[2]),SpiderGL.Math.sqrt(e[3])]},SpiderGL.Math.Vec4.tan=function(e){return[SpiderGL.Math.tan(e[0]),SpiderGL.Math.tan(e[1]),SpiderGL.Math.tan(e[2]),SpiderGL.Math.tan(e[3])]},SpiderGL.Math.Vec4.copy$=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},SpiderGL.Math.Vec4.neg$=function(e){return e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e[3]=-e[3],e},SpiderGL.Math.Vec4.add$=function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e},SpiderGL.Math.Vec4.adds$=function(e,t){return e[0]+=t,e[1]+=t,e[2]+=t,e[3]+=t,e},SpiderGL.Math.Vec4.sub$=function(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e[3]-=t[3],e},SpiderGL.Math.Vec4.subs$=function(e,t){return e[0]-=t,e[1]-=t,e[2]-=t,e[3]-=t,e},SpiderGL.Math.Vec4.ssub$=function(e,t){return t[0]=e-t[0],t[1]=e-t[1],t[2]=e-t[2],t[3]=e-t[3],t},SpiderGL.Math.Vec4.mul$=function(e,t){return e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e[3]*=t[3],e},SpiderGL.Math.Vec4.muls$=function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e},SpiderGL.Math.Vec4.div$=function(e,t){return e[0]/=t[0],e[1]/=t[1],e[2]/=t[2],e[3]/=t[3],e},SpiderGL.Math.Vec4.divs$=function(e,t){return e[0]/=t,e[1]/=t,e[2]/=t,e[3]/=t,e},SpiderGL.Math.Vec4.sdiv$=function(e,t){return e[0]=t/e[0],e[1]=t/e[1],e[2]=t/e[2],e[3]=t/e[3],e},SpiderGL.Math.Vec4.normalize$=function(e){var t=1/SpiderGL.Math.Vec4.length(e)
return SpiderGL.Math.Vec4.muls$(e,t)},SpiderGL.Math.Mat3={},SpiderGL.Math.Mat3.dup=function(e){return e.slice(0,9)},SpiderGL.Math.Mat3.scalar=function(e){return[e,e,e,e,e,e,e,e,e]},SpiderGL.Math.Mat3.zero=function(){return[0,0,0,0,0,0,0,0,0]},SpiderGL.Math.Mat3.one=function(){return[1,1,1,1,1,1,1,1,1]},SpiderGL.Math.Mat3.diag=function(e){return[e[0],0,0,0,e[0],0,0,0,e[0]]},SpiderGL.Math.Mat3.identity=function(){return[1,0,0,0,1,0,0,0,1]},SpiderGL.Math.Mat3.to44=function(e){return[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]},SpiderGL.Math.Mat3.mul2=function(e,t,i){return i=void 0==i?0:i,[e[0]*t[0]+e[3]*t[1]+e[6]*i,e[1]*t[0]+e[4]*t[1]+e[7]*i]},SpiderGL.Math.Mat3.mul3=function(e,t){return[e[0]*t[0]+e[3]*t[1]+e[6]*t[2],e[1]*t[0]+e[4]*t[1]+e[7]*t[2],e[2]*t[0]+e[5]*t[1]+e[8]*t[2]]},SpiderGL.Math.Mat3.transpose=function(e){return[e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]]},SpiderGL.Math.Mat4={},SpiderGL.Math.Mat4.dup=function(e){return e.slice(0,16)},SpiderGL.Math.Mat4.scalar=function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},SpiderGL.Math.Mat4.zero=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},SpiderGL.Math.Mat4.one=function(){return[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},SpiderGL.Math.Mat4.diag=function(e){return[e[0],0,0,0,0,e[0],0,0,0,0,e[0],0,0,0,0,e[0]]},SpiderGL.Math.Mat4.identity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},SpiderGL.Math.Mat4.to33=function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},SpiderGL.Math.Mat4.elem=function(e,t,i){return e[t+4*i]},SpiderGL.Math.Mat4.elem$=function(e,t,i,r){e[t+4*i]=r},SpiderGL.Math.Mat4.row=function(e,t){return[e[t+0],e[t+4],e[t+8],e[t+12]]},SpiderGL.Math.Mat4.row$=function(e,t,i){e[t+0]=i[0],e[t+4]=i[1],e[t+8]=i[2],e[t+12]=i[3]},SpiderGL.Math.Mat4.col=function(e,t){var i=4*t
return[e[i+0],e[i+1],e[i+2],e[i+3]]},SpiderGL.Math.Mat4.col$=function(e,t,i){var r=4*t
e[r+0]=i[0],e[r+1]=i[1],e[r+2]=i[2],e[r+3]=i[3]},SpiderGL.Math.Mat4.isIdentity=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},SpiderGL.Math.Mat4.neg=function(e){return[-e[0],-e[1],-e[2],-e[3],-e[4],-e[5],-e[6],-e[7],-e[8],-e[9],-e[10],-e[11],-e[12],-e[13],-e[14],-e[15]]},SpiderGL.Math.Mat4.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7],e[8]+t[8],e[9]+t[9],e[10]+t[10],e[11]+t[11],e[12]+t[12],e[13]+t[13],e[14]+t[14],e[15]+t[15]]},SpiderGL.Math.Mat4.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7],e[8]-t[8],e[9]-t[9],e[10]-t[10],e[11]-t[11],e[12]-t[12],e[13]-t[13],e[14]-t[14],e[15]-t[15]]},SpiderGL.Math.Mat4.mul=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],u=e[6],c=e[7],l=e[8],h=e[9],d=e[10],p=e[11],f=e[12],_=e[13],g=e[14],m=e[15],S=t[0],L=t[1],b=t[2],v=t[3],x=t[4],T=t[5],G=t[6],M=t[7],y=t[8],E=t[9],A=t[10],P=t[11],N=t[12],C=t[13],D=t[14],R=t[15]
return[i*S+s*L+l*b+f*v,r*S+o*L+h*b+_*v,n*S+u*L+d*b+g*v,a*S+c*L+p*b+m*v,i*x+s*T+l*G+f*M,r*x+o*T+h*G+_*M,n*x+u*T+d*G+g*M,a*x+c*T+p*G+m*M,i*y+s*E+l*A+f*P,r*y+o*E+h*A+_*P,n*y+u*E+d*A+g*P,a*y+c*E+p*A+m*P,i*N+s*C+l*D+f*R,r*N+o*C+h*D+_*R,n*N+u*C+d*D+g*R,a*N+c*C+p*D+m*R]},SpiderGL.Math.Mat4.muls=function(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t,e[8]*t,e[9]*t,e[10]*t,e[11]*t,e[12]*t,e[13]*t,e[14]*t,e[15]*t]},SpiderGL.Math.Mat4.mul3=function(e,t,i){return i=void 0==i?1:i,[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*i,e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*i,e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*i]},SpiderGL.Math.Mat4.mul4=function(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3]]},SpiderGL.Math.Mat4.rcp=function(e){return[1/e[0],1/e[1],1/e[2],1/e[3],1/e[4],1/e[5],1/e[6],1/e[7],1/e[8],1/e[9],1/e[10],1/e[11],1/e[12],1/e[13],1/e[14],1/e[15]]},SpiderGL.Math.Mat4.compMul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3],e[4]*t[4],e[5]*t[5],e[6]*t[6],e[7]*t[7],e[8]*t[8],e[9]*t[9],e[10]*t[10],e[11]*t[11],e[12]*t[12],e[13]*t[13],e[14]*t[14],e[15]*t[15]]},SpiderGL.Math.Mat4.compDiv=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3],e[4]/t[4],e[5]/t[5],e[6]/t[6],e[7]/t[7],e[8]/t[8],e[9]/t[9],e[10]/t[10],e[11]/t[11],e[12]/t[12],e[13]/t[13],e[14]/t[14],e[15]/t[15]]},SpiderGL.Math.Mat4.transpose=function(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]},SpiderGL.Math.Mat4.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],u=e[7],c=e[8],l=e[9],h=e[10],d=e[11],p=e[12],f=e[13],_=e[14],g=e[15]
return p*l*o*n-c*f*o*n-p*s*h*n+a*f*h*n+c*s*_*n-a*l*_*n-p*l*r*u+c*f*r*u+p*i*h*u-t*f*h*u-c*i*_*u+t*l*_*u+p*s*r*d-a*f*r*d-p*i*o*d+t*f*o*d+a*i*_*d-t*s*_*d-c*s*r*g+a*l*r*g+c*i*o*g-t*l*o*g-a*i*h*g+t*s*h*g},SpiderGL.Math.Mat4.inverse=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],u=e[7],c=e[8],l=e[9],h=e[10],d=e[11],p=e[12],f=e[13],_=e[14],g=e[15],m=1/(p*l*o*n-c*f*o*n-p*s*h*n+a*f*h*n+c*s*_*n-a*l*_*n-p*l*r*u+c*f*r*u+p*i*h*u-t*f*h*u-c*i*_*u+t*l*_*u+p*s*r*d-a*f*r*d-p*i*o*d+t*f*o*d+a*i*_*d-t*s*_*d-c*s*r*g+a*l*r*g+c*i*o*g-t*l*o*g-a*i*h*g+t*s*h*g)
return[m*(l*_*u-f*h*u+f*o*d-s*_*d-l*o*g+s*h*g),m*(f*h*n-l*_*n-f*r*d+i*_*d+l*r*g-i*h*g),m*(s*_*n-f*o*n+f*r*u-i*_*u-s*r*g+i*o*g),m*(l*o*n-s*h*n-l*r*u+i*h*u+s*r*d-i*o*d),m*(p*h*u-c*_*u-p*o*d+a*_*d+c*o*g-a*h*g),m*(c*_*n-p*h*n+p*r*d-t*_*d-c*r*g+t*h*g),m*(p*o*n-a*_*n-p*r*u+t*_*u+a*r*g-t*o*g),m*(a*h*n-c*o*n+c*r*u-t*h*u-a*r*d+t*o*d),m*(c*f*u-p*l*u+p*s*d-a*f*d-c*s*g+a*l*g),m*(p*l*n-c*f*n-p*i*d+t*f*d+c*i*g-t*l*g),m*(a*f*n-p*s*n+p*i*u-t*f*u-a*i*g+t*s*g),m*(c*s*n-a*l*n-c*i*u+t*l*u+a*i*d-t*s*d),m*(p*l*o-c*f*o-p*s*h+a*f*h+c*s*_-a*l*_),m*(c*f*r-p*l*r+p*i*h-t*f*h-c*i*_+t*l*_),m*(p*s*r-a*f*r-p*i*o+t*f*o+a*i*_-t*s*_),m*(a*l*r-c*s*r+c*i*o-t*l*o-a*i*h+t*s*h)]},SpiderGL.Math.Mat4.inverseTranspose33=function(e){var t=e[0],i=e[1],r=e[2],n=e[4],a=e[5],s=e[6],o=e[8],u=e[9],c=e[10],l=1/(t*(c*a-s*u)-i*(c*n-s*o)+r*(u*n-a*o))
return[l*(c*a-s*u),l*(s*o-c*n),l*(u*n-a*o),l*(r*u-c*i),l*(c*t-r*o),l*(i*o-u*t),l*(s*i-r*a),l*(r*n-s*t),l*(a*t-i*n)]},SpiderGL.Math.Mat4.trace=function(e){return e[0]+e[5]+e[10]+e[15]},SpiderGL.Math.Mat4.translation=function(e){return[1,0,0,0,0,1,0,0,0,0,1,0,e[0],e[1],e[2],1]},SpiderGL.Math.Mat4.rotationAngleAxis=function(e,t){var i,r,n,a,s,o,u,c,l,h=SpiderGL.Math.Vec3.normalize(t),d=SpiderGL.Math.sin(e),p=SpiderGL.Math.cos(e),f=1-p,_=h[0],g=h[1],m=h[2]
return i=_*_,r=g*g,n=m*m,a=_*g,s=g*m,o=m*_,u=_*d,c=g*d,l=m*d,[f*i+p,f*a+l,f*o-c,0,f*a-l,f*r+p,f*s+u,0,f*o+c,f*s-u,f*n+p,0,0,0,0,1]},SpiderGL.Math.Mat4.scaling=function(e){return[e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,1]},SpiderGL.Math.Mat4.lookAt=function(e,t,i){var r=SpiderGL.Math.Vec3.normalize(SpiderGL.Math.Vec3.sub(t,e)),n=SpiderGL.Math.Vec3.normalize(i),a=SpiderGL.Math.Vec3.normalize(SpiderGL.Math.Vec3.cross(r,n))
n=SpiderGL.Math.Vec3.cross(a,r)
var s=[a[0],n[0],-r[0],0,a[1],n[1],-r[1],0,a[2],n[2],-r[2],0,0,0,0,1]
return SpiderGL.Math.Mat4.translate$(s,SpiderGL.Math.Vec3.neg(e))},SpiderGL.Math.Mat4.ortho=function(e,t){var i=SpiderGL.Math.Vec3.add(t,e),r=SpiderGL.Math.Vec3.sub(t,e)
return[2/r[0],0,0,0,0,2/r[1],0,0,0,0,-2/r[2],0,-i[0]/r[0],-i[1]/r[1],-i[2]/r[2],1]},SpiderGL.Math.Mat4.frustum=function(e,t){var i=SpiderGL.Math.Vec3.add(t,e),r=SpiderGL.Math.Vec3.sub(t,e),n=2*e[2]
return[n/r[0],0,0,0,0,n/r[1],0,0,i[0]/r[0],i[1]/r[1],-i[2]/r[2],-1,0,0,-n*t[2]/r[2],0]},SpiderGL.Math.Mat4.perspective=function(e,t,i,r){var n=i*SpiderGL.Math.tan(e/2),a=n*t
return SpiderGL.Math.Mat4.frustum([-a,-n,i],[a,n,r])},SpiderGL.Math.Mat4.copy$=function(e,t){for(var i=0;16>i;++i)e[i]=t[i]
return e},SpiderGL.Math.Mat4.identity$=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},SpiderGL.Math.Mat4.neg$=function(e){for(var t=0;16>t;++t)e[t]=-e[t]
return e},SpiderGL.Math.Mat4.add$=function(e,t){for(var i=0;16>i;++i)e[i]+=t[i]
return e},SpiderGL.Math.Mat4.sub$=function(e,t){for(var i=0;16>i;++i)e[i]-=t[i]
return e},SpiderGL.Math.Mat4.mul$=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],u=e[6],c=e[7],l=e[8],h=e[9],d=e[10],p=e[11],f=e[12],_=e[13],g=e[14],m=e[15],S=t[0],L=t[1],b=t[2],v=t[3],x=t[4],T=t[5],G=t[6],M=t[7],y=t[8],E=t[9],A=t[10],P=t[11],N=t[12],C=t[13],D=t[14],R=t[15]
return e[0]=i*S+s*L+l*b+f*v,e[1]=r*S+o*L+h*b+_*v,e[2]=n*S+u*L+d*b+g*v,e[3]=a*S+c*L+p*b+m*v,e[4]=i*x+s*T+l*G+f*M,e[5]=r*x+o*T+h*G+_*M,e[6]=n*x+u*T+d*G+g*M,e[7]=a*x+c*T+p*G+m*M,e[8]=i*y+s*E+l*A+f*P,e[9]=r*y+o*E+h*A+_*P,e[10]=n*y+u*E+d*A+g*P,e[11]=a*y+c*E+p*A+m*P,e[12]=i*N+s*C+l*D+f*R,e[13]=r*N+o*C+h*D+_*R,e[14]=n*N+u*C+d*D+g*R,e[15]=a*N+c*C+p*D+m*R,e},SpiderGL.Math.Mat4.muls$=function(e,t){for(var i=0;16>i;++i)e[i]*=t
return e},SpiderGL.Math.Mat4.compMul$=function(e,t){for(var i=0;16>i;++i)e[i]*=t[i]
return e},SpiderGL.Math.Mat4.compDiv$=function(e,t){for(var i=0;16>i;++i)e[i]/=t[i]
return e},SpiderGL.Math.Mat4.transpose$=function(e){var t
return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,e},SpiderGL.Math.Mat4.invert$=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],u=e[7],c=e[8],l=e[9],h=e[10],d=e[11],p=e[12],f=e[13],_=e[14],g=e[15],m=1/(p*l*o*n-c*f*o*n-p*s*h*n+a*f*h*n+c*s*_*n-a*l*_*n-p*l*r*u+c*f*r*u+p*i*h*u-t*f*h*u-c*i*_*u+t*l*_*u+p*s*r*d-a*f*r*d-p*i*o*d+t*f*o*d+a*i*_*d-t*s*_*d-c*s*r*g+a*l*r*g+c*i*o*g-t*l*o*g-a*i*h*g+t*s*h*g)
return e[0]=m*(l*_*u-f*h*u+f*o*d-s*_*d-l*o*g+s*h*g),e[1]=m*(f*h*n-l*_*n-f*r*d+i*_*d+l*r*g-i*h*g),e[2]=m*(s*_*n-f*o*n+f*r*u-i*_*u-s*r*g+i*o*g),e[3]=m*(l*o*n-s*h*n-l*r*u+i*h*u+s*r*d-i*o*d),e[4]=m*(p*h*u-c*_*u-p*o*d+a*_*d+c*o*g-a*h*g),e[5]=m*(c*_*n-p*h*n+p*r*d-t*_*d-c*r*g+t*h*g),e[6]=m*(p*o*n-a*_*n-p*r*u+t*_*u+a*r*g-t*o*g),e[7]=m*(a*h*n-c*o*n+c*r*u-t*h*u-a*r*d+t*o*d),e[8]=m*(c*f*u-p*l*u+p*s*d-a*f*d-c*s*g+a*l*g),e[9]=m*(p*l*n-c*f*n-p*i*d+t*f*d+c*i*g-t*l*g),e[10]=m*(a*f*n-p*s*n+p*i*u-t*f*u-a*i*g+t*s*g),e[11]=m*(c*s*n-a*l*n-c*i*u+t*l*u+a*i*d-t*s*d),e[12]=m*(p*l*o-c*f*o-p*s*h+a*f*h+c*s*_-a*l*_),e[13]=m*(c*f*r-p*l*r+p*i*h-t*f*h-c*i*_+t*l*_),e[14]=m*(p*s*r-a*f*r-p*i*o+t*f*o+a*i*_-t*s*_),e[15]=m*(a*l*r-c*s*r+c*i*o-t*l*o-a*i*h+t*s*h),e},SpiderGL.Math.Mat4.translate$=function(e,t){var i=t[0],r=t[1],n=t[2]
return e[12]=e[0]*i+e[4]*r+e[8]*n+e[12],e[13]=e[1]*i+e[5]*r+e[9]*n+e[13],e[14]=e[2]*i+e[6]*r+e[10]*n+e[14],e[15]=e[3]*i+e[7]*r+e[11]*n+e[15],e},SpiderGL.Math.Mat4.rotateAngleAxis$=function(e,t,i){var r=SpiderGL.Math.Mat4.rotationAngleAxis(t,i)
return SpiderGL.Math.Mat4.mul$(e,r)},SpiderGL.Math.Mat4.scale$=function(e,t){var i=t[0],r=t[1],n=t[2]
return e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e[4]*=r,e[5]*=r,e[6]*=r,e[7]*=r,e[8]*=n,e[9]*=n,e[10]*=n,e[11]*=n,e},SpiderGL.Math.Quat={},SpiderGL.Math.Quat.dup=function(e){return e.slice(0,4)},SpiderGL.Math.Quat.identity=function(){return[0,0,0,1]},SpiderGL.Math.Quat.inverse=function(e){return[-e[0],-e[1],-e[2],e[3]]},SpiderGL.Math.Quat.mul=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],s=t[0],o=t[1],u=t[2],c=t[3]
return[i*c+a*s+n*o-r*u,r*c+a*o+i*u-n*s,n*c+a*u+r*s-i*o,a*c-i*s-r*o-n*u]},SpiderGL.Math.Quat.muls=function(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]},SpiderGL.Math.Quat.normalize=function(e){var t=1/SpiderGL.Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])
return SpiderGL.Math.Quat.muls(e,t)},SpiderGL.Math.Quat.from33=function(e){var t,i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],u=e[6],c=e[7],l=e[8],h=i+s+l
return h>0?(h+=1,t=.5/SpiderGL.Math.sqrt(h),[(o-c)*t,(u-n)*t,(r-a)*t,h*t]):i>s&&i>l?(h=i-s-l+1,t=.5/SpiderGL.Math.sqrt(h),[h*t,(r+a)*t,(u+n)*t,(o-c)*t]):s>l?(h=-i+s-l+1,t=.5/SpiderGL.Math.sqrt(h),[(r+a)*t,h*t,(o+c)*t,(u-n)*t]):(h=-i-s+l+1,t=.5/SpiderGL.Math.sqrt(h),[(u+n)*t,(o+c)*t,h*t,(r-a)*t])},SpiderGL.Math.Quat.to33=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=t*t,s=t*i,o=t*r,u=t*n,c=i*i,l=i*r,h=i*n,d=r*r,p=r*n
return[1-2*(c+d),2*(s+p),2*(o-h),2*(s-p),1-2*(a+d),2*(l+u),2*(o+h),2*(l-u),1-2*(a+c)]},SpiderGL.Math.Quat.from44=function(e){return SpiderGL.Math.Quat.from33(SpiderGL.Math.Mat4.to33(e))},SpiderGL.Math.Quat.to44=function(e){return SpiderGL.Math.Mat3.to44(SpiderGL.Math.Quat.to33(e))},SpiderGL.Math.Quat.fromAngleAxis=function(e,t){return[0,0,0,1]},SpiderGL.Math.Quat.toAngleAxis=function(e){return[0,0,0,1]},SpiderGL.Math.Quat.fromEulerAngles=function(e,t,i){return[0,0,0,1]},SpiderGL.Math.Quat.toEulerAngles=function(e){return[0,0,0,1]},SpiderGL.Math.Quat.copy$=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},SpiderGL.Math.Quat.identity$=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},SpiderGL.Math.Quat.invert$=function(e){return e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e},SpiderGL.Math.Quat.mul$=function(e){var t=p[0],i=p[1],r=p[2],n=p[3],a=e[0],s=e[1],o=e[2],u=e[3]
return e[0]=t*u+n*a+r*s-i*o,e[1]=i*u+n*s+t*o-r*a,e[2]=r*u+n*o+i*a-t*s,e[3]=n*u-t*a-i*s-r*o,e},SpiderGL.Math.Quat.muls$=function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e},SpiderGL.Math.Quat.normalize$=function(e){var t=1/SpiderGL.Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])
return SpiderGL.Math.Quat.muls$(e,t)},SpiderGL.Math.project=function(e,t,i,r){var n=SpiderGL.Math.Vec3,a=SpiderGL.Math.Mat4,s=a.mul4(t,e),o=1/s[3]
return s[3]=o,n.muls$(s,o/2),n.adds$(s,.5),n.mul$(s,[i[2],i[3],r[1]-r[0]]),n.add$(s,[i[0],i[1],r[0]]),s},SpiderGL.Math.unproject=function(e,t,i,r){var n=SpiderGL.Math.Vec3,a=SpiderGL.Math.Mat4,s=n.to4(e,1)
n.sub$(s,[i[0],i[1],r[0]]),n.div$(s,[i[2],i[3],r[1]-r[0]]),n.muls$(s,2),n.subs$(s,1),s=a.mul4(t,s)
var o=1/s[3]
return s[3]=o,n.muls$(s,o),s},SpiderGL.Space={},SpiderGL.Space.MatrixStack=function(e){SpiderGL.Core.ObjectBase.call(this),this._onChange=null,this.reset(),this._onChange=e},SpiderGL.Space.MatrixStack.prototype={_invalidate:function(){this._i=null,this._t=null,this._it=null,this._onChange&&this._onChange(this)},reset:function(){var e=SpiderGL.Math.Mat4.identity()
this._s=[e],this._l=1,this._m=e,this._i=e,this._t=e,this._it=e,this._onChange&&this._onChange(this)},get onChange(){return this._onChange},set onChange(e){this._onChange=e},get size(){return this._l},get matrix$(){return this._m},get matrix(){return SpiderGL.Math.Mat4.dup(this.matrix$)},get top$(){return this.matrix$},get top(){return this.matrix},get inverse$(){return this._i||(this._i=SpiderGL.Math.Mat4.inverse(this._m))},get inverse(){return SpiderGL.Math.Mat4.dup(this.inverse$)},get transpose$(){return this._t||(this._t=SpiderGL.Math.Mat4.transpose(this._m))},get transpose(){return SpiderGL.Math.Mat4.dup(this.transpose$)},get inverseTranspose$(){return this._it||(this._it=SpiderGL.Math.Mat4.transpose(this.inverse$))},get inverseTranspose(){return SpiderGL.Math.Mat4.dup(this.inverseTranspose$)},push:function(){var e=SpiderGL.Math.Mat4.dup(this._m)
this._s.push(e),this._l++,this._m=e},pop:function(){this._l<=1||(this._s.pop(),this._l--,this._m=this._s[this._l-1],this._invalidate())},load:function(e){e=SpiderGL.Math.Mat4.dup(e),this._s[this._l-1]=e,this._m=e,this._invalidate()},loadIdentity:function(){var e=SpiderGL.Math.Mat4.identity$(this._m)
this._i=e,this._t=e,this._it=e},multiply:function(e){SpiderGL.Math.Mat4.mul$(this._m,e),this._invalidate()},ortho:function(e,t){SpiderGL.Math.Mat4.mul$(this._m,SpiderGL.Math.Mat4.ortho(e,t)),this._invalidate()},frustum:function(e,t){SpiderGL.Math.Mat4.mul$(this._m,SpiderGL.Math.Mat4.frustum(e,t)),this._invalidate()},perspective:function(e,t,i,r){SpiderGL.Math.Mat4.mul$(this._m,SpiderGL.Math.Mat4.perspective(e,t,i,r)),this._invalidate()},lookAt:function(e,t,i){SpiderGL.Math.Mat4.mul$(this._m,SpiderGL.Math.Mat4.lookAt(e,t,i)),this._invalidate()},translate:function(e){SpiderGL.Math.Mat4.translate$(this._m,e),this._invalidate()},rotate:function(e,t){SpiderGL.Math.Mat4.rotateAngleAxis$(this._m,e,t),this._invalidate()},scale:function(e){SpiderGL.Math.Mat4.scale$(this._m,e),this._invalidate()}},SpiderGL.Type.extend(SpiderGL.Space.MatrixStack,SpiderGL.Core.ObjectBase),SpiderGL.Space.ViewportStack=function(e){SpiderGL.Core.ObjectBase.call(this),this._onChange=null,this.reset(),this._onChange=e},SpiderGL.Space.ViewportStack.prototype={_invalidate:function(){this._onChange&&this._onChange(this)},reset:function(){var e=[0,0,1,1]
this._s=[e],this._l=1,this._r=e,this._onChange&&this._onChange(this)},get onChange(){return this._onChange},set onChange(e){this._onChange=e},get size(){return this._l},get rect$(){return this._r},get rect(){return this.rect$.slice(0,4)},get top$(){return this.rect$},get top(){return this.rect},push:function(){var e=this._r.slice(0,4)
this._s.push(e),this._l++,this._r=e},pop:function(){this._l<=1||(this._s.pop(),this._l--,this._r=this._s[this._l-1],this._invalidate())},load:function(e){e=e.slice(0,4),this._s[this._l-1]=e,this._r=e,this._invalidate()},loadIdentity:function(){var e=[0,0,1,1]
this._r=e},inner:function(e){this._r[0]+=e[0],this._r[1]+=e[1],this._r[2]=e[2],this._r[3]=e[3],this._invalidate()}},SpiderGL.Type.extend(SpiderGL.Space.ViewportStack,SpiderGL.Core.ObjectBase),SpiderGL.Space.DepthRangeStack=function(e){SpiderGL.Core.ObjectBase.call(this),this._onChange=null,this.reset(),this._onChange=e},SpiderGL.Space.DepthRangeStack.prototype={_invalidate:function(){this._onChange&&this._onChange(this)},reset:function(){var e=[0,1]
this._s=[e],this._l=1,this._r=e,this._onChange&&this._onChange(this)},get onChange(){return this._onChange},set onChange(e){this._onChange=e},get size(){return this._l},get range$(){return this._r},get range(){return this.range$.slice(0,2)},get top$(){return this.range$},get top(){return this.range},push:function(){var e=this._r.slice(0,2)
this._s.push(e),this._l++,this._r=e},pop:function(){this._l<=1||(this._s.pop(),this._l--,this._r=this._s[this._l-1],this._invalidate())},load:function(e){e=e.slice(0,2),this._s[this._l-1]=e,this._r=e,this._invalidate()},loadIdentity:function(){var e=[0,1]
this._r=e},inner:function(e){this._r[0]+=e[0],this._r[1]=e[1],this._invalidate()}},SpiderGL.Type.extend(SpiderGL.Space.DepthRangeStack,SpiderGL.Core.ObjectBase),SpiderGL.Space.TransformationStack=function(){SpiderGL.Core.ObjectBase.call(this)
var e=this
this._mv={},this._vp={},this._mvp={},this._n={},this._c={},this._m=new SpiderGL.Space.MatrixStack(function(){e._mv={},e._mvp={},e._n={},e._c={}}),this._v=new SpiderGL.Space.MatrixStack(function(){e._mv={},e._vp={},e._mvp={},e._n={},e._c={}}),this._p=new SpiderGL.Space.MatrixStack(function(){e._vp={},e._mvp={}}),this._viewport=new SpiderGL.Space.ViewportStack(function(){}),this._depth=new SpiderGL.Space.DepthRangeStack(function(){})},SpiderGL.Space.TransformationStack.prototype={reset:function(){this._m.reset(),this._v.reset(),this._p.reset()},get viewport(){return this._viewport},get viewportRect$(){return this._viewport.rect$},get viewportRect(){return this._viewport.rect},get depth(){return this._depth},get depthRange$(){return this._depth.range$},get depthRange(){return this._depth.range},get model(){return this._m},get modelMatrix$(){return this._m.matrix$},get modelMatrix(){return this._m.matrix},get modelMatrixInverse$(){return this._m.inverse$},get modelMatrixInverse(){return this._m.inverse},get modelMatrixTranspose$(){return this._m.transpose$},get modelMatrixTranspose(){return this._m.transpose},get modelMatrixInverseTranspose$(){return this._m.inverseTranspose$},get modelMatrixInverseTranspose(){return this._m.inverseTranspose},get view(){return this._v},get viewMatrix$(){return this._v.matrix$},get viewMatrix(){return this._v.matrix},get viewMatrixInverse$(){return this._v.inverse$},get viewMatrixInverse(){return this._v.inverse},get viewMatrixTranspose$(){return this._v.transpose$},get viewMatrixTranspose(){return this._v.transpose},get viewMatrixInverseTranspose$(){return this._v.inverseTranspose$},get viewMatrixInverseTranspose(){return this._v.inverseTranspose},get projection(){return this._p},get projectionMatrix$(){return this._p.matrix$},get projectionMatrix(){return this._p.matrix},get projectionMatrixInverse$(){return this._p.inverse$},get projectionMatrixInverse(){return this._p.inverse},get projectionMatrixTranspose$(){return this._p.transpose$},get projectionMatrixTranspose(){return this._p.transpose},get projectionMatrixInverseTranspose$(){return this._p.inverseTranspose$},get projectionMatrixInverseTranspose(){return this._p.inverseTranspose},get modelViewMatrix$(){return this._mv.m||(this._mv.m=SpiderGL.Math.Mat4.mul(this.viewMatrix$,this.modelMatrix$))},get modelViewMatrix(){return SpiderGL.Math.Mat4.dup(this.modelViewMatrix$)},get modelViewMatrixInverse$(){return this._mv.i||(this._mv.i=SpiderGL.Math.Mat4.mul(this.modelMatrixInverse$,this.viewMatrixInverse$))},get modelViewMatrixInverse(){return SpiderGL.Math.Mat4.dup(this.modelViewMatrixInverse$)},get modelViewMatrixTranspose$(){return this._mv.t||(this._mv.t=SpiderGL.Math.Mat4.transpose(this.modelViewMatrix$))},get modelViewMatrixTranspose(){return SpiderGL.Math.Mat4.dup(this.modelViewMatrixTranspose$)},get modelViewMatrixInverseTranspose$(){return this._mv.it||(this._mv.it=SpiderGL.Math.Mat4.transpose(this.modelViewMatrixInverse$))},get modelViewMatrixInverseTranspose(){return SpiderGL.Math.Mat4.dup(this.modelViewMatrixInverseTranspose$)},get viewProjectionMatrix$(){return this._vp.m||(this._vp.m=SpiderGL.Math.Mat4.mul(this.projectionMatrix$,this.viewMatrix$))},get viewProjectionMatrix(){return SpiderGL.Math.Mat4.dup(this.viewProjectionMatrix$)},get viewProjectionMatrixInverse$(){return this._vp.i||(this._vp.i=SpiderGL.Math.Mat4.mul(this.viewMatrixInverse$,this.projectionMatrixInverse$))},get viewProjectionMatrixInverse(){return SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixInverse$)},get viewProjectionMatrixTranspose$(){return this._vp.t||(this._vp.t=SpiderGL.Math.Mat4.transpose(this.viewProjectionMatrix$))},get viewProjectionMatrixTranspose(){return SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixTranspose$)},get viewProjectionMatrixInverseTranspose$(){return this._vp.it||(this._vp.it=SpiderGL.Math.Mat4.transpose(this.viewProjectionMatrixInverse$))},get viewProjectionMatrixInverseTranspose(){return SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixInverseTranspose$)},get modelViewProjectionMatrix$(){return this._mvp.m||(this._mvp.m=SpiderGL.Math.Mat4.mul(this.viewProjectionMatrix$,this.modelMatrix$))},get modelViewProjectionMatrix(){return SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrix$)},get modelViewProjectionMatrixInverse$(){return this._mvp.i||(this._mvp.i=SpiderGL.Math.Mat4.inverse(this.modelViewProjectionMatrix$))},get modelViewProjectionMatrixInverse(){return SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixInverse$)},get modelViewProjectionMatrixTranspose$(){return this._mvp.t||(this._mvp.t=SpiderGL.Math.Mat4.transpose(this.modelViewProjectionMatrix$))},get modelViewProjectionMatrixTranspose(){return SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixTranspose$)},get modelViewProjectionMatrixInverseTranspose$(){return this._mvp.it||(this._mvp.it=SpiderGL.Math.Mat4.transpose(this.modelViewProjectionMatrixInverse$))},get modelViewProjectionMatrixInverseTranspose(){return SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixInverseTranspose$)},get worldSpaceNormalMatrix$(){return this._n.m||(this._n.m=SpiderGL.Math.Mat4.inverseTranspose33(this.modelMatrix$))},get worldSpaceNormalMatrix(){return SpiderGL.Math.Mat4.dup(this.worldSpaceNormalMatrix$)},get viewSpaceNormalMatrix$(){return this._n.v||(this._n.v=SpiderGL.Math.Mat4.inverseTranspose33(this.modelViewMatrix$))},get viewSpaceNormalMatrix(){return SpiderGL.Math.Mat4.dup(this.viewSpaceNormalMatrix$)},get modelSpaceViewerPosition$(){return this._c.mp||(this._c.mp=SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.col(this.modelViewMatrixInverse$,3)))},get modelSpaceViewerPosition(){return SpiderGL.Math.Vec3.dup(this.modelSpaceViewerPosition$)},get worldSpaceViewerPosition$(){return this._c.wp||(this._c.wp=SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.col(this.viewMatrixInverse$,3)))},get worldSpaceViewerPosition(){return SpiderGL.Math.Vec3.dup(this.worldSpaceViewerPosition$)},get modelSpaceViewDirection$(){return this._c.md||(this._c.md=SpiderGL.Math.Vec3.normalize$(SpiderGL.Math.Vec3.neg$(SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.row(this.modelViewMatrixInverse$,2)))))},get modelSpaceViewDirection(){return SpiderGL.Math.Vec3.dup(this.modelSpaceViewDirection$)},get worldSpaceViewDirection$(){return this._c.wd||(this._c.wd=SpiderGL.Math.Vec3.normalize$(SpiderGL.Math.Vec3.neg$(SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.row(this.viewMatrixInverse$,2)))))},get worldSpaceViewDirection(){return SpiderGL.Math.Vec3.dup(this.worldSpaceViewDirection$)},project:function(e){return SpiderGL.Math.project(e,this.modelViewProjectionMatrix$,this.viewportRect$,this.depthRange$)},unproject:function(e){return SpiderGL.Math.unproject(e,this.modelViewProjectionMatrixInverse$,this.viewportRect$,this.depthRange$)}},SpiderGL.Type.extend(SpiderGL.Space.TransformationStack,SpiderGL.Core.ObjectBase),SpiderGL.WebGL={},SpiderGL.WebGL.Context={},SpiderGL.WebGL.Context.WEBGL_STRING="experimental-webgl",SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y=!0,SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA=!1,SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Context.get=function(e,t){var i=e
if(SpiderGL.Type.isString(i)&&(i=SpiderGL.DOM.getElementById(i)),!SpiderGL.Type.instanceOf(i,HTMLCanvasElement))return null
var r=i.getContext(SpiderGL.WebGL.Context.WEBGL_STRING,t)
return r},SpiderGL.WebGL.Context._prepareContex=function(e){if(e){var t=e._spidergl
if(!t){t={},e._spidergl=t,t.TAG=0,t.gl=e
var i={}
t.glFunctions=i
for(var r in e){var n=e[n]
"function"==typeof n&&(i[r]=n)}}}},SpiderGL.WebGL.Context._addExtension=function(e,t,i,r){if(e){var n=e.getExtension
e.getExtension=function(a){if(a==t){var s=this._spidergl
if(!s)return null
var o=s[i]
if(!o){o={},o.TAG=0
var u={}
o._ext=u,u[i]=o,u.sgl=s,u.gl=e
var c={}
if(u.glFunctions=c,!r(e,o))return null
s[i]=o}return o}return n.call(this,a)}}},SpiderGL.WebGL.Context._setup_SGL_current_binding=function(e,t){if(!e)return!1
if(!t)return!1
if(!e._spidergl)return!1
if(e._spidergl.cb)return!1
var i=t,r=i._ext,n=r.glFunctions
r.currentBuffer={},r.currentBuffer[e.ARRAY_BUFFER]=e.getParameter(e.ARRAY_BUFFER_BINDING),r.currentBuffer[e.ELEMENT_ARRAY_BUFFER]=e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),r.bufferStack={},r.bufferStack[e.ARRAY_BUFFER]=[],r.bufferStack[e.ELEMENT_ARRAY_BUFFER]=[],n.bindBuffer=e.bindBuffer,e.bindBuffer=function(e,t){var i=this._spidergl.cb._ext,r=i.currentBuffer[e]
r!=t&&(i.currentBuffer[e]=t,i.glFunctions.bindBuffer.call(this,e,t))},i.getCurrentBuffer=function(e){return this._ext.currentBuffer[e]},i.pushBuffer=function(e){var t=this._ext,i=t.bufferStack[e],r=t.currentBuffer[e]
i.push(r)},i.popBuffer=function(e){var t=this._ext,i=t.bufferStack[e]
if(!(i.length<=0)){var r=i.pop()
t.gl.bindBuffer(e,r)}},r.currentFramebuffer={},r.currentFramebuffer[e.FRAMEBUFFER]=e.getParameter(e.FRAMEBUFFER_BINDING),r.framebufferStack={},r.framebufferStack[e.FRAMEBUFFER]=[],n.bindFramebuffer=e.bindFramebuffer,e.bindFramebuffer=function(e,t){var i=this._spidergl.cb._ext,r=i.currentFramebuffer[e]
r!=t&&(i.currentFramebuffer[e]=t,i.glFunctions.bindFramebuffer.call(this,e,t))},i.getCurrentFramebuffer=function(e){return this._ext.currentFramebuffer[e]},i.pushFramebuffer=function(e){var t=this._ext,i=t.framebufferStack[e],r=t.currentFramebuffer[e]
i.push(r)},i.popFramebuffer=function(e){var t=this._ext,i=t.framebufferStack[e]
if(!(i.length<=0)){var r=i.pop()
t.gl.bindFramebuffer(e,r)}},r.currentProgram=e.getParameter(e.CURRENT_PROGRAM),r.programStack=[],n.useProgram=e.useProgram,e.useProgram=function(e){var t=this._spidergl.cb._ext,i=t.currentProgram
i!=e&&(t.currentProgram=e,t.glFunctions.useProgram.call(this,e))},i.getCurrentProgram=function(){return this._ext.currentProgram},i.pushProgram=function(){var e=this._ext,t=e.programStack,i=e.currentProgram
t.push(i)},i.popProgram=function(){var e=this._ext,t=e.programStack
if(!(t.length<=0)){var i=t.pop()
e.gl.useProgram(i)}},r.currentRenderbuffer={},r.currentRenderbuffer[e.RENDERBUFFER]=e.getParameter(e.RENDERBUFFER_BINDING),r.renderbufferStack={},r.renderbufferStack[e.RENDERBUFFER]=[],n.bindRenderbuffer=e.bindRenderbuffer,e.bindRenderbuffer=function(e,t){var i=this._spidergl.cb._ext,r=i.currentRenderbuffer[e]
r!=t&&(i.currentRenderbuffer[e]=t,i.glFunctions.bindRenderbuffer.call(this,e,t))},i.getCurrentRenderbuffer=function(e){return this._ext.currentRenderbuffer[e]},i.pushRenderbuffer=function(e){var t=this._ext,i=t.renderbufferStack[e],r=t.currentRenderbuffer[e]
i.push(r)},i.popRenderbuffer=function(e){var t=this._ext,i=t.renderbufferStack[e]
if(!(i.length<=0)){var r=i.pop()
t.gl.bindRenderbuffer(e,r)}},r.currentShader={},r.currentShader[e.VERTEX_SHADER]=null,r.currentShader[e.FRAGMENT_SHADER]=null,r.shaderStack={},r.shaderStack[e.VERTEX_SHADER]=[],r.shaderStack[e.FRAGMENT_SHADER]=[],r.glFunctions.bindShader=function(e,t){},i.bindShader=function(e,t){var i=this._ext,r=i.currentShader[e]
r!=t&&(i.currentShader[e]=t,i.glFunctions.bindShader.call(i.gl,e,t))},i.getCurrentShader=function(e){return this._ext.currentShader[e]},i.pushShader=function(e){var t=this._ext,i=t.shaderStack[e],r=t.currentShader[e]
i.push(r)},i.popShader=function(e){var t=this._ext,i=t.shaderStack[e]
if(!(i.length<=0)){var r=i.pop()
t.gl.bindShader(e,r)}},r.currentTexture={}
var a=e.getParameter(e.ACTIVE_TEXTURE),s=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)
r.currentTexture={},r.textureStack={},r.textureUnitStack=[]
for(var o=0;s>o;++o){var u=e.TEXTURE0+o
e.activeTexture(u)
var c={}
c[e.TEXTURE_2D]=e.getParameter(e.TEXTURE_BINDING_2D),c[e.TEXTURE_CUBE_MAP]=e.getParameter(e.TEXTURE_BINDING_CUBE_MAP),r.currentTexture[u]=c
var l={}
l[e.TEXTURE_2D]=[],l[e.TEXTURE_CUBE_MAP]=[],r.textureStack[u]=l}return e.activeTexture(a),r.currentTextureUnit=a,n.activeTexture=e.activeTexture,e.activeTexture=function(e){var t=this._spidergl.cb._ext,i=t.currentTextureUnit
i!=e&&(t.currentTextureUnit=e,t.glFunctions.activeTexture.call(this,e))},i.getCurrentTextureUnit=function(){return this._ext.currentTextureUnit},i.pushTextureUnit=function(){var e=this._ext,t=e.textureUnitStack,i=e.currentTextureUnit
t.push(i)},i.popTextureUnit=function(){var e=this._ext,t=e.textureUnitStack
if(!(t.length<=0)){var i=t.pop()
e.gl.activeTexture(i)}},n.bindTexture=e.bindTexture,e.bindTexture=function(e,t){var i=this._spidergl.cb._ext,r=i.currentTextureUnit,n=i.currentTexture[r][e]
n!=t&&(i.currentTexture[r][e]=t,i.glFunctions.bindTexture.call(this,e,t))},i.getCurrentTexture=function(e){var t=this._ext,i=t.currentTextureUnit
return t.currentTexture[i][e]},i.pushTexture=function(e){var t=this._ext,i=t.currentTextureUnit,r=t.textureStack[i][e],n=t.currentTexture[i][e]
r.push(n)},i.popTexture=function(e){var t=this._ext,i=t.currentTextureUnit,r=t.textureStack[i][e]
if(!(r.length<=0)){var n=r.pop()
t.gl.bindTexture(e,n)}},!0},SpiderGL.WebGL.Context._setup_SGL_wrapper_notify=function(e,t){if(!e)return!1
if(!t)return!1
if(!e._spidergl)return!1
if(e._spidergl.wn)return!1
var i=t,r=i._ext,n=r.glFunctions
return r.cb=e.getExtension("SGL_current_binding"),r.cb?(n.deleteBuffer=e.deleteBuffer,e.deleteBuffer=function(e){var t=this._spidergl.wn._ext
t.glFunctions.deleteBuffer.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_deleteBuffer.apply(i._spidergl,arguments)},n.isBuffer=e.isBuffer,e.isBuffer=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.isBuffer.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_isBuffer.apply(r._spidergl,arguments),i},n.bindBuffer=e.bindBuffer,e.bindBuffer=function(e){var t=this._spidergl.wn._ext
t.glFunctions.bindBuffer.apply(this,arguments)
var i=t.cb.getCurrentBuffer(e)
i&&i._spidergl&&i._spidergl._gl_bindBuffer.apply(i._spidergl,arguments)},n.getBufferParameter=e.getBufferParameter,e.getBufferParameter=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getBufferParameter.apply(this,arguments),r=t.cb.getCurrentBuffer(e)
return r&&r._spidergl&&r._spidergl._gl_getBufferParameter.apply(r._spidergl,arguments),i},n.bufferData=e.bufferData,e.bufferData=function(e){var t=this._spidergl.wn._ext
t.glFunctions.bufferData.apply(this,arguments)
var i=t.cb.getCurrentBuffer(e)
i&&i._spidergl&&i._spidergl._gl_bufferData.apply(i._spidergl,arguments)},n.bufferSubData=e.bufferSubData,e.bufferSubData=function(e){var t=this._spidergl.wn._ext
t.glFunctions.bufferSubData.apply(this,arguments)
var i=t.cb.getCurrentBuffer(e)
i&&i._spidergl&&i._spidergl._gl_bufferSubData.apply(i._spidergl,arguments)},n.vertexAttribPointer=e.vertexAttribPointer,e.vertexAttribPointer=function(){var e=this._spidergl.wn._ext
e.glFunctions.vertexAttribPointer.apply(this,arguments)
var t=this.ARRAY_BUFFER,i=e.cb.getCurrentBuffer(t)
i&&i._spidergl&&i._spidergl._gl_vertexAttribPointer.apply(i._spidergl,arguments)},n.drawElements=e.drawElements,e.drawElements=function(e,t,i,r,n){var a=this._spidergl.wn._ext
a.glFunctions.drawElements.apply(this,arguments)
var s=this.ELEMENT_ARRAY_BUFFER,o=a.cb.getCurrentBuffer(s)
o&&o._spidergl&&o._spidergl._gl_drawElements.apply(o._spidergl,arguments)},n.deleteFramebuffer=e.deleteFramebuffer,e.deleteFramebuffer=function(e){var t=this._spidergl.wn._ext
t.glFunctions.deleteFramebuffer.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_deleteFramebuffer.apply(i._spidergl,arguments)},n.isFramebuffer=e.isFramebuffer,e.isFramebuffer=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.isFramebuffer.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_isFramebuffer.apply(r._spidergl,arguments),i},n.bindFramebuffer=e.bindFramebuffer,e.bindFramebuffer=function(e){var t=this._spidergl.wn._ext
t.glFunctions.bindFramebuffer.apply(this,arguments)
var i=t.cb.getCurrentFramebuffer(e)
i&&i._spidergl&&i._spidergl._gl_bindFramebuffer.apply(i._spidergl,arguments)},n.checkFramebufferStatus=e.checkFramebufferStatus,e.checkFramebufferStatus=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.checkFramebufferStatus.apply(this,arguments),r=t.cb.getCurrentFramebuffer(e)
return r&&r._spidergl&&r._spidergl._gl_checkFramebufferStatus.apply(r._spidergl,arguments),i},n.getFramebufferAttachmentParameter=e.getFramebufferAttachmentParameter,e.getFramebufferAttachmentParameter=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getFramebufferAttachmentParameter.apply(this,arguments),r=t.cb.getCurrentFramebuffer(e)
return r&&r._spidergl&&r._spidergl._gl_getFramebufferAttachmentParameter.apply(r._spidergl,arguments),i},n.framebufferRenderbuffer=e.framebufferRenderbuffer,e.framebufferRenderbuffer=function(e){var t=this._spidergl.wn._ext
t.glFunctions.framebufferRenderbuffer.apply(this,arguments)
var i=t.cb.getCurrentFramebuffer(e)
i&&i._spidergl&&i._spidergl._gl_framebufferRenderbuffer.apply(i._spidergl,arguments)},n.framebufferTexture2D=e.framebufferTexture2D,e.framebufferTexture2D=function(e){var t=this._spidergl.wn._ext
t.glFunctions.framebufferTexture2D.apply(this,arguments)
var i=t.cb.getCurrentFramebuffer(e)
i&&i._spidergl&&i._spidergl._gl_framebufferTexture2D.apply(i._spidergl,arguments)},n.clear=e.clear,e.clear=function(){var e=this._spidergl.wn._ext
e.glFunctions.clear.apply(this,arguments)
var t=this.FRAMEBUFFER,i=e.cb.getCurrentFramebuffer(t)
i&&i._spidergl&&i._spidergl._gl_clear.apply(i._spidergl,arguments)},n.readPixels=e.readPixels,e.readPixels=function(){var e=this._spidergl.wn._ext
e.glFunctions.readPixels.apply(this,arguments)
var t=this.FRAMEBUFFER,i=e.cb.getCurrentFramebuffer(t)
i&&i._spidergl&&i._spidergl._gl_readPixels.apply(i._spidergl,arguments)},n.deleteProgram=e.deleteProgram,e.deleteProgram=function(e){var t=this._spidergl.wn._ext
t.glFunctions.deleteProgram.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_deleteProgram.apply(i._spidergl,arguments)},n.isProgram=e.isProgram,e.isProgram=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.isProgram.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_isProgram.apply(r._spidergl,arguments),i},n.useProgram=e.useProgram,e.useProgram=function(){var e=this._spidergl.wn._ext
e.glFunctions.useProgram.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_useProgram.apply(t._spidergl,arguments)},n.getActiveAttrib=e.getActiveAttrib,e.getActiveAttrib=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getActiveAttrib.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getActiveAttrib.apply(r._spidergl,arguments),i},n.getActiveUniform=e.getActiveUniform,e.getActiveUniform=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getActiveUniform.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getActiveUniform.apply(r._spidergl,arguments),i},n.getAttachedShaders=e.getAttachedShaders,e.getAttachedShaders=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getAttachedShaders.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getAttachedShaders.apply(r._spidergl,arguments),i},n.getAttribLocation=e.getAttribLocation,e.getAttribLocation=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getAttribLocation.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getAttribLocation.apply(r._spidergl,arguments),i},n.getProgramParameter=e.getProgramParameter,e.getProgramParameter=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getProgramParameter.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getProgramParameter.apply(r._spidergl,arguments),i},n.getProgramInfoLog=e.getProgramInfoLog,e.getProgramInfoLog=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getProgramInfoLog.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getProgramInfoLog.apply(r._spidergl,arguments),i},n.getUniform=e.getUniform,e.getUniform=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getUniform.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getUniform.apply(r._spidergl,arguments),i},n.getUniformLocation=e.getUniformLocation,e.getUniformLocation=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getUniformLocation.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getUniformLocation.apply(r._spidergl,arguments),i},n.attachShader=e.attachShader,e.attachShader=function(e){var t=this._spidergl.wn._ext
t.glFunctions.attachShader.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_attachShader.apply(i._spidergl,arguments)},n.bindAttribLocation=e.bindAttribLocation,e.bindAttribLocation=function(e){var t=this._spidergl.wn._ext
t.glFunctions.bindAttribLocation.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_bindAttribLocation.apply(i._spidergl,arguments)},n.detachShader=e.detachShader,e.detachShader=function(e){var t=this._spidergl.wn._ext
t.glFunctions.detachShader.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_detachShader.apply(i._spidergl,arguments)},n.linkProgram=e.linkProgram,e.linkProgram=function(e){var t=this._spidergl.wn._ext
t.glFunctions.linkProgram.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_linkProgram.apply(i._spidergl,arguments)},n.uniform1f=e.uniform1f,e.uniform1f=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform1f.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform1f.apply(t._spidergl,arguments)},n.uniform1fv=e.uniform1fv,e.uniform1fv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform1fv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform1fv.apply(t._spidergl,arguments)},n.uniform1i=e.uniform1i,e.uniform1i=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform1i.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform1i.apply(t._spidergl,arguments)},n.uniform1iv=e.uniform1iv,e.uniform1iv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform1iv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform1iv.apply(t._spidergl,arguments)},n.uniform2f=e.uniform2f,e.uniform2f=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform2f.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform2f.apply(t._spidergl,arguments)},n.uniform2fv=e.uniform2fv,e.uniform2fv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform2fv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform2fv.apply(t._spidergl,arguments)},n.uniform2i=e.uniform2i,e.uniform2i=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform2i.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform2i.apply(t._spidergl,arguments)},n.uniform2iv=e.uniform2iv,e.uniform2iv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform2iv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform2iv.apply(t._spidergl,arguments)},n.uniform3f=e.uniform3f,e.uniform3f=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform3f.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform3f.apply(t._spidergl,arguments)},n.uniform3fv=e.uniform3fv,e.uniform3fv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform3fv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform3fv.apply(t._spidergl,arguments)},n.uniform3i=e.uniform3i,e.uniform3i=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform3i.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform3i.apply(t._spidergl,arguments)},n.uniform3iv=e.uniform3iv,e.uniform3iv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform3iv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform3iv.apply(t._spidergl,arguments)},n.uniform4f=e.uniform4f,e.uniform4f=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform4f.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform4f.apply(t._spidergl,arguments)},n.uniform4fv=e.uniform4fv,e.uniform4fv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform4fv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform4fv.apply(t._spidergl,arguments)},n.uniform4i=e.uniform4i,e.uniform4i=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform4i.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform4i.apply(t._spidergl,arguments)},n.uniform4iv=e.uniform4iv,e.uniform4iv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniform4iv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniform4iv.apply(t._spidergl,arguments)},n.uniformMatrix2fv=e.uniformMatrix2fv,e.uniformMatrix2fv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniformMatrix2fv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniformMatrix2fv.apply(t._spidergl,arguments)},n.uniformMatrix3fv=e.uniformMatrix3fv,e.uniformMatrix3fv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniformMatrix3fv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniformMatrix3fv.apply(t._spidergl,arguments)},n.uniformMatrix4fv=e.uniformMatrix4fv,e.uniformMatrix4fv=function(){var e=this._spidergl.wn._ext
e.glFunctions.uniformMatrix4fv.apply(this,arguments)
var t=e.cb.getCurrentProgram()
t&&t._spidergl&&t._spidergl._gl_uniformMatrix4fv.apply(t._spidergl,arguments)},n.validateProgram=e.validateProgram,e.validateProgram=function(e){var t=this._spidergl.wn._ext
t.glFunctions.validateProgram.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_validateProgram.apply(i._spidergl,arguments)},n.deleteRenderbuffer=e.deleteRenderbuffer,e.deleteRenderbuffer=function(e){var t=this._spidergl.wn._ext
t.glFunctions.deleteRenderbuffer.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_deleteRenderbuffer.apply(i._spidergl,arguments)},n.isRenderbuffer=e.isRenderbuffer,e.isRenderbuffer=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.isRenderbuffer.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_isRenderbuffer.apply(r._spidergl,arguments),i},n.bindRenderbuffer=e.bindRenderbuffer,e.bindRenderbuffer=function(e){var t=this._spidergl.wn._ext
t.glFunctions.bindRenderbuffer.apply(this,arguments)
var i=t.cb.getCurrentRenderbuffer(e)
i&&i._spidergl&&i._spidergl._gl_bindRenderbuffer.apply(i._spidergl,arguments)},n.getRenderbufferParameter=e.getRenderbufferParameter,e.getRenderbufferParameter=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getRenderbufferParameter.apply(this,arguments),r=t.cb.getCurrentRenderbuffer(e)
return r&&r._spidergl&&r._spidergl._gl_getRenderbufferParameter.apply(r._spidergl,arguments),i},n.renderbufferStorage=e.renderbufferStorage,e.renderbufferStorage=function(e){var t=this._spidergl.wn._ext
t.glFunctions.renderbufferStorage.apply(this,arguments)
var i=t.cb.getCurrentRenderbuffer(e)
i&&i._spidergl&&i._spidergl._gl_renderbufferStorage.apply(i._spidergl,arguments)},n.deleteShader=e.deleteShader,e.deleteShader=function(e){var t=this._spidergl.wn._ext
t.glFunctions.deleteShader.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_deleteShader.apply(i._spidergl,arguments)},n.isShader=e.isShader,e.isShader=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.isShader.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_isShader.apply(r._spidergl,arguments),i},n.getShaderParameter=e.getShaderParameter,e.getShaderParameter=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getShaderParameter.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getShaderParameter.apply(r._spidergl,arguments),i},n.getShaderInfoLog=e.getShaderInfoLog,e.getShaderInfoLog=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getShaderInfoLog.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getShaderInfoLog.apply(r._spidergl,arguments),i},n.getShaderSource=e.getShaderSource,e.getShaderSource=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getShaderSource.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_getShaderSource.apply(r._spidergl,arguments),i},n.compileShader=e.compileShader,e.compileShader=function(e){var t=this._spidergl.wn._ext
t.glFunctions.compileShader.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_compileShader.apply(i._spidergl,arguments)},n.shaderSource=e.shaderSource,e.shaderSource=function(e){var t=this._spidergl.wn._ext
t.glFunctions.shaderSource.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_shaderSource.apply(i._spidergl,arguments)},r.textureTargetMap={},r.textureTargetMap[e.TEXTURE_2D]=e.TEXTURE_2D,r.textureTargetMap[e.TEXTURE_CUBE_MAP]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_X]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_X]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_Y]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_Y]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_Z]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_Z]=e.TEXTURE_CUBE_MAP,n.deleteTexture=e.deleteTexture,e.deleteTexture=function(e){var t=this._spidergl.wn._ext
t.glFunctions.deleteTexture.apply(this,arguments)
var i=e
i&&i._spidergl&&i._spidergl._gl_deleteTexture.apply(i._spidergl,arguments)},n.isTexture=e.isTexture,e.isTexture=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.isTexture.apply(this,arguments),r=e
return r&&r._spidergl&&r._spidergl._gl_isTexture.apply(r._spidergl,arguments),i},n.bindTexture=e.bindTexture,e.bindTexture=function(e){var t=this._spidergl.wn._ext
t.glFunctions.bindTexture.apply(this,arguments)
var i=t.cb.getCurrentTexture(e)
i&&i._spidergl&&i._spidergl._gl_bindTexture.apply(i._spidergl,arguments)},n.getTexParameter=e.getTexParameter,e.getTexParameter=function(e){var t=this._spidergl.wn._ext,i=t.glFunctions.getTexParameter.apply(this,arguments),r=t.cb.getCurrentTexture(e)
return r&&r._spidergl&&r._spidergl._gl_getTexParameter.apply(r._spidergl,arguments),i},n.copyTexImage2D=e.copyTexImage2D,e.copyTexImage2D=function(e){var t=this._spidergl.wn._ext
t.glFunctions.copyTexImage2D.apply(this,arguments)
var i=t.textureTargetMap[e],r=t.cb.getCurrentTexture(i)
r&&r._spidergl&&r._spidergl._gl_copyTexImage2D.apply(r._spidergl,arguments)},n.copyTexSubImage2D=e.copyTexSubImage2D,e.copyTexSubImage2D=function(e){var t=this._spidergl.wn._ext
t.glFunctions.copyTexSubImage2D.apply(this,arguments)
var i=t.textureTargetMap[e],r=t.cb.getCurrentTexture(i)
r&&r._spidergl&&r._spidergl._gl_copyTexSubImage2D.apply(r._spidergl,arguments)},n.generateMipmap=e.generateMipmap,e.generateMipmap=function(e){var t=this._spidergl.wn._ext
t.glFunctions.generateMipmap.apply(this,arguments)
var i=t.cb.getCurrentTexture(e)
i&&i._spidergl&&i._spidergl._gl_generateMipmap.apply(i._spidergl,arguments)},n.texImage2D=e.texImage2D,e.texImage2D=function(e){var t=this._spidergl.wn._ext
t.glFunctions.texImage2D.apply(this,arguments)
var i=t.textureTargetMap[e],r=t.cb.getCurrentTexture(i)
r&&r._spidergl&&r._spidergl._gl_texImage2D.apply(r._spidergl,arguments)},n.texParameterf=e.texParameterf,e.texParameterf=function(e){var t=this._spidergl.wn._ext
t.glFunctions.texParameterf.apply(this,arguments)
var i=t.cb.getCurrentTexture(e)
i&&i._spidergl&&i._spidergl._gl_texParameterf.apply(i._spidergl,arguments)},n.texParameteri=e.texParameteri,e.texParameteri=function(e){var t=this._spidergl.wn._ext
t.glFunctions.texParameteri.apply(this,arguments)
var i=t.cb.getCurrentTexture(e)
i&&i._spidergl&&i._spidergl._gl_texParameteri.apply(i._spidergl,arguments)},n.texSubImage2D=e.texSubImage2D,e.texSubImage2D=function(e){var t=this._spidergl.wn._ext
t.glFunctions.texSubImage2D.apply(this,arguments)
var i=t.textureTargetMap[e],r=t.cb.getCurrentTexture(i)
r&&r._spidergl&&r._spidergl._gl_texSubImage2D.apply(r._spidergl,arguments)},!0):!1},SpiderGL.WebGL.Context._setup_SGL_direct_state_access=function(e,t){if(!e)return!1
if(!t)return!1
if(!e._spidergl)return!1
if(e._spidergl.dsa)return!1
var i=t,r=i._ext
r.glFunctions
return r.cb=e.getExtension("SGL_current_binding"),r.cb?(i.getBufferParameter=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentBuffer(t)
a!=e&&n.bindBuffer(t,e)
var s=n.getBufferParameter(t,i)
return a!=e&&n.bindBuffer(t,a),s},i.bufferData=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentBuffer(t)
s!=e&&a.bindBuffer(t,e),a.bufferData(t,i,r),s!=e&&a.bindBuffer(t,s)},i.bufferSubData=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentBuffer(t)
s!=e&&a.bindBuffer(t,e),a.bufferSubData(t,i,r),s!=e&&a.bindBuffer(t,s)},i.vertexAttribPointer=function(e,t,i,r,n,a,s){var o=this._ext,u=o.gl,c=u.ARRAY_BUFFER,l=o.cb.getCurrentBuffer(c)
l!=e&&u.bindBuffer(c,e),u.vertexAttribPointer(t,i,r,n,a,s),l!=e&&u.bindBuffer(c,l)},i.drawElements=function(e,t,i,r,n){var a=this._ext,s=a.gl,o=s.ELEMENT_ARRAY_BUFFER,u=a.cb.getCurrentBuffer(o)
u!=e&&s.bindBuffer(o,e),s.drawElements(t,i,r,n),u!=e&&s.bindBuffer(o,u)},i.checkFramebufferStatus=function(e,t){var i=this._ext,r=i.gl,n=i.cb.getCurrentFramebuffer(t)
n!=e&&r.bindFramebuffer(t,e)
var a=r.checkFramebufferStatus(t)
return n!=e&&r.bindFramebuffer(t,n),a},i.getFramebufferAttachmentParameter=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentFramebuffer(t)
s!=e&&a.bindFramebuffer(t,e)
var o=a.getFramebufferAttachmentParameter(t,i,r)
return s!=e&&a.bindFramebuffer(t,s),o},i.framebufferRenderbuffer=function(e,t,i,r,n){var a=this._ext,s=a.gl,o=a.cb.getCurrentFramebuffer(t)
o!=e&&s.bindFramebuffer(t,e),s.framebufferRenderbuffer(t,i,r,n),o!=e&&s.bindFramebuffer(t,o)},i.framebufferTexture2D=function(e,t,i,r,n,a){var s=this._ext,o=s.gl,u=s.cb.getCurrentFramebuffer(t)
u!=e&&o.bindFramebuffer(t,e),o.framebufferTexture2D(t,i,r,n,a),u!=e&&o.bindFramebuffer(t,u)},i.clear=function(e,t){var i=this._ext,r=i.gl,n=r.FRAMEBUFFER,a=i.cb.getCurrentFramebuffer(n)
a!=e&&r.bindFramebuffer(n,e),r.clear(t),a!=e&&r.bindFramebuffer(n,a)},i.readPixels=function(e,t,i,r,n,a,s,o){var u=this._ext,c=u.gl,l=c.FRAMEBUFFER,h=u.cb.getCurrentFramebuffer(l)
h!=e&&c.bindFramebuffer(l,e),c.readPixels(t,i,r,n,a,s,o),h!=e&&c.bindFramebuffer(l,h)},i.uniform1f=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform1f(t,i),a!=e&&n.useProgram(a)},i.uniform1fv=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform1fv(t,i),a!=e&&n.useProgram(a)},i.uniform1i=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform1i(t,i),a!=e&&n.useProgram(a)},i.uniform1iv=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform1iv(t,i),a!=e&&n.useProgram(a)},i.uniform2f=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentProgram()
s!=e&&a.useProgram(e),a.uniform2f(t,i,r),s!=e&&a.useProgram(s)},i.uniform2fv=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform2fv(t,i),a!=e&&n.useProgram(a)},i.uniform2i=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentProgram()
s!=e&&a.useProgram(e),a.uniform2i(t,i,r),s!=e&&a.useProgram(s)},i.uniform2iv=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform2iv(t,i),a!=e&&n.useProgram(a)},i.uniform3f=function(e,t,i,r,n){var a=this._ext,s=a.gl,o=a.cb.getCurrentProgram()
o!=e&&s.useProgram(e),s.uniform3f(t,i,r,n),o!=e&&s.useProgram(o)},i.uniform3fv=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform3fv(t,i),a!=e&&n.useProgram(a)},i.uniform3i=function(e,t,i,r,n){var a=this._ext,s=a.gl,o=a.cb.getCurrentProgram()
o!=e&&s.useProgram(e),s.uniform3i(t,i,r,n),o!=e&&s.useProgram(o)},i.uniform3iv=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform3iv(t,i),a!=e&&n.useProgram(a)},i.uniform4f=function(e,t,i,r,n,a){var s=this._ext,o=s.gl,u=s.cb.getCurrentProgram()
u!=e&&o.useProgram(e),o.uniform4f(t,i,r,n,a),u!=e&&o.useProgram(u)},i.uniform4fv=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform4fv(t,i),a!=e&&n.useProgram(a)},i.uniform4i=function(e,t,i,r,n,a){var s=this._ext,o=s.gl,u=s.cb.getCurrentProgram()
u!=e&&o.useProgram(e),o.uniform4i(t,i,r,n,a),u!=e&&o.useProgram(u)},i.uniform4iv=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentProgram()
a!=e&&n.useProgram(e),n.uniform4iv(t,i),a!=e&&n.useProgram(a)},i.uniformMatrix2fv=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentProgram()
s!=e&&a.useProgram(e),a.uniformMatrix2fv(t,i,r),s!=e&&a.useProgram(s)},i.uniformMatrix3fv=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentProgram()
s!=e&&a.useProgram(e),a.uniformMatrix3fv(t,i,r),s!=e&&a.useProgram(s)},i.uniformMatrix4fv=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentProgram()
s!=e&&a.useProgram(e),a.uniformMatrix4fv(t,i,r),s!=e&&a.useProgram(s)},i.getRenderbufferParameter=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentRenderbuffer(t)
a!=e&&n.bindRenderbuffer(t,e)
var s=n.getRenderbufferParameter.call(n,t,i)
return a!=e&&n.bindRenderbuffer(t,a),s},i.renderbufferStorage=function(e,t,i,r,n){var a=this._ext,s=a.gl,o=a.cb.getCurrentRenderbuffer(t)
o!=e&&s.bindRenderbuffer(t,e),s.renderbufferStorage(t,i,r,n),o!=e&&s.bindRenderbuffer(t,o)},i.shaderIsNull=function(e){return null==e},r.textureTargetMap={},r.textureTargetMap[e.TEXTURE_2D]=e.TEXTURE_2D,r.textureTargetMap[e.TEXTURE_CUBE_MAP]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_X]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_X]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_Y]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_Y]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_Z]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_Z]=e.TEXTURE_CUBE_MAP,i.getTexParameter=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb.getCurrentTexture(t)
a!=e&&n.bindTexture(t,e)
var s=n.getTexParameter(t,i)
return a!=e&&n.bindTexture(t,a),s},i.copyTexImage2D=function(e,t,i,r,n,a,s,o,u){var c=this._ext,l=c.gl,h=c.textureTargetMap[t],d=c.cb.getCurrentTexture(h)
d!=e&&l.bindTexture(h,e),l.copyTexImage2D(t,i,r,n,a,s,o,u),d!=e&&l.bindTexture(h,d)},i.copyTexSubImage2D=function(e,t,i,r,n,a,s,o,u,c){var l=this._ext,h=l.gl,d=l.textureTargetMap[t],p=l.cb.getCurrentTexture(d)
p!=e&&h.bindTexture(d,e),h.copyTexSubImage2D(t,i,r,n,a,s,o,u,c),p!=e&&h.bindTexture(d,p)},i.generateMipmap=function(e,t){var i=this._ext,r=i.gl,n=i.cb.getCurrentTexture(t)
n!=e&&r.bindTexture(t,e),r.generateMipmap(t),n!=e&&r.bindTexture(t,n)},i.texImage2D=function(e,t){var i=this._ext,r=i.gl,n=i.textureTargetMap[t],a=i.cb.getCurrentTexture(n)
a!=e&&r.bindTexture(n,e)
var s=Array.prototype.slice.call(arguments,1)
r.texImage2D.apply(r,s),a!=e&&r.bindTexture(n,a)},i.texParameterf=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentTexture(t)
s!=e&&a.bindTexture(t,e),a.texParameterf(t,i,r),s!=e&&a.bindTexture(t,s)},i.texParameteri=function(e,t,i,r){var n=this._ext,a=n.gl,s=n.cb.getCurrentTexture(t)
s!=e&&a.bindTexture(t,e),a.texParameteri(t,i,r),s!=e&&a.bindTexture(t,s)},i.texSubImage2D=function(e,t){var i=this._ext,r=i.gl,n=i.textureTargetMap[t],a=i.cb.getCurrentTexture(n)
a!=e&&r.bindTexture(n,e)
var s=Array.prototype.slice.call(arguments,1)
r.texSubImage2D.apply(r,s),a!=e&&r.bindTexture(n,a)},i.bindTexture=function(e,t,i){var r=this._ext,n=r.gl,a=r.cb,s=a.getCurrentTextureUnit()
s!=e&&n.activeTexture(e),n.bindTexture(t,i),s!=e&&n.activeTexture(s)},!0):!1},SpiderGL.WebGL.Context.hijack=function(e){if(e._spidergl)return!1
SpiderGL.WebGL.Context._prepareContex(e),SpiderGL.WebGL.Context._addExtension(e,"SGL_current_binding","cb",SpiderGL.WebGL.Context._setup_SGL_current_binding),SpiderGL.WebGL.Context._addExtension(e,"SGL_wrapper_notify","wn",SpiderGL.WebGL.Context._setup_SGL_wrapper_notify),SpiderGL.WebGL.Context._addExtension(e,"SGL_direct_state_access","dsa",SpiderGL.WebGL.Context._setup_SGL_direct_state_access)
var t=e.getExtension("SGL_current_binding"),i=e.getExtension("SGL_wrapper_notify"),r=e.getExtension("SGL_direct_state_access"),n=!!t&&!!i&&!!r
return n},SpiderGL.WebGL.Context.isHijacked=function(e){return!!e&&!!e._spidergl},SpiderGL.WebGL.Context.getHijacked=function(e,t){var i=SpiderGL.WebGL.Context.get(e,t)
return SpiderGL.WebGL.Context.hijack(i),i},SpiderGL.WebGL.Context.setStandardGLUnpack=function(e){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,WebGLRenderingContext.prototype.NONE)},SpiderGL.WebGL.ObjectGL=function(e,t,i){if(!SpiderGL.WebGL.Context.isHijacked(e))return null
i=SpiderGL.Utility.getDefaultObject({handle:null},i),SpiderGL.Core.ObjectBase.call(this)
e.getExtension("SGL_wrapper_notify")
this._gl=e,this._cb=e.getExtension("SGL_current_binding"),this._dsa=e.getExtension("SGL_direct_state_access"),this._h=i.handle,this._t=t},SpiderGL.WebGL.ObjectGL.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.ObjectGL.unbind=function(e){},SpiderGL.WebGL.ObjectGL.prototype={get gl(){return this._gl},get handle(){return this._h},get target(){return this._t},get isValid(){return null!=this._h},get isReady(){return!1},destroy:function(){},bind:function(){},unbind:function(){}},SpiderGL.Type.extend(SpiderGL.WebGL.ObjectGL,SpiderGL.Core.ObjectBase),SpiderGL.WebGL.Buffer=function(e,t,i){if(!SpiderGL.WebGL.Context.isHijacked(e))return null
if(SpiderGL.Type.instanceOf(i,WebGLBuffer)?i={handle:i}:SpiderGL.Type.instanceOf(i,ArrayBuffer)||SpiderGL.Type.isTypedArray(i)?i={data:i}:SpiderGL.Type.isNumber(i)&&(i={size:i}),i=SpiderGL.Utility.getDefaultObject({handle:null,data:null,size:0,usage:SpiderGL.WebGL.Buffer.DEFAULT_USAGE},i),SpiderGL.WebGL.ObjectGL.call(this,e,t,i),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl
var e=this._gl,r=this._cb,n=(this._dsa,this._t),a=this._h
r.pushBuffer(n),a?(e.bindBuffer(n,a),i.size=e.getBufferParameter(n,e.BUFFER_SIZE),i.usage=e.getBufferParameter(n,e.BUFFER_USAGE)):(a=e.createBuffer(),e.bindBuffer(n,a),this._h=a),r.popBuffer(n),a._spidergl=this,this._size=i.size,this._usage=i.usage,i.data?this.setData(i.data,i.usage):i.size&&this.setSize(i.size,i.usage)},SpiderGL.WebGL.Buffer.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Buffer.DEFAULT_USAGE=WebGLRenderingContext.prototype.STATIC_DRAW,SpiderGL.WebGL.Buffer.DEFAULT_SUB_DATA_OFFSET=0,SpiderGL.WebGL.Buffer.unbind=function(e){},SpiderGL.WebGL.Buffer.prototype={_gl_deleteBuffer:function(){this._h=null},_gl_isBuffer:function(){},_gl_bindBuffer:function(){},_gl_getBufferParameter:function(){},_gl_bufferData:function(){var e=arguments[1],t=arguments[2]
this._size=SpiderGL.Type.isNumber(e)?e:e.byteLength,this._usage=t},_gl_bufferSubData:function(){},_gl_vertexAttribPointer:function(){},_gl_drawElements:function(){},get isReady(){return this._size>0},get size(){return this._size},get usage(){return this._usage},setSize:function(e,t){t=SpiderGL.Utility.getDefaultValue(t,SpiderGL.WebGL.Buffer.DEFAULT_USAGE),this._dsa.bufferData(this._h,this._t,e,t)},setData:function(e,t){t=SpiderGL.Utility.getDefaultValue(t,SpiderGL.WebGL.Buffer.DEFAULT_USAGE),this._dsa.bufferData(this._h,this._t,e,t)},setSubData:function(e,t){t=SpiderGL.Utility.getDefaultValue(t,SpiderGL.WebGL.Buffer.DEFAULT_SUB_DATA_OFFSET),this._dsa.bufferSubData(this._h,this._t,t,e)},destroy:function(){this._gl.deleteBuffer(this._h)},bind:function(){this._gl.bindBuffer(this._t,this._h)},unbind:function(){this._gl.bindBuffer(this._t,null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Buffer,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.VertexBuffer=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Buffer.call(this,e,SpiderGL.WebGL.VertexBuffer.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:void 0):null},SpiderGL.WebGL.VertexBuffer.TARGET=WebGLRenderingContext.prototype.ARRAY_BUFFER,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_INDEX=0,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_SIZE=3,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_TYPE=WebGLRenderingContext.prototype.FLOAT,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_NORMALIZED=!1,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_STRIDE=0,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_OFFSET=0,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_ENABLE=!0,SpiderGL.WebGL.VertexBuffer.unbind=function(e){e.bindBuffer(SpiderGL.WebGL.VertexBuffer.TARGET,null)},SpiderGL.WebGL.VertexBuffer.prototype={vertexAttribPointer:function(e){e=SpiderGL.Utility.getDefaultObject({index:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_INDEX,size:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_SIZE,glType:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_TYPE,normalized:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_NORMALIZED,stride:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_STRIDE,offset:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_OFFSET,enable:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_ENABLE},e),this._dsa.vertexAttribPointer(this._h,e.index,e.size,e.glType,e.normalized,e.stride,e.offset),e.enable&&this._gl.enableVertexAttribArray(e.index)}},SpiderGL.Type.extend(SpiderGL.WebGL.VertexBuffer,SpiderGL.WebGL.Buffer),SpiderGL.WebGL.IndexBuffer=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Buffer.call(this,e,SpiderGL.WebGL.IndexBuffer.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:void 0):null},SpiderGL.WebGL.IndexBuffer.TARGET=WebGLRenderingContext.prototype.ELEMENT_ARRAY_BUFFER,SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_MODE=WebGLRenderingContext.prototype.TRIANGLES,SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_COUNT=-1,SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_TYPE=WebGLRenderingContext.prototype.UNSIGNED_SHORT,SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_OFFSET=0,SpiderGL.WebGL.IndexBuffer.unbind=function(e){e.bindBuffer(SpiderGL.WebGL.IndexBuffer.TARGET,null)},SpiderGL.WebGL.IndexBuffer.prototype={drawElements:function(e){if(e=SpiderGL.Utility.getDefaultObject({glMode:SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_MODE,count:SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_COUNT,glType:SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_TYPE,offset:SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_OFFSET},e),e.count<1){var t=SpiderGL.Type.typeSizeFromGL(e.glType)
e.count=(this._size-e.offset)/t}this._dsa.drawElements(this._h,e.glMode,e.count,e.glType,e.offset)}},SpiderGL.Type.extend(SpiderGL.WebGL.IndexBuffer,SpiderGL.WebGL.Buffer),SpiderGL.WebGL.Framebuffer=function(e,t){if(!SpiderGL.WebGL.Context.isHijacked(e))return null
SpiderGL.Type.instanceOf(t,WebGLFramebuffer)&&(t={handle:t}),t=SpiderGL.Utility.getDefaultObject({handle:null,autoViewport:SpiderGL.WebGL.Framebuffer.DEFAULT_AUTO_VIEWPORT},t)
SpiderGL.WebGL.ObjectGL.call(this,e,SpiderGL.WebGL.Framebuffer.TARGET,t)
if(this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl
var e=this._gl,i=this._cb,r=(this._dsa,this._t),n=this._h,a=!1
if(n?a=!0:(n=e.createFramebuffer(),this._h=n),n._spidergl=this,this._attachments={},this._status=0,this._autoViewport=t.autoViewport,this._viewport=[0,0,1,1],i.pushFramebuffer(r),e.bindFramebuffer(r,n),a){var s=null,o=0,u=0,c=0
for(var l in SpiderGL.WebGL.Framebuffer._attachmentName)switch(s=e.getFramebufferAttachmentParameter(r,att,e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME),o=e.getFramebufferAttachmentParameter(r,att,e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)){case e.RENDERBUFFER:c=e.RENDERBUFFER,this._importRenderbuffer(r,l,c,s)
break
case e.TEXTURE:u=e.getFramebufferAttachmentParameter(r,att,e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL),c=e.getFramebufferAttachmentParameter(r,att,e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE),0==c&&(c=e.TEXTURE_2D),this._importTexture(r,l,c,s,u)}}this._status=e.checkFramebufferStatus(r),i.popFramebuffer(r),this.setAttachments(t)},SpiderGL.WebGL.Framebuffer.TARGET=WebGLRenderingContext.prototype.FRAMEBUFFER,SpiderGL.WebGL.Framebuffer.DEFAULT_AUTO_VIEWPORT=!0,SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_TEXTURE_LEVEL=0,SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_CUBE_MAP_FACE=WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_X=0,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_Y=0,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_WIDTH=-1,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_HEIGHT=-1,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_FORMAT=WebGLRenderingContext.prototype.RGBA,SpiderGL.WebGL.Framebuffer.DEFAULT_CLEAR_MASK=WebGLRenderingContext.prototype.COLOR_BUFFER_BIT|WebGLRenderingContext.prototype.DEPTH_BUFFER_BIT|WebGLRenderingContext.prototype.STENCIL_BUFFER_BIT,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_TYPE=WebGLRenderingContext.prototype.UNSIGNED_BYTE,SpiderGL.WebGL.Framebuffer.unbind=function(e){e.bindFramebuffer(SpiderGL.WebGL.Framebuffer.TARGET,null)},SpiderGL.WebGL.Framebuffer._attachmentName={},SpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.COLOR_ATTACHMENT0]="color",SpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.DEPTH_ATTACHMENT]="depth",SpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.STENCIL_ATTACHMENT]="stencil",SpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.DEPTH_STENCIL_ATTACHMENT]="depthStencil",SpiderGL.WebGL.Framebuffer.prototype={_gl_deleteFramebuffer:function(e){this._h=null},_gl_isFramebuffer:function(e){},_gl_bindFramebuffer:function(e,t){},_gl_checkFramebufferStatus:function(e){},_gl_getFramebufferAttachmentParameter:function(e,t,i){},_gl_framebufferRenderbuffer:function(e,t,i,r){this._importRenderbuffer.apply(this,arguments),this._status=this._gl.checkFramebufferStatus(this._t)},_gl_framebufferTexture2D:function(e,t,i,r,n){this._importTexture.apply(this,arguments),this._status=this._gl.checkFramebufferStatus(this._t)},_gl_clear:function(e){},_gl_readPixels:function(e,t,i,r,n,a,s){},_importTexture:function(e,t,i,r,n){var a=SpiderGL.WebGL.Framebuffer._attachmentName[t]
if(a){if(!r)return void delete this._attachments[a]
var s=this._gl,o={attachment:t,resource:null,target:i,level:n,face:s.NONE}
this._attachments[a]=o,i==s.TEXTURE_2D?o.resource=new SpiderGL.WebGL.Texture2D(s,{handle:r}):(o.resource=new SpiderGL.WebGL.TextureCubeMap(s,{handle:r}),o.face=i),this._viewport=[0,0,SpiderGL.Math.max(o.resource.width,1),SpiderGL.Math.max(o.resource.height,1)]}},_importRenderbuffer:function(e,t,i,r){var n=SpiderGL.WebGL.Framebuffer._attachmentName[t]
if(n){if(!r)return void delete this._attachments[n]
var a=this._gl,s={attachment:t,resource:null,target:i,level:0,face:a.NONE}
this._attachments[n]=s,s.resource=new SpiderGL.WebGL.Renderbuffer(a,{handle:r}),this._viewport=[0,0,SpiderGL.Math.max(s.resource.width,1),SpiderGL.Math.max(s.resource.height,1)]}},_setAttachment:function(e,t){var i=SpiderGL.WebGL.Framebuffer._attachmentName[e]
if(!i)return!1
var r=this._gl,n=!t||"resource"in t&&!t.resource
if(n){var a=this._attachments[i]
return void(a&&(a.target===r.RENDERBUFFER?r.framebufferRenderbuffer(u,a.attachment,r.RENDERBUFFER,null):r.framebufferTexture2D(u,a.attachment,r.TEXTURE_2D,null,0)))}var s=r.NONE
SpiderGL.Type.instanceOf(t,WebGLTexture)?(t={resource:t},s=r.TEXTURE):SpiderGL.Type.instanceOf(t,WebGLRenderbuffer)?(t={resource:t},s=r.RENDERBUFFER):SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.Texture)?(t={resource:t.handle},s=r.TEXTURE):SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.Renderbuffer)&&(t={resource:t.handle},s=r.RENDERBUFFER)
var o=!!t&&"undefined"!=typeof t.face
t=SpiderGL.Utility.getDefaultObject({resource:null,level:SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_TEXTURE_LEVEL,face:SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_CUBE_MAP_FACE},t)
var u=this._t
switch(s){case r.TEXTURE:var c=SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.TextureCubeMap)||o,l=c?t.face:r.TEXTURE_2D
r.framebufferTexture2D(u,e,l,t.resource,t.level)
break
case r.RENDERBUFFER:r.framebufferRenderbuffer(u,e,r.RENDERBUFFER,t.resource)}return!0},get isReady(){return this.isComplete},get status(){return this._status},get isComplete(){return this._status===this._gl.FRAMEBUFFER_COMPLETE},get viewport(){return this._viewport.slice()},get width(){return this._viewport[2]},get height(){return this._viewport[3]},get autoViewport(){return this._autoViewport},set autoViewport(e){this._autoViewport=!!e},setAttachments:function(e){e=e||{}
var t=this._gl,i=this._cb,r=this._t,n=this._h
return i.pushFramebuffer(r),t.bindFramebuffer(r,n),"color"in e&&this._setAttachment(t.COLOR_ATTACHMENT0,e.color),"depthStencil"in e?(this._setAttachment(t.DEPTH_ATTACHMENT,null),this._setAttachment(t.STENCIL_ATTACHMENT,null),this._setAttachment(t.DEPTH_STENCIL_ATTACHMENT,e.depthStencil)):"depth"in e?(this._setAttachment(t.DEPTH_STENCIL_ATTACHMENT,null),this._setAttachment(t.STENCIL_ATTACHMENT,null),this._setAttachment(t.DEPTH_ATTACHMENT,e.depth)):"stencil"in e&&(this._setAttachment(t.DEPTH_STENCIL_ATTACHMENT,null),this._setAttachment(t.DEPTH_ATTACHMENT,null),this._setAttachment(t.STENCIL_ATTACHMENT,e.stencil)),this._status=t.checkFramebufferStatus(r),i.popFramebuffer(r),this.isComplete},getAttachments:function(){var e={},t=null
for(var i in this._attachments)t=this._attachments[i],e[i]={attachment:t.attachment,resource:t.resource,target:t.target,level:t.level}
return e},detachAll:function(){this.setAttachments({color:null,depthStencil:null})},get colorTarget(){var e=this._attachments.color
return e?e.resource:null},set colorTarget(e){this.setAttachments({color:e})},get depthTarget(){var e=this._attachments.depth
return e?e.resource:null},set depthTarget(e){this.setAttachments({depth:e})},get stencilTarget(){var e=this._attachments.stencil
return e?e.resource:null},set stencilTarget(e){this.setAttachments({stencil:e})},get depthStencilTarget(){var e=this._attachments.depthStencil
return e?e.resource:null},set depthStencilTarget(e){this.setAttachments({depthStencil:e})},clear:function(e){e=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Framebuffer.DEFAULT_CLEAR_MASK),this._dsa.clear(this._h,e)},readPixels:function(e,t){t=SpiderGL.Utility.getDefaultObject({x:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_X,y:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_Y,width:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_WIDTH,height:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_HEIGHT,format:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_FORMAT,type:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_TYPE},t),t.width<0&&(t.width=this._viewport[2]),t.height<0&&(t.height=this._viewport[3]),this._dsa.readPixels(this._h,t.x,t.y,t.width,t.height,t.format,t.type,e)},applyViewport:function(){var e=this._gl,t=this._viewport
e.viewport(t[0],t[1],t[2],t[3])},destroy:function(){this._gl.deleteFramebuffer(this._h)},bind:function(e){var t=this._gl
t.bindFramebuffer(this._t,this._h)
var i=SpiderGL.Utility.getDefaultValue(e,this._autoViewport)
if(i){var r=this._viewport
t.viewport(r[0],r[1],r[2],r[3])}},unbind:function(){this._gl.bindFramebuffer(this._t,null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Framebuffer,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.Program=function(e,t){if(!SpiderGL.WebGL.Context.isHijacked(e))return null
if(SpiderGL.Type.instanceOf(t,WebGLProgram)&&(t={handle:t}),t=SpiderGL.Utility.getDefaultObject({handle:null,autoLink:SpiderGL.WebGL.Program.DEFAULT_AUTO_LINK},t),SpiderGL.WebGL.ObjectGL.call(this,e,SpiderGL.WebGL.Program.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl
var e=this._gl,i=(this._cb,this._dsa,this._h),r=!1,n="",a=!1
if(i?(a=!0,r=!!e.getProgramParameter(i,e.LINK_STATUS),n=e.getProgramInfoLog(i),n||(n="")):(i=e.createProgram(),this._h=i),i._spidergl=this,this._shaders=[],this._linked=r,this._log=n,this._autoLink=t.autoLink,this._attributes={},this._uniforms={},a)for(var s=e.getAttachedShaders(i),o=0,u=s.length;u>o;++o)this._importShader(s[o])
var c=!1
this._addShaders(t.shaders)&&(c=!0),this._setAttributes(t.attributes)&&(c=!0),c&&this._autoLink?this.link():a&&this._postLink(),this.setUniforms(t.uniforms)},SpiderGL.WebGL.Program.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Program.DEFAULT_AUTO_LINK=!0,SpiderGL.WebGL.Program.unbind=function(e){e.useProgram(null)},SpiderGL.WebGL.Program._uniformSetFunctions={},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL]=function(e,t,i){e.uniform1i(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC2]=function(e,t,i){e.uniform2iv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC3]=function(e,t,i){e.uniform3iv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC4]=function(e,t,i){e.uniform4iv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT]=function(e,t,i){e.uniform1i(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC2]=function(e,t,i){e.uniform2iv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC3]=function(e,t,i){e.uniform3iv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC4]=function(e,t,i){e.uniform4iv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT]=function(e,t,i){e.uniform1f(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC2]=function(e,t,i){e.uniform2fv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC3]=function(e,t,i){e.uniform3fv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC4]=function(e,t,i){e.uniform4fv(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT2]=function(e,t,i){e.uniformMatrix2fv(t,this.location,!1,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT3]=function(e,t,i){e.uniformMatrix3fv(t,this.location,!1,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT4]=function(e,t,i){e.uniformMatrix4fv(t,this.location,!1,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.SAMPLER_2D]=function(e,t,i){e.uniform1i(t,this.location,i)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.SAMPLER_CUBE]=function(e,t,i){e.uniform1i(t,this.location,i)},SpiderGL.WebGL.Program.prototype={_gl_deleteProgram:function(e){this._h=null},_gl_isProgram:function(e){},_gl_useProgram:function(e){},_gl_getActiveAttrib:function(e,t){},_gl_getActiveUniform:function(e,t){},_gl_getAttachedShaders:function(e){},_gl_getAttribLocation:function(e,t){},_gl_getProgramParameter:function(e,t){},_gl_getProgramInfoLog:function(e){},_gl_getUniform:function(e,t){},_gl_getUniformLocation:function(e,t){},_gl_attachShader:function(e,t){this._importShader(t)},_gl_bindAttribLocation:function(e,t,i){},_gl_detachShader:function(e,t){if(t){var i=this._shaderHandleIndex(t)
0>i||this._shaders.splice(i,1)}},_gl_linkProgram:function(e){this._postLink()},_gl_uniform1f:function(e,t){},_gl_uniform1fv:function(e,t){},_gl_uniform1i:function(e,t){},_gl_uniform1iv:function(e,t){},_gl_uniform2f:function(e,t,i){},_gl_uniform2fv:function(e,t){},_gl_uniform2i:function(e,t,i){},_gl_uniform2iv:function(e,t){},_gl_uniform3f:function(e,t,i,r){},_gl_uniform3fv:function(e,t){},_gl_uniform3i:function(e,t,i,r){},_gl_uniform3iv:function(e,t){},_gl_uniform4f:function(e,t,i,r,n){},_gl_uniform4fv:function(e,t){},_gl_uniform4i:function(e,t,i,r,n){},_gl_uniform4iv:function(e,t){},_gl_uniformMatrix2fv:function(e,t,i){},_gl_uniformMatrix3fv:function(e,t,i){},_gl_uniformMatrix4fv:function(e,t,i){},_gl_validateProgram:function(e){},_shaderHandleIndex:function(e){for(var t=0,i=this._shaders.length;i>t;++t)if(this._shaders[t].handle===e)return t
return-1},_shaderIndex:function(e){if(this._shaders.indexOf)return this._shaders.indexOf(e)
for(var t=0,i=this._shaders.length;i>t;++t)if(this._shaders[t]===e)return t
return-1},_importShader:function(e){if(e&&!(this._shaderHandleIndex(e)>=0)){var t=this._gl,i=e._spidergl
if(!i){var r=t.getShaderParameter(e,t.SHADER_TYPE)
switch(r){case t.VERTEX_SHADER:i=new SpiderGL.WebGL.VertexShader(t,{handle:e})
break
case t.FRAGMENT_SHADER:i=new SpiderGL.WebGL.FragmentShader(t,{handle:e})
break
default:return}}this._shaders.push(i)}},_updateActiveInfo:function(){var e=this._gl,t=this._h,i=0,r=null,n=null,a=null,s={}
i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES)
for(var o=0;i>o;++o)r=e.getActiveAttrib(t,o),n=r.name,a=e.getAttribLocation(t,n),s[n]={index:o,name:n,size:r.size,type:r.type,location:a}
var u={}
i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS)
for(var o=0;i>o;++o)if(r=e.getActiveUniform(t,o),n=r.name,a=e.getUniformLocation(t,n),u[n]={index:o,name:n,size:r.size,type:r.type,location:a,setValue:SpiderGL.WebGL.Program._uniformSetFunctions[r.type]},r.size>1){var c=n.lastIndexOf("[0]")
if(c==n.length-3)for(var l=n.slice(0,c),h=1;h<r.size;++h){var d=l+"["+h+"]"
a=e.getUniformLocation(t,d),u[d]={index:o,name:d,size:r.size,type:r.type,location:a,setValue:SpiderGL.WebGL.Program._uniformSetFunctions[r.type]}}}this._attributes=s,this._uniforms=u},_postLink:function(){var e=this._gl,t=this._h
this._linked=!!e.getProgramParameter(t,e.LINK_STATUS),this._log=e.getProgramInfoLog(t),this._log||(this._log=""),this._updateActiveInfo()},_addShaders:function(e){if(!e)return!1
for(var t=this._gl,i=this._h,r=null,n=null,a=0,s=e.length;s>a;++a)r=e[a],n=null,SpiderGL.Type.instanceOf(r,SpiderGL.WebGL.Shader)&&(n=r.handle),SpiderGL.Type.instanceOf(r,WebGLShader)&&(n=r),n&&t.attachShader(i,n)
return!0},_removeShaders:function(e){if(!e)return!1
for(var t=this._gl,i=this._h,r=null,n=null,a=0,s=e.length;s>a;++a)r=e[a],n=null,SpiderGL.Type.instanceOf(r,SpiderGL.WebGL.Shader)&&(n=r.handle),SpiderGL.Type.instanceOf(r,SpiderGL.WebGL.Shader)&&(n=r),n&&t.detachShader(i,n)
return!0},_setAttributes:function(e){if(!e)return!1
var t=this._gl,i=this._h
for(var r in e)t.bindAttribLocation(i,e[r],r)
return!0},get isReady(){return this.isLinked},get isLinked(){return this._linked},get log(){return this._log},get autoLink(){return this._autoLink},set autoLink(e){this._autoLink=!!e},addShaders:function(e,t){var i=this._addShaders(e)
return i?(i=SpiderGL.Utility.getDefaultValue(t,this._autoLink),i?this.link():!0):!0},removeShaders:function(e,t){var i=this._removeShaders(e)
return i?(i=SpiderGL.Utility.getDefaultValue(t,this._autoLink),i?this.link():!0):!0},hasShader:function(e){return this._shaderIndex(e)>=0},getShaders:function(){return this._shaders.slice()},link:function(){return this._gl.linkProgram(this._h),this._linked},validate:function(){var e=this._gl,t=this._h
e.validateProgram(t)
var i=!!e.getProgramParameter(t,e.VALIDATE_STATUS)
return i},setAttributes:function(e){return this._setAttributes(e)?this._autoLink?this.link():!0:!1},getAttributesNames:function(){var e=this._attributes,t=[]
for(var i in e)t.push(e[i].name)
return t},getAttributesIndices:function(){var e=this._attributes,t={}
for(var i in e)t[i]=e[i].location
return t},getAttributesInfo:function(){var e=this._attributes,t=null,i={}
for(var r in e)t=e[r],i[r]={index:t.index,name:t.name,size:t.size,type:t.type,location:t.location}
return i},setUniforms:function(e){if(!e)return!1
var t=this._gl,i=this._cb,r=this._dsa,n=this._h
i.pushProgram(),t.useProgram(n)
var a=this._uniforms,s=null
for(var o in e)s=a[o],s&&s.setValue(r,n,e[o])
return i.popProgram(),!0},getUniformsNames:function(){var e=this._uniforms,t=[]
for(var i in e)t.push(e[i].name)
return t},getUniformsValues:function(){var e=this._gl,t=this._h,i=this._uniforms,r={}
for(var n in i)r[n]=e.getUniform(t,i[n].location)
return r},getUniformsInfo:function(){var e=this._uniforms,t=null,i={}
for(var r in e)t=e[r],i[r]={index:t.index,name:t.name,size:t.size,type:t.type,location:t.location}
return i},destroy:function(){this._gl.deleteProgram(this._h)},bind:function(){this._gl.useProgram(this._h)},unbind:function(){this._gl.useProgram(null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Program,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.Renderbuffer=function(e,t){if(!SpiderGL.WebGL.Context.isHijacked(e))return null
if(SpiderGL.Type.instanceOf(n,WebGLRenderbuffer)&&(t={handle:t}),t=SpiderGL.Utility.getDefaultObject({handle:null},t),SpiderGL.WebGL.ObjectGL.call(this,e,SpiderGL.WebGL.Renderbuffer.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl
var e=this._gl,i=this._cb,r=(this._dsa,this._t),n=this._h,a=e.NONE,s=0,o=0
n?(i.pushRenderbuffer(r),e.bindRenderbuffer(r,n),a=e.getRenderbufferParameter(r,e.RENDERBUFFER_INTERNAL_FORMAT),s=e.getRenderbufferParameter(r,e.RENDERBUFFER_WIDTH),o=e.getRenderbufferParameter(r,e.RENDERBUFFER_HEIGHT),i.popRenderbuffer(r)):(n=e.createRenderbuffer(),this._h=n),n._spidergl=this,this._width=s,this._height=o,this._format=a,SpiderGL.Type.isNumber(t.internalFormat)&&SpiderGL.Type.isNumber(t.width)&&SpiderGL.Type.isNumber(t.height)&&this.setStorage(t.internalFormat,t.width,t.height,t.format)},SpiderGL.WebGL.Renderbuffer.TARGET=WebGLRenderingContext.prototype.RENDERBUFFER,SpiderGL.WebGL.Renderbuffer.unbind=function(e){e.bindRenderbuffer(SpiderGL.WebGL.Renderbuffer.TARGET,null)},SpiderGL.WebGL.Renderbuffer.prototype={_gl_deleteRenderbuffer:function(e){this._h=null},_gl_isRenderbuffer:function(e){},_gl_bindRenderbuffer:function(e,t){},_gl_getRenderbufferParameter:function(e,t){},_gl_renderbufferStorage:function(e,t,i,r){this._format=t,this._width=i,this._height=r},get isReady(){return this._width>0&&this._height>0},get format(){return this._format},get width(){return this._width},get height(){return this._height},setStorage:function(e,t,i){this._dsa.renderbufferStorage(this._h,this._t,e,t,i)},destroy:function(){this._gl.deleteRenderbuffer(this._h)},bind:function(){this._gl.bindRenderbuffer(this._t,this._h)},unbind:function(){this._gl.bindRenderbuffer(this._t,null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Renderbuffer,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.Shader=function(e,t,i,r){if(!SpiderGL.WebGL.Context.isHijacked(e))return null
if(SpiderGL.Type.instanceOf(r,WebGLShader)?r={handle:r}:SpiderGL.Type.isString(r)&&(r={source:r}),r=SpiderGL.Utility.getDefaultObject({handle:null,source:null,autoCompile:SpiderGL.WebGL.Shader.DEFAULT_AUTO_COMPILE},r),SpiderGL.WebGL.ObjectGL.call(this,e,t,r),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl
var e=this._gl,n=(this._cb,this._dsa,""),a=!1,s=!1,o="",u=this._h
u?(n=e.getShaderSource(u),n||(n=""),a=!!e.getShaderParameter(u,e.COMPILE_STATUS),s=!!e.getShaderParameter(u,e.DELETE_STATUS),o=e.getShaderInfoLog(u),o||(o="")):(u=e.createShader(i),this._h=u),u._spidergl=this,this._source=n,this._compiled=a,this._log=o,this._autoCompile=r.autoCompile,r.source&&this.setSource(r.source)},SpiderGL.WebGL.Shader.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Shader.DEFAULT_AUTO_COMPILE=!0,SpiderGL.WebGL.Shader.unbind=function(e){},SpiderGL.WebGL.Shader.prototype={_gl_deleteShader:function(e){this._h=null},_gl_isShader:function(e){},_gl_getShaderParameter:function(e,t){},_gl_getShaderInfoLog:function(e){},_gl_getShaderSource:function(e){},_gl_compileShader:function(e){this._postCompile()},_gl_shaderSource:function(e,t){this._source=t,this._source||(this._source="")},_postCompile:function(){var e=this._gl,t=this._h
this._compiled=!!e.getShaderParameter(t,e.COMPILE_STATUS),this._log=e.getShaderInfoLog(t),this._log||(this._log="")},get isReady(){return this.isCompiled},get isCompiled(){return this._compiled},get log(){return this._log},get autoCompile(){return this._autoCompile},set autoCompile(e){this._autoCompile=!!e},setSource:function(e,t){var i=this._gl,r=this._h
i.shaderSource(r,e)
SpiderGL.Utility.getDefaultValue(t,this._autoCompile)
return this.compile()},get source(){return this._source},set source(e){this.setSource(e)},compile:function(){return this._gl.compileShader(this._h),this._compiled},destroy:function(){this._gl.deleteShader(this._h)},bind:function(){},unbind:function(){}},SpiderGL.Type.extend(SpiderGL.WebGL.Shader,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.VertexShader=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Shader.call(this,e,SpiderGL.WebGL.VertexShader.TARGET,e.VERTEX_SHADER,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:void 0):null},SpiderGL.WebGL.VertexShader.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.VertexShader.unbind=function(e){},SpiderGL.WebGL.VertexShader.prototype={},SpiderGL.Type.extend(SpiderGL.WebGL.VertexShader,SpiderGL.WebGL.Shader),SpiderGL.WebGL.FragmentShader=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Shader.call(this,e,SpiderGL.WebGL.FragmentShader.TARGET,e.FRAGMENT_SHADER,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:void 0):null},SpiderGL.WebGL.FragmentShader.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.FragmentShader.unbind=function(e){},SpiderGL.WebGL.FragmentShader.prototype={},SpiderGL.Type.extend(SpiderGL.WebGL.FragmentShader,SpiderGL.WebGL.Shader),SpiderGL.WebGL.Texture=function(e,t,i){if(!SpiderGL.WebGL.Context.isHijacked(e))return null
if(SpiderGL.Type.instanceOf(i,WebGLTexture)?i={handle:i}:SpiderGL.Type.isString(i)&&(i={url:i}),i=SpiderGL.Utility.getDefaultObject({handle:null,magFilter:SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER,minFilter:SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER,wrapS:SpiderGL.WebGL.Texture.DEFAULT_WRAP_S,wrapT:SpiderGL.WebGL.Texture.DEFAULT_WRAP_T,flipYPolicy:SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y,premultiplyAlphaPolicy:SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA,colorspaceConversionPolicy:SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION,autoMipmap:SpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP,format:e.NONE,width:0,height:0},i),SpiderGL.WebGL.ObjectGL.call(this,e,t,i),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl
var e=this._gl,r=this._cb,n=(this._dsa,this._t),a=this._h
a||(a=e.createTexture(),this._h=a),r.pushTexture(n),e.bindTexture(n,a),this._magFilter=e.getTexParameter(n,e.TEXTURE_MAG_FILTER),this._minFilter=e.getTexParameter(n,e.TEXTURE_MIN_FILTER),this._wrapS=e.getTexParameter(n,e.TEXTURE_WRAP_S),this._wrapT=e.getTexParameter(n,e.TEXTURE_WRAP_T),r.popTexture(n),a._spidergl=this,this._format=i.format,this._width=i.width,this._height=i.height,this._flipY=i.flipYPolicy,this._premultiplyAlpha=i.premultiplyAlphaPolicy,this._colorspaceConversion=i.colorspaceConversionPolicy,this._autoMipmap=i.autoMipmap,this._missingFaces=SpiderGL.WebGL.Texture._FACE_ALL_BITS,this.setSampler(i)},SpiderGL.WebGL.Texture.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Texture.DEFAULT_BORDER=0,SpiderGL.WebGL.Texture.DEFAULT_FORMAT=WebGLRenderingContext.prototype.RGBA,SpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP=!1,SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT=WebGLRenderingContext.prototype.RGBA,SpiderGL.WebGL.Texture.DEFAULT_LEVEL=0,SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER=WebGLRenderingContext.prototype.LINEAR,SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER=WebGLRenderingContext.prototype.LINEAR,SpiderGL.WebGL.Texture.DEFAULT_TYPE=WebGLRenderingContext.prototype.UNSIGNED_BYTE,SpiderGL.WebGL.Texture.DEFAULT_WRAP_S=WebGLRenderingContext.prototype.REPEAT,SpiderGL.WebGL.Texture.DEFAULT_WRAP_T=WebGLRenderingContext.prototype.REPEAT,SpiderGL.WebGL.Texture.DEFAULT_X_OFFSET=0,SpiderGL.WebGL.Texture.DEFAULT_Y_OFFSET=0,SpiderGL.WebGL.Texture.DEFAULT_UNPACK_FLIP_Y=!0,SpiderGL.WebGL.Texture.DEFAULT_UNPACK_PREMULTIPLY_ALPHA=!1,SpiderGL.WebGL.Texture.DEFAULT_UNPACK_COLORSPACE_CONVERSION=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Texture.unbind=function(e){},SpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT=1,SpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT=2,SpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT=4,SpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT=8,SpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT=16,SpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT=32,SpiderGL.WebGL.Texture._FACE_ALL_BITS=SpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT|SpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT|SpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT|SpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT|SpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT|SpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT,SpiderGL.WebGL.Texture._faceBits={},SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_2D]=SpiderGL.WebGL.Texture._FACE_ALL_BITS,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP]=SpiderGL.WebGL.Texture._FACE_ALL_BITS,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X]=SpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_X]=SpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Y]=SpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Y]=SpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Z]=SpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Z]=SpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT,SpiderGL.WebGL.Texture.prototype={_gl_deleteTexture:function(e){this._h=null},_gl_isTexture:function(e){},_gl_bindTexture:function(e,t){},_gl_getTexParameter:function(e,t){},_gl_copyTexImage2D:function(e,t,i,r,n,a,s,o){0==t&&(this._format=i,this._width=a,this._height=s)},_gl_copyTexSubImage2D:function(e,t,i,r,n,a,s,o,u){},_gl_generateMipmap:function(e){},_gl_texImage2D:function(e){var t=arguments.length
6===t?0===arguments[1]&&(this._format=arguments[2],this._width=arguments[5].width,this._height=arguments[5].height):9===t&&0===arguments[1]&&(this._format=arguments[2],this._width=arguments[3],this._height=arguments[4])},_gl_texParameterf:function(e,t,i){this._setTexParameter(t,i)},_gl_texParameteri:function(e,t,i){this._setTexParameter(t,i)},_gl_texSubImage2D:function(e){},_setTexParameter:function(e,t){var i=this._gl
switch(e){case i.TEXTURE_MAG_FILTER:this._magFilter=t
break
case i.TEXTURE_MIN_FILTER:this._minFilter=t
break
case i.TEXTURE_WRAP_S:this._wrapS=t
break
case i.TEXTURE_WRAP_T:this._wrapT=t}},_setImageData:function(e,t,i){i=SpiderGL.Utility.getDefaultObject({internalFormat:SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT,border:SpiderGL.WebGL.Texture.DEFAULT_BORDER,xoffset:SpiderGL.WebGL.Texture.DEFAULT_X_OFFSET,yoffset:SpiderGL.WebGL.Texture.DEFAULT_Y_OFFSET,level:SpiderGL.WebGL.Texture.DEFAULT_LEVEL,format:SpiderGL.WebGL.Texture.DEFAULT_FORMAT,type:SpiderGL.WebGL.Texture.DEFAULT_TYPE,width:0,height:0,generateMipmap:this._autoMipmap,flipY:this._flipY,premultiplyAlpha:this._premultiplyAlpha,colorspaceConversion:this._colorspaceConversion,data:null,url:null,onCancel:null,onError:null,onProgress:null,onSuccess:null},i)
var r=!!i.url,n=!1
r||(n=!i.data||SpiderGL.Type.isTypedArray(i.data))
var a=!1
r||n||(a=SpiderGL.Type.instanceOf(i.data,HTMLImageElement)||SpiderGL.Type.instanceOf(i.data,HTMLCanvasElement)||SpiderGL.Type.instanceOf(i.data,HTMLVideoElement),a||"undefined"!=typeof ImageData&&(a=SpiderGL.Type.instanceOf(i.data,ImageData)))
var s=this._gl,o=(this._cb,this._dsa),u=t,c=this._h,l=-1,h=-1,d=-1,p=-1,f=-1,_=-1;(n||a)&&(l=i.flipY,l!=SpiderGL.Core.DONT_CARE&&(h=s.getParameter(s.UNPACK_FLIP_Y_WEBGL),l==h?h=-1:s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,l)),d=i.premultiplyAlpha,d!=SpiderGL.Core.DONT_CARE&&(p=s.getParameter(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL),d==p?p=-1:s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d)),f=i.colorspaceConversion,f!=SpiderGL.Core.DONT_CARE&&(_=s.getParameter(s.UNPACK_COLORSPACE_CONVERSION_WEBGL),f==_?_=-1:s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,f)))
var g=!1
if(r){var m={internalFormat:i.internalFormat,border:i.border,xoffset:i.xoffset,yoffset:i.yoffset,level:i.level,format:i.format,type:i.type,generateMipmap:i.generateMipmap,flipY:i.flipY,premultiplyAlpha:i.premultiplyAlpha,colorspaceConversion:i.colorspaceConversion,data:null},S=this,L=i.onSuccess,b=new SpiderGL.IO.ImageRequest(i.url,{onCancel:i.onCancel,onError:i.onError,onProgress:i.onProgress,onSuccess:function(){m.data=b.image,e?S._setImage(t,m):S._setSubImage(t,m),L&&L()},send:!0})
return!0}if(n){if(i.width<=0||i.height<=0)return!1
e?(o.texImage2D(c,u,i.level,i.internalFormat,i.width,i.height,i.border,i.format,i.type,i.data),g=!0):o.texSubImage2D(c,u,i.level,i.xoffset,i.yoffset,i.width,i.height,i.format,i.type,i.data)}else{if(!a)return!1
e?(o.texImage2D(c,u,i.level,i.internalFormat,i.format,i.type,i.data),g=!0):o.texSubImage2D(c,u,i.level,i.xoffset,i.yoffset,i.format,i.type,i.data)}return g&&(this._missingFaces&=~SpiderGL.WebGL.Texture._faceBits[u]),(n||a)&&(-1!=h&&s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,h),-1!=p&&s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),-1!=_&&s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,_)),i.generateMipmap&&this.generateMipmap(),!0},_setImage:function(e,t){return this._setImageData(!0,e,t)},_setSubImage:function(e,t){return this._setImageData(!1,e,t)},get isReady(){return 0==this._missingFaces&&this._width>0&&this._height>0},get flipYPolicy(){return this._flipY},set flipYPolicy(e){this._flipY=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y)},get premultuplyAlphaPolicy(){return this._premultuplyAlpha},set premultuplyAlphaPolicy(e){this._premultuplyAlpha=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA)},get colorspaceConversionPolicy(){return this._colorspaceConversion},set colorspaceConversionPolicy(e){this._colorspaceConversion=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION)},get autoMipmap(){return this._autoMipmap},set autoMipmap(e){this._autoMipmap=e},get format(){return this._format},get width(){return this._width},get height(){return this._height},get magFilter(){return this._magFilter},set magFilter(e){e=SpiderGL.Utility.getDefaultValue(w,SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER),this._dsa.texParameteri(this._h,this._t,gl.TEXTURE_MAG_FILTER,e)},get minFilter(){return this._minFilter},set minFilter(e){e=SpiderGL.Utility.getDefaultValue(w,SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER),this._dsa.texParameteri(this._h,this._t,gl.TEXTURE_MIN_FILTER,e)},get wrapS(){return this._wrapS},set wrapS(e){e=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Texture.DEFAULT_WRAP_S),this._dsa.texParameteri(this._h,this._t,gl.TEXTURE_WRAP_S,e)},get wrapT(){return this._wrapT},set wrapT(e){e=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Texture.DEFAULT_WRAP_T),this._dsa.texParameteri(this._h,this._t,gl.TEXTURE_WRAP_T,e)},setSampler:function(e){if(!e)return!1
var t=this._gl,i=this._cb,r=(this._dsa,this._t),n=this._h
i.pushTexture(r),t.bindTexture(r,n)
var a=0
return"magFilter"in e&&(a=SpiderGL.Utility.getDefaultValue(e.magFilter,SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER),t.texParameteri(r,t.TEXTURE_MAG_FILTER,a)),"minFilter"in e&&(a=SpiderGL.Utility.getDefaultValue(e.minFilter,SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER),t.texParameteri(r,t.TEXTURE_MIN_FILTER,a)),"wrapS"in e&&(a=SpiderGL.Utility.getDefaultValue(e.wrapS,SpiderGL.WebGL.Texture.DEFAULT_WRAP_S),t.texParameteri(r,t.TEXTURE_WRAP_S,a)),"wrapT"in e&&(a=SpiderGL.Utility.getDefaultValue(e.wrapT,SpiderGL.WebGL.Texture.DEFAULT_WRAP_T),t.texParameteri(r,t.TEXTURE_WRAP_T,a)),i.popTexture(r),!0},getSampler:function(){return{magFilter:this._magFilter,minFilter:this._minFilter,wrapS:this._wrapS,wrapT:this._wrapT}},generateMipmap:function(){0==this._missingFaces&&this._dsa.generateMipmap(this._h,this._t)},destroy:function(){this._gl.deleteTexture(this._h)},bind:function(e){var t=this._gl,i=(this._cb,this._dsa)
"undefined"==typeof e?t.bindTexture(this._t,this._h):i.bindTexture(t.TEXTURE0+e,this._t,this._h)},unbind:function(e){var t=this._gl,i=(this._cb,this._dsa)
"undefined"==typeof e?t.bindTexture(this._t,null):i.bindTexture(t.TEXTURE0+e,this._t,null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Texture,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.Texture2D=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Texture.call(this,e,SpiderGL.WebGL.Texture2D.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:(t=t||{},SpiderGL.Type.instanceOf(t,WebGLTexture)?t={handle:t}:SpiderGL.Type.isString(t)&&(t={url:t}),void(("url"in t||"data"in t||"width"in t&&"height"in t)&&this.setImage(t)))):null},SpiderGL.WebGL.Texture2D.TARGET=WebGLRenderingContext.prototype.TEXTURE_2D,SpiderGL.WebGL.Texture2D.unbind=function(e,t){var i=(e.getExtension("SGL_current_binding"),e.getExtension("SGL_direct_state_access"))
"undefined"==typeof t?e.bindTexture(SpiderGL.WebGL.Texture2D.TARGET,null):i.bindTexture(e.TEXTURE0+t,SpiderGL.WebGL.Texture2D.TARGET,null)},SpiderGL.WebGL.Texture2D.prototype={setImage:function(e){return this._setImage(this._t,e)},setSubImage:function(e){return this._setSubImage(this._t,e)}},SpiderGL.Type.extend(SpiderGL.WebGL.Texture2D,SpiderGL.WebGL.Texture),SpiderGL.WebGL.TextureCubeMap=function(e,t){if(!SpiderGL.WebGL.Context.isHijacked(e))return null
if(SpiderGL.WebGL.Texture.call(this,e,SpiderGL.WebGL.TextureCubeMap.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl
t=t||{},SpiderGL.Type.instanceOf(t,WebGLTexture)?t={handle:t}:SpiderGL.Type.isString(t)&&(t={url:t})
var i=SpiderGL.WebGL.TextureCubeMap._faceTargets
if(t.url){var r=t.url,n=t.onSuccess
n&&(t.onSuccess=function(){var e=6
return function(){--e,0==e&&n.apply(t,null)}}())
for(var a=0;6>a;++a)t.url=r[a],this.setImage(i[a],t)
t.onSuccess=n}else if(t.data)for(var s=t.data,a=0;6>a;++a)t.data=s[a],this.setImage(i[a],t)
else if(t.width>0&&t.height>0)for(var a=0;6>a;++a)this.setImage(i[a],t)},SpiderGL.WebGL.TextureCubeMap.TARGET=WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP,SpiderGL.WebGL.TextureCubeMap.unbind=function(e,t){var i=(e.getExtension("SGL_current_binding"),e.getExtension("SGL_direct_state_access"))
"undefined"==typeof t?e.bindTexture(SpiderGL.WebGL.TextureCubeMap.TARGET,null):i.bindTexture(e.TEXTURE0+t,SpiderGL.WebGL.TextureCubeMap.TARGET,null)},SpiderGL.WebGL.TextureCubeMap._faceTargets=[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_X,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Y,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Y,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Z,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Z],SpiderGL.WebGL.TextureCubeMap.prototype={setImage:function(e,t){return this._setImage(e,t)},setSubImage:function(e,t){return this._setSubImage(e,t)}},SpiderGL.Type.extend(SpiderGL.WebGL.TextureCubeMap,SpiderGL.WebGL.Texture),SpiderGL.Model={},SpiderGL.Model.Model=function(e,t,i){SpiderGL.Core.ObjectBase.call(this),i=SpiderGL.Utility.getDefaultObject({},i),t&&"vertices"in t&&(t=SpiderGL.Model.Model._createSimpleDescriptor(t)),this._descriptor=SpiderGL.Model.Model._fixDescriptor(t),this._gl=null,this._renderData={},e&&(this.updateGL(e,i),this.updateRenderData())},SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_SIZE=3,SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE=SpiderGL.Type.FLOAT32,SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_NORMALIZED=!1,SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_STRIDE=0,SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_OFFSET=0,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_MODE=SpiderGL.Type.TRIANGLES,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_FIRST=0,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_COUNT=-1,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE=SpiderGL.Type.UINT16,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_OFFSET=0,SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP={},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.position={size:3,type:SpiderGL.Type.FLOAT32,normalized:!1,semantic:"POSITION",index:0,value:[0,0,0,1]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.normal={size:3,type:SpiderGL.Type.FLOAT32,normalized:!1,semantic:"NORMAL",index:0,value:[0,0,1,0]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.color={size:4,type:SpiderGL.Type.UINT8,normalized:!0,semantic:"COLOR",index:0,value:[0,0,0,255]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.texcoord={size:2,type:SpiderGL.Type.FLOAT32,normalized:!1,semantic:"TEXCOORD",index:0,value:[0,0,0,1]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.user={size:3,type:SpiderGL.Type.FLOAT32,normalized:!1,semantic:"USER",index:0,value:[0,0,0,1]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP={},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.triangles={mode:SpiderGL.Type.TRIANGLES,type:SpiderGL.Type.UINT16,count:-1,semantic:"FILL"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.triangleStrip={mode:SpiderGL.Type.TRIANGLE_STRIP,type:SpiderGL.Type.UINT16,count:-1,semantic:"FILL"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.triangleFan={mode:SpiderGL.Type.TRIANGLE_FAN,type:SpiderGL.Type.UINT16,count:-1,semantic:"FILL"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.lines={mode:SpiderGL.Type.LINES,type:SpiderGL.Type.UINT16,count:-1,semantic:"LINE"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.lineStrip={mode:SpiderGL.Type.LINE_STRIP,type:SpiderGL.Type.UINT16,count:-1,semantic:"LINE"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.lineLoop={mode:SpiderGL.Type.LINE_LOOP,type:SpiderGL.Type.UINT16,count:-1,semantic:"LINE"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.points={mode:SpiderGL.Type.POINTS,type:SpiderGL.Type.UINT16,count:-1,semantic:"POINT"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.user={mode:SpiderGL.Type.TRIANGLES,type:SpiderGL.Type.UINT16,count:-1,semantic:"FILL"},SpiderGL.Model.Model._fixDescriptor=function(e){return e=SpiderGL.Utility.getDefaultObject({version:"0.0.0.1 EXP",meta:null,data:null,access:null,semantic:null,logic:null},e),e.meta=SpiderGL.Model.Model._fixDescriptorMeta(e.meta),e.data=SpiderGL.Model.Model._fixDescriptorData(e.data),e.access=SpiderGL.Model.Model._fixDescriptorAccess(e.access),e.semantic=SpiderGL.Model.Model._fixDescriptorSemantic(e.semantic),e.logic=SpiderGL.Model.Model._fixDescriptorLogic(e.logic),e},SpiderGL.Model.Model._fixDescriptorMeta=function(e){return e=SpiderGL.Utility.getDefaultObject({author:null,date:null,description:null},e)},SpiderGL.Model.Model._fixDescriptorData=function(e){return e=SpiderGL.Utility.getDefaultObject({vertexBuffers:null,indexBuffers:null},e),e.vertexBuffers=SpiderGL.Model.Model._fixDescriptorDataVertexBuffers(e.vertexBuffers),e.indexBuffers=SpiderGL.Model.Model._fixDescriptorDataIndexBuffers(e.indexBuffers),e},SpiderGL.Model.Model._fixDescriptorDataVertexBuffers=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorDataVertexBuffer(e[t])
return e},SpiderGL.Model.Model._fixDescriptorDataVertexBuffer=function(e){return SpiderGL.Model.Model._fixDescriptorDataBuffer(e)},SpiderGL.Model.Model._fixDescriptorDataIndexBuffers=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorDataIndexBuffer(e[t])
return e},SpiderGL.Model.Model._fixDescriptorDataIndexBuffer=function(e){return SpiderGL.Model.Model._fixDescriptorDataBuffer(e)},SpiderGL.Model.Model._fixDescriptorDataBuffer=function(e){return e=SpiderGL.Utility.getDefaultObject({type:SpiderGL.Type.NO_TYPE,glType:WebGLRenderingContext.prototype.NONE,untypedArray:null,typedArray:null,glBuffer:null},e)},SpiderGL.Model.Model._fixDescriptorAccess=function(e){return e=SpiderGL.Utility.getDefaultObject({vertexStreams:null,primitiveStreams:null},e),e.vertexStreams=SpiderGL.Model.Model._fixDescriptorAccessVertexStreams(e.vertexStreams),e.primitiveStreams=SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStreams(e.primitiveStreams),e},SpiderGL.Model.Model._fixDescriptorAccessVertexStreams=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorAccessVertexStream(e[t])
return e},SpiderGL.Model.Model._fixDescriptorAccessVertexStream=function(e){return e=SpiderGL.Utility.getDefaultObject({buffer:null,size:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_SIZE,type:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE,glType:SpiderGL.Type.typeToGL(SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE),normalized:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_NORMALIZED,stride:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_STRIDE,offset:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_OFFSET},e)},SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStreams=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStream(e[t])
return e},SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStream=function(e){return e=SpiderGL.Utility.getDefaultObject({buffer:null,mode:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_MODE,first:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_FIRST,count:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_COUNT,type:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE,glType:SpiderGL.Type.typeToGL(SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE),offset:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_OFFSET},e)},SpiderGL.Model.Model._fixDescriptorSemantic=function(e){return e=SpiderGL.Utility.getDefaultObject({bindings:null,chunks:null},e),e.bindings=SpiderGL.Model.Model._fixDescriptorSemanticBindings(e.bindings),e.chunks=SpiderGL.Model.Model._fixDescriptorSemanticChunks(e.chunks),e},SpiderGL.Model.Model._fixDescriptorSemanticBindings=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorSemanticBinding(e[t])
return e},SpiderGL.Model.Model._fixDescriptorSemanticBinding=function(e){return e=SpiderGL.Utility.getDefaultObject({vertexStreams:null,primitiveStreams:null},e),e.vertexStreams=SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStreams(e.vertexStreams),e.primitiveStreams=SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStreams(e.primitiveStreams),e},SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStreams=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStream(e[t])
return e},SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStream=function(e){return e?SpiderGL.Type.isArray(e)?e.slice():[e]:null},SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStreams=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStream(e[t])
return e},SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStream=function(e){return e?SpiderGL.Type.isArray(e)?e.slice():[e]:null},SpiderGL.Model.Model._fixDescriptorSemanticChunks=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorSemanticChunk(e[t])
return e},SpiderGL.Model.Model._fixDescriptorSemanticChunk=function(e){return e=SpiderGL.Utility.getDefaultObject({techniques:null},e),e.techniques=SpiderGL.Model.Model._fixDescriptorSemanticChunkTechniques(e.techniques),e},SpiderGL.Model.Model._fixDescriptorSemanticChunkTechniques=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorSemanticChunkTechnique(e[t])
return e},SpiderGL.Model.Model._fixDescriptorSemanticChunkTechnique=function(e){return e=SpiderGL.Utility.getDefaultObject({binding:null},e)},SpiderGL.Model.Model._fixDescriptorLogic=function(e){return e=SpiderGL.Utility.getDefaultObject({parts:null},e),e.parts=SpiderGL.Model.Model._fixDescriptorLogicParts(e.parts),e},SpiderGL.Model.Model._fixDescriptorLogicParts=function(e){e=SpiderGL.Utility.getDefaultObject({},e)
for(var t in e)e[t]=SpiderGL.Model.Model._fixDescriptorLogicPart(e[t])
return e},SpiderGL.Model.Model._fixDescriptorLogicPart=function(e){return e=SpiderGL.Utility.getDefaultObject({chunks:null},e),e.chunks=SpiderGL.Model.Model._fixDescriptorLogicPartChunks(e.chunks),e},SpiderGL.Model.Model._fixDescriptorLogicPartChunks=function(e){return e?SpiderGL.Type.isArray(e)?e.slice():[e]:null},SpiderGL.Model.Model._createSimpleDescriptor=function(e){e=SpiderGL.Utility.getDefaultObject({vertices:null,primitives:null,options:null},e)
var t="mainBinding",i="mainChunk",r="mainPart",n="VertexBuffer",a="IndexBuffer",s={data:{vertexBuffers:{},indexBuffers:{}},access:{vertexStreams:{},primitiveStreams:{}},semantic:{bindings:{},chunks:{}},logic:{parts:{}}},o={vertexStreams:{},primitiveStreams:{}}
s.semantic.bindings[t]=o
var u={techniques:{common:{binding:t}}}
s.semantic.chunks[i]=u
var c={chunks:[i]}
s.logic.parts[r]=c
var l=-1,h=!1,d=!1
for(var p in e.vertices){var f=e.vertices[p]
if(f){(SpiderGL.Type.isArray(f)||SpiderGL.Type.isTypedArray(f)||SpiderGL.Type.instanceOf(f,ArrayBuffer))&&(f={data:f})
var _=SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[p],g=null
_?g=_.semantic:(_=SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.user,g=p.toUpperCase())
var m=SpiderGL.Utility.getDefaultObject({size:_.size,type:_.type,normalized:_.normalized,semantic:g,index:_.index,data:null,value:_.value.slice()},f),S={buffer:null,size:m.size,type:m.type,normalized:m.normalized,stride:0,offset:0,value:m.value.slice()}
if(m.data){var L={type:m.type},b=0
if(SpiderGL.Type.isArray(m.data))L.untypedArray=m.data,b=L.untypedArray.length/S.size
else{if(!SpiderGL.Type.isTypedArray(f)&&!SpiderGL.Type.instanceOf(f,ArrayBuffer))continue
L.typedArray=m.data,b=(L.typedArray.byteLength-S.offset)/(S.size*SpiderGL.Type.typeSize(S.type))}b=SpiderGL.Math.floor(b),h=!0,l=l>=0?SpiderGL.Math.min(l,b):b
var v=p+n
s.data.vertexBuffers[v]=L,S.buffer=v}else d=!0
var x=p
s.access.vertexStreams[x]=S
var T=new Array(m.index+1)
T[m.index]=x,o.vertexStreams[m.semantic]=T}}var G=0
h?G=l:d&&(G=1)
var M=e.primitives
if(SpiderGL.Type.isString(M)&&(M=[M]),SpiderGL.Type.isArray(M)){var y=M
M={}
for(var E=0,A=y.length;A>E;++E){var P=y[E]
SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[P]&&(M[P]={})}}for(var p in M){var f=M[p]
if(f){(SpiderGL.Type.isArray(f)||SpiderGL.Type.isTypedArray(f)||SpiderGL.Type.instanceOf(f,ArrayBuffer))&&(f={data:f})
var _=SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[p]
_||(_=SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.user)
var m=SpiderGL.Utility.getDefaultObject({mode:_.mode,type:_.type,count:_.count>=0?_.count:G,semantic:_.semantic},f),S={buffer:null,mode:m.mode,first:0,count:m.count,type:m.type,offset:0}
if(m.data){var L={type:m.type},b=0
if(SpiderGL.Type.isArray(m.data))L.untypedArray=m.data,b=L.untypedArray.length
else{if(!SpiderGL.Type.isTypedArray(f)&&!SpiderGL.Type.instanceOf(f,ArrayBuffer))continue
L.typedArray=m.data,b=(L.typedArray.byteLength-S.offset)/SpiderGL.Type.typeSize(S.type)}b=SpiderGL.Math.floor(b)
var v=p+a
s.data.indexBuffers[v]=L,S.buffer=v,S.count=b}var x=p
s.access.primitiveStreams[x]=S
var T=new Array(1)
T[0]=x,o.primitiveStreams[m.semantic]=T}}return s},SpiderGL.Model.Model.prototype={get descriptor(){return this._descriptor},get isReady(){return!!this._descriptor},get gl(){return this._gl},get renderData(){return this._renderData},updateTypedArrays:function(){var e=this._descriptor
if(!e)return!1
var t=null,i=null,r=e.data.vertexBuffers
for(var n in r)t=r[n],t.untypedArray&&(i=SpiderGL.Type.typeToTypedArrayConstructor(t.type),t.typedArray=new i(t.untypedArray))
var a=e.data.indexBuffers
for(var n in a)t=a[n],t.untypedArray&&(i=SpiderGL.Type.typeToTypedArrayConstructor(t.type),t.typedArray=new i(t.untypedArray))
return!0},updateGL:function(e,t){if(!e)return!1
var i=this._descriptor
if(!i)return!1
this._gl=e
var r=null,n=null,a=SpiderGL.Utility.getDefaultObject({data:null,usage:SpiderGL.Core.DEFAULT},t)
a.data=null
for(var s in i.data.vertexBuffers)r=i.data.vertexBuffers[s],a.data=r.typedArray,a.data||(n=SpiderGL.Type.typeToTypedArrayConstructor(r.type),a.data=new n(r.untypedArray)),r.glBuffer&&(r.glBuffer.destroy(),r.glBuffer=null),r.glBuffer=new SpiderGL.WebGL.VertexBuffer(e,a)
for(var s in i.data.indexBuffers)r=i.data.indexBuffers[s],a.data=r.typedArray,a.data||(n=SpiderGL.Type.typeToTypedArrayConstructor(r.type),a.data=new n(r.untypedArray)),r.glBuffer&&(r.glBuffer.destroy(),r.glBuffer=null),r.glBuffer=new SpiderGL.WebGL.IndexBuffer(e,a)
var o=null
for(var s in i.access.vertexStreams)o=i.access.vertexStreams[s],o.glType=SpiderGL.Type.typeToGL(o.type)
for(var s in i.access.primitiveStreams)o=i.access.primitiveStreams[s],o.glMode=SpiderGL.Type.primitiveToGL(o.mode),o.glType=SpiderGL.Type.typeToGL(o.type)
return!0},destroyGL:function(){var e=this._descriptor
if(!e)return!1
var t=null
for(var i in e.data.vertexBuffers)t=e.data.vertexBuffers[i],t.glBuffer&&(t.glBuffer.destroy(),t.glBuffer=null)
for(var i in e.data.indexBuffers)t=e.data.indexBuffers[i],t.glBuffer&&(t.glBuffer.destroy(),t.glBuffer=null)},updateRenderData:function(){var e=this._descriptor
if(!e)return!1
var t={partMap:{}}
for(var i in e.logic.parts){var r=e.logic.parts[i],n=r.chunks,a={}
t.partMap[i]=a
for(var s=0,o=n.length;o>s;++s){var u=n[s],c=e.semantic.chunks[u],l={}
a[u]=l
var h=c.techniques
for(var d in h){var p=h[d],f={vertexStreams:{buffered:[],constant:[]},primitiveStreams:{}}
l[d]=f
var _=e.semantic.bindings[p.binding],g=_.vertexStreams,m={}
for(var S in g)for(var L=g[S],b=0,v=L.length;v>b;++b){var x=L[b],T=e.access.vertexStreams[x],G={semantic:S,index:b,stream:T},M=T.buffer
M?(m[M]=m[M]||[],m[M].push(G)):f.vertexStreams.constant.push(G)}for(var M in m){var y={buffer:e.data.vertexBuffers[M],streams:m[M].slice()}
f.vertexStreams.buffered.push(y)}var g=_.primitiveStreams
for(var S in g){var m={},E={buffered:[],array:[]}
f.primitiveStreams[S]=E
for(var L=g[S],b=0,v=L.length;v>b;++b){var x=L[b],T=e.access.primitiveStreams[x],M=T.buffer
M?(m[M]=m[M]||[],m[M].push(T)):E.array.push(T)}for(var M in m){var y={buffer:e.data.indexBuffers[M],streams:m[M].slice()}
E.buffered.push(y)}}}}}this._renderData=t}},SpiderGL.Type.extend(SpiderGL.Model.Model,SpiderGL.Core.ObjectBase),SpiderGL.Model.Technique=function(e,t,i){SpiderGL.Core.ObjectBase.call(this),i=SpiderGL.Utility.getDefaultObject({},i),t&&"vertexShader"in t&&"fragmentShader"in t&&(t=SpiderGL.Model.Technique._createSimpleDescriptor(e,t)),this._descriptor=SpiderGL.Model.Technique._fixDescriptor(t),this._gl=this._descriptor.program.gl,this._renderData={},e&&this.updateRenderData()},SpiderGL.Model.Technique._fixDescriptor=function(e){return e=SpiderGL.Utility.getDefaultObject({name:"common",program:null,semantic:{}},e),e.vertexStreams&&(e.semantic.vertexStreams=e.vertexStreams,delete e.vertexStreams),e.globals&&(e.semantic.globals=e.globals,delete e.globals),e.semantic=SpiderGL.Model.Technique._fixSemantic(e.program,e.semantic),e},SpiderGL.Model.Technique._fixSemantic=function(e,t){return t=SpiderGL.Utility.getDefaultObject({vertexStreams:null,globals:null},t),t.vertexStreams=SpiderGL.Model.Technique._fixVertexStreams(e,t.vertexStreams),t.globals=SpiderGL.Model.Technique._fixGlobals(e,t.globals),t},SpiderGL.Model.Technique._fixVertexStreams=function(e,t){for(var i="0123456789",r=e.getAttributesNames(),n={},a=0,s=r.length;s>a;++a){for(var o=r[a],u="",c="",l=o.length-1;l>=0;--l){var h=o.charAt(l)
if(-1==i.indexOf(h,0)){u=o.substring(0,l+1)
break}c=h+c}var d=c.length>0?parseInt(c):0,p=u.length
if(p>=2&&"a"==u.charAt(0)){var h=u.charAt(1)
"_"==h&&p>2?u=u.substring(2):h==u.charAt(1).toUpperCase()&&(u=u.substring(1))}var f=u.toUpperCase()
n[o]={semantic:f,index:d,value:[0,0,0,1]}}var _={}
for(var g in t){var m=n[g]
if(m){var S=t[g]
SpiderGL.Type.isString(S)?S={semantic:S}:SpiderGL.Type.isArray(S)||SpiderGL.Type.isTypedArray(S)?S={value:S}:SpiderGL.Type.isNumber(S)&&(S={value:[S,S,S,S]}),_[g]=SpiderGL.Utility.getDefaultObject({semantic:m.semantic,index:m.index,value:m.value},S)}}return t=SpiderGL.Utility.getDefaultObject(n,_)},SpiderGL.Model.Technique._fixGlobals=function(e,t){var i=e.getUniformsValues(),r={}
for(var n in i){var a=n,s=a.length
if(s>=2&&"u"==a.charAt(0)){var o=a.charAt(1)
"_"==o&&s>2?a=a.substring(2):o==a.charAt(1).toUpperCase()&&(a=a.substring(1))}var u=a.toUpperCase()
r[n]={semantic:u,value:i[n]}}return t=SpiderGL.Utility.getDefaultObject(r,t)},SpiderGL.Model.Technique._createSimpleDescriptor=function(e,t){t=SpiderGL.Utility.getDefaultObject({name:"common",vertexShader:null,fragmentShader:null,attributes:null,uniforms:null,semantic:{},vertexStreams:null,globals:null,options:null},t),t.vertexStreams&&(t.semantic.vertexStreams=t.vertexStreams,delete t.vertexStreams),t.globals&&(t.semantic.globals=t.globals,delete t.globals)
var i={name:t.name,program:null,semantic:t.semantic}
if(!e)return i
var r=t.vertexShader,n=t.fragmentShader
if(!r||!n)return i
if(SpiderGL.Type.isString(r))r=new SpiderGL.WebGL.VertexShader(e,r)
else if(!SpiderGL.Type.instanceOf(r,SpiderGL.WebGL.VertexShader))return i
if(SpiderGL.Type.isString(n))n=new SpiderGL.WebGL.FragmentShader(e,n)
else if(!SpiderGL.Type.instanceOf(n,SpiderGL.WebGL.FragmentShader))return i
var a=new SpiderGL.WebGL.Program(e,{shaders:[r,n],attributes:t.attributes,uniforms:t.uniforms})
return i.program=a,i},SpiderGL.Model.Technique.prototype={get descriptor(){return this._descriptor},get isReady(){return!!this._descriptor},get gl(){return this._gl},get name(){return this._descriptor.name},get renderData(){return this._renderData},get program(){return this._descriptor.program},setUniforms:function(e){this._descriptor.program.setUniforms(e)},updateRenderData:function(){var e=this._descriptor,t={}
this._renderData=t
var i={}
t.attributesMap=i
var r=e.program.getAttributesIndices()
for(var n in e.semantic.vertexStreams){var a=e.semantic.vertexStreams[n],s=a.semantic,o=i[s]
o||(o=[],i[s]=o),o[a.index]={index:r[n],value:a.value}}var u={}
t.globalsMap=u
for(var c in e.semantic.globals){var a=e.semantic.globals[c]
u[a.semantic]={name:c,value:a.value}}}},SpiderGL.Model.ModelRenderer=function(e){this._gl=e,this._vertexAttributesCount=e.getParameter(e.MAX_VERTEX_ATTRIBS),this._textureUnitsCount=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._internalFramebuffer=new SpiderGL.WebGL.Framebuffer(e),this._reset()},SpiderGL.Model.ModelRenderer.prototype={_reset:function(){this._technique=null,this._model=null,this._partName=null,this._chunkName=null,this._primMode=null,this._framebuffer=null,this._inBegin=!1,this._enabledArrays=[],this._boundTextures=[],this._attribValues=[],this._primitiveStreams=[],this._techniqueDirty=!0,this._modelDirty=!0,this._modelPartDirty=!0,this._modelChunkDirty=!0,this._primModeDirty=!0,this._framebufferDirty=!0,this._viewportDirty=!0,this._dirty=!0},_resetContext:function(){for(var e=this._gl,t=0,i=this._vertexAttributesCount;i>t;++t)e.disableVertexAttribArray(t)
for(var t=this._textureUnitsCount-1;t>=0;--t)e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null)
SpiderGL.WebGL.VertexBuffer.unbind(e),SpiderGL.WebGL.IndexBuffer.unbind(e),SpiderGL.WebGL.Program.unbind(e),SpiderGL.WebGL.Framebuffer.unbind(e)},_update:function(){if(!this._dirty)return!0
var e=this._gl
if(this._techniqueDirty){var t=this._technique
if(!t)return!1
var i=t.renderData,r=i.attributesMap,n=[]
for(var a in r){var s=r[a]
for(var o in s){var u=s[o],c=null
u&&(c={index:u.index,value:u.value}),n.push(c)}}this._attribValues=n,t.program.bind(),this._techniqueDirty=!1}if(this._modelDirty){var l=this._model
if(!l)return!1
for(var n=this._attribValues,o=0,h=n.length;h>o;++o){var c=n[o]
c&&e.vertexAttrib4fv(c.index,c.value)}var d=l.renderData,t=this._technique
if(!t)return!1
var i=t.renderData
if(!i)return!1
var r=i.attributesMap
if(this._modelPartDirty){var p=this._partName
if(!p)return!1
this._modelPartDirty=!1}if(this._modelChunkDirty){var f=this._chunkName
if(!f)return!1
var _=d.partMap[this._partName]
if(!_)return!1
var g=_[f]
if(!g)return!1
var m=g[t.name]
if(m||(m=g.common),!m)return!1
for(var S=this._enabledArrays,o=0,h=S.length;h>o;++o)e.disableVertexAttribArray(S[o])
S=[]
for(var L=m.vertexStreams.buffered,o=0,h=L.length;h>o;++o){var b=L[o],v=b.buffer.glBuffer
v.bind()
for(var x=b.streams,T=0,G=x.length;G>T;++T){var M=x[T]
if(r[M.semantic]&&r[M.semantic][M.index]){var y=r[M.semantic][M.index].index,E=M.stream
E.index=y,S.push(y),v.vertexAttribPointer(E)}}}this._enabledArrays=S
for(var x=m.vertexStreams.constant,T=0,h=x.length;h>T;++T){var M=x[T]
if(r[M.semantic]&&r[M.semantic][M.index]){var y=r[M.semantic][M.index].index,E=M.stream
e.vertexAttrib4fv(y,E.value)}}this._modelChunkDirty=!1}if(this._primModeDirty){var A=this._primMode
if(!A)return!1
var _=d.partMap[this._partName]
if(!_)return!1
var g=_[this._chunkName]
if(!g)return!1
var m=g[t.name]
if(m||(m=g.common),!m)return!1
var P=m.primitiveStreams[A]
if(!P)return!1
this._primitiveStreams=P,this._primModeDirty=!1}this._modelDirty=!1}return this._framebufferDirty&&(this._framebuffer?this._framebuffer.bind():SpiderGL.WebGL.Framebuffer.unbind(e),this._framebufferDirty=!1),this._viewportDirty&&(this._framebuffer&&this._framebuffer.autoViewport&&this._framebuffer.applyViewport(),this._viewportDirty=!1),this._dirty=!1,!0},get gl(){return this._gl},get isValid(){return!!this._gl},destroy:function(){this.end(),this._internalFramebuffer.destroy(),this._internalFramebuffer=null,this._gl=null},begin:function(){this._inBegin||(this._resetContext(),this._inBegin=!0)},end:function(){if(this._inBegin){this._inBegin=!1
for(var e=this._gl,t=this._enabledArrays,i=0,r=t.length;r>i;++i)e.disableVertexAttribArray(t[i])
for(var n=this._boundTextures,i=0,r=n.length;r>i;++i){var a=n[i]
a&&(a.target==e.TEXTURE_2D?SpiderGL.WebGL.Texture2D.unbind(e,a.unit):a.target==e.TEXTURE_CUBE_MAP&&SpiderGL.WebGL.TextureCubeMap.unbind(e,a.unit))}this._framebuffer&&SpiderGL.WebGL.Framebuffer.unbind(this._gl),this._internalFramebuffer.detachAll(),this._reset(),this._resetContext()}},get isInBegin(){return this._inBegin},setTechnique:function(e){this._inBegin&&this._technique!=e&&(this._technique=e,this._techniqueDirty=!0,this._dirty=!0,e||SpiderGL.WebGL.Program.unbind(this._gl))},get technique(){return this._technique},setModel:function(e){this._inBegin&&this._model!=e&&(this._model=e,this._modelDirty=!0,this._modelPartDirty=!0,this._modelChunkDirty=!0,this._dirty=!0)},get model(){return this._model},setPart:function(e){this._inBegin&&this._part!=e&&(this._partName=e,this._modelPartDirty=!0,this._modelDirty=!0,this._dirty=!0)},get part(){return this._partName},setChunk:function(e){this._inBegin&&this._chunk!=e&&(this._chunkName=e,this._modelDirty=!0,this._modelChunkDirty=!0,this._primModeDirty=!0,this._dirty=!0)},get chunk(){return this._chunkName},setPrimitiveMode:function(e){this._inBegin&&this._primMode!=e&&(this._primMode=e,this._primModeDirty=!0,this._modelDirty=!0,this._dirty=!0)},get primitiveMode(){return this._primMode},setUniforms:function(e){this._inBegin&&this._technique&&this._technique.program.setUniforms(e)},setDefaultGlobals:function(){if(this._inBegin){var e=this._technique
if(e){var t=e.renderData.globalsMap,i={}
for(var r in t){var n=t[r].name,a=t[r].value
i[n]=a}e.program.setUniforms(i)}}},setGlobals:function(e){if(this._inBegin&&e){var t=this._technique
if(t){var i=t.renderData.globalsMap,r={}
for(var n in e)if(i[n]){var a=i[n].name,s=e[n]
r[a]=s}t.program.setUniforms(r)}}},setFramebuffer:function(e){this._inBegin&&this._framebuffer!=e&&(this._framebuffer=e,this._framebufferDirty=!0,this._viewportDirty=!0,this._dirty=!0,e?e.bind():SpiderGL.WebGL.Framebuffer.unbind(this._gl))},activateOffScreenFramebuffer:function(){this.setFramebuffer(this._internalFramebuffer)},activateMainFramebuffer:function(){return this.setFramebuffer(null)},setFramebufferAttachments:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.setAttachments(e),this._framebufferDirty=!0,this._viewportDirty=!0)},setColorRenderTarget:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.colorTarget=e,this._viewportDirty=!0,this._dirty=!0)},setDepthRenderTarget:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.depthTarget=e,this._viewportDirty=!0,this._dirty=!0)},setStencilRenderTarget:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.stencilTarget=e,this._viewportDirty=!0,this._dirty=!0)},setDepthStencilRenderTarget:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.depthStencilTarget=e,this._viewportDirty=!0,this._dirty=!0)},clearFramebuffer:function(e){if(this._inBegin&&e){var t=this._gl,i=0
if(SpiderGL.Type.isNumber(e))i=e
else{if("color"in e){var r=e.color
r&&t.clearColor(r[0],r[1],r[2],r[3]),i|=t.COLOR_BUFFER_BIT}if("depth"in e){var n=e.depth
SpiderGL.Type.isNumber(n)&&t.clearDepth(n),i|=t.DEPTH_BUFFER_BIT}if("stencil"in e){var a=e.stencil
SpiderGL.Type.isNumber(a)&&t.clearStencil(a),i|=t.Stencil_BUFFER_BIT}}if(i){var s=this._framebuffer
s?s.clear(i):t.clear(i)}}},setViewport:function(e,t,i,r){if(this._inBegin){var n=this._gl
n.viewport(e,t,i,r)}},setTexture:function(e,t){if(t)t.bind(e)
else{var i=this._gl
SpiderGL.WebGL.Texture2D.unbind(i,e),SpiderGL.WebGL.TextureCubeMap.unbind(i,e)}},get canRender(){return!!(this._inBegin&&this._technique&&this._model&&this._partName&&this._chunkName&&this._primMode)},render:function(){if(this.canRender&&this._update()){for(var e=this._gl,t=this._primitiveStreams,i=t.buffered,r=t.array,n=0,a=i.length;a>n;++n){var s=i[n],o=s.buffer.glBuffer
o.bind()
for(var u=s.streams,c=0,l=u.length;l>c;++c){var h=u[c]
o.drawElements(h)}}for(var c=0,a=r.length;a>c;++c){var h=r[c]
e.drawArrays(h.glMode,h.first,h.count)}}},renderModelPart:function(e){var t=this.model.descriptor.logic.parts[e]
this.setPart(e)
for(var i in t.chunks){var r=t.chunks[i]
this.setChunk(r),this.render()}},renderModel:function(){var e=this.model.descriptor.logic.parts
for(var t in e){var i=e[t]
this.setPart(t)
for(var r in i.chunks){var n=i.chunks[r]
this.setChunk(n),this.render()}}}},SpiderGL.UserInterface={},SpiderGL.UserInterface.CanvasHandler=function(e,t,i){SpiderGL.Core.ObjectBase.call(this),i=i||{}
var r=this,n=e.canvas
this._gl=e,this._canvas=n,this._handler=t,this._ignoreKeyRepeat=SpiderGL.Utility.getDefaultValue(i.ignoreKeyRepeat,SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT),this._keysDown={},this._mouseButtonsDown=[!1,!1,!1],this._dragging=[!1,!1,!1],this._dragStartPos=[[0,0],[0,0],[0,0]],this._dragEndPos=[[0,0],[0,0],[0,0]],this._dragDeltaPos=[[0,0],[0,0],[0,0]],this._cursorPos=[0,0],this._cursorPrevPos=[0,0],this._cursorDeltaPos=[0,0],this._drawEventPending=!1,this._drawEventHandler=function(){r._onDraw()},this._postDrawEventFunction=function(){r._postDrawEvent()},this._animateTime=Date.now(),this._animatePrevTime=this._animateTime,this._animateDeltaTime=0,this._animateRate=0,this._animateID=null,this._animateEventHandler=function(){r._onAnimate()},this._animateMS=-1,this._animateWithTimeout=!1,this._fastAnimate=!1,this._fpsUpdateMS=1e3,this._fpsTime=0,this._fpsCount=0,this._fps=0,this._delegateDraw=function(e){r._onDraw(e)}
var a=function(e){e.source==window&&(e.data==SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME?(e.stopPropagation(),r._onAnimate()):e.data==SpiderGL.UserInterface.CanvasHandler._FAST_DRAW_MESSAGE_NAME&&(e.stopPropagation(),r._onDraw()))}
window.addEventListener("message",a,!0),n.tabIndex=0,n.addEventListener("unload",function(e){r._onTerminate(e)},!1),n.addEventListener("keydown",function(e){r._onKeyDown(e)},!1),n.addEventListener("keyup",function(e){r._onKeyUp(e)},!1),n.addEventListener("keypress",function(e){r._onKeyPress(e)},!1),n.addEventListener("mousedown",function(e){r._onMouseButtonDown(e)},!1),n.addEventListener("mouseup",function(e){r._onMouseButtonUp(e)},!1),n.addEventListener("mousemove",function(e){r._onMouseMove(e)},!1),n.addEventListener("mouseout",function(e){r._onMouseOut(e)},!1),n.addEventListener("click",function(e){r._onClick(e)},!1),n.addEventListener("dblclick",function(e){r._onDoubleClick(e)},!1),n.addEventListener("resize",function(e){r._onResize(e)},!1),n.addEventListener("DOMMouseScroll",function(e){r._onMouseWheel(e)},!1),n.addEventListener("mousewheel",function(e){r._onMouseWheel(e)},!1),n.addEventListener("blur",function(e){r._onBlur(e)},!1),window.addEventListener("mouseup",function(e){r._onWindowMouseButtonUp(e)},!1),window.addEventListener("mousemove",function(e){r._onWindowMouseMove(e)},!1),n.addEventListener("touchstart",SpiderGL.UserInterface.CanvasHandler._touchHandler,!1),n.addEventListener("touchend",SpiderGL.UserInterface.CanvasHandler._touchHandler,!1),n.addEventListener("touchmove",SpiderGL.UserInterface.CanvasHandler._touchHandler,!1),window.addEventListener("pointerup",function(e){"touch"==e.pointerType?SpiderGL.UserInterface.CanvasHandler._touchHandler(e):r._onWindowMouseButtonUp(e)},!1),window.addEventListener("pointermove",function(e){"touch"==e.pointerType?SpiderGL.UserInterface.CanvasHandler._touchHandler(e):r._onWindowMouseMove(e)},!1),n.addEventListener("pointerdown",function(e){"touch"==e.pointerType?SpiderGL.UserInterface.CanvasHandler._touchHandler(e):r._onMouseButtonDown(e)},!1),n.addEventListener("pointerup",function(e){"touch"==e.pointerType?SpiderGL.UserInterface.CanvasHandler._touchHandler(e):r._onMouseButtonUp(e)},!1),n.addEventListener("pointermove",function(e){"touch"==e.pointerType?SpiderGL.UserInterface.CanvasHandler._touchHandler(e):r._onMouseMove(e)},!1)
var s=SpiderGL.Utility.getDefaultValue(i.standardGLUnpack,SpiderGL.UserInterface.CanvasHandler.DEFAULT_STANDARD_GL_UNPACK)
s&&SpiderGL.WebGL.Context.setStandardGLUnpack(e),this.animateRate=SpiderGL.Utility.getDefaultValue(i.animateRate,SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE)},SpiderGL.UserInterface.CanvasHandler._FAST_DRAW_MESSAGE_NAME="spidergl-fast-draw-message",SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME="spidergl-fast-animate-message",SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE=0,SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT=!0,SpiderGL.UserInterface.CanvasHandler.DEFAULT_STANDARD_GL_UNPACK=!0,SpiderGL.UserInterface.CanvasHandler.DEFAULT_PROPERTY_NAME="ui",SpiderGL.UserInterface.CanvasHandler._multiTouch={tmp:0,touches:[],evt:null,pan:!1,btn:0,phase:0},SpiderGL.UserInterface.CanvasHandler._touchHandler=function(e){var t,r,n=1,a=0,s=""
if("pointerdown"==e.type)SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.push(e)
else for(i=0;i<SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.length;i++)e.pointerId==SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i].pointerId&&(SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i]=e)
switch(navigator.userAgent.toLowerCase().indexOf("trident")>-1?(t=SpiderGL.UserInterface.CanvasHandler._multiTouch.touches,r=t[0]):(t=e.touches,r=e.changedTouches[0]),e.type){case"touchstart":case"pointerdown":s="mousedown"
break
case"touchmove":case"pointermove":s="mousemove"
break
case"touchend":case"pointerup":s="mouseup"
break
default:return}var o=document.createEvent("MouseEvent")
if(t.length>=2){if(navigator.userAgent.toLowerCase().indexOf("trident")<=-1&&("draw-canvas"!=t[0].target.id||"draw-canvas"!=t[1].target.id))return
var u=Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2)),n=u-SpiderGL.UserInterface.CanvasHandler._multiTouch.tmp
if(SpiderGL.UserInterface.CanvasHandler._multiTouch.tmp=u,"pointerup"==e.type)a=SpiderGL.UserInterface.CanvasHandler._multiTouch.btn,s="mousedown"
else{if(!(-.995>n||n>.995))return
n=n>0?1:-1,s="mousewheel"}}else{if(!("pointerup"!=e.type&&"pointermove"!=e.type||r&&e.pointerId==r.pointerId))return
if(0!=SpiderGL.UserInterface.CanvasHandler._multiTouch.tmp&&"touchend"==e.type&&(a=SpiderGL.UserInterface.CanvasHandler._multiTouch.btn,s="mousedown"),"mousedown"==s)SpiderGL.UserInterface.CanvasHandler._multiTouch.evt=e
else if("mouseup"==s)SpiderGL.UserInterface.CanvasHandler._multiTouch.pan&&(a=1,SpiderGL.UserInterface.CanvasHandler._multiTouch.pan=!1,SpiderGL.UserInterface.CanvasHandler._multiTouch.phase=0,navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&SpiderGL.UserInterface.CanvasHandler._touchHandler(e))
else if("mousemove"==s)if(SpiderGL.UserInterface.CanvasHandler._multiTouch.pan)switch(SpiderGL.UserInterface.CanvasHandler._multiTouch.phase){case 0:n=-1,s=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?"mousemove":"mouseup",SpiderGL.UserInterface.CanvasHandler._multiTouch.phase++
break
case 1:a=1,s="mousedown",SpiderGL.UserInterface.CanvasHandler._multiTouch.phase++
break
default:a=1}else{var c
c=navigator.userAgent.toLowerCase().indexOf("trident")>-1?SpiderGL.UserInterface.CanvasHandler._multiTouch.evt:SpiderGL.UserInterface.CanvasHandler._multiTouch.evt.touches[0],Math.sqrt(Math.pow(r.clientX-c.clientX,2)+Math.pow(r.clientY-c.clientY,2))<=2&&e.timeStamp-SpiderGL.UserInterface.CanvasHandler._multiTouch.evt.timeStamp>400&&(SpiderGL.UserInterface.CanvasHandler._multiTouch.pan=!0)}SpiderGL.UserInterface.CanvasHandler._multiTouch.tmp=0,SpiderGL.UserInterface.CanvasHandler._multiTouch.btn=a}if(r&&(o.initMouseEvent(s,!0,!0,window,n,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,a,null),r.target.dispatchEvent(o)),"pointerup"==e.type)for(i=0;i<SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.length;i++)SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i].pointerId>=e.pointerId&&(i+1==SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.length?SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.pop():SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i]=SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i+1])
e.preventDefault(),e.stopPropagation()},SpiderGL.UserInterface.CanvasHandler.prototype={_firstNotify:function(){this._onInitialize(),this._animateRate>0&&this._onAnimate(),this.postDrawEvent()},_dispatch:function(){var e=arguments[0],t=this._handler,i=t[e]
if(i){var r=Array.prototype.slice.call(arguments,1)
i.apply(t,r)}},_postDrawEvent:function(){this._postDrawCount=5,this._drawEventPending||(this._drawEventPending=!0,requestAnimationFrame(this._delegateDraw))},_getMouseClientPos:function(e){var t=this._canvas.getBoundingClientRect(),i=this._canvas.width,r=this._canvas.height,n=e.clientX-t.left,a=r-(e.clientY-t.top),s=0>n||n>=i||0>a||a>=r
return[n,a,s]},_onInitialize:function(){this._dispatch("onInitialize")},_onTerminate:function(){this._dispatch("onTerminate")},_onBlur:function(e){var t=(this._gl,this._keysDown)
for(var i in t)t[i]&&(t[i]=!1,this._dispatch("onKeyUp",i,null))},_onKeyDown:function(e){var t=e.keyCode
if(t>=48&&90>=t){var i=String.fromCharCode(t)
t=i.toUpperCase()}var r=this._keysDown[t]
this._keysDown[t]=!0,r&&this._ignoreKeyRepeat||this._dispatch("onKeyDown",t,e)},_onKeyUp:function(e){var t=e.keyCode
if(t>=48&&90>=t){var i=String.fromCharCode(t)
t=i.toUpperCase()}this._keysDown[t]=!1,this._dispatch("onKeyUp",t,e)},_onKeyPress:function(e){var t=e.keyCode
if(t>=48&&90>=t){var i=String.fromCharCode(t)
t=i.toUpperCase()}this._dispatch("onKeyPress",t,e)},_onMouseButtonDown:function(e){this._canvas.focus()
var t=this._getMouseClientPos(e)
this._cursorPos=t
var i=e.button
this._mouseButtonsDown[i]=!0,this._dragStartPos[i]=[t[0],t[1]],this._dispatch("onMouseButtonDown",i,t[0],t[1],e),e.stopPropagation()},_onMouseButtonUp:function(e){var t=this._getMouseClientPos(e)
this._cursorPos=t
var i=e.button
if(this._mouseButtonsDown[i]=!1,!(navigator.userAgent.toLowerCase().indexOf("firefox")>-1)||e.isTrusted){if(this._dispatch("onMouseButtonUp",i,t[0],t[1],e),this._dragging[i]){this._dragging[i]=!1
var r=this._dragStartPos[i],n=[t[0],t[1]]
this._dragEndPos[i]=n,this._dragDeltaPos[i]=[n[0]-r[0],n[1]-r[1]],this._dispatch("onDragEnd",i,n[0],n[1])}e.stopPropagation()}},_onWindowMouseButtonUp:function(e){var t=this._getMouseClientPos(e)
this._cursorPos=t
var i=e.button
if(this._mouseButtonsDown[i]&&(this._mouseButtonsDown[i]=!1,!(navigator.userAgent.toLowerCase().indexOf("firefox")>-1)||e.isTrusted)){if(this._dispatch("onMouseButtonUp",i,t[0],t[1],e),this._dragging[i]){this._dragging[i]=!1
var r=this._dragStartPos[i],n=[t[0],t[1]]
this._dragEndPos[i]=n,this._dragDeltaPos[i]=[n[0]-r[0],n[1]-r[1]],this._dispatch("onDragEnd",i,n[0],n[1])}e.stopPropagation()}},_onMouseMove:function(e){this._cursorPrevPos=this._cursorPos
var t=this._getMouseClientPos(e)
this._cursorPos=t,this._cursorDeltaPos=[this._cursorPos[0]-this._cursorPrevPos[0],this._cursorPos[1]-this._cursorPrevPos[1]]
for(var i=0;3>i;++i)if(this._mouseButtonsDown[i]&&(0!=this._cursorDeltaPos[0]||0!=this._cursorDeltaPos[1])){var r=this._dragStartPos[i],n=[t[0],t[1]]
this._dragEndPos[i]=n,this._dragDeltaPos[i]=[n[0]-r[0],n[1]-r[1]],this._dragging[i]?this._dispatch("onDrag",i,n[0],n[1]):(this._dragging[i]=!0,this._dispatch("onDragStart",i,r[0],r[1]))}this._dispatch("onMouseMove",t[0],t[1],e),e.stopPropagation()},_onWindowMouseMove:function(e){this._cursorPrevPos=this._cursorPos
var t=this._getMouseClientPos(e)
this._cursorPos=t,this._cursorDeltaPos=[this._cursorPos[0]-this._cursorPrevPos[0],this._cursorPos[1]-this._cursorPrevPos[1]]
for(var i=0;3>i;++i)if(this._dragging[i]){var r=this._dragStartPos[i],n=[t[0],t[1]]
this._dragEndPos[i]=n,this._dragDeltaPos[i]=[n[0]-r[0],n[1]-r[1]],this._dispatch("onDrag",i,n[0],n[1])}t[2]||(this._dispatch("onMouseMove",t[0],t[1],e),e.stopPropagation())},_onMouseWheel:function(e){var t=this._getMouseClientPos(e),i=0
e||(e=window.event),e.wheelDelta?(i=e.wheelDelta/120,window.opera&&(i=-i)):e.detail&&(i=-e.detail/3),i&&this._dispatch("onMouseWheel",i,t[0],t[1],e),e.preventDefault&&e.preventDefault(),e.stopPropagation()},_onMouseOut:function(e){var t=this._getMouseClientPos(e)
this._dispatch("onMouseOut",t[0],t[1],e)},_onClick:function(e){var t=this._getMouseClientPos(e)
this._dispatch("onClick",e.button,t[0],t[1],e)},_onDoubleClick:function(e){var t=this._getMouseClientPos(e)
this._dispatch("onDoubleClick",e.button,t[0],t[1],e)},_onResize:function(e){this._dispatch("onResize",this._canvas.width,this._canvas.height,e)},_onAnimate:function(){this._animatePrevTime=this._animateTime,this._animateTime=Date.now(),this._animateDeltaTime=this._animateTime-this._animatePrevTime,this._dispatch("onAnimate",this._animateDeltaTime/1e3),this._animateMS>=0?this._animateWithTimeout&&setTimeout(this._animateEventHandler,this._animateMS):this._fastAnimate&&window.postMessage(SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME,"*")},_onDraw:function(e){if(this._drawEventPending=!1,this._fpsTime&&5!=this.postDrawCount){this._fpsCount++
var t=e-this._fpsTime
this._fps=.8*this._fps+.2*(1e3/t)}else this._fpsCount=0
this._fpsTime=e,this._dispatch("onDraw"),this._postDrawCount-- >0&&(this._drawEventPending=!0,requestAnimationFrame(this._delegateDraw))},get gl(){return this._gl},get canvas(){return this._canvas},get width(){return this._canvas.width},get height(){return this._canvas.height},get postDrawEvent(){return this._postDrawEventFunction},get animateTime(){return this._animateTime},get animatePrevTime(){return this._animatePrevTime},get animateDeltaTime(){return this._animateDeltaTime},get animateRate(){return this._animateRate},set animateRate(e){e=SpiderGL.Utility.getDefaultValue(e,SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE),this._animateRate!==e&&(this._fastAnimate=!1,this._animateMS=-1,this._animateTime=Date.now(),this._animatePrevTime=this._animateTime,this._animateDeltaTime=0,this._animateID&&(clearInterval(this._animateID),this._animateID=null),this._animateRate=e,e>0?(this._animateMS=SpiderGL.Math.floor(1e3/e),this._animateWithTimeout?setTimeout(this._animateEventHandler,this._animateMS):this._animateID=setInterval(this._animateEventHandler,this._animateMS)):0>e&&(this._fastAnimate=!0,window.postMessage(SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME,"*")))},get framesPerSecond(){return this._fps},get ignoreKeyRepeat(){return this._ignoreKeyRepeat},set ignoreKeyRepeat(e){this._ignoreKeyRepeat=SpiderGL.Utility.getDefaultValue(e,SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT)},isKeyDown:function(e){return e.toUpperCase&&(e=e.toUpperCase()),this._keysDown[e]},isMouseButtonDown:function(e){return this._mouseButtonsDown[e]},isDragging:function(e){var t=!1
if(void 0!==e)t=this._dragging[e]
else for(i=0;i<3;i++)if(this._dragging[i])return!0
return t},dragStartX:function(e){return this._dragStartPos[e][0]},dragStartY:function(e){return this._dragStartPos[e][1]},dragEndX:function(e){return this._dragEndPos[e][0]},dragEndY:function(e){return this._dragEndPos[e][1]},dragDeltaX:function(e){return this._dragDeltaPos[e][0]},dragDeltaY:function(e){return this._dragDeltaPos[e][1]},get cursorX(){return this._cursorPos[0]},get cursorY(){return this._cursorPos[1]},get cursorPrevX(){return this._cursorPrevPos[0]},get cursorPrevY(){return this._cursorPrevPos[1]},get cursorDeltaX(){return this._cursorDeltaPos[0]},get cursorDeltaY(){return this._cursorDeltaPos[1]},draw:function(){this._onDraw()}},SpiderGL.Type.extend(SpiderGL.UserInterface.CanvasHandler,SpiderGL.Core.ObjectBase),SpiderGL.UserInterface.handleCanvas=function(e,t,i){if(!e||!t)return!1
i=i||{}
var r=SpiderGL.WebGL.Context.getHijacked(e,i)
if(!r)return!1
var n=new SpiderGL.UserInterface.CanvasHandler(r,t,i)
if(!n)return!1
var a=SpiderGL.Utility.getDefaultValue(i.uiName,SpiderGL.UserInterface.CanvasHandler.DEFAULT_PROPERTY_NAME)
return t[a]=n,n._firstNotify(),!0},SpiderGL.UserInterface.handleCanvasOnLoad=function(e,t,i){function r(){SpiderGL.UserInterface.handleCanvas(e,t,i),n&&n()}if(!e||!t)return!1
i=i||{}
var n=SpiderGL.Utility.getDefaultValue(i.onLoad,null)
return window.addEventListener("load",r,!1),!0},PanTiltTrackball.prototype={setup:function(e){e=e||{}
var t=sglGetDefaultObject({startCenter:[0,0,0],startPanX:0,startPanY:0,startAngleX:0,startAngleY:0,startDistance:2,minMaxDist:[.2,4],minMaxPanX:[-.7,.7],minMaxPanY:[-.7,.7],minMaxAngleX:[-70,70],minMaxAngleY:[-70,70]},e)
this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._matrix=SglMat4.identity(),this._center=t.startCenter,this._startPanX=t.startPanX,this._startPanY=t.startPanY,this._startAngleX=sglDegToRad(t.startAngleX),this._startAngleY=sglDegToRad(t.startAngleY),this._startDistance=t.startDistance,this._panX=this._startPanX,this._panY=this._startPanY,this._angleX=this._startAngleX,this._angleY=this._startAngleY,this._distance=this._startDistance,this._targetPanX=this._startPanX,this._targetPanY=this._startPanY,this._targetAngleX=this._startAngleX,this._targetAngleY=this._startAngleY,this._targetDistance=this._startDistance,this._isAnimating=!1,this._speedPanX=0,this._speedPanY=0,this._speedAngleX=0,this._speedAngleY=0,this._speedDistance=0,this._minMaxDist=t.minMaxDist,this._minMaxPanX=t.minMaxPanX,this._minMaxPanY=t.minMaxPanY,this._minMaxAngleX=t.minMaxAngleX,this._minMaxAngleX[0]=sglDegToRad(this._minMaxAngleX[0]),this._minMaxAngleX[1]=sglDegToRad(this._minMaxAngleX[1]),this._minMaxAngleY=t.minMaxAngleY,this._minMaxAngleY[0]=sglDegToRad(this._minMaxAngleY[0]),this._minMaxAngleY[1]=sglDegToRad(this._minMaxAngleY[1]),this._start=[0,0],this.reset()},clamp:function(e,t,i){return t>e?t:e>i?i:e},_computeMatrix:function(){var e=SglMat4.identity()
e=SglMat4.mul(e,SglMat4.translation([-this._center[0],-this._center[1],-this._center[2]])),e=SglMat4.mul(e,SglMat4.translation([0,0,-this._distance])),e=SglMat4.mul(e,SglMat4.rotationAngleAxis(this._angleY,[1,0,0])),e=SglMat4.mul(e,SglMat4.rotationAngleAxis(this._angleX,[0,-1,0])),e=SglMat4.mul(e,SglMat4.translation([this._panX,this._panY,0])),this._matrix=e},getState:function(){return[this._panX,this._panY,sglRadToDeg(this._angleX),sglRadToDeg(this._angleY),this._distance]},setState:function(e){this._panX=e[0],this._panY=e[1],this._angleX=sglDegToRad(e[2]),this._angleY=sglDegToRad(e[3]),this._distance=e[4],this._panX=this.clamp(this._panX,this._minMaxPanX[0],this._minMaxPanX[1]),this._panY=this.clamp(this._panY,this._minMaxPanY[0],this._minMaxPanY[1]),this._angleX=this.clamp(this._angleX,this._minMaxAngleX[0],this._minMaxAngleX[1]),this._angleY=this.clamp(this._angleY,this._minMaxAngleY[0],this._minMaxAngleY[1]),this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._computeMatrix()},animateToState:function(e){this._isAnimating=!1,this._targetPanX=e[0],this._targetPanY=e[1],this._targetAngleX=sglDegToRad(e[2]),this._targetAngleY=sglDegToRad(e[3]),this._targetDistance=e[4],this._targetPanX=this.clamp(this._targetPanX,this._minMaxPanX[0],this._minMaxPanX[1]),this._targetPanY=this.clamp(this._targetPanY,this._minMaxPanY[0],this._minMaxPanY[1]),this._targetAngleX=this.clamp(this._targetAngleX,this._minMaxAngleX[0],this._minMaxAngleX[1]),this._targetAngleY=this.clamp(this._targetAngleY,this._minMaxAngleY[0],this._minMaxAngleY[1]),this._targetDistance=this.clamp(this._targetDistance,this._minMaxDist[0],this._minMaxDist[1]),this._speedPanX=2,this._speedPanY=2,this._speedAngleX=Math.PI,this._speedAngleY=Math.PI,this._speedDistance=2
var t=Math.abs((this._targetPanX-this._panX)/this._speedPanX),i=Math.abs((this._targetPanY-this._panY)/this._speedPanY),r=Math.abs((this._targetAngleX-this._angleX)/this._speedAngleX),n=Math.abs((this._targetAngleY-this._angleY)/this._speedAngleY),a=Math.abs((this._targetDistance-this._distance)/this._speedDistance),s=Math.max(t,Math.max(i,Math.max(r,Math.max(n,a))))
s>1&&(s=1),this._speedPanX*=t/s,this._speedPanY*=i/s,this._speedAngleX*=r/s,this._speedAngleY*=n/s,this._speedDistance*=a/s,this._isAnimating=!0},tick:function(e){if(!this._isAnimating)return!1
var t=this._speedPanX*e,i=this._speedPanY*e,r=this._speedAngleX*e,n=this._speedAngleY*e,a=this._speedDistance*e,s=this._targetPanX-this._panX,o=this._targetPanY-this._panY,u=this._targetAngleX-this._angleX,c=this._targetAngleY-this._angleY,l=this._targetDistance-this._distance
return s>t?this._panX+=t:-t>s?this._panX-=t:this._panX=this._targetPanX,o>i?this._panY+=i:-i>o?this._panY-=i:this._panY=this._targetPanY,u>r?this._angleX+=r:-r>u?this._angleX-=r:this._angleX=this._targetAngleX,c>n?this._angleY+=n:-n>c?this._angleY-=n:this._angleY=this._targetAngleY,l>a?this._distance+=a:-a>l?this._distance-=a:this._distance=this._targetDistance,this._panX==this._targetPanX&&this._panX==this._targetPanX&&this._angleX==this._targetAngleX&&this._angleY==this._targetAngleY&&this._distance==this._targetDistance&&(this._isAnimating=!1),this._computeMatrix(),!0},get action(){return this._action},set action(e){this._action!=e&&(this._new_action=!0),this._action=e},get matrix(){return this._matrix},reset:function(){this._matrix=SglMat4.identity(),this._action=SGL_TRACKBALL_NO_ACTION,this._panX=this._startPanX,this._panY=this._startPanY,this._angleX=this._startAngleX,this._angleY=this._startAngleY,this._distance=this._startDistance,this._isAnimating=!1},track:function(e,t,i,r){this._new_action&&(this._start[0]=t,this._start[1]=i,this._new_action=!1)
var n=this._start[0]-t,a=this._start[1]-i
switch(this._start[0]=t,this._start[1]=i,this._action){case SGL_TRACKBALL_ROTATE:this._isAnimating=!1,this.rotate(e,n,a)
break
case SGL_TRACKBALL_PAN:this._isAnimating=!1,this.pan(e,n,a)
break
case SGL_TRACKBALL_SCALE:this._isAnimating=!1,this.scale(e,r)}return this._computeMatrix()},rotate:function(e,t,i){this._angleX+=t,this._angleY+=i,this._angleX=this.clamp(this._angleX,this._minMaxAngleX[0],this._minMaxAngleX[1]),this._angleY=this.clamp(this._angleY,this._minMaxAngleY[0],this._minMaxAngleY[1])},pan:function(e,t,i){this._panX-=t/2,this._panY-=i/2,this._panX=this.clamp(this._panX,this._minMaxPanX[0],this._minMaxPanX[1]),this._panY=this.clamp(this._panY,this._minMaxPanY[0],this._minMaxPanY[1])},scale:function(e,t){this._distance*=t,this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1])}},SphereTrackball.prototype={setup:function(e){e=e||{}
var t=sglGetDefaultObject({startCenter:[0,0,0],startDistance:2,minMaxDist:[.2,4]},e)
this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._startDistance=t.startDistance,this._distance=this._startDistance,this._minMaxDist=t.minMaxDist,this._matrix=SglMat4.identity(),this._sphereMatrix=SglMat4.identity(),this._pts=[[0,0],[0,0]],this._start=[0,0],this.reset()},clamp:function(e,t,i){return t>e?t:e>i?i:e},_computeMatrix:function(){var e=SglMat4.identity()
e=SglMat4.mul(e,SglMat4.translation([0,0,-this._distance])),e=SglMat4.mul(e,this._sphereMatrix),this._matrix=e},_projectOnSphere:function(e,i){var r=1,n=0,a=sglSqrt(e*e+i*i)
return.7071067811865476*r>a?n=sglSqrt(r*r-a*a):(t=r/1.4142135623730951,n=t*t/a),n},_transform:function(e,t,i,r){return SglMat4.mul4(e,[t,i,r,0])},_transformOnSphere:function(e,t,i){var r=this._projectOnSphere(t,i)
return this._transform(e,t,i,r)},_translate:function(e,t){var i=SglMat4.inverse(this._sphereMatrix),r=SglVec3.to4(e,0)
r=SglMat4.mul4(i,r),r=SglVec4.muls(r,t)
var n=SglMat4.translation(r)
this._sphereMatrix=SglMat4.mul(this._sphereMatrix,n)},getState:function(){return this._sphereMatrix},setState:function(e){this._sphereMatrix=e,this._computeMatrix()},animateToState:function(e){this._sphereMatrix=e,this._computeMatrix()},get action(){return this._action},set action(e){this._action!=e&&(this._new_action=!0),this._action=e},get matrix(){return this._matrix},reset:function(){this._matrix=SglMat4.identity(),this._sphereMatrix=SglMat4.identity(),this._distance=this._startDistance,this._pts=[[0,0],[0,0]],this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._computeMatrix()},track:function(e,t,i,r){this._new_action&&(this._start[0]=t,this._start[1]=i,this._new_action=!1)
var n=this._start[0]-t,a=this._start[1]-i
switch(this._start[0]=t,this._start[1]=i,this._pts[0][0]=this._pts[1][0]+n,this._pts[0][1]=this._pts[1][1]+a,this._pts[1][0]=n,this._pts[1][1]=a,this._action){case SGL_TRACKBALL_ROTATE:this.rotate(e)
break
case SGL_TRACKBALL_PAN:this.pan(e)
break
case SGL_TRACKBALL_DOLLY:this.dolly(e,r)
break
case SGL_TRACKBALL_SCALE:this.scale(e,r)}},rotate:function(e){if(this._pts[0][0]!=this._pts[1][0]||this._pts[0][1]!=this._pts[1][1]){var t=SglMat4.inverse(e),i=this._transformOnSphere(t,this._pts[0][0],this._pts[0][1]),r=this._transformOnSphere(t,this._pts[1][0],this._pts[1][1]),r=this._transformOnSphere(t,this._pts[1][0],this._pts[1][1]),r=this._transformOnSphere(t,this._pts[1][0],this._pts[1][1]),n=SglVec3.cross(i,r),a=SglVec3.length(n),s=SglMat4.rotationAngleAxis(a,n)
this._sphereMatrix=SglMat4.mul(s,this._sphereMatrix),this._computeMatrix()}},pan:function(e){var t=SglMat4.inverse(e),i=this._transform(t,this._pts[0][0],this._pts[0][1],-1),r=this._transform(t,this._pts[1][0],this._pts[1][1],-1),n=SglVec3.sub(r,i)
this._translate(n,2),this._computeMatrix()},dolly:function(e,t){var i=SglMat4.inverse(e),r=this._transform(i,0,0,t)
this._translate(r,1),this._computeMatrix()},scale:function(e,t){this._distance*=t,this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._computeMatrix()}},TurnTableTrackball.prototype={setup:function(e){e=e||{}
var t=sglGetDefaultObject({startCenter:[0,0,0],startPhi:0,startTheta:0,startDistance:2,minMaxDist:[.2,4],minMaxPhi:[-180,180],minMaxTheta:[-80,80]},e)
this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._matrix=SglMat4.identity(),this._center=t.startCenter,this._startPhi=sglDegToRad(t.startPhi),this._startTheta=sglDegToRad(t.startTheta),this._startDistance=t.startDistance,this._phi=this._startPhi,this._theta=this._startTheta,this._distance=this._startDistance,this._targetPhi=this._startPhi,this._targetTheta=this._startTheta,this._targetDistance=this._startDistance,this._isAnimating=!1,this._speedPhi=0,this._speedTheta=0,this._speedDistance=0,this._minMaxDist=t.minMaxDist,-180==t.minMaxPhi[0]&&180==t.minMaxPhi[1]?this._limitPhi=!1:this._limitPhi=!0,this._minMaxPhi=t.minMaxPhi,this._minMaxPhi[0]=sglDegToRad(this._minMaxPhi[0]),this._minMaxPhi[1]=sglDegToRad(this._minMaxPhi[1]),this._minMaxTheta=t.minMaxTheta,this._minMaxTheta[0]=sglDegToRad(this._minMaxTheta[0]),this._minMaxTheta[1]=sglDegToRad(this._minMaxTheta[1]),this._start=[0,0],this.reset()},clamp:function(e,t,i){return t>e?t:e>i?i:e},_computeMatrix:function(){var e=SglMat4.identity()
e=SglMat4.mul(e,SglMat4.translation([-this._center[0],-this._center[1],-this._center[2]])),e=SglMat4.mul(e,SglMat4.translation([0,0,-this._distance])),e=SglMat4.mul(e,SglMat4.rotationAngleAxis(this._theta,[1,0,0])),e=SglMat4.mul(e,SglMat4.rotationAngleAxis(this._phi,[0,-1,0])),this._matrix=e},getState:function(){return[sglRadToDeg(this._phi),sglRadToDeg(this._theta),this._distance]},setState:function(e){this._isAnimating=!1,this._phi=sglDegToRad(e[0]),this._theta=sglDegToRad(e[1]),this._distance=e[2],this._limitPhi&&(this._phi=this.clamp(this._phi,this._minMaxPhi[0],this._minMaxPhi[1])),this._theta=this.clamp(this._theta,this._minMaxTheta[0],this._minMaxTheta[1]),this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._computeMatrix()},animateToState:function(e){if(this._isAnimating=!1,this._targetPhi=sglDegToRad(e[0]),this._targetTheta=sglDegToRad(e[1]),this._targetDistance=e[2],this._limitPhi&&(this._targetPhi=this.clamp(this._targetPhi,this._minMaxPhi[0],this._minMaxPhi[1])),this._targetTheta=this.clamp(this._targetTheta,this._minMaxTheta[0],this._minMaxTheta[1]),this._targetDistance=this.clamp(this._targetDistance,this._minMaxDist[0],this._minMaxDist[1]),this._speedPhi=Math.PI,this._speedTheta=Math.PI,this._speedDistance=2,!this._limitPhi){for(;this._phi>2*Math.PI;)this._phi-=2*Math.PI
for(;this._phi<0;)this._phi+=2*Math.PI
for(var t=this._targetPhi;t>2*Math.PI;)t-=2*Math.PI
for(;0>t;)t+=2*Math.PI
Math.abs(t-this._phi)<Math.PI?t>this._phi?this.speedphi=Math.PI:this.speedphi=-Math.PI:t>this._phi?(t-=2*Math.PI,this.speedphi=-Math.PI):(t+=2*Math.PI,this.speedphi=Math.PI),this._targetPhi=t}var i=Math.abs((this._targetPhi-this._phi)/this._speedPhi),r=Math.abs((this._targetTheta-this._theta)/this._speedTheta),n=Math.abs((this._targetDistance-this._distance)/this._speedDistance),a=Math.max(i,Math.max(r,n))
a>1&&(a=1),this._speedPhi*=i/a,this._speedTheta*=r/a,this._speedDistance*=n/a,this._isAnimating=!0},tick:function(e){if(!this._isAnimating)return!1
var t=this._speedPhi*e,i=this._speedTheta*e,r=this._speedDistance*e,n=this._targetPhi-this._phi,a=this._targetTheta-this._theta,s=this._targetDistance-this._distance
return n>t?this._phi+=t:-t>n?this._phi-=t:this._phi=this._targetPhi,a>i?this._theta+=i:-i>a?this._theta-=i:this._theta=this._targetTheta,s>r?this._distance+=r:-r>s?this._distance-=r:this._distance=this._targetDistance,this._phi==this._targetPhi&&this._theta==this._targetTheta&&this._distance==this._targetDistance&&(this._isAnimating=!1),this._computeMatrix(),!0},get action(){return this._action},set action(e){this._action!=e&&(this._new_action=!0),this._action=e},get matrix(){return this._matrix},reset:function(){this._matrix=SglMat4.identity(),this._action=SGL_TRACKBALL_NO_ACTION,this._phi=this._startPhi,this._theta=this._startTheta,this._distance=this._startDistance,this._isAnimating=!1},track:function(e,t,i,r){this._new_action&&(this._start[0]=t,this._start[1]=i,this._new_action=!1)
var n=this._start[0]-t,a=this._start[1]-i
switch(this._start[0]=t,this._start[1]=i,this._action){case SGL_TRACKBALL_ROTATE:this._isAnimating=!1,this.rotate(e,n,a)
break
case SGL_TRACKBALL_PAN:break
case SGL_TRACKBALL_SCALE:this._isAnimating=!1,this.scale(e,r)}return this._computeMatrix()},rotate:function(e,t,i){this._phi+=t,this._limitPhi&&(this._phi=this.clamp(this._phi,this._minMaxPhi[0],this._minMaxPhi[1])),this._phi>20&&(this._phi=this._phi-20),this._phi<-20&&(this._phi=this._phi+20),this._theta+=i,this._theta=this.clamp(this._theta,this._minMaxTheta[0],this._minMaxTheta[1])},scale:function(e,t){this._distance*=t,this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1])}},TurntablePanTrackball.prototype={setup:function(e){e=e||{}
var t=sglGetDefaultObject({startCenter:[0,0,0],startPhi:0,startTheta:0,startDistance:2,startPanX:0,startPanY:0,startPanZ:0,minMaxDist:[.2,4],minMaxPhi:[-180,180],minMaxTheta:[-80,80],minMaxPanX:[-1,1],minMaxPanY:[-1,1],minMaxPanZ:[-1,1]},e)
this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._matrix=SglMat4.identity(),this._center=t.startCenter,this._startPhi=sglDegToRad(t.startPhi),this._startTheta=sglDegToRad(t.startTheta),this._startPanX=t.startPanX,this._startPanY=t.startPanY,this._startPanZ=t.startPanZ,this._startDistance=t.startDistance,this._phi=this._startPhi,this._theta=this._startTheta,this._panX=this._startPanX,this._panY=this._startPanY,this._panZ=this._startPanZ,this._distance=this._startDistance,this._isAnimating=!1,-180==t.minMaxPhi[0]&&180==t.minMaxPhi[1]?this._limitPhi=!1:this._limitPhi=!0,this._minMaxPhi=t.minMaxPhi,this._minMaxPhi[0]=sglDegToRad(this._minMaxPhi[0]),this._minMaxPhi[1]=sglDegToRad(this._minMaxPhi[1]),this._minMaxTheta=t.minMaxTheta,this._minMaxTheta[0]=sglDegToRad(this._minMaxTheta[0]),this._minMaxTheta[1]=sglDegToRad(this._minMaxTheta[1]),this._minMaxPanX=t.minMaxPanX,this._minMaxPanY=t.minMaxPanY,this._minMaxPanZ=t.minMaxPanZ,this._minMaxDist=t.minMaxDist,this._start=[0,0],this.reset()},clamp:function(e,t,i){return t>e?t:e>i?i:e},_computeMatrix:function(){var e=SglMat4.identity()
e=SglMat4.mul(e,SglMat4.translation([-this._center[0],-this._center[1],-this._center[2]])),e=SglMat4.mul(e,SglMat4.translation([0,0,-this._distance])),e=SglMat4.mul(e,SglMat4.rotationAngleAxis(this._theta,[1,0,0])),e=SglMat4.mul(e,SglMat4.rotationAngleAxis(this._phi,[0,-1,0])),e=SglMat4.mul(e,SglMat4.translation([-this._panX,-this._panY,-this._panZ])),this._matrix=e},getState:function(){return[sglRadToDeg(this._phi),sglRadToDeg(this._theta),this._panX,this._panY,this._panZ,this._distance]},setState:function(e){this._isAnimating=!1,this._phi=sglDegToRad(e[0]),this._theta=sglDegToRad(e[1]),this._panX=e[2],this._panY=e[3],this._panZ=e[4],this._distance=e[5],this._limitPhi&&(this._phi=this.clamp(this._phi,this._minMaxPhi[0],this._minMaxPhi[1])),this._theta=this.clamp(this._theta,this._minMaxTheta[0],this._minMaxTheta[1]),this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._panX=this.clamp(this._panX,this._minMaxPanX[0],this._minMaxPanX[1]),this._panY=this.clamp(this._panY,this._minMaxPanY[0],this._minMaxPanY[1]),this._panZ=this.clamp(this._panZ,this._minMaxPanZ[0],this._minMaxPanZ[1]),this._computeMatrix()},animateToState:function(e){if(this._isAnimating=!1,this._targetPhi=sglDegToRad(e[0]),this._targetTheta=sglDegToRad(e[1]),this._targetPanX=e[2],this._targetPanY=e[3],this._targetPanZ=e[4],this._targetDistance=e[5],this._limitPhi&&(this._targetPhi=this.clamp(this._targetPhi,this._minMaxPhi[0],this._minMaxPhi[1])),this._targetTheta=this.clamp(this._targetTheta,this._minMaxTheta[0],this._minMaxTheta[1]),this._targetPanX=this.clamp(this._targetPanX,this._minMaxPanX[0],this._minMaxPanX[1]),this._targetPanY=this.clamp(this._targetPanY,this._minMaxPanY[0],this._minMaxPanY[1]),this._targetPanZ=this.clamp(this._targetPanZ,this._minMaxPanZ[0],this._minMaxPanZ[1]),this._targetDistance=this.clamp(this._targetDistance,this._minMaxDist[0],this._minMaxDist[1]),this._speedPhi=Math.PI,this._speedTheta=Math.PI,this._speedPanX=1,this._speedPanY=1,this._speedPanZ=1,this._speedDistance=2,!this._limitPhi){for(;this._phi>2*Math.PI;)this._phi-=2*Math.PI
for(;this._phi<0;)this._phi+=2*Math.PI
for(var t=this._targetPhi;t>2*Math.PI;)t-=2*Math.PI
for(;0>t;)t+=2*Math.PI
Math.abs(t-this._phi)<Math.PI?t>this._phi?this.speedphi=Math.PI:this.speedphi=-Math.PI:t>this._phi?(t-=2*Math.PI,this.speedphi=-Math.PI):(t+=2*Math.PI,this.speedphi=Math.PI),this._targetPhi=t}var i=Math.abs((this._targetPhi-this._phi)/this._speedPhi),r=Math.abs((this._targetTheta-this._theta)/this._speedTheta),n=Math.abs((this._targetDistance-this._distance)/this._speedDistance),a=Math.abs((this._targetPanX-this._panX)/this._speedPanX),s=Math.abs((this._targetPanY-this._panY)/this._speedPanY),o=Math.abs((this._targetPanZ-this._panZ)/this._speedPanZ),u=Math.max(i,Math.max(r,Math.max(n,Math.max(a,Math.max(s,o)))))
u=this.clamp(u,.5,2),this._speedPhi*=i/u,this._speedTheta*=r/u,this._speedDistance*=n/u,this._speedPanX*=a/u,this._speedPanY*=s/u,this._speedPanZ*=o/u,this._isAnimating=!0},tick:function(e){if(!this._isAnimating)return!1
var t=this._speedPhi*e,i=this._speedTheta*e,r=this._speedDistance*e,n=this._speedPanX*e,a=this._speedPanY*e,s=this._speedPanZ*e,o=this._targetPhi-this._phi,u=this._targetTheta-this._theta,c=this._targetDistance-this._distance,l=this._targetPanX-this._panX,h=this._targetPanY-this._panY,d=this._targetPanZ-this._panZ
return o>t?this._phi+=t:-t>o?this._phi-=t:this._phi=this._targetPhi,u>i?this._theta+=i:-i>u?this._theta-=i:this._theta=this._targetTheta,c>r?this._distance+=r:-r>c?this._distance-=r:this._distance=this._targetDistance,l>n?this._panX+=n:-n>l?this._panX-=n:this._panX=this._targetPanX,h>a?this._panY+=a:-a>h?this._panY-=a:this._panY=this._targetPanY,d>s?this._panZ+=s:-s>d?this._panZ-=s:this._panZ=this._targetPanZ,this._phi==this._targetPhi&&this._theta==this._targetTheta&&this._distance==this._targetDistance&&this._panX==this._targetPanX&&this._panY==this._targetPanY&&this._panZ==this._targetPanZ&&(this._isAnimating=!1),this._computeMatrix(),!0},get action(){return this._action},set action(e){this._action!=e&&(this._new_action=!0),this._action=e},get matrix(){return this._matrix},reset:function(){this._matrix=SglMat4.identity(),this._action=SGL_TRACKBALL_NO_ACTION,this._phi=this._startPhi,this._theta=this._startTheta,this._distance=this._startDistance,this._panX=this._startPanX,this._panY=this._startPanY,this._panZ=this._startPanZ,this._isAnimating=!1},track:function(e,t,i,r){this._new_action&&(this._start[0]=t,this._start[1]=i,this._new_action=!1)
var n=this._start[0]-t,a=this._start[1]-i
switch(this._start[0]=t,this._start[1]=i,this._action){case SGL_TRACKBALL_ROTATE:this._isAnimating=!1,this.rotate(e,n,a)
break
case SGL_TRACKBALL_PAN:this._isAnimating=!1,this.pan(e,n,a)
break
case SGL_TRACKBALL_SCALE:this._isAnimating=!1,this.scale(e,r)}return this._computeMatrix()},pan:function(e,t,i){var r=[1,0,0,1],n=[0,1,0,1],a=[0,0,1,1]
r=SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi,[0,-1,0]),r),n=SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi,[0,-1,0]),n),a=SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi,[0,-1,0]),a),r=SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta,[1,0,0]),r),n=SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta,[1,0,0]),n),a=SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta,[1,0,0]),a),this._panX+=t*r[0]+i*r[1],this._panY+=t*n[0]+i*n[1],this._panZ+=t*a[0]+i*a[1],this._panX=this.clamp(this._panX,this._minMaxPanX[0],this._minMaxPanX[1]),this._panY=this.clamp(this._panY,this._minMaxPanY[0],this._minMaxPanY[1]),this._panZ=this.clamp(this._panZ,this._minMaxPanZ[0],this._minMaxPanZ[1])},rotate:function(e,t,i){this._phi+=t,this._limitPhi&&(this._phi=this.clamp(this._phi,this._minMaxPhi[0],this._minMaxPhi[1])),this._phi>20&&(this._phi=this._phi-20),this._phi<-20&&(this._phi=this._phi+20),this._theta+=i,this._theta=this.clamp(this._theta,this._minMaxTheta[0],this._minMaxTheta[1])},scale:function(e,t){this._distance*=t,this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1])}}
