{"version":3,"sources":["spidergl.js","presenter.js","ply.js","trackball_pantilt.js","trackball_sphere.js","trackball_turntable.js","trackball_turntable_pan.js","init.js"],"names":["SpiderGL","TAG","openNamespace","options","isConstant","name","constantRegExp","test","isNamespaceOrClass","namespaceOrClassRegExp","isFunction","functionRegExp","initialCap","substr","toUpperCase","collect","module","x","y","classes","functions","constants","Utility","getDefaultObject","globalObject","DEFAULT_GLOBAL_OBJECT","constantPrefix","DEFAULT_CONSTANT_PREFIX","functionPrefix","DEFAULT_FUNCTION_PREFIX","classPrefix","DEFAULT_CLASS_PREFIX","RegExp","modules","window","Version","VERSION_MAJOR","VERSION_MINOR","VERSION_REVISION","VERSION_STRING","Core","DEFAULT","DONT_CARE","EMPTY_STRING","EMPTY_OBJECT","EMPTY_ARRAY","EMPTY_FUNCTION","generateUID","_lastUID","ObjectBase","this","_uid","prototype","uid","Type","LITTLE_ENDIAN","a","Uint8Array","b","Uint16Array","buffer","BIG_ENDIAN","NO_TYPE","INT8","UINT8","INT16","UINT16","INT32","UINT32","FLOAT32","SIZEOF_INT8","Int8Array","BYTES_PER_ELEMENT","SIZEOF_UINT8","SIZEOF_INT16","Int16Array","SIZEOF_UINT16","SIZEOF_INT32","Int32Array","SIZEOF_UINT32","Uint32Array","SIZEOF_FLOAT32","Float32Array","typeSize","typeMap","sglType","typeToGL","WebGLRenderingContext","NONE","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","FLOAT","typeFromGL","glType","typeSizeFromGL","typeToTypedArrayConstructor","ArrayBuffer","POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_FAN","TRIANGLE_STRIP","primitiveToGL","enumMap","sglEnum","instanceOf","arg","ctor","isNumber","isString","isArray","constructor","Array","isTypedArray","extend","derived","base","inheritance","dproto","iproto","getter","setter","p","__lookupGetter__","__defineGetter__","__lookupSetter__","__defineSetter__","defineClassGetter","func","defineClassSetter","defineObjectGetter","obj","defineObjectSetter","getDefaultValue","defaultValue","undefined","defaultObj","sDefault","setDefaultValues","getAttrib4fv","getTime","Date","Timer","_tStart","_tElapsed","_accumElapsed","now","start","isStarted","isPaused","restart","r","elapsed","stop","pause","resume","DOM","getElementById","elementId","document","getElementText","elem","str","firstChild","nodeType","textContent","nextSibling","IO","Request","url","call","async","DEFAULT_ASYNC","send","DEFAULT_SEND","onProgress","onCancel","onError","onSuccess","onFinish","_url","_async","_status","_sent","_aborted","_data","_loaded","_total","_events","progress","main","listeners","cancel","error","success","finish","ONGOING","CANCELLED","FAILED","SUCCEEDED","_indexOf","handlers","h","i","n","length","_setMainListener","eventName","eventHandler","evt","addEventListener","removeEventListener","_dispatch","arguments","args","slice","push","lst","apply","_doPostProgress","_doPostCancel","_doPostError","_doPostSuccess","_doPostFinish","_doOnProgress","loaded","total","_doOnCancel","_finishTime","_doOnError","_doOnSuccess","_doOnFinish","_doSend","_doCancel","canSend","s","status","data","bytesLoaded","bytesTotal","sent","ongoing","cancelled","failed","succeeded","finished","startTime","_startTime","finishTime","elapsedTime","idx","splice","f","XHRRequestBase","that","xhr","XMLHttpRequest","_xhr","onprogress","_xhrOnProgress","onabort","onerror","onload","_range","open","range","rangeStr","setRequestHeader","_prepareXHR","abort","lengthComputable","XHRRequest","responseText","response","TextRequest","text","readText","requestText","JSONRequest","JSON","parse","json","readJSON","requestJSON","BinaryRequest","overrideMime","overrideMimeType","responseType","_setArrayBuffer","mozResponseArrayBuffer","String","arr","charCodeAt","readBinary","requestBinary","ImageRequest","img","Image","_img","_imgOnProgress","src","image","requestImage","AggregateRequest","_proxyOnProgress","req","_reqOnProgress","_proxyOnCancel","_reqOnCancel","_proxyOnError","_reqOnError","_proxyOnSuccess","_reqOnSuccess","_proxyOnFinish","_reqOnFinish","_aggrStartTime","_aggrFinishTime","_eventReq","_cancelledReqs","_failedReqs","_succeededReqs","_requests","requests","_installProxies","addRequest","_requestsFinished","_uninstallProxies","eventSenderRequest","requests$","removeRequest","Math","DEG_TO_RAD","PI","E","LN2","LN10","LOG2E","LOG10E","RAD_TO_DEG","SQRT2","MAX_VALUE","Number","MIN_VALUE","MAX_NUMBER","MIN_NUMBER","NAN","NaN","INFINITY","Infinity","abs","acos","asin","atan","atan2","ceil","clamp","min","max","cos","degToRad","exp","floor","lerp","t","ln","log","log2","log10","pow","radToDeg","random","random01","random11","randomRange","round","sqrt","sin","tan","Vec2","dup","v","scalar","zero","one","maxNumber","minNumber","to3","z","to4","w","neg","add","u","adds","sub","subs","ssub","mul","muls","div","divs","sdiv","rcp","dot","cross","perp","sqLength","normalize","copy$","neg$","add$","adds$","sub$","subs$","ssub$","mul$","muls$","div$","divs$","sdiv$","perp$","v0","normalize$","Vec3","to2","Vec4","c","d","e","project","Mat3","m","diag","identity","to44","mul2","mul3","transpose","Mat4","to33","row","col","elem$","value","row$","col$","isIdentity","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","a11","a12","a13","a14","a15","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15","mul4","compMul","compDiv","determinant","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","inverse","inverseTranspose33","m21","m31","m22","m32","m23","m33","trace","translation","rotationAngleAxis","angle","axis","xx","yy","zz","xy","yz","zx","xs","ys","zs","ax","q","scaling","lookAt","position","target","up","translate$","ortho","sum","dif","frustum","perspective","fovY","aspectRatio","zNear","zFar","dst","identity$","compMul$","compDiv$","transpose$","invert$","rotateAngleAxis$","scale$","Quat","px","py","pz","pw","qx","qy","qz","qw","from33","m00","m20","m01","m02","xz","xw","yw","zw","from44","fromAngleAxis","toAngleAxis","fromEulerAngles","toEulerAngles","xyzw","modelViewProjectionMatrix","viewport","depthRange","v3","invW","unproject","xyz","modelViewProjectionMatrixInverse","Space","MatrixStack","onChange","_onChange","reset","_invalidate","_i","_t","_it","_s","_l","_m","size","matrix$","matrix","top$","top","inverse$","inverseTranspose$","inverseTranspose","pop","load","loadIdentity","multiply","translate","rotate","scale","ViewportStack","_r","rect$","rect","inner","DepthRangeStack","range$","TransformationStack","_mv","_vp","_mvp","_n","_c","_v","_p","_viewport","_depth","viewportRect$","viewportRect","depth","depthRange$","model","modelMatrix$","modelMatrix","modelMatrixInverse$","modelMatrixInverse","modelMatrixTranspose$","modelMatrixTranspose","modelMatrixInverseTranspose$","modelMatrixInverseTranspose","view","viewMatrix$","viewMatrix","viewMatrixInverse$","viewMatrixInverse","viewMatrixTranspose$","viewMatrixTranspose","viewMatrixInverseTranspose$","viewMatrixInverseTranspose","projection","projectionMatrix$","projectionMatrix","projectionMatrixInverse$","projectionMatrixInverse","projectionMatrixTranspose$","projectionMatrixTranspose","projectionMatrixInverseTranspose$","projectionMatrixInverseTranspose","modelViewMatrix$","modelViewMatrix","modelViewMatrixInverse$","modelViewMatrixInverse","modelViewMatrixTranspose$","modelViewMatrixTranspose","modelViewMatrixInverseTranspose$","it","modelViewMatrixInverseTranspose","viewProjectionMatrix$","viewProjectionMatrix","viewProjectionMatrixInverse$","viewProjectionMatrixInverse","viewProjectionMatrixTranspose$","viewProjectionMatrixTranspose","viewProjectionMatrixInverseTranspose$","viewProjectionMatrixInverseTranspose","modelViewProjectionMatrix$","modelViewProjectionMatrixInverse$","modelViewProjectionMatrixTranspose$","modelViewProjectionMatrixTranspose","modelViewProjectionMatrixInverseTranspose$","modelViewProjectionMatrixInverseTranspose","worldSpaceNormalMatrix$","worldSpaceNormalMatrix","viewSpaceNormalMatrix$","viewSpaceNormalMatrix","modelSpaceViewerPosition$","mp","modelSpaceViewerPosition","worldSpaceViewerPosition$","wp","worldSpaceViewerPosition","modelSpaceViewDirection$","md","modelSpaceViewDirection","worldSpaceViewDirection$","wd","worldSpaceViewDirection","WebGL","Context","WEBGL_STRING","DEFAULT_UNPACK_FLIP_Y","DEFAULT_UNPACK_PREMULTIPLY_ALPHA","DEFAULT_UNPACK_COLORSPACE_CONVERSION","get","canvas","HTMLCanvasElement","ctx","getContext","_prepareContex","gl","sgl","_spidergl","glFunctions","fn","_addExtension","extName","propName","setupFunc","getExtension","pubExt","ext","_ext","_setup_SGL_current_binding","cb","currentBuffer","ARRAY_BUFFER","getParameter","ARRAY_BUFFER_BINDING","ELEMENT_ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER_BINDING","bufferStack","bindBuffer","current","getCurrentBuffer","pushBuffer","stack","popBuffer","currentFramebuffer","FRAMEBUFFER","FRAMEBUFFER_BINDING","framebufferStack","bindFramebuffer","framebuffer","getCurrentFramebuffer","pushFramebuffer","popFramebuffer","currentProgram","CURRENT_PROGRAM","programStack","useProgram","program","getCurrentProgram","pushProgram","popProgram","currentRenderbuffer","RENDERBUFFER","RENDERBUFFER_BINDING","renderbufferStack","bindRenderbuffer","renderbuffer","getCurrentRenderbuffer","pushRenderbuffer","popRenderbuffer","currentShader","VERTEX_SHADER","FRAGMENT_SHADER","shaderStack","bindShader","shader","getCurrentShader","pushShader","popShader","currentTexture","currentTextureUnit","ACTIVE_TEXTURE","textureUnitsCount","MAX_TEXTURE_IMAGE_UNITS","textureStack","textureUnitStack","textureUnit","TEXTURE0","activeTexture","textureBindings","TEXTURE_2D","TEXTURE_BINDING_2D","TEXTURE_CUBE_MAP","TEXTURE_BINDING_CUBE_MAP","textureStacks","texture","getCurrentTextureUnit","pushTextureUnit","unit","popTextureUnit","bindTexture","getCurrentTexture","pushTexture","popTexture","_setup_SGL_wrapper_notify","wn","deleteBuffer","_gl_deleteBuffer","isBuffer","_gl_isBuffer","_gl_bindBuffer","getBufferParameter","_gl_getBufferParameter","bufferData","_gl_bufferData","bufferSubData","_gl_bufferSubData","vertexAttribPointer","_gl_vertexAttribPointer","drawElements","mode","count","type","offset","_gl_drawElements","deleteFramebuffer","_gl_deleteFramebuffer","isFramebuffer","_gl_isFramebuffer","_gl_bindFramebuffer","checkFramebufferStatus","_gl_checkFramebufferStatus","getFramebufferAttachmentParameter","_gl_getFramebufferAttachmentParameter","framebufferRenderbuffer","_gl_framebufferRenderbuffer","framebufferTexture2D","_gl_framebufferTexture2D","clear","_gl_clear","readPixels","_gl_readPixels","deleteProgram","_gl_deleteProgram","isProgram","_gl_isProgram","_gl_useProgram","getActiveAttrib","_gl_getActiveAttrib","getActiveUniform","_gl_getActiveUniform","getAttachedShaders","_gl_getAttachedShaders","getAttribLocation","_gl_getAttribLocation","getProgramParameter","_gl_getProgramParameter","getProgramInfoLog","_gl_getProgramInfoLog","getUniform","_gl_getUniform","getUniformLocation","_gl_getUniformLocation","attachShader","_gl_attachShader","bindAttribLocation","_gl_bindAttribLocation","detachShader","_gl_detachShader","linkProgram","_gl_linkProgram","uniform1f","_gl_uniform1f","uniform1fv","_gl_uniform1fv","uniform1i","_gl_uniform1i","uniform1iv","_gl_uniform1iv","uniform2f","_gl_uniform2f","uniform2fv","_gl_uniform2fv","uniform2i","_gl_uniform2i","uniform2iv","_gl_uniform2iv","uniform3f","_gl_uniform3f","uniform3fv","_gl_uniform3fv","uniform3i","_gl_uniform3i","uniform3iv","_gl_uniform3iv","uniform4f","_gl_uniform4f","uniform4fv","_gl_uniform4fv","uniform4i","_gl_uniform4i","uniform4iv","_gl_uniform4iv","uniformMatrix2fv","_gl_uniformMatrix2fv","uniformMatrix3fv","_gl_uniformMatrix3fv","uniformMatrix4fv","_gl_uniformMatrix4fv","validateProgram","_gl_validateProgram","deleteRenderbuffer","_gl_deleteRenderbuffer","isRenderbuffer","_gl_isRenderbuffer","_gl_bindRenderbuffer","getRenderbufferParameter","_gl_getRenderbufferParameter","renderbufferStorage","_gl_renderbufferStorage","deleteShader","_gl_deleteShader","isShader","_gl_isShader","getShaderParameter","_gl_getShaderParameter","getShaderInfoLog","_gl_getShaderInfoLog","getShaderSource","_gl_getShaderSource","compileShader","_gl_compileShader","shaderSource","_gl_shaderSource","textureTargetMap","TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_CUBE_MAP_NEGATIVE_X","TEXTURE_CUBE_MAP_POSITIVE_Y","TEXTURE_CUBE_MAP_NEGATIVE_Y","TEXTURE_CUBE_MAP_POSITIVE_Z","TEXTURE_CUBE_MAP_NEGATIVE_Z","deleteTexture","_gl_deleteTexture","isTexture","_gl_isTexture","_gl_bindTexture","getTexParameter","_gl_getTexParameter","copyTexImage2D","texTarget","_gl_copyTexImage2D","copyTexSubImage2D","_gl_copyTexSubImage2D","generateMipmap","_gl_generateMipmap","texImage2D","_gl_texImage2D","texParameterf","_gl_texParameterf","texParameteri","_gl_texParameteri","texSubImage2D","_gl_texSubImage2D","_setup_SGL_direct_state_access","dsa","pname","dataOrSize","usage","indx","normalized","stride","attachment","renderbuffertarget","textarget","level","mask","width","height","format","pixels","location","internalformat","shaderIsNull","border","xoffset","yoffset","param","currentUnit","hijack","hijacked","isHijacked","getHijacked","setStandardGLUnpack","pixelStorei","UNPACK_FLIP_Y_WEBGL","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_COLORSPACE_CONVERSION_WEBGL","ObjectGL","handle","_gl","_cb","_dsa","_h","TARGET","unbind","isValid","isReady","destroy","bind","Buffer","WebGLBuffer","DEFAULT_USAGE","BUFFER_SIZE","BUFFER_USAGE","createBuffer","_size","_usage","setData","setSize","STATIC_DRAW","DEFAULT_SUB_DATA_OFFSET","sizeOrData","setSubData","VertexBuffer","DEFAULT_ATTRIBUTE_INDEX","DEFAULT_ATTRIBUTE_SIZE","DEFAULT_ATTRIBUTE_TYPE","DEFAULT_ATTRIBUTE_NORMALIZED","DEFAULT_ATTRIBUTE_STRIDE","DEFAULT_ATTRIBUTE_OFFSET","DEFAULT_ATTRIBUTE_ENABLE","index","enable","enableVertexAttribArray","IndexBuffer","DEFAULT_DRAW_ELEMENTS_MODE","DEFAULT_DRAW_ELEMENTS_COUNT","DEFAULT_DRAW_ELEMENTS_TYPE","DEFAULT_DRAW_ELEMENTS_OFFSET","glMode","bytesPerElem","Framebuffer","WebGLFramebuffer","autoViewport","DEFAULT_AUTO_VIEWPORT","imported","createFramebuffer","_attachments","_autoViewport","resource","_attachmentName","att","FRAMEBUFFER_ATTACHMENT_OBJECT_NAME","FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE","_importRenderbuffer","TEXTURE","FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL","FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE","_importTexture","setAttachments","DEFAULT_ATTACHMENT_TEXTURE_LEVEL","DEFAULT_ATTACHMENT_CUBE_MAP_FACE","DEFAULT_READ_PIXELS_X","DEFAULT_READ_PIXELS_Y","DEFAULT_READ_PIXELS_WIDTH","DEFAULT_READ_PIXELS_HEIGHT","DEFAULT_READ_PIXELS_FORMAT","RGBA","DEFAULT_CLEAR_MASK","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","DEFAULT_READ_PIXELS_TYPE","COLOR_ATTACHMENT0","DEPTH_ATTACHMENT","STENCIL_ATTACHMENT","DEPTH_STENCIL_ATTACHMENT","face","Texture2D","TextureCubeMap","Renderbuffer","_setAttachment","nfo","isNullResource","resourceType","WebGLTexture","WebGLRenderbuffer","Texture","cubeFaceSpecified","isCubemap","isComplete","FRAMEBUFFER_COMPLETE","on","attachments","color","depthStencil","stencil","getAttachments","rAtts","detachAll","colorTarget","rt","depthTarget","stencilTarget","depthStencilTarget","applyViewport","vp","setViewport","svp","Program","WebGLProgram","autoLink","DEFAULT_AUTO_LINK","linked","LINK_STATUS","createProgram","_shaders","_linked","_log","_autoLink","_attributes","_uniforms","shaders","_importShader","mustLink","_addShaders","_setAttributes","attributes","link","_postLink","setUniforms","uniforms","_uniformSetFunctions","BOOL","BOOL_VEC2","BOOL_VEC3","BOOL_VEC4","INT_VEC2","INT_VEC3","INT_VEC4","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","FLOAT_MAT2","FLOAT_MAT3","FLOAT_MAT4","SAMPLER_2D","SAMPLER_CUBE","_shaderHandleIndex","_shaderIndex","indexOf","shd","SHADER_TYPE","VertexShader","FragmentShader","_updateActiveInfo","loc","ACTIVE_ATTRIBUTES","ACTIVE_UNIFORMS","setValue","lastIndexOf","arrayName","j","subName","hshd","Shader","WebGLShader","_removeShaders","isLinked","addShaders","removeShaders","hasShader","getShaders","validate","validated","VALIDATE_STATUS","setAttributes","getAttributesNames","rAttributes","getAttributesIndices","getAttributesInfo","attribute","uniform","getUniformsNames","rUniforms","getUniformsValues","getUniformsInfo","RENDERBUFFER_INTERNAL_FORMAT","RENDERBUFFER_WIDTH","RENDERBUFFER_HEIGHT","createRenderbuffer","_width","_height","_format","internalFormat","setStorage","source","autoCompile","DEFAULT_AUTO_COMPILE","compiled","deleted","COMPILE_STATUS","DELETE_STATUS","createShader","_source","_compiled","_autoCompile","setSource","_postCompile","isCompiled","compile","magFilter","DEFAULT_MAG_FILTER","minFilter","DEFAULT_MIN_FILTER","wrapS","DEFAULT_WRAP_S","wrapT","DEFAULT_WRAP_T","flipYPolicy","premultiplyAlphaPolicy","colorspaceConversionPolicy","autoMipmap","DEFAULT_AUTO_GENERATE_MIPMAP","createTexture","_magFilter","TEXTURE_MAG_FILTER","_minFilter","TEXTURE_MIN_FILTER","_wrapS","TEXTURE_WRAP_S","_wrapT","TEXTURE_WRAP_T","_flipY","_premultiplyAlpha","_colorspaceConversion","_autoMipmap","_missingFaces","_FACE_ALL_BITS","setSampler","DEFAULT_BORDER","DEFAULT_FORMAT","DEFAULT_INTERNAL_FORMAT","DEFAULT_LEVEL","LINEAR","DEFAULT_TYPE","REPEAT","DEFAULT_X_OFFSET","DEFAULT_Y_OFFSET","_FACE_POSITIVE_X_BIT","_FACE_NEGATIVE_X_BIT","_FACE_POSITIVE_Y_BIT","_FACE_NEGATIVE_Y_BIT","_FACE_POSITIVE_Z_BIT","_FACE_NEGATIVE_Z_BIT","_faceBits","_setTexParameter","_setImageData","fullImage","flipY","premultiplyAlpha","colorspaceConversion","isURL","isData","isElement","HTMLImageElement","HTMLVideoElement","ImageData","userFlipY","userPremultiplyAlpha","userColorspaceConversion","imageUpdated","opts","_setImage","_setSubImage","premultuplyAlphaPolicy","_premultuplyAlpha","sampler","getSampler","setImage","setSubImage","faceTargets","_faceTargets","urls","imagesLeft","datas","Model","descriptor","_createSimpleDescriptor","_descriptor","_fixDescriptor","_renderData","updateGL","updateRenderData","DEFAULT_VERTEX_STREAM_SIZE","DEFAULT_VERTEX_STREAM_TYPE","DEFAULT_VERTEX_STREAM_NORMALIZED","DEFAULT_VERTEX_STREAM_STRIDE","DEFAULT_VERTEX_STREAM_OFFSET","DEFAULT_PRIMITIVE_STREAM_MODE","DEFAULT_PRIMITIVE_STREAM_FIRST","DEFAULT_PRIMITIVE_STREAM_COUNT","DEFAULT_PRIMITIVE_STREAM_TYPE","DEFAULT_PRIMITIVE_STREAM_OFFSET","DEFAULT_SIMPLE_MODEL_VERTEX_MAP","semantic","DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP","version","meta","access","logic","_fixDescriptorMeta","_fixDescriptorData","_fixDescriptorAccess","_fixDescriptorSemantic","_fixDescriptorLogic","author","date","description","vertexBuffers","indexBuffers","_fixDescriptorDataVertexBuffers","_fixDescriptorDataIndexBuffers","_fixDescriptorDataVertexBuffer","_fixDescriptorDataBuffer","_fixDescriptorDataIndexBuffer","untypedArray","typedArray","glBuffer","vertexStreams","primitiveStreams","_fixDescriptorAccessVertexStreams","_fixDescriptorAccessPrimitiveStreams","_fixDescriptorAccessVertexStream","_fixDescriptorAccessPrimitiveStream","first","bindings","chunks","_fixDescriptorSemanticBindings","_fixDescriptorSemanticChunks","_fixDescriptorSemanticBinding","_fixDescriptorSemanticBindingVertexStreams","_fixDescriptorSemanticBindingPrimitiveStreams","_fixDescriptorSemanticBindingVertexStream","_fixDescriptorSemanticBindingPrimitiveStream","_fixDescriptorSemanticChunk","techniques","_fixDescriptorSemanticChunkTechniques","_fixDescriptorSemanticChunkTechnique","binding","parts","_fixDescriptorLogicParts","_fixDescriptorLogicPart","_fixDescriptorLogicPartChunks","vertices","primitives","bindingName","chunkName","partName","vertexBufferSuffix","indexBufferSuffix","chunk","common","part","minBufferedCount","hasBuffered","hasConstant","map","mapSemantic","info","accessor","byteLength","bufferName","streamName","streams","minCount","optionsPrimitives","op","pn","renderData","updateTypedArrays","bufferOptions","stream","destroyGL","partMap","chunkNames","partInfo","chunkInfo","techniqueName","techique","techiqueInfo","buffered","constant","bufferMap","streamNames","streamInfo","bufferInfo","primitiveStreamsInfo","array","Technique","globals","_fixSemantic","_fixVertexStreams","_fixGlobals","num","attribNames","requiredAttribs","attribName","semanticStr","indexStr","ch","charAt","substring","parseInt","len","dd","uniformValues","requiredUniforms","uniformName","vertexShader","fragmentShader","attributesMap","attributesIndices","semanticInfo","semanticName","attribs","globalsMap","ModelRenderer","_vertexAttributesCount","MAX_VERTEX_ATTRIBS","_textureUnitsCount","_internalFramebuffer","_reset","_technique","_model","_partName","_chunkName","_primMode","_framebuffer","_inBegin","_enabledArrays","_boundTextures","_attribValues","_primitiveStreams","_techniqueDirty","_modelDirty","_modelPartDirty","_modelChunkDirty","_primModeDirty","_framebufferDirty","_viewportDirty","_dirty","_resetContext","disableVertexAttribArray","_update","technique","techniqueRenderData","attribValues","attribInfo","attribData","vertexAttrib4fv","modelRenderData","techniqueInfo","enabledArrays","infos","primMode","end","begin","boundTextures","tex","isInBegin","setTechnique","setModel","setPart","_part","setChunk","_chunk","setPrimitiveMode","primitiveMode","setDefaultGlobals","uniformValue","setGlobals","g","setFramebuffer","fb","activateOffScreenFramebuffer","activateMainFramebuffer","setFramebufferAttachments","setColorRenderTarget","setDepthRenderTarget","setStencilRenderTarget","setDepthStencilRenderTarget","clearFramebuffer","clearColor","clearDepth","clearStencil","Stencil_BUFFER_BIT","setTexture","canRender","render","bufferedStreams","arrayStreams","drawArrays","renderModelPart","renderModel","UserInterface","CanvasHandler","handler","_canvas","_handler","_ignoreKeyRepeat","ignoreKeyRepeat","DEFAULT_IGNORE_KEY_REPEAT","_keysDown","_mouseButtonsDown","_dragging","_dragStartPos","_dragEndPos","_dragDeltaPos","_cursorPos","_cursorPrevPos","_cursorDeltaPos","_drawEventPending","_drawEventHandler","_onDraw","_postDrawEventFunction","_postDrawEvent","_animateTime","_animatePrevTime","_animateDeltaTime","_animateRate","_animateID","_animateEventHandler","_onAnimate","_animateMS","_animateWithTimeout","_fastAnimate","_fpsUpdateMS","_fpsTime","_fpsCount","_fps","_delegateDraw","handleMessage","_FAST_ANIMATE_MESSAGE_NAME","stopPropagation","_FAST_DRAW_MESSAGE_NAME","tabIndex","_onTerminate","_onKeyDown","_onKeyUp","_onKeyPress","_onMouseButtonDown","_onMouseButtonUp","_onMouseMove","_onMouseOut","_onClick","_onDoubleClick","_onResize","_onMouseWheel","_onBlur","_onWindowMouseButtonUp","_onWindowMouseMove","_touchHandler","pointerType","standardGLUnpack","DEFAULT_STANDARD_GL_UNPACK","animateRate","DEFAULT_ANIMATE_RATE","DEFAULT_PROPERTY_NAME","_multiTouch","tmp","touches","pan","btn","phase","event","diff","button","pointerId","navigator","userAgent","toLowerCase","changedTouches","simulatedEvent","createEvent","id","dist","clientX","clientY","timeStamp","initMouseEvent","screenX","screenY","dispatchEvent","preventDefault","_firstNotify","_onInitialize","postDrawEvent","method","_postDrawCount","requestAnimationFrame","_getMouseClientPos","getBoundingClientRect","left","outside","ks","keyCode","fromCharCode","wasDown","focus","isTrusted","sPos","ePos","delta","wheelDelta","opera","detail","setTimeout","postMessage","timestamp","postDrawCount","animateTime","animatePrevTime","animateDeltaTime","clearInterval","setInterval","framesPerSecond","isKeyDown","key","isMouseButtonDown","isDragging","dragging","dragStartX","dragStartY","dragEndX","dragEndY","dragDeltaX","dragDeltaY","cursorX","cursorY","cursorPrevX","cursorPrevY","cursorDeltaX","cursorDeltaY","draw","handleCanvas","ui","uiName","handleCanvasOnLoad","doHandle","onLoad","SGL_TRACKBALL_NO_ACTION","SGL_TRACKBALL_ROTATE","SGL_TRACKBALL_PAN","SGL_TRACKBALL_DOLLY","SGL_TRACKBALL_SCALE","HOP_ALL","Presenter","_isDebugging","_lightDirection","_supportsWebGL","sglHandleCanvas","_parseScene","background","_parseBackground","meshes","_parseMeshes","texturedQuads","_parseTexturedQuads","modelInstances","_parseModelInstances","spots","_parseSpots","trackball","_parseTrackball","space","_parseSpace","sglGetDefaultObject","isEnvironment","_parseMesh","transform","_parseTransform","_parseTexturedQuad","_parseModelInstance","mesh","useSolidColor","alpha","useTransparency","cursor","ID","visible","tags","_instancesProgressiveID","_parseSpot","_spotsProgressiveID","TurnTableTrackball","trackOptions","centerMode","radiusMode","whichInstanceCenter","whichInstanceRadius","explicitCenter","explicitRadius","cameraFOV","cameraNearFar","SglMat4","_createStandardPointNXSProgram","nxsVertexShader","SglVertexShader","console","nxsFragmentShader","SglFragmentShader","SglProgram","aPosition","aNormal","aColor","aPointSize","uWorldViewProjectionMatrix","uViewSpaceNormalMatrix","SglMat3","uViewSpaceLightDirection","uAlpha","uUseSolidColor","uSolidColor","_createStandardNXSProgram","_createXYZPointNXSProgram","_createXYZNXSProgram","_createColorCodedIDPointNXSProgram","uColorID","_createColorCodedIDNXSProgram","_createColorShadedPointNXSProgram","_createColorShadedNXSProgram","_createStandardPLYtechnique","SglTechnique","_createXYZPLYtechnique","_createColorCodedIDPLYtechnique","_createColorShadedPLYtechnique","_createSimpleLinetechnique","uLineColor","uPointA","uPointB","_isSceneReady","_scene","_sceneParsed","_objectsToLoad","_testReady","_onLoadedEvent","track","_objectLoaded","_onMeshReady","_onTextureReady","_onBackgroundReady","_pickingRefresh","_pickpoint","pickedPixel","_onEndMeasurement","_onPickedSpot","_onEnterSpot","_onLeaveSpot","_drawScenePickingSpots","_Color2ID","_lastSpotID","spt","_pickedSpot","_onHover","_lastPickedSpot","_isMeasuring","_lastCursor","style","_onPickedInstance","_onEnterInstance","_onLeaveInstance","_drawScenePickingInstances","_lastInstanceID","instances","inst","_pickedInstance","_lastPickedInstance","_measureRefresh","ppoint","_drawScenePickingXYZ","_measurementStage","_pointA","_pointB","measurement","SglVec3","_startMeasurement","_stopMeasurement","_setSceneCenterRadius","sceneCenter","sceneRadiusInv","instCenter","renderable","datasetCenter","SglVec4","smin","smax","imin","imax","radius","datasetRadius","vector111","scalefactor","scenter","_destroyPickFramebuffer","pickFramebuffer","pickColorTexture","pickDepthRenderbuffer","_createPickFramebuffer","SglTexture2D","SglRenderbuffer","DEPTH_COMPONENT16","SglFramebuffer","_setupDraw","xform","FOV","nearP","farP","sglDegToRad","_ID2Color","intID","IDr","IDg","IDb","colorID","_onPlyLoaded","thatmesh","plyData","modelDescriptor","importPly","SglModel","boundingBox","extra","TMR","_drawScene","renderer","CurrProgram","basicNXSProgram","CurrPointProgram","pointNXSProgram","CurrTechnique","basicPLYTechnique","CCProgram","colorShadedNXSProgram","CCPointProgram","colorShadedPointNXSProgram","CCTechnique","colorShadedPLYtechnique","lineTechnique","simpleLinetechnique","bkg","instance","DEPTH_TEST","isNexus","nexus","_targetFps","newBudget","_drawBudget","_minDrawBudget","_drawSize","_header","signature","hasIndex","disable","depthMask","BLEND","blendFunc","SRC_ALPHA","ONE","depthFunc","LESS","lineUniforms","simpleLineModel","GREATER","spot","colorCodedXYZNXSProgram","colorCodedXYZPointNXSProgram","colorCodedXYZPLYtechnique","pixel","ppointc","rr","gg","bb","aa","colorCodedIDNXSProgram","colorCodedIDPointNXSProgram","colorCodedIDPLYtechnique","_drawNull","_createLineModel","normal","onInitialize","SglTransformationStack","SglModelRenderer","dstartx","dstarty","dendx","dendy","ax1","ay1","_targetInstanceName","_targetHotSpotName","_animating","_movingLight","_clickable","onDrag","rotateLight","action","testMatrix","_matrix","onMouseMove","isAnimate","onMouseOut","onMouseButtonDown","onMouseButtonUp","onKeyPress","charCode","getState","Nexus","Debug","nodes","onMouseWheel","factor","onAnimate","dt","tick","onDraw","supportsWebGL","toggleDebugMode","setScene","scene","setup","Renderer","targetError","onSceneReady","onUpdate","sglRequestBinary","resetTrackball","getTrackballPosition","setTrackballPosition","newposition","setState","animateToTrackballPosition","animateToState","setInstanceSolidColorByName","newState","redraw","newColor","setInstanceSolidColor","tag","tg","toggleInstanceSolidColorByName","toggleInstanceSolidColor","setInstanceTransparencyByName","newAlpha","setInstanceTransparency","toggleInstanceTransparencyByName","toggleInstanceTransparency","setInstanceVisibilityByName","setInstanceVisibility","toggleInstanceVisibilityByName","toggleInstanceVisibility","isInstanceVisibilityEnabledByName","visibility","isInstanceVisibilityEnabled","setSpotVisibilityByName","setSpotVisibility","toggleSpotVisibilityByName","toggleSpotVisibility","isSpotVisibilityEnabledByName","isSpotVisibilityEnabled","zoomIn","zoomOut","enableLightTrackball","isLightTrackballEnabled","enableOnHover","isOnHoverEnabled","enableMeasurementTool","isMeasurementToolEnabled","parsePly","trim","blanks","extractHeader","u8","endHeaderToken","header","found","currC","prevC","pos","splitHeader","lines","split","trimmed","tokens","parseHeader","prop","token","tn","elements","elementMap","comments","others","binary","littleEndian","properties","propertyMap","setupLines","tabs","generateReadValue","assignExpr","types","newIdentifiers","nIde","vIde","iIde","concat","tabStr","generateReadProperty","generateReadElement","props","generateReadElements","elemIndex","generateReadMesh","elems","elementLines","ides","ide","sort","join","getMeshInfo","mainParsePly","emptyFunc","callbacks","onBegin","onHeader","onBeginContent","onBeginElements","onElement","onEndElements","onEndContent","onEnd","dataView","DataView","readMeshStr","readMeshFunc","eval","canonicType","canonicTypes","char","int8","uchar","uint8","short","int16","ushort","uint16","int","int32","uint","uint32","float","float32","double","float64","emptyFunction","propertiesTypes","PlyHandler","_buffer","_modelDescriptor","_verticesCount","_vertexAttributes","_vertexStride","_vertexBuffer","_handleVertex","_facesCount","_indexBuffer","_handleFace","_view","_boundingBox","mainImportPly","ptypes","verticesCount","vertexLines","vertexAttributes","vertexStride","facesCount","faceLines","_mesh","vertexFuncStr","faceFuncStr","elementInfo","_handleElement","element","control","modelVertexBuffers","modelIndexBuffers","modelVertexStreams","modelPrimitiveStreams","modelBindings","modelChunks","modelParts","maxVerticesCount","baseVertexBufferName","baseIndexBufferName","baseBindingName","baseChunkName","basePointStreamName","baseTriStreamName","basePartName","Float64Array","vertexBufferView","indexBufferView","chunksCount","chunkVertexBuffers","chunkVerticesCount","chunkIndexBuffers","chunkIndicesCount","facesLeft","currFaceIndex","indicesBuffer","verticesMap","verticesNew","indicesCount","k","chunkVertexBuffer","chunkVertexBufferView","chunkIndexBuffer","set","subarray","partChunks","vertexBufferName","indexBufferName","attr","vertexStreamName","pointStreamName","triStreamName","PanTiltTrackball","opt","startCenter","startPanX","startPanY","startAngleX","startAngleY","startDistance","minMaxDist","minMaxPanX","minMaxPanY","minMaxAngleX","minMaxAngleY","_action","_new_action","_center","_startPanX","_startPanY","_startAngleX","_startAngleY","_startDistance","_panX","_panY","_angleX","_angleY","_distance","_targetPanX","_targetPanY","_targetAngleX","_targetAngleY","_targetDistance","_isAnimating","_speedPanX","_speedPanY","_speedAngleX","_speedAngleY","_speedDistance","_minMaxDist","_minMaxPanX","_minMaxPanY","_minMaxAngleX","_minMaxAngleY","_start","low","high","_computeMatrix","sglRadToDeg","newstate","timePanX","timePanY","timeAngleX","timeAngleY","timeDistance","maxtime","deltaPanX","deltaPanY","deltaAngleX","deltaAngleY","deltaDistance","diffPanX","diffPanY","diffAngleX","diffAngleY","diffDistance","dx","dy","SphereTrackball","_sphereMatrix","_pts","_projectOnSphere","sglSqrt","_transform","_transformOnSphere","_translate","invMat","trMat","dolly","mInv","v1","rotMat","dz","startPhi","startTheta","minMaxPhi","minMaxTheta","_startPhi","_startTheta","_phi","_theta","_targetPhi","_targetTheta","_speedPhi","_speedTheta","_limitPhi","_minMaxPhi","_minMaxTheta","clampedangle","speedphi","timePhi","timeTheta","deltaPhi","deltaTheta","diffPhi","diffTheta","TurntablePanTrackball","startPanZ","minMaxPanZ","_startPanZ","_panZ","_minMaxPanZ","_targetPanZ","_speedPanZ","timePanZ","deltaPanZ","diffPanZ","Xvec","Yvec","Zvec","init3dhop","interval","ismousedown","$","mouseenter","css","mouseout","mousedown","actionsToolbar","mouseup","click","enterFullscreen","exitFullscreen","resizeCanvas","parent","set3dhlg","lightSwitch","presenter","measurementSwitch","html","hotspotSwitch","fullscreenSwitch","el","native_width","native_height","screen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","moveToolbar","l","moveMeasurebox","mouseover","animate","msFullscreenElement","mozFullScreen","webkitIsFullScreen"],"mappings":"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","file":"3dviewer.js","sourcesContent":["/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview Namespace\r\n */\r\n\r\n/**\r\n * The SpiderGL namespace.\r\n *\r\n * @namespace The SpiderGL namespace.\r\n */\r\nvar SpiderGL = { };\r\n\r\n/**\r\n * Utility tag for any use.\r\n *\r\n * @type any\r\n */\r\nSpiderGL.TAG = 0;\r\n\r\n/**\r\n * Publishes SpiderGL modules content to a global object.\r\n *\r\n * The effect is to pollute the global object with the SpiderGL symbols. At the same time, it allows a faster and less verbose code.\r\n *\r\n * @param {object} [options] Symbols publishing options.\r\n * @param {object} [options.globalObject=SpiderGL.openNamespace.DEFAULT_GLOBAL_OBJECT] The global object to which inject SpiderGL symbols.\r\n * @param {string} [options.constantPrefix=SpiderGL.openNamespace.DEFAULT_CONSTANT_PREFIX] String prefix for constants.\r\n * @param {string} [options.functionPrefix=SpiderGL.openNamespace.DEFAULT_FUNCTION_PREFIX] String prefix for functions. The first letter of the function identifier will be made capital.\r\n * @param {string} [options.classPrefix=SpiderGL.openNamespace.DEFAULT_CLASS_PREFIX] String prefix for classes and sub-modules.\r\n */\r\nSpiderGL.openNamespace = function (options) {\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\tglobalObject   : SpiderGL.openNamespace.DEFAULT_GLOBAL_OBJECT,\r\n\t\tconstantPrefix : SpiderGL.openNamespace.DEFAULT_CONSTANT_PREFIX,\r\n\t\tfunctionPrefix : SpiderGL.openNamespace.DEFAULT_FUNCTION_PREFIX,\r\n\t\tclassPrefix    : SpiderGL.openNamespace.DEFAULT_CLASS_PREFIX\r\n\t}, options);\r\n\r\n\tvar constantRegExp = new RegExp(\"^(([_\\$0-9A-Z])+)$\");\r\n\tfunction isConstant(name) {\r\n\t\treturn constantRegExp.test(name);\r\n\t}\r\n\r\n\tvar namespaceOrClassRegExp = new RegExp(\"^([A-Z])\");\r\n\tfunction isNamespaceOrClass(name) {\r\n\t\treturn (namespaceOrClassRegExp.test(name) && !isConstant(name));\r\n\t}\r\n\r\n\tvar functionRegExp = new RegExp(\"^(([a-z])+([_\\$0-9A-Za-z])*)$\");\r\n\tfunction isFunction(name) {\r\n\t\treturn functionRegExp.test(name);\r\n\t}\r\n\r\n\tfunction initialCap(name) {\r\n\t\treturn (name.substr(0, 1).toUpperCase() + name.substr(1));\r\n\t}\r\n\r\n\tvar classes    = { };\r\n\tvar functions  = { };\r\n\tvar constants  = { };\r\n\r\n\tfunction collect(module) {\r\n\t\tif (!module) return;\r\n\t\tfor (var x in module) {\r\n\t\t\tif (x.substr(0, 1) == \"_\") continue;\r\n\t\t\tvar y = module[x];\r\n\t\t\tif (isNamespaceOrClass(x)) {\r\n\t\t\t\t//if (classes[x]) log(\"Duplicate: \" + x);\r\n\t\t\t\tclasses[x] = y;\r\n\t\t\t}\r\n\t\t\telse if (isFunction(x)) {\r\n\t\t\t\t//if (functions[x]) log(\"Duplicate: \" + x);\r\n\t\t\t\tfunctions[x] = y;\r\n\t\t\t}\r\n\t\t\telse if (isConstant(x)) {\r\n\t\t\t\t//if (constants[x]) log(\"Duplicate: \" + x);\r\n\t\t\t\tconstants[x] = y;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t//log(\"Unknown : \" + x);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar modules = [\r\n\t\t\"Core\",\r\n\t\t\"DOM\",\r\n\t\t\"IO\",\r\n\t\t\"Math\",\r\n\t\t\"Mesh\",\r\n\t\t\"Model\",\r\n\t\t\"Semantic\",\r\n\t\t\"Space\",\r\n\t\t\"Type\",\r\n\t\t\"UserInterface\",\r\n\t\t\"Utility\",\r\n\t\t\"Version\",\r\n\t\t\"WebGL\"\r\n\t];\r\n\r\n\tfor (var x in modules) {\r\n\t\tcollect(SpiderGL[modules[x]]);\r\n\t}\r\n\r\n\tfor (var x in classes) {\r\n\t\tvar name = options.classPrefix + initialCap(x);\r\n\t\t//log(\"CLASS    : \" + name);\r\n\t\toptions.globalObject[name] = classes[x];\r\n\t}\r\n\r\n\tfor (var x in functions) {\r\n\t\tvar name = options.functionPrefix + initialCap(x);\r\n\t\t//log(\"FUNCTION : \" + name);\r\n\t\toptions.globalObject[name] = functions[x];\r\n\t}\r\n\r\n\tfor (var x in constants) {\r\n\t\tvar name = options.constantPrefix + initialCap(x);\r\n\t\t//log(\"CONSTANT : \" + name);\r\n\t\toptions.globalObject[name] = constants[x];\r\n\t}\r\n};\r\n\r\n/**\r\n * Default publishing global object.\r\n *\r\n * @type object\r\n *\r\n * @default window\r\n */\r\nSpiderGL.openNamespace.DEFAULT_GLOBAL_OBJECT = window;\r\n\r\n/**\r\n * Default publishing prefix for constant symbols.\r\n *\r\n * @type string\r\n *\r\n * @default \"SGL_\"\r\n */\r\nSpiderGL.openNamespace.DEFAULT_CONSTANT_PREFIX = \"SGL_\";\r\n\r\n/**\r\n * Default publishing prefix for function symbols.\r\n *\r\n * @type string\r\n *\r\n * @default \"sgl\"\r\n */\r\nSpiderGL.openNamespace.DEFAULT_FUNCTION_PREFIX = \"sgl\";\r\n\r\n/**\r\n * Default publishing prefix for classes and sub-modules symbols.\r\n *\r\n * @type string\r\n *\r\n * @default \"Sgl\"\r\n */\r\nSpiderGL.openNamespace.DEFAULT_CLASS_PREFIX = \"Sgl\";\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview Version\r\n */\r\n\r\n/**\r\n * The SpiderGL.Version namespace.\r\n *\r\n * @namespace The SpiderGL.Version namespace.\r\n */\r\nSpiderGL.Version = { };\r\n\r\n/**\r\n * Major version number.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Version.VERSION_MAJOR = 0;\r\n\r\n/**\r\n * Minor version number.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Version.VERSION_MINOR = 2;\r\n\r\n/**\r\n * Revision version number.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Version.VERSION_REVISION = 1;\r\n\r\n/**\r\n * Version string.\r\n *\r\n * The version string is: \"{@link SpiderGL.Version.VERSION_MAJOR}.{@link SpiderGL.Version.VERSION_MINOR}.{@link SpiderGL.Version.VERSION_REVISION}\"\r\n *\r\n * @constant\r\n * @type string\r\n */\r\nSpiderGL.Version.VERSION_STRING = SpiderGL.Version.VERSION_MAJOR + \".\" + SpiderGL.Version.VERSION_MINOR + \".\" + SpiderGL.Version.VERSION_REVISION;\r\n\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview Core\r\n */\r\n\r\n/**\r\n * The SpiderGL.Core namespace.\r\n *\r\n * @namespace The SpiderGL.Core namespace.\r\n */\r\nSpiderGL.Core = { };\r\n\r\n/**\r\n * Default token.\r\n *\r\n * This constant can be used to set a parameter to its default value.\r\n *\r\n * @constant\r\n * @type object\r\n *\r\n * @example\r\n * texture.setSampler({\r\n *   wrapS : gl.REPEAT,\r\n *   wrapT : SpiderGL.Core.DEFAULT // set to the default value gl.CLAMP_TO_EDGE\r\n * });\r\n */\r\nSpiderGL.Core.DEFAULT = { };\r\n\r\n/**\r\n * Don't care token.\r\n *\r\n * This constant can be used to avoid setting policy/behavior parameter.\r\n *\r\n * @constant\r\n * @type object\r\n *\r\n * @example\r\n * texture.setImage({\r\n *   data  : image,\r\n *   flipY : SpiderGL.Core.DONT_CARE // overrides the texture automatic flipY policy and keeps current gl setting\r\n * });\r\n */\r\nSpiderGL.Core.DONT_CARE = { };\r\n\r\n/**\r\n * Alias for \"\".\r\n *\r\n * @constant\r\n * @type string\r\n */\r\nSpiderGL.Core.EMPTY_STRING = \"\";\r\n\r\n/**\r\n * Alias for { }.\r\n *\r\n * @constant\r\n * @type object\r\n*/\r\nSpiderGL.Core.EMPTY_OBJECT = { };\r\n\r\n/**\r\n * Alias for [ ].\r\n *\r\n * @constant\r\n * @type array\r\n*/\r\nSpiderGL.Core.EMPTY_ARRAY = [ ];\r\n\r\n/**\r\n * Alias for function () { }.\r\n *\r\n * It can be used as a function parameter or event handler to avoid checking whether the provided function is not null or undefined.\r\n *\r\n * @constant\r\n * @type function\r\n *\r\n * @example\r\n * // avoid test for null/undefined when invoking an event handler\r\n * someObject.onSomeEvent = SpiderGL.Core.EMPTY_FUNCTION;\r\n */\r\nSpiderGL.Core.EMPTY_FUNCTION = function () { };\r\n\r\n/**\r\n * Generates a unique id.\r\n *\r\n * @returns {number} A unique id.\r\n */\r\nSpiderGL.Core.generateUID = function () {\r\n\tSpiderGL.Core.generateUID._lastUID++;\r\n\treturn SpiderGL.Core.generateUID._lastUID;\r\n}\r\n\r\nSpiderGL.Core.generateUID._lastUID = 0;\r\n\r\n/**\r\n * Creates a SpiderGL.Core.ObjectBase\r\n *\r\n * SpiderGL.Core.ObjectBase is the base class for all SpiderGL classes.\r\n *\r\n * @class The SpiderGL.Core.ObjectBase is the base class for all SpiderGL classes.\r\n */\r\nSpiderGL.Core.ObjectBase = function () {\r\n\tthis._uid = SpiderGL.Core.generateUID();\r\n};\r\n\r\nSpiderGL.Core.ObjectBase.prototype = {\r\n\t/**\r\n\t * The object unique identifier.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget uid() {\r\n\t\treturn this._uid;\r\n\t}\r\n};\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview Type\r\n */\r\n\r\n/**\r\n * The SpiderGL.Type namespace.\r\n *\r\n * @namespace The SpiderGL.Type namespace.\r\n */\r\nSpiderGL.Type = { };\r\n\r\n/**\r\n * Little-Endian flag.\r\n * It is true if the host system is little endian, false otherwise.\r\n *\r\n * @constant\r\n * @type bool\r\n *\r\n * @see SpiderGL.Type.BIG_ENDIAN\r\n */\r\nSpiderGL.Type.LITTLE_ENDIAN = (function(){\r\n\tvar a = new Uint8Array([0x12, 0x34]);\r\n\tvar b = new Uint16Array(a.buffer);\r\n\treturn (b[0] == 0x3412);\r\n})();\r\n\r\n/**\r\n * Big-Endian flag.\r\n * It is true if the host system is big endian, false otherwise.\r\n *\r\n * @constant\r\n * @type bool\r\n *\r\n * @see SpiderGL.Type.LITTLE_ENDIAN\r\n */\r\nSpiderGL.Type.BIG_ENDIAN = !SpiderGL.Type.BIG_ENDIAN;\r\n\r\n/**\r\n * Constant for undefined (void) type.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.NO_TYPE = 0;\r\n\r\n/**\r\n * Constant for 8-bit signed integer type.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.INT8 = 1;\r\n\r\n/**\r\n * Constant for 8-bit unsigned integer type.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.UINT8 = 2;\r\n\r\n/**\r\n * Constant for 16-bit signed integer type.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.INT16 = 3;\r\n\r\n/**\r\n * Constant for 16-bit unsigned integer type.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.UINT16 = 4;\r\n\r\n/**\r\n * Constant for 32-bit signed integer type.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.INT32 = 5;\r\n\r\n/**\r\n * Constant for 32-bit unsigned integer type.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.UINT32 = 6;\r\n\r\n/**\r\n * Constant for 32-bit floating point type.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.FLOAT32 = 7;\r\n\r\n/**\r\n * Alias for Int8Array.BYTES_PER_ELEMENT.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.SIZEOF_INT8 = Int8Array.BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Alias for Uint8Array.BYTES_PER_ELEMENT.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.SIZEOF_UINT8 = Uint8Array.BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Alias for Int16Array.BYTES_PER_ELEMENT.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.SIZEOF_INT16 = Int16Array.BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Alias for Uint16Array.BYTES_PER_ELEMENT.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.SIZEOF_UINT16 = Uint16Array.BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Alias for Int32Array.BYTES_PER_ELEMENT.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.SIZEOF_INT32 = Int32Array.BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Alias for Uint32Array.BYTES_PER_ELEMENT.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.SIZEOF_UINT32 = Uint32Array.BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Alias for Float32Array.BYTES_PER_ELEMENT.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\nSpiderGL.Type.SIZEOF_FLOAT32 = Float32Array.BYTES_PER_ELEMENT;\r\n\r\n/* *\r\n * Alias for Float64Array.BYTES_PER_ELEMENT.\r\n *\r\n * @constant\r\n * @type number\r\n */\r\n//var SpiderGL.Type.SIZEOF_FLOAT64 = Float64Array.BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Returns the size of the type expressed by the passed symbolic constant.\r\n *\r\n * @param {number} sglType A SpiderGL type symbolic constants, i.e. SpiderGL.Type.UINT8.\r\n * @return {number} The size in bytes of the type.\r\n */\r\nSpiderGL.Type.typeSize = (function(){\r\n\tvar typeMap = { };\r\n\ttypeMap[SpiderGL.Type.NO_TYPE] = 0;\r\n\ttypeMap[SpiderGL.Type.INT8   ] = SpiderGL.Type.SIZEOF_INT8;\r\n\ttypeMap[SpiderGL.Type.UINT8  ] = SpiderGL.Type.SIZEOF_UINT8;\r\n\ttypeMap[SpiderGL.Type.INT16  ] = SpiderGL.Type.SIZEOF_INT16;\r\n\ttypeMap[SpiderGL.Type.UINT16 ] = SpiderGL.Type.SIZEOF_UINT16;\r\n\ttypeMap[SpiderGL.Type.INT32  ] = SpiderGL.Type.SIZEOF_INT32;\r\n\ttypeMap[SpiderGL.Type.UINT32 ] = SpiderGL.Type.SIZEOF_UINT32;\r\n\ttypeMap[SpiderGL.Type.FLOAT32] = SpiderGL.Type.SIZEOF_FLOAT32;\r\n\treturn function (sglType) {\r\n\t\treturn typeMap[sglType];\r\n\t};\r\n})();\r\n\r\n/**\r\n * Maps a SpiderGL type symbolic constant to a WebGL type constant.\r\n * For example, calling this function with SpiderGL.Type.UINT8 as argument will return WebGLRenderingContext.prototype.UNSIGNED_BYTE.\r\n *\r\n * @param {number} sglType A SpiderGL type symbolic constants, i.e. SpiderGL.Type.UINT8.\r\n * @return {number} The corresponding WebGLRenderingContext type constant, i.e. WebGLRenderingContext.prototype.UNSIGNED_BYTE.\r\n */\r\nSpiderGL.Type.typeToGL = (function(){\r\n\tvar typeMap = { };\r\n\ttypeMap[SpiderGL.Type.NO_TYPE] = WebGLRenderingContext.prototype.NONE;\r\n\ttypeMap[SpiderGL.Type.INT8   ] = WebGLRenderingContext.prototype.BYTE;\r\n\ttypeMap[SpiderGL.Type.UINT8  ] = WebGLRenderingContext.prototype.UNSIGNED_BYTE;\r\n\ttypeMap[SpiderGL.Type.INT16  ] = WebGLRenderingContext.prototype.SHORT;\r\n\ttypeMap[SpiderGL.Type.UINT16 ] = WebGLRenderingContext.prototype.UNSIGNED_SHORT;\r\n\ttypeMap[SpiderGL.Type.INT32  ] = WebGLRenderingContext.prototype.INT;\r\n\ttypeMap[SpiderGL.Type.UINT32 ] = WebGLRenderingContext.prototype.UNSIGNED_INT;\r\n\ttypeMap[SpiderGL.Type.FLOAT32] = WebGLRenderingContext.prototype.FLOAT;\r\n\treturn function (sglType) {\r\n\t\treturn typeMap[sglType];\r\n\t};\r\n})();\r\n\r\n/**\r\n * Maps a WebGL type constant to a WebGL type constant.\r\n * For example, calling this function with WebGLRenderingContext.prototype.UNSIGNED_BYTE as argument will return SpiderGL.Type.UINT8.\r\n *\r\n * @param {number} glType A WebGL type symbolic constants, i.e. WebGLRenderingContext.prototype.UNSIGNED_BYTE.\r\n * @return {number} The corresponding SpiderGL type constant, i.e. SpiderGL.Type.UINT8.\r\n */\r\nSpiderGL.Type.typeFromGL = (function(){\r\n\tvar typeMap = { };\r\n\ttypeMap[WebGLRenderingContext.prototype.NONE          ] = SpiderGL.Type.NO_TYPE;\r\n\ttypeMap[WebGLRenderingContext.prototype.BYTE          ] = SpiderGL.Type.INT8;\r\n\ttypeMap[WebGLRenderingContext.prototype.UNSIGNED_BYTE ] = SpiderGL.Type.UINT8;\r\n\ttypeMap[WebGLRenderingContext.prototype.SHORT         ] = SpiderGL.Type.INT16;\r\n\ttypeMap[WebGLRenderingContext.prototype.UNSIGNED_SHORT] = SpiderGL.Type.UINT16;\r\n\ttypeMap[WebGLRenderingContext.prototype.INT           ] = SpiderGL.Type.INT32;\r\n\ttypeMap[WebGLRenderingContext.prototype.UNSIGNED_INT  ] = SpiderGL.Type.UINT32;\r\n\ttypeMap[WebGLRenderingContext.prototype.FLOAT         ] = SpiderGL.Type.FLOAT32;\r\n\treturn function (glType) {\r\n\t\treturn typeMap[glType];\r\n\t};\r\n})();\r\n\r\n/**\r\n * Returns the size of the type expressed by the passed WebGL type symbolic constant.\r\n *\r\n * @param {number} glType A WebGL type symbolic constants, i.e. WebGLRenderingContext.prototype.UNSIGNED_BYTE.\r\n * @return {number} The size in bytes of the type.\r\n */\r\nSpiderGL.Type.typeSizeFromGL = function (glType) {\r\n\tvar sglType = SpiderGL.Type.typeFromGL(glType);\r\n\treturn SpiderGL.Type.typeSize(sglType);\r\n};\r\n\r\n/**\r\n * Maps a SpiderGL type symbolic constant to a TypedArray constructor.\r\n * For example, calling this function with SpiderGL.Type.UINT8 as argument will return Uint8Array.\r\n *\r\n * @param {number} sglType A SpiderGL type symbolic constants, i.e. SpiderGL.Type.UINT8.\r\n * @return {function} The corresponding TypedArray constructor function, i.e. Uint8Array.\r\n */\r\nSpiderGL.Type.typeToTypedArrayConstructor = (function(){\r\n\tvar typeMap = { };\r\n\ttypeMap[SpiderGL.Type.NO_TYPE] = ArrayBuffer;\r\n\ttypeMap[SpiderGL.Type.INT8   ] = Int8Array;\r\n\ttypeMap[SpiderGL.Type.UINT8  ] = Uint8Array;\r\n\ttypeMap[SpiderGL.Type.INT16  ] = Int16Array;\r\n\ttypeMap[SpiderGL.Type.UINT16 ] = Uint16Array;\r\n\ttypeMap[SpiderGL.Type.INT32  ] = Int32Array;\r\n\ttypeMap[SpiderGL.Type.UINT32 ] = Uint32Array;\r\n\ttypeMap[SpiderGL.Type.FLOAT32] = Float32Array;\r\n\treturn function (sglType) {\r\n\t\treturn typeMap[sglType];\r\n\t};\r\n})();\r\n\r\nSpiderGL.Type.POINTS         = 0;\r\nSpiderGL.Type.LINES          = 1;\r\nSpiderGL.Type.LINE_LOOP      = 2;\r\nSpiderGL.Type.LINE_STRIP     = 3;\r\nSpiderGL.Type.TRIANGLES      = 4;\r\nSpiderGL.Type.TRIANGLE_FAN   = 5;\r\nSpiderGL.Type.TRIANGLE_STRIP = 6;\r\n\r\nSpiderGL.Type.primitiveToGL = (function(){\r\n\tvar enumMap = { };\r\n\tenumMap[SpiderGL.Type.POINTS        ] = WebGLRenderingContext.prototype.POINTS;\r\n\tenumMap[SpiderGL.Type.LINES         ] = WebGLRenderingContext.prototype.LINES;\r\n\tenumMap[SpiderGL.Type.LINE_LOOP     ] = WebGLRenderingContext.prototype.LINE_LOOP;\r\n\tenumMap[SpiderGL.Type.LINE_STRIP    ] = WebGLRenderingContext.prototype.LINE_STRIP;\r\n\tenumMap[SpiderGL.Type.TRIANGLES     ] = WebGLRenderingContext.prototype.TRIANGLES;\r\n\tenumMap[SpiderGL.Type.TRIANGLE_FAN  ] = WebGLRenderingContext.prototype.TRIANGLE_FAN;\r\n\tenumMap[SpiderGL.Type.TRIANGLE_STRIP] = WebGLRenderingContext.prototype.TRIANGLE_STRIP;\r\n\treturn function (sglEnum) {\r\n\t\treturn enumMap[sglEnum];\r\n\t};\r\n})();\r\n\r\n/**\r\n * Tests the instance.\r\n *\r\n * The arg is tested to belong to a ctor function constructor.\r\n *\r\n * @param {any} arg The object to check.\r\n * @param {constructor} ctor The class (i.e. the function constructor) that is tested for creating the object.\r\n * @return {bool} True if arg is an instance of ctor, false otherwise.\r\n */\r\nSpiderGL.Type.instanceOf = function (arg, ctor) {\r\n\treturn (arg instanceof ctor);\r\n}\r\n\r\n/**\r\n * Tests whether the argument is a number.\r\n *\r\n * @param {any} arg The object to check.\r\n * @return {bool} True if arg is a number, false otherwise.\r\n */\r\nSpiderGL.Type.isNumber = function (arg) {\r\n\treturn (typeof arg == \"number\");\r\n}\r\n\r\n/**\r\n * Tests whether the argument is a string.\r\n *\r\n * @param {any} arg The object to check.\r\n * @return {bool} True if arg is a string, false otherwise.\r\n */\r\nSpiderGL.Type.isString = function (arg) {\r\n\treturn (typeof arg == \"string\");\r\n}\r\n\r\n/**\r\n * Tests whether the argument is a function.\r\n *\r\n * @param {any} arg The object to check.\r\n * @return {bool} True if arg is a function, false otherwise.\r\n */\r\nSpiderGL.Type.isFunction = function (arg) {\r\n\treturn (typeof arg == \"function\");\r\n}\r\n\r\n/**\r\n * Tests whether the argument is an array.\r\n *\r\n * @param {any} arg The object to check.\r\n * @return {bool} True if arg is an array, false otherwise.\r\n */\r\nSpiderGL.Type.isArray = function (arg) {\r\n\treturn (arg && arg.constructor === Array);\r\n}\r\n\r\n/**\r\n * Tests whether the argument is a typed array.\r\n *\r\n * @param {any} arg The object to check.\r\n * @return {bool} True if arg is a typed array, false otherwise.\r\n */\r\nSpiderGL.Type.isTypedArray = function (arg) {\r\n\treturn (arg && (typeof arg.buffer != \"undefined\") && (arg.buffer instanceof ArrayBuffer));\r\n}\r\n\r\n/**\r\n * Implements inheritance.\r\n *\r\n * A class derivation is established between derived and base. The derived object can be successfully tested as being a base instance and inherits base properties and methods.\r\n * It is possible to override base properties and methods by redefining them.\r\n * This function must be called after assigning the derived prototype object.\r\n *\r\n * @param {constructor} derived The derived class.\r\n * @param {constructor} base The base class.\r\n *\r\n * @example\r\n * function Base(x, y) {\r\n *   this.x = x;\r\n *   this.y = y;\r\n * };\r\n *\r\n * Base.prototype = {\r\n *   alertX : function () { alert(\"Base X: \" + this.x); },\r\n *   alertY : function () { alert(\"Base Y: \" + this.y); }\r\n * };\r\n *\r\n * function Derived(x, y, z) {\r\n *   Base.call(this, x, y);\r\n *   this.z = z;\r\n * };\r\n *\r\n * Derived.prototype = {\r\n *   alertY : function () { alert(\"Derived Y: \" + this.y); },\r\n *   alertZ : function () { alert(\"Derived Z: \" + this.z); },\r\n * };\r\n *\r\n * SpiderGL.Type.extend(base, derived);\r\n *\r\n * var b = new Base(1, 2);\r\n * b.alertX(); // alerts \"Base X: 1\"\r\n * b.alertY(); // alerts \"Base Y: 2\"\r\n *\r\n * var d = new Base(3, 4, 5);\r\n * d.alertX(); // alerts \"Base X: 3\"     (base method is kept)\r\n * d.alertY(); // alerts \"Derived Y: 4\"  (base method is overridden)\r\n * d.alertZ(); // alerts \"Derived Y: 5\"  (new derived method is called)\r\n */\r\nSpiderGL.Type.extend = function(derived, base /*, installBaseInfo*/) {\r\n\tfunction inheritance() { }\r\n\tinheritance.prototype = base.prototype;\r\n\r\n\tvar dproto = derived.prototype;\r\n\tvar iproto = new inheritance();\r\n\tiproto.constructor = derived;\r\n\r\n\tvar getter = null;\r\n\tvar setter = null;\r\n\tfor (var p in dproto) {\r\n\t\tgetter = dproto.__lookupGetter__(p);\r\n\t\tif (getter) { iproto.__defineGetter__(p, getter); }\r\n\r\n\t\tsetter = dproto.__lookupSetter__(p);\r\n\t\tif (setter) { iproto.__defineSetter__(p, setter); }\r\n\r\n\t\tif (!getter && !setter) { iproto[p] = dproto[p]; }\r\n\t}\r\n\r\n\tderived.prototype = iproto;\r\n\r\n\t/*\r\n\tif (installBaseInfo) {\r\n\t\tderived.superConstructor = base;\r\n\t\tderived.superClass       = base.prototype;\r\n\t}\r\n\t*/\r\n}\r\n\r\nSpiderGL.Type.defineClassGetter = function(ctor, name, func) {\r\n\tctor.prototype.__defineGetter__(name, func);\r\n}\r\n\r\nSpiderGL.Type.defineClassSetter = function(ctor, name, func) {\r\n\tctor.prototype.__defineSetter__(name, func);\r\n}\r\n\r\nSpiderGL.Type.defineObjectGetter = function(obj, name, func) {\r\n\tobj.__defineGetter__(name, func);\r\n}\r\n\r\nSpiderGL.Type.defineObjectSetter = function(obj, name, func) {\r\n\tobj.__defineSetter__(name, func);\r\n}\r\n\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview Utility\r\n */\r\n\r\n/**\r\n * The SpiderGL.Utility namespace.\r\n *\r\n * @namespace The SpiderGL.Utility namespace.\r\n */\r\nSpiderGL.Utility = { };\r\n\r\n/**\r\n * Gets default value for varibles.\r\n *\r\n * This function is used to get default values for optional variables.\r\n * If arg is undefined or is {@link SpiderGL.Core.DEFAULT}, then defaultValue will be returned. Otherwise, arg will be returned.\r\n *\r\n * @returns {any} Returns arg if arg is not undefined and is not {@link SpiderGL.Core.DEFAULT}, otherwise returns defaultValue.\r\n *\r\n * @example\r\n * var DEFAULT_V = 1;\r\n *\r\n * var v = null;\r\n * v = SpiderGL.Utility.getDefaultValue(someVar, DEFAULT_V); // someVar is undefined, so v = DEFAULT_V\r\n *\r\n * var someVar = 2;\r\n * v = SpiderGL.Utility.getDefaultValue(someVar, DEFAULT_V); // someVar is defined, so v = someVar\r\n *\r\n * var someVar = SpiderGL.Core.DEFAULT;\r\n * v = SpiderGL.Utility.getDefaultValue(someVar, DEFAULT_V); // someVar is SpiderGL.Core.DEFAULT, so v = DEFAULT_V\r\n *\r\n * @example\r\n * var DEFAULT_Y = 1;\r\n * var DEFAULT_Z = 2;\r\n *\r\n * function setObject(obj, x, options) {\r\n *   options = options || { }; // create an empty object to avoid testing for null\r\n *   obj.x = x;\r\n *   obj.y = SpiderGL.Utility.getDefaultValue(options.y, DEFAULT_Y);\r\n *   obj.z = SpiderGL.Utility.getDefaultValue(options.z, DEFAULT_Z);\r\n * }\r\n *\r\n * var obj = {\r\n *   x : 0,\r\n *   y : 1,\r\n *   z : 2\r\n * };\r\n *\r\n * setObject(obj, 3);        // obj = { x:3, y:DEFAULT_Y, z:DEFAULT_Z }\r\n * setObject(obj, 4, {z:5}); // obj = { x:4, y:DEFAULT_Y, z:5         }\r\n */\r\nSpiderGL.Utility.getDefaultValue = function (arg, defaultValue) {\r\n\tif ((arg === undefined) || (arg === SpiderGL.Core.DEFAULT)) { return defaultValue; }\r\n\treturn arg;\r\n}\r\n\r\n/**\r\n * Gets default values for objects.\r\n *\r\n * @param {object} defaultObj The object containing the default values.\r\n * @param {object} obj The object from which values are extracted.\r\n *\r\n * @returns {object} The modified defaultObj.\r\n */\r\nSpiderGL.Utility.getDefaultObject = function (defaultObj, obj) {\r\n\tif (obj) {\r\n\t\tvar sDefault = SpiderGL.Core.DEFAULT;\r\n\t\t//var getter = null;\r\n\t\tfor (var p in obj) {\r\n\t\t\t/* getter = obj.__lookupGetter__(p);\r\n\t\t\tif (getter) {\r\n\t\t\t\tdefaultObj.__defineGetter__(p, getter);\r\n\t\t\t}\r\n\t\t\telse */ if (obj[p] != sDefault) {\r\n\t\t\t\tdefaultObj[p] = obj[p];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn defaultObj;\r\n};\r\n\r\n/**\r\n * Sets default values for the passed object.\r\n *\r\n * @param {object} defaultObj The object containing the default values.\r\n * @param {object} obj The object from which values are extracted.\r\n *\r\n * @returns {object} The modified obj. If obj is null, defaultObj will be returned.\r\n */\r\nSpiderGL.Utility.setDefaultValues = function (defaultObj, obj) {\r\n\tif (!obj) return defaultObj;\r\n\r\n\tvar sDefault = SpiderGL.Core.DEFAULT;\r\n\tfor (var p in obj) {\r\n\t\tif (obj[p] == sDefault) {\r\n\t\t\tif (typeof defaultObj[p] != \"undefined\") {\r\n\t\t\t\tobj[p] = defaultObj[p];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfor (var p in defaultObj) {\r\n\t\tif (typeof obj[p] == \"undefined\") {\r\n\t\t\tobj[p] = defaultObj[p];\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n\r\n/**\r\n * Converts the input arguments to a 4-component Float32Array.\r\n * The input value is handled like WebGL handles constant vertex attributes,\r\n * that is, if the input parameter is null, a number, or an array with less than four components,\r\n * missing values are taken from the array [0, 0, 0, 1] at the respective position.\r\n *\r\n * @param {null|undefined|number|array|Float32Array} x The input value.\r\n *\r\n * @returns {array} a 4-component array.\r\n *\r\n * @example\r\n * x = SpiderGL.Utility.getAttrib4fv();                        // x = [0, 0, 0, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv(null);                    // x = [0, 0, 0, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv(undefined);               // x = [0, 0, 0, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv(0);                       // x = [0, 0, 0, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv(7);                       // x = [7, 0, 0, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv([]);                      // x = [0, 0, 0, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv([1]);                     // x = [1, 0, 0, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv([1, 2]);                  // x = [1, 2, 0, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv([1, 2, 3]);               // x = [1, 2, 3, 1]\r\n * x = SpiderGL.Utility.getAttrib4fv([1, 2, 3, 4, 5, 6]);      // x = [1, 2, 3, 4]\r\n * x = SpiderGL.Utility.getAttrib4fv(new Float32Array([0,9]);  // x = [0, 9, 0, 1]\r\n */\r\nSpiderGL.Utility.getAttrib4fv = function (x) {\r\n\tif (SpiderGL.Type.isNumber(x)) return [x, 0, 0, 1];\r\n\tif (!x) return [0, 0, 0, 1];\r\n\treturn [\r\n\t\t(x[0] != undefined) ? x[0] : 0,\r\n\t\t(x[1] != undefined) ? x[1] : 0,\r\n\t\t(x[2] != undefined) ? x[2] : 0,\r\n\t\t(x[3] != undefined) ? x[3] : 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Gets the number of milliseconds elapsed since January 1, 1970 at 00:00.\r\n * It is a utility function for (new Date()).getTime().\r\n *\r\n * @returns {number} The number of milliseconds elapsed since January 1, 1970 at 00:00.\r\n */\r\nSpiderGL.Utility.getTime = function () {\r\n\treturn (new Date()).getTime();\r\n};\r\n\r\nSpiderGL.Utility.Timer = function () {\r\n\tthis._tStart   = -1;\r\n\tthis._tElapsed = 0;\r\n}\r\n\r\nSpiderGL.Utility.Timer.prototype = {\r\n\t_accumElapsed : function () {\r\n\t\tthis._tElapsed += this.now - this._tStart;\r\n\t},\r\n\r\n\tget now() {\r\n\t\treturn Date.now();\r\n\t},\r\n\r\n\tstart : function () {\r\n\t\tif (this.isStarted) return;\r\n\t\tif (this.isPaused)  return;\r\n\t\tthis._tStart   = this.now;\r\n\t\tthis._tElapsed = 0;\r\n\t},\r\n\r\n\trestart : function () {\r\n\t\tvar r = this.elapsed;\r\n\t\tthis._tStart   = this.now;\r\n\t\tthis._tElapsed = 0;\r\n\t\treturn r;\r\n\t},\r\n\r\n\tstop : function () {\r\n\t\tif (!this.isStarted) return;\r\n\t\tif (this.isPaused)   return;\r\n\t\tthis._accumElapsed();\r\n\t\tthis._tStart = -1;\r\n\t},\r\n\r\n\tget isStarted() {\r\n\t\treturn (this._tStart >= 0);\r\n\t},\r\n\r\n\tpause : function () {\r\n\t\tif (!this.isStarted) return;\r\n\t\tif (this.isPaused)   return;\r\n\t\tthis._accumElapsed();\r\n\t\tthis._tStart = -2;\r\n\t},\r\n\r\n\tresume : function () {\r\n\t\tif (!this.isStarted) return;\r\n\t\tif (!this.isPaused)  return;\r\n\t\tthis._tStart = this.now;\r\n\t},\r\n\r\n\tget isPaused() {\r\n\t\treturn (this._tStart == -2);\r\n\t},\r\n\r\n\tget elapsed() {\r\n\t\treturn ((this.isStarted) ? (this._tElapsed + (this.now - this._tStart)) : (this._tElapsed))\r\n\t}\r\n};\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview DOM\r\n */\r\n\r\n/**\r\n * The SpiderGL.DOM namespace.\r\n *\r\n * @namespace The SpiderGL.DOM namespace.\r\n */\r\nSpiderGL.DOM = { };\r\n\r\n/**\r\n * Gets a document element object by id.\r\n *\r\n * The returned element object is retrieved by a direct call to document.getElementById(id).\r\n *\r\n * @param {string} id The element id.\r\n * @return {Element} The document element.\r\n */\r\nSpiderGL.DOM.getElementById = function (elementId) {\r\n\treturn document.getElementById(elementId);\r\n}\r\n\r\n/**\r\n * Gets the text of a document element.\r\n *\r\n * The returned text is retrieved by concatenating the text content of internal element nodes.\r\n *\r\n * @param {string} id The element id.\r\n * @return {string} The text contained in the document element.\r\n */\r\nSpiderGL.DOM.getElementText = function (elementId) {\r\n\tvar elem = document.getElementById(elementId);\r\n\tif (!elem) return null;\r\n\r\n\tvar str = \"\";\r\n\telem = elem.firstChild;\r\n\twhile (elem) {\r\n\t\tif (elem.nodeType == 3) {\r\n\t\t\tstr += elem.textContent;\r\n\t\t}\r\n\t\telem = elem.nextSibling;\r\n\t}\r\n\r\n\treturn str;\r\n}\r\n\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview IO\r\n */\r\n\r\n/**\r\n * The SpiderGL.IO namespace.\r\n *\r\n * @namespace The SpiderGL.IO namespace.\r\n */\r\nSpiderGL.IO = { };\r\n\r\n/**\r\n * Creates a SpiderGL.IO.Request.\r\n *\r\n * SpiderGL.IO.Request is the base class for I/O requests.\r\n *\r\n * @class The SpiderGL.IO.Request is the base class for I/O requests.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n */\r\nSpiderGL.IO.Request = function (url, options) {\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\tasync      : SpiderGL.IO.Request.DEFAULT_ASYNC,\r\n\t\tsend       : SpiderGL.IO.Request.DEFAULT_SEND,\r\n\t\tonProgress : null,\r\n\t\tonCancel   : null,\r\n\t\tonError    : null,\r\n\t\tonSuccess  : null,\r\n\t\tonFinish   : null\r\n\t}, options);\r\n\r\n\tthis._url     = url;\r\n\tthis._async   = options.async;\r\n\tthis._status  = SpiderGL.IO.Request.NONE;\r\n\tthis._sent    = false;\r\n\tthis._aborted = false;\r\n\tthis._data    = null;\r\n\tthis._loaded  = 0;\r\n\tthis._total   = 0;\r\n\r\n\tthis._events = {\r\n\t\tprogress : { main : null, listeners : [ ] },\r\n\t\tcancel   : { main : null, listeners : [ ] },\r\n\t\terror    : { main : null, listeners : [ ] },\r\n\t\tsuccess  : { main : null, listeners : [ ] },\r\n\t\tfinish   : { main : null, listeners : [ ] }\r\n\t};\r\n\r\n\tthis.onProgress = options.onProgress;\r\n\tthis.onCancel   = options.onCancel;\r\n\tthis.onError    = options.onError;\r\n\tthis.onSuccess  = options.onSuccess;\r\n\tthis.onFinish   = options.onFinish;\r\n};\r\n\r\nSpiderGL.IO.Request.NONE      = 0;\r\nSpiderGL.IO.Request.ONGOING   = 1;\r\nSpiderGL.IO.Request.CANCELLED = 2;\r\nSpiderGL.IO.Request.FAILED    = 3;\r\nSpiderGL.IO.Request.SUCCEEDED = 4;\r\n\r\nSpiderGL.IO.Request.DEFAULT_ASYNC = true;\r\nSpiderGL.IO.Request.DEFAULT_SEND  = true;\r\n\r\nSpiderGL.IO.Request.prototype = {\r\n\t_indexOf : function (handlers, h) {\r\n\t\tfor (var i=0, n=handlers.length; i<n; ++i) {\r\n\t\t\tif (handlers[i] == h) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\r\n\t_setMainListener : function (eventName, eventHandler) {\r\n\t\tvar evt = this._events[eventName];\r\n\t\tif (!evt) return;\r\n\t\tif (evt.main == eventHandler) return;\r\n\t\tif (eventHandler) { this.addEventListener(eventName, eventHandler); }\r\n\t\telse { this.removeEventListener(eventName, eventHandler); }\r\n\t\tevt.main = eventHandler;\r\n\t},\r\n\r\n\t_dispatch : function () {\r\n\t\tvar name = arguments[0];\r\n\t\tvar evt  = this._events[name];\r\n\t\tif (!evt) return;\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\t\targs.push(this);\r\n\t\tvar lst  = evt.listeners;\r\n\t\tfor (var i=0, n=lst.length; i<n; ++i) {\r\n\t\t\tlst[i].apply(null, args);\r\n\t\t}\r\n\t},\r\n\r\n\t_doPostProgress : function () {\r\n\t},\r\n\r\n\t_doPostCancel : function () {\r\n\t},\r\n\r\n\t_doPostError : function () {\r\n\t},\r\n\r\n\t_doPostSuccess : function () {\r\n\t},\r\n\r\n\t_doPostFinish : function () {\r\n\t},\r\n\r\n\t_doOnProgress : function (loaded, total) {\r\n\t\tif (this._aborted) return;\r\n\t\tthis._loaded = loaded;\r\n\t\tthis._total  = total;\r\n\t\tthis._doPostProgress();\r\n\t\tthis._dispatch(\"progress\", this._loaded, this._total);\r\n\t},\r\n\r\n\t_doOnCancel : function () {\r\n\t\tif (this._aborted) return;\r\n\t\tthis._status = SpiderGL.IO.Request.CANCELLED;\r\n\t\tthis._finishTime = SpiderGL.Utility.getTime();\r\n\t\tthis._doPostCancel();\r\n\t\tthis._dispatch(\"cancel\");\r\n\t},\r\n\r\n\t_doOnError : function () {\r\n\t\tif (this._aborted) return;\r\n\t\tthis._status = SpiderGL.IO.Request.FAILED;\r\n\t\tthis._finishTime = SpiderGL.Utility.getTime();\r\n\t\tthis._doPostError();\r\n\t\tthis._dispatch(\"error\");\r\n\t},\r\n\r\n\t_doOnSuccess : function () {\r\n\t\tif (this._aborted) return;\r\n\t\tthis._status = SpiderGL.IO.Request.SUCCEEDED;\r\n\t\tthis._finishTime = SpiderGL.Utility.getTime();\r\n\t\tthis._doPostSuccess();\r\n\t\tthis._dispatch(\"success\");\r\n\t},\r\n\r\n\t_doOnFinish : function () {\r\n\t\tthis._doPostFinish();\r\n\t\tthis._dispatch(\"finish\");\r\n\t},\r\n\r\n\t_doSend : function () {\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_doCancel : function () {\r\n\t\treturn false;\r\n\t},\r\n\r\n\tget canSend() {\r\n\t\treturn (this._url && !this._sent);\r\n\t},\r\n\r\n\tget url() {\r\n\t\treturn this._url;\r\n\t},\r\n\r\n\tset url(s) {\r\n\t\tthis.cancel();\r\n\t\tthis._url = s;\r\n\t},\r\n\r\n\tget status() {\r\n\t\treturn this._status;\r\n\t},\r\n\r\n\tget data() {\r\n\t\treturn this._data;\r\n\t},\r\n\r\n\tget bytesLoaded() {\r\n\t\treturn this._loaded;\r\n\t},\r\n\r\n\tget bytesTotal() {\r\n\t\treturn this._total;\r\n\t},\r\n\r\n\tget sent() {\r\n\t\treturn this._sent;\r\n\t},\r\n\r\n\tget ongoing() {\r\n\t\treturn (this._status == SpiderGL.IO.Request.ONGOING);\r\n\t},\r\n\r\n\tget cancelled() {\r\n\t\treturn (this._status == SpiderGL.IO.Request.CANCELLED);\r\n\t},\r\n\r\n\tget failed() {\r\n\t\treturn (this._status == SpiderGL.IO.Request.FAILED);\r\n\t},\r\n\r\n\tget succeeded() {\r\n\t\treturn (this._status == SpiderGL.IO.Request.SUCCEEDED);\r\n\t},\r\n\r\n\tget finished() {\r\n\t\treturn (this.succeeded || this.failed || this.cancelled);\r\n\t},\r\n\r\n\tget startTime() {\r\n\t\treturn this._startTime;\r\n\t},\r\n\r\n\tget finishTime() {\r\n\t\treturn this._finishTime;\r\n\t},\r\n\r\n\tget elapsedTime() {\r\n\t\tif (this._startTime < 0) return 0;\r\n\t\tif (this._finishTime < 0) return (SpiderGL.Utility.getTime() - this._startTime);\r\n\t\treturn (this._finishTime - this._startTime);\r\n\t},\r\n\r\n\taddEventListener : function (eventName, eventHandler) {\r\n\t\tif (!eventHandler) return;\r\n\t\tvar evt = this._events[eventName];\r\n\t\tif (!evt) return;\r\n\t\tvar idx = this._indexOf(evt.listeners, eventHandler);\r\n\t\tif (idx >= 0) return;\r\n\t\tevt.listeners.push(eventHandler);\r\n\t},\r\n\r\n\tremoveEventListener : function (eventName, eventHandler) {\r\n\t\tvar evt = this._events[eventName];\r\n\t\tif (!evt) return;\r\n\t\tvar idx = this._indexOf(evt.listeners, eventHandler);\r\n\t\tif (idx < 0) return;\r\n\t\tevt.listeners.splice(idx, 1);\r\n\t},\r\n\r\n\tget onProgress() {\r\n\t\treturn this._events.progress.main;\r\n\t},\r\n\r\n\tset onProgress(f) {\r\n\t\tthis._setMainListener(\"progress\", f);\r\n\t},\r\n\r\n\tget onCancel() {\r\n\t\treturn this._events.cancel.main;\r\n\t},\r\n\r\n\tset onCancel(f) {\r\n\t\tthis._setMainListener(\"cancel\", f);\r\n\t},\r\n\r\n\tget onError() {\r\n\t\treturn this._events.error.main;\r\n\t},\r\n\r\n\tset onError(f) {\r\n\t\tthis._setMainListener(\"error\", f);\r\n\t},\r\n\r\n\tget onSuccess() {\r\n\t\treturn this._events.success.main;\r\n\t},\r\n\r\n\tset onSuccess(f) {\r\n\t\tthis._setMainListener(\"success\", f);\r\n\t},\r\n\r\n\tget onFinish() {\r\n\t\treturn this._events.finish.main;\r\n\t},\r\n\r\n\tset onFinish(f) {\r\n\t\tthis._setMainListener(\"finish\", f);\r\n\t},\r\n\r\n\tcancel : function () {\r\n\t\tif (!this.ongoing) { return false; }\r\n\t\tthis._status  = SpiderGL.IO.Request.CANCELLED;\r\n\t\tthis._aborted = true;\r\n\t\tvar r = this._doCancel();\r\n\t\tthis._finishTime = SpiderGL.Utility.getTime();\r\n\t\treturn r;\r\n\t},\r\n\r\n\tsend : function () {\r\n\t\tif (!this.canSend) { return false; }\r\n\t\tthis._data       = null;\r\n\t\tthis._status     = SpiderGL.IO.Request.ONGOING;\r\n\t\tthis._aborted    = false;\r\n\t\tthis._sent       = true;\r\n\t\tthis._finishTime = -1;\r\n\t\tthis._startTime  = SpiderGL.Utility.getTime();\r\n\t\tvar r = this._doSend();\r\n\t\tif (!r) {\r\n\t\t\tthis._startTime = -1;\r\n\t\t\tthis._status = SpiderGL.IO.Request.NONE;\r\n\t\t\tthis._sent = false;\r\n\t\t};\r\n\t\treturn r;\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.IO.Request, SpiderGL.Core.ObjectBase);\r\n\r\n/**\r\n * Creates a SpiderGL.IO.XHRRequestBase.\r\n *\r\n * SpiderGL.IO.XHRRequestBase is the base class for I/O requests.\r\n *\r\n * @class The SpiderGL.IO.XHRRequestBase is the base class for I/O requests.\r\n *\r\n * @augments SpiderGL.IO.Request\r\n */\r\nSpiderGL.IO.XHRRequestBase = function (url, options) {\r\n\toptions = options || { };\r\n\tSpiderGL.IO.Request.call(this, url, options);\r\n\r\n\tvar that = this;\r\n\r\n\tvar xhr = new XMLHttpRequest();\r\n\tthis._xhr = xhr;\r\n\r\n\txhr.onprogress = function (evt) { that._xhrOnProgress(evt); };\r\n\txhr.onabort    = function ()    { that._doOnCancel(); that._doOnFinish(); };\r\n\txhr.onerror    = function ()    { that._doOnError();  that._doOnFinish(); };\r\n\txhr.onload     = function ()    {\r\n\t\tvar status = xhr.status;\r\n\t\tif ((status === 0) || (status === 200) || (!!that._range && (status == 206))) {\r\n\t\t\tthat._doOnSuccess();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthat._doOnError();\r\n\t\t}\r\n\t\tthat._doOnFinish();\r\n\t};\r\n\r\n\tthis._range = null;\r\n\r\n\tthis._xhr.open(\"GET\", this._url, this._async);\r\n\r\n\tif (\"range\" in options) {\r\n\t\tthis._range = [ options.range[0], options.range[1] ];\r\n\t\tvar rangeStr = \"bytes=\" + options.range[0] + \"-\" + options.range[1];\r\n\t\txhr.setRequestHeader(\"Range\", rangeStr);\r\n\t}\r\n\r\n\tthis._prepareXHR();\r\n\r\n\tvar send = SpiderGL.Utility.getDefaultValue(options.send, SpiderGL.IO.Request.DEFAULT_SEND);\r\n\tif (send) {\r\n\t\tthis.send();\r\n\t}\r\n};\r\n\r\nSpiderGL.IO.XHRRequestBase.prototype = {\r\n\t_prepareXHR : function () {\r\n\t},\r\n\r\n\t_doCancel : function () {\r\n\t\tthis._xhr.abort();\r\n\t\tthis._xhr = new XMLHttpRequest();\r\n\t\tthis._xhr.open(\"GET\", this._url, this._async);\r\n\t\tthis._prepareXHR();\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_doSend : function () {\r\n\t\tthis._xhr.send();\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_xhrOnProgress : function (evt) {\r\n\t\tvar loaded = 0;\r\n\t\tvar total  = 0;\r\n\t\tif (evt && evt.lengthComputable) {\r\n\t\t\tloaded = evt.loaded;\r\n\t\t\ttotal  = evt.total;\r\n\t\t}\r\n\t\tthis._doOnProgress(loaded, total);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.IO.XHRRequestBase, SpiderGL.IO.Request);\r\n\r\n/**\r\n * Creates a SpiderGL.IO.XHRRequest.\r\n *\r\n * SpiderGL.IO.XHRRequest is the base class for I/O requests.\r\n *\r\n * @class The SpiderGL.IO.XHRRequest is the base class for I/O requests.\r\n *\r\n * @augments SpiderGL.IO.XHRRequestBase\r\n */\r\nSpiderGL.IO.XHRRequest = function (url, options) {\r\n\tSpiderGL.IO.XHRRequestBase.call(this, url, options);\r\n};\r\n\r\nSpiderGL.IO.XHRRequest.prototype = {\r\n\t_doPostSuccess : function () {\r\n\t\tthis._data = this._xhr.responseText;\r\n\t},\r\n\r\n\tget xhr() {\r\n\t\treturn this._xhr;\r\n\t},\r\n\r\n\tget response() {\r\n\t\treturn this.data;\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.IO.XHRRequest, SpiderGL.IO.XHRRequestBase);\r\n\r\n/**\r\n * Creates a SpiderGL.IO.TextRequest.\r\n *\r\n * SpiderGL.IO.TextRequest is the base class for I/O requests.\r\n *\r\n * @class The SpiderGL.IO.TextRequest is the base class for I/O requests.\r\n *\r\n * @augments SpiderGL.IO.XHRRequestBase\r\n */\r\nSpiderGL.IO.TextRequest = function (url, options) {\r\n\tSpiderGL.IO.XHRRequestBase.call(this, url, options);\r\n};\r\n\r\nSpiderGL.IO.TextRequest.prototype = {\r\n\t_doPostSuccess : function () {\r\n\t\tthis._data = this._xhr.responseText;\r\n\t},\r\n\r\n\tget text() {\r\n\t\treturn this.data;\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.IO.TextRequest, SpiderGL.IO.XHRRequestBase);\r\n\r\n/**\r\n * Synchronous text read.\r\n * This function is equivalent to issuing a SpiderGL.IO.TextRequest with the async flag set to false and no callbacks, and then reading its text property.\r\n *\r\n * @param {string} url The URL of the content\r\n *\r\n * @returns {string} The text content, or null on failure.\r\n */\r\nSpiderGL.IO.readText = function (url) {\r\n\tvar r = new SpiderGL.IO.TextRequest(url, {async:false});\r\n\treturn r.text;\r\n};\r\n\r\n/**\r\n * Asynchronous text read.\r\n * This function creates a SpiderGL.IO.TextRequest with the async and seng flags set to true, overriding their values in the options parameter.\r\n *\r\n * @param {string} url The URL of the content\r\n * @param {object} options The request options.\r\n *\r\n * @returns {SpiderGL.IO.TextRequest} The internally generated SpiderGL.IO.TextRequest.\r\n */\r\nSpiderGL.IO.requestText = function (url, options) {\r\n\toptions = SpiderGL.Utility.getDefaultObject({ }, options);\r\n\toptions.async = true;\r\n\toptions.send  = true;\r\n\tvar r = new SpiderGL.IO.TextRequest(url, options);\r\n\treturn r;\r\n};\r\n\r\n/**\r\n * Creates a SpiderGL.IO.JSONRequest.\r\n *\r\n * SpiderGL.IO.JSONRequest is the base class for I/O requests.\r\n *\r\n * @class The SpiderGL.IO.JSONRequest is the base class for I/O requests.\r\n *\r\n * @augments SpiderGL.IO.XHRRequestBase\r\n */\r\nSpiderGL.IO.JSONRequest = function (url, options) {\r\n\tSpiderGL.IO.XHRRequestBase.call(this, url, options);\r\n};\r\n\r\nSpiderGL.IO.JSONRequest.prototype = {\r\n\t_doPostSuccess : function () {\r\n\t\tthis._data = JSON.parse(this._xhr.responseText);\r\n\t},\r\n\r\n\tget text() {\r\n\t\treturn this._xhr.responseText;\r\n\t},\r\n\r\n\tget json() {\r\n\t\treturn this.data;\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.IO.JSONRequest, SpiderGL.IO.XHRRequestBase);\r\n\r\n/**\r\n * Synchronous JSON object read.\r\n * This function is equivalent to issuing a SpiderGL.IO.JSONRequest with the async flag set to false and no callbacks, and then reading its json property.\r\n *\r\n * @param {string} url The URL of the content\r\n *\r\n * @returns {object} The JSON-parsed object, or null on failure.\r\n */\r\nSpiderGL.IO.readJSON = function (url) {\r\n\tvar r = new SpiderGL.IO.JSONRequest(url, {async:false});\r\n\treturn r.json;\r\n};\r\n\r\n/**\r\n * Asynchronous JSON read.\r\n * This function creates a SpiderGL.IO.JSONRequest with the async and seng flags set to true, overriding their values in the options parameter.\r\n *\r\n * @param {string} url The URL of the content\r\n * @param {object} options The request options.\r\n *\r\n * @returns {SpiderGL.IO.JSONRequest} The internally generated SpiderGL.IO.JSONRequest.\r\n */\r\nSpiderGL.IO.requestJSON = function (url, options) {\r\n\toptions = SpiderGL.Utility.getDefaultObject({ }, options);\r\n\toptions.async = true;\r\n\toptions.send  = true;\r\n\tvar r = new SpiderGL.IO.JSONRequest(url, options);\r\n\treturn r;\r\n};\r\n\r\n/**\r\n * Creates a SpiderGL.IO.BinaryRequest.\r\n *\r\n * SpiderGL.IO.BinaryRequest is the base class for I/O requests.\r\n *\r\n * @class The SpiderGL.IO.BinaryRequest is the base class for I/O requests.\r\n *\r\n * @augments SpiderGL.IO.XHRRequestBase\r\n */\r\nSpiderGL.IO.BinaryRequest = function (url, options) {\r\n\tSpiderGL.IO.XHRRequestBase.call(this, url, options);\r\n};\r\n\r\nSpiderGL.IO.BinaryRequest.prototype = {\r\n\t_prepareXHR : function () {\r\n\t\tvar xhr = this._xhr;\r\n\t\tvar overrideMime = false;\r\n\r\n\t\t/*\r\n\t\tif (xhr.hasOwnProperty(\"responseType\")) {\r\n\t\t\ttry {\r\n\t\t\t\txhr.responseType = \"arraybuffer\";\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\toverrideMime = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t\toverrideMime = true;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\tif (overrideMime) {\r\n\t\t\txhr.overrideMimeType(\"text/plain; charset=x-user-defined\");\r\n\t\t}\r\n\r\n\t\txhr.responseType = \"arraybuffer\";\r\n\t},\r\n\r\n\t_setArrayBuffer : function () {\r\n\t\tvar xhr = this._xhr;\r\n\r\n\t\tif (xhr.responseType == \"arraybuffer\") {\r\n\t\t\tthis._data = xhr.response;\r\n\t\t}\r\n\t\telse if (xhr.mozResponseArrayBuffer != null) {\r\n\t\t\tthis._data = xhr.mozResponseArrayBuffer;\r\n\t\t}\r\n\t\telse if (xhr.responseText != null) {\r\n\t\t\tvar data = new String(xhr.responseText);\r\n\t\t\tvar arr  = new Array(data.length);\r\n\t\t\tfor (var i=0, n=data.length; i<n; ++i) {\r\n\t\t\t\tarr[i] = data.charCodeAt(i) & 0xff;\r\n\t\t\t}\r\n\t\t\tthis._data = (new Uint8Array(arr)).buffer;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._data = null;\r\n\t\t}\r\n\t},\r\n\r\n\t_doPostSuccess : function () {\r\n\t\tthis._setArrayBuffer();\r\n\t},\r\n\r\n\tget data() {\r\n\t\tif (this.ongoing) {\r\n\t\t\tthis._setArrayBuffer();\r\n\t\t}\r\n\t\treturn this._data;\r\n\t},\r\n\r\n\tget buffer() {\r\n\t\treturn this.data;\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.IO.BinaryRequest, SpiderGL.IO.XHRRequestBase);\r\n\r\n/**\r\n * Synchronous binary data read.\r\n * This function is equivalent to issuing a SpiderGL.IO.BinaryRequest with the async flag set to false and no callbacks, and then reading its buffer property.\r\n *\r\n * @param {string} url The URL of the content\r\n *\r\n * @returns {ArrayBuffer} The content binary data, or null on failure.\r\n */\r\nSpiderGL.IO.readBinary = function (url) {\r\n\tvar r = new SpiderGL.IO.BinaryRequest(url, {async:false});\r\n\treturn r.buffer;\r\n};\r\n\r\n/**\r\n * Asynchronous binary read.\r\n * This function creates a SpiderGL.IO.BinaryRequest with the async and seng flags set to true, overriding their values in the options parameter.\r\n *\r\n * @param {string} url The URL of the content\r\n * @param {object} options The request options.\r\n *\r\n * @returns {SpiderGL.IO.BinaryRequest} The internally generated SpiderGL.IO.BinaryRequest.\r\n */\r\nSpiderGL.IO.requestBinary = function (url, options) {\r\n\toptions = SpiderGL.Utility.getDefaultObject({ }, options);\r\n\toptions.async = true;\r\n\toptions.send  = true;\r\n\tvar r = new SpiderGL.IO.BinaryRequest(url, options);\r\n\treturn r;\r\n};\r\n\r\n/**\r\n * Creates a SpiderGL.IO.ImageRequest.\r\n *\r\n * SpiderGL.IO.ImageRequest is the base class for I/O requests.\r\n * The request is always asynchronous, meaning that the async flag is ignored.\r\n *\r\n * @class The SpiderGL.IO.ImageRequest is the base class for I/O requests.\r\n *\r\n * @augments SpiderGL.IO.Request\r\n */\r\nSpiderGL.IO.ImageRequest = function (url, options) {\r\n\toptions = options || { };\r\n\tSpiderGL.IO.Request.call(this, url, options);\r\n\r\n\tvar that = this;\r\n\r\n\tvar img = new Image();\r\n\tthis._img  = img;\r\n\tthis._data = img;\r\n\r\n\timg.onabort = function () { that._doOnCancel();  that._doOnFinish(); };\r\n\timg.onerror = function () { that._doOnError();   that._doOnFinish(); };\r\n\timg.onload  = function () { that._doOnSuccess(); that._doOnFinish(); };\r\n\r\n\tif (typeof img.onprogress != \"undefined\") {\r\n\t\timg.onprogress = function (evt) { that._imgOnProgress(evt); };\r\n\t}\r\n\r\n\tvar send = SpiderGL.Utility.getDefaultValue(options.send, SpiderGL.IO.Request.DEFAULT_SEND);\r\n\tif (send) {\r\n\t\tthis.send();\r\n\t}\r\n};\r\n\r\nSpiderGL.IO.ImageRequest.prototype = {\r\n\t_doPostSuccess : function () {\r\n\t\tthis._data = this._img;\r\n\t},\r\n\r\n\t_doCancel : function () {\r\n\t\tthis._img.src = null;\r\n\t\tthis._img = new Image();\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_doSend : function () {\r\n\t\tthis._img.src = this._url;\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_imgOnProgress : function (evt) {\r\n\t\tvar loaded = 0;\r\n\t\tvar total  = 0;\r\n\t\tif (evt && evt.lengthComputable) {\r\n\t\t\tloaded = evt.loaded;\r\n\t\t\ttotal  = evt.total;\r\n\t\t}\r\n\t\tthis._doOnProgress(loaded, total);\r\n\t},\r\n\r\n\tget image() {\r\n\t\treturn this.data;\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.IO.ImageRequest, SpiderGL.IO.Request);\r\n\r\n/**\r\n * Asynchronous image read.\r\n * This function creates a SpiderGL.IO.ImageRequest with the async and seng flags set to true, overriding their values in the options parameter.\r\n *\r\n * @param {string} url The URL of the content\r\n * @param {object} options The request options.\r\n *\r\n * @returns {SpiderGL.IO.ImageRequest} The internally generated SpiderGL.IO.ImageRequest.\r\n */\r\nSpiderGL.IO.requestImage = function (url, options) {\r\n\toptions = SpiderGL.Utility.getDefaultObject({ }, options);\r\n\toptions.async = true;\r\n\toptions.send  = true;\r\n\tvar r = new SpiderGL.IO.ImageRequest(url, options);\r\n\treturn r;\r\n};\r\n\r\n/**\r\n * Creates a SpiderGL.IO.AggregateRequest.\r\n *\r\n * SpiderGL.IO.AggregateRequest is the base class for I/O requests.\r\n *\r\n * @class The SpiderGL.IO.AggregateRequest is the base class for I/O requests.\r\n *\r\n * @augments SpiderGL.IO.Request\r\n */\r\nSpiderGL.IO.AggregateRequest = function (options) {\r\n\toptions = options || { };\r\n\tSpiderGL.IO.Request.call(this, \"*\", options);\r\n\r\n\tvar that = this;\r\n\r\n\tthis._proxyOnProgress = function (loaded, total, req) {\r\n\t\tthat._reqOnProgress(loaded, total, req);\r\n\t};\r\n\r\n\tthis._proxyOnCancel = function (req) {\r\n\t\tthat._reqOnCancel(req);\r\n\t};\r\n\r\n\tthis._proxyOnError = function (req) {\r\n\t\tthat._reqOnError(req);\r\n\t};\r\n\r\n\tthis._proxyOnSuccess = function (req) {\r\n\t\tthat._reqOnSuccess(req);\r\n\t};\r\n\r\n\tthis._proxyOnFinish = function (req) {\r\n\t\tthat._reqOnFinish(req);\r\n\t};\r\n\r\n\tthis._aggrStartTime  = -1;\r\n\tthis._aggrFinishTime = -1;\r\n\r\n\tthis._eventReq = null;\r\n\tthis._cancelledReqs = 0;\r\n\tthis._failedReqs    = 0;\r\n\tthis._succeededReqs = 0;\r\n\tthis._requests = [ ];\r\n\tvar requests = options.requests;\r\n\tif (requests) {\r\n\t\tfor (var i=0, n=requests.length; i<n; ++i) {\r\n\t\t\tvar r = requests[i];\r\n\t\t\tif (r && !r.sent) {\r\n\t\t\t\tthis._installProxies(r);\r\n\t\t\t\tthis.addRequest(r);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar send = SpiderGL.Utility.getDefaultValue(options.send, SpiderGL.IO.Request.DEFAULT_SEND);\r\n\tif (send) {\r\n\t\tthis.send();\r\n\t}\r\n};\r\n\r\nSpiderGL.IO.AggregateRequest.prototype = {\r\n\t_doPostCancel : function () {\r\n\t\tif (!this._requestsFinished) {\r\n\t\t\tthis._status = SpiderGL.IO.Request.ONGOING;\r\n\t\t}\r\n\t},\r\n\r\n\t_doPostError : function () {\r\n\t\tif (!this._requestsFinished) {\r\n\t\t\tthis._status = SpiderGL.IO.Request.ONGOING;\r\n\t\t}\r\n\t},\r\n\r\n\t_doPostSuccess : function () {\r\n\t\tif (!this._requestsFinished) {\r\n\t\t\tthis._status = SpiderGL.IO.Request.ONGOING;\r\n\t\t}\r\n\t},\r\n\r\n\t_doCancel : function () {\r\n\t\tvar requests = this._requests;\r\n\t\tfor (var i=0, n=requests.length; i<n; ++i) {\r\n\t\t\trequests[i].cancel();\r\n\t\t}\r\n\t\tthis._aggrFinishTime = SpiderGL.Utility.getTime();\r\n\t},\r\n\r\n\t_doSend : function () {\r\n\t\tthis._aggrStartTime = SpiderGL.Utility.getTime();\r\n\t\tvar requests = this._requests;\r\n\t\tfor (var i=0, n=requests.length; i<n; ++i) {\r\n\t\t\trequests[i].send();\r\n\t\t}\r\n\t},\r\n\r\n\tget _requestsFinished() {\r\n\t\treturn ((this._cancelledReqs + this._failedReqs + this._succeededReqs) == this._requests.length);\r\n\t},\r\n\r\n\t_installProxies : function (req) {\r\n\t\treq.addEventListener(\"progress\", this._proxyOnProgress);\r\n\t\treq.addEventListener(\"cancel\",   this._proxyOnCancel);\r\n\t\treq.addEventListener(\"error\",    this._proxyOnError);\r\n\t\treq.addEventListener(\"success\",  this._proxyOnSuccess);\r\n\t\treq.addEventListener(\"finish\",   this._proxyOnFinish);\r\n\t},\r\n\r\n\t_uninstallProxies : function (req) {\r\n\t\treq.removeEventListener(\"progress\", this._proxyOnProgress);\r\n\t\treq.removeEventListener(\"cancel\",   this._proxyOnCancel);\r\n\t\treq.removeEventListener(\"error\",    this._proxyOnError);\r\n\t\treq.removeEventListener(\"success\",  this._proxyOnSuccess);\r\n\t\treq.removeEventListener(\"finish\",   this._proxyOnFinish);\r\n\t},\r\n\r\n\t_reqOnProgress : function (loaded, total, req) {\r\n\t\tvar idx = this._indexOf(this._requests, req);\r\n\t\tif (idx < 0) return;\r\n\t\tthis._eventReq = req;\r\n\t\tthis._doOnProgress(loaded, total);\r\n\t\tthis._eventReq = null;\r\n\t},\r\n\r\n\t_reqOnCancel : function (req) {\r\n\t\tvar idx = this._indexOf(this._requests, req);\r\n\t\tif (idx < 0) return;\r\n\t\tthis._eventReq = req;\r\n\t\t//this._doOnCancel();\r\n\t\tthis._cancelledReqs++;\r\n\t\tif (this._requestsFinished) {\r\n\t\t\tthis._aggrFinishTime = SpiderGL.Utility.getTime();\r\n\t\t\tif (this._cancelledReqs == this._requests.length) {\r\n\t\t\t\tthis._eventReq = this;\r\n\t\t\t\tthis._doOnCancel();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t}\r\n\t\tthis._eventReq = null;\r\n\t},\r\n\r\n\t_reqOnError : function (req) {\r\n\t\tvar idx = this._indexOf(this._requests, req);\r\n\t\tif (idx < 0) return;\r\n\t\tthis._eventReq = req;\r\n\t\t//this._doOnError();\r\n\t\tthis._failedReqs++;\r\n\t\tif (this._requestsFinished) {\r\n\t\t\tthis._aggrFinishTime = SpiderGL.Utility.getTime();\r\n\t\t\tthis._eventReq = this;\r\n\t\t\tthis._doOnError();\r\n\t\t}\r\n\t\tthis._eventReq = null;\r\n\t},\r\n\r\n\t_reqOnSuccess : function (req) {\r\n\t\tvar idx = this._indexOf(this._requests, req);\r\n\t\tif (idx < 0) return;\r\n\t\tthis._eventReq = req;\r\n\t\t//this._doOnSuccess();\r\n\t\tthis._succeededReqs++;\r\n\t\tif (this._requestsFinished) {\r\n\t\t\tthis._aggrFinishTime = SpiderGL.Utility.getTime();\r\n\t\t\tthis._eventReq = this;\r\n\t\t\tif (this._failedReqs > 0) {\r\n\t\t\t\tthis._doOnError();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._doOnSuccess();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._eventReq = null;\r\n\t},\r\n\r\n\t_reqOnFinish : function (req) {\r\n\t\tvar idx = this._indexOf(this._requests, req);\r\n\t\tif (idx < 0) return;\r\n\t\tthis._uninstallProxies(req);\r\n\t\tthis._eventReq = req;\r\n\t\t//this._doOnFinish();\r\n\t\tif (this._requestsFinished) {\r\n\t\t\tthis._eventReq = this;\r\n\t\t\tthis._doOnFinish();\r\n\t\t}\r\n\t\tthis._eventReq = null;\r\n\t},\r\n\r\n\tget eventSenderRequest() {\r\n\t\treturn this._eventReq;\r\n\t},\r\n\r\n\tget requests() {\r\n\t\treturn this._requests.slice();\r\n\t},\r\n\r\n\tget requests$() {\r\n\t\treturn this._requests;\r\n\t},\r\n\r\n\tget startTime() {\r\n\t\treturn this._aggrStartTime;\r\n\t},\r\n\r\n\tget finishTime() {\r\n\t\treturn this._aggrFinishTime;\r\n\t},\r\n\r\n\tget elapsedTime() {\r\n\t\tif (this._aggrStartTime < 0) return 0;\r\n\t\tif (this._aggrFinishTime < 0) return (SpiderGL.Utility.getTime() - this._aggrStartTime);\r\n\t\treturn (this._aggrFinishTime - this._aggrStartTime);\r\n\t},\r\n\r\n\taddRequest : function (r) {\r\n\t\tif (!r || this._sent) return;\r\n\t\tvar idx = this._indexOf(this._requests, r);\r\n\t\tif (idx >= 0) return;\r\n\t\tthis._requests.push(r);\r\n\t},\r\n\r\n\tremoveRequest : function (r) {\r\n\t\tif (!r || this._sent) return;\r\n\t\tvar idx = this._indexOf(this._requests, r);\r\n\t\tif (idx < 0) return;\r\n\t\tthis._requests.splice(idx, 1);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.IO.AggregateRequest, SpiderGL.IO.Request);\r\n\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview Math\r\n */\r\n\r\n/**\r\n * The SpiderGL.Math namespace.\r\n *\r\n * @namespace The SpiderGL.Math namespace.\r\n */\r\nSpiderGL.Math = { };\r\n\r\n// constants\r\n/*---------------------------------------------------------*/\r\n\r\n/**\r\n * Scale factor for degrees to radians conversion.\r\n * It is equal to PI / 180.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.DEG_TO_RAD = (Math.PI / 180.0);\r\n\r\n/**\r\n * Alias for Math.E.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.E = Math.E;\r\n\r\n/**\r\n * Alias for Math.LN2.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.LN2 = Math.LN2;\r\n\r\n/**\r\n * Alias for Math.LN10.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.LN10 = Math.LN10;\r\n\r\n/**\r\n * Alias for Math.LOG2E.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.LOG2E = Math.LOG2E;\r\n\r\n/**\r\n * Alias for Math.LOG10E.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.LOG10E = Math.LOG10E;\r\n\r\n/**\r\n * Alias for Math.PI.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.PI = Math.PI;\r\n\r\n/**\r\n * Scale factor for radians to degrees conversion.\r\n * It is equal to 180 / PI.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.RAD_TO_DEG = (180.0 / Math.PI);\r\n\r\n/**\r\n * Alias for Math.SQRT2.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.SQRT2 = Math.SQRT2;\r\n\r\n\r\n/**\r\n * Alias for Number.MAX_VALUE.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.MAX_VALUE = Number.MAX_VALUE;\r\n\r\n/**\r\n * Alias for Number.MIN_VALUE.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.MIN_VALUE = Number.MIN_VALUE;\r\n\r\n/**\r\n * Alias for SpiderGL.Math.MAX_VALUE.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.MAX_NUMBER = SpiderGL.Math.MAX_VALUE;\r\n\r\n/**\r\n * Alias for -SpiderGL.Math.MAX_VALUE.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.MIN_NUMBER = -SpiderGL.Math.MAX_VALUE;\r\n\r\n/**\r\n * Alias for Number.NaN.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.NAN = Number.NaN;\r\n\r\n/**\r\n * Alias for global Infinity.\r\n *\r\n * @constant\r\n *\r\n * @type number\r\n */\r\nSpiderGL.Math.INFINITY = Infinity;\r\n\r\n/*---------------------------------------------------------*/\r\n\r\n\r\n\r\n// functions on scalars\r\n/*---------------------------------------------------------*/\r\n\r\n/**\r\n * Alias for Math.abs.\r\n *\r\n * @param {number} x A number.\r\n *\r\n * @returns {number} The absolute value of x.\r\n */\r\nSpiderGL.Math.abs = function (x) {\r\n\treturn Math.abs(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.acos.\r\n *\r\n * @param {number} x The input cosine.\r\n *\r\n * @returns {number} The arccosine of x, in radians.\r\n */\r\nSpiderGL.Math.acos = function (x) {\r\n\treturn Math.acos(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.asin.\r\n *\r\n * @param {number} x The input sine.\r\n *\r\n * @returns {number} The arcsine of x, in radians.\r\n */\r\nSpiderGL.Math.asin = function (x) {\r\n\treturn Math.asin(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.atan2.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} The arctangent of x as a numeric value between -PI/2 and PI/2 radians.\r\n */\r\nSpiderGL.Math.atan = function (x) {\r\n\treturn Math.atan(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.atan2.\r\n *\r\n * @param {number} y A number.\r\n * @param {number} x A number.\r\n *\r\n * @returns {number} The the arctangent of the quotient of its arguments as a numeric value between PI and -PI.\r\n */\r\nSpiderGL.Math.atan2 = function (y, x) {\r\n\treturn Math.atan2(y, x);\r\n}\r\n\r\n/**\r\n * Alias for Math.ceil.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} x rounded upwards to the nearest integer.\r\n */\r\nSpiderGL.Math.ceil = function (x) {\r\n\treturn Math.ceil(x);\r\n}\r\n\r\n/**\r\n * Clamps a number over a range.\r\n *\r\n * @param {number} x The number to clamp.\r\n * @param {number} min The lower bound.\r\n * @param {number} max The upper bound.\r\n *\r\n * @returns {number} min if x < min, max if x > max, x otherwise.\r\n */\r\nSpiderGL.Math.clamp = function (x, min, max) {\r\n\treturn ((x <= min) ? (min) : ((x >= max) ? (max) : (x)));\r\n}\r\n\r\n/**\r\n * Alias for Math.cos.\r\n *\r\n * @param {number} x The input angle, in radians.\r\n *\r\n * @returns {number} The cosine of x.\r\n */\r\nSpiderGL.Math.cos = function (x) {\r\n\treturn Math.cos(x);\r\n}\r\n\r\n/**\r\n * Converts degrees to radians.\r\n *\r\n * @param {number} x The input angle, in degrees.\r\n *\r\n * @returns {number} x in radians.\r\n */\r\nSpiderGL.Math.degToRad = function (x) {\r\n\treturn (x * SpiderGL.Math.DEG_TO_RAD);\r\n}\r\n\r\n/**\r\n * Alias for Math.exp.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} E raised to x.\r\n */\r\nSpiderGL.Math.exp = function (x) {\r\n\treturn Math.exp(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.floor.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} x rounded downwards to the nearest integer.\r\n */\r\nSpiderGL.Math.floor = function (x) {\r\n\treturn Math.floor(x);\r\n}\r\n\r\n/**\r\n * Linear interpolation between two numbers.\r\n *\r\n * @param {number} x The start interpolation bound.\r\n * @param {number} y The stop interpolation bound.\r\n * @param {number} t The interpolation factor, between 0 and 1..\r\n *\r\n * @returns {number} The interpolated value (1-t)*x + t*y.\r\n */\r\nSpiderGL.Math.lerp = function (x, y, t) {\r\n\treturn x + t * (y - x);\r\n}\r\n\r\n/**\r\n * Alias for Math.log.\r\n * Same as {@link SpiderGL.Math.log}.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} The natural logarithm (base E) of x.\r\n */\r\nSpiderGL.Math.ln = function (x) {\r\n\treturn Math.log(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.log.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} The natural logarithm (base E) of x.\r\n */\r\nSpiderGL.Math.log = function (x) {\r\n\treturn Math.log(x);\r\n}\r\n\r\n/**\r\n * Logarithm base 2.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} The base 2 logarithm of x.\r\n */\r\nSpiderGL.Math.log2 = function (x) {\r\n\treturn (SpiderGL.Math.log(x) / SpiderGL.Math.LN2);\r\n}\r\n\r\n/**\r\n * Logarithm base 10.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} The base 10 logarithm of x.\r\n */\r\nSpiderGL.Math.log10 = function (x) {\r\n\treturn (SpiderGL.Math.log(x) / SpiderGL.Math.LN10);\r\n}\r\n\r\n/**\r\n * Alias for Math.max.\r\n *\r\n * @param {number} args Variable number of arguments\r\n *\r\n * @returns {number} The number with the highest value.\r\n *\r\n * @example\r\n * var x = SpiderGL.Math.max(3, 1.56, 2.1); // x == 3\r\n */\r\nSpiderGL.Math.max = function (args) {\r\n\treturn Math.max.apply(Math, arguments);\r\n}\r\n\r\n/**\r\n * Alias for Math.min.\r\n *\r\n * @param {number} args Variable number of arguments\r\n *\r\n * @returns {number} The number with the lowest value.\r\n *\r\n * @example\r\n * var x = SpiderGL.Math.min(3, 1.56, 2.1); // x == 1.56\r\n */\r\nSpiderGL.Math.min = function (args) {\r\n\treturn Math.min.apply(Math, arguments);\r\n}\r\n\r\n/**\r\n * Alias for Math.pow.\r\n *\r\n * @param {number} x The base number.\r\n * @param {number} x The exponent number.\r\n *\r\n * @returns {number} The value of x to the power of y.\r\n */\r\nSpiderGL.Math.pow = function (x, y) {\r\n\treturn Math.pow(x, y);\r\n}\r\n\r\n/**\r\n * Converts radians to degrees.\r\n *\r\n * @param {number} x The input angle, in radians.\r\n *\r\n * @returns {number} x in degrees.\r\n */\r\nSpiderGL.Math.radToDeg = function (x) {\r\n\treturn (x * SpiderGL.Math.RAD_TO_DEG);\r\n}\r\n\r\n/**\r\n * Alias for Math.random.\r\n *\r\n * @returns {number} A random number between 0.0 and 1.0, inclusive.\r\n */\r\nSpiderGL.Math.random = function () {\r\n\treturn Math.random();\r\n}\r\n\r\n/**\r\n * Alias for SpiderGL.Math.random.\r\n *\r\n * @returns {number} A random number between 0.0 and 1.0, inclusive.\r\n */\r\nSpiderGL.Math.random01 = function () {\r\n\treturn SpiderGL.Math.random();\r\n}\r\n\r\n/**\r\n * Generates a random number between -1.0 and 1.0.\r\n *\r\n * @returns {number} A random number between -1.0 and 1.0, inclusive.\r\n */\r\nSpiderGL.Math.random11 = function () {\r\n\treturn (SpiderGL.Math.random() * 2 - 1);\r\n}\r\n\r\n/**\r\n * Generates a random number between a and b.\r\n *\r\n * @param {number} min The range low end-point.\r\n * @param {number} max The range high end-point.\r\n *\r\n * @returns {number} A random number between min and max, inclusive.\r\n */\r\nSpiderGL.Math.randomRange = function (min, max) {\r\n\treturn (min + SpiderGL.Math.random() * (max - min));\r\n}\r\n\r\n/**\r\n * Alias for Math.round.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} x rounded to the nearest integer.\r\n *\r\n * @example\r\n * var a = SpiderGL.Math.round(    3); // a ==  3\r\n * var b = SpiderGL.Math.round(   -4); // b == -4\r\n * var c = SpiderGL.Math.round( 7.21); // c ==  7\r\n * var d = SpiderGL.Math.round( 7.56); // d ==  8\r\n * var e = SpiderGL.Math.round(-7.56); // e == -8\r\n * var f = SpiderGL.Math.round(-7.21); // f == -7\r\n */\r\nSpiderGL.Math.round = function (x) {\r\n\treturn Math.sqrt(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.sin.\r\n *\r\n * @param {number} x The input angle, in radians.\r\n *\r\n * @returns {number} The sine of x.\r\n */\r\nSpiderGL.Math.sin = function (x) {\r\n\treturn Math.sin(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.sqrt.\r\n *\r\n * @param {number} x The input number.\r\n *\r\n * @returns {number} The square root of x.\r\n */\r\nSpiderGL.Math.sqrt = function (x) {\r\n\treturn Math.sqrt(x);\r\n}\r\n\r\n/**\r\n * Alias for Math.tan.\r\n *\r\n * @param {number} x The input angle, in radians.\r\n *\r\n * @returns {number} The tangent of x.\r\n */\r\nSpiderGL.Math.tan = function (x) {\r\n\treturn Math.tan(x);\r\n}\r\n\r\n/*---------------------------------------------------------*/\r\n\r\n\r\n\r\n// 2-dimensional vector\r\n/*---------------------------------------------------------*/\r\n\r\n/**\r\n * The SpiderGL.Math.Vec2 namespace.\r\n * The provided functions operate on 2-dimensional vectors, represented as standard JavaScript arrays of length 2.\r\n * In general, vectors are considered as column vectors.\r\n *\r\n * @namespace The SpiderGL.Math.Vec2 namespace defines operations on 2-dimensional vectors.\r\n */\r\nSpiderGL.Math.Vec2 = { };\r\n\r\n/**\r\n * Duplicates the input 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = v[i] (same as v.slice(0, 2)).\r\n */\r\nSpiderGL.Math.Vec2.dup = function (v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\n/**\r\n * Creates a 2-dimensional vector initialized with a scalar.\r\n *\r\n * @param {number} s The input scalar.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = s.\r\n */\r\nSpiderGL.Math.Vec2.scalar = function (s) {\r\n\treturn [s, s];\r\n}\r\n\r\n/**\r\n * Creates a 2-dimensional vector initialized with zero.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = 0.\r\n */\r\nSpiderGL.Math.Vec2.zero = function () {\r\n\treturn [0, 0];\r\n}\r\n\r\n/**\r\n * Creates a 2-dimensional vector initialized with one.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = 1.0.\r\n */\r\nSpiderGL.Math.Vec2.one = function () {\r\n\treturn [1, 1];\r\n}\r\n\r\n/**\r\n * Creates a 2-dimensional vector initialized with SpiderGL.Math.MAX_NUMBER.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = SpiderGL.Math.MAX_NUMBER.\r\n */\r\nSpiderGL.Math.Vec2.maxNumber = function () {\r\n\treturn [SpiderGL.Math.MAX_NUMBER, SpiderGL.Math.MAX_NUMBER];\r\n}\r\n\r\n/**\r\n * Creates a 2-dimensional vector initialized with SpiderGL.Math.MIN_NUMBER.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = SpiderGL.Math.MIN_NUMBER.\r\n */\r\nSpiderGL.Math.Vec2.minNumber = function () {\r\n\treturn [SpiderGL.Math.MIN_NUMBER, SpiderGL.Math.MIN_NUMBER];\r\n}\r\n\r\n/**\r\n * Creates a 3-dimensional vector from a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n * @param {number} [z=0.0] The 3th component.\r\n *\r\n * @returns {array} A new 3-dimensional array r equal to v extended with z as 3rd component.\r\n */\r\nSpiderGL.Math.Vec2.to3 = function (v, z) {\r\n\treturn [v[0], v[1], (z != undefined) ? z : 0];\r\n}\r\n\r\n/**\r\n * Creates a 4-dimensional vector from a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n * @param {number} [z=0.0] The 3th component.\r\n * @param {number} [w=1.0] The 4th component.\r\n *\r\n * @returns {array} A new 4-dimensional array r equal to v extended with z as 3rd component and w as 4th component.\r\n */\r\nSpiderGL.Math.Vec2.to4 = function (v, z, w) {\r\n\treturn [v[0], v[1], v[2], (z != undefined) ? z : 0, (w != undefined) ? w : 1];\r\n}\r\n\r\n/**\r\n * Component-wise negation of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = -v[i].\r\n */\r\nSpiderGL.Math.Vec2.neg = function (v) {\r\n\treturn [-v[0], -v[1]];\r\n}\r\n\r\n/**\r\n * Component-wise addition of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = u[i] + v[i].\r\n */\r\nSpiderGL.Math.Vec2.add = function (u, v) {\r\n\treturn [u[0]+v[0], u[1]+v[1]];\r\n}\r\n\r\n/**\r\n * Component-wise addition of a 2-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector addition operand.\r\n * @param {number} s The scalar addition operand.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = v[i] + s.\r\n */\r\nSpiderGL.Math.Vec2.adds = function (v, s) {\r\n\treturn [v[0]+s, v[1]+s];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first subtraction operand.\r\n * @param {array} v The second subtraction operand.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = u[i] - v[i].\r\n */\r\nSpiderGL.Math.Vec2.sub = function (u, v) {\r\n\treturn [u[0]-v[0], u[1]-v[1]];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of a 2-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector subtraction operand.\r\n * @param {number} s The scalar subtraction operand.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = v[i] - s.\r\n */\r\nSpiderGL.Math.Vec2.subs = function (v, s) {\r\n\treturn [v[0]-s, v[1]-s];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of a scalar and a 2-dimensional.\r\n *\r\n * @param {number} s The scalar subtraction operand.\r\n * @param {array} v The vector subtraction operand.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = s - v[i].\r\n */\r\nSpiderGL.Math.Vec2.ssub = function (s, v) {\r\n\treturn [s-v[0], s-v[1]];\r\n}\r\n\r\n/**\r\n * Component-wise multiplication of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first multiplication operand.\r\n * @param {array} v The second multiplication operand.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = u[i] * v[i].\r\n */\r\nSpiderGL.Math.Vec2.mul = function (u, v) {\r\n\treturn [u[0]*v[0], u[1]*v[1]];\r\n}\r\n\r\n/**\r\n * Component-wise multiplication of a 2-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector multiplication operand.\r\n * @param {number} s The scalar multiplication operand.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = v[i] * s.\r\n */\r\nSpiderGL.Math.Vec2.muls = function (v, s) {\r\n\treturn [v[0]*s, v[1]*s];\r\n}\r\n\r\n/**\r\n * Component-wise division of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The numerator vector.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = u[i] / v[i].\r\n */\r\nSpiderGL.Math.Vec2.div = function (u, v) {\r\n\treturn [u[0]/v[0], u[1]/v[1]];\r\n}\r\n\r\n/**\r\n * Component-wise division of a 2-dimensional vector by a scalar.\r\n *\r\n * @param {array} v The numerator vector.\r\n * @param {number} s The scalar denominator.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = v[i] / s.\r\n */\r\nSpiderGL.Math.Vec2.divs = function (v, s) {\r\n\treturn [v[0]/s, v[1]/s];\r\n}\r\n\r\n/**\r\n * Component-wise division of a scalar by a 2-dimensional vector.\r\n *\r\n * @param {number} s The denominator scalar.\r\n * @param {array} v The numerator vector.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = s / v[i].\r\n */\r\nSpiderGL.Math.Vec2.sdiv = function (s, v) {\r\n\treturn [s/v[0], s/v[1]];\r\n}\r\n\r\n/**\r\n * Component-wise reciprocal of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input (denominator) vector.\r\n *\r\n * @returns {array} A new 2-dimensionals vector r, where r[i] = 1.0 / v[i].\r\n */\r\nSpiderGL.Math.Vec2.rcp = function (v) {\r\n\treturn [1.0/v[0], 1.0/v[1]];\r\n}\r\n\r\n/**\r\n * Dot product of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first vector operand.\r\n * @param {array} v The second vector operand.\r\n *\r\n * @returns {number} The dot product of u and v.\r\n */\r\nSpiderGL.Math.Vec2.dot = function (u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1]);\r\n}\r\n\r\n/**\r\n * Cross product of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first vector operand.\r\n * @param {array} v The second vector operand.\r\n *\r\n * @returns {array} A new 2-dimensional array equal to the cross product of u and v.\r\n */\r\nSpiderGL.Math.Vec2.cross = function (u, v) {\r\n\treturn (u[0]*v[1] - u[1]*v[0]);\r\n}\r\n\r\n/**\r\n * Perp operation.\r\n * Returns a 2-dimensional vector which is orthogonal to the input vector and lies in the right halfspace.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r = [v[1], -v[0]].\r\n */\r\nSpiderGL.Math.Vec2.perp = function (v) {\r\n\treturn [v[1], -v[0]];\r\n}\r\n\r\n/**\r\n * Squared length of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {number} The squared length of v, same as the dot product of v with itself.\r\n */\r\nSpiderGL.Math.Vec2.sqLength = function (v) {\r\n\treturn SpiderGL.Math.Vec2.dot(v, v);\r\n}\r\n\r\n/**\r\n * Length of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {number} The length of v.\r\n */\r\nSpiderGL.Math.Vec2.length = function (v) {\r\n\treturn SpiderGL.Math.sqrt(SpiderGL.Math.Vec2.sqLength(v));\r\n}\r\n\r\n/**\r\n * Creates a normalized 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r representing the normalized v, where r[i] = v[i] / {@link SpiderGL.Math.Vec2.length}(v).\r\n */\r\nSpiderGL.Math.Vec2.normalize = function (v) {\r\n\tvar f = 1.0 / SpiderGL.Math.Vec2.length(v);\r\n\treturn SpiderGL.Math.Vec2.muls(v, f);\r\n}\r\n\r\n/**\r\n * Component-wise absolute value of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.abs}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.abs = function (v) {\r\n\treturn [SpiderGL.Math.abs(v[0]), SpiderGL.Math.abs(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise arccosine of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.acos}(v[i]), in radians.\r\n */\r\nSpiderGL.Math.Vec2.acos = function (v) {\r\n\treturn [SpiderGL.Math.acos(v[0]), SpiderGL.Math.acos(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise arcsine of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.asin}(v[i]), in radians.\r\n */\r\nSpiderGL.Math.Vec2.asin = function (v) {\r\n\treturn [SpiderGL.Math.asin(v[0]), SpiderGL.Math.asin(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise arctangent of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.atan}(v[i]), between -PI/2 and PI/2 radians.\r\n */\r\nSpiderGL.Math.Vec2.atan = function (v) {\r\n\treturn [SpiderGL.Math.atan(v[0]), SpiderGL.Math.atan(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise arctangent of the quotient of two 2-dimensional vectors.\r\n *\r\n * @param {array} y The numerator vector.\r\n * @param {array} x The denominator vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.atan2}(y[i], x[i]), between PI and -PI radians.\r\n */\r\nSpiderGL.Math.Vec2.atan2 = function (y, x) {\r\n\treturn [SpiderGL.Math.atan2(y[0], x[0]), SpiderGL.Math.atan2(y[1], x[1])];\r\n}\r\n\r\n/**\r\n * Component-wise ceil of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.ceil}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.ceil = function (v) {\r\n\treturn [SpiderGL.Math.ceil(v[0]), SpiderGL.Math.ceil(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise clamp of a 2-dimensional vector with vector bounds.\r\n *\r\n * @param {array} v The input vector.\r\n * @param {array} min The lower 2-dimensional bound.\r\n * @param {array} max The upper 2-dimensional bound.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.clamp}(v[i], min[i], max[i]).\r\n */\r\nSpiderGL.Math.Vec2.clamp = function (v, min, max) {\r\n\treturn [SpiderGL.Math.clamp(v[0], min[0], max[0]), SpiderGL.Math.clamp(v[1], min[1], max[1])];\r\n}\r\n\r\n/**\r\n * Component-wise cosine of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.cos}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.cos = function (v) {\r\n\treturn [SpiderGL.Math.cos(v[0]), SpiderGL.Math.cos(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise conversion of a 2-dimensional vector from degrees to radians.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.degToRad}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.degToRad = function (v) {\r\n\treturn [SpiderGL.Math.degToRad(v[0]), SpiderGL.Math.degToRad(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise exponential of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.exp}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.exp = function (v) {\r\n\treturn [SpiderGL.Math.exp(v[0]), SpiderGL.Math.exp(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise floor of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.floor}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.floor = function (v) {\r\n\treturn [SpiderGL.Math.floor(v[0]), SpiderGL.Math.floor(v[1])];\r\n}\r\n\r\n/**\r\n * Linear interpolation between two 2-dimensional vectors.\r\n *\r\n * @param {array} u The start interpolation bound.\r\n * @param {array} v The stop interpolation bound.\r\n * @param {number} t The interpolation factor, between 0 and 1.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = (1-t)*u[i] + t*v[i].\r\n */\r\nSpiderGL.Math.Vec2.lerp = function (u, v, t) {\r\n\treturn [\r\n\t\tSpiderGL.Math.lerp(u[0], v[0], t),\r\n\t\tSpiderGL.Math.lerp(u[1], v[1], t)\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise natural (base E) logarithm of a 2-dimensional vector.\r\n * Same as {@link SpiderGL.Math.Vec2.log}.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.ln}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.ln = function (v) {\r\n\treturn [SpiderGL.Math.ln(v[0]), SpiderGL.Math.ln(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise natural (base E) logarithm of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.log}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.log = function (v) {\r\n\treturn [SpiderGL.Math.log(v[0]), SpiderGL.Math.log(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise base 2 logarithm of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.log2}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.log2 = function (v) {\r\n\treturn [SpiderGL.Math.log2(v[0]), SpiderGL.Math.log2(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise base 10 logarithm of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.log10}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.log10 = function (v) {\r\n\treturn [SpiderGL.Math.log10(v[0]), SpiderGL.Math.log10(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise maximum of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first vector.\r\n * @param {array} v The second vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.max}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec2.max = function (u, v) {\r\n\treturn [SpiderGL.Math.max(u[0], v[0]), SpiderGL.Math.max(u[1], v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise minimum of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first vector.\r\n * @param {array} v The second vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.min}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec2.min = function (u, v) {\r\n\treturn [SpiderGL.Math.min(u[0], v[0]), SpiderGL.Math.min(u[1], v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise power of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The base vector.\r\n * @param {array} v The exponent vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.pow}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec2.pow = function (u, v) {\r\n\treturn [SpiderGL.Math.pow(u[0], v[0]), SpiderGL.Math.pow(u[1], v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise conversion of a 2-dimensional vector from radians to degrees.\r\n *\r\n * @param {array} v The input vector, in degrees.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.pow}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.radToDeg = function (v) {\r\n\treturn [SpiderGL.Math.radToDeg(v[0]), SpiderGL.Math.radToDeg(v[1])];\r\n}\r\n\r\n/**\r\n * Creates a random 2-dimensional vector between 0 and 1.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.random}().\r\n */\r\nSpiderGL.Math.Vec2.random = function () {\r\n\treturn [SpiderGL.Math.random(), SpiderGL.Math.random()];\r\n}\r\n\r\n/**\r\n * Creates a random 2-dimensional vector between 0 and 1.\r\n * Same as {@link SpiderGL.Math.Vec2.random}.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.random01}().\r\n */\r\nSpiderGL.Math.Vec2.random01 = function () {\r\n\treturn [SpiderGL.Math.random01(), SpiderGL.Math.random01()];\r\n}\r\n\r\n/**\r\n * Creates a random 2-dimensional vector between -1 and 1.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.random11}().\r\n */\r\nSpiderGL.Math.Vec2.random11 = function () {\r\n\treturn [SpiderGL.Math.random11(), SpiderGL.Math.random11()];\r\n}\r\n\r\n/**\r\n * Creates a random 2-dimensional vector inside a range.\r\n *\r\n * @param {array} min The range vector lower bound.\r\n * @param {array} max The range vector upper bound.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.randomRange}(min[i], max[i]).\r\n */\r\nSpiderGL.Math.Vec2.randomRange = function (min, max) {\r\n\treturn [SpiderGL.Math.randomRange(min[0], max[0]), SpiderGL.Math.randomRange(min[1], max[1])];\r\n}\r\n\r\n/**\r\n * Component-wise round of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.round}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.round = function (v) {\r\n\treturn [SpiderGL.Math.round(v[0]), SpiderGL.Math.round(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise sine of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.sin}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.sin = function (v) {\r\n\treturn [SpiderGL.Math.sin(v[0]), SpiderGL.Math.sin(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise square root of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.sqrt}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.sqrt = function (v) {\r\n\treturn [SpiderGL.Math.sqrt(v[0]), SpiderGL.Math.sqrt(v[1])];\r\n}\r\n\r\n/**\r\n * Component-wise tangent root of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 2-dimensional array r, where r[i] = {@link SpiderGL.Math.tan}(v[i]).\r\n */\r\nSpiderGL.Math.Vec2.tan = function (v) {\r\n\treturn [SpiderGL.Math.tan(v[0]), SpiderGL.Math.tan(v[1])];\r\n}\r\n\r\n/**\r\n * In-place component-wise copy of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The destination vector.\r\n * @param {array} v The source vector.\r\n *\r\n * @returns {array} The destination vector u, where u[i] = v[i].\r\n */\r\nSpiderGL.Math.Vec2.copy$ = function (u, v) {\r\n\tu[0] = v[0];\r\n\tu[1] = v[1];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise negation of a 2-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = -v[i].\r\n */\r\nSpiderGL.Math.Vec2.neg$ = function (v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise addition of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] + v[i].\r\n */\r\nSpiderGL.Math.Vec2.add$ = function (u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise addition of a 2-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector addition operand.\r\n * @param {number} s The scalar addition operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] + s.\r\n */\r\nSpiderGL.Math.Vec2.adds$ = function (v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] - v[i].\r\n */\r\nSpiderGL.Math.Vec2.sub$ = function (u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of a 2-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector subtraction operand.\r\n * @param {number} s The scalar subtraction operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] - s.\r\n */\r\nSpiderGL.Math.Vec2.subs$ = function (v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of a scalar and a 2-dimensional vector.\r\n *\r\n * @param {number} s The scalar subtraction operand\r\n * @param {array} v The vector subtraction operand.\r\n *\r\n * @returns {array} The input vector v, where v[i] = s - v[i].\r\n */\r\nSpiderGL.Math.Vec2.ssub$ = function (s, v) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise multiplication of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The first multiplication operand.\r\n * @param {array} v The second multiplication operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] * v[i].\r\n */\r\nSpiderGL.Math.Vec2.mul$ = function (u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise multiplication of a 2-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The first multiplication operand.\r\n * @param {number} s The second multiplication operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] * s.\r\n */\r\nSpiderGL.Math.Vec2.muls$ = function (v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of two 2-dimensional vectors.\r\n *\r\n * @param {array} u The numerator vector.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] / v[i].\r\n */\r\nSpiderGL.Math.Vec2.div$ = function (u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of a 2-dimensional vector by a scalar.\r\n *\r\n * @param {array} v The numerator vector.\r\n * @param {number} s The scalar denominator.\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] / s.\r\n */\r\nSpiderGL.Math.Vec2.divs$ = function (v, s) {\r\n\tv[0] /= s;\r\n\tv[1] /= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of a scalar by a 2-dimensional.\r\n *\r\n * @param {number} s The scalar numerator.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = s / v[i].\r\n */\r\nSpiderGL.Math.Vec2.sdiv$ = function (v, s) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place perp operation.\r\n * Returns a 2-dimensional vector which is orthogonal to the input vector and lies in the right halfspace.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} The input vector v, where v = [v[1], -v[0]].\r\n */\r\nSpiderGL.Math.Vec2.perp$ = function (v) {\r\n\tvar v0 = v[0];\r\n\tv[0] = v[1];\r\n\tv[1] = -v0;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place 2-dimensional vector normalization.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] / {@link SpiderGL.Math.Vec2.length}(v).\r\n */\r\nSpiderGL.Math.Vec2.normalize$ = function (v) {\r\n\tvar f = 1.0 / SpiderGL.Math.Vec2.length(v);\r\n\treturn SpiderGL.Math.Vec2.muls$(v, f);\r\n}\r\n\r\n/*---------------------------------------------------------*/\r\n\r\n\r\n\r\n// 3-dimensional vector\r\n/*---------------------------------------------------------*/\r\n\r\n/**\r\n * The SpiderGL.Math.Vec3 namespace.\r\n * The provided functions operate on 3-dimensional vectors, represented as standard JavaScript arrays of length 3.\r\n * In general, vectors are considered as column vectors.\r\n *\r\n * @namespace The SpiderGL.Math.Vec3 namespace defines operations on 3-dimensional vectors.\r\n */\r\nSpiderGL.Math.Vec3 = { };\r\n\r\n/**\r\n * Duplicates the input 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = v[i] (same as v.slice(0, 3)).\r\n */\r\nSpiderGL.Math.Vec3.dup = function (v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n\r\n/**\r\n * Creates a 3-dimensional vector initialized with a scalar.\r\n *\r\n * @param {number} s The input scalar.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = s.\r\n */\r\nSpiderGL.Math.Vec3.scalar = function (s) {\r\n\treturn [s, s, s];\r\n}\r\n\r\n/**\r\n * Creates a 3-dimensional vector initialized with zero.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = 0.\r\n */\r\nSpiderGL.Math.Vec3.zero = function () {\r\n\treturn [0, 0, 0];\r\n}\r\n\r\n/**\r\n * Creates a 3-dimensional vector initialized with one.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = 1.0.\r\n */\r\nSpiderGL.Math.Vec3.one = function () {\r\n\treturn [1, 1, 1];\r\n}\r\n\r\n/**\r\n * Creates a 3-dimensional vector initialized with SpiderGL.Math.MAX_NUMBER.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = SpiderGL.Math.MAX_NUMBER.\r\n */\r\nSpiderGL.Math.Vec3.maxNumber = function () {\r\n\treturn [SpiderGL.Math.MAX_NUMBER, SpiderGL.Math.MAX_NUMBER, SpiderGL.Math.MAX_NUMBER];\r\n}\r\n\r\n/**\r\n * Creates a 3-dimensional vector initialized with SpiderGL.Math.MIN_NUMBER.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = SpiderGL.Math.MIN_NUMBER.\r\n */\r\nSpiderGL.Math.Vec3.minNumber = function () {\r\n\treturn [SpiderGL.Math.MIN_NUMBER, SpiderGL.Math.MIN_NUMBER, SpiderGL.Math.MIN_NUMBER];\r\n}\r\n\r\n/**\r\n * Creates a 2-dimensional vector from a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r equal to v with the 3rd component dropped.\r\n */\r\nSpiderGL.Math.Vec3.to2 = function (v) {\r\n\treturn [v[0], v[1]];\r\n}\r\n\r\n/**\r\n * Creates a 4-dimensional vector from a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n * @param {number} [w=1.0] The 4th component.\r\n *\r\n * @returns {array} A new 4-dimensional array r equal to v extended with w as 4th component.\r\n */\r\nSpiderGL.Math.Vec3.to4 = function (v, w) {\r\n\treturn [v[0], v[1], v[2], (w != undefined) ? w : 1];\r\n}\r\n\r\n/**\r\n * Component-wise negation of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = -v[i].\r\n */\r\nSpiderGL.Math.Vec3.neg = function (v) {\r\n\treturn [-v[0], -v[1], -v[2]];\r\n}\r\n\r\n/**\r\n * Component-wise addition of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = u[i] + v[i].\r\n */\r\nSpiderGL.Math.Vec3.add = function (u, v) {\r\n\treturn [u[0]+v[0], u[1]+v[1], u[2]+v[2]];\r\n}\r\n\r\n/**\r\n * Component-wise addition of a 3-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector addition operand.\r\n * @param {number} s The scalar addition operand.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = v[i] + s.\r\n */\r\nSpiderGL.Math.Vec3.adds = function (v, s) {\r\n\treturn [v[0]+s, v[1]+s, v[2]+s];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first subtraction operand.\r\n * @param {array} v The second subtraction operand.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = u[i] - v[i].\r\n */\r\nSpiderGL.Math.Vec3.sub = function (u, v) {\r\n\treturn [u[0]-v[0], u[1]-v[1], u[2]-v[2]];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of a 3-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector subtraction operand.\r\n * @param {number} s The scalar subtraction operand.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = v[i] - s.\r\n */\r\nSpiderGL.Math.Vec3.subs = function (v, s) {\r\n\treturn [v[0]-s, v[1]-s, v[2]-s];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of a scalar and a 3-dimensional.\r\n *\r\n * @param {number} s The scalar subtraction operand.\r\n * @param {array} v The vector subtraction operand.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = s - v[i].\r\n */\r\nSpiderGL.Math.Vec3.ssub = function (s, v) {\r\n\treturn [s-v[0], s-v[1], s-v[2]];\r\n}\r\n\r\n/**\r\n * Component-wise multiplication of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first multiplication operand.\r\n * @param {array} v The second multiplication operand.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = u[i] * v[i].\r\n */\r\nSpiderGL.Math.Vec3.mul = function (u, v) {\r\n\treturn [u[0]*v[0], u[1]*v[1], u[2]*v[2]];\r\n}\r\n\r\n/**\r\n * Component-wise multiplication of a 3-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector multiplication operand.\r\n * @param {number} s The scalar multiplication operand.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = v[i] * s.\r\n */\r\nSpiderGL.Math.Vec3.muls = function (v, s) {\r\n\treturn [v[0]*s, v[1]*s, v[2]*s];\r\n}\r\n\r\n/**\r\n * Component-wise division of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The numerator vector.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = u[i] / v[i].\r\n */\r\nSpiderGL.Math.Vec3.div = function (u, v) {\r\n\treturn [u[0]/v[0], u[1]/v[1], u[2]/v[2]];\r\n}\r\n\r\n/**\r\n * Component-wise division of a 3-dimensional vector by a scalar.\r\n *\r\n * @param {array} v The numerator vector.\r\n * @param {number} s The scalar denominator.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = v[i] / s.\r\n */\r\nSpiderGL.Math.Vec3.divs = function (v, s) {\r\n\treturn [v[0]/s, v[1]/s, v[2]/s];\r\n}\r\n\r\n/**\r\n * Component-wise division of a scalar by a 3-dimensional vector.\r\n *\r\n * @param {number} s The denominator scalar.\r\n * @param {array} v The numerator vector.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = s / v[i].\r\n */\r\nSpiderGL.Math.Vec3.sdiv = function (s, v) {\r\n\treturn [s/v[0], s/v[1], s/v[2]];\r\n}\r\n\r\n/**\r\n * Component-wise reciprocal of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input (denominator) vector.\r\n *\r\n * @returns {array} A new 3-dimensionals vector r, where r[i] = 1.0 / v[i].\r\n */\r\nSpiderGL.Math.Vec3.rcp = function (v) {\r\n\treturn [1.0/v[0], 1.0/v[1], 1.0/v[2]];\r\n}\r\n\r\n/**\r\n * Dot product of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first vector operand.\r\n * @param {array} v The second vector operand.\r\n *\r\n * @returns {number} The dot product of u and v.\r\n */\r\nSpiderGL.Math.Vec3.dot = function (u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1] + u[2]*v[2]);\r\n}\r\n\r\n/**\r\n * Cross product of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first vector operand.\r\n * @param {array} v The second vector operand.\r\n *\r\n * @returns {array} A new 3-dimensional array equal to the cross product of u and v.\r\n */\r\nSpiderGL.Math.Vec3.cross = function (u, v) {\r\n\treturn [u[1]*v[2] - u[2]*v[1], u[2]*v[0] - u[0]*v[2], u[0]*v[1] - u[1]*v[0]];\r\n}\r\n\r\n/**\r\n * Squared length of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {number} The squared length of v, same as the dot product of v with itself.\r\n */\r\nSpiderGL.Math.Vec3.sqLength = function (v) {\r\n\treturn SpiderGL.Math.Vec3.dot(v, v);\r\n}\r\n\r\n/**\r\n * Length of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {number} The length of v.\r\n */\r\nSpiderGL.Math.Vec3.length = function (v) {\r\n\treturn SpiderGL.Math.sqrt(SpiderGL.Math.Vec3.sqLength(v));\r\n}\r\n\r\n/**\r\n * Creates a normalized 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r representing the normalized v, where r[i] = v[i] / {@link SpiderGL.Math.Vec3.length}(v).\r\n */\r\nSpiderGL.Math.Vec3.normalize = function (v) {\r\n\tvar f = 1.0 / SpiderGL.Math.Vec3.length(v);\r\n\treturn SpiderGL.Math.Vec3.muls(v, f);\r\n}\r\n\r\n/**\r\n * Component-wise absolute value of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.abs}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.abs = function (v) {\r\n\treturn [SpiderGL.Math.abs(v[0]), SpiderGL.Math.abs(v[1]), SpiderGL.Math.abs(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise arccosine of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.acos}(v[i]), in radians.\r\n */\r\nSpiderGL.Math.Vec3.acos = function (v) {\r\n\treturn [SpiderGL.Math.acos(v[0]), SpiderGL.Math.acos(v[1]), SpiderGL.Math.acos(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise arcsine of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.asin}(v[i]), in radians.\r\n */\r\nSpiderGL.Math.Vec3.asin = function (v) {\r\n\treturn [SpiderGL.Math.asin(v[0]), SpiderGL.Math.asin(v[1]), SpiderGL.Math.asin(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise arctangent of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.atan}(v[i]), between -PI/2 and PI/2 radians.\r\n */\r\nSpiderGL.Math.Vec3.atan = function (v) {\r\n\treturn [SpiderGL.Math.atan(v[0]), SpiderGL.Math.atan(v[1]), SpiderGL.Math.atan(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise arctangent of the quotient of two 3-dimensional vectors.\r\n *\r\n * @param {array} y The numerator vector.\r\n * @param {array} x The denominator vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.atan2}(y[i], x[i]), between PI and -PI radians.\r\n */\r\nSpiderGL.Math.Vec3.atan2 = function (y, x) {\r\n\treturn [SpiderGL.Math.atan2(y[0], x[0]), SpiderGL.Math.atan2(y[1], x[1]), SpiderGL.Math.atan2(y[2], x[2])];\r\n}\r\n\r\n/**\r\n * Component-wise ceil of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.ceil}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.ceil = function (v) {\r\n\treturn [SpiderGL.Math.ceil(v[0]), SpiderGL.Math.ceil(v[1]), SpiderGL.Math.ceil(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise clamp of a 3-dimensional vector with vector bounds.\r\n *\r\n * @param {array} v The input vector.\r\n * @param {array} min The lower 3-dimensional bound.\r\n * @param {array} max The upper 3-dimensional bound.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.clamp}(v[i], min[i], max[i]).\r\n */\r\nSpiderGL.Math.Vec3.clamp = function (v, min, max) {\r\n\treturn [SpiderGL.Math.clamp(v[0], min[0], max[0]), SpiderGL.Math.clamp(v[1], min[1], max[1]), SpiderGL.Math.clamp(v[2], min[2], max[2])];\r\n}\r\n\r\n/**\r\n * Component-wise cosine of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.cos}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.cos = function (v) {\r\n\treturn [SpiderGL.Math.cos(v[0]), SpiderGL.Math.cos(v[1]), SpiderGL.Math.cos(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise conversion of a 3-dimensional vector from degrees to radians.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.degToRad}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.degToRad = function (v) {\r\n\treturn [SpiderGL.Math.degToRad(v[0]), SpiderGL.Math.degToRad(v[1]), SpiderGL.Math.degToRad(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise exponential of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.exp}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.exp = function (v) {\r\n\treturn [SpiderGL.Math.exp(v[0]), SpiderGL.Math.exp(v[1]), SpiderGL.Math.exp(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise floor of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.floor}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.floor = function (v) {\r\n\treturn [SpiderGL.Math.floor(v[0]), SpiderGL.Math.floor(v[1]), SpiderGL.Math.floor(v[2])];\r\n}\r\n\r\n/**\r\n * Linear interpolation between two 3-dimensional vectors.\r\n *\r\n * @param {array} u The start interpolation bound.\r\n * @param {array} v The stop interpolation bound.\r\n * @param {number} t The interpolation factor, between 0 and 1.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = (1-t)*u[i] + t*v[i].\r\n */\r\nSpiderGL.Math.Vec3.lerp = function (u, v, t) {\r\n\treturn [\r\n\t\tSpiderGL.Math.lerp(u[0], v[0], t),\r\n\t\tSpiderGL.Math.lerp(u[1], v[1], t),\r\n\t\tSpiderGL.Math.lerp(u[2], v[2], t)\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise natural (base E) logarithm of a 3-dimensional vector.\r\n * Same as {@link SpiderGL.Math.Vec3.log}.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.ln}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.ln = function (v) {\r\n\treturn [SpiderGL.Math.ln(v[0]), SpiderGL.Math.ln(v[1]), SpiderGL.Math.ln(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise natural (base E) logarithm of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.log}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.log = function (v) {\r\n\treturn [SpiderGL.Math.log(v[0]), SpiderGL.Math.log(v[1]), SpiderGL.Math.log(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise base 2 logarithm of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.log2}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.log2 = function (v) {\r\n\treturn [SpiderGL.Math.log2(v[0]), SpiderGL.Math.log2(v[1]), SpiderGL.Math.log2(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise base 10 logarithm of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.log10}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.log10 = function (v) {\r\n\treturn [SpiderGL.Math.log10(v[0]), SpiderGL.Math.log10(v[1]), SpiderGL.Math.log10(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise maximum of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first vector.\r\n * @param {array} v The second vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.max}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec3.max = function (u, v) {\r\n\treturn [SpiderGL.Math.max(u[0], v[0]), SpiderGL.Math.max(u[1], v[1]), SpiderGL.Math.max(u[2], v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise minimum of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first vector.\r\n * @param {array} v The second vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.min}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec3.min = function (u, v) {\r\n\treturn [SpiderGL.Math.min(u[0], v[0]), SpiderGL.Math.min(u[1], v[1]), SpiderGL.Math.min(u[2], v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise power of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The base vector.\r\n * @param {array} v The exponent vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.pow}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec3.pow = function (u, v) {\r\n\treturn [SpiderGL.Math.pow(u[0], v[0]), SpiderGL.Math.pow(u[1], v[1]), SpiderGL.Math.pow(u[2], v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise conversion of a 3-dimensional vector from radians to degrees.\r\n *\r\n * @param {array} v The input vector, in degrees.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.pow}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.radToDeg = function (v) {\r\n\treturn [SpiderGL.Math.radToDeg(v[0]), SpiderGL.Math.radToDeg(v[1]), SpiderGL.Math.radToDeg(v[2])];\r\n}\r\n\r\n/**\r\n * Creates a random 3-dimensional vector between 0 and 1.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.random}().\r\n */\r\nSpiderGL.Math.Vec3.random = function () {\r\n\treturn [SpiderGL.Math.random(), SpiderGL.Math.random(), SpiderGL.Math.random()];\r\n}\r\n\r\n/**\r\n * Creates a random 3-dimensional vector between 0 and 1.\r\n * Same as {@link SpiderGL.Math.Vec3.random}.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.random01}().\r\n */\r\nSpiderGL.Math.Vec3.random01 = function () {\r\n\treturn [SpiderGL.Math.random01(), SpiderGL.Math.random01(), SpiderGL.Math.random01()];\r\n}\r\n\r\n/**\r\n * Creates a random 3-dimensional vector between -1 and 1.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.random11}().\r\n */\r\nSpiderGL.Math.Vec3.random11 = function () {\r\n\treturn [SpiderGL.Math.random11(), SpiderGL.Math.random11(), SpiderGL.Math.random11()];\r\n}\r\n\r\n/**\r\n * Creates a random 3-dimensional vector inside a range.\r\n *\r\n * @param {array} min The range vector lower bound.\r\n * @param {array} max The range vector upper bound.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.randomRange}(min[i], max[i]).\r\n */\r\nSpiderGL.Math.Vec3.randomRange = function (min, max) {\r\n\treturn [SpiderGL.Math.randomRange(min[0], max[0]), SpiderGL.Math.randomRange(min[1], max[1]), SpiderGL.Math.randomRange(min[2], max[2])];\r\n}\r\n\r\n/**\r\n * Component-wise round of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.round}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.round = function (v) {\r\n\treturn [SpiderGL.Math.round(v[0]), SpiderGL.Math.round(v[1]), SpiderGL.Math.round(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise sine of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.sin}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.sin = function (v) {\r\n\treturn [SpiderGL.Math.sin(v[0]), SpiderGL.Math.sin(v[1]), SpiderGL.Math.sin(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise square root of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.sqrt}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.sqrt = function (v) {\r\n\treturn [SpiderGL.Math.sqrt(v[0]), SpiderGL.Math.sqrt(v[1]), SpiderGL.Math.sqrt(v[2])];\r\n}\r\n\r\n/**\r\n * Component-wise tangent root of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 3-dimensional array r, where r[i] = {@link SpiderGL.Math.tan}(v[i]).\r\n */\r\nSpiderGL.Math.Vec3.tan = function (v) {\r\n\treturn [SpiderGL.Math.tan(v[0]), SpiderGL.Math.tan(v[1]), SpiderGL.Math.tan(v[2])];\r\n}\r\n\r\n/**\r\n * In-place component-wise copy of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The destination vector.\r\n * @param {array} v The source vector.\r\n *\r\n * @returns {array} The destination vector u, where u[i] = v[i].\r\n */\r\nSpiderGL.Math.Vec3.copy$ = function (u, v) {\r\n\tu[0] = v[0];\r\n\tu[1] = v[1];\r\n\tu[2] = v[2];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise negation of a 3-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = -v[i].\r\n */\r\nSpiderGL.Math.Vec3.neg$ = function (v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\tv[2] = -v[2];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise addition of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] + v[i].\r\n */\r\nSpiderGL.Math.Vec3.add$ = function (u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\tu[2] += v[2];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise addition of a 3-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector addition operand.\r\n * @param {number} s The scalar addition operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] + s.\r\n */\r\nSpiderGL.Math.Vec3.adds$ = function (v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] - v[i].\r\n */\r\nSpiderGL.Math.Vec3.sub$ = function (u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\tu[2] -= v[2];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of a 3-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector subtraction operand.\r\n * @param {number} s The scalar subtraction operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] - s.\r\n */\r\nSpiderGL.Math.Vec3.subs$ = function (v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\tv[2] -= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of a scalar and a 3-dimensional vector.\r\n *\r\n * @param {number} s The scalar subtraction operand\r\n * @param {array} v The vector subtraction operand.\r\n *\r\n * @returns {array} The input vector v, where v[i] = s - v[i].\r\n */\r\nSpiderGL.Math.Vec3.ssub$ = function (s, v) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\tv[2] = s - v[2];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise multiplication of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The first multiplication operand.\r\n * @param {array} v The second multiplication operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] * v[i].\r\n */\r\nSpiderGL.Math.Vec3.mul$ = function (u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\tu[2] *= v[2];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise multiplication of a 3-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The first multiplication operand.\r\n * @param {number} s The second multiplication operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] * s.\r\n */\r\nSpiderGL.Math.Vec3.muls$ = function (v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of two 3-dimensional vectors.\r\n *\r\n * @param {array} u The numerator vector.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] / v[i].\r\n */\r\nSpiderGL.Math.Vec3.div$ = function (u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\tu[2] /= v[2];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of a 3-dimensional vector by a scalar.\r\n *\r\n * @param {array} v The numerator vector.\r\n * @param {number} s The scalar denominator.\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] / s.\r\n */\r\nSpiderGL.Math.Vec3.divs$ = function (v, s) {\r\n\tv[0] /= s;\r\n\tv[1] /= s;\r\n\tv[2] /= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of a scalar by a 3-dimensional.\r\n *\r\n * @param {number} s The scalar numerator.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = s / v[i].\r\n */\r\nSpiderGL.Math.Vec3.sdiv$ = function (v, s) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\tv[2] = s / v[2];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place 3-dimensional vector normalization.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] / {@link SpiderGL.Math.Vec3.length}(v)\r\n */\r\nSpiderGL.Math.Vec3.normalize$ = function (v) {\r\n\tvar f = 1.0 / SpiderGL.Math.Vec3.length(v);\r\n\treturn SpiderGL.Math.Vec3.muls$(v, f);\r\n}\r\n\r\n/*---------------------------------------------------------*/\r\n\r\n\r\n\r\n// 4-dimensional vector\r\n/*---------------------------------------------------------*/\r\n\r\n/**\r\n * The SpiderGL.Math.Vec4 namespace.\r\n * The provided functions operate on 4-dimensional vectors, represented as standard JavaScript arrays of length 4.\r\n * In general, vectors are considered as column vectors.\r\n *\r\n * @namespace The SpiderGL.Math.Vec4 namespace defines operations on 4-dimensional vectors.\r\n */\r\nSpiderGL.Math.Vec4 = { };\r\n\r\n/**\r\n * Duplicates the input 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = v[i] (same as v.slice(0, 4)).\r\n */\r\nSpiderGL.Math.Vec4.dup = function (v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\n/**\r\n * Creates a 4-dimensional vector initialized with a scalar.\r\n *\r\n * @param {number} s The input scalar.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = s.\r\n */\r\nSpiderGL.Math.Vec4.scalar = function (s) {\r\n\treturn [s, s, s, s];\r\n}\r\n\r\n/**\r\n * Creates a 4-dimensional vector initialized with zero.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = 0.\r\n */\r\nSpiderGL.Math.Vec4.zero = function () {\r\n\treturn [0, 0, 0, 0];\r\n}\r\n\r\n/**\r\n * Creates a 4-dimensional vector initialized with one.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = 1.0.\r\n */\r\nSpiderGL.Math.Vec4.one = function () {\r\n\treturn [1, 1, 1, 1];\r\n}\r\n\r\n/**\r\n * Creates a 4-dimensional vector initialized with SpiderGL.Math.MAX_NUMBER.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = SpiderGL.Math.MAX_NUMBER.\r\n */\r\nSpiderGL.Math.Vec4.maxNumber = function () {\r\n\treturn [SpiderGL.Math.MAX_NUMBER, SpiderGL.Math.MAX_NUMBER, SpiderGL.Math.MAX_NUMBER, SpiderGL.Math.MAX_NUMBER];\r\n}\r\n\r\n/**\r\n * Creates a 4-dimensional vector initialized with SpiderGL.Math.MIN_NUMBER.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = SpiderGL.Math.MIN_NUMBER.\r\n */\r\nSpiderGL.Math.Vec4.minNumber = function () {\r\n\treturn [SpiderGL.Math.MIN_NUMBER, SpiderGL.Math.MIN_NUMBER, SpiderGL.Math.MIN_NUMBER, SpiderGL.Math.MIN_NUMBER];\r\n}\r\n\r\n/**\r\n * Creates a 2-dimensional vector from a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 2-dimensional array r equal to v with the 3rd and 4th components dropped.\r\n */\r\nSpiderGL.Math.Vec4.to2 = function (v) {\r\n\treturn [v[0], v[1]];\r\n}\r\n\r\n/**\r\n * Creates a 3-dimensional vector from a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 3-dimensional array r equal to v with the 4th component dropped.\r\n */\r\nSpiderGL.Math.Vec4.to3 = function (v) {\r\n\treturn [v[0], v[1], v[2]];\r\n}\r\n\r\n/**\r\n * Component-wise negation of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = -v[i].\r\n */\r\nSpiderGL.Math.Vec4.neg = function (v) {\r\n\treturn [-v[0], -v[1], -v[2], -v[3]];\r\n}\r\n\r\n/**\r\n * Component-wise addition of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = u[i] + v[i].\r\n */\r\nSpiderGL.Math.Vec4.add = function (u, v) {\r\n\treturn [u[0]+v[0], u[1]+v[1], u[2]+v[2], u[3]+v[3]];\r\n}\r\n\r\n/**\r\n * Component-wise addition of a 4-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector addition operand.\r\n * @param {number} s The scalar addition operand.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = v[i] + s.\r\n */\r\nSpiderGL.Math.Vec4.adds = function (v, s) {\r\n\treturn [v[0]+s, v[1]+s, v[2]+s, v[3]+s];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first subtraction operand.\r\n * @param {array} v The second subtraction operand.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = u[i] - v[i].\r\n */\r\nSpiderGL.Math.Vec4.sub = function (u, v) {\r\n\treturn [u[0]-v[0], u[1]-v[1], u[2]-v[2], u[3]-v[3]];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of a 4-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector subtraction operand.\r\n * @param {number} s The scalar subtraction operand.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = v[i] - s.\r\n */\r\nSpiderGL.Math.Vec4.subs = function (v, s) {\r\n\treturn [v[0]-s, v[1]-s, v[2]-s, v[3]-s];\r\n}\r\n\r\n/**\r\n * Component-wise subtraction of a scalar and a 4-dimensional.\r\n *\r\n * @param {number} s The scalar subtraction operand.\r\n * @param {array} v The vector subtraction operand.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = s - v[i].\r\n */\r\nSpiderGL.Math.Vec4.ssub = function (s, v) {\r\n\treturn [s-v[0], s-v[1], s-v[2], s-v[3]];\r\n}\r\n\r\n/**\r\n * Component-wise multiplication of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first multiplication operand.\r\n * @param {array} v The second multiplication operand.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = u[i] * v[i].\r\n */\r\nSpiderGL.Math.Vec4.mul = function (u, v) {\r\n\treturn [u[0]*v[0], u[1]*v[1], u[2]*v[2], u[3]*v[3]];\r\n}\r\n\r\n/**\r\n * Component-wise multiplication of a 4-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector multiplication operand.\r\n * @param {number} s The scalar multiplication operand.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = v[i] * s.\r\n */\r\nSpiderGL.Math.Vec4.muls = function (v, s) {\r\n\treturn [v[0]*s, v[1]*s, v[2]*s, v[3]*s];\r\n}\r\n\r\n/**\r\n * Component-wise division of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The numerator vector.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = u[i] / v[i].\r\n */\r\nSpiderGL.Math.Vec4.div = function (u, v) {\r\n\treturn [u[0]/v[0], u[1]/v[1], u[2]/v[2], u[3]/v[3]];\r\n}\r\n\r\n/**\r\n * Component-wise division of a 4-dimensional vector by a scalar.\r\n *\r\n * @param {array} v The numerator vector.\r\n * @param {number} s The scalar denominator.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = v[i] / s.\r\n */\r\nSpiderGL.Math.Vec4.divs = function (v, s) {\r\n\treturn [v[0]/s, v[1]/s, v[2]/s, v[3]/s];\r\n}\r\n\r\n/**\r\n * Component-wise division of a scalar by a 4-dimensional vector.\r\n *\r\n * @param {number} s The denominator scalar.\r\n * @param {array} v The numerator vector.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = s / v[i].\r\n */\r\nSpiderGL.Math.Vec4.sdiv = function (s, v) {\r\n\treturn [s/v[0], s/v[1], s/v[2], s/v[3]];\r\n}\r\n\r\n/**\r\n * Component-wise reciprocal of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input (denominator) vector.\r\n *\r\n * @returns {array} A new 4-dimensionals vector r, where r[i] = 1.0 / v[i].\r\n */\r\nSpiderGL.Math.Vec4.rcp = function (v) {\r\n\treturn [1.0/v[0], 1.0/v[1], 1.0/v[2], 1.0/v[3]];\r\n}\r\n\r\n/**\r\n * Dot product of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first vector operand.\r\n * @param {array} v The second vector operand.\r\n *\r\n * @returns {number} The dot product of u and v.\r\n */\r\nSpiderGL.Math.Vec4.dot = function (u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1] + u[2]*v[2] + u[3]*v[3]);\r\n}\r\n\r\n/**\r\n * Cross product of three 4-dimensional vectors.\r\n *\r\n * @param {array} u The first vector operand.\r\n * @param {array} v The second vector operand.\r\n * @param {array} w The third vector operand.\r\n *\r\n * @returns {array} A new 4-dimensional array equal to the cross product of u, v and w.\r\n */\r\nSpiderGL.Math.Vec4.cross = function (u, v, w) {\r\n\tvar a = v[0]*w[1] - v[1]*w[0];\r\n\tvar b = v[0]*w[2] - v[2]*w[0];\r\n\tvar c = v[0]*w[3] - v[3]*w[0];\r\n\tvar d = v[1]*w[2] - v[2]*w[1];\r\n\tvar e = v[1]*w[3] - v[3]*w[1];\r\n\tvar f = v[2]*w[3] - v[3]*w[2];\r\n\r\n\treturn [\r\n\t\tu[1]*f - u[2]*e + u[3]*d,\r\n\t\tu[0]*f + u[2]*c - u[3]*b,\r\n\t\tu[0]*e - u[1]*c + u[3]*a,\r\n\t\tu[0]*d + u[1]*b - u[2]*a\r\n\t];\r\n}\r\n\r\n/**\r\n * Squared length of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {number} The squared length of v, same as the dot product of v with itself.\r\n */\r\nSpiderGL.Math.Vec4.sqLength = function (v) {\r\n\treturn SpiderGL.Math.Vec4.dot(v, v);\r\n}\r\n\r\n/**\r\n * Length of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {number} The length of v.\r\n */\r\nSpiderGL.Math.Vec4.length = function (v) {\r\n\treturn SpiderGL.Math.sqrt(SpiderGL.Math.Vec4.sqLength(v));\r\n}\r\n\r\n/**\r\n * Creates a normalized 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r representing the normalized v, where r[i] = v[i] / {@link SpiderGL.Math.Vec4.length}(v).\r\n */\r\nSpiderGL.Math.Vec4.normalize = function (v) {\r\n\tvar f = 1.0 / SpiderGL.Math.Vec4.length(v);\r\n\treturn SpiderGL.Math.Vec4.muls(v, f);\r\n}\r\n\r\n/**\r\n * Projects a homogeneous 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = v[i] / v[3].\r\n */\r\nSpiderGL.Math.Vec4.project = function (v) {\r\n\tvar f = 1.0 / v[3];\r\n\treturn [v[0]*f, v[1]*f, v[2]*f, 1.0];\r\n}\r\n\r\n/**\r\n * Component-wise absolute value of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.abs}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.abs = function (v) {\r\n\treturn [SpiderGL.Math.abs(v[0]), SpiderGL.Math.abs(v[1]), SpiderGL.Math.abs(v[2]), SpiderGL.Math.abs(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise arccosine of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.acos}(v[i]), in radians.\r\n */\r\nSpiderGL.Math.Vec4.acos = function (v) {\r\n\treturn [SpiderGL.Math.acos(v[0]), SpiderGL.Math.acos(v[1]), SpiderGL.Math.acos(v[2]), SpiderGL.Math.acos(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise arcsine of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.asin}(v[i]), in radians.\r\n */\r\nSpiderGL.Math.Vec4.asin = function (v) {\r\n\treturn [SpiderGL.Math.asin(v[0]), SpiderGL.Math.asin(v[1]), SpiderGL.Math.asin(v[2]), SpiderGL.Math.asin(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise arctangent of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.atan}(v[i]), between -PI/2 and PI/2 radians.\r\n */\r\nSpiderGL.Math.Vec4.atan = function (v) {\r\n\treturn [SpiderGL.Math.atan(v[0]), SpiderGL.Math.atan(v[1]), SpiderGL.Math.atan(v[2]), SpiderGL.Math.atan(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise arctangent of the quotient of two 4-dimensional vectors.\r\n *\r\n * @param {array} y The numerator vector.\r\n * @param {array} x The denominator vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.atan2}(y[i], x[i]), between PI and -PI radians.\r\n */\r\nSpiderGL.Math.Vec4.atan2 = function (y, x) {\r\n\treturn [SpiderGL.Math.atan2(y[0], x[0]), SpiderGL.Math.atan2(y[1], x[1]), SpiderGL.Math.atan2(y[2], x[2]), SpiderGL.Math.atan2(y[3], x[3])];\r\n}\r\n\r\n/**\r\n * Component-wise ceil of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.ceil}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.ceil = function (v) {\r\n\treturn [SpiderGL.Math.ceil(v[0]), SpiderGL.Math.ceil(v[1]), SpiderGL.Math.ceil(v[2]), SpiderGL.Math.ceil(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise clamp of a 4-dimensional vector with vector bounds.\r\n *\r\n * @param {array} v The input vector.\r\n * @param {array} min The lower 4-dimensional bound.\r\n * @param {array} max The upper 4-dimensional bound.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.clamp}(v[i], min[i], max[i]).\r\n */\r\nSpiderGL.Math.Vec4.clamp = function (v, min, max) {\r\n\treturn [SpiderGL.Math.clamp(v[0], min[0], max[0]), SpiderGL.Math.clamp(v[1], min[1], max[1]), SpiderGL.Math.clamp(v[2], min[2], max[2]), SpiderGL.Math.clamp(v[3], min[3], max[3])];\r\n}\r\n\r\n/**\r\n * Component-wise cosine of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.cos}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.cos = function (v) {\r\n\treturn [SpiderGL.Math.cos(v[0]), SpiderGL.Math.cos(v[1]), SpiderGL.Math.cos(v[2]), SpiderGL.Math.cos(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise conversion of a 4-dimensional vector from degrees to radians.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.degToRad}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.degToRad = function (v) {\r\n\treturn [SpiderGL.Math.degToRad(v[0]), SpiderGL.Math.degToRad(v[1]), SpiderGL.Math.degToRad(v[2]), SpiderGL.Math.degToRad(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise exponential of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.exp}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.exp = function (v) {\r\n\treturn [SpiderGL.Math.exp(v[0]), SpiderGL.Math.exp(v[1]), SpiderGL.Math.exp(v[2]), SpiderGL.Math.exp(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise floor of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.floor}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.floor = function (v) {\r\n\treturn [SpiderGL.Math.floor(v[0]), SpiderGL.Math.floor(v[1]), SpiderGL.Math.floor(v[2]), SpiderGL.Math.floor(v[3])];\r\n}\r\n\r\n/**\r\n * Linear interpolation between two 4-dimensional vectors.\r\n *\r\n * @param {array} u The start interpolation bound.\r\n * @param {array} v The stop interpolation bound.\r\n * @param {number} t The interpolation factor, between 0 and 1.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = (1-t)*u[i] + t*v[i].\r\n */\r\nSpiderGL.Math.Vec4.lerp = function (u, v, t) {\r\n\treturn [\r\n\t\tSpiderGL.Math.lerp(u[0], v[0], t),\r\n\t\tSpiderGL.Math.lerp(u[1], v[1], t),\r\n\t\tSpiderGL.Math.lerp(u[2], v[2], t),\r\n\t\tSpiderGL.Math.lerp(u[3], v[3], t)\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise natural (base E) logarithm of a 4-dimensional vector.\r\n * Same as {@link SpiderGL.Math.Vec4.log}.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.ln}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.ln = function (v) {\r\n\treturn [SpiderGL.Math.ln(v[0]), SpiderGL.Math.ln(v[1]), SpiderGL.Math.ln(v[2]), SpiderGL.Math.ln(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise natural (base E) logarithm of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.log}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.log = function (v) {\r\n\treturn [SpiderGL.Math.log(v[0]), SpiderGL.Math.log(v[1]), SpiderGL.Math.log(v[2]), SpiderGL.Math.log(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise base 2 logarithm of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.log2}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.log2 = function (v) {\r\n\treturn [SpiderGL.Math.log2(v[0]), SpiderGL.Math.log2(v[1]), SpiderGL.Math.log2(v[2]), SpiderGL.Math.log2(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise base 10 logarithm of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.log10}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.log10 = function (v) {\r\n\treturn [SpiderGL.Math.log10(v[0]), SpiderGL.Math.log10(v[1]), SpiderGL.Math.log10(v[2]), SpiderGL.Math.log10(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise maximum of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first vector.\r\n * @param {array} v The second vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.max}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec4.max = function (u, v) {\r\n\treturn [SpiderGL.Math.max(u[0], v[0]), SpiderGL.Math.max(u[1], v[1]), SpiderGL.Math.max(u[2], v[2]), SpiderGL.Math.max(u[3], v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise minimum of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first vector.\r\n * @param {array} v The second vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.min}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec4.min = function (u, v) {\r\n\treturn [SpiderGL.Math.min(u[0], v[0]), SpiderGL.Math.min(u[1], v[1]), SpiderGL.Math.min(u[2], v[2]), SpiderGL.Math.min(u[3], v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise power of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The base vector.\r\n * @param {array} v The exponent vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.pow}(u[i], v[i]).\r\n */\r\nSpiderGL.Math.Vec4.pow = function (u, v) {\r\n\treturn [SpiderGL.Math.pow(u[0], v[0]), SpiderGL.Math.pow(u[1], v[1]), SpiderGL.Math.pow(u[2], v[2]), SpiderGL.Math.pow(u[3], v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise conversion of a 4-dimensional vector from radians to degrees.\r\n *\r\n * @param {array} v The input vector, in degrees.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.pow}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.radToDeg = function (v) {\r\n\treturn [SpiderGL.Math.radToDeg(v[0]), SpiderGL.Math.radToDeg(v[1]), SpiderGL.Math.radToDeg(v[2]), SpiderGL.Math.radToDeg(v[3])];\r\n}\r\n\r\n/**\r\n * Creates a random 4-dimensional vector between 0 and 1.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.random}().\r\n */\r\nSpiderGL.Math.Vec4.random = function () {\r\n\treturn [SpiderGL.Math.random(), SpiderGL.Math.random(), SpiderGL.Math.random(), SpiderGL.Math.random()];\r\n}\r\n\r\n/**\r\n * Creates a random 4-dimensional vector between 0 and 1.\r\n * Same as {@link SpiderGL.Math.Vec4.random}.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.random01}().\r\n */\r\nSpiderGL.Math.Vec4.random01 = function () {\r\n\treturn [SpiderGL.Math.random01(), SpiderGL.Math.random01(), SpiderGL.Math.random01(), SpiderGL.Math.random01()];\r\n}\r\n\r\n/**\r\n * Creates a random 4-dimensional vector between -1 and 1.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.random11}().\r\n */\r\nSpiderGL.Math.Vec4.random11 = function () {\r\n\treturn [SpiderGL.Math.random11(), SpiderGL.Math.random11(), SpiderGL.Math.random11(), SpiderGL.Math.random11()];\r\n}\r\n\r\n/**\r\n * Creates a random 4-dimensional vector inside a range.\r\n *\r\n * @param {array} min The range vector lower bound.\r\n * @param {array} max The range vector upper bound.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.randomRange}(min[i], max[i]).\r\n */\r\nSpiderGL.Math.Vec4.randomRange = function (min, max) {\r\n\treturn [SpiderGL.Math.randomRange(min[0], max[0]), SpiderGL.Math.randomRange(min[1], max[1]), SpiderGL.Math.randomRange(min[2], max[2]), SpiderGL.Math.randomRange(min[3], max[3])];\r\n}\r\n\r\n/**\r\n * Component-wise round of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.round}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.round = function (v) {\r\n\treturn [SpiderGL.Math.round(v[0]), SpiderGL.Math.round(v[1]), SpiderGL.Math.round(v[2]), SpiderGL.Math.round(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise sine of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.sin}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.sin = function (v) {\r\n\treturn [SpiderGL.Math.sin(v[0]), SpiderGL.Math.sin(v[1]), SpiderGL.Math.sin(v[2]), SpiderGL.Math.sin(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise square root of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.sqrt}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.sqrt = function (v) {\r\n\treturn [SpiderGL.Math.sqrt(v[0]), SpiderGL.Math.sqrt(v[1]), SpiderGL.Math.sqrt(v[2]), SpiderGL.Math.sqrt(v[3])];\r\n}\r\n\r\n/**\r\n * Component-wise tangent root of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector, in radians.\r\n *\r\n * @returns {array} A new 4-dimensional array r, where r[i] = {@link SpiderGL.Math.tan}(v[i]).\r\n */\r\nSpiderGL.Math.Vec4.tan = function (v) {\r\n\treturn [SpiderGL.Math.tan(v[0]), SpiderGL.Math.tan(v[1]), SpiderGL.Math.tan(v[2]), SpiderGL.Math.tan(v[3])];\r\n}\r\n\r\n/**\r\n * In-place component-wise copy of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The destination vector.\r\n * @param {array} v The source vector.\r\n *\r\n * @returns {array} The destination vector u, where u[i] = v[i].\r\n */\r\nSpiderGL.Math.Vec4.copy$ = function (u, v) {\r\n\tu[0] = v[0];\r\n\tu[1] = v[1];\r\n\tu[2] = v[2];\r\n\tu[3] = v[3];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise negation of a 4-dimensional vector.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = -v[i].\r\n */\r\nSpiderGL.Math.Vec4.neg$ = function (v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\tv[2] = -v[2];\r\n\tv[3] = -v[3];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise addition of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] + v[i].\r\n */\r\nSpiderGL.Math.Vec4.add$ = function (u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\tu[2] += v[2];\r\n\tu[3] += v[3];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise addition of a 4-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector addition operand.\r\n * @param {number} s The scalar addition operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] + s.\r\n */\r\nSpiderGL.Math.Vec4.adds$ = function (v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\tv[3] += s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first addition operand.\r\n * @param {array} v The second addition operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] - v[i].\r\n */\r\nSpiderGL.Math.Vec4.sub$ = function (u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\tu[2] -= v[2];\r\n\tu[3] -= v[3];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of a 4-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The vector subtraction operand.\r\n * @param {number} s The scalar subtraction operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] - s.\r\n */\r\nSpiderGL.Math.Vec4.subs$ = function (v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\tv[2] -= s;\r\n\tv[3] -= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise subtraction of a scalar and a 4-dimensional vector.\r\n *\r\n * @param {number} s The scalar subtraction operand\r\n * @param {array} v The vector subtraction operand.\r\n *\r\n * @returns {array} The input vector v, where v[i] = s - v[i].\r\n */\r\nSpiderGL.Math.Vec4.ssub$ = function (s, v) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\tv[2] = s - v[2];\r\n\tv[3] = s - v[3];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise multiplication of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The first multiplication operand.\r\n * @param {array} v The second multiplication operand\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] * v[i].\r\n */\r\nSpiderGL.Math.Vec4.mul$ = function (u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\tu[2] *= v[2];\r\n\tu[3] *= v[3];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise multiplication of a 4-dimensional vector and a scalar.\r\n *\r\n * @param {array} v The first multiplication operand.\r\n * @param {number} s The second multiplication operand\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] * s.\r\n */\r\nSpiderGL.Math.Vec4.muls$ = function (v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\tv[3] *= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of two 4-dimensional vectors.\r\n *\r\n * @param {array} u The numerator vector.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} The input vector u, where u[i] = u[i] / v[i].\r\n */\r\nSpiderGL.Math.Vec4.div$ = function (u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\tu[2] /= v[2];\r\n\tu[3] /= v[3];\r\n\treturn u;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of a 4-dimensional vector by a scalar.\r\n *\r\n * @param {array} v The numerator vector.\r\n * @param {number} s The scalar denominator.\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] / s.\r\n */\r\nSpiderGL.Math.Vec4.divs$ = function (v, s) {\r\n\tv[0] /= s;\r\n\tv[1] /= s;\r\n\tv[2] /= s;\r\n\tv[3] /= s;\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of a scalar by a 4-dimensional.\r\n *\r\n * @param {number} s The scalar numerator.\r\n * @param {array} v The denominator vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = s / v[i].\r\n */\r\nSpiderGL.Math.Vec4.sdiv$ = function (v, s) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\tv[2] = s / v[2];\r\n\tv[3] = s / v[3];\r\n\treturn v;\r\n}\r\n\r\n/**\r\n * In-place 4-dimensional vector normalization.\r\n *\r\n * @param {array} v The input vector.\r\n *\r\n * @returns {array} The input vector v, where v[i] = v[i] / {@link SpiderGL.Math.Vec4.length}(v)\r\n */\r\nSpiderGL.Math.Vec4.normalize$ = function (v) {\r\n\tvar f = 1.0 / SpiderGL.Math.Vec4.length(v);\r\n\treturn SpiderGL.Math.Vec4.muls$(v, f);\r\n}\r\n\r\n/*---------------------------------------------------------*/\r\n\r\n\r\n\r\n// 3x3 matrix\r\n/*---------------------------------------------------------*/\r\n\r\n/**\r\n * The SpiderGL.Math.Mat3 namespace.\r\n * The provided functions operate on 3x3 matrices, represented as standard JavaScript arrays of length 9.\r\n * In general, matrices are considered in column-major format.\r\n *\r\n * @namespace The SpiderGL.Math.Mat3 namespace defines operations on 3x3 matrices.\r\n */\r\nSpiderGL.Math.Mat3 = { };\r\n\r\n/**\r\n * Duplicates the input 3x3 matrix.\r\n *\r\n * @param {array} n The input matrix.\r\n *\r\n * @returns {array} A new 9-component array r, where r[i] = m[i] (same as m.slice(0, 9)).\r\n */\r\nSpiderGL.Math.Mat3.dup = function (m) {\r\n\treturn m.slice(0, 9);\r\n}\r\n\r\n/**\r\n * Creates a 3x3 matrix initialized with a scalar.\r\n *\r\n * @param {number} s The input scalar.\r\n *\r\n * @returns {array} A new 9-component array r, where r[i] = s.\r\n */\r\nSpiderGL.Math.Mat3.scalar = function (s) {\r\n\treturn [\r\n\t\ts, s, s,\r\n\t\ts, s, s,\r\n\t\ts, s, s\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a 3x3 matrix initialized with zero.\r\n *\r\n * @returns {array} A new 9-component array r, where r[i] = 0.\r\n */\r\nSpiderGL.Math.Mat3.zero = function () {\r\n\treturn [\r\n\t\t0, 0, 0,\r\n\t\t0, 0, 0,\r\n\t\t0, 0, 0\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a 3x3 matrix initialized with one.\r\n *\r\n * @returns {array} A new 9-component array r, where r[i] = 1.\r\n */\r\nSpiderGL.Math.Mat3.one = function () {\r\n\treturn [\r\n\t\t1, 1, 1,\r\n\t\t1, 1, 1,\r\n\t\t1, 1, 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a diagonal 3x3 matrix.\r\n *\r\n * @param {array} d A 3-dimensional vector\r\n *\r\n * @returns {array} A new 9-component array representing a 3x3 matrix with diagonal elements set to d.\r\n */\r\nSpiderGL.Math.Mat3.diag = function (d) {\r\n\treturn [\r\n\t\td[0],    0,    0,\r\n\t\t0,    d[0],    0,\r\n\t\t0,       0, d[0]\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates an identity 3x3 matrix.\r\n *\r\n * @returns {array} A new 9-component array representing an identity 3x3 matrix.\r\n */\r\nSpiderGL.Math.Mat3.identity = function () {\r\n\treturn [\r\n\t\t1, 0, 0,\r\n\t\t0, 1, 0,\r\n\t\t0, 0, 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Extends a 3x3 matrix to a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {array} A new 16-component array representing a 4x4 matrix r, with the input 3x3 matrix as tue upper-left 3x3 region with [0, 0, 0, 1] as last row and column.\r\n */\r\nSpiderGL.Math.Mat3.to44 = function (m) {\r\n\treturn [\r\n\t\tm[0], m[1], m[2], 0,\r\n\t\tm[3], m[4], m[5], 0,\r\n\t\tm[6], m[7], m[8], 0,\r\n\t\t   0,    0,    0, 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Pre-multiplies a 2-dimensional vector by a column-major 3x3 matrix.\r\n *\r\n * @param {array} m The input column-major 3x3 matrix.\r\n * @param {array} v The input 2-dimensional vector.\r\n * @param {number} [z=0] The 3rd component of the input 2-dimensional vector.\r\n *\r\n * @return {array} A new 2-dimensional vector r, where r = m * v.\r\n */\r\nSpiderGL.Math.Mat3.mul2 = function (m, v, z) {\r\n\tz = (z == undefined) ? (0) : (z);\r\n\treturn [\r\n\t\tm[0]*v[0] + m[3]*v[1] + m[6]*z,\r\n\t\tm[1]*v[0] + m[4]*v[1] + m[7]*z /* ,\r\n\t\tm[2]*v[0] + m[5]*v[1] + m[8]*z */\r\n\t];\r\n}\r\n\r\n/**\r\n * Pre-multiplies a 3-dimensional vector by a column-major 3x3 matrix.\r\n *\r\n * @param {array} m The input column-major 3x3 matrix.\r\n * @param {array} v The input 3-dimensional vector.\r\n *\r\n * @return {array} A new 3-dimensional vector r, where r = m * v.\r\n */\r\nSpiderGL.Math.Mat3.mul3 = function (m, v) {\r\n\treturn [\r\n\t\tm[0]*v[0] + m[3]*v[1] + m[6]*v[2],\r\n\t\tm[1]*v[0] + m[4]*v[1] + m[7]*v[2],\r\n\t\tm[2]*v[0] + m[5]*v[1] + m[8]*v[2]\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates the transpose of a 3x3 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {array} A new 3x3 matrix representing the transpose of m.\r\n */\r\nSpiderGL.Math.Mat3.transpose = function (m) {\r\n\treturn [\r\n\t\tm[0], m[3], m[6],\r\n\t\tm[1], m[4], m[7],\r\n\t\tm[2], m[5], m[8]\r\n\t];\r\n}\r\n/*---------------------------------------------------------*/\r\n\r\n\r\n\r\n// 4x4 matrix\r\n/*---------------------------------------------------------*/\r\n\r\n/**\r\n * The SpiderGL.Math.Mat4 namespace.\r\n * The provided functions operate on 4x4 matrices, represented as standard JavaScript arrays of length 16.\r\n * In general, matrices are considered in column-major format.\r\n *\r\n * @namespace The SpiderGL.Math.Mat4 namespace defines operations on 4x4 matrices.\r\n */\r\nSpiderGL.Math.Mat4 = { };\r\n\r\n/**\r\n * Duplicates the input 4x4 matrix.\r\n *\r\n * @param {array} n The input matrix.\r\n *\r\n * @returns {array} A new 16-component array r, where r[i] = m[i] (same as m.slice(0, 16)).\r\n */\r\nSpiderGL.Math.Mat4.dup = function (m) {\r\n\treturn m.slice(0, 16);\r\n}\r\n\r\n/**\r\n * Creates a 4x4 matrix initialized with a scalar.\r\n *\r\n * @param {number} s The input scalar.\r\n *\r\n * @returns {array} A new 16-component array r, where r[i] = s.\r\n */\r\nSpiderGL.Math.Mat4.scalar = function (s) {\r\n\treturn [\r\n\t\ts, s, s, s,\r\n\t\ts, s, s, s,\r\n\t\ts, s, s, s,\r\n\t\ts, s, s, s\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a 4x4 matrix initialized with zero.\r\n *\r\n * @returns {array} A new 16-component array r, where r[i] = 0.\r\n */\r\nSpiderGL.Math.Mat4.zero = function () {\r\n\treturn [\r\n\t\t0, 0, 0, 0,\r\n\t\t0, 0, 0, 0,\r\n\t\t0, 0, 0, 0,\r\n\t\t0, 0, 0, 0\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a 4x4 matrix initialized with one.\r\n *\r\n * @returns {array} A new 16-component array r, where r[i] = 1.\r\n */\r\nSpiderGL.Math.Mat4.one = function () {\r\n\treturn [\r\n\t\t1, 1, 1, 1,\r\n\t\t1, 1, 1, 1,\r\n\t\t1, 1, 1, 1,\r\n\t\t1, 1, 1, 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a diagonal 4x4 matrix.\r\n *\r\n * @param {array} d A 4-dimensional vector\r\n *\r\n * @returns {array} A new 16-component array representing a 4x4 matrix with diagonal elements set to d.\r\n */\r\nSpiderGL.Math.Mat4.diag = function (d) {\r\n\treturn [\r\n\t\td[0],    0,    0,    0,\r\n\t\t0,    d[0],    0,    0,\r\n\t\t0,       0, d[0],    0,\r\n\t\t0,       0,    0, d[0]\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates an identity 4x4 matrix.\r\n *\r\n * @returns {array} A new 16-component array representing an identity 4x4 matrix.\r\n */\r\nSpiderGL.Math.Mat4.identity = function () {\r\n\treturn [\r\n\t\t1, 0, 0, 0,\r\n\t\t0, 1, 0, 0,\r\n\t\t0, 0, 1, 0,\r\n\t\t0, 0, 0, 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Extracts the upper-left 3x3 matrix from a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {array} A new 9-component array representing the upper-left 3x3 matrix.\r\n */\r\nSpiderGL.Math.Mat4.to33 = function (m) {\r\n\treturn [\r\n\t\tm[ 0], m[ 1], m[ 2],\r\n\t\tm[ 4], m[ 5], m[ 6],\r\n\t\tm[ 8], m[ 9], m[10]\r\n\t];\r\n}\r\n\r\n/**\r\n * Gets an element of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n * @param {number} row The element row index.\r\n * @param {number} col The element column index.\r\n *\r\n * @returns {number} The value of the (i-th, j-th) element of m.\r\n */\r\nSpiderGL.Math.Mat4.elem = function (m, row, col) {\r\n\treturn m[row+col*4];\r\n}\r\n\r\n/**\r\n * Sets an element of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n * @param {number} row The element row index.\r\n * @param {number} col The element column index.\r\n * @param {number} value The element value to set.\r\n */\r\nSpiderGL.Math.Mat4.elem$ = function (m, row, col, value) {\r\n\tm[row+col*4] = value;\r\n}\r\n\r\n/**\r\n * Gets a row of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n * @param {number} row The row index.\r\n *\r\n * @returns {array} A new 4-component array representing the row-th row of m.\r\n */\r\nSpiderGL.Math.Mat4.row = function (m, row) {\r\n\treturn [m[row+0], m[row+4], m[row+8], m[row+12]];\r\n}\r\n\r\n/**\r\n * Sets a row of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n * @param {number} row The row index.\r\n * @param {array} v A 4-component array that will be copied to the row-th row of m.\r\n */\r\nSpiderGL.Math.Mat4.row$ = function (m, row, v) {\r\n\tm[row+ 0] = v[0];\r\n\tm[row+ 4] = v[1];\r\n\tm[row+ 8] = v[2];\r\n\tm[row+12] = v[3];\r\n}\r\n\r\n/**\r\n * Gets a column of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n * @param {number} col The column index.\r\n *\r\n * @returns {array} A new 4-component array representing the col-th column of m.\r\n */\r\nSpiderGL.Math.Mat4.col = function (m, col) {\r\n\tvar i = col * 4;\r\n\treturn [m[i+0], m[i+1], m[i+2], m[i+3]];\r\n}\r\n\r\n/**\r\n * Sets a column of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n * @param {number} col The column index.\r\n * @param {array} v A 4-component array that will be copied to the col-th column of m.\r\n */\r\nSpiderGL.Math.Mat4.col$ = function (m, col, v) {\r\n\tvar i = col * 4;\r\n\tm[i+0] = v[0];\r\n\tm[i+1] = v[1];\r\n\tm[i+2] = v[2];\r\n\tm[i+3] = v[3];\r\n}\r\n\r\n/**\r\n * Tests whether a 4x4 matrix is the identity matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @return {bool} True if the input matrix is the identity matrix, false otherwise.\r\n */\r\nSpiderGL.Math.Mat4.isIdentity = function (m) {\r\n\treturn ((m[ 0] === 1) && (m[ 1] === 0) && (m[ 2] === 0) && (m[ 3] === 0) &&\r\n\t        (m[ 4] === 0) && (m[ 5] === 1) && (m[ 6] === 0) && (m[ 7] === 0) &&\r\n\t        (m[ 8] === 0) && (m[ 9] === 0) && (m[10] === 1) && (m[11] === 0) &&\r\n\t        (m[12] === 0) && (m[13] === 0) && (m[14] === 0) && (m[15] === 1));\r\n}\r\n\r\n/**\r\n * Component-wise negation of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @return {array} A new 4x4 matrix r, where r[i] = -m[i].\r\n */\r\nSpiderGL.Math.Mat4.neg = function (m) {\r\n\treturn [\r\n\t\t-m[ 0], -m[ 1], -m[ 2], -m[ 3],\r\n\t\t-m[ 4], -m[ 5], -m[ 6], -m[ 7],\r\n\t\t-m[ 8], -m[ 9], -m[10], -m[11],\r\n\t\t-m[12], -m[13], -m[14], -m[15]\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise addition of two 4x4 matrices.\r\n *\r\n * @param {array} a The first input matrix.\r\n * @param {array} b The first input matrix.\r\n *\r\n * @return {array} A new 4x4 matrix r, where r[i] = a[i] + b[i].\r\n */\r\nSpiderGL.Math.Mat4.add = function (a, b) {\r\n\treturn [\r\n\t\ta[ 0]+b[ 0], a[ 1]+b[ 1], a[ 2]+b[ 2], a[ 3]+b[ 3],\r\n\t\ta[ 4]+b[ 4], a[ 5]+b[ 5], a[ 6]+b[ 6], a[ 7]+b[ 7],\r\n\t\ta[ 8]+b[ 8], a[ 9]+b[ 9], a[10]+b[10], a[11]+b[11],\r\n\t\ta[12]+b[12], a[13]+b[13], a[14]+b[14], a[15]+b[15]\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise addition of two 4x4 matrices.\r\n *\r\n * @param {array} a The first input matrix.\r\n * @param {array} b The first input matrix.\r\n *\r\n * @return {array} A new 4x4 matrix r, where r[i] = a[i] - b[i].\r\n */\r\nSpiderGL.Math.Mat4.sub = function (a, b) {\r\n\treturn [\r\n\t\ta[ 0]-b[ 0], a[ 1]-b[ 1], a[ 2]-b[ 2], a[ 3]-b[ 3],\r\n\t\ta[ 4]-b[ 4], a[ 5]-b[ 5], a[ 6]-b[ 6], a[ 7]-b[ 7],\r\n\t\ta[ 8]-b[ 8], a[ 9]-b[ 9], a[10]-b[10], a[11]-b[11],\r\n\t\ta[12]-b[12], a[13]-b[13], a[14]-b[14], a[15]-b[15]\r\n\t];\r\n}\r\n\r\n/**\r\n * Multiplies of two column-major 4x4 matrices.\r\n *\r\n * @param {array} a The first input matrix.\r\n * @param {array} b The first input matrix.\r\n *\r\n * @return {array} A new 4x4 matrix r, result of matrix multiplication r = a * b.\r\n */\r\nSpiderGL.Math.Mat4.mul = function (a, b) {\r\n\tvar a0  = a[ 0], a1  = a[ 1],  a2 = a[ 2], a3  = a[ 3],\r\n\t    a4  = a[ 4], a5  = a[ 5],  a6 = a[ 6], a7  = a[ 7],\r\n\t    a8  = a[ 8], a9  = a[ 9], a10 = a[10], a11 = a[11],\r\n\t    a12 = a[12], a13 = a[13], a14 = a[14], a15 = a[15],\r\n\r\n\t    b0  = b[ 0], b1  = b[ 1], b2  = b[ 2], b3  = b[ 3],\r\n\t    b4  = b[ 4], b5  = b[ 5], b6  = b[ 6], b7  = b[ 7],\r\n\t    b8  = b[ 8], b9  = b[ 9], b10 = b[10], b11 = b[11],\r\n\t    b12 = b[12], b13 = b[13], b14 = b[14], b15 = b[15];\r\n\r\n\treturn [\r\n\t\ta0*b0  + a4*b1  + a8*b2   + a12*b3,\r\n\t\ta1*b0  + a5*b1  + a9*b2   + a13*b3,\r\n\t\ta2*b0  + a6*b1  + a10*b2  + a14*b3,\r\n\t\ta3*b0  + a7*b1  + a11*b2  + a15*b3,\r\n\r\n\t\ta0*b4  + a4*b5  + a8*b6   + a12*b7,\r\n\t\ta1*b4  + a5*b5  + a9*b6   + a13*b7,\r\n\t\ta2*b4  + a6*b5  + a10*b6  + a14*b7,\r\n\t\ta3*b4  + a7*b5  + a11*b6  + a15*b7,\r\n\r\n\t\ta0*b8  + a4*b9  + a8*b10  + a12*b11,\r\n\t\ta1*b8  + a5*b9  + a9*b10  + a13*b11,\r\n\t\ta2*b8  + a6*b9  + a10*b10 + a14*b11,\r\n\t\ta3*b8  + a7*b9  + a11*b10 + a15*b11,\r\n\r\n\t\ta0*b12 + a4*b13 + a8*b14  + a12*b15,\r\n\t\ta1*b12 + a5*b13 + a9*b14  + a13*b15,\r\n\t\ta2*b12 + a6*b13 + a10*b14 + a14*b15,\r\n\t\ta3*b12 + a7*b13 + a11*b14 + a15*b15\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise multiplication of a 4x4 matrix and a scalar.\r\n *\r\n * @param {array} m The matrix operand.\r\n * @param {number} s The scalar operand.\r\n *\r\n * @returns {array} A new 4x4 matrix r, where r[i] = m[i] * s.\r\n */\r\nSpiderGL.Math.Mat4.muls = function (m, s) {\r\n\treturn [\r\n\t\tm[ 0]*s, m[ 1]*s, m[ 2]*s, m[ 3]*s,\r\n\t\tm[ 4]*s, m[ 5]*s, m[ 6]*s, m[ 7]*s,\r\n\t\tm[ 8]*s, m[ 9]*s, m[10]*s, m[11]*s,\r\n\t\tm[12]*s, m[13]*s, m[14]*s, m[15]*s\r\n\t];\r\n}\r\n\r\n/**\r\n * Pre-multiplies a 3-dimensional vector by a column-major 4x4 matrix.\r\n *\r\n * @param {array} m The input column-major 4x4 matrix.\r\n * @param {array} v The input 3-dimensional vector.\r\n * @param {number} [w=1] The 4th component of the input 3-dimensional vector.\r\n *\r\n * @return {array} A new 3-dimensional vector r, where r = m * v.\r\n */\r\nSpiderGL.Math.Mat4.mul3 = function (m, v, w) {\r\n\tw = (w == undefined) ? (1) : (w);\r\n\treturn [\r\n\t\tm[ 0]*v[0] + m[ 4]*v[1] + m[ 8]*v[2] + m[12]*w,\r\n\t\tm[ 1]*v[0] + m[ 5]*v[1] + m[ 9]*v[2] + m[13]*w,\r\n\t\tm[ 2]*v[0] + m[ 6]*v[1] + m[10]*v[2] + m[14]*w /* ,\r\n\t\tm[ 3]*v[0] + m[ 7]*v[1] + m[11]*v[2] + m[15]*w */\r\n\t];\r\n}\r\n\r\n/**\r\n * Pre-multiplies a 4-dimensional vector by a column-major 4x4 matrix.\r\n *\r\n * @param {array} m The input column-major 4x4 matrix.\r\n * @param {array} v The input 4-dimensional vector.\r\n *\r\n * @return {array} A new 4-dimensional vector r, where r = m * v.\r\n */\r\nSpiderGL.Math.Mat4.mul4 = function (m, v) {\r\n\treturn [\r\n\t\tm[ 0]*v[0] + m[ 4]*v[1] + m[ 8]*v[2] + m[12]*v[3],\r\n\t\tm[ 1]*v[0] + m[ 5]*v[1] + m[ 9]*v[2] + m[13]*v[3],\r\n\t\tm[ 2]*v[0] + m[ 6]*v[1] + m[10]*v[2] + m[14]*v[3],\r\n\t\tm[ 3]*v[0] + m[ 7]*v[1] + m[11]*v[2] + m[15]*v[3]\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise reciprocal of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {array} A new 4x4 matrix r, where r[i] = 1 / m[i].\r\n */\r\nSpiderGL.Math.Mat4.rcp = function (m) {\r\n\treturn [\r\n\t\t1/m[ 0], 1/m[ 1], 1/m[ 2], 1/m[ 3],\r\n\t\t1/m[ 4], 1/m[ 5], 1/m[ 6], 1/m[ 7],\r\n\t\t1/m[ 8], 1/m[ 9], 1/m[10], 1/m[11],\r\n\t\t1/m[12], 1/m[13], 1/m[14], 1/m[15]\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise multiplication of two 4x4 matrices.\r\n *\r\n * @param {array} a The first matrix.\r\n * @param {array} b The second matrix.\r\n *\r\n * @returns {array} A new 4x4 matrix r, where r[i] = a[i] * b[i].\r\n */\r\nSpiderGL.Math.Mat4.compMul = function (a, b) {\r\n\treturn [\r\n\t\ta[ 0]*b[ 0], a[ 1]*b[ 1], a[ 2]*b[ 2], a[ 3]*b[ 3],\r\n\t\ta[ 4]*b[ 4], a[ 5]*b[ 5], a[ 6]*b[ 6], a[ 7]*b[ 7],\r\n\t\ta[ 8]*b[ 8], a[ 9]*b[ 9], a[10]*b[10], a[11]*b[11],\r\n\t\ta[12]*b[12], a[13]*b[13], a[14]*b[14], a[15]*b[15]\r\n\t];\r\n}\r\n\r\n/**\r\n * Component-wise division of two 4x4 matrices.\r\n *\r\n * @param {array} a The first matrix.\r\n * @param {array} b The second matrix.\r\n *\r\n * @returns {array} A new 4x4 matrix r, where r[i] = a[i] / b[i].\r\n */\r\nSpiderGL.Math.Mat4.compDiv = function (a, b) {\r\n\treturn [\r\n\t\ta[ 0]/b[ 0], a[ 1]/b[ 1], a[ 2]/b[ 2], a[ 3]/b[ 3],\r\n\t\ta[ 4]/b[ 4], a[ 5]/b[ 5], a[ 6]/b[ 6], a[ 7]/b[ 7],\r\n\t\ta[ 8]/b[ 8], a[ 9]/b[ 9], a[10]/b[10], a[11]/b[11],\r\n\t\ta[12]/b[12], a[13]/b[13], a[14]/b[14], a[15]/b[15]\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates the transpose of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {array} A new 4x4 matrix representing the transpose of m.\r\n */\r\nSpiderGL.Math.Mat4.transpose = function (m) {\r\n\treturn [\r\n\t\tm[ 0], m[ 4], m[ 8], m[12],\r\n\t\tm[ 1], m[ 5], m[ 9], m[13],\r\n\t\tm[ 2], m[ 6], m[10], m[14],\r\n\t\tm[ 3], m[ 7], m[11], m[15]\r\n\t];\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {number} The determinant of m.\r\n */\r\nSpiderGL.Math.Mat4.determinant = function (m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15];\r\n\r\n\treturn (m12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t        m8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t        m12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t        m12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t        m4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t        m8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15);\r\n}\r\n\r\n/**\r\n * Calculates the inverse of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {array} A new 4x4 matrix representing the inverse of m.\r\n */\r\nSpiderGL.Math.Mat4.inverse = function (m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15];\r\n\r\n\tvar d = 1 / (\r\n\t\tm12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t\tm8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t\tm12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t\tm12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t\tm4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t\tm8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15);\r\n\r\n\treturn [\r\n\t\td * (m9*m14*m7-m13*m10*m7+m13*m6*m11-m5*m14*m11-m9*m6*m15+m5*m10*m15),\r\n\t\td * (m13*m10*m3-m9*m14*m3-m13*m2*m11+m1*m14*m11+m9*m2*m15-m1*m10*m15),\r\n\t\td * (m5*m14*m3-m13*m6*m3+m13*m2*m7-m1*m14*m7-m5*m2*m15+m1*m6*m15),\r\n\t\td * (m9*m6*m3-m5*m10*m3-m9*m2*m7+m1*m10*m7+m5*m2*m11-m1*m6*m11),\r\n\r\n\t\td * (m12*m10*m7-m8*m14*m7-m12*m6*m11+m4*m14*m11+m8*m6*m15-m4*m10*m15),\r\n\t\td * (m8*m14*m3-m12*m10*m3+m12*m2*m11-m0*m14*m11-m8*m2*m15+m0*m10*m15),\r\n\t\td * (m12*m6*m3-m4*m14*m3-m12*m2*m7+m0*m14*m7+m4*m2*m15-m0*m6*m15),\r\n\t\td * (m4*m10*m3-m8*m6*m3+m8*m2*m7-m0*m10*m7-m4*m2*m11+m0*m6*m11),\r\n\r\n\t\td * (m8*m13*m7-m12*m9*m7+m12*m5*m11-m4*m13*m11-m8*m5*m15+m4*m9*m15),\r\n\t\td * (m12*m9*m3-m8*m13*m3-m12*m1*m11+m0*m13*m11+m8*m1*m15-m0*m9*m15),\r\n\t\td * (m4*m13*m3-m12*m5*m3+m12*m1*m7-m0*m13*m7-m4*m1*m15+m0*m5*m15),\r\n\t\td * (m8*m5*m3-m4*m9*m3-m8*m1*m7+m0*m9*m7+m4*m1*m11-m0*m5*m11),\r\n\r\n\t\td * (m12*m9*m6-m8*m13*m6-m12*m5*m10+m4*m13*m10+m8*m5*m14-m4*m9*m14),\r\n\t\td * (m8*m13*m2-m12*m9*m2+m12*m1*m10-m0*m13*m10-m8*m1*m14+m0*m9*m14),\r\n\t\td * (m12*m5*m2-m4*m13*m2-m12*m1*m6+m0*m13*m6+m4*m1*m14-m0*m5*m14),\r\n\t\td * (m4*m9*m2-m8*m5*m2+m8*m1*m6-m0*m9*m6-m4*m1*m10+m0*m5*m10)\r\n\t];\r\n}\r\n\r\n/**\r\n * Calculates the inverse transpose of the upper-left 3x3 matrix of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {array} A new 3x3 matrix representing the inverse transpose of the upper-left 3x3 matrix of m.\r\n */\r\nSpiderGL.Math.Mat4.inverseTranspose33 = function (m) {\r\n\tvar m11 = m[ 0], m21 = m[ 1], m31 = m[ 2],\r\n\t    m12 = m[ 4], m22 = m[ 5], m32 = m[ 6],\r\n\t    m13 = m[ 8], m23 = m[ 9], m33 = m[10];\r\n\r\n\tvar d =  1 / (m11*(m33*m22 - m32*m23) - m21*(m33*m12 - m32*m13) + m31*(m23*m12 - m22*m13));\r\n\r\n\treturn [\r\n\t\td * (m33*m22 - m32*m23), d * (m32*m13 - m33*m12), d * (m23*m12 - m22*m13),\r\n\t\td * (m31*m23 - m33*m21), d * (m33*m11 - m31*m13), d * (m21*m13 - m23*m11),\r\n\t\td * (m32*m21 - m31*m22), d * (m31*m12 - m32*m11), d * (m22*m11 - m21*m12)\r\n\t];\r\n}\r\n\r\n/**\r\n * Calculates the trace (i.e. the sum of the diagonal elements) of a 4x4 matrix.\r\n *\r\n * @param {array} m The input matrix.\r\n *\r\n * @returns {number} The trace of m.\r\n */\r\nSpiderGL.Math.Mat4.trace = function (m) {\r\n\treturn (m[0] + m[5] + m[10] + m[15]);\r\n}\r\n\r\n/**\r\n * Creates a column-major 4x4 translation matrix.\r\n * The input translation vector will be placed on the 4th column of an identity matrix.\r\n *\r\n * @param {array} v A 3-dimensional vector with translation offsets.\r\n *\r\n * @returns {array} A new column-major 4x4 translation matrix.\r\n */\r\nSpiderGL.Math.Mat4.translation = function (v) {\r\n\treturn [\r\n\t\t   1,    0,    0, 0,\r\n\t\t   0,    1,    0, 0,\r\n\t\t   0,    0,    1, 0,\r\n\t\tv[0], v[1], v[2], 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a column-major 4x4 rotation matrix.\r\n * The returned matrix will represent a counter-clockwise rotation about the input axis by the input angle in radians.\r\n * The input axis need not to be normalized.\r\n *\r\n * @param {number} angle The counter-clockwise rotation angle, in radians.\r\n * @param {array} axis A 3-dimensional vector representing the rotation axis.\r\n *\r\n * @returns {array} A new column-major 4x4 rotation matrix.\r\n */\r\nSpiderGL.Math.Mat4.rotationAngleAxis = function (angle, axis) {\r\n\tvar ax = SpiderGL.Math.Vec3.normalize(axis);\r\n\tvar s  = SpiderGL.Math.sin(angle);\r\n\tvar c  = SpiderGL.Math.cos(angle);\r\n\tvar q   = 1 - c;\r\n\r\n\tvar x = ax[0];\r\n\tvar y = ax[1];\r\n\tvar z = ax[2];\r\n\r\n\tvar xx, yy, zz, xy, yz, zx, xs, ys, zs;\r\n\r\n\txx = x * x;\r\n\tyy = y * y;\r\n\tzz = z * z;\r\n\txy = x * y;\r\n\tyz = y * z;\r\n\tzx = z * x;\r\n\txs = x * s;\r\n\tys = y * s;\r\n\tzs = z * s;\r\n\r\n\treturn [\r\n\t\t(q * xx) + c,  (q * xy) + zs, (q * zx) - ys, 0,\r\n\t\t(q * xy) - zs, (q * yy) + c,  (q * yz) + xs, 0,\r\n\t\t(q * zx) + ys, (q * yz) - xs, (q * zz) + c,  0,\r\n\t\t            0,             0,            0,  1\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a column-major 4x4 scaling matrix.\r\n *\r\n * @param {array} v The scaling amount as a 3-dimensional array.\r\n *\r\n * @returns {array} A new column-major 4x4 scaling matrix.\r\n */\r\nSpiderGL.Math.Mat4.scaling = function (v) {\r\n\treturn [\r\n\t\tv[0],    0,    0, 0,\r\n\t\t   0, v[1],    0, 0,\r\n\t\t   0,    0, v[2], 0,\r\n\t\t   0,    0,    0, 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a column-major 4x4 look-at matrix.\r\n *\r\n * @param {array} position The viewer's position as a 3-dimensional vector.\r\n * @param {array} target The viewer's look-at point as a 3-dimensional vector.\r\n * @param {array} position The viewer's up vector as a 3-dimensional vector.\r\n *\r\n * @returns {array} A new column-major 4x4 look-at matrix.\r\n */\r\nSpiderGL.Math.Mat4.lookAt = function (position, target, up) {\r\n\tvar v = SpiderGL.Math.Vec3.normalize(SpiderGL.Math.Vec3.sub(target, position));\r\n\tvar u = SpiderGL.Math.Vec3.normalize(up);\r\n\tvar s = SpiderGL.Math.Vec3.normalize(SpiderGL.Math.Vec3.cross(v, u));\r\n\r\n\tu = SpiderGL.Math.Vec3.cross(s, v);\r\n\r\n\tvar m = [\r\n\t\t s[0], u[0], -v[0], 0,\r\n\t\t s[1], u[1], -v[1], 0,\r\n\t\t s[2], u[2], -v[2], 0,\r\n\t\t    0,    0,    0,  1\r\n\t];\r\n\r\n\treturn SpiderGL.Math.Mat4.translate$(m, SpiderGL.Math.Vec3.neg(position));\r\n}\r\n\r\n/**\r\n * Creates a column-major 4x4 orthographic projection matrix.\r\n *\r\n * @param {array} min A 3-component array with the minimum coordinates of the parallel viewing volume.\r\n * @param {array} max A 3-component array with the maximum coordinates of the parallel viewing volume.\r\n *\r\n * @returns {array} A new column-major 4x4 orthographic projection matrix.\r\n */\r\nSpiderGL.Math.Mat4.ortho = function (min, max) {\r\n\tvar sum = SpiderGL.Math.Vec3.add(max, min);\r\n\tvar dif = SpiderGL.Math.Vec3.sub(max, min);\r\n\r\n\treturn [\r\n\t\t     2 / dif[0],                 0,           0,      0,\r\n\t\t               0,       2 / dif[1],           0,      0,\r\n\t\t               0,                0, -2 / dif[2],      0,\r\n\t\t-sum[0] / dif[0], -sum[1] / dif[1], -sum[2] / dif[2], 1\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a column-major 4x4 frustum matrix.\r\n *\r\n * @param {array} min A 3-component array with the minimum coordinates of the frustum volume.\r\n * @param {array} max A 3-component array with the maximum coordinates of the frustum volume.\r\n *\r\n * @returns {array} A new column-major 4x4 frustum matrix.\r\n */\r\nSpiderGL.Math.Mat4.frustum = function (min, max) {\r\n\tvar sum = SpiderGL.Math.Vec3.add(max, min);\r\n\tvar dif = SpiderGL.Math.Vec3.sub(max, min);\r\n\tvar t   = 2.0 * min[2];\r\n\r\n\treturn [\r\n\t\t     t / dif[0],               0,                     0,  0,\r\n\t\t              0,      t / dif[1],                     0,  0,\r\n\t\tsum[0] / dif[0], sum[1] / dif[1],      -sum[2] / dif[2], -1,\r\n\t\t              0,               0, -t *  max[2] / dif[2],  0\r\n\t];\r\n}\r\n\r\n/**\r\n * Creates a column-major 4x4 perspective projection matrix.\r\n *\r\n * @param {number} fovY The vertical field-of-view angle, in radians.\r\n * @param {number} aspectRatio The projection plane aspect ratio.\r\n * @param {number} zNear The distance of the near clipping plane.\r\n * @param {number} zFar The distance of the far clipping plane.\r\n *\r\n * @returns {array} A new column-major 4x4 perspective projection matrix.\r\n */\r\nSpiderGL.Math.Mat4.perspective = function (fovY, aspectRatio, zNear, zFar) {\r\n\tvar a = zNear * SpiderGL.Math.tan(fovY / 2);\r\n\tvar b = a * aspectRatio;\r\n\r\n\treturn SpiderGL.Math.Mat4.frustum([-b, -a, zNear], [b, a, zFar]);\r\n}\r\n\r\n/**\r\n * Copies a 4x4 matrix.\r\n *\r\n * @param {array} dst The destination 4x4 matrix.\r\n * @param {array} src The source 4x4 matrix.\r\n *\r\n * @returns {array} The input matrix dst, where dst[i] = src[i].\r\n */\r\nSpiderGL.Math.Mat4.copy$ = function (dst, src) {\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tdst[i] = src[i];\r\n\t}\r\n\treturn dst;\r\n}\r\n\r\n/**\r\n * Sets a 4x4 matrix as the identity matrix.\r\n *\r\n * @param {array} m The input 4x4 matrix to be set as identity.\r\n *\r\n * @returns {array} The input matrix m.\r\n */\r\nSpiderGL.Math.Mat4.identity$ = function (m) {\r\n\tm[ 0] = 1; m[ 1] = 0; m[ 2] = 0; m[ 3] = 0;\r\n\tm[ 4] = 0; m[ 5] = 1; m[ 6] = 0; m[ 7] = 0;\r\n\tm[ 8] = 0; m[ 9] = 0; m[10] = 1; m[11] = 0;\r\n\tm[12] = 0; m[13] = 0; m[14] = 0; m[15] = 1;\r\n\treturn m;\r\n}\r\n\r\n/**\r\n * In-place negation of a 4x4 matrix.\r\n *\r\n * @param {array} m The input 4x4 matrix.\r\n *\r\n * @returns {array} The input matrix m, where m[i] = -m[i].\r\n */\r\nSpiderGL.Math.Mat4.neg$ = function (m) {\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tm[i] = -m[i];\r\n\t}\r\n\treturn m;\r\n}\r\n\r\n/**\r\n * In-place addition of two 4x4 matrices.\r\n *\r\n * @param {array} a The first 4x4 input matrix.\r\n * @param {array} b The second 4x4 input matrix.\r\n *\r\n * @returns {array} The input matrix a, where a[i] = a[i] + b[i].\r\n */\r\nSpiderGL.Math.Mat4.add$ = function (a, b) {\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\ta[i] += b[i];\r\n\t}\r\n\treturn a;\r\n}\r\n\r\n/**\r\n * In-place subtraction of two 4x4 matrices.\r\n *\r\n * @param {array} a The first 4x4 input matrix.\r\n * @param {array} b The second 4x4 input matrix.\r\n *\r\n * @returns {array} The input matrix a, where a[i] = a[i] - b[i].\r\n */\r\nSpiderGL.Math.Mat4.sub$ = function (a, b) {\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\ta[i] -= b[i];\r\n\t}\r\n\treturn a;\r\n}\r\n\r\n/**\r\n * In-place multiplication of two 4x4 matrices.\r\n *\r\n * @param {array} a The first 4x4 input matrix.\r\n * @param {array} b The second 4x4 input matrix.\r\n *\r\n * @returns {array} The input matrix a, where a = a * b.\r\n */\r\nSpiderGL.Math.Mat4.mul$ = function (a, b) {\r\n\tvar a0  = a[ 0], a1  = a[ 1],  a2 = a[ 2], a3  = a[ 3],\r\n\t    a4  = a[ 4], a5  = a[ 5],  a6 = a[ 6], a7  = a[ 7],\r\n\t    a8  = a[ 8], a9  = a[ 9], a10 = a[10], a11 = a[11],\r\n\t    a12 = a[12], a13 = a[13], a14 = a[14], a15 = a[15],\r\n\r\n\t    b0  = b[ 0], b1  = b[ 1], b2  = b[ 2], b3  = b[ 3],\r\n\t    b4  = b[ 4], b5  = b[ 5], b6  = b[ 6], b7  = b[ 7],\r\n\t    b8  = b[ 8], b9  = b[ 9], b10 = b[10], b11 = b[11],\r\n\t    b12 = b[12], b13 = b[13], b14 = b[14], b15 = b[15];\r\n\r\n\ta[ 0] = a0*b0 + a4*b1 + a8*b2  + a12*b3;\r\n\ta[ 1] = a1*b0 + a5*b1 + a9*b2  + a13*b3;\r\n\ta[ 2] = a2*b0 + a6*b1 + a10*b2 + a14*b3;\r\n\ta[ 3] = a3*b0 + a7*b1 + a11*b2 + a15*b3;\r\n\r\n\ta[ 4] = a0*b4 + a4*b5 + a8*b6  + a12*b7;\r\n\ta[ 5] = a1*b4 + a5*b5 + a9*b6  + a13*b7;\r\n\ta[ 6] = a2*b4 + a6*b5 + a10*b6 + a14*b7;\r\n\ta[ 7] = a3*b4 + a7*b5 + a11*b6 + a15*b7;\r\n\r\n\ta[ 8] = a0*b8 + a4*b9 + a8*b10  + a12*b11;\r\n\ta[ 9] = a1*b8 + a5*b9 + a9*b10  + a13*b11;\r\n\ta[10] = a2*b8 + a6*b9 + a10*b10 + a14*b11;\r\n\ta[11] = a3*b8 + a7*b9 + a11*b10 + a15*b11;\r\n\r\n\ta[12] = a0*b12 + a4*b13 + a8*b14  + a12*b15;\r\n\ta[13] = a1*b12 + a5*b13 + a9*b14  + a13*b15;\r\n\ta[14] = a2*b12 + a6*b13 + a10*b14 + a14*b15;\r\n\ta[15] = a3*b12 + a7*b13 + a11*b14 + a15*b15;\r\n\r\n\treturn a;\r\n}\r\n\r\n/**\r\n * In-place subtraction of a 4x4 matrix and a scalar.\r\n *\r\n * @param {array} m The 4x4 input matrix.\r\n * @param {number} s The input scalar.\r\n *\r\n * @returns {array} The input matrix m, where m[i] = m[i] * s.\r\n */\r\nSpiderGL.Math.Mat4.muls$ = function (m, s) {\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tm[i] *= s;\r\n\t}\r\n\treturn m;\r\n}\r\n\r\n/**\r\n * In-place component-wise multiplication of two 4x4 matrices.\r\n *\r\n * @param {array} a The first 4x4 input matrix.\r\n * @param {array} b The second 4x4 input matrix.\r\n *\r\n * @returns {array} The input matrix a, where a[i] = a[i] * b[i].\r\n */\r\nSpiderGL.Math.Mat4.compMul$ = function (a, b) {\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\ta[i] *= b[i];\r\n\t}\r\n\treturn a;\r\n}\r\n\r\n/**\r\n * In-place component-wise division of two 4x4 matrices.\r\n *\r\n * @param {array} a The first 4x4 input matrix.\r\n * @param {array} b The second 4x4 input matrix.\r\n *\r\n * @returns {array} The input matrix a, where a[i] = a[i] / b[i].\r\n */\r\nSpiderGL.Math.Mat4.compDiv$ = function (a, b) {\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\ta[i] /= b[i];\r\n\t}\r\n\treturn a;\r\n}\r\n\r\n/**\r\n * In-place transpose of a 4x4 matrix.\r\n *\r\n * @param {array} m The 4x4 input matrix.\r\n *\r\n * @returns {array} The transposed input matrix m.\r\n */\r\nSpiderGL.Math.Mat4.transpose$ = function (m) {\r\n\tvar t;\r\n\tt = m[ 1]; m[ 1] = m[ 4]; m[ 4] = t;\r\n\tt = m[ 2]; m[ 2] = m[ 8]; m[ 8] = t;\r\n\tt = m[ 3]; m[ 3] = m[12]; m[12] = t;\r\n\tt = m[ 6]; m[ 6] = m[ 9]; m[ 9] = t;\r\n\tt = m[ 7]; m[ 7] = m[13]; m[13] = t;\r\n\tt = m[11]; m[11] = m[14]; m[14] = t;\r\n\treturn m;\r\n}\r\n\r\n/**\r\n * In-place inversion of a 4x4 matrix.\r\n *\r\n * @param {array} m The 4x4 input matrix.\r\n *\r\n * @returns {array} The inverted input matrix m.\r\n */\r\nSpiderGL.Math.Mat4.invert$ = function (m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15];\r\n\r\n\tvar d = 1.0 / (\r\n\t\tm12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t\tm8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t\tm12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t\tm12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t\tm4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t\tm8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15);\r\n\r\n\tm[ 0] = d * (m9*m14*m7-m13*m10*m7+m13*m6*m11-m5*m14*m11-m9*m6*m15+m5*m10*m15);\r\n\tm[ 1] = d * (m13*m10*m3-m9*m14*m3-m13*m2*m11+m1*m14*m11+m9*m2*m15-m1*m10*m15);\r\n\tm[ 2] = d * (m5*m14*m3-m13*m6*m3+m13*m2*m7-m1*m14*m7-m5*m2*m15+m1*m6*m15);\r\n\tm[ 3] = d * (m9*m6*m3-m5*m10*m3-m9*m2*m7+m1*m10*m7+m5*m2*m11-m1*m6*m11);\r\n\r\n\tm[ 4] = d * (m12*m10*m7-m8*m14*m7-m12*m6*m11+m4*m14*m11+m8*m6*m15-m4*m10*m15);\r\n\tm[ 5] = d * (m8*m14*m3-m12*m10*m3+m12*m2*m11-m0*m14*m11-m8*m2*m15+m0*m10*m15);\r\n\tm[ 6] = d * (m12*m6*m3-m4*m14*m3-m12*m2*m7+m0*m14*m7+m4*m2*m15-m0*m6*m15);\r\n\tm[ 7] = d * (m4*m10*m3-m8*m6*m3+m8*m2*m7-m0*m10*m7-m4*m2*m11+m0*m6*m11);\r\n\r\n\tm[ 8] = d * (m8*m13*m7-m12*m9*m7+m12*m5*m11-m4*m13*m11-m8*m5*m15+m4*m9*m15);\r\n\tm[ 9] = d * (m12*m9*m3-m8*m13*m3-m12*m1*m11+m0*m13*m11+m8*m1*m15-m0*m9*m15);\r\n\tm[10] = d * (m4*m13*m3-m12*m5*m3+m12*m1*m7-m0*m13*m7-m4*m1*m15+m0*m5*m15);\r\n\tm[11] = d * (m8*m5*m3-m4*m9*m3-m8*m1*m7+m0*m9*m7+m4*m1*m11-m0*m5*m11);\r\n\r\n\tm[12] = d * (m12*m9*m6-m8*m13*m6-m12*m5*m10+m4*m13*m10+m8*m5*m14-m4*m9*m14);\r\n\tm[13] = d * (m8*m13*m2-m12*m9*m2+m12*m1*m10-m0*m13*m10-m8*m1*m14+m0*m9*m14);\r\n\tm[14] = d * (m12*m5*m2-m4*m13*m2-m12*m1*m6+m0*m13*m6+m4*m1*m14-m0*m5*m14);\r\n\tm[15] = d * (m4*m9*m2-m8*m5*m2+m8*m1*m6-m0*m9*m6-m4*m1*m10+m0*m5*m10);\r\n\r\n\treturn m;\r\n}\r\n\r\n/**\r\n * In-place column-major translation of a 4x4 matrix.\r\n *\r\n * @param {array} m The 4x4 input matrix.\r\n * @param {array} v The 3-dimensional translation vector.\r\n *\r\n * @returns {array} The translated input matrix m with the same result as m = m * t, where t is a translation matrix.\r\n */\r\nSpiderGL.Math.Mat4.translate$ = function (m, v) {\r\n\tvar x = v[0],\r\n\t    y = v[1],\r\n\t    z = v[2];\r\n\r\n\tm[12] = m[ 0]*x + m[ 4]*y + m[ 8]*z + m[12];\r\n\tm[13] = m[ 1]*x + m[ 5]*y + m[ 9]*z + m[13];\r\n\tm[14] = m[ 2]*x + m[ 6]*y + m[10]*z + m[14];\r\n\tm[15] = m[ 3]*x + m[ 7]*y + m[11]*z + m[15];\r\n\r\n\treturn m;\r\n}\r\n\r\n/**\r\n * In-place column-major rotation of a 4x4 matrix.\r\n * The input matrix m will be post-multiplied by a matrix r representing a counter-clockwise rotation about the input axis by the input angle in radians.\r\n * The input axis need not to be normalized.\r\n *\r\n * @param {array} m The input 4x4 matrix.\r\n * @param {number} angle The counter-clockwise rotation angle, in radians.\r\n * @param {array} axis A 3-dimensional vector representing the rotation axis.\r\n *\r\n * @returns {array} The rotated input matrix m with the same result as m = m * r, where r is a rotation matrix.\r\n */\r\nSpiderGL.Math.Mat4.rotateAngleAxis$ = function (m, angle, axis) {\r\n\tvar r = SpiderGL.Math.Mat4.rotationAngleAxis(angle, axis);\r\n\treturn SpiderGL.Math.Mat4.mul$(m, r);\r\n}\r\n\r\n/**\r\n * In-place column-major scaling of a 4x4 matrix.\r\n *\r\n * @param {array} m The 4x4 input matrix.\r\n * @param {array} v The scaling amount as a 3-dimensional array.\r\n *\r\n * @returns {array} The scaled input matrix m with the same result as m = m * s, where s is a scaling matrix.\r\n */\r\nSpiderGL.Math.Mat4.scale$ = function (m, v) {\r\n\tvar x = v[0],\r\n\t    y = v[1],\r\n\t    z = v[2];\r\n\r\n\tm[ 0] *= x; m[ 1] *= x; m[ 2] *= x; m[ 3] *= x;\r\n\tm[ 4] *= y; m[ 5] *= y; m[ 6] *= y; m[ 7] *= y;\r\n\tm[ 8] *= z; m[ 9] *= z; m[10] *= z; m[11] *= z;\r\n\r\n\treturn m;\r\n}\r\n\r\n/*---------------------------------------------------------*/\r\n\r\n\r\n\r\n// quaternion\r\n/*---------------------------------------------------------*/\r\n\r\n/**\r\n * The SpiderGL.Math.Quat namespace.\r\n * The provided functions operate on quaternions, represented as standard JavaScript arrays of length 4.\r\n * The identity quaternion is represented as the vector [0, 0, 0, 1].\r\n *\r\n * @namespace The SpiderGL.Math.Quat namespace defines operations on quaternions.\r\n */\r\nSpiderGL.Math.Quat = { };\r\n\r\n/**\r\n * Duplicates the input quaternion.\r\n *\r\n * @param {array} q The input quaternion.\r\n *\r\n * @returns {array} A new 4-component array r, where r[i] = q[i] (same as q.slice(0, 4)).\r\n */\r\nSpiderGL.Math.Quat.dup = function (q) {\r\n\treturn q.slice(0, 4);\r\n}\r\n\r\n/**\r\n * Creates an identity quaternion.\r\n * The identity quaternion is represented as the vector [0, 0, 0, 1].\r\n *\r\n * @returns {array} A new 4-component array r, where r = [0, 0, 0, 1].\r\n */\r\nSpiderGL.Math.Quat.identity = function () {\r\n\treturn [0, 0, 0, 1];\r\n}\r\n\r\n/**\r\n * Inverts a quaternion.\r\n *\r\n * @param {array} q The input quaternion.\r\n *\r\n * @returns {array} A new 4-component array r, where r = [-q[0], -q[1], -q[2], q[3]].\r\n */\r\nSpiderGL.Math.Quat.inverse = function (q) {\r\n\treturn [-q[0], -q[1], -q[2], q[3]];\r\n}\r\n\r\n/**\r\n * Multiplies two quaternions.\r\n *\r\n * @param {array} p The first quaternion multiplication operand.\r\n * @param {array} q The second quaternion multiplication quaternion.\r\n *\r\n * @returns {array} A new 4-component array r, where r = [-q[0], -q[1], -q[2], q[3]].\r\n */\r\nSpiderGL.Math.Quat.mul = function (p, q) {\r\n\tvar px = p[0],\r\n\t    py = p[1],\r\n\t    pz = p[2],\r\n\t    pw = p[3];\r\n\r\n\tvar qx = q[0],\r\n\t    qy = q[1],\r\n\t    qz = q[2],\r\n\t    qw = q[3];\r\n\r\n\treturn [\r\n\t\tpx*qw + pw*qx + pz*qy - py*qz,\r\n\t\tpy*qw + pw*qy + px*qz - pz*qx,\r\n\t\tpz*qw + pw*qz + py*qx - px*qy,\r\n\t\tpw*qw - px*qx - py*qy - pz*qz\r\n\t];\r\n}\r\n\r\n/**\r\n * Multiplies a quaternion by a scalar.\r\n *\r\n * @param {array} q The first quaternion multiplication operand.\r\n * @param {number} s The second scalar multiplication operand.\r\n *\r\n * @returns {array} A new 4-component array r, where r[i] = q[i]*s.\r\n */\r\nSpiderGL.Math.Quat.muls = function (q, s) {\r\n\treturn [q[0]*s, q[1]*s, q[2]*s, q[3]*s];\r\n}\r\n\r\nSpiderGL.Math.Quat.normalize = function (q) {\r\n\tvar s = 1 / SpiderGL.Math.sqrt(q[0]*q[0] + q[1]*q[1] + q[2]*q[2] + q[3]*q[3]);\r\n\treturn SpiderGL.Math.Quat.muls(q, s);\r\n}\r\n\r\nSpiderGL.Math.Quat.from33 = function (m) {\r\n\tvar m00 = m[0],\r\n\t    m10 = m[1],\r\n\t    m20 = m[2];\r\n\r\n\tvar m01 = m[3],\r\n\t    m11 = m[4],\r\n\t    m21 = m[5];\r\n\r\n\tvar m02 = m[6],\r\n\t    m12 = m[7],\r\n\t    m22 = m[8];\r\n\r\n\tvar t = m00 + m11 + m22;\r\n\tvar s;\r\n\r\n\tif (t > 0) {\r\n\t\tt = t + 1;\r\n\t\ts = 0.5 / SpiderGL.Math.sqrt(t);\r\n\t\treturn [\r\n\t\t\t(m21 - m12) * s,\r\n\t\t\t(m02 - m20) * s,\r\n\t\t\t(m10 - m01) * s,\r\n\t\t\tt * s\r\n\t\t];\r\n\t} else if ((m00 > m11) && (m00 > m22)) {\r\n\t\tt = m00 - m11 - m22 + 1;\r\n\t\ts = 0.5 / SpiderGL.Math.sqrt(t);\r\n\t\treturn [\r\n\t\t\tt * s,\r\n\t\t\t(m10 + m01) * s,\r\n\t\t\t(m02 + m20) * s,\r\n\t\t\t(m21 - m12) * s,\r\n\t\t];\r\n\t}\r\n\telse if (m11 > m22) {\r\n\t\tt = -m00 + m11 - m22 + 1;\r\n\t\ts = 0.5 / SpiderGL.Math.sqrt(t);\r\n\t\treturn [\r\n\t\t\t(m10 + m01) * s,\r\n\t\t\tt * s,\r\n\t\t\t(m21 + m12) * s,\r\n\t\t\t(m02 - m20) * s\r\n\t\t];\r\n\t}\r\n\telse {\r\n\t\tt = -m00 - m11 + m22 + 1;\r\n\t\ts = 0.5 / SpiderGL.Math.sqrt(t);\r\n\t\treturn [\r\n\t\t\t(m02 + m20) * s,\r\n\t\t\t(m21 + m12) * s,\r\n\t\t\tt * s,\r\n\t\t\t(m10 - m01) * s\r\n\t\t];\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\nSpiderGL.Math.Quat.to33 = function (q) {\r\n\tvar x  = q[0],\r\n\t    y  = q[1],\r\n\t    z  = q[2],\r\n\t    w  = q[3];\r\n\r\n\tvar xx = x*x,\r\n\t    xy = x*y,\r\n\t    xz = x*z,\r\n\t    xw = x*w;\r\n\r\n\tvar yy = y*y,\r\n\t    yz = y*z,\r\n\t    yw = y*w;\r\n\r\n\tvar zz = z*z,\r\n\t    zw = z*w;\r\n\r\n\treturn [\r\n\t\t1 - 2 * ( yy + zz ),\r\n\t\t    2 * ( xy + zw ),\r\n\t\t    2 * ( xz - yw ),\r\n\r\n\t\t    2 * ( xy - zw ),\r\n\t\t1 - 2 * ( xx + zz ),\r\n\t\t    2 * ( yz + xw ),\r\n\r\n\t\t    2 * ( xz + yw ),\r\n\t\t    2 * ( yz - xw ),\r\n\t\t1 - 2 * ( xx + yy )\r\n\t];\r\n}\r\n\r\nSpiderGL.Math.Quat.from44 = function (m) {\r\n\treturn SpiderGL.Math.Quat.from33(SpiderGL.Math.Mat4.to33(m));\r\n}\r\n\r\nSpiderGL.Math.Quat.to44 = function (q) {\r\n\treturn SpiderGL.Math.Mat3.to44(SpiderGL.Math.Quat.to33(q));\r\n}\r\n\r\nSpiderGL.Math.Quat.fromAngleAxis = function (angle, axis) {\r\n\treturn [0, 0, 0, 1];\r\n}\r\n\r\nSpiderGL.Math.Quat.toAngleAxis = function (q) {\r\n\treturn [0, 0, 0, 1];\r\n}\r\n\r\nSpiderGL.Math.Quat.fromEulerAngles = function (x, y, z) {\r\n\treturn [0, 0, 0, 1];\r\n}\r\n\r\nSpiderGL.Math.Quat.toEulerAngles = function (q) {\r\n\treturn [0, 0, 0, 1];\r\n}\r\n\r\nSpiderGL.Math.Quat.copy$ = function (p, q) {\r\n\tp[0] = q[0];\r\n\tp[1] = q[1];\r\n\tp[2] = q[2];\r\n\tp[3] = q[3];\r\n\treturn p;\r\n}\r\n\r\nSpiderGL.Math.Quat.identity$ = function (q) {\r\n\tq[0] = 0;\r\n\tq[1] = 0;\r\n\tq[2] = 0;\r\n\tq[3] = 1;\r\n\treturn q;\r\n}\r\n\r\nSpiderGL.Math.Quat.invert$ = function (q) {\r\n\tq[0] = -q[0];\r\n\tq[1] = -q[1];\r\n\tq[2] = -q[2];\r\n\treturn q;\r\n}\r\n\r\nSpiderGL.Math.Quat.mul$ = function (q) {\r\n\tvar px = p[0],\r\n\t    py = p[1],\r\n\t    pz = p[2],\r\n\t    pw = p[3];\r\n\r\n\tvar qx = q[0],\r\n\t    qy = q[1],\r\n\t    qz = q[2],\r\n\t    qw = q[3];\r\n\r\n\tq[0] = px*qw + pw*qx + pz*qy - py*qz;\r\n\tq[1] = py*qw + pw*qy + px*qz - pz*qx;\r\n\tq[2] = pz*qw + pw*qz + py*qx - px*qy;\r\n\tq[3] = pw*qw - px*qx - py*qy - pz*qz;\r\n\r\n\treturn q;\r\n}\r\n\r\nSpiderGL.Math.Quat.muls$ = function (q, s) {\r\n\tq[0] *= s;\r\n\tq[1] *= s;\r\n\tq[2] *= s;\r\n\tq[3] *= s;\r\n\treturn q;\r\n}\r\n\r\nSpiderGL.Math.Quat.normalize$ = function (q) {\r\n\tvar s = 1 / SpiderGL.Math.sqrt(q[0]*q[0] + q[1]*q[1] + q[2]*q[2] + q[3]*q[3]);\r\n\treturn SpiderGL.Math.Quat.muls$(q, s);\r\n}\r\n\r\n/*---------------------------------------------------------*/\r\n\r\n\r\n\r\n// general\r\n/*---------------------------------------------------------*/\r\n\r\nSpiderGL.Math.project = function (xyzw, modelViewProjectionMatrix, viewport, depthRange) {\r\n\tvar v3 = SpiderGL.Math.Vec3;\r\n\tvar m4 = SpiderGL.Math.Mat4;\r\n\r\n\tvar r    = m4.mul4(modelViewProjectionMatrix, xyzw);\r\n\tvar invW = 1 / r[3];\r\n\tr[3]     = invW;\r\n\r\n\tv3.muls$(r, invW / 2);\r\n\tv3.adds$(r, 0.5);\r\n\r\n\tv3.mul$(r, [viewport[2], viewport[3], depthRange[1] - depthRange[0]]);\r\n\tv3.add$(r, [viewport[0], viewport[1], depthRange[0]]);\r\n\r\n\treturn r;\r\n};\r\n\r\nSpiderGL.Math.unproject = function (xyz, modelViewProjectionMatrixInverse, viewport, depthRange) {\r\n\tvar v3 = SpiderGL.Math.Vec3;\r\n\tvar m4 = SpiderGL.Math.Mat4;\r\n\r\n\tvar r = v3.to4(xyz, 1.0);\r\n\r\n\tv3.sub$(r, [viewport[0], viewport[1], depthRange[0]]);\r\n\tv3.div$(r, [viewport[2], viewport[3], depthRange[1] - depthRange[0]]);\r\n\r\n\tv3.muls$(r, 2);\r\n\tv3.subs$(r, 1);\r\n\r\n\tr        = m4.mul4(modelViewProjectionMatrixInverse, r);\r\n\tvar invW = 1 / r[3];\r\n\tr[3]     = invW;\r\n\r\n\tv3.muls$(r, invW);\r\n\r\n\treturn r;\r\n};\r\n\r\n/*---------------------------------------------------------*/\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview Space\r\n */\r\n\r\n/**\r\n * The SpiderGL.Space namespace.\r\n *\r\n * @namespace The SpiderGL.Space namespace.\r\n */\r\nSpiderGL.Space = { };\r\n\r\n/**\r\n * Creates a SpiderGL.Space.MatrixStack.\r\n *\r\n * SpiderGL.Space.MatrixStack is a stack for 4x4 matrices. Initially, the stack depth is one and contains an identity matrix.\r\n * Every method or getter to access the top matrix (or a derivation like inverse or transpose) returns a copy of the internal matrix.\r\n * For performance reasons, variants of the above accessors (having the same identifier with the postfix \"$\" appended) that return a reference to the internal matrix are also present.\r\n * The transpose, inverse, and inverse-transpose of the top matrix are calculated and cached when they are accessed.\r\n *\r\n * @class The SpiderGL.Space.MatrixStack is a stack for 4x4 matrices.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n *\r\n * @param {function(this)} [onChange] A callback function called whenever the stack is modified.\r\n *\r\n * @example\r\n * var s = new SpiderGL.Space.MatrixStack();\r\n * s.loadIdentity();\r\n * s.scale([2, 0.5, 2]);\r\n * for (var i=0; i<n; ++i) {\r\n * \ts.push();\r\n * \t\ts.translate(positions[i]);\r\n * \t\tmatrices[i] = {\r\n * \t\t\tm  : s.matrix,\r\n * \t\t\ti  : s.inverse,\r\n * \t\t\tt  : s.transpose,\r\n * \t\t\tit : s.inverseTranspose\r\n * \t\t};\r\n * \ts.pop();\r\n * }\r\n *\r\n * @see reset\r\n * @see SpiderGL.Space.TransformationStack\r\n */\r\nSpiderGL.Space.MatrixStack = function (onChange) {\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\tthis._onChange = null;\r\n\tthis.reset();\r\n\tthis._onChange = onChange;\r\n}\r\n\r\nSpiderGL.Space.MatrixStack.prototype = {\r\n\t_invalidate : function () {\r\n\t\tthis._i  = null;\r\n\t\tthis._t  = null;\r\n\t\tthis._it = null;\r\n\t\tif (this._onChange) {\r\n\t\t\tthis._onChange(this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Resets the stack.\r\n\t * The stack is reset to its initial state, that is, a stack with depth one containing the identity matrix.\r\n\t *\r\n\t * @see SpiderGL.Math.Mat4.identity\r\n\t */\r\n\treset : function () {\r\n\t\tvar m = SpiderGL.Math.Mat4.identity();\r\n\t\tthis._s  = [ m ];\r\n\t\tthis._l  = 1;\r\n\t\tthis._m  = m;\r\n\t\tthis._i  = m;\r\n\t\tthis._t  = m;\r\n\t\tthis._it = m;\r\n\t\tif (this._onChange) {\r\n\t\t\tthis._onChange(this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the callback invoked whenever the top matrix changes.\r\n\t * Initially, no callback is defined.\r\n\t *\r\n\t * @event\r\n\t */\r\n\tget onChange() {\r\n\t\treturn this._onChange;\r\n\t},\r\n\r\n\tset onChange(f) {\r\n\t\tthis._onChange = f;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the stack depth.\r\n\t * Initially, the stack contains an identity matrix, so its depth is one.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget size() {\r\n\t\treturn this._l;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the matrix at the top of the stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t * Initially, the stack has depth one and contains an identity matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #matrix\r\n\t */\r\n\tget matrix$() {\r\n\t\treturn this._m;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the matrix at the top of the stack.\r\n\t * Initially, the stack has depth one and contains an identity matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #matrix$\r\n\t */\r\n\tget matrix() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.matrix$);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for #matrix$.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #top\r\n\t * @see #matrix$\r\n\t */\r\n\tget top$() {\r\n\t\treturn this.matrix$;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for #matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #top$\r\n\t * @see #matrix\r\n\t */\r\n\tget top() {\r\n\t\treturn this.matrix;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the inverse of the matrix at the top of the stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #inverse\r\n\t */\r\n\tget inverse$() {\r\n\t\treturn (this._i || (this._i = SpiderGL.Math.Mat4.inverse(this._m)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the inverse of the matrix at the top of the stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #inverse$\r\n\t */\r\n\tget inverse() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.inverse$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the matrix at the top of the stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #transpose\r\n\t */\r\n\tget transpose$() {\r\n\t\treturn (this._t || (this._t = SpiderGL.Math.Mat4.transpose(this._m)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the matrix at the top of the stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #transpose$\r\n\t */\r\n\tget transpose() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.transpose$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the matrix at the top of the stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #inverseTranspose\r\n\t */\r\n\tget inverseTranspose$() {\r\n\t\treturn (this._it || (this._it = SpiderGL.Math.Mat4.transpose(this.inverse$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the matrix at the top of the stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #inverseTranspose$\r\n\t */\r\n\tget inverseTranspose() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.inverseTranspose$);\r\n\t},\r\n\r\n\t/**\r\n\t * Pushes into the stack the matrix at its top.\r\n\t * After a push operation, the stack depth is incremented by one and the two matrices at its top are identical.\r\n\t * There is no limit on the depth the stack can reach.\r\n\t *\r\n\t * @see #pop\r\n\t */\r\n\tpush : function () {\r\n\t\tvar m = SpiderGL.Math.Mat4.dup(this._m);\r\n\t\tthis._s.push(m);\r\n\t\tthis._l++;\r\n\t\tthis._m = m;\r\n\t},\r\n\r\n\t/**\r\n\t * Pops the stack.\r\n\t * After a pop operation, the stack depth is decremented by one.\r\n\t * Nothing is done if the stack has only one element.\r\n\t *\r\n\t * @see #push\r\n\t */\r\n\tpop : function () {\r\n\t\tif (this._l <= 1) return;\r\n\t\tthis._s.pop();\r\n\t\tthis._l--;\r\n\t\tthis._m = this._s[this._l - 1];\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Replaces the matrix at the top with a clone of the passed matrix.\r\n\t *\r\n\t * @param {array} m The matrix whose clone will be set as the top of the stack.\r\n\t *\r\n\t * @see #loadIdentity\r\n\t * @see #multiply\r\n\t * @see SpiderGL.Math.Mat4.dup\r\n\t */\r\n\tload : function (m) {\r\n\t\tm = SpiderGL.Math.Mat4.dup(m);\r\n\t\tthis._s[this._l - 1] = m;\r\n\t\tthis._m = m;\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Replaces the matrix at the top with an identity matrix.\r\n\t *\r\n\t * @see #load\r\n\t * @see #multiply\r\n\t * @see SpiderGL.Math.Mat4.identity\r\n\t * @see SpiderGL.Math.Mat4.identity$\r\n\t */\r\n\tloadIdentity : function () {\r\n\t\tvar m = SpiderGL.Math.Mat4.identity$(this._m);\r\n\t\tthis._i  = m;\r\n\t\tthis._t  = m;\r\n\t\tthis._it = m;\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with the passed matrix\r\n\t * The matrix a at the top will be replaced by a * m.\r\n\t *\r\n\t * @param {array} m The matrix to post-multiply.\r\n\t *\r\n\t * @see #load\r\n\t * @see SpiderGL.Math.Mat4.mul\r\n\t * @see SpiderGL.Math.Mat4.mul$\r\n\t */\r\n\tmultiply : function (m) {\r\n\t\tSpiderGL.Math.Mat4.mul$(this._m, m);\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with an ortographic projection matrix.\r\n\t *\r\n\t * @param {array} min The minimum coordinates of the parallel viewing volume.\r\n\t * @param {array} max The maximum coordinates of the parallel viewing volume.\r\n\t *\r\n\t * @see #frustum\r\n\t * @see #perspective\r\n\t * @see SpiderGL.Math.Mat4.ortho\r\n\t * @see SpiderGL.Math.Mat4.mul$\r\n\t */\r\n\tortho : function (min, max) {\r\n\t\tSpiderGL.Math.Mat4.mul$(this._m, SpiderGL.Math.Mat4.ortho(min, max));\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with a frustum matrix.\r\n\t *\r\n\t * @param {array} min A 3-component array with the minimum coordinates of the frustum volume.\r\n\t * @param {array} max A 3-component array with the maximum coordinates of the frustum volume.\r\n\t *\r\n\t * @see #perspective\r\n\t * @see #ortho\r\n\t * @see SpiderGL.Math.Mat4.frustum\r\n\t * @see SpiderGL.Math.Mat4.mul$\r\n\t */\r\n\tfrustum : function (min, max) {\r\n\t\tSpiderGL.Math.Mat4.mul$(this._m, SpiderGL.Math.Mat4.frustum(min, max));\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with a perspective projection matrix.\r\n\t *\r\n\t * @param {number} fovY The vertical field-of-view angle, in radians.\r\n\t * @param {number} aspectRatio The projection plane aspect ratio.\r\n\t * @param {number} zNear The distance of the near clipping plane.\r\n\t * @param {number} zFar The distance of the far clipping plane.\r\n\t *\r\n\t * @see #frustum\r\n\t * @see #ortho\r\n\t * @see SpiderGL.Math.Mat4.perspective\r\n\t * @see SpiderGL.Math.Mat4.mul$\r\n\t */\r\n\tperspective : function (fovY, aspectRatio, zNear, zFar) {\r\n\t\tSpiderGL.Math.Mat4.mul$(this._m, SpiderGL.Math.Mat4.perspective(fovY, aspectRatio, zNear, zFar));\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with a look-at matrix.\r\n\t *\r\n\t * @param {array} position The viewer's position as a 3-dimensional vector.\r\n\t * @param {array} target The viewer's look-at point as a 3-dimensional vector.\r\n\t * @param {array} position The viewer's up vector as a 3-dimensional vector.\r\n\t *\r\n\t * @see SpiderGL.Math.Mat4.lookAt\r\n\t * @see SpiderGL.Math.Mat4.mul$\r\n\t */\r\n\tlookAt : function (position, target, up) {\r\n\t\tSpiderGL.Math.Mat4.mul$(this._m, SpiderGL.Math.Mat4.lookAt(position, target, up));\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with a translation matrix.\r\n\t *\r\n\t * @param {array} v A 3-dimensional vector with translation offsets.\r\n\t *\r\n\t * @see #rotate\r\n\t * @see #scale\r\n\t * @see SpiderGL.Math.Mat4.translation\r\n\t * @see SpiderGL.Math.Mat4.translate$\r\n\t */\r\n\ttranslate : function (v) {\r\n\t\tSpiderGL.Math.Mat4.translate$(this._m, v);\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with a rotation matrix.\r\n\t *\r\n\t * @param {number} angle The counter-clockwise rotation angle, in radians.\r\n\t * @param {array} axis A 3-dimensional vector representing the rotation axis.\r\n\t *\r\n\t * @see #translate\r\n\t * @see #scale\r\n\t * @see SpiderGL.Math.Mat4.rotationAngleAxis\r\n\t * @see SpiderGL.Math.Mat4.rotateAngleAxis$\r\n\t */\r\n\trotate : function (angle, axis) {\r\n\t\tSpiderGL.Math.Mat4.rotateAngleAxis$(this._m, angle, axis);\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with a scaling matrix.\r\n\t *\r\n\t * @param {array} v The scaling amount as a 3-dimensional array.\r\n\t *\r\n\t * @see #translate\r\n\t * @see #rotate\r\n\t * @see SpiderGL.Math.Mat4.scaling\r\n\t * @see SpiderGL.Math.Mat4.scale$\r\n\t */\r\n\tscale : function (v) {\r\n\t\tSpiderGL.Math.Mat4.scale$(this._m, v);\r\n\t\tthis._invalidate();\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.Space.MatrixStack, SpiderGL.Core.ObjectBase);\r\n\r\n/**\r\n * Creates a SpiderGL.Space.ViewportStack.\r\n *\r\n * SpiderGL.Space.ViewportStack is a stack for viewport rectangles, specified with lower and left coordinates, width and height.\r\n * Initially, the stack depth is one and contains a rectangle with lower-eft coordinates equal to zero and width and height equal to one, that is, the array [0, 0, 1, 1].\r\n * Every method or getter to access the top rectangle returns a copy of the internal rectangle.\r\n * For performance reasons, variants of the above accessors (having the same identifier with the postfix \"$\" appended) that return a reference to the internal rectangle are also present.\r\n *\r\n * @class The SpiderGL.Space.ViewportStack is a stack for viewport rectangles.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n *\r\n * @param {function(this)} [onChange] A callback function called whenever the stack is modified.\r\n *\r\n * @example\r\n * var s  = new SpiderGL.Space.ViewportStack();\r\n * var dw = width  / nx;\r\n * var dh = height / ny;\r\n * s.load(x, y, width, height);\r\n * for (var x=0; x<nx; ++x) {\r\n * \tfor (var y=0; y<ny; ++y) {\r\n * \ts.push();\r\n\t\ts.inner([x*dw, y*dh, dw, dh]);\r\n\t\tviewports.push(s.rect);\r\n * \ts.pop();\r\n * }\r\n *\r\n * @see reset\r\n * @see SpiderGL.Space.TransformationStack\r\n */\r\nSpiderGL.Space.ViewportStack = function (onChange) {\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\tthis._onChange = null;\r\n\tthis.reset();\r\n\tthis._onChange = onChange;\r\n}\r\n\r\nSpiderGL.Space.ViewportStack.prototype = {\r\n\t_invalidate : function () {\r\n\t\tif (this._onChange) {\r\n\t\t\tthis._onChange(this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Resets the stack.\r\n\t * The stack is reset to its initial state, that is, a stack with depth one containing the identity rectangle, that is, [0, 0, 1, 1].\r\n\t *\r\n\t * @see #loadIdentity\r\n\t */\r\n\treset : function () {\r\n\t\tvar r = [0, 0, 1, 1];\r\n\t\tthis._s  = [ r ];\r\n\t\tthis._l  = 1;\r\n\t\tthis._r  = r;\r\n\t\tif (this._onChange) {\r\n\t\t\tthis._onChange(this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the callback invoked whenever the top rectangle changes.\r\n\t * Initially, no callback is defined.\r\n\t *\r\n\t * @event\r\n\t */\r\n\tget onChange() {\r\n\t\treturn this._onChange;\r\n\t},\r\n\r\n\tset onChange(f) {\r\n\t\tthis._onChange = f;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the stack depth.\r\n\t * Initially, the stack contains the identity rectangle, that is, [0, 0, 1, 1].\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget size() {\r\n\t\treturn this._l;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the rectangle at the top of the stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t * Initially, the stack has depth one and contains the identity rectangle, that is, [0, 0, 1, 1].\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #rect\r\n\t */\r\n\tget rect$() {\r\n\t\treturn this._r;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the matrix at the top of the stack.\r\n\t * Initially, the stack has depth one and contains the identity rectangle, that is, [0, 0, 1, 1].\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #rect$\r\n\t */\r\n\tget rect() {\r\n\t\treturn this.rect$.slice(0, 4);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for #rect$.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #top\r\n\t * @see #rect$\r\n\t */\r\n\tget top$() {\r\n\t\treturn this.rect$;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for #rect.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #top$\r\n\t * @see #rect\r\n\t */\r\n\tget top() {\r\n\t\treturn this.rect;\r\n\t},\r\n\r\n\t/**\r\n\t * Pushes into the stack the rectangle at its top.\r\n\t * After a push operation, the stack depth is incremented by one and the two rectangle at its top are identical.\r\n\t * There is no limit on the depth the stack can reach.\r\n\t *\r\n\t * @see #pop\r\n\t */\r\n\tpush : function () {\r\n\t\tvar r = this._r.slice(0, 4);\r\n\t\tthis._s.push(r);\r\n\t\tthis._l++;\r\n\t\tthis._r = r;\r\n\t},\r\n\r\n\t/**\r\n\t * Pops the stack.\r\n\t * After a pop operation, the stack depth is decremented by one.\r\n\t * Nothing is done if the stack has only one element.\r\n\t *\r\n\t * @see #push\r\n\t */\r\n\tpop : function () {\r\n\t\tif (this._l <= 1) return;\r\n\t\tthis._s.pop();\r\n\t\tthis._l--;\r\n\t\tthis._r = this._s[this._l - 1];\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Replaces the rectangle at the top with a clone of the passed rectangle.\r\n\t *\r\n\t * @param {array} m The rectangle whose clone will be set as the top of the stack.\r\n\t *\r\n\t * @see #loadIdentity\r\n\t * @see #inner\r\n\t */\r\n\tload : function (r) {\r\n\t\tr = r.slice(0, 4);\r\n\t\tthis._s[this._l - 1] = r;\r\n\t\tthis._r = r;\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Replaces the rectangle at the top with the identity rectangle, that is, [0, 0, 1, 1].\r\n\t *\r\n\t * @see #load\r\n\t * @see #inner\r\n\t */\r\n\tloadIdentity : function () {\r\n\t\tvar r = [0, 0, 1, 1];\r\n\t\tthis._r  = r;\r\n\t},\r\n\r\n\t/**\r\n\t * Replace the rectangle r at the top of the stack with Post-multiplies the matrix at the top with the passed matrix\r\n\t * The matrix a at the top will be replaced by a * m.\r\n\t *\r\n\t * @param {array} m The matrix to post-multiply.\r\n\t *\r\n\t * @see #load\r\n\t */\r\n\tinner : function (r) {\r\n\t\tthis._r[0] += r[0];\r\n\t\tthis._r[1] += r[1];\r\n\t\tthis._r[2]  = r[2];\r\n\t\tthis._r[3]  = r[3];\r\n\t\tthis._invalidate();\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.Space.ViewportStack, SpiderGL.Core.ObjectBase);\r\n\r\n/**\r\n * Creates a SpiderGL.Space.ViewportStack.\r\n *\r\n * SpiderGL.Space.ViewportStack is a stack for viewport rectangles, specified with lower and left coordinates, width and height.\r\n * Initially, the stack depth is one and contains a rectangle with lower-eft coordinates equal to zero and width and height equal to one, that is, the array [0, 0, 1, 1].\r\n * Every method or getter to access the top rectangle returns a copy of the internal rectangle.\r\n * For performance reasons, variants of the above accessors (having the same identifier with the postfix \"$\" appended) that return a reference to the internal rectangle are also present.\r\n *\r\n * @class The SpiderGL.Space.ViewportStack is a stack for viewport rectangles.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n *\r\n * @param {function(this)} [onChange] A callback function called whenever the stack is modified.\r\n *\r\n * @example\r\n * var s  = new SpiderGL.Space.ViewportStack();\r\n * var dw = width  / nx;\r\n * var dh = height / ny;\r\n * s.load(x, y, width, height);\r\n * for (var x=0; x<nx; ++x) {\r\n * \tfor (var y=0; y<ny; ++y) {\r\n * \ts.push();\r\n\t\ts.inner([0, 0, dw, dh]);\r\n\t\tviewports.push(s.rect);\r\n * \ts.pop();\r\n * }\r\n *\r\n * @see reset\r\n * @see SpiderGL.Space.TransformationStack\r\n */\r\nSpiderGL.Space.DepthRangeStack = function (onChange) {\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\tthis._onChange = null;\r\n\tthis.reset();\r\n\tthis._onChange = onChange;\r\n}\r\n\r\nSpiderGL.Space.DepthRangeStack.prototype = {\r\n\t_invalidate : function () {\r\n\t\tif (this._onChange) {\r\n\t\t\tthis._onChange(this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Resets the stack.\r\n\t * The stack is reset to its initial state, that is, a stack with depth one containing the identity rectangle, that is, [0, 0, 1, 1].\r\n\t *\r\n\t * @see #loadIdentity\r\n\t */\r\n\treset : function () {\r\n\t\tvar r = [0, 1];\r\n\t\tthis._s  = [ r ];\r\n\t\tthis._l  = 1;\r\n\t\tthis._r  = r;\r\n\t\tif (this._onChange) {\r\n\t\t\tthis._onChange(this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the callback invoked whenever the top rectangle changes.\r\n\t * Initially, no callback is defined.\r\n\t *\r\n\t * @event\r\n\t */\r\n\tget onChange() {\r\n\t\treturn this._onChange;\r\n\t},\r\n\r\n\tset onChange(f) {\r\n\t\tthis._onChange = f;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the stack depth\r\n\t * Initially, the stack contains an identity matrix, so its depth is one.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget size() {\r\n\t\treturn this._l;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the matrix at the top of the stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t * Initially, the stack has depth one and contains an identity matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #matrix\r\n\t */\r\n\tget range$() {\r\n\t\treturn this._r;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the matrix at the top of the stack.\r\n\t * Initially, the stack has depth one and contains an identity matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #matrix$\r\n\t */\r\n\tget range() {\r\n\t\treturn this.range$.slice(0, 2);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for #rect$.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #top\r\n\t * @see #rect$\r\n\t */\r\n\tget top$() {\r\n\t\treturn this.range$;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for #rect.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #top$\r\n\t * @see #rect\r\n\t */\r\n\tget top() {\r\n\t\treturn this.range;\r\n\t},\r\n\r\n\t/**\r\n\t * Pushes into the stack the range at its top.\r\n\t * After a push operation, the stack depth is incremented by one and the two rectangle at its top are identical.\r\n\t * There is no limit on the depth the stack can reach.\r\n\t *\r\n\t * @see #pop\r\n\t */\r\n\tpush : function () {\r\n\t\tvar r = this._r.slice(0, 2);\r\n\t\tthis._s.push(r);\r\n\t\tthis._l++;\r\n\t\tthis._r = r;\r\n\t},\r\n\r\n\t/**\r\n\t * Pops the stack.\r\n\t * After a pop operation, the stack depth is decremented by one.\r\n\t * Nothing is done if the stack has only one element.\r\n\t *\r\n\t * @see #push\r\n\t */\r\n\tpop : function () {\r\n\t\tif (this._l <= 1) return;\r\n\t\tthis._s.pop();\r\n\t\tthis._l--;\r\n\t\tthis._r = this._s[this._l - 1];\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Replaces the matrix at the top with a clone of the passed matrix.\r\n\t *\r\n\t * @param {array} m The matrix to push on the stack. The matrix actually pushed is a clone of m.\r\n\t *\r\n\t * @see #loadIdentity\r\n\t * @see #multiply\r\n\t * @see SpiderGL.Math.Mat4.dup\r\n\t */\r\n\tload : function (r) {\r\n\t\tr = r.slice(0, 2);\r\n\t\tthis._s[this._l - 1] = r;\r\n\t\tthis._r = r;\r\n\t\tthis._invalidate();\r\n\t},\r\n\r\n\t/**\r\n\t * Replaces the matrix at the top with an identity matrix.\r\n\t *\r\n\t * @see #load\r\n\t * @see #multiply\r\n\t * @see SpiderGL.Math.Mat4.identity\r\n\t * @see SpiderGL.Math.Mat4.identity$\r\n\t */\r\n\tloadIdentity : function () {\r\n\t\tvar r = [0, 1];\r\n\t\tthis._r  = r;\r\n\t},\r\n\r\n\t/**\r\n\t * Post-multiplies the matrix at the top with the passed matrix\r\n\t * The matrix a at the top will be replaced by a * m.\r\n\t *\r\n\t * @param {array} m The matrix to post-multiply.\r\n\t *\r\n\t * @see #load\r\n\t */\r\n\tinner : function (r) {\r\n\t\tthis._r[0] += r[0];\r\n\t\tthis._r[1]  = r[1];\r\n\t\tthis._invalidate();\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.Space.DepthRangeStack, SpiderGL.Core.ObjectBase);\r\n\r\n/**\r\n * Creates a SpiderGL.Space.TransformationStack.\r\n *\r\n * The purpose of SpiderGL.Space.TransformationStack is to provide transformation stack similar to the one in the fixed-pipeline versions of OpenGL.\r\n * Differently from OpenGL, which has two stacks, namely MODELVIEW and PRIJECTION, the SpiderGL.Space.TransformationStack is composed of three SpiderGL.Space.MatrixStack stacks: model, view and projection.\r\n * All three stacks can be directly accessed, as well as utility getters to obtain compositions of matrices, e.g. model-view-projection, model-view-inverse etc.\r\n * To avoid recalculation of several sub-products, matrix compositions and variations are cached and updated when stack operations occur.\r\n *\r\n * @class The SpiderGL.Space.TransformationStack holds the model, view and projection matrix stacks and calculates their matrix compositions.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n *\r\n * @example\r\n * var xform = new SpiderGL.Space.TransformationStack();\r\n *\r\n * var uniforms = {\r\n * \tuModelViewprojection : null,\r\n * \tuNormalMatrix        : null,\r\n * \tuColor               : null\r\n * };\r\n *\r\n * program.bind();\r\n *\r\n * xform.projection.loadIdentity();\r\n * xform.projection.perspective(SpiderGL.Math.degToRad(60.0), width/height, 0.1, 100.0);\r\n *\r\n * xform.view.loadIdentity();\r\n * xform.view.lookAt([0, 0, 10], [0, 0, 0], [0, 1, 0]);\r\n *\r\n * xform.model.loadIdentity();\r\n * xform.model.scale([0.1, 0.1, 0.1]);\r\n *\r\n * for (var i=0; i<n; ++i) {\r\n * \ts.push();\r\n * \t\ts.translate(models[i].positions);\r\n * \t\tuniforms.uModelViewProjection = xform.modelViewProjectionMatrix;\r\n * \t\tuniforms.uNormalMatrix        = xform.modelSpaceNormalMatrix;\r\n * \t\tuniforms.uColor               = models[i].color;\r\n * \t\tprogram.setUniforms(uniforms);\r\n * \t\tdrawModel(models[i]);\r\n * \ts.pop();\r\n * }\r\n *\r\n * @see reset\r\n * @see SpiderGL.Space.MatrixStack\r\n */\r\nSpiderGL.Space.TransformationStack = function () {\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\tvar that = this;\r\n\r\n\tthis._mv  = { };\r\n\tthis._vp  = { };\r\n\tthis._mvp = { };\r\n\tthis._n   = { };\r\n\tthis._c   = { };\r\n\r\n\tthis._m = new SpiderGL.Space.MatrixStack(function(){\r\n\t\tthat._mv  = { };\r\n\t\tthat._mvp = { };\r\n\t\tthat._n   = { };\r\n\t\tthat._c   = { };\r\n\t});\r\n\r\n\tthis._v = new SpiderGL.Space.MatrixStack(function(){\r\n\t\tthat._mv  = { };\r\n\t\tthat._vp  = { };\r\n\t\tthat._mvp = { };\r\n\t\tthat._n   = { };\r\n\t\tthat._c   = { };\r\n\t});\r\n\r\n\tthis._p = new SpiderGL.Space.MatrixStack(function(){\r\n\t\tthat._vp  = { };\r\n\t\tthat._mvp = { };\r\n\t});\r\n\r\n\tthis._viewport = new SpiderGL.Space.ViewportStack(function(){\r\n\t});\r\n\r\n\tthis._depth = new SpiderGL.Space.DepthRangeStack(function(){\r\n\t});\r\n}\r\n\r\nSpiderGL.Space.TransformationStack.prototype = {\r\n\t/**\r\n\t * Resets the three stacks.\r\n\t *\r\n\t * @see SpiderGL.Space.MatrixStack.reset\r\n\t */\r\n\treset : function () {\r\n\t\tthis._m.reset();\r\n\t\tthis._v.reset();\r\n\t\tthis._p.reset();\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the viewport stack.\r\n\t *\r\n\t * @type SpiderGL.Space.ViewportStack\r\n\t *\r\n\t * @see depthRange\r\n\t */\r\n\tget viewport() {\r\n\t\treturn this._viewport;\r\n\t},\r\n\r\n\tget viewportRect$() {\r\n\t\treturn this._viewport.rect$;\r\n\t},\r\n\r\n\tget viewportRect() {\r\n\t\treturn this._viewport.rect;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the depth range stack.\r\n\t *\r\n\t * @type SpiderGL.Space.DepthRangeStack\r\n\t *\r\n\t * @see viewport\r\n\t */\r\n\tget depth() {\r\n\t\treturn this._depth;\r\n\t},\r\n\r\n\tget depthRange$() {\r\n\t\treturn this._depth.range$;\r\n\t},\r\n\r\n\tget depthRange() {\r\n\t\treturn this._depth.range;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the model stack.\r\n\t *\r\n\t * @type SpiderGL.Space.MatrixStack\r\n\t *\r\n\t * @see view\r\n\t * @see projection\r\n\t */\r\n\tget model() {\r\n\t\treturn this._m;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the top matrix of the model stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @see modelMatrix\r\n\t * @see SpiderGL.Space.MatrixStack.matrix$\r\n\t */\r\n\tget modelMatrix$() {\r\n\t\treturn this._m.matrix$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the top matrix of the model stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelMatrix$\r\n\t * @see SpiderGL.Space.MatrixStack.matrix\r\n\t */\r\n\tget modelMatrix() {\r\n\t\treturn this._m.matrix;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the inverse of the top matrix of the model stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelMatrixInverse\r\n\t * @see SpiderGL.Space.MatrixStack.inverse$\r\n\t */\r\n\tget modelMatrixInverse$() {\r\n\t\treturn this._m.inverse$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the inverse of the top matrix of the model stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelMatrixInverse$\r\n\t * @see SpiderGL.Space.MatrixStack.inverse\r\n\t */\r\n\tget modelMatrixInverse() {\r\n\t\treturn this._m.inverse;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the top matrix of the model stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelMatrixTranspose\r\n\t * @see SpiderGL.Space.MatrixStack.transpose$\r\n\t */\r\n\tget modelMatrixTranspose$() {\r\n\t\treturn this._m.transpose$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the top matrix of the model stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelMatrixTranspose$\r\n\t * @see SpiderGL.Space.MatrixStack.transpose\r\n\t */\r\n\tget modelMatrixTranspose() {\r\n\t\treturn this._m.transpose;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the top matrix of the model stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelMatrixInverseTranspose\r\n\t * @see SpiderGL.Space.MatrixStack.inverseTranspose$\r\n\t */\r\n\tget modelMatrixInverseTranspose$() {\r\n\t\treturn this._m.inverseTranspose$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the top matrix of the model stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelMatrixInverseTranspose$\r\n\t * @see SpiderGL.Space.MatrixStack.inverseTranspose\r\n\t */\r\n\tget modelMatrixInverseTranspose() {\r\n\t\treturn this._m.inverseTranspose;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the view stack.\r\n\t *\r\n\t * @type SpiderGL.Space.MatrixStack\r\n\t *\r\n\t * @see model\r\n\t * @see projection\r\n\t */\r\n\tget view() {\r\n\t\treturn this._v;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the top matrix of the view stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewMatrix\r\n\t * @see SpiderGL.Space.MatrixStack.matrix$\r\n\t */\r\n\tget viewMatrix$() {\r\n\t\treturn this._v.matrix$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the top matrix of the view stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewMatrix$\r\n\t * @see SpiderGL.Space.MatrixStack.matrix\r\n\t */\r\n\tget viewMatrix() {\r\n\t\treturn this._v.matrix;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the inverse of the top matrix of the view stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewMatrixInverse\r\n\t * @see SpiderGL.Space.MatrixStack.inverse$\r\n\t */\r\n\tget viewMatrixInverse$() {\r\n\t\treturn this._v.inverse$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the inverse of the top matrix of the view stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewMatrixInverse$\r\n\t * @see SpiderGL.Space.MatrixStack.inverse\r\n\t */\r\n\tget viewMatrixInverse() {\r\n\t\treturn this._v.inverse;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the top matrix of the view stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewMatrixTranspose\r\n\t * @see SpiderGL.Space.MatrixStack.transpose$\r\n\t */\r\n\tget viewMatrixTranspose$() {\r\n\t\treturn this._v.transpose$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the top matrix of the view stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewMatrixTranspose$\r\n\t * @see SpiderGL.Space.MatrixStack.transpose\r\n\t */\r\n\tget viewMatrixTranspose() {\r\n\t\treturn this._v.transpose;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the top matrix of the view stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewMatrixInverseTranspose\r\n\t * @see SpiderGL.Space.MatrixStack.inverseTranspose$\r\n\t */\r\n\tget viewMatrixInverseTranspose$() {\r\n\t\treturn this._v.inverseTranspose$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the top matrix of the view stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewMatrixInverseTranspose$\r\n\t * @see SpiderGL.Space.MatrixStack.inverseTranspose\r\n\t */\r\n\tget viewMatrixInverseTranspose() {\r\n\t\treturn this._v.inverseTranspose;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the projection stack.\r\n\t *\r\n\t * @type SpiderGL.Space.MatrixStack\r\n\t *\r\n\t * @see model\r\n\t * @see view\r\n\t */\r\n\tget projection() {\r\n\t\treturn this._p;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the top matrix of the projection stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see projectionMatrix\r\n\t * @see SpiderGL.Space.MatrixStack.matrix$\r\n\t */\r\n\tget projectionMatrix$() {\r\n\t\treturn this._p.matrix$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the top matrix of the projection stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see projectionMatrix$\r\n\t * @see SpiderGL.Space.MatrixStack.matrix\r\n\t */\r\n\tget projectionMatrix() {\r\n\t\treturn this._p.matrix;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the inverse of the top matrix of the projection stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see projectionMatrixInverse\r\n\t * @see SpiderGL.Space.MatrixStack.inverse$\r\n\t */\r\n\tget projectionMatrixInverse$() {\r\n\t\treturn this._p.inverse$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the inverse of the top matrix of the projection stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see projectionMatrixInverse$\r\n\t * @see SpiderGL.Space.MatrixStack.inverse\r\n\t */\r\n\tget projectionMatrixInverse() {\r\n\t\treturn this._p.inverse;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the top matrix of the projection stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see projectionMatrixTranspose\r\n\t * @see SpiderGL.Space.MatrixStack.transpose$\r\n\t */\r\n\tget projectionMatrixTranspose$() {\r\n\t\treturn this._p.transpose$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the top matrix of the projection stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see projectionMatrixTranspose$\r\n\t * @see SpiderGL.Space.MatrixStack.transpose\r\n\t */\r\n\tget projectionMatrixTranspose() {\r\n\t\treturn this._p.transpose;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the top matrix of the projection stack.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see projectionMatrixInverseTranspose\r\n\t * @see SpiderGL.Space.MatrixStack.inverseTranspose$\r\n\t */\r\n\tget projectionMatrixInverseTranspose$() {\r\n\t\treturn this._p.inverseTranspose$;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the top matrix of the projection stack.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see projectionMatrixInverseTranspose$\r\n\t * @see SpiderGL.Space.MatrixStack.inverseTranspose\r\n\t */\r\n\tget projectionMatrixInverseTranspose() {\r\n\t\treturn this._p.inverseTranspose;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the matrix T = V * M, where V is the view matrix and M the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewMatrix\r\n\t */\r\n\tget modelViewMatrix$() {\r\n\t\treturn (this._mv.m || (this._mv.m = SpiderGL.Math.Mat4.mul(this.viewMatrix$, this.modelMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the matrix T = V * M, where V is the view matrix and M the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewMatrix$\r\n\t */\r\n\tget modelViewMatrix() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.modelViewMatrix$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the inverse of the matrix T = V * M, where V is the view matrix and M the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewMatrixInverse\r\n\t */\r\n\tget modelViewMatrixInverse$() {\r\n\t\treturn (this._mv.i || (this._mv.i = SpiderGL.Math.Mat4.mul(this.modelMatrixInverse$, this.viewMatrixInverse$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the inverse of the matrix T = V * M, where V is the view matrix and M the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewMatrixInverse$\r\n\t */\r\n\tget modelViewMatrixInverse() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.modelViewMatrixInverse$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the matrix T = V * M, where V is the view matrix and M the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewMatrixTranspose\r\n\t */\r\n\tget modelViewMatrixTranspose$() {\r\n\t\treturn (this._mv.t || (this._mv.t = SpiderGL.Math.Mat4.transpose(this.modelViewMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the matrix T = V * M, where V is the view matrix and M the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewMatrixTranspose$\r\n\t */\r\n\tget modelViewMatrixTranspose() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.modelViewMatrixTranspose$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the matrix T = V * M, where V is the view matrix and M the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewMatrixInverseTranspose\r\n\t */\r\n\tget modelViewMatrixInverseTranspose$() {\r\n\t\treturn (this._mv.it || (this._mv.it = SpiderGL.Math.Mat4.transpose(this.modelViewMatrixInverse$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the matrix T = V * M, where V is the view matrix and M the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewMatrixInverseTranspose$\r\n\t */\r\n\tget modelViewMatrixInverseTranspose() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.modelViewMatrixInverseTranspose$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the matrix T = P * V, where P is the projection matrix and V the view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewProjectionMatrix\r\n\t */\r\n\tget viewProjectionMatrix$() {\r\n\t\treturn (this._vp.m || (this._vp.m = SpiderGL.Math.Mat4.mul(this.projectionMatrix$, this.viewMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the matrix T = P * V, where P is the projection matrix and V the view matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewProjectionMatrix$\r\n\t */\r\n\tget viewProjectionMatrix() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.viewProjectionMatrix$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the inverse of the matrix T = P * V, where P is the projection matrix and V the view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewProjectionMatrixInverse\r\n\t */\r\n\tget viewProjectionMatrixInverse$() {\r\n\t\treturn (this._vp.i || (this._vp.i = SpiderGL.Math.Mat4.mul(this.viewMatrixInverse$, this.projectionMatrixInverse$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the inverse of the matrix T = P * V, where P is the projection matrix and V the view matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewProjectionMatrixInverse$\r\n\t */\r\n\tget viewProjectionMatrixInverse() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixInverse$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the matrix T = P * V, where P is the projection matrix and V the view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewProjectionMatrixTranspose\r\n\t */\r\n\tget viewProjectionMatrixTranspose$() {\r\n\t\treturn (this._vp.t || (this._vp.t = SpiderGL.Math.Mat4.transpose(this.viewProjectionMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the matrix T = P * V, where P is the projection matrix and V the view matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewProjectionMatrixTranspose$\r\n\t */\r\n\tget viewProjectionMatrixTranspose() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixTranspose$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the matrix T = P * V, where P is the projection matrix and V the view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewProjectionMatrixInverseTranspose\r\n\t */\r\n\tget viewProjectionMatrixInverseTranspose$() {\r\n\t\treturn (this._vp.it || (this._vp.it = SpiderGL.Math.Mat4.transpose(this.viewProjectionMatrixInverse$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the matrix T = P * V, where P is the projection matrix and V the view matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewProjectionMatrixInverseTranspose$\r\n\t */\r\n\tget viewProjectionMatrixInverseTranspose() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixInverseTranspose$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the matrix T = P * V * M, where P is the projection matrix, V the view matrix and M the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewProjectionMatrix\r\n\t */\r\n\tget modelViewProjectionMatrix$() {\r\n\t\treturn (this._mvp.m || (this._mvp.m = SpiderGL.Math.Mat4.mul(this.viewProjectionMatrix$, this.modelMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the matrix T = P * V * M, where P is the projection matrix, V the view matrix and M the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewProjectionMatrix$\r\n\t */\r\n\tget modelViewProjectionMatrix() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrix$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the inverse of the matrix T = P * V * M, where P is the projection matrix, V the view matrix and M the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewProjectionMatrix\r\n\t */\r\n\tget modelViewProjectionMatrixInverse$() {\r\n\t\treturn (this._mvp.i || (this._mvp.i = SpiderGL.Math.Mat4.inverse(this.modelViewProjectionMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the inverse of the matrix T = P * V * M, where P is the projection matrix, V the view matrix and M the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewProjectionMatrix$\r\n\t */\r\n\tget modelViewProjectionMatrixInverse() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixInverse$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the matrix T = P * V * M, where P is the projection matrix, V the view matrix and M the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewProjectionMatrixTranspose\r\n\t */\r\n\tget modelViewProjectionMatrixTranspose$() {\r\n\t\treturn (this._mvp.t || (this._mvp.t = SpiderGL.Math.Mat4.transpose(this.modelViewProjectionMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the matrix T = P * V * M, where P is the projection matrix, V the view matrix and M the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewProjectionMatrixTranspose$\r\n\t */\r\n\tget modelViewProjectionMatrixTranspose() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixTranspose$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the matrix T = P * V * M, where P is the projection matrix, V the view matrix and M the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewProjectionMatrixInverseTranspose\r\n\t */\r\n\tget modelViewProjectionMatrixInverseTranspose$() {\r\n\t\treturn (this._mvp.it || (this._mvp.it = SpiderGL.Math.Mat4.transpose(this.modelViewProjectionMatrixInverse$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the matrix T = P * V * M, where P is the projection matrix, V the view matrix and M the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelViewProjectionMatrixInverseTranspose$\r\n\t */\r\n\tget modelViewProjectionMatrixInverseTranspose() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixInverseTranspose$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the upper-left 3x3 matrix of the model matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see worldSpaceNormalMatrix\r\n\t * @see viewSpaceNormalMatrix$\r\n\t */\r\n\tget worldSpaceNormalMatrix$() {\r\n\t\treturn (this._n.m || (this._n.m = SpiderGL.Math.Mat4.inverseTranspose33(this.modelMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the upper-left 3x3 matrix of the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see worldSpaceNormalMatrix$\r\n\t * @see viewSpaceNormalMatrix\r\n\t */\r\n\tget worldSpaceNormalMatrix() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.worldSpaceNormalMatrix$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the transpose of the inverse of the upper-left 3x3 matrix of the model-view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewSpaceNormalMatrix\r\n\t * @see worldSpaceNormalMatrix$\r\n\t */\r\n\tget viewSpaceNormalMatrix$() {\r\n\t\treturn (this._n.v || (this._n.v = SpiderGL.Math.Mat4.inverseTranspose33(this.modelViewMatrix$)));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the transpose of the inverse of the upper-left 3x3 matrix of the model matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see viewSpaceNormalMatrix$\r\n\t * @see worldSpaceNormalMatrix\r\n\t */\r\n\tget viewSpaceNormalMatrix() {\r\n\t\treturn SpiderGL.Math.Mat4.dup(this.viewSpaceNormalMatrix$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the 3-dimensional vector representing the 4th column of the inverse of the model-view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelSpaceViewerPosition\r\n\t * @see modelSpaceViewDirection$\r\n\t * @see worldSpaceViewerPosition$\r\n\t */\r\n\tget modelSpaceViewerPosition$() {\r\n\t\treturn (this._c.mp || (this._c.mp = SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.col(this.modelViewMatrixInverse$, 3))));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the 3-dimensional vector representing the 4th column of the inverse of the model-view matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelSpaceViewerPosition$\r\n\t * @see modelSpaceViewDirection$\r\n\t * @see worldSpaceViewerPosition\r\n\t */\r\n\tget modelSpaceViewerPosition() {\r\n\t\treturn SpiderGL.Math.Vec3.dup(this.modelSpaceViewerPosition$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the 3-dimensional vector representing the 4th column of the inverse of the view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see worldSpaceViewerPosition\r\n\t * @see worldSpaceViewDirection$\r\n\t * @see modelSpaceViewerPosition$\r\n\t */\r\n\tget worldSpaceViewerPosition$() {\r\n\t\treturn (this._c.wp || (this._c.wp = SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.col(this.viewMatrixInverse$, 3))));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the 3-dimensional vector representing the 4th column of the inverse of the model-view matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see worldSpaceViewerPosition$\r\n\t * @see worldSpaceViewDirection\r\n\t * @see modelSpaceViewerPosition\r\n\t */\r\n\tget worldSpaceViewerPosition() {\r\n\t\treturn SpiderGL.Math.Vec3.dup(this.worldSpaceViewerPosition$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the 3-dimensional vector representing the negated 3rd row of the inverse of the model-view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelSpaceViewDirection\r\n\t * @see modelSpaceViewerPosition$\r\n\t * @see worldSpaceViewDirection$\r\n\t */\r\n\tget modelSpaceViewDirection$() {\r\n\t\treturn (this._c.md || (this._c.md = SpiderGL.Math.Vec3.normalize$(SpiderGL.Math.Vec3.neg$(SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.row(this.modelViewMatrixInverse$, 2))))));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a copy of the 3-dimensional vector representing the negated 3rd row of the inverse of the model-view matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see modelSpaceViewDirection$\r\n\t * @see modelSpaceViewerPosition\r\n\t * @see worldSpaceViewDirection\r\n\t */\r\n\tget modelSpaceViewDirection() {\r\n\t\treturn SpiderGL.Math.Vec3.dup(this.modelSpaceViewDirection$);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the 3-dimensional vector representing the negated 3rd row of the inverse of the view matrix.\r\n\t * The returned array MUST NOT be changed.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see worldSpaceViewDirection\r\n\t * @see worldSpaceViewerPosition$\r\n\t * @see modelSpaceViewDirection$\r\n\t */\r\n\tget worldSpaceViewDirection$() {\r\n\t\treturn (this._c.wd || (this._c.wd = SpiderGL.Math.Vec3.normalize$(SpiderGL.Math.Vec3.neg$(SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.row(this.viewMatrixInverse$, 2))))));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a reference to the 3-dimensional vector representing the negated 3rd row of the inverse of the model-view matrix.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @see worldSpaceViewDirection$\r\n\t * @see worldSpaceViewerPosition\r\n\t * @see modelSpaceViewDirection\r\n\t */\r\n\tget worldSpaceViewDirection() {\r\n\t\treturn SpiderGL.Math.Vec3.dup(this.worldSpaceViewDirection$);\r\n\t},\r\n\r\n\tproject : function(xyzw) {\r\n\t\treturn SpiderGL.Math.project(xyzw, this.modelViewProjectionMatrix$, this.viewportRect$, this.depthRange$);\r\n\t},\r\n\r\n\tunproject : function(xyz) {\r\n\t\treturn SpiderGL.Math.unproject(xyz, this.modelViewProjectionMatrixInverse$, this.viewportRect$, this.depthRange$);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.Space.TransformationStack, SpiderGL.Core.ObjectBase);\r\n\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview WebGL\r\n */\r\n\r\n/**\r\n * The SpiderGL.WebGL namespace.\r\n *\r\n * @namespace The SpiderGL.WebGL namespace.\r\n *\r\n * The SpiderGL.WebGL namespace gives access to WebGL functionalities in terms of context creation and enhancement, and object wrappers.\r\n * The main purpose of the module is to provide a robust and intuitive way of dealing with all native WebGL objects (e.g., textures, framebuffers, etc.).\r\n * Each specialized wrapper handles creation/destruction, edit operations (i.e. parameter settings), and binding of the underlying native WebGL object (the GL handle).\r\n * To allow low level access and integration with existing code, the native handle is exposed. On the other side, wrappers can be created for already existing native objects,\r\n * ensuring that the same wrapper will be used for multiple wraps of the same object.\r\n * To create a robust interoperability between wrapper usage and native WebGL calls on handles, wrappers must be informed whenever any single native call operates on the wrapped handle.\r\n * SpiderGL handles this task by hijacking the WebGLRenderingContext object, and installing on it a set of extensions that use callback mechanisms to report changes to wrappers.\r\n * Moreover, to overcome the bind-to-edit/bind-to-use paradigm typical of the OpenGL API family, SpiderGL injects an extension that is insired by GL_EXT_direct_state_access extension.\r\n */\r\nSpiderGL.WebGL = { };\r\n\r\n/**\r\n * The SpiderGL.WebGL.Context namespace.\r\n *\r\n * @namespace The SpiderGL.WebGL.Context namespace.\r\n */\r\nSpiderGL.WebGL.Context = { };\r\n\r\n/**\r\n * The string for obtaining a WebGLRenderingContext from a canvas.\r\n *\r\n * @constant\r\n *\r\n * @see SpiderGL.WebGL.Context.get\r\n */\r\nSpiderGL.WebGL.Context.WEBGL_STRING = \"experimental-webgl\";\r\n\r\n/**\r\n * Default value for pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_FLIP_Y_WEBGL.\r\n *\r\n * @default true\r\n *\r\n * @see SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA\r\n * @see SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION\r\n * @see SpiderGL.WebGL.Context.setStandardGLUnpack\r\n */\r\nSpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y = true;\r\n\r\n/**\r\n * Default value for pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_PREMULTIPLY_ALPHA_WEBGL.\r\n *\r\n * @default true\r\n *\r\n * @see SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y\r\n * @see SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION\r\n * @see SpiderGL.WebGL.Context.setStandardGLUnpack\r\n */\r\nSpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA = false;\r\n\r\n/**\r\n * Default value for pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_COLORSPACE_CONVERSION_WEBGL.\r\n *\r\n * @default WebGLRenderingContext.prototype.NONE\r\n *\r\n * @see SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y\r\n * @see SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA\r\n * @see SpiderGL.WebGL.Context.setStandardGLUnpack\r\n */\r\nSpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION = WebGLRenderingContext.prototype.NONE;\r\n\r\n/**\r\n * Retrieves the WebGLRenderingContext from a canvas.\r\n *\r\n * The WebGLRenderingContext is obtained by calling the getContext() method of the canvas object.\r\n *\r\n * @param {HTMLCanvasElement} canvas The HTMLCanvasElement from which retrieve the WebGL context.\r\n * @param {object} args The optional WebGL context arguments.\r\n *\r\n * @returns {WebGLRenderingContext} The canvas WebGL rendering context.\r\n *\r\n * @see SpiderGL.WebGL.Context.hijack\r\n * @see SpiderGL.WebGL.Context.getHijacked\r\n */\r\nSpiderGL.WebGL.Context.get = function (canvas, args) {\r\n\tvar c = canvas;\r\n\tif (SpiderGL.Type.isString(c)) { c = SpiderGL.DOM.getElementById(c); }\r\n\tif (!SpiderGL.Type.instanceOf(c, HTMLCanvasElement)) { return null; }\r\n\tvar ctx = c.getContext(SpiderGL.WebGL.Context.WEBGL_STRING, args);\r\n\treturn ctx;\r\n}\r\n\r\nSpiderGL.WebGL.Context._prepareContex = function (gl) {\r\n\tif (!gl) return;\r\n\r\n\tvar sgl = gl._spidergl;\r\n\tif (sgl) return;\r\n\r\n\tsgl = { };\r\n\tgl._spidergl = sgl;\r\n\tsgl.TAG = 0;\r\n\tsgl.gl = gl;\r\n\r\n\tvar glFunctions = { };\r\n\tsgl.glFunctions = glFunctions;\r\n\tfor (var f in gl) {\r\n\t\tvar fn = gl[fn];\r\n\t\tif (typeof fn == \"function\") {\r\n\t\t\tglFunctions[f] = fn;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nSpiderGL.WebGL.Context._addExtension = function (gl, extName, propName, setupFunc) {\r\n\tif (!gl) return;\r\n\r\n\tvar getExtension = gl.getExtension;\r\n\tgl.getExtension = function (name) {\r\n\t\tif (name == extName) {\r\n\t\t\tvar sgl = this._spidergl;\r\n\t\t\tif (!sgl) return null;\r\n\t\t\tvar pubExt = sgl[propName];\r\n\t\t\tif (!pubExt) {\r\n\t\t\t\tpubExt = { };\r\n\r\n\t\t\t\tpubExt.TAG = 0;\r\n\r\n\t\t\t\tvar ext = { };\r\n\t\t\t\tpubExt._ext = ext;\r\n\r\n\t\t\t\text[propName] = pubExt;\r\n\t\t\t\text.sgl = sgl;\r\n\t\t\t\text.gl  = gl;\r\n\r\n\t\t\t\tvar glFunctions = { };\r\n\t\t\t\text.glFunctions = glFunctions;\r\n\r\n\t\t\t\tif (!setupFunc(gl, pubExt)) return null;\r\n\r\n\t\t\t\tsgl[propName] = pubExt;\r\n\t\t\t}\r\n\t\t\treturn pubExt;\r\n\t\t}\r\n\t\treturn getExtension.call(this, name);\r\n\t};\r\n};\r\n\r\nSpiderGL.WebGL.Context._setup_SGL_current_binding = function (gl, pubExt) {\r\n\tif (!gl) return false;\r\n\tif (!pubExt) return false;\r\n\tif (!gl._spidergl) return false;\r\n\tif (gl._spidergl.cb) return false;\r\n\r\n\tvar cb = pubExt;\r\n\tvar ext = cb._ext;\r\n\tvar glFunctions = ext.glFunctions;\r\n\r\n\r\n\r\n\t// buffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\text.currentBuffer = { };\r\n\text.currentBuffer[gl.ARRAY_BUFFER        ] = gl.getParameter(gl.ARRAY_BUFFER_BINDING);\r\n\text.currentBuffer[gl.ELEMENT_ARRAY_BUFFER] = gl.getParameter(gl.ELEMENT_ARRAY_BUFFER_BINDING);\r\n\r\n\text.bufferStack = { };\r\n\text.bufferStack[gl.ARRAY_BUFFER        ] = [ ];\r\n\text.bufferStack[gl.ELEMENT_ARRAY_BUFFER] = [ ];\r\n\r\n\tglFunctions.bindBuffer = gl.bindBuffer;\r\n\tgl.bindBuffer = function (target, buffer) {\r\n\t\tvar ext = this._spidergl.cb._ext;\r\n\t\tvar current = ext.currentBuffer[target];\r\n\t\tif (current == buffer) return;\r\n\t\text.currentBuffer[target] = buffer;\r\n\t\text.glFunctions.bindBuffer.call(this, target, buffer);\r\n\t};\r\n\r\n\tcb.getCurrentBuffer = function (target) {\r\n\t\treturn this._ext.currentBuffer[target];\r\n\t};\r\n\r\n\tcb.pushBuffer = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack  = ext.bufferStack[target];\r\n\t\tvar buffer = ext.currentBuffer[target];\r\n\t\tstack.push(buffer);\r\n\t};\r\n\r\n\tcb.popBuffer = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack = ext.bufferStack[target];\r\n\t\tif (stack.length <= 0) return;\r\n\t\tvar buffer = stack.pop();\r\n\t\text.gl.bindBuffer(target, buffer);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// framebuffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\text.currentFramebuffer = { };\r\n\text.currentFramebuffer[gl.FRAMEBUFFER] = gl.getParameter(gl.FRAMEBUFFER_BINDING);\r\n\r\n\text.framebufferStack = { };\r\n\text.framebufferStack[gl.FRAMEBUFFER] = [ ];\r\n\r\n\tglFunctions.bindFramebuffer = gl.bindFramebuffer;\r\n\tgl.bindFramebuffer = function (target, framebuffer) {\r\n\t\tvar ext = this._spidergl.cb._ext;\r\n\t\tvar current = ext.currentFramebuffer[target];\r\n\t\tif (current == framebuffer) return;\r\n\t\text.currentFramebuffer[target] = framebuffer;\r\n\t\text.glFunctions.bindFramebuffer.call(this, target, framebuffer);\r\n\t};\r\n\r\n\tcb.getCurrentFramebuffer = function (target) {\r\n\t\treturn this._ext.currentFramebuffer[target];\r\n\t};\r\n\r\n\tcb.pushFramebuffer = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack  = ext.framebufferStack[target];\r\n\t\tvar framebuffer = ext.currentFramebuffer[target];\r\n\t\tstack.push(framebuffer);\r\n\t};\r\n\r\n\tcb.popFramebuffer = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack = ext.framebufferStack[target];\r\n\t\tif (stack.length <= 0) return;\r\n\t\tvar framebuffer = stack.pop();\r\n\t\text.gl.bindFramebuffer(target, framebuffer);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// program\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\text.currentProgram = gl.getParameter(gl.CURRENT_PROGRAM);\r\n\r\n\text.programStack = [ ];\r\n\r\n\tglFunctions.useProgram = gl.useProgram;\r\n\tgl.useProgram = function (program) {\r\n\t\tvar ext = this._spidergl.cb._ext;\r\n\t\tvar current = ext.currentProgram;\r\n\t\tif (current == program) return;\r\n\t\text.currentProgram = program;\r\n\t\text.glFunctions.useProgram.call(this, program);\r\n\t};\r\n\r\n\tcb.getCurrentProgram = function () {\r\n\t\treturn this._ext.currentProgram;\r\n\t};\r\n\r\n\tcb.pushProgram = function () {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack = ext.programStack;\r\n\t\tvar program = ext.currentProgram;\r\n\t\tstack.push(program);\r\n\t};\r\n\r\n\tcb.popProgram = function () {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack = ext.programStack;\r\n\t\tif (stack.length <= 0) return;\r\n\t\tvar program = stack.pop();\r\n\t\text.gl.useProgram(program);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// renderbuffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\text.currentRenderbuffer = { };\r\n\text.currentRenderbuffer[gl.RENDERBUFFER] = gl.getParameter(gl.RENDERBUFFER_BINDING);\r\n\r\n\text.renderbufferStack = { };\r\n\text.renderbufferStack[gl.RENDERBUFFER] = [ ];\r\n\r\n\tglFunctions.bindRenderbuffer = gl.bindRenderbuffer;\r\n\tgl.bindRenderbuffer = function (target, renderbuffer) {\r\n\t\tvar ext = this._spidergl.cb._ext;\r\n\t\tvar current = ext.currentRenderbuffer[target];\r\n\t\tif (current == renderbuffer) return;\r\n\t\text.currentRenderbuffer[target] = renderbuffer;\r\n\t\text.glFunctions.bindRenderbuffer.call(this, target, renderbuffer);\r\n\t};\r\n\r\n\tcb.getCurrentRenderbuffer = function (target) {\r\n\t\treturn this._ext.currentRenderbuffer[target];\r\n\t};\r\n\r\n\tcb.pushRenderbuffer = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack  = ext.renderbufferStack[target];\r\n\t\tvar renderbuffer = ext.currentRenderbuffer[target];\r\n\t\tstack.push(renderbuffer);\r\n\t};\r\n\r\n\tcb.popRenderbuffer = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack = ext.renderbufferStack[target];\r\n\t\tif (stack.length <= 0) return;\r\n\t\tvar renderbuffer = stack.pop();\r\n\t\text.gl.bindRenderbuffer(target, renderbuffer);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// shader\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\text.currentShader = { };\r\n\text.currentShader[gl.VERTEX_SHADER  ] = null;\r\n\text.currentShader[gl.FRAGMENT_SHADER] = null;\r\n\r\n\text.shaderStack = { };\r\n\text.shaderStack[gl.VERTEX_SHADER  ] = [ ];\r\n\text.shaderStack[gl.FRAGMENT_SHADER] = [ ];\r\n\r\n\text.glFunctions.bindShader = function (target, shader) { };\r\n\tcb.bindShader = function (target, shader) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar current = ext.currentShader[target];\r\n\t\tif (current == shader) return;\r\n\t\text.currentShader[target] = shader;\r\n\t\text.glFunctions.bindShader.call(ext.gl, target, shader);\r\n\t};\r\n\r\n\tcb.getCurrentShader = function (target) {\r\n\t\treturn this._ext.currentShader[target];\r\n\t};\r\n\r\n\tcb.pushShader = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack  = ext.shaderStack[target];\r\n\t\tvar shader = ext.currentShader[target];\r\n\t\tstack.push(shader);\r\n\t};\r\n\r\n\tcb.popShader = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack = ext.shaderStack[target];\r\n\t\tif (stack.length <= 0) return;\r\n\t\tvar shader = stack.pop();\r\n\t\text.gl.bindShader(target, shader);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// texture\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\text.currentTexture = { };\r\n\r\n\tvar currentTextureUnit = gl.getParameter(gl.ACTIVE_TEXTURE);\r\n\tvar textureUnitsCount  = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n\text.currentTexture = { };\r\n\text.textureStack = { };\r\n\text.textureUnitStack = [ ];\r\n\tfor (var i=0; i<textureUnitsCount; ++i) {\r\n\t\tvar textureUnit = gl.TEXTURE0 + i;\r\n\t\tgl.activeTexture(textureUnit);\r\n\r\n\t\tvar textureBindings = { }\r\n\t\ttextureBindings[gl.TEXTURE_2D      ] = gl.getParameter(gl.TEXTURE_BINDING_2D);\r\n\t\ttextureBindings[gl.TEXTURE_CUBE_MAP] = gl.getParameter(gl.TEXTURE_BINDING_CUBE_MAP);\r\n\t\text.currentTexture[textureUnit] = textureBindings;\r\n\r\n\t\tvar textureStacks = { }\r\n\t\ttextureStacks[gl.TEXTURE_2D      ] = [ ];\r\n\t\ttextureStacks[gl.TEXTURE_CUBE_MAP] = [ ];\r\n\t\text.textureStack[textureUnit] = textureStacks;\r\n\t}\r\n\tgl.activeTexture(currentTextureUnit);\r\n\text.currentTextureUnit = currentTextureUnit;\r\n\r\n\tglFunctions.activeTexture = gl.activeTexture;\r\n\tgl.activeTexture = function (texture) {\r\n\t\tvar ext = this._spidergl.cb._ext;\r\n\t\tvar current = ext.currentTextureUnit;\r\n\t\tif (current == texture) return;\r\n\t\text.currentTextureUnit = texture;\r\n\t\text.glFunctions.activeTexture.call(this, texture);\r\n\t};\r\n\r\n\tcb.getCurrentTextureUnit = function () {\r\n\t\treturn this._ext.currentTextureUnit;\r\n\t};\r\n\r\n\tcb.pushTextureUnit = function () {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack  = ext.textureUnitStack;\r\n\t\tvar unit = ext.currentTextureUnit;\r\n\t\tstack.push(unit);\r\n\t};\r\n\r\n\tcb.popTextureUnit = function () {\r\n\t\tvar ext = this._ext;\r\n\t\tvar stack  = ext.textureUnitStack;\r\n\t\tif (stack.length <= 0) return;\r\n\t\tvar unit = stack.pop();\r\n\t\text.gl.activeTexture(unit);\r\n\t};\r\n\r\n\tglFunctions.bindTexture = gl.bindTexture;\r\n\tgl.bindTexture = function (target, texture) {\r\n\t\tvar ext = this._spidergl.cb._ext;\r\n\t\tvar unit = ext.currentTextureUnit;\r\n\t\tvar current = ext.currentTexture[unit][target];\r\n\t\tif (current == texture) return;\r\n\t\text.currentTexture[unit][target] = texture;\r\n\t\text.glFunctions.bindTexture.call(this, target, texture);\r\n\t};\r\n\r\n\tcb.getCurrentTexture = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar unit = ext.currentTextureUnit;\r\n\t\treturn ext.currentTexture[unit][target];\r\n\t};\r\n\r\n\tcb.pushTexture = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar unit = ext.currentTextureUnit;\r\n\t\tvar stack  = ext.textureStack[unit][target];\r\n\t\tvar texture = ext.currentTexture[unit][target];\r\n\t\tstack.push(texture);\r\n\t};\r\n\r\n\tcb.popTexture = function (target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar unit = ext.currentTextureUnit;\r\n\t\tvar stack  = ext.textureStack[unit][target];\r\n\t\tif (stack.length <= 0) return;\r\n\t\tvar texture = stack.pop();\r\n\t\text.gl.bindTexture(target, texture);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\treturn true;\r\n};\r\n\r\nSpiderGL.WebGL.Context._setup_SGL_wrapper_notify = function (gl, pubExt) {\r\n\tif (!gl) return false;\r\n\tif (!pubExt) return false;\r\n\tif (!gl._spidergl) return false;\r\n\tif (gl._spidergl.wn) return false;\r\n\r\n\tvar wn = pubExt;\r\n\tvar ext = wn._ext;\r\n\tvar glFunctions = ext.glFunctions;\r\n\r\n\text.cb = gl.getExtension(\"SGL_current_binding\");\r\n\tif (!ext.cb) return false;\r\n\r\n\r\n\r\n\t// buffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tglFunctions.deleteBuffer = gl.deleteBuffer;\r\n\tgl.deleteBuffer = function (buffer) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.deleteBuffer.apply(this, arguments);\r\n\t\tvar current = buffer;\r\n\t\t(current && current._spidergl && current._spidergl._gl_deleteBuffer.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.isBuffer = gl.isBuffer;\r\n\tgl.isBuffer = function (buffer) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.isBuffer.apply(this, arguments);\r\n\t\tvar current = buffer;\r\n\t\t(current && current._spidergl && current._spidergl._gl_isBuffer.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.bindBuffer = gl.bindBuffer;\r\n\tgl.bindBuffer = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.bindBuffer.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_bindBuffer.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.getBufferParameter = gl.getBufferParameter;\r\n\tgl.getBufferParameter = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getBufferParameter.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_getBufferParameter.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.bufferData = gl.bufferData;\r\n\tgl.bufferData = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.bufferData.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_bufferData.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.bufferSubData = gl.bufferSubData;\r\n\tgl.bufferSubData = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.bufferSubData.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_bufferSubData.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.vertexAttribPointer = gl.vertexAttribPointer;\r\n\tgl.vertexAttribPointer = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.vertexAttribPointer.apply(this, arguments);\r\n\t\tvar target  = this.ARRAY_BUFFER;\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_vertexAttribPointer.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.drawElements = gl.drawElements;\r\n\tgl.drawElements = function (buffer, mode, count, type, offset) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.drawElements.apply(this, arguments);\r\n\t\tvar target  = this.ELEMENT_ARRAY_BUFFER;\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_drawElements.apply(current._spidergl, arguments));\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// framebuffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tglFunctions.deleteFramebuffer = gl.deleteFramebuffer;\r\n\tgl.deleteFramebuffer = function (framebuffer) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.deleteFramebuffer.apply(this, arguments);\r\n\t\tvar current = framebuffer;\r\n\t\t(current && current._spidergl && current._spidergl._gl_deleteFramebuffer.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.isFramebuffer = gl.isFramebuffer;\r\n\tgl.isFramebuffer = function (framebuffer) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.isFramebuffer.apply(this, arguments);\r\n\t\tvar current = framebuffer;\r\n\t\t(current && current._spidergl && current._spidergl._gl_isFramebuffer.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.bindFramebuffer = gl.bindFramebuffer;\r\n\tgl.bindFramebuffer = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.bindFramebuffer.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_bindFramebuffer.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.checkFramebufferStatus = gl.checkFramebufferStatus;\r\n\tgl.checkFramebufferStatus = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.checkFramebufferStatus.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_checkFramebufferStatus.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getFramebufferAttachmentParameter = gl.getFramebufferAttachmentParameter;\r\n\tgl.getFramebufferAttachmentParameter = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getFramebufferAttachmentParameter.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_getFramebufferAttachmentParameter.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.framebufferRenderbuffer = gl.framebufferRenderbuffer;\r\n\tgl.framebufferRenderbuffer = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.framebufferRenderbuffer.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_framebufferRenderbuffer.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.framebufferTexture2D = gl.framebufferTexture2D;\r\n\tgl.framebufferTexture2D = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.framebufferTexture2D.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_framebufferTexture2D.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.clear = gl.clear;\r\n\tgl.clear = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.clear.apply(this, arguments);\r\n\t\tvar target = this.FRAMEBUFFER;\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_clear.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.readPixels = gl.readPixels;\r\n\tgl.readPixels = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.readPixels.apply(this, arguments);\r\n\t\tvar target = this.FRAMEBUFFER;\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_readPixels.apply(current._spidergl, arguments));\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// program\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tglFunctions.deleteProgram = gl.deleteProgram;\r\n\tgl.deleteProgram = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.deleteProgram.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_deleteProgram.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.isProgram = gl.isProgram;\r\n\tgl.isProgram = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.isProgram.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_isProgram.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.useProgram = gl.useProgram;\r\n\tgl.useProgram = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.useProgram.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_useProgram.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.getActiveAttrib = gl.getActiveAttrib;\r\n\tgl.getActiveAttrib = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getActiveAttrib.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getActiveAttrib.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getActiveUniform = gl.getActiveUniform;\r\n\tgl.getActiveUniform = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getActiveUniform.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getActiveUniform.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getAttachedShaders = gl.getAttachedShaders;\r\n\tgl.getAttachedShaders = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getAttachedShaders.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getAttachedShaders.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getAttribLocation = gl.getAttribLocation;\r\n\tgl.getAttribLocation = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getAttribLocation.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getAttribLocation.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getProgramParameter = gl.getProgramParameter;\r\n\tgl.getProgramParameter = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getProgramParameter.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getProgramParameter.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getProgramInfoLog = gl.getProgramInfoLog;\r\n\tgl.getProgramInfoLog = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getProgramInfoLog.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getProgramInfoLog.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getUniform = gl.getUniform;\r\n\tgl.getUniform = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getUniform.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getUniform.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getUniformLocation = gl.getUniformLocation;\r\n\tgl.getUniformLocation = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getUniformLocation.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getUniformLocation.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.attachShader = gl.attachShader;\r\n\tgl.attachShader = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.attachShader.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_attachShader.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.bindAttribLocation = gl.bindAttribLocation;\r\n\tgl.bindAttribLocation = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.bindAttribLocation.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_bindAttribLocation.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.detachShader = gl.detachShader;\r\n\tgl.detachShader = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.detachShader.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_detachShader.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.linkProgram = gl.linkProgram;\r\n\tgl.linkProgram = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.linkProgram.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_linkProgram.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform1f = gl.uniform1f;\r\n\tgl.uniform1f = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform1f.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform1f.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform1fv = gl.uniform1fv;\r\n\tgl.uniform1fv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform1fv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform1fv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform1i = gl.uniform1i;\r\n\tgl.uniform1i = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform1i.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform1i.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform1iv = gl.uniform1iv;\r\n\tgl.uniform1iv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform1iv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform1iv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform2f = gl.uniform2f;\r\n\tgl.uniform2f = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform2f.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform2f.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform2fv = gl.uniform2fv;\r\n\tgl.uniform2fv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform2fv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform2fv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform2i = gl.uniform2i;\r\n\tgl.uniform2i = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform2i.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform2i.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform2iv = gl.uniform2iv;\r\n\tgl.uniform2iv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform2iv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform2iv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform3f = gl.uniform3f;\r\n\tgl.uniform3f = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform3f.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform3f.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform3fv = gl.uniform3fv;\r\n\tgl.uniform3fv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform3fv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform3fv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform3i = gl.uniform3i;\r\n\tgl.uniform3i = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform3i.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform3i.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform3iv = gl.uniform3iv;\r\n\tgl.uniform3iv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform3iv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform3iv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform4f = gl.uniform4f;\r\n\tgl.uniform4f = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform4f.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform4f.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform4fv = gl.uniform4fv;\r\n\tgl.uniform4fv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform4fv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform4fv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform4i = gl.uniform4i;\r\n\tgl.uniform4i = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform4i.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform4i.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniform4iv = gl.uniform4iv;\r\n\tgl.uniform4iv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniform4iv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniform4iv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniformMatrix2fv = gl.uniformMatrix2fv;\r\n\tgl.uniformMatrix2fv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniformMatrix2fv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniformMatrix2fv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniformMatrix3fv = gl.uniformMatrix3fv;\r\n\tgl.uniformMatrix3fv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniformMatrix3fv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniformMatrix3fv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.uniformMatrix4fv = gl.uniformMatrix4fv;\r\n\tgl.uniformMatrix4fv = function () {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.uniformMatrix4fv.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current && current._spidergl && current._spidergl._gl_uniformMatrix4fv.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.validateProgram = gl.validateProgram;\r\n\tgl.validateProgram = function (program) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.validateProgram.apply(this, arguments);\r\n\t\tvar current = program;\r\n\t\t(current && current._spidergl && current._spidergl._gl_validateProgram.apply(current._spidergl, arguments));\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// renderbuffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tglFunctions.deleteRenderbuffer = gl.deleteRenderbuffer;\r\n\tgl.deleteRenderbuffer = function (renderbuffer) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.deleteRenderbuffer.apply(this, arguments);\r\n\t\tvar current = renderbuffer;\r\n\t\t(current && current._spidergl && current._spidergl._gl_deleteRenderbuffer.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.isRenderbuffer = gl.isRenderbuffer;\r\n\tgl.isRenderbuffer = function (renderbuffer) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.isRenderbuffer.apply(this, arguments);\r\n\t\tvar current = renderbuffer;\r\n\t\t(current && current._spidergl && current._spidergl._gl_isRenderbuffer.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.bindRenderbuffer = gl.bindRenderbuffer;\r\n\tgl.bindRenderbuffer = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.bindRenderbuffer.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentRenderbuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_bindRenderbuffer.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.getRenderbufferParameter = gl.getRenderbufferParameter;\r\n\tgl.getRenderbufferParameter = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getRenderbufferParameter.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentRenderbuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_getRenderbufferParameter.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.renderbufferStorage = gl.renderbufferStorage;\r\n\tgl.renderbufferStorage = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.renderbufferStorage.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentRenderbuffer(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_renderbufferStorage.apply(current._spidergl, arguments));\r\n\t}\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// shader\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tglFunctions.deleteShader = gl.deleteShader;\r\n\tgl.deleteShader = function (shader) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.deleteShader.apply(this, arguments);\r\n\t\tvar current = shader;\r\n\t\t(current && current._spidergl && current._spidergl._gl_deleteShader.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.isShader = gl.isShader;\r\n\tgl.isShader = function (shader) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.isShader.apply(this, arguments);\r\n\t\tvar current = shader;\r\n\t\t(current && current._spidergl && current._spidergl._gl_isShader.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getShaderParameter = gl.getShaderParameter;\r\n\tgl.getShaderParameter = function (shader) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getShaderParameter.apply(this, arguments);\r\n\t\tvar current = shader;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getShaderParameter.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getShaderInfoLog = gl.getShaderInfoLog;\r\n\tgl.getShaderInfoLog = function (shader) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getShaderInfoLog.apply(this, arguments);\r\n\t\tvar current = shader;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getShaderInfoLog.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.getShaderSource = gl.getShaderSource;\r\n\tgl.getShaderSource = function (shader) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getShaderSource.apply(this, arguments);\r\n\t\tvar current = shader;\r\n\t\t(current && current._spidergl && current._spidergl._gl_getShaderSource.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.compileShader = gl.compileShader;\r\n\tgl.compileShader = function (shader) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.compileShader.apply(this, arguments);\r\n\t\tvar current = shader;\r\n\t\t(current && current._spidergl && current._spidergl._gl_compileShader.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.shaderSource = gl.shaderSource;\r\n\tgl.shaderSource = function (shader) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.shaderSource.apply(this, arguments);\r\n\t\tvar current = shader;\r\n\t\t(current && current._spidergl && current._spidergl._gl_shaderSource.apply(current._spidergl, arguments));\r\n\t}\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// texture\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\text.textureTargetMap = { };\r\n\text.textureTargetMap[gl.TEXTURE_2D                 ] = gl.TEXTURE_2D;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP           ] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_POSITIVE_X] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_NEGATIVE_X] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_POSITIVE_Y] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_NEGATIVE_Y] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_POSITIVE_Z] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_NEGATIVE_Z] = gl.TEXTURE_CUBE_MAP;\r\n\r\n\tglFunctions.deleteTexture = gl.deleteTexture;\r\n\tgl.deleteTexture = function (texture) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.deleteTexture.apply(this, arguments);\r\n\t\tvar current = texture;\r\n\t\t(current && current._spidergl && current._spidergl._gl_deleteTexture.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.isTexture = gl.isTexture;\r\n\tgl.isTexture = function (texture) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.isTexture.apply(this, arguments);\r\n\t\tvar current = texture;\r\n\t\t(current && current._spidergl && current._spidergl._gl_isTexture.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.bindTexture = gl.bindTexture;\r\n\tgl.bindTexture = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.bindTexture.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_bindTexture.apply(current._spidergl, arguments));\r\n\t};\r\n\r\n\tglFunctions.getTexParameter = gl.getTexParameter;\r\n\tgl.getTexParameter = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\tvar r = ext.glFunctions.getTexParameter.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_getTexParameter.apply(current._spidergl, arguments));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tglFunctions.copyTexImage2D = gl.copyTexImage2D;\r\n\tgl.copyTexImage2D = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.copyTexImage2D.apply(this, arguments);\r\n\t\tvar texTarget = ext.textureTargetMap[target];\r\n\t\tvar current = ext.cb.getCurrentTexture(texTarget);\r\n\t\t(current && current._spidergl && current._spidergl._gl_copyTexImage2D.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.copyTexSubImage2D = gl.copyTexSubImage2D;\r\n\tgl.copyTexSubImage2D = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.copyTexSubImage2D.apply(this, arguments);\r\n\t\tvar texTarget = ext.textureTargetMap[target];\r\n\t\tvar current = ext.cb.getCurrentTexture(texTarget);\r\n\t\t(current && current._spidergl && current._spidergl._gl_copyTexSubImage2D.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.generateMipmap = gl.generateMipmap;\r\n\tgl.generateMipmap = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.generateMipmap.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_generateMipmap.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.texImage2D = gl.texImage2D;\r\n\tgl.texImage2D = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.texImage2D.apply(this, arguments);\r\n\t\tvar texTarget = ext.textureTargetMap[target];\r\n\t\tvar current = ext.cb.getCurrentTexture(texTarget);\r\n\t\t(current && current._spidergl && current._spidergl._gl_texImage2D.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.texParameterf = gl.texParameterf;\r\n\tgl.texParameterf = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.texParameterf.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_texParameterf.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.texParameteri = gl.texParameteri;\r\n\tgl.texParameteri = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.texParameteri.apply(this, arguments);\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current && current._spidergl && current._spidergl._gl_texParameteri.apply(current._spidergl, arguments));\r\n\t}\r\n\r\n\tglFunctions.texSubImage2D = gl.texSubImage2D;\r\n\tgl.texSubImage2D = function (target) {\r\n\t\tvar ext = this._spidergl.wn._ext;\r\n\t\text.glFunctions.texSubImage2D.apply(this, arguments);\r\n\t\tvar texTarget = ext.textureTargetMap[target];\r\n\t\tvar current = ext.cb.getCurrentTexture(texTarget);\r\n\t\t(current && current._spidergl && current._spidergl._gl_texSubImage2D.apply(current._spidergl, arguments));\r\n\t}\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\treturn true;\r\n};\r\n\r\nSpiderGL.WebGL.Context._setup_SGL_direct_state_access = function (gl, pubExt) {\r\n\tif (!gl) return false;\r\n\tif (!pubExt) return false;\r\n\tif (!gl._spidergl) return false;\r\n\tif (gl._spidergl.dsa) return false;\r\n\r\n\tvar dsa = pubExt;\r\n\tvar ext = dsa._ext;\r\n\tvar glFunctions = ext.glFunctions;\r\n\r\n\text.cb = gl.getExtension(\"SGL_current_binding\");\r\n\tif (!ext.cb) return false;\r\n\r\n\t// buffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tdsa.getBufferParameter = function (buffer, target, pname) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current != buffer) && gl.bindBuffer(target, buffer);\r\n\t\tvar r = gl.getBufferParameter(target, pname);\r\n\t\t(current != buffer) && gl.bindBuffer(target, current);\r\n\t\treturn r;\r\n\t};\r\n\r\n\tdsa.bufferData = function (buffer, target, dataOrSize, usage) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current != buffer) && gl.bindBuffer(target, buffer);\r\n\t\tgl.bufferData(target, dataOrSize, usage);\r\n\t\t(current != buffer) && gl.bindBuffer(target, current);\r\n\t}\r\n\r\n\tdsa.bufferSubData = function (buffer, target, offset, data) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current != buffer) && gl.bindBuffer(target, buffer);\r\n\t\tgl.bufferSubData(target, offset, data);\r\n\t\t(current != buffer) && gl.bindBuffer(target, current);\r\n\t}\r\n\r\n\tdsa.vertexAttribPointer = function (buffer, indx, size, type, normalized, stride, offset) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar target  = gl.ARRAY_BUFFER;\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current != buffer) && gl.bindBuffer(target, buffer);\r\n\t\tgl.vertexAttribPointer(indx, size, type, normalized, stride, offset);\r\n\t\t(current != buffer) && gl.bindBuffer(target, current);\r\n\t};\r\n\r\n\tdsa.drawElements = function (buffer, mode, count, type, offset) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar target  = gl.ELEMENT_ARRAY_BUFFER;\r\n\t\tvar current = ext.cb.getCurrentBuffer(target);\r\n\t\t(current != buffer) && gl.bindBuffer(target, buffer);\r\n\t\tgl.drawElements(mode, count, type, offset);\r\n\t\t(current != buffer) && gl.bindBuffer(target, current);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// framebuffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tdsa.checkFramebufferStatus = function (framebuffer, target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, framebuffer);\r\n\t\tvar r = gl.checkFramebufferStatus(target);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, current);\r\n\t\treturn r;\r\n\t};\r\n\r\n\tdsa.getFramebufferAttachmentParameter = function (framebuffer, target, attachment, pname) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, framebuffer);\r\n\t\tvar r = gl.getFramebufferAttachmentParameter(target, attachment, pname);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, current);\r\n\t\treturn r;\r\n\t};\r\n\r\n\tdsa.framebufferRenderbuffer = function (framebuffer, target, attachment, renderbuffertarget, renderbuffer) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, framebuffer);\r\n\t\tgl.framebufferRenderbuffer(target, attachment, renderbuffertarget, renderbuffer);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, current);\r\n\t};\r\n\r\n\tdsa.framebufferTexture2D = function (framebuffer, target, attachment, textarget, texture, level) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, framebuffer);\r\n\t\tgl.framebufferTexture2D(target, attachment, textarget, texture, level);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, current);\r\n\t};\r\n\r\n\tdsa.clear = function (framebuffer, mask) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar target = gl.FRAMEBUFFER\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, framebuffer);\r\n\t\tgl.clear(mask);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, current);\r\n\t};\r\n\r\n\tdsa.readPixels = function (framebuffer, x, y, width, height, format, type, pixels) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar target = gl.FRAMEBUFFER\r\n\t\tvar current = ext.cb.getCurrentFramebuffer(target);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, framebuffer);\r\n\t\tgl.readPixels(x, y, width, height, format, type, pixels);\r\n\t\t(current != framebuffer) && gl.bindFramebuffer(target, current);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// program\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tdsa.uniform1f = function (program, location, x) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform1f(location, x);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform1fv = function (program, location, v) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform1fv(location, v);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform1i = function (program, location, x) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform1i(location, x);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform1iv = function (program, location, v) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform1iv(location, v);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform2f = function (program, location, x, y) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform2f(location, x, y);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform2fv = function (program, location, v) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform2fv(location, v);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform2i = function (program, location, x, y) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform2i(location, x, y);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform2iv = function (program, location, v) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform2iv(location, v);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform3f = function (program, location, x, y, z) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform3f(location, x, y, z);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform3fv = function (program, location, v) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform3fv(location, v);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform3i = function (program, location, x, y, z) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform3i(location, x, y, z);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform3iv = function (program, location, v) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform3iv(location, v);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform4f = function (program, location, x, y, z, w) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform4f(location, x, y, z, w);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform4fv = function (program, location, v) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform4fv(location, v);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform4i = function (program, location, x, y, z, w) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform4i(location, x, y, z, w);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniform4iv = function (program, location, v) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniform4iv(location, v);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniformMatrix2fv = function (program, location, transpose, value) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniformMatrix2fv(location, transpose, value);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniformMatrix3fv = function (program, location, transpose, value) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniformMatrix3fv(location, transpose, value);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\r\n\tdsa.uniformMatrix4fv = function (program, location, transpose, value) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentProgram();\r\n\t\t(current != program) && gl.useProgram(program);\r\n\t\tgl.uniformMatrix4fv(location, transpose, value);\r\n\t\t(current != program) && gl.useProgram(current);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// renderbuffer\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\tdsa.getRenderbufferParameter = function (renderbuffer, target, pname) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentRenderbuffer(target);\r\n\t\t(current != renderbuffer) && gl.bindRenderbuffer(target, renderbuffer);\r\n\t\tvar r = gl.getRenderbufferParameter.call(gl, target, pname);\r\n\t\t(current != renderbuffer) && gl.bindRenderbuffer(target, current);\r\n\t\treturn r;\r\n\t};\r\n\r\n\tdsa.renderbufferStorage = function (renderbuffer, target, internalformat, width, height) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentRenderbuffer(target);\r\n\t\t(current != renderbuffer) && gl.bindRenderbuffer(target, renderbuffer);\r\n\t\tgl.renderbufferStorage(target, internalformat, width, height);\r\n\t\t(current != renderbuffer) && gl.bindRenderbuffer(target, current);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// shader\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\t// NO DSA FUNCTIONS\r\n\tdsa.shaderIsNull = function (shader) {\r\n\t\treturn (shader == null);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n\t// texture\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\text.textureTargetMap = { };\r\n\text.textureTargetMap[gl.TEXTURE_2D                 ] = gl.TEXTURE_2D;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP           ] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_POSITIVE_X] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_NEGATIVE_X] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_POSITIVE_Y] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_NEGATIVE_Y] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_POSITIVE_Z] = gl.TEXTURE_CUBE_MAP;\r\n\text.textureTargetMap[gl.TEXTURE_CUBE_MAP_NEGATIVE_Z] = gl.TEXTURE_CUBE_MAP;\r\n\r\n\tdsa.getTexParameter = function (texture, target, pname) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current != texture) && gl.bindTexture(target, texture);\r\n\t\tvar r = gl.getTexParameter(target, pname);\r\n\t\t(current != texture) && gl.bindTexture(target, current);\r\n\t\treturn r;\r\n\t};\r\n\r\n\tdsa.copyTexImage2D = function (texture, target, level, internalformat, x, y, width, height, border) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar texTarget = ext.textureTargetMap[target];\r\n\t\tvar current = ext.cb.getCurrentTexture(texTarget);\r\n\t\t(current != texture) && gl.bindTexture(texTarget, texture);\r\n\t\tgl.copyTexImage2D(target, level, internalformat, x, y, width, height, border);\r\n\t\t(current != texture) && gl.bindTexture(texTarget, current);\r\n\t};\r\n\r\n\tdsa.copyTexSubImage2D = function (texture, target, level, xoffset, yoffset, x, y, width, height, border) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar texTarget = ext.textureTargetMap[target];\r\n\t\tvar current = ext.cb.getCurrentTexture(texTarget);\r\n\t\t(current != texture) && gl.bindTexture(texTarget, texture);\r\n\t\tgl.copyTexSubImage2D(target, level, xoffset, yoffset, x, y, width, height, border);\r\n\t\t(current != texture) && gl.bindTexture(texTarget, current);\r\n\t};\r\n\r\n\tdsa.generateMipmap = function (texture, target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current != texture) && gl.bindTexture(target, texture);\r\n\t\tgl.generateMipmap(target);\r\n\t\t(current != texture) && gl.bindTexture(target, current);\r\n\t};\r\n\r\n\tdsa.texImage2D = function (texture, target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar texTarget = ext.textureTargetMap[target];\r\n\t\tvar current = ext.cb.getCurrentTexture(texTarget);\r\n\t\t(current != texture) && gl.bindTexture(texTarget, texture);\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\t\tgl.texImage2D.apply(gl, args);\r\n\t\t(current != texture) && gl.bindTexture(texTarget, current);\r\n\t};\r\n\r\n\tdsa.texParameterf = function (texture, target, pname, param) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current != texture) && gl.bindTexture(target, texture);\r\n\t\tgl.texParameterf(target, pname, param);\r\n\t\t(current != texture) && gl.bindTexture(target, current);\r\n\t};\r\n\r\n\tdsa.texParameteri = function (texture, target, pname, param) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar current = ext.cb.getCurrentTexture(target);\r\n\t\t(current != texture) && gl.bindTexture(target, texture);\r\n\t\tgl.texParameteri(target, pname, param);\r\n\t\t(current != texture) && gl.bindTexture(target, current);\r\n\t};\r\n\r\n\tdsa.texSubImage2D = function (texture, target) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar texTarget = ext.textureTargetMap[target];\r\n\t\tvar current = ext.cb.getCurrentTexture(texTarget);\r\n\t\t(current != texture) && gl.bindTexture(texTarget, texture);\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\t\tgl.texSubImage2D.apply(gl, args);\r\n\t\t(current != texture) && gl.bindTexture(texTarget, current);\r\n\t};\r\n\r\n\tdsa.bindTexture = function (unit, target, texture) {\r\n\t\tvar ext = this._ext;\r\n\t\tvar gl  = ext.gl;\r\n\t\tvar cb = ext.cb;\r\n\t\tvar currentUnit = cb.getCurrentTextureUnit();\r\n\t\t(currentUnit != unit) && gl.activeTexture(unit);\r\n\t\tgl.bindTexture(target, texture);\r\n\t\t(currentUnit != unit) && gl.activeTexture(currentUnit);\r\n\t};\r\n\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\treturn true;\r\n};\r\n\r\n/**\r\n * Hijacks a WebGLRenderingContext for SpiderGL.WebGL.ObjectGL wrappers.\r\n *\r\n * The WebGLRenderingContext is modified to allow SpiderGL.WebGL.ObjectGL wrappers to be edited without explicit bind and without affecting the WebGL object bindings.\r\n * Most WebGL objects follow the \"bind to edit\" / \"bind to use\" paradigm.\r\n * This means that the object must be bound to the WebGL context to modify some parameter or its resource data.\r\n * As a side effect, binding the object just to modify it has the same result of binding it to be used during rendering.\r\n * To prevent this side effect, all the WebGLRenderingContext functions that bind and modify object parameters or data, as long as the rendering functions, are wrapped.\r\n * This allows SpiderGL wrappers (derived from {@link SpiderGL.WebGL.ObjectGL}) to be edited without affecting the binding state of the WebGLRenderingContext.prototype.\r\n * The following example clarifies how bindings are handled.\r\n *\r\n * @example\r\n * var textureA = gl.createTexture();\r\n * gl.bindTexture(gl.TEXTURE_2D, textureA);\r\n * gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n * // other texture calls\r\n * var textureB = new SpiderGL.WebGL.Texture2D(gl, parameters);\r\n * textureB.minFilter = gl.LINEAR; // textureB is hiddenly bound to modify the minification filter\r\n * gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR); // textureA is automatically re-bound to keep WebGL semantic\r\n * textureB.magFilter = gl.LINEAR; // textureB is hiddenly bound to modify another parameter\r\n * gl.drawArrays(gl.TRIANGLES, 0, 3); // textureA is automatically re-bound to keep WebGL semantic\r\n * textureB.bind(); // bind textureB to WebGL, breaking the binding with textureA\r\n * gl.drawArrays(gl.TRIANGLES, 0, 3); // textureA is used\r\n *\r\n * @param {WebGLRenderingContext} gl The WebGLRenderingContext to modify.\r\n *\r\n * @returns {bool} True on success, false if the gl argument is not valid or has already been modified.\r\n *\r\n * @see SpiderGL.WebGL.Context.isHijacked\r\n * @see SpiderGL.WebGL.Context.getHijacked\r\n * @see SpiderGL.WebGL.Context.get\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.Context.hijack = function (gl) {\r\n//\tif (!SpiderGL.Type.instanceOf(gl, WebGLRenderingContext)) { return false; }\r\n\tif (gl._spidergl) { return false; }\r\n\r\n\tSpiderGL.WebGL.Context._prepareContex(gl);\r\n\r\n\tSpiderGL.WebGL.Context._addExtension(gl, \"SGL_current_binding\",     \"cb\",  SpiderGL.WebGL.Context._setup_SGL_current_binding);\r\n\tSpiderGL.WebGL.Context._addExtension(gl, \"SGL_wrapper_notify\",      \"wn\",  SpiderGL.WebGL.Context._setup_SGL_wrapper_notify);\r\n\tSpiderGL.WebGL.Context._addExtension(gl, \"SGL_direct_state_access\", \"dsa\", SpiderGL.WebGL.Context._setup_SGL_direct_state_access);\r\n\r\n\tvar cb  = gl.getExtension(\"SGL_current_binding\"    );\r\n\tvar wn  = gl.getExtension(\"SGL_wrapper_notify\"     );\r\n\tvar dsa = gl.getExtension(\"SGL_direct_state_access\");\r\n\r\n\tvar hijacked = (!!cb && !!wn && !!dsa);\r\n\r\n\treturn hijacked;\r\n}\r\n\r\n/**\r\n * Tests whether a WebGLRenderingContext is hijacked.\r\n *\r\n * The WebGLRenderingContext is hijacked after a successful call to {@link SpiderGL.WebGL.Context.hijack}.\r\n *\r\n * @param {WebGLRenderingContext} gl The WebGLRenderingContext to test.\r\n *\r\n * @returns {bool} True on success, false if the gl argument is not valid or has already been modified.\r\n *\r\n * @see SpiderGL.WebGL.Context.hijack\r\n * @see SpiderGL.WebGL.Context.getHijacked\r\n * @see SpiderGL.WebGL.Context.get\r\n */\r\nSpiderGL.WebGL.Context.isHijacked = function (gl) {\r\n\treturn !!gl && !!gl._spidergl;\r\n\treturn (SpiderGL.Type.instanceOf(gl, WebGLRenderingContext) && gl._spidergl);\r\n}\r\n\r\n/**\r\n * Creates a WebGLRenderingContext and hijacks it.\r\n *\r\n * The WebGLRenderingContext obtained from the canvas parameter with optional arguments is hijacked.\r\n *\r\n * @param {HTMLCanvasElement} canvas The HTMLCanvasElement from which retrieve the WebGL context.\r\n * @param {object} args The optional WebGL context arguments.\r\n *\r\n * @returns {WebGLRenderingContext} The hijacked canvas WebGL rendering context.\r\n *\r\n * @see SpiderGL.WebGL.Context.get\r\n * @see SpiderGL.WebGL.Context.getHijacked\r\n * @see SpiderGL.WebGL.Context.isHijacked\r\n */\r\nSpiderGL.WebGL.Context.getHijacked = function (canvas, args) {\r\n\tvar gl = SpiderGL.WebGL.Context.get(canvas, args);\r\n\tSpiderGL.WebGL.Context.hijack(gl);\r\n\treturn gl;\r\n}\r\n\r\n/**\r\n * Sets pixel store unpack parameters to standard OpenGL SpiderGL values.\r\n * The parameters to be set are UNPACK_FLIP_Y_WEBGL (true), UNPACK_PREMULTIPLY_ALPHA_WEBGL (false) and UNPACK_COLORSPACE_CONVERSION_WEBGL (WebGLRenderingContext.prototype.NONE).\r\n *\r\n * @param {WebGLRenderingContext} gl The target WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.Context.setStandardGLUnpack = function (gl) {\r\n\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,                true);\r\n\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,     false);\r\n\tgl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, WebGLRenderingContext.prototype.NONE);\r\n}\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.ObjectGL.\r\n *\r\n * SpiderGL.WebGL.ObjectGL is the base class for every WebObjectGL wrapper and must not be directly used.\r\n * In general, every SpiderGL.WebGL.ObjectGL-derived constructor takes two arguments: a hijacked WebGLRenderingContext (\"gl\")\r\n * and an optional object argument (\"options\") that is used to wrap an existing native WebObjectGL and to set object-specific parameters or data.\r\n * If the options parameter has a propery named \"handle\" referencing a WebObjectGL, the constructed SpiderGL.WebGL.ObjectGL will use the provided WebObjectGL as the underlying resource.\r\n * Otherwise, a new WebObjectGL is created. In both cases, the internal WebObjectGL can be accessed with the {@link handle} read-only property and directly used in WebGLRenderingContext calls.\r\n * With a notification mechanism built into the hijacked WebGLRenderingContext, every direct access is communicated to the wrapper to keep up-to-date the internal state of the wrapper.\r\n *\r\n * @example\r\n * // create a native vertex WebGLBuffer\r\n * var vbo = gl.createBuffer();\r\n * gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\r\n * // ... use buffer ...\r\n * // create a SpiderGL wrapper from an existing object;\r\n * // the native object can be accessed through the \"handle\" property.\r\n * var wrappedVBO = new SpiderGL.WebGL.VertexBuffer(gl, {handle: vbo});\r\n * // it is not mandatory to bind the object before setting parameters or data\r\n * as the hijacked WebGLRendering context takes care of it and does not break previous bindings\r\n * wrappedVBO.setSize(sizeInBytes, gl.STATIC_DRAW);\r\n * wrappedVBO.bind(); // equivalent to gl.bindBuffer(gl.ARRAY_BUFFER, wrappedVBO.handle)\r\n * // create another SpiderGL.WebGL.VertexBuffer without specifying an existing object,\r\n * // thus letting the wrapper to create one\r\n * var anotherVBO = new SpiderGL.WebGL.VertexBuffer(gl, {size: someSizeInBytes});\r\n *\r\n * @class The SpiderGL.WebGL.ObjectGL is the base class for all WebGL object wrappers.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {number} target The WebObjectGL default target.\r\n * @param {object} [options] Object-specific parameters.\r\n */\r\nSpiderGL.WebGL.ObjectGL = function (gl, target, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\thandle : null\r\n\t}, options);\r\n\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\tvar wn = gl.getExtension(\"SGL_wrapper_notify\");\r\n\r\n\tthis._gl  = gl;\r\n\tthis._cb  = gl.getExtension(\"SGL_current_binding\");\r\n\tthis._dsa = gl.getExtension(\"SGL_direct_state_access\");\r\n\r\n\tthis._h = options.handle;\r\n\tthis._t = target;\r\n}\r\n\r\n/**\r\n * Default WebObjectGL target.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.NONE\r\n */\r\nSpiderGL.WebGL.ObjectGL.TARGET = WebGLRenderingContext.prototype.NONE;\r\n\r\n/**\r\n * Generic null WebObjectGL binding.\r\n *\r\n * This function is empty and provided only for completeness.\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.ObjectGL.unbind = function (gl) { };\r\n\r\nSpiderGL.WebGL.ObjectGL.prototype = {\r\n\t/**\r\n\t * The WebGLRenderingContext used at costruction.\r\n\t *\r\n\t * @type WebGLRenderingContext\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #handle\r\n\t */\r\n\tget gl() {\r\n\t\treturn this._gl;\r\n\t},\r\n\r\n\t/**\r\n\t * The native WebObjectGL.\r\n\t *\r\n\t * The native handle can be used with WebGLRenderingContext methods.\r\n\t *\r\n\t * @type WebObjectGL\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see #gl\r\n\t */\r\n\tget handle() {\r\n\t\treturn this._h;\r\n\t},\r\n\r\n\t/**\r\n\t * The WebObjectGL default target.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget target() {\r\n\t\treturn this._t;\r\n\t},\r\n\r\n\t/**\r\n\t * Tests for non-null handle.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget isValid() {\r\n\t\treturn (this._h != null);\r\n\t},\r\n\r\n\t/* *\r\n\t * Tests for empty object.\r\n\t * It is reimplemented on each derived classes with object-specific semantic.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\t/*\r\n\tget isEmpty () {\r\n\t\treturn true;\r\n\t},\r\n\t*/\r\n\r\n\t/**\r\n\t * Tests if the object is ready to use.\r\n\t * It is reimplemented on each derived classes with object-specific semantic.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget isReady () {\r\n\t\treturn false;\r\n\t},\r\n\r\n\t/**\r\n\t * Destroys the wrapped WebObjectGL.\r\n\t *\r\n\t * After calling this method, the object must not be accessed anymore.\r\n\t */\r\n\tdestroy : function () {\r\n\t},\r\n\r\n\t/**\r\n\t * Binds the object to the rendering pipeline.\r\n\t *\r\n\t * The wrapped WebObjectGL is bound to its default target in the WebGLRenderingContext.prototype.\r\n\t */\r\n\tbind : function () {\r\n\t},\r\n\r\n\t/**\r\n\t * Binds the null object to the rendering pipeline.\r\n\t *\r\n\t * This method is provided for symmetry with {@link SpiderGL.WebGL.ObjectGL#bind}. It binds the null object to the per-object webGL target.\r\n\t */\r\n\tunbind : function () {\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.ObjectGL, SpiderGL.Core.ObjectBase);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.Buffer.\r\n *\r\n * SpiderGL.WebGL.Buffer is the base class for WebGLBuffer object wrappers ({@link SpiderGL.WebGL.VertexBuffer} and {@link SpiderGL.WebGL.IndexBuffer}) and must not be directly used.\r\n * When passing data or size with the options parameter, the data field will have precedence on the size field, which will be ignored.\r\n *\r\n * @class The SpiderGL.WebGL.Buffer is the base class for all WebGLBuffer object wrappers, i.e. {@link SpiderGL.WebGL.VertexBuffer} and {@link SpiderGL.WebGL.IndexBuffer}.\r\n *\r\n * @augments SpiderGL.WebGL.ObjectGL\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {number} target The WebGLBuffer target. It must be either WebGLRenderingContext.prototype.ARRAY_BUFFER or WebGLRenderingContext.prototype.ELEMENT_ARRAY_BUFFER.\r\n * @param {object} [options] Optional parameters.\r\n * @param {WebGLBuffer} [options.handle] If defined, the provided buffer will be wrapped and its size and usage attributes will be queried to the rendering context. Otherwise an internal buffer will be created.\r\n * @param {ArrayBuffer|ArrayBufferView} [options.data] Buffer content to be set with WebGLRenderingContext.prototype.bufferData (see {@link setData}). If present, the data will be set both if a handle is provided or internally created.\r\n * @param {number} [options.size] Buffer size to be set with WebGLRenderingContext.prototype.bufferData (see {@link setData}). If present, it will be set both if a handle is provided or internally created. If data parameter is present, the size field is ignored.\r\n * @param {number} [options.usage=SpiderGL.WebGL.Buffer.DEFAULT_USAGE] WebGL buffer usage hint parameter for WebGLRenderingContext.prototype.bufferData.\r\n *\r\n * @example\r\n * // create a vertex buffer with a specified size\r\n * var vbuff = new SpiderGL.WebGL.VertexBuffer(gl, {\r\n * \tsize  : 2 * 1024 * 1024,  // 2 MB\r\n * \tusage : gl.STATIC_DRAW    // if omitted, defaults to SpiderGL.WebGL.Buffer.DEFAULT_USAGE\r\n * });\r\n *\r\n * // create an index buffer with content\r\n * var ibuff = new SpiderGL.WebGL.IndexBuffer(gl, {\r\n * \tdata : new Uint16Array(...)  // use a typed array for setting buffer data\r\n * });\r\n *\r\n * @see SpiderGL.WebGL.ObjectGL\r\n * @see SpiderGL.WebGL.VertexBuffer\r\n * @see SpiderGL.WebGL.IndexBuffer\r\n */\r\nSpiderGL.WebGL.Buffer = function (gl, target, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\r\n\tif (SpiderGL.Type.instanceOf(options, WebGLBuffer)) {\r\n\t\toptions = { handle : options };\r\n\t}\r\n\telse if (SpiderGL.Type.instanceOf(options, ArrayBuffer) || SpiderGL.Type.isTypedArray(options)) {\r\n\t\toptions = { data : options };\r\n\t}\r\n\telse if (SpiderGL.Type.isNumber(options)) {\r\n\t\toptions = { size : options };\r\n\t}\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\thandle : null,\r\n\t\tdata   : null,\r\n\t\tsize   : 0,\r\n\t\tusage  : SpiderGL.WebGL.Buffer.DEFAULT_USAGE\r\n\t}, options);\r\n\r\n\tSpiderGL.WebGL.ObjectGL.call(this, gl, target, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n\r\n\tvar gl  = this._gl;\r\n\tvar cb  = this._cb;\r\n\tvar dsa = this._dsa;\r\n\r\n\tvar t = this._t;\r\n\tvar h = this._h;\r\n\r\n\tcb.pushBuffer(t);\r\n\tif (h) {\r\n\t\tgl.bindBuffer(t, h);\r\n\t\toptions.size  = gl.getBufferParameter(t, gl.BUFFER_SIZE);\r\n\t\toptions.usage = gl.getBufferParameter(t, gl.BUFFER_USAGE);\r\n\t}\r\n\telse {\r\n\t\th = gl.createBuffer();\r\n\t\tgl.bindBuffer(t, h);\r\n\t\tthis._h = h;\r\n\t}\r\n\tcb.popBuffer(t);\r\n\th._spidergl = this;\r\n\r\n\tthis._size   = options.size;\r\n\tthis._usage  = options.usage;\r\n\r\n\tif (options.data) {\r\n\t\tthis.setData(options.data, options.usage);\r\n\t}\r\n\telse if (options.size) {\r\n\t\tthis.setSize(options.size, options.usage);\r\n\t}\r\n}\r\n\r\n/**\r\n * Default WebGLBuffer target.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.NONE\r\n */\r\nSpiderGL.WebGL.Buffer.TARGET = WebGLRenderingContext.prototype.NONE;\r\n\r\n/**\r\n * Default usage hint when specifying buffer size or data.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.STATIC_DRAW\r\n */\r\nSpiderGL.WebGL.Buffer.DEFAULT_USAGE = WebGLRenderingContext.prototype.STATIC_DRAW;\r\n\r\n/**\r\n * Default buffer offset when specifying buffer subdata.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.Buffer.DEFAULT_SUB_DATA_OFFSET = 0;\r\n\r\n/**\r\n * Generic WebGLBuffer unbinding.\r\n *\r\n * This function is empty and it is provided only for completeness.\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.Buffer.unbind = function (gl) { };\r\n\r\nSpiderGL.WebGL.Buffer.prototype = {\r\n\t_gl_deleteBuffer : function () {\r\n\t\tthis._h = null;\r\n\t},\r\n\r\n\t_gl_isBuffer : function () {\r\n\t},\r\n\r\n\t_gl_bindBuffer : function () {\r\n\t},\r\n\r\n\t_gl_getBufferParameter : function () {\r\n\t},\r\n\r\n\t_gl_bufferData : function () {\r\n\t\tvar sizeOrData = arguments[1];\r\n\t\tvar usage = arguments[2];\r\n\t\tthis._size = (SpiderGL.Type.isNumber(sizeOrData)) ? (sizeOrData) : (sizeOrData.byteLength);\r\n\t\tthis._usage = usage;\r\n\t},\r\n\r\n\t_gl_bufferSubData : function () {\r\n\t},\r\n\r\n\t_gl_vertexAttribPointer : function () {\r\n\t},\r\n\r\n\t_gl_drawElements : function () {\r\n\t},\r\n\r\n\t/* *\r\n\t * Tests for empty buffer.\r\n\t * It is true if the buffer size is greather than zero, false otherwise.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\t/*\r\n\tget isEmpty() { return (this._size <= 0); },\r\n\t*/\r\n\r\n\t/**\r\n\t * Tests if the buffer is ready to use.\r\n\t * A buffer is considered ready if its size is greater than zero.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget isReady () {\r\n\t\treturn (this._size > 0);\r\n\t},\r\n\r\n\t/**\r\n\t * The size in bytes of the buffer.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget size() {\r\n\t\treturn this._size;\r\n\t},\r\n\r\n\t/**\r\n\t * The usage hint of the WebGLBuffer.\r\n\t * It refers to the usage hint as specified in WebGLRenderingContext.prototype.bufferData().\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget usage() {\r\n\t\treturn this._usage;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the buffer size and usage.\r\n\t * The buffer is set up with specified size and usage.\r\n\t *\r\n\t * @param {number} size The buffer size.\r\n\t * @param {number} [usage=SpiderGL.WebGL.Buffer.DEFAULT_USAGE] WebGL buffer usage hint.\r\n\t *\r\n\t * @see setData\r\n\t */\r\n\tsetSize : function (size, usage) {\r\n\t\tusage = SpiderGL.Utility.getDefaultValue(usage, SpiderGL.WebGL.Buffer.DEFAULT_USAGE);\r\n\t\tthis._dsa.bufferData(this._h, this._t, size, usage);\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the buffer data and usage.\r\n\t * The buffer is set up with specified data and usage.\r\n\t *\r\n\t * @param {ArrayBuffer|ArrayBufferView} data The buffer data.\r\n\t * @param {number} [usage=SpiderGL.WebGL.Buffer.DEFAULT_USAGE] WebGL buffer usage hint.\r\n\t *\r\n\t * @see setSubData\r\n\t * @see setSize\r\n\t */\r\n\tsetData : function (data, usage) {\r\n\t\tusage = SpiderGL.Utility.getDefaultValue(usage, SpiderGL.WebGL.Buffer.DEFAULT_USAGE);\r\n\t\tthis._dsa.bufferData(this._h, this._t, data, usage);\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a range of the buffer data.\r\n\t * A range of buffer content can be set by specifying the starting offset and the typed array of values.\r\n\t *\r\n\t * @param {ArrayBuffer|ArrayBufferView} data The buffer sub data.\r\n\t * @param {number} [offset=SpiderGL.WebGL.Buffer.DEFAULT_SUB_DATA_OFFSET] The range starting offset, in bytes.\r\n\t *\r\n\t * @see setData\r\n\t */\r\n\tsetSubData : function (data, offset) {\r\n\t\toffset = SpiderGL.Utility.getDefaultValue(offset, SpiderGL.WebGL.Buffer.DEFAULT_SUB_DATA_OFFSET);\r\n\t\tthis._dsa.bufferSubData(this._h, this._t, offset, data);\r\n\t},\r\n\r\n\t/**\r\n\t * Destroys the WebGLBuffer.\r\n\t * After destruction, the handle is set to null and this object should not be used anymore.\r\n\t *\r\n\t * @see SpiderGL.WebGL.ObjectGL#destroy\r\n\t */\r\n\tdestroy : function () {\r\n\t\tthis._gl.deleteBuffer(this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Binds the wrapped WebGLBuffer to the appropriate target.\r\n\t * The used target is set by the derived objects {@link SpiderGL.WebGL.VertexBuffer} and {@link SpiderGL.WebGL.IndexBuffer}.\r\n\t *\r\n\t * @see unbind\r\n\t */\r\n\tbind : function () {\r\n\t\tthis._gl.bindBuffer(this._t, this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Binds \"null\" to the appropriate target.\r\n\t * This method is provided only for simmetry with {@link bind} and is not relative to the object state.\r\n\t *\r\n\t * @see bind\r\n\t */\r\n\tunbind : function () {\r\n\t\tthis._gl.bindBuffer(this._t, null);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.Buffer, SpiderGL.WebGL.ObjectGL);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.VertexBuffer.\r\n *\r\n * SpiderGL.WebGL.VertexBuffer represents a wrapper for a WebGLBuffer to be bound to the WebGLRenderingContext.prototype.ARRAY_BUFFER target.\r\n *\r\n * @class The SpiderGL.WebGL.VertexBuffer is WebGLBuffer wrapper for vertex buffers.\r\n *\r\n * @augments SpiderGL.WebGL.Buffer\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] See {@link SpiderGL.WebGL.Buffer}.\r\n *\r\n * @see SpiderGL.WebGL.Buffer\r\n * @see SpiderGL.WebGL.IndexBuffer\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.VertexBuffer = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\tSpiderGL.WebGL.Buffer.call(this, gl, SpiderGL.WebGL.VertexBuffer.TARGET, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n}\r\n\r\n/**\r\n * WebGL target for vertex buffers.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.ARRAY_BUFFER\r\n */\r\nSpiderGL.WebGL.VertexBuffer.TARGET = WebGLRenderingContext.prototype.ARRAY_BUFFER;\r\n\r\n/**\r\n * Default vertex attribute index when using SpiderGL.WebGL.VertexBuffer#vertexAttribPointer.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_INDEX = 0;\r\n\r\n/**\r\n * Default vertex attribute size when using SpiderGL.WebGL.VertexBuffer#vertexAttribPointer.\r\n *\r\n * @type number\r\n *\r\n * @default 3\r\n */\r\nSpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_SIZE = 3;\r\n\r\n/**\r\n * Default vertex attribute type when using SpiderGL.WebGL.VertexBuffer#vertexAttribPointer.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.FLOAT\r\n */\r\nSpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_TYPE = WebGLRenderingContext.prototype.FLOAT;\r\n\r\n/**\r\n * Default vertex attribute normalized flag when using SpiderGL.WebGL.VertexBuffer#vertexAttribPointer.\r\n *\r\n * @type bool\r\n *\r\n * @default false\r\n */\r\nSpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_NORMALIZED = false;\r\n\r\n/**\r\n * Default vertex attribute stride when using SpiderGL.WebGL.VertexBuffer#vertexAttribPointer.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_STRIDE = 0;\r\n\r\n/**\r\n * Default vertex attribute offset when using SpiderGL.WebGL.VertexBuffer#vertexAttribPointer.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_OFFSET = 0;\r\n\r\n/**\r\n * Default enable flag for vertex attribute when using SpiderGL.WebGL.VertexBuffer#vertexAttribPointer.\r\n *\r\n * @type bool\r\n *\r\n * @default true\r\n */\r\nSpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_ENABLE = true;\r\n\r\n/**\r\n * WebGLBuffer unbinding for vertex buffers.\r\n *\r\n * This function binds the null buffer to the WebGLRenderingContext.prototype.ARRAY_BUFFER target.\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.VertexBuffer.unbind = function (gl) { gl.bindBuffer(SpiderGL.WebGL.VertexBuffer.TARGET, null); };\r\n\r\nSpiderGL.WebGL.VertexBuffer.prototype = {\r\n\t/**\r\n\t * Latches the WebGL vertex attribute pointer with the internal buffer.\r\n\t * The effect of this method is to bind the SpiderGL.WebGL.VertexBuffer and call WebGLRenderingContext.prototype.vertexAttribPointer() with the provided parameters.\r\n\t *\r\n\t * @param {object} [options] Vertex attribute pointer parameters.\r\n\t * @param {number} [options.index=SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_INDEX] Attribute index.\r\n\t * @param {number} [options.size=SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_SIZE] Attribute size.\r\n\t * @param {number} [options.type=SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_TYPE] Attribute base type.\r\n\t * @param {number} [options.normalized=SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_NORMALIZED] True if the attribute has an integer type and must be normalized.\r\n\t * @param {number} [options.stride=SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_STRIDE] Bytes from the beginning of an element and the beginning of the next one.\r\n\t * @param {number} [options.offset=SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_OFFSET] Offset (in bytes) from the start of the buffer.\r\n\t * @param {bool} [options.enable=SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_ENABLE] If true, the index-th vertex attribute array will be enabled with WebGLRenderingContext.prototype.enableVertexAttribArray(index).\r\n\t *\r\n\t * @example\r\n\t * var vb = new SpiderGL.WebGL.VertexBuffer(...); // create a vertex buffer\r\n\t * // [... set vb data ...]\r\n\t * // calling vb.vertexAttribPointer has the same effect of:\r\n\t * // vb.bind();\r\n\t * // gl.vertexAttribPointer(positionAttributeIndex, 3, gl.FLOAT, false, 0, 0);\r\n\t * // gl.enableVertexAttribArray(positionAttributeIndex);\r\n\t * vb.vertexAttribPointer({\r\n\t * \tindex      : positionAttributeIndex,  // if omitted, defaults to SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_INDEX\r\n\t * \tsize       : 3,         // if omitted, defaults to SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_SIZE\r\n\t * \tglType     : gl.FLOAT,  // if omitted, defaults to SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_TYPE\r\n\t * \tnormalized : false,     // if omitted, defaults to SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_NORMALIZED\r\n\t * \tstride     : 0,         // if omitted, defaults to SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_STRIDE\r\n\t * \toffset     : 0,         // if omitted, defaults to SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_OFFSET\r\n\t * \tenable     : true       // if omitted, defaults to SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_ENABLE\r\n\t * });\r\n\t */\r\n\tvertexAttribPointer : function (options) {\r\n\t\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tindex      : SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_INDEX,\r\n\t\t\tsize       : SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_SIZE,\r\n\t\t\tglType     : SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_TYPE,\r\n\t\t\tnormalized : SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_NORMALIZED,\r\n\t\t\tstride     : SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_STRIDE,\r\n\t\t\toffset     : SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_OFFSET,\r\n\t\t\tenable     : SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_ENABLE\r\n\t\t}, options);\r\n\r\n\t\tthis._dsa.vertexAttribPointer(this._h, options.index, options.size, options.glType, options.normalized, options.stride, options.offset);\r\n\t\tif (options.enable) {\r\n\t\t\tthis._gl.enableVertexAttribArray(options.index);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.VertexBuffer, SpiderGL.WebGL.Buffer);\r\n\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.IndexBuffer.\r\n *\r\n * SpiderGL.WebGL.IndexBuffer represents a wrapper for a WebGLBuffer to be bound to the WebGLRenderingContext.prototype.ELEMENT_ARRAY_BUFFER target.\r\n *\r\n * @class The SpiderGL.WebGL.IndexBuffer is WebGLBuffer wrapper for index buffers.\r\n *\r\n * @augments SpiderGL.WebGL.Buffer\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] See {@link SpiderGL.WebGL.Buffer}.\r\n *\r\n * @see SpiderGL.WebGL.Buffer\r\n * @see SpiderGL.WebGL.VertexBuffer\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.IndexBuffer = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\tSpiderGL.WebGL.Buffer.call(this, gl, SpiderGL.WebGL.IndexBuffer.TARGET, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n}\r\n\r\n/**\r\n * WebGL target for index buffers.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.ELEMENT_ARRAY_BUFFER\r\n */\r\nSpiderGL.WebGL.IndexBuffer.TARGET = WebGLRenderingContext.prototype.ELEMENT_ARRAY_BUFFER;\r\n\r\n/**\r\n * Default elements draw mode when using SpiderGL.WebGL.IndexBuffer#drawElements.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.TRIANGLES\r\n */\r\nSpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_MODE  = WebGLRenderingContext.prototype.TRIANGLES;\r\n\r\n/**\r\n * Default elements count when using SpiderGL.WebGL.IndexBuffer#drawElements.\r\n * A negative value causes the calculation of the maximum number of elements given the buffer size, offset and index type.\r\n *\r\n * @type number\r\n *\r\n * @default -1\r\n */\r\nSpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_COUNT  = -1;\r\n\r\n/**\r\n * Default index type when using SpiderGL.WebGL.IndexBuffer#drawElements.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.UNSIGNED_SHORT\r\n */\r\nSpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_TYPE = WebGLRenderingContext.prototype.UNSIGNED_SHORT;\r\n\r\n/**\r\n * Default index buffer offset when using SpiderGL.WebGL.IndexBuffer#drawElements.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_OFFSET = 0;\r\n\r\n/**\r\n * WebGLBuffer unbinding for index buffers.\r\n *\r\n * This function binds the null buffer to the WebGLRenderingContext.prototype.ELEMENT_ARRAY_BUFFER target.\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.IndexBuffer.unbind = function (gl) { gl.bindBuffer(SpiderGL.WebGL.IndexBuffer.TARGET, null); };\r\n\r\nSpiderGL.WebGL.IndexBuffer.prototype = {\r\n\t/**\r\n\t * Binds the index buffers and calls WebGLRenderingContext.prototype.drawElements with the provided parameters.\r\n\t *\r\n\t * @param {object} [options] Draw parameters.\r\n\t * @param {number} [options.glMode=SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_MODE] The WebGL primitive type.\r\n\t * @param {number} [options.count=SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_COUNT] Number of elements to draw. If less than or equal to zero, its value will be calculated as the maximum number of stored indices, based on offset, buffer size and index type.\r\n\t * @param {number} [options.glType=SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_TYPE] Index type.\r\n\t * @param {number} [options.offset=SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_OFFSET] Offset (in bytes) from the start of the buffer.\r\n\t *\r\n\t * @example\r\n\t * var ib = new SpiderGL.WebGL.IndexBuffer(...); // create an index buffer\r\n\t * // [... set ib data ...]\r\n\t * // calling ib.drawElements has the same effect of:\r\n\t * // ib.bind();\r\n\t * // gl.drawElements(gl.TRIANGLES, (ib.size - offset) / SpiderGL.Type.SIZEOF_UINT16, gl.UNSIGNED_SHORT, offset);\r\n\t * ib.drawElements({\r\n\t * \tglMode : gl.TRIANGLES,       // if omitted, defaults to SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_MODE\r\n\t * \tcount  : 0,                  // if omitted, defaults to SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_COUNT\r\n\t * \tglType : gl.UNSIGNED_SHORT,  // if omitted, defaults to SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_TYPE\r\n\t * \toffset : offset              // if omitted, defaults to SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_OFFSET\r\n\t * });\r\n\t */\r\n\tdrawElements : function (options) {\r\n\t\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tglMode : SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_MODE,\r\n\t\t\tcount  : SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_COUNT,\r\n\t\t\tglType : SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_TYPE,\r\n\t\t\toffset : SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_OFFSET\r\n\t\t}, options);\r\n\r\n\t\tif (options.count < 1) {\r\n\t\t\tvar bytesPerElem = SpiderGL.Type.typeSizeFromGL(options.glType);\r\n\t\t\toptions.count = (this._size - options.offset) / bytesPerElem;\r\n\t\t}\r\n\r\n\t\tthis._dsa.drawElements(this._h, options.glMode, options.count, options.glType, options.offset);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.IndexBuffer, SpiderGL.WebGL.Buffer);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.Framebuffer.\r\n *\r\n * SpiderGL.WebGL.Framebuffer wraps a WebGLFramebuffer object.\r\n *\r\n * @class The SpiderGL.WebGL.Framebuffer is a wrapper for WebGLFramebuffer.\r\n *\r\n * @augments SpiderGL.WebGL.ObjectGL\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] Optional parameters.\r\n * @param {WebGLFramebuffer} [options.handle] A WebGLFramebuffer. If present, this object will be used as the wrapped WebGLFramebuffer. Otherwise a new one will be created.\r\n * @param {bool} [options.autoViewport=SpiderGL.WebGL.Framebuffer.DEFAULT_AUTO_VIEWPORT] The value of the {@link autoViewport} property.\r\n * @param {object} [options.color] Color attachment target (see {@link setAttachments}).\r\n * @param {object} [options.depth] Depth attachment target (see {@link setAttachments}).\r\n * @param {object} [options.stencil] Stencil attachment target (see {@link setAttachments}).\r\n * @param {object} [options.depthStencil] Depth-Stencil attachment target (see {@link setAttachments}).\r\n *\r\n * @see setAttachments\r\n * @see SpiderGL.WebGL.Texture2D\r\n * @see SpiderGL.WebGL.TextureCubeMap\r\n * @see SpiderGL.WebGL.Renderbuffer\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.Framebuffer = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\r\n\tif (SpiderGL.Type.instanceOf(options, WebGLFramebuffer)) {\r\n\t\toptions = { handle : options };\r\n\t}\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\thandle       : null,\r\n\t\tautoViewport : SpiderGL.WebGL.Framebuffer.DEFAULT_AUTO_VIEWPORT\r\n\t}, options);\r\n\r\n\tvar that = SpiderGL.WebGL.ObjectGL.call(this, gl, SpiderGL.WebGL.Framebuffer.TARGET, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n\r\n\tvar gl  = this._gl;\r\n\tvar cb  = this._cb;\r\n\tvar dsa = this._dsa;\r\n\r\n\tvar t = this._t;\r\n\tvar h = this._h;\r\n\r\n\tvar imported = false;\r\n\tif (h) {\r\n\t\timported = true;\r\n\t}\r\n\telse {\r\n\t\th = gl.createFramebuffer();\r\n\t\tthis._h = h;\r\n\t}\r\n\th._spidergl = this;\r\n\r\n\tthis._attachments  = { };\r\n\tthis._status       = 0;\r\n\tthis._autoViewport = options.autoViewport;\r\n\tthis._viewport     = [ 0, 0, 1, 1 ];\r\n\r\n\tcb.pushFramebuffer(t);\r\n\tgl.bindFramebuffer(t, h);\r\n\r\n\tif (imported) {\r\n\t\tvar resource = null;\r\n\t\tvar type     = 0;\r\n\t\tvar level    = 0;\r\n\t\tvar target   = 0;\r\n\r\n\t\tfor (var attachment in SpiderGL.WebGL.Framebuffer._attachmentName) {\r\n\t\t\tresource = gl.getFramebufferAttachmentParameter(t, att, gl.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME);\r\n\t\t\ttype     = gl.getFramebufferAttachmentParameter(t, att, gl.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE);\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase gl.RENDERBUFFER:\r\n\t\t\t\t\ttarget = gl.RENDERBUFFER;\r\n\t\t\t\t\tthis._importRenderbuffer(t, attachment, target, resource);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase gl.TEXTURE:\r\n\t\t\t\t\tlevel  = gl.getFramebufferAttachmentParameter(t, att, gl.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL);\r\n\t\t\t\t\ttarget = gl.getFramebufferAttachmentParameter(t, att, gl.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE);\r\n\t\t\t\t\tif (target == 0) target = gl.TEXTURE_2D;\r\n\t\t\t\t\tthis._importTexture(t, attachment, target, resource, level);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault: break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis._status = gl.checkFramebufferStatus(t);\r\n\r\n\tcb.popFramebuffer(t);\r\n\r\n\tthis.setAttachments(options);\r\n}\r\n\r\n/**\r\n * WebGL target for framebuffers.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.FRAMEBUFFER\r\n */\r\nSpiderGL.WebGL.Framebuffer.TARGET = WebGLRenderingContext.prototype.FRAMEBUFFER;\r\n\r\n/**\r\n * Default value for SpiderGL.WebGL.Framebuffer#autoViewport.\r\n *\r\n * @type bool\r\n *\r\n * @default true\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_AUTO_VIEWPORT = true;\r\n\r\n/**\r\n * Default texture level to attach when using SpiderGL.WebGL.Framebuffer#setAttachments.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_TEXTURE_LEVEL = 0;\r\n\r\n/**\r\n * Default texture cube map face to attach when using SpiderGL.WebGL.Framebuffer#setAttachments.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_CUBE_MAP_FACE = WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X;\r\n\r\n/**\r\n * Default read rectangle left coordinate (in pixels).\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n *\r\n * @see SpiderGL.WebGL.Framebuffer#readPixels\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_X = 0;\r\n\r\n/**\r\n * Default read rectangle bottom coordinate (in pixels).\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n *\r\n * @see SpiderGL.WebGL.Framebuffer#readPixels\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_Y = 0;\r\n\r\n/**\r\n * Default read rectangle width (in pixels).\r\n * If less than zero, the width will be set to span the whole render target (starting from read rectangle x coordinate).\r\n *\r\n * @type number\r\n *\r\n * @default -1\r\n *\r\n * @see SpiderGL.WebGL.Framebuffer#readPixels\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_WIDTH = -1;\r\n\r\n/**\r\n * Default read rectangle height (in pixels).\r\n * If less than zero, the height will be set to span the whole render target (starting from read rectangle y coordinate).\r\n *\r\n * @type number\r\n *\r\n * @default -1\r\n *\r\n * @see SpiderGL.WebGL.Framebuffer#readPixels\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_HEIGHT = -1;\r\n\r\n/**\r\n * The WebGL pixel format for reading framebuffer pixels.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.RGBA\r\n *\r\n * @see SpiderGL.WebGL.Framebuffer#readPixels\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_FORMAT = WebGLRenderingContext.prototype.RGBA;\r\n\r\n/**\r\n * The WebGL birfield mask used for clearing the framebuffer.\r\n *\r\n * @type number\r\n *\r\n * @default (WebGLRenderingContext.prototype.COLOR_BUFFER_BIT | WebGLRenderingContext.prototype.DEPTH_BUFFER_BIT | WebGLRenderingContext.prototype.STENCIL_BUFFER_BIT)\r\n *\r\n * @see SpiderGL.WebGL.Framebuffer#clear\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_CLEAR_MASK = (WebGLRenderingContext.prototype.COLOR_BUFFER_BIT | WebGLRenderingContext.prototype.DEPTH_BUFFER_BIT | WebGLRenderingContext.prototype.STENCIL_BUFFER_BIT);\r\n\r\n/**\r\n * The WebGL pixel type for reading framebuffer pixels.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.UNSIGNED_BYTE\r\n *\r\n * @see SpiderGL.WebGL.Framebuffer#readPixels\r\n */\r\nSpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_TYPE = WebGLRenderingContext.prototype.UNSIGNED_BYTE;\r\n\r\n/**\r\n * WebGLFramebuffer unbinding.\r\n *\r\n * This function binds the null framebuffer to the WebGLRenderingContext.prototype.FRAMEBUFFER target.\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.Framebuffer.unbind = function (gl) { gl.bindFramebuffer(SpiderGL.WebGL.Framebuffer.TARGET, null); };\r\n\r\nSpiderGL.WebGL.Framebuffer._attachmentName = { };\r\nSpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.COLOR_ATTACHMENT0]        = \"color\";\r\nSpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.DEPTH_ATTACHMENT]         = \"depth\";\r\nSpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.STENCIL_ATTACHMENT]       = \"stencil\";\r\nSpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.DEPTH_STENCIL_ATTACHMENT] = \"depthStencil\";\r\n\r\nSpiderGL.WebGL.Framebuffer.prototype = {\r\n\t_gl_deleteFramebuffer : function (framebuffer) {\r\n\t\tthis._h = null;\r\n\t},\r\n\r\n\t_gl_isFramebuffer : function (framebuffer) {\r\n\t},\r\n\r\n\t_gl_bindFramebuffer : function (target, framebuffer) {\r\n\t},\r\n\r\n\t_gl_checkFramebufferStatus : function (target) {\r\n\t},\r\n\r\n\t_gl_getFramebufferAttachmentParameter : function (target, attachment, pname) {\r\n\t},\r\n\r\n\t_gl_framebufferRenderbuffer : function (target, attachment, renderbuffertarget, renderbuffer) {\r\n\t\tthis._importRenderbuffer.apply(this, arguments);\r\n\t\tthis._status = this._gl.checkFramebufferStatus(this._t);\r\n\t},\r\n\r\n\t_gl_framebufferTexture2D : function (target, attachment, textarget, texture, level) {\r\n\t\tthis._importTexture.apply(this, arguments);\r\n\t\tthis._status = this._gl.checkFramebufferStatus(this._t);\r\n\t},\r\n\r\n\t_gl_clear : function (mask) {\r\n\t},\r\n\r\n\t_gl_readPixels : function (x, y, width, height, format, type, pixels) {\r\n\t},\r\n\r\n\t_importTexture : function (target, attachment, textarget, texture, level) {\r\n\t\tvar name = SpiderGL.WebGL.Framebuffer._attachmentName[attachment];\r\n\t\tif (!name) return;\r\n\r\n\t\tif (!texture) {\r\n\t\t\tdelete this._attachments[name];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar gl = this._gl;\r\n\r\n\t\tvar att = {\r\n\t\t\tattachment : attachment,\r\n\t\t\tresource   : null,\r\n\t\t\ttarget     : textarget,\r\n\t\t\tlevel      : level,\r\n\t\t\tface       : gl.NONE\r\n\t\t};\r\n\r\n\t\tthis._attachments[name] = att;\r\n\r\n\t\tif (textarget == gl.TEXTURE_2D) {\r\n\t\t\tatt.resource = new SpiderGL.WebGL.Texture2D(gl, { handle : texture });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tatt.resource = new SpiderGL.WebGL.TextureCubeMap(gl, { handle : texture });\r\n\t\t\tatt.face     = textarget;\r\n\t\t}\r\n\r\n\t\tthis._viewport = [ 0, 0, SpiderGL.Math.max(att.resource.width, 1), SpiderGL.Math.max(att.resource.height, 1) ];\r\n\t},\r\n\r\n\t_importRenderbuffer : function (target, attachment, renderbuffertarget, renderbuffer) {\r\n\t\tvar name = SpiderGL.WebGL.Framebuffer._attachmentName[attachment];\r\n\t\tif (!name) return;\r\n\r\n\t\tif (!renderbuffer) {\r\n\t\t\tdelete this._attachments[name];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar gl = this._gl;\r\n\r\n\t\tvar att = {\r\n\t\t\tattachment : attachment,\r\n\t\t\tresource   : null,\r\n\t\t\ttarget     : renderbuffertarget,\r\n\t\t\tlevel      : 0,\r\n\t\t\tface       : gl.NONE\r\n\t\t};\r\n\r\n\t\tthis._attachments[name] = att;\r\n\r\n\t\tatt.resource = new SpiderGL.WebGL.Renderbuffer(gl, { handle : renderbuffer });\r\n\r\n\t\tthis._viewport = [ 0, 0, SpiderGL.Math.max(att.resource.width, 1), SpiderGL.Math.max(att.resource.height, 1) ];\r\n\t},\r\n\r\n\t_setAttachment : function (attachment, nfo) {\r\n\t\tvar name = SpiderGL.WebGL.Framebuffer._attachmentName[attachment];\r\n\t\tif (!name) return false;\r\n\r\n\t\tvar gl = this._gl;\r\n\r\n\t\tvar isNullResource = (!nfo || ((\"resource\" in nfo) && !nfo.resource));\r\n\t\tif  (isNullResource) {\r\n\t\t\tvar att = this._attachments[name];\r\n\t\t\tif (att) {\r\n\t\t\t\tif (att.target === gl.RENDERBUFFER) {\r\n\t\t\t\t\tgl.framebufferRenderbuffer(t, att.attachment, gl.RENDERBUFFER, null);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tgl.framebufferTexture2D(t, att.attachment, gl.TEXTURE_2D, null, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar resourceType = gl.NONE;\r\n\r\n\t\tif (SpiderGL.Type.instanceOf(nfo, WebGLTexture)) {\r\n\t\t\tnfo = { resource : nfo };\r\n\t\t\tresourceType = gl.TEXTURE;\r\n\t\t}\r\n\t\telse if (SpiderGL.Type.instanceOf(nfo, WebGLRenderbuffer)) {\r\n\t\t\tnfo = { resource : nfo };\r\n\t\t\tresourceType = gl.RENDERBUFFER;\r\n\t\t}\r\n\t\telse if (SpiderGL.Type.instanceOf(nfo, SpiderGL.WebGL.Texture)) {\r\n\t\t\tnfo = { resource : nfo.handle };\r\n\t\t\tresourceType = gl.TEXTURE;\r\n\t\t}\r\n\t\telse if (SpiderGL.Type.instanceOf(nfo, SpiderGL.WebGL.Renderbuffer)) {\r\n\t\t\tnfo = { resource : nfo.handle };\r\n\t\t\tresourceType = gl.RENDERBUFFER;\r\n\t\t}\r\n\r\n\t\tvar cubeFaceSpecified = !!nfo && (typeof (nfo.face) != \"undefined\");\r\n\r\n\t\tnfo = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tresource : null,\r\n\t\t\tlevel    : SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_TEXTURE_LEVEL,\r\n\t\t\tface     : SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_CUBE_MAP_FACE\r\n\t\t}, nfo);\r\n\r\n\t\tvar t = this._t;\r\n\r\n\t\tswitch (resourceType) {\r\n\t\t\tcase gl.TEXTURE:\r\n\t\t\t\tvar isCubemap = SpiderGL.Type.instanceOf(nfo, SpiderGL.WebGL.TextureCubeMap) || cubeFaceSpecified;\r\n\t\t\t\tvar target = (isCubemap) ? (nfo.face) : (gl.TEXTURE_2D);\r\n\t\t\t\tgl.framebufferTexture2D(t, attachment, target, nfo.resource, nfo.level);\r\n\t\t\tbreak;\r\n\t\t\tcase gl.RENDERBUFFER:\r\n\t\t\t\tgl.framebufferRenderbuffer(t, attachment, gl.RENDERBUFFER, nfo.resource);\r\n\t\t\tbreak;\r\n\t\t\tdefault: break;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/*\r\n\tget isEmpty () {\r\n\t\treturn (\r\n\t\t\t!this._attachments.color        &&\r\n\t\t\t!this._attachments.depth        &&\r\n\t\t\t!this._attachments.stencil      &&\r\n\t\t\t!this._attachments.depthStencil\r\n\t\t);\r\n\t},\r\n\t*/\r\n\r\n\t/**\r\n\t * Tests if the framebuffer is ready to use.\r\n\t * A framebuffer is considered ready if its status is WebGLRenderingContext.prototype.FRAMEBUFFER_COMPLETE.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see isComplete\r\n\t */\r\n\tget isReady () {\r\n\t\treturn this.isComplete;\r\n\t},\r\n\r\n\t/**\r\n\t * The WebGL status of the framebuffer.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see isComplete\r\n\t */\r\n\tget status() {\r\n\t\treturn this._status;\r\n\t},\r\n\r\n\t/**\r\n\t * Indicates if the the status of the framebuffer is WebGLRenderingContext.prototype.FRAMEBUFFER_COMPLETE.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget isComplete() {\r\n\t\treturn (this._status === this._gl.FRAMEBUFFER_COMPLETE);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a 4-component array with the viewport parameters.\r\n\t *\r\n\t * Viewport parameters are stored as [0, 0, width, height] and will be set using WebGLRenderingContext.prototype.viewport() during a {@link bind} call if {@link autoViewport} is true.\r\n\t * The width and height parameters corresponds to the width and height of the last resource attached with {@link setAttachments}.\r\n\t *\r\n\t * @type array\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see autoViewport\r\n\t * @see setAttachments\r\n\t */\r\n\tget viewport() {\r\n\t\treturn this._viewport.slice();\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the width of the attached resources.\r\n\t *\r\n\t * The value represents the width of the attached resources.\r\n\t * It is equal to viewport[2].\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see height\r\n\t * @see viewport\r\n\t */\r\n\tget width() {\r\n\t\treturn this._viewport[2];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the height of the attached resources.\r\n\t *\r\n\t * The value represents the height of the attached resources.\r\n\t * It is equal to viewport[3].\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see width\r\n\t * @see viewport\r\n\t */\r\n\tget height() {\r\n\t\treturn this._viewport[3];\r\n\t},\r\n\r\n\t/**\r\n\t * Automatic viewport settings in a call to {@link bind}.\r\n\t *\r\n\t * If true, when calling {@link bind} the viewport will be set with a call to WebGLRenderingContext.prototype.viewport().\r\n\t *\r\n\t * @type bool\r\n\t */\r\n\tget autoViewport() {\r\n\t\treturn this._autoViewport;\r\n\t},\r\n\r\n\tset autoViewport(on) {\r\n\t\tthis._autoViewport = !!on;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the framebuffer attachments.\r\n\t * It is used to attach resources (SpiderGL.WebGL.Texture2D, SpiderGL.WebGL.TextureCubeMap or SpiderGL.WebGL.Renderbuffer) as render targets.\r\n\t *\r\n\t * @param {object} attachments The resources to attach to the WebGLFramebuffer.\r\n\t * @param {object|SpiderGL.WebGL.Texture2D|SpiderGL.WebGL.TextureCubeMap|SpiderGL.WebGL.Renderbuffer} [attachments.color] The color attachment for target WebGLRenderingContext.prototype.COLOR_ATTACHMENT0; if omitted, the current color attachment is kept; if null, the current color attachment is detached.\r\n\t * @param {SpiderGL.WebGL.Texture2D|SpiderGL.WebGL.TextureCubeMap|SpiderGL.WebGL.Renderbuffer} [attachments.color.resource] The resource to use as a render target for color attachment.\r\n\t * @param {number} [attachments.color.level=SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_TEXTURE_LEVEL] If resource is SpiderGL.WebGL.Texture2D or SpiderGL.WebGL.TextureCubeMap, specifies the texture level to attach. As per WebGL specifications, level must be zero.\r\n\t * @param {number} [attachments.color.face=SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_CUBE_MAP_FACE] If resource is SpiderGL.WebGL.TextureCubeMap, specifies the texture cube map face to attach.\r\n\t * @param {object|SpiderGL.WebGL.Renderbuffer} [attachments.depth] Same as attachments.color but for WebGLRenderingContext.prototype.DEPTH_ATTACHMENT. To ensure the restrictions of the WebGL specifications, stencil and depthStencil attachments are detached.\r\n\t * @param {object|SpiderGL.WebGL.Renderbuffer} [attachments.stencil] Same as attachments.color but for WebGLRenderingContext.prototype.STENCIL_ATTACHMENT. To ensure the restrictions of the WebGL specifications, depth and depthStencil attachments are detached.\r\n\t * @param {object|SpiderGL.WebGL.Renderbuffer} [attachments.depthStencil] Same as attachments.color but for WebGLRenderingContext.prototype.DEPTH_STENCIL_ATTACHMENT. To ensure the restrictions of the WebGL specifications, depth and stencil attachments are detached.\r\n\t *\r\n\t * @returns {bool} True if the framebuffer is complete, false otherwise.\r\n\t *\r\n\t * @example\r\n\t * var t2D = new SpiderGL.WebGL.Texture2D(...);\r\n\t * var tCM = new SpiderGL.WebGL.TextureCubeMap(...);\r\n\t * var rb  = new SpiderGL.WebGL.Renderbuffer(...);\r\n\t *\r\n\t * var fb = new SpiderGL.WebGL.Framebuffer(gl, {\r\n\t * \tcolor : {resource: t2D, level: 0 }, // alternatively: color: t2D; in this case level would default to SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_TEXTURE_LEVEL\r\n\t * \tdepth : rb                          // alternatively: depth: {resource: rb}; renderbuffers do not have mipmap levels\r\n\t * };\r\n\t * // use fb\r\n\t * // ...\r\n\t *\r\n\t * // change attachment\r\n\t * fb.setAttachments({\r\n\t * \tcolor: {resource: tCM, face: gl.TEXTURE_CUBE_MAP_NEGATIVE_Z} // if face is omitted, defaults to SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_CUBE_MAP_FACE\r\n\t * })\r\n\t *\r\n\t * @see getAttachments\r\n\t */\r\n\tsetAttachments : function (attachments) {\r\n\t\tattachments = attachments || { };\r\n\r\n\t\tvar gl = this._gl;\r\n\t\tvar cb = this._cb;\r\n\r\n\t\tvar t = this._t;\r\n\t\tvar h = this._h;\r\n\r\n\t\tcb.pushFramebuffer(t);\r\n\t\tgl.bindFramebuffer(t, h);\r\n\r\n\t\tif (\"color\" in attachments) {\r\n\t\t\tthis._setAttachment(gl.COLOR_ATTACHMENT0, attachments.color);\r\n\t\t}\r\n\r\n\t\tif (\"depthStencil\" in attachments) {\r\n\t\t\tthis._setAttachment(gl.DEPTH_ATTACHMENT,         null                    );\r\n\t\t\tthis._setAttachment(gl.STENCIL_ATTACHMENT,       null                    );\r\n\t\t\tthis._setAttachment(gl.DEPTH_STENCIL_ATTACHMENT, attachments.depthStencil);\r\n\t\t}\r\n\t\telse if (\"depth\" in attachments) {\r\n\t\t\tthis._setAttachment(gl.DEPTH_STENCIL_ATTACHMENT, null                    );\r\n\t\t\tthis._setAttachment(gl.STENCIL_ATTACHMENT,       null                    );\r\n\t\t\tthis._setAttachment(gl.DEPTH_ATTACHMENT,         attachments.depth       );\r\n\t\t}\r\n\t\telse if (\"stencil\" in attachments) {\r\n\t\t\tthis._setAttachment(gl.DEPTH_STENCIL_ATTACHMENT, null                    );\r\n\t\t\tthis._setAttachment(gl.DEPTH_ATTACHMENT,         null                    );\r\n\t\t\tthis._setAttachment(gl.STENCIL_ATTACHMENT,       attachments.stencil     );\r\n\t\t}\r\n\r\n\t\tthis._status = gl.checkFramebufferStatus(t);\r\n\r\n\t\tcb.popFramebuffer(t);\r\n\r\n\t\treturn this.isComplete;\r\n\t},\r\n\r\n\t/**\r\n\t * Retrieves the attached resources.\r\n\t * This method returns a new object containing the attachments information.\r\n\t *\r\n\t * @returns {object} The attachments data. The object fields may be: color, depth, stencil and depthStencil.\r\n\t *\r\n\t * @see setAttachments\r\n\t */\r\n\tgetAttachments : function () {\r\n\t\tvar rAtts = { };\r\n\t\tvar att   = null;\r\n\t\tfor (var a in this._attachments) {\r\n\t\t\tatt = this._attachments[a];\r\n\t\t\trAtts[a] = {\r\n\t\t\t\tattachment : att.attachment,\r\n\t\t\t\tresource   : att.resource,\r\n\t\t\t\ttarget     : att.target,\r\n\t\t\t\tlevel      : att.level\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn rAtts;\r\n\t},\r\n\r\n\t/**\r\n\t * Detaches all attached resources.\r\n\t *\r\n\t * @see setAttachments\r\n\t */\r\n\tdetachAll : function () {\r\n\t\tthis.setAttachments({\r\n\t\t\tcolor        : null,\r\n\t\t\tdepthStencil : null\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the resource attached to the color attachment.\r\n\t * If no resource is attached the result is null.\r\n\t * When setting, default attaching parameters are used.\r\n\t *\r\n\t * @type SpiderGL.WebGL.Texture|SpiderGL.WebGL.Renderbuffer\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see depthTarget\r\n\t * @see stencilTarget\r\n\t * @see depthStencilTarget\r\n\t */\r\n\tget colorTarget() {\r\n\t\tvar att = this._attachments.color;\r\n\t\tif (!att) return null\r\n\t\treturn att.resource;\r\n\t},\r\n\r\n\tset colorTarget(rt) {\r\n\t\tthis.setAttachments({ color : rt });\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the resource attached to the depth attachment.\r\n\t * If no resource is attached the result is null.\r\n\t * When setting, default attaching parameters are used.\r\n\t *\r\n\t * @type SpiderGL.WebGL.Texture|SpiderGL.WebGL.Renderbuffer\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see colorTarget\r\n\t * @see stencilTarget\r\n\t * @see depthStencilTarget\r\n\t */\r\n\tget depthTarget() {\r\n\t\tvar att = this._attachments.depth;\r\n\t\tif (!att) return null\r\n\t\treturn att.resource;\r\n\t},\r\n\r\n\tset depthTarget(rt) {\r\n\t\tthis.setAttachments({ depth : rt });\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the resource attached to the stencil attachment.\r\n\t * If no resource is attached the result is null.\r\n\t * When setting, default attaching parameters are used.\r\n\t *\r\n\t * @type SpiderGL.WebGL.Texture|SpiderGL.WebGL.Renderbuffer\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see colorTarget\r\n\t * @see depthTarget\r\n\t * @see depthStencilTarget\r\n\t */\r\n\tget stencilTarget() {\r\n\t\tvar att = this._attachments.stencil;\r\n\t\tif (!att) return null\r\n\t\treturn att.resource;\r\n\t},\r\n\r\n\tset stencilTarget(rt) {\r\n\t\tthis.setAttachments({ stencil : rt });\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the resource attached to the depthStencil attachment.\r\n\t * If no resource is attached the result is null.\r\n\t * When setting, default attaching parameters are used.\r\n\t *\r\n\t * @type SpiderGL.WebGL.Texture|SpiderGL.WebGL.Renderbuffer\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see colorTarget\r\n\t * @see depthTarget\r\n\t * @see stencilTarget\r\n\t */\r\n\tget depthStencilTarget() {\r\n\t\tvar att = this._attachments.depthStencil;\r\n\t\tif (!att) return null\r\n\t\treturn att.resource;\r\n\t},\r\n\r\n\tset depthStencilTarget(rt) {\r\n\t\tthis.setAttachments({ depthStencil : rt });\r\n\t},\r\n\r\n\t/**\r\n\t * Clears the framebuffer using current clear values.\r\n\t *\r\n\t * @param {number} mask The clear mask as for WebGLRenderingContext.prototype.clear.\r\n\t */\r\n\tclear : function (mask) {\r\n\t\tmask = SpiderGL.Utility.getDefaultValue(mask, SpiderGL.WebGL.Framebuffer.DEFAULT_CLEAR_MASK);\r\n\t\tthis._dsa.clear(this._h, mask);\r\n\t},\r\n\r\n\t/**\r\n\t * Reads the pixels from a rectangular region of the framebuffer.\r\n\t *\r\n\t * @param {ArrayBufferView} buffer The destination buffer in which pixels will be written.\r\n\t * @param {object} [options] Optional parameters.\r\n\t * @param {number} [options.x=SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_X] The rectangle left coordinate (in pixels).\r\n\t * @param {number} [options.y=SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_X] The rectangle bottom coordinate (in pixels).\r\n\t * @param {number} [options.width=SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_WIDTH] The rectangle width (in pixels). If less than zero, the width will be set to span the whole render target (starting from rectangle x coordinate).\r\n\t * @param {number} [options.height=SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_HEIGHT] The rectangle height (in pixels). If less than zero, the height will be set to span the whole render target (starting from rectangle y coordinate).\r\n\t * @param {number} [options.format=SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_FORMAT] The WebGL pixel format.\r\n\t * @param {number} [options.type=SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_TYPE] The WebGL pixel type.\r\n\t */\r\n\treadPixels : function (buffer, options) {\r\n\t\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tx      : SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_X,\r\n\t\t\ty      : SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_Y,\r\n\t\t\twidth  : SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_WIDTH,\r\n\t\t\theight : SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_HEIGHT,\r\n\t\t\tformat : SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_FORMAT,\r\n\t\t\ttype   : SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_TYPE\r\n\t\t}, options);\r\n\r\n\t\tif (options.width  < 0) { options.width  = this._viewport[2]; }\r\n\t\tif (options.height < 0) { options.height = this._viewport[3]; }\r\n\r\n\t\tthis._dsa.readPixels(this._h, options.x, options.y, options.width, options.height, options.format, options.type, buffer);\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the WebGL viewport to the framebuffer viewport rectangle.\r\n\t *\r\n\t * @see viewport\r\n\t * @see autoViewport\r\n\t * @see setAttachments\r\n\t */\r\n\tapplyViewport : function () {\r\n\t\tvar gl = this._gl;\r\n\t\tvar vp = this._viewport;\r\n\t\tgl.viewport(vp[0], vp[1], vp[2], vp[3]);\r\n\t},\r\n\r\n\t/**\r\n\t * Destroys the WebGLFramebuffer.\r\n\t * After destruction, the handle is set to null and this object should not be used anymore.\r\n\t *\r\n\t * @see SpiderGL.WebGL.ObjectGL#destroy\r\n\t */\r\n\tdestroy : function () {\r\n\t\tthis._gl.deleteFramebuffer(this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Binds the wrapped WebGLFramebuffer to the WebGLRenderingContex.FRAMEBUFFER target.\r\n\t * If setViewport is not specified and autoViewport is true, the stored viewport is set with WebGLRenderingContext.prototype.viewport().\r\n\t *\r\n\t * @param {bool} [setViewport] If specified, overrides the value of autoViewport.\r\n\t *\r\n\t * @see unbind\r\n\t * @see autoViewport\r\n\t */\r\n\tbind : function (setViewport) {\r\n\t\tvar gl = this._gl;\r\n\t\tgl.bindFramebuffer(this._t, this._h);\r\n\t\tvar svp = SpiderGL.Utility.getDefaultValue(setViewport, this._autoViewport);\r\n\t\tif (svp) {\r\n\t\t\tvar vp = this._viewport;\r\n\t\t\tgl.viewport(vp[0], vp[1], vp[2], vp[3]);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Binds \"null\" to the WebGLRenderingContex.FRAMEBUFFER target.\r\n\t * This method is provided only for simmetry with {@link bind} and is not relative to the object state.\r\n\t *\r\n\t * @see bind\r\n\t */\r\n\tunbind : function () {\r\n\t\tthis._gl.bindFramebuffer(this._t, null);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.Framebuffer, SpiderGL.WebGL.ObjectGL);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.Program.\r\n *\r\n * SpiderGL.WebGL.Program is a wrapper for WebGLProgram objects.\r\n *\r\n * @class The SpiderGL.WebGL.Program is a wrapper for WebGLProgram objects.\r\n *\r\n * @augments SpiderGL.WebGL.ObjectGL\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] Optional parameters.\r\n * @param {WebGLProgram} [options.handle] A WebGLProgram. If present, this object will be used as the wrapped WebGLProgram and the attached shaders will be queried. Otherwise a new one will be created.\r\n * @param {bool} [options.autoLink=SpiderGL.WebGL.Program.DEFAULT_AUTO_LINK] If true, the program will be linked automatically whenever shaders are added or removed, or vertex attribute indices change.\r\n * @param {array} [options.shaders] An array of SpiderGL.WebGL.Shader objects to attach to the program.\r\n * @param {object} [options.attributes] An object where each property has the name of a vertex shader attribute and whose value is the attribute index to wich the vertex attribute will be bound.\r\n * @param {object} [options.uniforms] An object where each property has the name of a program uniform and whose value is the uniform value.\r\n *\r\n * @example\r\n * var vertexShader   = new SpiderGL.WebGL.VertexShader   (gl, {source: vertexShaderSrc  });\r\n * var fragmentShader = new SpiderGL.WebGL.FragmentShader (gl, {source: fragmentShaderSrc});\r\n *\r\n * var program = new SpiderGL.WebGL.Program(gl, {\r\n * \tautoLink : true, // if true, the program is automatically linked whenever shaders are added or removed, or whenever attribute indices are changed.\r\n * \tshaders  : [vertexShader, fragmentShader],\r\n * \tattributes : {\r\n * \t\taPosition : 0, // the vertex shader aPosition attribute will be bound to the vertex attribute at index 0\r\n * \t\taNormal   : 1  // the vertex shader aNormal attribute will be bound to the vertex attribute at index 1\r\n * \t},\r\n * \tuniforms : {\r\n * \t\tuDiffuseMap  : 0,  // index of the texture unit for diffuse color textures\r\n * \t\tuScaleFactor : 2.0\r\n * \t}\r\n * };\r\n *\r\n * // uniforms can also be set when the program is not bound\r\n * program.setUniforms({\r\n *\tuModelViewProjection : getMVP(),\r\n *\tuShininess           : getShininess()\r\n * });\r\n *\r\n * program.bind();\r\n * // render\r\n *\r\n * @see setShaders\r\n * @see setAttributes\r\n * @see setUniforms\r\n * @see autoLink\r\n * @see SpiderGL.WebGL.Shader\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.Program = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\r\n\tif (SpiderGL.Type.instanceOf(options, WebGLProgram)) {\r\n\t\toptions = { handle : options };\r\n\t}\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\thandle   : null,\r\n\t\tautoLink : SpiderGL.WebGL.Program.DEFAULT_AUTO_LINK\r\n\t}, options);\r\n\r\n\tSpiderGL.WebGL.ObjectGL.call(this, gl, SpiderGL.WebGL.Program.TARGET, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n\r\n\tvar gl  = this._gl;\r\n\tvar cb  = this._cb;\r\n\tvar dsa = this._dsa;\r\n\r\n\tvar h = this._h;\r\n\r\n\tvar linked    = false;\r\n\tvar log       = \"\";\r\n\r\n\tvar imported = false;\r\n\tif (h) {\r\n\t\timported = true;\r\n\t\tlinked   = !!gl.getProgramParameter(h, gl.LINK_STATUS);\r\n\t\tlog      = gl.getProgramInfoLog(h);\r\n\t\tif (!log) { log = \"\"; }\r\n\t}\r\n\telse {\r\n\t\th = gl.createProgram();\r\n\t\tthis._h = h;\r\n\t}\r\n\th._spidergl = this;\r\n\r\n\tthis._shaders    = [ ];\r\n\tthis._linked     = linked;\r\n\tthis._log        = log;\r\n\tthis._autoLink   = options.autoLink;\r\n\tthis._attributes = { };\r\n\tthis._uniforms   = { };\r\n\r\n\tif (imported) {\r\n\t\tvar shaders = gl.getAttachedShaders(h);\r\n\t\tfor (var i=0,n=shaders.length; i<n; ++i) {\r\n\t\t\tthis._importShader(shaders[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tvar mustLink = false;\r\n\tif (this._addShaders(options.shaders))       { mustLink = true; }\r\n\tif (this._setAttributes(options.attributes)) { mustLink = true; }\r\n\r\n\tif (mustLink && this._autoLink) { this.link(); }\r\n\telse if (imported) { this._postLink(); }\r\n\r\n\tthis.setUniforms(options.uniforms);\r\n}\r\n\r\n/**\r\n * Dummy WebGL target for programs.\r\n * It is equal to WebGLRenderingContext.prototype.NONE and is provided only for completeness with other WebGL wrappers.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.NONE\r\n */\r\nSpiderGL.WebGL.Program.TARGET = WebGLRenderingContext.prototype.NONE;\r\n\r\n/**\r\n * Default value for SpiderGL.WebGL.Program#autoLink.\r\n *\r\n * @type bool\r\n *\r\n * @default true\r\n */\r\nSpiderGL.WebGL.Program.DEFAULT_AUTO_LINK = true;\r\n\r\n/**\r\n * WebGLProgram unbinding.\r\n *\r\n * This function binds the null program with WebGLRenderingContext.prototype.useProgram(null).\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.Program.unbind = function (gl) { gl.useProgram(null); };\r\n\r\nSpiderGL.WebGL.Program._uniformSetFunctions = { };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL        ] = function (dsa, h, v) { dsa.uniform1i        (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC2   ] = function (dsa, h, v) { dsa.uniform2iv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC3   ] = function (dsa, h, v) { dsa.uniform3iv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC4   ] = function (dsa, h, v) { dsa.uniform4iv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT         ] = function (dsa, h, v) { dsa.uniform1i        (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC2    ] = function (dsa, h, v) { dsa.uniform2iv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC3    ] = function (dsa, h, v) { dsa.uniform3iv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC4    ] = function (dsa, h, v) { dsa.uniform4iv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT       ] = function (dsa, h, v) { dsa.uniform1f        (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC2  ] = function (dsa, h, v) { dsa.uniform2fv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC3  ] = function (dsa, h, v) { dsa.uniform3fv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC4  ] = function (dsa, h, v) { dsa.uniform4fv       (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT2  ] = function (dsa, h, v) { dsa.uniformMatrix2fv (h, this.location, false, v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT3  ] = function (dsa, h, v) { dsa.uniformMatrix3fv (h, this.location, false, v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT4  ] = function (dsa, h, v) { dsa.uniformMatrix4fv (h, this.location, false, v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.SAMPLER_2D  ] = function (dsa, h, v) { dsa.uniform1i        (h, this.location,        v); };\r\nSpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.SAMPLER_CUBE] = function (dsa, h, v) { dsa.uniform1i        (h, this.location,        v); };\r\n\r\nSpiderGL.WebGL.Program.prototype = {\r\n\t_gl_deleteProgram : function (program) {\r\n\t\tthis._h = null;\r\n\t},\r\n\r\n\t_gl_isProgram : function (program) {\r\n\t},\r\n\r\n\t_gl_useProgram : function (program) {\r\n\t},\r\n\r\n\t_gl_getActiveAttrib : function (program, index) {\r\n\t},\r\n\r\n\t_gl_getActiveUniform : function (program, index) {\r\n\t},\r\n\r\n\t_gl_getAttachedShaders : function (program) {\r\n\t},\r\n\r\n\t_gl_getAttribLocation : function (program, name) {\r\n\t},\r\n\r\n\t_gl_getProgramParameter : function (program, pname) {\r\n\t},\r\n\r\n\t_gl_getProgramInfoLog : function (program) {\r\n\t},\r\n\r\n\t_gl_getUniform : function (program, location) {\r\n\t},\r\n\r\n\t_gl_getUniformLocation : function (program, name) {\r\n\t},\r\n\r\n\t_gl_attachShader : function (program, shader) {\r\n\t\tthis._importShader(shader);\r\n\t},\r\n\r\n\t_gl_bindAttribLocation : function (program, index, name) {\r\n\t},\r\n\r\n\t_gl_detachShader : function (program, shader) {\r\n\t\tif (!shader) { return; }\r\n\t\tvar idx = this._shaderHandleIndex(shader);\r\n\t\tif (idx < 0) { return; }\r\n\t\tthis._shaders.splice(idx, 1);\r\n\t},\r\n\r\n\t_gl_linkProgram : function (program) {\r\n\t\tthis._postLink();\r\n\t},\r\n\r\n\t_gl_uniform1f : function (location, x) {\r\n\t},\r\n\r\n\t_gl_uniform1fv : function (location, v) {\r\n\t},\r\n\r\n\t_gl_uniform1i : function (location, x) {\r\n\t},\r\n\r\n\t_gl_uniform1iv : function (location, v) {\r\n\t},\r\n\r\n\t_gl_uniform2f : function (location, x, y) {\r\n\t},\r\n\r\n\t_gl_uniform2fv : function (location, v) {\r\n\t},\r\n\r\n\t_gl_uniform2i : function (location, x, y) {\r\n\t},\r\n\r\n\t_gl_uniform2iv : function (location, v) {\r\n\t},\r\n\r\n\t_gl_uniform3f : function (location, x, y, z) {\r\n\t},\r\n\r\n\t_gl_uniform3fv : function (location, v) {\r\n\t},\r\n\r\n\t_gl_uniform3i : function (location, x, y, z) {\r\n\t},\r\n\r\n\t_gl_uniform3iv : function (location, v) {\r\n\t},\r\n\r\n\t_gl_uniform4f : function (location, x, y, z, w) {\r\n\t},\r\n\r\n\t_gl_uniform4fv : function (location, v) {\r\n\t},\r\n\r\n\t_gl_uniform4i : function (location, x, y, z, w) {\r\n\t},\r\n\r\n\t_gl_uniform4iv : function (location, v) {\r\n\t},\r\n\r\n\t_gl_uniformMatrix2fv : function (location, transpose, value) {\r\n\t},\r\n\r\n\t_gl_uniformMatrix3fv : function (location, transpose, value) {\r\n\t},\r\n\r\n\t_gl_uniformMatrix4fv : function (location, transpose, value) {\r\n\t},\r\n\r\n\t_gl_validateProgram : function (program) {\r\n\t},\r\n\r\n\t_shaderHandleIndex : function (shader) {\r\n\t\tfor (var i=0,n=this._shaders.length; i<n; ++i) {\r\n\t\t\tif (this._shaders[i].handle === shader) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\r\n\t_shaderIndex : function (shader) {\r\n\t\tif (this._shaders.indexOf) { return this._shaders.indexOf(shader); }\r\n\t\telse {\r\n\t\t\tfor (var i=0,n=this._shaders.length; i<n; ++i) {\r\n\t\t\t\tif (this._shaders[i] === shader) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t},\r\n\r\n\t_importShader : function (shader) {\r\n\t\tif (!shader) { return; }\r\n\t\tif (this._shaderHandleIndex(shader) >= 0) { return; }\r\n\r\n\t\tvar gl = this._gl;\r\n\t\tvar shd = shader._spidergl;\r\n\t\tif (!shd) {\r\n\t\t\tvar type = gl.getShaderParameter(shader, gl.SHADER_TYPE);\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase gl.VERTEX_SHADER   : shd = new SpiderGL.WebGL.VertexShader   (gl, { handle : shader }); break;\r\n\t\t\t\tcase gl.FRAGMENT_SHADER : shd = new SpiderGL.WebGL.FragmentShader (gl, { handle : shader }); break;\r\n\t\t\t\tdefault : return; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._shaders.push(shd);\r\n\t},\r\n\r\n\t_updateActiveInfo : function () {\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\r\n\t\tvar n    = 0;\r\n\t\tvar nfo  = null;\r\n\t\tvar name = null;\r\n\t\tvar loc  = null;\r\n\r\n\t\tvar attributes = { };\r\n\t\tn = gl.getProgramParameter(h, gl.ACTIVE_ATTRIBUTES);\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tnfo  = gl.getActiveAttrib(h, i);\r\n\t\t\tname = nfo.name;\r\n\t\t\tloc  = gl.getAttribLocation(h, name);\r\n\t\t\tattributes[name] = {\r\n\t\t\t\tindex    : i,\r\n\t\t\t\tname     : name,\r\n\t\t\t\tsize     : nfo.size,\r\n\t\t\t\ttype     : nfo.type,\r\n\t\t\t\tlocation : loc\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tvar uniforms = { };\r\n\t\tn = gl.getProgramParameter(h, gl.ACTIVE_UNIFORMS);\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tnfo = gl.getActiveUniform(h, i);\r\n\t\t\tname = nfo.name;\r\n\t\t\tloc  = gl.getUniformLocation(h, name);\r\n\t\t\tuniforms[name] = {\r\n\t\t\t\tindex    : i,\r\n\t\t\t\tname     : name,\r\n\t\t\t\tsize     : nfo.size,\r\n\t\t\t\ttype     : nfo.type,\r\n\t\t\t\tlocation : loc,\r\n\t\t\t\tsetValue : SpiderGL.WebGL.Program._uniformSetFunctions[nfo.type]\r\n\t\t\t};\r\n\t\t\tif (nfo.size > 1) {\r\n\t\t\t\tvar subs = name.lastIndexOf(\"[0]\");\r\n\t\t\t\tif (subs == (name.length - 3)) {\r\n\t\t\t\t\tvar arrayName = name.slice(0, subs);\r\n\t\t\t\t\tfor (var j=1; j<nfo.size; ++j) {\r\n\t\t\t\t\t\tvar subName = arrayName + \"[\" + j + \"]\";\r\n\t\t\t\t\t\tloc = gl.getUniformLocation(h, subName);\r\n\t\t\t\t\t\tuniforms[subName] = {\r\n\t\t\t\t\t\t\tindex    : i,\r\n\t\t\t\t\t\t\tname     : subName,\r\n\t\t\t\t\t\t\tsize     : nfo.size,\r\n\t\t\t\t\t\t\ttype     : nfo.type,\r\n\t\t\t\t\t\t\tlocation : loc,\r\n\t\t\t\t\t\t\tsetValue : SpiderGL.WebGL.Program._uniformSetFunctions[nfo.type]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._attributes = attributes;\r\n\t\tthis._uniforms   = uniforms;\r\n\t},\r\n\r\n\t_postLink : function () {\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\t\tthis._linked = !!gl.getProgramParameter(h, gl.LINK_STATUS);\r\n\t\tthis._log = gl.getProgramInfoLog(h);\r\n\t\tif (!this._log) { this._log = \"\"; }\r\n\t\tthis._updateActiveInfo();\r\n\t},\r\n\r\n\t_addShaders : function (shaders) {\r\n\t\tif (!shaders) { return false; }\r\n\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\t\tvar shd = null;\r\n\t\tvar hshd = null;\r\n\r\n\t\tfor (var i=0,n=shaders.length; i<n; ++i) {\r\n\t\t\tshd = shaders[i];\r\n\t\t\thshd = null;\r\n\t\t\tif (SpiderGL.Type.instanceOf(shd, SpiderGL.WebGL.Shader)) {\r\n\t\t\t\thshd = shd.handle;\r\n\t\t\t}\r\n\t\t\tif (SpiderGL.Type.instanceOf(shd, WebGLShader)) {\r\n\t\t\t\thshd = shd;\r\n\t\t\t}\r\n\t\t\tif (hshd) {\r\n\t\t\t\tgl.attachShader(h, hshd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_removeShaders : function (shaders) {\r\n\t\tif (!shaders) { return false; }\r\n\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\t\tvar shd = null;\r\n\t\tvar hshd = null;\r\n\r\n\t\tfor (var i=0,n=shaders.length; i<n; ++i) {\r\n\t\t\tshd = shaders[i];\r\n\t\t\thshd = null;\r\n\t\t\tif (SpiderGL.Type.instanceOf(shd, SpiderGL.WebGL.Shader)) {\r\n\t\t\t\thshd = shd.handle;\r\n\t\t\t}\r\n\t\t\tif (SpiderGL.Type.instanceOf(shd, SpiderGL.WebGL.Shader)) {\r\n\t\t\t\thshd = shd;\r\n\t\t\t}\r\n\t\t\tif (hshd) {\r\n\t\t\t\tgl.detachShader(h, hshd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_setAttributes : function (attributes) {\r\n\t\tif (!attributes) { return false; }\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\t\tfor (var a in attributes) {\r\n\t\t\tgl.bindAttribLocation(h, attributes[a], a);\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/*\r\n\tget isEmpty     () { return (this._shaders.length <= 0); },\r\n\t*/\r\n\r\n\t/**\r\n\t * Tests if the program is ready to use.\r\n\t * A program is considered ready if it is succesfully linked.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see isLinked\r\n\t */\r\n\tget isReady() {\r\n\t\treturn this.isLinked;\r\n\t},\r\n\r\n\t/**\r\n\t * Tests if the program is linked.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see isReady\r\n\t */\r\n\tget isLinked() {\r\n\t\treturn this._linked;\r\n\t},\r\n\r\n\t/*\r\n\tget isValidated() {\r\n\t\treturn this._validated;\r\n\t},\r\n\t*/\r\n\r\n\t/**\r\n\t * Gets the program info log.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget log() {\r\n\t\treturn this._log;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets if the program will be linked automatically whenever shaders are added or removed, or vertex attribute indices change.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @see link\r\n\t */\r\n\tget autoLink() {\r\n\t\treturn this._autoLink;\r\n\t},\r\n\r\n\tset autoLink(on) {\r\n\t\tthis._autoLink = !!on;\r\n\t},\r\n\r\n\t/**\r\n\t * Attaches the provided shaders to the program.\r\n\t * If link is not specified and autoLink is true, the program is automatically linked.\r\n\t *\r\n\t * @param {array|SpiderGL.WebGL.Shader} shaders An array of SpiderGL.WebGL.Shader or a single SpiderGL.WebGL.Shader to attach.\r\n\t * @param {bool} [link] If specified, overrides the value of autoLink.\r\n\t *\r\n\t * @returns {bool} If the program has been linked, returns whether the program is linked, otherwise always returns true.\r\n\t *\r\n\t * @see isLinked\r\n\t */\r\n\taddShaders : function (shaders, link) {\r\n\t\tvar mustLink = this._addShaders(shaders);\r\n\t\tif (!mustLink) { return true; };\r\n\t\tmustLink = SpiderGL.Utility.getDefaultValue(link, this._autoLink);\r\n\t\tif (!mustLink) { return true; }\r\n\t\treturn this.link()\r\n\t},\r\n\r\n\t/**\r\n\t * Detaches the provided shaders to the program.\r\n\t * If link is not specified and autoLink is true, the program is automatically linked.\r\n\t *\r\n\t * @param {array|SpiderGL.WebGL.Shader} shaders An array of SpiderGL.WebGL.Shader or a single SpiderGL.WebGL.Shader to detach.\r\n\t * @param {bool} [link] If specified, overrides the value of autoLink.\r\n\t *\r\n\t * @returns {bool} If the program has been linked, returns whether the program is linked, otherwise always returns true.\r\n\t */\r\n\tremoveShaders : function (shaders, link) {\r\n\t\tvar mustLink = this._removeShaders(shaders);\r\n\t\tif (!mustLink) { return true; };\r\n\t\tmustLink = SpiderGL.Utility.getDefaultValue(link, this._autoLink);\r\n\t\tif (!mustLink) { return true; }\r\n\t\treturn this.link()\r\n\t},\r\n\r\n\t/**\r\n\t * Tests whether the passed shader is attached to the program.\r\n\t *\r\n\t * @param {SpiderGL.WebGL.Shader} shader The shader to test for attachment.\r\n\t *\r\n\t * @returns {bool} If the shader is attached, false otherwise.\r\n\t */\r\n\thasShader : function (shader) {\r\n\t\treturn (this._shaderIndex(shader) >= 0);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the attached shaders.\r\n\t *\r\n\t * @returns {array} An array with the attached SpiderGL.WebGL.Shader objects.\r\n\t */\r\n\tgetShaders : function () {\r\n\t\treturn this._shaders.slice();\r\n\t},\r\n\r\n\t/**\r\n\t * Links the program.\r\n\t *\r\n\t * @returns {bool} True if the program has been succesfully linked, false otherwise.\r\n\t */\r\n\tlink : function () {\r\n\t\tthis._gl.linkProgram(this._h);\r\n\t\treturn this._linked;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates the program with the current attribute indices, uniforms and WebGLRenderingContext state\r\n\t * It is performed using WebGLRenderingContext.prototype.validateProgram().\r\n\t *\r\n\t * @returns {bool} True if the program has been succesfully validated, false otherwise.\r\n\t */\r\n\tvalidate : function () {\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\t\tgl.validateProgram(h);\r\n\t\tvar validated = !!gl.getProgramParameter(h, gl.VALIDATE_STATUS);\r\n\t\treturn validated;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the indices of vertex shader attributes.\r\n\t * Only the recognized attributes (i.e. the active attributes in vertex shaders) will be set.\r\n\t * The attribute binding indices will take effect only when the program is linked again.\r\n\t * If autoLink is true, the program is automatically linked.\r\n\t *\r\n\t * @param {object} attributes The attributes to set. For each attribute index to set, the object must contain a property whose name is the name of the vertex attribute and whose value is a non-negative integer specifying the attribute bind index.\r\n\t *\r\n\t * @example\r\n\t * var vertexShaderSrc = \"\" +\r\n\t * \t\"...\" +\r\n\t * \t\"attribute vec3 aPosition; \\n\" +\r\n\t * \t\"attribute vec3 aNormal;   \\n\" +\r\n\t * \t\"...\";\r\n\t *\r\n\t * // setup the program (attribute indices can also be set at construction)\r\n\t * // ...\r\n\t *\r\n\t * // set attributes indices;\r\n\t * // if autoLink is true, the program will be automatically linked;\r\n\t * // otherwise it must be explicitly linked with program.link()\r\n\t * program.setAttributes({\r\n\t * \taPosition : 3,  // bind attribute aPosition to vertex attribute 3\r\n\t * \taNormal   : 1   // bind attribute aNormal to vertex attribute 1\r\n\t * \taColor    : 2   // this attribute is not set because it is not an active attribute\r\n\t * });\r\n\t *\r\n\t * @returns {bool} True if the attributes have been set, false otherwise.\r\n\t *\r\n\t * @see getAttributesIndices\r\n\t * @see getAttributesInfo\r\n\t * @see setUniforms\r\n\t * @see link\r\n\t * @see autoLink\r\n\t */\r\n\tsetAttributes : function (attributes) {\r\n\t\tif (!this._setAttributes(attributes)) return false;\r\n\t\tif (this._autoLink) return this.link();\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets vertex attributes names.\r\n\t *\r\n\t * @returns {array} An array containing the names of all active vertex shader attributes.\r\n\t *\r\n\t * @see getAttributesIndices\r\n\t * @see getAttributesInfo\r\n\t */\r\n\tgetAttributesNames : function () {\r\n\t\tvar attributes  = this._attributes;\r\n\t\tvar rAttributes = [ ];\r\n\t\tfor (var a in attributes) {\r\n\t\t\trAttributes.push(attributes[a].name);\r\n\t\t}\r\n\t\treturn rAttributes;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the vertex attributes binding indices.\r\n\t *\r\n\t * @returns {object} An object with one property for each active vertex attribute. The name of the property is the name of the attribute in the vertex shader and its value is a non-negative integer representing the attribute bind index.\r\n\t *\r\n\t * @see getAttributesInfo\r\n\t * @see setAttributes\r\n\t */\r\n\tgetAttributesIndices : function () {\r\n\t\tvar attributes  = this._attributes;\r\n\t\tvar rAttributes = { };\r\n\t\tfor (var a in attributes) {\r\n\t\t\trAttributes[a] = attributes[a].location;\r\n\t\t}\r\n\t\treturn rAttributes;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the vertex attributes informations.\r\n\t *\r\n\t * @returns {object} An object where each property has the name of a vertex shader attribute and whose value is an object containing attribute information. The attribute index is in the \"location\" property.\r\n\t *\r\n\t * @see getAttributesIndices\r\n\t * @see setAttributes\r\n\t */\r\n\tgetAttributesInfo : function () {\r\n\t\tvar attributes  = this._attributes;\r\n\t\tvar attribute   = null;\r\n\t\tvar rAttributes = { };\r\n\t\tfor (var a in attributes) {\r\n\t\t\tattribute = attributes[a];\r\n\t\t\trAttributes[a] = {\r\n\t\t\t\tindex    : attribute.index,\r\n\t\t\t\tname     : attribute.name,\r\n\t\t\t\tsize     : attribute.size,\r\n\t\t\t\ttype     : attribute.type,\r\n\t\t\t\tlocation : attribute.location\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn rAttributes;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the program uniforms.\r\n\t * Only the recognized uniforms are set.\r\n\t *\r\n\t * @param {object} uniforms An object where each property has the name of the uniform to set and whose value is the uniform value.\r\n\t *\r\n\t * @example\r\n\t * var vertexShaderSrc = \"\" +\r\n\t * \t\"...\" +\r\n\t * \t\"uniform mat4  uMVP;      \\n\" +\r\n\t * \t\"uniform float uScale;    \\n\" +\r\n\t * \t\"uniform vec3  uLightPos; \\n\" +\r\n\t * \t\"...\";\r\n\t *\r\n\t * // setup the program (uniforms can also be set at construction)\r\n\t * // ...\r\n\t *\r\n\t * // set uniform values;\r\n\t * program.setUniforms({\r\n\t * \tuMVP      : getModelViewProjection(),\r\n\t * \tuScale    : 2.3,\r\n\t * \tuLightPos : [0, 0.5, 4.7], // can be a typed array: new Float32Array([0, 0.5, 4.7])\r\n\t * \tuOther    : 1.0 // this uniform is not set because it is not an active uniform\r\n\t * });\r\n\t *\r\n\t * @returns {bool} True if the uniforms have been set succesfully, false otherwise.\r\n\t */\r\n\tsetUniforms : function (uniforms) {\r\n\t\tif (!uniforms) { return false; }\r\n\r\n\t\tvar gl  = this._gl;\r\n\t\tvar cb  = this._cb;\r\n\t\tvar dsa = this._dsa;\r\n\r\n\t\tvar h = this._h;\r\n\r\n\t\tcb.pushProgram();\r\n\t\tgl.useProgram(h);\r\n\r\n\t\tvar _uniforms = this._uniforms;\r\n\t\tvar uniform = null;\r\n\t\tvar value   = null;\r\n\t\tfor (var u in uniforms) {\r\n\t\t\tuniform = _uniforms[u];\r\n\t\t\tif (uniform) {\r\n\t\t\t\tuniform.setValue(dsa, h, uniforms[u]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcb.popProgram();\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets uniforms names.\r\n\t *\r\n\t * @returns {array} An array containing the names of all active uniforms.\r\n\t *\r\n\t * @see getUniformsValues\r\n\t * @see getUniformsInfo\r\n\t */\r\n\tgetUniformsNames : function () {\r\n\t\tvar uniforms  = this._uniforms;\r\n\t\tvar rUniforms = [ ];\r\n\t\tfor (var u in uniforms) {\r\n\t\t\trUniforms.push(uniforms[u].name);\r\n\t\t}\r\n\t\treturn rUniforms;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the values of the program uniforms.\r\n\t *\r\n\t * @returns {object} An object with one property for each active uniform. The name of the property is the name of the uniform and its value is the uniform value, which can be a number, an array or a typed array.\r\n\t */\r\n\tgetUniformsValues : function () {\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\t\tvar uniforms  = this._uniforms;\r\n\t\tvar rUniforms = { };\r\n\t\tfor (var u in uniforms) {\r\n\t\t\trUniforms[u] = gl.getUniform(h, uniforms[u].location);\r\n\t\t}\r\n\t\treturn rUniforms;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the program uniforms informations.\r\n\t *\r\n\t * @returns {object} An object where each property has the name of a program uniform and whose value is an object containing uinformation.\r\n\t */\r\n\tgetUniformsInfo : function () {\r\n\t\tvar uniforms  = this._uniforms;\r\n\t\tvar uniform   = null;\r\n\t\tvar value     = null;\r\n\t\tvar rUniforms = { };\r\n\t\tfor (var u in uniforms) {\r\n\t\t\tuniform = uniforms[u];\r\n\t\t\trUniforms[u] = {\r\n\t\t\t\tindex    : uniform.index,\r\n\t\t\t\tname     : uniform.name,\r\n\t\t\t\tsize     : uniform.size,\r\n\t\t\t\ttype     : uniform.type,\r\n\t\t\t\tlocation : uniform.location\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn rUniforms;\r\n\t},\r\n\r\n\t/**\r\n\t * Destroys the WebGLProgram.\r\n\t * After destruction, the handle is set to null and this object should not be used anymore.\r\n\t *\r\n\t * @see SpiderGL.WebGL.ObjectGL#destroy\r\n\t */\r\n\tdestroy : function () {\r\n\t\tthis._gl.deleteProgram(this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Binds the wrapped WebGLProgram with WebGLRenderingContext.prototype.useProgram().\r\n\t *\r\n\t * @see unbind\r\n\t */\r\n\tbind : function () {\r\n\t\tthis._gl.useProgram(this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Binds the \"null\" program with WebGLRenderingContext.prototype.useProgram(null).\r\n\t * This method is provided only for simmetry with {@link bind} and is not relative to the object state.\r\n\t *\r\n\t * @see bind\r\n\t */\r\n\tunbind : function () {\r\n\t\tthis._gl.useProgram(null);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.Program, SpiderGL.WebGL.ObjectGL);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.Renderbuffer.\r\n *\r\n * SpiderGL.WebGL.Renderbuffer is a wrapper for WebGLRenderbuffer.\r\n *\r\n * @class The SpiderGL.WebGL.Renderbuffer is a wrapper for WebGLRenderbuffer.\r\n *\r\n * @augments SpiderGL.WebGL.ObjectGL\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] Optional parameters.\r\n * @param {WebGLRenderbuffer} [options.handle] A WebGLRenderbuffer. If present, this object will be used as the wrapped WebGLRenderbuffer. Otherwise a new one will be created.\r\n * @param {number} [options.internalFormat] The WebGL enumeration specifying the renderbuffer internal format.\r\n * @param {object} [options.width] The width of the renderbuffer.\r\n * @param {object} [options.height] The height of the renderbuffer.\r\n *\r\n * @example\r\n * var rb = new SpiderGL.WebGL.Renderbuffer(gl, {\r\n * \tinternalFormat : gl.RGBA,\r\n * \twidth  : 800,\r\n * \theight : 600\r\n * });\r\n *\r\n * @see setStorage\r\n * @see SpiderGL.WebGL.Framebuffer\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.Renderbuffer = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\r\n\tif (SpiderGL.Type.instanceOf(h, WebGLRenderbuffer)) {\r\n\t\toptions = { handle : options };\r\n\t}\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\thandle : null,\r\n\t}, options);\r\n\r\n\tSpiderGL.WebGL.ObjectGL.call(this, gl, SpiderGL.WebGL.Renderbuffer.TARGET, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n\r\n\tvar gl  = this._gl;\r\n\tvar cb  = this._cb;\r\n\tvar dsa = this._dsa;\r\n\r\n\tvar t = this._t;\r\n\tvar h = this._h;\r\n\r\n\tvar format = gl.NONE;\r\n\tvar width  = 0;\r\n\tvar height = 0;\r\n\r\n\tif (h) {\r\n\t\tcb.pushRenderbuffer(t);\r\n\t\tgl.bindRenderbuffer(t, h);\r\n\t\tformat = gl.getRenderbufferParameter(t, gl.RENDERBUFFER_INTERNAL_FORMAT);\r\n\t\twidth  = gl.getRenderbufferParameter(t, gl.RENDERBUFFER_WIDTH);\r\n\t\theight = gl.getRenderbufferParameter(t, gl.RENDERBUFFER_HEIGHT);\r\n\t\tcb.popRenderbuffer(t);\r\n\t}\r\n\telse {\r\n\t\th = gl.createRenderbuffer();\r\n\t\tthis._h = h;\r\n\t}\r\n\th._spidergl = this;\r\n\r\n\tthis._width  = width;\r\n\tthis._height = height;\r\n\tthis._format = format;\r\n\r\n\tif (SpiderGL.Type.isNumber(options.internalFormat) && SpiderGL.Type.isNumber(options.width) && SpiderGL.Type.isNumber(options.height)) {\r\n\t\tthis.setStorage(options.internalFormat, options.width, options.height, options.format);\r\n\t}\r\n}\r\n\r\n/**\r\n * WebGL target for renderbuffers.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.RENDERBUFFER\r\n */\r\nSpiderGL.WebGL.Renderbuffer.TARGET = WebGLRenderingContext.prototype.RENDERBUFFER;\r\n\r\n/**\r\n * WebGLRenderbuffer unbinding.\r\n *\r\n * This function binds the null renderbuffer to the WebGLRenderingContext.prototype.RENDERBUFFER target.\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.Renderbuffer.unbind = function (gl) { gl.bindRenderbuffer(SpiderGL.WebGL.Renderbuffer.TARGET, null); };\r\n\r\nSpiderGL.WebGL.Renderbuffer.prototype = {\r\n\t_gl_deleteRenderbuffer : function (renderbuffer) {\r\n\t\tthis._h = null;\r\n\t},\r\n\r\n\t_gl_isRenderbuffer : function (renderbuffer) {\r\n\t},\r\n\r\n\t_gl_bindRenderbuffer : function (target, renderbuffer) {\r\n\t},\r\n\r\n\t_gl_getRenderbufferParameter : function (target, pname) {\r\n\t},\r\n\r\n\t_gl_renderbufferStorage : function (target, internalformat, width, height) {\r\n\t\tthis._format = internalformat;\r\n\t\tthis._width  = width;\r\n\t\tthis._height = height;\r\n\t},\r\n\r\n\t/*\r\n\tget isEmpty () { return ((this._width <= 0) || (this._height <= 0)); },\r\n\t*/\r\n\r\n\t/**\r\n\t * Tests if the renderbuffer is ready to use.\r\n\t * A renderbuffer is considered ready if its width and height are greater than zero.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget isReady() {\r\n\t\treturn ((this._width > 0) && (this._height > 0));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the WebGL internal format of the renderbuffer.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget format() {\r\n\t\treturn this._format;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the width in pixels of the renderbuffer.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget width() {\r\n\t\treturn this._width;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the height in pixels of the renderbuffer.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget height() {\r\n\t\treturn this._height;\r\n\t},\r\n\r\n\t/**\r\n\t * Setups the renderbuffer storage configuration.\r\n\t *\r\n\t * @param {number} internalFormat The WebGL enumeration for the internal pixel format.\r\n\t * @param {number} width The width in pixels of the renderbuffer.\r\n\t * @param {number} height The height in pixels of the renderbuffer.\r\n\t */\r\n\tsetStorage : function (internalFormat, width, height) {\r\n\t\tthis._dsa.renderbufferStorage(this._h, this._t, internalFormat, width, height);\r\n\t},\r\n\r\n\t/**\r\n\t * Destroys the WebGLRenderbuffer.\r\n\t * After destruction, the handle is set to null and this object should not be used anymore.\r\n\t *\r\n\t * @see SpiderGL.WebGL.ObjectGL#destroy\r\n\t */\r\n\tdestroy : function () {\r\n\t\tthis._gl.deleteRenderbuffer(this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Binds the wrapped WebGLRenderbuffer to the WebGLRenderingContex.RENDERBUFFER target.\r\n\t *\r\n\t * @see unbind\r\n\t */\r\n\tbind : function () {\r\n\t\tthis._gl.bindRenderbuffer(this._t, this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Binds \"null\" to the WebGLRenderingContex.RENDERBUFFER target.\r\n\t * This method is provided only for simmetry with {@link bind} and is not relative to the object state.\r\n\t *\r\n\t * @see bind\r\n\t */\r\n\tunbind : function () {\r\n\t\tthis._gl.bindRenderbuffer(this._t, null);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.Renderbuffer, SpiderGL.WebGL.ObjectGL);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.Shader.\r\n *\r\n * SpiderGL.WebGL.Shader is the base class for WebGLShader object wrappers and must not be directly used.\r\n *\r\n * @class The SpiderGL.WebGL.Shader is the base class for all WebGLShader object wrappers, i.e. {@link SpiderGL.WebGL.Shader} and {@link SpiderGL.WebGL.FragmentShader}.\r\n *\r\n * @augments SpiderGL.WebGL.ObjectGL\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {number} target Not used.\r\n * @param {number} type WebGL shader type.\r\n * @param {object} [options] Optional parameters.\r\n * @param {WebGLShader} [options.handle] If defined, the provided shader will be wrapped and its source code will be queried to the rendering context. Otherwise an internal shader will be created.\r\n * @param {bool} [options.autoCompile=SpiderGL.WebGL.Shader.DEFAULT_AUTO_COMPILE] If true, the shader is automatically compiled whenever its source code changes.\r\n * @param {string} [options.source] Shader source code. If autoCompile is true, the shader will be automatically compiled.\r\n *\r\n * @see autoCompile\r\n * @see source\r\n * @see compile\r\n * @see SpiderGL.WebGL.VertexShader\r\n * @see SpiderGL.WebGL.FragmentShader\r\n * @see SpiderGL.WebGL.Program\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.Shader = function (gl, target, type, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\r\n\tif (SpiderGL.Type.instanceOf(options, WebGLShader)) {\r\n\t\toptions = { handle : options };\r\n\t}\r\n\telse if (SpiderGL.Type.isString(options)) {\r\n\t\toptions = { source : options };\r\n\t}\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\thandle      : null,\r\n\t\tsource      : null,\r\n\t\tautoCompile : SpiderGL.WebGL.Shader.DEFAULT_AUTO_COMPILE\r\n\t}, options);\r\n\r\n\tSpiderGL.WebGL.ObjectGL.call(this, gl, target, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n\r\n\tvar gl  = this._gl;\r\n\tvar cb  = this._cb;\r\n\tvar dsa = this._dsa;\r\n\r\n\tvar source   = \"\";\r\n\tvar compiled = false;\r\n\tvar deleted  = false;\r\n\tvar log      = \"\";\r\n\r\n\tvar h = this._h;\r\n\tif (h) {\r\n\t\tsource   = gl.getShaderSource(h);\r\n\t\tif (!source) { source = \"\"; }\r\n\t\tcompiled = !!gl.getShaderParameter(h, gl.COMPILE_STATUS);\r\n\t\tdeleted  = !!gl.getShaderParameter(h, gl.DELETE_STATUS);\r\n\t\tlog      = gl.getShaderInfoLog(h);\r\n\t\tif (!log) { log = \"\"; }\r\n\t}\r\n\telse {\r\n\t\th = gl.createShader(type);\r\n\t\tthis._h = h;\r\n\t}\r\n\th._spidergl = this;\r\n\r\n\tthis._source      = source;\r\n\tthis._compiled    = compiled;\r\n\tthis._log         = log;\r\n\tthis._autoCompile = options.autoCompile;\r\n\r\n\tif (options.source) { this.setSource(options.source); }\r\n}\r\n\r\n/**\r\n * Dummy WebGL target for shaders.\r\n *\r\n * It is equal to WebGLRenderingContext.prototype.NONE and is provided only for completeness with other WebGL wrappers.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.NONE\r\n */\r\nSpiderGL.WebGL.Shader.TARGET = WebGLRenderingContext.prototype.NONE;\r\n\r\n/**\r\n * Default value for SpiderGL.WebGL.Shader#autoCompile.\r\n *\r\n * @type bool\r\n *\r\n * @default true\r\n */\r\nSpiderGL.WebGL.Shader.DEFAULT_AUTO_COMPILE = true;\r\n\r\n/**\r\n * Dummy shader unbinding.\r\n *\r\n * This function does nothing and it is provided only for simmetry with other wrappers.\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.Shader.unbind = function (gl) { };\r\n\r\nSpiderGL.WebGL.Shader.prototype = {\r\n\t_gl_deleteShader : function (shader) {\r\n\t\tthis._h = null;\r\n\t},\r\n\r\n\t_gl_isShader : function (shader) {\r\n\t},\r\n\r\n\t_gl_getShaderParameter : function (shader, pname) {\r\n\t},\r\n\r\n\t_gl_getShaderInfoLog : function (shader) {\r\n\t},\r\n\r\n\t_gl_getShaderSource : function (shader) {\r\n\t},\r\n\r\n\t_gl_compileShader : function (shader) {\r\n\t\tthis._postCompile();\r\n\t},\r\n\r\n\t_gl_shaderSource : function (shader, source) {\r\n\t\tthis._source = source;\r\n\t\tif (!this._source) { this._source = \"\"; }\r\n\t},\r\n\r\n\t_postCompile : function () {\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\t\tthis._compiled = !!gl.getShaderParameter(h, gl.COMPILE_STATUS);\r\n\t\tthis._log      = gl.getShaderInfoLog(h);\r\n\t\tif (!this._log) { this._log = \"\"; }\r\n\t},\r\n\r\n\t/*\r\n\tget isEmpty () { return (this._source.length <= 0); },\r\n\t*/\r\n\r\n\t/**\r\n\t * Tests if the shader is ready to use.\r\n\t * A shader is considered ready if it is successfully compiled.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see isCompiled\r\n\t */\r\n\tget isReady() {\r\n\t\treturn this.isCompiled;\r\n\t},\r\n\r\n\t/**\r\n\t * Tests if the shader is successfully compiled.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see isReady\r\n\t */\r\n\tget isCompiled() {\r\n\t\treturn this._compiled;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the log output generated by the shader compiler.\r\n\t *\r\n\t * @type string\r\n\t *\r\n\t * @readonly\r\n\t *\r\n\t * @see compile\r\n\t */\r\n\tget log() {\r\n\t\treturn this._log;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets if the shader will be compiled automatically whenever the source code is changed.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @see source\r\n\t * @see compile\r\n\t */\r\n\tget autoCompile() {\r\n\t\treturn this._autoCompile;\r\n\t},\r\n\r\n\tset autoCompile(on) {\r\n\t\tthis._autoCompile = !!on;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the shader source code.\r\n\t * If compile is not specified and autoCompile is true, the shader is automatically compiled.\r\n\t *\r\n\t * @param {string} src The shader source code.\r\n\t * @param {bool} [compile] If specified, overrides the value of autoCompile.\r\n\t *\r\n\t * @see compile\r\n\t * @see autoCompile\r\n\t */\r\n\tsetSource : function (src, compile) {\r\n\t\tvar gl = this._gl;\r\n\t\tvar h = this._h;\r\n\r\n\t\tgl.shaderSource(h, src);\r\n\r\n\t\tvar c = SpiderGL.Utility.getDefaultValue(compile, this._autoCompile);\r\n\t\tif (!c) { true; }\r\n\t\treturn this.compile();\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the shader source code.\r\n\t * If autoCompile is true, the shader is automatically compiled when the source code string is changed.\r\n\t *\r\n\t * @type string\r\n\t *\r\n\t * @see setSource\r\n\t * @see compile\r\n\t * @see autoCompile\r\n\t */\r\n\tget source() {\r\n\t\treturn this._source;\r\n\t},\r\n\r\n\tset source(src) {\r\n\t\tthis.setSource(src);\r\n\t},\r\n\r\n\t/**\r\n\t * Compiles the shader.\r\n\t *\r\n\t * @returns {bool} True if the shader has been successfully compiled, false otherwise.\r\n\t *\r\n\t * @see source\r\n\t * @see autoCompile\r\n\t * @see log\r\n\t */\r\n\tcompile : function () {\r\n\t\tthis._gl.compileShader(this._h);\r\n\t\treturn this._compiled;\r\n\t},\r\n\r\n\t/**\r\n\t * Destroys the WebGLShader.\r\n\t * After destruction, the handle is set to null and this object should not be used anymore.\r\n\t *\r\n\t * @see SpiderGL.WebGL.ObjectGL#destroy\r\n\t */\r\n\tdestroy : function () {\r\n\t\tthis._gl.deleteShader(this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Dummy bind method.\r\n\t * It is provided for simmetry with other WebGL object wrappers.\r\n\t *\r\n\t * @see unbind\r\n\t */\r\n\tbind : function () {\r\n\t},\r\n\r\n\t/**\r\n\t * Dummy unbind method.\r\n\t * It is provided for simmetry with other WebGL object wrappers.\r\n\t *\r\n\t * @see bind\r\n\t */\r\n\tunbind : function () {\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.Shader, SpiderGL.WebGL.ObjectGL);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.VertexShader.\r\n *\r\n * SpiderGL.WebGL.VertexShader represents a wrapper for a WebGLShader whose type is type WebGLRenderingContext.prototype.VERTEX_SHADER.\r\n *\r\n * @class The SpiderGL.WebGL.VertexShader is a WebGLShader wrapper for vertex shaders.\r\n *\r\n * @augments SpiderGL.WebGL.Shader\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] See {@link SpiderGL.WebGL.Shader}.\r\n *\r\n * @see SpiderGL.WebGL.Shader\r\n * @see SpiderGL.WebGL.FragmentShader\r\n * @see SpiderGL.WebGL.Program\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.VertexShader = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\tSpiderGL.WebGL.Shader.call(this, gl, SpiderGL.WebGL.VertexShader.TARGET, gl.VERTEX_SHADER, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n}\r\n\r\n/**\r\n * Dummy WebGL target for vertex shaders.\r\n *\r\n * It is equal to WebGLRenderingContext.prototype.NONE and is provided only for completeness with other WebGL wrappers.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.NONE\r\n */\r\nSpiderGL.WebGL.VertexShader.TARGET = WebGLRenderingContext.prototype.NONE;\r\n\r\n/**\r\n * Dummy vertex shader unbinding.\r\n *\r\n * This function does nothing and it is provided only for simmetry with other wrappers.\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.VertexShader.unbind = function (gl) { };\r\n\r\nSpiderGL.WebGL.VertexShader.prototype = { };\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.VertexShader, SpiderGL.WebGL.Shader);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.FragmentShader.\r\n *\r\n * SpiderGL.WebGL.FragmentShader represents a wrapper for a WebGLShader whose type is type WebGLRenderingContext.prototype.FRAGMENT_SHADER.\r\n *\r\n * @class The SpiderGL.WebGL.FragmentShader is a WebGLShader wrapper for fragment shaders.\r\n *\r\n * @augments SpiderGL.WebGL.Shader\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] See {@link SpiderGL.WebGL.Shader}.\r\n *\r\n * @see SpiderGL.WebGL.Shader\r\n * @see SpiderGL.WebGL.VertexShader\r\n * @see SpiderGL.WebGL.Program\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.FragmentShader = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\tSpiderGL.WebGL.Shader.call(this, gl, SpiderGL.WebGL.FragmentShader.TARGET, gl.FRAGMENT_SHADER, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n}\r\n\r\n/**\r\n * Dummy WebGL target for fragment shaders.\r\n *\r\n * It is equal to WebGLRenderingContext.prototype.NONE and is provided only for completeness with other WebGL wrappers.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.NONE\r\n */\r\nSpiderGL.WebGL.FragmentShader.TARGET = WebGLRenderingContext.prototype.NONE;\r\n\r\n/**\r\n * Dummy fragment shader unbinding.\r\n *\r\n * This function does nothing and it is provided only for simmetry with other wrappers.\r\n *\r\n * @param  {WebGLRenderingContext} gl A WebGLRenderingContext.prototype.\r\n */\r\nSpiderGL.WebGL.FragmentShader.unbind = function (gl) { };\r\n\r\nSpiderGL.WebGL.FragmentShader.prototype = { };\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.FragmentShader, SpiderGL.WebGL.Shader);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.Texture.\r\n *\r\n * SpiderGL.WebGL.Texture is the base class for WebGLTexture object wrappers ({@link SpiderGL.WebGL.Texture2D} and {@link SpiderGL.WebGL.TextureCubeMap}) and must not be directly used.\r\n *\r\n * @class The SpiderGL.WebGL.Texture is the base class for all WebGLTexture object wrappers, i.e. {@link SpiderGL.WebGL.Texture2D} and {@link SpiderGL.WebGL.TextureCubeMap}.\r\n *\r\n * @augments SpiderGL.WebGL.ObjectGL\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {number} target Texture-specific target.\r\n * @param {object} [options] Optional parameters.\r\n * @param {WebGLTexture} [options.handle] If defined, the provided texture will be wrapped and its sampling parameters will be queried to the rendering context; as texture image base level width and height can not be retrieved, they should be specified with the width and height optional parameters. If handle is not specified, an internal texture will be created.\r\n * @param {string|array} [options.url] The url of the texture image to load. It has precedence over the data optional parameter. For SpiderGL.Texture.Texture2D, url is a string. For SpiderGL.Texture.TextureCubeMap, url is an array of six strings, one for each cube map face, in the order [+X, -X, +Y, -Y, +Z, -Z].\r\n * @param {ArrayBuffer|ArrayBufferView|ImageData|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} [options.data] The texture image pixel data.\r\n * @param {number} [options.internalFormat=SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT] The texture internal format.\r\n * @param {number} [options.width] If data is null or a typed array, specifies the texture image width. If handle is provided, the width parameter will supply the width information, not querable to the WebGLRenderingContext.prototype.\r\n * @param {number} [options.height] If data is null or a typed array, specifies the texture image height. If handle is provided, the width parameter will supply the height information, not querable to the WebGLRenderingContext.prototype.\r\n * @param {number} [options.border=SpiderGL.WebGL.Texture.DEFAULT_BORDER] Texture border.\r\n * @param {number} [options.format=SpiderGL.WebGL.Texture.DEFAULT_FORMAT] The format parameter used for WebGLRenderingContext.prototype.texImage2D.\r\n * @param {number} [options.type=SpiderGL.WebGL.Texture.DEFAULT_TYPE] The type parameter used for WebGLRenderingContext.prototype.texImage2D.\r\n * @param {number} [options.magFilter=SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER] Texture magnification filter (see {@link SpiderGL.WebGL.Texture#magFilter}).\r\n * @param {number} [options.minFilter=SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER] Texture minification filter (see {@link SpiderGL.WebGL.Texture#minFilter}).\r\n * @param {number} [options.wrapS=SpiderGL.WebGL.Texture.DEFAULT_WRAP_S] Texture horizontal wrap mode (see {@link SpiderGL.WebGL.Texture#wrapS}).\r\n * @param {number} [options.wrapT=SpiderGL.WebGL.Texture.DEFAULT_WRAP_T] Texture vertical wrap mode (see {@link SpiderGL.WebGL.Texture#wrapT}).\r\n * @param {bool} [options.autoMipmap=SpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP] If true, mipmaps are automatically generated when calling setImage or setSubImage (see {@link SpiderGL.WebGL.Texture#autoMipmap}).\r\n * @param {bool} [options.generateMipmap] If specified, overrides autoMipmap for this call.\r\n * @param {bool} [options.flipYPolicy=SpiderGL.WebGL.Texture.DEFAULT_UNPACK_FLIP_Y] WebGL unpack flip Y policy (see SpiderGL.WebGL.Texture#flipYPolicy).\r\n * @param {bool} [options.flipY] If specified, overrides flipYPolicy for this call.\r\n * @param {bool} [options.premultiplyAlphaPolicy=SpiderGL.WebGL.Texture.DEFAULT_UNPACK_PREMULTIPLY_ALPHA] WebGL unpack premultiply alpha policy (see SpiderGL.WebGL.Texture#premultiplyAlphaPolicy).\r\n * @param {bool} [options.premultiplyAlpha] If specified, overrides premultiplyAlphaPolicy for this call.\r\n * @param {number} [options.colorspaceConversionPolicy=SpiderGL.WebGL.Texture.DEFAULT_UNPACK_COLORSPACE_CONVERSION] WebGL unpack colorspace conversion policy (see SpiderGL.WebGL.Texture#colorspaceConversionPolicy).\r\n * @param {number} [options.colorspaceConversion] If specified, overrides colorspaceConversionPolicy for this call.\r\n * @param {function} [options.onCancel] If url is specified, this function will be called if image data loading is cancelled.\r\n * @param {function} [options.onError] If url is specified, this function will be called if an error occurs when loading image data.\r\n * @param {function} [options.onProgress] If url is specified, this function will be called during the image loading progress.\r\n * @param {function} [options.onSuccess] If url is specified, this function will be called when image data has been successfully loaded.\r\n *\r\n * @example\r\n * var tex1 = new SpiderGL.WebGL.Texture2D(gl, {\r\n * \tinternalFormat : gl.RGBA,              // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT\r\n * \twidth          : 256,\r\n * \theight         : 128,\r\n * \tborder         : 0,                    // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_BORDER\r\n * \tformat         : gl.RGBA,              // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_FORMAT\r\n * \ttype           : gl.UNSIGNED_BYTE,     // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_TYPE\r\n * \tdata           : new Uint8Array(...),  // if omitted or null, the texture is initialized to zero by the WebGLRenderingContext\r\n * \tmagFilter      : gl.LINEAR,            // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER\r\n * \tminFilter      : gl.LINEAR,            // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER\r\n * \twrapS          : gl.CLAMP_TO_EDGE,     // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_WRAP_S\r\n * \twrapT          : gl.CLAMP_TO_EDGE,     // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_WRAP_T\r\n * \tautoMipmap     : true,                 // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP\r\n * \tgenerateMipmap : false,                // if specified, overrides autoMipmap for this implicit call to setImage\r\n * \tflipYPolicy                : true,     // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_UNPACK_FLIP_Y\r\n * \tflipY                      : false,    // if specified, overrides flipYPolicy for this implicit call to setImage\r\n * \tpremultiplyAlphaPolicy     : true,     // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_UNPACK_PREMULTIPLY_ALPHA\r\n * \tpremultiplyAlpha           : false,    // if specified, overrides premultiplyAlphaPolicy for this implicit call to setImage\r\n * \tcolorspaceConversionPolicy : true,     // if omitted, defaults to SpiderGL.WebGL.Texture.DEFAULT_UNPACK_COLORSPACE_CONVERSION\r\n * \tcolorspaceConversion       : false     // if specified, overrides colorspaceConversionPolicy for this implicit call to setImage\r\n * });\r\n *\r\n * var tex2 = new SpiderGL.WebGL.TextureCubeMap(gl, {\r\n * \turl : [\r\n * \t\thttp://someurl.org/cubemap_pos_x.png,\r\n * \t\thttp://someurl.org/cubemap_neg_x.png,\r\n * \t\thttp://someurl.org/cubemap_pos_y.png,\r\n * \t\thttp://someurl.org/cubemap_neg_y.png,\r\n * \t\thttp://someurl.org/cubemap_pos_z.png,\r\n * \t\thttp://someurl.org/cubemap_neg_z.png\r\n * \t],\r\n * \tonCancel   : function () { ... },\r\n * \tonError    : function () { ... },\r\n * \tonProgress : function () { ... },\r\n * \tonLoad     : function () { ... },\r\n * \twrapS      : gl.REPEAT,\r\n * \tmagFilter  : gl.NEAREST\r\n * });\r\n *\r\n * @see SpiderGL.WebGL.Texture2D\r\n * @see SpiderGL.WebGL.TextureCubeMap\r\n * @see SpiderGL.WebGL.Framebuffer\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.Texture = function (gl, target, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\r\n\tif (SpiderGL.Type.instanceOf(options, WebGLTexture)) {\r\n\t\toptions = { handle : options };\r\n\t}\r\n\telse if (SpiderGL.Type.isString(options)) {\r\n\t\toptions = { url : options };\r\n\t}\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\thandle                     : null,\r\n\t\tmagFilter                  : SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER,\r\n\t\tminFilter                  : SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER,\r\n\t\twrapS                      : SpiderGL.WebGL.Texture.DEFAULT_WRAP_S,\r\n\t\twrapT                      : SpiderGL.WebGL.Texture.DEFAULT_WRAP_T,\r\n\t\tflipYPolicy                : SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y,\r\n\t\tpremultiplyAlphaPolicy     : SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA,\r\n\t\tcolorspaceConversionPolicy : SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION,\r\n\t\tautoMipmap                 : SpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP,\r\n\t\tformat                     : gl.NONE,\r\n\t\twidth                      : 0,\r\n\t\theight                     : 0\r\n\t}, options);\r\n\r\n\tSpiderGL.WebGL.ObjectGL.call(this, gl, target, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n\r\n\tvar gl  = this._gl;\r\n\tvar cb  = this._cb;\r\n\tvar dsa = this._dsa;\r\n\r\n\tvar t = this._t;\r\n\tvar h = this._h;\r\n\r\n\tif (!h) {\r\n\t\th = gl.createTexture();\r\n\t\tthis._h = h;\r\n\t}\r\n\r\n\tcb.pushTexture(t);\r\n\tgl.bindTexture(t, h);\r\n\tthis._magFilter = gl.getTexParameter(t, gl.TEXTURE_MAG_FILTER);\r\n\tthis._minFilter = gl.getTexParameter(t, gl.TEXTURE_MIN_FILTER);\r\n\tthis._wrapS     = gl.getTexParameter(t, gl.TEXTURE_WRAP_S);\r\n\tthis._wrapT     = gl.getTexParameter(t, gl.TEXTURE_WRAP_T);\r\n\tcb.popTexture(t);\r\n\th._spidergl = this;\r\n\r\n\tthis._format               = options.format;\r\n\tthis._width                = options.width;\r\n\tthis._height               = options.height;\r\n\tthis._flipY                = options.flipYPolicy;\r\n\tthis._premultiplyAlpha     = options.premultiplyAlphaPolicy;\r\n\tthis._colorspaceConversion = options.colorspaceConversionPolicy;\r\n\tthis._autoMipmap           = options.autoMipmap;\r\n\r\n\tthis._missingFaces = SpiderGL.WebGL.Texture._FACE_ALL_BITS;\r\n\r\n\tthis.setSampler(options);\r\n}\r\n\r\nSpiderGL.WebGL.Texture.TARGET = WebGLRenderingContext.prototype.NONE;\r\n\r\n/**\r\n * Default texture border when calling setImage\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_BORDER = 0;\r\n\r\n/**\r\n * Default texture input data format when calling setImage or setSubImage.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.RGBA\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_FORMAT = WebGLRenderingContext.prototype.RGBA;\r\n\r\n/**\r\n * Default value for SpiderGL.WebGL.Texture#autoMipmap\r\n *\r\n * @type bool\r\n *\r\n * @default false\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP = false;\r\n\r\n/**\r\n * Default texture internal format when calling setImage.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.RGBA\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT = WebGLRenderingContext.prototype.RGBA;\r\n\r\n/**\r\n * Default texture level when calling setImage.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_LEVEL = 0;\r\n\r\n/**\r\n * Default texture magnification filter.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.LINEAR\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER = WebGLRenderingContext.prototype.LINEAR;\r\n\r\n/**\r\n * Default texture minification filter.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.LINEAR\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER = WebGLRenderingContext.prototype.LINEAR;\r\n\r\n/**\r\n * Default texture input data type when calling setImage or setSubImage.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.UNSIGNED_BYTE\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_TYPE = WebGLRenderingContext.prototype.UNSIGNED_BYTE;\r\n\r\n/**\r\n * Default texture wrap mode in horizontal direction.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.REPEAT\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_WRAP_S = WebGLRenderingContext.prototype.REPEAT;\r\n\r\n/**\r\n * Default texture wrap mode in vertical direction.\r\n *\r\n * @type number\r\n *\r\n * @default WebGLRenderingContext.prototype.REPEAT\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_WRAP_T = WebGLRenderingContext.prototype.REPEAT;\r\n\r\n/**\r\n * Default texture sub-image x offset when calling setSubImage.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_X_OFFSET = 0;\r\n\r\n/**\r\n * Default texture sub-image y offset when calling setSubImage.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_Y_OFFSET = 0;\r\n\r\n/**\r\n * Default value for pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_FLIP_Y_WEBGL when calling setImage or setSubImage.\r\n *\r\n * @default true\r\n *\r\n * @see SpiderGL.WebGL.Texture.DEFAULT_UNPACK_PREMULTIPLY_ALPHA\r\n * @see SpiderGL.WebGL.Texture.DEFAULT_UNPACK_COLORSPACE_CONVERSION\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_UNPACK_FLIP_Y = true;\r\n\r\n/**\r\n * Default value for pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_PREMULTIPLY_ALPHA_WEBGL when calling setImage or setSubImage.\r\n *\r\n * @default true\r\n *\r\n * @see SpiderGL.WebGL.Texture.DEFAULT_UNPACK_FLIP_Y\r\n * @see SpiderGL.WebGL.Texture.DEFAULT_UNPACK_COLORSPACE_CONVERSION\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_UNPACK_PREMULTIPLY_ALPHA = false;\r\n\r\n/**\r\n * Default value for pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_COLORSPACE_CONVERSION_WEBGL when calling setImage or setSubImage.\r\n *\r\n * @default WebGLRenderingContext.prototype.NONE\r\n *\r\n * @see SpiderGL.WebGL.Texture.DEFAULT_UNPACK_FLIP_Y\r\n * @see SpiderGL.WebGL.Texture.DEFAULT_UNPACK_PREMULTIPLY_ALPHA\r\n */\r\nSpiderGL.WebGL.Texture.DEFAULT_UNPACK_COLORSPACE_CONVERSION = WebGLRenderingContext.prototype.NONE;\r\n\r\nSpiderGL.WebGL.Texture.unbind = function (gl) { };\r\n\r\nSpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT = (1 << 0);\r\nSpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT = (1 << 1);\r\nSpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT = (1 << 2);\r\nSpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT = (1 << 3);\r\nSpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT = (1 << 4);\r\nSpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT = (1 << 5);\r\nSpiderGL.WebGL.Texture._FACE_ALL_BITS       = (SpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT | SpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT | SpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT | SpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT | SpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT | SpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT);\r\n\r\nSpiderGL.WebGL.Texture._faceBits = { };\r\nSpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_2D                 ] = SpiderGL.WebGL.Texture._FACE_ALL_BITS;\r\nSpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP           ] = SpiderGL.WebGL.Texture._FACE_ALL_BITS;\r\nSpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X] = SpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT;\r\nSpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_X] = SpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT;\r\nSpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Y] = SpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT;\r\nSpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Y] = SpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT;\r\nSpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Z] = SpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT;\r\nSpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Z] = SpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT;\r\n\r\nSpiderGL.WebGL.Texture.prototype = {\r\n\t_gl_deleteTexture : function (texture) {\r\n\t\tthis._h = null;\r\n\t},\r\n\r\n\t_gl_isTexture : function (texture) {\r\n\t},\r\n\r\n\t_gl_bindTexture : function (target, texture) {\r\n\t},\r\n\r\n\t_gl_getTexParameter : function (target, pname) {\r\n\t},\r\n\r\n\t_gl_copyTexImage2D : function (target, level, internalformat, x, y, width, height, border) {\r\n\t\tif (level == 0) {\r\n\t\t\tthis._format = internalformat;\r\n\t\t\tthis._width  = width;\r\n\t\t\tthis._height = height;\r\n\t\t}\r\n\t},\r\n\r\n\t_gl_copyTexSubImage2D : function (target, level, xoffset, yoffset, x, y, width, height, border) {\r\n\t},\r\n\r\n\t_gl_generateMipmap : function (target) {\r\n\t},\r\n\r\n\t_gl_texImage2D : function (target) {\r\n\t\tvar n = arguments.length;\r\n\t\tif (n === 6) {\r\n\t\t\tif (arguments[1] === 0) {\r\n\t\t\t\tthis._format = arguments[2];\r\n\t\t\t\tthis._width  = arguments[5].width;\r\n\t\t\t\tthis._height = arguments[5].height;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (n === 9) {\r\n\t\t\tif (arguments[1] === 0) {\r\n\t\t\t\tthis._format = arguments[2];\r\n\t\t\t\tthis._width  = arguments[3];\r\n\t\t\t\tthis._height = arguments[4];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_gl_texParameterf : function (target, pname, param) {\r\n\t\tthis._setTexParameter(pname, param);\r\n\t},\r\n\r\n\t_gl_texParameteri : function (target, pname, param) {\r\n\t\tthis._setTexParameter(pname, param);\r\n\t},\r\n\r\n\t_gl_texSubImage2D : function (target) {\r\n\t},\r\n\r\n\t_setTexParameter : function (pname, param) {\r\n\t\tvar gl = this._gl;\r\n\r\n\t\tswitch (pname) {\r\n\t\t\tcase gl.TEXTURE_MAG_FILTER : this._magFilter = param; break;\r\n\t\t\tcase gl.TEXTURE_MIN_FILTER : this._minFilter = param; break;\r\n\t\t\tcase gl.TEXTURE_WRAP_S     : this._wrapS     = param; break;\r\n\t\t\tcase gl.TEXTURE_WRAP_T     : this._wrapT     = param; break;\r\n\t\t\tdefault : break;\r\n\t\t}\r\n\t},\r\n\r\n\t_setImageData : function (fullImage, target, options) {\r\n\t\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tinternalFormat       : SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT,\r\n\t\t\tborder               : SpiderGL.WebGL.Texture.DEFAULT_BORDER,\r\n\t\t\txoffset              : SpiderGL.WebGL.Texture.DEFAULT_X_OFFSET,\r\n\t\t\tyoffset              : SpiderGL.WebGL.Texture.DEFAULT_Y_OFFSET,\r\n\t\t\tlevel                : SpiderGL.WebGL.Texture.DEFAULT_LEVEL,\r\n\t\t\tformat               : SpiderGL.WebGL.Texture.DEFAULT_FORMAT,\r\n\t\t\ttype                 : SpiderGL.WebGL.Texture.DEFAULT_TYPE,\r\n\t\t\twidth                : 0,\r\n\t\t\theight               : 0,\r\n\t\t\tgenerateMipmap       : this._autoMipmap,\r\n\t\t\tflipY                : this._flipY,\r\n\t\t\tpremultiplyAlpha     : this._premultiplyAlpha,\r\n\t\t\tcolorspaceConversion : this._colorspaceConversion,\r\n\t\t\tdata                 : null,\r\n\t\t\turl                  : null,\r\n\t\t\tonCancel             : null,\r\n\t\t\tonError              : null,\r\n\t\t\tonProgress           : null,\r\n\t\t\tonSuccess            : null\r\n\t\t}, options);\r\n\r\n\t\tvar isURL     = !!options.url;\r\n\t\tvar isData    = false;\r\n\t\tif (!isURL) { isData = (!options.data || SpiderGL.Type.isTypedArray(options.data)); /* (!options.data || SpiderGL.Type.instanceOf(options.data, ArrayBufferView)) */ }\r\n\t\tvar isElement = false;\r\n\t\tif (!isURL && !isData) {\r\n\t\t\t// [WORKAROUND]\r\n\t\t\t// Firefox does not define ImageData\r\n\t\t\t// /* correct */ isElement = (SpiderGL.Type.instanceOf(data, ImageData) || SpiderGL.Type.instanceOf(data, HTMLImageElement) || SpiderGL.Type.instanceOf(data, HTMLCanvasElement) || SpiderGL.Type.instanceOf(data, HTMLVideoElement));\r\n\t\t\tisElement = (SpiderGL.Type.instanceOf(options.data, HTMLImageElement) || SpiderGL.Type.instanceOf(options.data, HTMLCanvasElement) || SpiderGL.Type.instanceOf(options.data, HTMLVideoElement));\r\n\t\t\tif (!isElement) {\r\n\t\t\t\tif (typeof ImageData != \"undefined\") {\r\n\t\t\t\t\tisElement = SpiderGL.Type.instanceOf(options.data, ImageData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar gl  = this._gl;\r\n\t\tvar cb  = this._cb;\r\n\t\tvar dsa = this._dsa;\r\n\r\n\t\tvar t = target;\r\n\t\tvar h = this._h;\r\n\r\n\t\tvar userFlipY                = -1;\r\n\t\tvar flipY                    = -1;\r\n\t\tvar userPremultiplyAlpha     = -1;\r\n\t\tvar premultiplyAlpha         = -1;\r\n\t\tvar userColorspaceConversion = -1;\r\n\t\tvar colorspaceConversion     = -1;\r\n\r\n\t\tif (isData || isElement) {\r\n\t\t\tuserFlipY = options.flipY;\r\n\t\t\tif (userFlipY != SpiderGL.Core.DONT_CARE) {\r\n\t\t\t\tflipY = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\t\t\t\tif (userFlipY == flipY) { flipY = -1; }\r\n\t\t\t\telse { gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, userFlipY); }\r\n\t\t\t}\r\n\r\n\t\t\tuserPremultiplyAlpha = options.premultiplyAlpha;\r\n\t\t\tif (userPremultiplyAlpha != SpiderGL.Core.DONT_CARE) {\r\n\t\t\t\tpremultiplyAlpha = gl.getParameter(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL);\r\n\t\t\t\tif (userPremultiplyAlpha == premultiplyAlpha) { premultiplyAlpha = -1; }\r\n\t\t\t\telse { gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, userPremultiplyAlpha); }\r\n\t\t\t}\r\n\r\n\t\t\tuserColorspaceConversion = options.colorspaceConversion;\r\n\t\t\tif (userColorspaceConversion != SpiderGL.Core.DONT_CARE) {\r\n\t\t\t\tcolorspaceConversion = gl.getParameter(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL);\r\n\t\t\t\tif (userColorspaceConversion == colorspaceConversion) { colorspaceConversion = -1; }\r\n\t\t\t\telse { gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, userColorspaceConversion); }\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar imageUpdated = false;\r\n\r\n\t\tif (isURL) {\r\n\t\t\tvar opts = {\r\n\t\t\t\tinternalFormat       : options.internalFormat,\r\n\t\t\t\tborder               : options.border,\r\n\t\t\t\txoffset              : options.xoffset,\r\n\t\t\t\tyoffset              : options.yoffset,\r\n\t\t\t\tlevel                : options.level,\r\n\t\t\t\tformat               : options.format,\r\n\t\t\t\ttype                 : options.type,\r\n\t\t\t\tgenerateMipmap       : options.generateMipmap,\r\n\t\t\t\tflipY                : options.flipY,\r\n\t\t\t\tpremultiplyAlpha     : options.premultiplyAlpha,\r\n\t\t\t\tcolorspaceConversion : options.colorspaceConversion,\r\n\t\t\t\tdata                 : null\r\n\t\t\t};\r\n\r\n\t\t\tvar that = this;\r\n\t\t\tvar onSuccess = options.onSuccess;\r\n\r\n\t\t\tvar req = new SpiderGL.IO.ImageRequest(options.url, {\r\n\t\t\t\tonCancel   : options.onCancel,\r\n\t\t\t\tonError    : options.onError,\r\n\t\t\t\tonProgress : options.onProgress,\r\n\t\t\t\tonSuccess  : function () {\r\n\t\t\t\t\topts.data = req.image;\r\n\t\t\t\t\tif (fullImage) {\r\n\t\t\t\t\t\tthat._setImage(target, opts);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthat._setSubImage(target, opts);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (onSuccess) { onSuccess(); }\r\n\t\t\t\t},\r\n\t\t\t\tsend : true\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse if (isData) {\r\n\t\t\tif ((options.width <= 0) || (options.height <= 0)) { return false; }\r\n\t\t\tif (fullImage) {\r\n\t\t\t\tdsa.texImage2D(h, t, options.level, options.internalFormat, options.width, options.height, options.border, options.format, options.type, options.data);\r\n\t\t\t\timageUpdated = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdsa.texSubImage2D(h, t, options.level, options.xoffset, options.yoffset, options.width, options.height, options.format, options.type, options.data);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (isElement) {\r\n\t\t\tif (fullImage) {\r\n\t\t\t\tdsa.texImage2D(h, t, options.level, options.internalFormat, options.format, options.type, options.data);\r\n\t\t\t\timageUpdated = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdsa.texSubImage2D(h, t, options.level, options.xoffset, options.yoffset, options.format, options.type, options.data);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (imageUpdated) {\r\n\t\t\tthis._missingFaces &= ~(SpiderGL.WebGL.Texture._faceBits[t]);\r\n\t\t}\r\n\r\n\t\tif (isData || isElement) {\r\n\t\t\tif (flipY                != -1) { gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,                flipY);                }\r\n\t\t\tif (premultiplyAlpha     != -1) { gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,     premultiplyAlpha);     }\r\n\t\t\tif (colorspaceConversion != -1) { gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, colorspaceConversion); }\r\n\t\t}\r\n\r\n\t\tif (options.generateMipmap) {\r\n\t\t\tthis.generateMipmap();\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_setImage : function (target, options) {\r\n\t\treturn this._setImageData(true, target, options);\r\n\t},\r\n\r\n\t_setSubImage : function (target, options) {\r\n\t\treturn this._setImageData(false, target, options);\r\n\t},\r\n\r\n\t/*\r\n\tget isEmpty () { return ((this._width <= 0) || (this._height <= 0)); },\r\n\t*/\r\n\r\n\t/**\r\n\t * Tests if the texture is ready to use.\r\n\t * A texture is considered ready if all its associated images (one for 2D textures, six for cube maps) have width and height greater than zero.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget isReady() {\r\n\t\treturn ((this._missingFaces == 0) && (this._width > 0) && (this._height > 0));\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the flip Y policy.\r\n\t * It specifies the image data vertical flipping policy when unpacking pixel data in setData or setSubData.\r\n\t * If set to true, the WebGL pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_FLIP_Y will be set to true\r\n\t * If set to false, the WebGL pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_FLIP_Y will be set to false\r\n\t * In either case, the unpack parameter will be restored.\r\n\t * If set to SpiderGL.Core.DONT_CARE, the current WebGLRenderingContext setting will be used (i.e. nothing will be changed).\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @default SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y\r\n\t */\r\n\tget flipYPolicy() {\r\n\t\treturn this._flipY;\r\n\t},\r\n\r\n\tset flipYPolicy(x) {\r\n\t\tthis._flipY = SpiderGL.Utility.getDefaultValue(x, SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the premultiply alpha policy.\r\n\t * It specifies the image data premultiply alpha policy when unpacking pixel data in setData or setSubData.\r\n\t * If set to true, the WebGL pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_PREMULTIPLY_ALPHA will be set to true\r\n\t * If set to false, the WebGL pixel unpack parameter WebGLRenderingContext.prototype.UNPACK_PREMULTIPLY_ALPHA will be set to false\r\n\t * In either case, the unpack parameter will be restored after image data has been set\r\n\t * If set to SpiderGL.Core.DONT_CARE, the current WebGLRenderingContext setting will be used (i.e. nothing will be changed).\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @default SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA\r\n\t */\r\n\tget premultuplyAlphaPolicy() {\r\n\t\treturn this._premultuplyAlpha;\r\n\t},\r\n\r\n\tset premultuplyAlphaPolicy(x) {\r\n\t\tthis._premultuplyAlpha = SpiderGL.Utility.getDefaultValue(x, SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the colorspace conversionpolicy.\r\n\t * It specifies the image data colorpsce conversion policy when unpacking pixel data in setData or setSubData.\r\n\t * If set to SpiderGL.Core.DONT_CARE, the current WebGLRenderingContext setting will be used (i.e. nothing will be changed).\r\n\t * Otherwise, the specified value will be used and then restored after image data has been set.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @default SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION\r\n\t */\r\n\tget colorspaceConversionPolicy() {\r\n\t\treturn this._colorspaceConversion;\r\n\t},\r\n\r\n\tset colorspaceConversionPolicy(x) {\r\n\t\tthis._colorspaceConversion = SpiderGL.Utility.getDefaultValue(x, SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the automatic mipmap generation.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @default SpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP\r\n\t */\r\n\tget autoMipmap() {\r\n\t\treturn this._autoMipmap;\r\n\t},\r\n\r\n\tset autoMipmap(on) {\r\n\t\tthis._autoMipmap = on;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the texture image internal format.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget format() {\r\n\t\treturn this._format;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the texture image width.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget width() {\r\n\t\treturn this._width;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the texture image height.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget height() {\r\n\t\treturn this._height;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the texture magnification filter.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget magFilter() {\r\n\t\treturn this._magFilter;\r\n\t},\r\n\r\n\tset magFilter(f) {\r\n\t\tf = SpiderGL.Utility.getDefaultValue(w, SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER);\r\n\t\tthis._dsa.texParameteri(this._h, this._t, gl.TEXTURE_MAG_FILTER, f);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the texture minification filter.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget minFilter() {\r\n\t\treturn this._minFilter;\r\n\t},\r\n\r\n\tset minFilter (f) {\r\n\t\tf = SpiderGL.Utility.getDefaultValue(w, SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER);\r\n\t\tthis._dsa.texParameteri(this._h, this._t, gl.TEXTURE_MIN_FILTER, f);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the texture horizontal wrap mode.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget wrapS() {\r\n\t\treturn this._wrapS;\r\n\t},\r\n\r\n\tset wrapS(w) {\r\n\t\tw = SpiderGL.Utility.getDefaultValue(w, SpiderGL.WebGL.Texture.DEFAULT_WRAP_S);\r\n\t\tthis._dsa.texParameteri(this._h, this._t, gl.TEXTURE_WRAP_S, w);\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the texture vertical wrap mode.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget wrapT() {\r\n\t\treturn this._wrapT;\r\n\t},\r\n\r\n\tset wrapT(w) {\r\n\t\tw = SpiderGL.Utility.getDefaultValue(w, SpiderGL.WebGL.Texture.DEFAULT_WRAP_T);\r\n\t\tthis._dsa.texParameteri(this._h, this._t, gl.TEXTURE_WRAP_T, w);\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the texture sampling (filtering and addressing) mode.\r\n\t * It is a utility function to specify the addressing and filtering parameters at once.\r\n\t * Only the specified properties will be changed.\r\n\t * To restore the default value, specify the property with value SpiderGL.Core.DEFAULT.\r\n\t *\r\n\t * @param {object} sampler The sampling options.\r\n\t * @param {number} [sampler.magFilter] Texture magnification filter (see {@link SpiderGL.WebGL.Texture#magFilter}).\r\n\t * @param {number} [sampler.minFilter] Texture minnification filter (see {@link SpiderGL.WebGL.Texture#minFilter}).\r\n\t * @param {number} [sampler.wrapS] Texture horizontal wrap mode (see {@link SpiderGL.WebGL.Texture#wrapS}).\r\n\t * @param {number} [sampler.wrapT] Texture vertical wrap mode (see {@link SpiderGL.WebGL.Texture#wrapT}).\r\n\t */\r\n\tsetSampler : function (sampler) {\r\n\t\tif (!sampler) return false;\r\n\r\n\t\tvar gl  = this._gl;\r\n\t\tvar cb  = this._cb;\r\n\t\tvar dsa = this._dsa;\r\n\r\n\t\tvar t = this._t;\r\n\t\tvar h = this._h;\r\n\r\n\t\tcb.pushTexture(t);\r\n\t\tgl.bindTexture(t, h);\r\n\r\n\t\tvar p = 0;\r\n\r\n\t\tif (\"magFilter\" in sampler) {\r\n\t\t\tp = SpiderGL.Utility.getDefaultValue(sampler.magFilter, SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER);\r\n\t\t\tgl.texParameteri(t, gl.TEXTURE_MAG_FILTER, p);\r\n\t\t}\r\n\r\n\t\tif (\"minFilter\" in sampler) {\r\n\t\t\tp = SpiderGL.Utility.getDefaultValue(sampler.minFilter, SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER);\r\n\t\t\tgl.texParameteri(t, gl.TEXTURE_MIN_FILTER, p);\r\n\t\t}\r\n\r\n\t\tif (\"wrapS\" in sampler) {\r\n\t\t\tp = SpiderGL.Utility.getDefaultValue(sampler.wrapS, SpiderGL.WebGL.Texture.DEFAULT_WRAP_S);\r\n\t\t\tgl.texParameteri(t, gl.TEXTURE_WRAP_S, p);\r\n\t\t}\r\n\r\n\t\tif (\"wrapT\" in sampler) {\r\n\t\t\tp = SpiderGL.Utility.getDefaultValue(sampler.wrapT, SpiderGL.WebGL.Texture.DEFAULT_WRAP_T);\r\n\t\t\tgl.texParameteri(t, gl.TEXTURE_WRAP_T, p);\r\n\t\t}\r\n\r\n\t\tcb.popTexture(t);\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the texture sampling (filtering and addressing) mode.\r\n\t *\r\n\t * @returns {object} The sampling options. The returned object will have the following properties: magFilter, minFilter, wrapS, wrapT.\r\n\t */\r\n\tgetSampler : function () {\r\n\t\treturn {\r\n\t\t\tmagFilter : this._magFilter,\r\n\t\t\tminFilter : this._minFilter,\r\n\t\t\twrapS     : this._wrapS,\r\n\t\t\twrapT     : this._wrapT\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generates the mipmap pyramid.\r\n\t */\r\n\tgenerateMipmap : function () {\r\n\t\tif (this._missingFaces != 0) return;\r\n\t\tthis._dsa.generateMipmap(this._h, this._t);\r\n\t},\r\n\r\n\t/**\r\n\t * Destroys the WebGLTexture.\r\n\t * After destruction, the handle is set to null and this object should not be used anymore.\r\n\t *\r\n\t * @see SpiderGL.WebGL.ObjectGL#destroy\r\n\t */\r\n\tdestroy : function () {\r\n\t\tthis._gl.deleteTexture(this._h);\r\n\t},\r\n\r\n\t/**\r\n\t * Binds the texture to the appropriate target for SpiderGL.WebGL.Texture2D and SpiderGL.WebGL.TextureCubeMap.\r\n\t *\r\n\t * @param {number} unit The unit (zero-based index) to which bind the texture. If not specified, the current texture unit is used.\r\n\t *\r\n\t * @see unbind\r\n\t */\r\n\tbind : function (unit) {\r\n\t\tvar gl  = this._gl;\r\n\t\tvar cb  = this._cb;\r\n\t\tvar dsa = this._dsa;\r\n\t\tif (typeof unit == \"undefined\") {\r\n\t\t\tgl.bindTexture(this._t, this._h);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdsa.bindTexture(gl.TEXTURE0 + unit, this._t, this._h);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Binds \"null\" to the appropriate texture target for SpiderGL.WebGL.Texture2D and SpiderGL.WebGL.TextureCubeMap.\r\n\t * This method is provided only for simmetry with {@link bind} and is not relative to the object state.\r\n\t *\r\n\t * @param {number} unit The unit (zero-based index) to which bind the null texture. If not specified, the current texture unit is used.\r\n\t *\r\n\t * @see bind\r\n\t */\r\n\tunbind : function (unit) {\r\n\t\tvar gl  = this._gl;\r\n\t\tvar cb  = this._cb;\r\n\t\tvar dsa = this._dsa;\r\n\t\tif (typeof unit == \"undefined\") {\r\n\t\t\tgl.bindTexture(this._t, null);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdsa.bindTexture(gl.TEXTURE0 + unit, this._t, null);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.Texture, SpiderGL.WebGL.ObjectGL);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.Texture2D.\r\n *\r\n * SpiderGL.WebGL.Texture2D is a wrapper for 2D WebGLTexture objects.\r\n *\r\n * @class The SpiderGL.WebGL.Texture2D is a wrapper for 2D WebGLTexture objects\r\n *\r\n * @augments SpiderGL.WebGL.Texture\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] Optional parameters (see SpiderGL.WebGL.Texture constructor).\r\n *\r\n * @see SpiderGL.WebGL.Texture\r\n * @see SpiderGL.WebGL.TextureCubeMap\r\n * @see SpiderGL.WebGL.Framebuffer\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.Texture2D = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\tSpiderGL.WebGL.Texture.call(this, gl, SpiderGL.WebGL.Texture2D.TARGET, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n\r\n\toptions = options || { };\r\n\tif (SpiderGL.Type.instanceOf(options, WebGLTexture)) {\r\n\t\toptions = { handle : options };\r\n\t}\r\n\telse if (SpiderGL.Type.isString(options)) {\r\n\t\toptions = { url : options };\r\n\t}\r\n\r\n\tif ((\"url\" in options) || (\"data\" in options) || ((\"width\" in options) && (\"height\" in options))) { this.setImage(options); }\r\n}\r\n\r\nSpiderGL.WebGL.Texture2D.TARGET = WebGLRenderingContext.prototype.TEXTURE_2D;\r\n\r\nSpiderGL.WebGL.Texture2D.unbind = function (gl, unit) {\r\n\tvar cb  = gl.getExtension(\"SGL_current_binding\");\r\n\tvar dsa = gl.getExtension(\"SGL_direct_state_access\");\r\n\tif (typeof unit == \"undefined\") {\r\n\t\tgl.bindTexture(SpiderGL.WebGL.Texture2D.TARGET, null);\r\n\t}\r\n\telse {\r\n\t\tdsa.bindTexture(gl.TEXTURE0 + unit, SpiderGL.WebGL.Texture2D.TARGET, null);\r\n\t}\r\n};\r\n\r\nSpiderGL.WebGL.Texture2D.prototype = {\r\n\t/**\r\n\t * Sets the texture image.\r\n\t *\r\n\t * @param {object} options The image data and type parameters (see SpiderGL.WebGL.Texture constructor).\r\n\t * @param {ArrayBuffer|ArrayBufferView|ImageData|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} [options.data] The texture image pixel data.\r\n\t * @param {number} [options.internalFormat=SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT] The texture internal format.\r\n\t * @param {number} [options.level=SpiderGL.WebGL.Texture.DEFAULT_LEVEL] The texture image mip level.\r\n\t * @param {number} [options.width] If data is null or a typed array, specifies the texture image width. If handle is provided, the width parameter will supply the width information, not querable to the WebGLRenderingContext.prototype.\r\n\t * @param {number} [options.height] If data is null or a typed array, specifies the texture image height. If handle is provided, the width parameter will supply the height information, not querable to the WebGLRenderingContext.prototype.\r\n\t * @param {number} [options.border=SpiderGL.WebGL.Texture.DEFAULT_BORDER] Texture border.\r\n\t * @param {number} [options.format=SpiderGL.WebGL.Texture.DEFAULT_FORMAT] The format parameter used for WebGLRenderingContext.prototype.texImage2D.\r\n\t * @param {number} [options.type=SpiderGL.WebGL.Texture.DEFAULT_TYPE] The type parameter used for WebGLRenderingContext.prototype.texImage2D.\r\n\t * @param {bool} [options.generateMipmap] If specified, overrides autoMipmap.\r\n\t * @param {bool} [options.flipY] If specified, overrides flipYPolicy.\r\n\t * @param {bool} [options.premultiplyAlpha] If specified, overrides premultiplyAlphaPolicy.\r\n\t * @param {number} [options.colorspaceConversion] If specified, overrides colorspaceConversionPolicy.\r\n\t * @param {function} [options.onCancel] If url is specified, this function will be called if image data loading is cancelled.\r\n\t * @param {function} [options.onError] If url is specified, this function will be called if an error occurs when loading image data.\r\n\t * @param {function} [options.onProgress] If url is specified, this function will be called during the image loading progress.\r\n\t * @param {function} [options.onSuccess] If url is specified, this function will be called when image data has been successfully loaded.\r\n\t *\r\n\t * @see setSubImage\r\n\t * @see SpiderGL.WebGL.Texture\r\n\t */\r\n\tsetImage : function (options) {\r\n\t\treturn this._setImage(this._t, options);\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a region of the texture image.\r\n\t *\r\n\t * @param {object} options The image data and type parameters (see SpiderGL.WebGL.Texture constructor).\r\n\t * @param {ArrayBuffer|ArrayBufferView|ImageData|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} [options.data] The texture sub-image pixel data.\r\n\t * @param {number} [options.xoffset=SpiderGL.WebGL.Texture.DEFAULT_X_OFFSET] The sub-image x offset.\r\n\t * @param {number} [options.yoffset=SpiderGL.WebGL.Texture.DEFAULT_Y_OFFSET] The sub-image y offset.\r\n\t * @param {number} [options.width] If data is null or a typed array, specifies the texture image width. If handle is provided, the width parameter will supply the width information, not querable to the WebGLRenderingContext.prototype.\r\n\t * @param {number} [options.height] If data is null or a typed array, specifies the texture image height. If handle is provided, the width parameter will supply the height information, not querable to the WebGLRenderingContext.prototype.\r\n\t * @param {number} [options.border=SpiderGL.WebGL.Texture.DEFAULT_BORDER] Texture border.\r\n\t * @param {number} [options.format=SpiderGL.WebGL.Texture.DEFAULT_FORMAT] The format parameter used for WebGLRenderingContext.prototype.texSubImage2D.\r\n\t * @param {number} [options.type=SpiderGL.WebGL.Texture.DEFAULT_TYPE] The type parameter used for WebGLRenderingContext.prototype.texSubImage2D.\r\n\t * @param {bool} [options.generateMipmap] If specified, overrides autoMipmap.\r\n\t * @param {bool} [options.flipY] If specified, overrides flipYPolicy.\r\n\t * @param {bool} [options.premultiplyAlpha] If specified, overrides premultiplyAlphaPolicy.\r\n\t * @param {number} [options.colorspaceConversion] If specified, overrides colorspaceConversionPolicy.\r\n\t * @param {function} [options.onCancel] If url is specified, this function will be called if image data loading is cancelled.\r\n\t * @param {function} [options.onError] If url is specified, this function will be called if an error occurs when loading image data.\r\n\t * @param {function} [options.onProgress] If url is specified, this function will be called during the image loading progress.\r\n\t * @param {function} [options.onSuccess] If url is specified, this function will be called when image data has been successfully loaded.\r\n\t *\r\n\t * @see setImage\r\n\t * @see SpiderGL.WebGL.Texture\r\n\t */\r\n\tsetSubImage : function (options) {\r\n\t\treturn this._setSubImage(this._t, options);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.Texture2D, SpiderGL.WebGL.Texture);\r\n\r\n/**\r\n * Creates a SpiderGL.WebGL.TextureCubeMap.\r\n *\r\n * SpiderGL.WebGL.TextureCubeMap is a wrapper for cube map WebGLTexture objects.\r\n *\r\n * @class The SpiderGL.WebGL.TextureCubeMap is a wrapper for cube map WebGLTexture objects\r\n *\r\n * @augments SpiderGL.WebGL.Texture\r\n *\r\n * @param {WebGLRenderingContext} gl A WebGLRenderingContext hijacked with {@link SpiderGL.WebGL.Context.hijack}.\r\n * @param {object} [options] Optional parameters (see SpiderGL.WebGL.Texture constructor). This constructor accepts only the url options as an array of six strings, or internalFormat, width, height, format and type, ignoring the data property.\r\n *\r\n * @see SpiderGL.WebGL.Texture\r\n * @see SpiderGL.WebGL.Texture2D\r\n * @see SpiderGL.WebGL.Framebuffer\r\n * @see SpiderGL.WebGL.ObjectGL\r\n */\r\nSpiderGL.WebGL.TextureCubeMap = function (gl, options) {\r\n\tif (!SpiderGL.WebGL.Context.isHijacked(gl)) { return null; }\r\n\tSpiderGL.WebGL.Texture.call(this, gl, SpiderGL.WebGL.TextureCubeMap.TARGET, options);\r\n\tif (!!this._h && !!this._h._spidergl && (this._h._spidergl != this)) return this._h._spidergl;\r\n\r\n\toptions = options || { };\r\n\tif (SpiderGL.Type.instanceOf(options, WebGLTexture)) {\r\n\t\toptions = { handle : options };\r\n\t}\r\n\telse if (SpiderGL.Type.isString(options)) {\r\n\t\toptions = { url : options };\r\n\t}\r\n\r\n\tvar faceTargets = SpiderGL.WebGL.TextureCubeMap._faceTargets;\r\n\r\n\tif (options.url) {\r\n\t\tvar urls = options.url;\r\n\t\tvar onSuccess = options.onSuccess;\r\n\t\tif (onSuccess) {\r\n\t\t\toptions.onSuccess = (function(){\r\n\t\t\t\tvar imagesLeft = 6;\r\n\t\t\t\treturn function () {\r\n\t\t\t\t\t--imagesLeft;\r\n\t\t\t\t\tif (imagesLeft == 0) onSuccess.apply(options, null);\r\n\t\t\t\t}\r\n\t\t\t})();\r\n\t\t}\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\toptions.url = urls[i];\r\n\t\t\tthis.setImage(faceTargets[i], options);\r\n\t\t}\r\n\t\toptions.onSuccess = onSuccess;\r\n\t}\r\n\telse if (options.data) {\r\n\t\tvar datas = options.data;\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\toptions.data = datas[i];\r\n\t\t\tthis.setImage(faceTargets[i], options);\r\n\t\t}\r\n\t}\r\n\telse if ((options.width > 0) && (options.height > 0)) {\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\tthis.setImage(faceTargets[i], options);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nSpiderGL.WebGL.TextureCubeMap.TARGET = WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP;\r\n\r\nSpiderGL.WebGL.TextureCubeMap.unbind = function (gl, unit) {\r\n\tvar cb  = gl.getExtension(\"SGL_current_binding\");\r\n\tvar dsa = gl.getExtension(\"SGL_direct_state_access\");\r\n\tif (typeof unit == \"undefined\") {\r\n\t\tgl.bindTexture(SpiderGL.WebGL.TextureCubeMap.TARGET, null);\r\n\t}\r\n\telse {\r\n\t\tdsa.bindTexture(gl.TEXTURE0 + unit, SpiderGL.WebGL.TextureCubeMap.TARGET, null);\r\n\t}\r\n};\r\n\r\nSpiderGL.WebGL.TextureCubeMap._faceTargets = [\r\n\tWebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X,\r\n\tWebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_X,\r\n\tWebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Y,\r\n\tWebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Y,\r\n\tWebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Z,\r\n\tWebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Z\r\n];\r\n\r\nSpiderGL.WebGL.TextureCubeMap.prototype = {\r\n\t/**\r\n\t * Sets the texture image for a cube face.\r\n\t *\r\n\t * @param {number} face The cube map face to set.\r\n\t * @param {object} options The image data and type parameters (see SpiderGL.WebGL.Texture constructor).\r\n\t * @param {ArrayBuffer|ArrayBufferView|ImageData|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} [options.data] The texture image pixel data.\r\n\t * @param {number} [options.internalFormat=SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT] The texture internal format.\r\n\t * @param {number} [options.width] If data is null or a typed array, specifies the texture image width. If handle is provided, the width parameter will supply the width information, not querable to the WebGLRenderingContext.prototype.\r\n\t * @param {number} [options.height] If data is null or a typed array, specifies the texture image height. If handle is provided, the width parameter will supply the height information, not querable to the WebGLRenderingContext.prototype.\r\n\t * @param {number} [options.border=SpiderGL.WebGL.Texture.DEFAULT_BORDER] Texture border.\r\n\t * @param {number} [options.format=SpiderGL.WebGL.Texture.DEFAULT_FORMAT] The format parameter used for WebGLRenderingContext.prototype.texImage2D.\r\n\t * @param {number} [options.type=SpiderGL.WebGL.Texture.DEFAULT_TYPE] The type parameter used for WebGLRenderingContext.prototype.texImage2D.\r\n\t * @param {bool} [options.generateMipmap] If specified, overrides autoMipmap.\r\n\t * @param {bool} [options.flipY] If specified, overrides flipYPolicy.\r\n\t * @param {bool} [options.premultiplyAlpha] If specified, overrides premultiplyAlphaPolicy.\r\n\t * @param {number} [options.colorspaceConversion] If specified, overrides colorspaceConversionPolicy.\r\n\t * @param {function} [options.onCancel] If url is specified, this function will be called if image data loading is cancelled.\r\n\t * @param {function} [options.onError] If url is specified, this function will be called if an error occurs when loading image data.\r\n\t * @param {function} [options.onProgress] If url is specified, this function will be called during the image loading progress.\r\n\t * @param {function} [options.onSuccess] If url is specified, this function will be called when image data has been successfully loaded.\r\n\t *\r\n\t * @see setSubImage\r\n\t * @see SpiderGL.WebGL.Texture\r\n\t */\r\n\tsetImage : function (face, options) {\r\n\t\t/*\r\n\t\tvar b = SpiderGL.WebGL.TextureCubeMap._faceBits[face];\r\n\t\tif (!b) return false;\r\n\t\tvar r = this._setImage(face, options);\r\n\t\tif (r) { this._missingFaces &= ~b; }\r\n\t\treturn r;\r\n\t\t*/\r\n\t\treturn this._setImage(face, options);\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a region of the texture image for a cube face.\r\n\t *\r\n\t * @param {number} face The cube map face to set.\r\n\t * @param {object} options The image data and type parameters (see SpiderGL.WebGL.Texture constructor).\r\n\t * @param {ArrayBuffer|ArrayBufferView|ImageData|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} [options.data] The texture sub-image pixel data.\r\n\t * @param {number} [options.xoffset=SpiderGL.WebGL.Texture.DEFAULT_X_OFFSET] The sub-image x offset.\r\n\t * @param {number} [options.yoffset=SpiderGL.WebGL.Texture.DEFAULT_Y_OFFSET] The sub-image y offset.\r\n\t * @param {number} [options.width] If data is null or a typed array, specifies the texture image width. If handle is provided, the width parameter will supply the width information, not querable to the WebGLRenderingContext.prototype.\r\n\t * @param {number} [options.height] If data is null or a typed array, specifies the texture image height. If handle is provided, the width parameter will supply the height information, not querable to the WebGLRenderingContext.prototype.\r\n\t * @param {number} [options.border=SpiderGL.WebGL.Texture.DEFAULT_BORDER] Texture border.\r\n\t * @param {number} [options.format=SpiderGL.WebGL.Texture.DEFAULT_FORMAT] The format parameter used for WebGLRenderingContext.prototype.texSubImage2D.\r\n\t * @param {number} [options.type=SpiderGL.WebGL.Texture.DEFAULT_TYPE] The type parameter used for WebGLRenderingContext.prototype.texSubImage2D.\r\n\t * @param {bool} [options.generateMipmap] If specified, overrides autoMipmap.\r\n\t * @param {bool} [options.flipY] If specified, overrides flipYPolicy.\r\n\t * @param {bool} [options.premultiplyAlpha] If specified, overrides premultiplyAlphaPolicy.\r\n\t * @param {number} [options.colorspaceConversion] If specified, overrides colorspaceConversionPolicy.\r\n\t * @param {function} [options.onCancel] If url is specified, this function will be called if image data loading is cancelled.\r\n\t * @param {function} [options.onError] If url is specified, this function will be called if an error occurs when loading image data.\r\n\t * @param {function} [options.onProgress] If url is specified, this function will be called during the image loading progress.\r\n\t * @param {function} [options.onSuccess] If url is specified, this function will be called when image data has been successfully loaded.\r\n\t *\r\n\t * @see setImage\r\n\t * @see SpiderGL.WebGL.Texture\r\n\t */\r\n\tsetSubImage : function (face, options) {\r\n\t\treturn this._setSubImage(face, options);\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.WebGL.TextureCubeMap, SpiderGL.WebGL.Texture);\r\n\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview Model\r\n */\r\n\r\n/**\r\n * The SpiderGL.Model namespace.\r\n *\r\n * @namespace The SpiderGL.Model namespace.\r\n */\r\nSpiderGL.Model = { };\r\n\r\n/**\r\n * Creates a SpiderGL.Model.Model.\r\n *\r\n * A SpiderGL.Model.Model is a layered data structure that represents a geometric model.\r\n * Through the model descriptor, it provides the elements needed to form a 3D model, e.g. raw data, semantic bindings, logical sub-structures, and higher level information.\r\n * Bottom to top, each layer in the stack relies at most on the previous one. While layer flexibility decreases bottom to top, their expressiveness increases.\r\n *\r\n * @class The SpiderGL.Model.Model represents a complex geometric model.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n */\r\nSpiderGL.Model.Model = function (gl, descriptor, options) {\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t}, options);\r\n\r\n\tif (descriptor && (\"vertices\" in descriptor)) {\r\n\t\tdescriptor = SpiderGL.Model.Model._createSimpleDescriptor(descriptor);\r\n\t}\r\n\r\n\tthis._descriptor = SpiderGL.Model.Model._fixDescriptor(descriptor);\r\n\tthis._gl = null;\r\n\tthis._renderData = { };\r\n\r\n\tif (gl) {\r\n\t\tthis.updateGL(gl, options);\r\n\t\tthis.updateRenderData();\r\n\t}\r\n};\r\n\r\nSpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_SIZE       = 3;\r\nSpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE       = SpiderGL.Type.FLOAT32;\r\nSpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_NORMALIZED = false;\r\nSpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_STRIDE     = 0;\r\nSpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_OFFSET     = 0;\r\n\r\nSpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_MODE    = SpiderGL.Type.TRIANGLES;\r\nSpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_FIRST   = 0;\r\nSpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_COUNT   = -1;\r\nSpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE    = SpiderGL.Type.UINT16;\r\nSpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_OFFSET  = 0;\r\n\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP = { };\r\n\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[\"position\"] = {\r\n\tsize       : 3,\r\n\ttype       : SpiderGL.Type.FLOAT32,\r\n\tnormalized : false,\r\n\tsemantic   : \"POSITION\",\r\n\tindex      : 0,\r\n\tvalue      : [0.0, 0.0, 0.0, 1.0]\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[\"normal\"] = {\r\n\tsize       : 3,\r\n\ttype       : SpiderGL.Type.FLOAT32,\r\n\tnormalized : false,\r\n\tsemantic   : \"NORMAL\",\r\n\tindex      : 0,\r\n\tvalue      : [0.0, 0.0, 1.0, 0.0]\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[\"color\"] = {\r\n\tsize       : 4,\r\n\ttype       : SpiderGL.Type.UINT8,\r\n\tnormalized : true,\r\n\tsemantic   : \"COLOR\",\r\n\tindex      : 0,\r\n\tvalue      : [0, 0, 0, 255]\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[\"texcoord\"] = {\r\n\tsize       : 2,\r\n\ttype       : SpiderGL.Type.FLOAT32,\r\n\tnormalized : false,\r\n\tsemantic   : \"TEXCOORD\",\r\n\tindex      : 0,\r\n\tvalue      : [0.0, 0.0, 0.0, 1.0]\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[\"user\"] = {\r\n\tsize       : 3,\r\n\ttype       : SpiderGL.Type.FLOAT32,\r\n\tnormalized : false,\r\n\tsemantic   : \"USER\",\r\n\tindex      : 0,\r\n\tvalue      : [0.0, 0.0, 0.0, 1.0]\r\n};\r\n\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP = { };\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"triangles\"] = {\r\n\tmode       : SpiderGL.Type.TRIANGLES,\r\n\ttype       : SpiderGL.Type.UINT16,\r\n\tcount      : -1,\r\n\tsemantic   : \"FILL\"\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"triangleStrip\"] = {\r\n\tmode       : SpiderGL.Type.TRIANGLE_STRIP,\r\n\ttype       : SpiderGL.Type.UINT16,\r\n\tcount      : -1,\r\n\tsemantic   : \"FILL\"\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"triangleFan\"] = {\r\n\tmode       : SpiderGL.Type.TRIANGLE_FAN,\r\n\ttype       : SpiderGL.Type.UINT16,\r\n\tcount      : -1,\r\n\tsemantic   : \"FILL\"\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"lines\"] = {\r\n\tmode       : SpiderGL.Type.LINES,\r\n\ttype       : SpiderGL.Type.UINT16,\r\n\tcount      : -1,\r\n\tsemantic   : \"LINE\"\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"lineStrip\"] = {\r\n\tmode       : SpiderGL.Type.LINE_STRIP,\r\n\ttype       : SpiderGL.Type.UINT16,\r\n\tcount      : -1,\r\n\tsemantic   : \"LINE\"\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"lineLoop\"] = {\r\n\tmode       : SpiderGL.Type.LINE_LOOP,\r\n\ttype       : SpiderGL.Type.UINT16,\r\n\tcount      : -1,\r\n\tsemantic   : \"LINE\"\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"points\"] = {\r\n\tmode       : SpiderGL.Type.POINTS,\r\n\ttype       : SpiderGL.Type.UINT16,\r\n\tcount      : -1,\r\n\tsemantic   : \"POINT\"\r\n};\r\nSpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"user\"] = {\r\n\tmode       : SpiderGL.Type.TRIANGLES,\r\n\ttype       : SpiderGL.Type.UINT16,\r\n\tcount      : -1,\r\n\tsemantic   : \"FILL\"\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptor = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tversion  : \"0.0.0.1 EXP\",\r\n\t\tmeta     : null,\r\n\t\tdata     : null,\r\n\t\taccess   : null,\r\n\t\tsemantic : null,\r\n\t\tlogic    : null\r\n\t}, d);\r\n\r\n\td.meta     = SpiderGL.Model.Model._fixDescriptorMeta     (d.meta);\r\n\td.data     = SpiderGL.Model.Model._fixDescriptorData     (d.data);\r\n\td.access   = SpiderGL.Model.Model._fixDescriptorAccess   (d.access);\r\n\td.semantic = SpiderGL.Model.Model._fixDescriptorSemantic (d.semantic);\r\n\td.logic    = SpiderGL.Model.Model._fixDescriptorLogic    (d.logic);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorMeta = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tauthor      : null,\r\n\t\tdate        : null,\r\n\t\tdescription : null\r\n\t}, d);\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorData = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tvertexBuffers : null,\r\n\t\tindexBuffers  : null\r\n\t}, d);\r\n\r\n\td.vertexBuffers = SpiderGL.Model.Model._fixDescriptorDataVertexBuffers (d.vertexBuffers);\r\n\td.indexBuffers  = SpiderGL.Model.Model._fixDescriptorDataIndexBuffers  (d.indexBuffers);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorDataVertexBuffers = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorDataVertexBuffer(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorDataVertexBuffer = function (d) {\r\n\treturn SpiderGL.Model.Model._fixDescriptorDataBuffer(d);\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorDataIndexBuffers = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorDataIndexBuffer(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorDataIndexBuffer = function (d) {\r\n\treturn SpiderGL.Model.Model._fixDescriptorDataBuffer(d);\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorDataBuffer = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\ttype         : SpiderGL.Type.NO_TYPE,\r\n\t\tglType       : WebGLRenderingContext.prototype.NONE,\r\n\t\tuntypedArray : null,\r\n\t\ttypedArray   : null,\r\n\t\tglBuffer     : null\r\n\t}, d);\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorAccess = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tvertexStreams    : null,\r\n\t\tprimitiveStreams : null\r\n\t}, d);\r\n\r\n\td.vertexStreams     = SpiderGL.Model.Model._fixDescriptorAccessVertexStreams    (d.vertexStreams);\r\n\td.primitiveStreams  = SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStreams (d.primitiveStreams);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorAccessVertexStreams = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorAccessVertexStream(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorAccessVertexStream = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tbuffer     : null,\r\n\t\tsize       : SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_SIZE,\r\n\t\ttype       : SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE,\r\n\t\tglType     : SpiderGL.Type.typeToGL(SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE),\r\n\t\tnormalized : SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_NORMALIZED,\r\n\t\tstride     : SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_STRIDE,\r\n\t\toffset     : SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_OFFSET\r\n\t}, d);\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorAccessPrimitiveStreams = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStream(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorAccessPrimitiveStream = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tbuffer     : null,\r\n\t\tmode       : SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_MODE,\r\n\t\tfirst      : SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_FIRST,\r\n\t\tcount      : SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_COUNT,\r\n\t\ttype       : SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE,\r\n\t\tglType     : SpiderGL.Type.typeToGL(SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE),\r\n\t\toffset     : SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_OFFSET\r\n\t}, d);\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemantic = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tbindings : null,\r\n\t\tchunks   : null\r\n\t}, d);\r\n\r\n\td.bindings = SpiderGL.Model.Model._fixDescriptorSemanticBindings (d.bindings);\r\n\td.chunks   = SpiderGL.Model.Model._fixDescriptorSemanticChunks   (d.chunks);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticBindings = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorSemanticBinding(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticBinding = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tvertexStreams    : null,\r\n\t\tprimitiveStreams : null\r\n\t}, d);\r\n\r\n\td.vertexStreams    = SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStreams    (d.vertexStreams);\r\n\td.primitiveStreams = SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStreams (d.primitiveStreams);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStreams = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStream(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStream = function (d) {\r\n\tif (!d) return null;\r\n\tif (SpiderGL.Type.isArray(d)) return d.slice();\r\n\treturn [ d ];\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStreams = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStream(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStream = function (d) {\r\n\tif (!d) return null;\r\n\tif (SpiderGL.Type.isArray(d)) return d.slice();\r\n\treturn [ d ];\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticChunks = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorSemanticChunk(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticChunk = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\ttechniques : null\r\n\t}, d);\r\n\r\n\td.techniques = SpiderGL.Model.Model._fixDescriptorSemanticChunkTechniques(d.techniques);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticChunkTechniques = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorSemanticChunkTechnique(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorSemanticChunkTechnique = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tbinding : null\r\n\t}, d);\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorLogic = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tparts : null\r\n\t}, d);\r\n\r\n\td.parts = SpiderGL.Model.Model._fixDescriptorLogicParts(d.parts);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorLogicParts = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({ }, d);\r\n\tfor (var x in d) {\r\n\t\td[x] = SpiderGL.Model.Model._fixDescriptorLogicPart(d[x]);\r\n\t}\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorLogicPart = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tchunks : null\r\n\t}, d);\r\n\r\n\td.chunks = SpiderGL.Model.Model._fixDescriptorLogicPartChunks(d.chunks);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model._fixDescriptorLogicPartChunks = function (d) {\r\n\tif (!d) return null;\r\n\tif (SpiderGL.Type.isArray(d)) return d.slice();\r\n\treturn [ d ];\r\n};\r\n\r\nSpiderGL.Model.Model._createSimpleDescriptor = function (options) {\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\tvertices   : null,\r\n\t\tprimitives : null,\r\n\t\toptions    : null\r\n\t}, options);\r\n\r\n\tvar bindingName        = \"mainBinding\";\r\n\tvar chunkName          = \"mainChunk\";\r\n\tvar partName           = \"mainPart\";\r\n\tvar vertexBufferSuffix = \"VertexBuffer\";\r\n\tvar indexBufferSuffix  = \"IndexBuffer\";\r\n\r\n\tvar d = {\r\n\t\tdata : {\r\n\t\t\tvertexBuffers : {\r\n\t\t\t},\r\n\t\t\tindexBuffers : {\r\n\t\t\t},\r\n\t\t},\r\n\t\taccess : {\r\n\t\t\tvertexStreams : {\r\n\t\t\t},\r\n\t\t\tprimitiveStreams : {\r\n\t\t\t}\r\n\t\t},\r\n\t\tsemantic : {\r\n\t\t\tbindings : {\r\n\t\t\t},\r\n\t\t\tchunks : {\r\n\t\t\t}\r\n\t\t},\r\n\t\tlogic : {\r\n\t\t\tparts : {\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar binding = {\r\n\t\tvertexStreams : {\r\n\t\t},\r\n\t\tprimitiveStreams : {\r\n\t\t}\r\n\t};\r\n\td.semantic.bindings[bindingName] = binding;\r\n\r\n\tvar chunk = {\r\n\t\ttechniques : {\r\n\t\t\t\"common\" : {\r\n\t\t\t\tbinding : bindingName\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\td.semantic.chunks[chunkName] = chunk;\r\n\r\n\tvar part = {\r\n\t\tchunks : [ chunkName ]\r\n\t};\r\n\td.logic.parts[partName] = part;\r\n\r\n\tvar minBufferedCount = -1;\r\n\tvar hasBuffered = false;\r\n\tvar hasConstant = false;\r\n\r\n\tfor (var x in options.vertices) {\r\n\t\tvar src = options.vertices[x];\r\n\t\tif (!src) continue;\r\n\r\n\t\tif (SpiderGL.Type.isArray(src) || SpiderGL.Type.isTypedArray(src) || SpiderGL.Type.instanceOf(src, ArrayBuffer)) {\r\n\t\t\tsrc = { data : src };\r\n\t\t}\r\n\r\n\t\tvar map = SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[x];\r\n\t\tvar mapSemantic = null;\r\n\t\tif (!map) {\r\n\t\t\tmap = SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[\"user\"];\r\n\t\t\tmapSemantic = x.toUpperCase();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmapSemantic = map.semantic;\r\n\t\t}\r\n\r\n\t\tvar info = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tsize       : map.size,\r\n\t\t\ttype       : map.type,\r\n\t\t\tnormalized : map.normalized,\r\n\t\t\tsemantic   : mapSemantic,\r\n\t\t\tindex      : map.index,\r\n\t\t\tdata       : null,\r\n\t\t\tvalue      : map.value.slice()\r\n\t\t}, src);\r\n\r\n\t\tvar accessor = {\r\n\t\t\tbuffer     : null,\r\n\t\t\tsize       : info.size,\r\n\t\t\ttype       : info.type,\r\n\t\t\tnormalized : info.normalized,\r\n\t\t\tstride     : 0,\r\n\t\t\toffset     : 0,\r\n\t\t\tvalue      : info.value.slice(),\r\n\t\t};\r\n\r\n\t\tif (info.data) {\r\n\t\t\tvar buffer = {\r\n\t\t\t\ttype : info.type\r\n\t\t\t};\r\n\t\t\tvar count = 0;\r\n\t\t\tif (SpiderGL.Type.isArray(info.data)) {\r\n\t\t\t\tbuffer.untypedArray = info.data;\r\n\t\t\t\tcount = buffer.untypedArray.length / accessor.size;\r\n\t\t\t}\r\n\t\t\telse if (SpiderGL.Type.isTypedArray(src) || SpiderGL.Type.instanceOf(src, ArrayBuffer)) {\r\n\t\t\t\tbuffer.typedArray = info.data;\r\n\t\t\t\tcount = (buffer.typedArray.byteLength - accessor.offset) / (accessor.size * SpiderGL.Type.typeSize(accessor.type));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcount = SpiderGL.Math.floor(count);\r\n\t\t\thasBuffered = true;\r\n\t\t\tminBufferedCount = (minBufferedCount >= 0) ? (SpiderGL.Math.min(minBufferedCount, count)) : (count);\r\n\t\t\tvar bufferName = x + vertexBufferSuffix;\r\n\t\t\td.data.vertexBuffers[bufferName] = buffer;\r\n\t\t\taccessor.buffer = bufferName;\r\n\t\t}\r\n\t\telse {\r\n\t\t\thasConstant = true;\r\n\t\t}\r\n\r\n\t\tvar streamName = x;\r\n\t\td.access.vertexStreams[streamName] = accessor;\r\n\r\n\t\tvar streams = new Array(info.index + 1);\r\n\t\tstreams[info.index] = streamName;\r\n\t\tbinding.vertexStreams[info.semantic] = streams;\r\n\t}\r\n\r\n\tvar minCount = 0;\r\n\tif (hasBuffered) {\r\n\t\tminCount = minBufferedCount;\r\n\t}\r\n\telse if (hasConstant) {\r\n\t\tminCount = 1;\r\n\t}\r\n\r\n\tvar optionsPrimitives = options.primitives;\r\n\tif (SpiderGL.Type.isString(optionsPrimitives)) {\r\n\t\toptionsPrimitives = [ optionsPrimitives ];\r\n\t}\r\n\tif (SpiderGL.Type.isArray(optionsPrimitives)) {\r\n\t\tvar op = optionsPrimitives;\r\n\t\toptionsPrimitives = { };\r\n\t\tfor (var i=0, n=op.length; i<n; ++i) {\r\n\t\t\tvar pn = op[i];\r\n\t\t\tif (!SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[pn]) continue;\r\n\t\t\toptionsPrimitives[pn] = { };\r\n\t\t}\r\n\t}\r\n\r\n\tfor (var x in optionsPrimitives) {\r\n\t\tvar src = optionsPrimitives[x];\r\n\t\tif (!src) continue;\r\n\r\n\t\tif (SpiderGL.Type.isArray(src) || SpiderGL.Type.isTypedArray(src) || SpiderGL.Type.instanceOf(src, ArrayBuffer)) {\r\n\t\t\tsrc = { data : src };\r\n\t\t}\r\n\r\n\t\tvar map = SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[x];\r\n\t\tif (!map) map = SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[\"user\"];\r\n\r\n\t\tvar info = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tmode     : map.mode,\r\n\t\t\ttype     : map.type,\r\n\t\t\tcount    : ((map.count >= 0) ? (map.count) : (minCount)),\r\n\t\t\tsemantic : map.semantic\r\n\t\t}, src);\r\n\r\n\t\tvar accessor = {\r\n\t\t\tbuffer     : null,\r\n\t\t\tmode       : info.mode,\r\n\t\t\tfirst      : 0,\r\n\t\t\tcount      : info.count,\r\n\t\t\ttype       : info.type,\r\n\t\t\toffset     : 0\r\n\t\t};\r\n\r\n\t\tif (info.data) {\r\n\t\t\tvar buffer = {\r\n\t\t\t\ttype : info.type\r\n\t\t\t};\r\n\t\t\tvar count = 0\r\n\t\t\tif (SpiderGL.Type.isArray(info.data)) {\r\n\t\t\t\tbuffer.untypedArray = info.data;\r\n\t\t\t\tcount = buffer.untypedArray.length;\r\n\t\t\t}\r\n\t\t\telse if (SpiderGL.Type.isTypedArray(src) || SpiderGL.Type.instanceOf(src, ArrayBuffer)) {\r\n\t\t\t\tbuffer.typedArray = info.data;\r\n\t\t\t\tcount = (buffer.typedArray.byteLength - accessor.offset) / (SpiderGL.Type.typeSize(accessor.type));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcount = SpiderGL.Math.floor(count);\r\n\t\t\tvar bufferName = x + indexBufferSuffix;\r\n\t\t\td.data.indexBuffers[bufferName] = buffer;\r\n\t\t\taccessor.buffer = bufferName;\r\n\t\t\taccessor.count  = count;\r\n\t\t}\r\n\r\n\t\tvar streamName = x;\r\n\t\td.access.primitiveStreams[streamName] = accessor;\r\n\r\n\t\tvar streams = new Array(1);\r\n\t\tstreams[0] = streamName;\r\n\t\tbinding.primitiveStreams[info.semantic] = streams;\r\n\t}\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Model.prototype = {\r\n\tget descriptor() {\r\n\t\treturn this._descriptor;\r\n\t},\r\n\r\n\tget isReady() {\r\n\t\treturn !!this._descriptor;\r\n\t},\r\n\r\n\tget gl() {\r\n\t\treturn this._gl;\r\n\t},\r\n\r\n\tget renderData() {\r\n\t\treturn this._renderData;\r\n\t},\r\n\r\n\tupdateTypedArrays : function () {\r\n\t\tvar d = this._descriptor;\r\n\t\tif (!d) return false;\r\n\r\n\t\tvar buffer = null;\r\n\t\tvar ctor   = null;\r\n\r\n\t\tvar vertexBuffers = d.data.vertexBuffers;\r\n\t\tfor (var x in vertexBuffers) {\r\n\t\t\tbuffer = vertexBuffers[x];\r\n\t\t\tif (!buffer.untypedArray) continue;\r\n\t\t\tctor = SpiderGL.Type.typeToTypedArrayConstructor(buffer.type);\r\n\t\t\tbuffer.typedArray = new ctor(buffer.untypedArray);\r\n\t\t}\r\n\r\n\t\tvar indexBuffers = d.data.indexBuffers;\r\n\t\tfor (var x in indexBuffers) {\r\n\t\t\tbuffer = indexBuffers[x];\r\n\t\t\tif (!buffer.untypedArray) continue;\r\n\t\t\tctor = SpiderGL.Type.typeToTypedArrayConstructor(buffer.type);\r\n\t\t\tbuffer.typedArray = new ctor(buffer.untypedArray);\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tupdateGL : function (gl, options) {\r\n\t\tif (!gl) return false;\r\n\r\n\t\tvar d = this._descriptor;\r\n\t\tif (!d) return false;\r\n\r\n\t\tthis._gl = gl;\r\n\r\n\t\tvar buffer     = null;\r\n\t\tvar typedArray = null;\r\n\t\tvar ctor       = null;\r\n\r\n\t\tvar bufferOptions = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tdata   : null,\r\n\t\t\tusage  : SpiderGL.Core.DEFAULT\r\n\t\t}, options);\r\n\t\tbufferOptions.data = null;\r\n\r\n\t\tfor (var x in d.data.vertexBuffers) {\r\n\t\t\tbuffer = d.data.vertexBuffers[x];\r\n\t\t\tbufferOptions.data = buffer.typedArray;\r\n\t\t\tif (!bufferOptions.data) {\r\n\t\t\t\tctor = SpiderGL.Type.typeToTypedArrayConstructor(buffer.type);\r\n\t\t\t\tbufferOptions.data = new ctor(buffer.untypedArray);\r\n\t\t\t}\r\n\t\t\tif (buffer.glBuffer) {\r\n\t\t\t\tbuffer.glBuffer.destroy();\r\n\t\t\t\tbuffer.glBuffer = null;\r\n\t\t\t}\r\n\t\t\tbuffer.glBuffer = new SpiderGL.WebGL.VertexBuffer(gl, bufferOptions);\r\n\t\t}\r\n\r\n\t\tfor (var x in d.data.indexBuffers) {\r\n\t\t\tbuffer = d.data.indexBuffers[x];\r\n\t\t\tbufferOptions.data = buffer.typedArray;\r\n\t\t\tif (!bufferOptions.data) {\r\n\t\t\t\tctor = SpiderGL.Type.typeToTypedArrayConstructor(buffer.type);\r\n\t\t\t\tbufferOptions.data = new ctor(buffer.untypedArray);\r\n\t\t\t}\r\n\t\t\tif (buffer.glBuffer) {\r\n\t\t\t\tbuffer.glBuffer.destroy();\r\n\t\t\t\tbuffer.glBuffer = null;\r\n\t\t\t}\r\n\t\t\tbuffer.glBuffer = new SpiderGL.WebGL.IndexBuffer(gl, bufferOptions);\r\n\t\t}\r\n\r\n\t\tvar stream = null;\r\n\r\n\t\tfor (var x in d.access.vertexStreams) {\r\n\t\t\tstream = d.access.vertexStreams[x];\r\n\t\t\tstream.glType = SpiderGL.Type.typeToGL(stream.type);\r\n\t\t}\r\n\r\n\t\tfor (var x in d.access.primitiveStreams) {\r\n\t\t\tstream = d.access.primitiveStreams[x];\r\n\t\t\tstream.glMode = SpiderGL.Type.primitiveToGL(stream.mode);\r\n\t\t\tstream.glType = SpiderGL.Type.typeToGL(stream.type);\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tdestroyGL : function () {\r\n\t\tvar d = this._descriptor;\r\n\t\tif (!d) return false;\r\n\r\n\t\tvar buffer = null;\r\n\r\n\t\tfor (var x in d.data.vertexBuffers) {\r\n\t\t\tbuffer = d.data.vertexBuffers[x];\r\n\t\t\tif (buffer.glBuffer) {\r\n\t\t\t\tbuffer.glBuffer.destroy();\r\n\t\t\t\tbuffer.glBuffer = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var x in d.data.indexBuffers) {\r\n\t\t\tbuffer = d.data.indexBuffers[x];\r\n\t\t\tif (buffer.glBuffer) {\r\n\t\t\t\tbuffer.glBuffer.destroy();\r\n\t\t\t\tbuffer.glBuffer = null;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tupdateRenderData : function () {\r\n\t\tvar d = this._descriptor;\r\n\t\tif (!d) return false;\r\n\r\n\t\tvar renderData = {\r\n\t\t\tpartMap : { }\r\n\t\t};\r\n\r\n\t\tfor (var partName in d.logic.parts) {\r\n\t\t\tvar part = d.logic.parts[partName];\r\n\t\t\tvar chunkNames = part.chunks;\r\n\t\t\tvar partInfo = { };\r\n\t\t\trenderData.partMap[partName] = partInfo;\r\n\r\n\t\t\tfor (var i=0, n=chunkNames.length; i<n; ++i) {\r\n\t\t\t\tvar chunkName = chunkNames[i];\r\n\t\t\t\tvar chunk = d.semantic.chunks[chunkName];\r\n\t\t\t\tvar chunkInfo = { };\r\n\t\t\t\tpartInfo[chunkName] = chunkInfo;\r\n\r\n\t\t\t\tvar techniques = chunk.techniques;\r\n\t\t\t\tfor (var techniqueName in techniques) {\r\n\t\t\t\t\tvar techique = techniques[techniqueName];\r\n\t\t\t\t\tvar techiqueInfo = {\r\n\t\t\t\t\t\tvertexStreams : {\r\n\t\t\t\t\t\t\tbuffered : [ ],\r\n\t\t\t\t\t\t\tconstant : [ ]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tprimitiveStreams : { }\r\n\t\t\t\t\t};\r\n\t\t\t\t\tchunkInfo[techniqueName] = techiqueInfo;\r\n\r\n\t\t\t\t\tvar binding = d.semantic.bindings[techique.binding];\r\n\r\n\t\t\t\t\tvar streams = binding.vertexStreams;\r\n\t\t\t\t\tvar bufferMap = { };\r\n\t\t\t\t\tfor (var semantic in streams) {\r\n\t\t\t\t\t\tvar streamNames = streams[semantic];\r\n\t\t\t\t\t\tfor (var j=0, m=streamNames.length; j<m; ++j) {\r\n\t\t\t\t\t\t\tvar streamName = streamNames[j];\r\n\t\t\t\t\t\t\tvar stream = d.access.vertexStreams[streamName];\r\n\t\t\t\t\t\t\tvar streamInfo = {\r\n\t\t\t\t\t\t\t\tsemantic : semantic,\r\n\t\t\t\t\t\t\t\tindex    : j,\r\n\t\t\t\t\t\t\t\tstream   : stream\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar bufferName = stream.buffer;\r\n\t\t\t\t\t\t\tif (bufferName) {\r\n\t\t\t\t\t\t\t\tbufferMap[bufferName] = bufferMap[bufferName] || [ ];\r\n\t\t\t\t\t\t\t\tbufferMap[bufferName].push(streamInfo);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\ttechiqueInfo.vertexStreams.constant.push(streamInfo);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (var bufferName in bufferMap) {\r\n\t\t\t\t\t\tvar bufferInfo = {\r\n\t\t\t\t\t\t\tbuffer  : d.data.vertexBuffers[bufferName],\r\n\t\t\t\t\t\t\tstreams : bufferMap[bufferName].slice()\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\ttechiqueInfo.vertexStreams.buffered.push(bufferInfo);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar streams = binding.primitiveStreams;\r\n\t\t\t\t\tfor (var semantic in streams) {\r\n\t\t\t\t\t\tvar bufferMap = { };\r\n\t\t\t\t\t\tvar primitiveStreamsInfo = {\r\n\t\t\t\t\t\t\tbuffered : [ ],\r\n\t\t\t\t\t\t\tarray    : [ ]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\ttechiqueInfo.primitiveStreams[semantic] = primitiveStreamsInfo;\r\n\r\n\t\t\t\t\t\tvar streamNames = streams[semantic];\r\n\t\t\t\t\t\tfor (var j=0, m=streamNames.length; j<m; ++j) {\r\n\t\t\t\t\t\t\tvar streamName = streamNames[j];\r\n\t\t\t\t\t\t\tvar stream = d.access.primitiveStreams[streamName];\r\n\t\t\t\t\t\t\tvar bufferName = stream.buffer;\r\n\t\t\t\t\t\t\tif (bufferName) {\r\n\t\t\t\t\t\t\t\tbufferMap[bufferName] = bufferMap[bufferName] || [ ];\r\n\t\t\t\t\t\t\t\tbufferMap[bufferName].push(stream);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tprimitiveStreamsInfo.array.push(stream);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (var bufferName in bufferMap) {\r\n\t\t\t\t\t\t\tvar bufferInfo = {\r\n\t\t\t\t\t\t\t\tbuffer  : d.data.indexBuffers[bufferName],\r\n\t\t\t\t\t\t\t\tstreams : bufferMap[bufferName].slice()\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tprimitiveStreamsInfo.buffered.push(bufferInfo);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._renderData = renderData;\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.Model.Model, SpiderGL.Core.ObjectBase);\r\n\r\n/**\r\n * Creates a SpiderGL.Model.Technique.\r\n *\r\n * @class The SpiderGL.Model.Technique handles the way a model is drawn.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n */\r\nSpiderGL.Model.Technique = function (gl, descriptor, options) {\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t}, options);\r\n\r\n\tif (descriptor && (\"vertexShader\" in descriptor) && (\"fragmentShader\" in descriptor)) {\r\n\t\tdescriptor = SpiderGL.Model.Technique._createSimpleDescriptor(gl, descriptor);\r\n\t}\r\n\r\n\tthis._descriptor = SpiderGL.Model.Technique._fixDescriptor(descriptor);\r\n\tthis._gl = this._descriptor.program.gl;\r\n\tthis._renderData = { };\r\n\r\n\tif (gl) {\r\n\t\tthis.updateRenderData();\r\n\t}\r\n};\r\n\r\nSpiderGL.Model.Technique._fixDescriptor = function (d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tname     : \"common\",\r\n\t\tprogram  : null,\r\n\t\tsemantic : { }\r\n\t}, d);\r\n\r\n\tif (d.vertexStreams) {\r\n\t\td.semantic.vertexStreams = d.vertexStreams;\r\n\t\tdelete d.vertexStreams;\r\n\t}\r\n\r\n\tif (d.globals) {\r\n\t\td.semantic.globals = d.globals;\r\n\t\tdelete d.globals;\r\n\t}\r\n\r\n\td.semantic = SpiderGL.Model.Technique._fixSemantic(d.program, d.semantic);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Technique._fixSemantic = function (p, d) {\r\n\td = SpiderGL.Utility.getDefaultObject({\r\n\t\tvertexStreams : null,\r\n\t\tglobals       : null\r\n\t}, d);\r\n\r\n\td.vertexStreams = SpiderGL.Model.Technique._fixVertexStreams (p, d.vertexStreams);\r\n\td.globals       = SpiderGL.Model.Technique._fixGlobals       (p, d.globals);\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Technique._fixVertexStreams = function (p, d) {\r\n\tvar num = \"0123456789\";\r\n\t//var lwr = \"abcdefghijklmnopqrstuvwxyz\";\r\n\t//var upr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n\r\n\tvar attribNames = p.getAttributesNames();\r\n\tvar requiredAttribs = { };\r\n\tfor (var i=0, n=attribNames.length; i<n; ++i) {\r\n\t\tvar attribName  = attribNames[i];\r\n\r\n\t\tvar semanticStr = \"\";\r\n\t\tvar indexStr    = \"\";\r\n\r\n\t\tfor (var j=attribName.length-1; j>=0; --j) {\r\n\t\t\tvar ch = attribName.charAt(j);\r\n\t\t\tif (num.indexOf(ch, 0) == -1) {\r\n\t\t\t\tsemanticStr = attribName.substring(0, j + 1);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tindexStr = ch + indexStr;\r\n\t\t}\r\n\t\tvar index = ((indexStr.length > 0) ? (parseInt(indexStr)) : (0));\r\n\r\n\t\tvar len = semanticStr.length;\r\n\t\tif (len >= 2) {\r\n\t\t\tif (semanticStr.charAt(0) == \"a\") {\r\n\t\t\t\tvar ch = semanticStr.charAt(1);\r\n\t\t\t\tif ((ch == \"_\") && (len > 2)) {\r\n\t\t\t\t\tsemanticStr = semanticStr.substring(2);\r\n\t\t\t\t}\r\n\t\t\t\telse if (ch == semanticStr.charAt(1).toUpperCase()) {\r\n\t\t\t\t\tsemanticStr = semanticStr.substring(1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar semantic = semanticStr.toUpperCase();\r\n\t\trequiredAttribs[attribName] = {\r\n\t\t\tsemantic : semantic,\r\n\t\t\tindex    : index,\r\n\t\t\tvalue    : [0.0, 0.0, 0.0, 1.0]\r\n\t\t};\r\n\t}\r\n\r\n\tvar dd = { };\r\n\tfor (var x in d) {\r\n\t\tvar r = requiredAttribs[x];\r\n\t\tif (!r) continue;\r\n\r\n\t\tvar s = d[x];\r\n\t\tif (SpiderGL.Type.isString(s)) {\r\n\t\t\ts = { semantic : s };\r\n\t\t}\r\n\t\telse if (SpiderGL.Type.isArray(s) || SpiderGL.Type.isTypedArray(s)) {\r\n\t\t\ts = { value : s };\r\n\t\t}\r\n\t\telse if (SpiderGL.Type.isNumber(s)) {\r\n\t\t\ts = { value : [s, s, s, s] };\r\n\t\t}\r\n\t\tdd[x] = SpiderGL.Utility.getDefaultObject({\r\n\t\t\tsemantic : r.semantic,\r\n\t\t\tindex    : r.index,\r\n\t\t\tvalue    : r.value\r\n\t\t}, s);\r\n\t}\r\n\r\n\td = SpiderGL.Utility.getDefaultObject(requiredAttribs, dd);\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Technique._fixGlobals = function (p, d) {\r\n\tvar uniformValues = p.getUniformsValues();\r\n\tvar requiredUniforms = { };\r\n\tfor (var uniformName in uniformValues) {\r\n\t\tvar semanticStr = uniformName;\r\n\t\tvar len = semanticStr.length;\r\n\t\tif (len >= 2) {\r\n\t\t\tif (semanticStr.charAt(0) == \"u\") {\r\n\t\t\t\tvar ch = semanticStr.charAt(1);\r\n\t\t\t\tif ((ch == \"_\") && (len > 2)) {\r\n\t\t\t\t\tsemanticStr = semanticStr.substring(2);\r\n\t\t\t\t}\r\n\t\t\t\telse if (ch == semanticStr.charAt(1).toUpperCase()) {\r\n\t\t\t\t\tsemanticStr = semanticStr.substring(1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar semantic = semanticStr.toUpperCase();\r\n\t\trequiredUniforms[uniformName] = {\r\n\t\t\tsemantic : semantic,\r\n\t\t\tvalue    : uniformValues[uniformName]\r\n\t\t};\r\n\t};\r\n\r\n\td = SpiderGL.Utility.getDefaultObject(requiredUniforms, d);\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Technique._createSimpleDescriptor = function (gl, options) {\r\n\toptions = SpiderGL.Utility.getDefaultObject({\r\n\t\tname           : \"common\",\r\n\t\tvertexShader   : null,\r\n\t\tfragmentShader : null,\r\n\t\tattributes     : null,\r\n\t\tuniforms       : null,\r\n\t\tsemantic       : { },\r\n\t\tvertexStreams  : null,\r\n\t\tglobals        : null,\r\n\t\toptions        : null\r\n\t}, options);\r\n\r\n\tif (options.vertexStreams) {\r\n\t\toptions.semantic.vertexStreams = options.vertexStreams;\r\n\t\tdelete options.vertexStreams;\r\n\t}\r\n\r\n\tif (options.globals) {\r\n\t\toptions.semantic.globals = options.globals;\r\n\t\tdelete options.globals;\r\n\t}\r\n\r\n\tvar d = {\r\n\t\tname     : options.name,\r\n\t\tprogram  : null,\r\n\t\tsemantic : options.semantic\r\n\t};\r\n\r\n\tif (!gl) {\r\n\t\treturn d;\r\n\t}\r\n\r\n\tvar vertexShader = options.vertexShader;\r\n\tvar fragmentShader = options.fragmentShader;\r\n\r\n\tif (!vertexShader || !fragmentShader) {\r\n\t\treturn d;\r\n\t}\r\n\r\n\tif (SpiderGL.Type.isString(vertexShader)) {\r\n\t\tvertexShader = new SpiderGL.WebGL.VertexShader(gl, vertexShader);\r\n\t}\r\n\telse if (!SpiderGL.Type.instanceOf(vertexShader, SpiderGL.WebGL.VertexShader)) {\r\n\t\treturn d;\r\n\t}\r\n\r\n\tif (SpiderGL.Type.isString(fragmentShader)) {\r\n\t\tfragmentShader = new SpiderGL.WebGL.FragmentShader(gl, fragmentShader);\r\n\t}\r\n\telse if (!SpiderGL.Type.instanceOf(fragmentShader, SpiderGL.WebGL.FragmentShader)) {\r\n\t\treturn d;\r\n\t}\r\n\r\n\tvar program = new SpiderGL.WebGL.Program(gl, {\r\n\t\tshaders    : [ vertexShader, fragmentShader ],\r\n\t\tattributes : options.attributes,\r\n\t\tuniforms   : options.uniforms\r\n\t});\r\n\r\n\td.program = program;\r\n\r\n\treturn d;\r\n};\r\n\r\nSpiderGL.Model.Technique.prototype = {\r\n\tget descriptor() {\r\n\t\treturn this._descriptor;\r\n\t},\r\n\r\n\tget isReady() {\r\n\t\treturn !!this._descriptor;\r\n\t},\r\n\r\n\tget gl() {\r\n\t\treturn this._gl;\r\n\t},\r\n\r\n\tget name() {\r\n\t\treturn this._descriptor.name;\r\n\t},\r\n\r\n\tget renderData() {\r\n\t\treturn this._renderData;\r\n\t},\r\n\r\n\tget program() {\r\n\t\treturn this._descriptor.program;\r\n\t},\r\n\r\n\tsetUniforms : function (uniforms) {\r\n\t\tthis._descriptor.program.setUniforms(uniforms);\r\n\t},\r\n\r\n\tupdateRenderData : function () {\r\n\t\tvar d = this._descriptor;\r\n\r\n\t\tvar renderData = { };\r\n\t\tthis._renderData = renderData;\r\n\r\n\t\tvar attributesMap = { };\r\n\t\trenderData.attributesMap = attributesMap;\r\n\t\tvar attributesIndices = d.program.getAttributesIndices();\r\n\t\tfor (var attribName in d.semantic.vertexStreams) {\r\n\t\t\tvar semanticInfo = d.semantic.vertexStreams[attribName];\r\n\t\t\tvar semanticName = semanticInfo.semantic;\r\n\t\t\tvar attribs = attributesMap[semanticName];\r\n\t\t\tif (!attribs) {\r\n\t\t\t\tattribs = [ ];\r\n\t\t\t\tattributesMap[semanticName] = attribs;\r\n\t\t\t}\r\n\t\t\tattribs[semanticInfo.index] = {\r\n\t\t\t\tindex : attributesIndices[attribName],\r\n\t\t\t\tvalue : semanticInfo.value\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tvar globalsMap = { };\r\n\t\trenderData.globalsMap = globalsMap;\r\n\t\tfor (var uniformName in d.semantic.globals) {\r\n\t\t\tvar semanticInfo = d.semantic.globals[uniformName];\r\n\t\t\tglobalsMap[semanticInfo.semantic] = {\r\n\t\t\t\tname  : uniformName,\r\n\t\t\t\tvalue : semanticInfo.value\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Creates a SpiderGL.Model.Technique.\r\n *\r\n * @class The SpiderGL.Model.Technique handles the way a model is drawn.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n */\r\nSpiderGL.Model.ModelRenderer = function (gl) {\r\n\tthis._gl = gl;\r\n\tthis._vertexAttributesCount = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\r\n\tthis._textureUnitsCount     = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n\tthis._internalFramebuffer   = new SpiderGL.WebGL.Framebuffer(gl);\r\n\tthis._reset();\r\n};\r\n\r\nSpiderGL.Model.ModelRenderer.prototype = {\r\n\t_reset : function () {\r\n\t\tthis._technique        = null;\r\n\t\tthis._model            = null;\r\n\t\tthis._partName         = null;\r\n\t\tthis._chunkName        = null;\r\n\t\tthis._primMode         = null;\r\n\t\tthis._framebuffer      = null;\r\n\r\n\t\tthis._inBegin          = false;\r\n\r\n\t\tthis._enabledArrays    = [ ];\r\n\t\tthis._boundTextures    = [ ];\r\n\t\tthis._attribValues     = [ ];\r\n\t\tthis._primitiveStreams = [ ];\r\n\r\n\t\tthis._techniqueDirty   = true;\r\n\t\tthis._modelDirty       = true;\r\n\t\tthis._modelPartDirty   = true;\r\n\t\tthis._modelChunkDirty  = true;\r\n\t\tthis._primModeDirty    = true;\r\n\t\tthis._framebufferDirty = true;\r\n\t\tthis._viewportDirty    = true;\r\n\r\n\t\tthis._dirty            = true;\r\n\t},\r\n\r\n\t_resetContext : function () {\r\n\t\tvar gl = this._gl;\r\n\r\n\t\tfor (var i=0, n=this._vertexAttributesCount; i<n; ++i) {\r\n\t\t\tgl.disableVertexAttribArray(i);\r\n\t\t}\r\n\r\n\t\tfor (var i=this._textureUnitsCount-1; i>=0; --i) {\r\n\t\t\tgl.activeTexture(gl.TEXTURE0 + i);\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\t\t\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n\t\t}\r\n\r\n\t\tSpiderGL.WebGL.VertexBuffer .unbind(gl);\r\n\t\tSpiderGL.WebGL.IndexBuffer  .unbind(gl);\r\n\t\tSpiderGL.WebGL.Program      .unbind(gl);\r\n\t\tSpiderGL.WebGL.Framebuffer  .unbind(gl);\r\n\t},\r\n\r\n\t_update : function () {\r\n\t\tif (!this._dirty) return true;\r\n\r\n\t\tvar gl = this._gl;\r\n\r\n\t\tif (this._techniqueDirty) {\r\n\t\t\tvar technique = this._technique;\r\n\t\t\tif (!technique) return false;\r\n\r\n\t\t\tvar techniqueRenderData = technique.renderData;\r\n\t\t\tvar attributesMap = techniqueRenderData.attributesMap;\r\n\t\t\tvar attribValues = [ ];\r\n\t\t\tfor (var semantic in attributesMap) {\r\n\t\t\t\tvar attribs = attributesMap[semantic];\r\n\t\t\t\tfor (var i in attribs) {\r\n\t\t\t\t\tvar attribInfo = attribs[i];\r\n\t\t\t\t\tvar attribData = null;\r\n\t\t\t\t\tif (attribInfo) {\r\n\t\t\t\t\t\tattribData = {\r\n\t\t\t\t\t\t\tindex : attribInfo.index,\r\n\t\t\t\t\t\t\tvalue : attribInfo.value\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tattribValues.push(attribData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._attribValues = attribValues;\r\n\r\n\t\t\ttechnique.program.bind();\r\n\r\n\t\t\tthis._techniqueDirty = false;\r\n\t\t}\r\n\r\n\t\tif (this._modelDirty) {\r\n\t\t\tvar model = this._model;\r\n\t\t\tif (!model) return false;\r\n\r\n\t\t\t// default vertex attributes\r\n\t\t\t//////////////\r\n\t\t\tvar attribValues = this._attribValues;\r\n\t\t\tfor (var i=0, n=attribValues.length; i<n; ++i) {\r\n\t\t\t\tvar attribData = attribValues[i];\r\n\t\t\t\tif (!attribData) continue;\r\n\t\t\t\tgl.vertexAttrib4fv(attribData.index, attribData.value);\r\n\t\t\t}\r\n\t\t\t//////////////\r\n\r\n\t\t\tvar modelRenderData = model.renderData;\r\n\r\n\t\t\tvar technique = this._technique;\r\n\t\t\tif (!technique) return false;\r\n\r\n\t\t\tvar techniqueRenderData = technique.renderData;\r\n\t\t\tif (!techniqueRenderData) return false;\r\n\t\t\tvar attributesMap = techniqueRenderData.attributesMap;\r\n\r\n\t\t\tif (this._modelPartDirty) {\r\n\t\t\t\tvar partName = this._partName;\r\n\t\t\t\tif (!partName) return false;\r\n\t\t\t\tthis._modelPartDirty = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (this._modelChunkDirty) {\r\n\t\t\t\tvar chunkName = this._chunkName;\r\n\t\t\t\tif (!chunkName) return false;\r\n\r\n\t\t\t\tvar partInfo = modelRenderData.partMap[this._partName];\r\n\t\t\t\tif (!partInfo) return false;\r\n\r\n\t\t\t\tvar chunkInfo = partInfo[chunkName];\r\n\t\t\t\tif (!chunkInfo) return false;\r\n\r\n\t\t\t\tvar techniqueInfo = chunkInfo[technique.name];\r\n\t\t\t\tif (!techniqueInfo) {\r\n\t\t\t\t\ttechniqueInfo = chunkInfo[\"common\"];\r\n\t\t\t\t}\r\n\t\t\t\tif (!techniqueInfo) return false;\r\n\r\n\t\t\t\t// buffered vertex streams\r\n\t\t\t\t//////////////\r\n\t\t\t\tvar enabledArrays = this._enabledArrays;\r\n\t\t\t\tfor (var i=0, n=enabledArrays.length; i<n; ++i) {\r\n\t\t\t\t\tgl.disableVertexAttribArray(enabledArrays[i]);\r\n\t\t\t\t}\r\n\t\t\t\tenabledArrays = [ ];\r\n\t\t\t\tvar streams = techniqueInfo.vertexStreams.buffered;\r\n\t\t\t\tfor (var i=0, n=streams.length; i<n; ++i) {\r\n\t\t\t\t\tvar data   = streams[i];\r\n\t\t\t\t\tvar buffer = data.buffer.glBuffer;\r\n\t\t\t\t\tbuffer.bind();\r\n\r\n\t\t\t\t\tvar infos = data.streams;\r\n\t\t\t\t\tfor (var j=0, m=infos.length; j<m; ++j) {\r\n\t\t\t\t\t\tvar info   = infos[j];\r\n\t\t\t\t\t\tif (!attributesMap[info.semantic] || !attributesMap[info.semantic][info.index]) continue;\r\n\t\t\t\t\t\tvar index  = attributesMap[info.semantic][info.index].index;\r\n\t\t\t\t\t\tvar stream = info.stream;\r\n\t\t\t\t\t\tstream.index = index;\r\n\t\t\t\t\t\tenabledArrays.push(index);\r\n\t\t\t\t\t\tbuffer.vertexAttribPointer(stream);\r\n\t\t\t\t\t\t//gl.enableVertexAttribArray(index);\r\n\t\t\t\t\t\t//gl.vertexAttribPointer(index, stream.size, stream.glType, stream.normalized, stream.stride, stream.offset);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._enabledArrays = enabledArrays;\r\n\t\t\t\t//////////////\r\n\r\n\t\t\t\t// constant vertex streams\r\n\t\t\t\t//////////////\r\n\t\t\t\tvar infos = techniqueInfo.vertexStreams.constant;\r\n\t\t\t\tfor (var j=0, n=infos.length; j<n; ++j) {\r\n\t\t\t\t\tvar info   = infos[j];\r\n\t\t\t\t\tif (!attributesMap[info.semantic] || !attributesMap[info.semantic][info.index]) continue;\r\n\t\t\t\t\tvar index  = attributesMap[info.semantic][info.index].index;\r\n\t\t\t\t\tvar stream = info.stream;\r\n\t\t\t\t\tgl.vertexAttrib4fv(index, stream.value);\r\n\t\t\t\t}\r\n\t\t\t\t//////////////\r\n\r\n\t\t\t\tthis._modelChunkDirty = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (this._primModeDirty) {\r\n\t\t\t\tvar primMode = this._primMode;\r\n\t\t\t\tif (!primMode) return false;\r\n\r\n\t\t\t\tvar partInfo = modelRenderData.partMap[this._partName];\r\n\t\t\t\tif (!partInfo) return false;\r\n\r\n\t\t\t\tvar chunkInfo = partInfo[this._chunkName];\r\n\t\t\t\tif (!chunkInfo) return false;\r\n\r\n\t\t\t\tvar techniqueInfo = chunkInfo[technique.name];\r\n\t\t\t\tif (!techniqueInfo) {\r\n\t\t\t\t\ttechniqueInfo = chunkInfo[\"common\"];\r\n\t\t\t\t}\r\n\t\t\t\tif (!techniqueInfo) return false;\r\n\r\n\t\t\t\tvar primitiveStreams = techniqueInfo.primitiveStreams[primMode];\r\n\t\t\t\tif (!primitiveStreams) return false;\r\n\r\n\t\t\t\t// primitive streams\r\n\t\t\t\t/////////////////////////////////////////////////\r\n\t\t\t\tthis._primitiveStreams = primitiveStreams;\r\n\r\n\t\t\t\tthis._primModeDirty = false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._modelDirty = false;\r\n\t\t}\r\n\r\n\t\tif (this._framebufferDirty) {\r\n\t\t\tif (this._framebuffer) {\r\n\t\t\t\tthis._framebuffer.bind();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tSpiderGL.WebGL.Framebuffer.unbind(gl);\r\n\t\t\t}\r\n\t\t\tthis._framebufferDirty = false;\r\n\t\t}\r\n\r\n\t\tif (this._viewportDirty) {\r\n\t\t\tif (this._framebuffer) {\r\n\t\t\t\tif (this._framebuffer.autoViewport) {\r\n\t\t\t\t\tthis._framebuffer.applyViewport();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._viewportDirty = false;\r\n\t\t}\r\n\r\n\t\tthis._dirty = false;\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tget gl() {\r\n\t\treturn this._gl;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn (!!this._gl);\r\n\t},\r\n\r\n\tdestroy : function () {\r\n\t\tthis.end();\r\n\t\tthis._internalFramebuffer.destroy();\r\n\t\tthis._internalFramebuffer = null;\r\n\t\tthis._gl = null;\r\n\t},\r\n\r\n\tbegin : function () {\r\n\t\tif (this._inBegin) return;\r\n\t\tthis._resetContext();\r\n\t\tthis._inBegin = true;\r\n\t},\r\n\r\n\tend : function () {\r\n\t\tif (!this._inBegin) return;\r\n\t\tthis._inBegin = false;\r\n\t\tvar gl = this._gl;\r\n\r\n\t\tvar enabledArrays = this._enabledArrays;\r\n\t\tfor (var i=0, n=enabledArrays.length; i<n; ++i) {\r\n\t\t\tgl.disableVertexAttribArray(enabledArrays[i]);\r\n\t\t}\r\n\r\n\t\tvar boundTextures = this._boundTextures;\r\n\t\tfor (var i=0, n=boundTextures.length; i<n; ++i) {\r\n\t\t\tvar tex = boundTextures[i];\r\n\t\t\tif (!tex) continue;\r\n\t\t\tif (tex.target == gl.TEXTURE_2D) {\r\n\t\t\t\tSpiderGL.WebGL.Texture2D.unbind(gl, tex.unit);\r\n\t\t\t}\r\n\t\t\telse if (tex.target == gl.TEXTURE_CUBE_MAP) {\r\n\t\t\t\tSpiderGL.WebGL.TextureCubeMap.unbind(gl, tex.unit);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._framebuffer) {\r\n\t\t\tSpiderGL.WebGL.Framebuffer.unbind(this._gl);\r\n\t\t}\r\n\r\n\t\tthis._internalFramebuffer.detachAll();\r\n\r\n\t\tthis._reset();\r\n\t\tthis._resetContext();\r\n\t},\r\n\r\n\tget isInBegin() {\r\n\t\treturn this._inBegin;\r\n\t},\r\n\r\n\tsetTechnique : function (t) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (this._technique == t) return;\r\n\t\tthis._technique = t;\r\n\t\tthis._techniqueDirty = true;\r\n\t\tthis._dirty = true;\r\n\r\n\t\tif (!t) {\r\n\t\t\tSpiderGL.WebGL.Program.unbind(this._gl);\r\n\t\t}\r\n\t},\r\n\r\n\tget technique() {\r\n\t\treturn this._technique;\r\n\t},\r\n\r\n\tsetModel : function (m) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (this._model == m) return;\r\n\t\tthis._model = m;\r\n\t\tthis._modelDirty = true;\r\n\t\tthis._modelPartDirty = true;\r\n\t\tthis._modelChunkDirty = true;\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\tget model() {\r\n\t\treturn this._model;\r\n\t},\r\n\r\n\tsetPart : function (p) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (this._part == p) return;\r\n\t\tthis._partName = p;\r\n\t\tthis._modelPartDirty = true;\r\n\t\tthis._modelDirty = true;\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\tget part() {\r\n\t\treturn this._partName;\r\n\t},\r\n\r\n\tsetChunk : function (c) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (this._chunk == c) return;\r\n\t\tthis._chunkName = c;\r\n\t\tthis._modelDirty = true;\r\n\t\tthis._modelChunkDirty = true;\r\n\t\tthis._primModeDirty = true;\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\tget chunk() {\r\n\t\treturn this._chunkName;\r\n\t},\r\n\r\n\tsetPrimitiveMode : function (m) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (this._primMode == m) return;\r\n\t\tthis._primMode = m;\r\n\t\tthis._primModeDirty = true;\r\n\t\tthis._modelDirty = true;\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\tget primitiveMode() {\r\n\t\treturn this._primMode;\r\n\t},\r\n\r\n\tsetUniforms : function (u) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (!this._technique) return;\r\n\t\tthis._technique.program.setUniforms(u);\r\n\t},\r\n\r\n\tsetDefaultGlobals : function () {\r\n\t\tif (!this._inBegin) return;\r\n\r\n\t\tvar technique = this._technique;\r\n\t\tif (!technique) return;\r\n\r\n\t\tvar globalsMap = technique.renderData.globalsMap;\r\n\t\tvar uniforms = { };\r\n\t\tfor (var semantic in globalsMap) {\r\n\t\t\tvar uniformName  = globalsMap[semantic].name;\r\n\t\t\tvar uniformValue = globalsMap[semantic].value;\r\n\t\t\tuniforms[uniformName] = uniformValue;\r\n\t\t}\r\n\r\n\t\ttechnique.program.setUniforms(uniforms);\r\n\t},\r\n\r\n\tsetGlobals : function (g) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (!g) return;\r\n\r\n\t\tvar technique = this._technique;\r\n\t\tif (!technique) return;\r\n\r\n\t\tvar globalsMap = technique.renderData.globalsMap;\r\n\t\tvar uniforms = { };\r\n\t\tfor (var semantic in g) {\r\n\t\t\tif (!globalsMap[semantic]) continue;\r\n\t\t\tvar uniformName  = globalsMap[semantic].name;\r\n\t\t\tvar uniformValue = g[semantic];\r\n\t\t\tuniforms[uniformName] = uniformValue;\r\n\t\t}\r\n\r\n\t\ttechnique.program.setUniforms(uniforms);\r\n\t},\r\n\r\n\tsetFramebuffer : function (fb) {\r\n\t\tif (!this._inBegin) return;\r\n\r\n\t\t//this._internalFramebuffer.detachAll();\r\n\t\tif (this._framebuffer == fb) return;\r\n\r\n\t\tthis._framebuffer = fb;\r\n\t\tthis._framebufferDirty = true;\r\n\t\tthis._viewportDirty = true;\r\n\t\tthis._dirty = true;\r\n\r\n\t\tif (fb) {\r\n\t\t\tfb.bind();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tSpiderGL.WebGL.Framebuffer.unbind(this._gl);\r\n\t\t}\r\n\t},\r\n\r\n\tactivateOffScreenFramebuffer : function () {\r\n\t\tthis.setFramebuffer(this._internalFramebuffer);\r\n\t},\r\n\r\n\tactivateMainFramebuffer : function () {\r\n\t\treturn this.setFramebuffer(null);\r\n\t},\r\n\r\n\tsetFramebufferAttachments : function (attachments) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (!this._framebuffer) return;\r\n\t\tthis._framebuffer.setAttachments(attachments);\r\n\t\tthis._framebufferDirty = true;\r\n\t\tthis._viewportDirty = true;\r\n\t},\r\n\r\n\tsetColorRenderTarget : function (rt) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (!this._framebuffer) return;\r\n\t\tthis._framebuffer.colorTarget = rt;\r\n\t\tthis._viewportDirty = true;\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\tsetDepthRenderTarget : function (rt) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (!this._framebuffer) return;\r\n\t\tthis._framebuffer.depthTarget = rt;\r\n\t\tthis._viewportDirty = true;\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\tsetStencilRenderTarget : function (rt) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (!this._framebuffer) return;\r\n\t\tthis._framebuffer.stencilTarget = rt;\r\n\t\tthis._viewportDirty = true;\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\tsetDepthStencilRenderTarget : function (rt) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (!this._framebuffer) return;\r\n\t\tthis._framebuffer.depthStencilTarget = rt;\r\n\t\tthis._viewportDirty = true;\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\tclearFramebuffer : function (options) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tif (!options) return;\r\n\t\tvar gl   = this._gl;\r\n\t\tvar mask = 0;\r\n\t\tif (SpiderGL.Type.isNumber(options)) {\r\n\t\t\tmask = options;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (\"color\" in options) {\r\n\t\t\t\tvar color = options.color;\r\n\t\t\t\tif (color) {\r\n\t\t\t\t\tgl.clearColor(color[0], color[1], color[2], color[3]);\r\n\t\t\t\t}\r\n\t\t\t\tmask |= gl.COLOR_BUFFER_BIT;\r\n\t\t\t}\r\n\t\t\tif (\"depth\" in options) {\r\n\t\t\t\tvar depth = options.depth;\r\n\t\t\t\tif (SpiderGL.Type.isNumber(depth)) {\r\n\t\t\t\t\tgl.clearDepth(depth);\r\n\t\t\t\t}\r\n\t\t\t\tmask |= gl.DEPTH_BUFFER_BIT;\r\n\t\t\t}\r\n\t\t\tif (\"stencil\" in options) {\r\n\t\t\t\tvar stencil = options.stencil;\r\n\t\t\t\tif (SpiderGL.Type.isNumber(stencil)) {\r\n\t\t\t\t\tgl.clearStencil(stencil);\r\n\t\t\t\t}\r\n\t\t\t\tmask |= gl.Stencil_BUFFER_BIT;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (mask) {\r\n\t\t\tvar fb = this._framebuffer;\r\n\t\t\tif (fb) {\r\n\t\t\t\tfb.clear(mask);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tgl.clear(mask);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetViewport : function (x, y, width, height) {\r\n\t\tif (!this._inBegin) return;\r\n\t\tvar gl = this._gl;\r\n\t\tgl.viewport(x, y, width, height);\r\n\t},\r\n\r\n\tsetTexture : function (unit, texture) {\r\n\t\tif (texture) {\r\n\t\t\ttexture.bind(unit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar gl = this._gl;\r\n\t\t\tSpiderGL.WebGL.Texture2D.unbind(gl, unit);\r\n\t\t\tSpiderGL.WebGL.TextureCubeMap.unbind(gl, unit);\r\n\t\t}\r\n\t},\r\n\r\n\tget canRender() {\r\n\t\treturn (!!this._inBegin && !!this._technique && !!this._model && !!this._partName && !!this._chunkName && !!this._primMode);\r\n\t},\r\n\r\n\trender : function () {\r\n\t\tif (!this.canRender) return;\r\n\t\tif (!this._update()) return;\r\n\r\n\t\tvar gl = this._gl;\r\n\r\n\t\tvar primitiveStreams = this._primitiveStreams;\r\n\r\n\t\tvar bufferedStreams = primitiveStreams.buffered;\r\n\t\tvar arrayStreams    = primitiveStreams.array;\r\n\r\n\t\t// buffered\r\n\t\t//////////////\r\n\t\tfor (var i=0, n=bufferedStreams.length; i<n; ++i) {\r\n\t\t\tvar data = bufferedStreams[i];\r\n\t\t\tvar buffer = data.buffer.glBuffer;\r\n\t\t\tbuffer.bind();\r\n\r\n\t\t\tvar infos = data.streams;\r\n\t\t\tfor (var j=0, m=infos.length; j<m; ++j) {\r\n\t\t\t\tvar stream = infos[j];\r\n\t\t\t\t//gl.drawElements(stream.glMode, stream.count, stream.glType, stream.offset);\r\n\t\t\t\tbuffer.drawElements(stream);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//////////////\r\n\r\n\t\t// array\r\n\t\t//////////////\r\n\t\tfor (var j=0, n=arrayStreams.length; j<n; ++j) {\r\n\t\t\tvar stream = arrayStreams[j];\r\n\t\t\tgl.drawArrays(stream.glMode, stream.first, stream.count);\r\n\t\t}\r\n\t\t//////////////\r\n\t},\r\n\r\n\trenderModelPart : function(partName) {\r\n\t\tvar part = this.model.descriptor.logic.parts[partName];\r\n\t\tthis.setPart(partName);\r\n\t\tfor (var c in part.chunks) {\r\n\t\t\tvar chunkName = part.chunks[c];\r\n\t\t\tthis.setChunk(chunkName);\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t},\r\n\r\n\trenderModel : function() {\r\n\t\tvar parts = this.model.descriptor.logic.parts;\r\n\t\tfor (var partName in parts) {\r\n\t\t\tvar part = parts[partName];\r\n\t\t\tthis.setPart(partName);\r\n\t\t\tfor (var c in part.chunks) {\r\n\t\t\t\tvar chunkName = part.chunks[c];\r\n\t\t\t\tthis.setChunk(chunkName);\r\n\t\t\t\tthis.render();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/*\r\nSpiderGL Computer Graphics Library\r\nCopyright (c) 2010, Marco Di Benedetto - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are met:\r\n    * Redistributions of source code must retain the above copyright\r\n      notice, this list of conditions and the following disclaimer.\r\n    * Redistributions in binary form must reproduce the above copyright\r\n      notice, this list of conditions and the following disclaimer in the\r\n      documentation and/or other materials provided with the distribution.\r\n    * Neither the name of SpiderGL nor the\r\n      names of its contributors may be used to endorse or promote products\r\n      derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\nDISCLAIMED. IN NO EVENT SHALL PAUL BRUNT BE LIABLE FOR ANY\r\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\n/**\r\n * @fileOverview UI\r\n */\r\n\r\n/**\r\n * The SpiderGL.UserInterface namespace.\r\n *\r\n * @namespace The SpiderGL.UserInterface namespace.\r\n */\r\nSpiderGL.UserInterface = { };\r\n\r\n/**\r\n * Creates a SpiderGL.UserInterface.CanvasHandler.\r\n *\r\n * SpiderGL.UserInterface.CanvasHandler is an event handler used to implement an easy controller for WebGL canvas.\r\n * It should not be directly used. Use {@link SpiderGL.UserInterface.handleCanvas} or {@link SpiderGL.UserInterface.handleCanvasOnLoad} to install it to a listener object.\r\n *\r\n * @class The SpiderGL.UserInterface.CanvasHandler is an event handler used to implement an easy controller for WebGL canvas. It should not be directly used.\r\n *\r\n * @augments SpiderGL.Core.ObjectBase\r\n *\r\n * @param {WebGLRenderingcontext} gl The WebGLRenderingcontext to pass to the handler.\r\n * @param {object} handler The event handler to which events will be dispatched.\r\n * @param {object} [options] Optional parameters\r\n * @param {bool} [options.standardGLUnpack=SpiderGL.UserInterface.CanvasHandler.DEFAULT_STANDARD_GL_UNPACK] If true, sets the default OpenGL unpack behaviour.\r\n * @param {number} [options.animateRate=SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE] Additional options.\r\n *\r\n * @see SpiderGL.UserInterface.handleCanvas\r\n * @see SpiderGL.UserInterface.handleCanvasOnLoad\r\n */\r\nSpiderGL.UserInterface.CanvasHandler = function (gl, handler, options) {\r\n\tSpiderGL.Core.ObjectBase.call(this);\r\n\r\n\toptions = options || { };\r\n\r\n\tvar that = this;\r\n\tvar canvas = gl.canvas;\r\n\r\n\tthis._gl        = gl;\r\n\tthis._canvas    = canvas;\r\n\tthis._handler   = handler;\r\n\r\n\tthis._ignoreKeyRepeat = SpiderGL.Utility.getDefaultValue(options.ignoreKeyRepeat, SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT);\r\n\tthis._keysDown = { };\r\n\r\n\tthis._mouseButtonsDown = [false, false, false];\r\n\r\n\tthis._dragging     = [false, false, false];\r\n\tthis._dragStartPos = [[0, 0], [0, 0], [0, 0]];\r\n\tthis._dragEndPos   = [[0, 0], [0, 0], [0, 0]];\r\n\tthis._dragDeltaPos = [[0, 0], [0, 0], [0, 0]];\r\n\r\n\tthis._cursorPos      = [0, 0];\r\n\tthis._cursorPrevPos  = [0, 0];\r\n\tthis._cursorDeltaPos = [0, 0];\r\n\r\n\tthis._drawEventPending      = false;\r\n\tthis._drawEventHandler      = function () { that._onDraw(); };\r\n\tthis._postDrawEventFunction = function () { that._postDrawEvent(); };\r\n\r\n\tthis._animateTime         = Date.now();\r\n\tthis._animatePrevTime     = this._animateTime;\r\n\tthis._animateDeltaTime    = 0;\r\n\tthis._animateRate         = 0;\r\n\tthis._animateID           = null;\r\n\tthis._animateEventHandler = function () { that._onAnimate(); };\r\n\tthis._animateMS           = -1;\r\n\tthis._animateWithTimeout  = false;\r\n\tthis._fastAnimate         = false;\r\n\r\n\tthis._fpsUpdateMS  = 1000;\r\n\tthis._fpsTime      = 0;\r\n\tthis._fpsCount     = 0;\r\n\tthis._fps          = 0;\r\n\tthis._delegateDraw = function(t) { that._onDraw(t); };\r\n\r\n\t/** @private */\r\n\tvar handleMessage = function (evt) {\r\n\t\tif (evt.source != window) return;\r\n\t\tif (evt.data == SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME) {\r\n\t\t\tevt.stopPropagation();\r\n\t\t\tthat._onAnimate();\r\n\t\t}\r\n\t\telse if (evt.data == SpiderGL.UserInterface.CanvasHandler._FAST_DRAW_MESSAGE_NAME) {\r\n\t\t\tevt.stopPropagation();\r\n\t\t\tthat._onDraw();\r\n\t\t}\r\n\t};\r\n\twindow.addEventListener(\"message\", handleMessage, true);\r\n\r\n\tcanvas.tabIndex = 0;\r\n\r\n\tcanvas.addEventListener(\"unload\",          function (e) { that._onTerminate       (e); }, false);\r\n\tcanvas.addEventListener(\"keydown\",         function (e) { that._onKeyDown         (e); }, false);\r\n\tcanvas.addEventListener(\"keyup\",           function (e) { that._onKeyUp           (e); }, false);\r\n\tcanvas.addEventListener(\"keypress\",        function (e) { that._onKeyPress        (e); }, false);\r\n\tcanvas.addEventListener(\"mousedown\",       function (e) { that._onMouseButtonDown (e); }, false);\r\n\tcanvas.addEventListener(\"mouseup\",         function (e) { that._onMouseButtonUp   (e); }, false);\r\n\tcanvas.addEventListener(\"mousemove\",       function (e) { that._onMouseMove       (e); }, false);\r\n\tcanvas.addEventListener(\"mouseout\",        function (e) { that._onMouseOut        (e); }, false);\r\n\tcanvas.addEventListener(\"click\",           function (e) { that._onClick           (e); }, false);\r\n\tcanvas.addEventListener(\"dblclick\",        function (e) { that._onDoubleClick     (e); }, false);\r\n\tcanvas.addEventListener(\"resize\",          function (e) { that._onResize          (e); }, false);\r\n\tcanvas.addEventListener(\"DOMMouseScroll\",  function (e) { that._onMouseWheel      (e); }, false);\r\n\tcanvas.addEventListener(\"mousewheel\",      function (e) { that._onMouseWheel      (e); }, false);\r\n\tcanvas.addEventListener(\"blur\",            function (e) { that._onBlur            (e); }, false);\r\n\r\n\twindow.addEventListener(\"mouseup\",         function (e) { that._onWindowMouseButtonUp (e); }, false);\r\n\twindow.addEventListener(\"mousemove\",       function (e) { that._onWindowMouseMove     (e); }, false);\r\n\r\n\tcanvas.addEventListener(\"touchstart\",      SpiderGL.UserInterface.CanvasHandler._touchHandler, false);\r\n\tcanvas.addEventListener(\"touchend\",        SpiderGL.UserInterface.CanvasHandler._touchHandler, false);\r\n\tcanvas.addEventListener(\"touchmove\",       SpiderGL.UserInterface.CanvasHandler._touchHandler, false);\r\n\r\n\twindow.addEventListener(\"pointerup\",       function (e) { if(e.pointerType==\"touch\") SpiderGL.UserInterface.CanvasHandler._touchHandler(e); else that._onWindowMouseButtonUp (e); }, false);\r\n\twindow.addEventListener(\"pointermove\",     function (e) { if(e.pointerType==\"touch\") SpiderGL.UserInterface.CanvasHandler._touchHandler(e); else that._onWindowMouseMove     (e); }, false);\r\n\r\n\tcanvas.addEventListener(\"pointerdown\",     function (e) { if(e.pointerType==\"touch\") SpiderGL.UserInterface.CanvasHandler._touchHandler(e); else that._onMouseButtonDown (e); }, false);\r\n\tcanvas.addEventListener(\"pointerup\",       function (e) { if(e.pointerType==\"touch\") SpiderGL.UserInterface.CanvasHandler._touchHandler(e); else that._onMouseButtonUp   (e); }, false);\r\n\tcanvas.addEventListener(\"pointermove\",     function (e) { if(e.pointerType==\"touch\") SpiderGL.UserInterface.CanvasHandler._touchHandler(e); else that._onMouseMove       (e); }, false);\r\n\r\n\tvar standardGLUnpack = SpiderGL.Utility.getDefaultValue(options.standardGLUnpack, SpiderGL.UserInterface.CanvasHandler.DEFAULT_STANDARD_GL_UNPACK);\r\n\tif (standardGLUnpack) {\r\n\t\tSpiderGL.WebGL.Context.setStandardGLUnpack(gl);\r\n\t}\r\n\r\n\tthis.animateRate = SpiderGL.Utility.getDefaultValue(options.animateRate, SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE);\r\n}\r\n\r\nSpiderGL.UserInterface.CanvasHandler._FAST_DRAW_MESSAGE_NAME    = \"spidergl-fast-draw-message\";\r\nSpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME = \"spidergl-fast-animate-message\";\r\n\r\n/**\r\n * Default value for animate rate.\r\n *\r\n * @type number\r\n *\r\n * @default 0\r\n */\r\nSpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE = 0;\r\n\r\n/**\r\n * Default value for ignoring key repeats.\r\n *\r\n * @type bool\r\n *\r\n * @default true\r\n */\r\nSpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT = true;\r\n\r\n/**\r\n * Default value for applying standard OpenGL pixel unpack parameters.\r\n *\r\n * @type bool\r\n *\r\n * @default true\r\n */\r\nSpiderGL.UserInterface.CanvasHandler.DEFAULT_STANDARD_GL_UNPACK = true;\r\n\r\n/**\r\n * Default name of the property to install in the handler object for accessing the canvas handler.\r\n *\r\n * @type string\r\n *\r\n * @default \"ui\"\r\n */\r\nSpiderGL.UserInterface.CanvasHandler.DEFAULT_PROPERTY_NAME = \"ui\";\r\n\r\nSpiderGL.UserInterface.CanvasHandler._multiTouch = { tmp:0, touches:[], evt:null, pan:false, btn:0, phase:0 };\r\nSpiderGL.UserInterface.CanvasHandler._touchHandler = function (event) {\r\n\r\n\tvar touches, first,\r\n\tdiff   = 1,\r\n\tbutton = 0,\r\n\ttype   = \"\";\r\n\r\n\t/**IE PATCH**/\r\n\t/**/if (event.type==\"pointerdown\") SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.push(event);\r\n\t/**/else {\r\n\t/**/\tfor(i=0; i<SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.length; i++) {\r\n\t/**/\t\tif (event.pointerId==SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i].pointerId) SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i] = event;\r\n\t/**/\t}\r\n\t/**/}\r\n\t/**/\r\n\t/**/if (navigator.userAgent.toLowerCase().indexOf('trident')>-1) { touches = SpiderGL.UserInterface.CanvasHandler._multiTouch.touches; first = touches[0]; }\r\n\t/**/else { touches = event.touches; first = event.changedTouches[0]; }\r\n\t/**IE PATCH**/\r\n\r\n\tswitch(event.type)\r\n\t{\r\n\t\tcase \"touchstart\": case \"pointerdown\": type = \"mousedown\"; break;\r\n\t\tcase \"touchmove\":  case \"pointermove\": type = \"mousemove\"; break;\r\n\t\tcase \"touchend\":   case \"pointerup\":   type = \"mouseup\";   break;\r\n\t\tdefault: return;\r\n\t}\r\n\r\n\tvar simulatedEvent = document.createEvent(\"MouseEvent\");\r\n\r\n\tif(touches.length>=2) {\r\n\t\t/**IE PATCH**/\r\n\t\t/**/if (navigator.userAgent.toLowerCase().indexOf('trident')<=-1)\r\n\t\t/**IE PATCH**/\r\n\t\t{\r\n\t\t\tif(touches[0].target.id!=\"draw-canvas\"||touches[1].target.id!=\"draw-canvas\") return;\r\n\t\t}\r\n\r\n\t\tvar dist = Math.sqrt(Math.pow((touches[0].clientX - touches[1].clientX),2)+Math.pow((touches[0].clientY - touches[1].clientY),2));\r\n\t\tvar diff = dist - SpiderGL.UserInterface.CanvasHandler._multiTouch.tmp;\r\n\t\tSpiderGL.UserInterface.CanvasHandler._multiTouch.tmp = dist;\r\n\t\t/**IE PATCH**/\r\n\t\t/**/if(event.type==\"pointerup\") {\r\n\t\t/**/\tbutton = SpiderGL.UserInterface.CanvasHandler._multiTouch.btn;\r\n\t\t/**/\ttype = \"mousedown\";\r\n\t\t/**/}\r\n\t\t/**IE PATCH**/\r\n\t\telse if(/*SpiderGL.UserInterface.CanvasHandler._multiTouch.tmp!=0 &&*/ (diff<-0.995||diff>0.995)) {\r\n\t\t\tdiff>0 ? diff=1 : diff=-1;\r\n\t\t\ttype = \"mousewheel\";\r\n\t\t}\r\n\t\telse return;\r\n\t}\r\n\telse {\r\n\t\t/**IE PATCH**/\r\n\t\t/**/if(event.type==\"pointerup\"||event.type==\"pointermove\") if((!first)||(event.pointerId!=first.pointerId)) return;\r\n\t\t/**IE PATCH**/\r\n\t\tif(SpiderGL.UserInterface.CanvasHandler._multiTouch.tmp!=0&&event.type==\"touchend\") {\r\n\t\t\tbutton = SpiderGL.UserInterface.CanvasHandler._multiTouch.btn;\r\n\t\t\ttype = \"mousedown\";\r\n\t\t}\r\n\t\t//TOUCH PAN START\r\n\t\tif (type==\"mousedown\") {\r\n\t\t\tSpiderGL.UserInterface.CanvasHandler._multiTouch.evt = event;\r\n\t\t}\r\n\t\telse if (type==\"mouseup\") {\r\n\t\t\tif(SpiderGL.UserInterface.CanvasHandler._multiTouch.pan) {\r\n\t\t\t\tbutton = 1;\r\n\t\t\t\tSpiderGL.UserInterface.CanvasHandler._multiTouch.pan   = false;\r\n\t\t\t\tSpiderGL.UserInterface.CanvasHandler._multiTouch.phase = 0;\r\n\t\t\t\t/**FIREFOX PATCH**/\r\n\t\t\t\t/**/if(navigator.userAgent.toLowerCase().indexOf('firefox')>-1) SpiderGL.UserInterface.CanvasHandler._touchHandler(event);\r\n\t\t\t\t/**FIREFOX PATCH**/\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (type==\"mousemove\") {\r\n\t\t\tif(!SpiderGL.UserInterface.CanvasHandler._multiTouch.pan) {\r\n\t\t\t\tvar start;\r\n\t\t\t\t/**IE PATCH**/\r\n\t\t\t\t/**/(navigator.userAgent.toLowerCase().indexOf('trident')>-1) ? (start=SpiderGL.UserInterface.CanvasHandler._multiTouch.evt) : (start=SpiderGL.UserInterface.CanvasHandler._multiTouch.evt.touches[0]);\r\n\t\t\t\t/**IE PATCH**/\r\n\t\t\t\tif((Math.sqrt(Math.pow((first.clientX - start.clientX),2)+Math.pow((first.clientY - start.clientY),2))<=2)&&(event.timeStamp-SpiderGL.UserInterface.CanvasHandler._multiTouch.evt.timeStamp>400)) SpiderGL.UserInterface.CanvasHandler._multiTouch.pan = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tswitch(SpiderGL.UserInterface.CanvasHandler._multiTouch.phase) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tdiff = -1;\r\n\t\t\t\t\t\t/**FIREFOX PATCH**/\r\n\t\t\t\t\t\t/**/(navigator.userAgent.toLowerCase().indexOf('firefox')>-1) ? (type = \"mousemove\") : (type = \"mouseup\");\r\n\t\t\t\t\t\t/**FIREFOX PATCH**/\r\n\t\t\t\t\t\tSpiderGL.UserInterface.CanvasHandler._multiTouch.phase++;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tbutton = 1;\r\n\t\t\t\t\t\ttype = \"mousedown\";\r\n\t\t\t\t\t\tSpiderGL.UserInterface.CanvasHandler._multiTouch.phase++;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tbutton = 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//TOUCH PAN END\r\n\t\tSpiderGL.UserInterface.CanvasHandler._multiTouch.tmp = 0;\r\n\t\tSpiderGL.UserInterface.CanvasHandler._multiTouch.btn = button;\r\n\t}\r\n\r\n\tif(first){\r\n\t\tsimulatedEvent.initMouseEvent(\r\n\t\t\ttype, true, true, window, diff,\r\n\t\t\tfirst.screenX, first.screenY,\r\n\t\t\tfirst.clientX, first.clientY, false,\r\n\t\t\tfalse, false, false, button, null\r\n\t\t);\r\n\t\tfirst.target.dispatchEvent(simulatedEvent);\r\n\t}\r\n\r\n\t/**IE PATCH**/\r\n\t/**/if(event.type==\"pointerup\") {\r\n\t/**/\tfor(i=0; i<SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.length; i++) {\r\n\t/**/\t\tif (SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i].pointerId>=event.pointerId) {\r\n\t/**/\t\t\tif (i+1==SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.length) SpiderGL.UserInterface.CanvasHandler._multiTouch.touches.pop();\r\n\t/**/\t\t\telse SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i] = SpiderGL.UserInterface.CanvasHandler._multiTouch.touches[i+1];\r\n\t/**/\t\t}\r\n\t/**/\t}\r\n\t/**/}\r\n\t/**IE PATCH**/\r\n\r\n\tevent.preventDefault();\r\n\tevent.stopPropagation();\r\n};\r\n\r\nSpiderGL.UserInterface.CanvasHandler.prototype = {\r\n\t_firstNotify : function () {\r\n\t\tthis._onInitialize();\r\n\t\tif (this._animateRate > 0) {\r\n\t\t\tthis._onAnimate();\r\n\t\t}\r\n\t\tthis.postDrawEvent();\r\n\t},\r\n\r\n\t_dispatch : function () {\r\n\t\tvar evt     = arguments[0];\r\n\t\tvar handler = this._handler;\r\n\t\tvar method  = handler[evt];\r\n\t\tif (!method) return;\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\t\tvar r = method.apply(handler, args);\r\n\t\t//if (r === false) return;\r\n\t\t//this._postDrawEvent();\r\n\t},\r\n\r\n\t_postDrawEvent : function () {\r\n\t\tthis._postDrawCount = 5;\r\n\t\tif (this._drawEventPending)\r\n\t\t\treturn;\r\n\r\n\t\tthis._drawEventPending = true;\r\n\t\trequestAnimationFrame(this._delegateDraw);\r\n\t\t//setTimeout(this._drawEventHandler, 0);\r\n\t\t//window.postMessage(SpiderGL.UserInterface.CanvasHandler._FAST_DRAW_MESSAGE_NAME, \"*\");\r\n\t},\r\n\r\n\t_getMouseClientPos : function(e) {\r\n\t\tvar r = this._canvas.getBoundingClientRect();\r\n\t\tvar w = this._canvas.width;\r\n\t\tvar h = this._canvas.height;\r\n\t\tvar x = e.clientX - r.left;\r\n\t\tvar y = h - (e.clientY - r.top);\r\n\t\tvar outside = ((x < 0) || (x >= w) || (y < 0) || (y >= h));\r\n\t\treturn [x, y, outside];\r\n\t},\r\n\r\n\t/*\r\n\t_getTouchClientPos : function(e) {\r\n\t\treturn this._getMouseClientPos(e);\r\n\t},\r\n\t*/\r\n\r\n\t_onInitialize : function () {\r\n\t\tthis._dispatch(\"onInitialize\");\r\n\t},\r\n\r\n\t_onTerminate : function () {\r\n\t\tthis._dispatch(\"onTerminate\");\r\n\t},\r\n\r\n\t_onBlur : function (e) {\r\n\t\tvar gl = this._gl;\r\n\t\tvar ks = this._keysDown;\r\n\t\tfor (var c in ks) {\r\n\t\t\tif (ks[c]) {\r\n\t\t\t\tks[c] = false;\r\n\t\t\t\tthis._dispatch(\"onKeyUp\", c, null);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onKeyDown : function (e) {\r\n\t\tvar c = e.keyCode;\r\n\t\tif(((c>=48) && (c<=90)))\r\n\t\t{\r\n\t\t\tvar s = String.fromCharCode(c);\r\n\t\t\tc = s.toUpperCase();\r\n\t\t}\r\n\r\n\t\tvar wasDown = this._keysDown[c];\r\n\t\tthis._keysDown[c] = true;\r\n\t\tif (!wasDown || !this._ignoreKeyRepeat) {\r\n\t\t\tthis._dispatch(\"onKeyDown\", c, e);\r\n\t\t}\r\n\t},\r\n\r\n\t_onKeyUp : function (e) {\r\n\t\tvar c = e.keyCode;\r\n\t\tif(((c>=48) && (c<=90)))\r\n\t\t{\r\n\t\t\tvar s = String.fromCharCode(c);\r\n\t\t\tc = s.toUpperCase();\r\n\t\t}\r\n\r\n\t\tthis._keysDown[c] = false;\r\n\t\tthis._dispatch(\"onKeyUp\", c, e);\r\n\t},\r\n\r\n\t_onKeyPress : function (e) {\r\n\t\tvar c = e.keyCode;\r\n\t\tif(((c>=48) && (c<=90)))\r\n\t\t{\r\n\t\t\tvar s = String.fromCharCode(c);\r\n\t\t\tc = s.toUpperCase();\r\n\t\t}\r\n\r\n\t\tthis._dispatch(\"onKeyPress\", c, e);\r\n\t},\r\n\r\n\t/*\r\n\t_onTouchStart : function (e) {\r\n\t\te = e.changedTouches[0];\r\n\t\tthis._canvas.focus();\r\n\t\tvar xy  = this._getTouchClientPos(e);\r\n\t\tthis._dispatch(\"onTouchStart\", xy[0], xy[1], e);\r\n\t\te.stopPropagation();\r\n\t},\r\n\r\n\t_onTouchEnd : function (e) {\r\n\t\te = e.changedTouches[0];\r\n\t\tthis._canvas.focus();\r\n\t\tvar xy  = this._getTouchClientPos(e);\r\n\t\tthis._dispatch(\"onTouchEnd\", xy[0], xy[1], e);\r\n\t\te.stopPropagation();\r\n\t},\r\n\r\n\t_onTouchMove : function (e) {\r\n\t\te = e.changedTouches[0];\r\n\t\tthis._canvas.focus();\r\n\t\tvar xy  = this._getTouchClientPos(e);\r\n\t\tthis._dispatch(\"onTouchMove\", xy[0], xy[1], e);\r\n\t\te.stopPropagation();\r\n\t},\r\n\t*/\r\n\r\n\t_onMouseButtonDown : function (e) {\r\n\t\tthis._canvas.focus();\r\n\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tthis._cursorPos = xy;\r\n\r\n\t\tvar btn = e.button;\r\n\t\tthis._mouseButtonsDown[btn] = true;\r\n\t\tthis._dragStartPos[btn] = [xy[0], xy[1]];\r\n\t\tthis._dispatch(\"onMouseButtonDown\", btn, xy[0], xy[1], e);\r\n\r\n\t\te.stopPropagation();\r\n\t},\r\n\r\n\t_onMouseButtonUp : function (e) {\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tthis._cursorPos = xy;\r\n\r\n\t\tvar btn = e.button;\r\n\t\tthis._mouseButtonsDown[btn] = false;\r\n\t\t/**FIREFOX PATCH**/\r\n\t\t/**/if(navigator.userAgent.toLowerCase().indexOf('firefox')>-1) if(!e.isTrusted) return;\r\n\t\t/**FIREFOX PATCH**/\r\n\t\tthis._dispatch(\"onMouseButtonUp\", btn, xy[0], xy[1], e);\r\n\r\n\t\tif (this._dragging[btn]) {\r\n\t\t\tthis._dragging[btn] = false;\r\n\t\t\tvar sPos = this._dragStartPos[btn];\r\n\t\t\tvar ePos = [xy[0], xy[1]];\r\n\t\t\tthis._dragEndPos[btn] = ePos;\r\n\t\t\tthis._dragDeltaPos[btn] = [ePos[0] - sPos[0], ePos[1] - sPos[1]];\r\n\t\t\tthis._dispatch(\"onDragEnd\", btn, ePos[0], ePos[1]);\r\n\t\t}\r\n\r\n\t\te.stopPropagation();\r\n\t},\r\n\r\n\t_onWindowMouseButtonUp : function (e) {\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tthis._cursorPos = xy;\r\n\r\n\t\tvar btn = e.button;\r\n\r\n\t\tif (!this._mouseButtonsDown[btn]) return;\r\n\r\n\t\tthis._mouseButtonsDown[btn] = false;\r\n\t\t/**FIREFOX PATCH**/\r\n\t\t/**/if(navigator.userAgent.toLowerCase().indexOf('firefox')>-1) if(!e.isTrusted) return;\r\n\t\t/**FIREFOX PATCH**/\r\n\t\tthis._dispatch(\"onMouseButtonUp\", btn, xy[0], xy[1], e);\r\n\r\n\t\tif (this._dragging[btn]) {\r\n\t\t\tthis._dragging[btn] = false;\r\n\t\t\tvar sPos = this._dragStartPos[btn];\r\n\t\t\tvar ePos = [xy[0], xy[1]];\r\n\t\t\tthis._dragEndPos[btn] = ePos;\r\n\t\t\tthis._dragDeltaPos[btn] = [ePos[0] - sPos[0], ePos[1] - sPos[1]];\r\n\t\t\tthis._dispatch(\"onDragEnd\", btn, ePos[0], ePos[1]);\r\n\t\t}\r\n\r\n\t\te.stopPropagation();\r\n\t},\r\n\r\n\t_onMouseMove : function (e) {\r\n\t\tthis._cursorPrevPos = this._cursorPos;\r\n\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tthis._cursorPos = xy;\r\n\r\n\t\tthis._cursorDeltaPos = [this._cursorPos[0] - this._cursorPrevPos[0], this._cursorPos[1] - this._cursorPrevPos[1]];\r\n\r\n\t\tfor (var i=0; i<3; ++i) {\r\n\t\t\tif (!this._mouseButtonsDown[i]||(this._cursorDeltaPos[0]==0&&this._cursorDeltaPos[1]==0)) continue;\r\n\t\t\tvar sPos = this._dragStartPos[i];\r\n\t\t\tvar ePos = [xy[0], xy[1]];\r\n\t\t\tthis._dragEndPos[i] = ePos;\r\n\t\t\tthis._dragDeltaPos[i] = [ePos[0] - sPos[0], ePos[1] - sPos[1]];\r\n\t\t\tif (!this._dragging[i]) {\r\n\t\t\t\tthis._dragging[i] = true;\r\n\t\t\t\tthis._dispatch(\"onDragStart\", i, sPos[0], sPos[1]);\r\n\t\t\t}\r\n\t\t\telse this._dispatch(\"onDrag\", i, ePos[0], ePos[1]);\r\n\t\t}\r\n\r\n\t\tthis._dispatch(\"onMouseMove\", xy[0], xy[1], e);\r\n\r\n\t\te.stopPropagation();\r\n\t},\r\n\r\n\t_onWindowMouseMove : function (e) {\r\n\t\tthis._cursorPrevPos = this._cursorPos;\r\n\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tthis._cursorPos = xy;\r\n\r\n\t\tthis._cursorDeltaPos = [this._cursorPos[0] - this._cursorPrevPos[0], this._cursorPos[1] - this._cursorPrevPos[1]];\r\n\r\n\t\tfor (var i=0; i<3; ++i) {\r\n\t\t\tif (!this._dragging[i]) continue;\r\n\t\t\tvar sPos = this._dragStartPos[i];\r\n\t\t\tvar ePos = [xy[0], xy[1]];\r\n\t\t\tthis._dragEndPos[i] = ePos;\r\n\t\t\tthis._dragDeltaPos[i] = [ePos[0] - sPos[0], ePos[1] - sPos[1]];\r\n\t\t\tthis._dispatch(\"onDrag\", i, ePos[0], ePos[1]);\r\n\t\t}\r\n\r\n\t\tif (xy[2]) return;\r\n\t\tthis._dispatch(\"onMouseMove\", xy[0], xy[1], e);\r\n\r\n\t\te.stopPropagation();\r\n\t},\r\n\r\n\t_onMouseWheel : function (e) {\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar delta = 0;\r\n\t\tif (!e) {\r\n\t\t\te = window.event;\r\n\t\t}\r\n\t\tif (e.wheelDelta) {\r\n\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t\tif (window.opera) {\r\n\t\t\t\tdelta = -delta;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (e.detail) {\r\n\t\t\tdelta = -e.detail / 3;\r\n\t\t}\r\n\t\tif (delta) {\r\n\t\t\tthis._dispatch(\"onMouseWheel\", delta, xy[0], xy[1], e);\r\n\t\t}\r\n\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\r\n\t\te.stopPropagation();\r\n\t},\r\n\r\n\t_onMouseOut: function(e) {\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tthis._dispatch(\"onMouseOut\", xy[0], xy[1], e);\r\n\t},\r\n\r\n\t_onClick : function (e) {\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tthis._dispatch(\"onClick\", e.button, xy[0], xy[1], e);\r\n\t},\r\n\r\n\t_onDoubleClick : function (e) {\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tthis._dispatch(\"onDoubleClick\", e.button, xy[0], xy[1], e);\r\n\t},\r\n\r\n\t_onResize : function (e) {\r\n\t\tthis._dispatch(\"onResize\", this._canvas.width, this._canvas.height, e);\r\n\t},\r\n\r\n\t_onAnimate : function () {\r\n\t\tthis._animatePrevTime  = this._animateTime;\r\n\t\tthis._animateTime      = Date.now();\r\n\t\tthis._animateDeltaTime = this._animateTime - this._animatePrevTime;\r\n\t\tthis._dispatch(\"onAnimate\", this._animateDeltaTime / 1000);\r\n\t\tif (this._animateMS >= 0) {\r\n\t\t\tif (this._animateWithTimeout) {\r\n\t\t\t\tsetTimeout(this._animateEventHandler, this._animateMS);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this._fastAnimate) {\r\n\t\t\twindow.postMessage(SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME, \"*\");\r\n\t\t}\r\n\t},\r\n\r\n\t_onDraw : function (timestamp) {\r\n\t\tthis._drawEventPending = false;\r\n\r\n\t\tif(!this._fpsTime || this.postDrawCount == 5) { //new run\r\n\t\t\tthis._fpsCount = 0;\r\n\t\t} else {\r\n\t\t\tthis._fpsCount++;\r\n\t\t\tvar diff = timestamp - this._fpsTime;\r\n\t\t\tthis._fps = 0.8*this._fps + 0.2 *(1000/diff);\r\n\t\t}\r\n\t\tthis._fpsTime = timestamp;\r\n\r\n\t\tthis._dispatch(\"onDraw\");\r\n\t\tif(this._postDrawCount-- > 0) {\r\n\t\t\tthis._drawEventPending = true;\r\n\t\t\trequestAnimationFrame(this._delegateDraw);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the canvas hijacked WebGLRenderingContext.prototype.\r\n\t *\r\n\t * @type WebGLRenderingContext\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget gl() {\r\n\t\treturn this._gl;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the associated canvas.\r\n\t *\r\n\t * @type HTMLCanvasElement\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget canvas() {\r\n\t\treturn this._canvas;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the width of the associated canvas.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget width() {\r\n\t\treturn this._canvas.width;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the height of the associated canvas.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget height() {\r\n\t\treturn this._canvas.height;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets a function that, once called, sends a draw event, which once handled will call the onDraw method of the registered handler.\r\n\t *\r\n\t * @type function\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget postDrawEvent() {\r\n\t\treturn this._postDrawEventFunction;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the time, in seconds, of the current onAnimate event.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget animateTime() {\r\n\t\treturn this._animateTime;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the time, in seconds, of the last onAnimate event.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget animatePrevTime() {\r\n\t\treturn this._animatePrevTime;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the elapsed time, in milliseconds, between the last and the current onAnimate event.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget animateDeltaTime() {\r\n\t\treturn this._animateDeltaTime;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets the frequency (calls per second) used to emit the onAnimate event.\r\n\t * If zero, the onAnimate event will be disabled. If greater than zero, specifies how many times emit the event per second.\r\n\t * If less than zero, the event will be emitted as fast as possible.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @default SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE\r\n\t */\r\n\tget animateRate() {\r\n\t\treturn this._animateRate;\r\n\t},\r\n\r\n\tset animateRate(r) {\r\n\t\tr = SpiderGL.Utility.getDefaultValue(r, SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE);\r\n\t\tif (this._animateRate === r) return;\r\n\r\n\t\tthis._fastAnimate = false;\r\n\t\tthis._animateMS   = -1;\r\n\r\n\t\tthis._animateTime      = Date.now();\r\n\t\tthis._animatePrevTime  = this._animateTime;\r\n\t\tthis._animateDeltaTime = 0;\r\n\r\n\t\tif (this._animateID) {\r\n\t\t\tclearInterval(this._animateID);\r\n\t\t\tthis._animateID = null;\r\n\t\t}\r\n\r\n\t\tthis._animateRate = r;\r\n\r\n\t\tif (r > 0) {\r\n\t\t\tthis._animateMS = SpiderGL.Math.floor(1000 / r);\r\n\t\t\tif (this._animateWithTimeout) {\r\n\t\t\t\tsetTimeout(this._animateEventHandler, this._animateMS);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._animateID = setInterval(this._animateEventHandler, this._animateMS);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (r < 0) {\r\n\t\t\tthis._fastAnimate = true;\r\n\t\t\twindow.postMessage(SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME, \"*\");\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the number of draw events occurred in the last second.\r\n\t *\r\n\t * @type number\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tget framesPerSecond() {\r\n\t\treturn this._fps;\r\n\t},\r\n\r\n\t/**\r\n\t * Gets/Sets if the key repeat must be ignored.\r\n\t *\r\n\t * @type bool\r\n\t *\r\n\t * @default SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT\r\n\t */\r\n\tget ignoreKeyRepeat() {\r\n\t\treturn this._ignoreKeyRepeat;\r\n\t},\r\n\r\n\tset ignoreKeyRepeat(on) {\r\n\t\tthis._ignoreKeyRepeat = SpiderGL.Utility.getDefaultValue(on, SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT);\r\n\t},\r\n\r\n\t/**\r\n\t * Tests if a key is pressed.\r\n\t *\r\n\t * @param {string|number} key The key to test.\r\n\t *\r\n\t * @returns {bool} True if the key is pressed, false otherwise.\r\n\t */\r\n\tisKeyDown : function (key) {\r\n\t\tif (key.toUpperCase) {\r\n\t\t\tkey = key.toUpperCase();\r\n\t\t}\r\n\t\treturn this._keysDown[key];\r\n\t},\r\n\r\n\t/**\r\n\t * Tests if a mouse button is pressed.\r\n\t *\r\n\t * @param {number} btn The button to test (0 = left, 1 = right, 2 = middle).\r\n\t *\r\n\t * @returns {bool} True if the mouse button is pressed, false otherwise.\r\n\t */\r\n\tisMouseButtonDown : function (btn) {\r\n\t\treturn this._mouseButtonsDown[btn];\r\n\t},\r\n\r\n\t/**\r\n\t * Tests if a dragging (mouse move + mouse button down) operation is active.\r\n\t *\r\n\t * @param {number} btn The button to test (0 = left, 1 = right, 2 = middle).\r\n\t *\r\n\t * @returns {bool} True if the dragging operation is active with the specified mouse button, false otherwise.\r\n\t */\r\n\tisDragging : function (btn) {\r\n\t\tvar dragging = false;\r\n\t\tif(btn!==undefined) dragging = this._dragging[btn];\r\n\t\telse {\r\n\t\t\tfor(i=0;i<3;i++) if(this._dragging[i]) return true;\r\n\t\t}\r\n\t\treturn dragging;\r\n//\t\treturn this._dragging[btn];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the cursor x position when dragging has started.\r\n\t *\r\n\t * @param {number} btn The button to test (0 = left, 1 = right, 2 = middle).\r\n\t *\r\n\t * @returns {number} The cursor x position, relative to the canvas lower left corner, when the dragging has started.\r\n\t */\r\n\tdragStartX : function (btn) {\r\n\t\treturn this._dragStartPos[btn][0];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the cursor y position when dragging has started.\r\n\t *\r\n\t * @param {number} btn The button to test (0 = left, 1 = right, 2 = middle).\r\n\t *\r\n\t * @returns {number} The cursor y position, relative to the canvas lower left corner, when the dragging has started.\r\n\t */\r\n\tdragStartY : function (btn) {\r\n\t\treturn this._dragStartPos[btn][1];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the cursor x position when dragging has finished.\r\n\t *\r\n\t * @param {number} btn The button to test (0 = left, 1 = right, 2 = middle).\r\n\t *\r\n\t * @returns {number} The cursor x position, relative to the canvas lower left corner, when the dragging has finished.\r\n\t */\r\n\tdragEndX : function (btn) {\r\n\t\treturn this._dragEndPos[btn][0];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the cursor y position when dragging has finished.\r\n\t *\r\n\t * @param {number} btn The button to test (0 = left, 1 = right, 2 = middle).\r\n\t *\r\n\t * @returns {number} The cursor y position, relative to the canvas lower left corner, when the dragging has finished.\r\n\t */\r\n\tdragEndY : function (btn) {\r\n\t\treturn this._dragEndPos[btn][1];\r\n\t},\r\n\r\n\t/**\r\n\t * If dragging is ongoing, gets the difference between the current cursor x position and the cursor x position at dragging start.\r\n\t *\r\n\t * @param {number} btn The button to test (0 = left, 1 = right, 2 = middle).\r\n\t *\r\n\t * @returns {number} The difference between the current cursor x position and the cursor x position at dragging start.\r\n\t */\r\n\tdragDeltaX : function (btn) {\r\n\t\treturn this._dragDeltaPos[btn][0];\r\n\t},\r\n\r\n\t/**\r\n\t * If dragging is ongoing, gets the difference between the current cursor y position and the cursor x position at dragging start.\r\n\t *\r\n\t * @param {number} btn The button to test (0 = left, 1 = right, 2 = middle).\r\n\t *\r\n\t * @returns {number} The difference between the current cursor y position and the cursor y position at dragging start.\r\n\t */\r\n\tdragDeltaY : function (btn) {\r\n\t\treturn this._dragDeltaPos[btn][1];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the cursor x position, relative to the canvas lower left corner.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget cursorX() {\r\n\t\treturn this._cursorPos[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the cursor y position, relative to the canvas lower left corner.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget cursorY() {\r\n\t\treturn this._cursorPos[1];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the previous cursor x position, relative to the canvas lower left corner.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget cursorPrevX() {\r\n\t\treturn this._cursorPrevPos[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the previous cursor y position, relative to the canvas lower left corner.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget cursorPrevY() {\r\n\t\treturn this._cursorPrevPos[1];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the difference between the current and the previous cursor x position, relative to the canvas lower left corner.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget cursorDeltaX() {\r\n\t\treturn this._cursorDeltaPos[0];\r\n\t},\r\n\r\n\t/**\r\n\t * Gets the difference between the current and the previous cursor y position, relative to the canvas lower left corner.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tget cursorDeltaY() {\r\n\t\treturn this._cursorDeltaPos[1];\r\n\t},\r\n\r\n\t/**\r\n\t * Calls immediately the onDraw event handler.\r\n\t */\r\n\tdraw : function () {\r\n\t\tthis._onDraw();\r\n\t}\r\n};\r\n\r\nSpiderGL.Type.extend(SpiderGL.UserInterface.CanvasHandler, SpiderGL.Core.ObjectBase);\r\n\r\n/**\r\n * Sets up a WebGL context and canvas event handling.\r\n * The WebGLRenderingContext is created and hijacked using {@link SpiderGL.WebGL.Context.getHijacked}.\r\n * A {@link SpiderGL.UserInterface.CanvasHandler} is created to handle the canvas events and dispatch them to the provided handler.\r\n * The canvas handler will be installed in the handler object as a named property.\r\n *\r\n * @param {HTMLCanvasElement|string} canvas The canvas used for rendering and from which event will be received.\r\n * @param {object} handler The event handler.\r\n * @param {function()} [handler.onInitialize] onInitialize event handler.\r\n * @param {function()} [handler.onTerminate] onTerminate event handler.\r\n * @param {function(keyCode, event)} [handler.onKeyUp] onKeyUp event handler.\r\n * @param {function(keyCode, event)} [handler.onKeyDown] onKeyDown event handler.\r\n * @param {function(keyCode, event)} [handler.onKeyPress] onKeyPress event handler.\r\n * @param {function(button, cursorX, cursorY, event)} [handler.onMouseButtonDown] onMouseButtonDown event handler.\r\n * @param {function(button, cursorX, cursorY, event)} [handler.onMouseButtonUp] onMouseButtonUp event handler.\r\n * @param {function(cursorX, cursorY, event)} [handler.onMouseMove] onMouseMove event handler.\r\n * @param {function(wheelDelta, cursorX, cursorY, event)} [handler.onMouseWheel] onMouseWheel event handler.\r\n * @param {function(button, cursorX, cursorY, event)} [handler.onClick] onClick event handler.\r\n * @param {function(button, cursorX, cursorY, event)} [handler.onDoubleClick] onDoubleClick event handler.\r\n * @param {function(button, cursorX, cursorY)} [handler.onDragStart] onDragStart event handler.\r\n * @param {function(button, cursorX, cursorY)} [handler.onDragEnd] onDragEnd event handler.\r\n * @param {function(button, cursorX, cursorY)} [handler.onDrag] onDrag event handler.\r\n * @param {function(canvasWidth, canvasHeight)} [handler.onResize] onResize event handler.\r\n * @param {function(deltaTimeSecs)} [handler.onAnimate] onAnimate event handler.\r\n * @param {function()} [handler.onDraw] onDraw event handler.\r\n * @param {object} options Optional parameters (see {@link SpiderGL.UserInterface.CanvasHandler}).\r\n * @param {string} [options.uiName=SpiderGL.UserInterface.CanvasHandler.DEFAULT_PROPERTY_NAME] The name of the property to install in the handler object for accessing the canvas handler.\r\n *\r\n * @see SpiderGL.UserInterface.handleCanvasOnLoad\r\n * @see SpiderGL.UserInterface.CanvasHandler\r\n */\r\nSpiderGL.UserInterface.handleCanvas = function (canvas, handler, options) {\r\n\tif (!canvas || !handler) return false;\r\n\r\n\toptions = options || { };\r\n\r\n\tvar gl = SpiderGL.WebGL.Context.getHijacked(canvas, options);\r\n\tif (!gl) return false;\r\n\r\n\tvar ui = new SpiderGL.UserInterface.CanvasHandler(gl, handler, options);\r\n\tif (!ui) return false;\r\n\r\n\tvar uiName = SpiderGL.Utility.getDefaultValue(options.uiName, SpiderGL.UserInterface.CanvasHandler.DEFAULT_PROPERTY_NAME);\r\n\thandler[uiName] = ui;\r\n\tui._firstNotify();\r\n\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * Sets up a WebGL context and canvas event handling after window loading.\r\n * When the window fires the onload event, {@link SpiderGL.UserInterface.handleCanvas} is called.\r\n *\r\n * @param {HTMLCanvasElement|string} canvas The canvas used for rendering and from which event will be received.\r\n * @param {object} handler The event handler (see {@link SpiderGL.UserInterface.handleCanvas}).\r\n * @param {object} options Optional parameters (see {@link SpiderGL.UserInterface.handleCanvas}).\r\n *\r\n * @see SpiderGL.UserInterface.handleCanvas\r\n */\r\nSpiderGL.UserInterface.handleCanvasOnLoad = function (canvas, handler, options) {\r\n\tif (!canvas || !handler) return false;\r\n\r\n\toptions = options || { };\r\n\tvar onLoad = SpiderGL.Utility.getDefaultValue(options.onLoad, null);\r\n\r\n\tfunction doHandle() {\r\n\t\tSpiderGL.UserInterface.handleCanvas(canvas, handler, options);\r\n\t\tif (onLoad) { onLoad(); }\r\n\t}\r\n\r\n\twindow.addEventListener(\"load\", doHandle, false);\r\n\treturn true;\r\n}\r\n\r\n","/*\r\n3DHOP - 3D Heritage Online Presenter\r\nCopyright (c) 2014, Marco Callieri - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.\r\n\r\nThis program is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nThis program is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nSpiderGL.openNamespace();\r\n\r\n//----------------------------------------------------------------------------------------\r\n// CONSTANTS\r\n//----------------------------------------------------------------------------------------\r\n// sgltrackball\r\nconst SGL_TRACKBALL_NO_ACTION = 0;\r\nconst SGL_TRACKBALL_ROTATE    = 1;\r\nconst SGL_TRACKBALL_PAN       = 2;\r\nconst SGL_TRACKBALL_DOLLY     = 3;\r\nconst SGL_TRACKBALL_SCALE     = 4;\r\n// selectors\r\nconst HOP_ALL     = 256;\r\n\r\nPresenter = function (canvas) {\r\n\tthis._isDebugging      = false;\r\n\r\n\tthis._lightDirection   = [ 0, 0, -1];\r\n\r\n\tthis._supportsWebGL = sglHandleCanvas(canvas, this);\r\n};\r\n\r\nPresenter.prototype = {\r\n//----------------------------------------------------------------------------------------\r\n// PARSING FUNCTIONS\r\n//----------------------------------------------------------------------------------------\r\n\t_parseScene : function (options) {\r\n\t\toptions = options || { };\r\n\t\tvar r = {\r\n\t\t\tbackground     : this._parseBackground(options.background),\r\n\t\t\tmeshes         : this._parseMeshes(options.meshes),\r\n\t\t\ttexturedQuads  : this._parseTexturedQuads(options.texturedQuads),\r\n\t\t\tmodelInstances : this._parseModelInstances(options.modelInstances),\r\n\t\t\tspots          : this._parseSpots(options.spots),\r\n\t\t\ttrackball      : this._parseTrackball(options.trackball),\r\n\t\t\tspace          : this._parseSpace(options.space)\r\n\t\t};\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseBackground : function (options) {\r\n\t\toptions = options || { };\r\n\t\tvar r = sglGetDefaultObject({\r\n\t\t\timage         : null,\r\n\t\t\tisEnvironment : false,\r\n\t\t\tcolor         : [ 0.0, 0.0, 0.0, 0.0 ]\r\n\t\t}, options);\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseMeshes : function (options) {\r\n\t\tvar r = { };\r\n\t\tfor (var m in options) {\r\n\t\t\tr[m] = this._parseMesh(options[m]);\r\n\t\t}\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseMesh : function (options) {\r\n\t\tvar r = sglGetDefaultObject({\r\n\t\t\turl       : null,\r\n\t\t\ttransform : null\r\n\t\t}, options);\r\n\t\tr.transform = this._parseTransform(r.transform);\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseTexturedQuads : function (options) {\r\n\t\tvar r = { };\r\n\t\tfor (var m in options) {\r\n\t\t\tr[m] = this._parseTexturedQuad(options[m]);\r\n\t\t}\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseTexturedQuad : function (options) {\r\n\t\treturn options;\r\n\t},\r\n\r\n\t_parseModelInstances : function (options) {\r\n\t\tvar r = { };\r\n\t\tfor (var m in options) {\r\n\t\t\tr[m] = this._parseModelInstance(options[m]);\r\n\t\t}\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseModelInstance : function (options) {\r\n\t\tvar r = sglGetDefaultObject({\r\n            mesh            : null,\r\n            color           : [ 1.0, 1.0, 1.0 ],\r\n            useSolidColor   : false,\r\n            alpha           : 0.5,\r\n            useTransparency : false,\r\n\t\t\tcursor          : \"default\",\r\n\t\t\tID              : 0,\r\n            transform       : null,\r\n\t\t\tvisible         : true,\r\n\t\t\ttags            : [ ]\r\n\t\t}, options);\r\n\t\tr.transform = this._parseTransform(r.transform);\r\n\t\tr.ID = this._instancesProgressiveID;\r\n\t\tif (r.color[3]) r.alpha = r.color[3];\r\n\t\tthis._instancesProgressiveID += 1;\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseSpots : function (options) {\r\n\t\tvar r = { };\r\n\t\tfor (var m in options) {\r\n\t\t\tr[m] = this._parseSpot(options[m]);\r\n\t\t}\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseSpot : function (options) {\r\n\t\tvar r = sglGetDefaultObject({\r\n            mesh      : null,\r\n            color     : [ 0.0, 0.25, 1.0 ],\r\n            useSolidColor   : true,\r\n            alpha           : 0.5,\r\n            useTransparency : true,\r\n\t\t\tcursor    : \"pointer\",\r\n\t\t\tID        : 0,\r\n            transform : null,\r\n\t\t\tvisible    : true,\r\n\t\t\ttags      : [ ]\r\n\t\t}, options);\r\n\t\tr.transform = this._parseTransform(r.transform);\r\n\t\tr.ID = this._spotsProgressiveID;\r\n\t\tif (r.color[3]) r.alpha = r.color[3]; //3DHOP 2.0 backward compatibility\r\n\t\tthis._spotsProgressiveID += 1;\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseTrackball : function (options) {\r\n\t\tvar r = sglGetDefaultObject({\r\n\t\t\ttype         : TurnTableTrackball,\r\n\t\t\ttrackOptions : {}\r\n\t\t}, options);\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseSpace : function (options) {\r\n\t\toptions = options || { };\r\n\t\tvar r = sglGetDefaultObject({\r\n\t\t\tcenterMode       : \"first\",\r\n\t\t\tradiusMode       : \"first\",\r\n\t\t\twhichInstanceCenter  : \"\",\r\n\t\t\twhichInstanceRadius  : \"\",\r\n\t\t\texplicitCenter   : [0.0, 0.0, 0.0],\r\n\t\t\texplicitRadius   : 1.0,\r\n            transform        : null,\r\n\t\t\tcameraFOV        : 60.0,\r\n\t\t\tcameraNearFar    : [0.1, 10.0],\r\n\t\t}, options);\r\n\t\tr.transform = this._parseTransform(r.transform);\r\n\t\tif(r.cameraFOV < 2.0) r.cameraFOV=2.0;\r\n\t\tif(r.cameraFOV > 88.0) r.cameraFOV=88.0;\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_parseTransform : function (options) {\r\n\t\tvar r = sglGetDefaultObject({\r\n\t\t\tmatrix : SglMat4.identity()\r\n\t\t}, options);\r\n\t\treturn r;\r\n\t},\r\n\r\n//----------------------------------------------------------------------------------------\r\n//SHADERS RELATED FUNCTIONS\r\n//----------------------------------------------------------------------------------------\r\n// standard program for NXS rendering, points and faces\r\n\t_createStandardPointNXSProgram : function () {\r\n\t\tvar gl = this.ui.gl;\r\n        var nxsVertexShader = new SglVertexShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n            uniform   mat3 uViewSpaceNormalMatrix;                                \\n\\\r\n                                                                                  \\n\\\r\n            attribute vec3 aPosition;                                             \\n\\\r\n            attribute vec3 aNormal;                                               \\n\\\r\n            attribute vec3 aColor;                                                \\n\\\r\n            attribute float aPointSize;                                           \\n\\\r\n                                                                                  \\n\\\r\n            varying   vec3 vNormal;                                               \\n\\\r\n            varying   vec3 vColor;                                                \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                vNormal     = uViewSpaceNormalMatrix * aNormal;                   \\n\\\r\n                vColor      = aColor;                                             \\n\\\r\n                                                                                  \\n\\\r\n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n\t\t\t\tgl_PointSize = 1.5 * aPointSize;\t\t\t\t\t\t\t\t  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS POINT Vertex Shader Log:\\n\" + nxsVertexShader.log);\r\n\r\n        var nxsFragmentShader = new SglFragmentShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   vec3 uViewSpaceLightDirection;                              \\n\\\r\n            uniform   float uAlpha;                                               \\n\\\r\n            uniform   bool uUseSolidColor;                                        \\n\\\r\n            uniform   vec3 uSolidColor;                                           \\n\\\r\n                                                                                  \\n\\\r\n            varying   vec3 vNormal;                                               \\n\\\r\n            varying   vec3 vColor;                                                \\n\\\r\n\t\t\t#extension GL_EXT_frag_depth : enable\t\t\t\t\t\t\t\t  \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n        \t\tfloat a = pow(2.0*(gl_PointCoord.x - 0.5), 2.0);\t\t\t\t  \\n\\\r\n\t\t        float b = pow(2.0*(gl_PointCoord.y - 0.5), 2.0);\t\t\t\t  \\n\\\r\n        \t\tfloat c = 1.0 - (a + b);\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n        \t\tif(c < 0.0) { discard; }\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t\t\t                                                          \\n\\\r\n\t\t\t\tvec3 diffuse;                                                     \\n\\\r\n\t\t\t\tif(uUseSolidColor)                                                \\n\\\r\n                  diffuse = uSolidColor;                                          \\n\\\r\n\t\t\t\telse                                                              \\n\\\r\n                  diffuse = vColor;                                               \\n\\\r\n\t\t\t\tif(vNormal[0] != 0.0 || vNormal[1] != 0.0 || vNormal[2] != 0.0) { \\n\\\r\n  \t\t\t\t  vec3  normal  = normalize(vNormal);                             \\n\\\r\n                  float nDotL   = dot(normal, -uViewSpaceLightDirection);         \\n\\\r\n                  float lambert = max(0.0, nDotL);                                \\n\\\r\n                  diffuse = diffuse * lambert;        \t\t\t\t\t\t      \\n\\\r\n                }                                                                 \\n\\\r\n                gl_FragColor  = vec4(diffuse, uAlpha);                            \\n\\\r\n\t       \t\tgl_FragDepthEXT = gl_FragCoord.z + 0.0001*(1.0-pow(c, 2.0));\t  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS POINT Fragment Shader Log:\\n\" + nxsFragmentShader.log);\r\n\r\n        var program = new SglProgram(gl, {\r\n            shaders    : [\r\n                nxsVertexShader,\r\n                nxsFragmentShader\r\n            ],\r\n            attributes : {\r\n                \"aPosition\" : 0,\r\n                \"aNormal\"   : 1,\r\n                \"aColor\"    : 2,\r\n\t\t\t\t\"aPointSize\": 4\r\n            },\r\n            uniforms   : {\r\n                \"uWorldViewProjectionMatrix\" : SglMat4.identity(),\r\n                \"uViewSpaceNormalMatrix\"     : SglMat3.identity(),\r\n                \"uViewSpaceLightDirection\"   : this._lightDirection,\r\n\t\t\t\t\"uAlpha\"                     : 1.0,\r\n\t\t\t\t\"uUseSolidColor\"             : false,\r\n\t\t\t\t\"uSolidColor\"                : [1.0, 1.0, 1.0],\r\n            }\r\n        });\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS POINT Program Log:\\n\" + program.log);\r\n\r\n\t\treturn program;\r\n\t},\r\n\r\n\t_createStandardNXSProgram : function () {\r\n\t\tvar gl = this.ui.gl;\r\n        var nxsVertexShader = new SglVertexShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n            uniform   mat3 uViewSpaceNormalMatrix;                                \\n\\\r\n                                                                                  \\n\\\r\n            attribute vec3 aPosition;                                             \\n\\\r\n            attribute vec3 aNormal;                                               \\n\\\r\n            attribute vec3 aColor;                                                \\n\\\r\n                                                                                  \\n\\\r\n            varying   vec3 vNormal;                                               \\n\\\r\n            varying   vec3 vColor;                                                \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                vNormal     = uViewSpaceNormalMatrix * aNormal;                   \\n\\\r\n                vColor      = aColor;                                             \\n\\\r\n                                                                                  \\n\\\r\n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS Vertex Shader Log:\\n\" + nxsVertexShader.log);\r\n\r\n        var nxsFragmentShader = new SglFragmentShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   vec3 uViewSpaceLightDirection;                              \\n\\\r\n            uniform   float uAlpha;                                               \\n\\\r\n            uniform   bool uUseSolidColor;                                        \\n\\\r\n            uniform   vec3 uSolidColor;                                           \\n\\\r\n                                                                        \t\t  \\n\\\r\n            varying   vec3 vNormal;                                               \\n\\\r\n            varying   vec3 vColor;                                                \\n\\\r\n\t\t\t#extension GL_EXT_frag_depth : enable\t\t\t\t\t\t\t\t  \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                vec3  normal  = normalize(vNormal);                               \\n\\\r\n                float nDotL   = dot(normal, -uViewSpaceLightDirection);           \\n\\\r\n\t\t\t\t                                                                  \\n\\\r\n\t\t\t\tvec3  diffuse;                                                    \\n\\\r\n\t\t\t\tif(uUseSolidColor)                                                \\n\\\r\n                  diffuse = uSolidColor;                                          \\n\\\r\n\t\t\t\telse                                                              \\n\\\r\n                  diffuse = vColor;                                               \\n\\\r\n                if(gl_FrontFacing)                                                \\n\\\r\n                  diffuse = diffuse * max(0.0, nDotL);                            \\n\\\r\n\t\t\t\telse                                                              \\n\\\r\n                  diffuse = diffuse * vec3(0.4, 0.3, 0.3) * abs(nDotL);           \\n\\\r\n\t\t\t\t                                                                  \\n\\\r\n                gl_FragColor  = vec4(diffuse, uAlpha);                            \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS Fragment Shader Log:\\n\" + nxsFragmentShader.log);\r\n\r\n        var program = new SglProgram(gl, {\r\n            shaders    : [\r\n                nxsVertexShader,\r\n                nxsFragmentShader\r\n            ],\r\n            attributes : {\r\n                \"aPosition\" : 0,\r\n                \"aNormal\"   : 1,\r\n                \"aColor\"    : 2\r\n            },\r\n            uniforms   : {\r\n                \"uWorldViewProjectionMatrix\" : SglMat4.identity(),\r\n                \"uViewSpaceNormalMatrix\"     : SglMat3.identity(),\r\n                \"uViewSpaceLightDirection\"   : this._lightDirection,\r\n\t\t\t\t\"uAlpha\"                     : 1.0,\r\n\t\t\t\t\"uUseSolidColor\"             : false,\r\n\t\t\t\t\"uSolidColor\"                : [1.0, 1.0, 1.0],\r\n            }\r\n        });\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS Program Log:\\n\" + program.log);\r\n\r\n\t\treturn program;\r\n\t},\r\n\r\n\t// Depth to color nexus rendering, point and faces\r\n\t_createXYZPointNXSProgram : function () {\r\n\t\tvar gl = this.ui.gl;\r\n        var nxsVertexShader = new SglVertexShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n                                                                                  \\n\\\r\n            attribute vec3 aPosition;                                             \\n\\\r\n            attribute vec3 aNormal;                                               \\n\\\r\n            attribute vec3 aColor;                                                \\n\\\r\n            attribute float aPointSize;                                           \\n\\\r\n                                                                                  \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n\t\t\t\tgl_PointSize = 1.5 * aPointSize;\t\t\t\t\t\t\t\t  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Vertex Shader Log:\\n\" + nxsVertexShader.log);\r\n\r\n        var nxsFragmentShader = new SglFragmentShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   vec4 uColorID;                                              \\n\\\r\n\t\t\t#extension GL_EXT_frag_depth : enable\t\t\t\t\t\t\t\t  \\n\\\r\n                                                                                  \\n\\\r\n\t\t\tvec4 pack_depth(const in float depth)                                         \\n\\\r\n\t\t\t{                                                                             \\n\\\r\n\t\t\t\tconst vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);  \\n\\\r\n\t\t\t\tconst vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);        \\n\\\r\n\t\t\t\tvec4 res = fract(depth * bit_shift);                                      \\n\\\r\n\t\t\t\tres -= res.xxyz * bit_mask;                                               \\n\\\r\n\t\t\t\treturn res;                                                               \\n\\\r\n\t\t\t}                                                                             \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n        \t\tfloat a = pow(2.0*(gl_PointCoord.x - 0.5), 2.0);\t\t\t\t  \\n\\\r\n\t\t        float b = pow(2.0*(gl_PointCoord.y - 0.5), 2.0);\t\t\t\t  \\n\\\r\n        \t\tfloat c = 1.0 - (a + b);\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n        \t\tif(c < 0.0) { discard; }\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n                vec4 myColor;                                                     \\n\\\r\n\t\t\t\tmyColor = pack_depth(gl_FragCoord.z);                             \\n\\\r\n\t\t\t\tgl_FragColor  = myColor;                                          \\n\\\r\n\t       \t\tgl_FragDepthEXT = gl_FragCoord.z + 0.0001*(1.0-pow(c, 2.0));\t  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS Fragment Shader Log:\\n\" + nxsFragmentShader.log);\r\n\r\n        var program = new SglProgram(gl, {\r\n            shaders    : [\r\n                nxsVertexShader,\r\n                nxsFragmentShader\r\n            ],\r\n            attributes : {\r\n                \"aPosition\" : 0,\r\n                \"aNormal\"   : 1,\r\n                \"aColor\"    : 2,\r\n\t\t\t\t\"aPointSize\": 4\r\n            },\r\n            uniforms   : {\r\n                \"uWorldViewProjectionMatrix\" : SglMat4.identity(),\r\n            }\r\n        });\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS Program Log:\\n\" + program.log);\r\n\r\n\t\treturn program;\r\n\t},\r\n\r\n\t_createXYZNXSProgram : function () {\r\n\t\tvar gl = this.ui.gl;\r\n        var nxsVertexShader = new SglVertexShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n                                                                                  \\n\\\r\n            attribute vec3 aPosition;                                             \\n\\\r\n            attribute vec3 aNormal;                                               \\n\\\r\n            attribute vec3 aColor;                                                \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Vertex Shader Log:\\n\" + nxsVertexShader.log);\r\n\r\n        var nxsFragmentShader = new SglFragmentShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n\t\t\tvec4 pack_depth(const in float depth)                                         \\n\\\r\n\t\t\t{                                                                             \\n\\\r\n\t\t\t\tconst vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);  \\n\\\r\n\t\t\t\tconst vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);        \\n\\\r\n\t\t\t\tvec4 res = fract(depth * bit_shift);                                      \\n\\\r\n\t\t\t\tres -= res.xxyz * bit_mask;                                               \\n\\\r\n\t\t\t\treturn res;                                                               \\n\\\r\n\t\t\t}                                                                             \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                vec4 myColor;                                                     \\n\\\r\n\t\t\t\tmyColor = pack_depth(gl_FragCoord.z);                             \\n\\\r\n\t\t\t\tgl_FragColor  = myColor;                                          \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS Fragment Shader Log:\\n\" + nxsFragmentShader.log);\r\n\r\n        var program = new SglProgram(gl, {\r\n            shaders    : [\r\n                nxsVertexShader,\r\n                nxsFragmentShader\r\n            ],\r\n            attributes : {\r\n                \"aPosition\" : 0,\r\n                \"aNormal\"   : 1,\r\n                \"aColor\"    : 2\r\n            },\r\n            uniforms   : {\r\n                \"uWorldViewProjectionMatrix\" : SglMat4.identity(),\r\n            }\r\n        });\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"NXS Program Log:\\n\" + program.log);\r\n\r\n\t\treturn program;\r\n\t},\r\n\r\n\t// color coded ID program for NXS rendering, points and faces\r\n\t_createColorCodedIDPointNXSProgram : function () {\r\n\t\tvar gl = this.ui.gl;\r\n        var nxsVertexShader = new SglVertexShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n                                                                                  \\n\\\r\n            attribute vec3 aPosition;                                             \\n\\\r\n            attribute vec3 aNormal;                                               \\n\\\r\n            attribute vec3 aColor;                                                \\n\\\r\n            attribute float aPointSize;                                           \\n\\\r\n                                                                                  \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n\t\t\t\tgl_PointSize = 1.5 * aPointSize;\t\t\t\t\t\t\t\t  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Vertex Shader Log:\\n\" + nxsVertexShader.log);\r\n\r\n        var nxsFragmentShader = new SglFragmentShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   vec3 uViewSpaceLightDirection;                              \\n\\\r\n                                                                                  \\n\\\r\n            uniform   vec4 uColorID;                                              \\n\\\r\n\t\t\t#extension GL_EXT_frag_depth : enable\t\t\t\t\t\t\t\t  \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n        \t\tfloat a = pow(2.0*(gl_PointCoord.x - 0.5), 2.0);\t\t\t\t  \\n\\\r\n\t\t        float b = pow(2.0*(gl_PointCoord.y - 0.5), 2.0);\t\t\t\t  \\n\\\r\n        \t\tfloat c = 1.0 - (a + b);\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n        \t\tif(c < 0.0) { discard; }\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n                gl_FragColor  = uColorID;                                         \\n\\\r\n\t       \t\tgl_FragDepthEXT = gl_FragCoord.z + 0.0001*(1.0-pow(c, 2.0));\t  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Fragment Shader Log:\\n\" + nxsFragmentShader.log);\r\n\r\n        var program = new SglProgram(gl, {\r\n            shaders    : [\r\n                nxsVertexShader,\r\n                nxsFragmentShader\r\n            ],\r\n            attributes : {\r\n                \"aPosition\" : 0,\r\n                \"aNormal\"   : 1,\r\n                \"aColor\"    : 2,\r\n\t\t\t\t\"aPointSize\": 4\r\n            },\r\n            uniforms   : {\r\n                \"uWorldViewProjectionMatrix\" : SglMat4.identity(),\r\n\t\t\t\t\"uColorID\"                   : [1.0, 0.5, 0.0, 1.0]\r\n            }\r\n        });\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Program Log:\\n\" + program.log);\r\n\r\n\t\treturn program;\r\n\t},\r\n\r\n\t_createColorCodedIDNXSProgram : function () {\r\n\t\tvar gl = this.ui.gl;\r\n        var nxsVertexShader = new SglVertexShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n                                                                                  \\n\\\r\n            attribute vec3 aPosition;                                             \\n\\\r\n            attribute vec3 aNormal;                                               \\n\\\r\n            attribute vec3 aColor;                                                \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Vertex Shader Log:\\n\" + nxsVertexShader.log);\r\n\r\n        var nxsFragmentShader = new SglFragmentShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   vec4 uColorID;                                              \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                gl_FragColor  = uColorID;                                         \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Fragment Shader Log:\\n\" + nxsFragmentShader.log);\r\n\r\n        var program = new SglProgram(gl, {\r\n            shaders    : [\r\n                nxsVertexShader,\r\n                nxsFragmentShader\r\n            ],\r\n            attributes : {\r\n                \"aPosition\" : 0,\r\n                \"aNormal\"   : 1,\r\n                \"aColor\"    : 2\r\n            },\r\n            uniforms   : {\r\n                \"uWorldViewProjectionMatrix\" : SglMat4.identity(),\r\n\t\t\t\t\"uColorID\"                   : [1.0, 0.5, 0.0, 1.0]\r\n            }\r\n        });\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Program Log:\\n\" + program.log);\r\n\r\n\t\treturn program;\r\n\t},\r\n\r\n\t// single-color barely-shaded program for NXS rendering, points and faces\r\n\t_createColorShadedPointNXSProgram : function () {\r\n\t\tvar gl = this.ui.gl;\r\n        var nxsVertexShader = new SglVertexShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n            uniform   mat3 uViewSpaceNormalMatrix;                                \\n\\\r\n                                                                                  \\n\\\r\n            attribute vec3 aPosition;                                             \\n\\\r\n            attribute vec3 aNormal;                                               \\n\\\r\n            attribute vec3 aColor;                                                \\n\\\r\n            attribute float aPointSize;                                           \\n\\\r\n                                                                                  \\n\\\r\n            varying   vec3 vNormal;                                               \\n\\\r\n            varying   vec3 vColor;                                                \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                vNormal     = uViewSpaceNormalMatrix * aNormal;                   \\n\\\r\n                vColor      = aColor;                                             \\n\\\r\n                                                                                  \\n\\\r\n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n\t\t\t\tgl_PointSize = 1.5 * aPointSize;\t\t\t\t\t\t\t\t  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Vertex Shader Log:\\n\" + nxsVertexShader.log);\r\n\r\n        var nxsFragmentShader = new SglFragmentShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   vec3 uViewSpaceLightDirection;                              \\n\\\r\n            uniform   vec4 uColorID;                                              \\n\\\r\n                                                                                  \\n\\\r\n            varying   vec3 vNormal;                                               \\n\\\r\n            varying   vec3 vColor;                                                \\n\\\r\n\t\t\t#extension GL_EXT_frag_depth : enable\t\t\t\t\t\t\t\t  \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n        \t\tfloat a = pow(2.0*(gl_PointCoord.x - 0.5), 2.0);\t\t\t\t  \\n\\\r\n\t\t        float b = pow(2.0*(gl_PointCoord.y - 0.5), 2.0);\t\t\t\t  \\n\\\r\n        \t\tfloat c = 1.0 - (a + b);\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n        \t\tif(c < 0.0) { discard; }\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t\t\t                                                          \\n\\\r\n\t\t\t\tvec3 diffuse = vec3(uColorID[0], uColorID[1], uColorID[2]);       \\n\\\r\n\t\t\t\tif(vNormal[0] != 0.0 || vNormal[1] != 0.0 || vNormal[2] != 0.0) { \\n\\\r\n  \t\t\t\t  vec3  normal  = normalize(vNormal);                             \\n\\\r\n                  float nDotL   = dot(normal, -uViewSpaceLightDirection);         \\n\\\r\n                  float lambert = max(-nDotL, nDotL);                             \\n\\\r\n                  diffuse = (diffuse*0.5) + (diffuse * lambert * 0.5);            \\n\\\r\n                }                                                                 \\n\\\r\n                gl_FragColor  = vec4(diffuse, uColorID[3]);                       \\n\\\r\n\t       \t\tgl_FragDepthEXT = gl_FragCoord.z + 0.0001*(1.0-pow(c, 2.0));\t  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Fragment Shader Log:\\n\" + nxsFragmentShader.log);\r\n\r\n        var program = new SglProgram(gl, {\r\n            shaders    : [\r\n                nxsVertexShader,\r\n                nxsFragmentShader\r\n            ],\r\n            attributes : {\r\n                \"aPosition\" : 0,\r\n                \"aNormal\"   : 1,\r\n                \"aColor\"    : 2,\r\n\t\t\t\t\"aPointSize\": 4\r\n            },\r\n            uniforms   : {\r\n                \"uWorldViewProjectionMatrix\" : SglMat4.identity(),\r\n                \"uViewSpaceNormalMatrix\"     : SglMat3.identity(),\r\n                \"uViewSpaceLightDirection\"   : this._lightDirection,\r\n\t\t\t\t\"uColorID\"                   : [1.0, 0.5, 0.0, 1.0]\r\n            }\r\n        });\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Program Log:\\n\" + program.log);\r\n\r\n\t\treturn program;\r\n\t},\r\n\r\n\t_createColorShadedNXSProgram : function () {\r\n\t\tvar gl = this.ui.gl;\r\n        var nxsVertexShader = new SglVertexShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n            uniform   mat3 uViewSpaceNormalMatrix;                                \\n\\\r\n                                                                                  \\n\\\r\n            attribute vec3 aPosition;                                             \\n\\\r\n            attribute vec3 aNormal;                                               \\n\\\r\n            attribute vec3 aColor;                                                \\n\\\r\n                                                                                  \\n\\\r\n            varying   vec3 vNormal;                                               \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                vNormal     = uViewSpaceNormalMatrix * aNormal;                   \\n\\\r\n                gl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Vertex Shader Log:\\n\" + nxsVertexShader.log);\r\n\r\n        var nxsFragmentShader = new SglFragmentShader(gl, \"\\\r\n            precision highp float;                                                \\n\\\r\n                                                                                  \\n\\\r\n            uniform   vec3 uViewSpaceLightDirection;                              \\n\\\r\n            uniform   vec4 uColorID;                                              \\n\\\r\n                                                                                  \\n\\\r\n            varying   vec3 vNormal;                                               \\n\\\r\n                                                                                  \\n\\\r\n            void main(void)                                                       \\n\\\r\n            {                                                                     \\n\\\r\n                vec3  normal  = normalize(vNormal);                               \\n\\\r\n                float nDotL   = dot(normal, -uViewSpaceLightDirection);           \\n\\\r\n\t\t\t\tfloat lambert   = max(-nDotL, nDotL);                             \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvec3  baseColor = vec3(uColorID[0], uColorID[1], uColorID[2]);    \\n\\\r\n\t\t\t\tvec3  diffuse   = (baseColor*0.5) + (baseColor * lambert * 0.5);  \\n\\\r\n                                                                                  \\n\\\r\n                gl_FragColor  = vec4(diffuse, uColorID[3]);                       \\n\\\r\n            }                                                                     \\n\\\r\n        \");\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Fragment Shader Log:\\n\" + nxsFragmentShader.log);\r\n\r\n        var program = new SglProgram(gl, {\r\n            shaders    : [\r\n                nxsVertexShader,\r\n                nxsFragmentShader\r\n            ],\r\n            attributes : {\r\n                \"aPosition\" : 0,\r\n                \"aNormal\"   : 1,\r\n                \"aColor\"    : 2\r\n            },\r\n            uniforms   : {\r\n                \"uWorldViewProjectionMatrix\" : SglMat4.identity(),\r\n                \"uViewSpaceNormalMatrix\"     : SglMat3.identity(),\r\n                \"uViewSpaceLightDirection\"   : this._lightDirection,\r\n\t\t\t\t\"uColorID\"                   : [1.0, 0.5, 0.0, 1.0]\r\n            }\r\n        });\r\n\t\tif(this._isDebugging)\r\n\t\t\tconsole.log(\"Program Log:\\n\" + program.log);\r\n\r\n\t\treturn program;\r\n\t},\r\n\r\n\t// standard technique for PLY rendering\r\n\t_createStandardPLYtechnique : function () {\r\n\t\tvar gl = this.ui.gl;\r\n\t\tvar technique = new SglTechnique(gl, {\r\n\t\t\tvertexShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n\t\t\t\tuniform   mat3 uViewSpaceNormalMatrix;                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tattribute vec3 aPosition;                                             \\n\\\r\n\t\t\t\tattribute vec3 aNormal;                                               \\n\\\r\n\t\t\t\tattribute vec3 aColor;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvarying   vec3 vNormal;                                               \\n\\\r\n\t\t\t\tvarying   vec3 vColor;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tvNormal     = uViewSpaceNormalMatrix * aNormal;                   \\n\\\r\n\t\t\t\t\tvColor      = aColor;                                             \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tfragmentShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tuniform   vec3      uViewSpaceLightDirection;                         \\n\\\r\n\t\t\t\tuniform   float     uAlpha;                                           \\n\\\r\n                uniform   bool uUseSolidColor;                                        \\n\\\r\n                uniform   vec3 uSolidColor;                                           \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvarying   vec3 vNormal;                                               \\n\\\r\n\t\t\t\tvarying   vec3 vColor;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tvec3  normal    = normalize(vNormal);                             \\n\\\r\n\t\t\t\t\tfloat nDotL     = dot(normal, -uViewSpaceLightDirection);         \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t\tvec3 diffuse;                                                     \\n\\\r\n\t\t\t\t    if(uUseSolidColor)                                                \\n\\\r\n                      diffuse = uSolidColor;                                          \\n\\\r\n\t\t\t\t    else                                                              \\n\\\r\n                      diffuse = vColor;                                               \\n\\\r\n                    if(gl_FrontFacing)                                                \\n\\\r\n                      diffuse = diffuse * max(0.0, nDotL);                            \\n\\\r\n\t\t\t\t    else                                                              \\n\\\r\n                      diffuse = diffuse * vec3(0.4, 0.3, 0.3) * abs(nDotL);           \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t\tgl_FragColor    = vec4(diffuse, uAlpha);                          \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tvertexStreams : {\r\n\t\t\t\t\"aNormal\" : [ 0.0, 0.0, 1.0, 0.0 ],\r\n\t\t\t\t\"aColor\"  : [ 0.4, 0.4, 0.8, 1.0 ]\r\n\t\t\t},\r\n\t\t\tglobals : {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : { semantic : \"uWorldViewProjectionMatrix\", value : SglMat4.identity() },\r\n\t\t\t\t\"uViewSpaceNormalMatrix\"     : { semantic : \"uViewSpaceNormalMatrix\",     value : SglMat3.identity() },\r\n\t\t\t\t\"uViewSpaceLightDirection\"   : { semantic : \"uViewSpaceLightDirection\",   value : [ 0.0, 0.0, -1.0 ] },\r\n\t\t\t\t\"uAlpha\"                     : { semantic : \"uAlpha\",                     value : 1.0 },\r\n\t\t\t\t\"uUseSolidColor\"             : { semantic : \"uUseSolidColor\",             value : true },\r\n\t\t\t\t\"uSolidColor\"                : { semantic : \"uSolidColor\",                value : [ 1.0, 1.0, 1.0 ] },\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn technique;\r\n\t},\r\n\r\n\t// depth to color technique for PLY rendering\r\n\t_createXYZPLYtechnique : function () {\r\n\t\tvar gl = this.ui.gl;\r\n\t\tvar technique = new SglTechnique(gl, {\r\n\t\t\tvertexShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tattribute vec3 aPosition;                                             \\n\\\r\n\t\t\t\tattribute vec3 aNormal;                                               \\n\\\r\n\t\t\t\tattribute vec3 aColor;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tfragmentShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvec4 pack_depth(const in float depth)                                         \\n\\\r\n\t\t\t\t{                                                                             \\n\\\r\n\t\t\t\t\tconst vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);  \\n\\\r\n\t\t\t\t\tconst vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);        \\n\\\r\n\t\t\t\t\tvec4 res = fract(depth * bit_shift);                                      \\n\\\r\n\t\t\t\t\tres -= res.xxyz * bit_mask;                                               \\n\\\r\n\t\t\t\t\treturn res;                                                               \\n\\\r\n\t\t\t\t}                                                                             \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tvec4 myColor;                                                     \\n\\\r\n\t\t\t\t\tmyColor = pack_depth(gl_FragCoord.z);                             \\n\\\r\n\t\t\t\t\tgl_FragColor  = myColor;                                          \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tvertexStreams : {\r\n\t\t\t\t\"aNormal\" : [ 0.0, 0.0, 1.0, 0.0 ],\r\n\t\t\t\t\"aColor\"  : [ 0.4, 0.4, 0.8, 1.0 ]\r\n\t\t\t},\r\n\t\t\tglobals : {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : { semantic : \"uWorldViewProjectionMatrix\", value : SglMat4.identity() },\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn technique;\r\n\t},\r\n\r\n\t// color coded ID technique for PLY rendering\r\n\t_createColorCodedIDPLYtechnique : function () {\r\n\t\tvar gl = this.ui.gl;\r\n\t\tvar technique = new SglTechnique(gl, {\r\n\t\t\tvertexShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tattribute vec3 aPosition;                                             \\n\\\r\n\t\t\t\tattribute vec3 aNormal;                                               \\n\\\r\n\t\t\t\tattribute vec3 aColor;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tfragmentShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n                uniform   vec4 uColorID;                                              \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tgl_FragColor    = uColorID;                                       \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tvertexStreams : {\r\n\t\t\t\t\"aNormal\" : [ 0.0, 0.0, 1.0, 0.0 ],\r\n\t\t\t\t\"aColor\"  : [ 0.4, 0.4, 0.8, 1.0 ]\r\n\t\t\t},\r\n\t\t\tglobals : {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : { semantic : \"uWorldViewProjectionMatrix\", value : SglMat4.identity() },\r\n\t\t\t\t\"uColorID\"                   : { semantic : \"uColorID\",   value : [1.0, 0.5, 0.25, 1.0] }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn technique;\r\n\t},\r\n\r\n\t// single-color barely-shaded technique for PLY rendering\r\n\t_createColorShadedPLYtechnique : function () {\r\n\t\tvar gl = this.ui.gl;\r\n\t\tvar technique = new SglTechnique(gl, {\r\n\t\t\tvertexShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n\t\t\t\tuniform   mat3 uViewSpaceNormalMatrix;                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tattribute vec3 aPosition;                                             \\n\\\r\n\t\t\t\tattribute vec3 aNormal;                                               \\n\\\r\n\t\t\t\tattribute vec3 aColor;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvarying   vec3 vNormal;                                               \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tvNormal     = uViewSpaceNormalMatrix * aNormal;                   \\n\\\r\n\t\t\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tfragmentShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n                uniform   vec4 uColorID;                                              \\n\\\r\n\t\t\t\tuniform   vec3 uViewSpaceLightDirection;                              \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvarying   vec3 vNormal;                                               \\n\\\r\n\t\t\t\tvarying   vec3 vColor;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tvec3  normal    = normalize(vNormal);                             \\n\\\r\n\t\t\t\t\tfloat nDotL     = dot(normal, -uViewSpaceLightDirection);         \\n\\\r\n\t\t\t\t\tfloat lambert   = max(-nDotL, nDotL);                             \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t\tvec3  baseColor = vec3(uColorID[0], uColorID[1], uColorID[2]);    \\n\\\r\n\t\t\t\t\tvec3  diffuse   = (baseColor*0.5) + (baseColor * lambert * 0.5);  \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t\tgl_FragColor    = vec4(diffuse, uColorID[3]);                     \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tvertexStreams : {\r\n\t\t\t\t\"aNormal\" : [ 0.0, 0.0, 1.0, 0.0 ],\r\n\t\t\t\t\"aColor\"  : [ 0.4, 0.4, 0.8, 1.0 ]\r\n\t\t\t},\r\n\t\t\tglobals : {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : { semantic : \"uWorldViewProjectionMatrix\", value : SglMat4.identity() },\r\n\t\t\t\t\"uViewSpaceNormalMatrix\"     : { semantic : \"uViewSpaceNormalMatrix\",     value : SglMat3.identity() },\r\n\t\t\t\t\"uViewSpaceLightDirection\"   : { semantic : \"uViewSpaceLightDirection\",   value : [ 0.0, 0.0, -1.0 ] },\r\n\t\t\t\t\"uColorID\"                   : { semantic : \"uColorID\",   value : [1.0, 0.5, 0.25, 1.0] }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn technique;\r\n\t},\r\n\r\n\t// 2 points line rendering\r\n\t_createSimpleLinetechnique : function () {\r\n\t\tvar gl = this.ui.gl;\r\n\t\tvar technique = new SglTechnique(gl, {\r\n\t\t\tvertexShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \\n\\\r\n\t\t\t\tuniform vec3 uPointA;                                                 \\n\\\r\n\t\t\t\tuniform vec3 uPointB;                                                 \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tattribute vec3 aPosition;                                             \\n\\\r\n\t\t\t\tattribute vec3 aNormal;                                               \\n\\\r\n\t\t\t\tattribute vec3 aColor;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tvec3 newPos;                                                      \\n\\\r\n\t\t\t\t\tif(aPosition[0]==0.0)                                             \\n\\\r\n\t\t\t\t\t\tnewPos = uPointA;                                             \\n\\\r\n\t\t\t\t\telse                                                              \\n\\\r\n\t\t\t\t\t\tnewPos = uPointB;                                             \\n\\\r\n\t\t\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(newPos, 1.0);     \\n\\\r\n\t\t\t\t\tgl_PointSize = 8.0;\t                 \t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tfragmentShader : \"\\\r\n\t\t\t\tprecision highp float;                                                \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n                uniform   vec4 uLineColor;                                            \\n\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \\n\\\r\n\t\t\t\tvoid main(void)                                                       \\n\\\r\n\t\t\t\t{                                                                     \\n\\\r\n\t\t\t\t\tgl_FragColor    = uLineColor;                                     \\n\\\r\n\t\t\t\t}                                                                     \\n\\\r\n\t\t\t\",\r\n\t\t\tvertexStreams : {\r\n\t\t\t\t\"aNormal\" : [ 0.0, 0.0, 1.0, 0.0 ],\r\n\t\t\t\t\"aColor\"  : [ 1.0, 0.0, 0.0, 1.0 ]\r\n\t\t\t},\r\n\t\t\tglobals : {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : { semantic : \"uWorldViewProjectionMatrix\", value : SglMat4.identity() },\r\n\t\t\t\t\"uLineColor\"                 : { semantic : \"uLineColor\",   value : [0.0, 1.0, 0.5, 1.0] },\r\n\t\t\t\t\"uPointA\"                    : { semantic : \"uPointA\",   value : [0.0, 0.0, 0.0] },\r\n\t\t\t\t\"uPointB\"                    : { semantic : \"uPointB\",   value : [1.0, 1.0, 1.0] },\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn technique;\r\n\t},\r\n\r\n\r\n//----------------------------------------------------------------------------------------\r\n// SUPPORT FUNCTIONS\r\n//----------------------------------------------------------------------------------------\r\n\t_isSceneReady : function () {\r\n\t\tvar r = (this._scene && this._sceneParsed && (this._objectsToLoad == 0));\r\n\t\treturn r;\r\n\t},\r\n\r\n\t_testReady : function () {\r\n\t\tif (this._objectsToLoad != 0) return;\r\n\t\t// Colin Addition\r\n\t\tif(this._onLoadedEvent && this._onLoadedEvent!=\"null\") {\r\n\t\t\tthis._onLoadedEvent();\r\n\t\t}\r\n\t\tthis.trackball.track(SglMat4.identity(), 0.0, 0.0, 0.0);\r\n\t\tthis.ui.postDrawEvent();\r\n\t},\r\n\r\n\t_objectLoaded : function () {\r\n\t\tthis._objectsToLoad--;\r\n\t\tthis._testReady();\r\n\t},\r\n\r\n\t_onMeshReady : function () {\r\n\t\tthis._objectLoaded();\r\n\t},\r\n\r\n\t_onTextureReady : function () {\r\n\t\tthis._objectLoaded();\r\n\t},\r\n\r\n\t_onBackgroundReady : function () {\r\n\t\tthis._objectLoaded();\r\n\t},\r\n\r\n\t_pickingRefresh: function(x,y) {\r\n\t\tthis._pickpoint[0] = x;\r\n\t\tthis._pickpoint[1] = y;\r\n\r\n\t\tvar pickedPixel;\r\n\t\tvar ID, cursor;\r\n\r\n\t\tif(this._onEndMeasurement||this._onPickedSpot||this._onEnterSpot||this._onLeaveSpot){\r\n\t\t\tpickedPixel = this._drawScenePickingSpots();\r\n\t\t\tID = this._Color2ID(pickedPixel);\r\n\t\t\tif(this._lastSpotID != ID){\r\n\t\t\t\tvar spots = this._scene.spots;\r\n\t\t\t\tif(ID != 0){\r\n\t\t\t\t\tfor (var spt in spots) {\r\n\t\t\t\t\t\tif (spots[spt].ID == ID) {\r\n\t\t\t\t\t\t\tthis._pickedSpot = spt;\r\n\t\t\t\t\t\t\tif(this._onHover){\r\n\t\t\t\t\t\t\t\tif(spots[this._lastPickedSpot]) spots[this._lastPickedSpot].alpha -= 0.2;\r\n\t\t\t\t\t\t\t\tspots[this._pickedSpot].alpha += 0.2;\r\n\t\t\t\t\t\t\t\tcursor = spots[spt].cursor;\r\n\t\t\t\t\t\t\t\tif(/*!this._movingLight ||*/ !this._isMeasuring){\r\n\t\t\t\t\t\t\t\t\tthis._lastCursor = document.getElementById(this.ui.canvas.id).style.cursor;\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById(this.ui.canvas.id).style.cursor = cursor;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.ui.postDrawEvent();\r\n\t\t\t\t\t\t\t\tif(this._onLeaveSpot && this._lastPickedSpot!=null)  this._onLeaveSpot(this._lastPickedSpot);\r\n\t\t\t\t\t\t\t\tif(this._onEnterSpot && this._pickedSpot!=null) this._onEnterSpot(this._pickedSpot);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis._lastPickedSpot = spt;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._lastSpotID = ID;\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis._pickedSpot = null;\r\n\t\t\t\t\tif(this._onHover){\r\n\t\t\t\t\t\tif(spots[this._lastPickedSpot]) spots[this._lastPickedSpot].alpha  -= 0.2;\r\n\t\t\t\t\t\tif(/*!this._movingLight || */!this._isMeasuring) document.getElementById(this.ui.canvas.id).style.cursor = \"default\";\r\n\t\t\t\t\t\tthis.ui.postDrawEvent();\r\n\t\t\t\t\t\tif(this._onLeaveSpot && this._lastPickedSpot!=null)  this._onLeaveSpot(this._lastPickedSpot);\r\n\t\t\t\t\t\t//if(this._onEnterSpot) this._onEnterSpot(this._pickedSpot);\r\n\t\t\t\t\t\tthis._lastPickedSpot = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._lastSpotID = ID;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(this._onEndMeasurement||this._onPickedInstance||this._onEnterInstance||this._onLeaveInstance){\r\n\t\t\tpickedPixel = this._drawScenePickingInstances();\r\n\t\t\tID = this._Color2ID(pickedPixel);\r\n\t\t\tif(this._lastInstanceID == ID && !(this._onPickedSpot||this._onEnterSpot||this._onLeaveSpot)) return;\r\n\t\t\tif(ID != 0){\r\n\t\t\t\tvar instances = this._scene.modelInstances;\r\n\t\t\t\tfor (var inst in instances) {\r\n\t\t\t\t\tif (instances[inst].ID == ID) {\r\n\t\t\t\t\t\tthis._pickedInstance = inst;\r\n\t\t\t\t\t\tif(this._onHover){\r\n\t\t\t\t\t\t\tcursor = instances[inst].cursor;\r\n\t\t\t\t\t\t\tif(/*!this._movingLight ||*/ !this._isMeasuring){\r\n\t\t\t\t\t\t\t\tthis._lastCursor = cursor;\r\n\t\t\t\t\t\t\t\tif(this._pickedSpot==null)document.getElementById(this.ui.canvas.id).style.cursor = cursor;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(this._onLeaveInstance && this._lastPickedInstance!=null)  this._onLeaveInstance(this._lastPickedInstance);\r\n\t\t\t\t\t\t\tif(this._onEnterInstance && this._pickedInstance!=null) this._onEnterInstance(this._pickedInstance);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._lastPickedInstance = inst;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis._pickedInstance = null;\r\n\t\t\t\tif(this._onHover){\r\n\t\t\t\t\tthis._lastCursor = \"default\";\r\n\t\t\t\t\tif((/*!this._movingLight || */!this._isMeasuring) && this._pickedSpot==null) document.getElementById(this.ui.canvas.id).style.cursor = \"default\";\r\n\t\t\t\t\tif(this._onLeaveInstance && this._lastPickedInstance!=null)  this._onLeaveInstance(this._lastPickedInstance);\r\n\t\t\t\t\t//if(this._onEnterInstance) this._onEnterInstance(this._pickedInstance);\r\n\t\t\t\t}\r\n\t\t\t\tthis._lastPickedInstance = null;\r\n\t\t\t}\r\n\t\t\tthis._lastInstanceID = ID;\r\n\t\t}\r\n\t},\r\n\r\n\t_measureRefresh : function (button, x, y, e) {\r\n\t\tif(e.target.id!=this.ui.gl.canvas.id) return;\r\n\r\n\t\tif(this._isMeasuring){\r\n\t\t\tthis._pickpoint[0] = x;\r\n\t\t\tthis._pickpoint[1] = y;\r\n\t\t\tvar ppoint = this._drawScenePickingXYZ();\r\n\t\t\tif ((ppoint!=null)&&(this._measurementStage != 2)){\r\n\t\t\t\tthis._pointA = ppoint;\r\n\t\t\t\tthis._measurementStage=2;\r\n\t\t\t\tthis.ui.postDrawEvent();\r\n\t\t\t}\r\n\t\t\telse if ((ppoint!=null)&&(this._measurementStage == 2)){\r\n\t\t\t\tthis._pointB = ppoint;\r\n\t\t\t\tthis.measurement = SglVec3.length(SglVec3.sub(this._pointA, this._pointB));\r\n\t\t\t\tthis._measurementStage=3;\r\n\t\t\t\tthis.ui.postDrawEvent();\r\n\t\t\t\tif(this._onEndMeasurement) this._onEndMeasurement(this.measurement);\r\n\t\t\t}\r\n\t\t}\r\n    },\r\n\r\n\t_startMeasurement  : function () {\r\n\t\tif (this._isMeasuring) return;\r\n\t\tthis._isMeasuring = true;\r\n\t\tthis._measurementStage = 1; // 0=inactive 1=picking pointA 2=picking pointB 3=measurement ready\r\n\t\tthis._pointA = [0.0, 0.0, 0.0];\r\n\t\tthis._pointB = [0.0, 0.0, 0.0];\r\n\t\tthis.measurement = 0.0;\r\n\t\tthis.ui.postDrawEvent();\r\n\t},\r\n\r\n\t_stopMeasurement  : function () {\r\n\t\tthis._isMeasuring = false;\r\n\t\tthis._measurementStage = 0; // 0=inactive 1=picking pointA 2=picking pointB 3=measurement ready\r\n\t\tthis._pointA = [0.0, 0.0, 0.0];\r\n\t\tthis._pointB = [0.0, 0.0, 0.0];\r\n\t\tthis.measurement = 0.0;\r\n\t\tthis.ui.postDrawEvent();\r\n\t},\r\n\r\n//----------------------------------------------------------------------------------------\r\n// DRAWING SUPPORT FUNCTIONS\r\n//----------------------------------------------------------------------------------------\r\n\t_setSceneCenterRadius : function () {\r\n\t\tvar meshes    = this._scene.meshes;\r\n\t\tvar instances = this._scene.modelInstances;\r\n\t\tthis.sceneCenter = [0.0, 0.0, 0.0];\r\n\t\tthis.sceneRadiusInv = 1.0;\r\n\r\n\t\tif(this._scene.space.centerMode == \"explicit\")\r\n\t\t{\r\n\t\t\tthis.sceneCenter = this._scene.space.explicitCenter;\r\n\t\t}\r\n\t\telse if(this._scene.space.centerMode == \"specific\"  && this._scene.space.whichInstanceCenter != \"\")\r\n\t\t{\r\n\t\t\tvar mesh = meshes[instances[this._scene.space.whichInstanceCenter].mesh];\r\n\t\t\tif((mesh)&&(mesh.renderable)){\r\n\t\t\t\tvar instCenter = SglVec3.to4(mesh.renderable.datasetCenter,1);\r\n\r\n\t\t\t\tinstCenter = SglMat4.mul4(mesh.transform.matrix, instCenter);\r\n\t\t\t\tinstCenter = SglMat4.mul4(instances[this._scene.space.whichInstanceCenter].transform.matrix, instCenter);\r\n\r\n\t\t\t\tinstCenter = SglVec4.to3(instCenter);\r\n\r\n\t\t\t\tthis.sceneCenter = instCenter;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(this._scene.space.centerMode == \"scene\")\r\n\t\t{\r\n\t\t\tvar smin = SglVec3.maxNumber();\r\n\t\t\tvar smax = SglVec3.minNumber();\r\n\t\t\tvar imin = [0.0, 0.0, 0.0];\r\n\t\t\tvar imax = [0.0, 0.0, 0.0];\r\n\r\n\t\t\tfor (var inst in instances) {\r\n\t\t\t\tvar mesh = meshes[instances[inst].mesh];\r\n\t\t\t\tif((mesh)&&(mesh.renderable)){\r\n\t\t\t\t\tvar instCenter = SglVec3.to4(mesh.renderable.datasetCenter,1);\r\n\t\t\t\t\tinstCenter = SglMat4.mul4(mesh.transform.matrix, instCenter);\r\n\t\t\t\t\tinstCenter = SglMat4.mul4(instances[inst].transform.matrix, instCenter);\r\n\t\t\t\t\tinstCenter = SglVec4.to3(instCenter);\r\n\r\n\t\t\t\t\tvar radius = mesh.renderable.datasetRadius;\r\n\t\t\t\t\tvar vector111 = SglVec3.one();\r\n\t\t\t\t\tvector111 = SglMat3.mul3(SglMat4.to33(mesh.transform.matrix), vector111);\r\n\t\t\t\t\tvector111 = SglMat3.mul3(SglMat4.to33(instances[inst].transform.matrix), vector111);\r\n\t\t\t\t\tvar scalefactor = SglVec3.length(vector111) / SglVec3.length([1,1,1]);\r\n\t\t\t\t\tradius = radius*scalefactor;\r\n\r\n\t\t\t\t\timin[0] = instCenter[0] - radius;\r\n\t\t\t\t\timin[1] = instCenter[1] - radius;\r\n\t\t\t\t\timin[2] = instCenter[2] - radius;\r\n\t\t\t\t\timax[0] = instCenter[0] + radius;\r\n\t\t\t\t\timax[1] = instCenter[1] + radius;\r\n\t\t\t\t\timax[2] = instCenter[2] + radius;\r\n\r\n\t\t\t\t\tif(imin[0] < smin[0]) smin[0] = imin[0];\r\n\t\t\t\t\tif(imin[1] < smin[1]) smin[1] = imin[1];\r\n\t\t\t\t\tif(imin[2] < smin[2]) smin[2] = imin[2];\r\n\t\t\t\t\tif(imax[0] > smax[0]) smax[0] = imax[0];\r\n\t\t\t\t\tif(imax[1] > smax[1]) smax[1] = imax[1];\r\n\t\t\t\t\tif(imax[2] > smax[2]) smax[2] = imax[2];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.sceneCenter = [ (smax[0] + smin[0])/2.0, (smax[1] + smin[1])/2.0, (smax[2] + smin[2])/2.0 ];\r\n\t\t}\r\n\t\telse //if(this._scene.space.centerMode == \"first\")\r\n\t\t{\r\n\t\t\tfor (var inst in instances) {\r\n\t\t\t\tvar mesh = meshes[instances[inst].mesh];\r\n\t\t\t\tif((mesh)&&(mesh.renderable)){\r\n\t\t\t\t\tvar instCenter = SglVec3.to4(mesh.renderable.datasetCenter,1);\r\n\r\n\t\t\t\t\tinstCenter = SglMat4.mul4(mesh.transform.matrix, instCenter);\r\n\t\t\t\t\tinstCenter = SglMat4.mul4(instances[inst].transform.matrix, instCenter);\r\n\r\n\t\t\t\t\tinstCenter = SglVec4.to3(instCenter);\r\n\r\n\t\t\t\t\tthis.sceneCenter = instCenter;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(this._scene.space.radiusMode == \"explicit\")\r\n\t\t{\r\n\t\t\tthis.sceneRadiusInv = 1.0 / this._scene.space.explicitRadius;\r\n\t\t}\r\n\t\telse if(this._scene.space.radiusMode == \"specific\" && this._scene.space.whichInstanceRadius != \"\")\r\n\t\t{\r\n\t\t\tvar mesh = meshes[instances[this._scene.space.whichInstanceRadius].mesh];\r\n\t\t\tif((mesh)&&(mesh.renderable)){\r\n\t\t\t\tvar radius = mesh.renderable.datasetRadius;\r\n\t\t\t\tvar vector111 = SglVec3.one();\r\n\r\n\t\t\t\tvector111 = SglMat3.mul3(SglMat4.to33(mesh.transform.matrix), vector111);\r\n\t\t\t\tvector111 = SglMat3.mul3(SglMat4.to33(instances[this._scene.space.whichInstanceRadius].transform.matrix), vector111);\r\n\r\n\t\t\t\tvar scalefactor = SglVec3.length(vector111) / SglVec3.length([1,1,1]);\r\n\r\n\t\t\t\tthis.sceneRadiusInv = 1.0 / (radius*scalefactor);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(this._scene.space.radiusMode == \"scene\")\r\n\t\t{\r\n\t\t\tvar smin = SglVec3.maxNumber();\r\n\t\t\tvar smax = SglVec3.minNumber();\r\n\t\t\tvar imin = [0.0, 0.0, 0.0];\r\n\t\t\tvar imax = [0.0, 0.0, 0.0];\r\n\r\n\t\t\tfor (var inst in instances) {\r\n\t\t\t\tvar mesh = meshes[instances[inst].mesh];\r\n\t\t\t\tif((mesh)&&(mesh.renderable)){\r\n\t\t\t\t\tvar instCenter = SglVec3.to4(mesh.renderable.datasetCenter,1);\r\n\t\t\t\t\tinstCenter = SglMat4.mul4(mesh.transform.matrix, instCenter);\r\n\t\t\t\t\tinstCenter = SglMat4.mul4(instances[inst].transform.matrix, instCenter);\r\n\t\t\t\t\tinstCenter = SglVec4.to3(instCenter);\r\n\r\n\t\t\t\t\tvar radius = mesh.renderable.datasetRadius;\r\n\t\t\t\t\tvar vector111 = SglVec3.one();\r\n\t\t\t\t\tvector111 = SglMat3.mul3(SglMat4.to33(mesh.transform.matrix), vector111);\r\n\t\t\t\t\tvector111 = SglMat3.mul3(SglMat4.to33(instances[inst].transform.matrix), vector111);\r\n\t\t\t\t\tvar scalefactor = SglVec3.length(vector111) / SglVec3.length([1,1,1]);\r\n\t\t\t\t\tradius = radius*scalefactor;\r\n\r\n\t\t\t\t\timin[0] = instCenter[0] - radius;\r\n\t\t\t\t\timin[1] = instCenter[1] - radius;\r\n\t\t\t\t\timin[2] = instCenter[2] - radius;\r\n\t\t\t\t\timax[0] = instCenter[0] + radius;\r\n\t\t\t\t\timax[1] = instCenter[1] + radius;\r\n\t\t\t\t\timax[2] = instCenter[2] + radius;\r\n\r\n\t\t\t\t\tif(imin[0] < smin[0]) smin[0] = imin[0];\r\n\t\t\t\t\tif(imin[1] < smin[1]) smin[1] = imin[1];\r\n\t\t\t\t\tif(imin[2] < smin[2]) smin[2] = imin[2];\r\n\t\t\t\t\tif(imax[0] > smax[0]) smax[0] = imax[0];\r\n\t\t\t\t\tif(imax[1] > smax[1]) smax[1] = imax[1];\r\n\t\t\t\t\tif(imax[2] > smax[2]) smax[2] = imax[2];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar scenter = [ (smax[0] + smin[0])/2.0, (smax[1] + smin[1])/2.0, (smax[2] + smin[2])/2.0 ]\r\n\t\t\tthis.sceneRadiusInv = 1.0 / SglVec3.length(SglVec3.sub(smax, scenter));\r\n\t\t}\r\n\t\telse //if(this._scene.space.radiusMode == \"first\")\r\n\t\t{\r\n\t\t\tfor (var inst in instances) {\r\n\t\t\t\tvar mesh = meshes[instances[inst].mesh];\r\n\t\t\t\tif((mesh)&&(mesh.renderable)){\r\n\t\t\t\t\tvar radius = mesh.renderable.datasetRadius;\r\n\t\t\t\t\tvar vector111 = SglVec3.one();\r\n\r\n\t\t\t\t\tvector111 = SglMat3.mul3(SglMat4.to33(mesh.transform.matrix), vector111);\r\n\t\t\t\t\tvector111 = SglMat3.mul3(SglMat4.to33(instances[inst].transform.matrix), vector111);\r\n\r\n\t\t\t\t\tvar scalefactor = SglVec3.length(vector111) / SglVec3.length([1,1,1]);\r\n\r\n\t\t\t\t\tthis.sceneRadiusInv = 1.0 / (radius*scalefactor);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_destroyPickFramebuffer : function () {\r\n\t\tif (this.pickFramebuffer) {\r\n\t\t\tthis.pickFramebuffer.destroy();\r\n\t\t\tthis.pickFramebuffer = null;\r\n\t\t}\r\n\t\tif (this.pickColorTexture) {\r\n\t\t\tthis.pickColorTexture.destroy();\r\n\t\t\tthis.pickColorTexture = null;\r\n\t\t}\r\n\t\tif (this.pickDepthRenderbuffer) {\r\n\t\t\tthis.pickDepthRenderbuffer.destroy();\r\n\t\t\tthis.pickDepthRenderbuffer = null;\r\n\t\t}\r\n\t},\r\n\r\n\t_createPickFramebuffer : function (width, height) {\r\n\t\tif (this.pickFramebuffer && (this.pickFramebuffer.width == width) && (this.pickFramebuffer.height == height))\r\n\t\t\treturn;\r\n\t\telse\r\n\t\t\tthis._destroyPickFramebuffer();\r\n\r\n\t\tvar gl = this.ui.gl;\r\n\r\n\t\tthis.pickColorTexture = new SglTexture2D(gl, {\r\n\t\t\tinternalFormat : gl.RGBA,\r\n\t\t\twidth          : width,\r\n\t\t\theight         : height\r\n\t\t});\r\n\r\n\t\tthis.pickDepthRenderbuffer = new SglRenderbuffer(gl, {\r\n\t\t\tinternalFormat : gl.DEPTH_COMPONENT16,\r\n\t\t\twidth          : width,\r\n\t\t\theight         : height\r\n\t\t});\r\n\r\n\t\tthis.pickFramebuffer = new SglFramebuffer(gl, {\r\n\t\t\tcolor : this.pickColorTexture,\r\n\t\t\tdepth : this.pickDepthRenderbuffer,\r\n\t\t\tautoViewport : true\r\n\t\t});\r\n\t},\r\n\r\n\t_setupDraw : function () {\r\n\t\tvar gl       = this.ui.gl;\r\n\t\tvar width    = this.ui.width;\r\n\t\tvar height   = this.ui.height;\r\n\t\tvar xform    = this.xform;\r\n\t\tvar space    = this._scene.space;\r\n\r\n\t\tgl.viewport(0, 0, width, height);\r\n\r\n\t\t// depending on FOV, we set projection params and camera pos accordingly\r\n\t\tvar FOV   = space.cameraFOV;\r\n\t\tvar nearP = space.cameraNearFar[0];\r\n\t\tvar farP  = space.cameraNearFar[1];\r\n\r\n\t\txform.projection.loadIdentity();\r\n\t\txform.projection.perspective(sglDegToRad(FOV), width/height, nearP, farP);\r\n\r\n\t\txform.view.loadIdentity();\r\n\t\txform.view.lookAt([0.0, 0.0, 0.0], [0.0, 0.0, -1.0], [0.0, 1.0, 0.0]);\r\n\t\tthis.viewMatrix = xform.viewMatrix;\r\n\r\n\t\txform.model.loadIdentity();\r\n\t\txform.model.multiply(this.trackball.matrix);\r\n\r\n\t\t// getting scale/center for scene\r\n\t\tthis._setSceneCenterRadius();\r\n\r\n\t\t// scale to unit box + recenter\r\n\t\txform.model.scale([this.sceneRadiusInv, this.sceneRadiusInv, this.sceneRadiusInv]);\r\n\t\txform.model.translate(SglVec3.neg(this.sceneCenter));\r\n\t},\r\n\r\n\t_ID2Color : function (ID) {\r\n\t\tvar intID = ID | 0;\r\n\r\n\t\tvar IDr = intID % 5;\r\n\t\tvar IDg = ((intID-IDr) / 5) % 5;\r\n\t\tvar IDb = ((((intID-IDr) / 5) - IDg) / 5) % 5;\r\n\r\n\t\tvar colorID = [IDr * 0.2, IDg * 0.2, IDb * 0.2, 1.0];\r\n\t\treturn colorID;\r\n\t},\r\n\r\n\t_Color2ID : function (color) {\r\n\t\tvar IDr =  (((color[0]+2)/255.0) / 0.2)       | 0;\r\n\t\tvar IDg = ((((color[1]+2)/255.0) / 0.2) * 5)  | 0;\r\n\t\tvar IDb = ((((color[2]+2)/255.0) / 0.2) * 25) | 0;\r\n\r\n\t\tvar ID = (IDr + IDg + IDb) | 0;\r\n\t\treturn ID;\r\n\t},\r\n\r\n\t_onPlyLoaded : function (req,thatmesh,gl) {\r\n\t\tvar plyData = req.buffer;\r\n\t\tvar modelDescriptor = importPly(plyData);\r\n\t\tthatmesh.renderable = new SglModel(gl, modelDescriptor);\r\n\t\tthatmesh.renderable.boundingBox = modelDescriptor.extra.boundingBox;\r\n\r\n\t\t// center and radius\r\n\t\tvar TMR = thatmesh.renderable;\r\n\t\tTMR.datasetCenter = [0.0, 0.0, 0.0];\r\n\t\tTMR.datasetRadius = 1.0;\r\n\r\n\t\tTMR.datasetCenter[0] = (TMR.boundingBox.max[0] + TMR.boundingBox.min[0]) / 2.0;\r\n\t\tTMR.datasetCenter[1] = (TMR.boundingBox.max[1] + TMR.boundingBox.min[1]) / 2.0;\r\n\t\tTMR.datasetCenter[2] = (TMR.boundingBox.max[2] + TMR.boundingBox.min[2]) / 2.0;\r\n\r\n\t\tTMR.datasetRadius = Math.sqrt( Math.pow((TMR.boundingBox.max[0] - TMR.boundingBox.min[0]),2) +\r\n\t\t\t\t\t\t\t\t\t   Math.pow((TMR.boundingBox.max[1] - TMR.boundingBox.min[1]),2) +\r\n\t\t\t\t\t\t\t\t\t   Math.pow((TMR.boundingBox.max[2] - TMR.boundingBox.min[2]),2) ) / 2.0;\r\n\r\n\t\tthis._onMeshReady();\r\n\t},\r\n\r\n//----------------------------------------------------------------------------------------\r\n// DRAWING SCENE FUNCTIONS\r\n//----------------------------------------------------------------------------------------\r\n\t_drawScene : function () {\r\n\t\tvar gl       = this.ui.gl;\r\n\t\tvar width    = this.ui.width;\r\n\t\tvar height   = this.ui.height;\r\n\t\tvar xform    = this.xform;\r\n\t\tvar renderer = this.renderer;\r\n\t\tvar CurrProgram   = this.basicNXSProgram;\r\n\t\tvar CurrPointProgram = this.pointNXSProgram;\r\n\t\tvar CurrTechnique = this.basicPLYTechnique;\r\n\t\tvar CCProgram   = this.colorShadedNXSProgram;\r\n\t\tvar CCPointProgram = this.colorShadedPointNXSProgram;\r\n\t\tvar CCTechnique = this.colorShadedPLYtechnique;\r\n\t\tvar lineTechnique = this.simpleLinetechnique;\r\n\t\tvar meshes    = this._scene.meshes;\r\n\t\tvar instances = this._scene.modelInstances;\r\n\t\tvar spots = this._scene.spots;\r\n\t\tvar space = this._scene.space;\r\n\t\tvar bkg = this._scene.background.color;\r\n\r\n\t\t// basic setup, matrices for projection & view\r\n\t\tthis._setupDraw();\r\n\r\n\t\t// clear buffer\r\n\t\tgl.clearColor(bkg[0], bkg[1], bkg[2], bkg[3]);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\r\n\r\n\t\t// draw non-transparent geometries\r\n\t\tfor (var inst in instances) {\r\n\t\t\tvar instance = instances[inst];\r\n\t\t\tvar mesh     = meshes[instance.mesh];\r\n\t\t\tif (!mesh) continue;\r\n\t\t\tvar renderable = mesh.renderable;\r\n\t\t\tif (!renderable) continue;\r\n\t\t\tif (!instance.visible) continue;\r\n\t\t\tif (instance.useTransparency) continue;\r\n\r\n\t\t\t// GLstate setup\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\r\n\t\t\txform.model.push();\r\n\t\t\txform.model.multiply(space.transform.matrix);\r\n\t\t\t// transform using mesh & instance matrices\r\n\t\t\txform.model.multiply(instance.transform.matrix);\r\n\t\t\txform.model.multiply(mesh.transform.matrix);\r\n\r\n\t\t\tvar uniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t\t\"uViewSpaceNormalMatrix\"     : xform.viewSpaceNormalMatrix,\r\n\t\t\t\t\"uViewSpaceLightDirection\"   : this._lightDirection,\r\n\t\t\t\t\"uAlpha\"                     : 1.0,\r\n\t\t\t\t\"uUseSolidColor\"             : instance.useSolidColor,\r\n\t\t\t\t\"uSolidColor\"                : [instance.color[0], instance.color[1], instance.color[2]]\r\n\t\t\t};\r\n\r\n\t\t\tif(mesh.isNexus) {\r\n\t\t\t\tif (!renderable.isReady) continue;\r\n\r\n\t\t\t\tvar nexus = renderable;\r\n\t\t\t\tnexus.modelMatrix      = xform.modelMatrix;\r\n\t\t\t\tnexus.viewMatrix       = xform.viewMatrix;\r\n\t\t\t\tnexus.projectionMatrix = xform.projectionMatrix;\r\n\t\t\t\tnexus.viewport         = [0, 0, width, height];\r\n\t\t\t\tif(nexus._targetFps && this.ui.framesPerSecond) {\r\n\t\t\t\t\tvar newBudget = (nexus._drawBudget * this.ui.framesPerSecond) / nexus._targetFps;\r\n\t\t\t\t\t// logic: increase budget only if we stop rendering because of it\r\n\t\t\t\t\tif(newBudget > nexus._minDrawBudget && (newBudget < nexus._drawBudget || nexus._drawSize > nexus._drawBudget))\r\n\t\t\t\t\t\tnexus._drawBudget = 0.9 * nexus._drawBudget + 0.1*newBudget;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar program;\r\n\t\t\t\tif(nexus._header.signature.face.hasIndex)\r\n\t\t\t\t\tprogram = CurrProgram;\r\n\t\t\t\telse\r\n\t\t\t\t\tprogram = CurrPointProgram;\r\n\t\t\t\tprogram.bind();\r\n\t\t\t\tprogram.setUniforms(uniforms);\r\n\t\t\t\t\tnexus.begin();\r\n\t\t\t\t\tnexus.render();\r\n\t\t\t\t\tnexus.end();\r\n\t\t\t\tprogram.unbind();\r\n\t\t\t}\r\n\t\t\telse { //drawing ply\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\t\trenderer.setTechnique(CurrTechnique);\r\n\t\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\t\trenderer.setPrimitiveMode(\"FILL\");\r\n\t\t\t\t\trenderer.setGlobals(uniforms);\r\n\t\t\t\t\trenderer.setModel(renderable);\r\n\t\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\r\n\t\t\t// GLstate cleanup\r\n\t\t\tgl.disable(gl.DEPTH_TEST);\r\n\r\n\t\t\txform.model.pop();\r\n\t\t}\r\n\r\n\t\t// draw transparent geometries\r\n\t\tfor (var inst in instances) {\r\n\t\t\tvar instance = instances[inst];\r\n\t\t\tvar mesh     = meshes[instance.mesh];\r\n\t\t\tif (!mesh) continue;\r\n\t\t\tvar renderable = mesh.renderable;\r\n\t\t\tif (!renderable) continue;\r\n\t\t\tif (!instance.visible) continue;\r\n\t\t\tif (!instance.useTransparency) continue;\r\n\r\n\t\t\t// GLstate setup\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\t\t\tgl.depthMask(false);\r\n\t\t\tgl.enable(gl.BLEND);\r\n\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n\t\t\txform.model.push();\r\n\t\t\txform.model.multiply(space.transform.matrix);\r\n\t\t\t// transform using mesh & instance matrices\r\n\t\t\txform.model.multiply(instance.transform.matrix);\r\n\t\t\txform.model.multiply(mesh.transform.matrix);\r\n\r\n\t\t\tvar uniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t\t\"uViewSpaceNormalMatrix\"     : xform.viewSpaceNormalMatrix,\r\n\t\t\t\t\"uViewSpaceLightDirection\"   : this._lightDirection,\r\n\t\t\t\t\"uAlpha\"                     : instance.alpha,\r\n\t\t\t\t\"uUseSolidColor\"             : instance.useSolidColor,\r\n\t\t\t\t\"uSolidColor\"                : [instance.color[0], instance.color[1], instance.color[2]]\r\n\t\t\t};\r\n\r\n\t\t\tif(mesh.isNexus) {\r\n\t\t\t\tif (!renderable.isReady) continue;\r\n\r\n\t\t\t\tvar nexus = renderable;\r\n\t\t\t\tnexus.modelMatrix      = xform.modelMatrix;\r\n\t\t\t\tnexus.viewMatrix       = xform.viewMatrix;\r\n\t\t\t\tnexus.projectionMatrix = xform.projectionMatrix;\r\n\t\t\t\tnexus.viewport         = [0, 0, width, height];\r\n\t\t\t\tif(nexus._targetFps && this.ui.framesPerSecond) {\r\n\t\t\t\t\tvar newBudget = (nexus._drawBudget * this.ui.framesPerSecond) / nexus._targetFps;\r\n\t\t\t\t\t// logic: increase budget only if we stop rendering because of it\r\n\t\t\t\t\tif(newBudget > nexus._minDrawBudget && (newBudget < nexus._drawBudget || nexus._drawSize > nexus._drawBudget))\r\n\t\t\t\t\t\tnexus._drawBudget = 0.9 * nexus._drawBudget + 0.1*newBudget;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar program;\r\n\t\t\t\tif(nexus._header.signature.face.hasIndex)\r\n\t\t\t\t\tprogram = CurrProgram;\r\n\t\t\t\telse\r\n\t\t\t\t\tprogram = CurrPointProgram;\r\n\t\t\t\tprogram.bind();\r\n\t\t\t\tprogram.setUniforms(uniforms);\r\n\t\t\t\t\tnexus.begin();\r\n\t\t\t\t\tnexus.render();\r\n\t\t\t\t\tnexus.end();\r\n\t\t\t\tprogram.unbind();\r\n\t\t\t}\r\n\t\t\telse { //drawing ply\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\t\trenderer.setTechnique(CurrTechnique);\r\n\t\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\t\trenderer.setPrimitiveMode(\"FILL\");\r\n\t\t\t\t\trenderer.setGlobals(uniforms);\r\n\t\t\t\t\trenderer.setModel(renderable);\r\n\t\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\r\n\t\t\t// GLstate cleanup\r\n\t\t\tgl.disable(gl.BLEND);\r\n\t\t\tgl.depthMask(true);\r\n\t\t\tgl.disable(gl.DEPTH_TEST);\r\n\r\n\t\t\txform.model.pop();\r\n\t\t}\r\n\r\n\t\t// draw measurement line (if any)\r\n\t\tif (this._measurementStage >= 2) {// 0=inactive 1=picking pointA 2=picking pointB 3=measurement ready\r\n\t\t\t// GLstate setup\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\t\t\tgl.depthFunc(gl.LESS);\r\n\r\n\t\t\txform.model.push();\r\n\r\n\t\t\tvar lineUniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t\t\"uLineColor\"                 : [0.5, 1.0, 0.5, 1.0] ,\r\n\t\t\t\t\"uPointA\"                    : this._pointA,\r\n\t\t\t\t\"uPointB\"                    : (this._measurementStage==2)?this._pointA:this._pointB,\r\n\t\t\t};\r\n\r\n\t\t\t//drawing points and line\r\n\t\t\trenderer.begin();\r\n\t\t\t\trenderer.setTechnique(lineTechnique);\r\n\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\trenderer.setGlobals(lineUniforms);\r\n\t\t\t\trenderer.setPrimitiveMode(\"LINE\");\r\n\t\t\t\trenderer.setModel(this.simpleLineModel);\r\n\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.setPrimitiveMode(\"POINT\");\r\n\t\t\t\trenderer.setModel(this.simpleLineModel);\r\n\t\t\t\trenderer.renderModel();\r\n\t\t\trenderer.end();\r\n\r\n\t\t\tlineUniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t\t\"uLineColor\"                 : [0.2, 0.4, 0.2, 0.5] ,\r\n\t\t\t\t\"uPointA\"                    : this._pointA,\r\n\t\t\t\t\"uPointB\"                    : (this._measurementStage==2)?this._pointA:this._pointB,\r\n\t\t\t};\r\n\r\n\t\t\tgl.depthFunc(gl.GREATER);\r\n\t\t\tgl.depthMask(false);\r\n\t\t\tgl.enable(gl.BLEND);\r\n\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n\t\t\t//drawing points and line\r\n\t\t\trenderer.begin();\r\n\t\t\t\trenderer.setTechnique(lineTechnique);\r\n\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\trenderer.setGlobals(lineUniforms);\r\n\t\t\t\trenderer.setPrimitiveMode(\"LINE\");\r\n\t\t\t\trenderer.setModel(this.simpleLineModel);\r\n\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.setPrimitiveMode(\"POINT\");\r\n\t\t\t\trenderer.setModel(this.simpleLineModel);\r\n\t\t\t\trenderer.renderModel();\r\n\t\t\trenderer.end();\r\n\r\n\t\t\t// GLstate cleanup\r\n\t\t\tgl.disable(gl.BLEND);\r\n\t\t\tgl.depthMask(true);\r\n\t\t\tgl.depthFunc(gl.LESS);\r\n\t\t\tgl.disable(gl.DEPTH_TEST);\r\n\r\n\t\t\txform.model.pop();\r\n\t\t}\r\n\r\n\t\t// draw transparent spot geometries\r\n\t\tfor (var spt in spots) {\r\n\t\t\tvar spot = spots[spt];\r\n\t\t\tvar mesh     = meshes[spot.mesh];\r\n\t\t\tif (!mesh) continue;\r\n\t\t\tvar renderable = mesh.renderable;\r\n\t\t\tif (!renderable) continue;\r\n\t\t\tif (!spot.visible) continue;\r\n\r\n\t\t\t// GLstate setup\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\t\t\tgl.depthMask(false);\r\n\t\t\tgl.enable(gl.BLEND);\r\n\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n\t\t\txform.model.push();\r\n\t\t\txform.model.multiply(space.transform.matrix);\r\n\t\t\t// transform using mesh & instance matrices\r\n\t\t\txform.model.multiply(spot.transform.matrix);\r\n\t\t\txform.model.multiply(mesh.transform.matrix);\r\n\r\n\t\t\tvar uniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t\t\"uViewSpaceNormalMatrix\"     : xform.viewSpaceNormalMatrix,\r\n\t\t\t\t\"uViewSpaceLightDirection\"   : this._lightDirection,\r\n\t\t\t\t\"uColorID\"                   : [spot.color[0], spot.color[1], spot.color[2], spot.alpha]\r\n\t\t\t}\r\n\r\n\t\t\tif(mesh.isNexus) {\r\n\t\t\t\tif (!renderable.isReady) continue;\r\n\t\t\t\tvar nexus = renderable;\r\n\t\t\t\tnexus.modelMatrix      = xform.modelMatrix;\r\n\t\t\t\tnexus.viewMatrix       = xform.viewMatrix;\r\n\t\t\t\tnexus.projectionMatrix = xform.projectionMatrix;\r\n\t\t\t\tnexus.viewport         = [0, 0, width, height];\r\n\r\n\t\t\t\tvar program;\r\n\t\t\t\tif(nexus._header.signature.face.hasIndex)\r\n\t\t\t\t\tprogram = CCProgram;\r\n\t\t\t\telse\r\n\t\t\t\t\tprogram = CCPointProgram;\r\n\t\t\t\tprogram.bind();\r\n\t\t\t\tprogram.setUniforms(uniforms);\r\n\t\t\t\t\tnexus.begin();\r\n\t\t\t\t\tnexus.render();\r\n\t\t\t\t\tnexus.end();\r\n\t\t\t\tprogram.unbind();\r\n\t\t\t}\r\n\t\t\telse { //drawing ply\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\t\trenderer.setTechnique(CCTechnique);\r\n\t\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\t\trenderer.setPrimitiveMode(\"FILL\");\r\n\t\t\t\t\trenderer.setGlobals(uniforms);\r\n\t\t\t\t\trenderer.setModel(renderable);\r\n\t\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\r\n\t\t\t// GLstate cleanup\r\n\t\t\tgl.disable(gl.BLEND);\r\n\t\t\tgl.depthMask(true);\r\n\t\t\tgl.disable(gl.DEPTH_TEST);\r\n\r\n\t\t\txform.model.pop();\r\n\t\t}\r\n\t},\r\n\r\n\t_drawScenePickingXYZ : function () {\r\n\t\tvar gl       = this.ui.gl;\r\n\t\tvar width    = this.ui.width;\r\n\t\tvar height   = this.ui.height;\r\n\t\tvar xform    = this.xform;\r\n\t\tvar renderer = this.renderer;\r\n\t\tvar CurrProgram   = this.colorCodedXYZNXSProgram;\r\n\t\tvar CurrPointProgram = this.colorCodedXYZPointNXSProgram;\r\n\t\tvar CurrTechnique = this.colorCodedXYZPLYtechnique;\r\n\t\tvar meshes    = this._scene.meshes;\r\n\t\tvar instances = this._scene.modelInstances;\r\n\t\tvar space = this._scene.space;\r\n\t\tvar pixel = new Uint8Array(4);\r\n\r\n\t\t// picking FB\r\n\t\tthis._createPickFramebuffer(width, height);\r\n\r\n\t\t// basic setup, matrices for projection & view\r\n\t\tthis._setupDraw();\r\n\r\n\t\t// clear buffer\r\n\t\tthis.pickFramebuffer.bind();\r\n\t\tgl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\r\n\t\tthis.pickFramebuffer.unbind();\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tvar instance = instances[inst];\r\n\t\t\tvar mesh     = meshes[instance.mesh];\r\n\t\t\tif (!mesh) continue;\r\n\t\t\tvar renderable = mesh.renderable;\r\n\t\t\tif (!renderable) continue;\r\n\t\t\tif (!instance.visible) continue;\r\n\r\n\t\t\t// GLstate setup\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\t\t\t// transform using mesh & instance matrices\r\n\t\t\txform.model.push();\r\n\t\t\txform.model.multiply(space.transform.matrix);\r\n\t\t\txform.model.multiply(instance.transform.matrix);\r\n\t\t\txform.model.multiply(mesh.transform.matrix);\r\n\r\n\t\t\tvar uniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t};\r\n\r\n\t\t\tif(mesh.isNexus) {\r\n\t\t\t\tif (!renderable.isReady) continue;\r\n\t\t\t\tvar nexus = renderable;\r\n\t\t\t\tnexus.modelMatrix      = xform.modelMatrix;\r\n\t\t\t\tnexus.viewMatrix       = xform.viewMatrix;\r\n\t\t\t\tnexus.projectionMatrix = xform.projectionMatrix;\r\n\t\t\t\tnexus.viewport         = [0, 0, width, height];\r\n\r\n\t\t\t\tthis.pickFramebuffer.bind();\r\n\r\n\t\t\t\tvar program;\r\n\t\t\t\tif(nexus._header.signature.face.hasIndex)\r\n\t\t\t\t\tprogram = CurrProgram;\r\n\t\t\t\telse\r\n\t\t\t\t\tprogram = CurrPointProgram;\r\n\t\t\t\tprogram.bind();\r\n\t\t\t\tprogram.setUniforms(uniforms);\r\n\t\t\t\t\tnexus.begin();\r\n\t\t\t\t\tnexus.render();\r\n\t\t\t\t\tnexus.end();\r\n\t\t\t\tprogram.unbind();\r\n\r\n\t\t\t\tthis.pickFramebuffer.unbind();\r\n\t\t\t}\r\n\t\t\telse { //drawing ply\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\t\trenderer.setFramebuffer(this.pickFramebuffer);\r\n\t\t\t\t\trenderer.setTechnique(CurrTechnique);\r\n\t\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\t\trenderer.setPrimitiveMode(\"FILL\");\r\n\t\t\t\t\trenderer.setGlobals(uniforms);\r\n\t\t\t\t\trenderer.setModel(renderable);\r\n\t\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\r\n\t\t\t// GLstate cleanup\r\n\t\t\tgl.disable(gl.DEPTH_TEST);\r\n\t\t\t// undo transform\r\n\t\t\txform.model.pop();\r\n\t\t}\r\n\r\n\t\tthis.pickFramebuffer.readPixels(pixel, {\r\n\t\t\tx      : this._pickpoint[0],\r\n\t\t\ty      : this._pickpoint[1],\r\n\t\t\twidth  : 1,\r\n\t\t\theight : 1,\r\n\t\t\tformat : gl.RGBA,\r\n\t\t\ttype   : gl.UNSIGNED_BYTE\r\n\t\t});\r\n\r\n\t\tvar rr = pixel[0] / 255.0;\r\n\t\tvar gg = pixel[1] / 255.0;\r\n\t\tvar bb = pixel[2] / 255.0;\r\n\t\tvar aa = pixel[3] / 255.0;\r\n\t\tvar depth = aa  + ( bb / (256.0)) + ( gg / (256.0*256.0)) + ( rr / (256.0*256.0*256.0));\r\n\r\n\t\tvar ppointc;\r\n\r\n\t\tif((rr==0.0) && (gg==0.0) && (bb==00))\r\n\t\t\treturn(null);\r\n\t\telse\r\n\t\t\tppointc = xform.unproject([this._pickpoint[0]/width,this._pickpoint[1]/height,depth]);\r\n\r\n\t\treturn([ppointc[0], ppointc[1], ppointc[2]]);\r\n\t},\r\n\r\n\t_drawScenePickingInstances : function () {\r\n\t\tvar gl       = this.ui.gl;\r\n\t\tvar width    = this.ui.width;\r\n\t\tvar height   = this.ui.height;\r\n\t\tvar xform    = this.xform;\r\n\t\tvar renderer = this.renderer;\r\n\t\tvar CurrProgram   = this.colorCodedIDNXSProgram;\r\n\t\tvar CurrPointProgram = this.colorCodedIDPointNXSProgram;\r\n\t\tvar CurrTechnique = this.colorCodedIDPLYtechnique;\r\n\t\tvar meshes    = this._scene.meshes;\r\n\t\tvar instances = this._scene.modelInstances;\r\n\t\tvar space = this._scene.space;\r\n\t\tvar pixel = new Uint8Array(4);\r\n\r\n\t\t// picking FB\r\n\t\tthis._createPickFramebuffer(width, height);\r\n\r\n\t\t// basic setup, matrices for projection & view\r\n\t\tthis._setupDraw();\r\n\r\n\t\t// clear buffer\r\n\t\tthis.pickFramebuffer.bind();\r\n\t\tgl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\r\n\t\tthis.pickFramebuffer.unbind();\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tvar instance = instances[inst];\r\n\t\t\tvar mesh     = meshes[instance.mesh];\r\n\t\t\tif (!mesh) continue;\r\n\t\t\tvar renderable = mesh.renderable;\r\n\t\t\tif (!renderable) continue;\r\n\t\t\tif (!instance.visible) continue;\r\n\r\n\t\t\t// GLstate setup\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\t\t\t// transform using mesh & instance matrices\r\n\t\t\txform.model.push();\r\n\t\t\txform.model.multiply(space.transform.matrix);\r\n\t\t\txform.model.multiply(instance.transform.matrix);\r\n\t\t\txform.model.multiply(mesh.transform.matrix);\r\n\r\n\t\t\tvar colorID = this._ID2Color(instance.ID);\r\n\t\t\tvar uniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t\t\"uColorID\"                   : colorID\r\n\t\t\t};\r\n\r\n\t\t\tif(mesh.isNexus) {\r\n\t\t\t\tif (!renderable.isReady) continue;\r\n\t\t\t\tvar nexus = renderable;\r\n\t\t\t\tnexus.modelMatrix      = xform.modelMatrix;\r\n\t\t\t\tnexus.viewMatrix       = xform.viewMatrix;\r\n\t\t\t\tnexus.projectionMatrix = xform.projectionMatrix;\r\n\t\t\t\tnexus.viewport         = [0, 0, width, height];\r\n\r\n\t\t\t\tthis.pickFramebuffer.bind();\r\n\r\n\t\t\t\tvar program;\r\n\t\t\t\tif(nexus._header.signature.face.hasIndex)\r\n\t\t\t\t\tprogram = CurrProgram;\r\n\t\t\t\telse\r\n\t\t\t\t\tprogram = CurrPointProgram;\r\n\t\t\t\tprogram.bind();\r\n\t\t\t\tprogram.setUniforms(uniforms);\r\n\t\t\t\t\tnexus.begin();\r\n\t\t\t\t\tnexus.render();\r\n\t\t\t\t\tnexus.end();\r\n\t\t\t\tprogram.unbind();\r\n\r\n\t\t\t\tthis.pickFramebuffer.unbind();\r\n\t\t\t}\r\n\t\t\telse { //drawing ply\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\t\trenderer.setFramebuffer(this.pickFramebuffer);\r\n\t\t\t\t\trenderer.setTechnique(CurrTechnique);\r\n\t\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\t\trenderer.setPrimitiveMode(\"FILL\");\r\n\t\t\t\t\trenderer.setGlobals(uniforms);\r\n\t\t\t\t\trenderer.setModel(renderable);\r\n\t\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\r\n\t\t\t// GLstate cleanup\r\n\t\t\tgl.disable(gl.DEPTH_TEST);\r\n\t\t\t// undo transform\r\n\t\t\txform.model.pop();\r\n\t\t}\r\n\r\n\t\tthis.pickFramebuffer.readPixels(pixel, {\r\n\t\t\tx      : this._pickpoint[0],\r\n\t\t\ty      : this._pickpoint[1],\r\n\t\t\twidth  : 1,\r\n\t\t\theight : 1,\r\n\t\t\tformat : gl.RGBA,\r\n\t\t\ttype   : gl.UNSIGNED_BYTE\r\n\t\t});\r\n\r\n\t\treturn pixel;\r\n\t},\r\n\r\n\t_drawScenePickingSpots : function () {\r\n\t\tvar gl       = this.ui.gl;\r\n\t\tvar width    = this.ui.width;\r\n\t\tvar height   = this.ui.height;\r\n\t\tvar xform    = this.xform;\r\n\t\tvar renderer = this.renderer;\r\n\t\tvar CurrProgram   = this.colorCodedIDNXSProgram;\r\n\t\tvar CurrPointProgram = this.colorCodedIDPointNXSProgram;\r\n\t\tvar CurrTechnique = this.colorCodedIDPLYtechnique;\r\n\t\tvar meshes    = this._scene.meshes;\r\n\t\tvar spots = this._scene.spots;\r\n\t\tvar instances = this._scene.modelInstances;\r\n\t\tvar space = this._scene.space;\r\n\t\tvar pixel = new Uint8Array(4);\r\n\r\n\t\t// picking FB\r\n\t\tthis._createPickFramebuffer(width, height);\r\n\r\n\t\t// basic setup, matrices for projection & view\r\n\t\tthis._setupDraw();\r\n\r\n\t\t// clear buffer\r\n\t\tthis.pickFramebuffer.bind();\r\n\t\tgl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\r\n\t\tthis.pickFramebuffer.unbind();\r\n\r\n\t\t// first pass, draw invisible instances, for occlusion\r\n\t\tfor (var inst in instances) {\r\n\t\t\tvar instance = instances[inst];\r\n\t\t\tvar mesh     = meshes[instance.mesh];\r\n\t\t\tif (!mesh) continue;\r\n\t\t\tvar renderable = mesh.renderable;\r\n\t\t\tif (!renderable) continue;\r\n\t\t\tif (!instance.visible) continue;\r\n\r\n\t\t\t// GLstate setup\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\t\t\t// transform using mesh & instance matrices\r\n\t\t\txform.model.push();\r\n\t\t\txform.model.multiply(space.transform.matrix);\r\n\t\t\txform.model.multiply(instance.transform.matrix);\r\n\t\t\txform.model.multiply(mesh.transform.matrix);\r\n\r\n\t\t\tvar uniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t\t\"uColorID\"                   : [0.0, 0.0, 0.0, 0.0]\r\n\t\t\t};\r\n\r\n\t\t\tif(mesh.isNexus) {\r\n\t\t\t\tif (!renderable.isReady) continue;\r\n\t\t\t\tvar nexus = renderable;\r\n\t\t\t\tnexus.modelMatrix      = xform.modelMatrix;\r\n\t\t\t\tnexus.viewMatrix       = xform.viewMatrix;\r\n\t\t\t\tnexus.projectionMatrix = xform.projectionMatrix;\r\n\t\t\t\tnexus.viewport         = [0, 0, width, height];\r\n\r\n\t\t\t\tthis.pickFramebuffer.bind();\r\n\r\n\t\t\t\tvar program;\r\n\t\t\t\tif(nexus._header.signature.face.hasIndex)\r\n\t\t\t\t\tprogram = CurrProgram;\r\n\t\t\t\telse\r\n\t\t\t\t\tprogram = CurrPointProgram;\r\n\t\t\t\tprogram.bind();\r\n\t\t\t\tprogram.setUniforms(uniforms);\r\n\t\t\t\t\tnexus.begin();\r\n\t\t\t\t\tnexus.render();\r\n\t\t\t\t\tnexus.end();\r\n\t\t\t\tprogram.unbind();\r\n\r\n\t\t\t\tthis.pickFramebuffer.unbind();\r\n\t\t\t}\r\n\t\t\telse { //drawing ply\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\t\trenderer.setFramebuffer(this.pickFramebuffer);\r\n\t\t\t\t\trenderer.setTechnique(CurrTechnique);\r\n\t\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\t\trenderer.setPrimitiveMode(\"FILL\");\r\n\t\t\t\t\trenderer.setGlobals(uniforms);\r\n\t\t\t\t\trenderer.setModel(renderable);\r\n\t\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\r\n\t\t\t// GLstate cleanup\r\n\t\t\tgl.disable(gl.DEPTH_TEST);\r\n\t\t\t// undo transform\r\n\t\t\txform.model.pop();\r\n\t\t}\r\n\r\n\t\t// second pass, draw color coded spots, for picking\r\n\t\tfor (var spt in spots) {\r\n\t\t\tvar spot = spots[spt];\r\n\t\t\tvar mesh     = meshes[spot.mesh];\r\n\t\t\tif (!mesh) continue;\r\n\t\t\tvar renderable = mesh.renderable;\r\n\t\t\tif (!renderable) continue;\r\n\t\t\tif (!spot.visible) continue;\r\n\r\n\t\t\t// GLstate setup\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\t\t\t// transform using mesh & instance matrices\r\n\t\t\txform.model.push();\r\n\t\t\txform.model.multiply(space.transform.matrix);\r\n\t\t\txform.model.multiply(spot.transform.matrix);\r\n\t\t\txform.model.multiply(mesh.transform.matrix);\r\n\r\n\t\t\tvar colorID = this._ID2Color(spot.ID);\r\n\t\t\tvar uniforms = {\r\n\t\t\t\t\"uWorldViewProjectionMatrix\" : xform.modelViewProjectionMatrix,\r\n\t\t\t\t\"uColorID\"                   : colorID\r\n\t\t\t};\r\n\r\n\t\t\tif(mesh.isNexus) {\r\n\t\t\t\tif (!renderable.isReady) continue;\r\n\t\t\t\tvar nexus = renderable;\r\n\t\t\t\tnexus.modelMatrix      = xform.modelMatrix;\r\n\t\t\t\tnexus.viewMatrix       = xform.viewMatrix;\r\n\t\t\t\tnexus.projectionMatrix = xform.projectionMatrix;\r\n\t\t\t\tnexus.viewport         = [0, 0, width, height];\r\n\r\n\t\t\t\tthis.pickFramebuffer.bind();\r\n\r\n\t\t\t\tvar program;\r\n\t\t\t\tif(nexus._header.signature.face.hasIndex)\r\n\t\t\t\t\tprogram = CurrProgram;\r\n\t\t\t\telse\r\n\t\t\t\t\tprogram = CurrPointProgram;\r\n\t\t\t\tprogram.bind();\r\n\t\t\t\tprogram.setUniforms(uniforms);\r\n\t\t\t\t\tnexus.begin();\r\n\t\t\t\t\tnexus.render();\r\n\t\t\t\t\tnexus.end();\r\n\t\t\t\tprogram.unbind();\r\n\r\n\t\t\t\tthis.pickFramebuffer.unbind();\r\n\t\t\t}\r\n\t\t\telse { //drawing ply\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\t\trenderer.setFramebuffer(this.pickFramebuffer);\r\n\t\t\t\t\trenderer.setTechnique(CurrTechnique);\r\n\t\t\t\t\trenderer.setDefaultGlobals();\r\n\t\t\t\t\trenderer.setPrimitiveMode(\"FILL\");\r\n\t\t\t\t\trenderer.setGlobals(uniforms);\r\n\t\t\t\t\trenderer.setModel(renderable);\r\n\t\t\t\t\trenderer.renderModel();\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\r\n\t\t\t// GLstate cleanup\r\n\t\t\tgl.disable(gl.DEPTH_TEST);\r\n\t\t\t// undo transform\r\n\t\t\txform.model.pop();\r\n\t\t}\r\n\r\n\t\tthis.pickFramebuffer.readPixels(pixel, {\r\n\t\t\tx      : this._pickpoint[0],\r\n\t\t\ty      : this._pickpoint[1],\r\n\t\t\twidth  : 1,\r\n\t\t\theight : 1,\r\n\t\t\tformat : gl.RGBA,\r\n\t\t\ttype   : gl.UNSIGNED_BYTE\r\n\t\t});\r\n\r\n\t\treturn pixel;\r\n\t},\r\n\r\n\t_drawNull : function () {\r\n\t\tvar gl = this.ui.gl;\r\n\t\tgl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\r\n\t},\r\n\r\n\t// creates simple 2-point line model\r\n\t_createLineModel : function () {\r\n\r\n\t\tvar gl = this.ui.gl;\r\n\t\tthis.simpleLineModel = new SglModel(gl, {\r\n\t\t\t\t\tvertices : {\r\n\t\t\t\t\t\tposition : [ 0,0,0,\r\n\t\t\t\t\t\t             1,1,1 ],\r\n\t\t\t\t\t\tnormal : [ 0,0,0,\r\n\t\t\t\t\t\t           0,0,0 ],\r\n\t\t\t\t\t\tcolor : {value : [ 1.0, 0.0, 0.0 ]}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tprimitives : [\"lines\",\"points\"]\r\n\t\t\t\t});\r\n\t},\r\n\r\n//----------------------------------------------------------------------------------------\r\n// EVENTS HANDLERS\r\n//----------------------------------------------------------------------------------------\r\n\tonInitialize : function () {\r\n\t\tvar gl = this.ui.gl;\r\n\r\n\t\tgl.getExtension('EXT_frag_depth');\r\n\t\tgl.clearColor(0.5, 0.5, 0.5, 1.0);\r\n\r\n\t\tvar xform = new SglTransformationStack();\r\n\t\tvar renderer = new SglModelRenderer(gl);\r\n\t\tvar viewMatrix = SglMat4.identity();\r\n\r\n\t\t// shaders\r\n\t\tthis.basicNXSProgram = this._createStandardNXSProgram();\r\n\t\tthis.pointNXSProgram = this._createStandardPointNXSProgram();\r\n\t\tthis.colorCodedIDNXSProgram = this._createColorCodedIDNXSProgram();\r\n\t\tthis.colorCodedIDPointNXSProgram = this._createColorCodedIDPointNXSProgram();\r\n\t\tthis.colorCodedXYZNXSProgram = this._createXYZNXSProgram();\r\n\t\tthis.colorCodedXYZPointNXSProgram = this._createXYZPointNXSProgram();\r\n\r\n\t\tthis.basicPLYTechnique  = this._createStandardPLYtechnique();\r\n\t\tthis.colorCodedIDPLYtechnique  = this._createColorCodedIDPLYtechnique();\r\n\t\tthis.colorCodedXYZPLYtechnique  = this._createXYZPLYtechnique();\r\n\r\n\t\tthis.colorShadedNXSProgram = this._createColorShadedNXSProgram();\r\n\t\tthis.colorShadedPointNXSProgram = this._createColorShadedPointNXSProgram();\r\n\t\tthis.colorShadedPLYtechnique = this._createColorShadedPLYtechnique();\r\n\r\n\t\tthis.simpleLinetechnique = this._createSimpleLinetechnique();\r\n\r\n\t\t// scene rendering support data\r\n\t\tthis.renderer   = renderer;\r\n\t\tthis.xform      = xform;\r\n\t\tthis.viewMatrix = viewMatrix;\r\n\r\n\t\tthis.sceneCenter = [0.0, 0.0, 0.0];\r\n\t\tthis.sceneRadiusInv = 1.0;\r\n\r\n\t\tthis.ui.animateRate = 0;\r\n\r\n\t\tthis.diff\t\t= 0.0;\r\n\t\tthis.x \t\t\t= 0.0;\r\n\t\tthis.y \t\t\t= 0.0;\r\n\t\tthis.dstartx\t= 0.0;\r\n\t\tthis.dstarty\t= 0.0;\r\n\t\tthis.dendx\t\t= 0.0;\r\n\t\tthis.dendy\t\t= 0.0;\r\n\r\n\t\tthis.ax1 \t\t= 0.0;\r\n\t\tthis.ay1 \t\t= 0.0;\r\n\r\n\t\t// scene others support data\r\n\t\tthis._scene       = null;\r\n\t\tthis._sceneParsed = false;\r\n\r\n\t\tthis._objectsToLoad      = 0;\r\n\t\tthis._targetInstanceName = null;\r\n\t\tthis._targetHotSpotName  = null;\r\n\r\n\t\tthis._instancesProgressiveID = 1;\r\n\t\tthis._spotsProgressiveID     = 1;\r\n\r\n\t\tthis._animating      = false;\r\n\t\tthis._movingLight    = false;\r\n\r\n\t\tthis._clickable      = false;\r\n\t\tthis._onHover        = false;\r\n\r\n\t\tthis._lastCursor     = \"default\";\r\n\t\tthis._pickedInstance = null;\r\n\t\tthis._pickedSpot     = null;\r\n\t\tthis._lastPickedInstance = null;\r\n\t\tthis._lastPickedSpot     = null;\r\n\t\tthis._lastInstanceID = 0;\r\n\t\tthis._lastSpotID     = 0;\r\n\t\tthis._pickpoint      = [10, 10];\r\n\r\n\t\t// point2point measurement data\r\n\t\tthis._isMeasuring = false;\r\n\t\tthis._measurementStage = 0; // 0=inactive 1=picking pointA 2=picking pointB 3=measurement ready\r\n\t\tthis._pointA = [0.0, 0.0, 0.0];\r\n\t\tthis._pointB = [0.0, 0.0, 0.0];\r\n\t\tthis.measurement = 0;\r\n\r\n\t\t// handlers\r\n\t\tthis._onPickedInstance = 0;\r\n\t\tthis._onPickedSpot     = 0;\r\n\t\tthis._onEnterInstance  = 0;\r\n\t\tthis._onEnterSpot      = 0;\r\n\t\tthis._onLeaveInstance  = 0;\r\n\t\tthis._onLeaveSpot      = 0;\r\n\t\tthis._onEndMeasurement = 0;\r\n\t},\r\n\r\n\tonDrag : function (button, x, y, e) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tthis.ax1 = (x / (ui.width  - 1)) * 2.0 - 1.0;\r\n\t\tthis.ay1 = (y / (ui.height - 1)) * 2.0 - 1.0;\r\n\r\n\t\tif(this._movingLight && ui.isMouseButtonDown(0))  {\r\n\t\t\tthis.rotateLight(this.ax1/2, this.ay1/2);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(this.dstartx == ui.dragStartX(button)){\r\n\t\t\tthis.diff = ui.dragEndX(button)- this.dendx;\r\n\t\t\tif(ui.dragDeltaX(button) != 0) this.x += (this.diff/500);\r\n\t\t}\r\n\r\n\t\tif(this.dstarty == ui.dragStartY(button)){\r\n\t\t\tthis.diff = ui.dragEndY(button)- this.dendy;\r\n\t\t\tif(ui.dragDeltaY(button) != 0) this.y += (this.diff/500);\r\n\t\t}\r\n\r\n\t\tvar action = SGL_TRACKBALL_NO_ACTION;\r\n\t\tif ((ui.isMouseButtonDown(0) && ui.isKeyDown(17)) || ui.isMouseButtonDown(1)) {\r\n\t\t\taction = SGL_TRACKBALL_PAN;\r\n\t\t}\r\n\t\telse if (ui.isMouseButtonDown(0)) {\r\n\t\t\taction = SGL_TRACKBALL_ROTATE;\r\n\t\t}\r\n\r\n\t\tvar testMatrix = this.trackball._matrix.slice();\r\n\r\n\t\tthis.trackball.action = action;\r\n\t\tthis.trackball.track(this.viewMatrix, this.x, this.y, 0.0);\r\n\r\n\t\tvar diff;\r\n\t\tfor(var i=0; i<testMatrix.length; i++) {\r\n\t\t\tif(testMatrix[i]!=this.trackball._matrix[i]) {diff=true; break;}\r\n\t\t}\r\n\t\tif(diff) ui.postDrawEvent();\r\n\r\n\t\tthis.dstartx = ui.dragStartX(button);\r\n\t\tthis.dstarty = ui.dragStartY(button);\r\n\t\tthis.dendx = ui.dragEndX(button);\r\n\t\tthis.dendy = ui.dragEndY(button);\r\n\t},\r\n\r\n\tonMouseMove : function (x, y, e) {\r\n\t\tif(e.target.id!=this.ui.gl.canvas.id) return;\r\n\t\tif(this._onHover && !this.ui.isDragging(0) && !this.isAnimate()) this._pickingRefresh(x, y);\r\n    },\r\n\r\n    onMouseOut : function (x, y) {\r\n\t\tif(this._onHover && !this.ui.isDragging(0)) this._pickingRefresh();\r\n    },\r\n\r\n\tonMouseButtonDown : function (button, x, y, e) {\r\n\t\tthis._clickable = true;\r\n\t},\r\n\r\n\tonMouseButtonUp : function (button, x, y, e) {\r\n\t\tif(this._clickable && !this.ui.isDragging(0) && button==0 && e.detail!=-1) {\r\n\t\t\tthis._pickingRefresh(x, y);\r\n\t\t\tif(this._onPickedSpot && this._pickedSpot!=null) this._onPickedSpot(this._pickedSpot);\r\n\t\t\tif(this._onPickedInstance && this._pickedInstance!=null) this._onPickedInstance(this._pickedInstance);\r\n\t\t\tthis._measureRefresh(button, x, y, e);\r\n\t\t}\r\n\t\tthis._clickable = false;\r\n\t},\r\n\r\n\tonKeyPress : function (key, evt) {\r\n\t\tif(this._isDebugging)\t// DEBUGGING-AUTHORING keys\r\n\t\t{\r\n\t\t\tif((evt.charCode == '80') || (evt.charCode == '112')) // key \"P\" to print trackball\r\n\t\t\t\tconsole.log(this.trackball.getState());\r\n\t\t\tif (evt.charCode == '49'){ // key \"1\" to show nexus patches\r\n\t\t\t\tNexus.Debug.nodes=!Nexus.Debug.nodes;\r\n\t\t\t\tthis.ui.postDrawEvent();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n    onMouseWheel: function (wheelDelta, x, y, e) {\r\n        var ui = this.ui;\r\n\r\n        var action = SGL_TRACKBALL_SCALE;\r\n        var factor = wheelDelta < 0.0 ? (0.90) : (1.10);\r\n\r\n\t\tvar testMatrix = this.trackball._matrix.slice();\r\n\r\n        this.trackball.action = action;\r\n        this.trackball.track(this.viewMatrix, 0.0, 0.0, factor);\r\n        this.trackball.action = SGL_TRACKBALL_NO_ACTION;\r\n\r\n\t\tvar diff;\r\n\t\tfor(var i=0; i<testMatrix.length; i++) {\r\n\t\t\tif(testMatrix[i]!=this.trackball._matrix[i]) {diff=true; break;}\r\n\t\t}\r\n\t\tif(diff) ui.postDrawEvent();\r\n    },\r\n\r\n    onAnimate : function (dt) {\r\n\t\tif (this._isSceneReady()) {\r\n\t\t\t// animate trackball\r\n\t\t\tif(this.trackball.tick(dt)) {\r\n\t\t\t\tthis.ui.postDrawEvent();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.ui.animateRate = 0;\r\n\t\t\t\tif(this._onHover && !this.ui.isDragging(0)) this._pickingRefresh(this.ui.cursorX, this.ui.cursorY);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tonDraw : function () {\r\n\t\tif (this._isSceneReady())\r\n\t\t\tthis._drawScene();\r\n\t\telse\r\n\t\t\tthis._drawNull();\r\n\t},\r\n\r\n//----------------------------------------------------------------------------------------\r\n// EXPOSED FUNCTIONS\r\n//----------------------------------------------------------------------------------------\r\n\tsupportsWebGL : function() {\r\n\t\treturn this._supportsWebGL;\r\n\t},\r\n\r\n\ttoggleDebugMode : function () {\r\n\t\tthis._isDebugging = !this._isDebugging;\r\n\t},\r\n\r\n\tsetScene : function (options) {\r\n\r\n\t\tif (!options) return;\r\n\r\n\t\tvar scene = this._parseScene(options);\r\n\t\tif (!scene) return;\r\n\r\n\t\tthis._scene = scene;\r\n\r\n\t\tthis._objectsToLoad = 0;\r\n\t\tfor (var m in scene.meshes) {\r\n\t\t\tvar mesh = scene.meshes[m];\r\n\t\t\tif (mesh.url) {\r\n\t\t\t\tthis._objectsToLoad++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var t in scene.texturedQuads) {\r\n\t\t\tvar tex = scene.texturedQuads[t];\r\n\t\t\tif (tex.url) {\r\n\t\t\t\tthis._objectsToLoad++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (scene.background.image) {\r\n\t\t\tthis._objectsToLoad++;\r\n\t\t}\r\n\r\n\t\t// creating the desired trackball\r\n\t\tvar trackball  = new this._scene.trackball.type();\r\n\t\ttrackball.setup(this._scene.trackball.trackOptions);\r\n        this.trackball  = trackball;\r\n\r\n\t\tvar that = this;\r\n\t\tvar gl = this.ui.gl;\r\n\r\n\t\tfor (var m in scene.meshes) {\r\n\t\t\tvar mesh = scene.meshes[m];\r\n\t\t\tif (!mesh.url) continue;\r\n\t\t\tif(String(mesh.url).lastIndexOf(\".nxs\") == (String(mesh.url).length - 4)) {\r\n\t\t\t\tvar nexus = new Nexus.Renderer(gl);\r\n\t\t\t\tmesh.renderable = nexus;\r\n\t\t\t\tmesh.isNexus = true;\r\n\t\t\t\tnexus.targetError = 1.0;\r\n\t\t\t\t//nexus.drawBudget = 0.5*1024*1024;\r\n\t\t\t\tnexus._targetFps = 25;\r\n\t\t\t\tnexus.onSceneReady = function () { that._onMeshReady(); };\r\n\t\t\t\tnexus.onUpdate = this.ui.postDrawEvent;\r\n\t\t\t\tnexus.open(mesh.url);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tmesh.renderable = null;\r\n\t\t\t\tmesh.isNexus = false;\r\n\t\t\t\tsglRequestBinary(mesh.url, {\r\n\t\t\t\t\tonSuccess : (function(m){ return function (req) { that._onPlyLoaded(req,m,gl); }; })(mesh)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var t in scene.texturedQuads) {\r\n\t\t\tvar tex = scene.texturedQuads[t];\r\n\t\t\tif (!tex.url) continue;\r\n\t\t\tscene.background.texture = new SglTexture2D(gl, {\r\n\t\t\t\tinternalFormat : gl.RGBA,\r\n\t\t\t\tformat         : gl.RGBA,\r\n\t\t\t\ttype           : gl.UNSIGNED_BYTE,\r\n\t\t\t\tgenerateMipmap : true,\r\n\t\t\t\tonSuccess      : function () { that._onTextureReady(); },\r\n\t\t\t\turl            : tex.url\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (scene.background.image) {\r\n\t\t\tscene.background.texture = new SglTexture2D(gl, {\r\n\t\t\t\tinternalFormat : gl.RGBA,\r\n\t\t\t\tformat         : gl.RGBA,\r\n\t\t\t\ttype           : gl.UNSIGNED_BYTE,\r\n\t\t\t\tgenerateMipmap : true,\r\n\t\t\t\tonSuccess      : function () { that._onBackgroundReady(); },\r\n\t\t\t\turl            : scene.background.image\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// create point-to-point line model\r\n\t\tthis._createLineModel();\r\n\r\n\t\tthis._testReady();\r\n\t\tthis._sceneParsed = true;\r\n\t},\r\n\r\n\tresetTrackball : function () {\r\n\t\tthis.trackball.reset();\r\n\t\tthis.trackball.track(SglMat4.identity(), 0.0, 0.0, 0.0);\r\n\r\n\t\tthis._lightDirection = [0, 0, -1]; // also reset lighting\r\n\r\n\t\tthis.ui.postDrawEvent();\r\n\t},\r\n\r\n\tgetTrackballPosition : function () {\r\n\t\treturn this.trackball.getState();\r\n\t},\r\n\r\n\tsetTrackballPosition : function (newposition) {\r\n\t\tthis.trackball.setState(newposition);\r\n\t\tthis.ui.postDrawEvent();\r\n\t},\r\n\r\n\tanimateToTrackballPosition : function (newposition) {\r\n\t\tthis.ui.animateRate = 30;\r\n\t\tthis.trackball.animateToState(newposition);\r\n\t\tthis.ui.postDrawEvent();\r\n\t},\r\n\r\n\tisAnimate : function () {\r\n\t\tif(this.ui.animateRate > 0) this._animating = true;\r\n\t\telse this._animating = false;\r\n\t\treturn this._animating;\r\n\t},\r\n\r\n// instance solid color\r\n\tsetInstanceSolidColorByName : function (name, newState, redraw, newColor) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tif(name == HOP_ALL) {\r\n\t\t\tfor (var inst in instances)\r\n\t\t\t\tinstances[inst].useSolidColor = newState;\r\n\t\t\t\tif(newColor)\r\n\t\t\t\t\tinstances[name].color = newColor;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(instances[name]) { // if an instance with that name exists\r\n\t\t\t\tinstances[name].useSolidColor = newState;\r\n\t\t\t\tif(newColor)\r\n\t\t\t\t\tinstances[name].color = newColor;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\tsetInstanceSolidColor : function (tag, newState, redraw, newColor) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tif(tag == HOP_ALL) {\r\n\t\t\t\tinstances[inst].useSolidColor = newState;\r\n\t\t\t\tif(newColor)\r\n\t\t\t\t\tinstances[inst].color = newColor;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (var tg in instances[inst].tags){\r\n\t\t\t\t\tif(instances[inst].tags[tg] == tag){\r\n\t\t\t\t\t\tinstances[inst].useSolidColor = newState;\r\n\t\t\t\t\t\tif(newColor)\r\n\t\t\t\t\t\t\tinstances[inst].color = newColor;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\ttoggleInstanceSolidColorByName : function (name, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tif(name == HOP_ALL) {\r\n\t\t\tfor (var inst in instances)\r\n\t\t\t\tinstances[inst].useSolidColor = !instances[inst].useSolidColor;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(instances[name]) // if an instance with that name exists\r\n\t\t\t\tinstances[name].useSolidColor = !instances[name].useSolidColor;\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\ttoggleInstanceSolidColor : function (tag, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tif(tag == HOP_ALL)\r\n\t\t\t{\r\n\t\t\t\tinstances[inst].useSolidColor = !instances[inst].useSolidColor;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (var tg in instances[inst].tags){\r\n\t\t\t\t\tif(instances[inst].tags[tg] == tag)\r\n\t\t\t\t\t\tinstances[inst].useSolidColor = !instances[inst].useSolidColor;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n// instance transparency\r\n\tsetInstanceTransparencyByName : function (name, newState, redraw, newAlpha) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tif(name == HOP_ALL) {\r\n\t\t\tfor (var inst in instances)\r\n\t\t\t\tinstances[inst].useTransparency = newState;\r\n\t\t\t\tif(newAlpha)\r\n\t\t\t\t\tinstances[inst].alpha = newAlpha;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(instances[name]) { // if an instance with that name exists\r\n\t\t\t\tinstances[name].useTransparency = newState;\r\n\t\t\t\tif(newAlpha)\r\n\t\t\t\t\tinstances[name].alpha = newAlpha;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\tsetInstanceTransparency : function (tag, newState, redraw, newAlpha) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tif(tag == HOP_ALL) {\r\n\t\t\t\tinstances[inst].useTransparency = newState;\r\n\t\t\t\tif(newAlpha)\r\n\t\t\t\t\tinstances[inst].alpha = newAlpha;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (var tg in instances[inst].tags){\r\n\t\t\t\t\tif(instances[inst].tags[tg] == tag){\r\n\t\t\t\t\t\tinstances[inst].useTransparency = newState;\r\n\t\t\t\t\t\tif(newAlpha)\r\n\t\t\t\t\t\t\tinstances[inst].alpha = newAlpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\r\n\ttoggleInstanceTransparencyByName : function (name, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tif(name == HOP_ALL) {\r\n\t\t\tfor (var inst in instances)\r\n\t\t\t\tinstances[inst].useTransparency = !instances[inst].useTransparency;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(instances[name]) // if an instance with that name exists\r\n\t\t\t\tinstances[name].useTransparency = !instances[name].useTransparency;\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\ttoggleInstanceTransparency : function (tag, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tif(tag == HOP_ALL)\r\n\t\t\t{\r\n\t\t\t\tinstances[inst].useTransparency = !instances[inst].useTransparency;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (var tg in instances[inst].tags){\r\n\t\t\t\t\tif(instances[inst].tags[tg] == tag)\r\n\t\t\t\t\t\tinstances[inst].useTransparency = !instances[inst].useTransparency;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n// instance visibility\r\n\tsetInstanceVisibilityByName : function (name, newState, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tif(name == HOP_ALL) {\r\n\t\t\tfor (var inst in instances)\r\n\t\t\t\tinstances[inst].visible = newState;;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(instances[name]) // if an instance with that name exists\r\n\t\t\t\tinstances[name].visible = newState;\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\tsetInstanceVisibility : function (tag, newState, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tif(tag == HOP_ALL) {\r\n\t\t\t\tinstances[inst].visible = newState;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (var tg in instances[inst].tags){\r\n\t\t\t\t\tif(instances[inst].tags[tg] == tag)\r\n\t\t\t\t\t\tinstances[inst].visible = newState;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\ttoggleInstanceVisibilityByName : function (name, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tif(name == HOP_ALL) {\r\n\t\t\tfor (var inst in instances)\r\n\t\t\t\tinstances[inst].visible = !instances[inst].visible;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(instances[name]) // if an instance with that name exists\r\n\t\t\t\tinstances[name].visible = !instances[name].visible;\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\ttoggleInstanceVisibility : function (tag, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tif(tag == HOP_ALL)\r\n\t\t\t{\r\n\t\t\t\tinstances[inst].visible = !instances[inst].visible;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (var tg in instances[inst].tags){\r\n\t\t\t\t\tif(instances[inst].tags[tg] == tag)\r\n\t\t\t\t\t\tinstances[inst].visible = !instances[inst].visible;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\tisInstanceVisibilityEnabledByName : function (name) {\r\n\t\tvar visibility = false;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tif(!name || name==HOP_ALL) {\r\n\t\t\tfor (var inst in instances) {\r\n\t\t\t\tif(instances[inst].visible){\r\n\t\t\t\t\tvisibility = true;\r\n\t\t\t\t\treturn visibility;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(instances[name]) { // if an instance with that name exists\r\n\t\t\t\tif(instances[name].visible){\r\n\t\t\t\t\tvisibility = true;\r\n\t\t\t\t\treturn visibility;\r\n\t\t\t\t}\r\n\t\t\t }\r\n\t\t}\r\n\t\treturn visibility;\r\n\t},\r\n\r\n\tisInstanceVisibilityEnabled : function (tag) {\r\n\t\tvar visibility = false;\r\n\r\n\t\tvar instances = this._scene.modelInstances;\r\n\r\n\t\tfor (var inst in instances) {\r\n\t\t\tif(!tag || tag==HOP_ALL){\r\n\t\t\t\tif(instances[inst].visible){\r\n\t\t\t\t\tvisibility = true;\r\n\t\t\t\t\treturn visibility;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tfor (var tg in instances[inst].tags){\r\n\t\t\t\t\tif(instances[inst].tags[tg] == tag){\r\n\t\t\t\t\t\tif(instances[inst].visible){\r\n\t\t\t\t\t\t\tvisibility = true;\r\n\t\t\t\t\t\t\treturn visibility;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn visibility;\r\n\t},\r\n\r\n// spot visibility\r\n\tsetSpotVisibilityByName : function (name, newState, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar spots = this._scene.spots;\r\n\r\n\t\tif(name == HOP_ALL) {\r\n\t\t\tfor (var spt in spots)\r\n\t\t\t\tspots[spt].visible = newState;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(spots[name]) // if an hotspot with that name exists\r\n\t\t\t\tspots[name].visible = newState;\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\tsetSpotVisibility : function (tag, newState, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar spots = this._scene.spots;\r\n\r\n\t\tfor (var spt in spots) {\r\n\t\t\tif(tag == HOP_ALL)\r\n\t\t\t{\r\n\t\t\t\tspots[spt].visible = newState;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (var tg in spots[spt].tags){\r\n\t\t\t\t\tif(spots[spt].tags[tg] == tag)\r\n\t\t\t\t\t\tspots[spt].visible = newState;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\ttoggleSpotVisibilityByName : function (name, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar spots = this._scene.spots;\r\n\r\n\t\tif(name == HOP_ALL) {\r\n\t\t\tfor (var spt in spots)\r\n\t\t\t\tspots[spt].visible = !spots[spt].visible;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(spots[name]) // if an hotspot with that name exists\r\n\t\t\t\tspots[name].visible = !spots[name].visible;\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\ttoggleSpotVisibility : function (tag, redraw) {\r\n\t\tvar ui = this.ui;\r\n\r\n\t\tvar spots = this._scene.spots;\r\n\r\n\t\tfor (var spt in spots) {\r\n\t\t\tif(tag == HOP_ALL)\r\n\t\t\t{\r\n\t\t\t\tspots[spt].visible = !spots[spt].visible;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (var tg in spots[spt].tags){\r\n\t\t\t\t\tif(spots[spt].tags[tg] == tag)\r\n\t\t\t\t\t\tspots[spt].visible = !spots[spt].visible;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(redraw)\r\n\t\t\tui.postDrawEvent();\r\n\t},\r\n\r\n\tisSpotVisibilityEnabledByName : function (name) {\r\n\t\tvar visibility = false;\r\n\r\n\t\tvar spots = this._scene.spots;\r\n\r\n\t\tif(!name || name==HOP_ALL) {\r\n\t\t\tfor (var spt in spots) {\r\n\t\t\t\tif(spots[spt].visible){\r\n\t\t\t\t\tvisibility = true;\r\n\t\t\t\t\treturn visibility;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(spots[name]) { // if an hotspot with that name exists\r\n\t\t\t\tif(spots[name].visible){\r\n\t\t\t\t\tvisibility = true;\r\n\t\t\t\t\treturn visibility;\r\n\t\t\t\t}\r\n\t\t\t }\r\n\t\t}\r\n\t\treturn visibility;\r\n\t},\r\n\r\n\tisSpotVisibilityEnabled : function (tag) {\r\n\t\tvar visibility = false;\r\n\r\n\t\tvar spots = this._scene.spots;\r\n\r\n\t\tfor (var spt in spots) {\r\n\t\t\tif(!tag || tag==HOP_ALL){\r\n\t\t\t\tif(spots[spt].visible){\r\n\t\t\t\t\tvisibility = true;\r\n\t\t\t\t\treturn visibility;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tfor (var tg in spots[spt].tags){\r\n\t\t\t\t\tif(spots[spt].tags[tg] == tag){\r\n\t\t\t\t\t\tif(spots[spt].visible){\r\n\t\t\t\t\t\t\tvisibility = true;\r\n\t\t\t\t\t\t\treturn visibility;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn visibility;\r\n\t},\r\n\r\n    zoomIn: function() {\r\n       this.onMouseWheel(-1);\r\n    },\r\n\r\n    zoomOut: function() {\r\n       this.onMouseWheel(1);\r\n    },\r\n\r\n    rotateLight: function(x, y) {\r\n      x *= 2;\r\n      y *= 2;\r\n      var r = Math.sqrt(x*x + y*y);\r\n      if(r >= 1) {\r\n        x /= r;\r\n        y /= r;\r\n        r = 0.999;\r\n       }\r\n       var z = Math.sqrt(1 - r*r);\r\n       this._lightDirection = [-x, -y, -z];\r\n       this.ui.postDrawEvent();\r\n    },\r\n\r\n\tenableLightTrackball: function(on) {\r\n\t\tthis._movingLight = on;\r\n\t},\r\n\r\n\tisLightTrackballEnabled: function() {\r\n\t\treturn this._movingLight;\r\n\t},\r\n\r\n\tenableOnHover: function(on) {\r\n\t\tthis._onHover = on;\r\n\t},\r\n\r\n\tisOnHoverEnabled: function() {\r\n\t\treturn this._onHover;\r\n\t},\r\n\r\n\tenableMeasurementTool: function(on) {\r\n\t\tthis._isMeasuring = on;\r\n\r\n\t\tif(on) this._startMeasurement();\r\n\t\telse this._stopMeasurement();\r\n\t},\r\n\r\n\tisMeasurementToolEnabled: function() {\r\n\t\treturn this._isMeasuring;\r\n\t}\r\n};\r\n","/*\r\n3DHOP - 3D Heritage Online Presenter\r\nCopyright (c) 2014, Marco Callieri - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.    \r\n\r\nThis program is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nThis program is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nvar parsePly = (function(){\r\n\tvar canonicTypes = {\r\n\t\t\"char\"    : \"int8\",\r\n\t\t\"int8\"    : \"int8\",\r\n\t\t\"uchar\"   : \"uint8\",\r\n\t\t\"uint8\"   : \"uint8\",\r\n\t\t\"short\"   : \"int16\",\r\n\t\t\"int16\"   : \"int16\",\r\n\t\t\"ushort\"  : \"uint16\",\r\n\t\t\"uint16\"  : \"uint16\",\r\n\t\t\"int\"     : \"int32\",\r\n\t\t\"int32\"   : \"int32\",\r\n\t\t\"uint\"    : \"uint32\",\r\n\t\t\"uint32\"  : \"uint32\",\r\n\t\t\"float\"   : \"float32\",\r\n\t\t\"float32\" : \"float32\",\r\n\t\t\"double\"  : \"float64\",\r\n\t\t\"float64\" : \"float64\"\r\n\t};\r\n\r\n\tfunction trim(s) {\r\n\t\tvar r = s;\r\n\t\tvar n = r.length;\r\n\t\tvar i = 0;\r\n\t\tvar blanks = \" \\n\\r\\t\";\r\n\t\twhile ((i < n) && (blanks.indexOf(r.charAt(i)) >= 0)) { i++; }\r\n\t\tr = r.substring(i, r.length);\r\n\t\ti = r.length - 1;\r\n\t\twhile ((i > 0) && (blanks.indexOf(r.charAt(i)) >= 0)) { i--; }\r\n\t\tr = r.substring(0, i+1);\r\n\t\treturn r;\r\n\t}\r\n\r\n\tfunction extractHeader(data) {\r\n\t\tif (!data || !data.view || !data.view.buffer) return null;\r\n\r\n\t\tvar u8 = new Uint8Array(data.view.buffer);\r\n\t\tvar endHeaderToken = \"end_header\";\r\n\t\tvar header = \"\";\r\n\t\tvar found  = false;\r\n\t\tvar currC  = null;\r\n\t\tvar prevC  = null;\r\n\t\tvar pos    = data.pos;\r\n\t\tvar p      = 0;\r\n\t\tvar n      = 0;\r\n\r\n\t\tfor (pos=0, n=u8.byteLength; pos<n; ++pos) {\r\n\t\t\tcurrC = String.fromCharCode(u8[pos]);\r\n\t\t\theader += currC;\r\n\t\t\tif (currC === \"\\n\") {\r\n\t\t\t\tif (pos >= endHeaderToken.length) {\r\n\t\t\t\t\tp = pos - endHeaderToken.length;\r\n\t\t\t\t\tif (prevC == \"\\r\") p--;\r\n\t\t\t\t\tif (header.substring(p, p + endHeaderToken.length) == endHeaderToken) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprevC = currC;\r\n\t\t}\r\n\r\n\t\tdata.pos = pos;\r\n\r\n\t\tif (!found) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tdata.pos++;\r\n\t\treturn header;\r\n\t}\r\n\r\n\tfunction splitHeader(header) {\r\n\t\tvar lines  = header.split(\"\\n\");\r\n\t\tvar trimmed = [ ];\r\n\t\tvar tokens  = null;\r\n\t\tvar s = null;\r\n\t\tfor (var i=0, n=lines.length; i<n; ++i) {\r\n\t\t\ts = trim(lines[i]);\r\n\t\t\tif (s) {\r\n\t\t\t\ttokens = s.split(\" \");\r\n\t\t\t\tif (tokens.length > 0) {\r\n\t\t\t\t\tfor (var j=0, m=tokens.length; j<m; ++j) {\r\n\t\t\t\t\t\ttokens[j] = trim(tokens[j]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttrimmed.push(tokens);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn trimmed;\r\n\t}\r\n\r\n\tfunction parseHeader(header) {\r\n\t\tif (!header || header.length <= 0) return null;\r\n\t\tif (header[0][0] != \"ply\") return null;\r\n\r\n\t\tvar elem   = null;\r\n\t\tvar prop   = null;\r\n\t\tvar tokens = null;\r\n\t\tvar token  = null;\r\n\t\tvar tn     = 0;\r\n\r\n\t\tvar info = {\r\n\t\t\tformat     : null,\r\n\t\t\telements   : [ ],\r\n\t\t\telementMap : { },\r\n\t\t\tcomments   : [ ],\r\n\t\t\tothers     : [ ]\r\n\t\t};\r\n\r\n\t\tfor (var i=1; i<header.length-1; ++i) {\r\n\t\t\ttokens = header[i];\r\n\t\t\ttn = tokens.length;\r\n\t\t\ttoken  = tokens[0].toLowerCase();\r\n\t\t\tswitch (token) {\r\n\t\t\t\tcase \"format\":\r\n\t\t\t\t\tif (tn >= 3) {\r\n\t\t\t\t\t\tinfo.format = {\r\n\t\t\t\t\t\t\tname    : tokens[1],\r\n\t\t\t\t\t\t\tversion : tokens[2],\r\n\t\t\t\t\t\t\tbinary  : (tokens[1].toLowerCase().indexOf(\"binary\") >= 0),\r\n\t\t\t\t\t\t\tlittleEndian : ((tokens[1].toLowerCase()) == \"binary_little_endian\")\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"comment\":\r\n\t\t\t\t\tinfo.comments.push(tokens.slice(1));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"element\":\r\n\t\t\t\t\tif (tn >= 3) {\r\n\t\t\t\t\t\telem = {\r\n\t\t\t\t\t\t\tname  : tokens[1],\r\n\t\t\t\t\t\t\tcount : parseInt(tokens[2]),\r\n\t\t\t\t\t\t\tproperties  : [ ],\r\n\t\t\t\t\t\t\tpropertyMap : { }\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tinfo.elements.push(elem);\r\n\t\t\t\t\t\tinfo.elementMap[elem.name.toLowerCase()] = elem;\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"property\":\r\n\t\t\t\t\tif (elem && (tn >= 3)) {\r\n\t\t\t\t\t\tprop = {\r\n\t\t\t\t\t\t\tname : tokens[tn-1],\r\n\t\t\t\t\t\t\ttype : tokens.slice(1, tn - 1)\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\telem.properties.push(prop);\r\n\t\t\t\t\t\telem.propertyMap[prop.name.toLowerCase()] = prop;\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tinfo.others.push(tokens.slice());\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!info.format) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn info;\r\n\t}\r\n\r\n\tvar tabStr = \"\\t\";\r\n\r\n\tfunction setupLines(lines, tabs) {\r\n\t\tfor (var i=0, n=lines.length; i<n; ++i) {\r\n\t\t\tlines[i] = tabs + lines[i];\r\n\t\t}\r\n\t\treturn lines;\r\n\t}\r\n\r\n\tfunction generateReadValue(assignExpr, types, index, binary, littleEndian, tabs, level, newIdentifiers) {\r\n\t\tvar lines = [ ];\r\n\t\tvar type  = types[index];\r\n\r\n\t\tif (type.toLowerCase() == \"list\") {\r\n\t\t\tvar nIde = \"n\" + level;\r\n\t\t\tvar vIde = \"v\" + level;\r\n\t\t\tvar iIde = \"i\" + level;\r\n\r\n\t\t\tnewIdentifiers[nIde] = true;\r\n\t\t\tnewIdentifiers[vIde] = true;\r\n\t\t\tnewIdentifiers[iIde] = true;\r\n\r\n\t\t\tlevel++;\r\n\t\t\tindex++;\r\n\r\n\t\t\tlines = lines.concat(lines, generateReadValue(/*\"var \" + */ \"\" + nIde, types, index, binary, littleEndian, \"\", level, newIdentifiers));\r\n\t\t\tindex++;\r\n\t\r\n\t\t\tlines.push(/*\"var \" + */ vIde + \" = new Array(\" + nIde + \");\");\r\n\t\t\tlines.push(\"for (\" + /*\"var \" + */ iIde +\"=0; \" + iIde + \"<\" + nIde + \"; ++\" + iIde + \") {\");\r\n\t\t\tlines = lines.concat(generateReadValue(vIde + \"[\" + iIde + \"]\", types, index, binary, littleEndian, tabStr, level, newIdentifiers));\r\n\t\t\t//lines.push(\"\");\r\n\t\t\tlines.push(\"}\");\r\n\t\t\tlines.push(assignExpr + \" = \" + vIde + \";\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (binary) {\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase \"char\":\r\n\t\t\t\t\tcase \"int8\":\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = view.getInt8(pos, \" + littleEndian + \");\");\r\n\t\t\t\t\t\tlines.push(\"pos += 1;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"uchar\":\r\n\t\t\t\t\tcase \"uint8\":\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = view.getUint8(pos, \" + littleEndian + \");\");\r\n\t\t\t\t\t\tlines.push(\"pos += 1;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"short\":\r\n\t\t\t\t\tcase \"int16\":\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = view.getInt16(pos, \" + littleEndian + \");\");\r\n\t\t\t\t\t\tlines.push(\"pos += 2;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"ushort\":\r\n\t\t\t\t\tcase \"uint16\":\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = view.getUint16(pos, \" + littleEndian + \");\");\r\n\t\t\t\t\t\tlines.push(\"pos += 2;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"int\":\r\n\t\t\t\t\tcase \"int32\":\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = view.getInt32(pos, \" + littleEndian + \");\");\r\n\t\t\t\t\t\tlines.push(\"pos += 4;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"uint\":\r\n\t\t\t\t\tcase \"uint32\":\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = view.getUint32(pos, \" + littleEndian + \");\");\r\n\t\t\t\t\t\tlines.push(\"pos += 4;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"float\":\r\n\t\t\t\t\tcase \"float32\":\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = view.getFloat32(pos, \" + littleEndian + \");\");\r\n\t\t\t\t\t\tlines.push(\"pos += 4;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"double\":\r\n\t\t\t\t\tcase \"float64\":\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = view.getFloat64(pos, \" + littleEndian + \");\");\r\n\t\t\t\t\t\tlines.push(\"pos += 8;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase \"char\"   :\r\n\t\t\t\t\tcase \"int8\"   :\r\n\t\t\t\t\tcase \"uchar\"  :\r\n\t\t\t\t\tcase \"uint8\"  :\r\n\t\t\t\t\tcase \"short\"  :\r\n\t\t\t\t\tcase \"int16\"  :\r\n\t\t\t\t\tcase \"ushort\" :\r\n\t\t\t\t\tcase \"uint16\" :\r\n\t\t\t\t\tcase \"int\"    :\r\n\t\t\t\t\tcase \"int32\"  :\r\n\t\t\t\t\tcase \"uint\"   :\r\n\t\t\t\t\tcase \"uint32\" :\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = parseInt(view[pos]);\");\r\n\t\t\t\t\t\tlines.push(\"pos += 1;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"float\"   :\r\n\t\t\t\t\tcase \"float32\" :\r\n\t\t\t\t\tcase \"double\"   :\r\n\t\t\t\t\tcase \"float64\" :\r\n\t\t\t\t\t\tlines.push(assignExpr + \" = parseFloat(view[pos]);\");\r\n\t\t\t\t\t\tlines.push(\"pos += 1;\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetupLines(lines, tabs);\r\n\t\treturn lines;\r\n\t}\r\n\r\n\tfunction generateReadProperty(assignExpr, types, binary, littleEndian, tabs, level, newIdentifiers) {\r\n\t\tvar lines = generateReadValue(assignExpr, types, 0, binary, littleEndian, \"\", level, newIdentifiers);\r\n\t\treturn lines;\r\n\t}\r\n\r\n\tfunction generateReadElement(assignExpr, props, binary, littleEndian, tabs, level, newIdentifiers) {\r\n\t\tvar p  = null;\r\n\t\tvar lines = [ ];\r\n\t\tfor (var i=0, n=props.length; i<n; ++i) {\r\n\t\t\tp = props[i];\r\n\t\t\tlines = lines.concat(generateReadProperty(assignExpr + \"[\\\"\" + p.name + \"\\\"]\", p.type, binary, littleEndian, \"\", level, newIdentifiers));\r\n\t\t\tlines.push(\"\");\r\n\t\t}\r\n\t\tsetupLines(lines, tabs);\r\n\t\treturn lines;\r\n\t}\r\n\r\n\tfunction generateReadElements(elemIndex, elem, binary, littleEndian, tabs, level, newIdentifiers) {\r\n\t\tvar lines = [ ];\r\n\t\tvar nIde  = \"n\" + level;\r\n\t\tvar iIde  = \"i\" + level;\r\n\t\tlevel++;\r\n\r\n\t\tnewIdentifiers[nIde]      = true;\r\n\t\tnewIdentifiers[iIde]      = true;\r\n\t\tnewIdentifiers[\"element\"] = true;\r\n\t\tnewIdentifiers[\"elem\"]    = true;\r\n\t\tnewIdentifiers[\"args\"]    = true;\r\n\r\n\t\tlines.push(/*\"var \" + */ \"element = info.elements[\" + elemIndex + \"];\");\r\n\t\tlines.push(/*\"var \" + */ nIde + \" = element.count;\");\r\n\t\tlines.push(/*\"var \" + */ \"elem = { };\");\r\n\t\tlines.push(/*\"var \" + */ \"args = [ info, element, 0, elem];\");\r\n\r\n\t\tlines.push(\"callbacks.onBeginElements.call(handler, info, element);\");\r\n\r\n\t\tlines.push(\"for (\" + /*\"var \" + */ iIde +\"=0; \" + iIde + \"<\" + nIde + \"; ++\" + iIde + \") {\");\r\n\t\tlines = lines.concat(generateReadElement(\"elem\", elem.properties, binary, littleEndian, tabStr, level, newIdentifiers));\r\n\t\tlines.push(tabStr + \"args[2] = \" + iIde + \";\");\r\n\t\tlines.push(tabStr + \"callbacks.onElement.apply(handler, args);\");\r\n\t\tlines.push(\"}\");\r\n\r\n\t\tlines.push(\"callbacks.onEndElements.call(handler, info, element);\");\r\n\r\n\t\tsetupLines(lines, tabs);\r\n\t\treturn lines;\r\n\t}\r\n\r\n\tfunction generateReadMesh(elems, binary, littleEndian) {\r\n\t\tvar lines = [ ];\r\n\t\tlines.push(\"function (data, info, callbacks, handler) {\");\r\n\t\tlines.push(tabStr + \"var view = data.view;\");\r\n\t\tlines.push(tabStr + \"var pos  = data.pos;\");\r\n\t\tlines.push(\"\");\r\n\r\n\t\tvar newIdentifiers = { };\r\n\r\n\t\tvar elementLines = [ ];\r\n\t\tfor (var i=0, n=elems.length; i<n; ++i) {\r\n\t\t\telementLines = elementLines.concat(generateReadElements(i, elems[i], binary, littleEndian, tabStr, 0, newIdentifiers));\r\n\t\t\telementLines.push(\"\");\r\n\t\t}\r\n\r\n\t\tvar ides = [ ];\r\n\t\tfor (var ide in newIdentifiers) {\r\n\t\t\tides.push(ide);\r\n\t\t}\r\n\t\tides.sort();\r\n\t\tlines.push(tabStr + \"var \" + ides.join(\", \") + \";\");\r\n\t\tlines.push(\"\");\r\n\r\n\t\tlines.push(tabStr + \"callbacks.onBeginContent.call(handler, info);\");\r\n\t\tlines = lines.concat(elementLines);\r\n\t\tlines.push(tabStr + \"callbacks.onEndContent.call(handler, info);\");\r\n\r\n\t\tlines.push(tabStr + \"data.pos = pos;\");\r\n\t\tlines.push(\"}\");\r\n\r\n\t\tsetupLines(lines, \"\");\r\n\t\tvar s = \"\";\r\n\t\tfor (var i=0, n=lines.length; i<n; ++i) {\r\n\t\t\ts += lines[i] + \"\\n\";\r\n\t\t}\r\n\t\treturn s;\r\n\t}\r\n\r\n\tfunction getMeshInfo(data) {\r\n\t\tif (!data) return null;\r\n\r\n\t\tvar header = extractHeader(data);\r\n\t\tif (!header) return null;\r\n\r\n\t\tvar tokens = splitHeader(header);\r\n\t\tif (!tokens) return null;\r\n\r\n\t\tvar info = parseHeader(tokens);\r\n\t\tif (!info) return null;\r\n\r\n\t\treturn info;\r\n\t}\r\n\r\n\tfunction mainParsePly(buffer, handler) {\r\n\t\tif (!buffer) return null;\r\n\r\n\t\tfunction emptyFunc() { };\r\n\r\n\t\thandler = handler || { };\r\n\t\tvar callbacks = {\r\n\t\t\tonBegin                 : (handler.onBegin         || emptyFunc),\r\n\t\t\t\tonHeader            : (handler.onHeader        || emptyFunc),\r\n\t\t\t\tonBeginContent      : (handler.onBeginContent  || emptyFunc),\r\n\t\t\t\t\tonBeginElements : (handler.onBeginElements || emptyFunc),\r\n\t\t\t\t\t\tonElement   : (handler.onElement       || emptyFunc),\r\n\t\t\t\t\tonEndElements   : (handler.onEndElements   || emptyFunc),\r\n\t\t\t\tonEndContent        : (handler.onEndContent    || emptyFunc),\r\n\t\t\tonEnd                   : (handler.onEnd           || emptyFunc)\r\n\t\t};\r\n\r\n\t\tvar dataView = new DataView(buffer);\r\n\t\tvar data = {\r\n\t\t\tview : dataView,\r\n\t\t\tpos  : 0\r\n\t\t};\r\n\r\n\t\tvar info = getMeshInfo(data);\r\n\t\tif (!info) return false;\r\n\r\n\t\tif (!info.format.binary) {\r\n\t\t\tdata.view = Array.prototype.map.call(\r\n\t\t\t\tnew Uint8Array(buffer, data.pos),\r\n\t\t\t\tfunction (x) {\r\n\t\t\t\t\treturn String.fromCharCode(x);\r\n\t\t\t\t}\r\n\t\t\t).join(\"\").split(\" \");\r\n\t\t\tdata.pos = 0;\r\n\t\t}\r\n\r\n\t\tvar readMeshStr  = generateReadMesh(info.elements, info.format.binary, info.format.littleEndian);\r\n\t\tvar readMeshFunc = eval(\"(\" + readMeshStr + \")\");\r\n\r\n\t\tfor (var e in info.elements) {\r\n\t\t\tfor (var p in info.elements[e].propertyMap) {\r\n\t\t\t\tinfo.elements[e].propertyMap[p].canonicType = canonicTypes[info.elements[e].propertyMap[p].type];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcallbacks.onBegin.call(handler);\r\n\t\t\tcallbacks.onHeader.call(handler, info);\r\n\t\t\treadMeshFunc(data, info, callbacks, handler);\r\n\t\tcallbacks.onEnd.call(handler);\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn mainParsePly;\r\n})();\r\n\r\nvar importPly = (function(){\r\n\tfunction emptyFunction() {\r\n\t}\r\n\r\n\tfunction propertiesTypes() {\r\n\t\tvar r = [ ];\r\n\t\tvar m = { };\r\n\t\tvar a = null;\r\n\t\tfor (var i=0; i<arguments.length; ++i) {\r\n\t\t\ta = arguments[i];\r\n\t\t\tif (!a) return r;\r\n\t\t\tm[a.canonicType] = 1;\r\n\t\t}\r\n\t\tfor (var t in m) {\r\n\t\t\tr.push(t);\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n\r\n\tfunction PlyHandler(buffer) {\r\n\t\tthis._buffer           = buffer;\r\n\r\n\t\tthis._modelDescriptor  = null;\r\n\r\n\t\tthis._verticesCount    = 0;\r\n\t\tthis._vertexAttributes = null;\r\n\t\tthis._vertexStride     = 0;\r\n\t\tthis._vertexBuffer     = null;\r\n\t\tthis._handleVertex     = emptyFunction;\r\n\r\n\t\tthis._facesCount       = 0;\r\n\t\tthis._indexBuffer      = null;\r\n\t\tthis._handleFace       = emptyFunction;\r\n\r\n\t\tthis._view             = null;\r\n\t\t\r\n\t\tthis._boundingBox      = { \r\n                                     min: [ 1000000.0, 1000000.0, 1000000.0], \r\n\t\t\t\t\t\t\t\t\t max: [-1000000.0,-1000000.0,-1000000.0]\r\n\t\t\t\t\t\t\t     };\r\n\t}\r\n\r\n\tPlyHandler.prototype = {\r\n\t\tget modelDescriptor() {\r\n\t\t\treturn this._modelDescriptor;\r\n\t\t},\r\n\r\n\t\tonBegin : function () {\r\n\t\t},\r\n\r\n\t\tonHeader : function (header) {\r\n\t\t\tvar tabStr = \"\\t\";\r\n\r\n\t\t\tvar elem   = null;\r\n\t\t\tvar props  = null;\r\n\t\t\tvar ptypes = null;\r\n\r\n\t\t\tvar verticesCount    = 0;\r\n\t\t\tvar vertexLines      = null;\r\n\t\t\tvar vertexAttributes = { };\r\n\t\t\tvar vertexStride     = 0;\r\n\r\n\t\t\telem  = header.elementMap[\"vertex\"];\r\n\t\t\tif (elem && elem.count > 0) {\r\n\t\t\t\tverticesCount = elem.count;\r\n\t\t\t\tprops = elem.propertyMap;\r\n\r\n\t\t\t\tvertexLines = [ ];\r\n\r\n\t\t\t\tvertexLines.push(\"function (header, elementInfo, index, element) {\");\r\n\t\t\t\tvertexLines.push(tabStr + \"var littleEndian = SpiderGL.Type.LITTLE_ENDIAN;\");\r\n\t\t\t\tvertexLines.push(tabStr + \"var sf32         = SpiderGL.Type.SIZEOF_FLOAT32;\");\r\n\t\t\t\tvertexLines.push(tabStr + \"var sui8         = SpiderGL.Type.SIZEOF_UINT8;\");\r\n\t\t\t\tvertexLines.push(tabStr + \"var offset       = index * this._vertexStride;\");\r\n\t\t\t\tvertexLines.push(tabStr + \"var view         = this._view;\");\r\n\t\t\t\tvertexLines.push(\"\");\r\n\r\n\t\t\t\tptypes = propertiesTypes(props[\"x\"], props[\"y\"], props[\"z\"]);\r\n\t\t\t\tif (ptypes.length == 1) {\r\n\t\t\t\t\tswitch (ptypes[0]) {\r\n\t\t\t\t\t\tcase \"float32\":\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.x, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.y, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.z, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(\"\");\r\n\t\t\t\t\t\t\tvertexAttributes[\"position\"] = {\r\n\t\t\t\t\t\t\t\tsize   : 3,\r\n\t\t\t\t\t\t\t\ttype   : SpiderGL.Type.FLOAT32,\r\n\t\t\t\t\t\t\t\toffset : vertexStride\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvertexStride += 3 * SpiderGL.Type.SIZEOF_FLOAT32;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault: break;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tptypes = propertiesTypes(props[\"nx\"], props[\"ny\"], props[\"nz\"]);\r\n\t\t\t\tif (ptypes.length == 1) {\r\n\t\t\t\t\tswitch (ptypes[0]) {\r\n\t\t\t\t\t\tcase \"float32\":\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.nx, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.ny, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.nz, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(\"\");\r\n\t\t\t\t\t\t\tvertexAttributes[\"normal\"] = {\r\n\t\t\t\t\t\t\t\tsize   : 3,\r\n\t\t\t\t\t\t\t\ttype   : SpiderGL.Type.FLOAT32,\r\n\t\t\t\t\t\t\t\toffset : vertexStride\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvertexStride += 3 * SpiderGL.Type.SIZEOF_FLOAT32;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault: break;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tptypes = propertiesTypes(props[\"red\"], props[\"green\"], props[\"blue\"]);\r\n\t\t\t\tif (ptypes.length == 1) {\r\n\t\t\t\t\tswitch (ptypes[0]) {\r\n\t\t\t\t\t\tcase \"uint8\":\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setUint8(offset, element.red  ); offset += sui8;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setUint8(offset, element.green); offset += sui8;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setUint8(offset, element.blue ); offset += sui8;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setUint8(offset, 255          ); offset += sui8;\");\r\n\t\t\t\t\t\t\tvertexLines.push(\"\");\r\n\t\t\t\t\t\t\tvertexAttributes[\"color\"] = {\r\n\t\t\t\t\t\t\t\tsize   : 4,\r\n\t\t\t\t\t\t\t\ttype   : SpiderGL.Type.UINT8,\r\n\t\t\t\t\t\t\t\toffset : vertexStride,\r\n\t\t\t\t\t\t\t\tnormalized : true\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvertexStride += 4 * SpiderGL.Type.SIZEOF_UINT8;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"float32\":\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.red,   littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.green, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.blue,  littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, 1.0,           littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(\"\");\r\n\t\t\t\t\t\t\tvertexAttributes[\"color\"] = {\r\n\t\t\t\t\t\t\t\tsize   : 4,\r\n\t\t\t\t\t\t\t\ttype   : SpiderGL.Type.FLOAT32,\r\n\t\t\t\t\t\t\t\toffset : vertexStride\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvertexStride += 4 * SpiderGL.Type.SIZEOF_FLOAT32;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault: break;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tptypes = propertiesTypes(props[\"texture_u\"], props[\"texture_v\"]);\r\n\t\t\t\tif (ptypes.length == 1) {\r\n\t\t\t\t\tswitch (ptypes[0]) {\r\n\t\t\t\t\t\tcase \"float32\":\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.texture_u, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(tabStr + \"view.setFloat32(offset, element.texture_v, littleEndian); offset += sf32;\");\r\n\t\t\t\t\t\t\tvertexLines.push(\"\");\r\n\t\t\t\t\t\t\tvertexAttributes[\"texcoord\"] = {\r\n\t\t\t\t\t\t\t\tsize   : 2,\r\n\t\t\t\t\t\t\t\ttype   : SpiderGL.Type.FLOAT32,\r\n\t\t\t\t\t\t\t\toffset : vertexStride\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvertexStride += 2 * SpiderGL.Type.SIZEOF_FLOAT32;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault: break;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvertexLines.push(\"}\");\r\n\t\t\t}\r\n\r\n\t\t\tvar facesCount = 0;\r\n\t\t\tvar faceLines  = null;\r\n\r\n\t\t\telem  = header.elementMap[\"face\"];\r\n\t\t\tif (elem && elem.count > 0) {\r\n\t\t\t\tfacesCount = elem.count;\r\n\t\t\t\tprops = elem.propertyMap;\r\n\r\n\t\t\t\tfaceLines = [ ];\r\n\r\n\t\t\t\tfaceLines.push(\"function (header, elementInfo, index, element) {\");\r\n\t\t\t\tfaceLines.push(tabStr + \"var littleEndian = SpiderGL.Type.LITTLE_ENDIAN;\");\r\n\t\t\t\tfaceLines.push(tabStr + \"var sui32        = SpiderGL.Type.SIZEOF_UINT32;\");\r\n\t\t\t\tfaceLines.push(tabStr + \"var offset       = index * 3 * sui32;\");\r\n\t\t\t\tfaceLines.push(tabStr + \"var view         = this._view;\");\r\n\t\t\t\tfaceLines.push(\"\");\r\n\r\n\t\t\t\tif (props[\"vertex_indices\"]) {\r\n\t\t\t\t\tfaceLines.push(tabStr + \"view.setUint32(offset, element.vertex_indices[0], littleEndian); offset += sui32;\");\r\n\t\t\t\t\tfaceLines.push(tabStr + \"view.setUint32(offset, element.vertex_indices[1], littleEndian); offset += sui32;\");\r\n\t\t\t\t\tfaceLines.push(tabStr + \"view.setUint32(offset, element.vertex_indices[2], littleEndian); offset += sui32;\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tfacesCount = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfaceLines.push(\"}\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._mesh = null;\r\n\r\n\t\t\tthis._verticesCount    = verticesCount;\r\n\t\t\tthis._vertexAttributes = vertexAttributes;\r\n\t\t\tthis._vertexStride     = vertexStride;\r\n\t\t\tthis._vertexBuffer     = null;\r\n\t\t\tthis._handleVertex     = emptyFunction;\r\n\r\n\t\t\tif (vertexStride > 0) {\r\n\t\t\t\tvar vertexFuncStr = vertexLines.join(\"\\n\");\r\n\t\t\t\tthis._handleVertex = eval(\"(\" + vertexFuncStr + \")\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._facesCount   = facesCount;\r\n\t\t\tthis._indexBuffer  = null;\r\n\t\t\tthis._handleFace   = emptyFunction;\r\n\r\n\t\t\tif (facesCount > 0) {\r\n\t\t\t\tvar faceFuncStr = faceLines.join(\"\\n\");\r\n\t\t\t\tthis._handleFace = eval(\"(\" + faceFuncStr + \")\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonBeginContent : function (header) {\r\n\t\t},\r\n\r\n\t\tonBeginElements : function (header, elementInfo) {\r\n\t\t\tswitch (elementInfo.name) {\r\n\t\t\t\tcase \"vertex\":\r\n\t\t\t\t\tthis._vertexBuffer  = new ArrayBuffer(this._verticesCount * this._vertexStride);\r\n\t\t\t\t\tthis._view          = new DataView(this._vertexBuffer);\r\n\t\t\t\t\tthis._handleElement = this._handleVertex;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"face\":\r\n\t\t\t\t\tthis._indexBuffer   = new ArrayBuffer(this._facesCount * 3 * SpiderGL.Type.SIZEOF_UINT32);\r\n\t\t\t\t\tthis._view          = new DataView(this._indexBuffer);\r\n\t\t\t\t\tthis._handleElement = this._handleFace;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis._view          = null;\r\n\t\t\t\t\tthis._handleElement = emptyFunction;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonElement : function (header, elementInfo, index, element) {\r\n\t\t\t// bounding box calculation\r\n\t\t\tif (elementInfo.name==\"vertex\"){\r\n\t\t\r\n\t\t\t\tif(element.x < this._boundingBox.min[0])\r\n\t\t\t\t\tthis._boundingBox.min[0] = element.x;\r\n\t\t\t\tif(element.y < this._boundingBox.min[1])\r\n\t\t\t\t\tthis._boundingBox.min[1] = element.y;\r\n\t\t\t\tif(element.z < this._boundingBox.min[2])\r\n\t\t\t\t\tthis._boundingBox.min[2] = element.z;\r\n\t\t\t\t\t\r\n\t\t\t\tif(element.x > this._boundingBox.max[0])\r\n\t\t\t\t\tthis._boundingBox.max[0] = element.x;\r\n\t\t\t\tif(element.y > this._boundingBox.max[1])\r\n\t\t\t\t\tthis._boundingBox.max[1] = element.y;\r\n\t\t\t\tif(element.z > this._boundingBox.max[2])\r\n\t\t\t\t\tthis._boundingBox.max[2] = element.z;\r\n\t\t\t}\r\n\t\t\r\n\t\t\tthis._handleElement(header, elementInfo, index, element);\r\n\t\t},\r\n\r\n\t\tonEndElements : function (header, elementInfo) {\r\n\t\t\tthis._view          = null;\r\n\t\t\tthis._handleElement = emptyFunction;\r\n\t\t},\r\n\r\n\t\tonEndContent : function () {\r\n\t\t},\r\n\r\n\t\tonEnd : function () {\r\n\t\t\tif ((this._verticesCount <= 0) && (this._facesCount <= 0)) return;\r\n\r\n\t\t\tvar gl   = this._gl;\r\n\t\t\tvar modelDescriptor = {\r\n\t\t\t\tversion : \"0.0.1.0 EXP\",\r\n\t\t\t\tmeta : {\r\n\t\t\t\t},\r\n\t\t\t\tdata : {\r\n\t\t\t\t\tvertexBuffers : {\r\n\t\t\t\t\t},\r\n\t\t\t\t\tindexBuffers : {\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\taccess : {\r\n\t\t\t\t\tvertexStreams : {\r\n\t\t\t\t\t},\r\n\t\t\t\t\tprimitiveStreams : {\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsemantic : {\r\n\t\t\t\t\tbindings : {\r\n\t\t\t\t\t},\r\n\t\t\t\t\tchunks : {\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tlogic : {\r\n\t\t\t\t\tparts : {\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcontrol : {\r\n\t\t\t\t},\r\n\t\t\t\textra : {\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tvar modelVertexBuffers    = modelDescriptor.data.vertexBuffers;\r\n\t\t\tvar modelIndexBuffers     = modelDescriptor.data.indexBuffers;\r\n\t\t\tvar modelVertexStreams    = modelDescriptor.access.vertexStreams;\r\n\t\t\tvar modelPrimitiveStreams = modelDescriptor.access.primitiveStreams;\r\n\t\t\tvar modelBindings         = modelDescriptor.semantic.bindings;\r\n\t\t\tvar modelChunks           = modelDescriptor.semantic.chunks;\r\n\t\t\tvar modelParts            = modelDescriptor.logic.parts;\r\n\r\n\t\t\tmodelDescriptor.extra.boundingBox = this._boundingBox;\r\n\t\t\t\r\n\t\t\tvar maxVerticesCount = (1 << 16) - 1;\r\n\r\n\t\t\tvar baseVertexBufferName = \"mainVertexBuffer\";\r\n\t\t\tvar baseIndexBufferName  = \"mainIndexBuffer\";\r\n\t\t\tvar baseBindingName      = \"mainBinding\";\r\n\t\t\tvar baseChunkName        = \"mainChunk\";\r\n\t\t\tvar basePointStreamName  = \"vertices\";\r\n\t\t\tvar baseTriStreamName    = \"triangles\";\r\n\t\t\tvar basePartName         = \"mainPart\";\r\n\r\n\t\t\tif (this._facesCount > 0) {\r\n\t\t\t\tvar littleEndian = SpiderGL.Type.LITTLE_ENDIAN;\r\n\t\t\t\tvar indexStride  = SpiderGL.Type.SIZEOF_UINT32;\r\n\t\t\t\tvar wholeSize    = Float64Array.BYTES_PER_ELEMENT;\r\n\r\n\t\t\t\tvar stride       = this._vertexStride;\r\n\t\t\t\tvar partCount    = stride % wholeSize;\r\n\t\t\t\tvar wholeCount   = (stride - partCount) / wholeSize;\r\n\r\n\t\t\t\tvar vertexBufferView = new Uint8Array(this._vertexBuffer);\r\n\t\t\t\tvar indexBufferView  = new Uint32Array(this._indexBuffer);\r\n\r\n\t\t\t\tvar chunksCount        = 0;\r\n\t\t\t\tvar chunkVertexBuffers = [ ];\r\n\t\t\t\tvar chunkVerticesCount = [ ];\r\n\t\t\t\tvar chunkIndexBuffers  = [ ];\r\n\t\t\t\tvar chunkIndicesCount  = [ ];\r\n\r\n\t\t\t\tvar facesLeft        = this._facesCount;\r\n\t\t\t\tvar currFaceIndex    = 0;\r\n\r\n\t\t\t\tvar indicesBuffer = new Uint32Array(this._facesCount * 3);\r\n\r\n\t\t\t\twhile (facesLeft > 0) {\r\n\t\t\t\t\tvar verticesMap   = new Uint32Array(this._verticesCount);\r\n\t\t\t\t\tvar verticesNew   = new Uint32Array(maxVerticesCount);\r\n\t\t\t\t\tvar verticesCount = 0;\r\n\t\t\t\t\tvar indicesCount  = 0;\r\n\t\t\t\t\tvar facesCount    = 0;\r\n\r\n\t\t\t\t\twhile ((verticesCount <= (maxVerticesCount - 3)) && (facesLeft > 0)) {\r\n\t\t\t\t\t\tfor (var k=0; k<3; ++k, ++currFaceIndex) {\r\n\t\t\t\t\t\t\tvar v = indexBufferView[currFaceIndex];\r\n\t\t\t\t\t\t\tvar r = verticesMap[v];\r\n\t\t\t\t\t\t\tif (!r) {\r\n\t\t\t\t\t\t\t\tverticesNew[verticesCount++] = v;\r\n\t\t\t\t\t\t\t\tverticesMap[v] = verticesCount;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tindicesBuffer[indicesCount++] = v;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfacesLeft--;\r\n\t\t\t\t\t\tfacesCount++;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (facesCount <= 0) continue;\r\n\r\n\t\t\t\t\tvar chunkVertexBuffer     = new ArrayBuffer(verticesCount * stride);\r\n\t\t\t\t\tvar chunkVertexBufferView = new Uint8Array(chunkVertexBuffer);\r\n\t\t\t\t\tvar chunkIndexBuffer      = new Uint16Array(indicesCount);\r\n\r\n\t\t\t\t\tfor (var i=0; i<indicesCount; ++i) {\r\n\t\t\t\t\t\tchunkIndexBuffer[i] = verticesMap[indicesBuffer[i]] - 1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar s = 0;\r\n\t\t\t\t\tfor (var i=0, d=0; i<verticesCount; ++i, d+=stride) {\r\n\t\t\t\t\t\ts = verticesNew[i] * stride;\r\n\t\t\t\t\t\tchunkVertexBufferView.set(vertexBufferView.subarray(s, s + stride), d);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tchunkVertexBuffers.push(chunkVertexBuffer);\r\n\t\t\t\t\tchunkVerticesCount.push(verticesCount);\r\n\t\t\t\t\tchunkIndexBuffers.push(chunkIndexBuffer);\r\n\t\t\t\t\tchunkIndicesCount.push(indicesCount);\r\n\t\t\t\t\tchunksCount++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar partChunks = new Array(chunksCount);\r\n\r\n\t\t\t\tfor (var i=0; i<chunksCount; ++i) {\r\n\t\t\t\t\tvar vertexBufferName = baseVertexBufferName + i;\r\n\t\t\t\t\tvar indexBufferName  = baseIndexBufferName  + i;\r\n\t\t\t\t\tvar bindingName      = baseBindingName      + i;\r\n\t\t\t\t\tvar chunkName        = baseChunkName        + i;\r\n\r\n\t\t\t\t\tmodelVertexBuffers[vertexBufferName] = {\r\n\t\t\t\t\t\ttypedArray : chunkVertexBuffers[i]\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar binding = {\r\n\t\t\t\t\t\tvertexStreams : {\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tprimitiveStreams : {\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tmodelBindings[bindingName] = binding;\r\n\r\n\t\t\t\t\tfor (var a in this._vertexAttributes) {\r\n\t\t\t\t\t\tvar attr = this._vertexAttributes[a];\r\n\t\t\t\t\t\tvar vertexStreamName = a + i;\r\n\t\t\t\t\t\tmodelVertexStreams[vertexStreamName] = {\r\n\t\t\t\t\t\t\tbuffer : vertexBufferName,\r\n\t\t\t\t\t\t\tsize   : attr.size,\r\n\t\t\t\t\t\t\ttype   : attr.type,\r\n\t\t\t\t\t\t\tstride : this._vertexStride,\r\n\t\t\t\t\t\t\toffset : attr.offset,\r\n\t\t\t\t\t\t\tnormalized : !!attr.normalized\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbinding.vertexStreams[a.toUpperCase()] = [vertexStreamName];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmodelIndexBuffers[indexBufferName] = {\r\n\t\t\t\t\t\ttypedArray : chunkIndexBuffers[i]\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar pointStreamName = basePointStreamName + i;\r\n\t\t\t\t\tmodelPrimitiveStreams[pointStreamName] = {\r\n\t\t\t\t\t\tmode  : SpiderGL.Type.POINTS,\r\n\t\t\t\t\t\tcount : chunkVerticesCount[i]\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbinding.primitiveStreams[\"POINT\"] = [pointStreamName];\r\n\r\n\t\t\t\t\tvar triStreamName = baseTriStreamName + i;\r\n\t\t\t\t\tmodelPrimitiveStreams[triStreamName] = {\r\n\t\t\t\t\t\tbuffer : indexBufferName,\r\n\t\t\t\t\t\tmode   : SpiderGL.Type.TRIANGLES,\r\n\t\t\t\t\t\tcount  : chunkIndicesCount[i],\r\n\t\t\t\t\t\ttype   : SpiderGL.Type.UINT16,\r\n\t\t\t\t\t\toffset : 0\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbinding.primitiveStreams[\"FILL\"] = [triStreamName];\r\n\r\n\t\t\t\t\tvar chunk = {\r\n\t\t\t\t\t\ttechniques : {\r\n\t\t\t\t\t\t\t\"common\" : {\r\n\t\t\t\t\t\t\t\tbinding : bindingName\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tmodelChunks[chunkName] = chunk;\r\n\r\n\t\t\t\t\tpartChunks[i] = chunkName;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodelParts[basePartName] = {\r\n\t\t\t\t\tchunks : partChunks\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar binding = {\r\n\t\t\t\t\tvertexStreams : {\r\n\t\t\t\t\t},\r\n\t\t\t\t\tprimitiveStreams : {\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tmodelBindings[baseBindingName] = binding;\r\n\r\n\t\t\t\tif (this._verticesCount > 0) {\r\n\t\t\t\t\tvar vertexBufferName = baseVertexBufferName;\r\n\t\t\t\t\tmodelVertexBuffers[vertexBufferName] = {\r\n\t\t\t\t\t\ttypedArray : this._vertexBuffer\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tfor (var a in this._vertexAttributes) {\r\n\t\t\t\t\t\tvar attr = this._vertexAttributes[a];\r\n\t\t\t\t\t\tmodelVertexStreams[a] = {\r\n\t\t\t\t\t\t\tbuffer : vertexBufferName,\r\n\t\t\t\t\t\t\tsize   : attr.size,\r\n\t\t\t\t\t\t\ttype   : attr.type,\r\n\t\t\t\t\t\t\tstride : this._vertexStride,\r\n\t\t\t\t\t\t\toffset : attr.offset,\r\n\t\t\t\t\t\t\tnormalized : !!attr.normalized\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbinding.vertexStreams[a.toUpperCase()] = [a];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmodelPrimitiveStreams[basePointStreamName] = {\r\n\t\t\t\t\t\tmode   : SpiderGL.Type.POINTS,\r\n\t\t\t\t\t\tcount  : this._verticesCount\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbinding.primitiveStreams[\"POINT\"] = [basePointStreamName];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ((this._verticesCount > 0) || (this._facesCount > 0)) {\r\n\t\t\t\t\tmodelChunks[baseChunkName] = {\r\n\t\t\t\t\t\ttechniques : {\r\n\t\t\t\t\t\t\t\"common\" : {\r\n\t\t\t\t\t\t\t\tbinding : baseBindingName\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tmodelParts[basePartName] = {\r\n\t\t\t\t\t\tchunks : [baseChunkName]\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._modelDescriptor = modelDescriptor;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction mainImportPly(buffer, gl) {\r\n\t\tvar handler = new PlyHandler(buffer, gl);\r\n\t\tparsePly(buffer, handler);\r\n\t\tvar modelDescriptor = handler.modelDescriptor;\r\n\t\treturn modelDescriptor;\r\n\t};\r\n\r\n\treturn mainImportPly;\r\n})();\r\n","/*\n3DHOP - 3D Heritage Online Presenter\nCopyright (c) 2014, Marco Callieri - Visual Computing Lab, ISTI - CNR\nAll rights reserved.    \n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/**\n * Constructs a PanTiltTrackball object.\n * @class Interactor which implements a pan-tilt trackball controller with bounds.\n */\nfunction PanTiltTrackball() {\n}\n\nPanTiltTrackball.prototype = {\n\n\tsetup : function (options) {\n\t\toptions = options || {};\n\t\tvar opt = sglGetDefaultObject({\n\t\t\tstartCenter   : [ 0.0, 0.0, 0.0 ],\n\t\t\tstartPanX     : 0.0,\n\t\t\tstartPanY     : 0.0,\n\t\t\tstartAngleX   : 0.0,\n\t\t\tstartAngleY   : 0.0,\n\t\t\tstartDistance : 2.0,\n\t\t\tminMaxDist    : [0.2, 4.0],\n\t\t\tminMaxPanX    : [-0.7, 0.7],\n\t\t\tminMaxPanY    : [-0.7, 0.7],\n\t\t\tminMaxAngleX  : [-70.0, 70.0],\n\t\t\tminMaxAngleY  : [-70.0, 70.0],\n\t\t}, options);\n\t\t\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION;\n\t\tthis._new_action = true;\n\n\t\tthis._matrix = SglMat4.identity();\n\n\t\t// trackball center\t\t\n\t\tthis._center = opt.startCenter;\n\t\t\n\t\t// starting/default parameters\n\t\tthis._startPanX = opt.startPanX;\t\t\t\t\t//pan X\n\t\tthis._startPanY = opt.startPanY;\t\t\t\t\t//pan Y\t\t\n\t\tthis._startAngleX = sglDegToRad(opt.startAngleX);\t//angle X\n\t\tthis._startAngleY = sglDegToRad(opt.startAngleY);\t//angle Y\n\t\tthis._startDistance = opt.startDistance;   \t\t\t//distance\n\n\t\t// current parameters\n\t\tthis._panX = this._startPanX;\n\t\tthis._panY = this._startPanY;\n\t\tthis._angleX = this._startAngleX;\n\t\tthis._angleY = this._startAngleY;\n\t\tthis._distance = this._startDistance;\n\t\t\n\t\t// target paramenters\n\t\tthis._targetPanX = this._startPanX;\n\t\tthis._targetPanY = this._startPanY;\n\t\tthis._targetAngleX = this._startAngleX;\n\t\tthis._targetAngleY = this._startAngleY;\n\t\tthis._targetDistance = this._startDistance; \n\t\t\n\t\t//animation data\n\t\tthis._isAnimating = false;\n\t\tthis._speedPanX = 0.0;\n\t\tthis._speedPanY = 0.0;\n\t\tthis._speedAngleX = 0.0;\n\t\tthis._speedAngleY = 0.0;\n\t\tthis._speedDistance = 0.0;\n\t\t\n\t\t//limits\n\t\tthis._minMaxDist  = opt.minMaxDist;\n\t\tthis._minMaxPanX   = opt.minMaxPanX;\n\t\tthis._minMaxPanY   = opt.minMaxPanY;\t\t\n\t\tthis._minMaxAngleX = opt.minMaxAngleX;\n\t\tthis._minMaxAngleX[0] = sglDegToRad(this._minMaxAngleX[0]);\n\t\tthis._minMaxAngleX[1] = sglDegToRad(this._minMaxAngleX[1]);\n\t\tthis._minMaxAngleY = opt.minMaxAngleY;\n\t\tthis._minMaxAngleY[0] = sglDegToRad(this._minMaxAngleY[0]);\n\t\tthis._minMaxAngleY[1] = sglDegToRad(this._minMaxAngleY[1]);\n\t\t\n\t\tthis._start = [0.0, 0.0];\n\t\tthis.reset();\n\t},\n\n    clamp: function(value, low, high) {\n      if(value < low) return low;\n      if(value > high) return high;\n      return value;\n    },\n\n    _computeMatrix: function() {\n      var m = SglMat4.identity();\n\t  \t  \n\t  // centering\n\t  m = SglMat4.mul(m, SglMat4.translation([-this._center[0], -this._center[1], -this._center[2]]));\t  \n\t  \n\t  // zoom\n\t  m = SglMat4.mul(m, SglMat4.translation([0.0, 0.0, -this._distance]));\n\t  \n\t  // tilt\n      m = SglMat4.mul(m, SglMat4.rotationAngleAxis(this._angleY, [1.0, 0.0, 0.0]));\t  \n      m = SglMat4.mul(m, SglMat4.rotationAngleAxis(this._angleX, [0.0, -1.0, 0.0]));\n\n\t  // pan\n      m = SglMat4.mul(m, SglMat4.translation([this._panX, this._panY, 0.0]));\n\t  \n      this._matrix = m;\t\t\n    },\n\n\tgetState : function () {\n\t\treturn [this._panX, this._panY, sglRadToDeg(this._angleX), sglRadToDeg(this._angleY), this._distance];\n\t},\n\n\tsetState : function (newstate) {\n\t\tthis._panX     = newstate[0];\n\t\tthis._panY     = newstate[1];\n\t\tthis._angleX   = sglDegToRad(newstate[2]);\n\t\tthis._angleY   = sglDegToRad(newstate[3]);\n\t\tthis._distance = newstate[4];\t\n\n\t\t//check limits\n\t\tthis._panX = this.clamp(this._panX, this._minMaxPanX[0], this._minMaxPanX[1]);\n\t\tthis._panY = this.clamp(this._panY, this._minMaxPanY[0], this._minMaxPanY[1]);\n\t\tthis._angleX = this.clamp(this._angleX, this._minMaxAngleX[0], this._minMaxAngleX[1]);\n\t\tthis._angleY = this.clamp(this._angleY, this._minMaxAngleY[0], this._minMaxAngleY[1]);\n\t\tthis._distance = this.clamp(this._distance, this._minMaxDist[0], this._minMaxDist[1]);\n\t\t\n\t\tthis._computeMatrix();\t\t\n\t},\n\t\n\tanimateToState : function (newstate) {\n\t\t// stop animation\n\t\tthis._isAnimating = false;\n\t\t\n\t\tthis._targetPanX = newstate[0];\n\t\tthis._targetPanY = newstate[1];\n\t\tthis._targetAngleX = sglDegToRad(newstate[2]);\n\t\tthis._targetAngleY = sglDegToRad(newstate[3]);\n\t\tthis._targetDistance = newstate[4]; \t\t\n\t\t\n\t\t//check limits\n\t\tthis._targetPanX = this.clamp(this._targetPanX, this._minMaxPanX[0], this._minMaxPanX[1]);\n\t\tthis._targetPanY = this.clamp(this._targetPanY, this._minMaxPanY[0], this._minMaxPanY[1]);\n\t\tthis._targetAngleX = this.clamp(this._targetAngleX, this._minMaxAngleX[0], this._minMaxAngleX[1]);\n\t\tthis._targetAngleY = this.clamp(this._targetAngleY, this._minMaxAngleY[0], this._minMaxAngleY[1]);\n\t\tthis._targetDistance = this.clamp(this._targetDistance, this._minMaxDist[0], this._minMaxDist[1]);\t\t\n\n\t\t// setting base velocities \n\t\tthis._speedPanX = 2.0;\n\t\tthis._speedPanY = 2.0;\n\t\tthis._speedAngleX = Math.PI;\n\t\tthis._speedAngleY = Math.PI;\n\t\tthis._speedDistance = 2.0;\n\t\t\n\t\t// find max animation time to set a time limit and then synchronize all movements\n\t\t\n\t\tvar timePanX = Math.abs((this._targetPanX - this._panX) / this._speedPanX);\n\t\tvar timePanY = Math.abs((this._targetPanY - this._panY) / this._speedPanY);\n\t\tvar timeAngleX = Math.abs((this._targetAngleX - this._angleX) / this._speedAngleX);\n\t\tvar timeAngleY = Math.abs((this._targetAngleY - this._angleY) / this._speedAngleY);\n\t\tvar timeDistance = Math.abs((this._targetDistance - this._distance) / this._speedDistance);\n\t\t\n\t\tvar maxtime = Math.max( timePanX, Math.max( timePanY, Math.max( timeAngleX, Math.max( timeAngleY, timeDistance ) ) ));\n\t\t\n\t\tif (maxtime > 1.0)\n\t\t\tmaxtime = 1.0;\n\t\t\t\n\t\tthis._speedPanX *= timePanX / maxtime;\n\t\tthis._speedPanY *= timePanY / maxtime;\n\t\tthis._speedAngleX *= timeAngleX / maxtime;\n\t\tthis._speedAngleY *= timeAngleY / maxtime;\n\t\tthis._speedDistance *= timeDistance / maxtime;\t\n\t\t\n\t\t// start animation\n\t\tthis._isAnimating = true;\n\t},\t\n\t\n\ttick : function (dt) {\n\t\tif(!this._isAnimating) return false;\n\t\t\n\t\tvar deltaPanX = this._speedPanX * dt;\n\t\tvar deltaPanY = this._speedPanY * dt;\n\t\tvar deltaAngleX = this._speedAngleX * dt;\n\t\tvar deltaAngleY = this._speedAngleY * dt;\t\t\n\t\tvar deltaDistance = this._speedDistance * dt;\n\t\t\n\t\tvar diffPanX = this._targetPanX - this._panX;\n\t\tvar diffPanY = this._targetPanY - this._panY;\n\t\tvar diffAngleX = this._targetAngleX - this._angleX;\n\t\tvar diffAngleY = this._targetAngleY - this._angleY;\t\t\n\t\tvar diffDistance = this._targetDistance - this._distance;\n\n\t\tif (diffPanX > deltaPanX) \n\t\t\tthis._panX += deltaPanX;\n\t\telse if (diffPanX < -deltaPanX) \n\t\t\tthis._panX -= deltaPanX;\n\t\telse \n\t\t\tthis._panX = this._targetPanX;\n\t\t\n\t\tif (diffPanY > deltaPanY) \n\t\t\tthis._panY += deltaPanY;\n\t\telse if (diffPanY < -deltaPanY) \n\t\t\tthis._panY -= deltaPanY;\n\t\telse \n\t\t\tthis._panY = this._targetPanY;\n\t\t\n\t\tif (diffAngleX > deltaAngleX) \n\t\t\tthis._angleX += deltaAngleX;\n\t\telse if (diffAngleX < -deltaAngleX) \n\t\t\tthis._angleX -= deltaAngleX;\n\t\telse \n\t\t\tthis._angleX = this._targetAngleX;\n\t\t\n\t\tif (diffAngleY > deltaAngleY) \n\t\t\tthis._angleY += deltaAngleY;\n\t\telse if (diffAngleY < -deltaAngleY) \n\t\t\tthis._angleY -= deltaAngleY;\n\t\telse \n\t\t\tthis._angleY = this._targetAngleY;\n\t\t\t\n\t\tif (diffDistance > deltaDistance) \n\t\t\tthis._distance += deltaDistance;\n\t\telse if (diffDistance < -deltaDistance) \n\t\t\tthis._distance -= deltaDistance;\n\t\telse \n\t\t\tthis._distance = this._targetDistance;\t\t\n\t\t\t\n\t\tif(this._panX == this._targetPanX)\n\t\t\tif(this._panX == this._targetPanX)\n\t\t\t\tif(this._angleX == this._targetAngleX)\n\t\t\t\t\tif(this._angleY == this._targetAngleY)\n\t\t\t\t\t\tif(this._distance == this._targetDistance)\n\t\t\t\t\t\t\tthis._isAnimating = false;\n\t\t\n\t\tthis._computeMatrix();\t\t\n\t\treturn true;\n\t},\t\n\t\n\tget action()  { return this._action; },\n\t\n\tset action(a) { if(this._action != a) this._new_action = true; this._action = a; },\n\n\tget matrix() { return this._matrix; },\n\n\treset : function () {\n\t\tthis._matrix = SglMat4.identity();\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION\n\t\t\n\t\tthis._panX = this._startPanX;\n\t\tthis._panY = this._startPanY;\n\t\tthis._angleX = this._startAngleX;\n\t\tthis._angleY = this._startAngleY;\n\t\tthis._distance = this._startDistance;\n\n\t\tthis._isAnimating = false;\t\t\n\t},\n\n\ttrack : function(m, x, y, z) {\n        if(this._new_action) {\n            this._start[0] = x;\n\t\t    this._start[1] = y;\n            this._new_action = false;\n        } \t\t\n\n        var dx = this._start[0] - x; \n        var dy = this._start[1] - y;\n        this._start[0] = x;\n        this._start[1] = y;\n        \n\t\tswitch (this._action) {\n\t\t\tcase SGL_TRACKBALL_ROTATE:\n\t\t\t\tthis._isAnimating = false; //stopping animation\n\t\t\t\tthis.rotate(m, dx, dy);\n\t\t\tbreak;\n\n\t\t\tcase SGL_TRACKBALL_PAN:\n\t\t\t\tthis._isAnimating = false; //stopping animation\n\t\t\t\tthis.pan(m, dx, dy);\n\t\t\tbreak;\n\n\t\t\tcase SGL_TRACKBALL_SCALE:\n\t\t\t\tthis._isAnimating = false; //stopping animation\n\t\t\t\tthis.scale(m, z);\n\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\tbreak;\n\t\t}\n        return this._computeMatrix();\n\t},\n\t\n    rotate: function(m, dx, dy) {\n      this._angleX += dx;\n      this._angleY += dy;\n      this._angleX = this.clamp(this._angleX, this._minMaxAngleX[0], this._minMaxAngleX[1]);\n      this._angleY = this.clamp(this._angleY, this._minMaxAngleY[0], this._minMaxAngleY[1]);\n    },\n\n    pan: function(m, dx, dy) {\n      this._panX -= dx/2.0;\n      this._panY -= dy/2.0;\n      this._panX = this.clamp(this._panX, this._minMaxPanX[0], this._minMaxPanX[1]);\n      this._panY = this.clamp(this._panY, this._minMaxPanY[0], this._minMaxPanY[1]);\n    },\t\n\t\n\tscale : function(m, s) {\n        this._distance *= s;\n\t\tthis._distance = this.clamp(this._distance, this._minMaxDist[0], this._minMaxDist[1]);\t\t\t\n\t}\n};\n/***********************************************************************/\n","/*\r\n3DHOP - 3D Heritage Online Presenter\r\nCopyright (c) 2014, Marco Callieri - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.    \r\n\r\nThis program is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nThis program is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n/**\r\n * Constructs a SphereTrackball object.\r\n * @class Interactor which implements a full spherical trackball controller.\r\n */\r\nfunction SphereTrackball() {\r\n}\r\n\r\nSphereTrackball.prototype = {\r\n\r\n\tsetup : function (options) {\r\n\t\toptions = options || {};\r\n\t\tvar opt = sglGetDefaultObject({\r\n\t\t\tstartCenter   : [ 0.0, 0.0, 0.0 ],\r\n\t\t\tstartDistance : 2.0,\r\n\t\t\tminMaxDist    : [0.2, 4.0],\r\n\t\t}, options);\r\n\r\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION;\r\n\t\tthis._new_action = true;\r\n\r\n\t\t// starting/default parameters\r\n\t\tthis._startDistance = opt.startDistance; //distance\r\n\r\n\t\t// current parameters\r\n\t\tthis._distance = this._startDistance;\r\n\r\n\t\t//limits\r\n\t\tthis._minMaxDist  = opt.minMaxDist;\r\n\t\t\r\n\t\tthis._matrix = SglMat4.identity();\r\n\t\tthis._sphereMatrix = SglMat4.identity();\r\n\r\n\t\tthis._pts    = [ [0.0, 0.0], [0.0, 0.0] ];\r\n\t\tthis._start = [0.0, 0.0];\r\n\r\n\t\tthis.reset();\r\n\t},\r\n\r\n    clamp: function(value, low, high) {\r\n      if(value < low) return low;\r\n      if(value > high) return high;\r\n      return value;\r\n    },\r\n\r\n    _computeMatrix: function() {\r\n      var m = SglMat4.identity();  \r\n\t  \r\n\t  // zoom\r\n\t  m = SglMat4.mul(m, SglMat4.translation([0.0, 0.0, -this._distance]));\r\n\t  \r\n\t  // spheretrack\r\n      m = SglMat4.mul(m, this._sphereMatrix); \r\n\r\n      this._matrix = m;\r\n    },\r\n\r\n\t_projectOnSphere : function(x, y) {\r\n\t\tvar r = 1.0;\r\n\r\n\t\tvar z = 0.0;\r\n\t\tvar d = sglSqrt(x*x + y*y);\r\n\t\tif (d < (r * 0.70710678118654752440)) {\r\n\t\t\t/* Inside sphere */\r\n\t\t\tz = sglSqrt(r*r - d*d);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t/* On hyperbola */\r\n\t\t\tt = r / 1.41421356237309504880;\r\n\t\t\tz = t*t / d;\r\n\t\t}\r\n\t\treturn z;\r\n\t},\r\n\r\n\t_transform : function(m, x, y, z) {\r\n\t\treturn SglMat4.mul4(m, [x, y, z, 0.0]);\r\n\t},\r\n\r\n\t_transformOnSphere : function(m, x, y) {\r\n\t\tvar z = this._projectOnSphere(x, y);\r\n\t\treturn this._transform(m, x, y, z);\r\n\t},\r\n\r\n\t_translate : function(offset, f) {\r\n\t\tvar invMat = SglMat4.inverse(this._sphereMatrix);\r\n\t\tvar t = SglVec3.to4(offset, 0.0);\r\n\t\tt = SglMat4.mul4(invMat, t);\r\n\t\tt = SglVec4.muls(t, f);\r\n\t\tvar trMat = SglMat4.translation(t);\r\n\t\tthis._sphereMatrix = SglMat4.mul(this._sphereMatrix, trMat);\r\n\t},\r\n\r\n\tgetState : function () {\r\n\t\treturn this._sphereMatrix;\r\n\t},\r\n\r\n\tsetState : function (newstate) {\r\n\t\tthis._sphereMatrix = newstate;\r\n\t\tthis._computeMatrix();\r\n\t},\r\n\t\r\n\tanimateToState : function (newstate) {\r\n\t\tthis._sphereMatrix = newstate;\r\n\t\tthis._computeMatrix();\r\n\t},\r\n\r\n\tget action()  { return this._action; },\r\n\r\n\tset action(a) { if(this._action != a) this._new_action = true; this._action = a; },\r\n\r\n\tget matrix() { return this._matrix; },\r\n\r\n\treset : function () {\r\n\t\tthis._matrix = SglMat4.identity();\r\n\t\tthis._sphereMatrix = SglMat4.identity();\r\n\t\t\r\n\t\tthis._distance = this._startDistance;\r\n\t\t\r\n\t\tthis._pts    = [ [0.0, 0.0], [0.0, 0.0] ];\r\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION;\r\n\t\tthis._new_action = true;\r\n\r\n\t\tthis._computeMatrix();\r\n\t},\r\n\r\n\ttrack : function(m, x, y, z) {\r\n\r\n        if(this._new_action) {\r\n            this._start[0] = x;\r\n            this._start[1] = y;\r\n            this._new_action = false;\r\n        }\r\n\r\n        var dx = this._start[0] - x; \r\n        var dy = this._start[1] - y;\r\n        this._start[0] = x;\r\n        this._start[1] = y;\r\n\r\n\t\tthis._pts[0][0] = this._pts[1][0] + dx;\r\n\t\tthis._pts[0][1] = this._pts[1][1] + dy;\r\n\t\tthis._pts[1][0] = dx;\r\n\t\tthis._pts[1][1] = dy;\r\n\r\n\t\tswitch (this._action) {\r\n\t\t\tcase SGL_TRACKBALL_ROTATE:\r\n\t\t\t\tthis.rotate(m);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_PAN:\r\n\t\t\t\tthis.pan(m);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_DOLLY:\r\n\t\t\t\tthis.dolly(m, z);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_SCALE:\r\n\t\t\t\tthis.scale(m, z);\r\n\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\trotate : function(m) {\r\n\t\tif ((this._pts[0][0] == this._pts[1][0]) && (this._pts[0][1] == this._pts[1][1])) return;\r\n\r\n\t\tvar mInv = SglMat4.inverse(m);\r\n\r\n\t\tvar v0 = this._transformOnSphere(mInv, this._pts[0][0], this._pts[0][1]);\r\n\t\tvar v1 = this._transformOnSphere(mInv, this._pts[1][0], this._pts[1][1]);\r\n\t\tvar v1 = this._transformOnSphere(mInv, this._pts[1][0], this._pts[1][1]);\r\n\t\tvar v1 = this._transformOnSphere(mInv, this._pts[1][0], this._pts[1][1]);\r\n\r\n\t\tvar axis   = SglVec3.cross(v0, v1);\r\n\t\tvar angle  = SglVec3.length(axis);\r\n\t\tvar rotMat = SglMat4.rotationAngleAxis(angle, axis);\r\n\r\n\t\tthis._sphereMatrix = SglMat4.mul(rotMat, this._sphereMatrix);\r\n\t\tthis._computeMatrix();\r\n\t},\r\n\r\n\tpan : function(m) {\r\n\t\tvar mInv = SglMat4.inverse(m);\r\n\t\tvar v0 = this._transform(mInv, this._pts[0][0], this._pts[0][1], -1.0);\r\n\t\tvar v1 = this._transform(mInv, this._pts[1][0], this._pts[1][1], -1.0);\r\n\t\tvar offset = SglVec3.sub(v1, v0);\r\n\t\tthis._translate(offset, 2.0);\r\n\t\tthis._computeMatrix();\r\n\t},\r\n\r\n\tdolly : function(m, dz) {\r\n\t\tvar mInv = SglMat4.inverse(m);\r\n\t\tvar offset = this._transform(mInv, 0.0, 0.0, dz);\r\n\t\tthis._translate(offset, 1.0);\r\n\t\tthis._computeMatrix();\r\n\t},\r\n\r\n\tscale : function(m, s) {\r\n\t\tthis._distance *= s;\r\n\t\tthis._distance = this.clamp(this._distance, this._minMaxDist[0], this._minMaxDist[1]);\r\n\t\tthis._computeMatrix();\r\n\t}\r\n};\r\n/***********************************************************************/\r\n","/*\n3DHOP - 3D Heritage Online Presenter\nCopyright (c) 2014, Marco Callieri - Visual Computing Lab, ISTI - CNR\nAll rights reserved.    \n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/**\n * Constructs a TurntableTrackball object.\n * @class Interactor which implements a Turntable controller with bounds.\n */\nfunction TurnTableTrackball() {\n}\n\nTurnTableTrackball.prototype = {\n\n\tsetup : function (options) {\n\t\toptions = options || {};\n\t\tvar opt = sglGetDefaultObject({\n\t\t\tstartCenter   : [ 0.0, 0.0, 0.0 ],\n\t\t\tstartPhi      : 0.0,\n\t\t\tstartTheta    : 0.0,\n\t\t\tstartDistance : 2.0,\n\t\t\tminMaxDist    : [0.2, 4.0],\n\t\t\tminMaxPhi     : [-180, 180],\n\t\t\tminMaxTheta   : [-80.0, 80.0],\n\t\t}, options);\n\t\t\n\t\t\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION;\n\t\tthis._new_action = true;\n\n\t\tthis._matrix = SglMat4.identity();\n\n\t\t// trackball center\n\t\tthis._center = opt.startCenter;\n\t\t\n\t\t// starting/default parameters\n\t\tthis._startPhi = sglDegToRad(opt.startPhi);   \t//phi (horizontal rotation)\n\t\tthis._startTheta = sglDegToRad(opt.startTheta);\t//theta (vertical rotation)\n\t\tthis._startDistance = opt.startDistance;   \t\t//distance\n\n\t\t// current parameters\n\t\tthis._phi = this._startPhi;\n\t\tthis._theta = this._startTheta;\n\t\tthis._distance = this._startDistance;\n\t\t\n\t\t// target paramenters\n\t\tthis._targetPhi = this._startPhi;\n\t\tthis._targetTheta = this._startTheta;\n\t\tthis._targetDistance = this._startDistance; \n\t\t\n\t\t//animation data\n\t\tthis._isAnimating = false;\n\t\tthis._speedPhi = 0.0;\n\t\tthis._speedTheta = 0.0;\t\t\n\t\tthis._speedDistance = 0.0;\n\n\t\t// limits\n\t\tthis._minMaxDist  = opt.minMaxDist;\n\t\tif((opt.minMaxPhi[0] == -180)&&(opt.minMaxPhi[1] == 180))\n\t\t\tthis._limitPhi = false;\t\t\n\t\telse\n\t\t\tthis._limitPhi = true;\t\t\n\t\tthis._minMaxPhi   = opt.minMaxPhi;\n\t\tthis._minMaxPhi[0] = sglDegToRad(this._minMaxPhi[0]);\n\t\tthis._minMaxPhi[1] = sglDegToRad(this._minMaxPhi[1]);\n\t\tthis._minMaxTheta = opt.minMaxTheta;\t\t\n\t\tthis._minMaxTheta[0] = sglDegToRad(this._minMaxTheta[0]);\n\t\tthis._minMaxTheta[1] = sglDegToRad(this._minMaxTheta[1]);\n\t\t\n\t\tthis._start = [0.0, 0.0];\n\t\tthis.reset();\n\t},\n\n    clamp: function(value, low, high) {\n      if(value < low) return low;\n      if(value > high) return high;\n      return value;\n    },\n\n    _computeMatrix: function() {\n      var m = SglMat4.identity();\n\t  \t  \n\t  // centering\n\t  m = SglMat4.mul(m, SglMat4.translation([-this._center[0], -this._center[1], -this._center[2]]));\t  \n\t  \n\t  // zoom\n\t  m = SglMat4.mul(m, SglMat4.translation([0.0, 0.0, -this._distance]));\n\t  \n  \t  // rotation\n      m = SglMat4.mul(m, SglMat4.rotationAngleAxis(this._theta, [1.0, 0.0, 0.0]));\t  \n  \n\t  // tilt\n      m = SglMat4.mul(m, SglMat4.rotationAngleAxis(this._phi, [0.0, -1.0, 0.0]));\n\t  \n      this._matrix = m;\t\n    },\n\n\tgetState : function () {\n\t\treturn [sglRadToDeg(this._phi), sglRadToDeg(this._theta), this._distance];\n\t},\n\n\tsetState : function (newstate) {\n\t\t// stop animation\n\t\tthis._isAnimating = false;\t\t\n\t\t\n\t\tthis._phi      = sglDegToRad(newstate[0]);\n\t\tthis._theta    = sglDegToRad(newstate[1]);\t\t\n\t\tthis._distance = newstate[2];\n\t\t\n\t\t//check limits\n\t\tif(this._limitPhi)\n\t\t\tthis._phi = this.clamp(this._phi, this._minMaxPhi[0], this._minMaxPhi[1]);\t  \n\t\tthis._theta = this.clamp(this._theta, this._minMaxTheta[0], this._minMaxTheta[1]);\t\t\n\t\tthis._distance = this.clamp(this._distance, this._minMaxDist[0], this._minMaxDist[1]);\n\t\t\n\t\tthis._computeMatrix();\t\t\n\t},\t\n\n\tanimateToState : function (newstate) {\n\t\t// stop animation\n\t\tthis._isAnimating = false;\n\t\t\n\t\tthis._targetPhi = sglDegToRad(newstate[0]);\n\t\tthis._targetTheta = sglDegToRad(newstate[1]);\n\t\tthis._targetDistance = newstate[2];\n\n\t\t//check limits\n\t\tif(this._limitPhi)\n\t\t\tthis._targetPhi = this.clamp(this._targetPhi, this._minMaxPhi[0], this._minMaxPhi[1]);\t  \n\t\tthis._targetTheta = this.clamp(this._targetTheta, this._minMaxTheta[0], this._minMaxTheta[1]);\t\t\n\t\tthis._targetDistance = this.clamp(this._targetDistance, this._minMaxDist[0], this._minMaxDist[1]);\t\t\n\t\t\n\t\t// setting base velocities \n\t\tthis._speedPhi = Math.PI;\t\t\n\t\tthis._speedTheta = Math.PI;\t\n\t\tthis._speedDistance = 2.0;\t\t\n\t\t\n\t\t//if phi unconstrained rotation, it is necessary to find a good rotation direction\n\t\tif(!this._limitPhi){ \n\t\t\t// clamp current phi angle, to prevent endless unwinding\n\t\t\twhile(this._phi > 2*Math.PI)\n\t\t\t\tthis._phi -= 2*Math.PI;\n\t\t\twhile(this._phi < 0) \n\t\t\t\tthis._phi += 2*Math.PI;\t\n\t\t\t\t\n\t\t\t// determine minimal, clamped target phi angle\n\t\t\tvar clampedangle = this._targetPhi;\n\t\t\twhile(clampedangle > 2*Math.PI)\n\t\t\t\tclampedangle -= 2*Math.PI;\n\t\t\twhile(clampedangle < 0) \n\t\t\t\tclampedangle += 2*Math.PI;\n\t\t\t\n\t\t\tif(Math.abs(clampedangle - this._phi) < Math.PI) { // standard rotation\n\t\t\t\tif(clampedangle > this._phi){\n\t\t\t\t\tthis.speedphi = Math.PI;\t\t\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tthis.speedphi = -Math.PI;\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(clampedangle > this._phi){\n\t\t\t\t\tclampedangle = (clampedangle - 2*Math.PI)\n\t\t\t\t\tthis.speedphi = -Math.PI;\t\t\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tclampedangle = (clampedangle + 2*Math.PI)\t\t\t\n\t\t\t\t\tthis.speedphi = Math.PI;\t\t\n\t\t\t\t}\t\t\n\t\t\t}\t\t\n\n\t\t\tthis._targetPhi = clampedangle;\n\t\t}\n\n\t\t// find max animation time to set a time limit and then synchronize all movements\t\t\n\t\tvar timePhi      = Math.abs((this._targetPhi - this._phi) / this._speedPhi);\n\t\tvar timeTheta    = Math.abs((this._targetTheta - this._theta) / this._speedTheta);\n\t\tvar timeDistance = Math.abs((this._targetDistance - this._distance) / this._speedDistance);\n\n\t\tvar maxtime = Math.max( timePhi, Math.max( timeTheta, timeDistance ));\n\t\t\n\t\tif (maxtime > 1.0)\n\t\t\tmaxtime = 1.0;\n\t\t\t\n\t\tthis._speedPhi *= timePhi / maxtime;\n\t\tthis._speedTheta *= timeTheta / maxtime;\n\t\tthis._speedDistance *= timeDistance / maxtime;\t\t\t\n\t\t\n\t\t// start animation\n\t\tthis._isAnimating = true;\n\t},\n\t\n\ttick : function (dt) {\n\t\tif(!this._isAnimating) return false;\n\t\t\n\t\tvar deltaPhi      = this._speedPhi * dt;\n\t\tvar deltaTheta    = this._speedTheta * dt;\n\t\tvar deltaDistance = this._speedDistance * dt;\n\t\t\n\t\tvar diffPhi      = this._targetPhi - this._phi;\n\t\tvar diffTheta    = this._targetTheta - this._theta;\n\t\tvar diffDistance = this._targetDistance - this._distance;\n\t\t\t\t\n\t\tif (diffPhi > deltaPhi) \n\t\t\tthis._phi += deltaPhi;\n\t\telse if (diffPhi < -deltaPhi) \n\t\t\tthis._phi -= deltaPhi;\n\t\telse \n\t\t\tthis._phi = this._targetPhi;\t\t\t\n\t\t\t\n\t\tif (diffTheta > deltaTheta) \n\t\t\tthis._theta += deltaTheta;\n\t\telse if (diffTheta < -deltaTheta) \n\t\t\tthis._theta -= deltaTheta;\n\t\telse \n\t\t\tthis._theta = this._targetTheta;\n\n\t\tif (diffDistance > deltaDistance) \n\t\t\tthis._distance += deltaDistance;\n\t\telse if (diffDistance < -deltaDistance) \n\t\t\tthis._distance -= deltaDistance;\n\t\telse \n\t\t\tthis._distance = this._targetDistance;\t\t\n\t\t\t\n\t\tif(this._phi == this._targetPhi) \n\t\t\tif(this._theta == this._targetTheta)\n\t\t\t\tif(this._distance == this._targetDistance)\n\t\t\t\t\tthis._isAnimating = false;\t\t\n\t\t\n\t\tthis._computeMatrix();\t\t\n\t\treturn true;\n\t},\n\t\n\tget action()  { return this._action; },\n\t\n\tset action(a) { if(this._action != a) this._new_action = true; this._action = a; },\n\n\tget matrix() { return this._matrix; },\n\n\treset : function () {\n\t\tthis._matrix = SglMat4.identity();\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION\n\n\t\tthis._phi = this._startPhi;\n\t\tthis._theta = this._startTheta;\n\t\tthis._distance = this._startDistance;\n\t\t\n\t\tthis._isAnimating = false;\t\t\n\t},\n\n\ttrack : function(m, x, y, z) {\n        if(this._new_action) {\n            this._start[0] = x;\n\t\t    this._start[1] = y;\n            this._new_action = false;\n        } \t\t\n\n        var dx = this._start[0] - x; \n        var dy = this._start[1] - y;\n        this._start[0] = x;\n        this._start[1] = y;\n        \n\t\tswitch (this._action) {\n\t\t\tcase SGL_TRACKBALL_ROTATE:\n\t\t\t\tthis._isAnimating = false; //stopping animation\n\t\t\t\tthis.rotate(m, dx, dy);\n\t\t\tbreak;\n\n\t\t\tcase SGL_TRACKBALL_PAN:\n\t\t\tbreak;\n\n\t\t\tcase SGL_TRACKBALL_SCALE:\n\t\t\t\tthis._isAnimating = false; //stopping animation\n\t\t\t\tthis.scale(m, z);\n\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\tbreak;\n\t\t}\n        return this._computeMatrix();\n\t},\n\t\n    rotate: function(m, dx, dy) {\n\t\tthis._phi += dx;\n\t\tif(this._limitPhi)\n\t\t\tthis._phi = this.clamp(this._phi, this._minMaxPhi[0], this._minMaxPhi[1]);\t  \n\t\t\n\t\t// avoid eternal accumulation of rotation, just for the sake of cleanliness\n\t\tif (this._phi > 20.0) this._phi = this._phi - 20.0;\n\t\tif (this._phi < -20.0) this._phi = this._phi + 20.0;\n\t\t\n\t\tthis._theta += dy; \n\t\tthis._theta = this.clamp(this._theta, this._minMaxTheta[0], this._minMaxTheta[1]);\n    },\n\n\tscale : function(m, s) {\n\t\tthis._distance *= s;\n\t\tthis._distance = this.clamp(this._distance, this._minMaxDist[0], this._minMaxDist[1]);\t\t\n\t}\n};\n/***********************************************************************/\n","/*\n3DHOP - 3D Heritage Online Presenter\nCopyright (c) 2014, Marco Callieri - Visual Computing Lab, ISTI - CNR\nAll rights reserved.    \n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/**\n * Constructs a TurntableCylTrackball object.\n * @class Interactor which implements a Turntable controller + cylindrical pan with bounds.\n */\nfunction TurntablePanTrackball() {\n}\n\nTurntablePanTrackball.prototype = {\n\n\tsetup : function (options) {\n\t\toptions = options || {};\n\t\tvar opt = sglGetDefaultObject({\n\t\t\tstartCenter   : [ 0.0, 0.0, 0.0 ],\n\t\t\tstartPhi      : 0.0,\n\t\t\tstartTheta    : 0.0,\n\t\t\tstartDistance : 2.0,\n\t\t\tstartPanX     : 0.0,\n\t\t\tstartPanY     : 0.0,\n\t\t\tstartPanZ     : 0.0,\n\t\t\tminMaxDist    : [0.2, 4.0],\n\t\t\tminMaxPhi     : [-180, 180],\n\t\t\tminMaxTheta   : [-80.0, 80.0],\n\t\t\tminMaxPanX    : [-1.0, 1.0],\n\t\t\tminMaxPanY    : [-1.0, 1.0],\n\t\t\tminMaxPanZ    : [-1.0, 1.0],\n\t\t}, options);\n\t\t\n\t\t\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION;\n\t\tthis._new_action = true;\n\n\t\tthis._matrix = SglMat4.identity();\n\n\t\t// trackball center\n\t\tthis._center = opt.startCenter;\n\t\t\n\t\t// starting/default parameters\n\t\tthis._startPhi = sglDegToRad(opt.startPhi);   \t//phi (horizontal rotation)\n\t\tthis._startTheta = sglDegToRad(opt.startTheta);\t//theta (vertical rotation)\n\t\tthis._startPanX = opt.startPanX;   \t\t    \t//panX\n\t\tthis._startPanY = opt.startPanY;   \t\t    \t//panY\n\t\tthis._startPanZ = opt.startPanZ;   \t\t    \t//panZ\n\t\tthis._startDistance = opt.startDistance;   \t\t//distance\n\t\t\n\t\t// current parameters\n\t\tthis._phi = this._startPhi;\n\t\tthis._theta = this._startTheta;\n\t\tthis._panX = this._startPanX;\n\t\tthis._panY = this._startPanY;\n\t\tthis._panZ = this._startPanZ;\n\t\tthis._distance = this._startDistance;\n\t\t\n\t\t//animation data\n\t\tthis._isAnimating = false;\n\t\t\n\t\t// limits\n\t\tif((opt.minMaxPhi[0] == -180)&&(opt.minMaxPhi[1] == 180))\n\t\t\tthis._limitPhi = false;\n\t\telse\n\t\t\tthis._limitPhi = true;\n\t\tthis._minMaxPhi   = opt.minMaxPhi;\n\t\tthis._minMaxPhi[0] = sglDegToRad(this._minMaxPhi[0]);\n\t\tthis._minMaxPhi[1] = sglDegToRad(this._minMaxPhi[1]);\n\t\tthis._minMaxTheta = opt.minMaxTheta;\n\t\tthis._minMaxTheta[0] = sglDegToRad(this._minMaxTheta[0]);\n\t\tthis._minMaxTheta[1] = sglDegToRad(this._minMaxTheta[1]);\n\t\tthis._minMaxPanX  = opt.minMaxPanX;\n\t\tthis._minMaxPanY  = opt.minMaxPanY;\n\t\tthis._minMaxPanZ  = opt.minMaxPanZ;\n\t\tthis._minMaxDist  = opt.minMaxDist;\n\t\t\n\t\tthis._start = [0.0, 0.0];\n\t\tthis.reset();\n\t},\n\n    clamp: function(value, low, high) {\n      if(value < low) return low;\n      if(value > high) return high;\n      return value;\n    },\n\n    _computeMatrix: function() {\n      var m = SglMat4.identity();\n\n\t  // centering\n\t  m = SglMat4.mul(m, SglMat4.translation([-this._center[0], -this._center[1], -this._center[2]]));\n\n\t  // zoom\n\t  m = SglMat4.mul(m, SglMat4.translation([0.0, 0.0, -this._distance]));\n\n  \t  // rotation\n      m = SglMat4.mul(m, SglMat4.rotationAngleAxis(this._theta, [1.0, 0.0, 0.0]));\n  \n\t  // tilt\n      m = SglMat4.mul(m, SglMat4.rotationAngleAxis(this._phi, [0.0, -1.0, 0.0]));\n\n\t  // panning\n\t  m = SglMat4.mul(m, SglMat4.translation([-this._panX, -this._panY, -this._panZ]));\n\n      this._matrix = m;\n    },\n\n\tgetState : function () {\n\t\treturn [sglRadToDeg(this._phi), sglRadToDeg(this._theta), this._panX, this._panY, this._panZ, this._distance];\n\t},\n\n\tsetState : function (newstate) {\n\t\t// stop animation\n\t\tthis._isAnimating = false;\n\n\t\tthis._phi      = sglDegToRad(newstate[0]);\n\t\tthis._theta    = sglDegToRad(newstate[1]);\n\t\tthis._panX     = newstate[2];\n\t\tthis._panY     = newstate[3];\n\t\tthis._panZ     = newstate[4];\n\t\tthis._distance = newstate[5];\n\n\t\t//check limits\n\t\tif(this._limitPhi)\n\t\t\tthis._phi = this.clamp(this._phi, this._minMaxPhi[0], this._minMaxPhi[1]);\n\t\tthis._theta = this.clamp(this._theta, this._minMaxTheta[0], this._minMaxTheta[1]);\n\t\tthis._distance = this.clamp(this._distance, this._minMaxDist[0], this._minMaxDist[1]);\n\t\tthis._panX = this.clamp(this._panX, this._minMaxPanX[0], this._minMaxPanX[1]);\n\t\tthis._panY = this.clamp(this._panY, this._minMaxPanY[0], this._minMaxPanY[1]);\n\t\tthis._panZ = this.clamp(this._panZ, this._minMaxPanZ[0], this._minMaxPanZ[1]);\n\n\t\tthis._computeMatrix();\n\t},\t\n\n\tanimateToState : function (newstate) {\n\t\t// stop animation\n\t\tthis._isAnimating = false;\n\t\t\n\t\tthis._targetPhi      = sglDegToRad(newstate[0]);\n\t\tthis._targetTheta    = sglDegToRad(newstate[1]);\n\t\tthis._targetPanX     = newstate[2];\n\t\tthis._targetPanY     = newstate[3];\n\t\tthis._targetPanZ     = newstate[4];\n\t\tthis._targetDistance = newstate[5];\n\n\t\t//check limits\n\t\tif(this._limitPhi)\n\t\t\tthis._targetPhi = this.clamp(this._targetPhi, this._minMaxPhi[0], this._minMaxPhi[1]);\n\t\tthis._targetTheta = this.clamp(this._targetTheta, this._minMaxTheta[0], this._minMaxTheta[1]);\n\t\tthis._targetPanX = this.clamp(this._targetPanX, this._minMaxPanX[0], this._minMaxPanX[1]);\n\t\tthis._targetPanY = this.clamp(this._targetPanY, this._minMaxPanY[0], this._minMaxPanY[1]);\n\t\tthis._targetPanZ = this.clamp(this._targetPanZ, this._minMaxPanZ[0], this._minMaxPanZ[1]);\n\t\tthis._targetDistance = this.clamp(this._targetDistance, this._minMaxDist[0], this._minMaxDist[1]);\n\n\t\t// setting base velocities \n\t\tthis._speedPhi = Math.PI;\n\t\tthis._speedTheta = Math.PI;\n\t\tthis._speedPanX = 1.0;\n\t\tthis._speedPanY = 1.0;\n\t\tthis._speedPanZ = 1.0;\n\t\tthis._speedDistance = 2.0;\n\n\t\t//if phi unconstrained rotation, it is necessary to find a good rotation direction\n\t\tif(!this._limitPhi){ \n\t\t\t// clamp current phi angle, to prevent endless unwinding\n\t\t\twhile(this._phi > 2*Math.PI)\n\t\t\t\tthis._phi -= 2*Math.PI;\n\t\t\twhile(this._phi < 0) \n\t\t\t\tthis._phi += 2*Math.PI;\t\n\n\t\t\t// determine minimal, clamped target phi angle\n\t\t\tvar clampedangle = this._targetPhi;\n\t\t\twhile(clampedangle > 2*Math.PI)\n\t\t\t\tclampedangle -= 2*Math.PI;\n\t\t\twhile(clampedangle < 0) \n\t\t\t\tclampedangle += 2*Math.PI;\n\t\t\t\n\t\t\tif(Math.abs(clampedangle - this._phi) < Math.PI) { // standard rotation\n\t\t\t\tif(clampedangle > this._phi){\n\t\t\t\t\tthis.speedphi = Math.PI;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tthis.speedphi = -Math.PI;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(clampedangle > this._phi){\n\t\t\t\t\tclampedangle = (clampedangle - 2*Math.PI)\n\t\t\t\t\tthis.speedphi = -Math.PI;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tclampedangle = (clampedangle + 2*Math.PI)\n\t\t\t\t\tthis.speedphi = Math.PI;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._targetPhi = clampedangle;\n\t\t}\n\n\t\t// find max animation time to set a time limit and then synchronize all movements\n\t\tvar timePhi      = Math.abs((this._targetPhi - this._phi) / this._speedPhi);\n\t\tvar timeTheta    = Math.abs((this._targetTheta - this._theta) / this._speedTheta);\n\t\tvar timeDistance = Math.abs((this._targetDistance - this._distance) / this._speedDistance);\n\t\tvar timePanX     = Math.abs((this._targetPanX - this._panX) / this._speedPanX);\n\t\tvar timePanY     = Math.abs((this._targetPanY - this._panY) / this._speedPanY);\n\t\tvar timePanZ     = Math.abs((this._targetPanZ - this._panZ) / this._speedPanZ); \n\n\t\tvar maxtime = Math.max( timePhi, Math.max( timeTheta, Math.max( timeDistance, Math.max( timePanX, Math.max( timePanY, timePanZ )))));\n\n\t\tmaxtime = this.clamp(maxtime, 0.5, 2.0);\n\n\t\tthis._speedPhi      *= timePhi / maxtime;\n\t\tthis._speedTheta    *= timeTheta / maxtime;\n\t\tthis._speedDistance *= timeDistance / maxtime;\n\t\tthis._speedPanX     *= timePanX / maxtime;\n\t\tthis._speedPanY     *= timePanY / maxtime;\n\t\tthis._speedPanZ     *= timePanZ / maxtime;\n\n\t\t// start animation\n\t\tthis._isAnimating = true;\n\t},\n\n\ttick : function (dt) {\n\t\tif(!this._isAnimating) return false;\n\n\t\tvar deltaPhi      = this._speedPhi * dt;\n\t\tvar deltaTheta    = this._speedTheta * dt;\n\t\tvar deltaDistance = this._speedDistance * dt;\n\t\tvar deltaPanX     = this._speedPanX * dt;\n\t\tvar deltaPanY     = this._speedPanY * dt;\n\t\tvar deltaPanZ     = this._speedPanZ * dt;\n\n\t\tvar diffPhi      = this._targetPhi - this._phi;\n\t\tvar diffTheta    = this._targetTheta - this._theta;\n\t\tvar diffDistance = this._targetDistance - this._distance;\n\t\tvar diffPanX     = this._targetPanX - this._panX;\n\t\tvar diffPanY     = this._targetPanY - this._panY;\n\t\tvar diffPanZ     = this._targetPanZ - this._panZ;\n\n\t\tif (diffPhi > deltaPhi) \n\t\t\tthis._phi += deltaPhi;\n\t\telse if (diffPhi < -deltaPhi) \n\t\t\tthis._phi -= deltaPhi;\n\t\telse \n\t\t\tthis._phi = this._targetPhi;\n\n\t\tif (diffTheta > deltaTheta) \n\t\t\tthis._theta += deltaTheta;\n\t\telse if (diffTheta < -deltaTheta) \n\t\t\tthis._theta -= deltaTheta;\n\t\telse \n\t\t\tthis._theta = this._targetTheta;\n\n\t\tif (diffDistance > deltaDistance) \n\t\t\tthis._distance += deltaDistance;\n\t\telse if (diffDistance < -deltaDistance) \n\t\t\tthis._distance -= deltaDistance;\n\t\telse \n\t\t\tthis._distance = this._targetDistance;\n\n\t\tif (diffPanX > deltaPanX) \n\t\t\tthis._panX += deltaPanX;\n\t\telse if (diffPanX < -deltaPanX) \n\t\t\tthis._panX -= deltaPanX;\n\t\telse \n\t\t\tthis._panX\t= this._targetPanX;\t\n\n\t\tif (diffPanY > deltaPanY) \n\t\t\tthis._panY += deltaPanY;\n\t\telse if (diffPanY < -deltaPanY) \n\t\t\tthis._panY -= deltaPanY;\n\t\telse \n\t\t\tthis._panY\t= this._targetPanY;\n\n\t\tif (diffPanZ > deltaPanZ) \n\t\t\tthis._panZ += deltaPanZ;\n\t\telse if (diffPanZ < -deltaPanZ) \n\t\t\tthis._panZ -= deltaPanZ;\n\t\telse \n\t\t\tthis._panZ\t= this._targetPanZ;\n\t\t\t\n\t\tif(this._phi == this._targetPhi) \n\t\t\tif(this._theta == this._targetTheta)\n\t\t\t\tif(this._distance == this._targetDistance)\n\t\t\t\t\tif(this._panX == this._targetPanX)\n\t\t\t\t\t\tif(this._panY == this._targetPanY)\n\t\t\t\t\t\t\tif(this._panZ == this._targetPanZ)\n\t\t\t\t\t\t\t\tthis._isAnimating = false;\n\n\t\tthis._computeMatrix();\n\t\treturn true;\n\t},\n\n\tget action()  { return this._action; },\n\n\tset action(a) { if(this._action != a) this._new_action = true; this._action = a; },\n\n\tget matrix() { return this._matrix; },\n\n\treset : function () {\n\t\tthis._matrix = SglMat4.identity();\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION\n\n\t\tthis._phi = this._startPhi;\n\t\tthis._theta = this._startTheta;\n\t\tthis._distance = this._startDistance;\n\t\tthis._panX = this._startPanX;\n\t\tthis._panY = this._startPanY;\n\t\tthis._panZ = this._startPanZ;\n\n\t\tthis._isAnimating = false;\n\t},\n\n\ttrack : function(m, x, y, z) {\n        if(this._new_action) {\n            this._start[0] = x;\n\t\t    this._start[1] = y;\n            this._new_action = false;\n        }\n\n        var dx = this._start[0] - x; \n        var dy = this._start[1] - y;\n        this._start[0] = x;\n        this._start[1] = y;\n        \n\t\tswitch (this._action) {\n\t\t\tcase SGL_TRACKBALL_ROTATE:\n\t\t\t\tthis._isAnimating = false; //stopping animation\n\t\t\t\tthis.rotate(m, dx, dy);\n\t\t\tbreak;\n\n\t\t\tcase SGL_TRACKBALL_PAN:\n\t\t\t\tthis._isAnimating = false; //stopping animation\n\t\t\t\tthis.pan(m, dx, dy);\n\t\t\tbreak;\n\n\t\t\tcase SGL_TRACKBALL_SCALE:\n\t\t\t\tthis._isAnimating = false; //stopping animation\n\t\t\t\tthis.scale(m, z);\n\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\tbreak;\n\t\t}\n        return this._computeMatrix();\n\t},\n\n\tpan: function(m, dx, dy) {\n\n\t\t//determining current X, Y and Z axis\n\t\tvar Xvec = [1.0, 0.0, 0.0, 1.0];\n\t\tvar Yvec = [0.0, 1.0, 0.0, 1.0];\n\t\tvar Zvec = [0.0, 0.0, 1.0, 1.0];\n\t\tXvec = SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi, [0.0, -1.0, 0.0]), Xvec);\n\t\tYvec = SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi, [0.0, -1.0, 0.0]), Yvec);\n\t\tZvec = SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi, [0.0, -1.0, 0.0]), Zvec);\n\t\tXvec = SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta, [1.0, 0.0, 0.0]), Xvec);\n\t\tYvec = SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta, [1.0, 0.0, 0.0]), Yvec);\n\t\tZvec = SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta, [1.0, 0.0, 0.0]), Zvec);\n\n\t\tthis._panX += (dx * Xvec[0]) + (dy * Xvec[1]);\n\t\tthis._panY += (dx * Yvec[0]) + (dy * Yvec[1]);\n\t\tthis._panZ += (dx * Zvec[0]) + (dy * Zvec[1]);\n\n\t\t//clamping\n\t\tthis._panX = this.clamp(this._panX, this._minMaxPanX[0], this._minMaxPanX[1]);\n\t\tthis._panY = this.clamp(this._panY, this._minMaxPanY[0], this._minMaxPanY[1]);\n\t\tthis._panZ = this.clamp(this._panZ, this._minMaxPanZ[0], this._minMaxPanZ[1]);\n    },\n\n    rotate: function(m, dx, dy) {\n\t\tthis._phi += dx;\n\t\tif(this._limitPhi)\n\t\t\tthis._phi = this.clamp(this._phi, this._minMaxPhi[0], this._minMaxPhi[1]);\n\n\t\t// avoid eternal accumulation of rotation, just for the sake of cleanliness\n\t\tif (this._phi > 20.0) this._phi = this._phi - 20.0;\n\t\tif (this._phi < -20.0) this._phi = this._phi + 20.0;\n\n\t\tthis._theta += dy; \n\t\tthis._theta = this.clamp(this._theta, this._minMaxTheta[0], this._minMaxTheta[1]);\n    },\n\n\tscale : function(m, s) {\n\t\tthis._distance *= s;\n\t\tthis._distance = this.clamp(this._distance, this._minMaxDist[0], this._minMaxDist[1]);\n\t}\n};\n/***********************************************************************/\n","/*\r\n3DHOP - 3D Heritage Online Presenter\r\nCopyright (c) 2014, Marco Callieri - Visual Computing Lab, ISTI - CNR\r\nAll rights reserved.    \r\n\r\nThis program is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nThis program is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU General Public License for more details.\r\n\r\nYou should have received a copy of the GNU General Public License\r\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nfunction init3dhop() {\r\n\tvar interval, id, ismousedown;\r\n\tvar button = 0;\r\n\r\n\t$('#toolbar img')\r\n\t\t.mouseenter(function(e) {\r\n\t\t\tid = $(this).attr('id');\r\n\t\t\tif(!ismousedown) $(this).css(\"opacity\",\"0.8\");\r\n\t\t\telse $(this).css(\"opacity\",\"1.0\");\r\n\t\t})\r\n\t\t.mouseout(function(e) {\r\n\t\t\tclearInterval(interval); \r\n\t\t\t$(this).css(\"opacity\",\"0.5\");\r\n\t\t})\r\n\t\t.mousedown(function(e) {\r\n\t\t\tismousedown = true;\r\n\t\t\tif(e.button==button){\r\n\t\t\t\tactionsToolbar(id);\r\n\t\t\t\tif(id == \"zoomin\" || id == \"zoomout\"){\r\n\t\t\t\t\tinterval = setInterval(function(){\r\n\t\t\t\t\t\tactionsToolbar(id);\r\n\t\t\t\t\t}, 100);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tclearInterval(interval); \r\n\t\t\t\t}\r\n\t\t\t\t$(this).css(\"opacity\",\"1.0\");\r\n\t\t\t\tbutton=0;\r\n\t\t\t}\r\n\t\t})\r\n\t\t.mouseup(function(e) {\r\n\t\t\tismousedown = false;\r\n\t\t\tif(e.button==button){\r\n\t\t\t\tclearInterval(interval); \r\n\t\t\t\t$(this).css(\"opacity\",\"0.8\");\r\n\t\t\t\tbutton=0;\r\n\t\t\t}\r\n\t\t})\r\n\t\t.on('touchstart', function(e) { \r\n\t\t\tbutton=2;\r\n\t\t})\r\n\t\t.on('touchend', function(e) {\r\n\t\t\tbutton=0;\r\n\t\t});\r\n\r\n\t$('#measure-output')\r\n\t\t.on('contextmenu', function(e){ \r\n\t\t\te.stopPropagation();\r\n\t\t});\r\n\r\n\t$('#3dhop')\r\n\t\t.on('contextmenu', function(e){ \r\n\t\t\treturn false; \r\n\t\t})\r\n\t\t.on('touchstart', function(e) {\r\n\t\t\t$('#toolbar img').css(\"opacity\",\"0.5\");\r\n\t\t})\r\n\t\t.on('touchend', function(e) {\r\n\t\t\tclearInterval(interval); \r\n\t\t})\r\n\t\t.on('touchmove', function(e) {\r\n\t\t\tclearInterval(interval); \r\n\t\t\t$('#toolbar img').css(\"opacity\",\"0.5\");\r\n\t\t});\r\n\r\n\t$('#draw-canvas')\r\n//\t\t.css(\"cursor\",\"default\")\r\n\t\t.mousedown(function() { $('#toolbar img').css(\"opacity\",\"0.5\"); });\r\n\r\n\tif (window.navigator.userAgent.indexOf('Trident/') > 0) { //IE fullscreen handler \r\n\t\t$('#full').click(function(e) {enterFullscreen();});\r\n\t\t$('#full_on').click(function(e) {exitFullscreen();});\r\n\t}\r\n\r\n\tresizeCanvas($('#3dhop').parent().width(),$('#3dhop').parent().height());\r\n\r\n\tset3dhlg();\r\n} \r\n\r\nfunction lightSwitch() {\r\n  var on = presenter.isLightTrackballEnabled();\r\n\r\n  if(on){\r\n    $('#light').css(\"visibility\", \"hidden\");\r\n    $('#light_on').css(\"visibility\", \"visible\");\r\n    $('#light_on').css(\"opacity\",\"1.0\");\r\n//    $('#draw-canvas').css(\"cursor\",\"url(./skins/icons/cursor_light.png), auto\");\r\n  }\r\n  else{\r\n    $('#light_on').css(\"visibility\", \"hidden\");\r\n    $('#light').css(\"visibility\", \"visible\");\r\n    $('#light').css(\"opacity\",\"1.0\");\r\n//    $('#draw-canvas').css(\"cursor\",\"default\");\r\n  }\r\n}\r\n\r\nfunction measurementSwitch() {\r\n  var on = presenter.isMeasurementToolEnabled();\r\n\r\n  if(on){\r\n    $('#measure').css(\"visibility\", \"hidden\");\r\n    $('#measure_on').css(\"visibility\", \"visible\");\r\n    $('#measure_on').css(\"opacity\",\"1.0\");\r\n    $('#measurebox').css(\"visibility\",\"visible\");\r\n    $('#draw-canvas').css(\"cursor\",\"crosshair\");\r\n  }\r\n  else{\r\n    $('#measure_on').css(\"visibility\", \"hidden\");\r\n    $('#measure').css(\"visibility\", \"visible\");\r\n    $('#measure').css(\"opacity\",\"1.0\");\r\n    $('#measurebox').css(\"visibility\",\"hidden\");\r\n    $('#measure-output').html(\"0.0\");\r\n    $('#draw-canvas').css(\"cursor\",\"default\");\r\n  }\r\n}\r\n\r\nfunction hotspotSwitch() {\r\n  var on = presenter.isSpotVisibilityEnabled();\r\n\r\n  if(on){\r\n    $('#hotspot').css(\"visibility\", \"hidden\");\r\n    $('#hotspot_on').css(\"visibility\", \"visible\");\r\n    $('#hotspot_on').css(\"opacity\",\"1.0\");\r\n  }\r\n  else{\r\n    $('#hotspot_on').css(\"visibility\", \"hidden\");\r\n    $('#hotspot').css(\"visibility\", \"visible\");\r\n    $('#hotspot').css(\"opacity\",\"1.0\");\r\n  }\r\n}\r\n\r\nfunction fullscreenSwitch() {\r\n  if($('#full').css(\"visibility\")==\"visible\"){\r\n    if (window.navigator.userAgent.indexOf('Trident/') < 0) enterFullscreen();\r\n  }\r\n  else{\r\n    if (window.navigator.userAgent.indexOf('Trident/') < 0) exitFullscreen();\r\n  }\r\n}\r\n\r\nfunction enterFullscreen() {\r\n  var el = document.getElementById('3dhop');\r\n  presenter.native_width  = presenter.ui.width;\r\n  presenter.native_height = presenter.ui.height;\r\n  $('#full').css(\"visibility\", \"hidden\");\r\n  $('#full_on').css(\"visibility\", \"visible\");\r\n  $('#full_on').css(\"opacity\",\"0.5\");\r\n  resizeCanvas(screen.width,screen.height);\r\n\r\n  if (el.msRequestFullscreen) el.msRequestFullscreen();\r\n  else if (el.mozRequestFullScreen) el.mozRequestFullScreen();\r\n  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();\r\n\r\n  presenter.ui.postDrawEvent();\r\n}\r\n\r\nfunction exitFullscreen() {\r\n  $('#full_on').css(\"visibility\", \"hidden\");\r\n  $('#full').css(\"visibility\", \"visible\");\r\n  $('#full').css(\"opacity\",\"0.5\");\r\n  resizeCanvas(presenter.native_width,presenter.native_height);\r\n\r\n  if (document.msExitFullscreen) document.msExitFullscreen();  \r\n  else if (document.mozCancelFullScreen) document.mozCancelFullScreen();\r\n  else if (document.webkitExitFullscreen) document.webkitExitFullscreen();\r\n\r\n  presenter.ui.postDrawEvent(); \r\n}\r\n\r\nfunction moveToolbar(l,t) {\r\n  $('#toolbar').css('left', l);\r\n  $('#toolbar').css('top', t);\r\n}\r\n\r\nfunction moveMeasurebox(r,t) {\r\n  $('#measurebox').css('right', r);\r\n  $('#measurebox').css('top', t);\r\n}\r\n\r\nfunction resizeCanvas(w,h) {\r\n  $('#draw-canvas').attr('width', w);\r\n  $('#draw-canvas').attr('height',h);\r\n  $('#3dhop').css('width', w);\r\n  $('#3dhop').css('height', h);  \r\n}\r\n\r\nfunction set3dhlg() {\r\n  $('#tdhlg').html(\"Powered by 3DHOP</br>&nbsp;C.N.R. &nbsp;&ndash;&nbsp; I.S.T.I.\");\r\n  $('#tdhlg').mouseover(function() {\r\n\t $('#tdhlg').animate({ \r\n\t\theight: \"25px\"\r\n\t  }, \"fast\" );\r\n\t })\r\n\t.mouseout(function() {\r\n\t $('#tdhlg').animate({ \r\n\t\theight: \"13px\"\r\n\t  }, \"slow\" );\r\n\t });\r\n  $('#tdhlg').click(function() { window.open('http://vcg.isti.cnr.it/3dhop/', '_blank') });\r\n}\r\n\r\ndocument.addEventListener(\"MSFullscreenChange\", function () {\r\n    if(!document.msFullscreenElement) exitFullscreen();\r\n}, false);\r\ndocument.addEventListener(\"mozfullscreenchange\", function () {\r\n    if(!document.mozFullScreen) exitFullscreen();\r\n}, false);\r\ndocument.addEventListener(\"webkitfullscreenchange\", function () {\r\n    if(!document.webkitIsFullScreen) exitFullscreen();\r\n}, false);\r\n"],"sourceRoot":"/source/"}