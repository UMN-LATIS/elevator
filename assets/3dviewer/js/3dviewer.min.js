var SpiderGL={TAG:0,openNamespace:function(e){e=SpiderGL.Utility.getDefaultObject({globalObject:SpiderGL.openNamespace.DEFAULT_GLOBAL_OBJECT,constantPrefix:SpiderGL.openNamespace.DEFAULT_CONSTANT_PREFIX,functionPrefix:SpiderGL.openNamespace.DEFAULT_FUNCTION_PREFIX,classPrefix:SpiderGL.openNamespace.DEFAULT_CLASS_PREFIX},e);var t=new RegExp("^(([_$0-9A-Z])+)$");function n(e){return t.test(e)}var a=new RegExp("^([A-Z])"),s=new RegExp("^(([a-z])+([_$0-9A-Za-z])*)$");function r(e){return e.substr(0,1).toUpperCase()+e.substr(1)}var o={},u={},d={};function i(e){var t,r;if(e)for(var i in e)"_"!=i.substr(0,1)&&(t=e[i],r=i,a.test(r)&&!n(r)?o[i]=t:(r=i,s.test(r)?u[i]=t:n(i)&&(d[i]=t)))}var p,h=["Core","DOM","IO","Math","Mesh","Model","Semantic","Space","Type","UserInterface","Utility","Version","WebGL"];for(p in h)i(SpiderGL[h[p]]);for(p in o){var _=e.classPrefix+r(p);e.globalObject[_]=o[p]}for(p in u)_=e.functionPrefix+r(p),e.globalObject[_]=u[p];for(p in d)_=e.constantPrefix+r(p),e.globalObject[_]=d[p]}};SpiderGL.openNamespace.DEFAULT_GLOBAL_OBJECT=window,SpiderGL.openNamespace.DEFAULT_CONSTANT_PREFIX="SGL_",SpiderGL.openNamespace.DEFAULT_FUNCTION_PREFIX="sgl",SpiderGL.openNamespace.DEFAULT_CLASS_PREFIX="Sgl",SpiderGL.Version={},SpiderGL.Version.VERSION_MAJOR=0,SpiderGL.Version.VERSION_MINOR=2,SpiderGL.Version.VERSION_REVISION=10,SpiderGL.Version.VERSION_STRING=SpiderGL.Version.VERSION_MAJOR+"."+SpiderGL.Version.VERSION_MINOR+"."+SpiderGL.Version.VERSION_REVISION,SpiderGL.Core={},SpiderGL.Core.DEFAULT={},SpiderGL.Core.DONT_CARE={},SpiderGL.Core.EMPTY_STRING="",SpiderGL.Core.EMPTY_OBJECT={},SpiderGL.Core.EMPTY_ARRAY=[],SpiderGL.Core.EMPTY_FUNCTION=function(){},SpiderGL.Core.generateUID=function(){return SpiderGL.Core.generateUID._lastUID++,SpiderGL.Core.generateUID._lastUID},SpiderGL.Core.generateUID._lastUID=0,SpiderGL.Core.ObjectBase=function(){this._uid=SpiderGL.Core.generateUID()},SpiderGL.Core.ObjectBase.prototype={get uid(){return this._uid}},SpiderGL.Type={},SpiderGL.Type.LITTLE_ENDIAN=(()=>{var e=new Uint8Array([18,52]);return 13330==new Uint16Array(e.buffer)[0]})(),SpiderGL.Type.BIG_ENDIAN=!SpiderGL.Type.BIG_ENDIAN,SpiderGL.Type.NO_TYPE=0,SpiderGL.Type.INT8=1,SpiderGL.Type.UINT8=2,SpiderGL.Type.INT16=3,SpiderGL.Type.UINT16=4,SpiderGL.Type.INT32=5,SpiderGL.Type.UINT32=6,SpiderGL.Type.FLOAT32=7,SpiderGL.Type.SIZEOF_INT8=Int8Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_UINT8=Uint8Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_INT16=Int16Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_UINT16=Uint16Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_INT32=Int32Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_UINT32=Uint32Array.BYTES_PER_ELEMENT,SpiderGL.Type.SIZEOF_FLOAT32=Float32Array.BYTES_PER_ELEMENT,SpiderGL.Type.typeSize=(()=>{var t={};return t[SpiderGL.Type.NO_TYPE]=0,t[SpiderGL.Type.INT8]=SpiderGL.Type.SIZEOF_INT8,t[SpiderGL.Type.UINT8]=SpiderGL.Type.SIZEOF_UINT8,t[SpiderGL.Type.INT16]=SpiderGL.Type.SIZEOF_INT16,t[SpiderGL.Type.UINT16]=SpiderGL.Type.SIZEOF_UINT16,t[SpiderGL.Type.INT32]=SpiderGL.Type.SIZEOF_INT32,t[SpiderGL.Type.UINT32]=SpiderGL.Type.SIZEOF_UINT32,t[SpiderGL.Type.FLOAT32]=SpiderGL.Type.SIZEOF_FLOAT32,function(e){return t[e]}})(),SpiderGL.Type.typeToGL=(()=>{var t={};return t[SpiderGL.Type.NO_TYPE]=WebGLRenderingContext.prototype.NONE,t[SpiderGL.Type.INT8]=WebGLRenderingContext.prototype.BYTE,t[SpiderGL.Type.UINT8]=WebGLRenderingContext.prototype.UNSIGNED_BYTE,t[SpiderGL.Type.INT16]=WebGLRenderingContext.prototype.SHORT,t[SpiderGL.Type.UINT16]=WebGLRenderingContext.prototype.UNSIGNED_SHORT,t[SpiderGL.Type.INT32]=WebGLRenderingContext.prototype.INT,t[SpiderGL.Type.UINT32]=WebGLRenderingContext.prototype.UNSIGNED_INT,t[SpiderGL.Type.FLOAT32]=WebGLRenderingContext.prototype.FLOAT,function(e){return t[e]}})(),SpiderGL.Type.typeFromGL=(()=>{var t={};return t[WebGLRenderingContext.prototype.NONE]=SpiderGL.Type.NO_TYPE,t[WebGLRenderingContext.prototype.BYTE]=SpiderGL.Type.INT8,t[WebGLRenderingContext.prototype.UNSIGNED_BYTE]=SpiderGL.Type.UINT8,t[WebGLRenderingContext.prototype.SHORT]=SpiderGL.Type.INT16,t[WebGLRenderingContext.prototype.UNSIGNED_SHORT]=SpiderGL.Type.UINT16,t[WebGLRenderingContext.prototype.INT]=SpiderGL.Type.INT32,t[WebGLRenderingContext.prototype.UNSIGNED_INT]=SpiderGL.Type.UINT32,t[WebGLRenderingContext.prototype.FLOAT]=SpiderGL.Type.FLOAT32,function(e){return t[e]}})(),SpiderGL.Type.typeSizeFromGL=function(e){e=SpiderGL.Type.typeFromGL(e);return SpiderGL.Type.typeSize(e)},SpiderGL.Type.typeToTypedArrayConstructor=(()=>{var t={};return t[SpiderGL.Type.NO_TYPE]=ArrayBuffer,t[SpiderGL.Type.INT8]=Int8Array,t[SpiderGL.Type.UINT8]=Uint8Array,t[SpiderGL.Type.INT16]=Int16Array,t[SpiderGL.Type.UINT16]=Uint16Array,t[SpiderGL.Type.INT32]=Int32Array,t[SpiderGL.Type.UINT32]=Uint32Array,t[SpiderGL.Type.FLOAT32]=Float32Array,function(e){return t[e]}})(),SpiderGL.Type.POINTS=0,SpiderGL.Type.LINES=1,SpiderGL.Type.LINE_LOOP=2,SpiderGL.Type.LINE_STRIP=3,SpiderGL.Type.TRIANGLES=4,SpiderGL.Type.TRIANGLE_FAN=5,SpiderGL.Type.TRIANGLE_STRIP=6,SpiderGL.Type.primitiveToGL=(()=>{var t={};return t[SpiderGL.Type.POINTS]=WebGLRenderingContext.prototype.POINTS,t[SpiderGL.Type.LINES]=WebGLRenderingContext.prototype.LINES,t[SpiderGL.Type.LINE_LOOP]=WebGLRenderingContext.prototype.LINE_LOOP,t[SpiderGL.Type.LINE_STRIP]=WebGLRenderingContext.prototype.LINE_STRIP,t[SpiderGL.Type.TRIANGLES]=WebGLRenderingContext.prototype.TRIANGLES,t[SpiderGL.Type.TRIANGLE_FAN]=WebGLRenderingContext.prototype.TRIANGLE_FAN,t[SpiderGL.Type.TRIANGLE_STRIP]=WebGLRenderingContext.prototype.TRIANGLE_STRIP,function(e){return t[e]}})(),SpiderGL.Type.instanceOf=function(e,t){return e instanceof t},SpiderGL.Type.isNumber=function(e){return"number"==typeof e},SpiderGL.Type.isString=function(e){return"string"==typeof e},SpiderGL.Type.isFunction=function(e){return"function"==typeof e},SpiderGL.Type.isArray=function(e){return e&&e.constructor===Array},SpiderGL.Type.isTypedArray=function(e){return e&&void 0!==e.buffer&&e.buffer instanceof ArrayBuffer},SpiderGL.Type.extend=function(e,t){function r(){}r.prototype=t.prototype;var i,n,a,s=e.prototype,o=new r;o.constructor=e;for(a in s)(i=s.__lookupGetter__(a))&&o.__defineGetter__(a,i),(n=s.__lookupSetter__(a))&&o.__defineSetter__(a,n),i||n||(o[a]=s[a]);e.prototype=o},SpiderGL.Type.defineClassGetter=function(e,t,r){e.prototype.__defineGetter__(t,r)},SpiderGL.Type.defineClassSetter=function(e,t,r){e.prototype.__defineSetter__(t,r)},SpiderGL.Type.defineObjectGetter=function(e,t,r){e.__defineGetter__(t,r)},SpiderGL.Type.defineObjectSetter=function(e,t,r){e.__defineSetter__(t,r)},SpiderGL.Utility={},SpiderGL.Utility.getDefaultValue=function(e,t){return void 0===e||e===SpiderGL.Core.DEFAULT?t:e},SpiderGL.Utility.getDefaultObject=function(e,t){if(t){var r,i=SpiderGL.Core.DEFAULT;for(r in t)t[r]!=i&&(e[r]=t[r])}return e},SpiderGL.Utility.setDefaultValues=function(e,t){if(!t)return e;var r,i=SpiderGL.Core.DEFAULT;for(r in t)t[r]==i&&void 0!==e[r]&&(t[r]=e[r]);for(r in e)void 0===t[r]&&(t[r]=e[r]);return t},SpiderGL.Utility.getAttrib4fv=function(e){return SpiderGL.Type.isNumber(e)?[e,0,0,1]:e?[null!=e[0]?e[0]:0,null!=e[1]?e[1]:0,null!=e[2]?e[2]:0,null!=e[3]?e[3]:1]:[0,0,0,1]},SpiderGL.Utility.getTime=function(){return(new Date).getTime()},SpiderGL.Utility.Timer=function(){this._tStart=-1,this._tElapsed=0},SpiderGL.Utility.Timer.prototype={_accumElapsed:function(){this._tElapsed+=this.now-this._tStart},get now(){return Date.now()},start:function(){this.isStarted||this.isPaused||(this._tStart=this.now,this._tElapsed=0)},restart:function(){var e=this.elapsed;return this._tStart=this.now,this._tElapsed=0,e},stop:function(){!this.isStarted||this.isPaused||(this._accumElapsed(),this._tStart=-1)},get isStarted(){return 0<=this._tStart},pause:function(){!this.isStarted||this.isPaused||(this._accumElapsed(),this._tStart=-2)},resume:function(){this.isStarted&&this.isPaused&&(this._tStart=this.now)},get isPaused(){return-2==this._tStart},get elapsed(){return this.isStarted?this._tElapsed+(this.now-this._tStart):this._tElapsed}},SpiderGL.Utility.Browser=function(){},SpiderGL.Utility.Browser.prototype={get isOpera(){return!!window.opr&&!!opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/")},get isFirefox(){return"undefined"!=typeof InstallTrigger||-1<navigator.userAgent.toLowerCase().indexOf("fxios")},get isSafari(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)||/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString()},get isIE(){return!!document.documentMode},get isEdge(){return!this.isIE&&!!window.StyleMedia},get isChrome(){return!!window.chrome&&!!window.chrome.webstore}},SpiderGL.DOM={},SpiderGL.DOM.getElementById=function(e){return document.getElementById(e)},SpiderGL.DOM.getElementText=function(e){if(!(r=document.getElementById(e)))return null;for(var t="",r=r.firstChild;r;)3==r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t},SpiderGL.IO={},SpiderGL.IO.Request=function(e,t){SpiderGL.Core.ObjectBase.call(this),t=SpiderGL.Utility.getDefaultObject({async:SpiderGL.IO.Request.DEFAULT_ASYNC,send:SpiderGL.IO.Request.DEFAULT_SEND,onProgress:null,onCancel:null,onError:null,onSuccess:null,onFinish:null},t),this._url=e,this._async=t.async,this._status=SpiderGL.IO.Request.NONE,this._sent=!1,this._aborted=!1,this._data=null,this._loaded=0,this._total=0,this._events={progress:{main:null,listeners:[]},cancel:{main:null,listeners:[]},error:{main:null,listeners:[]},success:{main:null,listeners:[]},finish:{main:null,listeners:[]}},this.onProgress=t.onProgress,this.onCancel=t.onCancel,this.onError=t.onError,this.onSuccess=t.onSuccess,this.onFinish=t.onFinish},SpiderGL.IO.Request.NONE=0,SpiderGL.IO.Request.ONGOING=1,SpiderGL.IO.Request.CANCELLED=2,SpiderGL.IO.Request.FAILED=3,SpiderGL.IO.Request.SUCCEEDED=4,SpiderGL.IO.Request.DEFAULT_ASYNC=!0,SpiderGL.IO.Request.DEFAULT_SEND=!0,SpiderGL.IO.Request.prototype={_indexOf:function(e,t){for(var r=0,i=e.length;r<i;++r)if(e[r]==t)return r;return-1},_setMainListener:function(e,t){var r=this._events[e];r&&r.main!=t&&(t?this.addEventListener(e,t):this.removeEventListener(e,t),r.main=t)},_dispatch:function(){var e=this._events[arguments[0]];if(e){var t=Array.prototype.slice.call(arguments,1);t.push(this);for(var r=e.listeners,i=0,n=r.length;i<n;++i)r[i].apply(null,t)}},_doPostProgress:function(){},_doPostCancel:function(){},_doPostError:function(){},_doPostSuccess:function(){},_doPostFinish:function(){},_doOnProgress:function(e,t){this._aborted||(this._loaded=e,this._total=t,this._doPostProgress(),this._dispatch("progress",this._loaded,this._total))},_doOnCancel:function(){this._aborted||(this._status=SpiderGL.IO.Request.CANCELLED,this._finishTime=SpiderGL.Utility.getTime(),this._doPostCancel(),this._dispatch("cancel"))},_doOnError:function(){this._aborted||(this._status=SpiderGL.IO.Request.FAILED,this._finishTime=SpiderGL.Utility.getTime(),this._doPostError(),this._dispatch("error"))},_doOnSuccess:function(){this._aborted||(this._status=SpiderGL.IO.Request.SUCCEEDED,this._finishTime=SpiderGL.Utility.getTime(),this._doPostSuccess(),this._dispatch("success"))},_doOnFinish:function(){this._doPostFinish(),this._dispatch("finish")},_doSend:function(){return!1},_doCancel:function(){return!1},get canSend(){return this._url&&!this._sent},get url(){return this._url},set url(e){this.cancel(),this._url=e},get status(){return this._status},get data(){return this._data},get bytesLoaded(){return this._loaded},get bytesTotal(){return this._total},get sent(){return this._sent},get ongoing(){return this._status==SpiderGL.IO.Request.ONGOING},get cancelled(){return this._status==SpiderGL.IO.Request.CANCELLED},get failed(){return this._status==SpiderGL.IO.Request.FAILED},get succeeded(){return this._status==SpiderGL.IO.Request.SUCCEEDED},get finished(){return this.succeeded||this.failed||this.cancelled},get startTime(){return this._startTime},get finishTime(){return this._finishTime},get elapsedTime(){return this._startTime<0?0:this._finishTime<0?SpiderGL.Utility.getTime()-this._startTime:this._finishTime-this._startTime},addEventListener:function(e,t){!t||!(e=this._events[e])||0<=this._indexOf(e.listeners,t)||e.listeners.push(t)},removeEventListener:function(e,t){e=this._events[e];!e||(t=this._indexOf(e.listeners,t))<0||e.listeners.splice(t,1)},get onProgress(){return this._events.progress.main},set onProgress(e){this._setMainListener("progress",e)},get onCancel(){return this._events.cancel.main},set onCancel(e){this._setMainListener("cancel",e)},get onError(){return this._events.error.main},set onError(e){this._setMainListener("error",e)},get onSuccess(){return this._events.success.main},set onSuccess(e){this._setMainListener("success",e)},get onFinish(){return this._events.finish.main},set onFinish(e){this._setMainListener("finish",e)},cancel:function(){if(!this.ongoing)return!1;this._status=SpiderGL.IO.Request.CANCELLED,this._aborted=!0;var e=this._doCancel();return this._finishTime=SpiderGL.Utility.getTime(),e},send:function(){if(!this.canSend)return!1;this._data=null,this._status=SpiderGL.IO.Request.ONGOING,this._aborted=!1,this._sent=!0,this._finishTime=-1,this._startTime=SpiderGL.Utility.getTime();var e=this._doSend();return e||(this._startTime=-1,this._status=SpiderGL.IO.Request.NONE,this._sent=!1),e}},SpiderGL.Type.extend(SpiderGL.IO.Request,SpiderGL.Core.ObjectBase),SpiderGL.IO.XHRRequestBase=function(e,t){SpiderGL.IO.Request.call(this,e,t=t||{});var r=this,i=new XMLHttpRequest;(this._xhr=i).onprogress=function(e){r._xhrOnProgress(e)},i.onabort=function(){r._doOnCancel(),r._doOnFinish()},i.onerror=function(){r._doOnError(),r._doOnFinish()},i.onload=function(){var e=i.status;0===e||200===e||r._range&&206==e?r._doOnSuccess():r._doOnError(),r._doOnFinish()},this._range=null,this._xhr.open("GET",this._url,this._async),"range"in t&&(this._range=[t.range[0],t.range[1]],e="bytes="+t.range[0]+"-"+t.range[1],i.setRequestHeader("Range",e)),this._prepareXHR(),SpiderGL.Utility.getDefaultValue(t.send,SpiderGL.IO.Request.DEFAULT_SEND)&&this.send()},SpiderGL.IO.XHRRequestBase.prototype={_prepareXHR:function(){},_doCancel:function(){return this._xhr.abort(),this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._url,this._async),this._prepareXHR(),!0},_doSend:function(){return this._xhr.send(),!0},_xhrOnProgress:function(e){var t=0,r=0;e&&e.lengthComputable&&(t=e.loaded,r=e.total),this._doOnProgress(t,r)}},SpiderGL.Type.extend(SpiderGL.IO.XHRRequestBase,SpiderGL.IO.Request),SpiderGL.IO.XHRRequest=function(e,t){SpiderGL.IO.XHRRequestBase.call(this,e,t)},SpiderGL.IO.XHRRequest.prototype={_doPostSuccess:function(){this._data=this._xhr.responseText},get xhr(){return this._xhr},get response(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.XHRRequest,SpiderGL.IO.XHRRequestBase),SpiderGL.IO.TextRequest=function(e,t){SpiderGL.IO.XHRRequestBase.call(this,e,t)},SpiderGL.IO.TextRequest.prototype={_doPostSuccess:function(){this._data=this._xhr.responseText},get text(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.TextRequest,SpiderGL.IO.XHRRequestBase),SpiderGL.IO.readText=function(e){return new SpiderGL.IO.TextRequest(e,{async:!1}).text},SpiderGL.IO.requestText=function(e,t){return(t=SpiderGL.Utility.getDefaultObject({},t)).async=!0,t.send=!0,new SpiderGL.IO.TextRequest(e,t)},SpiderGL.IO.JSONRequest=function(e,t){SpiderGL.IO.XHRRequestBase.call(this,e,t)},SpiderGL.IO.JSONRequest.prototype={_doPostSuccess:function(){this._data=JSON.parse(this._xhr.responseText)},get text(){return this._xhr.responseText},get json(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.JSONRequest,SpiderGL.IO.XHRRequestBase),SpiderGL.IO.readJSON=function(e){return new SpiderGL.IO.JSONRequest(e,{async:!1}).json},SpiderGL.IO.requestJSON=function(e,t){return(t=SpiderGL.Utility.getDefaultObject({},t)).async=!0,t.send=!0,new SpiderGL.IO.JSONRequest(e,t)},SpiderGL.IO.BinaryRequest=function(e,t){SpiderGL.IO.XHRRequestBase.call(this,e,t)},SpiderGL.IO.BinaryRequest.prototype={_prepareXHR:function(){this._xhr.responseType="arraybuffer"},_setArrayBuffer:function(){var e=this._xhr;if("arraybuffer"==e.responseType)this._data=e.response;else if(null!=e.mozResponseArrayBuffer)this._data=e.mozResponseArrayBuffer;else if(null!=e.responseText){for(var t=new String(e.responseText),r=new Array(t.length),i=0,n=t.length;i<n;++i)r[i]=255&t.charCodeAt(i);this._data=new Uint8Array(r).buffer}else this._data=null},_doPostSuccess:function(){this._setArrayBuffer()},get data(){return this.ongoing&&this._setArrayBuffer(),this._data},get buffer(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.BinaryRequest,SpiderGL.IO.XHRRequestBase),SpiderGL.IO.readBinary=function(e){return new SpiderGL.IO.BinaryRequest(e,{async:!1}).buffer},SpiderGL.IO.requestBinary=function(e,t){return(t=SpiderGL.Utility.getDefaultObject({},t)).async=!0,t.send=!0,new SpiderGL.IO.BinaryRequest(e,t)},SpiderGL.IO.ImageRequest=function(e,t){SpiderGL.IO.Request.call(this,e,t=t||{});var r=this,e=new Image;this._img=e,(this._data=e).onabort=function(){r._doOnCancel(),r._doOnFinish()},e.onerror=function(){r._doOnError(),r._doOnFinish()},e.onload=function(){r._doOnSuccess(),r._doOnFinish()},void 0!==e.onprogress&&(e.onprogress=function(e){r._imgOnProgress(e)}),SpiderGL.Utility.getDefaultValue(t.send,SpiderGL.IO.Request.DEFAULT_SEND)&&this.send()},SpiderGL.IO.ImageRequest.prototype={_doPostSuccess:function(){this._data=this._img},_doCancel:function(){return this._img.src=null,this._img=new Image,!0},_doSend:function(){return this._img.src=this._url,!0},_imgOnProgress:function(e){var t=0,r=0;e&&e.lengthComputable&&(t=e.loaded,r=e.total),this._doOnProgress(t,r)},get image(){return this.data}},SpiderGL.Type.extend(SpiderGL.IO.ImageRequest,SpiderGL.IO.Request),SpiderGL.IO.requestImage=function(e,t){return(t=SpiderGL.Utility.getDefaultObject({},t)).async=!0,t.send=!0,new SpiderGL.IO.ImageRequest(e,t)},SpiderGL.IO.AggregateRequest=function(e){SpiderGL.IO.Request.call(this,"*",e=e||{});var i=this,t=(this._proxyOnProgress=function(e,t,r){i._reqOnProgress(e,t,r)},this._proxyOnCancel=function(e){i._reqOnCancel(e)},this._proxyOnError=function(e){i._reqOnError(e)},this._proxyOnSuccess=function(e){i._reqOnSuccess(e)},this._proxyOnFinish=function(e){i._reqOnFinish(e)},this._aggrStartTime=-1,this._aggrFinishTime=-1,this._eventReq=null,this._cancelledReqs=0,this._failedReqs=0,this._succeededReqs=0,this._requests=[],e.requests);if(t)for(var r=0,n=t.length;r<n;++r){var a=t[r];a&&!a.sent&&(this._installProxies(a),this.addRequest(a))}SpiderGL.Utility.getDefaultValue(e.send,SpiderGL.IO.Request.DEFAULT_SEND)&&this.send()},SpiderGL.IO.AggregateRequest.prototype={_doPostCancel:function(){this._requestsFinished||(this._status=SpiderGL.IO.Request.ONGOING)},_doPostError:function(){this._requestsFinished||(this._status=SpiderGL.IO.Request.ONGOING)},_doPostSuccess:function(){this._requestsFinished||(this._status=SpiderGL.IO.Request.ONGOING)},_doCancel:function(){for(var e=this._requests,t=0,r=e.length;t<r;++t)e[t].cancel();this._aggrFinishTime=SpiderGL.Utility.getTime()},_doSend:function(){this._aggrStartTime=SpiderGL.Utility.getTime();for(var e=this._requests,t=0,r=e.length;t<r;++t)e[t].send()},get _requestsFinished(){return this._cancelledReqs+this._failedReqs+this._succeededReqs==this._requests.length},_installProxies:function(e){e.addEventListener("progress",this._proxyOnProgress),e.addEventListener("cancel",this._proxyOnCancel),e.addEventListener("error",this._proxyOnError),e.addEventListener("success",this._proxyOnSuccess),e.addEventListener("finish",this._proxyOnFinish)},_uninstallProxies:function(e){e.removeEventListener("progress",this._proxyOnProgress),e.removeEventListener("cancel",this._proxyOnCancel),e.removeEventListener("error",this._proxyOnError),e.removeEventListener("success",this._proxyOnSuccess),e.removeEventListener("finish",this._proxyOnFinish)},_reqOnProgress:function(e,t,r){this._indexOf(this._requests,r)<0||(this._eventReq=r,this._doOnProgress(e,t),this._eventReq=null)},_reqOnCancel:function(e){this._indexOf(this._requests,e)<0||(this._eventReq=e,this._cancelledReqs++,this._requestsFinished&&(this._aggrFinishTime=SpiderGL.Utility.getTime(),this._cancelledReqs==this._requests.length)&&(this._eventReq=this)._doOnCancel(),this._eventReq=null)},_reqOnError:function(e){this._indexOf(this._requests,e)<0||(this._eventReq=e,this._failedReqs++,this._requestsFinished&&(this._aggrFinishTime=SpiderGL.Utility.getTime(),(this._eventReq=this)._doOnError()),this._eventReq=null)},_reqOnSuccess:function(e){this._indexOf(this._requests,e)<0||(this._eventReq=e,this._succeededReqs++,this._requestsFinished&&(this._aggrFinishTime=SpiderGL.Utility.getTime(),0<(this._eventReq=this)._failedReqs?this._doOnError():this._doOnSuccess()),this._eventReq=null)},_reqOnFinish:function(e){this._indexOf(this._requests,e)<0||(this._uninstallProxies(e),this._eventReq=e,this._requestsFinished&&(this._eventReq=this)._doOnFinish(),this._eventReq=null)},get eventSenderRequest(){return this._eventReq},get requests(){return this._requests.slice()},get requests$(){return this._requests},get startTime(){return this._aggrStartTime},get finishTime(){return this._aggrFinishTime},get elapsedTime(){return this._aggrStartTime<0?0:this._aggrFinishTime<0?SpiderGL.Utility.getTime()-this._aggrStartTime:this._aggrFinishTime-this._aggrStartTime},addRequest:function(e){!e||this._sent||0<=this._indexOf(this._requests,e)||this._requests.push(e)},removeRequest:function(e){!e||this._sent||(e=this._indexOf(this._requests,e))<0||this._requests.splice(e,1)}},SpiderGL.Type.extend(SpiderGL.IO.AggregateRequest,SpiderGL.IO.Request),SpiderGL.Math={},SpiderGL.Math.DEG_TO_RAD=Math.PI/180,SpiderGL.Math.E=Math.E,SpiderGL.Math.LN2=Math.LN2,SpiderGL.Math.LN10=Math.LN10,SpiderGL.Math.LOG2E=Math.LOG2E,SpiderGL.Math.LOG10E=Math.LOG10E,SpiderGL.Math.PI=Math.PI,SpiderGL.Math.RAD_TO_DEG=180/Math.PI,SpiderGL.Math.SQRT2=Math.SQRT2,SpiderGL.Math.MAX_VALUE=Number.MAX_VALUE,SpiderGL.Math.MIN_VALUE=Number.MIN_VALUE,SpiderGL.Math.MAX_NUMBER=SpiderGL.Math.MAX_VALUE,SpiderGL.Math.MIN_NUMBER=-SpiderGL.Math.MAX_VALUE,SpiderGL.Math.NAN=Number.NaN,SpiderGL.Math.INFINITY=1/0,SpiderGL.Math.abs=function(e){return Math.abs(e)},SpiderGL.Math.acos=function(e){return Math.acos(e)},SpiderGL.Math.asin=function(e){return Math.asin(e)},SpiderGL.Math.atan=function(e){return Math.atan(e)},SpiderGL.Math.atan2=function(e,t){return Math.atan2(e,t)},SpiderGL.Math.ceil=function(e){return Math.ceil(e)},SpiderGL.Math.clamp=function(e,t,r){return e<=t?t:r<=e?r:e},SpiderGL.Math.cos=function(e){return Math.cos(e)},SpiderGL.Math.degToRad=function(e){return e*SpiderGL.Math.DEG_TO_RAD},SpiderGL.Math.exp=function(e){return Math.exp(e)},SpiderGL.Math.floor=function(e){return Math.floor(e)},SpiderGL.Math.lerp=function(e,t,r){return e+r*(t-e)},SpiderGL.Math.ln=function(e){return Math.log(e)},SpiderGL.Math.log=function(e){return Math.log(e)},SpiderGL.Math.log2=function(e){return SpiderGL.Math.log(e)/SpiderGL.Math.LN2},SpiderGL.Math.log10=function(e){return SpiderGL.Math.log(e)/SpiderGL.Math.LN10},SpiderGL.Math.max=function(e){return Math.max.apply(Math,arguments)},SpiderGL.Math.min=function(e){return Math.min.apply(Math,arguments)},SpiderGL.Math.pow=function(e,t){return Math.pow(e,t)},SpiderGL.Math.radToDeg=function(e){return e*SpiderGL.Math.RAD_TO_DEG},SpiderGL.Math.random=function(){return Math.random()},SpiderGL.Math.random01=function(){return SpiderGL.Math.random()},SpiderGL.Math.random11=function(){return 2*SpiderGL.Math.random()-1},SpiderGL.Math.randomRange=function(e,t){return e+SpiderGL.Math.random()*(t-e)},SpiderGL.Math.round=function(e){return Math.round(e)},SpiderGL.Math.sin=function(e){return Math.sin(e)},SpiderGL.Math.sqrt=function(e){return Math.sqrt(e)},SpiderGL.Math.tan=function(e){return Math.tan(e)},SpiderGL.Math.Vec2={},SpiderGL.Math.Vec2.dup=function(e){return e.slice(0,2)},SpiderGL.Math.Vec2.scalar=function(e){return[e,e]},SpiderGL.Math.Vec2.zero=function(){return[0,0]},SpiderGL.Math.Vec2.one=function(){return[1,1]},SpiderGL.Math.Vec2.maxNumber=function(){return[SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER]},SpiderGL.Math.Vec2.minNumber=function(){return[SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER]},SpiderGL.Math.Vec2.to3=function(e,t){return[e[0],e[1],null!=t?t:0]},SpiderGL.Math.Vec2.to4=function(e,t,r){return[e[0],e[1],e[2],null!=t?t:0,null!=r?r:1]},SpiderGL.Math.Vec2.neg=function(e){return[-e[0],-e[1]]},SpiderGL.Math.Vec2.add=function(e,t){return[e[0]+t[0],e[1]+t[1]]},SpiderGL.Math.Vec2.adds=function(e,t){return[e[0]+t,e[1]+t]},SpiderGL.Math.Vec2.sub=function(e,t){return[e[0]-t[0],e[1]-t[1]]},SpiderGL.Math.Vec2.subs=function(e,t){return[e[0]-t,e[1]-t]},SpiderGL.Math.Vec2.ssub=function(e,t){return[e-t[0],e-t[1]]},SpiderGL.Math.Vec2.mul=function(e,t){return[e[0]*t[0],e[1]*t[1]]},SpiderGL.Math.Vec2.muls=function(e,t){return[e[0]*t,e[1]*t]},SpiderGL.Math.Vec2.div=function(e,t){return[e[0]/t[0],e[1]/t[1]]},SpiderGL.Math.Vec2.divs=function(e,t){return[e[0]/t,e[1]/t]},SpiderGL.Math.Vec2.sdiv=function(e,t){return[e/t[0],e/t[1]]},SpiderGL.Math.Vec2.rcp=function(e){return[1/e[0],1/e[1]]},SpiderGL.Math.Vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},SpiderGL.Math.Vec2.cross=function(e,t){return e[0]*t[1]-e[1]*t[0]},SpiderGL.Math.Vec2.perp=function(e){return[e[1],-e[0]]},SpiderGL.Math.Vec2.sqLength=function(e){return SpiderGL.Math.Vec2.dot(e,e)},SpiderGL.Math.Vec2.length=function(e){return SpiderGL.Math.sqrt(SpiderGL.Math.Vec2.sqLength(e))},SpiderGL.Math.Vec2.normalize=function(e){var t=1/SpiderGL.Math.Vec2.length(e);return SpiderGL.Math.Vec2.muls(e,t)},SpiderGL.Math.Vec2.abs=function(e){return[SpiderGL.Math.abs(e[0]),SpiderGL.Math.abs(e[1])]},SpiderGL.Math.Vec2.acos=function(e){return[SpiderGL.Math.acos(e[0]),SpiderGL.Math.acos(e[1])]},SpiderGL.Math.Vec2.asin=function(e){return[SpiderGL.Math.asin(e[0]),SpiderGL.Math.asin(e[1])]},SpiderGL.Math.Vec2.atan=function(e){return[SpiderGL.Math.atan(e[0]),SpiderGL.Math.atan(e[1])]},SpiderGL.Math.Vec2.atan2=function(e,t){return[SpiderGL.Math.atan2(e[0],t[0]),SpiderGL.Math.atan2(e[1],t[1])]},SpiderGL.Math.Vec2.ceil=function(e){return[SpiderGL.Math.ceil(e[0]),SpiderGL.Math.ceil(e[1])]},SpiderGL.Math.Vec2.clamp=function(e,t,r){return[SpiderGL.Math.clamp(e[0],t[0],r[0]),SpiderGL.Math.clamp(e[1],t[1],r[1])]},SpiderGL.Math.Vec2.cos=function(e){return[SpiderGL.Math.cos(e[0]),SpiderGL.Math.cos(e[1])]},SpiderGL.Math.Vec2.degToRad=function(e){return[SpiderGL.Math.degToRad(e[0]),SpiderGL.Math.degToRad(e[1])]},SpiderGL.Math.Vec2.exp=function(e){return[SpiderGL.Math.exp(e[0]),SpiderGL.Math.exp(e[1])]},SpiderGL.Math.Vec2.floor=function(e){return[SpiderGL.Math.floor(e[0]),SpiderGL.Math.floor(e[1])]},SpiderGL.Math.Vec2.lerp=function(e,t,r){return[SpiderGL.Math.lerp(e[0],t[0],r),SpiderGL.Math.lerp(e[1],t[1],r)]},SpiderGL.Math.Vec2.ln=function(e){return[SpiderGL.Math.ln(e[0]),SpiderGL.Math.ln(e[1])]},SpiderGL.Math.Vec2.log=function(e){return[SpiderGL.Math.log(e[0]),SpiderGL.Math.log(e[1])]},SpiderGL.Math.Vec2.log2=function(e){return[SpiderGL.Math.log2(e[0]),SpiderGL.Math.log2(e[1])]},SpiderGL.Math.Vec2.log10=function(e){return[SpiderGL.Math.log10(e[0]),SpiderGL.Math.log10(e[1])]},SpiderGL.Math.Vec2.max=function(e,t){return[SpiderGL.Math.max(e[0],t[0]),SpiderGL.Math.max(e[1],t[1])]},SpiderGL.Math.Vec2.min=function(e,t){return[SpiderGL.Math.min(e[0],t[0]),SpiderGL.Math.min(e[1],t[1])]},SpiderGL.Math.Vec2.pow=function(e,t){return[SpiderGL.Math.pow(e[0],t[0]),SpiderGL.Math.pow(e[1],t[1])]},SpiderGL.Math.Vec2.radToDeg=function(e){return[SpiderGL.Math.radToDeg(e[0]),SpiderGL.Math.radToDeg(e[1])]},SpiderGL.Math.Vec2.random=function(){return[SpiderGL.Math.random(),SpiderGL.Math.random()]},SpiderGL.Math.Vec2.random01=function(){return[SpiderGL.Math.random01(),SpiderGL.Math.random01()]},SpiderGL.Math.Vec2.random11=function(){return[SpiderGL.Math.random11(),SpiderGL.Math.random11()]},SpiderGL.Math.Vec2.randomRange=function(e,t){return[SpiderGL.Math.randomRange(e[0],t[0]),SpiderGL.Math.randomRange(e[1],t[1])]},SpiderGL.Math.Vec2.round=function(e){return[SpiderGL.Math.round(e[0]),SpiderGL.Math.round(e[1])]},SpiderGL.Math.Vec2.sin=function(e){return[SpiderGL.Math.sin(e[0]),SpiderGL.Math.sin(e[1])]},SpiderGL.Math.Vec2.sqrt=function(e){return[SpiderGL.Math.sqrt(e[0]),SpiderGL.Math.sqrt(e[1])]},SpiderGL.Math.Vec2.tan=function(e){return[SpiderGL.Math.tan(e[0]),SpiderGL.Math.tan(e[1])]},SpiderGL.Math.Vec2.copy$=function(e,t){return e[0]=t[0],e[1]=t[1],e},SpiderGL.Math.Vec2.neg$=function(e){return e[0]=-e[0],e[1]=-e[1],e},SpiderGL.Math.Vec2.add$=function(e,t){return e[0]+=t[0],e[1]+=t[1],e},SpiderGL.Math.Vec2.adds$=function(e,t){return e[0]+=t,e[1]+=t,e},SpiderGL.Math.Vec2.sub$=function(e,t){return e[0]-=t[0],e[1]-=t[1],e},SpiderGL.Math.Vec2.subs$=function(e,t){return e[0]-=t,e[1]-=t,e},SpiderGL.Math.Vec2.ssub$=function(e,t){return t[0]=e-t[0],t[1]=e-t[1],t},SpiderGL.Math.Vec2.mul$=function(e,t){return e[0]*=t[0],e[1]*=t[1],e},SpiderGL.Math.Vec2.muls$=function(e,t){return e[0]*=t,e[1]*=t,e},SpiderGL.Math.Vec2.div$=function(e,t){return e[0]/=t[0],e[1]/=t[1],e},SpiderGL.Math.Vec2.divs$=function(e,t){return e[0]/=t,e[1]/=t,e},SpiderGL.Math.Vec2.sdiv$=function(e,t){return e[0]=t/e[0],e[1]=t/e[1],e},SpiderGL.Math.Vec2.perp$=function(e){var t=e[0];return e[0]=e[1],e[1]=-t,e},SpiderGL.Math.Vec2.normalize$=function(e){var t=1/SpiderGL.Math.Vec2.length(e);return SpiderGL.Math.Vec2.muls$(e,t)},SpiderGL.Math.Vec3={},SpiderGL.Math.Vec3.dup=function(e){return e.slice(0,3)},SpiderGL.Math.Vec3.scalar=function(e){return[e,e,e]},SpiderGL.Math.Vec3.zero=function(){return[0,0,0]},SpiderGL.Math.Vec3.one=function(){return[1,1,1]},SpiderGL.Math.Vec3.maxNumber=function(){return[SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER]},SpiderGL.Math.Vec3.minNumber=function(){return[SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER]},SpiderGL.Math.Vec3.to2=function(e){return[e[0],e[1]]},SpiderGL.Math.Vec3.to4=function(e,t){return[e[0],e[1],e[2],null!=t?t:1]},SpiderGL.Math.Vec3.neg=function(e){return[-e[0],-e[1],-e[2]]},SpiderGL.Math.Vec3.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},SpiderGL.Math.Vec3.adds=function(e,t){return[e[0]+t,e[1]+t,e[2]+t]},SpiderGL.Math.Vec3.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},SpiderGL.Math.Vec3.subs=function(e,t){return[e[0]-t,e[1]-t,e[2]-t]},SpiderGL.Math.Vec3.ssub=function(e,t){return[e-t[0],e-t[1],e-t[2]]},SpiderGL.Math.Vec3.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},SpiderGL.Math.Vec3.muls=function(e,t){return[e[0]*t,e[1]*t,e[2]*t]},SpiderGL.Math.Vec3.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2]]},SpiderGL.Math.Vec3.divs=function(e,t){return[e[0]/t,e[1]/t,e[2]/t]},SpiderGL.Math.Vec3.sdiv=function(e,t){return[e/t[0],e/t[1],e/t[2]]},SpiderGL.Math.Vec3.rcp=function(e){return[1/e[0],1/e[1],1/e[2]]},SpiderGL.Math.Vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},SpiderGL.Math.Vec3.cross=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},SpiderGL.Math.Vec3.sqLength=function(e){return SpiderGL.Math.Vec3.dot(e,e)},SpiderGL.Math.Vec3.length=function(e){return SpiderGL.Math.sqrt(SpiderGL.Math.Vec3.sqLength(e))},SpiderGL.Math.Vec3.normalize=function(e){var t=1/SpiderGL.Math.Vec3.length(e);return SpiderGL.Math.Vec3.muls(e,t)},SpiderGL.Math.Vec3.abs=function(e){return[SpiderGL.Math.abs(e[0]),SpiderGL.Math.abs(e[1]),SpiderGL.Math.abs(e[2])]},SpiderGL.Math.Vec3.acos=function(e){return[SpiderGL.Math.acos(e[0]),SpiderGL.Math.acos(e[1]),SpiderGL.Math.acos(e[2])]},SpiderGL.Math.Vec3.asin=function(e){return[SpiderGL.Math.asin(e[0]),SpiderGL.Math.asin(e[1]),SpiderGL.Math.asin(e[2])]},SpiderGL.Math.Vec3.atan=function(e){return[SpiderGL.Math.atan(e[0]),SpiderGL.Math.atan(e[1]),SpiderGL.Math.atan(e[2])]},SpiderGL.Math.Vec3.atan2=function(e,t){return[SpiderGL.Math.atan2(e[0],t[0]),SpiderGL.Math.atan2(e[1],t[1]),SpiderGL.Math.atan2(e[2],t[2])]},SpiderGL.Math.Vec3.ceil=function(e){return[SpiderGL.Math.ceil(e[0]),SpiderGL.Math.ceil(e[1]),SpiderGL.Math.ceil(e[2])]},SpiderGL.Math.Vec3.clamp=function(e,t,r){return[SpiderGL.Math.clamp(e[0],t[0],r[0]),SpiderGL.Math.clamp(e[1],t[1],r[1]),SpiderGL.Math.clamp(e[2],t[2],r[2])]},SpiderGL.Math.Vec3.cos=function(e){return[SpiderGL.Math.cos(e[0]),SpiderGL.Math.cos(e[1]),SpiderGL.Math.cos(e[2])]},SpiderGL.Math.Vec3.degToRad=function(e){return[SpiderGL.Math.degToRad(e[0]),SpiderGL.Math.degToRad(e[1]),SpiderGL.Math.degToRad(e[2])]},SpiderGL.Math.Vec3.exp=function(e){return[SpiderGL.Math.exp(e[0]),SpiderGL.Math.exp(e[1]),SpiderGL.Math.exp(e[2])]},SpiderGL.Math.Vec3.floor=function(e){return[SpiderGL.Math.floor(e[0]),SpiderGL.Math.floor(e[1]),SpiderGL.Math.floor(e[2])]},SpiderGL.Math.Vec3.lerp=function(e,t,r){return[SpiderGL.Math.lerp(e[0],t[0],r),SpiderGL.Math.lerp(e[1],t[1],r),SpiderGL.Math.lerp(e[2],t[2],r)]},SpiderGL.Math.Vec3.ln=function(e){return[SpiderGL.Math.ln(e[0]),SpiderGL.Math.ln(e[1]),SpiderGL.Math.ln(e[2])]},SpiderGL.Math.Vec3.log=function(e){return[SpiderGL.Math.log(e[0]),SpiderGL.Math.log(e[1]),SpiderGL.Math.log(e[2])]},SpiderGL.Math.Vec3.log2=function(e){return[SpiderGL.Math.log2(e[0]),SpiderGL.Math.log2(e[1]),SpiderGL.Math.log2(e[2])]},SpiderGL.Math.Vec3.log10=function(e){return[SpiderGL.Math.log10(e[0]),SpiderGL.Math.log10(e[1]),SpiderGL.Math.log10(e[2])]},SpiderGL.Math.Vec3.max=function(e,t){return[SpiderGL.Math.max(e[0],t[0]),SpiderGL.Math.max(e[1],t[1]),SpiderGL.Math.max(e[2],t[2])]},SpiderGL.Math.Vec3.min=function(e,t){return[SpiderGL.Math.min(e[0],t[0]),SpiderGL.Math.min(e[1],t[1]),SpiderGL.Math.min(e[2],t[2])]},SpiderGL.Math.Vec3.pow=function(e,t){return[SpiderGL.Math.pow(e[0],t[0]),SpiderGL.Math.pow(e[1],t[1]),SpiderGL.Math.pow(e[2],t[2])]},SpiderGL.Math.Vec3.radToDeg=function(e){return[SpiderGL.Math.radToDeg(e[0]),SpiderGL.Math.radToDeg(e[1]),SpiderGL.Math.radToDeg(e[2])]},SpiderGL.Math.Vec3.random=function(){return[SpiderGL.Math.random(),SpiderGL.Math.random(),SpiderGL.Math.random()]},SpiderGL.Math.Vec3.random01=function(){return[SpiderGL.Math.random01(),SpiderGL.Math.random01(),SpiderGL.Math.random01()]},SpiderGL.Math.Vec3.random11=function(){return[SpiderGL.Math.random11(),SpiderGL.Math.random11(),SpiderGL.Math.random11()]},SpiderGL.Math.Vec3.randomRange=function(e,t){return[SpiderGL.Math.randomRange(e[0],t[0]),SpiderGL.Math.randomRange(e[1],t[1]),SpiderGL.Math.randomRange(e[2],t[2])]},SpiderGL.Math.Vec3.round=function(e){return[SpiderGL.Math.round(e[0]),SpiderGL.Math.round(e[1]),SpiderGL.Math.round(e[2])]},SpiderGL.Math.Vec3.sin=function(e){return[SpiderGL.Math.sin(e[0]),SpiderGL.Math.sin(e[1]),SpiderGL.Math.sin(e[2])]},SpiderGL.Math.Vec3.sqrt=function(e){return[SpiderGL.Math.sqrt(e[0]),SpiderGL.Math.sqrt(e[1]),SpiderGL.Math.sqrt(e[2])]},SpiderGL.Math.Vec3.tan=function(e){return[SpiderGL.Math.tan(e[0]),SpiderGL.Math.tan(e[1]),SpiderGL.Math.tan(e[2])]},SpiderGL.Math.Vec3.copy$=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},SpiderGL.Math.Vec3.neg$=function(e){return e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e},SpiderGL.Math.Vec3.add$=function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e},SpiderGL.Math.Vec3.adds$=function(e,t){return e[0]+=t,e[1]+=t,e[2]+=t,e},SpiderGL.Math.Vec3.sub$=function(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e},SpiderGL.Math.Vec3.subs$=function(e,t){return e[0]-=t,e[1]-=t,e[2]-=t,e},SpiderGL.Math.Vec3.ssub$=function(e,t){return t[0]=e-t[0],t[1]=e-t[1],t[2]=e-t[2],t},SpiderGL.Math.Vec3.mul$=function(e,t){return e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e},SpiderGL.Math.Vec3.muls$=function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e},SpiderGL.Math.Vec3.div$=function(e,t){return e[0]/=t[0],e[1]/=t[1],e[2]/=t[2],e},SpiderGL.Math.Vec3.divs$=function(e,t){return e[0]/=t,e[1]/=t,e[2]/=t,e},SpiderGL.Math.Vec3.sdiv$=function(e,t){return e[0]=t/e[0],e[1]=t/e[1],e[2]=t/e[2],e},SpiderGL.Math.Vec3.normalize$=function(e){var t=1/SpiderGL.Math.Vec3.length(e);return SpiderGL.Math.Vec3.muls$(e,t)},SpiderGL.Math.Vec4={},SpiderGL.Math.Vec4.dup=function(e){return e.slice(0,4)},SpiderGL.Math.Vec4.scalar=function(e){return[e,e,e,e]},SpiderGL.Math.Vec4.zero=function(){return[0,0,0,0]},SpiderGL.Math.Vec4.one=function(){return[1,1,1,1]},SpiderGL.Math.Vec4.maxNumber=function(){return[SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER,SpiderGL.Math.MAX_NUMBER]},SpiderGL.Math.Vec4.minNumber=function(){return[SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER,SpiderGL.Math.MIN_NUMBER]},SpiderGL.Math.Vec4.to2=function(e){return[e[0],e[1]]},SpiderGL.Math.Vec4.to3=function(e){return[e[0],e[1],e[2]]},SpiderGL.Math.Vec4.neg=function(e){return[-e[0],-e[1],-e[2],-e[3]]},SpiderGL.Math.Vec4.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3]]},SpiderGL.Math.Vec4.adds=function(e,t){return[e[0]+t,e[1]+t,e[2]+t,e[3]+t]},SpiderGL.Math.Vec4.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3]]},SpiderGL.Math.Vec4.subs=function(e,t){return[e[0]-t,e[1]-t,e[2]-t,e[3]-t]},SpiderGL.Math.Vec4.ssub=function(e,t){return[e-t[0],e-t[1],e-t[2],e-t[3]]},SpiderGL.Math.Vec4.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3]]},SpiderGL.Math.Vec4.muls=function(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]},SpiderGL.Math.Vec4.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3]]},SpiderGL.Math.Vec4.divs=function(e,t){return[e[0]/t,e[1]/t,e[2]/t,e[3]/t]},SpiderGL.Math.Vec4.sdiv=function(e,t){return[e/t[0],e/t[1],e/t[2],e/t[3]]},SpiderGL.Math.Vec4.rcp=function(e){return[1/e[0],1/e[1],1/e[2],1/e[3]]},SpiderGL.Math.Vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},SpiderGL.Math.Vec4.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0],n=t[0]*r[2]-t[2]*r[0],a=t[0]*r[3]-t[3]*r[0],s=t[1]*r[2]-t[2]*r[1],o=t[1]*r[3]-t[3]*r[1],t=t[2]*r[3]-t[3]*r[2];return[e[1]*t-e[2]*o+e[3]*s,e[0]*t+e[2]*a-e[3]*n,e[0]*o-e[1]*a+e[3]*i,e[0]*s+e[1]*n-e[2]*i]},SpiderGL.Math.Vec4.sqLength=function(e){return SpiderGL.Math.Vec4.dot(e,e)},SpiderGL.Math.Vec4.length=function(e){return SpiderGL.Math.sqrt(SpiderGL.Math.Vec4.sqLength(e))},SpiderGL.Math.Vec4.normalize=function(e){var t=1/SpiderGL.Math.Vec4.length(e);return SpiderGL.Math.Vec4.muls(e,t)},SpiderGL.Math.Vec4.project=function(e){var t=1/e[3];return[e[0]*t,e[1]*t,e[2]*t,1]},SpiderGL.Math.Vec4.abs=function(e){return[SpiderGL.Math.abs(e[0]),SpiderGL.Math.abs(e[1]),SpiderGL.Math.abs(e[2]),SpiderGL.Math.abs(e[3])]},SpiderGL.Math.Vec4.acos=function(e){return[SpiderGL.Math.acos(e[0]),SpiderGL.Math.acos(e[1]),SpiderGL.Math.acos(e[2]),SpiderGL.Math.acos(e[3])]},SpiderGL.Math.Vec4.asin=function(e){return[SpiderGL.Math.asin(e[0]),SpiderGL.Math.asin(e[1]),SpiderGL.Math.asin(e[2]),SpiderGL.Math.asin(e[3])]},SpiderGL.Math.Vec4.atan=function(e){return[SpiderGL.Math.atan(e[0]),SpiderGL.Math.atan(e[1]),SpiderGL.Math.atan(e[2]),SpiderGL.Math.atan(e[3])]},SpiderGL.Math.Vec4.atan2=function(e,t){return[SpiderGL.Math.atan2(e[0],t[0]),SpiderGL.Math.atan2(e[1],t[1]),SpiderGL.Math.atan2(e[2],t[2]),SpiderGL.Math.atan2(e[3],t[3])]},SpiderGL.Math.Vec4.ceil=function(e){return[SpiderGL.Math.ceil(e[0]),SpiderGL.Math.ceil(e[1]),SpiderGL.Math.ceil(e[2]),SpiderGL.Math.ceil(e[3])]},SpiderGL.Math.Vec4.clamp=function(e,t,r){return[SpiderGL.Math.clamp(e[0],t[0],r[0]),SpiderGL.Math.clamp(e[1],t[1],r[1]),SpiderGL.Math.clamp(e[2],t[2],r[2]),SpiderGL.Math.clamp(e[3],t[3],r[3])]},SpiderGL.Math.Vec4.cos=function(e){return[SpiderGL.Math.cos(e[0]),SpiderGL.Math.cos(e[1]),SpiderGL.Math.cos(e[2]),SpiderGL.Math.cos(e[3])]},SpiderGL.Math.Vec4.degToRad=function(e){return[SpiderGL.Math.degToRad(e[0]),SpiderGL.Math.degToRad(e[1]),SpiderGL.Math.degToRad(e[2]),SpiderGL.Math.degToRad(e[3])]},SpiderGL.Math.Vec4.exp=function(e){return[SpiderGL.Math.exp(e[0]),SpiderGL.Math.exp(e[1]),SpiderGL.Math.exp(e[2]),SpiderGL.Math.exp(e[3])]},SpiderGL.Math.Vec4.floor=function(e){return[SpiderGL.Math.floor(e[0]),SpiderGL.Math.floor(e[1]),SpiderGL.Math.floor(e[2]),SpiderGL.Math.floor(e[3])]},SpiderGL.Math.Vec4.lerp=function(e,t,r){return[SpiderGL.Math.lerp(e[0],t[0],r),SpiderGL.Math.lerp(e[1],t[1],r),SpiderGL.Math.lerp(e[2],t[2],r),SpiderGL.Math.lerp(e[3],t[3],r)]},SpiderGL.Math.Vec4.ln=function(e){return[SpiderGL.Math.ln(e[0]),SpiderGL.Math.ln(e[1]),SpiderGL.Math.ln(e[2]),SpiderGL.Math.ln(e[3])]},SpiderGL.Math.Vec4.log=function(e){return[SpiderGL.Math.log(e[0]),SpiderGL.Math.log(e[1]),SpiderGL.Math.log(e[2]),SpiderGL.Math.log(e[3])]},SpiderGL.Math.Vec4.log2=function(e){return[SpiderGL.Math.log2(e[0]),SpiderGL.Math.log2(e[1]),SpiderGL.Math.log2(e[2]),SpiderGL.Math.log2(e[3])]},SpiderGL.Math.Vec4.log10=function(e){return[SpiderGL.Math.log10(e[0]),SpiderGL.Math.log10(e[1]),SpiderGL.Math.log10(e[2]),SpiderGL.Math.log10(e[3])]},SpiderGL.Math.Vec4.max=function(e,t){return[SpiderGL.Math.max(e[0],t[0]),SpiderGL.Math.max(e[1],t[1]),SpiderGL.Math.max(e[2],t[2]),SpiderGL.Math.max(e[3],t[3])]},SpiderGL.Math.Vec4.min=function(e,t){return[SpiderGL.Math.min(e[0],t[0]),SpiderGL.Math.min(e[1],t[1]),SpiderGL.Math.min(e[2],t[2]),SpiderGL.Math.min(e[3],t[3])]},SpiderGL.Math.Vec4.pow=function(e,t){return[SpiderGL.Math.pow(e[0],t[0]),SpiderGL.Math.pow(e[1],t[1]),SpiderGL.Math.pow(e[2],t[2]),SpiderGL.Math.pow(e[3],t[3])]},SpiderGL.Math.Vec4.radToDeg=function(e){return[SpiderGL.Math.radToDeg(e[0]),SpiderGL.Math.radToDeg(e[1]),SpiderGL.Math.radToDeg(e[2]),SpiderGL.Math.radToDeg(e[3])]},SpiderGL.Math.Vec4.random=function(){return[SpiderGL.Math.random(),SpiderGL.Math.random(),SpiderGL.Math.random(),SpiderGL.Math.random()]},SpiderGL.Math.Vec4.random01=function(){return[SpiderGL.Math.random01(),SpiderGL.Math.random01(),SpiderGL.Math.random01(),SpiderGL.Math.random01()]},SpiderGL.Math.Vec4.random11=function(){return[SpiderGL.Math.random11(),SpiderGL.Math.random11(),SpiderGL.Math.random11(),SpiderGL.Math.random11()]},SpiderGL.Math.Vec4.randomRange=function(e,t){return[SpiderGL.Math.randomRange(e[0],t[0]),SpiderGL.Math.randomRange(e[1],t[1]),SpiderGL.Math.randomRange(e[2],t[2]),SpiderGL.Math.randomRange(e[3],t[3])]},SpiderGL.Math.Vec4.round=function(e){return[SpiderGL.Math.round(e[0]),SpiderGL.Math.round(e[1]),SpiderGL.Math.round(e[2]),SpiderGL.Math.round(e[3])]},SpiderGL.Math.Vec4.sin=function(e){return[SpiderGL.Math.sin(e[0]),SpiderGL.Math.sin(e[1]),SpiderGL.Math.sin(e[2]),SpiderGL.Math.sin(e[3])]},SpiderGL.Math.Vec4.sqrt=function(e){return[SpiderGL.Math.sqrt(e[0]),SpiderGL.Math.sqrt(e[1]),SpiderGL.Math.sqrt(e[2]),SpiderGL.Math.sqrt(e[3])]},SpiderGL.Math.Vec4.tan=function(e){return[SpiderGL.Math.tan(e[0]),SpiderGL.Math.tan(e[1]),SpiderGL.Math.tan(e[2]),SpiderGL.Math.tan(e[3])]},SpiderGL.Math.Vec4.copy$=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},SpiderGL.Math.Vec4.neg$=function(e){return e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e[3]=-e[3],e},SpiderGL.Math.Vec4.add$=function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e},SpiderGL.Math.Vec4.adds$=function(e,t){return e[0]+=t,e[1]+=t,e[2]+=t,e[3]+=t,e},SpiderGL.Math.Vec4.sub$=function(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e[3]-=t[3],e},SpiderGL.Math.Vec4.subs$=function(e,t){return e[0]-=t,e[1]-=t,e[2]-=t,e[3]-=t,e},SpiderGL.Math.Vec4.ssub$=function(e,t){return t[0]=e-t[0],t[1]=e-t[1],t[2]=e-t[2],t[3]=e-t[3],t},SpiderGL.Math.Vec4.mul$=function(e,t){return e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e[3]*=t[3],e},SpiderGL.Math.Vec4.muls$=function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e},SpiderGL.Math.Vec4.div$=function(e,t){return e[0]/=t[0],e[1]/=t[1],e[2]/=t[2],e[3]/=t[3],e},SpiderGL.Math.Vec4.divs$=function(e,t){return e[0]/=t,e[1]/=t,e[2]/=t,e[3]/=t,e},SpiderGL.Math.Vec4.sdiv$=function(e,t){return e[0]=t/e[0],e[1]=t/e[1],e[2]=t/e[2],e[3]=t/e[3],e},SpiderGL.Math.Vec4.normalize$=function(e){var t=1/SpiderGL.Math.Vec4.length(e);return SpiderGL.Math.Vec4.muls$(e,t)},SpiderGL.Math.Mat3={},SpiderGL.Math.Mat3.dup=function(e){return e.slice(0,9)},SpiderGL.Math.Mat3.scalar=function(e){return[e,e,e,e,e,e,e,e,e]},SpiderGL.Math.Mat3.zero=function(){return[0,0,0,0,0,0,0,0,0]},SpiderGL.Math.Mat3.one=function(){return[1,1,1,1,1,1,1,1,1]},SpiderGL.Math.Mat3.diag=function(e){return[e[0],0,0,0,e[0],0,0,0,e[0]]},SpiderGL.Math.Mat3.identity=function(){return[1,0,0,0,1,0,0,0,1]},SpiderGL.Math.Mat3.to44=function(e){return[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]},SpiderGL.Math.Mat3.mul2=function(e,t,r){return[e[0]*t[0]+e[3]*t[1]+e[6]*(r=null==r?0:r),e[1]*t[0]+e[4]*t[1]+e[7]*r]},SpiderGL.Math.Mat3.mul3=function(e,t){return[e[0]*t[0]+e[3]*t[1]+e[6]*t[2],e[1]*t[0]+e[4]*t[1]+e[7]*t[2],e[2]*t[0]+e[5]*t[1]+e[8]*t[2]]},SpiderGL.Math.Mat3.transpose=function(e){return[e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]]},SpiderGL.Math.Mat4={},SpiderGL.Math.Mat4.dup=function(e){return e.slice(0,16)},SpiderGL.Math.Mat4.scalar=function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},SpiderGL.Math.Mat4.zero=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},SpiderGL.Math.Mat4.one=function(){return[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},SpiderGL.Math.Mat4.diag=function(e){return[e[0],0,0,0,0,e[0],0,0,0,0,e[0],0,0,0,0,e[0]]},SpiderGL.Math.Mat4.identity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},SpiderGL.Math.Mat4.to33=function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},SpiderGL.Math.Mat4.elem=function(e,t,r){return e[t+4*r]},SpiderGL.Math.Mat4.elem$=function(e,t,r,i){e[t+4*r]=i},SpiderGL.Math.Mat4.row=function(e,t){return[e[t+0],e[t+4],e[t+8],e[t+12]]},SpiderGL.Math.Mat4.row$=function(e,t,r){e[t+0]=r[0],e[t+4]=r[1],e[t+8]=r[2],e[t+12]=r[3]},SpiderGL.Math.Mat4.col=function(e,t){t*=4;return[e[0+t],e[1+t],e[2+t],e[3+t]]},SpiderGL.Math.Mat4.col$=function(e,t,r){t*=4;e[0+t]=r[0],e[1+t]=r[1],e[2+t]=r[2],e[3+t]=r[3]},SpiderGL.Math.Mat4.isIdentity=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},SpiderGL.Math.Mat4.neg=function(e){return[-e[0],-e[1],-e[2],-e[3],-e[4],-e[5],-e[6],-e[7],-e[8],-e[9],-e[10],-e[11],-e[12],-e[13],-e[14],-e[15]]},SpiderGL.Math.Mat4.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7],e[8]+t[8],e[9]+t[9],e[10]+t[10],e[11]+t[11],e[12]+t[12],e[13]+t[13],e[14]+t[14],e[15]+t[15]]},SpiderGL.Math.Mat4.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7],e[8]-t[8],e[9]-t[9],e[10]-t[10],e[11]-t[11],e[12]-t[12],e[13]-t[13],e[14]-t[14],e[15]-t[15]]},SpiderGL.Math.Mat4.mul=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],u=e[6],d=e[7],p=e[8],h=e[9],_=e[10],c=e[11],l=e[12],f=e[13],L=e[14],e=e[15],S=t[0],g=t[1],G=t[2],m=t[3],T=t[4],M=t[5],E=t[6],b=t[7],x=t[8],v=t[9],y=t[10],A=t[11],R=t[12],P=t[13],I=t[14],t=t[15];return[r*S+s*g+p*G+l*m,i*S+o*g+h*G+f*m,n*S+u*g+_*G+L*m,a*S+d*g+c*G+e*m,r*T+s*M+p*E+l*b,i*T+o*M+h*E+f*b,n*T+u*M+_*E+L*b,a*T+d*M+c*E+e*b,r*x+s*v+p*y+l*A,i*x+o*v+h*y+f*A,n*x+u*v+_*y+L*A,a*x+d*v+c*y+e*A,r*R+s*P+p*I+l*t,i*R+o*P+h*I+f*t,n*R+u*P+_*I+L*t,a*R+d*P+c*I+e*t]},SpiderGL.Math.Mat4.muls=function(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t,e[8]*t,e[9]*t,e[10]*t,e[11]*t,e[12]*t,e[13]*t,e[14]*t,e[15]*t]},SpiderGL.Math.Mat4.mul3=function(e,t,r){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*(r=null==r?1:r),e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*r,e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*r]},SpiderGL.Math.Mat4.mul4=function(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3]]},SpiderGL.Math.Mat4.rcp=function(e){return[1/e[0],1/e[1],1/e[2],1/e[3],1/e[4],1/e[5],1/e[6],1/e[7],1/e[8],1/e[9],1/e[10],1/e[11],1/e[12],1/e[13],1/e[14],1/e[15]]},SpiderGL.Math.Mat4.compMul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3],e[4]*t[4],e[5]*t[5],e[6]*t[6],e[7]*t[7],e[8]*t[8],e[9]*t[9],e[10]*t[10],e[11]*t[11],e[12]*t[12],e[13]*t[13],e[14]*t[14],e[15]*t[15]]},SpiderGL.Math.Mat4.compDiv=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3],e[4]/t[4],e[5]/t[5],e[6]/t[6],e[7]/t[7],e[8]/t[8],e[9]/t[9],e[10]/t[10],e[11]/t[11],e[12]/t[12],e[13]/t[13],e[14]/t[14],e[15]/t[15]]},SpiderGL.Math.Mat4.transpose=function(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]},SpiderGL.Math.Mat4.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],u=e[7],d=e[8],p=e[9],h=e[10],_=e[11],c=e[12],l=e[13],f=e[14],e=e[15];return c*p*o*n-d*l*o*n-c*s*h*n+a*l*h*n+d*s*f*n-a*p*f*n-c*p*i*u+d*l*i*u+c*r*h*u-t*l*h*u-d*r*f*u+t*p*f*u+c*s*i*_-a*l*i*_-c*r*o*_+t*l*o*_+a*r*f*_-t*s*f*_-d*s*i*e+a*p*i*e+d*r*o*e-t*p*o*e-a*r*h*e+t*s*h*e},SpiderGL.Math.Mat4.inverse=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],u=e[7],d=e[8],p=e[9],h=e[10],_=e[11],c=e[12],l=e[13],f=e[14],e=e[15],L=1/(c*p*o*n-d*l*o*n-c*s*h*n+a*l*h*n+d*s*f*n-a*p*f*n-c*p*i*u+d*l*i*u+c*r*h*u-t*l*h*u-d*r*f*u+t*p*f*u+c*s*i*_-a*l*i*_-c*r*o*_+t*l*o*_+a*r*f*_-t*s*f*_-d*s*i*e+a*p*i*e+d*r*o*e-t*p*o*e-a*r*h*e+t*s*h*e);return[L*(p*f*u-l*h*u+l*o*_-s*f*_-p*o*e+s*h*e),L*(l*h*n-p*f*n-l*i*_+r*f*_+p*i*e-r*h*e),L*(s*f*n-l*o*n+l*i*u-r*f*u-s*i*e+r*o*e),L*(p*o*n-s*h*n-p*i*u+r*h*u+s*i*_-r*o*_),L*(c*h*u-d*f*u-c*o*_+a*f*_+d*o*e-a*h*e),L*(d*f*n-c*h*n+c*i*_-t*f*_-d*i*e+t*h*e),L*(c*o*n-a*f*n-c*i*u+t*f*u+a*i*e-t*o*e),L*(a*h*n-d*o*n+d*i*u-t*h*u-a*i*_+t*o*_),L*(d*l*u-c*p*u+c*s*_-a*l*_-d*s*e+a*p*e),L*(c*p*n-d*l*n-c*r*_+t*l*_+d*r*e-t*p*e),L*(a*l*n-c*s*n+c*r*u-t*l*u-a*r*e+t*s*e),L*(d*s*n-a*p*n-d*r*u+t*p*u+a*r*_-t*s*_),L*(c*p*o-d*l*o-c*s*h+a*l*h+d*s*f-a*p*f),L*(d*l*i-c*p*i+c*r*h-t*l*h-d*r*f+t*p*f),L*(c*s*i-a*l*i-c*r*o+t*l*o+a*r*f-t*s*f),L*(a*p*i-d*s*i+d*r*o-t*p*o-a*r*h+t*s*h)]},SpiderGL.Math.Mat4.inverseTranspose33=function(e){var t=e[0],r=e[1],i=e[2],n=e[4],a=e[5],s=e[6],o=e[8],u=e[9],e=e[10],d=1/(t*(e*a-s*u)-r*(e*n-s*o)+i*(u*n-a*o));return[d*(e*a-s*u),d*(s*o-e*n),d*(u*n-a*o),d*(i*u-e*r),d*(e*t-i*o),d*(r*o-u*t),d*(s*r-i*a),d*(i*n-s*t),d*(a*t-r*n)]},SpiderGL.Math.Mat4.trace=function(e){return e[0]+e[5]+e[10]+e[15]},SpiderGL.Math.Mat4.translation=function(e){return[1,0,0,0,0,1,0,0,0,0,1,0,e[0],e[1],e[2],1]},SpiderGL.Math.Mat4.rotationAngleAxis=function(e,t){var r,i,n,a,t=SpiderGL.Math.Vec3.normalize(t),s=SpiderGL.Math.sin(e),e=SpiderGL.Math.cos(e),o=1-e,u=t[0],d=t[1],t=t[2];return[u*u*o+e,o*(r=u*d)+(a=t*s),o*(i=t*u)-(n=d*s),0,o*r-a,d*d*o+e,o*(r=d*t)+(a=u*s),0,o*i+n,o*r-a,t*t*o+e,0,0,0,0,1]},SpiderGL.Math.Mat4.scaling=function(e){return[e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,1]},SpiderGL.Math.Mat4.lookAt=function(e,t,r){var t=SpiderGL.Math.Vec3.normalize(SpiderGL.Math.Vec3.sub(t,e)),r=SpiderGL.Math.Vec3.normalize(r),i=SpiderGL.Math.Vec3.normalize(SpiderGL.Math.Vec3.cross(t,r)),r=SpiderGL.Math.Vec3.cross(i,t),i=[i[0],r[0],-t[0],0,i[1],r[1],-t[1],0,i[2],r[2],-t[2],0,0,0,0,1];return SpiderGL.Math.Mat4.translate$(i,SpiderGL.Math.Vec3.neg(e))},SpiderGL.Math.Mat4.ortho=function(e,t){var r=SpiderGL.Math.Vec3.add(t,e),t=SpiderGL.Math.Vec3.sub(t,e);return[2/t[0],0,0,0,0,2/t[1],0,0,0,0,-2/t[2],0,-r[0]/t[0],-r[1]/t[1],-r[2]/t[2],1]},SpiderGL.Math.Mat4.frustum=function(e,t){var r=SpiderGL.Math.Vec3.add(t,e),i=SpiderGL.Math.Vec3.sub(t,e),e=2*e[2];return[e/i[0],0,0,0,0,e/i[1],0,0,r[0]/i[0],r[1]/i[1],-r[2]/i[2],-1,0,0,-e*t[2]/i[2],0]},SpiderGL.Math.Mat4.perspective=function(e,t,r,i){e=r*SpiderGL.Math.tan(e/2),t*=e;return SpiderGL.Math.Mat4.frustum([-t,-e,r],[t,e,i])},SpiderGL.Math.Mat4.copy$=function(e,t){for(var r=0;r<16;++r)e[r]=t[r];return e},SpiderGL.Math.Mat4.identity$=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},SpiderGL.Math.Mat4.neg$=function(e){for(var t=0;t<16;++t)e[t]=-e[t];return e},SpiderGL.Math.Mat4.add$=function(e,t){for(var r=0;r<16;++r)e[r]+=t[r];return e},SpiderGL.Math.Mat4.sub$=function(e,t){for(var r=0;r<16;++r)e[r]-=t[r];return e},SpiderGL.Math.Mat4.mul$=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],u=e[6],d=e[7],p=e[8],h=e[9],_=e[10],c=e[11],l=e[12],f=e[13],L=e[14],S=e[15],g=t[0],G=t[1],m=t[2],T=t[3],M=t[4],E=t[5],b=t[6],x=t[7],v=t[8],y=t[9],A=t[10],R=t[11],P=t[12],I=t[13],D=t[14],t=t[15];return e[0]=r*g+s*G+p*m+l*T,e[1]=i*g+o*G+h*m+f*T,e[2]=n*g+u*G+_*m+L*T,e[3]=a*g+d*G+c*m+S*T,e[4]=r*M+s*E+p*b+l*x,e[5]=i*M+o*E+h*b+f*x,e[6]=n*M+u*E+_*b+L*x,e[7]=a*M+d*E+c*b+S*x,e[8]=r*v+s*y+p*A+l*R,e[9]=i*v+o*y+h*A+f*R,e[10]=n*v+u*y+_*A+L*R,e[11]=a*v+d*y+c*A+S*R,e[12]=r*P+s*I+p*D+l*t,e[13]=i*P+o*I+h*D+f*t,e[14]=n*P+u*I+_*D+L*t,e[15]=a*P+d*I+c*D+S*t,e},SpiderGL.Math.Mat4.muls$=function(e,t){for(var r=0;r<16;++r)e[r]*=t;return e},SpiderGL.Math.Mat4.compMul$=function(e,t){for(var r=0;r<16;++r)e[r]*=t[r];return e},SpiderGL.Math.Mat4.compDiv$=function(e,t){for(var r=0;r<16;++r)e[r]/=t[r];return e},SpiderGL.Math.Mat4.transpose$=function(e){var t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,e},SpiderGL.Math.Mat4.invert$=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],u=e[7],d=e[8],p=e[9],h=e[10],_=e[11],c=e[12],l=e[13],f=e[14],L=e[15],S=1/(c*p*o*n-d*l*o*n-c*s*h*n+a*l*h*n+d*s*f*n-a*p*f*n-c*p*i*u+d*l*i*u+c*r*h*u-t*l*h*u-d*r*f*u+t*p*f*u+c*s*i*_-a*l*i*_-c*r*o*_+t*l*o*_+a*r*f*_-t*s*f*_-d*s*i*L+a*p*i*L+d*r*o*L-t*p*o*L-a*r*h*L+t*s*h*L);return e[0]=S*(p*f*u-l*h*u+l*o*_-s*f*_-p*o*L+s*h*L),e[1]=S*(l*h*n-p*f*n-l*i*_+r*f*_+p*i*L-r*h*L),e[2]=S*(s*f*n-l*o*n+l*i*u-r*f*u-s*i*L+r*o*L),e[3]=S*(p*o*n-s*h*n-p*i*u+r*h*u+s*i*_-r*o*_),e[4]=S*(c*h*u-d*f*u-c*o*_+a*f*_+d*o*L-a*h*L),e[5]=S*(d*f*n-c*h*n+c*i*_-t*f*_-d*i*L+t*h*L),e[6]=S*(c*o*n-a*f*n-c*i*u+t*f*u+a*i*L-t*o*L),e[7]=S*(a*h*n-d*o*n+d*i*u-t*h*u-a*i*_+t*o*_),e[8]=S*(d*l*u-c*p*u+c*s*_-a*l*_-d*s*L+a*p*L),e[9]=S*(c*p*n-d*l*n-c*r*_+t*l*_+d*r*L-t*p*L),e[10]=S*(a*l*n-c*s*n+c*r*u-t*l*u-a*r*L+t*s*L),e[11]=S*(d*s*n-a*p*n-d*r*u+t*p*u+a*r*_-t*s*_),e[12]=S*(c*p*o-d*l*o-c*s*h+a*l*h+d*s*f-a*p*f),e[13]=S*(d*l*i-c*p*i+c*r*h-t*l*h-d*r*f+t*p*f),e[14]=S*(c*s*i-a*l*i-c*r*o+t*l*o+a*r*f-t*s*f),e[15]=S*(a*p*i-d*s*i+d*r*o-t*p*o-a*r*h+t*s*h),e},SpiderGL.Math.Mat4.translate$=function(e,t){var r=t[0],i=t[1],t=t[2];return e[12]=e[0]*r+e[4]*i+e[8]*t+e[12],e[13]=e[1]*r+e[5]*i+e[9]*t+e[13],e[14]=e[2]*r+e[6]*i+e[10]*t+e[14],e[15]=e[3]*r+e[7]*i+e[11]*t+e[15],e},SpiderGL.Math.Mat4.rotateAngleAxis$=function(e,t,r){t=SpiderGL.Math.Mat4.rotationAngleAxis(t,r);return SpiderGL.Math.Mat4.mul$(e,t)},SpiderGL.Math.Mat4.scale$=function(e,t){var r=t[0],i=t[1],t=t[2];return e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e},SpiderGL.Math.Quat={},SpiderGL.Math.Quat.dup=function(e){return e.slice(0,4)},SpiderGL.Math.Quat.identity=function(){return[0,0,0,1]},SpiderGL.Math.Quat.inverse=function(e){return[-e[0],-e[1],-e[2],e[3]]},SpiderGL.Math.Quat.mul=function(e,t){var r=e[0],i=e[1],n=e[2],e=e[3],a=t[0],s=t[1],o=t[2],t=t[3];return[r*t+e*a+n*s-i*o,i*t+e*s+r*o-n*a,n*t+e*o+i*a-r*s,e*t-r*a-i*s-n*o]},SpiderGL.Math.Quat.muls=function(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]},SpiderGL.Math.Quat.normalize=function(e){var t=1/SpiderGL.Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);return SpiderGL.Math.Quat.muls(e,t)},SpiderGL.Math.Quat.from33=function(e){var t,r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],u=e[6],d=e[7],e=e[8],p=r+s+e;return 0<p?[(o-d)*(t=.5/SpiderGL.Math.sqrt(p+=1)),(u-n)*t,(i-a)*t,p*t]:s<r&&e<r?[(p=r-s-e+1)*(t=.5/SpiderGL.Math.sqrt(p)),(i+a)*t,(u+n)*t,(o-d)*t]:e<s?[(i+a)*(t=.5/SpiderGL.Math.sqrt(p=-r+s-e+1)),p*t,(o+d)*t,(u-n)*t]:[(u+n)*(t=.5/SpiderGL.Math.sqrt(p=-r-s+e+1)),(o+d)*t,p*t,(i-a)*t]},SpiderGL.Math.Quat.to33=function(e){var t=e[0],r=e[1],i=e[2],e=e[3],n=t*t,a=t*r,s=t*i,t=t*e,o=r*r,u=r*i,r=r*e,d=i*i,i=i*e;return[1-2*(o+d),2*(a+i),2*(s-r),2*(a-i),1-2*(n+d),2*(u+t),2*(s+r),2*(u-t),1-2*(n+o)]},SpiderGL.Math.Quat.from44=function(e){return SpiderGL.Math.Quat.from33(SpiderGL.Math.Mat4.to33(e))},SpiderGL.Math.Quat.to44=function(e){return SpiderGL.Math.Mat3.to44(SpiderGL.Math.Quat.to33(e))},SpiderGL.Math.Quat.fromAngleAxis=function(e,t){return[0,0,0,1]},SpiderGL.Math.Quat.toAngleAxis=function(e){return[0,0,0,1]},SpiderGL.Math.Quat.fromEulerAngles=function(e,t,r){return[0,0,0,1]},SpiderGL.Math.Quat.toEulerAngles=function(e){return[0,0,0,1]},SpiderGL.Math.Quat.copy$=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},SpiderGL.Math.Quat.identity$=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},SpiderGL.Math.Quat.invert$=function(e){return e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e},SpiderGL.Math.Quat.mul$=function(e){var t=p[0],r=p[1],i=p[2],n=p[3],a=e[0],s=e[1],o=e[2],u=e[3];return e[0]=t*u+n*a+i*s-r*o,e[1]=r*u+n*s+t*o-i*a,e[2]=i*u+n*o+r*a-t*s,e[3]=n*u-t*a-r*s-i*o,e},SpiderGL.Math.Quat.muls$=function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e},SpiderGL.Math.Quat.normalize$=function(e){var t=1/SpiderGL.Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);return SpiderGL.Math.Quat.muls$(e,t)},SpiderGL.Math.project=function(e,t,r,i){var n=SpiderGL.Math.Vec3,t=SpiderGL.Math.Mat4.mul4(t,e),e=1/t[3];return t[3]=e,n.muls$(t,e/2),n.adds$(t,.5),n.mul$(t,[r[2],r[3],i[1]-i[0]]),n.add$(t,[r[0],r[1],i[0]]),t},SpiderGL.Math.unproject=function(e,t,r,i){var n=SpiderGL.Math.Vec3,a=SpiderGL.Math.Mat4,e=n.to4(e,1),r=(n.sub$(e,[r[0],r[1],i[0]]),n.div$(e,[r[2],r[3],i[1]-i[0]]),n.muls$(e,2),n.subs$(e,1),1/(e=a.mul4(t,e))[3]);return e[3]=r,n.muls$(e,r),e},SpiderGL.Space={},SpiderGL.Space.MatrixStack=function(e){SpiderGL.Core.ObjectBase.call(this),this._onChange=null,this.reset(),this._onChange=e},SpiderGL.Space.MatrixStack.prototype={_invalidate:function(){this._i=null,this._t=null,this._it=null,this._onChange&&this._onChange(this)},reset:function(){var e=SpiderGL.Math.Mat4.identity();this._s=[e],this._l=1,this._m=e,this._i=e,this._t=e,this._it=e,this._onChange&&this._onChange(this)},get onChange(){return this._onChange},set onChange(e){this._onChange=e},get size(){return this._l},get matrix$(){return this._m},get matrix(){return SpiderGL.Math.Mat4.dup(this.matrix$)},get top$(){return this.matrix$},get top(){return this.matrix},get inverse$(){return this._i||(this._i=SpiderGL.Math.Mat4.inverse(this._m))},get inverse(){return SpiderGL.Math.Mat4.dup(this.inverse$)},get transpose$(){return this._t||(this._t=SpiderGL.Math.Mat4.transpose(this._m))},get transpose(){return SpiderGL.Math.Mat4.dup(this.transpose$)},get inverseTranspose$(){return this._it||(this._it=SpiderGL.Math.Mat4.transpose(this.inverse$))},get inverseTranspose(){return SpiderGL.Math.Mat4.dup(this.inverseTranspose$)},push:function(){var e=SpiderGL.Math.Mat4.dup(this._m);this._s.push(e),this._l++,this._m=e},pop:function(){this._l<=1||(this._s.pop(),this._l--,this._m=this._s[this._l-1],this._invalidate())},load:function(e){e=SpiderGL.Math.Mat4.dup(e),this._s[this._l-1]=e,this._m=e,this._invalidate()},loadIdentity:function(){var e=SpiderGL.Math.Mat4.identity$(this._m);this._i=e,this._t=e,this._it=e},multiply:function(e){SpiderGL.Math.Mat4.mul$(this._m,e),this._invalidate()},ortho:function(e,t){SpiderGL.Math.Mat4.mul$(this._m,SpiderGL.Math.Mat4.ortho(e,t)),this._invalidate()},frustum:function(e,t){SpiderGL.Math.Mat4.mul$(this._m,SpiderGL.Math.Mat4.frustum(e,t)),this._invalidate()},perspective:function(e,t,r,i){SpiderGL.Math.Mat4.mul$(this._m,SpiderGL.Math.Mat4.perspective(e,t,r,i)),this._invalidate()},lookAt:function(e,t,r){SpiderGL.Math.Mat4.mul$(this._m,SpiderGL.Math.Mat4.lookAt(e,t,r)),this._invalidate()},translate:function(e){SpiderGL.Math.Mat4.translate$(this._m,e),this._invalidate()},rotate:function(e,t){SpiderGL.Math.Mat4.rotateAngleAxis$(this._m,e,t),this._invalidate()},scale:function(e){SpiderGL.Math.Mat4.scale$(this._m,e),this._invalidate()}},SpiderGL.Type.extend(SpiderGL.Space.MatrixStack,SpiderGL.Core.ObjectBase),SpiderGL.Space.ViewportStack=function(e){SpiderGL.Core.ObjectBase.call(this),this._onChange=null,this.reset(),this._onChange=e},SpiderGL.Space.ViewportStack.prototype={_invalidate:function(){this._onChange&&this._onChange(this)},reset:function(){var e=[0,0,1,1];this._s=[e],this._l=1,this._r=e,this._onChange&&this._onChange(this)},get onChange(){return this._onChange},set onChange(e){this._onChange=e},get size(){return this._l},get rect$(){return this._r},get rect(){return this.rect$.slice(0,4)},get top$(){return this.rect$},get top(){return this.rect},push:function(){var e=this._r.slice(0,4);this._s.push(e),this._l++,this._r=e},pop:function(){this._l<=1||(this._s.pop(),this._l--,this._r=this._s[this._l-1],this._invalidate())},load:function(e){e=e.slice(0,4),this._s[this._l-1]=e,this._r=e,this._invalidate()},loadIdentity:function(){this._r=[0,0,1,1]},inner:function(e){this._r[0]+=e[0],this._r[1]+=e[1],this._r[2]=e[2],this._r[3]=e[3],this._invalidate()}},SpiderGL.Type.extend(SpiderGL.Space.ViewportStack,SpiderGL.Core.ObjectBase),SpiderGL.Space.DepthRangeStack=function(e){SpiderGL.Core.ObjectBase.call(this),this._onChange=null,this.reset(),this._onChange=e},SpiderGL.Space.DepthRangeStack.prototype={_invalidate:function(){this._onChange&&this._onChange(this)},reset:function(){var e=[0,1];this._s=[e],this._l=1,this._r=e,this._onChange&&this._onChange(this)},get onChange(){return this._onChange},set onChange(e){this._onChange=e},get size(){return this._l},get range$(){return this._r},get range(){return this.range$.slice(0,2)},get top$(){return this.range$},get top(){return this.range},push:function(){var e=this._r.slice(0,2);this._s.push(e),this._l++,this._r=e},pop:function(){this._l<=1||(this._s.pop(),this._l--,this._r=this._s[this._l-1],this._invalidate())},load:function(e){e=e.slice(0,2),this._s[this._l-1]=e,this._r=e,this._invalidate()},loadIdentity:function(){this._r=[0,1]},inner:function(e){this._r[0]+=e[0],this._r[1]=e[1],this._invalidate()}},SpiderGL.Type.extend(SpiderGL.Space.DepthRangeStack,SpiderGL.Core.ObjectBase),SpiderGL.Space.TransformationStack=function(){SpiderGL.Core.ObjectBase.call(this);var e=this;this._mv={},this._vp={},this._mvp={},this._n={},this._c={},this._m=new SpiderGL.Space.MatrixStack(function(){e._mv={},e._mvp={},e._n={},e._c={}}),this._v=new SpiderGL.Space.MatrixStack(function(){e._mv={},e._vp={},e._mvp={},e._n={},e._c={}}),this._p=new SpiderGL.Space.MatrixStack(function(){e._vp={},e._mvp={}}),this._viewport=new SpiderGL.Space.ViewportStack(function(){}),this._depth=new SpiderGL.Space.DepthRangeStack(function(){})},SpiderGL.Space.TransformationStack.prototype={reset:function(){this._m.reset(),this._v.reset(),this._p.reset()},get viewport(){return this._viewport},get viewportRect$(){return this._viewport.rect$},get viewportRect(){return this._viewport.rect},get depth(){return this._depth},get depthRange$(){return this._depth.range$},get depthRange(){return this._depth.range},get model(){return this._m},get modelMatrix$(){return this._m.matrix$},get modelMatrix(){return this._m.matrix},get modelMatrixInverse$(){return this._m.inverse$},get modelMatrixInverse(){return this._m.inverse},get modelMatrixTranspose$(){return this._m.transpose$},get modelMatrixTranspose(){return this._m.transpose},get modelMatrixInverseTranspose$(){return this._m.inverseTranspose$},get modelMatrixInverseTranspose(){return this._m.inverseTranspose},get view(){return this._v},get viewMatrix$(){return this._v.matrix$},get viewMatrix(){return this._v.matrix},get viewMatrixInverse$(){return this._v.inverse$},get viewMatrixInverse(){return this._v.inverse},get viewMatrixTranspose$(){return this._v.transpose$},get viewMatrixTranspose(){return this._v.transpose},get viewMatrixInverseTranspose$(){return this._v.inverseTranspose$},get viewMatrixInverseTranspose(){return this._v.inverseTranspose},get projection(){return this._p},get projectionMatrix$(){return this._p.matrix$},get projectionMatrix(){return this._p.matrix},get projectionMatrixInverse$(){return this._p.inverse$},get projectionMatrixInverse(){return this._p.inverse},get projectionMatrixTranspose$(){return this._p.transpose$},get projectionMatrixTranspose(){return this._p.transpose},get projectionMatrixInverseTranspose$(){return this._p.inverseTranspose$},get projectionMatrixInverseTranspose(){return this._p.inverseTranspose},get modelViewMatrix$(){return this._mv.m||(this._mv.m=SpiderGL.Math.Mat4.mul(this.viewMatrix$,this.modelMatrix$))},get modelViewMatrix(){return SpiderGL.Math.Mat4.dup(this.modelViewMatrix$)},get modelViewMatrixInverse$(){return this._mv.i||(this._mv.i=SpiderGL.Math.Mat4.mul(this.modelMatrixInverse$,this.viewMatrixInverse$))},get modelViewMatrixInverse(){return SpiderGL.Math.Mat4.dup(this.modelViewMatrixInverse$)},get modelViewMatrixTranspose$(){return this._mv.t||(this._mv.t=SpiderGL.Math.Mat4.transpose(this.modelViewMatrix$))},get modelViewMatrixTranspose(){return SpiderGL.Math.Mat4.dup(this.modelViewMatrixTranspose$)},get modelViewMatrixInverseTranspose$(){return this._mv.it||(this._mv.it=SpiderGL.Math.Mat4.transpose(this.modelViewMatrixInverse$))},get modelViewMatrixInverseTranspose(){return SpiderGL.Math.Mat4.dup(this.modelViewMatrixInverseTranspose$)},get viewProjectionMatrix$(){return this._vp.m||(this._vp.m=SpiderGL.Math.Mat4.mul(this.projectionMatrix$,this.viewMatrix$))},get viewProjectionMatrix(){return SpiderGL.Math.Mat4.dup(this.viewProjectionMatrix$)},get viewProjectionMatrixInverse$(){return this._vp.i||(this._vp.i=SpiderGL.Math.Mat4.mul(this.viewMatrixInverse$,this.projectionMatrixInverse$))},get viewProjectionMatrixInverse(){return SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixInverse$)},get viewProjectionMatrixTranspose$(){return this._vp.t||(this._vp.t=SpiderGL.Math.Mat4.transpose(this.viewProjectionMatrix$))},get viewProjectionMatrixTranspose(){return SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixTranspose$)},get viewProjectionMatrixInverseTranspose$(){return this._vp.it||(this._vp.it=SpiderGL.Math.Mat4.transpose(this.viewProjectionMatrixInverse$))},get viewProjectionMatrixInverseTranspose(){return SpiderGL.Math.Mat4.dup(this.viewProjectionMatrixInverseTranspose$)},get modelViewProjectionMatrix$(){return this._mvp.m||(this._mvp.m=SpiderGL.Math.Mat4.mul(this.viewProjectionMatrix$,this.modelMatrix$))},get modelViewProjectionMatrix(){return SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrix$)},get modelViewProjectionMatrixInverse$(){return this._mvp.i||(this._mvp.i=SpiderGL.Math.Mat4.inverse(this.modelViewProjectionMatrix$))},get modelViewProjectionMatrixInverse(){return SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixInverse$)},get modelViewProjectionMatrixTranspose$(){return this._mvp.t||(this._mvp.t=SpiderGL.Math.Mat4.transpose(this.modelViewProjectionMatrix$))},get modelViewProjectionMatrixTranspose(){return SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixTranspose$)},get modelViewProjectionMatrixInverseTranspose$(){return this._mvp.it||(this._mvp.it=SpiderGL.Math.Mat4.transpose(this.modelViewProjectionMatrixInverse$))},get modelViewProjectionMatrixInverseTranspose(){return SpiderGL.Math.Mat4.dup(this.modelViewProjectionMatrixInverseTranspose$)},get worldSpaceNormalMatrix$(){return this._n.m||(this._n.m=SpiderGL.Math.Mat4.inverseTranspose33(this.modelMatrix$))},get worldSpaceNormalMatrix(){return SpiderGL.Math.Mat4.dup(this.worldSpaceNormalMatrix$)},get viewSpaceNormalMatrix$(){return this._n.v||(this._n.v=SpiderGL.Math.Mat4.inverseTranspose33(this.modelViewMatrix$))},get viewSpaceNormalMatrix(){return SpiderGL.Math.Mat4.dup(this.viewSpaceNormalMatrix$)},get modelSpaceViewerPosition$(){return this._c.mp||(this._c.mp=SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.col(this.modelViewMatrixInverse$,3)))},get modelSpaceViewerPosition(){return SpiderGL.Math.Vec3.dup(this.modelSpaceViewerPosition$)},get worldSpaceViewerPosition$(){return this._c.wp||(this._c.wp=SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.col(this.viewMatrixInverse$,3)))},get worldSpaceViewerPosition(){return SpiderGL.Math.Vec3.dup(this.worldSpaceViewerPosition$)},get modelSpaceViewDirection$(){return this._c.md||(this._c.md=SpiderGL.Math.Vec3.normalize$(SpiderGL.Math.Vec3.neg$(SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.row(this.modelViewMatrixInverse$,2)))))},get modelSpaceViewDirection(){return SpiderGL.Math.Vec3.dup(this.modelSpaceViewDirection$)},get worldSpaceViewDirection$(){return this._c.wd||(this._c.wd=SpiderGL.Math.Vec3.normalize$(SpiderGL.Math.Vec3.neg$(SpiderGL.Math.Vec4.to3(SpiderGL.Math.Mat4.row(this.viewMatrixInverse$,2)))))},get worldSpaceViewDirection(){return SpiderGL.Math.Vec3.dup(this.worldSpaceViewDirection$)},project:function(e){return SpiderGL.Math.project(e,this.modelViewProjectionMatrix$,this.viewportRect$,this.depthRange$)},unproject:function(e){return SpiderGL.Math.unproject(e,this.modelViewProjectionMatrixInverse$,this.viewportRect$,this.depthRange$)}},SpiderGL.Type.extend(SpiderGL.Space.TransformationStack,SpiderGL.Core.ObjectBase),SpiderGL.WebGL={},SpiderGL.WebGL.Context={},SpiderGL.WebGL.Context.WEBGL_STRING="experimental-webgl",SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y=!0,SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA=!1,SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Context.get=function(e,t){return SpiderGL.Type.isString(e)&&(e=SpiderGL.DOM.getElementById(e)),SpiderGL.Type.instanceOf(e,HTMLCanvasElement)?e.getContext(SpiderGL.WebGL.Context.WEBGL_STRING,t):null},SpiderGL.WebGL.Context._prepareContex=function(e){if(e){var t=e._spidergl;if(!t){(e._spidergl=t={}).TAG=0,t.gl=e;var r,i={};for(r in t.glFunctions=i,e){var n=e[n];"function"==typeof n&&(i[r]=n)}}}},SpiderGL.WebGL.Context._addExtension=function(i,n,a,s){var o;i&&(o=i.getExtension,i.getExtension=function(e){if(e!=n)return o.call(this,e);e=this._spidergl;if(!e)return null;if(!(t=e[a])){var t,r={};if(((t={TAG:0})._ext=r)[a]=t,r.sgl=e,r.gl=i,r.glFunctions={},!s(i,t))return null;e[a]=t}return t})},SpiderGL.WebGL.Context._setup_SGL_current_binding=function(e,t){if(!e)return!1;if(!t)return!1;if(!e._spidergl)return!1;if(e._spidergl.cb)return!1;var r=t._ext,i=r.glFunctions,n=(r.currentBuffer={},r.currentBuffer[e.ARRAY_BUFFER]=e.getParameter(e.ARRAY_BUFFER_BINDING),r.currentBuffer[e.ELEMENT_ARRAY_BUFFER]=e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),r.bufferStack={},r.bufferStack[e.ARRAY_BUFFER]=[],r.bufferStack[e.ELEMENT_ARRAY_BUFFER]=[],i.bindBuffer=e.bindBuffer,e.bindBuffer=function(e,t){var r=this._spidergl.cb._ext;r.currentBuffer[e]!=t&&(r.currentBuffer[e]=t,r.glFunctions.bindBuffer.call(this,e,t))},t.getCurrentBuffer=function(e){return this._ext.currentBuffer[e]},t.pushBuffer=function(e){var t=this._ext,r=t.bufferStack[e],t=t.currentBuffer[e];r.push(t)},t.popBuffer=function(e){var t=this._ext,r=t.bufferStack[e];r.length<=0||(r=r.pop(),t.gl.bindBuffer(e,r))},r.currentFramebuffer={},r.currentFramebuffer[e.FRAMEBUFFER]=e.getParameter(e.FRAMEBUFFER_BINDING),r.framebufferStack={},r.framebufferStack[e.FRAMEBUFFER]=[],i.bindFramebuffer=e.bindFramebuffer,e.bindFramebuffer=function(e,t){var r=this._spidergl.cb._ext;r.currentFramebuffer[e]!=t&&(r.currentFramebuffer[e]=t,r.glFunctions.bindFramebuffer.call(this,e,t))},t.getCurrentFramebuffer=function(e){return this._ext.currentFramebuffer[e]},t.pushFramebuffer=function(e){var t=this._ext,r=t.framebufferStack[e],t=t.currentFramebuffer[e];r.push(t)},t.popFramebuffer=function(e){var t=this._ext,r=t.framebufferStack[e];r.length<=0||(r=r.pop(),t.gl.bindFramebuffer(e,r))},r.currentProgram=e.getParameter(e.CURRENT_PROGRAM),r.programStack=[],i.useProgram=e.useProgram,e.useProgram=function(e){var t=this._spidergl.cb._ext;t.currentProgram!=e&&(t.currentProgram=e,t.glFunctions.useProgram.call(this,e))},t.getCurrentProgram=function(){return this._ext.currentProgram},t.pushProgram=function(){var e=this._ext;e.programStack.push(e.currentProgram)},t.popProgram=function(){var e=this._ext,t=e.programStack;t.length<=0||(t=t.pop(),e.gl.useProgram(t))},r.currentRenderbuffer={},r.currentRenderbuffer[e.RENDERBUFFER]=e.getParameter(e.RENDERBUFFER_BINDING),r.renderbufferStack={},r.renderbufferStack[e.RENDERBUFFER]=[],i.bindRenderbuffer=e.bindRenderbuffer,e.bindRenderbuffer=function(e,t){var r=this._spidergl.cb._ext;r.currentRenderbuffer[e]!=t&&(r.currentRenderbuffer[e]=t,r.glFunctions.bindRenderbuffer.call(this,e,t))},t.getCurrentRenderbuffer=function(e){return this._ext.currentRenderbuffer[e]},t.pushRenderbuffer=function(e){var t=this._ext,r=t.renderbufferStack[e],t=t.currentRenderbuffer[e];r.push(t)},t.popRenderbuffer=function(e){var t=this._ext,r=t.renderbufferStack[e];r.length<=0||(r=r.pop(),t.gl.bindRenderbuffer(e,r))},r.currentShader={},r.currentShader[e.VERTEX_SHADER]=null,r.currentShader[e.FRAGMENT_SHADER]=null,r.shaderStack={},r.shaderStack[e.VERTEX_SHADER]=[],r.shaderStack[e.FRAGMENT_SHADER]=[],r.glFunctions.bindShader=function(e,t){},t.bindShader=function(e,t){var r=this._ext;r.currentShader[e]!=t&&(r.currentShader[e]=t,r.glFunctions.bindShader.call(r.gl,e,t))},t.getCurrentShader=function(e){return this._ext.currentShader[e]},t.pushShader=function(e){var t=this._ext,r=t.shaderStack[e],t=t.currentShader[e];r.push(t)},t.popShader=function(e){var t=this._ext,r=t.shaderStack[e];r.length<=0||(r=r.pop(),t.gl.bindShader(e,r))},r.currentTexture={},e.getParameter(e.ACTIVE_TEXTURE)),a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);r.currentTexture={},r.textureStack={},r.textureUnitStack=[];for(var s=0;s<a;++s){var o=e.TEXTURE0+s,u=(e.activeTexture(o),{}),u=(u[e.TEXTURE_2D]=e.getParameter(e.TEXTURE_BINDING_2D),u[e.TEXTURE_CUBE_MAP]=e.getParameter(e.TEXTURE_BINDING_CUBE_MAP),r.currentTexture[o]=u,{});u[e.TEXTURE_2D]=[],u[e.TEXTURE_CUBE_MAP]=[],r.textureStack[o]=u}return e.activeTexture(n),r.currentTextureUnit=n,i.activeTexture=e.activeTexture,e.activeTexture=function(e){var t=this._spidergl.cb._ext;t.currentTextureUnit!=e&&(t.currentTextureUnit=e,t.glFunctions.activeTexture.call(this,e))},t.getCurrentTextureUnit=function(){return this._ext.currentTextureUnit},t.pushTextureUnit=function(){var e=this._ext;e.textureUnitStack.push(e.currentTextureUnit)},t.popTextureUnit=function(){var e=this._ext,t=e.textureUnitStack;t.length<=0||(t=t.pop(),e.gl.activeTexture(t))},i.bindTexture=e.bindTexture,e.bindTexture=function(e,t){var r=this._spidergl.cb._ext,i=r.currentTextureUnit;r.currentTexture[i][e]!=t&&(r.currentTexture[i][e]=t,r.glFunctions.bindTexture.call(this,e,t))},t.getCurrentTexture=function(e){var t=this._ext,r=t.currentTextureUnit;return t.currentTexture[r][e]},t.pushTexture=function(e){var t=this._ext,r=t.currentTextureUnit,i=t.textureStack[r][e],t=t.currentTexture[r][e];i.push(t)},t.popTexture=function(e){var t=this._ext,r=t.currentTextureUnit,r=t.textureStack[r][e];r.length<=0||(r=r.pop(),t.gl.bindTexture(e,r))},!0},SpiderGL.WebGL.Context._setup_SGL_wrapper_notify=function(e,t){var r;return!!e&&!!t&&!(!e._spidergl||e._spidergl.wn||(r=(t=t._ext).glFunctions,t.cb=e.getExtension("SGL_current_binding"),!t.cb)||(r.deleteBuffer=e.deleteBuffer,e.deleteBuffer=function(e){this._spidergl.wn._ext.glFunctions.deleteBuffer.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_deleteBuffer.apply(e._spidergl,arguments)},r.isBuffer=e.isBuffer,e.isBuffer=function(e){var t=this._spidergl.wn._ext.glFunctions.isBuffer.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_isBuffer.apply(e._spidergl,arguments),t},r.bindBuffer=e.bindBuffer,e.bindBuffer=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.bindBuffer.apply(this,arguments),t.cb.getCurrentBuffer(e));t&&t._spidergl&&t._spidergl._gl_bindBuffer.apply(t._spidergl,arguments)},r.getBufferParameter=e.getBufferParameter,e.getBufferParameter=function(e){var t=this._spidergl.wn._ext,r=t.glFunctions.getBufferParameter.apply(this,arguments),t=t.cb.getCurrentBuffer(e);return t&&t._spidergl&&t._spidergl._gl_getBufferParameter.apply(t._spidergl,arguments),r},r.bufferData=e.bufferData,e.bufferData=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.bufferData.apply(this,arguments),t.cb.getCurrentBuffer(e));t&&t._spidergl&&t._spidergl._gl_bufferData.apply(t._spidergl,arguments)},r.bufferSubData=e.bufferSubData,e.bufferSubData=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.bufferSubData.apply(this,arguments),t.cb.getCurrentBuffer(e));t&&t._spidergl&&t._spidergl._gl_bufferSubData.apply(t._spidergl,arguments)},r.vertexAttribPointer=e.vertexAttribPointer,e.vertexAttribPointer=function(){var e=this._spidergl.wn._ext,t=(e.glFunctions.vertexAttribPointer.apply(this,arguments),this.ARRAY_BUFFER),e=e.cb.getCurrentBuffer(t);e&&e._spidergl&&e._spidergl._gl_vertexAttribPointer.apply(e._spidergl,arguments)},r.drawElements=e.drawElements,e.drawElements=function(e,t,r,i,n){var a=this._spidergl.wn._ext,s=(a.glFunctions.drawElements.apply(this,arguments),this.ELEMENT_ARRAY_BUFFER),a=a.cb.getCurrentBuffer(s);a&&a._spidergl&&a._spidergl._gl_drawElements.apply(a._spidergl,arguments)},r.deleteFramebuffer=e.deleteFramebuffer,e.deleteFramebuffer=function(e){this._spidergl.wn._ext.glFunctions.deleteFramebuffer.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_deleteFramebuffer.apply(e._spidergl,arguments)},r.isFramebuffer=e.isFramebuffer,e.isFramebuffer=function(e){var t=this._spidergl.wn._ext.glFunctions.isFramebuffer.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_isFramebuffer.apply(e._spidergl,arguments),t},r.bindFramebuffer=e.bindFramebuffer,e.bindFramebuffer=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.bindFramebuffer.apply(this,arguments),t.cb.getCurrentFramebuffer(e));t&&t._spidergl&&t._spidergl._gl_bindFramebuffer.apply(t._spidergl,arguments)},r.checkFramebufferStatus=e.checkFramebufferStatus,e.checkFramebufferStatus=function(e){var t=this._spidergl.wn._ext,r=t.glFunctions.checkFramebufferStatus.apply(this,arguments),t=t.cb.getCurrentFramebuffer(e);return t&&t._spidergl&&t._spidergl._gl_checkFramebufferStatus.apply(t._spidergl,arguments),r},r.getFramebufferAttachmentParameter=e.getFramebufferAttachmentParameter,e.getFramebufferAttachmentParameter=function(e){var t=this._spidergl.wn._ext,r=t.glFunctions.getFramebufferAttachmentParameter.apply(this,arguments),t=t.cb.getCurrentFramebuffer(e);return t&&t._spidergl&&t._spidergl._gl_getFramebufferAttachmentParameter.apply(t._spidergl,arguments),r},r.framebufferRenderbuffer=e.framebufferRenderbuffer,e.framebufferRenderbuffer=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.framebufferRenderbuffer.apply(this,arguments),t.cb.getCurrentFramebuffer(e));t&&t._spidergl&&t._spidergl._gl_framebufferRenderbuffer.apply(t._spidergl,arguments)},r.framebufferTexture2D=e.framebufferTexture2D,e.framebufferTexture2D=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.framebufferTexture2D.apply(this,arguments),t.cb.getCurrentFramebuffer(e));t&&t._spidergl&&t._spidergl._gl_framebufferTexture2D.apply(t._spidergl,arguments)},r.clear=e.clear,e.clear=function(){var e=this._spidergl.wn._ext,t=(e.glFunctions.clear.apply(this,arguments),this.FRAMEBUFFER),e=e.cb.getCurrentFramebuffer(t);e&&e._spidergl&&e._spidergl._gl_clear.apply(e._spidergl,arguments)},r.readPixels=e.readPixels,e.readPixels=function(){var e=this._spidergl.wn._ext,t=(e.glFunctions.readPixels.apply(this,arguments),this.FRAMEBUFFER),e=e.cb.getCurrentFramebuffer(t);e&&e._spidergl&&e._spidergl._gl_readPixels.apply(e._spidergl,arguments)},r.deleteProgram=e.deleteProgram,e.deleteProgram=function(e){this._spidergl.wn._ext.glFunctions.deleteProgram.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_deleteProgram.apply(e._spidergl,arguments)},r.isProgram=e.isProgram,e.isProgram=function(e){var t=this._spidergl.wn._ext.glFunctions.isProgram.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_isProgram.apply(e._spidergl,arguments),t},r.useProgram=e.useProgram,e.useProgram=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.useProgram.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_useProgram.apply(e._spidergl,arguments)},r.getActiveAttrib=e.getActiveAttrib,e.getActiveAttrib=function(e){var t=this._spidergl.wn._ext.glFunctions.getActiveAttrib.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getActiveAttrib.apply(e._spidergl,arguments),t},r.getActiveUniform=e.getActiveUniform,e.getActiveUniform=function(e){var t=this._spidergl.wn._ext.glFunctions.getActiveUniform.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getActiveUniform.apply(e._spidergl,arguments),t},r.getAttachedShaders=e.getAttachedShaders,e.getAttachedShaders=function(e){var t=this._spidergl.wn._ext.glFunctions.getAttachedShaders.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getAttachedShaders.apply(e._spidergl,arguments),t},r.getAttribLocation=e.getAttribLocation,e.getAttribLocation=function(e){var t=this._spidergl.wn._ext.glFunctions.getAttribLocation.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getAttribLocation.apply(e._spidergl,arguments),t},r.getProgramParameter=e.getProgramParameter,e.getProgramParameter=function(e){var t=this._spidergl.wn._ext.glFunctions.getProgramParameter.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getProgramParameter.apply(e._spidergl,arguments),t},r.getProgramInfoLog=e.getProgramInfoLog,e.getProgramInfoLog=function(e){var t=this._spidergl.wn._ext.glFunctions.getProgramInfoLog.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getProgramInfoLog.apply(e._spidergl,arguments),t},r.getUniform=e.getUniform,e.getUniform=function(e){var t=this._spidergl.wn._ext.glFunctions.getUniform.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getUniform.apply(e._spidergl,arguments),t},r.getUniformLocation=e.getUniformLocation,e.getUniformLocation=function(e){var t=this._spidergl.wn._ext.glFunctions.getUniformLocation.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getUniformLocation.apply(e._spidergl,arguments),t},r.attachShader=e.attachShader,e.attachShader=function(e){this._spidergl.wn._ext.glFunctions.attachShader.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_attachShader.apply(e._spidergl,arguments)},r.bindAttribLocation=e.bindAttribLocation,e.bindAttribLocation=function(e){this._spidergl.wn._ext.glFunctions.bindAttribLocation.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_bindAttribLocation.apply(e._spidergl,arguments)},r.detachShader=e.detachShader,e.detachShader=function(e){this._spidergl.wn._ext.glFunctions.detachShader.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_detachShader.apply(e._spidergl,arguments)},r.linkProgram=e.linkProgram,e.linkProgram=function(e){this._spidergl.wn._ext.glFunctions.linkProgram.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_linkProgram.apply(e._spidergl,arguments)},r.uniform1f=e.uniform1f,e.uniform1f=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform1f.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform1f.apply(e._spidergl,arguments)},r.uniform1fv=e.uniform1fv,e.uniform1fv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform1fv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform1fv.apply(e._spidergl,arguments)},r.uniform1i=e.uniform1i,e.uniform1i=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform1i.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform1i.apply(e._spidergl,arguments)},r.uniform1iv=e.uniform1iv,e.uniform1iv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform1iv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform1iv.apply(e._spidergl,arguments)},r.uniform2f=e.uniform2f,e.uniform2f=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform2f.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform2f.apply(e._spidergl,arguments)},r.uniform2fv=e.uniform2fv,e.uniform2fv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform2fv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform2fv.apply(e._spidergl,arguments)},r.uniform2i=e.uniform2i,e.uniform2i=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform2i.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform2i.apply(e._spidergl,arguments)},r.uniform2iv=e.uniform2iv,e.uniform2iv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform2iv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform2iv.apply(e._spidergl,arguments)},r.uniform3f=e.uniform3f,e.uniform3f=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform3f.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform3f.apply(e._spidergl,arguments)},r.uniform3fv=e.uniform3fv,e.uniform3fv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform3fv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform3fv.apply(e._spidergl,arguments)},r.uniform3i=e.uniform3i,e.uniform3i=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform3i.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform3i.apply(e._spidergl,arguments)},r.uniform3iv=e.uniform3iv,e.uniform3iv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform3iv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform3iv.apply(e._spidergl,arguments)},r.uniform4f=e.uniform4f,e.uniform4f=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform4f.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform4f.apply(e._spidergl,arguments)},r.uniform4fv=e.uniform4fv,e.uniform4fv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform4fv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform4fv.apply(e._spidergl,arguments)},r.uniform4i=e.uniform4i,e.uniform4i=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform4i.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform4i.apply(e._spidergl,arguments)},r.uniform4iv=e.uniform4iv,e.uniform4iv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniform4iv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniform4iv.apply(e._spidergl,arguments)},r.uniformMatrix2fv=e.uniformMatrix2fv,e.uniformMatrix2fv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniformMatrix2fv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniformMatrix2fv.apply(e._spidergl,arguments)},r.uniformMatrix3fv=e.uniformMatrix3fv,e.uniformMatrix3fv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniformMatrix3fv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniformMatrix3fv.apply(e._spidergl,arguments)},r.uniformMatrix4fv=e.uniformMatrix4fv,e.uniformMatrix4fv=function(){var e=this._spidergl.wn._ext,e=(e.glFunctions.uniformMatrix4fv.apply(this,arguments),e.cb.getCurrentProgram());e&&e._spidergl&&e._spidergl._gl_uniformMatrix4fv.apply(e._spidergl,arguments)},r.validateProgram=e.validateProgram,e.validateProgram=function(e){this._spidergl.wn._ext.glFunctions.validateProgram.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_validateProgram.apply(e._spidergl,arguments)},r.deleteRenderbuffer=e.deleteRenderbuffer,e.deleteRenderbuffer=function(e){this._spidergl.wn._ext.glFunctions.deleteRenderbuffer.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_deleteRenderbuffer.apply(e._spidergl,arguments)},r.isRenderbuffer=e.isRenderbuffer,e.isRenderbuffer=function(e){var t=this._spidergl.wn._ext.glFunctions.isRenderbuffer.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_isRenderbuffer.apply(e._spidergl,arguments),t},r.bindRenderbuffer=e.bindRenderbuffer,e.bindRenderbuffer=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.bindRenderbuffer.apply(this,arguments),t.cb.getCurrentRenderbuffer(e));t&&t._spidergl&&t._spidergl._gl_bindRenderbuffer.apply(t._spidergl,arguments)},r.getRenderbufferParameter=e.getRenderbufferParameter,e.getRenderbufferParameter=function(e){var t=this._spidergl.wn._ext,r=t.glFunctions.getRenderbufferParameter.apply(this,arguments),t=t.cb.getCurrentRenderbuffer(e);return t&&t._spidergl&&t._spidergl._gl_getRenderbufferParameter.apply(t._spidergl,arguments),r},r.renderbufferStorage=e.renderbufferStorage,e.renderbufferStorage=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.renderbufferStorage.apply(this,arguments),t.cb.getCurrentRenderbuffer(e));t&&t._spidergl&&t._spidergl._gl_renderbufferStorage.apply(t._spidergl,arguments)},r.deleteShader=e.deleteShader,e.deleteShader=function(e){this._spidergl.wn._ext.glFunctions.deleteShader.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_deleteShader.apply(e._spidergl,arguments)},r.isShader=e.isShader,e.isShader=function(e){var t=this._spidergl.wn._ext.glFunctions.isShader.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_isShader.apply(e._spidergl,arguments),t},r.getShaderParameter=e.getShaderParameter,e.getShaderParameter=function(e){var t=this._spidergl.wn._ext.glFunctions.getShaderParameter.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getShaderParameter.apply(e._spidergl,arguments),t},r.getShaderInfoLog=e.getShaderInfoLog,e.getShaderInfoLog=function(e){var t=this._spidergl.wn._ext.glFunctions.getShaderInfoLog.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getShaderInfoLog.apply(e._spidergl,arguments),t},r.getShaderSource=e.getShaderSource,e.getShaderSource=function(e){var t=this._spidergl.wn._ext.glFunctions.getShaderSource.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_getShaderSource.apply(e._spidergl,arguments),t},r.compileShader=e.compileShader,e.compileShader=function(e){this._spidergl.wn._ext.glFunctions.compileShader.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_compileShader.apply(e._spidergl,arguments)},r.shaderSource=e.shaderSource,e.shaderSource=function(e){this._spidergl.wn._ext.glFunctions.shaderSource.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_shaderSource.apply(e._spidergl,arguments)},t.textureTargetMap={},t.textureTargetMap[e.TEXTURE_2D]=e.TEXTURE_2D,t.textureTargetMap[e.TEXTURE_CUBE_MAP]=e.TEXTURE_CUBE_MAP,t.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_X]=e.TEXTURE_CUBE_MAP,t.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_X]=e.TEXTURE_CUBE_MAP,t.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_Y]=e.TEXTURE_CUBE_MAP,t.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_Y]=e.TEXTURE_CUBE_MAP,t.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_Z]=e.TEXTURE_CUBE_MAP,t.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_Z]=e.TEXTURE_CUBE_MAP,r.deleteTexture=e.deleteTexture,e.deleteTexture=function(e){this._spidergl.wn._ext.glFunctions.deleteTexture.apply(this,arguments);e&&e._spidergl&&e._spidergl._gl_deleteTexture.apply(e._spidergl,arguments)},r.isTexture=e.isTexture,e.isTexture=function(e){var t=this._spidergl.wn._ext.glFunctions.isTexture.apply(this,arguments);return e&&e._spidergl&&e._spidergl._gl_isTexture.apply(e._spidergl,arguments),t},r.bindTexture=e.bindTexture,e.bindTexture=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.bindTexture.apply(this,arguments),t.cb.getCurrentTexture(e));t&&t._spidergl&&t._spidergl._gl_bindTexture.apply(t._spidergl,arguments)},r.getTexParameter=e.getTexParameter,e.getTexParameter=function(e){var t=this._spidergl.wn._ext,r=t.glFunctions.getTexParameter.apply(this,arguments),t=t.cb.getCurrentTexture(e);return t&&t._spidergl&&t._spidergl._gl_getTexParameter.apply(t._spidergl,arguments),r},r.copyTexImage2D=e.copyTexImage2D,e.copyTexImage2D=function(e){var t=this._spidergl.wn._ext,e=(t.glFunctions.copyTexImage2D.apply(this,arguments),t.textureTargetMap[e]),t=t.cb.getCurrentTexture(e);t&&t._spidergl&&t._spidergl._gl_copyTexImage2D.apply(t._spidergl,arguments)},r.copyTexSubImage2D=e.copyTexSubImage2D,e.copyTexSubImage2D=function(e){var t=this._spidergl.wn._ext,e=(t.glFunctions.copyTexSubImage2D.apply(this,arguments),t.textureTargetMap[e]),t=t.cb.getCurrentTexture(e);t&&t._spidergl&&t._spidergl._gl_copyTexSubImage2D.apply(t._spidergl,arguments)},r.generateMipmap=e.generateMipmap,e.generateMipmap=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.generateMipmap.apply(this,arguments),t.cb.getCurrentTexture(e));t&&t._spidergl&&t._spidergl._gl_generateMipmap.apply(t._spidergl,arguments)},r.texImage2D=e.texImage2D,e.texImage2D=function(e){var t=this._spidergl.wn._ext,e=(t.glFunctions.texImage2D.apply(this,arguments),t.textureTargetMap[e]),t=t.cb.getCurrentTexture(e);t&&t._spidergl&&t._spidergl._gl_texImage2D.apply(t._spidergl,arguments)},r.texParameterf=e.texParameterf,e.texParameterf=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.texParameterf.apply(this,arguments),t.cb.getCurrentTexture(e));t&&t._spidergl&&t._spidergl._gl_texParameterf.apply(t._spidergl,arguments)},r.texParameteri=e.texParameteri,e.texParameteri=function(e){var t=this._spidergl.wn._ext,t=(t.glFunctions.texParameteri.apply(this,arguments),t.cb.getCurrentTexture(e));t&&t._spidergl&&t._spidergl._gl_texParameteri.apply(t._spidergl,arguments)},r.texSubImage2D=e.texSubImage2D,e.texSubImage2D=function(e){var t=this._spidergl.wn._ext,e=(t.glFunctions.texSubImage2D.apply(this,arguments),t.textureTargetMap[e]),t=t.cb.getCurrentTexture(e);t&&t._spidergl&&t._spidergl._gl_texSubImage2D.apply(t._spidergl,arguments)},0))},SpiderGL.WebGL.Context._setup_SGL_direct_state_access=function(e,t){var r;return!!e&&!!t&&!(!e._spidergl||e._spidergl.dsa||((r=(t=t)._ext).glFunctions,r.cb=e.getExtension("SGL_current_binding"),!r.cb)||(t.getBufferParameter=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentBuffer(t),r=(i!=e&&n.bindBuffer(t,e),n.getBufferParameter(t,r));return i!=e&&n.bindBuffer(t,i),r},t.bufferData=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentBuffer(t);n!=e&&a.bindBuffer(t,e),a.bufferData(t,r,i),n!=e&&a.bindBuffer(t,n)},t.bufferSubData=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentBuffer(t);n!=e&&a.bindBuffer(t,e),a.bufferSubData(t,r,i),n!=e&&a.bindBuffer(t,n)},t.vertexAttribPointer=function(e,t,r,i,n,a,s){var o=this._ext,u=o.gl,d=u.ARRAY_BUFFER,o=o.cb.getCurrentBuffer(d);o!=e&&u.bindBuffer(d,e),u.vertexAttribPointer(t,r,i,n,a,s),o!=e&&u.bindBuffer(d,o)},t.drawElements=function(e,t,r,i,n){var a=this._ext,s=a.gl,o=s.ELEMENT_ARRAY_BUFFER,a=a.cb.getCurrentBuffer(o);a!=e&&s.bindBuffer(o,e),s.drawElements(t,r,i,n),a!=e&&s.bindBuffer(o,a)},t.checkFramebufferStatus=function(e,t){var r=this._ext,i=r.gl,r=r.cb.getCurrentFramebuffer(t),n=(r!=e&&i.bindFramebuffer(t,e),i.checkFramebufferStatus(t));return r!=e&&i.bindFramebuffer(t,r),n},t.getFramebufferAttachmentParameter=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentFramebuffer(t),r=(n!=e&&a.bindFramebuffer(t,e),a.getFramebufferAttachmentParameter(t,r,i));return n!=e&&a.bindFramebuffer(t,n),r},t.framebufferRenderbuffer=function(e,t,r,i,n){var a=this._ext,s=a.gl,a=a.cb.getCurrentFramebuffer(t);a!=e&&s.bindFramebuffer(t,e),s.framebufferRenderbuffer(t,r,i,n),a!=e&&s.bindFramebuffer(t,a)},t.framebufferTexture2D=function(e,t,r,i,n,a){var s=this._ext,o=s.gl,s=s.cb.getCurrentFramebuffer(t);s!=e&&o.bindFramebuffer(t,e),o.framebufferTexture2D(t,r,i,n,a),s!=e&&o.bindFramebuffer(t,s)},t.clear=function(e,t){var r=this._ext,i=r.gl,n=i.FRAMEBUFFER,r=r.cb.getCurrentFramebuffer(n);r!=e&&i.bindFramebuffer(n,e),i.clear(t),r!=e&&i.bindFramebuffer(n,r)},t.readPixels=function(e,t,r,i,n,a,s,o){var u=this._ext,d=u.gl,p=d.FRAMEBUFFER,u=u.cb.getCurrentFramebuffer(p);u!=e&&d.bindFramebuffer(p,e),d.readPixels(t,r,i,n,a,s,o),u!=e&&d.bindFramebuffer(p,u)},t.uniform1f=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform1f(t,r),i!=e&&n.useProgram(i)},t.uniform1fv=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform1fv(t,r),i!=e&&n.useProgram(i)},t.uniform1i=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform1i(t,r),i!=e&&n.useProgram(i)},t.uniform1iv=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform1iv(t,r),i!=e&&n.useProgram(i)},t.uniform2f=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentProgram();n!=e&&a.useProgram(e),a.uniform2f(t,r,i),n!=e&&a.useProgram(n)},t.uniform2fv=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform2fv(t,r),i!=e&&n.useProgram(i)},t.uniform2i=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentProgram();n!=e&&a.useProgram(e),a.uniform2i(t,r,i),n!=e&&a.useProgram(n)},t.uniform2iv=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform2iv(t,r),i!=e&&n.useProgram(i)},t.uniform3f=function(e,t,r,i,n){var a=this._ext,s=a.gl,a=a.cb.getCurrentProgram();a!=e&&s.useProgram(e),s.uniform3f(t,r,i,n),a!=e&&s.useProgram(a)},t.uniform3fv=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform3fv(t,r),i!=e&&n.useProgram(i)},t.uniform3i=function(e,t,r,i,n){var a=this._ext,s=a.gl,a=a.cb.getCurrentProgram();a!=e&&s.useProgram(e),s.uniform3i(t,r,i,n),a!=e&&s.useProgram(a)},t.uniform3iv=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform3iv(t,r),i!=e&&n.useProgram(i)},t.uniform4f=function(e,t,r,i,n,a){var s=this._ext,o=s.gl,s=s.cb.getCurrentProgram();s!=e&&o.useProgram(e),o.uniform4f(t,r,i,n,a),s!=e&&o.useProgram(s)},t.uniform4fv=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform4fv(t,r),i!=e&&n.useProgram(i)},t.uniform4i=function(e,t,r,i,n,a){var s=this._ext,o=s.gl,s=s.cb.getCurrentProgram();s!=e&&o.useProgram(e),o.uniform4i(t,r,i,n,a),s!=e&&o.useProgram(s)},t.uniform4iv=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentProgram();i!=e&&n.useProgram(e),n.uniform4iv(t,r),i!=e&&n.useProgram(i)},t.uniformMatrix2fv=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentProgram();n!=e&&a.useProgram(e),a.uniformMatrix2fv(t,r,i),n!=e&&a.useProgram(n)},t.uniformMatrix3fv=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentProgram();n!=e&&a.useProgram(e),a.uniformMatrix3fv(t,r,i),n!=e&&a.useProgram(n)},t.uniformMatrix4fv=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentProgram();n!=e&&a.useProgram(e),a.uniformMatrix4fv(t,r,i),n!=e&&a.useProgram(n)},t.getRenderbufferParameter=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentRenderbuffer(t),r=(i!=e&&n.bindRenderbuffer(t,e),n.getRenderbufferParameter.call(n,t,r));return i!=e&&n.bindRenderbuffer(t,i),r},t.renderbufferStorage=function(e,t,r,i,n){var a=this._ext,s=a.gl,a=a.cb.getCurrentRenderbuffer(t);a!=e&&s.bindRenderbuffer(t,e),s.renderbufferStorage(t,r,i,n),a!=e&&s.bindRenderbuffer(t,a)},t.shaderIsNull=function(e){return null==e},r.textureTargetMap={},r.textureTargetMap[e.TEXTURE_2D]=e.TEXTURE_2D,r.textureTargetMap[e.TEXTURE_CUBE_MAP]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_X]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_X]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_Y]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_Y]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_POSITIVE_Z]=e.TEXTURE_CUBE_MAP,r.textureTargetMap[e.TEXTURE_CUBE_MAP_NEGATIVE_Z]=e.TEXTURE_CUBE_MAP,t.getTexParameter=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentTexture(t),r=(i!=e&&n.bindTexture(t,e),n.getTexParameter(t,r));return i!=e&&n.bindTexture(t,i),r},t.copyTexImage2D=function(e,t,r,i,n,a,s,o,u){var d=this._ext,p=d.gl,h=d.textureTargetMap[t],d=d.cb.getCurrentTexture(h);d!=e&&p.bindTexture(h,e),p.copyTexImage2D(t,r,i,n,a,s,o,u),d!=e&&p.bindTexture(h,d)},t.copyTexSubImage2D=function(e,t,r,i,n,a,s,o,u,d){var p=this._ext,h=p.gl,_=p.textureTargetMap[t],p=p.cb.getCurrentTexture(_);p!=e&&h.bindTexture(_,e),h.copyTexSubImage2D(t,r,i,n,a,s,o,u,d),p!=e&&h.bindTexture(_,p)},t.generateMipmap=function(e,t){var r=this._ext,i=r.gl,r=r.cb.getCurrentTexture(t);r!=e&&i.bindTexture(t,e),i.generateMipmap(t),r!=e&&i.bindTexture(t,r)},t.texImage2D=function(e,t){var r=this._ext,i=r.gl,t=r.textureTargetMap[t],r=r.cb.getCurrentTexture(t),n=(r!=e&&i.bindTexture(t,e),Array.prototype.slice.call(arguments,1));i.texImage2D.apply(i,n),r!=e&&i.bindTexture(t,r)},t.texParameterf=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentTexture(t);n!=e&&a.bindTexture(t,e),a.texParameterf(t,r,i),n!=e&&a.bindTexture(t,n)},t.texParameteri=function(e,t,r,i){var n=this._ext,a=n.gl,n=n.cb.getCurrentTexture(t);n!=e&&a.bindTexture(t,e),a.texParameteri(t,r,i),n!=e&&a.bindTexture(t,n)},t.texSubImage2D=function(e,t){var r=this._ext,i=r.gl,t=r.textureTargetMap[t],r=r.cb.getCurrentTexture(t),n=(r!=e&&i.bindTexture(t,e),Array.prototype.slice.call(arguments,1));i.texSubImage2D.apply(i,n),r!=e&&i.bindTexture(t,r)},t.bindTexture=function(e,t,r){var i=this._ext,n=i.gl,i=i.cb.getCurrentTextureUnit();i!=e&&n.activeTexture(e),n.bindTexture(t,r),i!=e&&n.activeTexture(i)},0))},SpiderGL.WebGL.Context.hijack=function(e){if(e._spidergl)return!1;SpiderGL.WebGL.Context._prepareContex(e),SpiderGL.WebGL.Context._addExtension(e,"SGL_current_binding","cb",SpiderGL.WebGL.Context._setup_SGL_current_binding),SpiderGL.WebGL.Context._addExtension(e,"SGL_wrapper_notify","wn",SpiderGL.WebGL.Context._setup_SGL_wrapper_notify),SpiderGL.WebGL.Context._addExtension(e,"SGL_direct_state_access","dsa",SpiderGL.WebGL.Context._setup_SGL_direct_state_access);var t=e.getExtension("SGL_current_binding"),r=e.getExtension("SGL_wrapper_notify"),e=e.getExtension("SGL_direct_state_access");return!!t&&!!r&&!!e},SpiderGL.WebGL.Context.isHijacked=function(e){return!!e&&!!e._spidergl},SpiderGL.WebGL.Context.getHijacked=function(e,t){e=SpiderGL.WebGL.Context.get(e,t);return SpiderGL.WebGL.Context.hijack(e),e},SpiderGL.WebGL.Context.setStandardGLUnpack=function(e){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,WebGLRenderingContext.prototype.NONE)},SpiderGL.WebGL.ObjectGL=function(e,t,r){if(!SpiderGL.WebGL.Context.isHijacked(e))return null;r=SpiderGL.Utility.getDefaultObject({handle:null},r),SpiderGL.Core.ObjectBase.call(this),e.getExtension("SGL_wrapper_notify"),this._gl=e,this._cb=e.getExtension("SGL_current_binding"),this._dsa=e.getExtension("SGL_direct_state_access"),this._h=r.handle,this._t=t},SpiderGL.WebGL.ObjectGL.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.ObjectGL.unbind=function(e){},SpiderGL.WebGL.ObjectGL.prototype={get gl(){return this._gl},get handle(){return this._h},get target(){return this._t},get isValid(){return null!=this._h},get isReady(){return!1},destroy:function(){},bind:function(){},unbind:function(){}},SpiderGL.Type.extend(SpiderGL.WebGL.ObjectGL,SpiderGL.Core.ObjectBase),SpiderGL.WebGL.Buffer=function(e,t,r){if(!SpiderGL.WebGL.Context.isHijacked(e))return null;if(SpiderGL.Type.instanceOf(r,WebGLBuffer)?r={handle:r}:SpiderGL.Type.instanceOf(r,ArrayBuffer)||SpiderGL.Type.isTypedArray(r)?r={data:r}:SpiderGL.Type.isNumber(r)&&(r={size:r}),r=SpiderGL.Utility.getDefaultObject({handle:null,data:null,size:0,usage:SpiderGL.WebGL.Buffer.DEFAULT_USAGE},r),SpiderGL.WebGL.ObjectGL.call(this,e,t,r),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl;e=this._gl;var t=this._cb,i=(this._dsa,this._t),n=this._h;t.pushBuffer(i),n?(e.bindBuffer(i,n),r.size=e.getBufferParameter(i,e.BUFFER_SIZE),r.usage=e.getBufferParameter(i,e.BUFFER_USAGE)):(n=e.createBuffer(),e.bindBuffer(i,n),this._h=n),t.popBuffer(i),(n._spidergl=this)._size=r.size,this._usage=r.usage,r.data?this.setData(r.data,r.usage):r.size&&this.setSize(r.size,r.usage)},SpiderGL.WebGL.Buffer.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Buffer.DEFAULT_USAGE=WebGLRenderingContext.prototype.STATIC_DRAW,SpiderGL.WebGL.Buffer.DEFAULT_SUB_DATA_OFFSET=0,SpiderGL.WebGL.Buffer.unbind=function(e){},SpiderGL.WebGL.Buffer.prototype={_gl_deleteBuffer:function(){this._h=null},_gl_isBuffer:function(){},_gl_bindBuffer:function(){},_gl_getBufferParameter:function(){},_gl_bufferData:function(){var e=arguments[1],t=arguments[2];this._size=SpiderGL.Type.isNumber(e)?e:e.byteLength,this._usage=t},_gl_bufferSubData:function(){},_gl_vertexAttribPointer:function(){},_gl_drawElements:function(){},get isReady(){return 0<this._size},get size(){return this._size},get usage(){return this._usage},setSize:function(e,t){t=SpiderGL.Utility.getDefaultValue(t,SpiderGL.WebGL.Buffer.DEFAULT_USAGE),this._dsa.bufferData(this._h,this._t,e,t)},setData:function(e,t){t=SpiderGL.Utility.getDefaultValue(t,SpiderGL.WebGL.Buffer.DEFAULT_USAGE),this._dsa.bufferData(this._h,this._t,e,t)},setSubData:function(e,t){t=SpiderGL.Utility.getDefaultValue(t,SpiderGL.WebGL.Buffer.DEFAULT_SUB_DATA_OFFSET),this._dsa.bufferSubData(this._h,this._t,t,e)},destroy:function(){this._gl.deleteBuffer(this._h)},bind:function(){this._gl.bindBuffer(this._t,this._h)},unbind:function(){this._gl.bindBuffer(this._t,null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Buffer,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.VertexBuffer=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Buffer.call(this,e,SpiderGL.WebGL.VertexBuffer.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:void 0):null},SpiderGL.WebGL.VertexBuffer.TARGET=WebGLRenderingContext.prototype.ARRAY_BUFFER,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_INDEX=0,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_SIZE=3,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_TYPE=WebGLRenderingContext.prototype.FLOAT,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_NORMALIZED=!1,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_STRIDE=0,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_OFFSET=0,SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_ENABLE=!0,SpiderGL.WebGL.VertexBuffer.unbind=function(e){e.bindBuffer(SpiderGL.WebGL.VertexBuffer.TARGET,null)},SpiderGL.WebGL.VertexBuffer.prototype={vertexAttribPointer:function(e){e=SpiderGL.Utility.getDefaultObject({index:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_INDEX,size:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_SIZE,glType:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_TYPE,normalized:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_NORMALIZED,stride:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_STRIDE,offset:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_OFFSET,enable:SpiderGL.WebGL.VertexBuffer.DEFAULT_ATTRIBUTE_ENABLE},e),this._dsa.vertexAttribPointer(this._h,e.index,e.size,e.glType,e.normalized,e.stride,e.offset),e.enable&&this._gl.enableVertexAttribArray(e.index)}},SpiderGL.Type.extend(SpiderGL.WebGL.VertexBuffer,SpiderGL.WebGL.Buffer),SpiderGL.WebGL.IndexBuffer=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Buffer.call(this,e,SpiderGL.WebGL.IndexBuffer.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:void 0):null},SpiderGL.WebGL.IndexBuffer.TARGET=WebGLRenderingContext.prototype.ELEMENT_ARRAY_BUFFER,SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_MODE=WebGLRenderingContext.prototype.TRIANGLES,SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_COUNT=-1,SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_TYPE=WebGLRenderingContext.prototype.UNSIGNED_SHORT,SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_OFFSET=0,SpiderGL.WebGL.IndexBuffer.unbind=function(e){e.bindBuffer(SpiderGL.WebGL.IndexBuffer.TARGET,null)},SpiderGL.WebGL.IndexBuffer.prototype={drawElements:function(e){var t;(e=SpiderGL.Utility.getDefaultObject({glMode:SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_MODE,count:SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_COUNT,glType:SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_TYPE,offset:SpiderGL.WebGL.IndexBuffer.DEFAULT_DRAW_ELEMENTS_OFFSET},e)).count<1&&(t=SpiderGL.Type.typeSizeFromGL(e.glType),e.count=(this._size-e.offset)/t),this._dsa.drawElements(this._h,e.glMode,e.count,e.glType,e.offset)}},SpiderGL.Type.extend(SpiderGL.WebGL.IndexBuffer,SpiderGL.WebGL.Buffer),SpiderGL.WebGL.Framebuffer=function(e,t){if(!SpiderGL.WebGL.Context.isHijacked(e))return null;if(SpiderGL.Type.instanceOf(t,WebGLFramebuffer)&&(t={handle:t}),t=SpiderGL.Utility.getDefaultObject({handle:null,autoViewport:SpiderGL.WebGL.Framebuffer.DEFAULT_AUTO_VIEWPORT},t),SpiderGL.WebGL.ObjectGL.call(this,e,SpiderGL.WebGL.Framebuffer.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl;e=this._gl;var r=this._cb,i=(this._dsa,this._t),n=this._h,a=!1;if(n?a=!0:(n=e.createFramebuffer(),this._h=n),(n._spidergl=this)._attachments={},this._status=0,this._autoViewport=t.autoViewport,this._viewport=[0,0,1,1],r.pushFramebuffer(i),e.bindFramebuffer(i,n),a){var s,o,u,d=0;for(u in SpiderGL.WebGL.Framebuffer._attachmentName)switch(s=e.getFramebufferAttachmentParameter(i,att,e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME),e.getFramebufferAttachmentParameter(i,att,e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)){case e.RENDERBUFFER:d=e.RENDERBUFFER,this._importRenderbuffer(i,u,d,s);break;case e.TEXTURE:o=e.getFramebufferAttachmentParameter(i,att,e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL),0==(d=e.getFramebufferAttachmentParameter(i,att,e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE))&&(d=e.TEXTURE_2D),this._importTexture(i,u,d,s,o)}}this._status=e.checkFramebufferStatus(i),r.popFramebuffer(i),this.setAttachments(t)},SpiderGL.WebGL.Framebuffer.TARGET=WebGLRenderingContext.prototype.FRAMEBUFFER,SpiderGL.WebGL.Framebuffer.DEFAULT_AUTO_VIEWPORT=!0,SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_TEXTURE_LEVEL=0,SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_CUBE_MAP_FACE=WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_X=0,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_Y=0,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_WIDTH=-1,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_HEIGHT=-1,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_FORMAT=WebGLRenderingContext.prototype.RGBA,SpiderGL.WebGL.Framebuffer.DEFAULT_CLEAR_MASK=WebGLRenderingContext.prototype.COLOR_BUFFER_BIT|WebGLRenderingContext.prototype.DEPTH_BUFFER_BIT|WebGLRenderingContext.prototype.STENCIL_BUFFER_BIT,SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_TYPE=WebGLRenderingContext.UNSIGNED_BYTE,SpiderGL.WebGL.Framebuffer.unbind=function(e){e.bindFramebuffer(SpiderGL.WebGL.Framebuffer.TARGET,null)},SpiderGL.WebGL.Framebuffer._attachmentName={},SpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.COLOR_ATTACHMENT0]="color",SpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.DEPTH_ATTACHMENT]="depth",SpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.STENCIL_ATTACHMENT]="stencil",SpiderGL.WebGL.Framebuffer._attachmentName[WebGLRenderingContext.prototype.DEPTH_STENCIL_ATTACHMENT]="depthStencil",SpiderGL.WebGL.Framebuffer.prototype={_gl_deleteFramebuffer:function(e){this._h=null},_gl_isFramebuffer:function(e){},_gl_bindFramebuffer:function(e,t){},_gl_checkFramebufferStatus:function(e){},_gl_getFramebufferAttachmentParameter:function(e,t,r){},_gl_framebufferRenderbuffer:function(e,t,r,i){this._importRenderbuffer.apply(this,arguments),this._status=this._gl.checkFramebufferStatus(this._t)},_gl_framebufferTexture2D:function(e,t,r,i,n){this._importTexture.apply(this,arguments),this._status=this._gl.checkFramebufferStatus(this._t)},_gl_clear:function(e){},_gl_readPixels:function(e,t,r,i,n,a,s){},_importTexture:function(e,t,r,i,n){var a=SpiderGL.WebGL.Framebuffer._attachmentName[t];a&&(i?(n={attachment:t,resource:null,target:r,level:n,face:(t=this._gl).NONE},this._attachments[a]=n,r==t.TEXTURE_2D?n.resource=new SpiderGL.WebGL.Texture2D(t,{handle:i}):(n.resource=new SpiderGL.WebGL.TextureCubeMap(t,{handle:i}),n.face=r),this._viewport=[0,0,SpiderGL.Math.max(n.resource.width,1),SpiderGL.Math.max(n.resource.height,1)]):delete this._attachments[a])},_importRenderbuffer:function(e,t,r,i){var n=SpiderGL.WebGL.Framebuffer._attachmentName[t];n&&(i?(r={attachment:t,resource:null,target:r,level:0,face:(t=this._gl).NONE},(this._attachments[n]=r).resource=new SpiderGL.WebGL.Renderbuffer(t,{handle:i}),this._viewport=[0,0,SpiderGL.Math.max(r.resource.width,1),SpiderGL.Math.max(r.resource.height,1)]):delete this._attachments[n])},_setAttachment:function(e,t){var r=SpiderGL.WebGL.Framebuffer._attachmentName[e];if(!r)return!1;var i=this._gl;if(!(!t||"resource"in t&&!t.resource)){var n=i.NONE,a=(SpiderGL.Type.instanceOf(t,WebGLTexture)?(t={resource:t},n=i.TEXTURE):SpiderGL.Type.instanceOf(t,WebGLRenderbuffer)?(t={resource:t},n=i.RENDERBUFFER):SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.Texture)?(t={resource:t.handle},n=i.TEXTURE):SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.Renderbuffer)&&(t={resource:t.handle},n=i.RENDERBUFFER),!!t&&void 0!==t.face),s=(t=SpiderGL.Utility.getDefaultObject({resource:null,level:SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_TEXTURE_LEVEL,face:SpiderGL.WebGL.Framebuffer.DEFAULT_ATTACHMENT_CUBE_MAP_FACE},t),this._t);switch(n){case i.TEXTURE:var o=SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.TextureCubeMap)||a?t.face:i.TEXTURE_2D;i.framebufferTexture2D(s,e,o,t.resource,t.level);break;case i.RENDERBUFFER:i.framebufferRenderbuffer(s,e,i.RENDERBUFFER,t.resource)}return!0}n=this._attachments[r];n&&(n.target===i.RENDERBUFFER?i.framebufferRenderbuffer(s,n.attachment,i.RENDERBUFFER,null):i.framebufferTexture2D(s,n.attachment,i.TEXTURE_2D,null,0))},get isReady(){return this.isComplete},get status(){return this._status},get isComplete(){return this._status===this._gl.FRAMEBUFFER_COMPLETE},get viewport(){return this._viewport.slice()},get width(){return this._viewport[2]},get height(){return this._viewport[3]},get autoViewport(){return this._autoViewport},set autoViewport(e){this._autoViewport=!!e},setAttachments:function(e){e=e||{};var t=this._gl,r=this._cb,i=this._t,n=this._h;return r.pushFramebuffer(i),t.bindFramebuffer(i,n),"color"in e&&this._setAttachment(t.COLOR_ATTACHMENT0,e.color),"depthStencil"in e?(this._setAttachment(t.DEPTH_ATTACHMENT,null),this._setAttachment(t.STENCIL_ATTACHMENT,null),this._setAttachment(t.DEPTH_STENCIL_ATTACHMENT,e.depthStencil)):"depth"in e?(this._setAttachment(t.DEPTH_STENCIL_ATTACHMENT,null),this._setAttachment(t.STENCIL_ATTACHMENT,null),this._setAttachment(t.DEPTH_ATTACHMENT,e.depth)):"stencil"in e&&(this._setAttachment(t.DEPTH_STENCIL_ATTACHMENT,null),this._setAttachment(t.DEPTH_ATTACHMENT,null),this._setAttachment(t.STENCIL_ATTACHMENT,e.stencil)),this._status=t.checkFramebufferStatus(i),r.popFramebuffer(i),this.isComplete},getAttachments:function(){var e,t,r={};for(t in this._attachments)e=this._attachments[t],r[t]={attachment:e.attachment,resource:e.resource,target:e.target,level:e.level};return r},detachAll:function(){this.setAttachments({color:null,depthStencil:null})},get colorTarget(){var e=this._attachments.color;return e?e.resource:null},set colorTarget(e){this.setAttachments({color:e})},get depthTarget(){var e=this._attachments.depth;return e?e.resource:null},set depthTarget(e){this.setAttachments({depth:e})},get stencilTarget(){var e=this._attachments.stencil;return e?e.resource:null},set stencilTarget(e){this.setAttachments({stencil:e})},get depthStencilTarget(){var e=this._attachments.depthStencil;return e?e.resource:null},set depthStencilTarget(e){this.setAttachments({depthStencil:e})},clear:function(e){e=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Framebuffer.DEFAULT_CLEAR_MASK),this._dsa.clear(this._h,e)},readPixels:function(e,t){(t=SpiderGL.Utility.getDefaultObject({x:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_X,y:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_Y,width:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_WIDTH,height:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_HEIGHT,format:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_FORMAT,type:SpiderGL.WebGL.Framebuffer.DEFAULT_READ_PIXELS_TYPE},t)).width<0&&(t.width=this._viewport[2]),t.height<0&&(t.height=this._viewport[3]),this._dsa.readPixels(this._h,t.x,t.y,t.width,t.height,t.format,t.type,e)},applyViewport:function(){var e=this._gl,t=this._viewport;e.viewport(t[0],t[1],t[2],t[3])},destroy:function(){this._gl.deleteFramebuffer(this._h)},bind:function(e){var t=this._gl;t.bindFramebuffer(this._t,this._h),SpiderGL.Utility.getDefaultValue(e,this._autoViewport)&&(e=this._viewport,t.viewport(e[0],e[1],e[2],e[3]))},unbind:function(){this._gl.bindFramebuffer(this._t,null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Framebuffer,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.Program=function(e,t){if(!SpiderGL.WebGL.Context.isHijacked(e))return null;if(SpiderGL.Type.instanceOf(t,WebGLProgram)&&(t={handle:t}),t=SpiderGL.Utility.getDefaultObject({handle:null,autoLink:SpiderGL.WebGL.Program.DEFAULT_AUTO_LINK},t),SpiderGL.WebGL.ObjectGL.call(this,e,SpiderGL.WebGL.Program.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl;e=this._gl,this._cb,this._dsa;var r=this._h,i=!1,n="",a=!1;if(r?(a=!0,i=!!e.getProgramParameter(r,e.LINK_STATUS),n=(n=e.getProgramInfoLog(r))||""):(r=e.createProgram(),this._h=r),(r._spidergl=this)._shaders=[],this._linked=i,this._log=n,this._autoLink=t.autoLink,this._attributes={},this._uniforms={},a)for(var s=e.getAttachedShaders(r),o=0,u=s.length;o<u;++o)this._importShader(s[o]);i=!1;this._addShaders(t.shaders)&&(i=!0),(i=this._setAttributes(t.attributes)?!0:i)&&this._autoLink?this.link():a&&this._postLink(),this.setUniforms(t.uniforms)},SpiderGL.WebGL.Program.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Program.DEFAULT_AUTO_LINK=!0,SpiderGL.WebGL.Program.unbind=function(e){e.useProgram(null)},SpiderGL.WebGL.Program._uniformSetFunctions={},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL]=function(e,t,r){e.uniform1i(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC2]=function(e,t,r){e.uniform2iv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC3]=function(e,t,r){e.uniform3iv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.BOOL_VEC4]=function(e,t,r){e.uniform4iv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT]=function(e,t,r){e.uniform1i(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC2]=function(e,t,r){e.uniform2iv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC3]=function(e,t,r){e.uniform3iv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.INT_VEC4]=function(e,t,r){e.uniform4iv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT]=function(e,t,r){e.uniform1f(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC2]=function(e,t,r){e.uniform2fv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC3]=function(e,t,r){e.uniform3fv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_VEC4]=function(e,t,r){e.uniform4fv(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT2]=function(e,t,r){e.uniformMatrix2fv(t,this.location,!1,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT3]=function(e,t,r){e.uniformMatrix3fv(t,this.location,!1,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.FLOAT_MAT4]=function(e,t,r){e.uniformMatrix4fv(t,this.location,!1,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.SAMPLER_2D]=function(e,t,r){e.uniform1i(t,this.location,r)},SpiderGL.WebGL.Program._uniformSetFunctions[WebGLRenderingContext.prototype.SAMPLER_CUBE]=function(e,t,r){e.uniform1i(t,this.location,r)},SpiderGL.WebGL.Program.prototype={_gl_deleteProgram:function(e){this._h=null},_gl_isProgram:function(e){},_gl_useProgram:function(e){},_gl_getActiveAttrib:function(e,t){},_gl_getActiveUniform:function(e,t){},_gl_getAttachedShaders:function(e){},_gl_getAttribLocation:function(e,t){},_gl_getProgramParameter:function(e,t){},_gl_getProgramInfoLog:function(e){},_gl_getUniform:function(e,t){},_gl_getUniformLocation:function(e,t){},_gl_attachShader:function(e,t){this._importShader(t)},_gl_bindAttribLocation:function(e,t,r){},_gl_detachShader:function(e,t){!t||(t=this._shaderHandleIndex(t))<0||this._shaders.splice(t,1)},_gl_linkProgram:function(e){this._postLink()},_gl_uniform1f:function(e,t){},_gl_uniform1fv:function(e,t){},_gl_uniform1i:function(e,t){},_gl_uniform1iv:function(e,t){},_gl_uniform2f:function(e,t,r){},_gl_uniform2fv:function(e,t){},_gl_uniform2i:function(e,t,r){},_gl_uniform2iv:function(e,t){},_gl_uniform3f:function(e,t,r,i){},_gl_uniform3fv:function(e,t){},_gl_uniform3i:function(e,t,r,i){},_gl_uniform3iv:function(e,t){},_gl_uniform4f:function(e,t,r,i,n){},_gl_uniform4fv:function(e,t){},_gl_uniform4i:function(e,t,r,i,n){},_gl_uniform4iv:function(e,t){},_gl_uniformMatrix2fv:function(e,t,r){},_gl_uniformMatrix3fv:function(e,t,r){},_gl_uniformMatrix4fv:function(e,t,r){},_gl_validateProgram:function(e){},_shaderHandleIndex:function(e){for(var t=0,r=this._shaders.length;t<r;++t)if(this._shaders[t].handle===e)return t;return-1},_shaderIndex:function(e){if(this._shaders.indexOf)return this._shaders.indexOf(e);for(var t=0,r=this._shaders.length;t<r;++t)if(this._shaders[t]===e)return t;return-1},_importShader:function(e){if(e&&!(0<=this._shaderHandleIndex(e))){var t=this._gl,r=e._spidergl;if(!r)switch(t.getShaderParameter(e,t.SHADER_TYPE)){case t.VERTEX_SHADER:r=new SpiderGL.WebGL.VertexShader(t,{handle:e});break;case t.FRAGMENT_SHADER:r=new SpiderGL.WebGL.FragmentShader(t,{handle:e});break;default:return}this._shaders.push(r)}},_updateActiveInfo:function(){for(var e=this._gl,t=this._h,r=0,i=null,n=null,a=null,s={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<r;++o)n=(i=e.getActiveAttrib(t,o)).name,a=e.getAttribLocation(t,n),s[n]={index:o,name:n,size:i.size,type:i.type,location:a};var u={};for(r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=0;o<r;++o)if(n=(i=e.getActiveUniform(t,o)).name,a=e.getUniformLocation(t,n),u[n]={index:o,name:n,size:i.size,type:i.type,location:a,setValue:SpiderGL.WebGL.Program._uniformSetFunctions[i.type]},1<i.size){var d=n.lastIndexOf("[0]");if(d==n.length-3)for(var p=n.slice(0,d),h=1;h<i.size;++h){var _=p+"["+h+"]",a=e.getUniformLocation(t,_);u[_]={index:o,name:_,size:i.size,type:i.type,location:a,setValue:SpiderGL.WebGL.Program._uniformSetFunctions[i.type]}}}this._attributes=s,this._uniforms=u},_postLink:function(){var e=this._gl,t=this._h;this._linked=!!e.getProgramParameter(t,e.LINK_STATUS),this._log=e.getProgramInfoLog(t),this._log||(this._log=""),this._updateActiveInfo()},_addShaders:function(e){if(!e)return!1;for(var t,r=this._gl,i=this._h,n=null,a=0,s=e.length;a<s;++a)t=e[a],n=null,SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.Shader)&&(n=t.handle),(n=SpiderGL.Type.instanceOf(t,WebGLShader)?t:n)&&r.attachShader(i,n);return!0},_removeShaders:function(e){if(!e)return!1;for(var t,r=this._gl,i=this._h,n=null,a=0,s=e.length;a<s;++a)t=e[a],n=null,SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.Shader)&&(n=t.handle),(n=SpiderGL.Type.instanceOf(t,SpiderGL.WebGL.Shader)?t:n)&&r.detachShader(i,n);return!0},_setAttributes:function(e){if(!e)return!1;var t,r=this._gl,i=this._h;for(t in e)r.bindAttribLocation(i,e[t],t);return!0},get isReady(){return this.isLinked},get isLinked(){return this._linked},get log(){return this._log},get autoLink(){return this._autoLink},set autoLink(e){this._autoLink=!!e},addShaders:function(e,t){return!this._addShaders(e)||!SpiderGL.Utility.getDefaultValue(t,this._autoLink)||this.link()},removeShaders:function(e,t){return!this._removeShaders(e)||!SpiderGL.Utility.getDefaultValue(t,this._autoLink)||this.link()},hasShader:function(e){return 0<=this._shaderIndex(e)},getShaders:function(){return this._shaders.slice()},link:function(){return this._gl.linkProgram(this._h),this._linked},validate:function(){var e=this._gl,t=this._h;return e.validateProgram(t),!!e.getProgramParameter(t,e.VALIDATE_STATUS)},setAttributes:function(e){return!!this._setAttributes(e)&&(!this._autoLink||this.link())},getAttributesNames:function(){var e,t=this._attributes,r=[];for(e in t)r.push(t[e].name);return r},getAttributesIndices:function(){var e,t=this._attributes,r={};for(e in t)r[e]=t[e].location;return r},getAttributesInfo:function(){var e,t,r=this._attributes,i={};for(t in r)e=r[t],i[t]={index:e.index,name:e.name,size:e.size,type:e.type,location:e.location};return i},setUniforms:function(e){if(!e)return!1;var t,r=this._gl,i=this._cb,n=this._dsa,a=this._h,s=(i.pushProgram(),r.useProgram(a),this._uniforms),o=null;for(t in e)(o=s[t])&&o.setValue(n,a,e[t]);return i.popProgram(),!0},getUniformsNames:function(){var e,t=this._uniforms,r=[];for(e in t)r.push(t[e].name);return r},getUniformsValues:function(){var e,t=this._gl,r=this._h,i=this._uniforms,n={};for(e in i)n[e]=t.getUniform(r,i[e].location);return n},getUniformsInfo:function(){var e,t,r=this._uniforms,i={};for(t in r)e=r[t],i[t]={index:e.index,name:e.name,size:e.size,type:e.type,location:e.location};return i},destroy:function(){this._gl.deleteProgram(this._h)},bind:function(){this._gl.useProgram(this._h)},unbind:function(){this._gl.useProgram(null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Program,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.Renderbuffer=function(e,t){if(!SpiderGL.WebGL.Context.isHijacked(e))return null;if(SpiderGL.Type.instanceOf(n,WebGLRenderbuffer)&&(t={handle:t}),t=SpiderGL.Utility.getDefaultObject({handle:null},t),SpiderGL.WebGL.ObjectGL.call(this,e,SpiderGL.WebGL.Renderbuffer.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl;e=this._gl;var r=this._cb,i=(this._dsa,this._t),n=this._h,a=e.NONE,s=0,o=0;n?(r.pushRenderbuffer(i),e.bindRenderbuffer(i,n),a=e.getRenderbufferParameter(i,e.RENDERBUFFER_INTERNAL_FORMAT),s=e.getRenderbufferParameter(i,e.RENDERBUFFER_WIDTH),o=e.getRenderbufferParameter(i,e.RENDERBUFFER_HEIGHT),r.popRenderbuffer(i)):(n=e.createRenderbuffer(),this._h=n),(n._spidergl=this)._width=s,this._height=o,this._format=a,SpiderGL.Type.isNumber(t.internalFormat)&&SpiderGL.Type.isNumber(t.width)&&SpiderGL.Type.isNumber(t.height)&&this.setStorage(t.internalFormat,t.width,t.height,t.format)},SpiderGL.WebGL.Renderbuffer.TARGET=WebGLRenderingContext.prototype.RENDERBUFFER,SpiderGL.WebGL.Renderbuffer.unbind=function(e){e.bindRenderbuffer(SpiderGL.WebGL.Renderbuffer.TARGET,null)},SpiderGL.WebGL.Renderbuffer.prototype={_gl_deleteRenderbuffer:function(e){this._h=null},_gl_isRenderbuffer:function(e){},_gl_bindRenderbuffer:function(e,t){},_gl_getRenderbufferParameter:function(e,t){},_gl_renderbufferStorage:function(e,t,r,i){this._format=t,this._width=r,this._height=i},get isReady(){return 0<this._width&&0<this._height},get format(){return this._format},get width(){return this._width},get height(){return this._height},setStorage:function(e,t,r){this._dsa.renderbufferStorage(this._h,this._t,e,t,r)},destroy:function(){this._gl.deleteRenderbuffer(this._h)},bind:function(){this._gl.bindRenderbuffer(this._t,this._h)},unbind:function(){this._gl.bindRenderbuffer(this._t,null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Renderbuffer,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.Shader=function(e,t,r,i){if(!SpiderGL.WebGL.Context.isHijacked(e))return null;if(SpiderGL.Type.instanceOf(i,WebGLShader)?i={handle:i}:SpiderGL.Type.isString(i)&&(i={source:i}),i=SpiderGL.Utility.getDefaultObject({handle:null,source:null,autoCompile:SpiderGL.WebGL.Shader.DEFAULT_AUTO_COMPILE},i),SpiderGL.WebGL.ObjectGL.call(this,e,t,i),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl;e=this._gl,this._cb,this._dsa;var t="",n=!1,a="",s=this._h;s?(t=(t=e.getShaderSource(s))||"",n=!!e.getShaderParameter(s,e.COMPILE_STATUS),e.getShaderParameter(s,e.DELETE_STATUS),a=(a=e.getShaderInfoLog(s))||""):(s=e.createShader(r),this._h=s),(s._spidergl=this)._source=t,this._compiled=n,this._log=a,this._autoCompile=i.autoCompile,i.source&&this.setSource(i.source)},SpiderGL.WebGL.Shader.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Shader.DEFAULT_AUTO_COMPILE=!0,SpiderGL.WebGL.Shader.unbind=function(e){},SpiderGL.WebGL.Shader.prototype={_gl_deleteShader:function(e){this._h=null},_gl_isShader:function(e){},_gl_getShaderParameter:function(e,t){},_gl_getShaderInfoLog:function(e){},_gl_getShaderSource:function(e){},_gl_compileShader:function(e){this._postCompile()},_gl_shaderSource:function(e,t){this._source=t,this._source||(this._source="")},_postCompile:function(){var e=this._gl,t=this._h;this._compiled=!!e.getShaderParameter(t,e.COMPILE_STATUS),this._log=e.getShaderInfoLog(t),this._log||(this._log="")},get isReady(){return this.isCompiled},get isCompiled(){return this._compiled},get log(){return this._log},get autoCompile(){return this._autoCompile},set autoCompile(e){this._autoCompile=!!e},setSource:function(e,t){var r=this._gl,i=this._h;return r.shaderSource(i,e),SpiderGL.Utility.getDefaultValue(t,this._autoCompile),this.compile()},get source(){return this._source},set source(e){this.setSource(e)},compile:function(){return this._gl.compileShader(this._h),this._compiled},destroy:function(){this._gl.deleteShader(this._h)},bind:function(){},unbind:function(){}},SpiderGL.Type.extend(SpiderGL.WebGL.Shader,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.VertexShader=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Shader.call(this,e,SpiderGL.WebGL.VertexShader.TARGET,e.VERTEX_SHADER,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:void 0):null},SpiderGL.WebGL.VertexShader.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.VertexShader.unbind=function(e){},SpiderGL.WebGL.VertexShader.prototype={},SpiderGL.Type.extend(SpiderGL.WebGL.VertexShader,SpiderGL.WebGL.Shader),SpiderGL.WebGL.FragmentShader=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Shader.call(this,e,SpiderGL.WebGL.FragmentShader.TARGET,e.FRAGMENT_SHADER,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:void 0):null},SpiderGL.WebGL.FragmentShader.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.FragmentShader.unbind=function(e){},SpiderGL.WebGL.FragmentShader.prototype={},SpiderGL.Type.extend(SpiderGL.WebGL.FragmentShader,SpiderGL.WebGL.Shader),SpiderGL.WebGL.Texture=function(e,t,r){if(!SpiderGL.WebGL.Context.isHijacked(e))return null;if(SpiderGL.Type.instanceOf(r,WebGLTexture)?r={handle:r}:SpiderGL.Type.isString(r)&&(r={url:r}),r=SpiderGL.Utility.getDefaultObject({handle:null,magFilter:SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER,minFilter:SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER,wrapS:SpiderGL.WebGL.Texture.DEFAULT_WRAP_S,wrapT:SpiderGL.WebGL.Texture.DEFAULT_WRAP_T,flipYPolicy:SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y,premultiplyAlphaPolicy:SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA,colorspaceConversionPolicy:SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION,autoMipmap:SpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP,format:e.NONE,width:0,height:0},r),SpiderGL.WebGL.ObjectGL.call(this,e,t,r),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl;e=this._gl;var t=this._cb,i=(this._dsa,this._t),n=this._h;n||(n=e.createTexture(),this._h=n),t.pushTexture(i),e.bindTexture(i,n),this._magFilter=e.getTexParameter(i,e.TEXTURE_MAG_FILTER),this._minFilter=e.getTexParameter(i,e.TEXTURE_MIN_FILTER),this._wrapS=e.getTexParameter(i,e.TEXTURE_WRAP_S),this._wrapT=e.getTexParameter(i,e.TEXTURE_WRAP_T),t.popTexture(i),(n._spidergl=this)._format=r.format,this._width=r.width,this._height=r.height,this._flipY=r.flipYPolicy,this._premultiplyAlpha=r.premultiplyAlphaPolicy,this._colorspaceConversion=r.colorspaceConversionPolicy,this._autoMipmap=r.autoMipmap,this._missingFaces=SpiderGL.WebGL.Texture._FACE_ALL_BITS,this.setSampler(r)},SpiderGL.WebGL.Texture.TARGET=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Texture.DEFAULT_BORDER=0,SpiderGL.WebGL.Texture.DEFAULT_FORMAT=WebGLRenderingContext.prototype.RGBA,SpiderGL.WebGL.Texture.DEFAULT_AUTO_GENERATE_MIPMAP=!1,SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT=WebGLRenderingContext.prototype.RGBA,SpiderGL.WebGL.Texture.DEFAULT_LEVEL=0,SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER=WebGLRenderingContext.prototype.LINEAR,SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER=WebGLRenderingContext.prototype.LINEAR,SpiderGL.WebGL.Texture.DEFAULT_TYPE=WebGLRenderingContext.prototype.UNSIGNED_BYTE,SpiderGL.WebGL.Texture.DEFAULT_WRAP_S=WebGLRenderingContext.prototype.REPEAT,SpiderGL.WebGL.Texture.DEFAULT_WRAP_T=WebGLRenderingContext.prototype.REPEAT,SpiderGL.WebGL.Texture.DEFAULT_X_OFFSET=0,SpiderGL.WebGL.Texture.DEFAULT_Y_OFFSET=0,SpiderGL.WebGL.Texture.DEFAULT_UNPACK_FLIP_Y=!0,SpiderGL.WebGL.Texture.DEFAULT_UNPACK_PREMULTIPLY_ALPHA=!1,SpiderGL.WebGL.Texture.DEFAULT_UNPACK_COLORSPACE_CONVERSION=WebGLRenderingContext.prototype.NONE,SpiderGL.WebGL.Texture.unbind=function(e){},SpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT=1,SpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT=2,SpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT=4,SpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT=8,SpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT=16,SpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT=32,SpiderGL.WebGL.Texture._FACE_ALL_BITS=SpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT|SpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT|SpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT|SpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT|SpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT|SpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT,SpiderGL.WebGL.Texture._faceBits={},SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_2D]=SpiderGL.WebGL.Texture._FACE_ALL_BITS,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP]=SpiderGL.WebGL.Texture._FACE_ALL_BITS,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X]=SpiderGL.WebGL.Texture._FACE_POSITIVE_X_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_X]=SpiderGL.WebGL.Texture._FACE_NEGATIVE_X_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Y]=SpiderGL.WebGL.Texture._FACE_POSITIVE_Y_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Y]=SpiderGL.WebGL.Texture._FACE_NEGATIVE_Y_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Z]=SpiderGL.WebGL.Texture._FACE_POSITIVE_Z_BIT,SpiderGL.WebGL.Texture._faceBits[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Z]=SpiderGL.WebGL.Texture._FACE_NEGATIVE_Z_BIT,SpiderGL.WebGL.Texture.prototype={_gl_deleteTexture:function(e){this._h=null},_gl_isTexture:function(e){},_gl_bindTexture:function(e,t){},_gl_getTexParameter:function(e,t){},_gl_copyTexImage2D:function(e,t,r,i,n,a,s,o){0==t&&(this._format=r,this._width=a,this._height=s)},_gl_copyTexSubImage2D:function(e,t,r,i,n,a,s,o,u){},_gl_generateMipmap:function(e){},_gl_texImage2D:function(e){var t=arguments.length;6===t?0===arguments[1]&&(this._format=arguments[2],this._width=arguments[5].width,this._height=arguments[5].height):9===t&&0===arguments[1]&&(this._format=arguments[2],this._width=arguments[3],this._height=arguments[4])},_gl_texParameterf:function(e,t,r){this._setTexParameter(t,r)},_gl_texParameteri:function(e,t,r){this._setTexParameter(t,r)},_gl_texSubImage2D:function(e){},_setTexParameter:function(e,t){var r=this._gl;switch(e){case r.TEXTURE_MAG_FILTER:this._magFilter=t;break;case r.TEXTURE_MIN_FILTER:this._minFilter=t;break;case r.TEXTURE_WRAP_S:this._wrapS=t;break;case r.TEXTURE_WRAP_T:this._wrapT=t}},_setImageData:function(e,t,r){var i,n,a,s,o=!!(r=SpiderGL.Utility.getDefaultObject({internalFormat:SpiderGL.WebGL.Texture.DEFAULT_INTERNAL_FORMAT,border:SpiderGL.WebGL.Texture.DEFAULT_BORDER,xoffset:SpiderGL.WebGL.Texture.DEFAULT_X_OFFSET,yoffset:SpiderGL.WebGL.Texture.DEFAULT_Y_OFFSET,level:SpiderGL.WebGL.Texture.DEFAULT_LEVEL,format:SpiderGL.WebGL.Texture.DEFAULT_FORMAT,type:SpiderGL.WebGL.Texture.DEFAULT_TYPE,width:0,height:0,generateMipmap:this._autoMipmap,flipY:this._flipY,premultiplyAlpha:this._premultiplyAlpha,colorspaceConversion:this._colorspaceConversion,data:null,url:null,onCancel:null,onError:null,onProgress:null,onSuccess:null},r)).url,u=!1,d=(o||(u=!r.data||SpiderGL.Type.isTypedArray(r.data)),!1),p=(o||u||(d=SpiderGL.Type.instanceOf(r.data,HTMLImageElement)||SpiderGL.Type.instanceOf(r.data,HTMLCanvasElement)||SpiderGL.Type.instanceOf(r.data,HTMLVideoElement))||"undefined"!=typeof ImageData&&(d=SpiderGL.Type.instanceOf(r.data,ImageData)),this._gl),h=(this._cb,this._dsa),_=t,c=this._h,l=-1,f=-1,L=-1,S=((u||d)&&((S=r.flipY)!=SpiderGL.Core.DONT_CARE&&(S==(l=p.getParameter(p.UNPACK_FLIP_Y_WEBGL))?l=-1:p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,S)),(S=r.premultiplyAlpha)!=SpiderGL.Core.DONT_CARE&&(S==(f=p.getParameter(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL))?f=-1:p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,S)),(S=r.colorspaceConversion)!=SpiderGL.Core.DONT_CARE)&&(S==(L=p.getParameter(p.UNPACK_COLORSPACE_CONVERSION_WEBGL))?L=-1:p.pixelStorei(p.UNPACK_COLORSPACE_CONVERSION_WEBGL,S)),!1);if(o)i={internalFormat:r.internalFormat,border:r.border,xoffset:r.xoffset,yoffset:r.yoffset,level:r.level,format:r.format,type:r.type,generateMipmap:r.generateMipmap,flipY:r.flipY,premultiplyAlpha:r.premultiplyAlpha,colorspaceConversion:r.colorspaceConversion,data:null},n=this,a=r.onSuccess,s=new SpiderGL.IO.ImageRequest(r.url,{onCancel:r.onCancel,onError:r.onError,onProgress:r.onProgress,onSuccess:function(){i.data=s.image,e?n._setImage(t,i):n._setSubImage(t,i),a&&a()},send:!0});else{if(u){if(r.width<=0||r.height<=0)return!1;e?(h.texImage2D(c,_,r.level,r.internalFormat,r.width,r.height,r.border,r.format,r.type,r.data),S=!0):h.texSubImage2D(c,_,r.level,r.xoffset,r.yoffset,r.width,r.height,r.format,r.type,r.data)}else{if(!d)return!1;e?(h.texImage2D(c,_,r.level,r.internalFormat,r.format,r.type,r.data),S=!0):h.texSubImage2D(c,_,r.level,r.xoffset,r.yoffset,r.format,r.type,r.data)}S&&(this._missingFaces&=~SpiderGL.WebGL.Texture._faceBits[_]),(u||d)&&(-1!=l&&p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,l),-1!=f&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),-1!=L)&&p.pixelStorei(p.UNPACK_COLORSPACE_CONVERSION_WEBGL,L),r.generateMipmap&&this.generateMipmap()}return!0},_setImage:function(e,t){return this._setImageData(!0,e,t)},_setSubImage:function(e,t){return this._setImageData(!1,e,t)},get isReady(){return 0==this._missingFaces&&0<this._width&&0<this._height},get flipYPolicy(){return this._flipY},set flipYPolicy(e){this._flipY=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Context.DEFAULT_UNPACK_FLIP_Y)},get premultuplyAlphaPolicy(){return this._premultuplyAlpha},set premultuplyAlphaPolicy(e){this._premultuplyAlpha=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Context.DEFAULT_UNPACK_PREMULTIPLY_ALPHA)},get colorspaceConversionPolicy(){return this._colorspaceConversion},set colorspaceConversionPolicy(e){this._colorspaceConversion=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Context.DEFAULT_UNPACK_COLORSPACE_CONVERSION)},get autoMipmap(){return this._autoMipmap},set autoMipmap(e){this._autoMipmap=e},get format(){return this._format},get width(){return this._width},get height(){return this._height},get magFilter(){return this._magFilter},set magFilter(e){e=SpiderGL.Utility.getDefaultValue(w,SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER),this._dsa.texParameteri(this._h,this._t,gl.TEXTURE_MAG_FILTER,e)},get minFilter(){return this._minFilter},set minFilter(e){e=SpiderGL.Utility.getDefaultValue(w,SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER),this._dsa.texParameteri(this._h,this._t,gl.TEXTURE_MIN_FILTER,e)},get wrapS(){return this._wrapS},set wrapS(e){e=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Texture.DEFAULT_WRAP_S),this._dsa.texParameteri(this._h,this._t,gl.TEXTURE_WRAP_S,e)},get wrapT(){return this._wrapT},set wrapT(e){e=SpiderGL.Utility.getDefaultValue(e,SpiderGL.WebGL.Texture.DEFAULT_WRAP_T),this._dsa.texParameteri(this._h,this._t,gl.TEXTURE_WRAP_T,e)},setSampler:function(e){var t,r,i,n;return!!e&&(t=this._gl,r=this._cb,this._dsa,i=this._t,n=this._h,r.pushTexture(i),t.bindTexture(i,n),n=0,"magFilter"in e&&(n=SpiderGL.Utility.getDefaultValue(e.magFilter,SpiderGL.WebGL.Texture.DEFAULT_MAG_FILTER),t.texParameteri(i,t.TEXTURE_MAG_FILTER,n)),"minFilter"in e&&(n=SpiderGL.Utility.getDefaultValue(e.minFilter,SpiderGL.WebGL.Texture.DEFAULT_MIN_FILTER),t.texParameteri(i,t.TEXTURE_MIN_FILTER,n)),"wrapS"in e&&(n=SpiderGL.Utility.getDefaultValue(e.wrapS,SpiderGL.WebGL.Texture.DEFAULT_WRAP_S),t.texParameteri(i,t.TEXTURE_WRAP_S,n)),"wrapT"in e&&(n=SpiderGL.Utility.getDefaultValue(e.wrapT,SpiderGL.WebGL.Texture.DEFAULT_WRAP_T),t.texParameteri(i,t.TEXTURE_WRAP_T,n)),r.popTexture(i),!0)},getSampler:function(){return{magFilter:this._magFilter,minFilter:this._minFilter,wrapS:this._wrapS,wrapT:this._wrapT}},generateMipmap:function(){0==this._missingFaces&&this._dsa.generateMipmap(this._h,this._t)},destroy:function(){this._gl.deleteTexture(this._h)},bind:function(e){var t=this._gl,r=(this._cb,this._dsa);void 0===e?t.bindTexture(this._t,this._h):r.bindTexture(t.TEXTURE0+e,this._t,this._h)},unbind:function(e){var t=this._gl,r=(this._cb,this._dsa);void 0===e?t.bindTexture(this._t,null):r.bindTexture(t.TEXTURE0+e,this._t,null)}},SpiderGL.Type.extend(SpiderGL.WebGL.Texture,SpiderGL.WebGL.ObjectGL),SpiderGL.WebGL.Texture2D=function(e,t){return SpiderGL.WebGL.Context.isHijacked(e)?(SpiderGL.WebGL.Texture.call(this,e,SpiderGL.WebGL.Texture2D.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this?this._h._spidergl:(SpiderGL.Type.instanceOf(t=t||{},WebGLTexture)?t={handle:t}:SpiderGL.Type.isString(t)&&(t={url:t}),void(("url"in t||"data"in t||"width"in t&&"height"in t)&&this.setImage(t)))):null},SpiderGL.WebGL.Texture2D.TARGET=WebGLRenderingContext.prototype.TEXTURE_2D,SpiderGL.WebGL.Texture2D.unbind=function(e,t){e.getExtension("SGL_current_binding");var r=e.getExtension("SGL_direct_state_access");void 0===t?e.bindTexture(SpiderGL.WebGL.Texture2D.TARGET,null):r.bindTexture(e.TEXTURE0+t,SpiderGL.WebGL.Texture2D.TARGET,null)},SpiderGL.WebGL.Texture2D.prototype={setImage:function(e){return this._setImage(this._t,e)},setSubImage:function(e){return this._setSubImage(this._t,e)}},SpiderGL.Type.extend(SpiderGL.WebGL.Texture2D,SpiderGL.WebGL.Texture),SpiderGL.WebGL.TextureCubeMap=function(e,t){if(!SpiderGL.WebGL.Context.isHijacked(e))return null;if(SpiderGL.WebGL.Texture.call(this,e,SpiderGL.WebGL.TextureCubeMap.TARGET,t),this._h&&this._h._spidergl&&this._h._spidergl!=this)return this._h._spidergl;t=t||{},SpiderGL.Type.instanceOf(t,WebGLTexture)?t={handle:t}:SpiderGL.Type.isString(t)&&(t={url:t});var r,i=SpiderGL.WebGL.TextureCubeMap._faceTargets;if(t.url){var n=t.url,a=t.onSuccess;a&&(t.onSuccess=(r=6,function(){0==--r&&a.apply(t,null)}));for(var s=0;s<6;++s)t.url=n[s],this.setImage(i[s],t);t.onSuccess=a}else if(t.data)for(var o=t.data,s=0;s<6;++s)t.data=o[s],this.setImage(i[s],t);else if(0<t.width&&0<t.height)for(s=0;s<6;++s)this.setImage(i[s],t)},SpiderGL.WebGL.TextureCubeMap.TARGET=WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP,SpiderGL.WebGL.TextureCubeMap.unbind=function(e,t){e.getExtension("SGL_current_binding");var r=e.getExtension("SGL_direct_state_access");void 0===t?e.bindTexture(SpiderGL.WebGL.TextureCubeMap.TARGET,null):r.bindTexture(e.TEXTURE0+t,SpiderGL.WebGL.TextureCubeMap.TARGET,null)},SpiderGL.WebGL.TextureCubeMap._faceTargets=[WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_X,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_X,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Y,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Y,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_POSITIVE_Z,WebGLRenderingContext.prototype.TEXTURE_CUBE_MAP_NEGATIVE_Z],SpiderGL.WebGL.TextureCubeMap.prototype={setImage:function(e,t){return this._setImage(e,t)},setSubImage:function(e,t){return this._setSubImage(e,t)}},SpiderGL.Type.extend(SpiderGL.WebGL.TextureCubeMap,SpiderGL.WebGL.Texture),SpiderGL.Model={},SpiderGL.Model.Model=function(e,t,r){SpiderGL.Core.ObjectBase.call(this),r=SpiderGL.Utility.getDefaultObject({},r),t&&"vertices"in t&&(t=SpiderGL.Model.Model._createSimpleDescriptor(t)),this._descriptor=SpiderGL.Model.Model._fixDescriptor(t),this._gl=null,this._renderData={},e&&(this.updateGL(e,r),this.updateRenderData())},SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_SIZE=3,SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE=SpiderGL.Type.FLOAT32,SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_NORMALIZED=!1,SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_STRIDE=0,SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_OFFSET=0,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_MODE=SpiderGL.Type.TRIANGLES,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_FIRST=0,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_COUNT=-1,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE=SpiderGL.Type.UINT16,SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_OFFSET=0,SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP={},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.position={size:3,type:SpiderGL.Type.FLOAT32,normalized:!1,semantic:"POSITION",index:0,value:[0,0,0,1]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.normal={size:3,type:SpiderGL.Type.FLOAT32,normalized:!1,semantic:"NORMAL",index:0,value:[0,0,1,0]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.color={size:4,type:SpiderGL.Type.UINT8,normalized:!0,semantic:"COLOR",index:0,value:[0,0,0,255]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.texcoord={size:2,type:SpiderGL.Type.FLOAT32,normalized:!1,semantic:"TEXCOORD",index:0,value:[0,0,0,1]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.user={size:3,type:SpiderGL.Type.FLOAT32,normalized:!1,semantic:"USER",index:0,value:[0,0,0,1]},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP={},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.triangles={mode:SpiderGL.Type.TRIANGLES,type:SpiderGL.Type.UINT16,count:-1,semantic:"FILL"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.triangleStrip={mode:SpiderGL.Type.TRIANGLE_STRIP,type:SpiderGL.Type.UINT16,count:-1,semantic:"FILL"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.triangleFan={mode:SpiderGL.Type.TRIANGLE_FAN,type:SpiderGL.Type.UINT16,count:-1,semantic:"FILL"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.lines={mode:SpiderGL.Type.LINES,type:SpiderGL.Type.UINT16,count:-1,semantic:"LINE"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.lineStrip={mode:SpiderGL.Type.LINE_STRIP,type:SpiderGL.Type.UINT16,count:-1,semantic:"LINE"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.lineLoop={mode:SpiderGL.Type.LINE_LOOP,type:SpiderGL.Type.UINT16,count:-1,semantic:"LINE"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.points={mode:SpiderGL.Type.POINTS,type:SpiderGL.Type.UINT16,count:-1,semantic:"POINT"},SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.user={mode:SpiderGL.Type.TRIANGLES,type:SpiderGL.Type.UINT16,count:-1,semantic:"FILL"},SpiderGL.Model.Model._fixDescriptor=function(e){return(e=SpiderGL.Utility.getDefaultObject({version:"0.0.0.1 EXP",meta:null,data:null,access:null,semantic:null,logic:null},e)).meta=SpiderGL.Model.Model._fixDescriptorMeta(e.meta),e.data=SpiderGL.Model.Model._fixDescriptorData(e.data),e.access=SpiderGL.Model.Model._fixDescriptorAccess(e.access),e.semantic=SpiderGL.Model.Model._fixDescriptorSemantic(e.semantic),e.logic=SpiderGL.Model.Model._fixDescriptorLogic(e.logic),e},SpiderGL.Model.Model._fixDescriptorMeta=function(e){return SpiderGL.Utility.getDefaultObject({author:null,date:null,description:null},e)},SpiderGL.Model.Model._fixDescriptorData=function(e){return(e=SpiderGL.Utility.getDefaultObject({vertexBuffers:null,indexBuffers:null},e)).vertexBuffers=SpiderGL.Model.Model._fixDescriptorDataVertexBuffers(e.vertexBuffers),e.indexBuffers=SpiderGL.Model.Model._fixDescriptorDataIndexBuffers(e.indexBuffers),e},SpiderGL.Model.Model._fixDescriptorDataVertexBuffers=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorDataVertexBuffer(e[t]);return e},SpiderGL.Model.Model._fixDescriptorDataVertexBuffer=function(e){return SpiderGL.Model.Model._fixDescriptorDataBuffer(e)},SpiderGL.Model.Model._fixDescriptorDataIndexBuffers=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorDataIndexBuffer(e[t]);return e},SpiderGL.Model.Model._fixDescriptorDataIndexBuffer=function(e){return SpiderGL.Model.Model._fixDescriptorDataBuffer(e)},SpiderGL.Model.Model._fixDescriptorDataBuffer=function(e){return SpiderGL.Utility.getDefaultObject({type:SpiderGL.Type.NO_TYPE,glType:WebGLRenderingContext.prototype.NONE,untypedArray:null,typedArray:null,glBuffer:null},e)},SpiderGL.Model.Model._fixDescriptorAccess=function(e){return(e=SpiderGL.Utility.getDefaultObject({vertexStreams:null,primitiveStreams:null},e)).vertexStreams=SpiderGL.Model.Model._fixDescriptorAccessVertexStreams(e.vertexStreams),e.primitiveStreams=SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStreams(e.primitiveStreams),e},SpiderGL.Model.Model._fixDescriptorAccessVertexStreams=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorAccessVertexStream(e[t]);return e},SpiderGL.Model.Model._fixDescriptorAccessVertexStream=function(e){return SpiderGL.Utility.getDefaultObject({buffer:null,size:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_SIZE,type:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE,glType:SpiderGL.Type.typeToGL(SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_TYPE),normalized:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_NORMALIZED,stride:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_STRIDE,offset:SpiderGL.Model.Model.DEFAULT_VERTEX_STREAM_OFFSET},e)},SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStreams=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStream(e[t]);return e},SpiderGL.Model.Model._fixDescriptorAccessPrimitiveStream=function(e){return SpiderGL.Utility.getDefaultObject({buffer:null,mode:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_MODE,first:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_FIRST,count:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_COUNT,type:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE,glType:SpiderGL.Type.typeToGL(SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_TYPE),offset:SpiderGL.Model.Model.DEFAULT_PRIMITIVE_STREAM_OFFSET},e)},SpiderGL.Model.Model._fixDescriptorSemantic=function(e){return(e=SpiderGL.Utility.getDefaultObject({bindings:null,chunks:null},e)).bindings=SpiderGL.Model.Model._fixDescriptorSemanticBindings(e.bindings),e.chunks=SpiderGL.Model.Model._fixDescriptorSemanticChunks(e.chunks),e},SpiderGL.Model.Model._fixDescriptorSemanticBindings=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorSemanticBinding(e[t]);return e},SpiderGL.Model.Model._fixDescriptorSemanticBinding=function(e){return(e=SpiderGL.Utility.getDefaultObject({vertexStreams:null,primitiveStreams:null},e)).vertexStreams=SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStreams(e.vertexStreams),e.primitiveStreams=SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStreams(e.primitiveStreams),e},SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStreams=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStream(e[t]);return e},SpiderGL.Model.Model._fixDescriptorSemanticBindingVertexStream=function(e){return e?SpiderGL.Type.isArray(e)?e.slice():[e]:null},SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStreams=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStream(e[t]);return e},SpiderGL.Model.Model._fixDescriptorSemanticBindingPrimitiveStream=function(e){return e?SpiderGL.Type.isArray(e)?e.slice():[e]:null},SpiderGL.Model.Model._fixDescriptorSemanticChunks=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorSemanticChunk(e[t]);return e},SpiderGL.Model.Model._fixDescriptorSemanticChunk=function(e){return(e=SpiderGL.Utility.getDefaultObject({techniques:null},e)).techniques=SpiderGL.Model.Model._fixDescriptorSemanticChunkTechniques(e.techniques),e},SpiderGL.Model.Model._fixDescriptorSemanticChunkTechniques=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorSemanticChunkTechnique(e[t]);return e},SpiderGL.Model.Model._fixDescriptorSemanticChunkTechnique=function(e){return SpiderGL.Utility.getDefaultObject({binding:null},e)},SpiderGL.Model.Model._fixDescriptorLogic=function(e){return(e=SpiderGL.Utility.getDefaultObject({parts:null},e)).parts=SpiderGL.Model.Model._fixDescriptorLogicParts(e.parts),e},SpiderGL.Model.Model._fixDescriptorLogicParts=function(e){for(var t in e=SpiderGL.Utility.getDefaultObject({},e))e[t]=SpiderGL.Model.Model._fixDescriptorLogicPart(e[t]);return e},SpiderGL.Model.Model._fixDescriptorLogicPart=function(e){return(e=SpiderGL.Utility.getDefaultObject({chunks:null},e)).chunks=SpiderGL.Model.Model._fixDescriptorLogicPartChunks(e.chunks),e},SpiderGL.Model.Model._fixDescriptorLogicPartChunks=function(e){return e?SpiderGL.Type.isArray(e)?e.slice():[e]:null},SpiderGL.Model.Model._createSimpleDescriptor=function(e){e=SpiderGL.Utility.getDefaultObject({vertices:null,primitives:null,options:null},e);var t={data:{vertexBuffers:{},indexBuffers:{}},access:{vertexStreams:{},primitiveStreams:{}},semantic:{bindings:{},chunks:{}},logic:{parts:{}}},r={vertexStreams:{},primitiveStreams:{}},i=(t.semantic.bindings.mainBinding=r,t.semantic.chunks.mainChunk={techniques:{common:{binding:"mainBinding"}}},-1),n=!(t.logic.parts.mainPart={chunks:["mainChunk"]}),a=!1;for(_ in e.vertices)if(c=e.vertices[_]){(SpiderGL.Type.isArray(c)||SpiderGL.Type.isTypedArray(c)||SpiderGL.Type.instanceOf(c,ArrayBuffer))&&(c={data:c});var s=null,s=(l=SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP[_])?l.semantic:(l=SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_VERTEX_MAP.user,_.toUpperCase()),o={buffer:null,size:(f=SpiderGL.Utility.getDefaultObject({size:l.size,type:l.type,normalized:l.normalized,semantic:s,index:l.index,data:null,value:l.value.slice()},c)).size,type:f.type,normalized:f.normalized,stride:0,offset:0,value:f.value.slice()};if(f.data){var u={type:f.type},d=0;if(SpiderGL.Type.isArray(f.data))u.untypedArray=f.data,d=u.untypedArray.length/o.size;else{if(!SpiderGL.Type.isTypedArray(c)&&!SpiderGL.Type.instanceOf(c,ArrayBuffer))continue;u.typedArray=f.data,d=(u.typedArray.byteLength-o.offset)/(o.size*SpiderGL.Type.typeSize(o.type))}var d=SpiderGL.Math.floor(d),n=!0,i=0<=i?SpiderGL.Math.min(i,d):d,p=_+"VertexBuffer";t.data.vertexBuffers[p]=u,o.buffer=p}else a=!0;var h=_;t.access.vertexStreams[h]=o,(L=new Array(f.index+1))[f.index]=h,r.vertexStreams[f.semantic]=L}var _,c,l,f,L,S=0,g=(n?S=i:a&&(S=1),e.primitives);if(SpiderGL.Type.isString(g)&&(g=[g]),SpiderGL.Type.isArray(g))for(var G=g,g={},m=0,T=G.length;m<T;++m){var M=G[m];SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[M]&&(g[M]={})}for(_ in g)if(c=g[_]){if((SpiderGL.Type.isArray(c)||SpiderGL.Type.isTypedArray(c)||SpiderGL.Type.instanceOf(c,ArrayBuffer))&&(c={data:c}),l=(l=SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP[_])||SpiderGL.Model.Model.DEFAULT_SIMPLE_MODEL_PRIMITIVE_MAP.user,o={buffer:null,mode:(f=SpiderGL.Utility.getDefaultObject({mode:l.mode,type:l.type,count:0<=l.count?l.count:S,semantic:l.semantic},c)).mode,first:0,count:f.count,type:f.type,offset:0},f.data){if(u={type:f.type},d=0,SpiderGL.Type.isArray(f.data))u.untypedArray=f.data,d=u.untypedArray.length;else{if(!SpiderGL.Type.isTypedArray(c)&&!SpiderGL.Type.instanceOf(c,ArrayBuffer))continue;u.typedArray=f.data,d=(u.typedArray.byteLength-o.offset)/SpiderGL.Type.typeSize(o.type)}d=SpiderGL.Math.floor(d),t.data.indexBuffers[p=_+"IndexBuffer"]=u,o.buffer=p,o.count=d}h=_,t.access.primitiveStreams[h]=o,(L=new Array(1))[0]=h,r.primitiveStreams[f.semantic]=L}return t},SpiderGL.Model.Model.prototype={get descriptor(){return this._descriptor},get isReady(){return!!this._descriptor},get gl(){return this._gl},get renderData(){return this._renderData},updateTypedArrays:function(){var e=this._descriptor;if(!e)return!1;var t=null,r=null,i=e.data.vertexBuffers;for(n in i)(t=i[n]).untypedArray&&(r=SpiderGL.Type.typeToTypedArrayConstructor(t.type),t.typedArray=new r(t.untypedArray));var n,a=e.data.indexBuffers;for(n in a)(t=a[n]).untypedArray&&(r=SpiderGL.Type.typeToTypedArrayConstructor(t.type),t.typedArray=new r(t.untypedArray));return!0},updateGL:function(e,t){if(!e)return!1;var r=this._descriptor;if(!r)return!1;this._gl=e;var i=null,n=null,a=SpiderGL.Utility.getDefaultObject({data:null,usage:SpiderGL.Core.DEFAULT},t);for(s in a.data=null,r.data.vertexBuffers)i=r.data.vertexBuffers[s],a.data=i.typedArray,a.data||(n=SpiderGL.Type.typeToTypedArrayConstructor(i.type),a.data=new n(i.untypedArray)),i.glBuffer&&(i.glBuffer.destroy(),i.glBuffer=null),i.glBuffer=new SpiderGL.WebGL.VertexBuffer(e,a);for(s in r.data.indexBuffers)i=r.data.indexBuffers[s],a.data=i.typedArray,a.data||(n=SpiderGL.Type.typeToTypedArrayConstructor(i.type),a.data=new n(i.untypedArray)),i.glBuffer&&(i.glBuffer.destroy(),i.glBuffer=null),i.glBuffer=new SpiderGL.WebGL.IndexBuffer(e,a);var s,o=null;for(s in r.access.vertexStreams)(o=r.access.vertexStreams[s]).glType=SpiderGL.Type.typeToGL(o.type);for(s in r.access.primitiveStreams)(o=r.access.primitiveStreams[s]).glMode=SpiderGL.Type.primitiveToGL(o.mode),o.glType=SpiderGL.Type.typeToGL(o.type);return!0},destroyGL:function(){var e=this._descriptor;if(!e)return!1;var t,r=null;for(t in e.data.vertexBuffers)(r=e.data.vertexBuffers[t]).glBuffer&&(r.glBuffer.destroy(),r.glBuffer=null);for(t in e.data.indexBuffers)(r=e.data.indexBuffers[t]).glBuffer&&(r.glBuffer.destroy(),r.glBuffer=null)},updateRenderData:function(){var e=this._descriptor;if(!e)return!1;var t,r={partMap:{}};for(t in e.logic.parts){var i=e.logic.parts[t].chunks,n={};r.partMap[t]=n;for(var a=0,s=i.length;a<s;++a){var o,u=i[a],d=e.semantic.chunks[u],p={},h=(n[u]=p,d.techniques);for(o in h){var _,c=h[o],l={vertexStreams:{buffered:[],constant:[]},primitiveStreams:{}},c=(p[o]=l,e.semantic.bindings[c.binding]),f=c.vertexStreams,L={};for(_ in f)for(var S=0,g=(M=f[_]).length;S<g;++S){var G=M[S],m={semantic:_,index:S,stream:x=e.access.vertexStreams[G]};((E=x.buffer)?(L[E]=L[E]||[],L[E]):l.vertexStreams.constant).push(m)}for(E in L){var T={buffer:e.data.vertexBuffers[E],streams:L[E].slice()};l.vertexStreams.buffered.push(T)}for(_ in f=c.primitiveStreams){var M,E,L={},b={buffered:[],array:[]};for(l.primitiveStreams[_]=b,S=0,g=(M=f[_]).length;S<g;++S){var x,G=M[S];((E=(x=e.access.primitiveStreams[G]).buffer)?(L[E]=L[E]||[],L[E]):b.array).push(x)}for(E in L)T={buffer:e.data.indexBuffers[E],streams:L[E].slice()},b.buffered.push(T)}}}}this._renderData=r}},SpiderGL.Type.extend(SpiderGL.Model.Model,SpiderGL.Core.ObjectBase),SpiderGL.Model.Technique=function(e,t,r){SpiderGL.Core.ObjectBase.call(this),r=SpiderGL.Utility.getDefaultObject({},r),t&&"vertexShader"in t&&"fragmentShader"in t&&(t=SpiderGL.Model.Technique._createSimpleDescriptor(e,t)),this._descriptor=SpiderGL.Model.Technique._fixDescriptor(t),this._gl=this._descriptor.program.gl,this._renderData={},e&&this.updateRenderData()},SpiderGL.Model.Technique._fixDescriptor=function(e){return(e=SpiderGL.Utility.getDefaultObject({name:"common",program:null,semantic:{}},e)).vertexStreams&&(e.semantic.vertexStreams=e.vertexStreams,delete e.vertexStreams),e.globals&&(e.semantic.globals=e.globals,delete e.globals),e.semantic=SpiderGL.Model.Technique._fixSemantic(e.program,e.semantic),e},SpiderGL.Model.Technique._fixSemantic=function(e,t){return(t=SpiderGL.Utility.getDefaultObject({vertexStreams:null,globals:null},t)).vertexStreams=SpiderGL.Model.Technique._fixVertexStreams(e,t.vertexStreams),t.globals=SpiderGL.Model.Technique._fixGlobals(e,t.globals),t},SpiderGL.Model.Technique._fixVertexStreams=function(e,t){for(var r=e.getAttributesNames(),i={},n=0,a=r.length;n<a;++n){for(var s=r[n],o="",u="",d=s.length-1;0<=d;--d){var p=s.charAt(d);if(-1=="0123456789".indexOf(p,0)){o=s.substring(0,d+1);break}u=p+u}var h=0<u.length?parseInt(u):0,_=o.length,_=(2<=_&&"a"==o.charAt(0)&&("_"==(p=o.charAt(1))&&2<_?o=o.substring(2):p==o.charAt(1).toUpperCase()&&(o=o.substring(1))),o.toUpperCase());i[s]={semantic:_,index:h,value:[0,0,0,1]}}var c,l={};for(c in t){var f,L=i[c];L&&(f=t[c],SpiderGL.Type.isString(f)?f={semantic:f}:SpiderGL.Type.isArray(f)||SpiderGL.Type.isTypedArray(f)?f={value:f}:SpiderGL.Type.isNumber(f)&&(f={value:[f,f,f,f]}),l[c]=SpiderGL.Utility.getDefaultObject({semantic:L.semantic,index:L.index,value:L.value},f))}return SpiderGL.Utility.getDefaultObject(i,l)},SpiderGL.Model.Technique._fixGlobals=function(e,t){var r,i=e.getUniformsValues(),n={};for(r in i){var a,s=r,o=s.length,o=(2<=o&&"u"==s.charAt(0)&&("_"==(a=s.charAt(1))&&2<o?s=s.substring(2):a==s.charAt(1).toUpperCase()&&(s=s.substring(1))),s.toUpperCase());n[r]={semantic:o,value:i[r]}}return SpiderGL.Utility.getDefaultObject(n,t)},SpiderGL.Model.Technique._createSimpleDescriptor=function(e,t){(t=SpiderGL.Utility.getDefaultObject({name:"common",vertexShader:null,fragmentShader:null,attributes:null,uniforms:null,semantic:{},vertexStreams:null,globals:null,options:null},t)).vertexStreams&&(t.semantic.vertexStreams=t.vertexStreams,delete t.vertexStreams),t.globals&&(t.semantic.globals=t.globals,delete t.globals);var r={name:t.name,program:null,semantic:t.semantic};if(e){var i=t.vertexShader,n=t.fragmentShader;if(i&&n){if(SpiderGL.Type.isString(i))i=new SpiderGL.WebGL.VertexShader(e,i);else if(!SpiderGL.Type.instanceOf(i,SpiderGL.WebGL.VertexShader))return r;if(SpiderGL.Type.isString(n))n=new SpiderGL.WebGL.FragmentShader(e,n);else if(!SpiderGL.Type.instanceOf(n,SpiderGL.WebGL.FragmentShader))return r;e=new SpiderGL.WebGL.Program(e,{shaders:[i,n],attributes:t.attributes,uniforms:t.uniforms});r.program=e}}return r},SpiderGL.Model.Technique.prototype={get descriptor(){return this._descriptor},get isReady(){return!!this._descriptor},get gl(){return this._gl},get name(){return this._descriptor.name},get renderData(){return this._renderData},get program(){return this._descriptor.program},setUniforms:function(e){this._descriptor.program.setUniforms(e)},updateRenderData:function(){var e,t=this._descriptor,r={},i={},n=((this._renderData=r).attributesMap=i,t.program.getAttributesIndices());for(e in t.semantic.vertexStreams){var a=(u=t.semantic.vertexStreams[e]).semantic,s=i[a];s||(i[a]=s=[]),s[u.index]={index:n[e],value:u.value}}var o,u,d={};for(o in r.globalsMap=d,t.semantic.globals)d[(u=t.semantic.globals[o]).semantic]={name:o,value:u.value}}},SpiderGL.Model.ModelRenderer=function(e){this._gl=e,this._vertexAttributesCount=e.getParameter(e.MAX_VERTEX_ATTRIBS),this._textureUnitsCount=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._internalFramebuffer=new SpiderGL.WebGL.Framebuffer(e),this._reset()},SpiderGL.Model.ModelRenderer.prototype={_reset:function(){this._technique=null,this._model=null,this._partName=null,this._chunkName=null,this._primMode=null,this._framebuffer=null,this._inBegin=!1,this._enabledArrays=[],this._boundTextures=[],this._attribValues=[],this._primitiveStreams=[],this._techniqueDirty=!0,this._modelDirty=!0,this._modelPartDirty=!0,this._modelChunkDirty=!0,this._primModeDirty=!0,this._framebufferDirty=!0,this._viewportDirty=!0,this._dirty=!0},_resetContext:function(){for(var e=this._gl,t=0,r=this._vertexAttributesCount;t<r;++t)e.disableVertexAttribArray(t);for(t=this._textureUnitsCount-1;0<=t;--t)e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null);SpiderGL.WebGL.VertexBuffer.unbind(e),SpiderGL.WebGL.IndexBuffer.unbind(e),SpiderGL.WebGL.Program.unbind(e),SpiderGL.WebGL.Framebuffer.unbind(e)},_update:function(){if(this._dirty){var e=this._gl;if(this._techniqueDirty){if(!(d=this._technique))return!1;var t,r=(p=d.renderData).attributesMap,i=[];for(t in r){var n=r[t];for(h in n){var a=n[h],s=null;a&&(s={index:a.index,value:a.value}),i.push(s)}}this._attribValues=i,d.program.bind(),this._techniqueDirty=!1}if(this._modelDirty){var o=this._model;if(!o)return!1;h=0;for(var u=(i=this._attribValues).length;h<u;++h)if(s=i[h])switch(s.value.length){case 1:e.vertexAttrib1fv(s.index,s.value);break;case 2:e.vertexAttrib2fv(s.index,s.value);break;case 3:e.vertexAttrib3fv(s.index,s.value);break;default:e.vertexAttrib4fv(s.index,s.value)}var d,o=o.renderData;if(!(d=this._technique))return!1;if(!(p=d.renderData))return!1;if(r=p.attributesMap,this._modelPartDirty){if(!this._partName)return!1;this._modelPartDirty=!1}if(this._modelChunkDirty){var p=this._chunkName;if(!p)return!1;if(!(M=o.partMap[this._partName]))return!1;if(!(E=M[p]))return!1;if(!(b=(b=E[d.name])||E.common))return!1;for(var h=0,u=(l=this._enabledArrays).length;h<u;++h)e.disableVertexAttribArray(l[h]);var _,c,l=[],f=b.vertexStreams.buffered;for(h=0,u=f.length;h<u;++h){var L=f[h],S=L.buffer.glBuffer;S.bind();for(var g=0,G=(_=L.streams).length;g<G;++g)r[(c=_[g]).semantic]&&r[c.semantic][c.index]&&(T=r[c.semantic][c.index].index,(m=c.stream).index=T,l.push(T),S.vertexAttribPointer(m))}for(this._enabledArrays=l,g=0,u=(_=b.vertexStreams.constant).length;g<u;++g)if(r[(c=_[g]).semantic]&&r[c.semantic][c.index]){var m,T=r[c.semantic][c.index].index;switch((m=c.stream).value.length){case 1:e.vertexAttrib1fv(T,m.value);break;case 2:e.vertexAttrib2fv(T,m.value);break;case 3:e.vertexAttrib3fv(T,m.value);break;default:e.vertexAttrib4fv(T,m.value)}}this._modelChunkDirty=!1}if(this._primModeDirty){var M,E,b,p=this._primMode;if(!p)return!1;if(!(M=o.partMap[this._partName]))return!1;if(!(E=M[this._chunkName]))return!1;if(!(b=(b=E[d.name])||E.common))return!1;o=b.primitiveStreams[p];if(!o)return!1;this._primitiveStreams=o,this._primModeDirty=!1}this._modelDirty=!1}this._framebufferDirty&&(this._framebuffer?this._framebuffer.bind():SpiderGL.WebGL.Framebuffer.unbind(e),this._framebufferDirty=!1),this._viewportDirty&&(this._framebuffer&&this._framebuffer.autoViewport&&this._framebuffer.applyViewport(),this._viewportDirty=!1),this._dirty=!1}return!0},get gl(){return this._gl},get isValid(){return!!this._gl},destroy:function(){this.end(),this._internalFramebuffer.destroy(),this._internalFramebuffer=null,this._gl=null},begin:function(){this._inBegin||(this._resetContext(),this._inBegin=!0)},end:function(){if(this._inBegin){this._inBegin=!1;for(var e=this._gl,t=this._enabledArrays,r=0,i=t.length;r<i;++r)e.disableVertexAttribArray(t[r]);for(var n=this._boundTextures,r=0,i=n.length;r<i;++r){var a=n[r];a&&(a.target==e.TEXTURE_2D?SpiderGL.WebGL.Texture2D.unbind(e,a.unit):a.target==e.TEXTURE_CUBE_MAP&&SpiderGL.WebGL.TextureCubeMap.unbind(e,a.unit))}this._framebuffer&&SpiderGL.WebGL.Framebuffer.unbind(this._gl),this._internalFramebuffer.detachAll(),this._reset(),this._resetContext()}},get isInBegin(){return this._inBegin},setTechnique:function(e){this._inBegin&&this._technique!=e&&(this._technique=e,this._techniqueDirty=!0,this._dirty=!0,e||SpiderGL.WebGL.Program.unbind(this._gl))},get technique(){return this._technique},setModel:function(e){this._inBegin&&this._model!=e&&(this._model=e,this._modelDirty=!0,this._modelPartDirty=!0,this._modelChunkDirty=!0,this._dirty=!0)},get model(){return this._model},setPart:function(e){this._inBegin&&this._part!=e&&(this._partName=e,this._modelPartDirty=!0,this._modelDirty=!0,this._dirty=!0)},get part(){return this._partName},setChunk:function(e){this._inBegin&&this._chunk!=e&&(this._chunkName=e,this._modelDirty=!0,this._modelChunkDirty=!0,this._primModeDirty=!0,this._dirty=!0)},get chunk(){return this._chunkName},setPrimitiveMode:function(e){this._inBegin&&this._primMode!=e&&(this._primMode=e,this._primModeDirty=!0,this._modelDirty=!0,this._dirty=!0)},get primitiveMode(){return this._primMode},setUniforms:function(e){this._inBegin&&this._technique&&this._technique.program.setUniforms(e)},setDefaultGlobals:function(){if(this._inBegin){var e=this._technique;if(e){var t,r=e.renderData.globalsMap,i={};for(t in r){var n=r[t].name,a=r[t].value;i[n]=a}e.program.setUniforms(i)}}},setGlobals:function(e){if(this._inBegin&&e){var t=this._technique;if(t){var r,i,n,a=t.renderData.globalsMap,s={};for(r in e)a[r]&&(i=a[r].name,n=e[r],s[i]=n);t.program.setUniforms(s)}}},setFramebuffer:function(e){this._inBegin&&this._framebuffer!=e&&(this._framebuffer=e,this._framebufferDirty=!0,this._viewportDirty=!0,this._dirty=!0,e?e.bind():SpiderGL.WebGL.Framebuffer.unbind(this._gl))},activateOffScreenFramebuffer:function(){this.setFramebuffer(this._internalFramebuffer)},activateMainFramebuffer:function(){return this.setFramebuffer(null)},setFramebufferAttachments:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.setAttachments(e),this._framebufferDirty=!0,this._viewportDirty=!0)},setColorRenderTarget:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.colorTarget=e,this._viewportDirty=!0,this._dirty=!0)},setDepthRenderTarget:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.depthTarget=e,this._viewportDirty=!0,this._dirty=!0)},setStencilRenderTarget:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.stencilTarget=e,this._viewportDirty=!0,this._dirty=!0)},setDepthStencilRenderTarget:function(e){this._inBegin&&this._framebuffer&&(this._framebuffer.depthStencilTarget=e,this._viewportDirty=!0,this._dirty=!0)},clearFramebuffer:function(e){var t,r,i;this._inBegin&&e&&(t=this._gl,r=0,SpiderGL.Type.isNumber(e)?r=e:("color"in e&&((i=e.color)&&t.clearColor(i[0],i[1],i[2],i[3]),r|=t.COLOR_BUFFER_BIT),"depth"in e&&(i=e.depth,SpiderGL.Type.isNumber(i)&&t.clearDepth(i),r|=t.DEPTH_BUFFER_BIT),"stencil"in e&&(i=e.stencil,SpiderGL.Type.isNumber(i)&&t.clearStencil(i),r|=t.Stencil_BUFFER_BIT)),r)&&(this._framebuffer||t).clear(r)},setViewport:function(e,t,r,i){this._inBegin&&this._gl.viewport(e,t,r,i)},setTexture:function(e,t){t?t.bind(e):(t=this._gl,SpiderGL.WebGL.Texture2D.unbind(t,e),SpiderGL.WebGL.TextureCubeMap.unbind(t,e))},get canRender(){return!!(this._inBegin&&this._technique&&this._model&&this._partName&&this._chunkName&&this._primMode)},render:function(){if(this.canRender&&this._update()){for(var e=this._gl,t=this._primitiveStreams,r=t.buffered,i=t.array,n=0,a=r.length;n<a;++n){var s=r[n],o=s.buffer.glBuffer;o.bind();for(var u=s.streams,d=0,p=u.length;d<p;++d){var h=u[d];o.drawElements(h)}}for(d=0,a=i.length;d<a;++d)h=i[d],e.drawArrays(h.glMode,h.first,h.count)}},renderModelPart:function(e){var t,r=this.model.descriptor.logic.parts[e];for(t in this.setPart(e),r.chunks){var i=r.chunks[t];this.setChunk(i),this.render()}},renderModel:function(){var e,t=this.model.descriptor.logic.parts;for(e in t){var r,i=t[e];for(r in this.setPart(e),i.chunks){var n=i.chunks[r];this.setChunk(n),this.render()}}}},SpiderGL.UserInterface={},SpiderGL.UserInterface.CanvasHandler=function(e,t,r){SpiderGL.Core.ObjectBase.call(this),r=r||{};var i=this,n=e.canvas,t=(this._gl=e,this._canvas=n,this._handler=t,this._ignoreKeyRepeat=SpiderGL.Utility.getDefaultValue(r.ignoreKeyRepeat,SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT),this._keysDown={},this._mouseButtonsDown=[!1,!1,!1],this._dragging=[!1,!1,!1],this._dragStartPos=[[0,0],[0,0],[0,0]],this._dragEndPos=[[0,0],[0,0],[0,0]],this._dragDeltaPos=[[0,0],[0,0],[0,0]],this._cursorPos=[0,0,!0,0],this._cursorPrevPos=[0,0,!0,0],this._cursorDeltaPos=[0,0],this._cursorDeltaTime=0,this._cursorIncrPos=0,this._cursorIncrTime=0,this._clickPos=[0,0,!0,0],this._clickPrevPos=[0,0,!0,0],this._touches=[],this._touchZoomDelta=0,this._touchPanResolved=!1,this._drawEventPending=!1,this._drawEventHandler=function(){i._onDraw()},this._postDrawEventFunction=function(){i._postDrawEvent()},this._animateTime=Date.now(),this._animatePrevTime=this._animateTime,this._animateDeltaTime=0,this._animateRate=0,this._animateID=null,this._animateEventHandler=function(){i._onAnimate()},this._animateMS=-1,this._animateWithTimeout=!1,this._fastAnimate=!1,this._fpsUpdateMS=1e3,this._fpsTime=0,this._fpsCount=0,this._fps=0,this._delegateDraw=function(e){i._onDraw(e)},window.addEventListener("message",function(e){e.source==window&&(e.data==SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME?(e.stopPropagation(),i._onAnimate()):e.data==SpiderGL.UserInterface.CanvasHandler._FAST_DRAW_MESSAGE_NAME&&(e.stopPropagation(),i._onDraw()))},!0),n.tabIndex=0,n.addEventListener("unload",function(e){i._onTerminate(e)},!1),n.addEventListener("keydown",function(e){i._onKeyDown(e)},!1),n.addEventListener("keyup",function(e){i._onKeyUp(e)},!1),n.addEventListener("keypress",function(e){i._onKeyPress(e)},!1),n.addEventListener("mousedown",function(e){i._onMouseButtonDown(e)},!1),n.addEventListener("mouseup",function(e){i._onMouseButtonUp(e)},!1),n.addEventListener("mousemove",function(e){i._onMouseMove(e)},!1),n.addEventListener("mouseout",function(e){i._onMouseOut(e)},!1),n.addEventListener("click",function(e){i._onClick(e)},!1),n.addEventListener("dblclick",function(e){i._onDoubleClick(e)},!1),n.addEventListener("resize",function(e){i._onResize(e)},!1),n.addEventListener("DOMMouseScroll",function(e){i._onMouseWheel(e)},!1),n.addEventListener("mousewheel",function(e){i._onMouseWheel(e)},!1),n.addEventListener("blur",function(e){i._onBlur(e)},!1),new SglBrowser);t.isIE||t.isEdge?(n.addEventListener("pointerdown",function(e){"touch"==e.pointerType&&i._onTouchStart(e)},!1),n.addEventListener("pointerup",function(e){"touch"==e.pointerType&&i._onTouchEnd(e)},!1),n.addEventListener("pointermove",function(e){"touch"==e.pointerType&&i._onTouchMove(e)},!1),window.addEventListener("pointerup",function(e){"touch"==e.pointerType&&i._onTouchEnd(e)},!1),window.addEventListener("pointermove",function(e){"touch"==e.pointerType&&i._onTouchMove(e)},!1)):(n.addEventListener("touchstart",function(e){i._onTouchStart(e)},!1),n.addEventListener("touchend",function(e){i._onTouchEnd(e)},!1),n.addEventListener("touchmove",function(e){i._onTouchMove(e)},!1)),window.addEventListener("mouseup",function(e){i._onWindowMouseButtonUp(e)},!1),window.addEventListener("mousemove",function(e){i._onWindowMouseMove(e)},!1),window.addEventListener("resize",function(e){i._onWindowResize(e)},!1),SpiderGL.Utility.getDefaultValue(r.standardGLUnpack,SpiderGL.UserInterface.CanvasHandler.DEFAULT_STANDARD_GL_UNPACK)&&SpiderGL.WebGL.Context.setStandardGLUnpack(e),this.animateRate=SpiderGL.Utility.getDefaultValue(r.animateRate,SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE)},SpiderGL.UserInterface.CanvasHandler._FAST_DRAW_MESSAGE_NAME="spidergl-fast-draw-message",SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME="spidergl-fast-animate-message",SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE=0,SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT=!0,SpiderGL.UserInterface.CanvasHandler.DEFAULT_STANDARD_GL_UNPACK=!0,SpiderGL.UserInterface.CanvasHandler.DEFAULT_PROPERTY_NAME="ui",SpiderGL.UserInterface.CanvasHandler.prototype={_firstNotify:function(){this._onInitialize(),0<this._animateRate&&this._onAnimate(),this.postDrawEvent()},_dispatch:function(){var e,t=this._handler,r=t[arguments[0]];r&&(e=Array.prototype.slice.call(arguments,1),r.apply(t,e))},_postDrawEvent:function(){this._postDrawCount=5,this._drawEventPending||(this._drawEventPending=!0,requestAnimationFrame(this._delegateDraw))},_getMouseClientPos:function(e){var t,r=this._canvas.getBoundingClientRect(),i=this._canvas.width,n=this._canvas.height;return[t=e.changedTouches?e.changedTouches[0].clientX-r.left:e.clientX-r.left,r=e.changedTouches?n-(e.changedTouches[0].clientY-r.top):n-(e.clientY-r.top),t<0||i<=t||r<0||n<=r,e.timeStamp]},_onInitialize:function(){this._dispatch("onInitialize")},_onTerminate:function(){this._dispatch("onTerminate")},_onBlur:function(e){this._gl;var t,r=this._keysDown;for(t in r)r[t]&&(r[t]=!1,this._dispatch("onKeyUp",t,null))},_onKeyDown:function(e){var t=e.keyCode,r=(48<=t&&t<=90&&(t=String.fromCharCode(t).toUpperCase()),this._keysDown[t]);this._keysDown[t]=!0,r&&this._ignoreKeyRepeat||this._dispatch("onKeyDown",t,e)},_onKeyUp:function(e){var t=e.keyCode;48<=t&&t<=90&&(t=String.fromCharCode(t).toUpperCase()),this._keysDown[t]=!1,this._dispatch("onKeyUp",t,e)},_onKeyPress:function(e){var t=e.keyCode;48<=t&&t<=90&&(t=String.fromCharCode(t).toUpperCase()),this._dispatch("onKeyPress",t,e)},_onTouchStart:function(e){var t;if(this._canvas.focus(),e.changedTouches)t=e.targetTouches;else{var r={id:e.pointerId,evt:e};for(i=0;i<this._touches.length;i++)if(this._touches[i].id==r.id)return e.preventDefault&&e.preventDefault(),void e.stopPropagation();this._touches.push(r),t=this._touches}1==t.length&&(t=this._getMouseClientPos(e),this._cursorPos=t,n=e.button||0,this._mouseButtonsDown[n]=!0,this._dragStartPos[n]=[t[0],t[1]],this._dispatch("onMouseButtonDown",n,t[0],t[1],e));var n=new SglBrowser;(n.isIE||n.isEdge)&&e.preventDefault&&e.preventDefault(),e.stopPropagation()},_onTouchEnd:function(e){var t,r;if(e.changedTouches)r=e.targetTouches;else{var n=!1;for(i=0;i<this._touches.length;i++)if(this._touches[i].id==e.pointerId){this._touches.splice(i,1),n=!0;break}if(!n)return e.preventDefault&&e.preventDefault(),void e.stopPropagation();r=this._touches}0==r.length&&(r=this._getMouseClientPos(e),this._cursorPos=r,t=e.button||0,this._dispatch("onMouseButtonUp",t,r[0],r[1],e),this._mouseButtonsDown[1]&&(t=1),this._mouseButtonsDown=[!1,!1,!1],this._dragging[t]&&(this._dragging[t]=!1,a=this._dragStartPos[t],r=[r[0],r[1]],this._dragEndPos[t]=r,this._dragDeltaPos[t]=[r[0]-a[0],r[1]-a[1]],this._dispatch("onDragEnd",t,r[0],r[1])),this._touchPanResolved=!1,this._cursorIncrPos=this._cursorIncrTime=0);var a=new SglBrowser;(a.isIE||a.isEdge)&&e.preventDefault&&e.preventDefault(),e.stopPropagation()},_onTouchMove:function(e){var t;if(e.changedTouches)t=e.targetTouches;else{for(var r=!1,i=0;i<Math.min(this._touches.length,2);i++)if(this._touches[i].id==e.pointerId){this._touches[i].evt=e,r=!0;break}if(!r)return e.preventDefault&&e.preventDefault(),void e.stopPropagation();t=this._touches}if(1<t.length&&this._resolveTouchZoom(e),1==t.length){this._cursorPrevPos=this._cursorPos;var n=this._getMouseClientPos(e);if(this._cursorPos=n,this._cursorDeltaPos=[this._cursorPos[0]-this._cursorPrevPos[0],this._cursorPos[1]-this._cursorPrevPos[1]],this._cursorDeltaTime=this._cursorPos[3]-this._cursorPrevPos[3],0<this._cursorDeltaPos[0]?this._cursorDeltaPos[0]=Math.floor(this._cursorDeltaPos[0]):this._cursorDeltaPos[0]=Math.ceil(this._cursorDeltaPos[0]),0<this._cursorDeltaPos[1]?this._cursorDeltaPos[1]=Math.floor(this._cursorDeltaPos[1]):this._cursorDeltaPos[1]=Math.ceil(this._cursorDeltaPos[1]),this._touchPanResolved||(this._cursorIncrPos+=SpiderGL.Math.Vec2.length(this._cursorDeltaPos),this._cursorIncrTime+=this._cursorDeltaTime,this._resolveTouchPan(e)),0!=this._cursorDeltaPos[0]||0!=this._cursorDeltaPos[1]){for(var a,s,i=0;i<3;++i)this._mouseButtonsDown[i]&&(a=this._dragStartPos[i],s=[n[0],n[1]],this._dragEndPos[i]=s,this._dragDeltaPos[i]=[s[0]-a[0],s[1]-a[1]],this._dragging[i]?this._dispatch("onDrag",i,s[0],s[1]):(this._dragging[i]=!0,this._dispatch("onDragStart",i,a[0],a[1])));this._dispatch("onMouseMove",n[0],n[1],e)}}e.preventDefault&&e.preventDefault(),e.stopPropagation()},_resolveTouchZoom:function(e){var e=e.changedTouches?e.targetTouches:[this._touches[0].evt,this._touches[1].evt],e=Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2)),t=e-this._touchZoomDelta;this._touchZoomDelta=e,-.995<t&&t<.995||this._dispatch("onMouseWheel",0<t?1:-1)},_resolveTouchPan:function(e){var t=25,r=new SglBrowser;if((r.isIE||r.isEdge)&&(t=5),this._cursorIncrPos<t){if(this._cursorIncrTime<500)return;this._mouseButtonsDown[0]=!1,this._dragging[0]&&(this._dragging[0]=!1,r=this._dragStartPos[0],t=[this._cursorPos[0],this._cursorPos[1]],this._dragEndPos[0]=t,this._dragDeltaPos[0]=[t[0]-r[0],t[1]-r[1]],this._dispatch("onDragEnd",0,t[0],t[1])),this._mouseButtonsDown[1]=!0,this._dragStartPos[1]=[this._cursorPos[0],this._cursorPos[1]]}this._touchPanResolved=!0},_onMouseButtonDown:function(e){this._canvas.focus();var t=this._getMouseClientPos(e),r=(this._cursorPos=t,e.button);this._mouseButtonsDown[r]=!0,this._dragStartPos[r]=[t[0],t[1]],this._dispatch("onMouseButtonDown",r,t[0],t[1],e),e.stopPropagation()},_onMouseButtonUp:function(e){var t,r=this._getMouseClientPos(e),i=(this._cursorPos=r,e.button);this._mouseButtonsDown[i]=!1,this._dispatch("onMouseButtonUp",i,r[0],r[1],e),this._dragging[i]&&(this._dragging[i]=!1,t=this._dragStartPos[i],r=[r[0],r[1]],this._dragEndPos[i]=r,this._dragDeltaPos[i]=[r[0]-t[0],r[1]-t[1]],this._dispatch("onDragEnd",i,r[0],r[1])),e.stopPropagation()},_onWindowMouseButtonUp:function(e){var t,r=this._getMouseClientPos(e),i=(this._cursorPos=r,e.button);this._mouseButtonsDown[i]&&(this._mouseButtonsDown[i]=!1,this._dispatch("onMouseButtonUp",i,r[0],r[1],e),this._dragging[i]&&(this._dragging[i]=!1,t=this._dragStartPos[i],r=[r[0],r[1]],this._dragEndPos[i]=r,this._dragDeltaPos[i]=[r[0]-t[0],r[1]-t[1]],this._dispatch("onDragEnd",i,r[0],r[1])),e.stopPropagation())},_onMouseMove:function(e){this._cursorPrevPos=this._cursorPos;var t=this._getMouseClientPos(e);if(this._cursorPos=t,this._cursorDeltaPos=[this._cursorPos[0]-this._cursorPrevPos[0],this._cursorPos[1]-this._cursorPrevPos[1]],0!=this._cursorDeltaPos[0]||0!=this._cursorDeltaPos[1]){for(var r,i,n=0;n<3;++n)this._mouseButtonsDown[n]&&(r=this._dragStartPos[n],i=[t[0],t[1]],this._dragEndPos[n]=i,this._dragDeltaPos[n]=[i[0]-r[0],i[1]-r[1]],this._dragging[n]?this._dispatch("onDrag",n,i[0],i[1]):(this._dragging[n]=!0,this._dispatch("onDragStart",n,r[0],r[1])));this._dispatch("onMouseMove",t[0],t[1],e)}e.stopPropagation()},_onWindowMouseMove:function(e){this._cursorPrevPos=this._cursorPos;var t=this._getMouseClientPos(e);if(this._cursorPos=t,this._cursorDeltaPos=[this._cursorPos[0]-this._cursorPrevPos[0],this._cursorPos[1]-this._cursorPrevPos[1]],0!=this._cursorDeltaPos[0]||0!=this._cursorDeltaPos[1]){for(var r,i,n=0;n<3;++n)this._dragging[n]&&(r=this._dragStartPos[n],i=[t[0],t[1]],this._dragEndPos[n]=i,this._dragDeltaPos[n]=[i[0]-r[0],i[1]-r[1]],this._dispatch("onDrag",n,i[0],i[1]));t[2]||this._dispatch("onMouseMove",t[0],t[1],e)}e.stopPropagation()},_onWindowResize:function(e){this._mouseButtonsDown[0]?t=0:this._mouseButtonsDown[1]&&(t=1),this._touches.pop();var t,r,i=this._cursorPos;this._mouseButtonsDown=[!1,!1,!1],this._dispatch("onMouseButtonUp",t,i[0],i[1],e),this._dragging[t]&&(this._dragging[t]=!1,r=this._dragStartPos[t],i=[i[0],i[1]],this._dragEndPos[t]=i,this._dragDeltaPos[t]=[i[0]-r[0],i[1]-r[1]],this._dispatch("onDragEnd",t,i[0],i[1])),this._touchPanResolved=!1,this._cursorIncrPos=this._cursorIncrTime=0,e.stopPropagation()},_onMouseWheel:function(e){var t=this._getMouseClientPos(e),r=0;(e=e||window.event).wheelDelta?r=e.wheelDelta/120:e.detail&&(r=-e.detail/3),r&&this._dispatch("onMouseWheel",r,t[0],t[1],e),e.preventDefault&&e.preventDefault(),e.stopPropagation()},_onMouseOut:function(e){var t=this._getMouseClientPos(e);this._cursorPos=t,this._dispatch("onMouseOut",t[0],t[1],e)},_onClick:function(e){var t=this._getMouseClientPos(e);this._dispatch("onClick",e.button,t[0],t[1],e)},_onDoubleClick:function(e){var t=this._getMouseClientPos(e);this._dispatch("onDoubleClick",e.button,t[0],t[1],e)},_onResize:function(e){this._dispatch("onResize",this._canvas.width,this._canvas.height,e)},_onAnimate:function(){this._animatePrevTime=this._animateTime,this._animateTime=Date.now(),this._animateDeltaTime=this._animateTime-this._animatePrevTime,this._dispatch("onAnimate",this._animateDeltaTime/1e3),0<=this._animateMS?this._animateWithTimeout&&setTimeout(this._animateEventHandler,this._animateMS):this._fastAnimate&&window.postMessage(SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME,"*")},_onDraw:function(e){var t;this._drawEventPending=!1,this._fpsTime&&5!=this.postDrawCount?(this._fpsCount++,t=e-this._fpsTime,this._fps=.8*this._fps+1e3/t*.2):this._fpsCount=0,this._fpsTime=e,this._dispatch("onDraw"),0<this._postDrawCount--&&(this._drawEventPending=!0,requestAnimationFrame(this._delegateDraw))},get gl(){return this._gl},get canvas(){return this._canvas},get width(){return this._canvas.width},get height(){return this._canvas.height},get postDrawEvent(){return this._postDrawEventFunction},get animateTime(){return this._animateTime},get animatePrevTime(){return this._animatePrevTime},get animateDeltaTime(){return this._animateDeltaTime},get animateRate(){return this._animateRate},set animateRate(e){e=SpiderGL.Utility.getDefaultValue(e,SpiderGL.UserInterface.CanvasHandler.DEFAULT_ANIMATE_RATE),this._animateRate!==e&&(this._fastAnimate=!1,this._animateMS=-1,this._animateTime=Date.now(),this._animatePrevTime=this._animateTime,this._animateDeltaTime=0,this._animateID&&(clearInterval(this._animateID),this._animateID=null),0<(this._animateRate=e)?(this._animateMS=SpiderGL.Math.floor(1e3/e),this._animateWithTimeout?setTimeout(this._animateEventHandler,this._animateMS):this._animateID=setInterval(this._animateEventHandler,this._animateMS)):e<0&&(this._fastAnimate=!0,window.postMessage(SpiderGL.UserInterface.CanvasHandler._FAST_ANIMATE_MESSAGE_NAME,"*")))},get framesPerSecond(){return this._fps},get ignoreKeyRepeat(){return this._ignoreKeyRepeat},set ignoreKeyRepeat(e){this._ignoreKeyRepeat=SpiderGL.Utility.getDefaultValue(e,SpiderGL.UserInterface.CanvasHandler.DEFAULT_IGNORE_KEY_REPEAT)},isKeyDown:function(e){return e.toUpperCase&&(e=e.toUpperCase()),this._keysDown[e]},isMouseButtonDown:function(e){return this._mouseButtonsDown[e]},isDragging:function(e){return this._dragging[e]},dragStartX:function(e){return this._dragStartPos[e][0]},dragStartY:function(e){return this._dragStartPos[e][1]},dragEndX:function(e){return this._dragEndPos[e][0]},dragEndY:function(e){return this._dragEndPos[e][1]},dragDeltaX:function(e){return this._dragDeltaPos[e][0]},dragDeltaY:function(e){return this._dragDeltaPos[e][1]},get cursorX(){return this._cursorPos[0]},get cursorY(){return this._cursorPos[1]},get cursorPrevX(){return this._cursorPrevPos[0]},get cursorPrevY(){return this._cursorPrevPos[1]},get cursorDeltaX(){return this._cursorDeltaPos[0]},get cursorDeltaY(){return this._cursorDeltaPos[1]},draw:function(){this._onDraw()}},SpiderGL.Type.extend(SpiderGL.UserInterface.CanvasHandler,SpiderGL.Core.ObjectBase),SpiderGL.UserInterface.handleCanvas=function(e,t,r){return!(!e||!t||!(e=SpiderGL.WebGL.Context.getHijacked(e,r=r||{}))||!(e=new SpiderGL.UserInterface.CanvasHandler(e,t,r))||((t[SpiderGL.Utility.getDefaultValue(r.uiName,SpiderGL.UserInterface.CanvasHandler.DEFAULT_PROPERTY_NAME)]=e)._firstNotify(),0))},SpiderGL.UserInterface.handleCanvasOnLoad=function(e,t,r){if(!e||!t)return!1;r=r||{};var i=SpiderGL.Utility.getDefaultValue(r.onLoad,null);return window.addEventListener("load",function(){SpiderGL.UserInterface.handleCanvas(e,t,r),i&&i()},!1),!0};
SpiderGL.openNamespace();let HOP_VERSION="4.2.17",HOP_ALL=256,HOP_DEBUGMODE=!1,HOP_DEFAULTLIGHT=[0,0,-1],HOP_DEFAULTPOINTSIZE=1,SGL_TRACKBALL_NO_ACTION=0,SGL_TRACKBALL_ROTATE=1,SGL_TRACKBALL_PAN=2,SGL_TRACKBALL_DOLLY=3,SGL_TRACKBALL_SCALE=4;(Presenter=function(t){this._supportsWebGL=sglHandleCanvas(t,this,{stencil:!0}),console.log("3DHOP version: "+this.version)}).prototype={_parseScene:function(t){return{background:this._parseBackground((t=t||{}).background),meshes:this._parseMeshes(t.meshes),texturedQuads:this._parseTexturedQuads(t.texturedQuads),modelInstances:this._parseModelInstances(t.modelInstances),spots:this._parseSpots(t.spots),trackball:this._parseTrackball(t.trackball),space:this._parseSpace(t.space),config:this._parseConfig(t.config)}},_parseBackground:function(t){t=sglGetDefaultObject({image:null,isEnvironment:!1,color:[0,0,0,0]},t);return t.image&&(this._objectsToProcess++,this._objectsToLoad++),t},_parseMeshes:function(t){var e,i={};for(e in t)i[e]=this._parseMesh(t[e]);return i},_parseMesh:function(t){t=sglGetDefaultObject({url:null,mType:null,transform:null},t);return t.transform=this._parseTransform(t.transform),t.url&&(this._objectsToProcess++,this._objectsToLoad++),t},_parseTexturedQuads:function(t){var e,i={};for(e in t)i[e]=this._parseTexturedQuad(t[e]);return i},_parseTexturedQuad:function(t){t=sglGetDefaultObject({url:null},t);return t.url&&(this._objectsToProcess++,this._objectsToLoad++),t},_parseModelInstances:function(t){var e,i={};for(e in t)i[e]=this._parseModelInstance(t[e]);return i},_parseModelInstance:function(t){t=sglGetDefaultObject({mesh:null,rendermode:null,color:[1,1,1],useSolidColor:!1,specularColor:[0,0,0,32],backfaceColor:[.7,.4,.4,0],alpha:.5,useTransparency:!1,useLighting:!0,cursor:"default",ID:0,transform:null,visible:!0,tags:[],clippable:!0,measurable:!0},t);return t.color[3]&&(t.alpha=t.color[3],t.color=[t.color[0],t.color[1],t.color[2]]),t.transform=this._parseTransform(t.transform),t.ID=this._instancesProgressiveID,this._instancesProgressiveID++,t},_parseSpots:function(t){var e,i={};for(e in t)i[e]=this._parseSpot(t[e]);return i},_parseSpot:function(t){t=sglGetDefaultObject({mesh:null,rendermode:null,color:[0,.25,1],useSolidColor:!0,alpha:.5,alphaHigh:.8,useTransparency:!0,useStencil:!1,cursor:"pointer",ID:0,transform:null,visible:!0,tags:[]},t);return t.color[3]&&(t.alpha=t.color[3],t.color=[t.color[0],t.color[1],t.color[2]]),t.transform=this._parseTransform(t.transform),t.ID=this._spotsProgressiveID,this._spotsProgressiveID++,t},_parseTrackball:function(t){return sglGetDefaultObject({type:TurnTableTrackball,trackOptions:{},locked:!1},t)},_parseSpace:function(t){t=sglGetDefaultObject({centerMode:"first",radiusMode:"first",whichInstanceCenter:"",whichInstanceRadius:"",explicitCenter:[0,0,0],explicitRadius:1,transform:null,cameraFOV:60,cameraNearFar:[.01,10],cameraType:"perspective",sceneLighting:!0},t);return t.transform=this._parseTransform(t.transform),t.cameraFOV<2&&(t.cameraFOV=2),88<t.cameraFOV&&(t.cameraFOV=88),"perspective"!=t.cameraType&&"orthographic"!=t.cameraType&&(t.cameraType="perspective"),t},_parseConfig:function(t){return sglGetDefaultObject({pickedpointColor:[1,0,1],measurementColor:[.5,1,.5],showClippingPlanes:!0,showClippingBorder:!1,clippingBorderSize:.5,clippingBorderColor:[0,1,1],pointSize:1,pointSizeMinMax:[1,5],autoSaveScreenshot:!0,screenshotBaseName:"screenshot"},t)},_parseTransform:function(t){var e,i,n,t=sglGetDefaultObject({matrix:SglMat4.identity(),rotation:[0,0,0],translation:[0,0,0],scale:[1,1,1,0]},t),s=!1,o=SglMat4.identity(),r=SglMat4.identity(),a=SglMat4.identity();return 0==t.translation[0]&&0==t.translation[1]&&0==t.translation[2]||(o=SglMat4.translation(t.translation),s=!0),0==t.rotation[0]&&0==t.rotation[1]&&0==t.rotation[2]||(e=SglMat4.rotationAngleAxis(sglDegToRad(t.rotation[0]),[1,0,0]),i=SglMat4.rotationAngleAxis(sglDegToRad(t.rotation[1]),[0,1,0]),n=SglMat4.rotationAngleAxis(sglDegToRad(t.rotation[2]),[0,0,1]),r=SglMat4.mul(SglMat4.mul(n,i),e),s=!0),1==t.scale[0]&&1==t.scale[1]&&1==t.scale[2]||(a=SglMat4.scaling(t.scale),s=!0),s&&(t.matrix=SglMat4.mul(SglMat4.mul(o,r),a)),t},_createStandardPointsProgram:function(){var t=this.ui.gl,e=new SglVertexShader(t,"\t\tprecision highp float;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   mat4 uWorldViewProjectionMatrix;\t\t\t\t\t\t\t\t\n\t\tuniform   mat3 uViewSpaceNormalMatrix;\t\t\t\t\t\t\t\t\t\n\t\tuniform   mat4 uWorldViewMatrix;\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   mat4 uModelMatrix;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   float uPointSize;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tattribute vec3 aPosition;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tattribute vec3 aNormal;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tattribute vec4 aColor;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tattribute float aPointSize;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec3 vNormal;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vColor;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelPos;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelViewPos;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvoid main(void)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvNormal       = normalize(uViewSpaceNormalMatrix * aNormal);\t\t\n\t\t\tvColor        = aColor;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvModelPos     = uModelMatrix * vec4(aPosition, 1.0);\t\t\t\t\n\t\t\tvModelViewPos = uWorldViewMatrix * vec4(aPosition, 1.0);\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tgl_Position  = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);\t\n\t\t\tgl_PointSize = uPointSize * aPointSize;\t\t\t\t\t\t\t\t\n\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t"),i=(this._isDebugging&&console.log("STD POINTS Vertex Shader Log:\n"+e.log),new SglFragmentShader(t,"\t\t#extension GL_EXT_frag_depth : enable\t\t\t\t\t\t\t\t\t\n\t\tprecision highp float;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uViewSpaceLightDirection;\t\t\t\t\t\t\t\t\n\t\tuniform   float uAlpha;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   bool uUseSolidColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   bool uUseLighting;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uSolidColor;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec4 uSpecularColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uClipPoint;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uClipAxis;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec4 uClipPlane;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uClipColor;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   float uClipColorSize;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec3 vNormal;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vColor;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelPos;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelViewPos;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvoid main(void)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif(length(uClipPlane.xyz) > 0.0)\t\t\t\t\t\t\t\t\t\n\t\t\t\tif( dot(vModelPos, uClipPlane) > 0.0) discard;\t\t\t\t\t\n\t\t\tif(length(uClipAxis) > 0.0)\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tif( uClipAxis[0] * (vModelPos[0] - uClipPoint[0]) > 0.0) discard;\t\n\t\t\t\tif( uClipAxis[1] * (vModelPos[1] - uClipPoint[1]) > 0.0) discard;\t\n\t\t\t\tif( uClipAxis[2] * (vModelPos[2] - uClipPoint[2]) > 0.0) discard;\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvec2 cxy = 2.0 * gl_PointCoord - 1.0;\t\t\t\t\t\t\t\t\n\t\t\tfloat r = dot(cxy, cxy);\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif (r > 1.0) { discard; }\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvec3  renderColor = vec3(1.0, 1.0, 1.0);\t\t\t\t\t\t\t\n\t\t\tvec3  diffuse = vColor.rgb;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tfloat lambert = 1.0;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvec3  specular = vec3(0.0, 0.0, 0.0);\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif(uUseSolidColor) {\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t  if(uSolidColor.r + uSolidColor.g + uSolidColor.b == -3.0)\t\t\t\n\t\t\t\tdiffuse = vColor.aaa;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t  else\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tdiffuse = uSolidColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif((uUseLighting)&&(length(vNormal) > 0.0))\t\t\t\t\t\t\t\n\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t  float nDotL   = dot(vNormal, -uViewSpaceLightDirection);\t\t\t\n\t\t\t  lambert = max(0.0, nDotL);\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n              vec3 halfV = normalize(-uViewSpaceLightDirection -vModelViewPos.xyz);\n              float spc = pow(max(dot(vNormal, halfV),0.0), uSpecularColor.a);\t\n              specular = spc * uSpecularColor.rgb;\t\t\t\t\t\t\t\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\trenderColor = (diffuse * lambert) + specular;\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif((length(uClipPlane.xyz) > 0.0)&&(uClipColorSize>0.0))\t\t\t\n\t\t\t\tif( dot(vModelPos, uClipPlane) > -uClipColorSize) renderColor = uClipColor;\t\n\t\t\tif((length(uClipAxis) > 0.0)&&(uClipColorSize>0.0))\t\t\t\t\t\n\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tif( uClipAxis[0] * (vModelPos[0] - uClipPoint[0] + (uClipAxis[0]*uClipColorSize)) > 0.0) renderColor = uClipColor;\t\n\t\t\t\tif( uClipAxis[1] * (vModelPos[1] - uClipPoint[1] + (uClipAxis[1]*uClipColorSize)) > 0.0) renderColor = uClipColor;\t\n\t\t\t\tif( uClipAxis[2] * (vModelPos[2] - uClipPoint[2] + (uClipAxis[2]*uClipColorSize)) > 0.0) renderColor = uClipColor;\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tgl_FragColor = vec4(renderColor, uAlpha);\t\t\t\t\t\t\t\n\t\t\tgl_FragDepthEXT = gl_FragCoord.z + 0.0001*(pow(r, 2.0));\t\t\t\n\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t")),t=(this._isDebugging&&console.log("STD POINTS\tFragment Shader Log:\n"+i.log),new SglProgram(t,{shaders:[e,i],attributes:{aPosition:0,aNormal:1,aColor:2,aPointSize:4},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uViewSpaceNormalMatrix:SglMat3.identity(),uWorldViewMatrix:SglMat4.identity(),uModelMatrix:SglMat4.identity(),uViewSpaceLightDirection:[0,0,-1],uPointSize:1,uAlpha:1,uUseSolidColor:!1,uUseLighting:!0,uSolidColor:[1,1,1],uSpecularColor:[0,0,0,32],uClipPoint:[0,0,0],uClipAxis:[0,0,0],uClipPlane:[0,0,0,0],uClipColor:[1,1,1],uClipColorSize:.5}}));return this._isDebugging&&console.log("STD POINTS Program Log:\n"+t.log),t},_createStandardFacesProgram:function(){var t=this.ui.gl,e=new SglVertexShader(t,"\t\tprecision highp float;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   mat4 uWorldViewProjectionMatrix;\t\t\t\t\t\t\t\t\n\t\tuniform   mat3 uViewSpaceNormalMatrix;\t\t\t\t\t\t\t\t\t\n\t\tuniform   mat4 uWorldViewMatrix;\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   mat4 uModelMatrix;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tattribute vec3 aPosition;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tattribute vec3 aNormal;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tattribute vec4 aColor;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tattribute vec2 aTextureCoord;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec3 vNormal;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vColor;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelPos;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelViewPos;\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec2 vTextureCoord;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvoid main(void)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvNormal       = normalize(uViewSpaceNormalMatrix * aNormal);\t\t\n\t\t\tvColor        = aColor;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvModelPos     = uModelMatrix * vec4(aPosition, 1.0);\t\t\t\t\n\t\t\tvModelViewPos = uWorldViewMatrix * vec4(aPosition, 1.0);\t\t\t\n\t\t\tvTextureCoord = aTextureCoord;\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);\t\n\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t"),i=(this._isDebugging&&console.log("STD FACES Vertex Shader Log:\n"+e.log),new SglFragmentShader(t,"\t\tprecision highp float;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uViewSpaceLightDirection;\t\t\t\t\t\t\t\t\n\t\tuniform   float uAlpha;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   bool uUseSolidColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   bool uUseLighting;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec4 uBackFaceColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uSolidColor;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec4 uSpecularColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uClipPoint;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uClipAxis;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec4 uClipPlane;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uClipColor;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   float uClipColorSize;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   sampler2D uSampler;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec3 vNormal;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vColor;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelPos;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelViewPos;\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec2 vTextureCoord;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvoid main(void)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif(length(uClipPlane.xyz) > 0.0)\t\t\t\t\t\t\t\t\t\n\t\t\t\tif( dot(vModelPos, uClipPlane) > 0.0) discard;\t\t\t\t\t\n\t\t\tif(length(uClipAxis) > 0.0)\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tif( uClipAxis[0] * (vModelPos[0] - uClipPoint[0]) > 0.0) discard;\t\n\t\t\t\tif( uClipAxis[1] * (vModelPos[1] - uClipPoint[1]) > 0.0) discard;\t\n\t\t\t\tif( uClipAxis[2] * (vModelPos[2] - uClipPoint[2]) > 0.0) discard;\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvec3  renderColor = vec3(1.0, 1.0, 1.0);\t\t\t\t\t\t\t\n\t\t\tvec3  diffuse = vColor.rgb;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tfloat lambert = 1.0;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvec3  specular = vec3(0.0, 0.0, 0.0);\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif(vTextureCoord.x != 0.0)\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t  diffuse = texture2D(uSampler, vTextureCoord).xyz;\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif(uUseSolidColor) {\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t  if(uSolidColor.r + uSolidColor.g + uSolidColor.b == -3.0)\t\t\t\n\t\t\t\tdiffuse = vColor.aaa;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t  else if(uSolidColor.r + uSolidColor.g + uSolidColor.b == -6.0)\t\n\t\t\t\tdiffuse = vColor.rgb;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t  else\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tdiffuse = uSolidColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif((uUseLighting)&&(length(vNormal) > 0.0))\t\t\t\t\t\t\t\n\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t  float nDotL   = dot(vNormal, -uViewSpaceLightDirection);\t\t\t\n\t\t\t  lambert = max(0.0, gl_FrontFacing? nDotL : -nDotL);\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n              vec3 halfV = normalize(-uViewSpaceLightDirection -vModelViewPos.xyz);\n              float spc = pow(max(dot(vNormal, halfV),0.0), uSpecularColor.a);\t\n              specular = spc * uSpecularColor.rgb;\t\t\t\t\t\t\t\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\trenderColor = (diffuse * lambert) + specular;\t\t\t\t\t\t\n\t\t\tif(gl_FrontFacing==false)\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tif (uBackFaceColor[3]==0.0) renderColor = renderColor * uBackFaceColor.rgb;\t\n\t\t\t\telse if(uBackFaceColor[3]==1.0) renderColor = uBackFaceColor.rgb;\t\t\t\n\t\t\t\telse if(uBackFaceColor[3]==2.0) discard;\t\t\t\t\t\t\t\t\t\n\t\t\t\telse if(uBackFaceColor[3]==3.0) renderColor = (uBackFaceColor.rgb * lambert)+specular;\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif((length(uClipPlane.xyz) > 0.0)&&(uClipColorSize>0.0))\t\t\t\n\t\t\t\tif( dot(vModelPos, uClipPlane) > -uClipColorSize) renderColor = uClipColor;\t\n\t\t\tif((length(uClipAxis) > 0.0)&&(uClipColorSize>0.0))\t\t\t\t\t\n\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tif( uClipAxis[0] * (vModelPos[0] - uClipPoint[0] + (uClipAxis[0]*uClipColorSize)) > 0.0) renderColor = uClipColor;\t\n\t\t\t\tif( uClipAxis[1] * (vModelPos[1] - uClipPoint[1] + (uClipAxis[1]*uClipColorSize)) > 0.0) renderColor = uClipColor;\t\n\t\t\t\tif( uClipAxis[2] * (vModelPos[2] - uClipPoint[2] + (uClipAxis[2]*uClipColorSize)) > 0.0) renderColor = uClipColor;\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tgl_FragColor = vec4(renderColor, uAlpha);\t\t\t\t\t\t\t\n\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t")),t=(this._isDebugging&&console.log("STD FACES Fragment Shader Log:\n"+i.log),new SglProgram(t,{shaders:[e,i],attributes:{aPosition:0,aNormal:1,aColor:2,aTextureCoord:3},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uViewSpaceNormalMatrix:SglMat3.identity(),uWorldViewMatrix:SglMat4.identity(),uModelMatrix:SglMat4.identity(),uViewSpaceLightDirection:[0,0,-1],uAlpha:1,uUseSolidColor:!1,uUseLighting:!0,uBackFaceColor:[.4,.3,.3,0],uSolidColor:[1,1,1],uSpecularColor:[0,0,0,32],uClipPoint:[0,0,0],uClipAxis:[0,0,0],uClipPlane:[0,0,0,0],uClipColor:[1,1,1],uClipColorSize:.5,uSampler:0}}));return this._isDebugging&&console.log("STD FACE Program Log:\n"+t.log),t},_createUtilsProgram:function(){var t=this.ui.gl,e=new SglVertexShader(t,"\t\tprecision highp float;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \n\t\tuniform   mat4 uModelMatrix;                                          \n\t\tuniform   float uPointSize;                                           \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tattribute vec3 aPosition;                                             \n\t\tattribute vec3 aNormal;                                               \n\t\tattribute vec4 aColor;                                                \n\t\tattribute float aPointSize;                                           \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tvarying   vec4 vModelPos;                                             \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tvoid main(void)                                                       \n\t\t{                                                                     \n\t\t\tvModelPos = uModelMatrix * vec4(aPosition, 1.0);                  \n\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n\t\t\tgl_PointSize = uPointSize * aPointSize;\t\t\t\t\t\t\t  \n\t\t}                                                                     \n\t"),i=(this._isDebugging&&console.log("UTILS Vertex Shader Log:\n"+e.log),new SglFragmentShader(t,"\t\tprecision highp float;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uClipPoint;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec3 uClipAxis;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec4 uClipPlane;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec4 uBackFaceColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   vec4 uColorID;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tuniform   float uMode;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvarying   vec4 vModelPos;\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvec4 pack_depth(const in float depth)\t\t\t\t\t\t\t\t\t\t\t\n\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tconst vec4 bit_shift = vec4(255.0*255.0*255.0, 255.0*255.0, 255.0, 1.0);\t\n\t\t\tconst vec4 bit_mask  = vec4(0.0, 1.0/255.0, 1.0/255.0, 1.0/255.0);\t\t\t\n\t\t\tvec4 res = fract(depth * bit_shift);\t\t\t\t\t\t\t\t\t\t\n\t\t\tres -= res.xxyz * bit_mask;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\treturn res;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\tvoid main(void)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif(length(uClipPlane.xyz) > 0.0)\t\t\t\t\t\t\t\t\t\n\t\t\t\tif( dot(vModelPos, uClipPlane) > 0.0) discard;\t\t\t\t\t\n\t\t\tif(length(uClipAxis) > 0.0)\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\tif( uClipAxis[0] * (vModelPos[0] - uClipPoint[0]) > 0.0) discard;\t\n\t\t\t\tif( uClipAxis[1] * (vModelPos[1] - uClipPoint[1]) > 0.0) discard;\t\n\t\t\t\tif( uClipAxis[2] * (vModelPos[2] - uClipPoint[2]) > 0.0) discard;\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif((gl_FrontFacing==false) && (uBackFaceColor[3]==2.0)) discard;\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tvec4 outColor;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tif(uMode == 1.0)\t//xyx picking\t\t\t\t\t\t\t\t\t\n\t\t\t\toutColor = pack_depth(gl_FragCoord.z);\t\t\t\t\t\t\t\n\t\t\telse if(uMode == 2.0)\t//color coded\t\t\t\t\t\t\t\t\n\t\t\t\toutColor = uColorID;\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tgl_FragColor = outColor;\t\t\t\t\t\t\t\t\t\t\t\n\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t")),t=(this._isDebugging&&console.log("UTILS Fragment Shader Log:\n"+i.log),new SglProgram(t,{shaders:[e,i],attributes:{aPosition:0,aNormal:1,aColor:2,aPointSize:4},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uModelMatrix:SglMat4.identity(),uClipPoint:[0,0,0],uClipAxis:[0,0,0],uClipPlane:[0,0,0,0],uBackFaceColor:[.4,.3,.3,0],uColorID:[1,.5,0,1],uPointSize:1,uMode:1}}));return this._isDebugging&&console.log("UTILS Program Log:\n"+t.log),t},_createColorShadedProgram:function(){var t=this.ui.gl,e=new SglVertexShader(t,"\t\tprecision highp float;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \n\t\tuniform   mat3 uViewSpaceNormalMatrix;                                \n\t\tuniform   float uPointSize;                                           \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tattribute vec3 aPosition;                                             \n\t\tattribute vec3 aNormal;                                               \n\t\tattribute float aPointSize;                                           \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tvarying   vec3 vNormal;                                               \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tvoid main(void)                                                       \n\t\t{                                                                     \n\t\t\tvNormal     = uViewSpaceNormalMatrix * aNormal;                   \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n\t\t\tgl_PointSize = uPointSize * aPointSize;\t\t\t\t\t\t\t  \n\t\t}                                                                     \n\t"),i=(this._isDebugging&&console.log("COLOR SHADED Vertex Shader Log:\n"+e.log),new SglFragmentShader(t,"\t\tprecision highp float;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tuniform   vec3 uViewSpaceLightDirection;                              \n\t\tuniform   vec4 uColorID;                                              \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tvarying   vec3 vNormal;                                               \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\tvoid main(void)                                                       \n\t\t{                                                                     \n\t\t\tif(uColorID[3] == 0.0) discard;                                   \n\t\t\tvec3  diffuse = vec3(uColorID[0], uColorID[1], uColorID[2]);      \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tif(vNormal[0] != 0.0 || vNormal[1] != 0.0 || vNormal[2] != 0.0) { \n\t\t\t\tvec3  normal    = normalize(vNormal);                         \n\t\t\t\tfloat nDotL     = dot(normal, -uViewSpaceLightDirection);     \n\t\t\t\tfloat lambert   = max(-nDotL, nDotL);                         \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\t\tdiffuse = (diffuse * 0.5) + (diffuse * lambert * 0.5);        \n\t\t\t}                                                                 \n\t\t\tgl_FragColor = vec4(diffuse, uColorID[3]);                       \n\t\t}                                                                     \n\t")),t=(this._isDebugging&&console.log("COLOR SHADED Fragment Shader Log:\n"+i.log),new SglProgram(t,{shaders:[e,i],attributes:{aPosition:0,aNormal:1,aPointSize:4},uniforms:{uWorldViewProjectionMatrix:SglMat4.identity(),uViewSpaceNormalMatrix:SglMat3.identity(),uViewSpaceLightDirection:[0,0,-1],uColorID:[1,.5,0,1],uPointSize:1}}));return this._isDebugging&&console.log("COLOR SHADED Program Log:\n"+t.log),t},_createStandardPointsTechnique:function(){var t=this.ui.gl;return new SglTechnique(t,{program:this._createStandardPointsProgram(),vertexStreams:{aNormal:[0,0,0],aColor:[.8,.8,.8,1],aPointSize:1},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uViewSpaceNormalMatrix:{semantic:"uViewSpaceNormalMatrix",value:SglMat3.identity()},uWorldViewMatrix:{semantic:"uWorldViewMatrix",value:SglMat4.identity()},uModelMatrix:{semantic:"uModelMatrix",value:SglMat4.identity()},uViewSpaceLightDirection:{semantic:"uViewSpaceLightDirection",value:[0,0,-1]},uPointSize:{semantic:"uPointSize",value:1},uAlpha:{semantic:"uAlpha",value:1},uUseSolidColor:{semantic:"uUseSolidColor",value:!1},uUseLighting:{semantic:"uUseLighting",value:!0},uSolidColor:{semantic:"uSolidColor",value:[1,1,1]},uBackFaceColor:{semantic:"uBackFaceColor",value:[.4,.3,.3,0]},uSpecularColor:{semantic:"uSpecularColor",value:[.5,.2,.8,32]},uClipPoint:{semantic:"uClipPoint",value:[0,0,0]},uClipAxis:{semantic:"uClipAxis",value:[0,0,0]},uClipPlane:{semantic:"uClipPlane",value:[0,0,0,0]},uClipColor:{semantic:"uClipColor",value:[1,1,1]},uClipColorSize:{semantic:"uClipColorSize",value:.5}}})},_createStandardFacesTechnique:function(){var t=this.ui.gl;return new SglTechnique(t,{program:this._createStandardFacesProgram(),vertexStreams:{aNormal:[0,0,0],aColor:[.8,.8,.8,1],aTextureCoord:[0,0]},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uViewSpaceNormalMatrix:{semantic:"uViewSpaceNormalMatrix",value:SglMat3.identity()},uWorldViewMatrix:{semantic:"uWorldViewMatrix",value:SglMat4.identity()},uModelMatrix:{semantic:"uModelMatrix",value:SglMat4.identity()},uViewSpaceLightDirection:{semantic:"uViewSpaceLightDirection",value:[0,0,-1]},uAlpha:{semantic:"uAlpha",value:1},uUseSolidColor:{semantic:"uUseSolidColor",value:!1},uUseLighting:{semantic:"uUseLighting",value:!0},uSolidColor:{semantic:"uSolidColor",value:[1,1,1]},uBackFaceColor:{semantic:"uBackFaceColor",value:[.4,.3,.3,0]},uSpecularColor:{semantic:"uSpecularColor",value:[.5,.2,.8,32]},uClipPoint:{semantic:"uClipPoint",value:[0,0,0]},uClipAxis:{semantic:"uClipAxis",value:[0,0,0]},uClipPlane:{semantic:"uClipPlane",value:[0,0,0,0]},uClipColor:{semantic:"uClipColor",value:[1,1,1]},uClipColorSize:{semantic:"uClipColorSize",value:.5},uSampler:{semantic:"uSampler",value:0}}})},_createUtilsTechnique:function(){var t=this.ui.gl;return new SglTechnique(t,{program:this._createUtilsProgram(),vertexStreams:{aNormal:[0,0,0],aColor:[.8,.8,.8,1],aPointSize:1},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uModelMatrix:{semantic:"uModelMatrix",value:SglMat4.identity()},uClipPoint:{semantic:"uClipPoint",value:[0,0,0]},uClipAxis:{semantic:"uClipAxis",value:[0,0,0]},uClipPlane:{semantic:"uClipPlane",value:[0,0,0,0]},uBackFaceColor:{semantic:"uBackFaceColor",value:[.4,.3,.3,0]},uColorID:{semantic:"uColorID",value:[1,.5,0,1]},uPointSize:{semantic:"uPointSize",value:1},uMode:{semantic:"uMode",value:1}}})},_createColorShadedTechnique:function(){var t=this.ui.gl;return new SglTechnique(t,{program:this._createColorShadedProgram(),vertexStreams:{aNormal:[0,0,0],aPointSize:1},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uViewSpaceNormalMatrix:{semantic:"uViewSpaceNormalMatrix",value:SglMat3.identity()},uViewSpaceLightDirection:{semantic:"uViewSpaceLightDirection",value:[0,0,-1]},uColorID:{semantic:"uColorID",value:[1,.5,.25,1]},uPointSize:{semantic:"uPointSize",value:1}}})},_createSimpleLinetechnique:function(){var t=this.ui.gl;return new SglTechnique(t,{vertexShader:"\t\t\tprecision highp float;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \n\t\t\tuniform vec3 uPointA;                                                 \n\t\t\tuniform vec3 uPointB;                                                 \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tattribute vec3 aPosition;                                             \n\t\t\tattribute vec3 aNormal;                                               \n\t\t\tattribute vec4 aColor;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tvoid main(void)                                                       \n\t\t\t{                                                                     \n\t\t\t\tvec3 newPos;                                                      \n\t\t\t\tif(aPosition[0]==0.0)                                             \n\t\t\t\t\tnewPos = uPointA;                                             \n\t\t\t\telse                                                              \n\t\t\t\t\tnewPos = uPointB;                                             \n\t\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(newPos, 1.0);     \n\t\t\t\tgl_PointSize = 8.0;\t                 \t\t\t\t\t\t\t  \n\t\t\t}                                                                     \n\t\t",fragmentShader:"\t\t\tprecision highp float;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tuniform   vec4 uLineColor;                                            \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tvoid main(void)                                                       \n\t\t\t{                                                                     \n\t\t\t\tgl_FragColor = uLineColor;                                     \n\t\t\t}                                                                     \n\t\t",vertexStreams:{aNormal:[0,0,0],aColor:[.8,.8,.8,1]},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uLineColor:{semantic:"uLineColor",value:[0,1,.5,1]},uPointA:{semantic:"uPointA",value:[0,0,0]},uPointB:{semantic:"uPointB",value:[1,1,1]}}})},_createMultiLinesPointstechnique:function(){var t=this.ui.gl;return new SglTechnique(t,{vertexShader:"\t\t\tprecision highp float;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tuniform   mat4 uWorldViewProjectionMatrix;                            \n\t\t\tuniform   float uPointSize;  \t\t\t\t                          \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tattribute vec3 aPosition;                                             \n\t\t\tattribute vec3 aNormal;                                               \n\t\t\tattribute vec4 aColor;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tvarying   vec3 vNormal;                                               \n\t\t\tvarying   vec4 vColor;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tvoid main(void)                                                       \n\t\t\t{                                                                     \n\t\t\t\tvColor      = aColor;                                             \n\t\t\t\tgl_Position = uWorldViewProjectionMatrix * vec4(aPosition, 1.0);  \n\t\t\t\tgl_PointSize = uPointSize;\t\t\t\t \t\t\t\t\t \t  \n\t\t\t}                                                                     \n\t\t",fragmentShader:"\t\t#extension GL_EXT_frag_depth : enable\t\t\t\t\t\t\t\t\t  \n\t\tprecision highp float;\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tuniform   vec4 uColorID;\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tuniform   float uZOff;\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tvarying   vec4 vColor;                                                \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\tvoid main(void)                                                       \n\t\t\t{                                                                     \n\t\t\t\tgl_FragColor = uColorID;                                          \n\t\t\t\tgl_FragDepthEXT = gl_FragCoord.z - uZOff;\t\t\t\t\t\t  \n\t\t\t}                                                                     \n\t\t",vertexStreams:{aNormal:[0,0,0],aColor:[.8,.8,.8,1]},globals:{uWorldViewProjectionMatrix:{semantic:"uWorldViewProjectionMatrix",value:SglMat4.identity()},uColorID:{semantic:"uColorID",value:[1,.5,.25,1]},uPointSize:{semantic:"uPointSize",value:1},uZOff:{semantic:"uZOff",value:0}}})},_onMeshReady:function(){this._objectLoaded()},_onTextureReady:function(){this._objectLoaded()},_onBackgroundReady:function(){this._objectLoaded()},_objectLoaded:function(){this._objectsToLoad--,this._testReady()},_testReady:function(){var t;0==this._objectsToLoad&&(this._onLoadedEvent&&"null"!=this._onLoadedEvent&&(t=this,setTimeout(function(){t._onLoadedEvent()},1500)),this._sceneReady=this._scenePrepare(),this.repaint())},_scenePrepare:function(){var t,e=this._scene.meshes,i=this._scene.modelInstances,n=this._scene.spots;for(t in e)if(e[t].renderable){for(var s in i)t==i[s].mesh&&(i[s].rendermode=e[t].renderable.renderMode[0]);for(var o in n)t==n[o].mesh&&(n[o].rendermode=e[t].renderable.renderMode[0])}return!0},_isSceneReady:function(){return this._scene&&this._sceneParsed&&this._sceneReady},_pickingRefresh:function(t,e){var i,n,s;if(this._pickpoint[0]=t,this._pickpoint[1]=e,(this._onEndPickingPoint||this._onEndMeasurement||this._onPickedSpot||this._onEnterSpot||this._onLeaveSpot)&&(i=this._drawScenePickingSpots(),n=this._Color2ID(i),this._lastSpotID!=n)){var o=this._scene.spots;if(0!=n){for(var r in o)if(o[r].ID==n){this._pickedSpot=r,this._onHover&&(s=o[r].cursor,this._isMeasuring||(this._lastCursor=document.getElementById(this.ui.canvas.id).style.cursor,document.getElementById(this.ui.canvas.id).style.cursor=s),this._onLeaveSpot&&null!=this._lastPickedSpot&&this._onLeaveSpot(this._lastPickedSpot),this._onEnterSpot&&null!=this._pickedSpot&&this._onEnterSpot(this._pickedSpot),this.repaint()),this._lastPickedSpot=r;break}}else this._pickedSpot=null,this._onHover&&(this._isMeasuring||(document.getElementById(this.ui.canvas.id).style.cursor="default"),this._onLeaveSpot&&null!=this._lastPickedSpot&&this._onLeaveSpot(this._lastPickedSpot),this._lastPickedSpot=null,this.repaint());this._lastSpotID=n}if((this._onEndPickingPoint||this._onEndMeasurement||this._onPickedInstance||this._onEnterInstance||this._onLeaveInstance)&&(i=this._drawScenePickingInstances(),n=this._Color2ID(i),this._lastInstanceID!=n||this._onPickedSpot||this._onEnterSpot||this._onLeaveSpot)){if(0!=n){var a,l=this._scene.modelInstances;for(a in l)if(l[a].ID==n){this._pickedInstance=a,this._onHover&&(s=l[a].cursor,this._isMeasuring||(this._lastCursor=s,null==this._pickedSpot&&(document.getElementById(this.ui.canvas.id).style.cursor=s),this.repaint()),this._onLeaveInstance&&null!=this._lastPickedInstance&&this._onLeaveInstance(this._lastPickedInstance),this._onEnterInstance)&&null!=this._pickedInstance&&this._onEnterInstance(this._pickedInstance),this._lastPickedInstance=a;break}}else this._pickedInstance=null,this._onHover&&(this._lastCursor="default",this._isMeasuring||null!=this._pickedSpot||(document.getElementById(this.ui.canvas.id).style.cursor="default"),this._onLeaveInstance&&null!=this._lastPickedInstance&&this._onLeaveInstance(this._lastPickedInstance),this.repaint()),this._lastPickedInstance=null;this._lastInstanceID=n}},_measureRefresh:function(t,e,i,n){this._isMeasuringDistance&&(this._pickpoint[0]=e,this._pickpoint[1]=i,null!=(e=this._drawScenePickingXYZ())&&2!=this._measurementStage?(this._pointA=e,this._measurementStage=2,this.repaint()):null!=e&&2==this._measurementStage&&(this._pointB=e,this.measurement=SglVec3.length(SglVec3.sub(this._pointA,this._pointB)),this._measurementStage=3,this.repaint(),this._onEndMeasurement)&&this._onEndMeasurement(this.measurement,[this._pointA[0],this._pointA[1],this._pointA[2]],[this._pointB[0],this._pointB[1],this._pointB[2]]))},_startMeasurement:function(){this._isMeasuringDistance||(this._isMeasuring=this._isMeasuringDistance=!0,this._measurementStage=1,this._pointA=[0,0,0],this._pointB=[0,0,0],this.measurement=0,this.repaint())},_stopMeasurement:function(){this._isMeasuringDistance=!1,this._isMeasuringPickpoint||(this._isMeasuring=this._isMeasuringDistance),this._measurementStage=0,this._pointA=[0,0,0],this._pointB=[0,0,0],this.measurement=0,this.repaint()},_pickpointRefresh:function(t,e,i,n){this._isMeasuringPickpoint&&(this._pickpoint[0]=e,this._pickpoint[1]=i,null!=(e=this._drawScenePickingXYZ()))&&(this._pickedPoint=e,this._pickValid=!0,this._onEndPickingPoint&&this._onEndPickingPoint([this._pickedPoint[0],this._pickedPoint[1],this._pickedPoint[2]]),this.repaint())},_startPickPoint:function(){this._isMeasuringPickpoint||(this._isMeasuring=this._isMeasuringPickpoint=!0,this._pickValid=!1,this._pickedPoint=[0,0,0],this.repaint())},_stopPickPoint:function(){this._isMeasuringPickpoint=!1,this._isMeasuringDistance||(this._isMeasuring=this._isMeasuringPickpoint),this._pickValid=!1,this._pickedPoint=[0,0,0],this.repaint()},_setSceneCenterRadius:function(){var t=this._scene.meshes,e=this._scene.modelInstances;if(this.sceneCenter=[0,0,0],this.sceneRadiusInv=1,"explicit"==this._scene.space.centerMode)this.sceneCenter=this._scene.space.explicitCenter;else if("specific"==this._scene.space.centerMode&&""!=this._scene.space.whichInstanceCenter)(l=t[e[this._scene.space.whichInstanceCenter].mesh])&&l.renderable&&(a=SglVec3.to4(l.renderable.datasetCenter,1),a=SglMat4.mul4(l.transform.matrix,a),a=SglMat4.mul4(e[this._scene.space.whichInstanceCenter].transform.matrix,a),a=SglMat4.mul4(this._scene.space.transform.matrix,a),a=SglVec4.to3(a),this.sceneCenter=a);else if("scene"==this._scene.space.centerMode){var i=SglVec3.maxNumber(),n=SglVec3.minNumber(),s=[0,0,0],o=[0,0,0];for(r in e)(l=t[e[r].mesh])&&l.renderable&&(a=SglVec3.to4(l.renderable.datasetCenter,1),a=SglMat4.mul4(l.transform.matrix,a),a=SglMat4.mul4(e[r].transform.matrix,a),a=SglMat4.mul4(this._scene.space.transform.matrix,a),a=SglVec4.to3(a),u=l.renderable.datasetRadius,h=SglVec3.one(),h=SglMat3.mul3(SglMat4.to33(l.transform.matrix),h),h=SglMat3.mul3(SglMat4.to33(e[r].transform.matrix),h),h=SglMat3.mul3(SglMat4.to33(this._scene.space.transform.matrix),h),u*=d=SglVec3.length(h)/SglVec3.length([1,1,1]),s[0]=a[0]-u,s[1]=a[1]-u,s[2]=a[2]-u,o[0]=a[0]+u,o[1]=a[1]+u,o[2]=a[2]+u,s[0]<i[0]&&(i[0]=s[0]),s[1]<i[1]&&(i[1]=s[1]),s[2]<i[2]&&(i[2]=s[2]),o[0]>n[0]&&(n[0]=o[0]),o[1]>n[1]&&(n[1]=o[1]),o[2]>n[2])&&(n[2]=o[2]);this.sceneCenter=[(n[0]+i[0])/2,(n[1]+i[1])/2,(n[2]+i[2])/2]}else for(var r in e)if((l=t[e[r].mesh])&&l.renderable){var a=SglVec3.to4(l.renderable.datasetCenter,1);a=SglMat4.mul4(l.transform.matrix,a),a=SglMat4.mul4(e[r].transform.matrix,a),a=SglMat4.mul4(this._scene.space.transform.matrix,a),a=SglVec4.to3(a),this.sceneCenter=a;break}if("explicit"==this._scene.space.radiusMode)this.sceneRadiusInv=1/this._scene.space.explicitRadius;else if("specific"==this._scene.space.radiusMode&&""!=this._scene.space.whichInstanceRadius)(l=t[e[this._scene.space.whichInstanceRadius].mesh])&&l.renderable&&(u=l.renderable.datasetRadius,h=SglVec3.one(),h=SglMat3.mul3(SglMat4.to33(l.transform.matrix),h),h=SglMat3.mul3(SglMat4.to33(e[this._scene.space.whichInstanceRadius].transform.matrix),h),h=SglMat3.mul3(SglMat4.to33(this._scene.space.transform.matrix),h),d=SglVec3.length(h)/SglVec3.length([1,1,1]),this.sceneRadiusInv=1/(u*d));else if("scene"==this._scene.space.radiusMode){var l,i=SglVec3.maxNumber(),n=SglVec3.minNumber(),s=[0,0,0],o=[0,0,0];for(r in e)(l=t[e[r].mesh])&&l.renderable&&(a=SglVec3.to4(l.renderable.datasetCenter,1),a=SglMat4.mul4(l.transform.matrix,a),a=SglMat4.mul4(e[r].transform.matrix,a),a=SglMat4.mul4(this._scene.space.transform.matrix,a),a=SglVec4.to3(a),u=l.renderable.datasetRadius,h=SglVec3.one(),h=SglMat3.mul3(SglMat4.to33(l.transform.matrix),h),h=SglMat3.mul3(SglMat4.to33(e[r].transform.matrix),h),h=SglMat3.mul3(SglMat4.to33(this._scene.space.transform.matrix),h),u*=d=SglVec3.length(h)/SglVec3.length([1,1,1]),s[0]=a[0]-u,s[1]=a[1]-u,s[2]=a[2]-u,o[0]=a[0]+u,o[1]=a[1]+u,o[2]=a[2]+u,s[0]<i[0]&&(i[0]=s[0]),s[1]<i[1]&&(i[1]=s[1]),s[2]<i[2]&&(i[2]=s[2]),o[0]>n[0]&&(n[0]=o[0]),o[1]>n[1]&&(n[1]=o[1]),o[2]>n[2])&&(n[2]=o[2]);var c=[(n[0]+i[0])/2,(n[1]+i[1])/2,(n[2]+i[2])/2];this.sceneRadiusInv=1/SglVec3.length(SglVec3.sub(n,c))}else for(var r in e)if((l=t[e[r].mesh])&&l.renderable){var u=l.renderable.datasetRadius,h=SglVec3.one(),d=(h=SglMat3.mul3(SglMat4.to33(l.transform.matrix),h),h=SglMat3.mul3(SglMat4.to33(e[r].transform.matrix),h),h=SglMat3.mul3(SglMat4.to33(this._scene.space.transform.matrix),h),SglVec3.length(h)/SglVec3.length([1,1,1]));this.sceneRadiusInv=1/(u*d);break}},_destroyPickFramebuffer:function(){this.pickFramebuffer&&(this.pickFramebuffer.destroy(),this.pickFramebuffer=null),this.pickColorTexture&&(this.pickColorTexture.destroy(),this.pickColorTexture=null),this.pickDepthRenderbuffer&&(this.pickDepthRenderbuffer.destroy(),this.pickDepthRenderbuffer=null)},_createPickFramebuffer:function(t,e){var i;this.pickFramebuffer&&this.pickFramebuffer.width==t&&this.pickFramebuffer.height==e||(this._destroyPickFramebuffer(),i=this.ui.gl,this.pickColorTexture=new SglTexture2D(i,{internalFormat:i.RGBA,width:t,height:e}),this.pickDepthRenderbuffer=new SglRenderbuffer(i,{internalFormat:i.DEPTH_COMPONENT16,width:t,height:e}),this.pickFramebuffer=new SglFramebuffer(i,{color:this.pickColorTexture,depth:this.pickDepthRenderbuffer,autoViewport:!0}))},_setupDraw:function(){var t,e=this.ui.width,i=this.ui.height,n=this.xform,s=this._scene.space,o=(this.ui.gl.viewport(0,0,e,i),s.cameraFOV),r=s.cameraNearFar[0],a=s.cameraNearFar[1];this._setSceneCenterRadius(),n.projection.loadIdentity(),"orthographic"==s.cameraType?(s=1,s=(s=void 0!==this.trackball.distance?this.trackball.distance:s)*SpiderGL.Math.tan(sglDegToRad(o)/2),n.projection.ortho([-(t=s*e/i),-s,r],[t,s,a])):n.projection.perspective(sglDegToRad(o),e/i,r,a),n.view.loadIdentity(),n.view.lookAt([0,0,0],[0,0,-1],[0,1,0]),this.viewMatrix=n.viewMatrix,n.model.loadIdentity(),n.model.multiply(this.trackball.matrix),n.model.scale([this.sceneRadiusInv,this.sceneRadiusInv,this.sceneRadiusInv]),n.model.translate(SglVec3.neg(this.sceneCenter)),Nexus.beginFrame(this.ui.gl,this.ui.framesPerSecond)},_ID2Color:function(t){var t=0|t,e=t%10,i=(t-e)/10%10;return[.1*e,.1*i,.1*(((t-e)/10-i)/10%10),1]},_Color2ID:function(t){return(0|Math.round(t[0]/255/.1))+(10*Math.round(t[1]/255/.1)|0)+(100*Math.round(t[2]/255/.1)|0)|0},_onPlyLoaded:function(t,e,i){var n=t.buffer,n=importPly(n),s=e.renderable=new SglModel(i,n);if(s.renderMode=n.extra.renderMode,s.boundingBox=n.extra.boundingBox,s.datasetCenter=[0,0,0],s.datasetRadius=1,s.datasetCenter[0]=(s.boundingBox.max[0]+s.boundingBox.min[0])/2,s.datasetCenter[1]=(s.boundingBox.max[1]+s.boundingBox.min[1])/2,s.datasetCenter[2]=(s.boundingBox.max[2]+s.boundingBox.min[2])/2,s.datasetRadius=Math.sqrt(Math.pow(s.boundingBox.max[0]-s.boundingBox.min[0],2)+Math.pow(s.boundingBox.max[1]-s.boundingBox.min[1],2)+Math.pow(s.boundingBox.max[2]-s.boundingBox.min[2],2))/2,n.extra.textureUrl){for(var o=this,r="",a=t._url.split("/"),l=0;l<a.length-1;++l)r+=a[l].concat("/");r=r.concat(n.extra.textureUrl),s.texture=new SglTexture2D(i,{url:r,onError:function(){s.hasTexture=!1,o._onMeshReady()},onSuccess:function(){s.hasTexture=!0,o._onMeshReady()}})}else this._onMeshReady()},_drawScene:function(){var t,e,i,n,s,o,r=this.ui.gl,a=this.ui.width,l=this.ui.height,c=this.xform,u=this.renderer,h=this.facesProgram,d=this.pointsProgram,p=this.faceTechnique,m=this.pointTechnique,F=this.colorShadedProgram,g=this.colorShadedTechnique,_=this.simpleLineTechnique,N=this.multiLinesPointsTechnique,f=this._scene.meshes,v=this._scene.modelInstances,S=this._scene.entities,M=this._scene.spots,C=this._scene.space,b=this._scene.config,x=this._scene.background.color;for(t in this._setupDraw(),r.clearColor(x[0],x[1],x[2],x[3]),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT),r.enable(r.DEPTH_TEST),v)if(D=f[(e=v[t]).mesh]){var P=D.renderable;if(P&&e.visible&&!e.useTransparency){c.model.push(),c.model.multiply(C.transform.matrix),c.model.multiply(e.transform.matrix),c.model.multiply(D.transform.matrix);var L=SglMat4.identity(),k=(L=SglMat4.mul(L,C.transform.matrix),L=SglMat4.mul(L,e.transform.matrix),L=SglMat4.mul(L,D.transform.matrix),e.clippable?this._clipAxis:[0,0,0]),T=e.clippable?this._clipPlane:[0,0,0,0],y=b.showClippingBorder?b.clippingBorderSize:0,B={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uViewSpaceNormalMatrix:c.viewSpaceNormalMatrix,uModelMatrix:L,uWorldViewMatrix:c.modelViewMatrix,uViewSpaceLightDirection:this._lightDirection,uPointSize:b.pointSize,uAlpha:1,uUseSolidColor:e.useSolidColor,uUseLighting:C.sceneLighting&&e.useLighting,uBackFaceColor:e.backfaceColor,uSpecularColor:e.specularColor,uSolidColor:e.color,uClipPoint:this._clipPoint,uClipAxis:k,uClipPlane:T,uClipColor:b.clippingBorderColor,uClipColorSize:y};if("nexus"===D.mType){if(!P.isReady)continue;(A=P).updateView([0,0,a,l],c.projectionMatrix,c.modelViewMatrix),(E="FILL"==e.rendermode?h:d).setUniforms(B),E.bind(),A.setPrimitiveMode(e.rendermode),A.render(),E.unbind()}else"ply"===D.mType&&(w="FILL"==e.rendermode?p:m,u.begin(),u.setTechnique(w),u.setDefaultGlobals(),u.setPrimitiveMode(e.rendermode),u.setGlobals(B),u.setModel(P),u.setTexture(0,P.texture),u.renderModel(),u.end());c.model.pop()}}for(t in v)if(D=f[(e=v[t]).mesh]){P=D.renderable;if(P&&e.visible&&e.useTransparency){r.depthMask(!1),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE),c.model.push(),c.model.multiply(C.transform.matrix),c.model.multiply(e.transform.matrix),c.model.multiply(D.transform.matrix);var w,L=SglMat4.identity(),k=(L=SglMat4.mul(L,C.transform.matrix),L=SglMat4.mul(L,e.transform.matrix),L=SglMat4.mul(L,D.transform.matrix),e.clippable?this._clipAxis:[0,0,0]),T=e.clippable?this._clipPlane:[0,0,0,0],y=b.showClippingBorder?b.clippingBorderSize:0,B={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uViewSpaceNormalMatrix:c.viewSpaceNormalMatrix,uModelMatrix:L,uWorldViewMatrix:c.modelViewMatrix,uViewSpaceLightDirection:this._lightDirection,uPointSize:b.pointSize,uAlpha:e.alpha,uUseSolidColor:e.useSolidColor,uUseLighting:C.sceneLighting&&e.useLighting,uBackFaceColor:e.backfaceColor,uSpecularColor:e.specularColor,uSolidColor:e.color,uClipPoint:[0,0,0],uClipPoint:this._clipPoint,uClipAxis:k,uClipPlane:T,uClipColor:b.clippingBorderColor,uClipColorSize:y};if("nexus"===D.mType){if(!P.isReady)continue;(A=P).updateView([0,0,a,l],c.projectionMatrix,c.modelViewMatrix),(E="FILL"==e.rendermode?h:d).setUniforms(B),E.bind(),A.setPrimitiveMode(e.rendermode),A.render(),E.unbind()}else"ply"===D.mType&&(w="FILL"==e.rendermode?p:m,u.begin(),u.setTechnique(w),u.setDefaultGlobals(),u.setPrimitiveMode(e.rendermode),u.setGlobals(B),u.setModel(P),u.setTexture(0,P.texture),u.renderModel(),u.end());r.disable(r.BLEND),r.depthMask(!0),c.model.pop()}}for(i in this._pickValid&&(r.depthFunc(r.LESS),c.model.push(),s={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uLineColor:[b.pickedpointColor[0],b.pickedpointColor[1],b.pickedpointColor[2],1],uPointA:this._pickedPoint,uPointB:this._pickedPoint},u.begin(),u.setTechnique(_),u.setDefaultGlobals(),u.setGlobals(s),u.setPrimitiveMode("POINT"),u.setModel(this.simpleLineModel),u.renderModel(),u.end(),s.uLineColor=[.4*b.pickedpointColor[0],.5*b.pickedpointColor[1],.6*b.pickedpointColor[2],.5],r.depthFunc(r.GREATER),r.depthMask(!1),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE),u.begin(),u.setTechnique(_),u.setDefaultGlobals(),u.setGlobals(s),u.setPrimitiveMode("POINT"),u.setModel(this.simpleLineModel),u.renderModel(),u.end(),r.disable(r.BLEND),r.depthMask(!0),r.depthFunc(r.LESS),c.model.pop()),2<=this._measurementStage&&(r.depthFunc(r.LESS),c.model.push(),s={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uLineColor:[b.measurementColor[0],b.measurementColor[1],b.measurementColor[2],1],uPointA:this._pointA,uPointB:2==this._measurementStage?this._pointA:this._pointB},u.begin(),u.setTechnique(_),u.setDefaultGlobals(),u.setGlobals(s),u.setPrimitiveMode("LINE"),u.setModel(this.simpleLineModel),u.renderModel(),u.setPrimitiveMode("POINT"),u.setModel(this.simpleLineModel),u.renderModel(),u.end(),s.uLineColor=[.4*b.measurementColor[0],.5*b.measurementColor[1],.6*b.measurementColor[2],.5],r.depthFunc(r.GREATER),r.depthMask(!1),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE),u.begin(),u.setTechnique(_),u.setDefaultGlobals(),u.setGlobals(s),u.setPrimitiveMode("LINE"),u.setModel(this.simpleLineModel),u.renderModel(),u.setPrimitiveMode("POINT"),u.setModel(this.simpleLineModel),u.renderModel(),u.end(),r.disable(r.BLEND),r.depthMask(!0),r.depthFunc(r.LESS),c.model.pop()),S){var R,I=S[i];I.visible&&I.renderable&&(c.model.push(),c.model.multiply(C.transform.matrix),c.model.multiply(I.transform.matrix),R={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uPointSize:8,uColorID:I.color,uZOff:I.zOff},I.useTransparency&&(r.depthMask(!1),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE)),u.begin(),u.setTechnique(N),"lines"==I.type?u.setPrimitiveMode("LINE"):"points"==I.type?u.setPrimitiveMode("POINT"):"triangles"==I.type&&u.setPrimitiveMode("FILL"),u.setDefaultGlobals(),u.setGlobals(R),u.setModel(I.renderable),u.renderModel(),u.end(),I.useTransparency&&(r.depthMask(!0),r.disable(r.BLEND)),c.model.pop())}for(n in M){var D,V=M[n];if(D=f[V.mesh]){P=D.renderable;if(P&&V.visible){r.depthMask(!1),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE),c.model.push(),c.model.multiply(C.transform.matrix),c.model.multiply(V.transform.matrix),c.model.multiply(D.transform.matrix);var A,E,B={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uViewSpaceNormalMatrix:c.viewSpaceNormalMatrix,uViewSpaceLightDirection:this._lightDirection,uPointSize:b.pointSize,uColorID:[V.color[0],V.color[1],V.color[2],n==this._pickedSpot?V.alphaHigh:V.alpha]};if("nexus"===D.mType){if(!P.isReady)continue;(A=P).updateView([0,0,a,l],c.projectionMatrix,c.modelViewMatrix),(E=F).setUniforms(B),E.bind(),A.setPrimitiveMode(V.rendermode),A.render(),E.unbind()}else"ply"===D.mType&&(u.begin(),u.setTechnique(g),u.setDefaultGlobals(),u.setPrimitiveMode(V.rendermode),u.setGlobals(B),u.setModel(P),V.useStencil?(r.clear(r.STENCIL_BUFFER_BIT),r.colorMask(!1,!1,!1,!1),r.enable(r.STENCIL_TEST),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),u.renderModel(),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.stencilFunc(r.EQUAL,1,1),u.renderModel(),r.disable(r.STENCIL_TEST)):u.renderModel(),u.end());r.disable(r.BLEND),r.depthMask(!0),c.model.pop()}}}b.showClippingPlanes&&(r.depthMask(!1),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE),0<SglVec3.length([this._clipPlane[0],this._clipPlane[1],this._clipPlane[2]])&&(x=[0,0,0],_=SglVec3.dot(this._sceneBboxCenter,[this._clipPlane[0],this._clipPlane[1],this._clipPlane[2]])+this._clipPlane[3],x[0]=this._sceneBboxCenter[0]-this._clipPlane[0]*_,x[1]=this._sceneBboxCenter[1]-this._clipPlane[1]*_,x[2]=this._sceneBboxCenter[2]-this._clipPlane[2]*_,s=SglMat4.identity(),s=SglMat4.mul(s,SglMat4.rotationAngleAxis(sglDegToRad(this._clipPlaneAH),[0,-1,0])),s=SglMat4.mul(s,SglMat4.rotationAngleAxis(sglDegToRad(this._clipPlaneAV),[0,0,1])),_=this._sceneBboxDiag,c.model.push(),c.model.translate(x),c.model.multiply(s),c.model.scale([_,_,_]),o={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uViewSpaceNormalMatrix:c.viewSpaceNormalMatrix,uViewSpaceLightDirection:this._lightDirection,uColorID:[1,0,1,.25]},u.begin(),u.setTechnique(g),u.setDefaultGlobals(),u.setPrimitiveMode("FILL"),u.setGlobals(o),u.setModel(this.simpleQuadXModel),u.renderModel(),u.end(),c.model.pop()),0!=this._clipAxis[0]&&(c.model.push(),c.model.translate([this._clipPoint[0],this._sceneBboxCenter[1],this._sceneBboxCenter[2]]),c.model.scale([this._sceneBboxMax[0]-this._sceneBboxMin[0],this._sceneBboxMax[1]-this._sceneBboxMin[1],this._sceneBboxMax[2]-this._sceneBboxMin[2]]),o={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uViewSpaceNormalMatrix:c.viewSpaceNormalMatrix,uViewSpaceLightDirection:this._lightDirection,uColorID:[1,0,0,.25]},u.begin(),u.setTechnique(g),u.setDefaultGlobals(),u.setPrimitiveMode("FILL"),u.setGlobals(o),u.setModel(this.simpleQuadXModel),u.renderModel(),u.end(),c.model.pop()),0!=this._clipAxis[1]&&(c.model.push(),c.model.translate([this._sceneBboxCenter[0],this._clipPoint[1],this._sceneBboxCenter[2]]),c.model.scale([this._sceneBboxMax[0]-this._sceneBboxMin[0],this._sceneBboxMax[1]-this._sceneBboxMin[1],this._sceneBboxMax[2]-this._sceneBboxMin[2]]),o={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uViewSpaceNormalMatrix:c.viewSpaceNormalMatrix,uViewSpaceLightDirection:this._lightDirection,uColorID:[0,1,0,.25]},u.begin(),u.setTechnique(g),u.setDefaultGlobals(),u.setPrimitiveMode("FILL"),u.setGlobals(o),u.setModel(this.simpleQuadYModel),u.renderModel(),u.end(),c.model.pop()),0!=this._clipAxis[2]&&(c.model.push(),c.model.translate([this._sceneBboxCenter[0],this._sceneBboxCenter[1],this._clipPoint[2]]),c.model.scale([this._sceneBboxMax[0]-this._sceneBboxMin[0],this._sceneBboxMax[1]-this._sceneBboxMin[1],this._sceneBboxMax[2]-this._sceneBboxMin[2]]),o={uWorldViewProjectionMatrix:c.modelViewProjectionMatrix,uViewSpaceNormalMatrix:c.viewSpaceNormalMatrix,uViewSpaceLightDirection:this._lightDirection,uColorID:[0,0,1,.25]},u.begin(),u.setTechnique(g),u.setDefaultGlobals(),u.setPrimitiveMode("FILL"),u.setGlobals(o),u.setModel(this.simpleQuadZModel),u.renderModel(),u.end(),c.model.pop()),r.disable(r.BLEND),r.depthMask(!0)),Nexus.endFrame(this.ui.gl),this.isCapturingScreenshot&&(this.isCapturingScreenshot=!1,this.screenshotData=this.ui._canvas.toDataURL("image/png",1).replace("image/png","image/octet-stream"),this._scene.config.autoSaveScreenshot)&&(x=new Date,s=this._scene.config.screenshotBaseName+x.getHours()+x.getMinutes()+x.getSeconds()+".png",this.ui._canvas.msToBlob?(console.error("IE and EDGEhtml cannot save images"),_=this.ui._canvas.msToBlob(),window.navigator.msSaveBlob(_,s)):((o=document.createElement("a")).href=this.screenshotData,o.download=s,o.target="_blank",o.click()))},_drawScenePickingXYZ:function(){var t,e=this.ui.gl,i=this.ui.width,n=this.ui.height,s=this.xform,o=this.renderer,r=this.utilsProgram,a=this.utilsTechnique,l=this._scene.meshes,c=this._scene.modelInstances,u=this._scene.space,h=new Uint8Array(4);for(t in this._createPickFramebuffer(i,n),this._setupDraw(),this.pickFramebuffer.bind(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),e.enable(e.DEPTH_TEST),this.pickFramebuffer.unbind(),c){var d=c[t],p=l[d.mesh];if(p){var m=p.renderable;if(m&&d.visible&&d.measurable){s.model.push(),s.model.multiply(u.transform.matrix),s.model.multiply(d.transform.matrix),s.model.multiply(p.transform.matrix);var g=SglMat4.identity(),g=SglMat4.mul(g,u.transform.matrix),_=(g=SglMat4.mul(g,d.transform.matrix),g=SglMat4.mul(g,p.transform.matrix),d.clippable?this._clipAxis:[0,0,0]),f=d.clippable?this._clipPlane:[0,0,0,0],g={uWorldViewProjectionMatrix:s.modelViewProjectionMatrix,uModelMatrix:g,uBackFaceColor:d.backfaceColor,uClipPoint:this._clipPoint,uClipAxis:_,uClipPlane:f,uPointSize:this._scene.config.pointSize,uMode:1};if("nexus"===p.mType){if(!m.isReady)continue;_=m,f=(_.updateView([0,0,i,n],s.projectionMatrix,s.modelViewMatrix),this.pickFramebuffer.bind(),r);f.setUniforms(g),f.bind(),_.setPrimitiveMode(d.rendermode),_.render(),f.unbind(),this.pickFramebuffer.unbind()}else"ply"===p.mType&&(o.begin(),o.setFramebuffer(this.pickFramebuffer),o.setTechnique(a),o.setDefaultGlobals(),o.setPrimitiveMode(d.rendermode),o.setGlobals(g),o.setModel(m),o.renderModel(),o.setFramebuffer(null),o.end());s.model.pop()}}}this.pickFramebuffer.readPixels(h,{x:this._pickpoint[0],y:this._pickpoint[1],width:1,height:1,format:e.RGBA,type:e.UNSIGNED_BYTE});var e=h[0]/255,v=h[1]/255,S=h[2]/255,h=h[3]/255;return 0==e&&0==v&&0==S?null:[(h=s.unproject([this._pickpoint[0]/i,this._pickpoint[1]/n,h+S/255+v/65025+e/16581375]))[0],h[1],h[2]]},_drawScenePickingInstances:function(){var t,e=this.ui.gl,i=this.ui.width,n=this.ui.height,s=this.xform,o=this.renderer,r=this.utilsProgram,a=this.utilsTechnique,l=this._scene.meshes,c=this._scene.modelInstances,u=this._scene.space,h=new Uint8Array(4);for(t in this._createPickFramebuffer(i,n),this._setupDraw(),this.pickFramebuffer.bind(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),e.enable(e.DEPTH_TEST),this.pickFramebuffer.unbind(),c){var d=c[t],p=l[d.mesh];if(p){var m=p.renderable;if(m&&d.visible){s.model.push(),s.model.multiply(u.transform.matrix),s.model.multiply(d.transform.matrix),s.model.multiply(p.transform.matrix);var g=SglMat4.identity(),g=SglMat4.mul(g,u.transform.matrix),_=(g=SglMat4.mul(g,d.transform.matrix),g=SglMat4.mul(g,p.transform.matrix),d.clippable?this._clipAxis:[0,0,0]),f=d.clippable?this._clipPlane:[0,0,0,0],v=this._ID2Color(d.ID),g={uWorldViewProjectionMatrix:s.modelViewProjectionMatrix,uModelMatrix:g,uClipPoint:this._clipPoint,uClipAxis:_,uClipPlane:f,uPointSize:this._scene.config.pointSize,uColorID:v,uMode:2};if("nexus"===p.mType){if(!m.isReady)continue;_=m,f=(_.updateView([0,0,i,n],s.projectionMatrix,s.modelViewMatrix),this.pickFramebuffer.bind(),r);f.setUniforms(g),f.bind(),_.setPrimitiveMode(d.rendermode),_.render(),f.unbind(),this.pickFramebuffer.unbind()}else"ply"===p.mType&&(o.begin(),o.setFramebuffer(this.pickFramebuffer),o.setTechnique(a),o.setDefaultGlobals(),o.setPrimitiveMode(d.rendermode),o.setGlobals(g),o.setModel(m),o.renderModel(),o.setFramebuffer(null),o.end());s.model.pop()}}}return this.pickFramebuffer.readPixels(h,{x:this._pickpoint[0],y:this._pickpoint[1],width:1,height:1,format:e.RGBA,type:e.UNSIGNED_BYTE}),h},_drawScenePickingSpots:function(){var t,e,i=this.ui.gl,n=this.ui.width,s=this.ui.height,o=this.xform,r=this.renderer,a=this.utilsProgram,l=this.utilsTechnique,c=this._scene.meshes,u=this._scene.spots,h=this._scene.modelInstances,d=this._scene.space,p=new Uint8Array(4);for(t in this._createPickFramebuffer(n,s),this._setupDraw(),this.pickFramebuffer.bind(),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT),i.enable(i.DEPTH_TEST),this.pickFramebuffer.unbind(),h){var m=h[t];if(f=c[m.mesh]){var g=f.renderable;if(g&&m.visible){o.model.push(),o.model.multiply(d.transform.matrix),o.model.multiply(m.transform.matrix),o.model.multiply(f.transform.matrix);var _={uWorldViewProjectionMatrix:o.modelViewProjectionMatrix,uPointSize:this._scene.config.pointSize,uColorID:[0,0,0,0],uMode:2};if("nexus"===f.mType){if(!g.isReady)continue;(S=g).updateView([0,0,n,s],o.projectionMatrix,o.modelViewMatrix),this.pickFramebuffer.bind(),(M=a).setUniforms(_),M.bind(),S.setPrimitiveMode(m.rendermode),S.render(),M.unbind(),this.pickFramebuffer.unbind()}else"ply"===f.mType&&(r.begin(),r.setFramebuffer(this.pickFramebuffer),r.setTechnique(l),r.setDefaultGlobals(),r.setPrimitiveMode(m.rendermode),r.setGlobals(_),r.setModel(g),r.renderModel(),r.setFramebuffer(null),r.end());o.model.pop()}}}for(e in u){var f,v=u[e];if(f=c[v.mesh]){g=f.renderable;if(g&&v.visible){o.model.push(),o.model.multiply(d.transform.matrix),o.model.multiply(v.transform.matrix),o.model.multiply(f.transform.matrix);var S,M,C=this._ID2Color(v.ID),_={uWorldViewProjectionMatrix:o.modelViewProjectionMatrix,uPointSize:this._scene.config.pointSize,uColorID:C,uMode:2};if("nexus"===f.mType){if(!g.isReady)continue;(S=g).updateView([0,0,n,s],o.projectionMatrix,o.modelViewMatrix),this.pickFramebuffer.bind(),(M=a).setUniforms(_),M.bind(),S.setPrimitiveMode(v.rendermode),S.render(),M.unbind(),this.pickFramebuffer.unbind()}else"ply"===f.mType&&(r.begin(),r.setFramebuffer(this.pickFramebuffer),r.setTechnique(l),r.setDefaultGlobals(),r.setPrimitiveMode(v.rendermode),r.setGlobals(_),r.setModel(g),r.renderModel(),r.setFramebuffer(null),r.end());o.model.pop(),i.depthMask(!0)}}}return this.pickFramebuffer.readPixels(p,{x:this._pickpoint[0],y:this._pickpoint[1],width:1,height:1,format:i.RGBA,type:i.UNSIGNED_BYTE}),p},_drawNull:function(){var t=this.ui.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)},_createMeshModels:function(){for(var i=this,n=this.ui.gl,t=Object.keys(this._scene.meshes),e=t.length-1;0<=e;e--){var s,o=t[e],o=this._scene.meshes[o];o.url&&(0==this._objectsToProcess?this._testReady():(this._objectsToProcess--,null==o.mType&&("nxs"===(s=o.url.split(".").pop().split(/\#|\?/)[0].toLowerCase())||"nxz"===s?o.mType="nexus":"ply"===s&&(o.mType="ply")),"nexus"===o.mType?((s=new Nexus.Renderer(n)).onLoad=function(){i._onMeshReady()},s.onUpdate=this.ui.postDrawEvent,(o.renderable=s).open(o.url)):"ply"===o.mType&&(o.renderable=null,sglRequestBinary(o.url,{onSuccess:(e=>function(t){i._onPlyLoaded(t,e,n)})(o)}))))}},_createLineModel:function(){var t=this.ui.gl;this.simpleLineModel=new SglModel(t,{vertices:{position:[0,0,0,1,1,1],normal:[0,0,0,0,0,0],color:{value:[1,0,0]}},primitives:["lines","points"]})},_createQuadModels:function(){var t=this.ui.gl;this.simpleQuadXModel=new SglModel(t,{vertices:{position:[0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,-.5,0,-.5,-.5,0,.5,.5],normal:[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],color:{value:[1,0,0]}},primitives:["triangles"]}),this.simpleQuadYModel=new SglModel(t,{vertices:{position:[.5,0,.5,-.5,0,.5,-.5,0,-.5,.5,0,-.5,-.5,0,-.5,.5,0,.5],normal:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],color:{value:[0,1,0]}},primitives:["triangles"]}),this.simpleQuadZModel=new SglModel(t,{vertices:{position:[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,-.5,0,-.5,-.5,0,.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],color:{value:[0,0,1]}},primitives:["triangles"]})},onInitialize:function(){var t=this.ui.gl;this._isDebugging=HOP_DEBUGMODE,t.getExtension("EXT_frag_depth"),t.clearColor(.5,.5,.5,1),t.clearStencil(0),t.depthFunc(t.LESS),t.vertexAttrib3f(1,0,0,0),t.vertexAttrib4f(2,.8,.8,.8,1),t.vertexAttrib2f(3,0,0),t.vertexAttrib1f(4,1),this.renderer=new SglModelRenderer(t),this.xform=new SglTransformationStack,this.viewMatrix=SglMat4.identity(),this.isCapturingScreenshot=!1,this.screenshotData=null,this._nexusTargetFps=15,this._nexusTargetError=1,this._nexusCacheSize=5e7,this.installDefaultShaders(),this._onPickedInstance=0,this._onPickedSpot=0,this._onEnterInstance=0,this._onEnterSpot=0,this._onLeaveInstance=0,this._onLeaveSpot=0,this._onEndPickingPoint=0,this._onEndMeasurement=0,this.ui.animateRate=0,this.x=0,this.y=0,this._keycombo=!1,this._scene=null,this._sceneParsed=!1,this._sceneReady=!1,this._objectsToProcess=0,this._objectsToLoad=0,this._instancesProgressiveID=1,this._spotsProgressiveID=1,this._lightDirection=HOP_DEFAULTLIGHT,this.sceneCenter=[0,0,0],this.sceneRadiusInv=1,this._targetInstanceName=null,this._targetHotSpotName=null,this._animating=!1,this._movingLight=!1,this._resizable=!0,this._clickable=!1,this._onHover=!1,this._lastCursor="default",this._pickedInstance=null,this._pickedSpot=null,this._lastPickedInstance=null,this._lastPickedSpot=null,this._lastInstanceID=0,this._lastSpotID=0,this._pickpoint=[1,1],this._isMeasuring=!1,this._isMeasuringDistance=!1,this._measurementStage=0,this._pointA=[0,0,0],this._pointB=[0,0,0],this.measurement=0,this._isMeasuringPickpoint=!1,this._pickValid=!1,this._pickedPoint=[0,0,0],this._clipPoint=[0,0,0],this._clipAxis=[0,0,0],this._clipPlane=[0,0,0,0],this._sceneBboxMin=[0,0,0],this._sceneBboxMax=[0,0,0],this._sceneBboxCenter=[0,0,0],this._sceneBboxDiag=0},installDefaultShaders:function(){this.facesProgram=this._createStandardFacesProgram(),this.pointsProgram=this._createStandardPointsProgram(),this.utilsProgram=this._createUtilsProgram(),this.colorShadedProgram=this._createColorShadedProgram(),this.faceTechnique=this._createStandardFacesTechnique(),this.pointTechnique=this._createStandardPointsTechnique(),this.utilsTechnique=this._createUtilsTechnique(),this.colorShadedTechnique=this._createColorShadedTechnique(),this.simpleLineTechnique=this._createSimpleLinetechnique(),this.multiLinesPointsTechnique=this._createMultiLinesPointstechnique()},onDrag:function(t,e,i,n){var s=this.ui;if(this._clickable&&(this._clickable=!1),this._movingLight&&s.isMouseButtonDown(0))e=e/(s.width-1)*2-1,i=i/(s.height-1)*2-1,this.rotateLight(e/2,i/2);else if(!this._scene.trackball.locked){0!=s.dragDeltaX(t)&&(this.x+=s.cursorDeltaX/500),0!=s.dragDeltaY(t)&&(this.y+=s.cursorDeltaY/500);var o,e=SGL_TRACKBALL_NO_ACTION,r=(s.isMouseButtonDown(0)&&s.isKeyDown(17)||s.isMouseButtonDown(1)||s.isMouseButtonDown(2)?e=SGL_TRACKBALL_PAN:s.isMouseButtonDown(0)&&(e=SGL_TRACKBALL_ROTATE),this.trackball._matrix.slice());this.trackball.action=e,this.trackball.track(this.viewMatrix,this.x,this.y,0);for(var a=0;a<r.length;a++)if(r[a]!=this.trackball._matrix[a]){o=!0;break}o&&this.repaint()}},onMouseMove:function(t,e,i){i.target.id!=this.ui.gl.canvas.id||!this._onHover||this.ui.isDragging(0)||this.ui.isDragging(1)||this.ui.isDragging(2)||this._pickingRefresh(t,e)},onMouseOut:function(t,e,i){var n=document.createEvent("MouseEvents");n.initEvent("mouseup",!0,!0),i.target.dispatchEvent(n),this._onHover&&this._pickingRefresh(-1,-1),this._clickable=!1},onMouseButtonDown:function(t,e,i,n){this._onHover&&this._pickingRefresh(e,i),0==t&&(this._clickable=!0)},onClick:function(t,e,i,n){var s=this.ui._getMouseClientPos(n),s=(this.ui._clickPrevPos=this.ui._clickPos,this.ui._clickPos=s,[this.ui._clickPos[0]-this.ui._clickPrevPos[0],this.ui._clickPos[1]-this.ui._clickPrevPos[1]]),o=this.ui._clickPos[3]-this.ui._clickPrevPos[3],s=SpiderGL.Math.Vec2.length(s);this._clickable&&(this._pickingRefresh(e,i),s<=30&&o<=250&&this.trackball.recenter&&null!=(s=this._drawScenePickingXYZ())&&(this.ui.animateRate=30,this.trackball.recenter(s),this.repaint()),this._onPickedSpot&&null!=this._pickedSpot&&this._onPickedSpot(this._pickedSpot),this._onPickedInstance&&null!=this._pickedInstance&&this._onPickedInstance(this._pickedInstance),this._isMeasuringPickpoint&&this._pickpointRefresh(0,e,i,n),this._isMeasuringDistance)&&this._measureRefresh(0,e,i,n),this._clickable=!1},onKeyDown:function(t,e){e.ctrlKey&&"p"==e.key&&(e.preventDefault(),this.isCapturingScreenshot=!0,this.repaint())},onKeyPress:function(t,e){this._isDebugging&&("49"==e.charCode?(Nexus.Debug.nodes=!Nexus.Debug.nodes,this.repaint()):"50"==e.charCode?(this.toggleCameraType(),this.repaint()):"80"!=e.charCode&&"112"!=e.charCode||console.log(this.trackball.getState()))},onKeyUp:function(t,e){this._keycombo&&"18"==e.keyCode&&(e.preventDefault(),this._keycombo=!1)},onMouseWheel:function(t,e,i,n){var s=!1;if(n&&n.altKey){this._keycombo=!0;n=this._scene.config.pointSize;this._scene.config.pointSize+=t/10,this._scene.config.pointSize<this._scene.config.pointSizeMinMax[0]?this._scene.config.pointSize=this._scene.config.pointSizeMinMax[0]:this._scene.config.pointSize>this._scene.config.pointSizeMinMax[1]&&(this._scene.config.pointSize=this._scene.config.pointSizeMinMax[1]),n!=this._scene.config.pointSize&&(s=!0)}else{if(this._scene.trackball.locked)return;var n=SGL_TRACKBALL_SCALE,t=0<t?.9:1.1,o=this.trackball._matrix.slice();this.trackball.action=n,this.trackball.track(this.viewMatrix,0,0,t),this.trackball.action=SGL_TRACKBALL_NO_ACTION;for(var r=0;r<o.length;r++)if(o[r]!=this.trackball._matrix[r]){s=!0;break}}s&&this.repaint()},onAnimate:function(t){this._isSceneReady()&&(this.trackball.tick(t)?this.repaint():(this.ui.animateRate=0,this._onHover&&!this.ui._cursorPos[2]&&this._pickingRefresh(this.ui._cursorPos[0],this.ui._cursorPos[1])))},onDraw:function(){this._isSceneReady()?this._drawScene():this._drawNull()},setScene:function(t){t&&(null!=this._scene&&(this._scene=null,this._sceneParsed=!1,this._sceneReady=!1,this._instancesProgressiveID=1,this._spotsProgressiveID=1,this._objectsToProcess=0,this._objectsToLoad=0,this._stopMeasurement(),this._stopPickPoint(),this._clipAxis=[0,0,0],this._clipPoint=[0,0,0],this.enableLightTrackball(!1)),t=this._parseScene(t))&&(this._scene=t,this.trackball=new t.trackball.type,this.trackball.setup(t.trackball.trackOptions),this.trackball.track(SglMat4.identity(),0,0,0),t=this.ui.gl,Nexus.setTargetError(t,this._nexusTargetError),Nexus.setTargetFps(t,this._nexusTargetFps),Nexus.setMaxCacheSize(t,this._nexusCacheSize),this._createMeshModels(),this._createLineModel(),this._createQuadModels(),this._scene.entities={},this._sceneParsed=!0)},get version(){return HOP_VERSION},supportsWebGL:function(){return this._supportsWebGL},toggleDebugMode:function(){this._isDebugging=!this._isDebugging},repaint:function(){this.ui.postDrawEvent()},saveScreenshot:function(){this.isCapturingScreenshot=!0,this.repaint()},createEntity:function(t,e,i){var n={visible:!0},s=(n.type=e,n.renderable=null,n.transform={},n.transform.matrix=SglMat4.identity(),n.color=[1,0,1,1],n.useTransparency=!1,n.zOff=0,{}),o=("points"==e?s.primitives=["points"]:"lines"==e?s.primitives=["lines"]:"triangles"==e&&(s.primitives=["triangles"]),s.vertices={},s.vertices.position=[],s.vertices.normal=[],s.vertices.color={value:[1,0,1,1]},i.length);for(vInd=0;vInd<o;vInd++)s.vertices.position.push(i[vInd][0]),s.vertices.position.push(i[vInd][1]),s.vertices.position.push(i[vInd][2]),s.vertices.normal.push(0),s.vertices.normal.push(0),s.vertices.normal.push(0);e=this.ui.gl;return n.renderable=new SglModel(e,s),this._scene.entities[t]={},this._scene.entities[t]=n,this._scene.entities[t]},deleteEntity:function(t){delete this._scene.entities[t]},setNexusTargetFps:function(t){this._nexusTargetFps=t,Nexus.setTargetFps(this.ui.gl,t)},getNexusTargetFps:function(){return this._nexusTargetFps},setNexusTargetError:function(t){this._nexusTargetError=t,Nexus.setTargetError(this.ui.gl,t)},getNexusTargetError:function(){return this._nexusTargetError},setNexusCacheSize:function(t){this._nexusCacheSize=t,Nexus.setMaxCacheSize(this.ui.gl,t)},getNexusCacheSize:function(){return this._nexusCacheSize},resetTrackball:function(){this.trackball.reset(),this.trackball.track(SglMat4.identity(),0,0,0),this._lightDirection=HOP_DEFAULTLIGHT,this.repaint()},getTrackballPosition:function(){return this.trackball.getState()},setTrackballPosition:function(t){this.trackball.setState(t),this.repaint()},animateToTrackballPosition:function(t,e){this.ui.animateRate=30,this.trackball.animateToState(t,e),this.repaint()},isAnimate:function(){return 0<this.ui.animateRate?this._animating=!0:this._animating=!1,this._animating},setCenterModeFirst:function(){this._scene.space.centerMode="first",this.repaint()},setCenterModeScene:function(){this._scene.space.centerMode="scene",this.repaint()},setCenterModeSpecific:function(t){if(!this._scene.modelInstances[t])return"ERROR - No such instance";this._scene.space.centerMode="specific",this._scene.space.whichInstanceCenter=t,this.repaint()},setCenterModeExplicit:function(t){if(!(t.constructor===Array&&(t.length=3,isFinite(String(t[0])))&&isFinite(String(t[1]))&&isFinite(String(t[2]))))return"ERROR - Not a point";this._scene.space.centerMode="explicit",this._scene.space.explicitCenter=t,this.repaint()},setRadiusModeFirst:function(){this._scene.space.radiusMode="first",this.repaint()},setRadiusModeScene:function(){this._scene.space.radiusMode="scene",this.repaint()},setRadiusModeSpecific:function(t){if(!this._scene.modelInstances[t])return"ERROR - No such instance";this._scene.space.radiusMode="specific",this._scene.space.whichInstanceRadius=t,this.repaint()},setRadiusModeExplicit:function(t){if(!(isFinite(String(t))&&0<t))return"ERROR - Not a radius";this._scene.space.radiusMode="explicit",this._scene.space.explicitRadius=t,this.repaint()},setInstanceSolidColorByName:function(t,e,i,n){var s=this._scene.modelInstances;if(t==HOP_ALL)for(var o in s)s[o].useSolidColor=e,n&&(s[o].color=n);else s[t]&&(s[t].useSolidColor=e,n)&&(s[t].color=n);i&&this.repaint()},setInstanceSolidColor:function(t,e,i,n){var s,o=this._scene.modelInstances;for(s in o)if(t==HOP_ALL)o[s].useSolidColor=e,n&&(o[s].color=n);else for(var r in o[s].tags)o[s].tags[r]==t&&(o[s].useSolidColor=e,n)&&(o[s].color=n);i&&this.repaint()},toggleInstanceSolidColorByName:function(t,e){var i=this._scene.modelInstances;if(t==HOP_ALL)for(var n in i)i[n].useSolidColor=!i[n].useSolidColor;else i[t]&&(i[t].useSolidColor=!i[t].useSolidColor);e&&this.repaint()},toggleInstanceSolidColor:function(t,e){var i,n=this._scene.modelInstances;for(i in n)if(t==HOP_ALL)n[i].useSolidColor=!n[i].useSolidColor;else for(var s in n[i].tags)n[i].tags[s]==t&&(n[i].useSolidColor=!n[i].useSolidColor);e&&this.repaint()},isInstanceSolidColorEnabledByName:function(t){var e=!1,i=this._scene.modelInstances;if(t&&t!=HOP_ALL){if(i[t]&&i[t].useSolidColor)return e=!0}else for(var n in i)if(i[n].useSolidColor)return e=!0;return e},isInstanceSolidColorEnabled:function(t){var e,i=!1,n=this._scene.modelInstances;for(e in n)if(t&&t!=HOP_ALL){for(var s in n[e].tags)if(n[e].tags[s]==t&&n[e].useSolidColor)return i=!0}else if(n[e].useSolidColor)return i=!0;return i},setInstanceTransparencyByName:function(t,e,i,n){var s=this._scene.modelInstances;if(t==HOP_ALL){for(var o in s)s[o].useTransparency=e;n&&(s[o].alpha=n)}else s[t]&&(s[t].useTransparency=e,n)&&(s[t].alpha=n);i&&this.repaint()},setInstanceTransparency:function(t,e,i,n){var s,o=this._scene.modelInstances;for(s in o)if(t==HOP_ALL)o[s].useTransparency=e,n&&(o[s].alpha=n);else for(var r in o[s].tags)o[s].tags[r]==t&&(o[s].useTransparency=e,n)&&(o[s].alpha=n);i&&this.repaint()},toggleInstanceTransparencyByName:function(t,e){var i=this._scene.modelInstances;if(t==HOP_ALL)for(var n in i)i[n].useTransparency=!i[n].useTransparency;else i[t]&&(i[t].useTransparency=!i[t].useTransparency);e&&this.repaint()},toggleInstanceTransparency:function(t,e){var i,n=this._scene.modelInstances;for(i in n)if(t==HOP_ALL)n[i].useTransparency=!n[i].useTransparency;else for(var s in n[i].tags)n[i].tags[s]==t&&(n[i].useTransparency=!n[i].useTransparency);e&&this.repaint()},isInstanceTransparencyEnabledByName:function(t){var e=!1,i=this._scene.modelInstances;if(t&&t!=HOP_ALL){if(i[t]&&i[t].useTransparency)return e=!0}else for(var n in i)if(i[n].useTransparency)return e=!0;return e},isInstanceTransparencyEnabled:function(t){var e,i=!1,n=this._scene.modelInstances;for(e in n)if(t&&t!=HOP_ALL){for(var s in n[e].tags)if(n[e].tags[s]==t&&n[e].useTransparency)return i=!0}else if(n[e].useTransparency)return i=!0;return i},setInstanceSpecularityByName:function(t,e,i,n){var s=this._scene.modelInstances;if(t==HOP_ALL)for(var o in s)s[o].specularColor=[e[0],e[1],e[2],i];else s[t]&&(s[t].specularColor=[e[0],e[1],e[2],i]);n&&this.repaint()},setInstanceSpecularity:function(t,e,i,n){var s,o=this._scene.modelInstances;for(s in o)if(t==HOP_ALL)o[s].specularColor=[e[0],e[1],e[2],i];else for(var r in o[s].tags)o[s].tags[r]==t&&(o[s].specularColor=[e[0],e[1],e[2],i]);n&&this.repaint()},setInstanceBackfaceByName:function(t,e,i,n){var s=this._scene.modelInstances,o=0;if("tint"==i?o=0:"fill"==i?o=1:"cull"==i&&(o=2),t==HOP_ALL)for(var r in s)s[r].backfaceColor=[e[0],e[1],e[2],o];else s[t]&&(s[t].backfaceColor=[e[0],e[1],e[2],o]);n&&this.repaint()},setInstanceBackface:function(t,e,i,n){var s,o=this._scene.modelInstances,r=0;for(s in"tint"==i?r=0:"fill"==i?r=1:"cull"==i&&(r=2),o)if(t==HOP_ALL)o[s].backfaceColor=[e[0],e[1],e[2],r];else for(var a in o[s].tags)o[s].tags[a]==t&&(o[s].backfaceColor=[e[0],e[1],e[2],r]);n&&this.repaint()},setInstanceVisibilityByName:function(t,e,i){var n=this._scene.modelInstances;if(t==HOP_ALL)for(var s in n)n[s].visible=e;else n[t]&&(n[t].visible=e);i&&this.repaint()},setInstanceVisibility:function(t,e,i){var n,s=this._scene.modelInstances;for(n in s)if(t==HOP_ALL)s[n].visible=e;else for(var o in s[n].tags)s[n].tags[o]==t&&(s[n].visible=e);i&&this.repaint()},toggleInstanceVisibilityByName:function(t,e){var i=this._scene.modelInstances;if(t==HOP_ALL)for(var n in i)i[n].visible=!i[n].visible;else i[t]&&(i[t].visible=!i[t].visible);e&&this.repaint()},toggleInstanceVisibility:function(t,e){var i,n=this._scene.modelInstances;for(i in n)if(t==HOP_ALL)n[i].visible=!n[i].visible;else for(var s in n[i].tags)n[i].tags[s]==t&&(n[i].visible=!n[i].visible);e&&this.repaint()},isInstanceVisibilityEnabledByName:function(t){var e=!1,i=this._scene.modelInstances;if(t&&t!=HOP_ALL){if(i[t]&&i[t].visible)return e=!0}else for(var n in i)if(i[n].visible)return e=!0;return e},isInstanceVisibilityEnabled:function(t){var e,i=!1,n=this._scene.modelInstances;for(e in n)if(t&&t!=HOP_ALL){for(var s in n[e].tags)if(n[e].tags[s]==t&&n[e].visible)return i=!0}else if(n[e].visible)return i=!0;return i},setSpotVisibilityByName:function(t,e,i){var n=this._scene.spots;if(t==HOP_ALL)for(var s in n)n[s].visible=e;else n[t]&&(n[t].visible=e);i&&this.repaint()},setSpotVisibility:function(t,e,i){var n,s=this._scene.spots;for(n in s)if(t==HOP_ALL)s[n].visible=e;else for(var o in s[n].tags)s[n].tags[o]==t&&(s[n].visible=e);i&&this.repaint()},toggleSpotVisibilityByName:function(t,e){var i=this._scene.spots;if(t==HOP_ALL)for(var n in i)i[n].visible=!i[n].visible;else i[t]&&(i[t].visible=!i[t].visible);e&&this.repaint()},toggleSpotVisibility:function(t,e){var i,n=this._scene.spots;for(i in n)if(t==HOP_ALL)n[i].visible=!n[i].visible;else for(var s in n[i].tags)n[i].tags[s]==t&&(n[i].visible=!n[i].visible);e&&this.repaint()},isSpotVisibilityEnabledByName:function(t){var e=!1,i=this._scene.spots;if(t&&t!=HOP_ALL){if(i[t]&&i[t].visible)return e=!0}else for(var n in i)if(i[n].visible)return e=!0;return e},isSpotVisibilityEnabled:function(t){var e,i=!1,n=this._scene.spots;for(e in n)if(t&&t!=HOP_ALL){for(var s in n[e].tags)if(n[e].tags[s]==t&&n[e].visible)return i=!0}else if(n[e].visible)return i=!0;return i},resetClippingXYZ:function(){this._calculateBounding(),this._clipAxis=[0,0,0],this._clipPoint=[0,0,0],this.repaint()},setClippingXYZ:function(t,e,i){this._calculateBounding(),this._clipAxis=[t,e,i],this.repaint()},setClippingX:function(t){this._calculateBounding(),this._clipAxis[0]=t,this.repaint()},setClippingY:function(t){this._calculateBounding(),this._clipAxis[1]=t,this.repaint()},setClippingZ:function(t){this._calculateBounding(),this._clipAxis[2]=t,this.repaint()},getClippingX:function(){return this._clipAxis[0]},getClippingY:function(){return this._clipAxis[1]},getClippingZ:function(){return this._clipAxis[2]},setClippingPointXYZabs:function(t,e,i){this._calculateBounding(),this._clipPoint=[t,e,i],this.repaint()},setClippingPointXabs:function(t){this._calculateBounding(),this._clipPoint[0]=t,this.repaint()},setClippingPointYabs:function(t){this._calculateBounding(),this._clipPoint[1]=t,this.repaint()},setClippingPointZabs:function(t){this._calculateBounding(),this._clipPoint[2]=t,this.repaint()},setClippingPointXYZ:function(t,e,i){var n=[0,0,0];this._calculateBounding(),t<0?t=0:1<t&&(t=1),e<0?e=0:1<e&&(e=1),i<0?i=0:1<i&&(i=1),n[0]=this._sceneBboxMin[0]+t*(this._sceneBboxMax[0]-this._sceneBboxMin[0]),n[1]=this._sceneBboxMin[1]+e*(this._sceneBboxMax[1]-this._sceneBboxMin[1]),n[2]=this._sceneBboxMin[2]+i*(this._sceneBboxMax[2]-this._sceneBboxMin[2]),this._clipPoint=n,this.repaint()},setClippingPointX:function(t){this._calculateBounding(),t<0?t=0:1<t&&(t=1),t=this._sceneBboxMin[0]+t*(this._sceneBboxMax[0]-this._sceneBboxMin[0]),this._clipPoint[0]=t,this.repaint()},setClippingPointY:function(t){this._calculateBounding(),t<0?t=0:1<t&&(t=1),t=this._sceneBboxMin[1]+t*(this._sceneBboxMax[1]-this._sceneBboxMin[1]),this._clipPoint[1]=t,this.repaint()},setClippingPointZ:function(t){this._calculateBounding(),t<0?t=0:1<t&&(t=1),t=this._sceneBboxMin[2]+t*(this._sceneBboxMax[2]-this._sceneBboxMin[2]),this._clipPoint[2]=t,this.repaint()},_calculateBounding:function(){var t,e=this._scene.meshes,i=this._scene.modelInstances,n=(this._sceneBboxMin=SglVec3.maxNumber(),this._sceneBboxMax=SglVec3.minNumber(),this._sceneBboxCenter=[0,0,0],[this._sceneBboxDiag=0,0,0]),s=[0,0,0];for(t in i){var o,r,a,l=e[i[t].mesh];l&&l.renderable&&i[t].clippable&&(o=SglVec3.to4(l.renderable.datasetCenter,1),o=SglMat4.mul4(l.transform.matrix,o),o=SglMat4.mul4(i[t].transform.matrix,o),o=SglMat4.mul4(this._scene.space.transform.matrix,o),o=SglVec4.to3(o),r=l.renderable.datasetRadius,a=SglVec3.one(),a=SglMat3.mul3(SglMat4.to33(l.transform.matrix),a),a=SglMat3.mul3(SglMat4.to33(i[t].transform.matrix),a),a=SglMat3.mul3(SglMat4.to33(this._scene.space.transform.matrix),a),r*=SglVec3.length(a)/SglVec3.length([1,1,1]),n[0]=o[0]-r,n[1]=o[1]-r,n[2]=o[2]-r,s[0]=o[0]+r,s[1]=o[1]+r,s[2]=o[2]+r,n[0]<this._sceneBboxMin[0]&&(this._sceneBboxMin[0]=n[0]),n[1]<this._sceneBboxMin[1]&&(this._sceneBboxMin[1]=n[1]),n[2]<this._sceneBboxMin[2]&&(this._sceneBboxMin[2]=n[2]),s[0]>this._sceneBboxMax[0]&&(this._sceneBboxMax[0]=s[0]),s[1]>this._sceneBboxMax[1]&&(this._sceneBboxMax[1]=s[1]),s[2]>this._sceneBboxMax[2])&&(this._sceneBboxMax[2]=s[2])}this._sceneBboxCenter[0]=(this._sceneBboxMin[0]+this._sceneBboxMax[0])/2,this._sceneBboxCenter[1]=(this._sceneBboxMin[1]+this._sceneBboxMax[1])/2,this._sceneBboxCenter[2]=(this._sceneBboxMin[2]+this._sceneBboxMax[2])/2,this._sceneBboxDiag=SglVec3.length([this._sceneBboxMax[0]-this._sceneBboxMin[0],this._sceneBboxMax[1]-this._sceneBboxMin[1],this._sceneBboxMax[2]-this._sceneBboxMin[2]])},setClippingRendermode:function(t,e,i,n){this._calculateBounding(),this._scene.config.showClippingPlanes=t,this._scene.config.showClippingBorder=e,0<i&&(this._scene.config.clippingBorderSize=i),n&&(this._scene.config.clippingBorderColor=n),this.repaint()},getClippingRendermode:function(){return[this._scene.config.showClippingPlanes,this._scene.config.showClippingBorder,this._scene.config.clippingBorderSize,this._scene.config.clippingBorderColor]},resetClippingPlane:function(){this._calculateBounding(),this._clipPlane=[0,0,0,0],this.repaint()},setClippingPlaneExplicit:function(t,e){this._calculateBounding(),this._clipPlane=[t[0],t[1],t[2],e],this.repaint()},setClippingPlane:function(t,e,i,n,s){this._calculateBounding();var o=SglMat4.identity(),e=(this._clipPlaneAH=t,this._clipPlaneAV=e,o=SglMat4.mul(o,SglMat4.rotationAngleAxis(sglDegToRad(t),[0,-1,0])),o=SglMat4.mul(o,SglMat4.rotationAngleAxis(sglDegToRad(e),[0,0,1])),t=SglMat4.mul4(o,[+i,0,0,1]),this._sceneBboxDiag/2*(n/100)),o=[this._sceneBboxCenter[0]+t[0]*(e=void 0!==s?s:e),this._sceneBboxCenter[1]+t[1]*e,this._sceneBboxCenter[2]+t[2]*e],e=SglVec3.dot([t[0],t[1],t[2]],o);this._clipPlane=[t[0],t[1],t[2],-e],this.repaint()},zoomIn:function(){this.onMouseWheel(1)},zoomOut:function(){this.onMouseWheel(-1)},rotateLight:function(t,e){t*=2,e*=2;var i=Math.sqrt(t*t+e*e),i=(1<=i&&(t/=i,e/=i,i=.999),Math.sqrt(1-i*i));this._lightDirection=[-t,-e,-i],this.repaint()},enableLightTrackball:function(t){(this._movingLight=t)&&!this._scene.space.sceneLighting&&(this._scene.space.sceneLighting=t),this.repaint()},isLightTrackballEnabled:function(){return this._movingLight},enableOnHover:function(t){this._onHover=t},isOnHoverEnabled:function(){return this._onHover},enableMeasurementTool:function(t){t?this._startMeasurement():this._stopMeasurement()},isMeasurementToolEnabled:function(){return this._isMeasuringDistance},enablePickpointMode:function(t){t?this._startPickPoint():this._stopPickPoint()},isPickpointModeEnabled:function(){return this._isMeasuringPickpoint},isAnyMeasurementEnabled:function(){return this._isMeasuring},toggleCameraType:function(){"orthographic"==this._scene.space.cameraType?this._scene.space.cameraType="perspective":this._scene.space.cameraType="orthographic",this.repaint()},setCameraPerspective:function(){this._scene.space.cameraType="perspective",this.repaint()},setCameraOrthographic:function(){this._scene.space.cameraType="orthographic",this.repaint()},getCameraType:function(){return this._scene.space.cameraType},toggleTrackballLock:function(){this._scene.trackball.locked=!this._scene.trackball.locked},setTrackballLock:function(t){this._scene.trackball.locked=t},isTrackballLockEnabled:function(){return this._scene.trackball.locked},enableSceneLighting:function(t){!(this._scene.space.sceneLighting=t)&&this._movingLight&&(this._movingLight=t),this.repaint()},isSceneLightingEnabled:function(){return this._scene.space.sceneLighting},setInstanceLightingByName:function(t,e,i){var n=this._scene.modelInstances;if(t==HOP_ALL)for(var s in n)n[s].useLighting=e;else n[t]&&(n[t].useLighting=e);i&&this.repaint()},setInstanceLighting:function(t,e,i){var n,s=this._scene.modelInstances;for(n in s)if(t==HOP_ALL)s[n].useLighting=e;else for(var o in s[n].tags)s[n].tags[o]==t&&(s[n].useLighting=e);i&&this.repaint()},toggleInstanceLightingByName:function(t,e){var i=this._scene.modelInstances;if(t==HOP_ALL)for(var n in i)i[n].useLighting=!i[n].useLighting;else i[t]&&(i[t].useLighting=!i[t].useLighting);e&&this.repaint()},toggleInstanceLighting:function(t,e){var i,n=this._scene.modelInstances;for(i in n)if(t==HOP_ALL)n[i].useLighting=!n[i].useLighting;else for(var s in n[i].tags)n[i].tags[s]==t&&(n[i].useLighting=!n[i].useLighting);e&&this.repaint()},isInstanceLightingEnabledByName:function(t){var e=!1,i=this._scene.modelInstances;if(t&&t!=HOP_ALL){if(i[t]&&i[t].useLighting)return e=!0}else for(var n in i)if(i[n].useLighting)return e=!0;return e},isInstanceLightingEnabled:function(t){var e,i=!1,n=this._scene.modelInstances;for(e in n)if(t&&t!=HOP_ALL){for(var s in n[e].tags)if(n[e].tags[s]==t&&n[e].useLighting)return i=!0}else if(n[e].useLighting)return i=!0;return i}};
var parsePly=function(){var canonicTypes={char:"int8",int8:"int8",uchar:"uint8",uint8:"uint8",short:"int16",int16:"int16",ushort:"uint16",uint16:"uint16",int:"int32",int32:"int32",uint:"uint32",uint32:"uint32",float:"float32",float32:"float32",double:"float64",float64:"float64"};function trim(e){for(var t=e,n=t.length,r=0,s=" \n\r\t";r<n&&0<=s.indexOf(t.charAt(r));)r++;for(r=(t=t.substring(r,t.length)).length-1;0<r&&0<=s.indexOf(t.charAt(r));)r--;return t=t.substring(0,r+1)}function extractHeader(e){if(!e||!e.view||!e.view.buffer)return null;for(var t,n=new Uint8Array(e.view.buffer),r="end_header",s="",i=!1,a=null,o=e.pos,l=0,o=0,u=n.byteLength;o<u;++o){if(s+=t=String.fromCharCode(n[o]),"\n"===t&&r.length<=o&&(l=o-r.length,"\r"==a&&l--,s.substring(l,l+r.length)==r)){i=!0;break}a=t}return e.pos=o,i?(e.pos++,s):null}function splitHeader(e){for(var t=e.split("\n"),n=[],r=null,s=null,i=0,a=t.length;i<a;++i)if((s=trim(t[i]))&&0<(r=s.split(" ")).length){for(var o=0,l=r.length;o<l;++o)r[o]=trim(r[o]);n.push(r)}return n}function parseHeader(e){if(!e||e.length<=0)return null;if("ply"!=e[0][0])return null;for(var t,n=null,r=null,s=null,i={format:null,elements:[],elementMap:{},comments:[],others:[]},a=1;a<e.length-1;++a)switch(t=(s=e[a]).length,s[0].toLowerCase()){case"format":3<=t&&(i.format={name:s[1],version:s[2],binary:0<=s[1].toLowerCase().indexOf("binary"),littleEndian:"binary_little_endian"==s[1].toLowerCase()});break;case"comment":i.comments.push(s.slice(1));break;case"element":3<=t&&(n={name:s[1],count:parseInt(s[2]),properties:[],propertyMap:{}},i.elements.push(n),i.elementMap[n.name.toLowerCase()]=n);break;case"property":n&&3<=t&&(r={name:s[t-1],type:s.slice(1,t-1)},n.properties.push(r),n.propertyMap[r.name.toLowerCase()]=r);break;default:i.others.push(s.slice())}return!!i.format&&i}var tabStr="\t";function setupLines(e,t){for(var n=0,r=e.length;n<r;++n)e[n]=t+e[n]}function generateReadValue(e,t,n,r,s,i,a,o){var l=[],u=t[n];if("list"==u.toLowerCase()){var p="n"+a,f="v"+a,h="i"+a;o[p]=!0,o[f]=!0,o[h]=!0,l=l.concat(l,generateReadValue(p,t,++n,r,s,"",++a,o)),n++,l.push(f+" = new Array("+p+");"),l.push("for ("+h+"=0; "+h+"<"+p+"; ++"+h+") {"),(l=l.concat(generateReadValue(f+"["+h+"]",t,n,r,s,tabStr,a,o))).push("}"),l.push(e+" = "+f+";")}else if(r)switch(u){case"char":case"int8":l.push(e+" = view.getInt8(pos, "+s+");"),l.push("pos += 1;");break;case"uchar":case"uint8":l.push(e+" = view.getUint8(pos, "+s+");"),l.push("pos += 1;");break;case"short":case"int16":l.push(e+" = view.getInt16(pos, "+s+");"),l.push("pos += 2;");break;case"ushort":case"uint16":l.push(e+" = view.getUint16(pos, "+s+");"),l.push("pos += 2;");break;case"int":case"int32":l.push(e+" = view.getInt32(pos, "+s+");"),l.push("pos += 4;");break;case"uint":case"uint32":l.push(e+" = view.getUint32(pos, "+s+");"),l.push("pos += 4;");break;case"float":case"float32":l.push(e+" = view.getFloat32(pos, "+s+");"),l.push("pos += 4;");break;case"double":case"float64":l.push(e+" = view.getFloat64(pos, "+s+");"),l.push("pos += 8;")}else switch(u){case"char":case"int8":case"uchar":case"uint8":case"short":case"int16":case"ushort":case"uint16":case"int":case"int32":case"uint":case"uint32":l.push(e+" = parseInt(view[pos]);"),l.push("pos += 1;");break;case"float":case"float32":case"double":case"float64":l.push(e+" = parseFloat(view[pos]);"),l.push("pos += 1;")}return setupLines(l,i),l}function generateReadProperty(e,t,n,r,s,i,a){return generateReadValue(e,t,0,n,r,"",i,a)}function generateReadElement(e,t,n,r,s,i,a){for(var o,l=[],u=0,p=t.length;u<p;++u)o=t[u],(l=l.concat(generateReadProperty(e+'["'+o.name+'"]',o.type,n,r,"",i,a))).push("");return setupLines(l,s),l}function generateReadElements(e,t,n,r,s,i,a){var o=[],l="n"+i,u="i"+i;return i++,a[l]=!0,a[u]=!0,a.element=!0,a.elem=!0,a.args=!0,o.push("element = info.elements["+e+"];"),o.push(l+" = element.count;"),o.push("elem = { };"),o.push("args = [ info, element, 0, elem];"),o.push("callbacks.onBeginElements.call(handler, info, element);"),o.push("for ("+u+"=0; "+u+"<"+l+"; ++"+u+") {"),(o=o.concat(generateReadElement("elem",t.properties,n,r,tabStr,i,a))).push(tabStr+"args[2] = "+u+";"),o.push(tabStr+"callbacks.onElement.apply(handler, args);"),o.push("}"),o.push("callbacks.onEndElements.call(handler, info, element);"),setupLines(o,s),o}function generateReadMesh(e,t,n){for(var r=[],s=(r.push("function (data, info, callbacks, handler) {"),r.push(tabStr+"var view = data.view;"),r.push(tabStr+"var pos  = data.pos;"),r.push(""),{}),i=[],a=0,o=e.length;a<o;++a)(i=i.concat(generateReadElements(a,e[a],t,n,tabStr,0,s))).push("");var l,u=[];for(l in s)u.push(l);u.sort(),r.push(tabStr+"var "+u.join(", ")+";"),r.push(""),r.push(tabStr+"callbacks.onBeginContent.call(handler, info);"),(r=r.concat(i)).push(tabStr+"callbacks.onEndContent.call(handler, info);"),r.push(tabStr+"data.pos = pos;"),r.push("}"),setupLines(r,"");for(var p="",a=0,o=r.length;a<o;++a)p+=r[a]+"\n";return p}function getMeshInfo(e){return(e=e&&extractHeader(e))&&(e=splitHeader(e))&&parseHeader(e)||null}function mainParsePly(buffer,handler){if(!buffer)return null;function emptyFunc(){}handler=handler||{};var callbacks={onBegin:handler.onBegin||emptyFunc,onHeader:handler.onHeader||emptyFunc,onBeginContent:handler.onBeginContent||emptyFunc,onBeginElements:handler.onBeginElements||emptyFunc,onElement:handler.onElement||emptyFunc,onEndElements:handler.onEndElements||emptyFunc,onEndContent:handler.onEndContent||emptyFunc,onEnd:handler.onEnd||emptyFunc},dataView=new DataView(buffer),data={view:dataView,pos:0},info=getMeshInfo(data),i;if(!info)return!1;for(i in info.format.binary||(data.view=Array.prototype.map.call(new Uint8Array(buffer,data.pos),function(e){return String.fromCharCode(e)}).join("").split(" "),data.pos=0),info.comments)"TextureFile"==info.comments[i][0]&&(handler._textureUrl=info.comments[i][1]);var readMeshStr=generateReadMesh(info.elements,info.format.binary,info.format.littleEndian),readMeshFunc=eval("("+readMeshStr+")"),e;for(e in info.elements)for(var p in info.elements[e].propertyMap)info.elements[e].propertyMap[p].canonicType=canonicTypes[info.elements[e].propertyMap[p].type];return callbacks.onBegin.call(handler),callbacks.onHeader.call(handler,info),readMeshFunc(data,info,callbacks,handler),callbacks.onEnd.call(handler),!0}return mainParsePly}(),importPly=function(){function emptyFunction(){}function propertiesTypes(){for(var e,t,n=[],r={},s=0;s<arguments.length;++s){if(!(e=arguments[s]))return n;r[e.canonicType]=1}for(t in r)n.push(t);return n}function PlyHandler(e){this._buffer=e,this._modelDescriptor=null,this._verticesCount=0,this._vertexAttributes=null,this._vertexStride=0,this._vertexBuffer=null,this._handleVertex=emptyFunction,this._facesCount=0,this._indexBuffer=null,this._handleFace=emptyFunction,this._view=null,this._hasPosition=null,this._hasNormal=null,this._hasColor=null,this._hasTexCoord=null,this._textureUrl=null,this._renderMode=["POINT"],this._boundingBox={min:[1e6,1e6,1e6],max:[-1e6,-1e6,-1e6]}}function mainImportPly(e){var t=new PlyHandler(e);return parsePly(e,t),t.modelDescriptor}return PlyHandler.prototype={get modelDescriptor(){return this._modelDescriptor},onBegin:function(){},onHeader:function(header){var tabStr="\t",elem=null,props=null,ptypes=null,verticesCount=0,vertexLines=null,vertexAttributes={},vertexStride=0,hasPosition=!1,hasNormal=!1,hasColor=!1,hasTexCoord=!1,elem=header.elementMap.vertex;if(elem&&0<elem.count){if(verticesCount=elem.count,props=elem.propertyMap,vertexLines=[],vertexLines.push("function (header, elementInfo, index, element) {"),vertexLines.push(tabStr+"var littleEndian = SpiderGL.Type.LITTLE_ENDIAN;"),vertexLines.push(tabStr+"var sf32         = SpiderGL.Type.SIZEOF_FLOAT32;"),vertexLines.push(tabStr+"var sui8         = SpiderGL.Type.SIZEOF_UINT8;"),vertexLines.push(tabStr+"var offset       = index * this._vertexStride;"),vertexLines.push(tabStr+"var view         = this._view;"),vertexLines.push(""),ptypes=propertiesTypes(props.x,props.y,props.z),1==ptypes.length&&(hasPosition=!0,"float32"===ptypes[0])&&(vertexLines.push(tabStr+"view.setFloat32(offset, element.x, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.y, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.z, littleEndian); offset += sf32;"),vertexLines.push(""),vertexAttributes.position={size:3,type:SpiderGL.Type.FLOAT32,offset:vertexStride},vertexStride+=3*SpiderGL.Type.SIZEOF_FLOAT32),ptypes=propertiesTypes(props.nx,props.ny,props.nz),1==ptypes.length&&(hasNormal=!0,"float32"===ptypes[0])&&(vertexLines.push(tabStr+"view.setFloat32(offset, element.nx, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.ny, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.nz, littleEndian); offset += sf32;"),vertexLines.push(""),vertexAttributes.normal={size:3,type:SpiderGL.Type.FLOAT32,offset:vertexStride},vertexStride+=3*SpiderGL.Type.SIZEOF_FLOAT32),ptypes=propertiesTypes(props.red,props.green,props.blue),1==ptypes.length)switch(hasColor=!0,ptypes[0]){case"uint8":vertexLines.push(tabStr+"view.setUint8(offset, element.red  ); offset += sui8;"),vertexLines.push(tabStr+"view.setUint8(offset, element.green); offset += sui8;"),vertexLines.push(tabStr+"view.setUint8(offset, element.blue ); offset += sui8;"),vertexLines.push(tabStr+"view.setUint8(offset, 255          ); offset += sui8;"),vertexLines.push(""),vertexAttributes.color={size:4,type:SpiderGL.Type.UINT8,offset:vertexStride,normalized:!0},vertexStride+=4*SpiderGL.Type.SIZEOF_UINT8;break;case"float32":vertexLines.push(tabStr+"view.setFloat32(offset, element.red,   littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.green, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.blue,  littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, 1.0,           littleEndian); offset += sf32;"),vertexLines.push(""),vertexAttributes.color={size:4,type:SpiderGL.Type.FLOAT32,offset:vertexStride},vertexStride+=4*SpiderGL.Type.SIZEOF_FLOAT32}ptypes=propertiesTypes(props.texture_u,props.texture_v),1==ptypes.length&&(hasTexCoord=!0,"float32"===ptypes[0])&&(vertexLines.push(tabStr+"view.setFloat32(offset, element.texture_u, littleEndian); offset += sf32;"),vertexLines.push(tabStr+"view.setFloat32(offset, element.texture_v, littleEndian); offset += sf32;"),vertexLines.push(""),vertexAttributes.texturecoord={size:2,type:SpiderGL.Type.FLOAT32,offset:vertexStride},vertexStride+=2*SpiderGL.Type.SIZEOF_FLOAT32),vertexLines.push("}")}var facesCount=0,faceLines=null,vertexFuncStr,faceFuncStr;elem=header.elementMap.face,elem&&0<elem.count&&(facesCount=elem.count,props=elem.propertyMap,faceLines=[],faceLines.push("function (header, elementInfo, index, element) {"),faceLines.push(tabStr+"var littleEndian = SpiderGL.Type.LITTLE_ENDIAN;"),faceLines.push(tabStr+"var sui32        = SpiderGL.Type.SIZEOF_UINT32;"),faceLines.push(tabStr+"var offset       = index * 3 * sui32;"),faceLines.push(tabStr+"var view         = this._view;"),faceLines.push(""),props.vertex_indices?(faceLines.push(tabStr+"view.setUint32(offset, element.vertex_indices[0], littleEndian); offset += sui32;"),faceLines.push(tabStr+"view.setUint32(offset, element.vertex_indices[1], littleEndian); offset += sui32;"),faceLines.push(tabStr+"view.setUint32(offset, element.vertex_indices[2], littleEndian); offset += sui32;")):props.vertex_index?(faceLines.push(tabStr+"view.setUint32(offset, element.vertex_index[0], littleEndian); offset += sui32;"),faceLines.push(tabStr+"view.setUint32(offset, element.vertex_index[1], littleEndian); offset += sui32;"),faceLines.push(tabStr+"view.setUint32(offset, element.vertex_index[2], littleEndian); offset += sui32;")):facesCount=0,faceLines.push("}")),this._mesh=null,this._hasPosition=hasPosition,this._hasNormal=hasNormal,this._hasColor=hasColor,this._hasTexCoord=hasTexCoord,this._verticesCount=verticesCount,this._vertexAttributes=vertexAttributes,this._vertexStride=vertexStride,this._vertexBuffer=null,this._handleVertex=emptyFunction,0<vertexStride&&(vertexFuncStr=vertexLines.join("\n"),this._handleVertex=eval("("+vertexFuncStr+")")),this._facesCount=facesCount,this._indexBuffer=null,this._handleFace=emptyFunction,0<facesCount&&(faceFuncStr=faceLines.join("\n"),this._handleFace=eval("("+faceFuncStr+")"))},onBeginContent:function(e){},onBeginElements:function(e,t){switch(t.name){case"vertex":this._vertexBuffer=new ArrayBuffer(this._verticesCount*this._vertexStride),this._view=new DataView(this._vertexBuffer),this._handleElement=this._handleVertex;break;case"face":this._indexBuffer=new ArrayBuffer(3*this._facesCount*SpiderGL.Type.SIZEOF_UINT32),this._view=new DataView(this._indexBuffer),this._handleElement=this._handleFace;break;default:this._view=null,this._handleElement=emptyFunction}},onElement:function(e,t,n,r){"vertex"==t.name&&(r.x<this._boundingBox.min[0]&&(this._boundingBox.min[0]=r.x),r.y<this._boundingBox.min[1]&&(this._boundingBox.min[1]=r.y),r.z<this._boundingBox.min[2]&&(this._boundingBox.min[2]=r.z),r.x>this._boundingBox.max[0]&&(this._boundingBox.max[0]=r.x),r.y>this._boundingBox.max[1]&&(this._boundingBox.max[1]=r.y),r.z>this._boundingBox.max[2])&&(this._boundingBox.max[2]=r.z),this._handleElement(e,t,n,r)},onEndElements:function(e,t){this._view=null,this._handleElement=emptyFunction},onEndContent:function(){},onEnd:function(){if(!(this._verticesCount<=0&&this._facesCount<=0)){var e={version:"0.0.1.0 EXP",meta:{},data:{vertexBuffers:{},indexBuffers:{}},access:{vertexStreams:{},primitiveStreams:{}},semantic:{bindings:{},chunks:{}},logic:{parts:{}},control:{},extra:{}},t=e.data.vertexBuffers,O=e.data.indexBuffers,n=e.access.vertexStreams,r=e.access.primitiveStreams,s=e.semantic.bindings,i=e.semantic.chunks,a=e.logic.parts,o=(e.extra.boundingBox=this._boundingBox,e.extra.renderMode=this._renderMode,e.extra.hasPosition=this._hasPosition,e.extra.hasNormal=this._hasNormal,e.extra.hasColor=this._hasColor,e.extra.hasTexCoord=this._hasTexCoord,e.extra.textureUrl=this._textureUrl,"mainVertexBuffer"),l="mainBinding",u="mainChunk",p="vertices",f="mainPart";if(0<this._facesCount){SpiderGL.Type.LITTLE_ENDIAN,SpiderGL.Type.SIZEOF_UINT32,Float64Array.BYTES_PER_ELEMENT;for(var h=this._vertexStride,M=new Uint8Array(this._vertexBuffer),G=new Uint32Array(this._indexBuffer),c=0,d=[],v=[],m=[],x=[],y=this._facesCount,b=0,_=new Uint32Array(3*this._facesCount);0<y;){for(var S=new Uint32Array(this._verticesCount),L=new Uint32Array(65535),g=0,w=0,E=0;g<=65532&&0<y;){for(var T=0;T<3;++T,++b){var F=G[b];S[F]||(S[L[g++]=F]=g),_[w++]=F}y--,E++}if(!(E<=0)){for(var C=new ArrayBuffer(g*h),z=new Uint8Array(C),R=new Uint16Array(w),B=0;B<w;++B)R[B]=S[_[B]]-1;for(var A,B=0,V=0;B<g;++B,V+=h)A=L[B]*h,z.set(M.subarray(A,A+h),V);d.push(C),v.push(g),m.push(R),x.push(w),c++}}for(var H=new Array(c),B=0;B<c;++B){var D="mainIndexBuffer"+B,Z=l+B,j=u+B,I=(t[P=o+B]={typedArray:d[B]},{vertexStreams:{},primitiveStreams:{}});for(N in s[Z]=I,this._vertexAttributes){var U=this._vertexAttributes[N],q=N+B;n[q]={buffer:P,size:U.size,type:U.type,stride:this._vertexStride,offset:U.offset,normalized:!!U.normalized},I.vertexStreams[N.toUpperCase()]=[q]}O[D]={typedArray:m[B]};var k=p+B,k=(r[k]={mode:SpiderGL.Type.POINTS,count:v[B]},I.primitiveStreams.POINT=[k],"triangles"+B);r[k]={buffer:D,mode:SpiderGL.Type.TRIANGLES,count:x[B],type:SpiderGL.Type.UINT16,offset:0},I.primitiveStreams.FILL=[k],i[j]={techniques:{common:{binding:Z}}},H[B]=j}a[f]={chunks:H},this._renderMode.unshift("FILL")}else{var P,N,I={vertexStreams:{},primitiveStreams:{}};if(s[l]=I,0<this._verticesCount){for(N in t[P=o]={typedArray:this._vertexBuffer},this._vertexAttributes){U=this._vertexAttributes[N];n[N]={buffer:P,size:U.size,type:U.type,stride:this._vertexStride,offset:U.offset,normalized:!!U.normalized},I.vertexStreams[N.toUpperCase()]=[N]}r[p]={mode:SpiderGL.Type.POINTS,count:this._verticesCount},I.primitiveStreams.POINT=[p]}(0<this._verticesCount||0<this._facesCount)&&(i[u]={techniques:{common:{binding:l}}},a[f]={chunks:[u]})}this._modelDescriptor=e}}},mainImportPly}();
function PanTiltTrackball(){}PanTiltTrackball.prototype={setup:function(t){t=t||{};t=sglGetDefaultObject({startCenter:[0,0,0],startPanX:0,startPanY:0,startAngleX:0,startAngleY:0,startDistance:2,minMaxDist:[.2,4],minMaxPanX:[-.7,.7],minMaxPanY:[-.7,.7],minMaxAngleX:[-70,70],minMaxAngleY:[-70,70],pathStates:[],animationLocked:!1,animationTime:null},t);this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._matrix=SglMat4.identity(),this._pathStates=t.pathStates,this._animationLocked=t.animationLocked,this._pathPosNum=0,this._center=t.startCenter,this._startPanX=t.startPanX,this._startPanY=t.startPanY,this._startAngleX=sglDegToRad(t.startAngleX),this._startAngleY=sglDegToRad(t.startAngleY),this._startDistance=t.startDistance,this._panX=this._startPanX,this._panY=this._startPanY,this._angleX=this._startAngleX,this._angleY=this._startAngleY,this._distance=this._startDistance,this._targetPanX=this._startPanX,this._targetPanY=this._startPanY,this._targetAngleX=this._startAngleX,this._targetAngleY=this._startAngleY,this._targetDistance=this._startDistance,this._isAnimating=!1,this._speedPanX=0,this._speedPanY=0,this._speedAngleX=0,this._speedAngleY=0,this._speedDistance=0,this._isAutoWalking=!1,this._animationTime=t.animationTime,this._minMaxDist=t.minMaxDist,this._minMaxPanX=t.minMaxPanX,this._minMaxPanY=t.minMaxPanY,this._minMaxAngleX=t.minMaxAngleX,this._minMaxAngleX[0]=sglDegToRad(this._minMaxAngleX[0]),this._minMaxAngleX[1]=sglDegToRad(this._minMaxAngleX[1]),this._minMaxAngleY=t.minMaxAngleY,this._minMaxAngleY[0]=sglDegToRad(this._minMaxAngleY[0]),this._minMaxAngleY[1]=sglDegToRad(this._minMaxAngleY[1]),this._start=[0,0],this.reset()},_clamp:function(t,i,s){return t<i?i:s<t?s:t},_computeMatrix:function(){var t=SglMat4.identity(),t=SglMat4.mul(t,SglMat4.translation([-this._center[0],-this._center[1],-this._center[2]]));t=SglMat4.mul(t,SglMat4.translation([0,0,-this._distance])),t=SglMat4.mul(t,SglMat4.rotationAngleAxis(this._angleY,[1,0,0])),t=SglMat4.mul(t,SglMat4.rotationAngleAxis(this._angleX,[0,-1,0])),t=SglMat4.mul(t,SglMat4.translation([this._panX,this._panY,0])),this._matrix=t,"undefined"!=typeof onTrackballUpdate&&onTrackballUpdate(this.getState())},getState:function(){return[this._panX,this._panY,sglRadToDeg(this._angleX),sglRadToDeg(this._angleY),this._distance]},setState:function(t){this._isAnimating=this._isAutoWalking=!1,this._panX=t[0],this._panY=t[1],this._angleX=sglDegToRad(t[2]),this._angleY=sglDegToRad(t[3]),this._distance=t[4],this._panX=this._clamp(this._panX,this._minMaxPanX[0],this._minMaxPanX[1]),this._panY=this._clamp(this._panY,this._minMaxPanY[0],this._minMaxPanY[1]),this._angleX=this._clamp(this._angleX,this._minMaxAngleX[0],this._minMaxAngleX[1]),this._angleY=this._clamp(this._angleY,this._minMaxAngleY[0],this._minMaxAngleY[1]),this._distance=this._clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._computeMatrix()},animateToState:function(t,i){var s,a,n,e,h;this._isAnimating=!1,t?(this._isAutoWalking=!1,this._targetPanX=t[0],this._targetPanY=t[1],this._targetAngleX=sglDegToRad(t[2]),this._targetAngleY=sglDegToRad(t[3]),this._targetDistance=t[4],this._targetPanX=this._clamp(this._targetPanX,this._minMaxPanX[0],this._minMaxPanX[1]),this._targetPanY=this._clamp(this._targetPanY,this._minMaxPanY[0],this._minMaxPanY[1]),this._targetAngleX=this._clamp(this._targetAngleX,this._minMaxAngleX[0],this._minMaxAngleX[1]),this._targetAngleY=this._clamp(this._targetAngleY,this._minMaxAngleY[0],this._minMaxAngleY[1]),this._targetDistance=this._clamp(this._targetDistance,this._minMaxDist[0],this._minMaxDist[1]),this._speedPanX=2,this._speedPanY=2,this._speedAngleX=Math.PI,this._speedAngleY=Math.PI,this._speedDistance=2,t=Math.abs((this._targetPanX-this._panX)/this._speedPanX),s=Math.abs((this._targetPanY-this._panY)/this._speedPanY),a=Math.abs((this._targetAngleX-this._angleX)/this._speedAngleX),n=Math.abs((this._targetAngleY-this._angleY)/this._speedAngleY),e=Math.abs((this._targetDistance-this._distance)/this._speedDistance),h=Math.max(t,Math.max(s,Math.max(a,Math.max(n,e)))),h=this._clamp(h,.5,2),i?h=i:this._animationTime&&(h=this._animationTime),this._speedPanX*=t/h,this._speedPanY*=s/h,this._speedAngleX*=a/h,this._speedAngleY*=n/h,this._speedDistance*=e/h):this._pathPosNum==this._pathStates.length?(this._isAutoWalking=!1,this._pathPosNum=0):(i=this._pathStates[this._pathPosNum][0],t=this._animationTime,Array.isArray(i)?this._pathStates[this._pathPosNum][1]&&(t=this._pathStates[this._pathPosNum][1]):i=this._pathStates[this._pathPosNum],this._isAutoWalking||this.animateToState(i,t),this._isAutoWalking=!0),this._isAnimating=!0},recenter:function(t){this._isAnimating=this._isAutoWalking=!1;var i=-(t[0]-presenter.sceneCenter[0])*presenter.sceneRadiusInv,t=-(t[1]-presenter.sceneCenter[1])*presenter.sceneRadiusInv;this.animateToState([i,t,sglRadToDeg(this._angleX),sglRadToDeg(this._angleY),.6*this._distance])},tick:function(t){var i,s,a,n,e,h,_,g,l;return!!this._isAnimating&&(i=this._speedPanX*t,s=this._speedPanY*t,a=this._speedAngleX*t,n=this._speedAngleY*t,t=this._speedDistance*t,e=this._targetPanX-this._panX,h=this._targetPanY-this._panY,_=this._targetAngleX-this._angleX,g=this._targetAngleY-this._angleY,l=this._targetDistance-this._distance,i<e?this._panX+=i:e<-i?this._panX-=i:this._panX=this._targetPanX,s<h?this._panY+=s:h<-s?this._panY-=s:this._panY=this._targetPanY,a<_?this._angleX+=a:_<-a?this._angleX-=a:this._angleX=this._targetAngleX,n<g?this._angleY+=n:g<-n?this._angleY-=n:this._angleY=this._targetAngleY,t<l?this._distance+=t:l<-t?this._distance-=t:this._distance=this._targetDistance,this._panX==this._targetPanX&&this._panX==this._targetPanX&&this._angleX==this._targetAngleX&&this._angleY==this._targetAngleY&&this._distance==this._targetDistance&&(this._isAnimating=!1,this._isAutoWalking)&&(this._pathPosNum++,this._isAutoWalking=!1,this.animateToState()),this._computeMatrix(),!0)},set action(t){this._action!=t&&(this._new_action=!0,this._action=t)},get action(){return this._action},get matrix(){return this._computeMatrix(),this._matrix},get distance(){return this._distance},reset:function(){this._matrix=SglMat4.identity(),this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._panX=this._startPanX,this._panY=this._startPanY,this._angleX=this._startAngleX,this._angleY=this._startAngleY,this._distance=this._startDistance,this._pathPosNum=0,this._isAutoWalking=!1,this._isAnimating=!1,this._computeMatrix()},track:function(t,i,s,a){this._animationLocked&&this._isAnimating&&(this._action=SGL_TRACKBALL_NO_ACTION),this._new_action&&(this._start[0]=i,this._start[1]=s,this._new_action=!1);var n=this._start[0]-i,e=this._start[1]-s;switch(this._start[0]=i,this._start[1]=s,this._action){case SGL_TRACKBALL_ROTATE:this._isAnimating=this._isAutoWalking=!1,this.rotate(t,n,e);break;case SGL_TRACKBALL_PAN:this._isAnimating=this._isAutoWalking=!1,this.pan(t,n,e);break;case SGL_TRACKBALL_SCALE:this._isAnimating=this._isAutoWalking=!1,this.scale(t,a)}return this._computeMatrix()},rotate:function(t,i,s){this._angleX+=i,this._angleY+=s,this._angleX=this._clamp(this._angleX,this._minMaxAngleX[0],this._minMaxAngleX[1]),this._angleY=this._clamp(this._angleY,this._minMaxAngleY[0],this._minMaxAngleY[1])},pan:function(t,i,s){var a=Math.max(Math.min(1.5,this._distance),.05);this._panX-=i/2*a,this._panY-=s/2*a,this._panX=this._clamp(this._panX,this._minMaxPanX[0],this._minMaxPanX[1]),this._panY=this._clamp(this._panY,this._minMaxPanY[0],this._minMaxPanY[1])},scale:function(t,i){this._distance*=i,this._distance=this._clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1])}};
function SphereTrackball(){}SphereTrackball.prototype={setup:function(t){t=t||{};t=sglGetDefaultObject({startCenter:[0,0,0],startDistance:2,minMaxDist:[.2,4]},t);this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._matrix=SglMat4.identity(),this._sphereMatrix=SglMat4.identity(),this._startDistance=t.startDistance,this._distance=this._startDistance,this._minMaxDist=t.minMaxDist,this._pts=[[0,0],[0,0]],this._start=[0,0],this.reset()},clamp:function(t,s,i){return t<s?s:i<t?i:t},_computeMatrix:function(){var t=SglMat4.identity(),t=SglMat4.mul(t,SglMat4.translation([0,0,-this._distance]));t=SglMat4.mul(t,this._sphereMatrix),this._matrix=t,"undefined"!=typeof onTrackballUpdate&&onTrackballUpdate(this.getState())},_projectOnSphere:function(s,i){s=sglSqrt(s*s+i*i);return s<.7071067811865476?sglSqrt(1-s*s):(t=.7071067811865475)*t/s},_transform:function(t,s,i,e){return SglMat4.mul4(t,[s,i,e,0])},_transformOnSphere:function(t,s,i){var e=this._projectOnSphere(s,i);return this._transform(t,s,i,e)},_translate:function(t,s){var i=SglMat4.inverse(this._sphereMatrix),t=SglVec3.to4(t,0),t=SglMat4.mul4(i,t),i=(t=SglVec4.muls(t,s),SglMat4.translation(t));this._sphereMatrix=SglMat4.mul(this._sphereMatrix,i)},getState:function(){return this._sphereMatrix},setState:function(t){this._sphereMatrix=t,this._computeMatrix()},animateToState:function(t){this._sphereMatrix=t,this._computeMatrix()},recenter:function(t){var s=(t[0]-presenter.sceneCenter[0])*presenter.sceneRadiusInv,i=(t[1]-presenter.sceneCenter[1])*presenter.sceneRadiusInv,t=(t[2]-presenter.sceneCenter[2])*presenter.sceneRadiusInv;this._sphereMatrix[12]=-s,this._sphereMatrix[13]=-i,this._sphereMatrix[14]=-t,this._distance*=.6,this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._computeMatrix()},tick:function(t){return!1},set action(t){this._action!=t&&(this._new_action=!0),this._action=t},get action(){return this._action},get matrix(){return this._computeMatrix(),this._matrix},get distance(){return this._distance},reset:function(){this._matrix=SglMat4.identity(),this._sphereMatrix=SglMat4.identity(),this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._distance=this._startDistance,this._pts=[[0,0],[0,0]],this._computeMatrix()},track:function(t,s,i,e){this._new_action&&(this._start[0]=s,this._start[1]=i,this._new_action=!1);var a=this._start[0]-s,r=this._start[1]-i;switch(this._start[0]=s,this._start[1]=i,this._pts[0][0]=this._pts[1][0]+a,this._pts[0][1]=this._pts[1][1]+r,this._pts[1][0]=a,this._pts[1][1]=r,this._action){case SGL_TRACKBALL_ROTATE:this.rotate(t);break;case SGL_TRACKBALL_PAN:this.pan(t);break;case SGL_TRACKBALL_DOLLY:this.dolly(t,e);break;case SGL_TRACKBALL_SCALE:this.scale(t,e)}},rotate:function(t){var s,i;this._pts[0][0]==this._pts[1][0]&&this._pts[0][1]==this._pts[1][1]||(t=SglMat4.inverse(t),s=this._transformOnSphere(t,this._pts[0][0],this._pts[0][1]),i=this._transformOnSphere(t,this._pts[1][0],this._pts[1][1]),i=this._transformOnSphere(t,this._pts[1][0],this._pts[1][1]),i=this._transformOnSphere(t,this._pts[1][0],this._pts[1][1]),t=SglVec3.cross(s,i),s=SglVec3.length(t),i=SglMat4.rotationAngleAxis(s,t),this._sphereMatrix=SglMat4.mul(i,this._sphereMatrix),this._computeMatrix())},pan:function(t){var t=SglMat4.inverse(t),s=this._transform(t,this._pts[0][0],this._pts[0][1],-1),t=this._transform(t,this._pts[1][0],this._pts[1][1],-1),t=SglVec3.sub(t,s);this._translate(t,2),this._computeMatrix()},dolly:function(t,s){t=SglMat4.inverse(t),t=this._transform(t,0,0,s);this._translate(t,1),this._computeMatrix()},scale:function(t,s){this._distance*=s,this._distance=this.clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._computeMatrix()}};
function TurnTableTrackball(){}TurnTableTrackball.prototype={setup:function(t){t=t||{};t=sglGetDefaultObject({startCenter:[0,0,0],startPhi:0,startTheta:0,startDistance:2,minMaxDist:[.2,4],minMaxPhi:[-180,180],minMaxTheta:[-80,80],pathStates:[],animationLocked:!1,animationTime:null},t);this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._matrix=SglMat4.identity(),this._pathStates=t.pathStates,this._animationLocked=t.animationLocked,this._pathPosNum=0,this._center=t.startCenter,this._startPhi=sglDegToRad(t.startPhi),this._startTheta=sglDegToRad(t.startTheta),this._startDistance=t.startDistance,this._phi=this._startPhi,this._theta=this._startTheta,this._distance=this._startDistance,this._targetPhi=this._startPhi,this._targetTheta=this._startTheta,this._targetDistance=this._startDistance,this._isAnimating=!1,this._speedPhi=0,this._speedTheta=0,this._speedDistance=0,this._isAutoWalking=!1,this._animationTime=t.animationTime,this._minMaxDist=t.minMaxDist,-180==t.minMaxPhi[0]&&180==t.minMaxPhi[1]?this._limitPhi=!1:this._limitPhi=!0,this._minMaxPhi=t.minMaxPhi,this._minMaxPhi[0]=sglDegToRad(this._minMaxPhi[0]),this._minMaxPhi[1]=sglDegToRad(this._minMaxPhi[1]),this._minMaxTheta=t.minMaxTheta,this._minMaxTheta[0]=sglDegToRad(this._minMaxTheta[0]),this._minMaxTheta[1]=sglDegToRad(this._minMaxTheta[1]),this._start=[0,0],this.reset()},_clamp:function(t,i,s){return t<i?i:s<t?s:t},_computeMatrix:function(){var t=SglMat4.identity(),t=SglMat4.mul(t,SglMat4.translation([-this._center[0],-this._center[1],-this._center[2]]));t=SglMat4.mul(t,SglMat4.translation([0,0,-this._distance])),t=SglMat4.mul(t,SglMat4.rotationAngleAxis(this._theta,[1,0,0])),t=SglMat4.mul(t,SglMat4.rotationAngleAxis(this._phi,[0,-1,0])),this._matrix=t,"undefined"!=typeof onTrackballUpdate&&onTrackballUpdate(this.getState())},getState:function(){return[sglRadToDeg(this._phi),sglRadToDeg(this._theta),this._distance]},setState:function(t){this._isAnimating=this._isAutoWalking=!1,this._phi=sglDegToRad(t[0]),this._theta=sglDegToRad(t[1]),this._distance=t[2],this._limitPhi&&(this._phi=this._clamp(this._phi,this._minMaxPhi[0],this._minMaxPhi[1])),this._theta=this._clamp(this._theta,this._minMaxTheta[0],this._minMaxTheta[1]),this._distance=this._clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._computeMatrix()},animateToState:function(t,i){var s,h,a;this._isAnimating=!1,t?(this._isAutoWalking=!1,this._targetPhi=sglDegToRad(t[0]),this._targetTheta=sglDegToRad(t[1]),this._targetDistance=t[2],this._limitPhi&&(this._targetPhi=this._clamp(this._targetPhi,this._minMaxPhi[0],this._minMaxPhi[1])),this._targetPhi=this._targetPhi%(2*Math.PI),this._targetTheta=this._clamp(this._targetTheta,this._minMaxTheta[0],this._minMaxTheta[1]),this._targetDistance=this._clamp(this._targetDistance,this._minMaxDist[0],this._minMaxDist[1]),this._speedPhi=Math.PI,this._speedTheta=Math.PI,this._speedDistance=2,this._limitPhi||(this._phi=this._phi%(2*Math.PI),t=this._targetPhi,Math.abs((t%=2*Math.PI)-this._phi)<Math.PI?t>this._phi?this.speedphi=Math.PI:this.speedphi=-Math.PI:t>this._phi?(t-=2*Math.PI,this.speedphi=-Math.PI):(t+=2*Math.PI,this.speedphi=Math.PI),this._targetPhi=t),t=Math.abs((this._targetPhi-this._phi)/this._speedPhi),s=Math.abs((this._targetTheta-this._theta)/this._speedTheta),h=Math.abs((this._targetDistance-this._distance)/this._speedDistance),a=Math.max(t,Math.max(s,h)),a=this._clamp(a,.5,2),i?a=i:this._animationTime&&(a=this._animationTime),this._speedPhi*=t/a,this._speedTheta*=s/a,this._speedDistance*=h/a):this._pathPosNum==this._pathStates.length?(this._isAutoWalking=!1,this._pathPosNum=0):(i=this._pathStates[this._pathPosNum][0],t=this._animationTime,Array.isArray(i)?this._pathStates[this._pathPosNum][1]&&(t=this._pathStates[this._pathPosNum][1]):i=this._pathStates[this._pathPosNum],this._isAutoWalking||this.animateToState(i,t),this._isAutoWalking=!0),this._isAnimating=!0},tick:function(t){var i,s,h,a,e;return!!this._isAnimating&&(i=this._speedPhi*t,s=this._speedTheta*t,t=this._speedDistance*t,h=this._targetPhi-this._phi,a=this._targetTheta-this._theta,e=this._targetDistance-this._distance,i<h?this._phi+=i:h<-i?this._phi-=i:this._phi=this._targetPhi,s<a?this._theta+=s:a<-s?this._theta-=s:this._theta=this._targetTheta,t<e?this._distance+=t:e<-t?this._distance-=t:this._distance=this._targetDistance,this._phi==this._targetPhi&&this._theta==this._targetTheta&&this._distance==this._targetDistance&&(this._isAnimating=!1,this._isAutoWalking)&&(this._pathPosNum++,this._isAutoWalking=!1,this.animateToState()),this._computeMatrix(),!0)},set action(t){this._action!=t&&(this._new_action=!0,this._action=t)},get action(){return this._action},get matrix(){return this._computeMatrix(),this._matrix},get distance(){return this._distance},reset:function(){this._matrix=SglMat4.identity(),this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._phi=this._startPhi,this._theta=this._startTheta,this._distance=this._startDistance,this._pathPosNum=0,this._isAutoWalking=!1,this._isAnimating=!1,this._computeMatrix()},track:function(t,i,s,h){this._animationLocked&&this._isAnimating&&(this._action=SGL_TRACKBALL_NO_ACTION),this._new_action&&(this._start[0]=i,this._start[1]=s,this._new_action=!1);var a=this._start[0]-i,e=this._start[1]-s;switch(this._start[0]=i,this._start[1]=s,this._action){case SGL_TRACKBALL_ROTATE:this._isAnimating=this._isAutoWalking=!1,this.rotate(t,a,e);break;case SGL_TRACKBALL_PAN:break;case SGL_TRACKBALL_SCALE:this._isAnimating=this._isAutoWalking=!1,this.scale(t,h)}return this._computeMatrix()},rotate:function(t,i,s){this._phi+=i,this._limitPhi&&(this._phi=this._clamp(this._phi,this._minMaxPhi[0],this._minMaxPhi[1])),10<this._phi&&(this._phi=this._phi-10),this._phi<-10&&(this._phi=this._phi+10),this._theta+=s,this._theta=this._clamp(this._theta,this._minMaxTheta[0],this._minMaxTheta[1])},scale:function(t,i){this._distance*=i,this._distance=this._clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1])}};
function TurntablePanTrackball(){}TurntablePanTrackball.prototype={setup:function(t){t=t||{};t=sglGetDefaultObject({startCenter:[0,0,0],startPhi:0,startTheta:0,startDistance:2,startPanX:0,startPanY:0,startPanZ:0,minMaxDist:[.2,4],minMaxPhi:[-180,180],minMaxTheta:[-80,80],minMaxPanX:[-1,1],minMaxPanY:[-1,1],minMaxPanZ:[-1,1],pathStates:[],animationLocked:!1,animationTime:null},t);this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._matrix=SglMat4.identity(),this._pathStates=t.pathStates,this._animationLocked=t.animationLocked,this._pathPosNum=0,this._center=t.startCenter,this._startPhi=sglDegToRad(t.startPhi),this._startTheta=sglDegToRad(t.startTheta),this._startPanX=t.startPanX,this._startPanY=t.startPanY,this._startPanZ=t.startPanZ,this._startDistance=t.startDistance,this._phi=this._startPhi,this._theta=this._startTheta,this._panX=this._startPanX,this._panY=this._startPanY,this._panZ=this._startPanZ,this._distance=this._startDistance,this._targetPhi=this._startPhi,this._targetTheta=this._startTheta,this._targetPanX=this._startPanX,this._targetPanY=this._startPanY,this._targetPanZ=this._startPanZ,this._targetDistance=this._startDistance,this._isAnimating=!1,this._speedPhi=0,this._speedTheta=0,this._speedPanX=0,this._speedPanY=0,this._speedPanZ=0,this._speedDistance=0,this._isAutoWalking=!1,this._animationTime=t.animationTime,this._minMaxDist=t.minMaxDist,-180==t.minMaxPhi[0]&&180==t.minMaxPhi[1]?this._limitPhi=!1:this._limitPhi=!0,this._minMaxPhi=t.minMaxPhi,this._minMaxPhi[0]=sglDegToRad(this._minMaxPhi[0]),this._minMaxPhi[1]=sglDegToRad(this._minMaxPhi[1]),this._minMaxTheta=t.minMaxTheta,this._minMaxTheta[0]=sglDegToRad(this._minMaxTheta[0]),this._minMaxTheta[1]=sglDegToRad(this._minMaxTheta[1]),this._minMaxPanX=t.minMaxPanX,this._minMaxPanY=t.minMaxPanY,this._minMaxPanZ=t.minMaxPanZ,this._start=[0,0],this.reset()},_clamp:function(t,i,a){return t<i?i:a<t?a:t},_computeMatrix:function(){var t=SglMat4.identity(),t=SglMat4.mul(t,SglMat4.translation([-this._center[0],-this._center[1],-this._center[2]]));t=SglMat4.mul(t,SglMat4.translation([0,0,-this._distance])),t=SglMat4.mul(t,SglMat4.rotationAngleAxis(this._theta,[1,0,0])),t=SglMat4.mul(t,SglMat4.rotationAngleAxis(this._phi,[0,-1,0])),t=SglMat4.mul(t,SglMat4.translation([-this._panX,-this._panY,-this._panZ])),this._matrix=t,"undefined"!=typeof onTrackballUpdate&&onTrackballUpdate(this.getState())},getState:function(){return[sglRadToDeg(this._phi),sglRadToDeg(this._theta),this._panX,this._panY,this._panZ,this._distance]},setState:function(t){this._isAnimating=this._isAutoWalking=!1,this._phi=sglDegToRad(t[0]),this._theta=sglDegToRad(t[1]),this._panX=t[2],this._panY=t[3],this._panZ=t[4],this._distance=t[5],this._limitPhi&&(this._phi=this._clamp(this._phi,this._minMaxPhi[0],this._minMaxPhi[1])),this._theta=this._clamp(this._theta,this._minMaxTheta[0],this._minMaxTheta[1]),this._distance=this._clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1]),this._panX=this._clamp(this._panX,this._minMaxPanX[0],this._minMaxPanX[1]),this._panY=this._clamp(this._panY,this._minMaxPanY[0],this._minMaxPanY[1]),this._panZ=this._clamp(this._panZ,this._minMaxPanZ[0],this._minMaxPanZ[1]),this._computeMatrix()},animateToState:function(t,i){var a,s,h,n,_,e;this._isAnimating=!1,t?(this._isAutoWalking=!1,this._targetPhi=sglDegToRad(t[0]),this._targetTheta=sglDegToRad(t[1]),this._targetPanX=t[2],this._targetPanY=t[3],this._targetPanZ=t[4],this._targetDistance=t[5],this._limitPhi&&(this._targetPhi=this._clamp(this._targetPhi,this._minMaxPhi[0],this._minMaxPhi[1])),this._targetPhi=this._targetPhi%(2*Math.PI),this._targetTheta=this._clamp(this._targetTheta,this._minMaxTheta[0],this._minMaxTheta[1]),this._targetPanX=this._clamp(this._targetPanX,this._minMaxPanX[0],this._minMaxPanX[1]),this._targetPanY=this._clamp(this._targetPanY,this._minMaxPanY[0],this._minMaxPanY[1]),this._targetPanZ=this._clamp(this._targetPanZ,this._minMaxPanZ[0],this._minMaxPanZ[1]),this._targetDistance=this._clamp(this._targetDistance,this._minMaxDist[0],this._minMaxDist[1]),this._speedPhi=Math.PI,this._speedTheta=Math.PI,this._speedPanX=1,this._speedPanY=1,this._speedPanZ=1,this._speedDistance=2,this._limitPhi||(this._phi=this._phi%(2*Math.PI),t=this._targetPhi,Math.abs((t%=2*Math.PI)-this._phi)<Math.PI?t>this._phi?this.speedphi=Math.PI:this.speedphi=-Math.PI:t>this._phi?(t-=2*Math.PI,this.speedphi=-Math.PI):(t+=2*Math.PI,this.speedphi=Math.PI),this._targetPhi=t),t=Math.abs((this._targetPhi-this._phi)/this._speedPhi),a=Math.abs((this._targetTheta-this._theta)/this._speedTheta),s=Math.abs((this._targetDistance-this._distance)/this._speedDistance),h=Math.abs((this._targetPanX-this._panX)/this._speedPanX),n=Math.abs((this._targetPanY-this._panY)/this._speedPanY),_=Math.abs((this._targetPanZ-this._panZ)/this._speedPanZ),e=Math.max(t,Math.max(a,Math.max(s,Math.max(h,Math.max(n,_))))),e=this._clamp(e,.5,2),i?e=i:this._animationTime&&(e=this._animationTime),this._speedPhi*=t/e,this._speedTheta*=a/e,this._speedDistance*=s/e,this._speedPanX*=h/e,this._speedPanY*=n/e,this._speedPanZ*=_/e):this._pathPosNum==this._pathStates.length?(this._isAutoWalking=!1,this._pathPosNum=0):(i=this._pathStates[this._pathPosNum][0],t=this._animationTime,Array.isArray(i)?this._pathStates[this._pathPosNum][1]&&(t=this._pathStates[this._pathPosNum][1]):i=this._pathStates[this._pathPosNum],this._isAutoWalking||this.animateToState(i,t),this._isAutoWalking=!0),this._isAnimating=!0},recenter:function(t){this._isAnimating=this._isAutoWalking=!1;var i=(t[0]-presenter.sceneCenter[0])*presenter.sceneRadiusInv,a=(t[1]-presenter.sceneCenter[1])*presenter.sceneRadiusInv,t=(t[2]-presenter.sceneCenter[2])*presenter.sceneRadiusInv;this.animateToState([sglRadToDeg(this._phi),sglRadToDeg(this._theta),i,a,t,.6*this._distance])},tick:function(t){var i,a,s,h,n,_,e,r,p,m,P;return!!this._isAnimating&&(i=this._speedPhi*t,a=this._speedTheta*t,s=this._speedDistance*t,h=this._speedPanX*t,n=this._speedPanY*t,t=this._speedPanZ*t,_=this._targetPhi-this._phi,e=this._targetTheta-this._theta,r=this._targetDistance-this._distance,p=this._targetPanX-this._panX,m=this._targetPanY-this._panY,P=this._targetPanZ-this._panZ,i<_?this._phi+=i:_<-i?this._phi-=i:this._phi=this._targetPhi,a<e?this._theta+=a:e<-a?this._theta-=a:this._theta=this._targetTheta,s<r?this._distance+=s:r<-s?this._distance-=s:this._distance=this._targetDistance,h<p?this._panX+=h:p<-h?this._panX-=h:this._panX=this._targetPanX,n<m?this._panY+=n:m<-n?this._panY-=n:this._panY=this._targetPanY,t<P?this._panZ+=t:P<-t?this._panZ-=t:this._panZ=this._targetPanZ,this._phi==this._targetPhi&&this._theta==this._targetTheta&&this._distance==this._targetDistance&&this._panX==this._targetPanX&&this._panY==this._targetPanY&&this._panZ==this._targetPanZ&&(this._isAnimating=!1,this._isAutoWalking)&&(this._pathPosNum++,this._isAutoWalking=!1,this.animateToState()),this._computeMatrix(),!0)},set action(t){this._action!=t&&(this._new_action=!0,this._action=t)},get action(){return this._action},get matrix(){return this._computeMatrix(),this._matrix},get distance(){return this._distance},reset:function(){this._matrix=SglMat4.identity(),this._action=SGL_TRACKBALL_NO_ACTION,this._new_action=!0,this._phi=this._startPhi,this._theta=this._startTheta,this._distance=this._startDistance,this._panX=this._startPanX,this._panY=this._startPanY,this._panZ=this._startPanZ,this._pathPosNum=0,this._isAutoWalking=!1,this._isAnimating=!1,this._computeMatrix()},track:function(t,i,a,s){this._animationLocked&&this._isAnimating&&(this._action=SGL_TRACKBALL_NO_ACTION),this._new_action&&(this._start[0]=i,this._start[1]=a,this._new_action=!1);var h=this._start[0]-i,n=this._start[1]-a;switch(this._start[0]=i,this._start[1]=a,this._action){case SGL_TRACKBALL_ROTATE:this._isAnimating=this._isAutoWalking=!1,this.rotate(t,h,n);break;case SGL_TRACKBALL_PAN:this._isAnimating=this._isAutoWalking=!1,this.pan(t,h,n);break;case SGL_TRACKBALL_SCALE:this._isAnimating=this._isAutoWalking=!1,this.scale(t,s)}return this._computeMatrix()},pan:function(t,i,a){var s=[1,0,0,1],h=[0,1,0,1],n=[0,0,1,1],s=SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi,[0,-1,0]),s),h=SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi,[0,-1,0]),h),n=SglMat4.mul4(SglMat4.rotationAngleAxis(this._phi,[0,-1,0]),n),_=(s=SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta,[1,0,0]),s),h=SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta,[1,0,0]),h),n=SglMat4.mul4(SglMat4.rotationAngleAxis(this._theta,[1,0,0]),n),Math.max(Math.min(1.5,this._distance),.05));this._panX+=(i*s[0]+a*s[1])*_,this._panY+=(i*h[0]+a*h[1])*_,this._panZ+=(i*n[0]+a*n[1])*_,this._panX=this._clamp(this._panX,this._minMaxPanX[0],this._minMaxPanX[1]),this._panY=this._clamp(this._panY,this._minMaxPanY[0],this._minMaxPanY[1]),this._panZ=this._clamp(this._panZ,this._minMaxPanZ[0],this._minMaxPanZ[1])},rotate:function(t,i,a){this._phi+=i,this._limitPhi&&(this._phi=this._clamp(this._phi,this._minMaxPhi[0],this._minMaxPhi[1])),10<this._phi&&(this._phi=this._phi-10),this._phi<-10&&(this._phi=this._phi+10),this._theta+=a,this._theta=this._clamp(this._theta,this._minMaxTheta[0],this._minMaxTheta[1])},scale:function(t,i){this._distance*=i,this._distance=this._clamp(this._distance,this._minMaxDist[0],this._minMaxDist[1])}};
function init3dhop(){isIOS()&&$("head").append('<meta name="viewport" content="width=device-width">');var i,t,n,s=0;$("#toolbar img").mouseenter(function(e){t=$(this).attr("id"),n?$(this).css("opacity","1.0"):$(this).css("opacity","0.8")}).mouseout(function(e){clearInterval(i),$(this).css("opacity","0.5")}).mousedown(function(e){t=$(this).attr("id"),n=!0,e.button==s&&(actionsToolbar(t),"zoomin"==t||"zoomout"==t?i=setInterval(function(){actionsToolbar(t)},100):clearInterval(i),$(this).css("opacity","1.0"),s=0)}).mouseup(function(e){n=!1,e.button==s&&(clearInterval(i),$(this).css("opacity","0.8"),s=0)}).on("touchstart",function(e){s=2}).on("touchend",function(e){s=0}),$(".output-table td:has(.output-text,.output-input)").css("border-radius","5px").css("background-color","rgba(125,125,125,0.25)"),$("#3dhop").on("touchstart pointerdown",function(e){$("#toolbar img").css("opacity","0.5")}).on("touchend pointerup",function(e){clearInterval(i)}).on("touchmove",function(e){clearInterval(i),$("#toolbar img").css("opacity","0.5")}),$("#3dhop:not(#draw-canvas)").on("contextmenu",function(e){return!1}),$("#draw-canvas").on("contextmenu",function(e){if(!isMobile())return!1}).on("touchstart pointerdown",function(e){$("#toolbar img").css("opacity","0.5")}).mousedown(function(e){$("#toolbar img").css("opacity","0.5"),e.preventDefault&&e.preventDefault(),window.getSelection&&""!=window.getSelection()?window.getSelection().removeAllRanges():document.selection&&""!=document.selection.createRange()&&document.selection.empty()}),$(document).on("MSFullscreenChange mozfullscreenchange webkitfullscreenchange",function(e){document.msFullscreenElement||document.mozFullScreen||document.webkitIsFullScreen||exitFullscreen()}),0<window.navigator.userAgent.indexOf("Trident/")&&($("#full").click(function(){enterFullscreen()}),$("#full_on").click(function(){exitFullscreen()})),$(window).on("resize",function(){var e,i=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?(e=Math.max(document.documentElement.clientWidth,window.innerWidth),window.innerHeight):(e=$("#3dhop").parent().width(),$("#3dhop").parent().height());resizeCanvas(e,i),presenter.ui.postDrawEvent()}),$(".close").mouseenter(function(){$(".close").css("display","none"),$(".close_on").css("display","inline")}),$(".close_on").mouseleave(function(){$(".close_on").css("display","none"),$(".close").css("display","inline")}),resizeCanvas($("#3dhop").parent().width(),$("#3dhop").parent().height()),anchorPanels(),set3dhlg()}function set3dhlg(){$("#tdhlg").css({right:2,bottom:2}),$("#tdhlg").html("Powered by 3DHOP</br>CNR &nbsp;&ndash;&nbsp; ISTI"),$("#tdhlg").mouseover(function(){$("#tdhlg").animate({height:"25px"},"fast")}).mouseout(function(){$("#tdhlg").animate({height:"13px"},"slow")}),$("#tdhlg").click(function(){window.open("http://vcg.isti.cnr.it/3dhop/","_blank")})}function lightSwitch(e){((e=void 0===e?presenter.isLightTrackballEnabled():e)?($("#light").css("visibility","hidden"),$("#light_on").css("visibility","visible"),$("#lighting_off").css("visibility","hidden"),$("#lighting")):($("#light_on").css("visibility","hidden"),$("#light"))).css("visibility","visible")}function lightingSwitch(e){((e=void 0===e?presenter.isSceneLightingEnabled():e)?($("#lighting_off").css("visibility","hidden"),$("#lighting")):($("#lighting").css("visibility","hidden"),$("#lighting_off").css("visibility","visible"),$("#light_on").css("visibility","hidden"),$("#light"))).css("visibility","visible")}function hotspotSwitch(e){((e=void 0===e?presenter.isSpotVisibilityEnabled():e)?($("#hotspot").css("visibility","hidden"),$("#hotspot_on")):($("#hotspot_on").css("visibility","hidden"),$("#hotspot"))).css("visibility","visible")}function pickpointSwitch(e){(e=void 0===e?presenter.isPickpointModeEnabled():e)?($("#pick").css("visibility","hidden"),$("#pick_on").css("visibility","visible"),$("#pickpoint-box").fadeIn().css("display","table"),$("#draw-canvas").css("cursor","crosshair")):(window.getSelection&&""!=window.getSelection()?window.getSelection().removeAllRanges():document.selection&&""!=document.selection.createRange()&&document.selection.empty(),$("#pick_on").css("visibility","hidden"),$("#pick").css("visibility","visible"),$("#pickpoint-box").css("display","none"),$("#pickpoint-output").html("[ 0 , 0 , 0 ]"),presenter.isAnyMeasurementEnabled()||$("#draw-canvas").css("cursor","default"))}function measureSwitch(e){(e=void 0===e?presenter.isMeasurementToolEnabled():e)?($("#measure").css("visibility","hidden"),$("#measure_on").css("visibility","visible"),$("#measure-box").fadeIn().css("display","table"),$("#draw-canvas").css("cursor","crosshair")):(window.getSelection&&""!=window.getSelection()?window.getSelection().removeAllRanges():document.selection&&""!=document.selection.createRange()&&document.selection.empty(),$("#measure_on").css("visibility","hidden"),$("#measure").css("visibility","visible"),$("#measure-box").css("display","none"),$("#measure-output").html("0.0"),presenter.isAnyMeasurementEnabled()||$("#draw-canvas").css("cursor","default"))}function colorSwitch(e){((e=void 0===e?"visible"==$("#color").css("visibility"):e)?($("#color").css("visibility","hidden"),$("#color_on")):($("#color_on").css("visibility","hidden"),$("#color"))).css("visibility","visible")}function cameraSwitch(e){((e=void 0===e?"visible"==$("#perspective").css("visibility"):e)?($("#perspective").css("visibility","hidden"),$("#orthographic")):($("#orthographic").css("visibility","hidden"),$("#perspective"))).css("visibility","visible")}function helpSwitch(e){((e=void 0===e?"visible"==$("#help").css("visibility"):e)?($("#help").css("visibility","hidden"),$("#help_on")):($("#help_on").css("visibility","hidden"),$("#help"))).css("visibility","visible")}function sectiontoolSwitch(e){(e=void 0===e?"visible"==$("#sections").css("visibility"):e)?($("#sections").css("visibility","hidden"),$("#sections_on").css("visibility","visible"),$("#sections-box").fadeIn().css("display","table"),$("#xplane, #yplane, #zplane").css("visibility","visible")):($("#sections_on").css("visibility","hidden"),$("#sections").css("visibility","visible"),$("#sections-box").css("display","none"),$("#sections-box img").css("visibility","hidden"),presenter.setClippingXYZ(0,0,0))}function sectiontoolInit(){presenter.setClippingPointXYZ(.5,.5,.5);var e=$("#xplaneSlider")[0],e=(e.min=0,e.max=1,e.step=.01,e.defaultValue=.5,e.oninput=function(){sectionxSwitch(!0),presenter.setClippingPointX(this.valueAsNumber)},e.onchange=function(){sectionxSwitch(!0),presenter.setClippingPointX(this.valueAsNumber)},$("#yplaneSlider")[0]),e=(e.min=0,e.max=1,e.step=.01,e.defaultValue=.5,e.oninput=function(){sectionySwitch(!0),presenter.setClippingPointY(this.valueAsNumber)},e.onchange=function(){sectionySwitch(!0),presenter.setClippingPointY(this.valueAsNumber)},$("#zplaneSlider")[0]),e=(e.min=0,e.max=1,e.step=.01,e.defaultValue=.5,e.oninput=function(){sectionzSwitch(!0),presenter.setClippingPointZ(this.valueAsNumber)},e.onchange=function(){sectionzSwitch(!0),presenter.setClippingPointZ(this.valueAsNumber)},$("#xplaneFlip")[0]),e=(e.defaultChecked=!1,e.onchange=function(){0!=presenter.getClippingX()&&(this.checked?presenter.setClippingX(-1):presenter.setClippingX(1))},$("#yplaneFlip")[0]),e=(e.defaultChecked=!1,e.onchange=function(){0!=presenter.getClippingY()&&(this.checked?presenter.setClippingY(-1):presenter.setClippingY(1))},$("#zplaneFlip")[0]),e=(e.defaultChecked=!1,e.onchange=function(){0!=presenter.getClippingZ()&&(this.checked?presenter.setClippingZ(-1):presenter.setClippingZ(1))},$("#showPlane")[0]),e=(e.defaultChecked=presenter.getClippingRendermode()[0],e.onchange=function(){presenter.setClippingRendermode(this.checked,presenter.getClippingRendermode()[1])},$("#showBorder")[0]);e.defaultChecked=presenter.getClippingRendermode()[1],e.onchange=function(){presenter.setClippingRendermode(presenter.getClippingRendermode()[0],this.checked)}}function sectiontoolReset(){presenter.setClippingPointXYZ(.5,.5,.5);var e=$("#xplaneSlider")[0],e=(e.value=e.defaultValue,$("#yplaneSlider")[0]),e=(e.value=e.defaultValue,$("#zplaneSlider")[0]),e=(e.value=e.defaultValue,$("#xplaneFlip")[0]);e.checked=e.defaultChecked,$("#yplaneFlip")[0].checked=e.defaultChecked;$("#zplaneFlip")[0].checked=e.defaultChecked;e=$("#showPlane")[0],e.checked=e.defaultChecked,presenter.setClippingRendermode(e.checked,presenter.getClippingRendermode()[1]),e=$("#showBorder")[0];e.checked=e.defaultChecked,presenter.setClippingRendermode(presenter.getClippingRendermode()[0],e.checked)}function sectionxSwitch(e){(e=void 0===e?0==presenter.getClippingX():e)?($("#xplane").css("visibility","hidden"),$("#xplane_on").css("visibility","visible"),$("#xplaneFlip")[0].checked?presenter.setClippingX(-1):presenter.setClippingX(1)):($("#xplane_on").css("visibility","hidden"),$("#xplane").css("visibility","visible"),presenter.setClippingX(0))}function sectionySwitch(e){(e=void 0===e?0==presenter.getClippingY():e)?($("#yplane").css("visibility","hidden"),$("#yplane_on").css("visibility","visible"),$("#yplaneFlip")[0].checked?presenter.setClippingY(-1):presenter.setClippingY(1)):($("#yplane_on").css("visibility","hidden"),$("#yplane").css("visibility","visible"),presenter.setClippingY(0))}function sectionzSwitch(e){(e=void 0===e?0==presenter.getClippingZ():e)?($("#zplane").css("visibility","hidden"),$("#zplane_on").css("visibility","visible"),$("#zplaneFlip")[0].checked?presenter.setClippingZ(-1):presenter.setClippingZ(1)):($("#zplane_on").css("visibility","hidden"),$("#zplane").css("visibility","visible"),presenter.setClippingZ(0))}function fullscreenSwitch(){"visible"==$("#full").css("visibility")?window.navigator.userAgent.indexOf("Trident/")<0&&enterFullscreen():window.navigator.userAgent.indexOf("Trident/")<0&&exitFullscreen()}function enterFullscreen(){var e;$("#full").css("visibility","hidden"),$("#full_on").css("visibility","visible"),isIOS()||(presenter._nativeWidth=presenter.ui.width,presenter._nativeHeight=presenter.ui.height,(e=$("#3dhop")[0]).msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),presenter.ui.postDrawEvent())}function exitFullscreen(){$("#full_on").css("visibility","hidden"),$("#full").css("visibility","visible"),isIOS()||(resizeCanvas(presenter._nativeWidth,presenter._nativeHeight),document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),presenter.ui.postDrawEvent())}function showPanel(e){$("#cover").css("display","table"),$(".panel").css("display","none"),$("#"+e).css("display","table")}function measurementSwitch(){presenter.isMeasurementToolEnabled()?($("#measure").css("visibility","hidden"),$("#measure_on").css("visibility","visible"),$("#measurebox").css("visibility","visible"),$("#draw-canvas").css("cursor","crosshair")):(window.getSelection&&""!=window.getSelection()?window.getSelection().removeAllRanges():document.selection&&""!=document.selection.createRange()&&document.selection.empty(),$("#measure_on").css("visibility","hidden"),$("#measure").css("visibility","visible"),$("#measurebox").css("visibility","hidden"),$("#measure-output").html("0.0"),presenter.isAnyMeasurementEnabled()||$("#draw-canvas").css("cursor","default"))}function moveToolbar(e,i){$("#toolbar").css("left",e),$("#toolbar").css("top",i),anchorPanels()}function movePickpointbox(e,i){$("#pickpoint-box").css("left",e),$("#pickpoint-box").css("top",i)}function moveMeasurementbox(e,i){$("#measure-box").css("left",e),$("#measure-box").css("top",i)}function moveSectionsbox(e,i){$("#sections-box").css("left",e),$("#sections-box").css("top",i)}function moveMeasurebox(e,i){$("#measurebox").css("right",e),$("#measurebox").css("top",i)}function resizeCanvas(e,i){$("#draw-canvas").attr("width",e),$("#draw-canvas").attr("height",i),$("#3dhop").css("width",e),$("#3dhop").css("height",i)}function anchorPanels(){$("#pickpoint-box")[0]&&$("#pick")[0]&&($("#pickpoint-box").css("left",$("#pick").position().left+$("#pick").width()+$("#toolbar").position().left+5),$("#pickpoint-box").css("top",$("#pick").position().top+$("#toolbar").position().top)),$("#measure-box")[0]&&$("#measure")[0]&&($("#measure-box").css("left",$("#measure").position().left+$("#measure").width()+$("#toolbar").position().left+5),$("#measure-box").css("top",$("#measure").position().top+$("#toolbar").position().top)),$("#sections-box")[0]&&$("#sections")[0]&&($("#sections-box").css("left",$("#sections").position().left+$("#sections").width()+$("#toolbar").position().left+5),$("#sections-box").css("top",$("#sections").position().top+$("#toolbar").position().top))}function isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function isMobile(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4))}
//# sourceMappingURL=3dviewer.min.js.map
