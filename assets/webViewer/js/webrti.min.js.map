{"version":3,"sources":["spidergl.js","multires.js"],"names":["SGL_VERSION_MAJOR","SGL_VERSION_MINOR","SGL_VERSION_REVISION","SGL_VERSION_STRING","sglUnknown","Error","sglUnsupported","sglUnimplemented","sglInvalidParameter","sglInvalidCall","sglDefineConstant","ClassName","constantName","constantValue","sglInherit","DerivedClassName","BaseClassName","prototype","constructor","sglInitialize","sglFinalize","sglNodeText","domNodeID","node","document","getElementById","str","n","firstChild","nodeType","textContent","nextSibling","sglLoadFile","url","callback","async","req","XMLHttpRequest","onreadystatechange","readyState","responseText","open","send","ret","sglGetLines","text","allLines","split","length","lines","line","i","replace","push","window","addEventListener","SGL_REQUEST_FAILED","SGL_REQUEST_SUCCEEDED","SGL_REQUEST_IDLE","SGL_REQUEST_ONGOING","SGL_REQUEST_ABORTED","SGL_REQUEST_QUEUED","SGL_REQUEST_REJECTED","SGL_REQUEST_CANCELLED","SglRequest","onReadyCallback","this","_priority","_status","_queue","_onReady","addOnReadyCallback","SglTextFileRequest","apply","Array","slice","call","arguments","_url","_req","Object","defineProperty","get","SglImageRequest","_img","SglRequestWatcher","reqs","_waitingReqs","_succeededReqs","_failedReqs","_reqs","t","cb","r","succeeded","failed","isReady","SglRequestQueue","maxOngoing","maxQueued","_maxOngoing","_maxQueued","_ongoing","_queued","_minPriorityReq","_priorityCompare","_dirty","_createOnReadyCallback","ok","_requestReady","status","priority","p","_updateRequest","f","removeOnReadyCallback","index","splice","queue","_send","cancel","_removeQueuedRequest","abort","_removeOngoingRequest","_abort","img","Image","crossOrigin","onload","complete","onerror","src","requests","onReady","_sort","sort","_updateMinPriority","comparePriorities","_removeFromArray","arr","elem","_execute","sendable","pop","a","b","priorityCompare","victims","result","toKill","SGL_PI","Math","PI","sglAbs","x","abs","sglFloor","floor","sglCeil","ceil","sglSqrt","sqrt","sglPow","y","pow","sglLog","log","sglExp","exp","sglSin","sin","sglAsin","asin","sglCos","cos","sglAcos","acos","sglTan","tan","sglAtan","atan","sglAtan2","atan2","sglDegToRad","sglRadToDeg","sglMin","min","sglMax","max","sglClamp","sglRandom01","random","sglMapVN","vArray","size","param","first","count","stride","undefined","last","v","k","j","sglMapV2","v2Array","sglMapV3","v3Array","sglMapV4","v4Array","sglUndefV2","sglV2V","sglV2S","s","sglV2C","sglZeroV2","sglOneV2","sglV2","sglDupV2","sglNegV2","sglAddV2","u","sglAddV2S","sglAddSV2","sglSubV2","sglSubV2S","sglSubSV2","sglMulV2","sglMulV2S","sglMulSV2","sglDivV2","sglDivV2S","sglDivSV2","sglRcpV2","sglDotV2","sglCrossV2","sglSqLengthV2","sglLengthV2","sglNormalizedV2","sglSelfNegV2","sglSelfAddV2","sglSelfAddV2S","sglSelfAddSV2","sglSelfSubV2","sglSelfSubV2S","sglSelfSubSV2","sglSelfMulV2","sglSelfMulV2S","sglSelfMulSV2","sglSelfDivV2","sglSelfDivV2S","sglSelfDivSV2","sglSelfRcpV2","sglSelfNormalizeV2","sglMinV2","sglMaxV2","sglV2toV3","z","sglV3C","sglV2toV4","w","sglV4C","sglUndefV3","sglV3V","sglV3S","sglZeroV3","sglOneV3","sglV3","sglDupV3","sglNegV3","sglAddV3","sglAddV3S","sglAddSV3","sglSubV3","sglSubV3S","sglSubSV3","sglMulV3","sglMulV3S","sglMulSV3","sglDivV3","sglDivV3S","sglDivSV3","sglRcpV3","sglDotV3","sglCrossV3","sglSqLengthV3","sglLengthV3","sglNormalizedV3","sglSelfNegV3","sglSelfAddV3","sglSelfAddV3S","sglSelfAddSV3","sglSelfSubV3","sglSelfSubV3S","sglSelfSubSV3","sglSelfMulV3","sglSelfMulV3S","sglSelfMulSV3","sglSelfDivV3","sglSelfDivV3S","sglSelfDivSV3","sglSelfRcpV3","sglSelfCrossV3","sglSelfNormalizeV3","sglMinV3","sglMaxV3","sglV3toV2","sglV3toV4","sglUndefV4","sglV4V","sglV4S","sglZeroV4","sglOneV4","sglV4","sglDupV4","sglNegV4","sglAddV4","sglAddV4S","sglAddSV4","sglSubV4","sglSubV4S","sglSubSV4","sglMulV4","sglMulV4S","sglMulSV4","sglDivV4","sglDivV4S","sglDivSV4","sglRcpV4","sglDotV4","sglSqLengthV4","sglLengthV4","sglNormalizedV4","sglProjectV4","sglSelfNegV4","sglSelfAddV4","sglSelfAddV4S","sglSelfAddSV4","sglSelfSubV4","sglSelfSubV4S","sglSelfSubSV4","sglSelfMulV4","sglSelfMulV4S","sglSelfMulSV4","sglSelfDivV4","sglSelfDivV4S","sglSelfDivSV4","sglSelfRcpV4","sglSelfNormalizeV4","sglSelfProjectV4","sglMinV4","sglMaxV4","sglV4toV2","sglV4toV3","sglUndefM4","sglM4V","sglM4S","m","sglDiagM4V","d","sglDiagM4S","sglDiagM4C","m00","m11","m22","m33","sglZeroM4","sglOneM4","sglIdentityM4","sglM4","sglDupM4","sglGetElemM4","row","col","sglSetElemM4","value","sglGetRowM4","sglSetRowM4V","sglSetRowM4S","sglSetRowM4C","sglGetColM4","c","sglSetColM4V","sglSetColM4S","sglSetColM4C","sglM4toM3","sglIsIdentityM4","sglNegM4","sglAddM4","sglAddM4S","sglAddSM4","sglSubM4","sglSubM4S","sglSubSM4","sglMulM4","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","a11","a12","a13","a14","a15","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15","sglMulM4S","sglMulSM4","sglMulM4V3","sglMulM4V4","sglDivM4S","sglDivSM4","sglRcpM4","sglCompMulM4","sglCompDivM4","sglTransposeM4","sglDeterminantM4","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m12","m13","m14","m15","sglInverseM4","sglTraceM4","sglTranslationM4V","sglTranslationM4C","sglTranslationM4S","sglRotationAngleAxisM4V","angleRad","axis","xx","yy","zz","xy","yz","zx","xs","ys","zs","ax","q","sglRotationAngleAxisM4C","ay","az","sglScalingM4V","sglScalingM4C","sglScalingM4S","sglLookAtM4V","position","target","up","sglLookAtM4C","positionX","positionY","positionZ","targetX","targetY","targetZ","upX","upY","upZ","sglOrthoM4V","omin","omax","sum","dif","sglOrthoM4C","left","right","bottom","top","zNear","zFar","sglFrustumM4V","fmin","fmax","sglFrustumM4C","sglPerspectiveM4","fovYRad","aspectRatio","pmin","pmax","sglUndefQuat","sglQuatV","sglIdentityQuat","sglAngleAxisQuat","halfAngle","fsin","sglM4Quat","trace","root","sglGetQuatAngleAxis","sqLen","invLen","aglAcos","sglGetQuatRotationM4","tx","ty","tz","twx","twy","twz","txx","txy","txz","tyy","tyz","tzz","sglNormalizedQuat","sglMulQuat","q1","q2","SglVec2","setVec","setScalar","setZero","SglVec3","SglVec4","SglPlane3","normal","offset","normalize","_normal","_offset","setup","SglBox3","_min","_max","SglSphere3","center","radius","_center","_radius","SglMatrixStack","_s","_n","SglTransformStack","_ms","_vs","_ps","_SglFrustumPlane","testVertex","clone","copy","set","setOne","at","squaredLength","dot","normalized","neg","minComp","maxComp","argMin","argMax","add","sub","mul","div","rcp","cross","o","slize","nomalize","isNull","isEmpty","squaredDiagonal","diagonal","facesAreas","surfaceArea","facesArea","volume","halfDelta","corner","transformed","matrix","addPoint","addBox","_redius","ss","reset","topRef","load","multiply","loadIdentity","translate","rotate","scale","lookAt","ortho","frustum","perspective","model","view","projection","modelMatrix","modelMatrixRef","modelMatrixTranspose","modelMatrixInverse","modelMatrixInverseTranspose","viewMatrix","viewMatrixRef","viewMatrixTranspose","viewMatrixInverse","viewMatrixInverseTranspose","projectionMatrix","projectionMatrixRef","projectionMatrixTranspose","projectionMatrixInverse","projectionMatrixInverseTranspose","modelViewMatrix","modelViewMatrixTranspose","modelViewMatrixInverse","modelViewMatrixInverseTranspose","viewProjectionMatrix","viewProjectionMatrixTranspose","viewProjectionMatrixInverse","viewProjectionMatrixInverseTranspose","modelViewProjectionMatrix","modelViewProjectionMatrixTranspose","modelViewProjectionMatrixInverse","modelViewProjectionMatrixInverseTranspose","worldSpaceNormalMatrix","viewSpaceNormalMatrix","modelSpaceViewerPosition","modelSpaceViewDirection","worldSpaceViewerPosition","worldSpaceViewDirection","ssglNegV3","nx","ny","nz","off","SGL_OUTSIDE_FRUSTUM","SGL_INTERSECT_FRUSTUM","SGL_INSIDE_FRUSTUM","SglFrustum","viewport","_mvpMatrix","_viewport","_vp","_billboardMatrix","_planes","sglBoxVisibility","boxMin","boxMax","boxVisibility","_sglConsolidateOptions","fullOptions","usedOptions","attr","sglGetBufferOptions","gl","options","usage","STATIC_DRAW","SglBufferInfo","handle","valid","sglBufferFromData","values","opt","buff","createBuffer","bindBuffer","bufferData","obj","sizeInBytes","sglVertexBufferFromData","ARRAY_BUFFER","sglIndexBufferFromData","ELEMENT_ARRAY_BUFFER","SglShaderInfo","type","sglShaderFromSource","shd","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","sglVertexShaderFromSource","VERTEX_SHADER","sglFragmentShaderFromSource","FRAGMENT_SHADER","SglProgramAttributeInfo","name","nativeType","location","SglProgramUniformInfo","SglProgramSamplerInfo","SglProgramInfo","shaders","attributes","uniforms","samplers","sglProgramFromShaders","prg","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attribs_count","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","unif","loc","uniforms_count","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","SAMPLER_2D","SAMPLER_CUBE","sglSetDefaultProgramBindings","sglProgramFromSources","vertexSources","fragmentSources","programInfo","vattr","bindAttribLocation","useProgram","unit","smp","uniform1i","sglProgramSynchronize","sglGetTextureOptions","minFilter","LINEAR","magFilter","wrapS","CLAMP_TO_EDGE","wrapT","isDepth","depthMode","LUMINANCE","depthCompareMode","COMPARE_R_TO_TEXTURE","depthCompareFunc","LEQUAL","generateMipmap","flipY","premultiplyAlpha","SglTextureInfo","format","width","height","sglTexture2DFromData","internalFormat","sourceFormat","sourceType","texels","FLOAT","Float32Array","Uint8Array","tex","createTexture","bindTexture","TEXTURE_2D","flipYEnabled","getParameter","UNPACK_FLIP_Y_WEBGL","flipYRequired","pixelStorei","texImage2D","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","DEPTH_TEXTURE_MODE","TEXTURE_COMPARE_MODE","TEXTURE_COMPARE_FUNC","sglTexture2DFromImage","image","RGBA","UNSIGNED_BYTE","sglTexture2DFromUrl","texInfo","sglTextureCubeFromData","facesTexels","TEXTURE_CUBE_MAP","TEXTURE_CUBE_MAP_POSITIVE_X","sglTextureCubeFromImages","images","sglTextureCubeFromUrls","urls","remaining","watcher","SglRenderbufferInfo","sglRenderbufferFromFormat","rb","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","sglGetFramebufferOptions","colorsAsRenderbuffer","depthAsRenderbuffer","stencilAsRenderbuffer","generateColorsMipmap","generateDepthMipmap","generateStencilMipmap","SglFramebufferInfo","colorTargets","depthTarget","stencilTarget","sglFramebufferFromTargets","fb","createFramebuffer","bindFramebuffer","FRAMEBUFFER","NONE","framebufferTexture2D","DEPTH_ATTACHMENT","framebufferRenderbuffer","STENCIL_ATTACHMENT","cts","drawBuffers","att","COLOR_ATTACHMENT0","ct","fbStatus","checkFramebufferStatus","trg","FRAMEBUFFER_COMPLETE","sglFramebufferFromFormats","colorFormats","depthFormat","stencilFormat","DEPTH_COMPONENT","STENCIL_COMPONENT","SglVertexBuffer","_info","SglIndexBuffer","SglProgramAttribute","program","info","_prog","SglProgramUniform","_func","BOOL","BOOL_VEC2","uniform2iv","BOOL_VEC3","uniform3iv","BOOL_VEC4","uniform4iv","INT","INT_VEC2","INT_VEC3","INT_VEC4","uniform1f","FLOAT_VEC2","uniform2fv","FLOAT_VEC3","uniform3fv","FLOAT_VEC4","uniform4fv","FLOAT_MAT2","uniformMatrix2fv","FALSE","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","SglProgramSampler","_unit","SglProgram","_attributes","_uniforms","_samplers","SglTexture2D","SglTextureCube","SglRenderbuffer","SglFramebuffer","_colorTargets","_depthTarget","_stencilTarget","SglAttributeStreamJS","byCopy","_name","_size","_buff","SglVertexStreamJS","_attribs","_length","rot","sc","scRcp","sMat","sMatInv","rMatInv","bminmax","fp","projectedSegmentSize","hs","p0","p1","p2","destroy","deleteBuffer","isValid","bind","unbind","getUniform","deleteProgram","deleteShader","setDefaultBindings","synchronize","setAttributes","mapping","link","setUniforms","setSamplers","deleteTexture","activeTexture","TEXTURE0","deleteRenderbuffer","deleteFramebuffer","targets","setViewport","vp","bindColor","unbindColor","bindDepth","unbindDepth","bindStencil","unbindStencil","colors","depth","stencil","attachColorTarget","detachColorTarget","buffer","addAttribute","removeAttribute","SGL_ARRAY_PRIMITIVE_STREAM","SGL_INDEXED_PRIMITIVE_STREAM","SGL_PACKED_INDEXED_PRIMITIVE_STREAM","SGL_POINTS_LIST","SGL_LINES_LIST","SGL_LINE_STRIP","SGL_LINE_LOOP","SGL_TRIANGLES_LIST","SGL_TRIANGLE_STRIP","SGL_TRIANGLE_FAN","SglPrimitiveStreamJS","mode","_mode","_first","SglArrayPrimitiveStreamJS","SglIndexedPrimitiveStreamJS","indices","SglConnectivityJS","_prims","SglMeshJS","_valid","_vert","_conn","sglMeshJSImportOBJFromString","mesh","positionsArray","texcoordsArray","normalsArray","indicesArray","positions","texcoords","normals","facemap","pos","nor","tokens","hasPos","hasTex","hasNor","lineIndex","parseFloat","parseInt","addVertexAttribute","addIndexedPrimitives","sglMeshJSImportOBJFromURL","asynch","txt","_sglFindVertexAttributeJSON","vertices","_sglFindConnectivityJSON","connectivity","sglMeshJSImportJSONFromString","JSON","parse","stdMapping","vm","source","semantic","conn","primitives","sglMeshJSImportJSONFromURL","sglGLTypeSize","BYTE","SHORT","UNSIGNED_SHORT","UNSIGNED_INT","sglGLTypeFromWebGLArray","wglArray","Int8Array","Int16Array","Uint16Array","Int32Array","Uint32Array","SglAttributeStreamGL","_type","_norm","_stride","SglVertexStreamGL","SglPrimitiveStreamGL","SglArrayPrimitiveStreamGL","SglIndexedPrimitiveStreamGL","_idxType","SglPackedIndexedPrimitiveStreamGL","blockStartingIndices","blockStartingVertices","_blockStartingVertices","_blockStartingIndices","_blockIndicesCount","start","sIdx","SglConnectivityGL","SglMeshGL","addArrayPrimitives","prim","removePrimitives","removeVertexAttribute","parseOBJ","importOBJ","parseJSON","importJSON","isNormalized","baseVertex","vertexAttribPointer","doDestroy","_clampRange","end","vEnd","_render","_destroy","render","range","drawArrays","drawElements","_clampBlockRange","block","blockRanges","firstBlock","lastBlock","ranges","renderBlock","addPackedIndexedPrimitives","SGL_DefaultStreamMappingPrefix","SglMeshGLRenderer","doSynchronize","_mapping","_meshAttrMap","_mesh","_primStream","_phase","_updateEnabledVB","synchronizeProgram","setStreamMapping","sglRenderMeshGLPrimitives","streamMapping","renderer","begin","renderMeshPrimitives","sglMeshJSCalculateBBox","meshJS","attribName","attrn","posAttrib","posSize","posBuffer","bbox","val","sglGLPrimitiveType","primType","POINTS","LINES","LINE_STRIP","LINE_LOOP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","sglMeshJStoGL","meshGL","ptype","sglPackMeshJStoGL","maxVertexIndex","primName","maxInd","pmode","ariety","srcIndices","startVertex","startIndex","startVertices","startIndices","newIndices","newAttribs","indicesMap","dstIndices","vtxCount","triIndices","newVerticesCount","srcIdx","dstIdx","idxCount","srcAttr","dstAttr","asize","dstBase","newArr","concat","srcBuff","dstBuff","_bindVertexBuffers","_unbindVertexBuffers","prog","doLink","getStreamMappingFromPrefix","prefix","substr","meshAttrName","progAttrName","progAttr","setStreamMappingFromPrefix","textures","disableVertexAttribArray","beginMesh","endMesh","beginPrimitives","endPrimitives","vIndex","enableVertexAttribArray","isPacked","blocksCount","blocks","calculateBoundingBox","toMeshGL","toPackedMeshGL","SGL_TRACKBALL_NO_ACTION","SGL_TRACKBALL_ROTATE","SGL_TRACKBALL_PAN","SGL_TRACKBALL_DOLLY","SGL_TRACKBALL_SCALE","SglTrackball","_matrix","_pts","_action","SglFirstPersonCamera","_position","_angles","sglGetCanvasContext","canvasID","canvas","contextNames","getContext","TRUE","SglCanvasUI","manager","handler","_manager","_handler","_canvas","_timerID","_updRate","_ignoreKeyRepeat","loadEvent","unloadEvent","keyDownEvent","keyUpEvent","keyPressEvent","mouseDownEvent","mouseUpEvent","mouseMoveEvent","mouseWheelEvent","clickEvent","dblClickEvent","resizeEvent","updateEvent","drawEvent","keysDown","mouseButtonsDown","mousePos","mousePrevPos","mouseDeltaPos","timeNow","Date","now","timePrev","timeDelta","_SglCanvasManager","updateRate","contentEditable","PACK_ALIGNMENT","UNPACK_ALIGNMENT","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_COLORSPACE_CONVERSION_WEBGL","ui","mgr","_drawPending","rendering","_drawFunc","draw","e","unload","keyDown","keyUp","keyPress","mouseDown","mouseUp","mouseMove","click","dblClick","resize","mouseWheel","blur","mouseOut","mouseOver","touchStart","touchEnd","touchMove","_projectOnSphere","_transform","_transformOnSphere","_translate","invMat","trMat","action","track","pan","dolly","mInv","rotMat","v0","dz","scaleMat","roll","viewDir","xOffset","yOffset","zOffset","pitchMat","yawMat","rotOffset","translateOnPlane","pitchOffset","yawOffset","rollOffset","ignoreKeyRepeat","updR","clearInterval","ms","setInterval","update","requestDraw","_getMouseClientPos","rct","getBoundingClientRect","clientX","clientY","setTimeout","doDraw","button","key","keyString","String","fromCharCode","keyCode","toLowerCase","toUpperCase","charCode","preventDefault","focus","delta","event","wheelDelta","opera","detail","touches","changedTouches","flush","_SGL_RegisteredCanvas","_sglManageCanvas","_sglUnmanageCanvas","_sglManageCanvasOnLoad","_sglUnmanageCanvasOnLoad","sglRegisterCanvas","sglRegisterLoadedCanvas","createRtiViewer","idDiv","imageUrlOrFunction","canvasHeight","canvasWidth","fullscreen","canvasContainer","$","canvasDiv","createElement","id","style","margin","append","canvasNode","canvasName","aNode","href","aNodeDiv","appendChild","cssFloat","toolbar","setAttribute","visibility","innerHTML","divHelp","fullScreenOff","exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen","multiResRTI","label","icons","primary","color","backgroundColor","display","startZoomIn","startZoomOut","trim","setMode","show","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","screen","fullScreenOn","removeClass","msFullscreenElement","mozFullScreen","webkitIsFullScreen","hide","divError","MultiRes","setImageUrl","setImageFunction","setOnLoadImageCallback","css","msg","stepAnimation","idTimer","flipAngles","onDrawCallback","animating","moveToCenter","imageUrl","imageFunction","OnLoadImageCallback","currentSpeed","maxStep","animationStack","isMoving","MultiResNode","parentIndex","childrenIndices","projectedSize","zScale","box","timestamp","error","Number","MAX_VALUE","data","isLeaf","MultiResTree","onloadCallback","ready","nodesCount","rootIndex","nodes","tileSize","forma","imgW","imgH","_MultiResAssert","cond","alert","_MultiResCompareNodes","MultiResRenderer","cacheSizeInBytes","onLoad","lg","_tree","_timestamp","_frustum","_maxError","_cache","_cacheSizeInBytes","_maxCacheSize","_maxOngoingRequests","_currentOngoingRequests","_toRequest","_toRenderFullRes","_toRenderHalfRes","_readyItems","renderData","renderBoxes","boxPositions","trianglesIndices","edgesIndices","_boxMesh","_tileFullMesh","_tileHalfMesh","_program","bvs","bfs","bprg","_boxProgram","_boxRenderer","_treeTransform","_normalizedTreeTransform","updateData","texProg","lgPositions","lgTexcoords","tmp","lgMesh","lgtex","_createLg","enumType","_setLightDir","lx","ly","norm","alpha","lpos","lightPos","lweights","computeLightingFunction","resetViewpoint","translation","mat","flipMatrix","xform","loadImage","leftBottom","imgWidth","imgHeight","rightTop","h","scale1","scale2","maxScale","viewerdx","viewerdy","stopRendering","setOnDrawCallback","onDraw","_startZoom","deltaPos","speed","tmpScale","deltaScale","that","moveInterval","zoomInterval","_zoomAnimation","step","tmpMat","returnModelMatrix","lb","rt","realwidth","realheight","deltaX","deltaY","lenght","_moveAnimation","computeModelMatrix","tempPos","endPoint","currentPoint","_updateMoveStack","sendMouseDown","endAnimation","tmpVector","_adjustTranslation","startPoint","deltaVect","movementVector","acceleration","tmpPoint","translVector","realDeltaX","realDeltaY","dt","translVect","scaleMatrix","normalizedTreeTransform","offsetHeight","getError","CONTEXT_LOST_WEBGL","console","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","_load","temp","nLevel","woffset","hoffset","imgBox","imgSize","imgCenter","parentNode","halfW","halfH","halfSize","diff","destroyData","idx","parent","child","phi","theta","cosPhi","cosTheta","cosTheta2","xhttp","targetURL","overrideMimeType","doc","responseXML","getElementsByTagName","getAttribute","isNaN","content","tree","bias","ordlen","numLayers","childNodes","nodeValue","gmax","gmin","_destroyData","vs","fs","_renderer","leftTex","rightTex","bottomTex","topTex","_setupTree","ctx","save","beginPath","moveTo","lineTo","closePath","clip","strokeStyle","lineCap","lineJoin","miterLimit","restore","transform","g","createRadialGradient","addColorStop","fillStyle","lineWidth","arc","fill","stroke","createLinearGradient","dataURL","toDataURL","texOpt","NEAREST","_createData","colorImgs","colorTexOpts","dataTextures","_requestNode","_collectNodesRec","parentFullyVisible","needed","usable","visStatus","neededCount","usableCount","cr","missingChildren","children","_collectNodes","_renderNodeFullRes","u_world_box_min","u_world_box_max","_renderNodesFullRes","mvp","u_model_view_projection_matrix","u_scale_bias","u_texcoord_scale_bias","_renderNodeHalfRes","scaleBias","_renderNodesHalfRes","nc","_renderNodes","_renderNodeFullResBox","sz","u_color","_renderNodesFullResBoxes","_renderNodeHalfResBox","_renderNodesHalfResBoxes","_renderNodesBoxes","depthFunc","LESS","_doRender","mv","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","quadUniforms","u_mvp","quadSamplers","s_texture","disable","_updateCache","readyItems","combined","cl","outOfCache","cimgs","fc","reinsertedCount","_requestNodes","cs","lastItem","requestableCount","requested","canRequest","_calculateNormalizedTreeTransform","rbox","bc","bs","maxDim","csize","quadPositions","quadMesh"],"mappings":"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","file":"webrti.min.js","sourcesContent":["/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// version\r\n/***********************************************************************/\r\nvar SGL_VERSION_MAJOR      = 0;\r\nvar SGL_VERSION_MINOR      = 1;\r\nvar SGL_VERSION_REVISION   = 1;\r\nvar SGL_VERSION_STRING     = SGL_VERSION_MAJOR + \".\" + SGL_VERSION_MINOR + \".\" + SGL_VERSION_REVISION;\r\n/***********************************************************************/\r\n\r\n\r\n// exceptions\r\n/***********************************************************************/\r\nfunction sglUnknown() {\r\n\tthrow new Error(\"SpiderGL : UNKNOWN\");\r\n}\r\n\r\nfunction sglUnsupported() {\r\n\tthrow new Error(\"SpiderGL : UNSUPPORTED\");\r\n}\r\n\r\nfunction sglUnimplemented() {\r\n\tthrow new Error(\"SpiderGL : UNIMPLEMENTED\");\r\n}\r\n\r\nfunction sglInvalidParameter() {\r\n\tthrow new Error(\"SpiderGL : INVALID_PARAMETER\");\r\n}\r\n\r\nfunction sglInvalidCall() {\r\n\tthrow new Error(\"SpiderGL : INVALID_CALL\");\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// utilities\r\n/***********************************************************************/\r\n/*function sglDefineGetter(ClassName, getterName, getterFunc, obj) {\r\n\tClassName.defineProperty(obj, getterName, {get: getterFunc});\r\n\t//ClassName.prototype.__defineGetter__(getterName, getterFunc);\r\n}\r\n\r\nfunction sglDefineSetter(ClassName, setterName, setterFunc, obj) {\r\n\tClassName.defineProperty(obj, setterName, {set: setterFunc});\r\n\t//ClassName.prototype.__defineSetter__(setterName, setterFunc);\r\n}*/\r\n\r\nfunction sglDefineConstant(ClassName, constantName, constantValue) {\r\n\tClassName[constantName] = constantValue;\r\n}\r\n\r\nfunction sglInherit(DerivedClassName, BaseClassName) {\r\n\tDerivedClassName.prototype = new BaseClassName();\r\n\tDerivedClassName.prototype.constructor = DerivedClassName;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// initialization - finalization\r\n/***********************************************************************/\r\nfunction sglInitialize() {\r\n\t;\r\n}\r\n\r\nfunction sglFinalize() {\r\n\t;\r\n}\r\n\r\nwindow.addEventListener(\"load\",   function() { sglInitialize(); }, false);\r\nwindow.addEventListener(\"unload\", function() { sglFinalize();   }, false);\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// DOM utilities\r\n/*********************************************************/\r\nfunction sglNodeText(domNodeID) {\r\n\tvar node = document.getElementById(domNodeID);\r\n\tif (!node) return null;\r\n\r\n\tvar str = \"\";\r\n\tvar n   = node.firstChild;\r\n\twhile (n) {\r\n\t\tif (n.nodeType == 3) {\r\n\t\t\tstr += n.textContent;\r\n\t\t}\r\n\t\tn = n.nextSibling;\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nfunction sglLoadFile(url, callback) {\r\n\tvar async = (callback) ? (true) : (false);\r\n\tvar req = new XMLHttpRequest();\r\n\r\n\tif (async) {\r\n\t\treq.onreadystatechange = function() {\r\n\t\t\tif (req.readyState == 4) {\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(req.responseText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\treq.open(\"GET\", url, async);\r\n\treq.send(null);\r\n\r\n\tvar ret = null;\r\n\tif (!async) {\r\n\t\tret = req.responseText;\r\n\t}\r\n\r\n\treturn ret;\r\n}\r\n\r\nfunction sglGetLines(text)\r\n{\r\n\tvar allLines = text.split(\"\\n\");\r\n\tvar n = allLines.length;\r\n\tvar lines = [ ];\r\n\tvar line = null;\r\n\tfor (var i=0; i<n; ++i) {\r\n\t\tline = allLines[i].replace(/[ \\t]+/g, \" \").replace(/\\s\\s*$/, \"\");\r\n\t\tif (line.length > 0) {\r\n\t\t\tlines.push(line);\r\n\t\t}\r\n\t}\r\n\treturn lines;\r\n}\r\n/*********************************************************/\r\n\r\n\r\n// SglRequest\r\n/*********************************************************/\r\nvar SGL_REQUEST_FAILED     = 0;\r\nvar SGL_REQUEST_SUCCEEDED  = 1;\r\nvar SGL_REQUEST_IDLE       = 2;\r\nvar SGL_REQUEST_ONGOING    = 3;\r\nvar SGL_REQUEST_ABORTED    = 4;\r\nvar SGL_REQUEST_QUEUED     = 5;\r\nvar SGL_REQUEST_REJECTED   = 6;\r\nvar SGL_REQUEST_CANCELLED  = 7;\r\n\r\n/**\r\n * Constructs a SglRequest.\r\n * @class Base class for an asynchronous request.\r\n */\r\nfunction SglRequest(onReadyCallback) {\r\n\tthis._priority = null;\r\n\tthis._status   = SGL_REQUEST_IDLE;\r\n\tthis._queue    = null;\r\n\tthis._onReady  = [ ];\r\n\tif (onReadyCallback) {\r\n\t\tthis.addOnReadyCallback(onReadyCallback);\r\n\t}\r\n}\r\n\r\nSglRequest.prototype = {\r\n\t_createOnReadyCallback : function() {\r\n\t\tvar t  = this;\r\n\t\tvar cb = function(ok) {\r\n\t\t\tt._status = (ok) ? (SGL_REQUEST_SUCCEEDED) : (SGL_REQUEST_FAILED);\r\n\t\t\tif (t._queue) {\r\n\t\t\t\tt._queue._requestReady(t);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tvar n = t._onReady.length;\r\n\t\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\t\tt._onReady[i](t);\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn cb;\r\n\t},\r\n\r\n\tget status() {\r\n\t\treturn this._status;\r\n\t},\r\n\r\n\tget priority() {\r\n\t\treturn this._priority;\r\n\t},\r\n\r\n\tset priority(p) {\r\n\t\tthis._priority = p;\r\n\t\tif (this._queue) {\r\n\t\t\tthis._queue._updateRequest(this);\r\n\t\t}\r\n\t},\r\n\r\n\tget succeeded() {\r\n\t\treturn (this._status == SGL_REQUEST_SUCCEEDED);\r\n\t},\r\n\r\n\tget failed() {\r\n\t\treturn (this._status == SGL_REQUEST_FAILED);\r\n\t},\r\n\r\n\taddOnReadyCallback : function(f) {\r\n\t\tif (f) {\r\n\t\t\tthis._onReady.push(f);\r\n\t\t\tif (this.isReady) {\r\n\t\t\t\tf(this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tremoveOnReadyCallback : function(f) {\r\n\t\tvar index = -1;\r\n\t\tvar n = this._onReady.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tif (this._onReady[i] == f) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (index < 0) return;\r\n\t\tthis._onReady.splice(index, 1);\r\n\t},\r\n\r\n\tget isReady() {\r\n\t\treturn (this.failed || this.succeeded);\r\n\t},\r\n\r\n\tget queue() {\r\n\t\treturn this._queue;\r\n\t},\r\n\r\n\tsend : function() {\r\n\t\tif (!this._send) return false;\r\n\t\tvar r = this._send();\r\n\t\tif (r) {\r\n\t\t\tthis._status = SGL_REQUEST_ONGOING;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._status = SGL_REQUEST_FAILED;\r\n\t\t\tvar cb = this._createOnReadyCallback();\r\n\t\t\tcb(false);\r\n\t\t}\r\n\t\treturn r;\r\n\t},\r\n\r\n\tcancel : function() {\r\n\t\tif (this._status == SGL_REQUEST_QUEUED) {\r\n\t\t\tif (this._queue) {\r\n\t\t\t\tthis._queue._removeQueuedRequest(this);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tthis._status = SGL_REQUEST_CANCELLED;\r\n\t\t}\r\n\t},\r\n\r\n\tabort : function() {\r\n\t\tthis.cancel();\r\n\t\tif (this._status == SGL_REQUEST_ONGOING) {\r\n\t\t\tif (this._queue) {\r\n\t\t\t\tthis._queue._removeOngoingRequest(this);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tif (this._abort) {\r\n\t\t\t\tthis._abort();\r\n\t\t\t}\r\n\t\t\tthis._status = SGL_REQUEST_ABORTED;\r\n\t\t}\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglTextFileRequest\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglTextFileRequest.\r\n * @class Asynchronous text file request.\r\n */\r\nfunction SglTextFileRequest(url, onReadyCallback) {\r\n\tSglRequest.apply(this, Array.prototype.slice.call(arguments, 1));\r\n\tthis._url = url;\r\n\tthis._req = null;\r\n\tObject.defineProperty(this, \"url\", {get: function(){return this._url;}});\r\n\tObject.defineProperty(this, \"text\", {get: function(){return this._req.responseText;}});\r\n}\r\n\r\nsglInherit(SglTextFileRequest, SglRequest);\r\n\r\n/*sglDefineGetter(SglTextFileRequest, \"url\", function() {\r\n\treturn this._url;\r\n});\r\n\r\nsglDefineGetter(SglTextFileRequest, \"text\", function() {\r\n\treturn this._req.responseText;\r\n});*/\r\n\r\nSglTextFileRequest.prototype._send = function() {\r\n\tif (!this._url) return false;\r\n\r\n\tvar req = new XMLHttpRequest();\r\n\tthis._req = req;\r\n\r\n\tvar cb = this._createOnReadyCallback();\r\n\treq.onreadystatechange = function() {\r\n\t\tif (req.readyState == 4) {\r\n\t\t\tvar ok = (req.status) ? (req.status == 200) : (true);\r\n\t\t\tcb(ok);\r\n\t\t}\r\n\t};\r\n\treq.open(\"GET\", this._url, true);\r\n\treq.send();\r\n\r\n\treturn true;\r\n};\r\n\r\nSglTextFileRequest.prototype._abort = function() {\r\n\tif (!this._req) return;\r\n\tthis._req.abort();\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglImageRequest\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglImageRequest.\r\n * @class Asynchronous image request.\r\n */\r\nfunction SglImageRequest(url, onReadyCallback) {\r\n\tSglRequest.apply(this, Array.prototype.slice.call(arguments, 1));\r\n\tthis._url = url;\r\n\tthis._img = null;\r\n\tObject.defineProperty(this, \"url\", {get: function(){return this._url;}});\r\n\tObject.defineProperty(this, \"image\", {get: function(){return this._img;}});\r\n}\r\n\r\nsglInherit(SglImageRequest, SglRequest);\r\n\r\nSglImageRequest.prototype._send = function() {\r\n\tif (!this._url) return false;\r\n\r\n\tvar img = new Image();\r\n\tthis._img = img;\r\n\timg.crossOrigin = '';\r\n\tvar cb = this._createOnReadyCallback();\r\n\timg.onload = function() {\r\n\t\tcb(img.complete);\r\n\t};\r\n\timg.onerror = function() {\r\n\t\tcb(false);\r\n\t};\r\n\timg.src = this._url;\r\n\r\n\treturn true;\r\n};\r\n\r\nSglImageRequest.prototype._abort = function() {\r\n\t;\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglRequestWatcher\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglRequestWatcher.\r\n * @class Watches for requests completion.\r\n */\r\nfunction SglRequestWatcher(reqs, onReadyCallback) {\r\n\tvar n = reqs.length;\r\n\r\n\tthis._onReady       = (onReadyCallback) ? (onReadyCallback) : (null);\r\n\tthis._waitingReqs   = n;\r\n\tthis._succeededReqs = 0;\r\n\tthis._failedReqs    = 0;\r\n\tthis._reqs          = reqs.slice();\r\n\r\n\tvar t  = this;\r\n\tvar cb = function(r) {\r\n\t\tif (r.succeeded) {\r\n\t\t\tt._succeededReqs++;\r\n\t\t}\r\n\t\telse if (r.failed) {\r\n\t\t\tt._failedReqs++;\r\n\t\t}\r\n\t\tt._waitingReqs--;\r\n\t\tif (t.isReady) {\r\n\t\t\tif (t._onReady) {\r\n\t\t\t\tt._onReady(t);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor (var i=0; i<n; ++i) {\r\n\t\tif (reqs[i].succeeded) {\r\n\t\t\tthis._succeededReqs++;\r\n\t\t\tthis._waitingReqs--;\r\n\t\t}\r\n\t\telse if (reqs[i].failed) {\r\n\t\t\tthis._failedReqs++;\r\n\t\t\tthis._waitingReqs--;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treqs[i].addOnReadyCallback(cb);\r\n\t\t}\r\n\t}\r\n\r\n\tif (this._waitingReqs <= 0) {\r\n\t\tif (this._onReady) {\r\n\t\t\tthis._onReady(this);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nSglRequestWatcher.prototype = {\r\n\tget requests() {\r\n\t\treturn this._reqs;\r\n\t},\r\n\r\n\tget succeeded() {\r\n\t\treturn (this._succeededReqs == this._reqs.length);\r\n\t},\r\n\r\n\tget failed() {\r\n\t\tif ((this._succeededReqs + this._failedReqs) < this._reqs.length) return false;\r\n\t\treturn (this._succeededReqs < this._reqs.length);\r\n\t},\r\n\r\n\tget onReady() {\r\n\t\treturn this._onReady;\r\n\t},\r\n\r\n\tset onReady(f) {\r\n\t\tthis._onReady = f;\r\n\t\tif (this.isReady) {\r\n\t\t\tif (this._onReady) {\r\n\t\t\t\tthis._onReady(t);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tget isReady() {\r\n\t\treturn ((this._succeededReqs + this._failedReqs) == this._reqs.length);\r\n\t},\r\n\r\n\tsend : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].send();\r\n\t\t}\r\n\t},\r\n\r\n\tcancel : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].cancel();\r\n\t\t}\r\n\t},\r\n\r\n\tabort : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].abort();\r\n\t\t}\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglRequestQueue\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglRequestQueue.\r\n * @class Asynchronous requests scheduler.\r\n */\r\nfunction SglRequestQueue(maxOngoing, maxQueued, onReadyCallback) {\r\n\tthis._maxOngoing = (maxOngoing > 0) ? (maxOngoing) : (0);\r\n\tthis._maxQueued  = (maxQueued  > 0) ? (maxQueued ) : (0);\r\n\r\n\tthis._ongoing = [ ];\r\n\tthis._queued  = [ ];\r\n\tthis._onReady = null;\r\n\tthis._minPriorityReq = null;\r\n\tthis._priorityCompare = null;\r\n\tthis._dirty = true;\r\n}\r\n\r\nSglRequestQueue.prototype = {\r\n\t_sort : function() {\r\n\t\tif (!this._dirty) return;\r\n\r\n\t\tthis._dirty = false;\r\n\t\tthis._minPriorityReq = null;\r\n\t\tif (this._queued.length <= 0) return;\r\n\r\n\t\tif (this._priorityCompare) {\r\n\t\t\tthis._queued.sort(this._priorityCompare);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._queued.sort();\r\n\t\t}\r\n\t\tif (this._queued.length > 0) {\r\n\t\t\tthis._minPriorityReq = this._queued[0];\r\n\t\t}\r\n\t},\r\n\r\n\t_updateMinPriority : function() {\r\n\t\tthis._minPriorityReq = null;\r\n\t\tvar n = this._queued.length;\r\n\t\tif (n <= 0) return;\r\n\r\n\t\tthis._minPriorityReq = this._queued[0];\r\n\t\tif (!this._dirty) return;\r\n\r\n\t\tfor (var i=1; i<n; ++i) {\r\n\t\t\tif (this.comparePriorities(this._queued[i].priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\tthis._minPriorityReq = this._queued[i];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_removeFromArray : function(arr, elem) {\r\n\t\tvar index = -1;\r\n\t\tvar n = arr.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tif (arr[i] == elem) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (index < 0) return;\r\n\t\tarr.splice(index, 1);\r\n\t},\r\n\r\n\t_removeQueuedRequest : function(r) {\r\n\t\tthis._removeFromArray(this._queued, r);\r\n\t\tif (this._queued.length <= 0) {\r\n\t\t\tthis._minPriorityReq = null;\r\n\t\t}\r\n\t\telse if (r == this._minPriorityReq) {\r\n\t\t\tthis._updateMinPriority();\r\n\t\t}\r\n\t},\r\n\r\n\t_removeOngoingRequest : function(r) {\r\n\t\tthis._removeFromArray(this._ongoing, r);\r\n\t\tthis._execute();\r\n\t},\r\n\r\n\t_updateRequest : function(r) {\r\n\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\tthis._minPriorityReq = r;\r\n\t\t}\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\t_requestReady : function(r) {\r\n\t\tthis._removeOngoingRequest(r);\r\n\t\tif (this._onReady) {\r\n\t\t\tthis._onReady(r);\r\n\t\t}\r\n\t\tthis._execute();\r\n\t},\r\n\r\n\t_execute : function() {\r\n\t\tvar n = this._queued.length;\r\n\t\tif (n <= 0) return;\r\n\t\tvar sendable = (this._maxOngoing > 0) ? (this._maxOngoing - this._ongoing.length) : (n)\r\n\t\tif (sendable <= 0) return;\r\n\t\tif (sendable > n) sendable = n;\r\n\t\tthis._sort();\r\n\t\tvar r = null;\r\n\t\tfor (var i=0; i<sendable; ++i) {\r\n\t\t\tr = this._queued.pop();\r\n\t\t\tr.send();\r\n\t\t}\r\n\t\tif (this._queued.length > 0) {\r\n\t\t\tthis._minPriorityReq = this._queued[0];\r\n\t\t}\r\n\t},\r\n\r\n\tcomparePriorities : function(a, b) {\r\n\t\tif (this._priorityCompare) {\r\n\t\t\treturn this._priorityCompare(a, b);\r\n\t\t}\r\n\t\treturn (a - b);\r\n\t},\r\n\r\n\tget priorityCompare() {\r\n\t\treturn this._priorityCompare;\r\n\t},\r\n\r\n\tset priorityCompare(f) {\r\n\t\tthis._priorityCompare = f;\r\n\t\tthis._updateMinPriority();\r\n\t},\r\n\r\n\tget onReady() {\r\n\t\treturn this._onReady;\r\n\t},\r\n\r\n\tset onReady(f) {\r\n\t\tthis._onReady = f;\r\n\t},\r\n\r\n\tpush : function(r) {\r\n\t\tvar ret = {\r\n\t\t\tvictims : null,\r\n\t\t\tresult  : false\r\n\t\t};\r\n\t\t\r\n\t\tif (r.queue) return ret;\r\n\t\tvar n = this._queued.length;\r\n\t\tvar overflow = ((this._maxQueued > 0) && (n >= this._maxQueued));\r\n\r\n\t\tif  (overflow) {\r\n\t\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\tr._status = SGL_REQUEST_REJECTED;\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._queued.push(r);\r\n\t\tr._queue  = this;\r\n\t\tr._status = SGL_REQUEST_QUEUED;\r\n\t\tn++;\r\n\r\n\t\tret.result = true;\r\n\t\r\n\t\tvar toKill = (this._maxQueued > 0) ? (n - this._maxQueued) : (0);\r\n\t\tif (toKill <= 0) {\r\n\t\t\tif (this._minPriorityReq != null) {\r\n\t\t\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\t\tthis._minPriorityReq = r;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._minPriorityReq = r;\r\n\t\t\t}\r\n\t\t\tthis._dirty = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._sort();\r\n\t\t\tret.victims = this._queued.slice(0, toKill);\r\n\t\t\tthis._queued.splice(0, toKill);\r\n\t\t\tfor (var i=0; i<toKill; ++i) {\r\n\t\t\t\tret.victims[i]._status = SGL_REQUEST_REJECTED;\r\n\t\t\t\tret.victims[i]._queue  = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._execute();\r\n\r\n\t\treturn ret;\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// math utilities\r\n/***********************************************************************/\r\nvar SGL_PI = Math.PI;\r\n\r\nfunction sglAbs(x) {\r\n\treturn Math.abs(x);\r\n}\r\n\r\nfunction sglFloor(x) {\r\n\treturn Math.floor(x);\r\n}\r\n\r\nfunction sglCeil(x) {\r\n\treturn Math.ceil(x);\r\n}\r\n\r\nfunction sglSqrt(x) {\r\n\treturn Math.sqrt(x);\r\n}\r\n\r\nfunction sglPow(x, y) {\r\n\treturn Math.pow(x, y);\r\n}\r\n\r\nfunction sglLog(x) {\r\n\treturn Math.log(x);\r\n}\r\n\r\nfunction sglExp(x) {\r\n\treturn Math.exp(x);\r\n}\r\n\r\nfunction sglSin(x) {\r\n\treturn Math.sin(x);\r\n}\r\n\r\nfunction sglAsin(x) {\r\n\treturn Math.asin(x);\r\n}\r\n\r\nfunction sglCos(x) {\r\n\treturn Math.cos(x);\r\n}\r\n\r\nfunction sglAcos(x) {\r\n\treturn Math.acos(x);\r\n}\r\n\r\nfunction sglTan(x) {\r\n\treturn Math.tan(x);\r\n}\r\n\r\nfunction sglAtan(x) {\r\n\treturn Math.atan(x);\r\n}\r\n\r\nfunction sglAtan2(y, x) {\r\n\treturn Math.atan2(y, x);\r\n}\r\n\r\nfunction sglDegToRad(x) {\r\n\treturn (x * (SGL_PI / 180.0));\r\n}\r\n\r\nfunction sglRadToDeg(x) {\r\n\treturn (x * (180.0 / SGL_PI));\r\n}\r\n\r\nfunction sglMin(a, b) {\r\n\treturn Math.min(a, b);\r\n}\r\n\r\nfunction sglMax(a, b) {\r\n\treturn Math.max(a, b);\r\n}\r\n\r\nfunction sglClamp(x, min, max) {\r\n\treturn ((x <= min) ? (min) : ((x >= max) ? (max) : (x)));\r\n}\r\n\r\nfunction sglRandom01() {\r\n\treturn Math.random();\r\n}\r\n\r\nfunction sglMapVN(vArray, size, f, param, first, count, stride) {\r\n\tfirst  = (first  != undefined) ? first  : 0;\r\n\tstride = (stride != undefined) ? stride : size;\r\n\tcount  = (count  != undefined) ? count  : ((vArray.length - first) / stride);\r\n\r\n\tvar last = first + count * stride;\r\n\tvar v    = new Array(n);\r\n\r\n\tvar k = 0;\r\n\tvar j = 0;\r\n\tfor (var i=first; i<last; i+=stride) {\r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\tv[j] = vArray[i+j];\r\n\t\t}\r\n\t\tf(v, param, k++);\r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\tvArray[i+j] = v[j];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction sglMapV2(v2Array, f, param, first, count, stride) {\r\n\tsglMapVN(v2Array, 2, f, param, first, count, stride);\r\n}\r\n\r\nfunction sglMapV3(v3Array, f, param, first, count, stride) {\r\n\tsglMapVN(v3Array, 3, f, param, first, count, stride);\r\n}\r\n\r\nfunction sglMapV4(v4Array, f, param, first, count, stride) {\r\n\tsglMapVN(v4Array, 4, f, param, first, count, stride);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// 2-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV2(v) {\r\n\treturn new Array(2);\r\n}\r\n\r\nfunction sglV2V(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV2S(s) {\r\n\treturn [ s, s ];\r\n}\r\n\r\nfunction sglV2C(x, y) {\r\n\treturn [ x, y ];\r\n}\r\n\r\nfunction sglZeroV2() {\r\n\treturn sglV2S(0.0);\r\n}\r\n\r\nfunction sglOneV2() {\r\n\treturn sglV2S(1.0);\r\n}\r\n\r\nfunction sglV2() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV2V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV2S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 2:\r\n\t\t\treturn sglV2V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV2();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglNegV2(v) {\r\n\treturn sglV2C(-v[0], -v[1]);\r\n}\r\n\r\nfunction sglAddV2(u, v) {\r\n\treturn sglV2C(u[0]+v[0], u[1]+v[1]);\r\n}\r\n\r\nfunction sglAddV2S(v, s) {\r\n\treturn sglV2C(v[0]+s, v[1]+s);\r\n}\r\n\r\nfunction sglAddSV2(s, v) {\r\n\treturn sglAddV2S(v, s)\r\n}\r\n\r\nfunction sglSubV2(u, v) {\r\n\treturn sglV2C(u[0]-v[0], u[1]-v[1]);\r\n}\r\n\r\nfunction sglSubV2S(v, s) {\r\n\treturn sglV2C(v[0]-s, v[1]-s);\r\n}\r\n\r\nfunction sglSubSV2(v, s) {\r\n\treturn sglV2C(s-v[0], s-v[1]);\r\n}\r\n\r\nfunction sglMulV2(u, v) {\r\n\treturn sglV2C(u[0]*v[0], u[1]*v[1]);\r\n}\r\n\r\nfunction sglMulV2S(v, s) {\r\n\treturn sglV2C(v[0]*s, v[1]*s);\r\n}\r\n\r\nfunction sglMulSV2(s, v) {\r\n\treturn sglMulV2S(v, s);\r\n}\r\n\r\nfunction sglDivV2(u, v) {\r\n\treturn sglV2C(u[0]/v[0], u[1]/v[1]);\r\n}\r\n\r\nfunction sglDivV2S(v, s) {\r\n\treturn sglV2C(v[0]/s, v[1]/s);\r\n}\r\n\r\nfunction sglDivSV2(s, v) {\r\n\treturn sglV2C(s/v[0], s/v[1]);\r\n}\r\n\r\nfunction sglRcpV2(v) {\r\n\treturn sglDivSV2(1.0, v);\r\n}\r\n\r\nfunction sglDotV2(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1]);\r\n}\r\n\r\nfunction sglCrossV2(u, v) {\r\n\treturn (u[0]*v[1] - u[1]*v[0]);\r\n}\r\n\r\nfunction sglSqLengthV2(v) {\r\n\treturn sglDotV2(v, v);\r\n}\r\n\r\nfunction sglLengthV2(v) {\r\n\treturn sglSqrt(sglSqLengthV2(v));\r\n}\r\n\r\nfunction sglNormalizedV2(v) {\r\n\tvar f = 1.0 / sglLengthV2(v);\r\n\treturn sglMulV2S(v, f);\r\n}\r\n\r\nfunction sglSelfNegV2(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV2(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV2S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV2(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV2(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV2S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV2(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV2(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV2S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV2(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV2(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV2S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV2(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV2(v) {\r\n\treturn sglSelfDivSV2(1.0, v);\r\n}\r\n\r\nfunction sglSelfNormalizeV2(v) {\r\n\tvar f = 1.0 / sglLengthV2(v);\r\n\treturn sglSelfMulV2S(v, f);\r\n}\r\n\r\nfunction sglMinV2(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV2(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1]))\r\n\t];\r\n}\r\n\r\nfunction sglV2toV3(v, z) {\r\n\treturn sglV3C(v[0], v[1], z);\r\n}\r\n\r\nfunction sglV2toV4(v, z, w) {\r\n\treturn sglV4C(v[0], v[1], z, w);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 3-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV3(v) {\r\n\treturn new Array(3);\r\n}\r\n\r\nfunction sglV3V(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n\r\nfunction sglV3S(s) {\r\n\treturn [ s, s, s ];\r\n}\r\n\r\nfunction sglV3C(x, y, z) {\r\n\treturn [ x, y, z ];\r\n}\r\n\r\nfunction sglZeroV3() {\r\n\treturn sglV3S(0.0);\r\n}\r\n\r\nfunction sglOneV3() {\r\n\treturn sglV3S(1.0);\r\n}\r\n\r\nfunction sglV3() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV3V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV3S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 3:\r\n\t\t\treturn sglV3V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV3();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV3(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n\r\nfunction sglNegV3(v) {\r\n\treturn sglV3C(-v[0], -v[1], -v[2]);\r\n}\r\n\r\nfunction sglAddV3(u, v) {\r\n\treturn sglV3C(u[0]+v[0], u[1]+v[1], u[2]+v[2]);\r\n}\r\n\r\nfunction sglAddV3S(v, s) {\r\n\treturn sglV3C(v[0]+s, v[1]+s, v[2]+s);\r\n}\r\n\r\nfunction sglAddSV3(s, v) {\r\n\treturn sglAddV3S(v, s)\r\n}\r\n\r\nfunction sglSubV3(u, v) {\r\n\treturn sglV3C(u[0]-v[0], u[1]-v[1], u[2]-v[2]);\r\n}\r\n\r\nfunction sglSubV3S(v, s) {\r\n\treturn sglV3C(v[0]-s, v[1]-s, v[2]-s);\r\n}\r\n\r\nfunction sglSubSV3(v, s) {\r\n\treturn sglV3C(s-v[0], s-v[1], s-v[2]);\r\n}\r\n\r\nfunction sglMulV3(u, v) {\r\n\treturn sglV3C(u[0]*v[0], u[1]*v[1], u[2]*v[2]);\r\n}\r\n\r\nfunction sglMulV3S(v, s) {\r\n\treturn sglV3C(v[0]*s, v[1]*s, v[2]*s);\r\n}\r\n\r\nfunction sglMulSV3(s, v) {\r\n\treturn sglMulV3S(v, s);\r\n}\r\n\r\nfunction sglDivV3(u, v) {\r\n\treturn sglV3C(u[0]/v[0], u[1]/v[1], u[2]/v[2]);\r\n}\r\n\r\nfunction sglDivV3S(v, s) {\r\n\treturn sglV3C(v[0]/s, v[1]/s, v[2]/s);\r\n}\r\n\r\nfunction sglDivSV3(s, v) {\r\n\treturn sglV3C(s/v[0], s/v[1], s/v[2]);\r\n}\r\n\r\nfunction sglRcpV3(v) {\r\n\treturn sglDivSV3(1.0, v);\r\n}\r\n\r\nfunction sglDotV3(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1] + u[2]*v[2]);\r\n}\r\n\r\nfunction sglCrossV3(u, v) {\r\n\treturn sglV3C(u[1]*v[2] - u[2]*v[1], u[2]*v[0] - u[0]*v[2], u[0]*v[1] - u[1]*v[0]);\r\n}\r\n\r\nfunction sglSqLengthV3(v) {\r\n\treturn sglDotV3(v, v);\r\n}\r\n\r\nfunction sglLengthV3(v) {\r\n\treturn sglSqrt(sglSqLengthV3(v));\r\n}\r\n\r\nfunction sglNormalizedV3(v) {\r\n\tvar f = 1.0 / sglLengthV3(v);\r\n\treturn sglMulV3S(v, f);\r\n}\r\n\r\nfunction sglSelfNegV3(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\tv[2] = -v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV3(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\tu[2] += v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV3S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV3(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV3(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\tu[2] -= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV3S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\tv[2] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV3(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\tv[2] = s - v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV3(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\tu[2] *= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV3S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV3(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV3(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\tu[2] /= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV3S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\tu[2] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV3(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\tv[2] = s / v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV3(v) {\r\n\treturn sglSelfDivSV3(1.0, v);\r\n}\r\n\r\nfunction sglSelfCrossV3(u, v) {\r\n\tvar t = sglV3C(u[1]*v[2] - u[2]*v[1], u[2]*v[0] - u[0]*v[2], u[0]*v[1] - u[1]*v[0]);\r\n\tu[0] = t[0];\r\n\tu[1] = t[1];\r\n\tu[2] = t[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfNormalizeV3(v) {\r\n\tvar f = 1.0 / sglLengthV3(v);\r\n\treturn sglSelfMulV3S(v, f);\r\n}\r\n\r\nfunction sglMinV3(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] < v[2]) ? (u[2]) : (v[2]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV3(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] > v[2]) ? (u[2]) : (v[2]))\r\n\t];\r\n}\r\n\r\nfunction sglV3toV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV3toV4(v, w) {\r\n\treturn sglV4C(v[0], v[1], v[2], w);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 4-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV4(v) {\r\n\treturn new Array(4);\r\n}\r\n\r\nfunction sglV4V(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglV4S(s) {\r\n\treturn [ s, s, s, s ];\r\n}\r\n\r\nfunction sglV4C(x, y, z, w) {\r\n\treturn [ x, y, z, w ];\r\n}\r\n\r\nfunction sglZeroV4() {\r\n\treturn sglV4S(0.0);\r\n}\r\n\r\nfunction sglOneV4() {\r\n\treturn sglV4S(1.0);\r\n}\r\n\r\nfunction sglV4() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV4V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV4S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 4:\r\n\t\t\treturn sglV4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV4();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV4(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglNegV4(v) {\r\n\treturn sglV4C(-v[0], -v[1], -v[2], -v[3]);\r\n}\r\n\r\nfunction sglAddV4(u, v) {\r\n\treturn sglV4C(u[0]+v[0], u[1]+v[1], u[2]+v[2], u[3]+v[3]);\r\n}\r\n\r\nfunction sglAddV4S(v, s) {\r\n\treturn sglV4C(v[0]+s, v[1]+s, v[2]+s, v[3]+s);\r\n}\r\n\r\nfunction sglAddSV4(s, v) {\r\n\treturn sglAddV4S(v, s)\r\n}\r\n\r\nfunction sglSubV4(u, v) {\r\n\treturn sglV4C(u[0]-v[0], u[1]-v[1], u[2]-v[2], u[3]-v[3]);\r\n}\r\n\r\nfunction sglSubV4S(v, s) {\r\n\treturn sglV4C(v[0]-s, v[1]-s, v[2]-s, v[3]-s);\r\n}\r\n\r\nfunction sglSubSV4(v, s) {\r\n\treturn sglV4C(s-v[0], s-v[1], s-v[2], s-v[3]);\r\n}\r\n\r\nfunction sglMulV4(u, v) {\r\n\treturn sglV4C(u[0]*v[0], u[1]*v[1], u[2]*v[2], u[3]*v[3]);\r\n}\r\n\r\nfunction sglMulV4S(v, s) {\r\n\treturn sglV4C(v[0]*s, v[1]*s, v[2]*s, v[3]*s);\r\n}\r\n\r\nfunction sglMulSV4(s, v) {\r\n\treturn sglMulV4S(v, s);\r\n}\r\n\r\nfunction sglDivV4(u, v) {\r\n\treturn sglV4C(u[0]/v[0], u[1]/v[1], u[2]/v[2], u[3]/v[3]);\r\n}\r\n\r\nfunction sglDivV4S(v, s) {\r\n\treturn sglV4C(v[0]/s, v[1]/s, v[2]/s, v[3]/s);\r\n}\r\n\r\nfunction sglDivSV4(s, v) {\r\n\treturn sglV4C(s/v[0], s/v[1], s/v[2], s/v[3]);\r\n}\r\n\r\nfunction sglRcpV4(v) {\r\n\treturn sglDivSV4(1.0, v);\r\n}\r\n\r\nfunction sglDotV4(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1] + u[2]*v[2] + u[3]*v[3]);\r\n}\r\n\r\nfunction sglSqLengthV4(v) {\r\n\treturn sglDotV4(v, v);\r\n}\r\n\r\nfunction sglLengthV4(v) {\r\n\treturn sglSqrt(sglSqLengthV4(v));\r\n}\r\n\r\nfunction sglNormalizedV4(v) {\r\n\tvar f = 1.0 / sglLengthV4(v);\r\n\treturn sglMulV4S(v, f);\r\n}\r\n\r\nfunction sglProjectV4(v) {\r\n\tvar f = 1.0 / v[3];\r\n\treturn sglV4C(v[0]*f, v[1]*f, v[2]*f, 1.0);\r\n}\r\n\r\nfunction sglSelfNegV4(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\tv[2] = -v[2];\r\n\tv[3] = -v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV4(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\tu[2] += v[2];\r\n\tu[3] += v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV4S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\tv[3] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV4(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\tv[3] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV4(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\tu[2] -= v[2];\r\n\tu[3] -= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV4S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\tv[2] -= s;\r\n\tv[3] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV4(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\tv[2] = s - v[2];\r\n\tv[3] = s - v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV4(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\tu[2] *= v[2];\r\n\tu[3] *= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV4S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\tv[3] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV4(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\tv[3] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV4(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\tu[2] /= v[2];\r\n\tu[3] /= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV4S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\tu[2] /= s;\r\n\tu[3] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV4(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\tv[2] = s / v[2];\r\n\tv[3] = s / v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV4(v) {\r\n\treturn sglSelfDivSV4(1.0, v);\r\n}\r\n\r\nfunction sglSelfNormalizeV4(v) {\r\n\tvar f = 1.0 / sglLengthV4(v);\r\n\treturn sglSelfMulV4S(v, f);\r\n}\r\n\r\nfunction sglSelfProjectV4(v) {\r\n\tvar f = 1.0 / v[3];\r\n\tv[0] *= f;\r\n\tv[1] *= f;\r\n\tv[2] *= f;\r\n\tv[3]  = 1.0;\r\n\treturn v;\r\n}\r\n\r\nfunction sglMinV4(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] < v[2]) ? (u[2]) : (v[2])),\r\n\t\t((u[3] < v[3]) ? (u[3]) : (v[3]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV4(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] > v[2]) ? (u[2]) : (v[2])),\r\n\t\t((u[3] > v[3]) ? (u[3]) : (v[3]))\r\n\t];\r\n}\r\n\r\nfunction sglV4toV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV4toV3(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 4x4 matrix\r\n/***********************************************************************/\r\nfunction sglUndefM4() {\r\n\treturn new Array(16);\r\n}\r\n\r\nfunction sglM4V(v) {\r\n\treturn v.slice(0, 16);\r\n}\r\n\r\nfunction sglM4S(s) {\r\n\tvar m = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tm[i] = s;\r\n\t}\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4V(d) {\r\n\tvar m = sglM4S(0.0);\r\n\tm[ 0] = d[0];\r\n\tm[ 5] = d[1];\r\n\tm[10] = d[2];\r\n\tm[15] = d[3];\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4S(s) {\r\n\tvar m = sglM4S(0.0);\r\n\tm[ 0] = s;\r\n\tm[ 5] = s;\r\n\tm[10] = s;\r\n\tm[15] = s;\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4C(m00, m11, m22, m33) {\r\n\treturn sglDiagM4V(arguments);\r\n}\r\n\r\nfunction sglZeroM4() {\r\n\treturn sglM4S(0.0);\r\n}\r\n\r\nfunction sglOneM4() {\r\n\treturn sglM4S(1.0);\r\n}\r\n\r\nfunction sglIdentityM4() {\r\n\treturn sglDiagM4S(1.0);\r\n}\r\n\r\nfunction sglM4() {\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tswitch (arguments[0].length) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\treturn sglDiagM4S(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\treturn sglDiagM4V(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 16:\r\n\t\t\t\t\t\treturn sglM4V(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn sglIdentityM4();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn sglM4S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 4:\r\n\t\t\treturn sglDiagM4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tcase 16:\r\n\t\t\treturn sglM4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglIdentityM4();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupM4(m) {\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = m[ 0];\r\n\tr[ 1] = m[ 1];\r\n\tr[ 2] = m[ 2];\r\n\tr[ 3] = m[ 3];\r\n\r\n\tr[ 4] = m[ 4];\r\n\tr[ 5] = m[ 5];\r\n\tr[ 6] = m[ 6];\r\n\tr[ 7] = m[ 7];\r\n\r\n\tr[ 8] = m[ 8];\r\n\tr[ 9] = m[ 9];\r\n\tr[10] = m[10];\r\n\tr[11] = m[11];\r\n\r\n\tr[12] = m[12];\r\n\tr[13] = m[13];\r\n\tr[14] = m[14];\r\n\tr[15] = m[15];\r\n\r\n\treturn r;\r\n\r\n\t//return m.slice(0, 16);\r\n\t//return m.slice();\r\n}\r\n\r\nfunction sglGetElemM4(m, row, col) {\r\n\treturn m[row+col*4];\r\n}\r\n\r\nfunction sglSetElemM4(m, row, col, value) {\r\n\tm[row+col*4] = value;\r\n}\r\n\r\nfunction sglGetRowM4(m, r) {\r\n\treturn sglV4C(m[r+0], m[r+4], m[r+8], m[r+12]);\r\n}\r\n\r\nfunction sglSetRowM4V(m, r, v) {\r\n\tm[r+ 0] = v[0];\r\n\tm[r+ 4] = v[1];\r\n\tm[r+ 8] = v[2];\r\n\tm[r+12] = v[3];\r\n}\r\n\r\nfunction sglSetRowM4S(m, r, s) {\r\n\tm[r+ 0] = s;\r\n\tm[r+ 4] = s;\r\n\tm[r+ 8] = s;\r\n\tm[r+12] = s;\r\n}\r\n\r\nfunction sglSetRowM4C(m, r, x, y, z, w) {\r\n\tm[r+ 0] = x;\r\n\tm[r+ 4] = y;\r\n\tm[r+ 8] = z;\r\n\tm[r+12] = w;\r\n}\r\n\r\nfunction sglGetColM4(m, c) {\r\n\tvar i = c * 4;\r\n\treturn sglV4C(m[i+0], m[i+1], m[i+2], m[i+3]);\r\n}\r\n\r\nfunction sglSetColM4V(m, c, v) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = v[0];\r\n\tm[i+1] = v[1];\r\n\tm[i+2] = v[2];\r\n\tm[i+3] = v[3];\r\n}\r\n\r\nfunction sglSetColM4S(m, c, s) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = s;\r\n\tm[i+1] = s;\r\n\tm[i+2] = s;\r\n\tm[i+3] = s;\r\n}\r\n\r\nfunction sglSetColM4C(m, c, x, y, z, w) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = x;\r\n\tm[i+1] = y;\r\n\tm[i+2] = z;\r\n\tm[i+3] = w;\r\n}\r\n\r\nfunction sglM4toM3(m) {\r\n\treturn [\r\n\t\tm[ 0], m[ 1], m[ 2],\r\n\t\tm[ 4], m[ 5], m[ 6],\r\n\t\tm[ 8], m[ 9], m[10]\r\n\t];\r\n}\r\n\r\nfunction sglIsIdentityM4(m) {\r\n\tvar i = 0;\r\n\tvar j = 0;\r\n\tvar s = 0.0;\r\n\tfor (i=0; i<4; ++i) {\r\n\t\tfor (j=0; j<4; ++j) {\r\n\t\t\ts = m[i+j*4];\r\n\t\t\tif ((i == j)) {\r\n\t\t\t\tif (s != 1.0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (s != 0.0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction sglNegM4(m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = -m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] + b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddM4S(m, s)\r\n{\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] + s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddSM4(s, m) {\r\n\treturn sglAddM4S(m, s);\r\n}\r\n\r\nfunction sglSubM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] - b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglSubM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] - s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglSubSM4(s, m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = s - m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglMulM4(a, b) {\r\n\tvar a0  = a[ 0], a1  = a[ 1],  a2 = a[ 2], a3  = a[ 3],\r\n\t    a4  = a[ 4], a5  = a[ 5],  a6 = a[ 6], a7  = a[ 7],\r\n\t    a8  = a[ 8], a9  = a[ 9], a10 = a[10], a11 = a[11],\r\n\t    a12 = a[12], a13 = a[13], a14 = a[14], a15 = a[15],\r\n\r\n\t    b0  = b[ 0], b1  = b[ 1], b2  = b[ 2], b3  = b[ 3],\r\n\t    b4  = b[ 4], b5  = b[ 5], b6  = b[ 6], b7  = b[ 7],\r\n\t    b8  = b[ 8], b9  = b[ 9], b10 = b[10], b11 = b[11],\r\n\t    b12 = b[12], b13 = b[13], b14 = b[14], b15 = b[15];\r\n\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = a0*b0 + a4*b1 + a8*b2  + a12*b3;\r\n\tr[ 1] = a1*b0 + a5*b1 + a9*b2  + a13*b3;\r\n\tr[ 2] = a2*b0 + a6*b1 + a10*b2 + a14*b3;\r\n\tr[ 3] = a3*b0 + a7*b1 + a11*b2 + a15*b3;\r\n\r\n\tr[ 4] = a0*b4 + a4*b5 + a8*b6  + a12*b7;\r\n\tr[ 5] = a1*b4 + a5*b5 + a9*b6  + a13*b7;\r\n\tr[ 6] = a2*b4 + a6*b5 + a10*b6 + a14*b7;\r\n\tr[ 7] = a3*b4 + a7*b5 + a11*b6 + a15*b7;\r\n\r\n\tr[ 8] = a0*b8 + a4*b9 + a8*b10  + a12*b11;\r\n\tr[ 9] = a1*b8 + a5*b9 + a9*b10  + a13*b11;\r\n\tr[10] = a2*b8 + a6*b9 + a10*b10 + a14*b11;\r\n\tr[11] = a3*b8 + a7*b9 + a11*b10 + a15*b11;\r\n\r\n\tr[12] = a0*b12 + a4*b13 + a8*b14  + a12*b15;\r\n\tr[13] = a1*b12 + a5*b13 + a9*b14  + a13*b15;\r\n\tr[14] = a2*b12 + a6*b13 + a10*b14 + a14*b15;\r\n\tr[15] = a3*b12 + a7*b13 + a11*b14 + a15*b15;\r\n\r\n\t/*\r\n\tr[ 0] = a[ 0]*b[ 0] + a[ 4]*b[ 1] + a[ 8]*b[ 2] + a[12]*b[ 3];\r\n\tr[ 1] = a[ 1]*b[ 0] + a[ 5]*b[ 1] + a[ 9]*b[ 2] + a[13]*b[ 3];\r\n\tr[ 2] = a[ 2]*b[ 0] + a[ 6]*b[ 1] + a[10]*b[ 2] + a[14]*b[ 3];\r\n\tr[ 3] = a[ 3]*b[ 0] + a[ 7]*b[ 1] + a[11]*b[ 2] + a[15]*b[ 3];\r\n\r\n\tr[ 4] = a[ 0]*b[ 4] + a[ 4]*b[ 5] + a[ 8]*b[ 6] + a[12]*b[ 7];\r\n\tr[ 5] = a[ 1]*b[ 4] + a[ 5]*b[ 5] + a[ 9]*b[ 6] + a[13]*b[ 7];\r\n\tr[ 6] = a[ 2]*b[ 4] + a[ 6]*b[ 5] + a[10]*b[ 6] + a[14]*b[ 7];\r\n\tr[ 7] = a[ 3]*b[ 4] + a[ 7]*b[ 5] + a[11]*b[ 6] + a[15]*b[ 7];\r\n\r\n\tr[ 8] = a[ 0]*b[ 8] + a[ 4]*b[ 9] + a[ 8]*b[10] + a[12]*b[11];\r\n\tr[ 9] = a[ 1]*b[ 8] + a[ 5]*b[ 9] + a[ 9]*b[10] + a[13]*b[11];\r\n\tr[10] = a[ 2]*b[ 8] + a[ 6]*b[ 9] + a[10]*b[10] + a[14]*b[11];\r\n\tr[11] = a[ 3]*b[ 8] + a[ 7]*b[ 9] + a[11]*b[10] + a[15]*b[11];\r\n\r\n\tr[12] = a[ 0]*b[12] + a[ 4]*b[13] + a[ 8]*b[14] + a[12]*b[15];\r\n\tr[13] = a[ 1]*b[12] + a[ 5]*b[13] + a[ 9]*b[14] + a[13]*b[15];\r\n\tr[14] = a[ 2]*b[12] + a[ 6]*b[13] + a[10]*b[14] + a[14]*b[15];\r\n\tr[15] = a[ 3]*b[12] + a[ 7]*b[13] + a[11]*b[14] + a[15]*b[15];\r\n\t*/\r\n\r\n\treturn r;\r\n\r\n\t/*\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = a[ 0]*b[ 0] + a[ 4]*b[ 1] + a[ 8]*b[ 2] + a[12]*b[ 3];\r\n\tr[ 1] = a[ 1]*b[ 0] + a[ 5]*b[ 1] + a[ 9]*b[ 2] + a[13]*b[ 3];\r\n\tr[ 2] = a[ 2]*b[ 0] + a[ 6]*b[ 1] + a[10]*b[ 2] + a[14]*b[ 3];\r\n\tr[ 3] = a[ 3]*b[ 0] + a[ 7]*b[ 1] + a[11]*b[ 2] + a[15]*b[ 3];\r\n\r\n\tr[ 4] = a[ 0]*b[ 4] + a[ 4]*b[ 5] + a[ 8]*b[ 6] + a[12]*b[ 7];\r\n\tr[ 5] = a[ 1]*b[ 4] + a[ 5]*b[ 5] + a[ 9]*b[ 6] + a[13]*b[ 7];\r\n\tr[ 6] = a[ 2]*b[ 4] + a[ 6]*b[ 5] + a[10]*b[ 6] + a[14]*b[ 7];\r\n\tr[ 7] = a[ 3]*b[ 4] + a[ 7]*b[ 5] + a[11]*b[ 6] + a[15]*b[ 7];\r\n\r\n\tr[ 8] = a[ 0]*b[ 8] + a[ 4]*b[ 9] + a[ 8]*b[10] + a[12]*b[11];\r\n\tr[ 9] = a[ 1]*b[ 8] + a[ 5]*b[ 9] + a[ 9]*b[10] + a[13]*b[11];\r\n\tr[10] = a[ 2]*b[ 8] + a[ 6]*b[ 9] + a[10]*b[10] + a[14]*b[11];\r\n\tr[11] = a[ 3]*b[ 8] + a[ 7]*b[ 9] + a[11]*b[10] + a[15]*b[11];\r\n\r\n\tr[12] = a[ 0]*b[12] + a[ 4]*b[13] + a[ 8]*b[14] + a[12]*b[15];\r\n\tr[13] = a[ 1]*b[12] + a[ 5]*b[13] + a[ 9]*b[14] + a[13]*b[15];\r\n\tr[14] = a[ 2]*b[12] + a[ 6]*b[13] + a[10]*b[14] + a[14]*b[15];\r\n\tr[15] = a[ 3]*b[12] + a[ 7]*b[13] + a[11]*b[14] + a[15]*b[15];\r\n\r\n\treturn r;\r\n\t*/\r\n}\r\n\r\nfunction sglMulM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] * s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglMulSM4(s, m) {\r\n\treturn sglMulM4S(m, s);\r\n}\r\n\r\nfunction sglMulM4V3(m, v, w) {\r\n\treturn [\r\n\t\tm[ 0] * v[0] + m[ 4] * v[1] + m[ 8] * v[2] + m[12] * w,\r\n\t\tm[ 1] * v[0] + m[ 5] * v[1] + m[ 9] * v[2] + m[13] * w,\r\n\t\tm[ 2] * v[0] + m[ 6] * v[1] + m[10] * v[2] + m[14] * w /* ,\r\n\t\tm[ 3] * v[0] + m[ 7] * v[1] + m[11] * v[2] + m[15] * w*/\r\n\t];\r\n}\r\n\r\nfunction sglMulM4V4(m, v) {\r\n\treturn [\r\n\t\tm[ 0] * v[0] + m[ 4] * v[1] + m[ 8] * v[2] + m[12] * v[3],\r\n\t\tm[ 1] * v[0] + m[ 5] * v[1] + m[ 9] * v[2] + m[13] * v[3],\r\n\t\tm[ 2] * v[0] + m[ 6] * v[1] + m[10] * v[2] + m[14] * v[3],\r\n\t\tm[ 3] * v[0] + m[ 7] * v[1] + m[11] * v[2] + m[15] * v[3]\r\n\t];\r\n}\r\n\r\nfunction sglDivM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] / s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglDivSM4(s, m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = s / m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglRcpM4(m) {\r\n\treturn sglDivSM4(1.0, m);\r\n}\r\n\r\nfunction sglCompMulM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] * b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglCompDivM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] / b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglTransposeM4(m) {\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = m[ 0];\r\n\tr[ 1] = m[ 4];\r\n\tr[ 2] = m[ 8];\r\n\tr[ 3] = m[12];\r\n\t\r\n\tr[ 4] = m[ 1];\r\n\tr[ 5] = m[ 5];\r\n\tr[ 6] = m[ 9];\r\n\tr[ 7] = m[13];\r\n\t\r\n\tr[ 8] = m[ 2];\r\n\tr[ 9] = m[ 6];\r\n\tr[10] = m[10];\r\n\tr[11] = m[14];\r\n\t\r\n\tr[12] = m[ 3];\r\n\tr[13] = m[ 7];\r\n\tr[14] = m[11];\r\n\tr[15] = m[15];\r\n\t\r\n\treturn r;\r\n}\r\n\r\nfunction sglDeterminantM4(m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15]\r\n\r\n\treturn (\r\n\t\tm12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t\tm8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t\tm12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t\tm12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t\tm4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t\tm8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15\r\n\t);\r\n}\r\n\r\nfunction sglInverseM4(m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15]\r\n\r\n\tvar t = sglUndefM4();\r\n\r\n\tt[ 0] = (m9*m14*m7-m13*m10*m7+m13*m6*m11-m5*m14*m11-m9*m6*m15+m5*m10*m15);\r\n\tt[ 1] = (m13*m10*m3-m9*m14*m3-m13*m2*m11+m1*m14*m11+m9*m2*m15-m1*m10*m15);\r\n\tt[ 2] = (m5*m14*m3-m13*m6*m3+m13*m2*m7-m1*m14*m7-m5*m2*m15+m1*m6*m15);\r\n\tt[ 3] = (m9*m6*m3-m5*m10*m3-m9*m2*m7+m1*m10*m7+m5*m2*m11-m1*m6*m11);\r\n\r\n\tt[ 4] = (m12*m10*m7-m8*m14*m7-m12*m6*m11+m4*m14*m11+m8*m6*m15-m4*m10*m15);\r\n\tt[ 5] = (m8*m14*m3-m12*m10*m3+m12*m2*m11-m0*m14*m11-m8*m2*m15+m0*m10*m15);\r\n\tt[ 6] = (m12*m6*m3-m4*m14*m3-m12*m2*m7+m0*m14*m7+m4*m2*m15-m0*m6*m15);\r\n\tt[ 7] = (m4*m10*m3-m8*m6*m3+m8*m2*m7-m0*m10*m7-m4*m2*m11+m0*m6*m11);\r\n\r\n\tt[ 8] = (m8*m13*m7-m12*m9*m7+m12*m5*m11-m4*m13*m11-m8*m5*m15+m4*m9*m15);\r\n\tt[ 9] = (m12*m9*m3-m8*m13*m3-m12*m1*m11+m0*m13*m11+m8*m1*m15-m0*m9*m15);\r\n\tt[10] = (m4*m13*m3-m12*m5*m3+m12*m1*m7-m0*m13*m7-m4*m1*m15+m0*m5*m15);\r\n\tt[11] = (m8*m5*m3-m4*m9*m3-m8*m1*m7+m0*m9*m7+m4*m1*m11-m0*m5*m11);\r\n\r\n\tt[12] = (m12*m9*m6-m8*m13*m6-m12*m5*m10+m4*m13*m10+m8*m5*m14-m4*m9*m14);\r\n\tt[13] = (m8*m13*m2-m12*m9*m2+m12*m1*m10-m0*m13*m10-m8*m1*m14+m0*m9*m14);\r\n\tt[14] = (m12*m5*m2-m4*m13*m2-m12*m1*m6+m0*m13*m6+m4*m1*m14-m0*m5*m14);\r\n\tt[15] = (m4*m9*m2-m8*m5*m2+m8*m1*m6-m0*m9*m6-m4*m1*m10+m0*m5*m10);\r\n\r\n\tvar s = 1.0 / (\r\n\t\tm12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t\tm8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t\tm12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t\tm12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t\tm4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t\tm8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15\r\n\t);\r\n\r\n\tfor (var i=0; i<16; ++i) t[i] *= s;\r\n\r\n\treturn t;\r\n}\r\n\r\nfunction sglTraceM4(m) {\r\n\treturn (m[0] + m[5] + m[10] + m[15]);\r\n}\r\n\r\nfunction sglTranslationM4V(v) {\r\n\tvar m = sglIdentityM4();\r\n\tm[12] = v[0];\r\n\tm[13] = v[1];\r\n\tm[14] = v[2];\r\n\treturn m;\r\n}\r\n\r\nfunction sglTranslationM4C(x, y, z) {\r\n\treturn sglTranslationM4V([x, y, z]);\r\n}\r\n\r\nfunction sglTranslationM4S(s) {\r\n\treturn sglTranslationM4C(s, s, s);\r\n}\r\n\r\nfunction sglRotationAngleAxisM4V(angleRad, axis) {\r\n\tvar ax = sglNormalizedV3(axis);\r\n\tvar s  = sglSin(angleRad);\r\n\tvar c  = sglCos(angleRad);\r\n\tvar q   = 1.0 - c;\r\n\r\n\tvar x = ax[0];\r\n\tvar y = ax[1];\r\n\tvar z = ax[2];\r\n\r\n\tvar xx, yy, zz, xy, yz, zx, xs, ys, zs;\r\n\r\n\txx = x * x;\r\n\tyy = y * y;\r\n\tzz = z * z;\r\n\txy = x * y;\r\n\tyz = y * z;\r\n\tzx = z * x;\r\n\txs = x * s;\r\n\tys = y * s;\r\n\tzs = z * s;\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] = (q * xx) + c;\r\n\tm[ 1] = (q * xy) + zs;\r\n\tm[ 2] = (q * zx) - ys;\r\n\tm[ 3] = 0.0;\r\n\r\n\tm[ 4] = (q * xy) - zs;\r\n\tm[ 5] = (q * yy) + c;\r\n\tm[ 6] = (q * yz) + xs;\r\n\tm[ 7] = 0.0;\r\n\r\n\tm[ 8] = (q * zx) + ys;\r\n\tm[ 9] = (q * yz) - xs;\r\n\tm[10] = (q * zz) + c;\r\n\tm[11] = 0.0;\r\n\r\n\tm[12] = 0.0;\r\n\tm[13] = 0.0;\r\n\tm[14] = 0.0;\r\n\tm[15] = 1.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglRotationAngleAxisM4C(angleRad, ax, ay, az) {\r\n\treturn sglRotationAngleAxisM4V(angleRad, [ax, ay, az]);\r\n}\r\n\r\nfunction sglScalingM4V(v) {\r\n\tvar m = sglIdentityM4();\r\n\tm[ 0] = v[0];\r\n\tm[ 5] = v[1];\r\n\tm[10] = v[2];\r\n\treturn m;\r\n}\r\n\r\nfunction sglScalingM4C(x, y, z) {\r\n\treturn sglScalingM4V([x, y, z]);\r\n}\r\n\r\nfunction sglScalingM4S(s) {\r\n\treturn sglScalingM4C(s, s, s);\r\n}\r\n\r\nfunction sglLookAtM4V(position, target, up) {\r\n\tvar v = sglNormalizedV3(sglSubV3(target, position));\r\n\tvar u = sglNormalizedV3(up);\r\n\tvar s = sglNormalizedV3(sglCrossV3(v, u));\r\n\r\n\tu = sglNormalizedV3(sglCrossV3(s, v));\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] =  s[0];\r\n\tm[ 1] =  u[0];\r\n\tm[ 2] = -v[0];\r\n\tm[ 3] =   0.0;\r\n\r\n\tm[ 4] =  s[1];\r\n\tm[ 5] =  u[1];\r\n\tm[ 6] = -v[1];\r\n\tm[ 7] =   0.0;\r\n\r\n\tm[ 8] =  s[2];\r\n\tm[ 9] =  u[2];\r\n\tm[10] = -v[2];\r\n\tm[11] =   0.0;\r\n\r\n\tm[12] =   0.0;\r\n\tm[13] =   0.0;\r\n\tm[14] =   0.0;\r\n\tm[15] =   1.0;\r\n\r\n\tm = sglMulM4(m, sglTranslationM4V(sglNegV3(position)));\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglLookAtM4C(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ) {\r\n\treturn sglLookAtM4V([positionX, positionY, positionZ], [targetX, targetY, targetZ], [upX, upY, upZ]);\r\n}\r\n\r\nfunction sglOrthoM4V(omin, omax) {\r\n\tvar sum   = sglAddV3(omax, omin);\r\n\tvar dif   = sglSubV3(omax, omin);\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] =      2.0 / dif[0];\r\n\tm[ 1] =               0.0;\r\n\tm[ 2] =               0.0;\r\n\tm[ 3] =               0.0;\r\n\r\n\tm[ 4] =               0.0;\r\n\tm[ 5] =      2.0 / dif[1];\r\n\tm[ 6] =               0.0;\r\n\tm[ 7] =               0.0;\r\n\r\n\tm[ 8] =               0.0;\r\n\tm[ 9] =               0.0;\r\n\tm[10] =     -2.0 / dif[2];\r\n\tm[11] =                 0.0;\r\n\r\n\tm[12] =  -sum[0] / dif[0];\r\n\tm[13] =  -sum[1] / dif[1];\r\n\tm[14] =  -sum[2] / dif[2];\r\n\tm[15] =               1.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglOrthoM4C(left, right, bottom, top, zNear, zFar) {\r\n\treturn sglOrthoM4V([left, bottom, zNear], [right, top, zFar]);\r\n}\r\n\r\nfunction sglFrustumM4V(fmin, fmax) {\r\n\tvar sum   = sglAddV3(fmax, fmin);\r\n\tvar dif   = sglSubV3(fmax, fmin);\r\n\tvar t     = 2.0 * fmin[2];\r\n\r\n\tvar m = sglUndefM4();\r\n\t\r\n\tm[ 0] =            t / dif[0];\r\n\tm[ 1] =                   0.0;\r\n\tm[ 2] =                   0.0;\r\n\tm[ 3] =                   0.0;\r\n\r\n\tm[ 4] =                   0.0;\r\n\tm[ 5] =            t / dif[1];\r\n\tm[ 6] =                   0.0;\r\n\tm[ 7] =                   0.0;\r\n\r\n\tm[ 8] =       sum[0] / dif[0];\r\n\tm[ 9] =       sum[1] / dif[1];\r\n\tm[10] =      -sum[2] / dif[2];\r\n\tm[11] =                  -1.0;\r\n\r\n\tm[12] =                   0.0;\r\n\tm[13] =                   0.0;\r\n\tm[14] = -t * fmax[2] / dif[2];\r\n\tm[15] =                   0.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglFrustumM4C(left, right, bottom, top, zNear, zFar) {\r\n\treturn sglFrustumM4V([left, bottom, zNear], [right, top, zFar]);\r\n}\r\n\r\nfunction sglPerspectiveM4(fovYRad, aspectRatio, zNear, zFar) {\r\n\tvar pmin = sglUndefV4();\r\n\tvar pmax = sglUndefV4();\r\n\r\n\tpmin[2] = zNear;\r\n\tpmax[2] = zFar;\r\n\r\n\tpmax[1] = pmin[2] * sglTan(fovYRad / 2.0);\r\n\tpmin[1] = -pmax[1];\r\n\r\n\tpmax[0] = pmax[1] * aspectRatio;\r\n\tpmin[0] = -pmax[0];\r\n\r\n\treturn sglFrustumM4V(pmin, pmax);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// quaternion\r\n/***********************************************************************/\r\nfunction sglUndefQuat(v) {\r\n\treturn new Array(4);\r\n}\r\n\r\nfunction sglQuatV(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglIdentityQuat() {\r\n\treturn [ 0.0, 0.0, 0.0, 1.0 ];\r\n}\r\n\r\nfunction sglAngleAxisQuat(angleRad, axis) {\r\n\tvar halfAngle = angleRad / 2.0;\r\n\tvar fsin = sglSin(halfAngle);\r\n\treturn [\r\n\t\tfsin * axis[0],\r\n\t\tfsin * axis[1],\r\n\t\tfsin * axis[2],\r\n\t\tsglCos(halfAngle)\r\n\t];\r\n}\r\n\r\nfunction sglM4Quat(m) {\r\n\tvar trace = sglGetElemM4(m, 0, 0) + sglGetElemM4(m, 1, 1) + sglGetElemM4(m, 2, 2);\r\n\tvar root = null;\r\n\tvar q = sglUndefQuat();\r\n\r\n\tif (trace > 0.0) {\r\n\t\troot = sglSqrt(trace + 1.0);\r\n\t\tq[3] = root / 2.0;\r\n\t\troot = 0.5 / root;\r\n\t\tq[0] = (sglGetElemM4(m, 2, 1) - sglGetElemM4(m, 1, 2)) * root;\r\n\t\tq[1] = (sglGetElemM4(m, 0, 2) - sglGetElemM4(m, 2, 0)) * root;\r\n\t\tq[2] = (sglGetElemM4(m, 1, 0) - sglGetElemM4(m, 0, 1)) * root;\r\n\t}\r\n\telse {\r\n\t\tvar i = 0;\r\n\r\n\t\tif (sglGetElemM4(m, 1, 1) > sglGetElemM4(m, 0, 0)) i = 1;\r\n\t\tif (sglGetElemM4(m, 2, 2) > sglGetElemM4(m, i, i)) i = 2;\r\n\r\n\t\tvar j = (i + 1) % 3;\r\n\t\tvar k = (j + 1) % 3;\r\n\r\n\t\troot = sglSqrt(sglGetElemM4(m, i, i) - sglGetElemM4(m, j, j) - sglGetElemM4(m, k, k) + 1.0);\r\n\r\n\t\tq[i] = root / 2.0;\r\n\t\troot = 0.5 / root;\r\n\t\tq[3] = (sglGetElemM4(m, k, j) - sglGetElemM4(m, j, k)) * root;\r\n\t\tq[j] = (sglGetElemM4(m, j, i) + sglGetElemM4(m, i, j)) * root;\r\n\t\tq[k] = (sglGetElemM4(m, k, i) + sglGetElemM4(m, i, k)) * root;\r\n\t}\r\n\treturn q;\r\n}\r\n\r\nfunction sglGetQuatAngleAxis(q) {\r\n\tvar v = new Array(4);\r\n\r\n\tvar sqLen = sglSqLengthV4(q);\r\n\tvar angle = null;\r\n\r\n\tif (sqLen > 0.0) {\r\n\t\tvar invLen = 1.0 / sglSqrt(sqLen);\r\n\t\tv[0] = q[0] * invLen;\r\n\t\tv[1] = q[1] * invLen;\r\n\t\tv[2] = q[2] * invLen;\r\n\t\tv[3] = 2.0 * aglAcos(q[3]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tv[0] = 0.0;\r\n\t\tv[1] = 0.0;\r\n\t\tv[2] = 1.0;\r\n\t\tv[3] = 0.0;\r\n\t}\r\n\r\n\treturn v;\r\n}\r\n\r\nfunction sglGetQuatRotationM4(q) {\r\n\tvar tx  = 2.0 * q[0];\r\n\tvar ty  = 2.0 * q[1];\r\n\tvar tz  = 2.0 * q[2];\r\n\tvar twx = tx * q[3];\r\n\tvar twy = ty * q[3];\r\n\tvar twz = tz * q[3];\r\n\tvar txx = tx * q[0];\r\n\tvar txy = ty * q[0];\r\n\tvar txz = tz * q[0];\r\n\tvar tyy = ty * q[1];\r\n\tvar tyz = tz * q[1];\r\n\tvar tzz = tz * q[2];\r\n\r\n\tvar m = sglIdentityM4();\r\n\r\n\tsglSetElemM4(m, 0, 0, 1.0 - (tyy + tzz));\r\n\tsglSetElemM4(m, 0, 1, txy - twz);\r\n\tsglSetElemM4(m, 0, 2, txz + twy);\r\n\tsglSetElemM4(m, 1, 0, txy + twz);\r\n\tsglSetElemM4(m, 1, 1, 1.0 - (txx + tzz));\r\n\tsglSetElemM4(m, 1, 2, tyz - twx);\r\n\tsglSetElemM4(m, 2, 0, txz - twy);\r\n\tsglSetElemM4(m, 2, 1, tyz + twx);\r\n\tsglSetElemM4(m, 2, 2, 1.0 - (txx + tyy));\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglNormalizedQuat(q) {\r\n\treturn sglNormalizedV4(q);\r\n}\r\n\r\nfunction sglMulQuat(q1, q2) {\r\n\tvar r = sglUndefQuat();\r\n\r\n\tr[0] = p[3] * q[0] + p[0] * q[3] + p[1] * q[2] - p[2] * q[1];\r\n\tr[1] = p[3] * q[1] + p[1] * q[3] + p[2] * q[0] - p[0] * q[2];\r\n\tr[2] = p[3] * q[2] + p[2] * q[3] + p[0] * q[1] - p[1] * q[0];\r\n\tr[3] = p[3] * q[3] - p[0] * q[0] - p[1] * q[1] - p[2] * q[2];\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglVec2\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec2.\r\n * @class 2-dimensional vector.\r\n */\r\nfunction SglVec2() {\r\n\tthis.v = new Array(2);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec2) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 2:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec2.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec2(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\r\n\tset : function(x, y) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec2(-(this.v[0]), -(this.v[1]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec2(sglAbs(this.v[0]), sglAbs(this.v[1]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec2(this.v[0] + v.v[0], this.v[1] + v.v[1]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec2(this.v[0] - v.v[0], this.v[1] - v.v[1]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec2(this.v[0] * v.v[0], this.v[1] * v.v[1]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec2(this.v[0] / v.v[0], this.v[1] / v.v[1]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec2(1.0 / this.v[0], 1.0 / this.v[1]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1]);\r\n\t},\r\n\r\n\tcross : function(v) {\r\n\t\treturn (this.v[0]*v.v[1] - this.v[1]*v.v[0]);\r\n\t},\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec2(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec2(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglVec3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec3.\r\n * @class 3-dimensional vector.\r\n */\r\nfunction SglVec3() {\r\n\tthis.v = new Array(3);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec3) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 3:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec3.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec3(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\tget z( ) { return this.v[2]; },\r\n\tset z(n) { this.v[2] = n;    },\r\n\r\n\tset : function(x, y, z) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\tthis.v[2] = z;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1], v[2]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\tthis.v[2] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec3(-(this.v[0]), -(this.v[1]), -(this.v[2]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec3(sglAbs(this.v[0]), sglAbs(this.v[1]), sglAbs(this.v[2]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\tif (m > this.v[2]) m = this.v[2];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\tif (m < this.v[2]) m = this.v[2];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec3(this.v[0] + v.v[0], this.v[1] + v.v[1], this.v[2] + v.v[2]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec3(this.v[0] - v.v[0], this.v[1] - v.v[1], this.v[2] - v.v[2]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec3(this.v[0] * v.v[0], this.v[1] * v.v[1], this.v[2] * v.v[2]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec3(this.v[0] / v.v[0], this.v[1] / v.v[1], this.v[2] / v.v[2]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec3(1.0 / this.v[0], 1.0 / this.v[1], 1.0 / this.v[2]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1] + this.v[2] * v.v[2]);\r\n\t},\r\n\r\n\tcross : function(v) {\r\n\t\treturn new SglVec3(this.v[1]*v.v[2] - this.v[2]*v.v[1], this.v[2]*v.v[0] - this.v[0]*v.v[2], this.v[0]*v.v[1] - this.v[1]*v.v[0]);\r\n\t},\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec3(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]), sglMin(this.v[2], v.v[2]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec3(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]), sglMax(this.v[2], v.v[2]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglVec4\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec3.\r\n * @class 4-dimensional vector.\r\n */\r\nfunction SglVec4() {\r\n\tthis.v = new Array(4);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec4) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 4:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec4.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec4(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\tget z( ) { return this.v[2]; },\r\n\tset z(n) { this.v[2] = n;    },\r\n\tget w( ) { return this.v[3]; },\r\n\tset w(n) { this.v[3] = n;    },\r\n\r\n\tset : function(x, y, z, w) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\tthis.v[2] = z;\r\n\t\tthis.v[3] = w;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1], v[2], v[3]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s, s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\tthis.v[2] *= f;\r\n\t\tthis.v[3] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec4(-(this.v[0]), -(this.v[1]), -(this.v[2]), -(this.v[3]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec4(sglAbs(this.v[0]), sglAbs(this.v[1]), sglAbs(this.v[2]), sglAbs(this.v[3]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\tif (m > this.v[2]) m = this.v[2];\r\n\t\tif (m > this.v[3]) m = this.v[3];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\tif (m < this.v[2]) m = this.v[2];\r\n\t\tif (m < this.v[3]) m = this.v[3];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\tif (this.v[a] > this.v[3]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\tif (this.v[a] > this.v[3]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec4(this.v[0] + v.v[0], this.v[1] + v.v[1], this.v[2] + v.v[2], this.v[3] + v.v[3]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec4(this.v[0] - v.v[0], this.v[1] - v.v[1], this.v[2] - v.v[2], this.v[3] - v.v[3]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec4(this.v[0] * v.v[0], this.v[1] * v.v[1], this.v[2] * v.v[2], this.v[3] * v.v[3]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec4(this.v[0] / v.v[0], this.v[1] / v.v[1], this.v[2] / v.v[2], this.v[3] / v.v[3]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec4(1.0 / this.v[0], 1.0 / this.v[1], 1.0 / this.v[2], 1.0 / this.v[3]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1] + this.v[2] * v.v[2] + this.v[3] * v.v[3]);\r\n\t},\r\n\r\n\t/*\r\n\tcross : function(u, v, w) {\r\n\t\treturn null;\r\n\t},\r\n\t*/\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec4(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]), sglMin(this.v[2], v.v[2]), sglMin(this.v[3], v.v[3]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec4(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]), sglMax(this.v[2], v.v[2]), sglMax(this.v[3], v.v[3]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglPlane3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglPlane3.\r\n * @class Represents a plane in space.\r\n */\r\nfunction SglPlane3(normal, offset, normalize) {\r\n\tthis._normal = [ 0.0, 0.0, 1.0 ];\r\n\tthis._offset = 0.0;\r\n\r\n\tif (normal && offset) {\r\n\t\tthis.setup(normal, offset, normalize);\r\n\t}\r\n}\r\n\r\nSglPlane3.prototype = {\r\n\tget normal()  { return this._normal;          },\r\n\tset normal(n) { this._normal = n.slice(0, 3); },\r\n\r\n\tget offset()  { return this._offset;          },\r\n\tset offset(o) { this._offset = o.slize(0, 3); },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglPlane3(this._normal, this._offset, false);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(normal, offset, nomalize) {\r\n\t\tthis._normal[0] = normal[0];\r\n\t\tthis._normal[1] = normal[1];\r\n\t\tthis._normal[2] = normal[2];\r\n\t\tthis._offset    = offset;\r\n\r\n\t\tif (normalize) {\r\n\t\t\tvar s = sglSqrt(sglDotV3(this._normal));\r\n\r\n\t\t\tif (s > 0.0) {\r\n\t\t\t\ts = 1.0 / s;\r\n\t\t\t\tsglSelfMulV3S(this._normal, s);\r\n\t\t\t\tthis._offset    *= s;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglBox3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglBox3.\r\n * @class Represents an axis-aligned box in space.\r\n */\r\nfunction SglBox3(min, max) {\r\n\tthis._min = [  1.0,  1.0,  1.0 ];\r\n\tthis._max = [ -1.0, -1.0, -1.0 ];\r\n\r\n\tif (min && max) {\r\n\t\tthis.setup(min, max);\r\n\t}\r\n}\r\n\r\nSglBox3.prototype = {\r\n\tget min()  { return this._min;          },\r\n\tset min(m) { this._min = m.slice(0, 3); },\r\n\r\n\tget max()  { return this._max;          },\r\n\tset max(m) { this._max = m.slice(0, 3); },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglBox3(this._min, this._max);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(min, max) {\r\n\t\tfor (var i=0; i<3; ++i) {\r\n\t\t\tthis._min[i] = min[i];\r\n\t\t\tthis._max[i] = max[i];\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget isNull() {\r\n\t\treturn (this._min[0] > this._max[0]);\r\n\t},\r\n\r\n\tget isEmpty() {\r\n\t\treturn (\r\n\t\t\t   (this._min[0] == this._max[0])\r\n\t\t\t&& (this._min[1] == this._max[1])\r\n\t\t\t&& (this._min[2] == this._max[2])\r\n\t\t);\r\n\t},\r\n\r\n\tget center() {\r\n\t\treturn sglSelfMulV3S(sglAddV3(this._min, this._max), 0.5);\r\n\t},\r\n\r\n\tget size() {\r\n\t\treturn sglSubV3(this._max, this._min);\r\n\t},\r\n\r\n\tget squaredDiagonal() {\r\n\t\tvar s = this.size;\r\n\t\treturn sglDotV3(s, s);\r\n\t},\r\n\r\n\tget diagonal() {\r\n\t\treturn sglSqrt(this.squaredDiagonal);\r\n\t},\r\n\r\n\tget facesAreas() {\r\n\t\tvar s = this.size;\r\n\t\treturn [\r\n\t\t\t(s[1] * s[2]),\r\n\t\t\t(s[0] * s[2]),\r\n\t\t\t(s[0] * s[1])\r\n\t\t];\r\n\t},\r\n\r\n\tget surfaceArea() {\r\n\t\tvar a = this.facesArea;\r\n\t\treturn ((a[0] + a[1] + a[2]) * 2.0);\r\n\t},\r\n\r\n\tget volume() {\r\n\t\tvar s = this.size;\r\n\t\treturn (s[0] * s[1] * s[2]);\r\n\t},\r\n\r\n\toffset : function(halfDelta) {\r\n\t\tsglSelfSubV3S(this._min[i], halfDelta);\r\n\t\tsglSelfAddV3S(this._max[i], halfDelta);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tcorner : function(index) {\r\n\t\tvar s = this.size;\r\n\t\treturn [\r\n\t\t\tthis._min[0] + (((index % 2)       != (0.0)) ? (1.0) : (0.0)) * s[0],\r\n\t\t\tthis._min[1] + ((((index / 2) % 2) != (0.0)) ? (1.0) : (0.0)) * s[1],\r\n\t\t\tthis._min[2] + (((index > 3)       != (0.0)) ? (1.0) : (0.0)) * s[2]\r\n\t\t];\r\n\t},\r\n\r\n\ttransformed : function(matrix) {\r\n\t\tvar b = new SglBox3();\r\n\t\tvar p = sglMulM4V3(matrix, this.corner(0), 1.0);\r\n\t\tb.min = p;\r\n\t\tb.max = p;\r\n\t\tfor (var i=1; i<8; ++i) {\r\n\t\t\tp = sglMulM4V3(matrix, this.corner(i), 1.0);\r\n\t\t\tb.min = sglMinV3(b.min, p);\r\n\t\t\tb.max = sglMaxV3(b.max, p);\r\n\t\t}\r\n\t\treturn b;\r\n\t},\r\n\r\n\taddPoint : function(p) {\r\n\t\tif (this.isNull) {\r\n\t\t\tthis.min = p;\r\n\t\t\tthis.max = p;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.min = sglMinV3(this.min, p);\r\n\t\t\tthis.max = sglMaxV3(this.min, p);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddBox : function(b) {\r\n\t\tif (!b.isNull) {\r\n\t\t\tif (this.isNull) {\r\n\t\t\t\tthis.min = b.min;\r\n\t\t\t\tthis.max = b.max;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.min = sglMinV3(this.min, b.min);\r\n\t\t\t\tthis.max = sglMaxV3(this.max, b.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglSphere3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglSphere3.\r\n * @class Represents a sphere in space.\r\n */\r\nfunction SglSphere3(center, radius) {\r\n\tthis._center = [ 0.0, 0.0, 0.0 ];\r\n\tthis._radius = -1.0;\r\n\r\n\tif (center && radius) {\r\n\t\tthis.setup(center, radius);\r\n\t}\r\n}\r\n\r\nSglSphere3.prototype = {\r\n\tget center()  { return this._center;          },\r\n\tset center(c) { this._center = c.slice(0, 3); },\r\n\r\n\tget radius()  { return this._redius;          },\r\n\tset radius(r) { this._radius = r;             },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglSphere3(this._center, this._radius);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(center, radius) {\r\n\t\tthis._center[0] = center[0];\r\n\t\tthis._center[1] = center[1];\r\n\t\tthis._center[2] = center[2];\r\n\t\tthis._radius    = radius;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget isNull() {\r\n\t\treturn (this._radius < 0.0);\r\n\t},\r\n\r\n\tget isEmpty() {\r\n\t\treturn (this._radius == 0.0);\r\n\t},\r\n\r\n\tget surfaceArea() {\r\n\t\treturn (4.0 * SGL_PI * this._radius * this._radius);\r\n\t},\r\n\r\n\tget volume() {\r\n\t\treturn ((4.0 / 3.0) * SGL_PI * this._radius * this._radius * this._radius);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglMatrixStack\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglMatrixStack.\r\n * @class Represents a stack of 4x4 matrices.\r\n */\r\nfunction SglMatrixStack() {\r\n\tthis._s = [ ];\r\n\tthis._s.push(sglIdentityM4());\r\n\tthis._n = 0;\r\n}\r\n\r\nSglMatrixStack.prototype = {\r\n\tclone : function() {\r\n\t\tvar ss = new SglMatrixStack();\r\n\t\tss.s = [ ];\r\n\t\tfor (var i=0; i<(this._n+1); ++i) {\r\n\t\t\tss._s.push(sglDupM4(this._s[i]));\r\n\t\t}\r\n\t\treturn ss;\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\treset : function() {\r\n\t\tthis._s = [ ];\r\n\t\tthis._s.push(sglIdentityM4());\r\n\t\tthis._n = 0;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget size() {\r\n\t\treturn (this._n + 1);\r\n\t},\r\n\r\n\tget top() {\r\n\t\treturn sglDupM4(this._s[this._n]);\r\n\t},\r\n\r\n\tget topRef() {\r\n\t\treturn this._s[this._n];\r\n\t},\r\n\r\n\tpush : function() {\r\n\t\tthis._s.push(sglDupM4(this._s[this._n]));\r\n\t\tthis._n++;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tpop : function() {\r\n\t\tif (this._n > 0) {\r\n\t\t\tthis._s.pop();\r\n\t\t\tthis._n--;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tload : function(m) {\r\n\t\tthis._s[this._n] = sglDupM4(m);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmultiply : function(m) {\r\n\t\tthis._s[this._n] = sglMulM4(this._s[this._n], m);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tloadIdentity : function() {\r\n\t\tthis._s[this._n] = sglIdentityM4();\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttranslate : function(x, y, z) {\r\n\t\treturn this.multiply(sglTranslationM4C(x, y, z));\r\n\t},\r\n\r\n\trotate : function(angleRad, x, y, z) {\r\n\t\treturn this.multiply(sglRotationAngleAxisM4C(angleRad, x, y, z));\r\n\t},\r\n\r\n\tscale : function(x, y, z) {\r\n\t\treturn this.multiply(sglScalingM4C(x, y, z));\r\n\t},\r\n\r\n\tlookAt : function(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ) {\r\n\t\treturn this.multiply(sglLookAtM4C(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ));\r\n\t},\r\n\r\n\tortho : function(left, right, bottom, top, zNear, zFar) {\r\n\t\treturn this.multiply(sglOrthoM4C(left, right, bottom, top, zNear, zFar));\r\n\t},\r\n\r\n\tfrustum : function(left, right, bottom, top, zNear, zFar) {\r\n\t\treturn this.multiply(sglFrustumM4C(left, right, bottom, top, zNear, zFar));\r\n\t},\r\n\r\n\tperspective : function(fovYRad, aspectRatio, zNear, zFar) {\r\n\t\treturn this.multiply(sglPerspectiveM4(fovYRad, aspectRatio, zNear, zFar));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTransformStack\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglTransformStack.\r\n * @class Holds model, view and projection matrix stacks.\r\n */\r\nfunction SglTransformStack() {\r\n\tthis._ms = new SglMatrixStack();\r\n\tthis._vs = new SglMatrixStack();\r\n\tthis._ps = new SglMatrixStack();\r\n}\r\n\r\nSglTransformStack.prototype = {\r\n\tclone : function() {\r\n\t\tvar xs = new SglTransformStack();\r\n\t\txs._ms = this._ms.clone();\r\n\t\txs._vs = this._vs.clone();\r\n\t\txs._ps = this._ps.clone();\r\n\t\treturn xs;\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\treset : function() {\r\n\t\tthis._ms.reset();\r\n\t\tthis._vs.reset();\r\n\t\tthis._ps.reset();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget model() {\r\n\t\treturn this._ms;\r\n\t},\r\n\r\n\tget view() {\r\n\t\treturn this._vs;\r\n\t},\r\n\r\n\tget projection() {\r\n\t\treturn this._ps;\r\n\t},\r\n\r\n\tget modelMatrix() {\r\n\t\treturn this.model.top;\r\n\t},\r\n\r\n\tget modelMatrixRef() {\r\n\t\treturn this.model.topRef;\r\n\t},\r\n\r\n\tget modelMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelMatrixInverse);\r\n\t},\r\n\r\n\tget viewMatrix() {\r\n\t\treturn this.view.top;\r\n\t},\r\n\r\n\tget viewMatrixRef() {\r\n\t\treturn this.view.topRef;\r\n\t},\r\n\r\n\tget viewMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewMatrixInverse() {\r\n\t\treturn sglInverseM4(this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.viewMatrixInverse);\r\n\t},\r\n\r\n\tget projectionMatrix() {\r\n\t\treturn this.projection.top;\r\n\t},\r\n\r\n\tget projectionMatrixRef() {\r\n\t\treturn this.projection.topRef;\r\n\t},\r\n\r\n\tget projectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.projectionMatrixRef);\r\n\t},\r\n\r\n\tget projectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.projectionMatrixRef);\r\n\t},\r\n\r\n\tget projectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.projectionMatrixInverse);\r\n\t},\r\n\r\n\tget modelViewMatrix() {\r\n\t\treturn sglMulM4(this.viewMatrixRef, this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelViewMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewMatrix);\r\n\t},\r\n\r\n\tget modelViewMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelViewMatrix);\r\n\t},\r\n\r\n\tget modelViewMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewMatrixInverse);\r\n\t},\r\n\r\n\tget viewProjectionMatrix() {\r\n\t\treturn sglMulM4(this.projectionMatrixRef, this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewProjectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.viewProjectionMatrix);\r\n\t},\r\n\r\n\tget viewProjectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.viewProjectionMatrix);\r\n\t},\r\n\r\n\tget viewProjectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.viewProjectionMatrixInverse);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrix() {\r\n\t\treturn sglMulM4(this.projectionMatrixRef, sglMulM4(this.viewMatrixRef, this.modelMatrixRef));\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewProjectionMatrix);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelViewProjectionMatrix);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewProjectionMatrixInverse);\r\n\t},\r\n\r\n\tget worldSpaceNormalMatrix() {\r\n\t\treturn sglM4toM3(this.modelMatrixInverseTranspose);\r\n\t},\r\n\r\n\tget viewSpaceNormalMatrix() {\r\n\t\treturn sglM4toM3(this.modelViewMatrixInverseTranspose);\r\n\t},\r\n\r\n\tget modelSpaceViewerPosition() {\r\n\t\treturn sglV4toV3(sglGetColM4(this.modelViewMatrixInverse, 3));\r\n\t},\r\n\r\n\tget modelSpaceViewDirection() {\r\n\t\treturn sglNegV3(sglV4toV3(sglGetRowM4(this.modelViewMatrix, 2)));\r\n\t},\r\n\r\n\tget worldSpaceViewerPosition() {\r\n\t\treturn sglV4toV3(sglGetColM4(this.viewMatrixInverse, 3));\r\n\t},\r\n\r\n\tget worldSpaceViewDirection() {\r\n\t\treturn ssglNegV3(sglV4toV3(sglGetRowM4(this.viewMatrixRef, 2)));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// _SglFrustumPlane\r\n/**********************************************************/\r\nfunction _SglFrustumPlane() {\r\n\tthis.normal     = [ 0.0, 0.0, 1.0 ];\r\n\tthis.offset     = 0.0;\r\n\tthis.testVertex = [ 0, 0, 0 ];\r\n}\r\n\r\n_SglFrustumPlane.prototype = {\r\n\tsetup : function(nx, ny, nz, off) {\r\n\t\tvar s = 1.0 / sglSqrt(nx*nx + ny*ny + nz*nz);\r\n\r\n\t\tthis.normal[0] = nx * s;\r\n\t\tthis.normal[1] = ny * s;\r\n\t\tthis.normal[2] = nz * s;\r\n\r\n\t\tthis.offset = off * s;\r\n\r\n\t\tthis.testVertex[0] = (this.normal[0] >= 0.0) ? (1) : (0);\r\n\t\tthis.testVertex[1] = (this.normal[1] >= 0.0) ? (1) : (0);\r\n\t\tthis.testVertex[2] = (this.normal[2] >= 0.0) ? (1) : (0);\r\n\t}\r\n};\r\n/**********************************************************/\r\n\r\n\r\n// SglFrustum\r\n/**********************************************************/\r\nvar SGL_OUTSIDE_FRUSTUM   = 0;\r\nvar SGL_INTERSECT_FRUSTUM = 1;\r\nvar SGL_INSIDE_FRUSTUM    = 2;\r\n\r\n/**\r\n * Constructs a SglFrustum.\r\n * @class Holds frustum information for operations such as visibility culling.\r\n */\r\nfunction SglFrustum(projectionMatrix, modelViewMatrix, viewport) {\r\n\tthis._mvpMatrix       = sglIdentityM4();\r\n\tthis._viewport        = [ 0, 0, 1, 1 ];\r\n\tthis._vp              = [ 0, 0, 1, 1 ];\r\n\tthis._billboardMatrix = sglIdentityM4();\r\n\r\n\tthis._planes = new Array(6);\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tthis._planes[i] = new _SglFrustumPlane();\r\n\t}\r\n\r\n\tif (projectionMatrix && modelViewMatrix && viewport) {\r\n\t\tthis.setup(projectionMatrix, modelViewMatrix, viewport);\r\n\t}\r\n}\r\n\r\nSglFrustum.prototype = {\r\n\tsetup : function (projectionMatrix, modelViewMatrix, viewport) {\r\n\t\tvar rot = [\r\n\t\t\tsglGetColM4(modelViewMatrix, 0),\r\n\t\t\tsglGetColM4(modelViewMatrix, 1),\r\n\t\t\tsglGetColM4(modelViewMatrix, 2)\r\n\t\t];\r\n\r\n\t\tvar sc = [\r\n\t\t\tsglLengthV4(rot[0]),\r\n\t\t\tsglLengthV4(rot[1]),\r\n\t\t\tsglLengthV4(rot[2])\r\n\t\t];\r\n\r\n\t\tvar scRcp = sglRcpV3(sc);\r\n\r\n\t\tvar sMat    = sglScalingM4V(sc);\r\n\t\tvar sMatInv = sglScalingM4V(scRcp);\r\n\r\n\t\trot[0] = sglMulV4S(rot[0], scRcp[0]);\r\n\t\trot[1] = sglMulV4S(rot[1], scRcp[1]);\r\n\t\trot[2] = sglMulV4S(rot[2], scRcp[2]);\r\n\r\n\t\tvar rMatInv = sglIdentityM4();\r\n\t\tsglSetRowM4V(rMatInv, 0, rot[0]);\r\n\t\tsglSetRowM4V(rMatInv, 1, rot[1]);\r\n\t\tsglSetRowM4V(rMatInv, 2, rot[2]);\r\n\r\n\t\tthis._mvpMatrix       = sglMulM4(projectionMatrix, modelViewMatrix);\r\n\t\tthis._billboardMatrix = sglMulM4(sMatInv, sglMulM4(rMatInv, sMat));\r\n\t\tthis._viewport        = viewport.slice(0, 4);\r\n\r\n\t\tthis._vp[0] = this._viewport[2] * 0.5;\r\n\t\tthis._vp[1] = this._viewport[0] + this._viewport[2] * 0.5;\r\n\t\tthis._vp[2] = this._viewport[3] * 0.5;\r\n\t\tthis._vp[3] = this._viewport[1] + this._viewport[3] * 0.5;\r\n\r\n\r\n\t\tvar m = this._mvpMatrix;\r\n\t\tvar q = [ m[3], m[7], m[11] ];\r\n\r\n\t\tthis._planes[0].setup(q[ 0] - m[ 0], q[ 1] - m[ 4], q[ 2] - m[ 8], m[15] - m[12]);\r\n\t\tthis._planes[1].setup(q[ 0] + m[ 0], q[ 1] + m[ 4], q[ 2] + m[ 8], m[15] + m[12]);\r\n\t\tthis._planes[2].setup(q[ 0] - m[ 1], q[ 1] - m[ 5], q[ 2] - m[ 9], m[15] - m[13]);\r\n\t\tthis._planes[3].setup(q[ 0] + m[ 1], q[ 1] + m[ 5], q[ 2] + m[ 9], m[15] + m[13]);\r\n\t\tthis._planes[4].setup(q[ 0] - m[ 2], q[ 1] - m[ 6], q[ 2] - m[10], m[15] - m[14]);\r\n\t\tthis._planes[5].setup(q[ 0] + m[ 2], q[ 1] + m[ 6], q[ 2] + m[10], m[15] + m[14]);\r\n\t},\r\n\r\n\tboxVisibility : function(boxMin, boxMax) {\r\n\t\tvar ret = SGL_INSIDE_FRUSTUM;\r\n\r\n\t\tvar bminmax = [ boxMin, boxMax ];\r\n\r\n\t\tvar fp = null;\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\tfp = this._planes[i];\r\n\t\t\tif (\r\n\t\t\t\t((fp.normal[0] * bminmax[fp.testVertex[0]][0]) +\r\n\t\t\t\t (fp.normal[1] * bminmax[fp.testVertex[1]][1]) +\r\n\t\t\t\t (fp.normal[2] * bminmax[fp.testVertex[2]][2]) +\r\n\t\t\t\t (fp.offset)) < 0.0\r\n\t\t\t) {\r\n\t\t\t\treturn SGL_OUTSIDE_FRUSTUM;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\t((fp.normal[0] * bminmax[1 - fp.testVertex[0]][0]) +\r\n\t\t\t\t (fp.normal[1] * bminmax[1 - fp.testVertex[1]][1]) +\r\n\t\t\t\t (fp.normal[2] * bminmax[1 - fp.testVertex[2]][2]) +\r\n\t\t\t\t (fp.offset)) < 0.0\r\n\t\t\t) {\r\n\t\t\t\tret = SGL_INTERSECT_FRUSTUM;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t},\r\n\r\n\tprojectedSegmentSize : function(center, size) {\r\n\t\tvar hs = size * 0.5;\r\n\r\n\t\tvar p0 = sglV3toV4(center, 0.0);\r\n\t\tvar p1 = [ -hs, 0.0, 0.0, 1.0 ];\r\n\t\tvar p2 = [  hs, 0.0, 0.0, 1.0 ];\r\n\r\n\t\tp1 = sglMulM4V4(this._billboardMatrix, p1);\r\n\t\tp1 = sglAddV4(p1, p0);\r\n\t\tp1 = sglProjectV4(sglMulM4V4(this._mvpMatrix, p1));\r\n\r\n\t\tp2 = sglMulM4V4(this._billboardMatrix, p2);\r\n\t\tp2 = sglAddV4(p2, p0);\r\n\t\tp2 = sglProjectV4(sglMulM4V4(this._mvpMatrix, p2));\r\n\r\n\t\t/*\r\n\t\tp1[0] = this._vp[0] * p1[0] + this._vp[1];\r\n\t\tp2[0] = this._vp[0] * p2[0] + this._vp[1];\r\n\t\t//p1[1] = this.viewport[3] * 0.5 * p1[1] + this.viewport[1] + this.viewport[3] * 0.5;\r\n\r\n\t\tp2[0] = this.viewport[2] * 0.5 * p2[0] + this.viewport[0] + this.viewport[2] * 0.5;\r\n\t\t//p2[1] = this.viewport[3] * 0.5 * p2[1] + this.viewport[1] + this.viewport[3] * 0.5;\r\n\r\n\t\tvar size = aglAbs(p2[0] - p1[0]);\r\n\t\t*/\r\n\r\n\t\tvar sz = this._vp[0] * sglAbs(p2[0] - p1[0]);\r\n\r\n\t\treturn sz;\r\n\t}\r\n};\r\n\r\nfunction sglBoxVisibility(modelViewProjectionMatrix, boxMin, boxMax) {\r\n\tvar fc = new SglFrustum(modelViewProjectionMatrix);\r\n\treturn fc.boxVisibility(boxMin, boxMax);\r\n}\r\n/**********************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// GL utilities\r\n/***********************************************************************/\r\nfunction _sglConsolidateOptions(fullOptions, usedOptions)\r\n{\r\n\tif (usedOptions) {\r\n\t\tfor (var attr in usedOptions) {\r\n\t\t\tfullOptions[attr] = usedOptions[attr];\r\n\t\t}\r\n\t}\r\n\treturn fullOptions;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglBufferInfo\r\n/***********************************************************************/\r\nfunction sglGetBufferOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tusage : gl.STATIC_DRAW\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglBufferInfo.\r\n * @class Holds information about a WebGL buffer object.\r\n */\r\nfunction SglBufferInfo() {\r\n\tthis.handle = null;\r\n\tthis.valid  = false;\r\n\tthis.target = 0;\r\n\tthis.size   = 0;\r\n\tthis.usage  = 0;\r\n}\r\n\r\nfunction sglBufferFromData(gl, target, values, options) {\r\n\tvar opt = sglGetBufferOptions(gl, options);\r\n\tvar buff = gl.createBuffer();\r\n\tgl.bindBuffer(target, buff);\r\n\tgl.bufferData(target, values, opt.usage);\r\n\tgl.bindBuffer(target, null);\r\n\r\n\tvar obj = new SglBufferInfo();\r\n\tobj.handle = buff;\r\n\tobj.valid  = true;\r\n\tobj.target = target;\r\n\tobj.size   = values.sizeInBytes;\r\n\tobj.usage  = opt.usage;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglVertexBufferFromData(gl, values, usage) {\r\n\treturn sglBufferFromData(gl, gl.ARRAY_BUFFER, values, usage);\r\n}\r\n\r\nfunction sglIndexBufferFromData(gl, values, usage) {\r\n\treturn sglBufferFromData(gl, gl.ELEMENT_ARRAY_BUFFER, values, usage);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglShaderInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglShaderInfo.\r\n * @class Holds information about a WebGL shader object.\r\n */\r\nfunction SglShaderInfo() {\r\n\tthis.handle = null;\r\n\tthis.valid  = false;\r\n\tthis.type   = 0;\r\n\tthis.log    = \"\";\r\n}\r\n\r\nfunction sglShaderFromSource(gl, type, src) {\r\n\tvar log = \"\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar shd  = gl.createShader(type);\r\n\tgl.shaderSource(shd, src);\r\n\tgl.compileShader(shd);\r\n\r\n\tlog += \"[SHADER LOG]\\n\";\r\n\tvar valid = true;\r\n\tif (gl.getShaderParameter(shd, gl.COMPILE_STATUS) != 0) {\r\n\t\tlog += \"SUCCESS:\\n\";\r\n\t}\r\n\telse {\r\n\t\tvalid = false;\r\n\t\tlog += \"FAIL:\\n\";\r\n\t}\r\n\tlog += gl.getShaderInfoLog(shd);\r\n\tlog += \"\\n\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar obj = new SglShaderInfo();\r\n\tobj.handle = shd;\r\n\tobj.valid  = valid;\r\n\tobj.type   = type;\r\n\tobj.log    = log;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglVertexShaderFromSource(gl, src) {\r\n\treturn sglShaderFromSource(gl, gl.VERTEX_SHADER, src);\r\n}\r\n\r\nfunction sglFragmentShaderFromSource(gl, src) {\r\n\treturn sglShaderFromSource(gl, gl.FRAGMENT_SHADER, src);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramAttributeInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttributeInfo.\r\n * @class Holds information about a WebGL program active attribute.\r\n */\r\nfunction SglProgramAttributeInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramUniformInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttributeInfo.\r\n * @class Holds information about a WebGL program active uniform.\r\n */\r\nfunction SglProgramUniformInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramSamplerInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramSamplerInfo.\r\n * @class Holds information about a WebGL program active sampler.\r\n */\r\nfunction SglProgramSamplerInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramInfo.\r\n * @class Holds information about a WebGL program object.\r\n */\r\nfunction SglProgramInfo() {\r\n\tthis.handle     = null;\r\n\tthis.valid      = false;\r\n\tthis.shaders    = [ ];\r\n\tthis.attributes = new Object();\r\n\tthis.uniforms   = new Object();\r\n\tthis.samplers   = new Object();\r\n\tthis.log        = \"\";\r\n}\r\n\r\nfunction sglProgramFromShaders(gl, shaders) {\r\n\tvar log = \"\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar prg = gl.createProgram();\r\n\tfor (var s in shaders) {\r\n\t\tvar shd = shaders[s];\r\n\t\t//if (shd.valid) {\r\n\t\t\tgl.attachShader(prg, shd.handle);\r\n\t\t//}\r\n\t}\r\n\tgl.linkProgram(prg);\r\n\r\n\tvar valid = true;\r\n\tvalid = valid && (gl.getProgramParameter(prg, gl.LINK_STATUS)     != 0);\r\n\r\n\t// validation is needed when uniforms are set, so skip this.\r\n\t//gl.validateProgram(prg);\r\n\t//valid = valid && (gl.getProgramParameter(prg, gl.VALIDATE_STATUS) != 0);\r\n\r\n\tlog += \"[PROGRAM LOG]\\n\";\r\n\tif (valid) {\r\n\t\tlog += \"SUCCESS:\\n\";\r\n\t}\r\n\telse {\r\n\t\tlog += \"FAIL:\\n\";\r\n\t}\r\n\tlog += gl.getProgramInfoLog(prg);\r\n\tlog += \"\\n\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar obj = new SglProgramInfo();\r\n\tobj.handle = prg;\r\n\tobj.valid  = valid;\r\n\tfor (var s in shaders) {\r\n\t\tvar shd = shaders[s]\r\n\t\t//if (shd.valid) {\r\n\t\t\tobj.shaders.push(shd);\r\n\t\t//}\r\n\t}\r\n\tobj.log = log;\r\n\r\n\tvar attribs_count = gl.getProgramParameter(prg, gl.ACTIVE_ATTRIBUTES);\r\n\tvar attr, loc, a;\r\n\tfor (var i=0; i<attribs_count; ++i) {\r\n\t\tattr = gl.getActiveAttrib(prg, i);\r\n\t\tif (!attr) continue;\r\n\t\ta    = new SglProgramAttributeInfo();\r\n\t\ta.name = attr.name;\r\n\t\ta.nativeType = attr.type;\r\n\t\ta.size = attr.size;\r\n\t\ta.location = gl.getAttribLocation(prg, attr.name);\r\n\t\tobj.attributes[a.name] = a;\r\n\t}\r\n\r\n\tvar uniforms_count = gl.getProgramParameter(prg, gl.ACTIVE_UNIFORMS);\r\n\tvar unif, loc, u;\r\n\tfor (var i=0; i<uniforms_count; ++i) {\r\n\t\tunif = gl.getActiveUniform(prg, i);\r\n\t\tif (!unif) continue;\r\n\t\tloc  = gl.getUniformLocation(prg, unif.name);\r\n\t\tif ((unif.type == gl.SAMPLER_2D) || (unif.type == gl.SAMPLER_CUBE) || (unif.type == 35682)) {\r\n\t\t\ts = new SglProgramSamplerInfo();\r\n\t\t\ts.name = unif.name;\r\n\t\t\ts.nativeType = unif.type;\r\n\t\t\ts.size = unif.size;\r\n\t\t\ts.location = loc;\r\n\t\t\tobj.samplers[s.name] = s;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tu = new SglProgramUniformInfo();\r\n\t\t\tu.name = unif.name;\r\n\t\t\tu.nativeType = unif.type;\r\n\t\t\tu.size = unif.size;\r\n\t\t\tu.location = loc;\r\n\t\t\tobj.uniforms[u.name] = u;\r\n\t\t}\r\n\t}\r\n\r\n\tsglSetDefaultProgramBindings(gl, obj);\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglProgramFromSources(gl, vertexSources, fragmentSources) {\r\n\tvar shd = null;\r\n\tvar shaders = [ ];\r\n\tfor (var s in vertexSources) {\r\n\t\tvar src = vertexSources[s];\r\n\t\tshd = sglVertexShaderFromSource(gl, src);\r\n\t\tshaders.push(shd);\r\n\t}\r\n\tfor (var s in fragmentSources) {\r\n\t\tvar src = fragmentSources[s];\r\n\t\tshd = sglFragmentShaderFromSource(gl, src);\r\n\t\tshaders.push(shd);\r\n\t}\r\n\treturn sglProgramFromShaders(gl, shaders);\r\n}\r\n\r\nfunction sglSetDefaultProgramBindings(gl, programInfo) {\r\n\tvar prg = programInfo.handle;\r\n\r\n\t// ensure index is sequential in \"for (attr in programInfo.attributes)\" loops\r\n\tvar index = 0;\r\n\tfor (var v in programInfo.attributes) {\r\n\t\tvar vattr = programInfo.attributes[v];\r\n\t\tgl.bindAttribLocation(prg, index, vattr.name);\r\n\t\tvattr.location = index;\r\n\t\tindex++;\r\n\t}\r\n\t// must relink after attributes binding\r\n\tgl.linkProgram(prg);\r\n\r\n\t// uniform locations could change after program linking, so update them\r\n\tfor (var u in programInfo.uniforms) {\r\n\t\tvar unif = programInfo.uniforms[u];\r\n\t\tunif.location = gl.getUniformLocation(prg, unif.name);\r\n\t}\r\n\r\n\tgl.useProgram(programInfo.handle);\r\n\t// ensure texture unit is sequential in \"for (attr in programInfo.samplers)\" loops\r\n\tvar unit = 0;\r\n\tfor (var s in programInfo.samplers) {\r\n\t\tvar smp = programInfo.samplers[s];\r\n\t\tsmp.location = gl.getUniformLocation(prg, smp.name);\r\n\t\tgl.uniform1i(smp.location, unit);\r\n\t\tunit++;\r\n\t}\r\n\t//gl.useProgram(null);\r\n}\r\n\r\nfunction sglProgramSynchronize(gl, programInfo) {\r\n\tvar prg = programInfo.handle;\r\n\r\n\tfor (var v in programInfo.attributes) {\r\n\t\tvar vattr = programInfo.attributes[v];\r\n\t\tvattr.location = gl.getAttribLocation(prg, vattr.name);\r\n\t}\r\n\r\n\tfor (var u in programInfo.uniforms) {\r\n\t\tvar unif = programInfo.uniforms[u];\r\n\t\tunif.location = gl.getUniformLocation(prg, unif.name);\r\n\t}\r\n\r\n\tfor (var s in programInfo.samplers) {\r\n\t\tvar smp = programInfo.samplers[s];\r\n\t\tsmp.location = gl.getUniformLocation(prg, smp.name);\r\n\t}\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglTextureInfo\r\n/***********************************************************************/\r\nfunction sglGetTextureOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tminFilter        : gl.LINEAR,\r\n\t\tmagFilter        : gl.LINEAR,\r\n\t\twrapS            : gl.CLAMP_TO_EDGE,\r\n\t\twrapT            : gl.CLAMP_TO_EDGE,\r\n\t\tisDepth          : false,\r\n\t\tdepthMode        : gl.LUMINANCE,\r\n\t\tdepthCompareMode : gl.COMPARE_R_TO_TEXTURE,\r\n\t\tdepthCompareFunc : gl.LEQUAL,\r\n\t\tgenerateMipmap   : false,\r\n\t\tflipY            : true,\r\n\t\tpremultiplyAlpha : false,\r\n\t\tonload           : null\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglTextureInfo.\r\n * @class Holds information about a WebGL texture object.\r\n */\r\nfunction SglTextureInfo() {\r\n\tthis.handle           = null;\r\n\tthis.valid            = false;\r\n\tthis.target           = 0;\r\n\tthis.format           = 0;\r\n\tthis.width            = 0;\r\n\tthis.height           = 0;\r\n\tthis.minFilter        = 0;\r\n\tthis.magFilter        = 0;\r\n\tthis.wrapS            = 0;\r\n\tthis.wrapT            = 0;\r\n\tthis.isDepth          = false;\r\n\tthis.depthMode        = 0;\r\n\tthis.depthCompareMode = 0;\r\n\tthis.depthCompareFunc = 0;\r\n}\r\n\r\nfunction sglTexture2DFromData(gl, internalFormat, width, height, sourceFormat, sourceType, texels, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\t// Chrome does not like texels == null\r\n\tif (!texels) {\r\n\t\tif (sourceType == gl.FLOAT) {\r\n\t\t\ttexels = new Float32Array(width * height * 4);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttexels = new Uint8Array(width * height * 4);\r\n\t\t}\r\n\t}\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tgl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, width, height, 0, sourceFormat, sourceType, texels);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.isDepth) {\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.DEPTH_TEXTURE_MODE,   opt.depthMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, opt.depthCompareMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, opt.depthCompareFunc);\r\n\t}\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_2D);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_2D;\r\n\tobj.format           = internalFormat;\r\n\tobj.width            = width;\r\n\tobj.height           = height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = opt.isDepth;\r\n\tobj.depthMode        = opt.depthMode;\r\n\tobj.depthCompareMode = opt.depthCompareMode;\r\n\tobj.depthCompareFunc = opt.depthCompareFunc;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTexture2DFromImage(gl, image, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_2D);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_2D;\r\n\tobj.format           = gl.RGBA;\r\n\tobj.width            = image.width;\r\n\tobj.height           = image.height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = false;\r\n\tobj.depthMode        = 0;\r\n\tobj.depthCompareMode = 0;\r\n\tobj.depthCompareFunc = 0;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTexture2DFromUrl(gl, url, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\tvar obj = new SglTextureInfo();\r\n\r\n\tvar img = new Image();\r\n\timg.crossOrigin = '';\r\n\timg.onload = function() {\r\n\t\tvar texInfo = sglTexture2DFromImage(gl, img, opt);\r\n\t\tfor (var a in texInfo) {\r\n\t\t\tobj[a] = texInfo[a];\r\n\t\t}\r\n\t\tif (opt.onload) {\r\n\t\t\topt.onload(gl, obj, url);\r\n\t\t}\r\n\t};\r\n\timg.src = url;\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/***********************************************************************/\r\nfunction sglTextureCubeFromData(gl, internalFormat, width, height, sourceFormat, sourceType, facesTexels, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\t// Chrome does not like texels == null\r\n\tif (!facesTexels) {\r\n\t\tvar tx = null;\r\n\t\tif (sourceType == gl.FLOAT) {\r\n\t\t\ttx = new Float32Array(width * height * 4);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttx = new Uint8Array(width * height * 4);\r\n\t\t}\r\n\t\tfacesTexels = new Array(6);\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\tfacesTexels[i] = tx;\r\n\t\t}\r\n\t}\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tgl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, internalFormat, width, height, 0, sourceFormat, sourceType, facesTexels[i]);\r\n\t}\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.isDepth) {\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.DEPTH_TEXTURE_MODE,   opt.depthMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_MODE, opt.depthCompareMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_FUNC, opt.depthCompareFunc);\r\n\t}\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_CUBE_MAP;\r\n\tobj.format           = internalFormat;\r\n\tobj.width            = width;\r\n\tobj.height           = height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = opt.isDepth;\r\n\tobj.depthMode        = opt.depthMode;\r\n\tobj.depthCompareMode = opt.depthCompareMode;\r\n\tobj.depthCompareFunc = opt.depthCompareFunc;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTextureCubeFromImages(gl, images, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tgl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, images[i]);\r\n\t}\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_CUBE_MAP;\r\n\tobj.format           = gl.RGBA;\r\n\tobj.width            = images[0].width;\r\n\tobj.height           = images[0].height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = false;\r\n\tobj.depthMode        = 0;\r\n\tobj.depthCompareMode = 0;\r\n\tobj.depthCompareFunc = 0;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTextureCubeFromUrls(gl, urls, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\tvar obj = new SglTextureInfo();\r\n\r\n\tvar remaining = 6;\r\n\tvar images = new Array(6);\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\timages[i] = new Image();\r\n\t\timages[i].crossOrigin = '';\r\n\t}\r\n\tvar watcher = function() {\r\n\t\tremaining--;\r\n\t\tif (remaining == 0) {\r\n\t\t\tvar texInfo = sglTextureCubeFromImages(gl, images, opt);\r\n\t\t\tfor (var a in texInfo) {\r\n\t\t\t\tobj[a] = texInfo[a];\r\n\t\t\t}\r\n\t\t\tif (opt.onload) {\r\n\t\t\t\topt.onload(gl, obj, urls);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\timages[i].onload = watcher;\r\n\t\timages[i].src    = urls[i];\r\n\t}\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglRenderbufferInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglRenderbufferInfo.\r\n * @class Holds information about a WebGL renderbuffer object.\r\n */\r\nfunction SglRenderbufferInfo() {\r\n\tthis.handle    = null;\r\n\tthis.valid     = false;\r\n\tthis.target    = 0;\r\n\tthis.format    = 0;\r\n\tthis.width     = 0;\r\n\tthis.height    = 0;\r\n}\r\n\r\nfunction sglRenderbufferFromFormat(gl, format, width, height) {\r\n\tvar rb = gl.createRenderbuffer();\r\n\tgl.bindRenderbuffer(gl.RENDERBUFFER, rb);\r\n\tgl.renderbufferStorage(gl.RENDERBUFFER, format, width, height);\r\n\tgl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n\r\n\tvar obj = new SglRenderbufferInfo();\r\n\tobj.handle = rb;\r\n\tobj.valid  = true;\r\n\tobj.target = gl.RENDERBUFFER;\r\n\tobj.format = format;\r\n\tobj.width  = width;\r\n\tobj.height = height;\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglFramebufferInfo\r\n/***********************************************************************/\r\nfunction sglGetFramebufferOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tminFilter             : gl.LINEAR,\r\n\t\tmagFilter             : gl.LINEAR,\r\n\t\twrapS                 : gl.CLAMP_TO_EDGE,\r\n\t\twrapT                 : gl.CLAMP_TO_EDGE,\r\n\t\tisDepth               : false,\r\n\t\tdepthMode             : gl.LUMINANCE,\r\n\t\tdepthCompareMode      : gl.COMPARE_R_TO_TEXTURE,\r\n\t\tdepthCompareFunc      : gl.LEQUAL,\r\n\t\tcolorsAsRenderbuffer  : false,\r\n\t\tdepthAsRenderbuffer   : false,\r\n\t\tstencilAsRenderbuffer : false,\r\n\t\tgenerateColorsMipmap  : false,\r\n\t\tgenerateDepthMipmap   : false,\r\n\t\tgenerateStencilMipmap : false\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglFramebufferInfo.\r\n * @class Holds information about a WebGL framebuffer object.\r\n */\r\nfunction SglFramebufferInfo() {\r\n\tthis.handle        = null;\r\n\tthis.valid         = false;\r\n\tthis.width         = 0;\r\n\tthis.height        = 0;\r\n\tthis.colorTargets  = [ ];\r\n\tthis.depthTarget   = null;\r\n\tthis.stencilTarget = null;\r\n\tthis.status        = 0;\r\n}\r\n\r\nfunction sglFramebufferFromTargets(gl, colorTargets, depthTarget, stencilTarget, options) {\r\n\tvar opt = sglGetFramebufferOptions(gl, options);\r\n\r\n\tvar fb = gl.createFramebuffer();\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, fb);\r\n\r\n\tif ((depthTarget != undefined) && (depthTarget != null) && (depthTarget != gl.NONE)) {\r\n\t\tif (depthTarget.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, depthTarget.handle, 0);\r\n\t\t}\r\n\t\telse if (depthTarget.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthTarget.handle);\r\n\t\t}\r\n\t}\r\n\r\n\tif ((stencilTarget != undefined) && (stencilTarget != null) && (stencilTarget != gl.NONE)) {\r\n\t\tif (stencilTarget.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.TEXTURE_2D, stencilTarget.handle, 0);\r\n\t\t}\r\n\t\telse if (stencilTarget.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.RENDERBUFFER, stencilTarget.handle);\r\n\t\t}\r\n\t}\r\n\r\n\tvar cts = [ ];\r\n\tvar drawBuffers = [ ];\r\n\tif ((colorTargets != undefined) && (colorTargets != null)) {\r\n\t\tvar n = colorTargets.length;\r\n\t\tif (n == 0) {\r\n\t\t\tdrawBuffers.push(gl.NONE);\r\n\t\t\t//gl.readBuffer(gl.NONE);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar att = gl.COLOR_ATTACHMENT0;\r\n\t\t\tfor (var c in colorTargets) {\r\n\t\t\t\tvar ct = colorTargets[c];\r\n\t\t\t\tif (ct.target == gl.TEXTURE_2D) {\r\n\t\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, ct.handle, 0);\r\n\t\t\t\t}\r\n\t\t\t\telse if (ct.target == gl.RENDERBUFFER) {\r\n\t\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, ct.handle);\r\n\t\t\t\t}\r\n\t\t\t\tdrawBuffers.push(att);\r\n\t\t\t\tcts.push(ct);\r\n\t\t\t\tatt++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//gl.drawBuffers(drawBuffers);\r\n\tvar fbStatus = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n\tvar trg = null;\r\n\tif (cts.length > 0) {\r\n\t\ttrg = cts[0];\r\n\t}\r\n\telse if (depthTarget) {\r\n\t\ttrg = depthTarget;\r\n\t}\r\n\telse if (stencilTarget) {\r\n\t\ttrg = stencilTarget;\r\n\t}\r\n\r\n\tvar width  = 0;\r\n\tvar height = 0;\r\n\tif (trg) {\r\n\t\twidth  = trg.width;\r\n\t\theight = trg.height;\r\n\t}\r\n\r\n\tvar obj = new SglFramebufferInfo()\r\n\tobj.handle        = fb;\r\n\tobj.valid         = (fbStatus == gl.FRAMEBUFFER_COMPLETE);\r\n\tobj.width         = width;\r\n\tobj.height        = height;\r\n\tobj.colorTargets  = cts;\r\n\tobj.depthTarget   = (depthTarget  ) ? (depthTarget  ) : (null);\r\n\tobj.stencilTarget = (stencilTarget) ? (stencilTarget) : (null);\r\n\tobj.status        = fbStatus;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglFramebufferFromFormats(gl, width, height, colorFormats, depthFormat, stencilFormat, options) {\r\n\tvar opt = sglGetFramebufferOptions(gl, options);\r\n\r\n\tvar colorTargets = null;\r\n\tif (colorFormats) {\r\n\t\topt.isDepth = false;\r\n\t\tcolorTargets = [ ];\r\n\t\tvar ct = null;\r\n\t\tif (opt.colorsAsRenderbuffer) {\r\n\t\t\tfor (var c in colorFormats) {\r\n\t\t\t\tvar cc = colorFormats[c];\r\n\t\t\t\tct = sglRenderbufferFromFormat(gl, cc, width, height);\r\n\t\t\t\tcolorTargets.push(ct);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateColorsMipmap;\r\n\t\t\tfor (var c in colorFormats) {\r\n\t\t\t\tvar cc = colorFormats[c];\r\n\t\t\t\tct = sglTexture2DFromData(gl, cc, width, height, gl.RGBA, gl.UNSIGNED_BYTE, null, opt);\r\n\t\t\t\tcolorTargets.push(ct);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar depthTarget = null;\r\n\tif (depthFormat) {\r\n\t\topt.isDepth = true;\r\n\t\tif (opt.depthAsRenderbuffer) {\r\n\t\t\tdepthTarget = sglRenderbufferFromFormat(gl, depthFormat, width, height);\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateDepthMipmap;\r\n\t\t\tdepthTarget = sglTexture2DFromData(gl, depthFormat, width, height, gl.DEPTH_COMPONENT, gl.FLOAT, null, opt);\r\n\t\t}\r\n\t}\r\n\r\n\tvar stencilTarget = null;\r\n\tif (stencilFormat) {\r\n\t\topt.isDepth = false;\r\n\t\tif (opt.stencilAsRenderbuffer) {\r\n\t\t\tstencilTarget = sglRenderbufferFromFormat(gl, stencilFormat, width, height);\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateStencilMipmap;\r\n\t\t\tstencilTarget = sglTexture2DFromData(gl, stencilFormat, width, height, gl.STENCIL_COMPONENT, gl.UNSIGNED_BYTE, null, opt);\r\n\t\t}\r\n\t}\r\n\r\n\treturn sglFramebufferFromTargets(gl, colorTargets, depthTarget, stencilTarget, opt);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglVertexBuffer\r\n/***********************************************************************/\r\n// SglVertexBuffer(gl, info)\r\n// SglVertexBuffer(gl, values, usage)\r\n/**\r\n * Constructs a SglVertexBuffer.\r\n * @class Manages a WebGL vertex buffer object.\r\n */\r\nfunction SglVertexBuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\tif (arguments[1] instanceof SglBufferInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglVertexBufferFromData(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n}\r\n\r\nSglVertexBuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid) {\r\n\t\t\tthis.gl.deleteBuffer(this._info.handle);\r\n\t\t}\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglIndexBuffer\r\n/***********************************************************************/\r\n// SglIndexBuffer(gl, info)\r\n// SglIndexBuffer(gl, values, usage)\r\n/**\r\n * Constructs a SglIndexBuffer.\r\n * @class Manages a WebGL index buffer object.\r\n */\r\nfunction SglIndexBuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\tif (arguments[1] instanceof SglBufferInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglIndexBufferFromData(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n}\r\n\r\nSglIndexBuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid) {\r\n\t\t\tthis.gl.deleteBuffer(this._info.handle);\r\n\t\t}\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramAttribute\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttribute.\r\n * @class Manages a program attribute.\r\n */\r\nfunction SglProgramAttribute(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n}\r\n\r\nSglProgramAttribute.prototype = {\r\n\tset index(n) {\r\n\t\tthis._prog.gl.bindAttribLocation(this._prog._info.handle, n, this._info.name)\r\n\t\tthis._info.location = n;\r\n\t},\r\n\r\n\tget index () {\r\n\t\treturn this._info.location;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramUniform\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramUniform.\r\n * @class Manages a program uniform.\r\n */\r\nfunction SglProgramUniform(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n\tthis._func = null;\r\n\r\n\tvar gl   = this._prog.gl;\r\n\tvar type = this._info.nativeType;\r\n\r\n\tif (type == gl.BOOL) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1i(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1i(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1f(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix2fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix3fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix4fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse {\r\n\t\tsglUnknown();\r\n\t}\r\n}\r\n\r\nSglProgramUniform.prototype = {\r\n\tset value(v) {\r\n\t\tthis._func(v);\r\n\t},\r\n\r\n\tget value() {\r\n\t\treturn this._prog.gl.getUniform(this._prog._info.handle, this._info.location);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramSampler\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramSampler.\r\n * @class Manages a program sampler.\r\n */\r\nfunction SglProgramSampler(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n\tthis._unit = -1;\r\n\r\n\tvar gl   = this._prog.gl;\r\n\tvar type = this._info.nativeType;\r\n\r\n\tif (type == gl.SAMPLER_2D) {\r\n\t\t;\r\n\t}\r\n\telse if (type == gl.SAMPLER_CUBE) {\r\n\t\t;\r\n\t}\r\n\telse if (type == 35682) {\r\n\t\t;\r\n\t}\r\n\telse {\r\n\t\tsglUnknown();\r\n\t}\r\n}\r\n\r\nSglProgramSampler.prototype = {\r\n\tset unit(n) {\r\n\t\tthis._prog.gl.uniform1i(this._info.location, n);\r\n\t\tthis._unit = n;\r\n\t},\r\n\r\n\tget unit() {\r\n\t\t//return this._prog.gl.getUniform(this._prog._info.handle, this._info.location);\r\n\t\treturn this._unit;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgram\r\n/***********************************************************************/\r\n// SglProgram(gl, info)\r\n// SglProgram(gl, [vertexSources], [fragmentSources])\r\n/**\r\n * Constructs a SglProgram.\r\n * @class Manages a WebGL program object.\r\n */\r\nfunction SglProgram() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tif (arguments[1] instanceof SglProgramInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglProgramFromSources(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n\r\n\tthis._attributes = new Object();\r\n\tfor (var a in this._info.attributes) {\r\n\t\tthis._attributes[a] = new SglProgramAttribute(this, this._info.attributes[a]);\r\n\t}\r\n\r\n\tthis._uniforms = new Object();\r\n\tfor (var u in this._info.uniforms) {\r\n\t\tthis._uniforms[u] = new SglProgramUniform(this, this._info.uniforms[u]);\r\n\t}\r\n\r\n\tvar unit = 0;\r\n\tthis._samplers = new Object();\r\n\tfor (var s in this._info.samplers) {\r\n\t\tthis._samplers[s] = new SglProgramSampler(this, this._info.samplers[s]);\r\n\t\tthis._samplers[s]._unit = unit;\r\n\t\tunit++;\r\n\t}\r\n}\r\n\r\nSglProgram.prototype =\r\n{\r\n\tget info()       { return this._info;        },\r\n\tget attributes() { return this._attributes;  },\r\n\tget uniforms()   { return this._uniforms;    },\r\n\tget samplers()   { return this._samplers;    },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid == null) return;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tgl.deleteProgram(this._info.handle);\r\n\t\tfor (var s in this._info.shaders) {\r\n\t\t\tgl.deleteShader(this._info.shaders[s].handle);\r\n\t\t}\r\n\r\n\t\tthis._attributes = null;\r\n\t\tthis._uniforms   = null;\r\n\t\tthis._samplers   = null;\r\n\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tget log() {\r\n\t\tvar log = \"\";\r\n\t\tlog += \"-------------------------------------\\n\";\r\n\t\tfor (var s in this._info.shaders) {\r\n\t\t\tlog += this._info.shaders[s].log;\r\n\t\t}\r\n\t\tlog += this._info.log;\r\n\t\tlog += \"-------------------------------------\\n\";\r\n\t\tlog += \"\\n\";\r\n\t\treturn log;\r\n\t},\r\n\r\n\tsetDefaultBindings : function() {\r\n\t\tsglSetDefaultProgramBindings(this.gl, this._info);\r\n\t},\r\n\r\n\tsynchronize : function() {\r\n\t\tsglProgramSynchronize(this.gl, this._info);\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.useProgram(this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\t//this.gl.useProgram(null);\r\n\t},\r\n\r\n\tsetAttributes : function(mapping) {\r\n\t\tvar attr = null;\r\n\t\tfor (var a in mapping) {\r\n\t\t\tattr = this._attributes[a];\r\n\t\t\tif (attr) {\r\n\t\t\t\tattr.index = mapping[a];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.link();\r\n\t},\r\n\r\n\tsetUniforms : function(mapping) {\r\n\t\tvar unif = null;\r\n\t\tfor (var u in mapping) {\r\n\t\t\tunif = this._uniforms[u];\r\n\t\t\tif (unif) {\r\n\t\t\t\tunif.value = mapping[u];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetSamplers : function(mapping) {\r\n\t\tvar smp = null;\r\n\t\tfor (var s in mapping) {\r\n\t\t\tsmp = this._samplers[s];\r\n\t\t\tif (smp != undefined) {\r\n\t\t\t\tsmp.unit = mapping[s];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTexture2D\r\n/***********************************************************************/\r\n// SglTexture2D(gl, info)\r\n// SglTexture2D(gl, internalFormat, width, height, sourceFormat, sourceType, texels, options)\r\n// SglTexture2D(gl, image, options)\r\n// SglTexture2D(gl, url, options)\r\n/**\r\n * Constructs a SglTexture2D.\r\n * @class Manages a WebGL 2D texture object.\r\n */\r\nfunction SglTexture2D() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif ((n == 2) || (n == 3)) {\r\n\t\tif (arguments[1] instanceof Image) {\r\n\t\t\tthis._info = sglTexture2DFromImage(gl, arguments[1], arguments[2]);\r\n\t\t}\r\n\t\t//else if (arguments[1] instanceof String) {\r\n\t\telse if (typeof(arguments[1]) == \"string\") {\r\n\t\t\tthis._info = sglTexture2DFromUrl(gl, arguments[1], arguments[2]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._info = arguments[1];\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglTexture2DFromData(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7]);\r\n\t}\r\n}\r\n\r\nSglTexture2D.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteTexture(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, null);\r\n\t},\r\n\r\n\tgenerateMipmap : function() {\r\n\t\tthis.gl.generateMipmap(this._info.target);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTextureCube\r\n/***********************************************************************/\r\n// SglTextureCube(gl, info)\r\n// SglTextureCube(gl, internalFormat, width, height, sourceFormat, sourceType, facesTexels, options)\r\n// SglTextureCube(gl, images, options)\r\n// SglTextureCube(gl, urls, options)\r\n/**\r\n * Constructs a SglTextureCube.\r\n * @class Manages a WebGL cube texture object.\r\n */\r\nfunction SglTextureCube() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif ((n == 2) || (n == 3)) {\r\n\t\tif (arguments[1] instanceof Array) {\r\n\t\t\tif (arguments[1][0] instanceof Image) {\r\n\t\t\t\tthis._info = sglTextureCubeFromImages(gl, arguments[1], arguments[2]);\r\n\t\t\t}\r\n\t\t\t//else if (arguments[1] instanceof String) {\r\n\t\t\telse if (typeof(arguments[1][0]) == \"string\") {\r\n\t\t\t\tthis._info = sglTextureCubeFromUrls(gl, arguments[1], arguments[2]);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._info = arguments[1];\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglTextureCubeFromData(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7]);\r\n\t}\r\n}\r\n\r\nSglTextureCube.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteTexture(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, null);\r\n\t},\r\n\r\n\tgenerateMipmap : function() {\r\n\t\tthis.gl.generateMipmap(this._info.target);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglRenderbuffer\r\n/***********************************************************************/\r\n// SglRenderbuffer(gl, info)\r\n// SglRenderbuffer(gl, format, width, height)\r\n/**\r\n * Constructs a SglRenderbuffer.\r\n * @class Manages a WebGL renderbuffer object.\r\n */\r\nfunction SglRenderbuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif (n == 2) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglRenderbufferFromFormat(gl, arguments[1], arguments[2], arguments[3]);\r\n\t}\r\n}\r\n\r\nSglRenderbuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteRenderbuffer(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindRenderbuffer(this.gl.RENDERBUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindRenderbuffer(this.gl.RENDERBUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglFramebuffer\r\n/***********************************************************************/\r\n// SglFramebuffer(gl, info)\r\n// SglFramebuffer(gl, width, height, colorFormats, depthFormat, stencilFormat, options)\r\n/**\r\n * Constructs a SglFramebuffer.\r\n * @class Manages a WebGL framebuffer object.\r\n */\r\nfunction SglFramebuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif (n == 2) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglFramebufferFromFormats(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6]);\r\n\t}\r\n\r\n\tvar s = null;\r\n\tvar t = null;\r\n\r\n\tthis._colorTargets = [ ];\r\n\tfor (var c in this._info.colorTargets) {\r\n\t\ts = this._info.colorTargets[c];\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._colorTargets.push(t);\r\n\t}\r\n\r\n\tthis._depthTarget = null;\r\n\tif (this._info.depthTarget) {\r\n\t\ts = this._info.depthTarget;\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._depthTarget = t;\r\n\t}\r\n\r\n\tthis._stencilTarget = null;\r\n\tif (this._info.stencilTarget) {\r\n\t\ts = this._info.stencilTarget;\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._stencilTarget = t;\r\n\t}\r\n}\r\n\r\nSglFramebuffer.prototype = {\r\n\tget info()          { return this._info;          },\r\n\tget colorTargets()  { return this._colorTargets;  },\r\n\tget depthTarget()   { return this._depthTarget;   },\r\n\tget stencilTarget() { return this._stencilTarget; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteFramebuffer(this._info.handle);\r\n\t\tfor (var t in this._colorTargets) {\r\n\t\t\tvar ct = this._colorTargets[t];\r\n\t\t\tif (ct) {\r\n\t\t\t\tthis._colorTargets[t].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._depthTarget) {\r\n\t\t\tthis._depthTarget.destroy();\r\n\t\t}\r\n\t\tif (this._stencilTarget) {\r\n\t\t\tthis._stencilTarget.destroy();\r\n\t\t}\r\n\t\tthis._info   = null;\r\n\t\tthis.targets = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tget width() {\r\n\t\treturn this._info.width;\r\n\t},\r\n\r\n\tget height() {\r\n\t\treturn this._info.height;\r\n\t},\r\n\r\n\tbind : function(setViewport) {\r\n\t\tvar vp = true;\r\n\t\tif (setViewport != undefined) vp = setViewport;\r\n\r\n\t\tif (vp) {\r\n\t\t\tthis.gl.viewport(0, 0, this._info.width, this._info.height);\r\n\t\t}\r\n\r\n\t\tthis.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\r\n\t},\r\n\r\n\tbindColor : function(index, unit) {\r\n\t\tthis._colorTargets[index].bind(unit);\r\n\t},\r\n\r\n\tunbindColor : function(index, unit) {\r\n\t\tthis._colorTargets[index].unbind(unit);\r\n\t},\r\n\r\n\tbindDepth : function(unit) {\r\n\t\tthis._depthTarget.bind(unit);\r\n\t},\r\n\r\n\tunbindDepth : function(unit) {\r\n\t\tthis._depthTarget.unbind(unit);\r\n\t},\r\n\r\n\tbindStencil : function(unit) {\r\n\t\tthis._stencilTarget.bind(unit);\r\n\t},\r\n\r\n\tunbindStencil : function(unit) {\r\n\t\tthis._stencilTarget.unbind(unit);\r\n\t},\r\n\r\n\tgenerateMipmap : function(colors, depth, stencil) {\r\n\t\tvar t = null;\r\n\r\n\t\tif (colors) {\r\n\t\t\tfor (var c in this._colorTargets) {\r\n\t\t\t\tt = this._colorTargets[c];\r\n\t\t\t\tif (!t) continue;\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (depth) {\r\n\t\t\tt = this._depthTarget;\r\n\t\t\tif (t) {\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (stencil) {\r\n\t\t\tt = this._stencilTarget;\r\n\t\t\tif (t) {\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tattachColorTarget : function(index, t) {\r\n\t\tif (!t) return false;\r\n\t\tif ((index < 0) || (index >= this._colorTargets.length)) return false;\r\n\t\tif ((t.width != this.width) || (t.height != this.height)) return false;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tvar att = this.gl.COLOR_ATTACHMENT0 + index;\r\n\t\tif (t.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, t.handle, 0);\r\n\t\t}\r\n\t\telse if (t.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, t.handle);\r\n\t\t}\r\n\r\n\t\tthis._colorTargets[index] = t;\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tdetachColorTarget : function(index) {\r\n\t\tif ((index < 0) || (index >= this._colorTargets.length)) return false;\r\n\r\n\t\tvar t = this._colorTargets[index]\r\n\t\tif (!t) return false;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tif (t.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, null, 0);\r\n\t\t}\r\n\t\telse if (t.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, null);\r\n\t\t}\r\n\r\n\t\tthis._colorTargets[index] = null;\r\n\r\n\t\treturn true;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglAttributeStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglAttributeStreamJS.\r\n * @class Holds the properties and the storage array of a vertex attribute stream.\r\n */\r\nfunction SglAttributeStreamJS(name, size, values, byCopy) {\r\n\tthis._name = name;\r\n\tthis._size = size;\r\n\tthis._buff = (byCopy) ? ((values) ? (values.slice()) : (null)) : (values);\r\n}\r\n\r\nSglAttributeStreamJS.prototype = {\r\n\tget name()       { return this._name; },\r\n\tget size()       { return this._size; },\r\n\tget buffer()     { return this._buff; },\r\n\tget length()     { return this._buff.length; },\r\n\r\n\tget : function(index) {\r\n\t\treturn this._buff.slice(index * this._size, this._size);\r\n\t},\r\n\r\n\tset : function(index, value) {\r\n\t\tvar k = index * this._size;\r\n\t\tfor (var i=0; i<this._size; ++i) {\r\n\t\t\tthis._buff[k++] = value[i];\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglVertexStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglVertexStreamJS.\r\n * @class Container of vertex attribute streams.\r\n */\r\nfunction SglVertexStreamJS() {\r\n\tthis._attribs = { };\r\n\tthis._length  = 0;\r\n}\r\n\r\nSglVertexStreamJS.prototype = {\r\n\tget attributes() { return this._attribs; },\r\n\tget length()     { return this._length;  },\r\n\r\n\taddAttribute : function(name, size, values, byCopy) {\r\n\t\tvar attr = new SglAttributeStreamJS(name, size, values, byCopy);\r\n\t\tthis._attribs[name] = attr;\r\n\t\tthis._length = attr.length;\r\n\t},\r\n\r\n\tremoveAttribute : function(name) {\r\n\t\tif (!this._attribs[name]) return;\r\n\r\n\t\tdelete this._attribs[name];\r\n\r\n\t\tthis._length = 0;\r\n\t\tfor (var a in this._attribs) {\r\n\t\t\tthis._length = this._attribs[a].length;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\nvar SGL_ARRAY_PRIMITIVE_STREAM          = 1;\r\nvar SGL_INDEXED_PRIMITIVE_STREAM        = 2;\r\nvar SGL_PACKED_INDEXED_PRIMITIVE_STREAM = 3;\r\n\r\nvar SGL_POINTS_LIST    = 1;\r\nvar SGL_LINES_LIST     = 2;\r\nvar SGL_LINE_STRIP     = 3;\r\nvar SGL_LINE_LOOP      = 4;\r\nvar SGL_TRIANGLES_LIST = 5;\r\nvar SGL_TRIANGLE_STRIP = 6;\r\nvar SGL_TRIANGLE_FAN   = 7;\r\n\r\n\r\n// SglPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPrimitiveStreamJS.\r\n * @class Holds the primitives stream information and storage (if any).\r\n */\r\nfunction SglPrimitiveStreamJS(name, mode, first, length) {\r\n\tthis._name = name;\r\n\tthis._mode = mode;\r\n\tthis._first  = (first)  ? (first)  : (0);\r\n\tthis._length = (length) ? (length) : (0);\r\n}\r\n\r\nSglPrimitiveStreamJS.prototype = {\r\n\tget type()   { return undefined;    },\r\n\tget name()   { return this._name;   },\r\n\tget mode()   { return this._mode;   },\r\n\tget first()  { return this._first;  },\r\n\tget length() { return this._length; }\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglArrayPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglArrayPrimitiveStreamJS.\r\n * @class Holds the array primitive stream information.\r\n */\r\nfunction SglArrayPrimitiveStreamJS(name, mode, first, count) {\r\n\tSglPrimitiveStreamJS.call(this, name, mode, first, count);\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_ARRAY_PRIMITIVE_STREAM;}});\r\n}\r\n\r\nsglInherit(SglArrayPrimitiveStreamJS, SglPrimitiveStreamJS);\r\n/*sglDefineGetter(SglArrayPrimitiveStreamJS, \"type\", function() {\r\n\treturn SGL_ARRAY_PRIMITIVE_STREAM;\r\n});*/\r\n/***************************************************************/\r\n\r\n\r\n// SglIndexedPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglIndexedPrimitiveStreamJS.\r\n * @class Holds the indexed primitive stream information and storage.\r\n */\r\nfunction SglIndexedPrimitiveStreamJS(name, mode, indices, byCopy) {\r\n\tSglPrimitiveStreamJS.call(this, name, mode, 0, indices.length);\r\n\r\n\tthis._buff = (byCopy) ? ((indices) ? (indices.slice()) : (null)) : (indices);\r\n\t\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_INDEXED_PRIMITIVE_STREAM;}});\r\n\tObject.defineProperty(this, \"buffer\", {get: function(){return this._buff;}});\r\n\tObject.defineProperty(this, \"length\", {get: function(){return this._buff.length;}});\r\n}\r\n\r\n\r\nsglInherit(SglIndexedPrimitiveStreamJS, SglPrimitiveStreamJS);\r\n/*sglDefineGetter(SglIndexedPrimitiveStreamJS, \"type\", function() {\r\n\treturn SGL_INDEXED_PRIMITIVE_STREAM;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamJS, \"buffer\", function() {\r\n\treturn this._buff;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamJS, \"length\", function() {\r\n\treturn this._buff.length;\r\n});*/\r\n/***************************************************************/\r\n\r\n\r\n// SglConnectivityJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglConnectivityJS.\r\n * @class Container for primitive streams.\r\n */\r\nfunction SglConnectivityJS() {\r\n\tthis._prims = { };\r\n}\r\n\r\nSglConnectivityJS.prototype = {\r\n\tget primitives() { return this._prims; },\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tvar prim = new SglArrayPrimitiveStreamJS(name, mode, first, count)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices, byCopy) {\r\n\t\tvar prim = new SglIndexedPrimitiveStreamJS(name, mode, indices, byCopy)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\tremovePrimitives : function(name) {\r\n\t\tif (!this._prims[name]) return;\r\n\t\tdelete this._prims[name];\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglMeshJS.\r\n * @class Mesh definition with vertex stream and primitive stream.\r\n */\r\nfunction SglMeshJS() {\r\n\tthis._valid = false;\r\n\tthis._vert  = new SglVertexStreamJS();\r\n\tthis._conn  = new SglConnectivityJS();\r\n}\r\n\r\nSglMeshJS.prototype = {\r\n\tget isValid()      { return this._valid;  },\r\n\tset isValid(value) { this._valid = value; },\r\n\r\n\tget vertices()     { return this._vert; },\r\n\tget connectivity() { return this._conn; },\r\n\r\n\taddVertexAttribute : function(name, size, values, byCopy) {\r\n\t\tthis._vert.addAttribute(name, size, values, byCopy);\r\n\t},\r\n\r\n\tremoveVertexAttribute : function(name) {\r\n\t\tthis._vert.removeAttribute(name);\r\n\t},\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tthis._conn.addArrayPrimitives(name, mode, first, count);\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices, byCopy) {\r\n\t\tthis._conn.addIndexedPrimitives(name, mode, indices, byCopy);\r\n\t},\r\n\r\n\tremovePrimitives : function(name) {\r\n\t\tthis._conn.removePrimitives(name);\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// importers\r\n/***********************************************************************/\r\nfunction sglMeshJSImportOBJFromString(mesh, text) {\r\n\tvar positionsArray = [ ];\r\n\tvar texcoordsArray = [ ];\r\n\tvar normalsArray   = [ ];\r\n\tvar indicesArray   = [ ];\r\n\r\n\tvar positions = [ ];\r\n\tvar texcoords = [ ];\r\n\tvar normals   = [ ];\r\n\tvar facemap   = { };\r\n\tvar index     = 0;\r\n\r\n\tvar line = null;\r\n\tvar f   = null;\r\n\tvar pos = 0;\r\n\tvar tex = 0;\r\n\tvar nor = 0;\r\n\tvar x   = 0.0;\r\n\tvar y   = 0.0;\r\n\tvar z   = 0.0;\r\n\tvar tokens = null;\r\n\r\n\tvar hasPos = false;\r\n\tvar hasTex = false;\r\n\tvar hasNor = false;\r\n\r\n\tvar lines = text.split(\"\\n\");\r\n\tfor (var lineIndex in lines) {\r\n\t\tline = lines[lineIndex].replace(/[ \\t]+/g, \" \").replace(/\\s\\s*$/, \"\");\r\n\r\n\t\tif (line[0] == \"#\") continue;\r\n\r\n\t\ttokens = line.split(\" \");\r\n\t\tif (tokens[0] == \"v\") {\r\n\t\t\tpositions.push(parseFloat(tokens[1]));\r\n\t\t\tpositions.push(parseFloat(tokens[2]));\r\n\t\t\tpositions.push(parseFloat(tokens[3]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"vt\") {\r\n\t\t\ttexcoords.push(parseFloat(tokens[1]));\r\n\t\t\ttexcoords.push(parseFloat(tokens[2]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"vn\") {\r\n\t\t\tnormals.push(parseFloat(tokens[1]));\r\n\t\t\tnormals.push(parseFloat(tokens[2]));\r\n\t\t\tnormals.push(parseFloat(tokens[3]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"f\") {\r\n\t\t\tif (tokens.length != 4) continue;\r\n\r\n\t\t\tfor (var i=1; i<4; ++i) {\r\n\t\t\t\tif (!(tokens[i] in facemap)) {\r\n\t\t\t\t\tf = tokens[i].split(\"/\");\r\n\r\n\t\t\t\t\tif (f.length == 1) {\r\n\t\t\t\t\t\tpos = parseInt(f[0]) - 1;\r\n\t\t\t\t\t\ttex = pos;\r\n\t\t\t\t\t\tnor = pos;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (f.length == 3) {\r\n\t\t\t\t\t\tpos = parseInt(f[0]) - 1;\r\n\t\t\t\t\t\ttex = parseInt(f[1]) - 1;\r\n\t\t\t\t\t\tnor = parseInt(f[2]) - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tz = 0.0;\r\n\t\t\t\t\tif ((pos * 3 + 2) < positions.length) {\r\n\t\t\t\t\t\thasPos = true;\r\n\t\t\t\t\t\tx = positions[pos*3+0];\r\n\t\t\t\t\t\ty = positions[pos*3+1];\r\n\t\t\t\t\t\tz = positions[pos*3+2];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpositionsArray.push(x);\r\n\t\t\t\t\tpositionsArray.push(y);\r\n\t\t\t\t\tpositionsArray.push(z);\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tif ((tex * 2 + 1) < texcoords.length) {\r\n\t\t\t\t\t\thasTex = true;\r\n\t\t\t\t\t\tx = texcoords[tex*2+0];\r\n\t\t\t\t\t\ty = texcoords[tex*2+1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttexcoordsArray.push(x);\r\n\t\t\t\t\ttexcoordsArray.push(y);\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tz = 1.0;\r\n\t\t\t\t\tif ((nor * 3 + 2) < normals.length) {\r\n\t\t\t\t\t\thasNor = true;\r\n\t\t\t\t\t\tx = normals[nor*3+0];\r\n\t\t\t\t\t\ty = normals[nor*3+1];\r\n\t\t\t\t\t\tz = normals[nor*3+2];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnormalsArray.push(x);\r\n\t\t\t\t\tnormalsArray.push(y);\r\n\t\t\t\t\tnormalsArray.push(z);\r\n\r\n\t\t\t\t\tfacemap[tokens[i]] = index++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tindicesArray.push(facemap[tokens[i]]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (hasPos) {\r\n\t\tmesh.addVertexAttribute(\"position\", 3, positionsArray, false);\r\n\t}\r\n\tif (hasNor) {\r\n\t\tmesh.addVertexAttribute(\"normal\", 3, normalsArray, false);\r\n\t}\r\n\tif (hasTex) {\r\n\t\tmesh.addVertexAttribute(\"texcoord\", 2, texcoordsArray, false);\r\n\t}\r\n\r\n\tif (indicesArray.length > 0) {\r\n\t\tmesh.addIndexedPrimitives(\"triangles\", SGL_TRIANGLES_LIST, indicesArray, false);\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction sglMeshJSImportOBJFromURL(mesh, url, asynch, callback) {\r\n\tmesh.isValid = false;\r\n\r\n\tif (!asynch) {\r\n\t\tvar txt = sglLoadFile(url);\r\n\t\tmesh.isValid = sglMeshJSImportOBJFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t\treturn mesh.isValid;\r\n\t}\r\n\r\n\tsglLoadFile(url, function(txt) {\r\n\t\tmesh.isValid = sglMeshJSImportOBJFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t});\r\n\r\n\treturn true;\r\n}\r\n\r\nSglMeshJS.prototype.parseOBJ = function(txt) {\r\n\tthis.isValid = sglMeshJSImportOBJFromString(this, txt);\r\n\treturn this.isValid;\r\n};\r\n\r\nSglMeshJS.prototype.importOBJ = function(url, asynch, callback) {\r\n\treturn sglMeshJSImportOBJFromURL(this, url, asynch, callback);\r\n};\r\n\r\nfunction _sglFindVertexAttributeJSON(m, name) {\r\n\tfor (var a in m.vertices) {\r\n\t\tif (m.vertices[a].name === name) {\r\n\t\t\treturn m.vertices[a];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction _sglFindConnectivityJSON(m, name) {\r\n\tfor (var a in m.connectivity) {\r\n\t\tif (m.connectivity[a].name === name) {\r\n\t\t\treturn m.connectivity[a];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglMeshJSImportJSONFromString(mesh, text) {\r\n\tvar m = JSON.parse(text);\r\n\tif (!m) return false;\r\n\r\n\tvar mapping = m.mapping;\r\n\tvar stdMapping = null;\r\n\tfor (var v in mapping) {\r\n\t\tif (mapping[v].name === \"standard\") {\r\n\t\t\tstdMapping = mapping[v];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (!stdMapping) return false;\r\n\r\n\tfor (var a in stdMapping.attributes) {\r\n\t\tvar vm = stdMapping.attributes[a];\r\n\t\tvar vattr = _sglFindVertexAttributeJSON(m, vm.source);\r\n\t\tif (!vattr) continue;\r\n\t\tif (vattr.normalized) {\r\n\t\t\tfor (var i=0, n=vattr.values.length; i<n; ++i) {\r\n\t\t\t\tvattr.values[i] /= 255.0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmesh.addVertexAttribute(vm.semantic, vattr.size, vattr.values, false);\r\n\t}\r\n\r\n\tvar conn = _sglFindConnectivityJSON(m, stdMapping.primitives);\r\n\tif (!conn) return false;\r\n\tmesh.addIndexedPrimitives(conn.name, SGL_TRIANGLES_LIST, conn.indices, false);\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction sglMeshJSImportJSONFromURL(mesh, url, asynch, callback) {\r\n\tmesh.isValid = false;\r\n\r\n\tif (!asynch) {\r\n\t\tvar txt = sglLoadFile(url);\r\n\t\tmesh.isValid = sglMeshJSImportJSONFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t\treturn mesh.isValid;\r\n\t}\r\n\r\n\tsglLoadFile(url, function(txt) {\r\n\t\tmesh.isValid = sglMeshJSImportJSONFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t});\r\n\r\n\treturn true;\r\n}\r\n\r\nSglMeshJS.prototype.parseJSON = function(txt) {\r\n\tthis.isValid = sglMeshJSImportJSONFromString(this, txt);\r\n\treturn this.isValid;\r\n};\r\n\r\nSglMeshJS.prototype.importJSON = function(url, asynch, callback) {\r\n\treturn sglMeshJSImportJSONFromURL(this, url, asynch, callback);\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// utilities\r\n/***************************************************************/\r\nfunction sglGLTypeSize(gl, type) {\r\n\tif (type == gl.BYTE)           return 1;\r\n\tif (type == gl.UNSIGNED_BYTE)  return 1;\r\n\tif (type == gl.SHORT)          return 2;\r\n\tif (type == gl.UNSIGNED_SHORT) return 2;\r\n\tif (type == gl.INT)            return 4;\r\n\tif (type == gl.UNSIGNED_INT)   return 4;\r\n\tif (type == gl.FLOAT)          return 4;\r\n\treturn null;\r\n}\r\n\r\nfunction sglGLTypeFromWebGLArray(gl, wglArray) {\r\n\tif (wglArray instanceof Int8Array   ) return gl.BYTE;\r\n\tif (wglArray instanceof Uint8Array  ) return gl.UNSIGNED_BYTE;\r\n\tif (wglArray instanceof Int16Array  ) return gl.SHORT;\r\n\tif (wglArray instanceof Uint16Array ) return gl.UNSIGNED_SHORT;\r\n\tif (wglArray instanceof Int32Array  ) return gl.INT;\r\n\tif (wglArray instanceof Uint32Array ) return gl.UNSIGNED_INT;\r\n\tif (wglArray instanceof Float32Array) return gl.FLOAT;\r\n\treturn null;\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglAttributeStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglAttributeStreamGL.\r\n * @class Holds the properties and the storage buffer of a vertex attribute stream.\r\n */\r\nfunction SglAttributeStreamGL(gl, name, size, values, normalized) {\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, values);\r\n\tvar stride = sglGLTypeSize(gl, type) * size;\r\n\r\n\tthis.gl      = gl;\r\n\tthis._name   = name;\r\n\tthis._size   = size;\r\n\tthis._type   = type;\r\n\tthis._norm   = (normalized) ? (true) : (false);\r\n\tthis._stride = stride;\r\n\tthis._offset = 0;\r\n\tthis._length = values.length / size;\r\n\tthis._buff   = new SglVertexBuffer(gl, values, { usage : gl.STATIC_DRAW });\r\n}\r\n\r\nSglAttributeStreamGL.prototype = {\r\n\tget name()         { return this._name;   },\r\n\tget size()         { return this._size;   },\r\n\tget type()         { return this._type;   },\r\n\tget isNormalized() { return this._norm;   },\r\n\tget stride()       { return this._stride; },\r\n\tget offset()       { return this._offset; },\r\n\tget buffer()       { return this._buff;   },\r\n\tget length()       { return this._length; },\r\n\r\n\tdestroy : function() {\r\n\t\tthis._buff.destroy();\r\n\t},\r\n\r\n\tbind : function(index, baseVertex) {\r\n\t\tvar off = ((baseVertex) ? (baseVertex) : (0)) * this._stride;\r\n\t\tthis._buff.bind();\r\n\t\tthis.gl.vertexAttribPointer(index, this._size, this._type, this._norm, this._stride, this._offset + off);\r\n\t},\r\n\r\n\tunbind : function(index) {\r\n\t\tthis._buff.unbind();\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglVertexStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglVertexStreamGL.\r\n * @class Container of vertex attribute streams.\r\n */\r\nfunction SglVertexStreamGL(gl) {\r\n\tthis.gl       = gl;\r\n\tthis._attribs = new Object();\r\n\tthis._length  = 0;\r\n}\r\n\r\nSglVertexStreamGL.prototype = {\r\n\tget attributes() { return this._attribs; },\r\n\tget length()     { return this._length;  },\r\n\r\n\tdestroy : function() {\r\n\t\tfor (var attr in this._attribs) {\r\n\t\t\tthis._attribs[attr].destroy();\r\n\t\t}\r\n\t},\r\n\r\n\taddAttribute : function(name, size, normalized, values) {\r\n\t\tvar attr = new SglAttributeStreamGL(this.gl, name, size, normalized, values)\r\n\t\tthis._attribs[name] = attr;\r\n\t\tthis._length = attr.length;\r\n\t},\r\n\r\n\tremoveAttribute : function(name, doDestroy) {\r\n\t\tif (!this._attribs[name]) return;\r\n\r\n\t\tif (doDestroy) {\r\n\t\t\tthis._attribs[name].destroy();\r\n\t\t}\r\n\r\n\t\tdelete this._attribs[name];\r\n\r\n\t\tthis._length = 0;\r\n\t\tfor (var a in this._attribs) {\r\n\t\t\tthis._length = this._attribs[a].length;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\tbind : function(mapping, baseVertex) {\r\n\t\tvar vm = null;\r\n\t\tfor (var m in mapping) {\r\n\t\t\tvm = this._attribs[m];\r\n\t\t\tif (vm) {\r\n\t\t\t\tvm.bind(mapping[m], baseVertex)\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tunbind : function(mapping) {\r\n\t\tvar vm = null;\r\n\t\tfor (var m in mapping) {\r\n\t\t\tvm = this._attribs[m];\r\n\t\t\tif (vm) {\r\n\t\t\t\tvm.unbind(mapping[m])\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPrimitiveStreamGL.\r\n * @class Holds the primitives stream information and storage (if any).\r\n */\r\nfunction SglPrimitiveStreamGL(gl, name, mode, first, length) {\r\n\tthis.gl      = gl;\r\n\tthis._name   = name;\r\n\tthis._mode   = mode;\r\n\tthis._first  = (first)  ? (first)  : (0);\r\n\tthis._length = (length) ? (length) : (0);\r\n}\r\n\r\nSglPrimitiveStreamGL.prototype = {\r\n\t_clampRange : function(first, count) {\r\n\t\tvar end = this._first + this._length;\r\n\r\n\t\tvar f = this._first + ((first >= 0) ? (first) : (0));\r\n\t\tif (f >= end) return null;\r\n\r\n\t\tvar c = (count >= 0) ? (count) : (this._length);\r\n\t\tvar vEnd = (f + c);\r\n\t\tif (vEnd > end) c -= vEnd - end;\r\n\r\n\t\treturn [f, c];\r\n\t},\r\n\r\n\t_render : function(first, count) {\r\n\t\t;\r\n\t},\r\n\r\n\tget type()   { return undefined;    },\r\n\tget name()   { return this._name;   },\r\n\tget mode()   { return this._mode;   },\r\n\tget first()  { return this._first;  },\r\n\tget length() { return this._length; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._destroy) {\r\n\t\t\tthis._destroy();\r\n\t\t}\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\t;\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\t;\r\n\t},\r\n\r\n\trender : function(first, count) {\r\n\t\tvar range = this._clampRange(first, count);\r\n\t\tthis._render(range[0], range[1]);\r\n\t}\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglArrayPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglArrayPrimitiveStreamGL.\r\n * @class Holds the array primitive stream information.\r\n */\r\nfunction SglArrayPrimitiveStreamGL(gl, name, mode, first, count) {\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, first, count);\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_ARRAY_PRIMITIVE_STREAM;}});\r\n}\r\n\r\nsglInherit(SglArrayPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n/*sglDefineGetter(SglArrayPrimitiveStreamGL, \"type\", function() {\r\n\treturn SGL_ARRAY_PRIMITIVE_STREAM;\r\n});*/\r\n\r\n\r\n\r\nSglArrayPrimitiveStreamGL.prototype._render = function(first, count) {\r\n\tthis.gl.drawArrays(this._mode, first, count);\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglIndexedPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglIndexedPrimitiveStreamGL.\r\n * @class Holds the indexed primitive stream information and storage.\r\n */\r\nfunction SglIndexedPrimitiveStreamGL(gl, name, mode, indices) {\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, 0, indices.length);\r\n\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, indices);\r\n\tvar stride = sglGLTypeSize(gl, type);\r\n\r\n\tthis._idxType = type;\r\n\tthis._stride  = stride;\r\n\tthis._buff    = new SglIndexBuffer(gl, indices, { usage : gl.STATIC_DRAW });\r\n\t\r\n\tObject.defineProperty(this, \"indexType\", {get: function(){return this._idxType;}});\r\n\tObject.defineProperty(this, \"stride\", {get: function(){return this._stride;}});\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_INDEXED_PRIMITIVE_STREAM;}});\r\n}\r\n\r\n\r\nsglInherit(SglIndexedPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n/*sglDefineGetter(SglIndexedPrimitiveStreamGL, \"indexType\", function() {\r\n\treturn this._idxType;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamGL, \"stride\", function() {\r\n\treturn this._stride;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamGL, \"type\", function() {\r\n\treturn SGL_INDEXED_PRIMITIVE_STREAM;\r\n});*/\r\n\r\nSglIndexedPrimitiveStreamGL.prototype._destroy = function() {\r\n\tthis._buff.destroy();\r\n\tthis._buff = null;\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype.bind = function() {\r\n\tthis._buff.bind();\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype.unbind = function() {\r\n\tthis._buff.unbind();\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype._render = function(first, count) {\r\n\tthis.gl.drawElements(this._mode, count, this._idxType, first * this._stride);\r\n}\r\n\r\n\r\n\r\n/***************************************************************/\r\n\r\n\r\n// SglPackedIndexedPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPackedIndexedPrimitiveStream.\r\n * @class Holds the packed indexed primitive stream information and storage.\r\n */\r\nfunction SglPackedIndexedPrimitiveStreamGL(gl, name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\tif (blockStartingIndices.length != blockStartingVertices.length) {\r\n\t\tsglInvalidParameter();\r\n\t}\r\n\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, 0, indices.length);\r\n\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, indices);\r\n\tvar stride = sglGLTypeSize(gl, type);\r\n\r\n\tthis._idxType = type;\r\n\tthis._stride  = stride;\r\n\tthis._buff    = new SglIndexBuffer(gl, indices, { usage : gl.STATIC_DRAW });\r\n\r\n\r\n\tthis._blockStartingVertices = blockStartingVertices.slice();\r\n\tvar n = this._blockStartingVertices.length;\r\n\r\n\tthis._blockStartingIndices = blockStartingIndices.slice();\r\n\tthis._blockIndicesCount    = new Array(n);\r\n\r\n\tvar start = this._blockStartingIndices[0];\r\n\tfor (var i=0; i<(n-1); ++i) {\r\n\t\tvar sIdx = this._blockStartingIndices[i+1];\r\n\t\tthis._blockIndicesCount[i] = sIdx - start;\r\n\t\tstart = sIdx;\r\n\t}\r\n\tthis._blockIndicesCount[n-1] = indices.length - start;\r\n\t\r\n\tObject.defineProperty(this, \"isPacked\", {get: function(){return true;}});\r\n\tObject.defineProperty(this, \"indexType\", {get: function(){return this._idxType;}});\r\n\tObject.defineProperty(this, \"stride\", {get: function(){return this._stride;}});\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_PACKED_INDEXED_PRIMITIVE_STREAM;}});\r\n\tObject.defineProperty(this, \"blocksCount\", {get: function(){return this._blockStartingIndices.length;}});\r\n\tObject.defineProperty(this, \"blockStartingVertices\", {get: function(){return this._blockStartingVertices;}});\r\n\tObject.defineProperty(this, \"blockIndicesCount\", {get: function(){return this._blockIndicesCount;}});\r\n}\r\n\r\nsglInherit(SglPackedIndexedPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype._destroy = function() {\r\n\tthis._buff.destroy();\r\n\tthis._buff = null;\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.bind = function() {\r\n\tthis._buff.bind();\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.unbind = function() {\r\n\tthis._buff.unbind();\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype._clampBlockRange = function(block, first, count) {\r\n\tvar end = this._blockStartingIndices[block] + this._blockIndicesCount[block];\r\n\r\n\tvar f = this._blockStartingIndices[block] + ((first >= 0) ? (first) : (0));\r\n\tif (f >= end) return null;\r\n\r\n\tvar c = (count >= 0) ? (count) : (this._blockIndicesCount[block]);\r\n\tvar vEnd = (f + c);\r\n\tif (vEnd > end) c -= vEnd - end;\r\n\r\n\treturn [f, c];\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.blockRanges = function(first, count) {\r\n\tvar range = this._clampRange(first, count);\r\n\tvar n     = this._blockStartingIndices.length;\r\n\r\n\tvar firstBlock = 0;\r\n\twhile ((firstBlock < n) && (range[0] < this._blockStartingIndices[firstBlock])) {\r\n\t\tfirstBlock++;\r\n\t}\r\n\tif (firstBlock >= n) return null;\r\n\r\n\tvar last = range[0] + range[1] - 1;\r\n\tvar lastBlock = firstBlock;\r\n\twhile ((lastBlock < n) && (last >= (this._blockStartingIndices[lastBlock] + this._blockIndicesCount[lastBlock]))) {\r\n\t\tlastBlock++;\r\n\t}\r\n\tif (lastBlock >= n) lastBlock = n - 1;\r\n\r\n\tvar ranges = [ ];\r\n\tvar f = range[0] - this._blockStartingIndices[firstBlock];\r\n\tvar c = range[1];\r\n\tvar e = f + range[1];\r\n\tif (e > this._blockIndicesCount[firstBlock]) c = this._blockIndicesCount[firstBlock] - this._blockStartingIndices[firstBlock];\r\n\tranges.push([firstBlock, f, c, this._blockStartingVertices[firstBlock]]);\r\n\tfor (var i=firstBlock+1; i<lastBlock; ++i) {\r\n\t\tranges.push([i, 0, this._blockIndicesCount[i], this._blockStartingVertices[i]]);\r\n\t}\r\n\tif (lastBlock > firstBlock) {\r\n\t\tranges.push([i, 0, range[0] + range[1] - this._blockStartingIndices[lastBlock], this._blockStartingVertices[lastBlock]]);\r\n\t}\r\n\r\n\treturn ranges;\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.renderBlock = function(block, first, count) {\r\n\tvar range = this._clampBlockRange(block, first, count);\r\n\tthis.gl.drawElements(this._mode, range[1], this._idxType, range[0] * this._stride);\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglConnectivityGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglConnectivityGL.\r\n * @class Container of primitive streams.\r\n */\r\nfunction SglConnectivityGL(gl) {\r\n\tthis.gl     = gl;\r\n\tthis._prims = new Object();\r\n}\r\n\r\nSglConnectivityGL.prototype = {\r\n\tget primitives() { return this._prims; },\r\n\r\n\tdestroy : function() {\r\n\t\tfor (var prim in this._prims) {\r\n\t\t\tthis._prims[prim].destroy();\r\n\t\t}\r\n\t},\r\n\r\n\taddArrayPrimitives: function(name, mode, first, count) {\r\n\t\tvar prim = new SglArrayPrimitiveStreamGL(this.gl, name, mode, first, count)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices) {\r\n\t\tvar prim = new SglIndexedPrimitiveStreamGL(this.gl, name, mode, indices)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddPackedIndexedPrimitives : function(name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\t\tvar prim = new SglPackedIndexedPrimitiveStreamGL(this.gl, name, mode, indices, blockStartingIndices, blockStartingVertices)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\tremovePrimitives : function(name, doDestroy) {\r\n\t\tif (!this._prims[name]) return;\r\n\r\n\t\tif (doDestroy) {\r\n\t\t\tthis._prims[name].destroy();\r\n\t\t}\r\n\r\n\t\tdelete this._prims[name];\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglMeshGL.\r\n * @class Mesh definition with vertex stream and primitive stream.\r\n */\r\nfunction SglMeshGL(gl) {\r\n\tthis.gl    = gl;\r\n\tthis._vert = new SglVertexStreamGL(this.gl);\r\n\tthis._conn = new SglConnectivityGL(this.gl);\r\n}\r\n\r\nSglMeshGL.prototype = {\r\n\tget vertices()     { return this._vert; },\r\n\tget connectivity() { return this._conn; },\r\n\r\n\tdestroy : function() {\r\n\t\tthis._vert.destroy();\r\n\t\tthis._conn.destroy();\r\n\t},\r\n\r\n\taddVertexAttribute : function(name, size, values, normalized) {\r\n\t\tthis._vert.addAttribute(name, size, values, normalized);\r\n\t},\r\n\r\n\tremoveVertexAttribute : function(name, doDestroy) {\r\n\t\tthis._vert.removeAttribute(name, doDestroy);\r\n\t},\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tthis._conn.addArrayPrimitives(name, mode, first, count);\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices) {\r\n\t\tthis._conn.addIndexedPrimitives(name, mode, indices);\r\n\t},\r\n\r\n\taddPackedIndexedPrimitives : function(name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\t\tthis._conn.addPackedIndexedPrimitives(name, mode, indices, blockStartingIndices, blockStartingVertices);\r\n\t},\r\n\r\n\tremovePrimitives : function(name, doDestroy) {\r\n\t\tthis._conn.removePrimitives(name, doDestroy);\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshRenderer\r\n/***************************************************************/\r\nvar SGL_DefaultStreamMappingPrefix = \"a_\";\r\n\r\n/**\r\n * Constructs a SglMeshGLRenderer.\r\n * @class Takes charge of mesh rendering, including program attributes, uniforms and samplers bindings.\r\n */\r\nfunction SglMeshGLRenderer(program, doSynchronize) {\r\n\tthis._prog        = program;\r\n\tthis._mapping     = null;\r\n\tthis._meshAttrMap = null;\r\n\tthis._mesh        = null;\r\n\tthis._primStream  = null;\r\n\tthis._phase       = 0;\r\n\r\n\tthis._updateEnabledVB = false;\r\n\r\n\tif (doSynchronize) {\r\n\t\tthis.synchronizeProgram();\r\n\t}\r\n\r\n\tthis.setStreamMapping();\r\n}\r\n\r\nSglMeshGLRenderer.prototype = {\r\n\t_bindVertexBuffers : function(baseVertex) {\r\n\t\tthis._mesh.vertices.bind(this._meshAttrMap, baseVertex);\r\n\t},\r\n\r\n\t_unbindVertexBuffers : function() {\r\n\t\tthis._mesh.vertices.unbind(this._meshAttrMap);\r\n\t},\r\n\r\n\tget program() { return this.prog; },\r\n\r\n\tsynchronizeProgram : function() {\r\n\t\tthis._prog.synchronize();\r\n\r\n\t\tvar doLink = false;\r\n\t\tvar index = 0;\r\n\t\tvar attr = null;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tattr = this._prog.attributes[a];\r\n\t\t\tif (attr.index != index) {\r\n\t\t\t\tattr.index = index;\r\n\t\t\t\tdoLink = true;\r\n\t\t\t}\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\tif (doLink) {\r\n\t\t\tthis._prog.link();\r\n\t\t}\r\n\r\n\t\tvar unit = 0;\r\n\t\tvar smp = null;\r\n\t\tfor (var s in this._prog.samplers) {\r\n\t\t\tsmp = this._prog.samplers[s];\r\n\t\t\tsmp.unit = unit;\r\n\t\t\tunit++;\r\n\t\t}\r\n\t},\r\n\r\n\tgetStreamMappingFromPrefix : function(prefix) {\r\n\t\tvar n = prefix.length;\r\n\t\tvar mapping = new Object();\r\n\t\tvar src = null;\r\n\t\tfor (var attr in this._prog.attributes) {\r\n\t\t\tif (attr.substr(0, n) == prefix) {\r\n\t\t\t\tsrc = attr.substr(n);\r\n\t\t\t\tif (src.length > 0) {\r\n\t\t\t\t\tmapping[attr] = src;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn mapping;\r\n\t},\r\n\r\n\tsetStreamMapping : function(mapping) {\r\n\t\t//if ((this._phase != 0) && (this._phase != 1)) return;\r\n\r\n\t\tthis._updateEnabledVB = true;\r\n\r\n\t\tvar meshAttrName = null;\r\n\r\n\t\tthis._mapping = this.getStreamMappingFromPrefix(SGL_DefaultStreamMappingPrefix);\r\n\t\tfor (var progAttrName in mapping) {\r\n\t\t\tmeshAttrName = mapping[progAttr];\r\n\t\t\tif (this._prog.attributes[progAttrName]) {\r\n\t\t\t\tthis._mapping[progAttrName] = meshAttrName;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._meshAttrMap = { };\r\n\t\tvar progAttr = null;\r\n\t\tfor (var progAttrName in this._mapping) {\r\n\t\t\tmeshAttrName = this._mapping[progAttrName];\r\n\t\t\tprogAttr     = this._prog.attributes[progAttrName];\r\n\t\t\tthis._meshAttrMap[meshAttrName] = progAttr.index;\r\n\t\t}\r\n\r\n\t\tif (this._mesh) {\r\n\t\t\tthis._bindVertexBuffers(0);\r\n\t\t}\r\n\t},\r\n\r\n\tsetStreamMappingFromPrefix : function(prefix) {\r\n\t\tif (!prefix) prefix = SGL_DefaultStreamMappingPrefix;\r\n\t\tvar mapping = this.getStreamMappingFromPrefix(prefix);\r\n\t\tthis.setStreamMapping(mapping);\r\n\t},\r\n\r\n\tsetUniforms : function(mapping) {\r\n\t\tif (this._phase == 0) return;\r\n\t\tthis._prog.setUniforms(mapping);\r\n\t},\r\n\r\n\tsetSamplers : function(mapping) {\r\n\t\tif (this._phase == 0) return;\r\n\r\n\t\tvar samplers = { };\r\n\t\tvar textures = { };\r\n\r\n\t\tvar t = null;\r\n\t\tfor (var s in mapping) {\r\n\t\t\tt = mapping[s];\r\n\t\t\tif (typeof(t) == \"number\") {\r\n\t\t\t\tsamplers[s] = t;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttextures[s] = t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._prog.setSamplers(samplers);\r\n\r\n\t\tvar smp = null;\r\n\t\tfor (var s in textures) {\r\n\t\t\tsmp = this._prog.samplers[s];\r\n\t\t\tif (smp) {\r\n\t\t\t\ttextures[s].bind(smp.unit);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tbegin : function() {\r\n\t\tif (this._phase != 0) return;\r\n\t\t/*\r\n\t\tvar gl = this._prog.gl;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tgl.enableVertexAttribArray(this._prog.attributes[a].index);\r\n\t\t}\r\n\t\t*/\r\n\t\tthis._prog.bind();\r\n\t\tthis._phase = 1;\r\n\t},\r\n\r\n\tend : function() {\r\n\t\tif (this._phase != 1) return;\r\n\t\tthis._prog.unbind();\r\n\t\tvar gl = this._prog.gl;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tgl.disableVertexAttribArray(this._prog.attributes[a].index);\r\n\t\t}\r\n\t\tthis._phase = 0;\r\n\t},\r\n\r\n\tbeginMesh : function(mesh) {\r\n\t\tif (this._phase != 1) return;\r\n\t\tthis._updateEnabledVB = true;\r\n\t\tthis._mesh = mesh;\r\n\t\tthis._bindVertexBuffers(0);\r\n\t\tthis._phase = 2;\r\n\t},\r\n\r\n\tendMesh : function() {\r\n\t\tif (this._phase != 2) return;\r\n\t\tthis._unbindVertexBuffers();\r\n\t\tthis._prog.gl.bindBuffer(this._prog.gl.ARRAY_BUFFER, null);\r\n\t\tthis._mesh = null;\r\n\t\tthis._phase = 1;\r\n\t},\r\n\r\n\tbeginPrimitives : function(name) {\r\n\t\tif (this._phase != 2) return;\r\n\t\tthis._primStream = this._mesh.connectivity.primitives[name];\r\n\t\tthis._primStream.bind();\r\n\t\tthis._phase = 3;\r\n\t},\r\n\r\n\tendPrimitives : function() {\r\n\t\tif (this._phase != 3) return;\r\n\t\tthis._primStream.unbind();\r\n\t\tthis._primStream = null;\r\n\t\tthis._phase = 2;\r\n\t},\r\n\r\n\trender : function(first, count) {\r\n\t\tif (this._phase != 3) return;\r\n\r\n\t\tvar gl = this._prog.gl;\r\n\t\tvar vIndex = 0;\r\n\r\n\t\tif (this._updateEnabledVB) {\r\n\t\t\tthis._updateEnabledVB = false;\r\n\t\t\tfor (var progAttr in this._mapping) {\r\n\t\t\t\tvIndex = this._prog.attributes[progAttr].index;\r\n\t\t\t\tif (this._mesh.vertices.attributes[this._mapping[progAttr]]) {\r\n\t\t\t\t\tgl.enableVertexAttribArray(vIndex);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tgl.disableVertexAttribArray(vIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._primStream.isPacked) {\r\n\t\t\tif (this._primStream.blocksCount > 0) {\r\n\t\t\t\tvar blocks = this._primStream.blockRanges(first, count);\r\n\t\t\t\tvar n = blocks.length;\r\n\t\t\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\t\t\tthis._bindVertexBuffers(blocks[i][3]);\r\n\t\t\t\t\tthis._primStream.renderBlock(blocks[i][0], blocks[i][1], blocks[i][2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._primStream.render(first, count);\r\n\t\t}\r\n\t},\r\n\r\n\trenderMeshPrimitives : function(mesh, name, first, count) {\r\n\t\tthis.beginMesh(mesh);\r\n\t\t\tthis.beginPrimitives(name);\r\n\t\t\t\tthis.render(first, count);\r\n\t\t\tthis.endPrimitives();\r\n\t\tthis.endMesh();\r\n\t}\r\n};\r\n\r\nfunction sglRenderMeshGLPrimitives(mesh, name, program, streamMapping, uniforms, samplers, first, count) {\r\n\tvar renderer = new SglMeshGLRenderer(program);\r\n\trenderer.begin();\r\n\tif (streamMapping) renderer.setStreamMapping (streamMapping);\r\n\tif (uniforms     ) renderer.setUniforms      (uniforms     );\r\n\tif (samplers     ) renderer.setSamplers      (samplers     );\r\n\tif (name) {\r\n\t\trenderer.renderMeshPrimitives(mesh, name, first, count);\r\n\t}\r\n\telse {\r\n\t\tvar primitives = mesh.connectivity.primitives;\r\n\t\tfor (var p in primitives) {\r\n\t\t\trenderer.renderMeshPrimitives(mesh, p, first, count);\r\n\t\t}\r\n\t}\r\n}\r\n/***************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// utilities\r\n/***********************************************************************/\r\nfunction sglMeshJSCalculateBBox(meshJS, attribName) {\r\n\tvar attrn     = attribName || \"position\";\r\n\r\n\tvar posAttrib = meshJS.vertices.attributes[attrn];\r\n\tvar posSize   = posAttrib.size;\r\n\tvar posBuffer = posAttrib.buffer;\r\n\r\n\tvar bbox = new SglBox3();\r\n\tif (posSize != 3) return bbox;\r\n\r\n\tvar n = posBuffer.length / posSize;\r\n\tif (n <= 0) return bbox;\r\n\r\n\tn *= posSize;\r\n\r\n\tfor (var j=0; j<posSize; ++j) {\r\n\t\tbbox.min[j] = posBuffer[j];\r\n\t\tbbox.max[j] = posBuffer[j];\r\n\t}\r\n\r\n\tvar val = 0.0;\r\n\tfor (var i=posSize; i<n; i+=posSize) {\r\n\t\tfor (var j=0; j<posSize; ++j) {\r\n\t\t\tval = posBuffer[i+j];\r\n\t\t\tif (bbox.min[j] > val) bbox.min[j] = val;\r\n\t\t\tif (bbox.max[j] < val) bbox.max[j] = val;\r\n\t\t}\r\n\t}\r\n\r\n\treturn bbox;\r\n}\r\n\r\nSglMeshJS.prototype.calculateBoundingBox = function(attribName) {\r\n\treturn sglMeshJSCalculateBBox(this, attribName);\r\n};\r\n\r\nfunction sglGLPrimitiveType(gl, primType) {\r\n\tswitch (primType) {\r\n\t\tcase SGL_POINTS_LIST    : return gl.POINTS;         break;\r\n\t\tcase SGL_LINES_LIST     : return gl.LINES;          break;\r\n\t\tcase SGL_LINE_STRIP     : return gl.LINE_STRIP;     break;\r\n\t\tcase SGL_LINE_LOOP      : return gl.LINE_LOOP;      break;\r\n\t\tcase SGL_TRIANGLES_LIST : return gl.TRIANGLES;      break;\r\n\t\tcase SGL_TRIANGLE_STRIP : return gl.TRIANGLE_STRIP; break;\r\n\t\tcase SGL_TRIANGLE_FAN   : return gl.TRIANGLE_FAN;   break;\r\n\t\tdefault                 : return undefined;         break;\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\nfunction sglMeshJStoGL(gl, meshJS) {\r\n\tvar meshGL = new SglMeshGL(gl);\r\n\r\n\tfor (a in meshJS.vertices.attributes) {\r\n\t\tvar attr = meshJS.vertices.attributes[a];\r\n\t\tmeshGL.addVertexAttribute(attr.name, attr.size, new Float32Array(attr.buffer));\r\n\t}\r\n\r\n\tfor (p in meshJS.connectivity.primitives) {\r\n\t\tvar prim = meshJS.connectivity.primitives[p];\r\n\t\tvar ptype = sglGLPrimitiveType(meshGL.gl, prim.mode);\r\n\t\tif (ptype == undefined) continue;\r\n\r\n\t\tswitch (prim.type) {\r\n\t\t\tcase SGL_ARRAY_PRIMITIVE_STREAM :\r\n\t\t\t\tmeshGL.addArrayPrimitives(prim.name, ptype, prim.first, prim.length);\r\n\t\t\tbreak;\r\n\t\t\tcase SGL_INDEXED_PRIMITIVE_STREAM :\r\n\t\t\t\tmeshGL.addIndexedPrimitives(prim.name, ptype, new Uint16Array(prim.buffer));\r\n\t\t\tbreak;\r\n\t\t\tdefault :\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn meshGL;\r\n}\r\n\r\nSglMeshJS.prototype.toMeshGL = function(gl) {\r\n\treturn sglMeshJStoGL(gl, this);\r\n};\r\n\r\nfunction sglPackMeshJStoGL(gl, mesh, primitives, maxVertexIndex) {\r\n\tvar primName = primitives     || \"triangles\";\r\n\tvar maxInd   = maxVertexIndex || 65000;\r\n\r\n\tvar prim = mesh.connectivity.primitives[primName];\r\n\r\n\tif (!prim) return null;\r\n\tif (prim.type != SGL_INDEXED_PRIMITIVE_STREAM) return null;\r\n\r\n\tvar pmode = sglGLPrimitiveType(gl, prim.mode);\r\n\tif (pmode == undefined) return null;\r\n\r\n\tvar ariety   = 0;\r\n\tif (pmode === gl.TRIANGLES) {\r\n\t\tariety = 3;\r\n\t}\r\n\telse if (pmode === gl.LINES) {\r\n\t\tariety = 2;\r\n\t}\r\n\telse if (pmode === gl.POINTS) {\r\n\t\tariety = 1;\r\n\t}\r\n\telse {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar res   = [ ];\r\n\r\n\tvar srcIndices = prim.buffer;\r\n\tvar n          = srcIndices.length;\r\n\tn -= (n % ariety);\r\n\r\n\tvar start = 0;\r\n\r\n\tvar startVertex = 0;\r\n\tvar startIndex  = 0;\r\n\tvar startVertices = [ ];\r\n\tvar startIndices  = [ ];\r\n\r\n\tvar newIndices = [ ];\r\n\tvar newAttribs = { };\r\n\tfor (var a in mesh.vertices.attributes) {\r\n\t\tvar attr  = mesh.vertices.attributes[a];\r\n\t\tnewAttribs[a] = {\r\n\t\t\tname   : attr.name,\r\n\t\t\tsize   : attr.size,\r\n\t\t\tbuffer : [ ]\r\n\t\t};\r\n\t}\r\n\r\n\twhile (start < n) {\r\n\t\tvar indicesMap = { };\r\n\t\tvar dstIndices = [ ];\r\n\t\tvar vtxCount = 0;\r\n\r\n\t\tvar indicesMap = { };\r\n\t\tvar vtxCount   = 0;\r\n\t\tfor (var i=start; i<n; i+=ariety) {\r\n\t\t\tvar triIndices       = { };\r\n\t\t\tvar newVerticesCount = 0;\r\n\t\t\tfor (var j=0; j<ariety; ++j) {\r\n\t\t\t\tvar srcIdx = srcIndices[i+j];\r\n\t\t\t\tif (triIndices[srcIdx] == undefined) {\r\n\t\t\t\t\ttriIndices[srcIdx] = true;\r\n\t\t\t\t\tif (indicesMap[srcIdx] == undefined) {\r\n\t\t\t\t\t\tnewVerticesCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ((vtxCount + newVerticesCount) <= maxInd) {\r\n\t\t\t\tfor (var j=0; j<ariety; ++j) {\r\n\t\t\t\t\tvar srcIdx = srcIndices[i+j];\r\n\t\t\t\t\tvar dstIdx = indicesMap[srcIdx];\r\n\t\t\t\t\tif (dstIdx == undefined) {\r\n\t\t\t\t\t\tindicesMap[srcIdx] = vtxCount;\r\n\t\t\t\t\t\tdstIdx = vtxCount;\r\n\t\t\t\t\t\tvtxCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdstIndices.push(dstIdx);\r\n\t\t\t\t}\r\n\t\t\t\tstart += ariety;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (vtxCount <= 0) break;\r\n\r\n\t\tvar idxCount = dstIndices.length;\r\n\r\n\t\tfor (var a in mesh.vertices.attributes) {\r\n\t\t\tvar srcAttr  = mesh.vertices.attributes[a];\r\n\t\t\tvar dstAttr  = newAttribs[a];\r\n\t\t\tvar asize    = srcAttr.size;\r\n\t\t\tvar dstBase  = dstAttr.buffer.length;\r\n\t\t\tvar newArr   = new Array(vtxCount * asize);\r\n\t\t\tdstAttr.buffer = dstAttr.buffer.concat(newArr);\r\n\r\n\t\t\tvar srcBuff = srcAttr.buffer;\r\n\t\t\tvar dstBuff = dstAttr.buffer;\r\n\t\t\tfor (var i in indicesMap) {\r\n\t\t\t\tvar dstIdx = indicesMap[i];\r\n\t\t\t\tfor (var c=0; c<asize; ++c) {\r\n\t\t\t\t\tdstBuff[dstBase + (dstIdx*asize+c)] = srcBuff[i*asize+c];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tnewIndices = newIndices.concat(dstIndices);\r\n\r\n\t\tstartVertices.push(startVertex);\r\n\t\tstartIndices.push(startIndex);\r\n\r\n\t\tstartVertex += vtxCount;\r\n\t\tstartIndex  += idxCount;\r\n\t}\r\n\r\n\tvar m = new SglMeshGL(gl);\r\n\r\n\tfor (var a in newAttribs) {\r\n\t\tvar attr = newAttribs[a];\r\n\t\tm.addVertexAttribute(attr.name, attr.size, new Float32Array(attr.buffer));\r\n\t}\r\n\r\n\tif (startVertices.length == 1) {\r\n\t\tm.addIndexedPrimitives(primName, pmode, new Uint16Array(newIndices));\r\n\t}\r\n\telse {\r\n\t\tm.addPackedIndexedPrimitives(primName, pmode, new Uint16Array(newIndices), startIndices, startVertices);\r\n\t}\r\n\r\n\treturn m;\r\n}\r\n\r\nSglMeshJS.prototype.toPackedMeshGL = function(gl, primitives, maxVertexIndex) {\r\n\treturn sglPackMeshJStoGL(gl, this, primitives, maxVertexIndex);\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglTrackball\r\n/***********************************************************************/\r\nvar SGL_TRACKBALL_NO_ACTION = 0;\r\nvar SGL_TRACKBALL_ROTATE    = 1;\r\nvar SGL_TRACKBALL_PAN       = 2;\r\nvar SGL_TRACKBALL_DOLLY     = 3;\r\nvar SGL_TRACKBALL_SCALE     = 4;\r\n\r\n/**\r\n * Constructs a SglTrackball object.\r\n * @class Interactor which implements a typical trackball controller.\r\n */\r\nfunction SglTrackball() {\r\n\tthis._matrix = sglIdentityM4();\r\n\tthis._pts    = [ [0.0, 0.0], [0.0, 0.0] ];\r\n\tthis._action = SGL_TRACKBALL_NO_ACTION;\r\n\r\n\tthis.reset();\r\n}\r\n\r\nSglTrackball.prototype = {\r\n\t_projectOnSphere : function(x, y) {\r\n\t\tvar r = 1.0;\r\n\r\n\t\tvar z = 0.0;\r\n\t\tvar d = sglSqrt(x*x + y*y);\r\n\t\tif (d < (r * 0.70710678118654752440)) {\r\n\t\t\t/* Inside sphere */\r\n\t\t\tz = sglSqrt(r*r - d*d);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t/* On hyperbola */\r\n\t\t\tt = r / 1.41421356237309504880;\r\n\t\t\tz = t*t / d;\r\n\t\t}\r\n\t\treturn z;\r\n\t},\r\n\r\n\t_transform : function(m, x, y, z) {\r\n\t\treturn sglMulM4V4(m, sglV4C(x, y, z, 0.0));\r\n\t},\r\n\r\n\t_transformOnSphere : function(m, x, y) {\r\n\t\tvar z = this._projectOnSphere(x, y);\r\n\t\treturn this._transform(m, x, y, z);\r\n\t},\r\n\r\n\t_translate : function(offset, f) {\r\n\t\tvar invMat = sglInverseM4(this._matrix);\r\n\t\tvar t = sglV3toV4(offset, 0.0);\r\n\t\tt = sglMulM4V4(invMat, t);\r\n\t\tt = sglMulSV4(f, t);\r\n\t\tvar trMat = sglTranslationM4V(t);\r\n\t\tthis._matrix = sglMulM4(this._matrix, trMat);\r\n\t},\r\n\r\n\tget action()  { return this._action; },\r\n\tset action(a) { this._action = a     },\r\n\r\n\tget matrix() { return this._matrix; },\r\n\r\n\treset : function () {\r\n\t\tthis._matrix = sglIdentityM4();\r\n\t\tthis._pts    = [ [0.0, 0.0], [0.0, 0.0] ];\r\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION\r\n\t},\r\n\r\n\ttrack : function(m, x, y, z) {\r\n\t\tthis._pts[0][0] = this._pts[1][0];\r\n\t\tthis._pts[0][1] = this._pts[1][1];\r\n\t\tthis._pts[1][0] = x;\r\n\t\tthis._pts[1][1] = y;\r\n\r\n\t\tswitch (this._action) {\r\n\t\t\tcase SGL_TRACKBALL_ROTATE:\r\n\t\t\t\tthis.rotate(m);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_PAN:\r\n\t\t\t\tthis.pan(m);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_DOLLY:\r\n\t\t\t\tthis.dolly(m, z);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_SCALE:\r\n\t\t\t\tthis.scale(m, z);\r\n\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\trotate : function(m) {\r\n\t\tif ((this._pts[0][0] == this._pts[1][0]) && (this._pts[0][1] == this._pts[1][1])) return;\r\n\r\n\t\tvar mInv = sglInverseM4(m);\r\n\r\n\t\tvar v0 = this._transformOnSphere(mInv, this._pts[0][0], this._pts[0][1]);\r\n\t\tvar v1 = this._transformOnSphere(mInv, this._pts[1][0], this._pts[1][1]);\r\n\r\n\t\tvar axis   = sglCrossV3(v0, v1);\r\n\t\tvar angle  = sglLengthV3(axis);\r\n\t\tvar rotMat = sglRotationAngleAxisM4V(angle, axis);\r\n\r\n\t\tthis._matrix = sglMulM4(rotMat, this._matrix);\r\n\t},\r\n\r\n\tpan : function(m) {\r\n\t\tvar mInv = sglInverseM4(m);\r\n\t\tvar v0 = this._transform(mInv, this._pts[0][0], this._pts[0][1], -1.0);\r\n\t\tvar v1 = this._transform(mInv, this._pts[1][0], this._pts[1][1], -1.0);\r\n\t\tvar offset = sglSubV3(v1, v0);\r\n\t\tthis._translate(offset, 2.0);\r\n\t},\r\n\r\n\tdolly : function(m, dz) {\r\n\t\tvar mInv = sglInverseM4(m);\r\n\t\tvar offset = this._transform(mInv, 0.0, 0.0, dz);\r\n\t\tthis._translate(offset, 1.0);\r\n\t},\r\n\r\n\tscale : function(m, s) {\r\n\t\tvar scaleMat = sglScalingM4C(s, s, s);\r\n\t\tthis._matrix = sglMulM4(this._matrix, scaleMat);\r\n\t}\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglFirstPersonCamera\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglFirstPersonCamera object.\r\n * The default pose is positioned at the origin, looking towards the -Z axis with 0 degrees roll.\r\n * The camera moves on the XZ plane, having +Y as upward axis.\r\n * @class Interactor which implements typical First-Person camera movements.\r\n */\r\nfunction SglFirstPersonCamera() {\r\n\tthis._position = sglZeroV3();\r\n\tthis._angles   = sglZeroV3();\r\n\r\n\tthis.lookAt(0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0);\r\n}\r\n\r\nSglFirstPersonCamera.prototype = {\r\n\t/**\r\n\t * Clones the object.\r\n\t * @return {SglFirstPersonCamera} A clone of the object.\r\n\t * @see SglFirstPersonCamera#get:copy\r\n\t */\r\n\tclone : function() {\r\n\t\tvar r = new SglFirstPersonCamera();\r\n\t\tr._position = this._position.slice();\r\n\t\tr._angles   = this._angles.slice();\r\n\t\treturn r;\r\n\t},\r\n\r\n\t/**\r\n\t * Getter for the whole object clone.\r\n\t * It returns a clone of the object.\r\n\t * @name SglFirstPersonCamera#get:copy\r\n\t * @function.\r\n\t * @return {SglFirstPersonCamera}\r\n\t * @see SglFirstPersonCamera#clone\r\n\t */\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets camera pose.\r\n\t * @param {number} positionX The X coordinate of the camera position.\r\n\t * @param {number} positionY The Y coordinate of the camera position.\r\n\t * @param {number} positionZ The Z coordinate of the camera position.\r\n\t * @param {number} targetX   The X coordinate of the point the camera will be looking at.\r\n\t * @param {number} targetY   The Y coordinate of the point the camera will be looking at.\r\n\t * @param {number} targetZ   The Z coordinate of the point the camera will be looking at.\r\n\t * @param {number} roll      The angle (in radians) of rotation around the view direction (upward vector is kepth at Y axis).\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\tlookAt : function(positionX, positionY, positionZ, targetX, targetY, targetZ, roll) {\r\n\t\tthis._position = sglV3C(positionX, positionY, positionZ);\r\n\r\n\t\tvar viewDir = sglSubV3([ targetX, targetY, targetZ ], this._position);\r\n\r\n\t\tthis._angles[0] = sglAtan2( viewDir[1], -viewDir[2]);\r\n\t\tthis._angles[1] = sglAtan2(-viewDir[0], -viewDir[2]);\r\n\t\tthis._angles[2] = (roll) ? (roll) : (0.0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Translates the camera position in its frame of reference.\r\n\t * @param {number} xOffset The amount of translation along the X axis.\r\n\t * @param {number} yOffset The amount of translation along the Y axis.\r\n\t * @param {number} zOffset The amount of translation along the Z axis.\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\ttranslate : function(xOffset, yOffset, zOffset) {\r\n\t\tvar pitchMat  = sglRotationAngleAxisM4C(this._angles[0], 1.0, 0.0, 0.0);\r\n\t\tvar yawMat    = sglRotationAngleAxisM4C(this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rollMat   = sglRotationAngleAxisM4C(this._angles[2], 0.0, 0.0, 1.0);\r\n\t\tvar rotMat    = sglMulM4(rollMat, sglMulM4(yawMat, pitchMat));\r\n\t\tvar rotOffset = sglMulM4V4(rotMat, [ xOffset, yOffset, zOffset, 0.0 ]);\r\n\r\n\t\tthis._position[0] += rotOffset[0];\r\n\t\tthis._position[1] += rotOffset[1];\r\n\t\tthis._position[2] += rotOffset[2];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Translates the camera position in its frame of reference, while preserving the Y coordinate (i.e. altitude).\r\n\t * @param {number} xOffset The amount of translation along the X axis.\r\n\t * @param {number} yOffset The amount of translation along the Y axis.\r\n\t * @param {number} zOffset The amount of translation along the Z axis.\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\ttranslateOnPlane : function(xOffset, yOffset, zOffset) {\r\n\t\tvar rotMat    = sglRotationAngleAxisM4C(this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rotOffset = sglMulM4V4(rotMat, [ xOffset, yOffset, zOffset, 0.0 ]);\r\n\r\n\t\tthis._position[0] += rotOffset[0];\r\n\t\tthis._position[1] += rotOffset[1];\r\n\t\tthis._position[2] += rotOffset[2];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Rotate the camera in its pitch-yaw-roll reference frame.\r\n\t * @param {number} pitchOffset The amount of rotation around the X axis (in radians).\r\n\t * @param {number} yawOffset   The amount of rotation around the Y axis (in radians).\r\n\t * @param {number} rollOffset  The amount of rotation around the view direction (in radians).\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\trotate : function(pitchOffset, yawOffset, rollOffset) {\r\n\t\tthis._angles[0] += pitchOffset;\r\n\t\tthis._angles[1] += yawOffset;\r\n\t\tthis._angles[2] += rollOffset;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Getter for the camera pose matrix.\r\n\t * The camera pose is returned as a 16-element array representing a 4x4 column major transofrmation matrix.\r\n\t * @name SglFirstPersonCamera#get:matrix\r\n\t * @function.\r\n\t * @return {Array}\r\n\t */\r\n\tget matrix() {\r\n\t\tvar pitchMat  = sglRotationAngleAxisM4C(-this._angles[0], 1.0, 0.0, 0.0);\r\n\t\tvar yawMat    = sglRotationAngleAxisM4C(-this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rollMat   = sglRotationAngleAxisM4C(-this._angles[2], 0.0, 0.0, 1.0);\r\n\t\tvar posMat    = sglTranslationM4V(sglNegV3(this._position));\r\n\t\tvar res       = sglMulM4(rollMat, sglMulM4(pitchMat, sglMulM4(yawMat, posMat)));\r\n\r\n\t\treturn res;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// canvas utilities\r\n/***********************************************************************/\r\nfunction sglGetCanvasContext(canvasID) {\r\n\tvar canvas = document.getElementById(canvasID);\r\n\tif (!canvas) return null;\r\n\r\n\tvar contextNames = ['webgl','experimental-webgl','moz-webgl','webkit-3d'];\r\n\t\r\n\tvar gl = null\r\n\tfor(var i = 0; i < contextNames.length; i++)\r\n\t{\r\n\t\ttry \r\n\t\t{\r\n\t\t\tgl = canvas.getContext(contextNames[i]);\r\n\t\t}\r\n\t\tcatch (x) { gl = null; }\r\n        if (gl) break;\r\n\t}\r\n\t\t\r\n\tif (gl == null) return null;\r\n\r\n\tif (gl.FALSE == undefined) gl.FALSE = 0;\r\n\tif (gl.TRUE  == undefined) gl.TRUE  = 1;\r\n\r\n\treturn gl;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglCanvasUI\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglCanvasUI.\r\n * @class Holds current information about the canvas object and input devices state.\r\n */\r\nfunction SglCanvasUI(manager, handler, canvas, gl) {\r\n\tthis._manager = manager;\r\n\tthis._handler = handler;\r\n\tthis._canvas  = canvas;\r\n\r\n\tthis._timerID = null;\r\n\tthis._updRate = 0.0;\r\n\tthis._ignoreKeyRepeat = true;\r\n\r\n\tthis.gl = gl;\r\n\r\n\tthis.loadEvent        = null;\r\n\tthis.unloadEvent      = null;\r\n\tthis.keyDownEvent     = null;\r\n\tthis.keyUpEvent       = null;\r\n\tthis.keyPressEvent    = null;\r\n\tthis.mouseDownEvent   = null;\r\n\tthis.mouseUpEvent     = null;\r\n\tthis.mouseMoveEvent   = null;\r\n\tthis.mouseWheelEvent  = null;\r\n\tthis.clickEvent       = null;\r\n\tthis.dblClickEvent    = null;\r\n\tthis.resizeEvent      = null;\r\n\tthis.updateEvent      = null;\r\n\tthis.drawEvent        = null;\r\n\r\n\tthis.keysDown         = new Object();\r\n\r\n\tthis.mouseButtonsDown = new Object();\r\n\tthis.mousePos         = { x:0, y:0 };\r\n\tthis.mousePrevPos     = { x:0, y:0 };\r\n\tthis.mouseDeltaPos    = { x:0, y:0 };\r\n\r\n\tthis.timeNow   = Date.now() / 1000.0;\r\n\tthis.timePrev  = this.timeNow;\r\n\tthis.timeDelta = 0.0;\r\n}\r\n\r\nSglCanvasUI.prototype = {\r\n\tget canvas() {\r\n\t\treturn this._canvas;\r\n\t},\r\n\r\n\tget width() {\r\n\t\treturn this._canvas.width;\r\n\t},\r\n\r\n\tget height() {\r\n\t\treturn this._canvas.height;\r\n\t},\r\n\r\n\tget ignoreKeyRepeat() {\r\n\t\treturn this._ignoreKeyRepeat;\r\n\t},\r\n\r\n\tset ignoreKeyRepeat(v) {\r\n\t\tthis._ignoreKeyRepeat = v;\r\n\t},\r\n\r\n\tget updateRate() {\r\n\t\tif (this._updRate <= 0.0) return 0.0;\r\n\t\treturn this._updRate;\r\n\t},\r\n\r\n\tset updateRate(r) {\r\n\t\tvar updR = r;\r\n\t\tif (updR < 0.0) updR = 0.0;\r\n\t\tif (updR > 1000.0) updR = 1000.0;\r\n\t\tif (this._updRate == updR) return;\r\n\r\n\t\tthis._updRate = updR;\r\n\r\n\t\tif (this._timerID != null)\r\n\t\t{\r\n\t\t\tclearInterval(this._timerID);\r\n\t\t\tthis._timerID = null;\r\n\t\t}\r\n\r\n\t\tif (this._updRate > 0.0)\r\n\t\t{\r\n\t\t\tvar ms  = 1000.0 / this._updRate;\r\n\t\t\tif (ms < 1.0) ms = 1.0;\r\n\t\t\tvar mgr = this._manager;\r\n\r\n\t\t\tthis.timeNow   = Date.now() / 1000.0;\r\n\t\t\tthis.timePrev  = this.timeNow;\r\n\t\t\tthis.timeDelta = 0.0;\r\n\r\n\t\t\tthis._timerID = setInterval(function() { mgr.update(); }, ms);\r\n\t\t}\r\n\t},\r\n\r\n\tget requestDraw() {\r\n\t\tvar t = this;\r\n\t\treturn (function() { t._manager.requestDraw(); });\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// _SglCanvasManager\r\n/***********************************************************************/\r\nfunction _SglCanvasManager(canvasID, handler, updateRate) {\r\n\tvar canvas = document.getElementById(canvasID);\r\n\tif (!canvas) throw new Error(\"SpiderGL : Canvas not found\");\r\n\r\n\tcanvas.contentEditable = true;\r\n\r\n\tvar gl = sglGetCanvasContext(canvasID);\r\n\tif (!gl) throw new Error(\"SpiderGL : Cannot get WebGL context\");\r\n\r\n\tgl.pixelStorei(gl.PACK_ALIGNMENT,                     1);\r\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT,                   1);\r\n\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,                true);\r\n\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,     false);\r\n\tgl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, gl.NONE);\r\n\r\n\t// for some strange reason, this is a workaround\r\n\t// to have Chrome work properly...\r\n\t// (anyway it should be harmless...)\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n\tvar ui  = new SglCanvasUI(this, handler, canvas, gl);\r\n\tthis.ui = ui;\r\n\r\n\tvar mgr = this;\r\n\r\n\tthis.gl      = gl;\r\n\tthis.canvas  = canvas;\r\n\tthis.handler = handler;\r\n\t//this.handler.prototype.ui = get function() { return ui };\r\n\t//this.handler.ui = get function() { return ui };\r\n\tthis.handler.ui = ui;\r\n\r\n\tthis._drawPending = false;\r\n\tthis.rendering = true;\r\n\tthis._drawFunc = function() {\r\n\t\tmgr.draw();\r\n\t};\r\n\r\n\r\n\tthis.canvas.addEventListener(\"load\",            function(e) { mgr.load        (e); }, false);\r\n\tthis.canvas.addEventListener(\"unload\",          function(e) { mgr.unload      (e); }, false);\r\n\tthis.canvas.addEventListener(\"keydown\",         function(e) { mgr.keyDown     (e); }, false);\r\n\tthis.canvas.addEventListener(\"keyup\",           function(e) { mgr.keyUp       (e); }, false);\r\n\tthis.canvas.addEventListener(\"keypress\",        function(e) { mgr.keyPress    (e); }, false);\r\n\tthis.canvas.addEventListener(\"mousedown\",       function(e) { mgr.mouseDown   (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseup\",         function(e) { mgr.mouseUp     (e); }, false);\r\n\tthis.canvas.addEventListener(\"mousemove\",       function(e) { mgr.mouseMove   (e); }, false);\r\n\tthis.canvas.addEventListener(\"click\",           function(e) { mgr.click       (e); }, false);\r\n\tthis.canvas.addEventListener(\"dblclick\",        function(e) { mgr.dblClick    (e); }, false);\r\n\tthis.canvas.addEventListener(\"resize\",          function(e) { mgr.resize      (e); }, false);\r\n\r\n\tthis.canvas.addEventListener(\"mousewheel\",      function(e) { mgr.mouseWheel  (e); }, false);\r\n\tthis.canvas.addEventListener(\"DOMMouseScroll\",  function(e) { mgr.mouseWheel  (e); }, false);\r\n\r\n\tthis.canvas.addEventListener(\"blur\",            function(e) { mgr.blur        (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseout\",        function(e) { mgr.mouseOut    (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseover\",       function(e) { mgr.mouseOver    (e); }, false);\r\n\t\r\n\tthis.canvas.addEventListener(\"touchstart\",      function(e) { mgr.touchStart  (e); }, false);\r\n\tthis.canvas.addEventListener(\"touchend\",        function(e) { mgr.touchEnd    (e); }, false);\r\n\tthis.canvas.addEventListener(\"touchmove\",       function(e) { mgr.touchMove   (e); }, false);\r\n\t\r\n\tthis.load();\r\n\r\n\tif (updateRate) {\r\n\t\tthis.ui.updateRate = updateRate;\r\n\t}\r\n}\r\n\r\n_SglCanvasManager.prototype = {\r\n\t_getMouseClientPos : function(e) {\r\n\t\tvar rct = this.canvas.getBoundingClientRect();\r\n\t\treturn {\r\n\t\t\tx : (e.clientX - rct.left),\r\n\t\t\ty : (e.clientY - rct.top )\r\n\t\t};\r\n\t},\r\n\r\n\trequestDraw : function() {\r\n\t\tif (this.rendering)\r\n\t\t{\r\n\t\t\tif (!this._drawPending) {\r\n\t\t\t\tthis._drawPending = true;\r\n\t\t\t\tsetTimeout(this._drawFunc, 0);\r\n\t\t\t}\r\n\t\t}\t\r\n\t},\r\n\r\n\tblur : function(e) {\r\n\t\tvar doDraw = false;\r\n\t\tfor (var button in this.ui.mouseButtonsDown) {\r\n\t\t\tif (this.ui.mouseButtonsDown[button]) {\r\n\t\t\t\tthis.ui.mouseButtonsDown[button] = false;\r\n\t\t\t\tif (this.handler.mouseUp) {\r\n\t\t\t\t\tif (this.handler.mouseUp(this.gl, button, this.ui.mousePos.x, this.ui.mousePos.y) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var key in this.ui.keysDown) {\r\n\t\t\tif (this.ui.keysDown[key]) {\r\n\t\t\t\tthis.ui.keysDown[key] = false;\r\n\t\t\t\tif (this.handler.keyUp) {\r\n\t\t\t\t\t// WARNING : passing 0 as keyCode\r\n\t\t\t\t\tif (this.handler.keyUp(this.gl, 0, key) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseOut: function(e) {\r\n\t\tvar doDraw = false;\r\n\t\tfor (var button in this.ui.mouseButtonsDown) {\r\n\t\t\tif (this.ui.mouseButtonsDown[button]) {\r\n\t\t\t\tthis.ui.mouseButtonsDown[button] = false;\r\n\t\t\t\tif (this.handler.mouseOut) {\r\n\t\t\t\t\tif (this.handler.mouseOut(this.gl, this.ui.mousePos.x, this.ui.mousePos.y) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\t\r\n\tmouseOver: function(e) {\r\n\t\r\n\t},\r\n\r\n\tload : function() {\r\n\t\tthis.ui.loadEvent = null;\r\n\t\tif (this.handler.load) {\r\n\t\t\tif (this.handler.load(this.gl) != false) {\r\n\t\t\t\t;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.requestDraw();\r\n\t},\r\n\r\n\tunload : function()\r\n\t{\r\n\t\tthis.ui.unloadEvent = null;\r\n\t\tthis.ui.updateRate = 0.0;\r\n\t\tif (this.handler.unload) {\r\n\t\t\tthis.handler.unload(this.gl);\r\n\t\t}\r\n\t\tthis.handler.ui = null;\r\n\t\tthis.handler    = null;\r\n\t\tthis.ui         = null;\r\n\t},\r\n\r\n\tkeyDown : function(e) {\r\n\t\tthis.ui.keyDownEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.keyCode);\r\n\t\tthis.ui.keysDown[keyString.toLowerCase()] = true;\r\n\t\tthis.ui.keysDown[keyString.toUpperCase()] = true;\r\n\t\tif (!this.ui.keysDown[e.keyCode] || !this.ui.ignoreKeyRepeat) {\r\n\t\t\tthis.ui.keysDown[e.keyCode] = true;\r\n\t\t\tif (this.handler.keyDown) {\r\n\t\t\t\tif (this.handler.keyDown(this.gl, e.keyCode, keyString) != false) {\r\n\t\t\t\t\tthis.requestDraw();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tkeyUp : function(e) {\r\n\t\tthis.ui.keyUpEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.keyCode);\r\n\t\tthis.ui.keysDown[keyString.toLowerCase()] = false;\r\n\t\tthis.ui.keysDown[keyString.toUpperCase()] = false;\r\n\t\tthis.ui.keysDown[e.keyCode] = false;\r\n\t\tif (this.handler.keyUp) {\r\n\t\t\tif (this.handler.keyUp(this.gl, e.keyCode, keyString) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tkeyPress : function(e) {\r\n\t\tthis.ui.keyPressEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.charCode);\r\n\t\tif (this.handler.keyPress) {\r\n\t\t\tif (this.handler.keyPress(this.gl, e.charCode, keyString) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseDown : function(e) {\r\n\t\tthis.ui.mouseDownEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[e.button] = true;\r\n\t\tif (this.handler.mouseDown) {\r\n\t\t\tif (this.handler.mouseDown(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.canvas.focus();\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseUp : function(e) {\r\n\t\tthis.ui.mouseUpEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[e.button] = false;\r\n\t\tif (this.handler.mouseUp) {\r\n\t\t\tif (this.handler.mouseUp(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseMove : function(e) {\r\n\t\tthis.ui.mouseMoveEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = this.ui.mousePos.x;\r\n\t\tthis.ui.mousePrevPos.y = this.ui.mousePos.y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = this.ui.mousePos.x - this.ui.mousePrevPos.x;\r\n\t\tthis.ui.mouseDeltaPos.y = this.ui.mousePos.y - this.ui.mousePrevPos.y;\r\n\t\tif (this.handler.mouseMove) {\r\n\t\t\tif (this.handler.mouseMove(this.gl, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseWheel : function(e) {\r\n\t\tthis.ui.mouseWheelEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tif (this.handler.mouseWheel) {\r\n\t\t\tvar delta = 0;\r\n\t\t\tif (!e) /* For IE. */ {\r\n\t\t\t\te = window.event;\r\n\t\t\t}\r\n\t\t\tif (e.wheelDelta) /* IE/Opera. */ {\r\n\t\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t\t\t/* In Opera 9, delta differs in sign as compared to IE.\r\n\t\t\t\t */\r\n\t\t\t\tif (window.opera) {\r\n\t\t\t\t\tdelta = -delta;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (e.detail) /** Mozilla case. */ {\r\n\t\t\t\t/** In Mozilla, sign of delta is different than in IE.\r\n\t\t\t\t * Also, delta is multiple of 3.\r\n\t\t\t\t */\r\n\t\t\t\tdelta = -e.detail / 3;\r\n\t\t\t}\r\n\t\t\t/* If delta is nonzero, handle it.\r\n\t\t\t * Basically, delta is now positive if wheel was scrolled up,\r\n\t\t\t * and negative, if wheel was scrolled down.\r\n\t\t\t */\r\n\t\t\tif (delta) {\r\n\t\t\t\tif (this.handler.mouseWheel(this.gl, delta, x, y) != false) {\r\n\t\t\t\t\tthis.requestDraw();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* Prevent default actions caused by mouse wheel.\r\n\t\t * That might be ugly, but we handle scrolls somehow\r\n\t\t * anyway, so don't bother here..\r\n\t\t */\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t//e.returnValue = false;\r\n\t},\r\n\r\n\ttouchStart : function(e) {\r\n\t\tthis.ui.mouseDownEvent = e.touches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.touches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[0] = true;\r\n\t\tif (this.handler.mouseDown) {\r\n\t\t\tif (this.handler.mouseDown(this.gl, 0, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.canvas.focus();\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\ttouchEnd : function(e) {\r\n\t\tthis.ui.mouseUpEvent = e.changedTouches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.changedTouches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[0] = false;\r\n\t\tif (this.handler.mouseUp) {\r\n\t\t\tif (this.handler.mouseUp(this.gl, 0, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\ttouchMove : function(e) {\r\n\t\tthis.ui.mouseMoveEvent = e.changedTouches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.changedTouches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = this.ui.mousePos.x;\r\n\t\tthis.ui.mousePrevPos.y = this.ui.mousePos.y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = this.ui.mousePos.x - this.ui.mousePrevPos.x;\r\n\t\tthis.ui.mouseDeltaPos.y = this.ui.mousePos.y - this.ui.mousePrevPos.y;\r\n\t\tif (this.handler.mouseMove) {\r\n\t\t\tif (this.handler.mouseMove(this.gl, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\t\r\n\tclick : function(e) {\r\n\t\tthis.ui.clickEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tif (this.handler.click) {\r\n\t\t\tif (this.handler.click(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tdblClick : function(e) {\r\n\t\tthis.ui.dblClickEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tif (this.handler.dblClick) {\r\n\t\t\tif (this.handler.dblClick(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tresize : function(e) {\r\n\t\tthis.ui.resizeEvent = e;\r\n\t\tif (this.handler.resize) {\r\n\t\t\tif (this.handler.resize(this.gl, this.canvas.width, this.canvas.height) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tupdate : function() {\r\n\t\tthis.ui.updateEvent = null;\r\n\t\tvar now = Date.now() / 1000.0;\r\n\t\tthis.ui.timePrev  = this.ui.timeNow;\r\n\t\tthis.ui.timeNow   = now;\r\n\t\tthis.ui.timeDelta = (this.ui.timeNow - this.ui.timePrev);\r\n\t\tvar doDraw = true;\r\n\t\tif (this.handler.update) {\r\n\t\t\tdoDraw = (this.handler.update(this.gl, this.ui.timeDelta) != false);\r\n\t\t}\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\r\n\tdraw : function() {\r\n\t\tthis.ui.drawEvent = null;\r\n\t\tif (this.handler.draw) {\r\n\t\t\tthis.handler.draw(this.gl);\r\n\t\t}\r\n\t\tthis.gl.flush();\r\n\t\tthis._drawPending = false;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// canvas registration\r\n/***********************************************************************/\r\nvar _SGL_RegisteredCanvas = new Object();\r\n\r\nfunction _sglManageCanvas(canvasID, handler, updateRate) {\r\n\tvar manager = new _SglCanvasManager(canvasID, handler, updateRate);\r\n\t_SGL_RegisteredCanvas[canvasID] = manager;\r\n}\r\n\r\nfunction _sglUnmanageCanvas(canvasID) {\r\n\tif (_SGL_RegisteredCanvas[canvasID]) {\r\n\t\t_SGL_RegisteredCanvas[canvasID] = null;\r\n\t\tdelete _SGL_RegisteredCanvas[canvasID];\r\n\t}\r\n}\r\n\r\nfunction _sglManageCanvasOnLoad(canvasID, handler, updateRate) {\r\n\twindow.addEventListener(\"load\", function() { _sglManageCanvas(canvasID, handler, updateRate); }, false);\r\n}\r\n\r\nfunction _sglUnmanageCanvasOnLoad(canvasID) {\r\n\twindow.addEventListener(\"unload\", function() { _sglUnmanageCanvas(canvasID); }, false);\r\n}\r\n\r\nfunction sglRegisterCanvas(canvasID, handler, updateRate) {\r\n\t_sglManageCanvasOnLoad(canvasID, handler, updateRate);\r\n\t_sglUnmanageCanvasOnLoad(canvasID);\r\n}\r\n\r\nfunction sglRegisterLoadedCanvas(canvasID, handler, updateRate) {\r\n\t_sglManageCanvas(canvasID, handler, updateRate);\r\n\t_sglUnmanageCanvasOnLoad(canvasID);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n","/*************************************************************************/\r\n/*                                                                       */\r\n/*  WebMultiRes                                                          */\r\n/*  JavaScript 3D Graphics Library on top of SpiderGL for web            */\r\n/*  visualization of high resolution RTI images                          */\r\n/*                                                                       */\r\n/*  Copyright (C) 2013-2015                                              */\r\n/*  Gianpaolo Palma                                                      */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it/rti/webviewer.php                             */\r\n/*  mailto: gianpaolo[DOT]palma[AT]isti[DOT]cnr[DOT]it                   */\r\n/*                                                                       */\r\n/*                                                                       */\r\n/*  This program is free software: you can redistribute it and/or modify */\r\n/*  it under the terms of the GNU General Public License as published by */\r\n/*  the Free Software Foundation, either version 3 of the License, or    */\r\n/*  (at your option) any later version.                                  */\r\n/*                                                                       */\r\n/*  This program is distributed in the hope that it will be useful,      */\r\n/*  but WITHOUT ANY WARRANTY; without even the implied warranty of       */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        */\r\n/*  GNU General Public License for more details.                         */\r\n/*                                                                       */ \r\n/*  You should have received a copy of the GNU General Public License    */\r\n/*  along with this program.  If not, see <http://www.gnu.org/licenses/> */\r\n/*************************************************************************/\r\n\r\nfunction createRtiViewer(idDiv, imageUrlOrFunction, width, height)\r\n{\r\n\tvar canvasHeight = height;\r\n\tvar canvasWidth = width;\r\n\tvar fullscreen = false;\r\n\tvar canvasContainer = $($(\"#\"+idDiv)[0]);\r\n\tvar canvasDiv = document.createElement(\"div\");\r\n\tcanvasDiv.id = idDiv + \"_div\";\r\n\tcanvasDiv.style.height = height + \"px\";\r\n\tcanvasDiv.style.width = width + \"px\";\r\n\tcanvasDiv.style.margin = \"auto\";\r\n\tcanvasDiv.style.position = \"relative\";\r\n\tcanvasContainer.append(canvasDiv);\r\n\t\r\n\tvar canvasNode = $($(\"#\"+idDiv + \"_div\")[0]);\r\n\tvar canvasName = idDiv + \"_webgl\";\r\n\tvar canvas = document.createElement(\"canvas\");\r\n\tcanvas.id = canvasName;\r\n\tcanvas.width = width;\r\n\tcanvas.height = height;\r\n\tcanvasNode.append(canvas);\r\n\t\r\n\tvar aNode = document.createElement(\"a\");\r\n\taNode.href = \"http://vcg.isti.cnr.it/rti/webviewer.php\";\r\n\taNode.target =\"_blank\";\r\n\t\r\n\tvar aNodeDiv = document.createElement(\"div\");\r\n\taNodeDiv.style.width = 80 + \"px\";\r\n\taNodeDiv.style.height = 50 + \"px\";\r\n\t\r\n\taNode.appendChild(aNodeDiv);\r\n\taNode.style.position = \"absolute\";\r\n\taNode.style.bottom = \"0px\";\r\n\taNode.style.left = \"0px\";\r\n\taNode.style.cssFloat = \"left\";\r\n\tcanvasNode.append(aNode);\r\n\t\t\r\n\tvar toolbar = document.createElement(\"div\");\r\n\ttoolbar.setAttribute(\"class\", \"toolbar\");\r\n\ttoolbar.style.position = \"absolute\";\r\n\ttoolbar.style.top = \"10px\";\r\n\ttoolbar.style.left = \"10px\";\r\n\ttoolbar.style.cssFloat = \"left\";\r\n\ttoolbar.style.width = \"40px\";\r\n\ttoolbar.style.height = \"200px\";\r\n\ttoolbar.style.visibility = \"hidden\";\r\n\ttoolbar.innerHTML = '<button class = \"toolbarButton\" id = \"zoomIn\"></button><button class = \"toolbarButton\" id = \"zoomOut\"></button><button class = \"toolbarButton\" id = \"light\"></button><button class = \"toolbarButton\" id = \"fullscreen\"></button><button class = \"toolbarButton\" id = \"help\"></button>'\r\n\tcanvasNode.append(toolbar);\r\n\t\r\n\tvar divHelp = document.createElement(\"div\");\r\n\tdivHelp.id = idDiv + \"_guide\";\r\n\tdivHelp.style.width = \"100%\";\r\n\tdivHelp.style.height = \"100%\";\r\n\tdivHelp.style.position = \"absolute\";\r\n\tdivHelp.style.left = \"0px\";\r\n\tdivHelp.style.top = \"0px\";\r\n\tdivHelp.style.color = \"#FFFFFF\";\r\n\tdivHelp.style.backgroundColor=\"rgba(0, 0, 0, 0.9)\";\r\n\t\r\n\tdivHelp.innerHTML = '<div id = \"guideTable\"><div id = \"guideCell\"> <div id = \"guideList\"><h3>WebRTIViewer<br/></h3><ul><li>Pan: LeftMouseButton + MouseMove.</li><li>Zoom in: MouseWhell or press the button <span><img src = \"/assets/webViewer/css/icons/zoomin.png\" alt=\"\"/></span></li><li>Zoom out: MouseWheel or press the button <span><img src = \"/assets/webViewer/css/icons/zoomout.png\" alt=\"\"/></span></li><li>To change the light direction: activate the light with the button <span><img src = \"/assets/webViewer/css/icons/light.png\" alt=\"\"/></span> and press LeftMouseButton + MouseMove or Ctrl + LeftMouseButton + MouseMove.</li><li>Fullscreen: press the button <span><img src = \"/assets/webViewer/css/icons/full.png\" alt=\"\"/></span> to active the fullscreen mode and the button <span><img src = \"/assets/webViewer/css/icons/full_on.png\" alt=\"\"/></span> to exit</li><li>To reset the viewpoint: press R.</li></ul><a href=\"http://vcg.isti.cnr.it/rti/webviewer.php\" target = \"_black\">Visual Computing Lab ISTI CNR Pisa</a></div></div></div>'\r\n\tdivHelp.style.display = \"none\";\r\n\tcanvasNode.append(divHelp);\r\n\t\r\n\t$( \"#\"+idDiv + \"_div #zoomIn\" ).button({\r\n      icons: {\r\n        primary: \"zoomInIcon toolbarIcon\"\r\n      },\r\n\t  text: false,\r\n      label: \"Zoom In\"\r\n    }).click(function(){multiResRTI.startZoomIn();});\r\n\t\r\n\t$( \"#\"+idDiv + \"_div #zoomOut\" ).button({\r\n      icons: {\r\n        primary: \"zoomOutIcon toolbarIcon\"\r\n      },\r\n\t  text: false,\r\n      label: \"Zoom Out\"\r\n    }).click(function(){multiResRTI.startZoomOut();});\r\n\r\n\t$( \"#\"+idDiv + \"_div #light\" ).button({\r\n      icons: {\r\n        primary: \"lightIcon toolbarIcon\"\r\n      },\r\n      text: false,\r\n\t  label: \"Light Off\"\r\n    }).click(function(){\r\n\t\tvar options;\r\n\t\tif ( $.trim($( this ).text()) == \"Light Off\" ) \r\n\t\t{\r\n\t\t\toptions = {\r\n\t\t\t\tlabel: \"Light On\",\r\n\t\t\t\ticons: {\r\n\t\t\t\t\tprimary: \"lightOnIcon toolbarIcon\"\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tmultiResRTI.setMode(1);\r\n\t\t} else {\r\n\t\t\toptions = {\r\n\t\t\t\tlabel: \"Light Off\",\r\n\t\t\t\ticons: {\r\n\t\t\t\t\tprimary: \"lightIcon toolbarIcon\"\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tmultiResRTI.setMode(0);\r\n\t\t}\r\n\t\t$( this ).button( \"option\", options );\r\n\t});\r\n\t\r\n\t$( \"#\"+idDiv + \"_div #help\" ).button({\r\n      icons: {\r\n        primary: \"helpIcon toolbarIcon\"\r\n      },\r\n\t  text: false,\r\n      label: \"Help\"\r\n    }).click(function(){$( \"#\"+idDiv + \"_guide\" ).show();});\r\n\t\r\n\t\r\n\tfunction fullScreenOn(){\r\n\t\tvar i = document.getElementById(idDiv + \"_div\");\r\n\t\tif (i.requestFullscreen) {\r\n\t\t\ti.requestFullscreen();\r\n\t\t} else if (i.webkitRequestFullscreen) {\r\n\t\t\ti.webkitRequestFullscreen();\r\n\t\t} else if (i.mozRequestFullScreen) {\r\n\t\t\ti.mozRequestFullScreen();\r\n\t\t} else if (i.msRequestFullscreen) {\r\n\t\t\ti.msRequestFullscreen();\r\n\t\t}\r\n\t\t\r\n\t\ti.style.height = screen.height + \"px\";\r\n\t\ti.style.width = screen.width + \"px\";\r\n\t\tvar canvas = $(\"#\" + idDiv + \"_webgl\");\r\n\t\tcanvas.height(screen.height);\r\n\t\tcanvas.width(screen.width);\r\n\t\tcanvas.attr(\"width\", screen.width);\r\n\t\tcanvas.attr(\"height\", screen.height);\r\n\t\tmultiResRTI.resize();\r\n\t\tfullscreen = true\r\n\t\tvar options = {\r\n\t\t\t\t\tlabel: \"Exit Fullscreen\",\r\n\t\t\t\t\ticons: {\r\n\t\t\t\t\t\tprimary: \"fullOnIcon toolbarIcon\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t$( \"#\"+idDiv + \"_div #fullscreen\").button( \"option\", options );\r\n\t};\r\n\t\r\n\tfunction fullScreenOff(){\r\n\t\tvar i = document.getElementById(idDiv + \"_div\");\r\n\t\tif (document.exitFullscreen) {\r\n\t\t\tdocument.exitFullscreen();\r\n\t\t} else if (document.webkitExitFullscreen) {\r\n\t\t\tdocument.webkitExitFullscreen();\r\n\t\t} else if (document.mozCancelFullScreen) {\r\n\t\t\tdocument.mozCancelFullScreen();\r\n\t\t} else if (document.msExitFullscreen) {\r\n\t\t\tdocument.msExitFullscreen();\r\n\t\t}\r\n\t\ti.style.height = canvasHeight + \"px\";\r\n\t\ti.style.width = canvasWidth + \"px\";\r\n\t\tvar canvas = $(\"#\" + idDiv + \"_webgl\");\r\n\t\tcanvas.height(canvasHeight);\r\n\t\tcanvas.width(canvasWidth);\r\n\t\tcanvas.attr(\"width\", canvasWidth);\r\n\t\tcanvas.attr(\"height\", canvasHeight);\r\n\t\tmultiResRTI.resize();\r\n\t\tfullscreen = false;\r\n\t\tvar options = {\r\n\t\t\t\t\tlabel: \"Active Fullscreen\",\r\n\t\t\t\t\ticons: {\r\n\t\t\t\t\t\tprimary: \"fullIcon toolbarIcon\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t$( \"#\"+idDiv + \"_div #fullscreen\").button( \"option\", options );\r\n\t};\r\n\t\r\n\t$( \"#\"+idDiv + \"_div #fullscreen\" ).button({\r\n      icons: {\r\n        primary: \"fullIcon toolbarIcon\"\r\n      },\r\n\t  text: false,\r\n      label: \"Active Fullscreen\"\r\n    }).click(\r\n\tfunction(){\r\n\t\t\tvar options;\r\n\t\t\tif (!fullscreen)\r\n\t\t\t\tfullScreenOn();\r\n\t\t\telse\r\n\t\t\t\tfullScreenOff();\r\n\t\t\t$(\"#\"+idDiv + \"_div #fullscreen\").removeClass(\"ui-state-hover\");\r\n\t\t}\r\n\t);\r\n\t\r\n\tdocument.addEventListener(\"MSFullscreenChange\", function () {\r\n    if(!document.msFullscreenElement) fullScreenOff();\r\n\t}, false);\r\n\tdocument.addEventListener(\"mozfullscreenchange\", function () {\r\n\t\tif(!document.mozFullScreen) fullScreenOff();\r\n\t}, false);\r\n\tdocument.addEventListener(\"webkitfullscreenchange\", function () {\r\n\t\tif(!document.webkitIsFullScreen) fullScreenOff();\r\n\t}, false);\r\n\t\t\r\n\t$( \"#\"+idDiv + \"_guide\" ).click(function(){$( \"#\"+idDiv + \"_guide\" ).hide();});\r\n\t\r\n\t\r\n\tvar divError = document.createElement(\"div\");\r\n\tdivError.id = idDiv + \"_error\";\r\n\tdivError.style.width = \"100%\";\r\n\tdivError.style.height = \"100%\";\r\n\tdivError.style.position = \"absolute\";\r\n\tdivError.style.left = \"0px\";\r\n\tdivError.style.top = \"0px\";\r\n\tdivError.style.color = \"#FFFFFF\";\r\n\tdivError.style.backgroundColor=\"rgba(0, 0, 0, 1.0)\";\r\n\t\r\n\tdivError.innerHTML = '<canvas id = \"testCanvas\" width= \"800\" height= \"600\" contenteditable=\"true\"></canvas>';\r\n\tdivError.style.display = \"none\";\r\n\tcanvasNode.append(divError);\r\n\tif (sglGetCanvasContext(\"testCanvas\") == null)\r\n\t{\r\n\t\tdivError.style.display = \"block\";\r\n\t\tdivError.innerHTML = '<div id = \"contentError\" style = \"width: 90%; height: 100%; text-align:left; padding:0% 5% 0% 5%; font-family:  Verdana,sans-serif; overflow-y: scroll;\"><h3>WebGL is not available or not enabled.</h3><p><a href=\"http://en.wikipedia.org/wiki/WebGL\">WebGL</a> is the technology we use to display the RTI images. It is currently supported, but sometimes not enabled by default, by recent versions of <a href=\"http://www.mozilla.org/firefox\">Firefox</a>, <a href=\"http://www.google.com/chrome\">Chrome</a> and <a href=\"http://www.apple.com/safari\">Safari</a>. An external plugins is available for <a href=\"http://microsoft.com/ie\">Internet  Explorer</a>.<br/> It also requires a moderately recent and capable hardware and up to date drivers.</p><p><b>Chrome</b><br/>Type \"chrome://flags\" in the address bar.<br/>Disable (yes, it is a confusing double negation!) the WebGL entry.<br/>Click the <em>relaunch now</em> button at the bottom.</p><p><b>Firefox</b><br/>Type \"about:config\" in the address bar<br/>Type \"webgl\" in the <em>Filter</em>.<br/>Doubleclick the entry <b>webgl.force-enable</b>, and restart Firefox.</p><p><b>Safari</b><br/>Open the Safari menu and select Preferences.<br/>Then, click the Advanced tab in the Preferences window.<br/>Then, at the bottom of the window, check the Show Develop menu in menu bar checkbox.<br/>Then, open the Develop menu in the menu bar and select Enable WebGL.</p><p><b>Internet Explorer (from version 9.0)</b><br/>Install the <a href=\"http://www.google.com/chromeframe\">Chrome Frame</a> <br/>Open the Tools menu and select Manage add-ons.<br/>Then, enable the ChromeFrame BHO plugins and restart Internet Explorer.<br/></p><p><b>Installing updated drivers</b><br/>If the visualization of the RTI image fails you must update the drivers of your graphics cards.</p></div>'\r\n\t}\r\n\telse\r\n\t{\r\n\t\tdivError.innerHTML = '';\r\n\t\tvar multiResRTI = new MultiRes(canvasName);\r\n\t\tif($.type(imageUrlOrFunction) === \"string\") {\r\n\t\t\tmultiResRTI.setImageUrl(imageUrlOrFunction);\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmultiResRTI.setImageFunction(imageUrlOrFunction);\r\n\t\t}\r\n\t\t\r\n\t\tfunction isRelitable(type){\r\n\t\t\tif (type ==  \"IMAGE\")\r\n\t\t\t{\r\n\t\t\t\t$( \"#\"+idDiv + \"_div #light\" ).css(\"display\", \"none\");\r\n\t\t\t}\r\n\t\t\t$( \".toolbar\").css(\"visibility\", \"visible\");\r\n\t\t};\r\n\t\tmultiResRTI.setOnLoadImageCallback(isRelitable);\r\n\t\tsglRegisterCanvas(canvasName, multiResRTI, 10.0);\r\n\t}\r\n}\r\n\r\n\r\n\r\nfunction log(msg) \r\n{\r\n\t//console.log(msg);\r\n}\r\n\r\nfunction MultiRes(canvas)\r\n{\r\n\tthis.mode = 0;\r\n\tthis.stepAnimation = 0;\r\n\tthis.idTimer;\r\n\tthis.flipAngles = [];\r\n\tthis.flipAngles[0] = 0.0;\r\n\tthis.canvas = canvas;\r\n\tthis.rendering = false;\r\n\tthis.onDrawCallback = null;\r\n\tthis.animating = false;\r\n\tthis.moveToCenter = false;\r\n\tthis.imageUrl = \"\";\r\n\tthis.imageFunction = null;\r\n\tthis.OnLoadImageCallback = null;\r\n\t\r\n\tthis.currentSpeed = 0.0;\r\n\tthis.maxStep = 7;\r\n\tthis.animationStack = [];\r\n\tthis.isMoving = false;\r\n\tfor (var  i = 1; i < 21; i++)\r\n\t\tthis.flipAngles[i] = SGL_PI / 2.0 * (Math.sin(i / 40.0 * SGL_PI));\r\n}\r\n\r\nMultiRes.prototype = {\r\n\r\n\tsetMode: function(x)\r\n\t{\r\n\t\tthis.mode = x;\r\n\t},\t\t\t\r\n\r\n\t\r\n\t_setLightDir : function(x, y) \r\n\t{\r\n\t\tvar lx = ((x / this.ui.width) * 2.2 - 1.1);\r\n\t\tvar ly = ((y / this.ui.height) * 2.2 - 1.1);\r\n\t\tlx = Math.min(1.0, Math.max(-1.0, lx));\r\n\t\tly = Math.min(1.0, Math.max(-1.0, ly));\r\n\t\tvar norm = Math.sqrt(lx*lx + ly*ly);\r\n\t\tif (norm > 1.0)\r\n\t\t\tnorm = 1.0;\r\n\t\tvar alpha = Math.PI / 2;\r\n\t\tif (lx != 0.0)\r\n\t\t\talpha = Math.atan2(ly, lx);\r\n\t\tlx = norm * Math.cos(alpha);\r\n\t\tly = norm * Math.sin(alpha);\r\n\t\tvar lpos = []\r\n\t\tif (norm < 1.0)\r\n\t\t\tlpos = [lx, ly, Math.sqrt(1.0 - lx*lx - ly*ly)];\r\n\t\telse\r\n\t\t\tlpos = [lx, ly, 0.0];\r\n\t\tlpos = sglNormalizedV3(lpos);\r\n\t\tthis.renderer.lightPos = lpos.slice(0, 3);\r\n\t\tthis.renderer.lweights = this.renderer.computeLightingFunction(lpos);\r\n\t},\r\n\r\n\tresetViewpoint : function()\r\n\t{\r\n\t\tthis.translation[0] = 0.0;\r\n\t\tthis.translation[1] = 0.0;\r\n\t\tthis.mat = sglIdentityM4();\r\n\t\tthis.flipMatrix = sglIdentityM4();\r\n\t},\r\n\t\r\n\t\r\n\tsetImageUrl: function(url)\r\n\t{\r\n\t\tthis.imageUrl = url;\r\n\t},\r\n\tsetImageFunction: function(imageFunction)\r\n\t{\r\n\t\tthis.imageFunction = imageFunction;\r\n\t},\r\n\t\r\n\tsetOnLoadImageCallback: function(callback)\r\n\t{\r\n\t\tthis.OnLoadImageCallback = callback;\r\n\t},\r\n\r\n\tload : function(gl)\r\n\t{\r\n\t\tlog(\"SpiderGL Version : \" + SGL_VERSION_STRING + \"\\n\");\r\n\t\t/*************************************************************/\r\n\t\tthis.xform  = new SglTransformStack();\r\n\t\t/*************************************************************/\r\n\r\n\t\tthis.renderer = new MultiResRenderer(gl, 256 * 1024 * 1024);\r\n\t\t\r\n\t\tthis.translation = [ 0.0, 0.0 ];\r\n\t\tthis.mat = sglIdentityM4();\r\n\t\tthis.flipMatrix = sglIdentityM4();\r\n\t\tif (this.imageUrl != \"\")\r\n\t\t\tthis.loadImage(this.imageUrl);\r\n\t\telse if(this.imageFunction !== null)\r\n\t\t\tthis.loadImage(this.imageFunction);\r\n\t},\r\n\t\r\n\t\r\n\tloadImage : function(url)\r\n\t{\r\n\t\tthis.renderer.loadImage(url);\r\n\t\tthis.OnLoadImageCallback(this.renderer.type);\r\n\t\tthis.xform  = new SglTransformStack();\r\n\t\tthis.translation = [ 0.0, 0.0 ];\r\n\t\tthis.mat = sglIdentityM4();\r\n\t\tthis.rendering = true;\r\n\t\t\r\n\t\tthis.leftBottom = [(this.renderer._tree.scale[0] - this.renderer.imgWidth) / 2.0, (this.renderer._tree.scale[1] - this.renderer.imgHeight) / 2.0];\r\n\t\tthis.rightTop = [this.leftBottom[0] + this.renderer.imgWidth, this.leftBottom[1] + this.renderer.imgHeight];\r\n\t\t\r\n\t\tthis.scale = 0;\r\n\t\tvar w = this.ui.width;\r\n\t\tvar h = this.ui.height;\r\n\t\tvar scale1 = this.renderer._tree.scale[0] / this.renderer.imgWidth * w;\r\n\t\tvar scale2 = this.renderer._tree.scale[1] / this.renderer.imgHeight * h;\r\n\t\tthis.scale = Math.min(scale1, scale2);\r\n\t\tthis.maxScale = Math.max(this.renderer.imgWidth / w, this.renderer.imgHeight / h) * 2.5;\r\n\t\tthis.viewerdx = 100;\r\n\t\tthis.viewerdy = 100;\r\n\t},\t\t\t\r\n\t\r\n\t\r\n\tstopRendering: function()\r\n\t{\r\n\t\tthis.rendering = false;\r\n\t},\r\n\t\r\n\tsetOnDrawCallback: function(onDraw)\r\n\t{\r\n\t\tif (onDraw)\r\n\t\t\tthis.onDrawCallback = onDraw;\r\n\t},\r\n\r\n\tkeyDown : function(gl, keyCode, keyString)\r\n\t{\r\n\t\tif (keyString == \"R\") this.resetViewpoint();\r\n\t\tif (keyString == \"1\") this.renderer.renderData = !this.renderer.renderData;\r\n\t\tif (keyString == \"2\") this.renderer.renderBoxes = !this.renderer.renderBoxes;\r\n\t},\r\n \r\n\tmouseWheel : function(gl, delta, x, y)\r\n\t{\r\n\t\tif (this.isMoving)\r\n\t\t\treturn false;\r\n\t\tvar tx = x - this.translation[0];\r\n\t\tvar ty = y - this.translation[1];\r\n\t\tvar s = sglPow(0.98, 10 * delta);\r\n\t\tthis._startZoom(s, tx, ty);\r\n\t},\r\n\t\r\n\t\r\n\tstartZoomIn: function()\r\n\t{\r\n\t\tif (this.isMoving)\r\n\t\t\treturn false;\r\n\t\tvar tx = this.ui.width / 2.0 - this.translation[0];\r\n\t\tvar ty = this.ui.height / 2.0 - this.translation[1];\r\n\t\tvar s = 1.2;\r\n\t\tthis._startZoom(s, tx, ty);\r\n\t},\r\n\t\r\n\t\r\n\tstartZoomOut: function()\r\n\t{\r\n\t\tif (this.isMoving)\r\n\t\t\treturn false;\r\n\t\tvar tx = this.ui.width / 2.0 - this.translation[0];\r\n\t\tvar ty = this.ui.height / 2.0 - this.translation[1];\r\n\t\tvar s = 0.8;\r\n\t\tthis._startZoom(s, tx, ty);\r\n\t},\r\n\t\r\n\t\r\n\t_startZoom: function(s, tx, ty)\r\n\t{\r\n\t\tvar tmp = this.mat[0] * s;\r\n\t\tif (tmp  > this.maxScale)\r\n\t\t\ts = this.maxScale / this.mat[0];\r\n\t\tif (tmp < 1.0 )\r\n\t\t\ts = 1.0 / this.mat[0];\r\n\t\tif (tmp <= 1.00000001)\r\n\t\t\tthis.moveToCenter = true;\r\n\t\tvar deltaPos = s*this.mat[0] - this.mat[0];\r\n\t\tif (deltaPos > 0.0001 || deltaPos < -0.0001)\r\n\t\t{\r\n\t\t\tthis.animationStack = [];\r\n\t\t\tvar t = this.maxStep * 2; \r\n\t\t\tvar d = 3 * deltaPos /(t * t * t);\r\n\t\t\tvar b = -2 * t * d;\r\n\t\t\tvar speed = d * t * t;\r\n\t\t\tvar tmpScale = this.mat[0];\r\n\t\t\tfor (var i = 0; i < t; i++)\r\n\t\t\t{\r\n\t\t\t\tvar delta = d * i + d / 3.0 + b / 2.0 + speed;\r\n\t\t\t\tspeed += d * (2*i + 1) + b;\r\n\t\t\t\tvar deltaScale = 1 + delta / tmpScale;\r\n\t\t\t\ttmpScale += delta;\r\n\t\t\t\tthis.animationStack.push([deltaScale, tx, ty]);\r\n\t\t\t}\r\n\t\t\tthis.animating = this.moveToCenter;\r\n\t\t\tvar that = this;\r\n\t\t\tclearInterval(this.moveInterval);\r\n\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\tthis.zoomInterval = setInterval(function(){that._zoomAnimation();}, 35);\r\n\t\t\tthis.renderer.updateData = false;\r\n\t\t\tthis.isMoving = this.moveToCenter;\r\n\t\t}\r\n\t\telse if (this.moveToCenter)\r\n\t\t{\r\n\t\t\tthis.animating = true;\r\n\t\t\tthis.isMoving = true;\r\n\t\t\tvar that = this;\r\n\t\t\tthis.animationStack = [];\r\n\t\t\tclearInterval(this.moveInterval);\r\n\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\tthis.zoomInterval = setInterval(function(){that._zoomAnimation();}, 35);\r\n\t\t\tthis.renderer.updateData = false;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t_zoomAnimation: function()\r\n\t{\r\n\t\tif (this.animationStack.length == 0)\r\n\t\t{\r\n\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\tif (this.moveToCenter)\r\n\t\t\t{\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tclearInterval(this.moveInterval);\r\n\t\t\t\tthis.moveInterval = setInterval(function(){that._moveAnimation();}, 35);\r\n\t\t\t\tthis.renderer.updateData = false;\r\n\t\t\t\tthis.isMoving = true;\r\n\t\t\t\t\r\n\t\t\t\tthis.computeModelMatrix();\t\t\t\t\r\n\t\t\t\tvar matrix = this.xform.model.top;\r\n\t\t\t\tvar tempPos = [this.renderer._tree.scale[0] / 2.0, this.renderer._tree.scale[1] / 2.0 ];\r\n\t\t\t\tvar endPoint = [this.ui.width/2.0, this.ui.height/2.0];\r\n\t\t\t\tvar pos = sglMulM4V4(matrix, sglV4C(tempPos[0], tempPos[1], 0.0, 1.0)).slice(0,2);\r\n\t\t\t\tvar deltaX = endPoint[0] - pos[0];\r\n\t\t\t\tvar deltaY = endPoint[1] - pos[1];\r\n\t\t\t\tthis.currentSpeed = 0;\r\n\t\t\t\tthis.currentPoint = pos;\t\t\t\t\r\n\t\t\t\tthis._updateMoveStack(pos, endPoint, sglV2C(deltaX, deltaY));\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis.renderer.updateData = true;\r\n\t\t\tthis.animating = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar step = this.animationStack.splice(0, 1)[0];\r\n\t\tvar s = step[0];\r\n\t\ttx = step[1];\r\n\t\tty = step[2];\r\n\r\n\t\tvar tmpMat = sglMulM4(sglTranslationM4C(tx, ty, 0.0), sglMulM4(sglScalingM4C(s, s, 1.0), sglMulM4(sglTranslationM4C(-tx, -ty, 0.0), this.mat)));\r\n\t\tvar m = this.returnModelMatrix(this.translation, tmpMat);\r\n\t\tvar lb = sglMulM4V4(m, sglV4C(this.leftBottom[0], this.leftBottom[1], 0.0, 1.0)).slice(0,2);\r\n\t\tvar rt = sglMulM4V4(m, sglV4C(this.rightTop[0], this.rightTop[1], 0.0, 1.0)).slice(0,2);\r\n\t\tlb[0] -= this.viewerdx;\r\n\t\tlb[1] -= this.viewerdy;\r\n\t\trt[0] += this.viewerdx;\r\n\t\trt[1] += this.viewerdy;\r\n\t\tvar realwidth = rt[0] - lb[0];\r\n\t\tvar realheight = rt[1] - lb[1];\r\n\t\tvar deltaX = 0;\r\n\t\tvar deltaY = 0;\r\n\t\tif (realwidth > this.ui.width && realheight > this.ui.height)\r\n\t\t{\r\n\t\t\tif (rt[0] < this.ui.width)\r\n\t\t\t\tdeltaX += this.ui.width - rt[0];\r\n\t\t\telse if (lb[0] > 0)\r\n\t\t\t\tdeltaX -= lb[0];\r\n\t\t\tif (rt[1] < this.ui.height)\r\n\t\t\t\tdeltaY += this.ui.height - rt[1];\r\n\t\t\telse if (lb[1] > 0)\r\n\t\t\t\tdeltaY -= lb[1];\r\n\t\t}\r\n\t\telse if (realwidth > this.ui.width)\r\n\t\t{\r\n\t\t\tty = this.ui.height / 2.0 - this.translation[1];\r\n\t\t\tif (rt[0] < this.ui.width)\r\n\t\t\t\tdeltaX += this.ui.width - rt[0];\r\n\t\t\telse if (lb[0] > 0)\r\n\t\t\t\tdeltaX -= lb[0];\r\n\t\t}\r\n\t\telse if (realheight > this.ui.height)\r\n\t\t{\r\n\t\t\ttx = this.ui.width / 2.0 - this.translation[0];\r\n\t\t\tif (rt[1] < this.ui.height)\r\n\t\t\t\tdeltaY += this.ui.height - rt[1];\r\n\t\t\telse if (lb[1] > 0)\r\n\t\t\t\tdeltaY -= lb[1];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttx = this.ui.width / 2.0;\r\n\t\t\tty = this.ui.height / 2.0;\r\n\t\t\tthis.resetViewpoint();\r\n\t\t\tif (this.animationStack.lenght == 0)\r\n\t\t\t{\r\n\t\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\t\tthis.renderer.updateData = true;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.mat = sglMulM4(sglTranslationM4C(tx, ty, 0.0), sglMulM4(sglScalingM4C(s, s, 1.0), sglMulM4(sglTranslationM4C(-tx, -ty, 0.0), this.mat)));\r\n\t\t\r\n\t\tthis.translation[0] += deltaX;\r\n\t\tthis.translation[1] += deltaY;\r\n\t\t\r\n\t\t_SGL_RegisteredCanvas[this.canvas].requestDraw();\r\n\t\treturn;\t\r\n\t},\r\n\t\r\n\tsendMouseDown : function(e)\r\n\t{\r\n\t\t_SGL_RegisteredCanvas[this.canvas].mouseDown(e);\r\n\t},\r\n \r\n\tmouseDown : function(gl, button, x, y)\r\n\t{\r\n\t\tif (this.animating)\r\n\t\t\treturn false;\r\n\t\tif (button == 0)\r\n\t\t{\r\n\t\t\tif (this.ui.keysDown[17])\r\n\t\t\t{\r\n\t\t\t\tthis._setLightDir(x, y);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (this.mode == 0)\r\n\t\t\t{\r\n\t\t\t\tthis.endAnimation = false;\r\n\t\t\t\tthis.currentPoint = [x, y];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tthis.animationStack = [];\r\n\t\t\t\t\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\t\tclearInterval(this.moveInterval);\r\n\t\t\t\tthis.moveInterval = setInterval(function(){that._moveAnimation();}, 35);\r\n\t\t\t\tthis.renderer.updateData = false;\r\n\t\t\t\tthis.isMoving = true;\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse if (this.mode == 1) \r\n\t\t\t\tthis._setLightDir(x, y);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_moveAnimation: function()\r\n\t{\r\n\t\tif ((this.moveToCenter ||this.endAnimation) && this.animationStack.length == 0)\r\n\t\t{\r\n\t\t\tclearInterval(this.moveInterval);\r\n\t\t\tthis.renderer.updateData = true;\r\n\t\t\tthis.isMoving = false;\r\n\t\t\tthis.animating = false;\r\n\t\t\tthis.moveToCenter = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (this.animationStack.length == 0)\r\n\t\t{\r\n\t\t\tthis.currentSpeed = 0;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar step = this.animationStack.splice(0, 1)[0];\r\n\t\t\r\n\t\tvar deltaX = step[0] - this.currentPoint[0];\r\n\t\tvar deltaY = step[1] - this.currentPoint[1];\r\n\t\tthis.currentSpeed = step[2];\r\n\t\t\r\n\t\tthis.translation[0] += deltaX;\r\n\t\tthis.translation[1] += deltaY;\r\n\t\t\r\n\t\tthis.currentPoint[0] = step[0];\r\n\t\tthis.currentPoint[1] = step[1];\r\n\t\t\r\n\t\t_SGL_RegisteredCanvas[this.canvas].requestDraw();\r\n\t\treturn;\r\n\t},\r\n\t\r\n\t\r\n\tmouseUp : function(gl, button, x, y)\r\n\t{\r\n\t\tif (button == 0)\r\n\t\t{\r\n\t\t\tif (this.mode == 0) \r\n\t\t\t{\r\n\t\t\t\tthis.endAnimation = true;\r\n\t\t\t\tthis.renderer.updateData = true;\r\n\t\t\t\tthis.isMoving = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\tmouseOut:function(gl, button, x, y)\r\n\t{\r\n\t\tthis.endAnimation = true;\r\n\t\tthis.isMoving = false;\r\n\t},\r\n\r\n\tmouseMove: function(gl, x, y)\r\n\t{\r\n\t\tif (this.animating)\r\n\t\t\treturn false;\r\n\t\tif (this.ui.mouseButtonsDown[0])\r\n\t\t{\r\n\t\t\tif (this.mode == 0)\r\n\t\t\t{\r\n\t\t\t\tif (this.ui.keysDown[17])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._setLightDir(x, y);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tvar endPoint = [x, y];\r\n\t\t\t\tvar deltaX = endPoint[0] - this.currentPoint[0];\r\n\t\t\t\tvar deltaY = endPoint[1] - this.currentPoint[1];\r\n\t\t\t\t\r\n\t\t\t\tvar tmpVector = this._adjustTranslation(deltaX, deltaY);\r\n\t\t\t\tendPoint = [this.currentPoint[0] + tmpVector[0], this.currentPoint[1] + tmpVector[1]];\r\n\t\t\t\tthis._updateMoveStack(this.currentPoint, endPoint, tmpVector);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis._setLightDir(x, y);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t\r\n\t_updateMoveStack: function(startPoint, endPoint, deltaVect)\r\n\t{\r\n\t\tvar deltaPos = sglLengthV2(deltaVect);\r\n\t\tif (deltaPos > 0.1)\r\n\t\t{\r\n\t\t\tthis.animationStack.splice(0, this.animationStack.length);\r\n\t\t\tvar movementVector = sglNormalizedV2(deltaVect);\r\n\t\t\tvar acceleration = (deltaPos / 2.0 - this.currentSpeed * this.maxStep) * 2.0 / (this.maxStep*this.maxStep);\r\n\t\t\tvar speed = this.currentSpeed;\r\n\t\t\tvar tmpPoint = [startPoint[0], startPoint[1]];\r\n\t\t\tvar totDelta = 0;\r\n\t\t\tvar t = this.maxStep;\r\n\t\t\tvar b = 0;\r\n\t\t\tvar d = 0;\r\n\t\t\tif (acceleration > 0)\r\n\t\t\t{\r\n\t\t\t\tfor (var i = 0 ; i < this.maxStep; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar delta = acceleration / 2.0  + speed;\r\n\t\t\t\t\tspeed += acceleration;\r\n\t\t\t\t\ttotDelta += delta;\r\n\t\t\t\t\tvar x = movementVector[0] * delta;\r\n\t\t\t\t\tvar y = movementVector[1] * delta;\r\n\t\t\t\t\ttmpPoint[0] += x;\r\n\t\t\t\t\ttmpPoint[1] += y;\r\n\t\t\t\t\tthis.animationStack.push([tmpPoint[0], tmpPoint[1], speed, acceleration]);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tt = 3 * deltaPos / (2 * speed);\r\n\t\t\t\td = 4 * speed * speed * speed / (9 * deltaPos * deltaPos);\r\n\t\t\t\tb = - 4 * speed * speed / (3 * deltaPos);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tt = 6 * deltaPos / (2 * speed);\r\n\t\t\t\td = speed * speed * speed / (9 * deltaPos * deltaPos);\r\n\t\t\t\tb = - 2 * speed * speed / (3 * deltaPos);\r\n\t\t\t}\t\t\t\t\t\r\n\t\t\t\r\n\t\t\tfor (var i = 0 ; i < t; i++)\r\n\t\t\t{\r\n\t\t\t\tvar delta = d * i + d / 3.0 + b / 2.0 + speed;\r\n\t\t\t\tspeed += d * (2*i + 1) + b;\r\n\t\t\t\tvar acc = d * (i + 1) + b; \r\n\t\t\t\tvar x = movementVector[0] * delta;\r\n\t\t\t\tvar y = movementVector[1] * delta;\r\n\t\t\t\ttmpPoint[0] += x;\r\n\t\t\t\ttmpPoint[1] += y;\r\n\t\t\t\tthis.animationStack.push([tmpPoint[0], tmpPoint[1], speed, d]);\r\n\t\t\t}\r\n\t\t\tthis.animationStack.push([endPoint[0], endPoint[1], 0, 0]);\t\r\n\t\t}\r\n\t},\r\n\t\r\n\t_adjustTranslation: function(deltaX, deltaY)\r\n\t{\r\n\t\tvar translVector = sglV4C(this.translation[0] + deltaX, this.translation[1] + deltaY, 0, 1.0);\r\n\t\tvar m = this.returnModelMatrix(translVector, this.mat);\r\n\t\t\r\n\t\tvar lb = sglMulM4V4(m, sglV4C(this.leftBottom[0], this.leftBottom[1], 0.0, 1.0)).slice(0,2);\r\n\t\tvar rt = sglMulM4V4(m, sglV4C(this.rightTop[0], this.rightTop[1], 0.0, 1.0)).slice(0,2);\r\n\t\tlb[0] -= this.viewerdx;\r\n\t\tlb[1] -= this.viewerdy;\r\n\t\trt[0] += this.viewerdx;\r\n\t\trt[1] += this.viewerdy;\r\n\t\tvar realwidth = rt[0] - lb[0];\r\n\t\tvar realheight = rt[1] - lb[1];\r\n\t\tvar realDeltaX = deltaX;\r\n\t\tvar realDeltaY = deltaY;\r\n\t\tif (realwidth > this.ui.width && realheight > this.ui.height)\r\n\t\t{\r\n\t\t\tif (rt[0] < this.ui.width)\r\n\t\t\t\trealDeltaX += this.ui.width - rt[0];\r\n\t\t\telse if (lb[0] > 0)\r\n\t\t\t\trealDeltaX -= lb[0];\r\n\t\t\tif (rt[1] < this.ui.height)\r\n\t\t\t\trealDeltaY += this.ui.height - rt[1];\r\n\t\t\telse if (lb[1] > 0)\r\n\t\t\t\trealDeltaY -= lb[1];\r\n\t\t}\r\n\t\telse if (realwidth > this.ui.width)\r\n\t\t{\r\n\t\t\tif (rt[0] < this.ui.width)\r\n\t\t\t\trealDeltaX += this.ui.width - rt[0];\r\n\t\t\telse if (lb[0] > 0)\r\n\t\t\t\trealDeltaX -= lb[0];\r\n\t\t\trealDeltaY = 0;\r\n\t\t}\r\n\t\telse if (realheight > this.ui.height)\r\n\t\t{\r\n\t\t\tif (rt[1] < this.ui.height)\r\n\t\t\t\trealDeltaY += this.ui.height - rt[1];\r\n\t\t\telse if (lb[1] > 0)\r\n\t\t\t\trealDeltaY -= lb[1];\r\n\t\t\trealDeltaX = 0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\trealDeltaX = 0;\r\n\t\t\trealDeltaY = 0;\r\n\t\t}\r\n\t\treturn sglV2C(realDeltaX, realDeltaY);\t\r\n\t},\r\n\t\r\n\tupdate : function(gl, dt)\r\n\t{\r\n\t\t;\r\n\t},\r\n\t\r\n\t\r\n\treturnModelMatrix: function(translVect, scaleMatrix)\r\n\t{\r\n\t\tvar m = (sglMulM4(sglTranslationM4C(translVect[0], translVect[1], 1.0), scaleMatrix));\r\n\t\tm = sglMulM4(this.flipMatrix, m);\r\n\t\tthis.xform.model.load(m);\r\n\t\r\n\t\tvar t = sglTranslationM4C(this.ui.width / 2.0, this.ui.height / 2.0, 0.0);\r\n\t\t\r\n\t\tthis.xform.model.multiply(t);\r\n\t\tthis.xform.model.scale(this.scale, this.scale, 1.0);\r\n\t\tthis.xform.model.multiply(this.renderer.normalizedTreeTransform);\r\n\t\treturn this.xform.model.top;\r\n\t},\r\n\t\r\n\t\r\n\tcomputeModelMatrix: function()\r\n\t{\r\n\t\tvar m = (sglMulM4(sglTranslationM4C(this.translation[0], this.translation[1], 1.0), this.mat));\r\n\t\tm = sglMulM4(this.flipMatrix, m);\r\n\t\tthis.xform.model.load(m);\r\n\t\r\n\t\tvar t = sglTranslationM4C(this.ui.width / 2.0, this.ui.height / 2.0, 0.0);\r\n\t\t\r\n\t\tthis.xform.model.multiply(t);\r\n\t\tthis.xform.model.scale(this.scale, this.scale, 1.0);\r\n\t\tthis.xform.model.multiply(this.renderer.normalizedTreeTransform);\r\n\t},\r\n\t\r\n\t\r\n\tresize : function()\r\n\t{\r\n\t\tthis.xform  = new SglTransformStack();\r\n\t\tthis.translation = [ 0.0, 0.0 ];\r\n\t\tthis.mat = sglIdentityM4();\r\n\t\tthis.rendering = true;\r\n\t\t\r\n\t\tthis.leftBottom = [(this.renderer._tree.scale[0] - this.renderer.imgWidth) / 2.0, (this.renderer._tree.scale[1] - this.renderer.imgHeight) / 2.0];\r\n\t\tthis.rightTop = [this.leftBottom[0] + this.renderer.imgWidth, this.leftBottom[1] + this.renderer.imgHeight];\r\n\t\t\r\n\t\tthis.scale = 0;\r\n\t\tvar w = this.ui.width;\r\n\t\tthis.offsetHeight = 0;\r\n\t\tvar h = this.ui.height + this.offsetHeight;\r\n\t\t\r\n\t\tthis.scale = Math.min(this.renderer._tree.scale[0] / this.renderer.imgWidth * w, this.renderer._tree.scale[1] / this.renderer.imgHeight * h);\r\n\t\tthis.maxScale = Math.max(this.renderer.imgWidth / w, this.renderer.imgHeight / h) * 3;\r\n\t\t\r\n\t\tthis.viewerdx = this.ui.width / 2.0 - 10;\r\n\t\tthis.viewerdy = this.ui.height / 2.0 - 10;\r\n\t},\r\n\t\r\n\r\n\tdraw : function(gl)\r\n\t{\r\n\t\tvar error = gl.getError();\r\n\t\tif (error == gl.CONTEXT_LOST_WEBGL)\r\n\t\t\tconsole.log(\"WebGL Context lost\");\r\n\t\tgl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\r\n\t\tif (this.rendering == true)\r\n\t\t{\r\n\t\t\tvar w = this.ui.width;\r\n\t\t\tvar h = this.ui.height;\r\n\r\n\t\t\tgl.viewport(0, 0, w, h);\r\n\r\n\t\t\tthis.xform.projection.loadIdentity();\r\n\t\t\tthis.xform.projection.ortho(0.0, w, 0.0, h, -4096.0, 4096.0);\r\n\r\n\t\t\tthis.xform.view.loadIdentity();\r\n\t\t\tthis.xform.view.lookAt(0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0);\r\n\r\n\t\t\tthis.computeModelMatrix();\r\n\t\t\t\t\t\r\n\t\t\tvar m = this.xform.model.top;\r\n\t\t\tif (this.onDrawCallback)\r\n\t\t\t\tthis.onDrawCallback(m);\r\n\t\t\t\r\n\t\t\tthis.renderer.render(this.xform.projectionMatrix, this.xform.modelViewMatrix, [ 0, 0, w, h ]);\r\n\t\t}\r\n\t},\r\n};\r\n\r\n\r\n\r\n\r\nfunction MultiResNode()\r\n{\r\n\tthis.id              = 0;\r\n\tthis.parentIndex     = -1;\r\n\tthis.childrenIndices = [ -1, -1, -1, -1 ];\r\n\tthis.projectedSize   = 1.0;\r\n\tthis.zScale          = 1.0;\r\n\tthis.box             = new SglBox3();\r\n\tthis.priority        = { timestamp: -1, error: Number.MAX_VALUE };\r\n\tthis.req             = null;\r\n\tthis.data            = null;\r\n\tthis.isLeaf          = true;\r\n}\r\n\r\n\r\n\r\nfunction MultiResTree(url, onloadCallback)\r\n{\r\n\tthis.ready      = true;\r\n\tthis.nodesCount = 0;\r\n\tthis.rootIndex  = -1;\r\n\tthis.nodes      = null;\r\n\tthis.url        = null;\r\n\tthis.tileSize   = 0;\r\n\tthis.scale      = [ 1.0, 1.0, 1.0 ];\r\n\tthis.offset     = [ 0.0, 0.0, 0.0 ];\r\n\tthis.forma\t\t= \"\";\r\n\r\n\tif (url)\r\n\t\tthis.load(url, imgW, imgH, onloadCallback);\r\n}\r\n\r\nMultiResTree.prototype = {\r\n\r\n\t_load : function(text, imgW, imgH)\r\n\t{\r\n\t\tthis.ready = true;\r\n\r\n\t\tvar lines = sglGetLines(text);\r\n\t\tvar n = lines.length;\r\n\t\tvar tokens = null;\r\n\t\tvar i = 0;\r\n\r\n\t\tif (n <= i) return;\r\n\t\ttokens = lines[i++].split(\" \");\r\n\t\tif (tokens.length < 2) return;\r\n\t\tvar nodesCount = parseInt(tokens[0]);\r\n\t\tif (nodesCount <= 0) return;\r\n\t\tvar rootIndex = parseInt(tokens[1]);\r\n\t\tif ((rootIndex < 0) || (rootIndex >= nodesCount)) return;\r\n\r\n\t\tif (n <= i) return;\r\n\t\ttokens = lines[i++].split(\" \");\r\n\t\tif (tokens.length < 1) return;\r\n\t\tvar tileSize = parseInt(tokens[0]);\r\n\t\tif (tileSize <= 0) return;\r\n\r\n\t\tif (n <= i) return;\r\n\t\ttokens = lines[i++].split(\" \");\r\n\t\tif (tokens.length < 3) return;\r\n\t\tvar scale = [ 1.0, 1.0, 1.0 ];\r\n\t\tscale[0] = parseFloat(tokens[0]);\r\n\t\tscale[1] = parseFloat(tokens[1]);\r\n\t\tscale[2] = parseFloat(tokens[2]);\r\n\r\n\t\tif (n <= i) return;\r\n\t\ttokens = lines[i++].split(\" \");\r\n\t\tif (tokens.length < 3) return;\r\n\t\tvar offset = [ 0.0, 0.0, 0.0 ];\r\n\t\toffset[0] = parseFloat(tokens[0]);\r\n\t\toffset[1] = parseFloat(tokens[1]);\r\n\t\toffset[2] = parseFloat(tokens[2]);\r\n\r\n\t\tvar nodes = new Array(nodesCount);\r\n\t\tif ( n > i )\r\n\t\t{\r\n\t\t\tfor (var k=0; k<nodesCount; ++k)\r\n\t\t\t{\r\n\t\t\t\tvar node = new MultiResNode();\r\n\r\n\t\t\t\tif (n <= i) return;\r\n\t\t\t\ttokens = lines[i++].split(\" \");\r\n\t\t\t\tif (tokens.length < 14) return;\r\n\r\n\t\t\t\tnode.id = parseInt(tokens[0]);\r\n\t\t\t\tif (node.id <= 0) return;\r\n\r\n\t\t\t\tnode.parentIndex = parseInt(tokens[1]);\r\n\t\t\t\tif ((node.parentIndex < -1) || (node.parentIndex >= nodesCount)) return;\r\n\r\n\t\t\t\tfor (var c=0; c<4; ++c) \r\n\t\t\t\t{\r\n\t\t\t\t\tnode.childrenIndices[c] = parseInt(tokens[c+2]);\r\n\t\t\t\t\tif ((node.childrenIndices[c] < -1) || (node.childrenIndices[c] >= nodesCount)) return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode.projectedSize = parseFloat(tokens[6]);\r\n\r\n\t\t\t\tnode.zScale = parseFloat(tokens[7]);\r\n\r\n\t\t\t\tnode.box.min[0] = parseFloat(tokens[ 8]);\r\n\t\t\t\tnode.box.min[1] = parseFloat(tokens[ 9]);\r\n\t\t\t\tnode.box.min[2] = parseFloat(tokens[10]);\r\n\t\t\t\tnode.box.max[0] = parseFloat(tokens[11]);\r\n\t\t\t\tnode.box.max[1] = parseFloat(tokens[12]);\r\n\t\t\t\tnode.box.max[2] = parseFloat(tokens[13]);\r\n\r\n\t\t\t\tnode.isLeaf = true;\r\n\t\t\t\tfor (var j=0; j<4; ++j) \r\n\t\t\t\t{\r\n\t\t\t\t\tif (node.childrenIndices[j] >= 0) \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnode.isLeaf = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnodes[k] = node;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar index = 0;\r\n\t\t\tvar temp = scale[0];\r\n\t\t\tvar nLevel = 1;\r\n\t\t\twhile (temp > tileSize)\r\n\t\t\t{\r\n\t\t\t\tnLevel++;\r\n\t\t\t\ttemp /= 2;\r\n\t\t\t}\r\n\t\t\tvar woffset = ((scale[0] - imgW) / 2.0) / scale[0];\r\n\t\t\tvar hoffset = ((scale[1] - imgH) / 2.0) / scale[1];\r\n\t\t\tvar imgBox = new SglBox3([woffset, hoffset, 0], [woffset + imgW / scale[0] , hoffset + imgH / scale[1], 1.0]);\r\n\t\t\tvar imgSize = imgBox.size;\r\n\t\t\tvar imgCenter = imgBox.center;\r\n\t\t\tfor (var i = 0; i < nLevel; i++)\r\n\t\t\t{\r\n\t\t\t\tvar count = Math.pow(4, i);\r\n\t\t\t\tfor (var j = 0; j < count; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar node = new MultiResNode();\r\n\t\t\t\t\tnode.id = index + 1;\r\n\t\t\t\t\tif (index > 0)\r\n\t\t\t\t\t\tnode.parentIndex = Math.ceil(index / 4) - 1;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tnode.parentIndex = -1;\r\n\t\t\t\t\tif (i < nLevel - 1)\r\n\t\t\t\t\t\tnode.isLeaf = false;\r\n\t\t\t\t\tfor (var c=0; c<4; ++c) \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (i == nLevel - 1)\r\n\t\t\t\t\t\t\tnode.childrenIndices[c] = -1;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tnode.childrenIndices[c] = index * 4 + 1 + (c + 2) % 4;\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\tnode.projectedSize = tileSize;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tif (index > 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar t = index % 4;\r\n\t\t\t\t\t\tvar parentNode = nodes[node.parentIndex];\r\n\t\t\t\t\t\tvar halfW = parentNode.box.min[0] + (parentNode.box.max[0] -  parentNode.box.min[0]) / 2.0;\r\n\t\t\t\t\t\tvar halfH = parentNode.box.min[1] + (parentNode.box.max[1] -  parentNode.box.min[1]) / 2.0;\r\n\t\t\t\t\t\tif (t == 1)\r\n\t\t\t\t\t\t\tnode.box = new SglBox3([parentNode.box.min[0], halfH, 0.0], [halfW, parentNode.box.max[1], 1.0]);\r\n\t\t\t\t\t\telse if (t == 2)\r\n\t\t\t\t\t\t\tnode.box = new SglBox3([halfW, halfH, 0.0], parentNode.box.max);\r\n\t\t\t\t\t\telse if (t == 3)\r\n\t\t\t\t\t\t\tnode.box = new SglBox3(parentNode.box.min, [halfW, halfH, 1.0]);\r\n\t\t\t\t\t\telse if (t == 0)\r\n\t\t\t\t\t\t\tnode.box = new SglBox3([halfW, parentNode.box.min[1], 0.0], [parentNode.box.max[0], halfH, 1.0]);\r\n\t\t\t\t\t\tvar center = node.box.center;\r\n\t\t\t\t\t\tvar size = node.box.size;\r\n\t\t\t\t\t\tvar halfSize = sglSelfMulV3S(sglAddV3(imgSize, size), 0.5);\r\n\t\t\t\t\t\tvar diff = sglSubV3(imgCenter, center);\r\n\t\t\t\t\t\tif (Math.abs(diff[0]) <= halfSize[0] && Math.abs(diff[1]) <= halfSize[1] && Math.abs(diff[2]) <= halfSize[2])\r\n\t\t\t\t\t\t\tnode.zScale = 1;\r\n\t\t\t\t\t\telse \r\n\t\t\t\t\t\t\tnode.zScale = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnode.box = new SglBox3([0.0, 0.0, 0.0], [1.0, 1.0, 1.0]);\r\n\t\t\t\t\t\tnode.zScale = 1;\r\n\t\t\t\t\t}\t\r\n\t\t\t\t\tnodes[index] = node;\r\n\t\t\t\t\tindex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.nodesCount = nodesCount;\r\n\t\tthis.rootIndex  = rootIndex;\r\n\t\tthis.tileSize   = tileSize;\r\n\t\tthis.scale      = scale;\r\n\t\tthis.offset     = offset;\r\n\t\tthis.nodes      = nodes;\r\n\t},\r\n\r\n\tdestroy : function(destroyData)\r\n\t{\r\n\t\tvar n = null;\r\n\t\tfor (var i in this.nodes) \r\n\t\t{\r\n\t\t\tn = this.nodes[i];\r\n\t\t\tif (n.req) \r\n\t\t\t{\r\n\t\t\t\tn.req.onLoad = null;\r\n\t\t\t\tn.req = null;\r\n\t\t\t}\r\n\t\t\tif (n.data) \r\n\t\t\t{\r\n\t\t\t\tdestroyData(n.data);\r\n\t\t\t\tn.data = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.ready      = true;\r\n\t\tthis.nodesCount = 0;\r\n\t\tthis.rootIndex  = -1;\r\n\t\tthis.nodes      = null\r\n\t\tthis.url        = null;\r\n\t\tthis.tileSize   = 0;\r\n\t\tthis.scale      = [ 1.0, 1.0, 1.0 ];\r\n\t},\r\n\r\n\tload : function(url, imgW, imgH, onloadCallback)\r\n\t{\r\n\t\tif (!url) return false;\r\n\t\tthis._load(url, imgW, imgH);\r\n\t},\r\n\r\n\tget isEmpty() \r\n\t{\r\n\t\treturn (this.nodesCount <= 0);\r\n\t},\r\n\r\n\tget root() \r\n\t{\r\n\t\tvar idx = this.rootIndex;\r\n\t\tif (idx < 0) return null;\r\n\t\treturn this.nodes[idx];\r\n\t},\r\n\r\n\tparent : function(n)\r\n\t{\r\n\t\tvar idx = n.parentIndex;\r\n\t\tif (idx < 0) return null;\r\n\t\treturn this.nodes[idx];\r\n\t},\r\n\r\n\tchild: function(n, i)\r\n\t{\r\n\t\tvar idx = n.childrenIndices[i];\r\n\t\tif (idx < 0) return null;\r\n\t\treturn this.nodes[idx];\r\n\t}\r\n};\r\n\r\nfunction _MultiResAssert(cond) \r\n{\r\n\tif (cond) return;\r\n\talert(\"MultiResAssert FAILED : \" + cond);\r\n}\r\n\r\nfunction _MultiResCompareNodes(a, b)\r\n{\r\n\t// higher timestamp first\r\n\tif (a.priority.timestamp != b.priority.timestamp)\r\n\t\treturn (b.priority.timestamp - a.priority.timestamp);\r\n\t\r\n\t// higher error first\r\n\tif (a.priority.error != b.priority.error)\r\n\t\treturn (b.priority.error - a.priority.error);\r\n\r\n\t// lower id first\r\n\treturn (a.id - b.id);\r\n};\r\n\r\nfunction MultiResRenderer(gl, cacheSizeInBytes, onLoad)\r\n {\r\n\tthis.lg = true;\r\n\tthis.gl = gl;\r\n\tthis._tree = new MultiResTree();\r\n\tthis._timestamp = 0;\r\n\tthis._frustum = new SglFrustum();\r\n\tthis._maxError = 1.0;\r\n\tthis._cache = [ ];\r\n\tthis._cacheSizeInBytes = cacheSizeInBytes;\r\n\tthis._maxCacheSize = 1;\r\n\tthis._maxOngoingRequests = 2;\r\n\tthis._currentOngoingRequests = 0;\r\n\tthis._toRequest = [ ];\r\n\tthis._toRenderFullRes = [ ];\r\n\tthis._toRenderHalfRes = [ ];\r\n\tthis._readyItems = [ ];\r\n\r\n\tthis.renderData  = true;\r\n\tthis.renderBoxes = false;\r\n\t//this.lightPos    = [ 0.0, 0.0, 1.0 ];\r\n\t//this.lweights \t = this.computeLightingFunction(this.lightPos);\r\n\r\n\t// box mesh\r\n\t/******************************************************/\r\n\tvar boxPositions = new Float32Array([\r\n\t\t-0.5, -0.5,  0.5,\r\n\t\t 0.5, -0.5,  0.5,\r\n\t\t-0.5,  0.5,  0.5,\r\n\t\t 0.5,  0.5,  0.5,\r\n\t\t-0.5, -0.5, -0.5,\r\n\t\t 0.5, -0.5, -0.5,\r\n\t\t-0.5,  0.5, -0.5,\r\n\t\t 0.5,  0.5, -0.5\r\n\t ]);\r\n\r\n\tvar trianglesIndices = new Uint16Array([\r\n\t\t0, 1, 2,  2, 1, 3,  // front\r\n\t\t5, 4, 7,  7, 4, 6,  // back\r\n\t\t4, 0, 6,  6, 0, 2,  // left\r\n\t\t1, 5, 3,  3, 5, 7,  // right\r\n\t\t2, 3, 6,  6, 3, 7,  // top\r\n\t\t4, 5, 0,  0, 5, 1   // bottom\r\n\t]);\r\n\r\n\tvar edgesIndices = new Uint16Array([\r\n\t\t0, 1, 1, 3, 3, 2, 2, 0,  // front\r\n\t\t5, 4, 4, 6, 6, 7, 7, 5,  // back\r\n\t\t0, 4, 1, 5, 3, 7, 2, 6   // middle\r\n\t]);\r\n\r\n\tvar box = new SglMeshGL(gl);\r\n\r\n\tbox.addVertexAttribute(\"position\", 3, boxPositions);\r\n\tbox.addIndexedPrimitives(\"triangles\", gl.TRIANGLES, trianglesIndices);\r\n\tbox.addIndexedPrimitives(\"edges\",     gl.LINES,     edgesIndices);\r\n\r\n\tthis._boxMesh = box;\r\n\t/******************************************************/\r\n\r\n\t/******************************************************/\r\n\tthis._tileFullMesh = null;\r\n\tthis._tileHalfMesh = null;\r\n\t/******************************************************/\r\n\r\n\t// image rendering\r\n\t/******************************************************/\r\n\tthis._program = null;\r\n\t/******************************************************/\r\n\r\n\t// box rendering\r\n\t/******************************************************/\r\n\tvar bvs = sglLoadFile(\"/assets/webViewer/spidergl/box.v.glsl\");\r\n\tvar bfs = sglLoadFile(\"/assets/webViewer/spidergl/box.f.glsl\");\r\n\tvar bprg = new SglProgram(gl, [bvs], [bfs]);\r\n\tlog(bprg.log);\r\n\r\n\tthis._boxProgram  = bprg;\r\n\tthis._boxRenderer = new SglMeshGLRenderer(this._boxProgram);\r\n\t/******************************************************/\r\n\r\n\tthis._treeTransform = sglIdentityM4();\r\n\tthis._normalizedTreeTransform = sglIdentityM4();\r\n\r\n\tthis.updateData = true;\r\n\r\n\tvar texVsrc = \"#ifdef GL_ES\\n\" + \"precision highp float;\\n\" + \"#endif\\n\" + \"uniform   mat4 u_mvp;\\n\" + \"attribute vec2 a_position;\\n\" + \"attribute vec2 a_texcoord;\\n\" + \"varying   vec2 v_texcoord;\\n\" + \"void main(void){\\n\" +\"v_texcoord  = a_texcoord;\\n\" + \"gl_Position = u_mvp * vec4(a_position, 0.0, 1.0);\\n}\";\r\n\tvar texFsrc = \"#ifdef GL_ES\\n\" + \"precision highp float;\\n\" + \"#endif\\n\" + \"uniform sampler2D s_texture;\\n\" + \"varying vec2     v_texcoord;\\n\" + \"void main(void){\" + \"vec4 color = texture2D(s_texture, v_texcoord).xyzw;\\n\" + \"if (color.w > 0.7)\\n\" + \"gl_FragData[0] = vec4(color.rgb, 1.0);\\n\" + \"else\\n\" +\r\n\t\"gl_FragData[0] = vec4(0.0);}\";\t\r\n\tthis.texProg = new SglProgram(this.gl, [texVsrc], [texFsrc]);\r\n\tlog(this.texProg.log);\r\n\t\t\r\n\tvar lgPositions = new Float32Array\r\n\t([\r\n\t\t 0, 0,\r\n\t\t 80,  0,\r\n\t\t 0,  50,\r\n\t\t 80,  50,\r\n\t]);\r\n\r\n\tvar lgTexcoords = new Float32Array\r\n\t([\r\n\t\t0.0, 0.0,\r\n\t\t1.0, 0.0,\r\n\t\t0.0, 1.0,\r\n\t\t1.0, 1.0\r\n\t]);\r\n\r\n\tif (this.lg)\r\n\t{\r\n\t\tvar tmp = new SglMeshGL(this.gl);\r\n\t\ttmp.addVertexAttribute(\"position\", 2, lgPositions);\r\n\t\ttmp.addVertexAttribute(\"texcoord\", 2, lgTexcoords);\r\n\t\ttmp.addArrayPrimitives(\"tristrip\", this.gl.TRIANGLE_STRIP, 0, 4);\r\n\t\tthis.lgMesh = tmp;\r\n\t\tthis.lgtex = null;\r\n\t\tthis._createLg();\r\n\t}\r\n\t\r\n\tthis.enumType = new Object();\r\n\tthis.enumType[\"HSH_RTI\"] = 1;\r\n\tthis.enumType[\"LRGB_PTM\"] = 2;\r\n\tthis.enumType[\"RGB_PTM\"] = 3;\r\n\tthis.enumType[\"IMAGE\"] = 4;\r\n}\r\n\r\n\r\nMultiResRenderer.prototype = {\r\n\r\n\tcomputeLightingFunction: function(lpos)\r\n\t{\r\n\t\tswitch (this.enumType[this.type])\r\n\t\t{\r\n\t\t\tcase 1:\r\n\t\t\t\tvar phi = Math.atan2(lpos[1], lpos[0]);\r\n\t\t\t\tif (phi < 0) \r\n\t\t\t\t\tphi = 2 * Math.PI + phi;\r\n\t\t\t\tvar theta = Math.min(Math.acos(lpos[2]), Math.PI / 2 - 0.15);\r\n\t\t\t\t\t\r\n\t\t\t\tvar cosPhi = Math.cos(phi);\r\n\t\t\t\tvar cosTheta = Math.cos(theta);\r\n\t\t\t\tvar cosTheta2 = cosTheta * cosTheta;\r\n\t\t\t\t\r\n\t\t\t\tvar lweights = new Array(9);\r\n\t\t\t\tlweights[0] = 1.0 / Math.sqrt(2.0 * Math.PI);\r\n\t\t\t\tlweights[1] = Math.sqrt(6.0 / Math.PI) * (cosPhi * Math.sqrt(cosTheta-cosTheta2));\r\n\t\t\t\tlweights[2] = Math.sqrt(3.0 / (2.0 * Math.PI)) * (-1.0 + 2.0*cosTheta);\r\n\t\t\t\tlweights[3] = Math.sqrt(6.0 / Math.PI) * (Math.sqrt(cosTheta - cosTheta2) * Math.sin(phi));\r\n\t\t\t\t\r\n\t\t\t\tlweights[4] = Math.sqrt(30.0 / Math.PI) * (Math.cos(2.0 * phi) * (-cosTheta + cosTheta2));\r\n\t\t\t\tlweights[5] = Math.sqrt(30.0 / Math.PI) * (cosPhi*(-1.0 + 2.0 * cosTheta) * Math.sqrt(cosTheta - cosTheta2));\r\n\t\t\t\tlweights[6] = Math.sqrt(5.0 / (2.0 * Math.PI)) * (1.0 - 6.0 * cosTheta + 6.0 * cosTheta2);\r\n\t\t\t\tlweights[7] = Math.sqrt(30.0 / Math.PI) * ((-1.0 + 2.0 * cosTheta) * Math.sqrt(cosTheta - cosTheta2) * Math.sin(phi));\r\n\t\t\t\tlweights[8] = Math.sqrt(30.0 / Math.PI) * ((-cosTheta + cosTheta2) * Math.sin(2.*phi));\r\n\t\t\t\treturn lweights;\r\n\t\t\tcase 2:\r\n\t\t\tcase 3:\r\n\t\t\t\tvar lweights = new Array(6);\r\n\t\t\t\tlweights[0] = lpos[0] * lpos[0];\r\n\t\t\t\tlweights[1] = lpos[1] * lpos[1];\r\n\t\t\t\tlweights[2] = lpos[0] * lpos[1];\r\n\t\t\t\tlweights[3] = lpos[0];\r\n\t\t\t\tlweights[4] = lpos[1];\r\n\t\t\t\tlweights[5] = 1.0;\r\n\t\t\t\treturn lweights;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t\treturn [];\r\n\t},\r\n\t\r\n\t\r\n\tloadImage: function(url)\r\n\t{\r\n\t\tvar xhttp=new XMLHttpRequest();\r\n\t\tvar targetURL = null;\r\n\t\tif(typeof url === \"string\") {\r\n\t\t\ttargetURL = url + \"/info.xml\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttargetURL = url(\"/info.xml\");\r\n\t\t}\r\n\t\txhttp.overrideMimeType('text/xml');\r\n\t\txhttp.open(\"GET\", targetURL, false);\r\n\t\txhttp.send();\r\n\r\n\t\tvar doc = xhttp.responseXML;\r\n\t\tthis.format = \"jpg\";\r\n\t\tvar val = parseInt(doc.getElementsByTagName(\"MultiRes\")[0].getAttribute(\"format\"));\r\n\t\tif (!isNaN(val))\r\n\t\t\tif (val == 1)\r\n\t\t\t\tthis.format = \"png\";\r\n\t\tvar content = doc.getElementsByTagName(\"Content\")[0];\r\n\t\tthis.type = content.getAttribute(\"type\");\r\n\t\tif (!(this.type in this.enumType))\r\n\t\t\treturn false;\r\n\t\tvar tree = null;\r\n\t\tswitch (this.enumType[this.type])\r\n\t\t{\r\n\t\t\tcase 1:\r\n\t\t\tcase 2:\r\n\t\t\tcase 3:\r\n\t\t\t\tvar size = doc.getElementsByTagName(\"Size\")[0];\r\n\t\t\t\tvar scale = doc.getElementsByTagName(\"Scale\")[0];\r\n\t\t\t\tvar bias = doc.getElementsByTagName(\"Bias\")[0];\r\n\t\t\t\ttree = doc.getElementsByTagName(\"Tree\")[0];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tthis.imgWidth = parseInt(size.getAttribute(\"width\"));\r\n\t\t\t\tthis.imgHeight = parseInt(size.getAttribute(\"height\"));\r\n\t\t\t\tthis.ordlen = parseInt(size.getAttribute(\"coefficients\"));\r\n\t\t\t\tthis.numLayers = this.ordlen;\r\n\t\t\t\tif (this.enumType[this.type] == 2)\r\n\t\t\t\t\tthis.numLayers = 3;\r\n\t\t\t\ttokens = scale.childNodes[0].nodeValue.split(\" \");\r\n\t\t\t\tif (tokens.length < this.ordlen) return;\r\n\t\t\t\tthis.gmax = [];\r\n\t\t\t\tfor (var j = 0; j < this.ordlen; j++ )\r\n\t\t\t\t\tthis.gmax[j] = parseFloat(tokens[j]);\r\n\t\t\t\t\t\t\r\n\t\t\t\ttokens = bias.childNodes[0].nodeValue.split(\" \");\r\n\t\t\t\tif (tokens.length < this.ordlen) return;\r\n\t\t\t\tthis.gmin = [];\r\n\t\t\t\tfor (var j = 0; j < this.ordlen; j++ )\r\n\t\t\t\t\tthis.gmin[j] = parseFloat(tokens[j]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tvar size = doc.getElementsByTagName(\"Size\")[0];\r\n\t\t\t\ttree = doc.getElementsByTagName(\"Tree\")[0];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tthis.imgWidth = parseInt(size.getAttribute(\"width\"));\r\n\t\t\t\tthis.imgHeight = parseInt(size.getAttribute(\"height\"));\r\n\t\t\t\tthis.ordlen = parseInt(size.getAttribute(\"coefficients\"));\r\n\t\t\t\tthis.numLayers = this.ordlen;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn;\t\t\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tif (this._tree)\r\n\t\t\tthis._tree.destroy(this._destroyData);\r\n\t\t\r\n\t\tthis._tree.load(tree.textContent, this.imgWidth, this.imgHeight);\r\n\t\t\r\n\t\tthis._url  = url;\r\n\t\tthis._timestamp = 0;\r\n\t\tthis._frustum = new SglFrustum();\r\n\t\tthis._maxError = 1.0;\r\n\t\tthis._cache = [ ];\r\n\t\tthis._toRequest = [ ];\r\n\t\tthis._toRenderFullRes = [ ];\r\n\t\tthis._toRenderHalfRes = [ ];\r\n\t\tthis._readyItems = [ ];\r\n\r\n\t\tthis.renderData  = true;\r\n\t\tthis.renderBoxes = false;\r\n\t\t\r\n\t\t//var lpos = [0.241844, 0.241844, 0.939692]\r\n\t\t//lpos = sglNormalizedV3(lpos);\r\n\t\t//this.lightPos = lpos.slice(0, 3);\r\n\t\tthis.lightPos    = [ 0.0, 0.0, 1.0 ];\r\n\t\tthis.lweights \t = [];\r\n\t\tthis.lweights \t = this.computeLightingFunction(this.lightPos);\r\n\t\tif (this._program != null)\r\n\t\t\tthis._program.destroy();\r\n\t\tswitch (this.enumType[this.type])\r\n\t\t{\r\n\t\t\tcase 1:\r\n\t\t\t\tvar vs = sglLoadFile(\"/assets/webViewer/spidergl/multi.v.glsl\");\r\n\t\t\t\tvar fs = sglLoadFile(\"/assets/webViewer/spidergl/hsh.f.glsl\");\r\n\t\t\t\tvar prg = new SglProgram(this.gl, [vs], [fs]);\r\n\t\t\t\tlog(prg.log);\r\n\t\t\t\tthis._program  = prg;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tvar vs = sglLoadFile(\"/assets/webViewer/spidergl/multi.v.glsl\");\r\n\t\t\t\tvar fs = sglLoadFile(\"/assets/webViewer/spidergl/lrgbptm.f.glsl\");\r\n\t\t\t\tvar prg = new SglProgram(this.gl, [vs], [fs]);\r\n\t\t\t\tlog(prg.log);\r\n\t\t\t\tthis._program  = prg;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tvar vs = sglLoadFile(\"/assets/webViewer/spidergl/multi.v.glsl\");\r\n\t\t\t\tvar fs = sglLoadFile(\"/assets/webViewer/spidergl/rgbptm.f.glsl\");\r\n\t\t\t\tvar prg = new SglProgram(this.gl, [vs], [fs]);\r\n\t\t\t\tlog(prg.log);\r\n\t\t\t\tthis._program  = prg;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tvar vs = sglLoadFile(\"/assets/webViewer/spidergl/multi.v.glsl\");\r\n\t\t\t\tvar fs = sglLoadFile(\"/assets/webViewer/spidergl/image.f.glsl\");\r\n\t\t\t\tvar prg = new SglProgram(this.gl, [vs], [fs]);\r\n\t\t\t\tlog(prg.log);\r\n\t\t\t\tthis._program  = prg;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis._program = new SglProgram();\r\n\t\t}\r\n\t\tthis._renderer = new SglMeshGLRenderer(this._program);\r\n\t\tthis._treeTransform = sglIdentityM4();\r\n\t\tthis._normalizedTreeTransform = sglIdentityM4();\r\n\t\t\r\n\t\tthis.leftTex = (this._tree.scale[0] - this.imgWidth) / 2.0; \r\n\t\tthis.rightTex = this.leftTex + this.imgWidth; \r\n\t\t\r\n\t\tthis.bottomTex = (this._tree.scale[1] - this.imgHeight) / 2.0; \r\n\t\tthis.topTex = this.bottomTex + this.imgHeight;\r\n\t\tthis.leftTex /= this._tree.scale[0];\r\n\t\tthis.rightTex /= this._tree.scale[0];\r\n\t\t\r\n\t\tthis.bottomTex /= this._tree.scale[1];\r\n\t\tthis.topTex /= this._tree.scale[1];\r\n\t\t\r\n\t\tif (this._tree.ready) \r\n\t\t\tthis._setupTree();\r\n\t},\r\n\r\n\r\n\t_createLg: function()\r\n\t{\r\n\t\tvar canvas=document.createElement(\"canvas\");\r\n\t\tcanvas.height = 50;\r\n\t\tcanvas.width = 80;\r\n\t\tvar ctx = canvas.getContext(\"2d\");\r\n\t\tctx.save();\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(0,0);\r\n\t\tctx.lineTo(80,0);\r\n\t\tctx.lineTo(80,50);\r\n\t\tctx.lineTo(0,50);\r\n\t\tctx.closePath();\r\n\t\tctx.clip();\r\n\t\tctx.strokeStyle = 'rgba(0,0,0,0)';\r\n\t\tctx.lineCap = 'butt';\r\n\t\tctx.lineJoin = 'miter';\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.save();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.transform(0.21814175,0,0,0.21573678,-3.3721339,-3.3665838);\r\n\t\tctx.save();\r\n\t\tctx.translate(14.071762,20);\r\n\t\tctx.save();\r\n\t\tg=ctx.createRadialGradient(239.50893,204.66128888494003,0,239.50893,204.66128888494003,31.820419);\r\n\t\tg.addColorStop(0,\"rgba(255, 255, 255, 1)\");\r\n\t\tg.addColorStop(1,\"rgba(151, 151, 151, 1)\");\r\n\t\tctx.fillStyle = g;\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 2.4923694133758545;\r\n\t\tctx.lineCap = \"round\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.transform(2.1234583,0,0,1.6108995,-256.37574,-264.34719);\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(271.42857,233.79076);\r\n\t\tctx.translate(240,233.80553976769053);\r\n\t\tctx.rotate(0);\r\n\t\tctx.scale(0.7586207296076113,1);\r\n\t\tctx.arc(0,0,41.42857,-0.00035675303306008355,3.1419494066230014,0);\r\n\t\tctx.scale(1.318181748760332,1);\r\n\t\tctx.rotate(0);\r\n\t\tctx.translate(-240,-233.80553976769053);\r\n\t\tctx.translate(240,233.77598023230948);\r\n\t\tctx.rotate(0);\r\n\t\tctx.scale(0.7586207296076113,1);\r\n\t\tctx.arc(0,0,41.42857,3.141235900556733,6.2835420602127945,0);\r\n\t\tctx.scale(1.318181748760332,1);\r\n\t\tctx.rotate(0);\r\n\t\tctx.translate(-240,-233.77598023230948);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.fillStyle = \"#ececec\";\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 4.609655857086182;\r\n\t\tctx.lineCap = \"butt\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(49.495605,44.507569);\r\n\t\tctx.lineTo(129.49561,79.507569);\r\n\t\tctx.lineTo(209.49561,44.507569);\r\n\t\tctx.lineTo(49.495605,44.507569);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.fillStyle = \"#999999\";\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 4.609655857086182;\r\n\t\tctx.lineCap = \"butt\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(129.49561,174.50757);\r\n\t\tctx.lineTo(129.49561,79.507572);\r\n\t\tctx.lineTo(209.49561,44.507572);\r\n\t\tctx.lineTo(129.49561,174.50757);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.fillStyle = \"#b3b3b3\";\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 4.609655857086182;\r\n\t\tctx.lineCap = \"butt\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(129.49561,174.50757);\r\n\t\tctx.lineTo(129.49561,79.507569);\r\n\t\tctx.lineTo(49.495605,44.507569);\r\n\t\tctx.lineTo(129.49561,174.50757);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tg=ctx.createLinearGradient(236.58487,196.44904,257.4877,320.66739);\r\n\t\tg.addColorStop(0,\"rgba(255, 255, 255, 1)\");\r\n\t\tg.addColorStop(1,\"rgba(151, 151, 151, 1)\");\r\n\t\tctx.fillStyle = g;\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 3.3579113483428955;\r\n\t\tctx.lineCap = \"round\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.transform(1.4965962,0,0,1.2591977,-86.218969,-182.0266);\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(271.42857,233.79076);\r\n\t\tctx.translate(240,233.80553976769053);\r\n\t\tctx.rotate(0);\r\n\t\tctx.scale(0.7586207296076113,1);\r\n\t\tctx.arc(0,0,41.42857,-0.00035675303306008355,3.1419494066230014,0);\r\n\t\tctx.scale(1.318181748760332,1);\r\n\t\tctx.rotate(0);\r\n\t\tctx.translate(-240,-233.80553976769053);\r\n\t\tctx.translate(240,233.77598023230948);\r\n\t\tctx.rotate(0);\r\n\t\tctx.scale(0.7586207296076113,1);\r\n\t\tctx.arc(0,0,41.42857,3.141235900556733,6.2835420602127945,0);\r\n\t\tctx.scale(1.318181748760332,1);\r\n\t\tctx.rotate(0);\r\n\t\tctx.translate(-240,-233.77598023230948);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.restore();\r\n\t\tctx.restore();\r\n\t\tctx.restore();\r\n\t\tvar image = new Image();\r\n\t\tvar dataURL = canvas.toDataURL(\"image/png\");\r\n\t\t// image.crossOrigin = '';\r\n\t\timage.src = dataURL;\r\n\r\n\t\tvar that = this;\r\n\t\timage.onload = function() \r\n\t\t\t\t\t\t{ \r\n\t\t\t\t\t\t\tvar texOpt =\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tgenerateMipmap  : false,\r\n\t\t\t\t\t\t\t\tminFilter       : that.gl.NEAREST,\r\n\t\t\t\t\t\t\t\tmagFilter \t\t: that.gl.NEAREST,\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tthat.lgtex = new SglTexture2D(that.gl, image, texOpt);\r\n\t\t\t\t\t\t}\r\n\t\t\r\n\t\t\r\n\t\tvar error = this.gl.getError();\r\n\t\tconsole.log(error);\r\n\t},\r\n\r\n\r\n\t_createData : function(colorImgs)\r\n\t{\r\n\t\tvar colorTexOpts = {\r\n\t\t\tminFilter : this.gl.LINEAR,\r\n\t\t\tmagFilter : this.gl.LINEAR,\r\n\t\t\tgenerateMipmap : false\r\n\t\t};\r\n\r\n\t\tvar dataTextures = new Array(colorImgs.length);\r\n\t\tfor (var i=0; i < colorImgs.length; ++i) \r\n\t\t\tdataTextures[i] = new SglTexture2D(this.gl, colorImgs[i], colorTexOpts);\r\n\r\n\t\tvar data = {\r\n\t\t\ttextures : dataTextures\r\n\t\t};\r\n\r\n\t\treturn data;\r\n\t},\r\n\r\n\t\r\n\t_destroyData : function(data) \r\n\t{\r\n\t\tif (!data) return;\r\n\t\tfor (var i = 0; i < data.textures.length; ++i) \r\n\t\t\tdata.textures[i].destroy();\r\n\t\t\r\n\t\tdata.textures = null;\r\n\t},\r\n\r\n\t\r\n\t_requestNode : function(n)\r\n\t{\r\n\t\tif (n.req) return;\r\n\r\n\t\tvar that  = this;\r\n\t\tif(typeof this._url === \"string\") {\r\n\t\t\tvar url   = this._url + \"/\" + n.id;\t\r\n\t\t}\r\n\t\t\r\n\r\n\t\tvar requests = new Array();\r\n\r\n\t\tfor (var i = 1; i <= this.numLayers; i++) {\r\n\t\t\tif(typeof this._url === \"string\") {\r\n\t\t\t\tvar targetURL   = url + \"_\" + i + \".\" + this.format;\t\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar targetURL = this._url(\"/\" + n.id + \"_\" + i + \".\" + this.format)\r\n\t\t\t}\r\n\t\t\r\n\t\t\trequests.push(new SglImageRequest(targetURL));\r\n\t\t}\r\n\r\n\t\tvar watcher = new SglRequestWatcher(requests, function(w) {\r\n\t\t\tthat._currentOngoingRequests--;\r\n\t\t\tthat._readyItems.push(n);\r\n\t\t});\r\n\t\tn.req = watcher;\r\n\t\twatcher.send();\r\n\t},\r\n\r\n\t\r\n\t_collectNodesRec : function(n, parentFullyVisible)\r\n\t{\r\n\t\tvar result = {\r\n\t\t\tneeded : false,\r\n\t\t\tusable : ((n.data) ? (true) : (false))\r\n\t\t};\r\n\r\n\t\tif (n.zScale == 0)\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// test visibility only if parent is not completely inside frustum\r\n\t\tif (!parentFullyVisible) \r\n\t\t{\r\n\t\t\tvar visStatus = this._frustum.boxVisibility(n.box.min, n.box.max);\r\n\t\t\tif (visStatus == SGL_OUTSIDE_FRUSTUM) return result;\r\n\t\t\tparentFullyVisible = (visStatus == SGL_INSIDE_FRUSTUM);\r\n\t\t}\r\n\r\n\t\t// node is visible and thus needed\r\n\t\tresult.needed = true;\r\n\r\n\t\t// calculate error\r\n\t\tvar prjSize = this._frustum.projectedSegmentSize(n.box.center, n.box.size[0]);\r\n\t\tvar error   = prjSize / n.projectedSize;\r\n\r\n\t\tn.priority.timestamp = this._timestamp;\r\n\t\tn.priority.error     = error;\r\n\r\n\t\t// if node data is not available, request node and return\r\n\t\tif (!result.usable) \r\n\t\t{\r\n\t\t\tif (!n.req)\r\n\t\t\t{\r\n\t\t\t\tthis._toRequest.push(n);\r\n\t\t\t\t//this._toRequest[n.id] = n;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// if node is below error, render it in full resolution and return\r\n\t\tif ((error < this._maxError) || n.isLeaf)\r\n\t\t{\r\n\t\t\tthis._toRenderFullRes.push(n);\r\n\t\t\t//this._toRenderFullRes[n.id] = n;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// recurse down to children\r\n\t\tvar c = null;\r\n\t\tvar neededCount = 0;\r\n\t\tvar usableCount = 0;\r\n\t\tvar cr = null;\r\n\t\tvar missingChildren = [ ];\r\n\r\n\t\tfor (var i = 0; i < 4; ++i)\r\n\t\t{\r\n\t\t\tc = this._tree.child(n, i);\r\n\t\t\tif (!c) continue;\r\n\t\t\tcr = this._collectNodesRec(c, parentFullyVisible);\r\n\t\t\tif (cr.usable) usableCount++;\r\n\t\t\tif (cr.needed)\r\n\t\t\t{\r\n\t\t\t\tneededCount++;\r\n\t\t\t\tif (!cr.usable)\r\n\t\t\t\t{\r\n\t\t\t\t\tmissingChildren.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//_MultiResAssert(neededCount > 0);\r\n\r\n\t\tif (neededCount > 0) \r\n\t\t{\r\n\t\t\tif (usableCount <= 0)\r\n\t\t\t{\r\n\t\t\t\t// no needed child is available, render node in full resolution\r\n\t\t\t\tthis._toRenderFullRes.push(n);\r\n\t\t\t\t//this._toRenderFullRes[n.id] = n;\r\n\t\t\t}\r\n\t\t\telse if (missingChildren.length > 0)\r\n\t\t\t{\r\n\t\t\t\t// some child is needed but not usable, render their sectors in half resolution (wrt this node)\r\n\t\t\t\tthis._toRenderHalfRes.push({ n: n, children: missingChildren });\r\n\t\t\t\t//this._toRenderHalfRes[n.id] = { n: n, missingChildren: missingChildren };\r\n\t\t\t}\r\n\t\t\t// else all needed children can be rendered\r\n\t\t}\r\n\r\n\t\t// the node is needed and available\r\n\t\treturn result;\r\n\t},\r\n\r\n\t\r\n\t_collectNodes : function() \r\n\t{\r\n\t\tthis._toRequest = [ ];\r\n\t\tthis._toRenderFullRes = [ ];\r\n\t\tthis._toRenderHalfRes = [ ];\r\n\r\n\t\tvar root = this._tree.root;\r\n\t\tif (!root) return;\r\n\r\n\t\tthis._collectNodesRec(root, false);\r\n\t},\r\n\r\n\t\r\n\t_renderNodeFullRes : function(n)\r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_world_box_min : n.box.min,\r\n\t\t\tu_world_box_max : n.box.max\r\n\t\t};\r\n\r\n\t\tvar samplers = [];\r\n\t\tfor (var i = 0; i < this.numLayers; i++)\r\n\t\t\tsamplers['coeff' + i] = n.data.textures[i];\r\n\t\t\r\n\t\tthis._renderer.setUniforms(uniforms);\r\n\t\tthis._renderer.setSamplers(samplers);\r\n\t\tthis._renderer.render();\r\n\t},\r\n\r\n\t_renderNodesFullRes : function(mvp)\r\n\t{\r\n\t\tvar mesh = null;\r\n\t\tvar primitives = null;\r\n\r\n\t\tmesh = this._tileFullMesh;\r\n\t\tprimitives = \"tristrip\";\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tu_model_view_projection_matrix : mvp,\r\n\t\t\tu_scale_bias                   : [ 1.0, 1.0, 0.0, 0.0 ],\r\n\t\t\tu_texcoord_scale_bias          : [ (this._tree.tileSize / (this._tree.tileSize + 2.0)), (1.0 / (this._tree.tileSize + 2.0)) ],\r\n\t\t\tordlen\t\t\t\t\t\t   : this.ordlen,\r\n\t\t\tleftTex                        : this.leftTex,\r\n\t\t\trightTex                       : this.rightTex,\r\n\t\t\tbottomTex                      : this.bottomTex,\r\n\t\t\ttopTex                         : this.topTex\r\n\t\t}\r\n\t\t\r\n\t\tif (this.enumType[this.type] != 4)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < this.ordlen; i++)\r\n\t\t\t{\r\n\t\t\t\tuniforms['gmax' + i] = this.gmax[i];\r\n\t\t\t\tuniforms['gmin' + i] = this.gmin[i];\r\n\t\t\t\tuniforms['lweight' + i] = this.lweights[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis._renderer.begin();\r\n\t\t\tthis._renderer.setUniforms(uniforms);\r\n\t\t\tthis._renderer.beginMesh(mesh);\r\n\t\t\t\tthis._renderer.beginPrimitives(primitives);\r\n\t\t\t\tvar n = null;\r\n\t\t\t\tfor (var i in this._toRenderFullRes)\r\n\t\t\t\t{\r\n\t\t\t\t\tn = this._toRenderFullRes[i];\r\n\t\t\t\t\tthis._renderNodeFullRes(n);\r\n\t\t\t\t}\r\n\t\t\t\tthis._renderer.endPrimitives();\r\n\t\t\tthis._renderer.endMesh();\r\n\t\tthis._renderer.end();\r\n\t},\r\n\r\n\t_renderNodeHalfRes : function(n, children)\r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_world_box_min : null,\r\n\t\t\tu_world_box_max : null,\r\n\t\t\tu_scale_bias    : null\r\n\t\t};\r\n\r\n\t\tvar samplers = [];\r\n\t\tfor (var i = 0; i < this.numLayers; i++)\r\n\t\t\tsamplers['coeff' + i] = n.data.textures[i];\r\n\t\t\r\n\t\tthis._renderer.setSamplers(samplers);\r\n\r\n\t\tvar scaleBias = [\r\n\t\t\t[ 0.5, 0.5, 0.0, 0.0 ],\r\n\t\t\t[ 0.5, 0.5, 0.5, 0.0 ],\r\n\t\t\t[ 0.5, 0.5, 0.0, 0.5 ],\r\n\t\t\t[ 0.5, 0.5, 0.5, 0.5 ]\r\n\t\t];\r\n\r\n\t\tvar c = null;\r\n\t\tfor (var i in children)\r\n\t\t{\r\n\t\t\tc = this._tree.child(n, children[i]);\r\n\t\t\tuniforms.u_world_box_min = c.box.min;\r\n\t\t\tuniforms.u_world_box_max = c.box.max;\r\n\t\t\tuniforms.u_scale_bias    = scaleBias[children[i]];\r\n\t\t\tthis._renderer.setUniforms(uniforms);\r\n\t\t\tthis._renderer.render();\r\n\t\t}\r\n\t},\r\n\r\n\t_renderNodesHalfRes : function(mvp)\r\n\t{\r\n\t\tvar mesh = null;\r\n\t\tvar primitives = null;\r\n\r\n\t\tmesh = this._tileHalfMesh;\r\n\t\tprimitives = \"tristrip\";\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tu_model_view_projection_matrix : mvp,\r\n\t\t\tu_texcoord_scale_bias          : [ (this._tree.tileSize / (this._tree.tileSize + 2.0)), (1.0 / (this._tree.tileSize + 2.0)) ],\r\n\t\t\tordlen\t\t\t\t\t\t   : this.ordlen,\r\n\t\t\tleftTex                        : this.leftTex,\r\n\t\t\trightTex                       : this.rightTex,\r\n\t\t\tbottomTex                      : this.bottomTex,\r\n\t\t\ttopTex                         : this.topTex\r\n\t\t}\r\n\t\t\r\n\t\tif (this.enumType[this.type] != 4)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < this.ordlen; i++)\r\n\t\t\t{\r\n\t\t\t\tuniforms['gmax' + i] = this.gmax[i];\r\n\t\t\t\tuniforms['gmin' + i] = this.gmin[i];\r\n\t\t\t\tuniforms['lweight' + i] = this.lweights[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis._renderer.begin();\r\n\t\t\tthis._renderer.setUniforms(uniforms);\r\n\t\t\tthis._renderer.beginMesh(mesh);\r\n\t\t\t\tthis._renderer.beginPrimitives(primitives);\r\n\t\t\t\tvar nc = null;\r\n\t\t\t\tfor (var i in this._toRenderHalfRes)\r\n\t\t\t\t{\r\n\t\t\t\t\tnc = this._toRenderHalfRes[i];\r\n\t\t\t\t\tthis._renderNodeHalfRes(nc.n, nc.children);\r\n\t\t\t\t}\r\n\t\t\t\tthis._renderer.endPrimitives();\r\n\t\t\tthis._renderer.endMesh();\r\n\t\tthis._renderer.end();\r\n\t},\r\n\r\n\t_renderNodes : function(mvp)\r\n\t{\r\n\t\tthis._renderNodesFullRes(mvp);\r\n\t\tthis._renderNodesHalfRes(mvp);\r\n\t},\r\n\r\n\t_renderNodeFullResBox : function(n) \r\n\t{\r\n\t\tvar sz = n.box.size;\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tu_world_box_min : sglAddV3S(n.box.min, sz[0] * 0.05),\r\n\t\t\tu_world_box_max : sglSubV3S(n.box.max, sz[0] * 0.05),\r\n\t\t\tu_color         : ((n.isLeaf) ? ([1.0, 0.0, 1.0]) : ([0.0, 1.0, 0.0]))\r\n\t\t};\r\n\r\n\t\tthis._boxRenderer.setUniforms(uniforms);\r\n\t\tthis._boxRenderer.render();\r\n\t},\r\n\r\n\t_renderNodesFullResBoxes : function(mvp) \r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_model_view_projection_matrix : mvp\r\n\t\t};\r\n\r\n\t\tthis._boxRenderer.begin();\r\n\t\t\tthis._boxRenderer.setUniforms(uniforms);\r\n\t\t\tthis._boxRenderer.beginMesh(this._boxMesh);\r\n\t\t\t\tthis._boxRenderer.beginPrimitives(\"edges\");\r\n\t\t\t\tvar n = null;\r\n\t\t\t\tfor (var i in this._toRenderFullRes)\r\n\t\t\t\t{\r\n\t\t\t\t\tn = this._toRenderFullRes[i];\r\n\t\t\t\t\tthis._renderNodeFullResBox(n);\r\n\t\t\t\t}\r\n\t\t\t\tthis._boxRenderer.endPrimitives();\r\n\t\t\tthis._boxRenderer.endMesh();\r\n\t\tthis._boxRenderer.end();\r\n\t},\r\n\r\n\t_renderNodeHalfResBox : function(n, children) \r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_world_box_min : null,\r\n\t\t\tu_world_box_max : null,\r\n\t\t\tu_color         : null\r\n\t\t};\r\n\r\n\t\tvar c  = null;\r\n\t\tvar sx = null;\r\n\t\tfor (var i in children)\r\n\t\t{\r\n\t\t\tc = this._tree.child(n, children[i]);\r\n\t\t\tsz = c.box.size;\r\n\t\t\tuniforms.u_world_box_min = sglAddV3S(c.box.min, sz[0] * 0.05);\r\n\t\t\tuniforms.u_world_box_max = sglSubV3S(c.box.max, sz[0] * 0.05);\r\n\t\t\tuniforms.u_color         = ((c.isLeaf) ? ([1.0, 1.0, 0.0]) : ([1.0, 1.0, 1.0]));\r\n\t\t\tthis._boxRenderer.setUniforms(uniforms);\r\n\t\t\tthis._boxRenderer.render();\r\n\t\t}\r\n\t},\r\n\r\n\t_renderNodesHalfResBoxes : function(mvp)\r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_model_view_projection_matrix : mvp\r\n\t\t};\r\n\r\n\t\tthis._boxRenderer.begin();\r\n\t\t\tthis._boxRenderer.setUniforms(uniforms);\r\n\t\t\tthis._boxRenderer.beginMesh(this._boxMesh);\r\n\t\t\t\tthis._boxRenderer.beginPrimitives(\"edges\");\r\n\t\t\t\tvar nc = null;\r\n\t\t\t\tfor (var i in this._toRenderHalfRes)\r\n\t\t\t\t{\r\n\t\t\t\t\tnc = this._toRenderHalfRes[i];\r\n\t\t\t\t\tthis._renderNodeHalfResBox(nc.n, nc.children);\r\n\t\t\t\t}\r\n\t\t\t\tthis._boxRenderer.endPrimitives();\r\n\t\t\tthis._boxRenderer.endMesh();\r\n\t\tthis._boxRenderer.end();\r\n\t},\r\n\r\n\t_renderNodesBoxes : function(mvp)\r\n\t{\r\n\t\tthis.gl.lineWidth(2.0);\r\n\t\tthis.gl.depthFunc(this.gl.LEQUAL);\r\n\t\tthis._renderNodesFullResBoxes(mvp);\r\n\t\tthis._renderNodesHalfResBoxes(mvp);\r\n\t\tthis.gl.depthFunc(this.gl.LESS);\r\n\t\tthis.gl.lineWidth(1.0);\r\n\t},\r\n\r\n\t_doRender : function(projectionMatrix, modelViewMatrix, viewport)\r\n\t{\r\n\t\tvar mv = sglMulM4(modelViewMatrix, this._treeTransform);\r\n\t\t//var mv = modelViewMatrix;\r\n\r\n\t\tthis._timestamp++;\r\n\t\tthis._frustum.setup(projectionMatrix, mv, viewport);\r\n\r\n\t\tthis._collectNodes();\r\n\t\tvar mvp = sglMulM4(projectionMatrix, mv);\r\n\r\n\t\tif (this.renderData)\r\n\t\t\tthis._renderNodes(mvp);\r\n\r\n\t\tif (this.renderBoxes) \r\n\t\t\tthis._renderNodesBoxes(mvp);\r\n\t\t\r\n\t\tif (this.lg && this.lgtex != null)\r\n\t\t{\r\n\t\t\tthis.gl.enable(this.gl.BLEND);\r\n\t\t\tthis.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\r\n\t\t\tvar mvp2 = sglMulM4(projectionMatrix, sglScalingM4C(1.0, 1.0, 1.0));\r\n\t\t\tvar quadUniforms = { u_mvp : mvp2 };\r\n\t\t\tvar quadSamplers = { s_texture : this.lgtex };\r\n\t\t\tsglRenderMeshGLPrimitives(this.lgMesh, \"tristrip\", this.texProg, null, quadUniforms, quadSamplers);\r\n\t\t\tthis.gl.disable(this.gl.BLEND);\r\n\t\t}\r\n\t\t//this.gl.finish();\r\n\t},\r\n\r\n\t_updateCache : function()\r\n\t{\r\n\t\tvar maxUpdatesPerFrame = 1;\r\n\t\tvar readyItems = this._readyItems.slice(0, maxUpdatesPerFrame);\r\n\t\tthis._readyItems.splice(0, maxUpdatesPerFrame);\r\n\r\n\t\tvar combined = this._cache.concat(readyItems);\r\n\t\tcombined.sort(_MultiResCompareNodes);\r\n\r\n\t\tvar cl = combined.length;\r\n\t\tvar k  = (this._maxCacheSize < cl) ? (this._maxCacheSize) : (cl);\r\n\r\n\t\tthis._cache = combined.splice(0, k);\r\n\t\tvar outOfCache = combined;\r\n\r\n\t\tvar n = null;\r\n\t\tvar r = null;\r\n\t\tvar failed = [ ];\r\n\r\n\t\tfor (var i=0; i<k; ++i) \r\n\t\t{\r\n\t\t\tn = this._cache[i];\r\n\t\t\tr = n.req;\r\n\t\t\tn.req = null;\r\n\r\n\t\t\tif (!r) continue;\r\n\t\t\tif (!r.succeeded)\r\n\t\t\t{\r\n\t\t\t\tfailed.push(i);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar cimgs = new Array(r.requests.length);\r\n\t\t\tfor (var i=0; i<cimgs.length; ++i)\r\n\t\t\t\tcimgs[i] = r.requests[i].image;\r\n\t\t\t\t\r\n\t\t\tif (n.data)\r\n\t\t\t\tthis._destroyData(n.data);\r\n\t\t\t\r\n\t\t\tn.data = this._createData(cimgs);\r\n\t\t}\r\n\r\n\t\tvar fc = failed.length;\r\n\t\tvar reinsertedCount = 0;\r\n\r\n\t\tk = outOfCache.length;\r\n\t\tfor (var i=0; i<k; ++i)\r\n\t\t{\r\n\t\t\tn = outOfCache[i];\r\n\t\t\tr = n.req;\r\n\t\t\tn.req = null;\r\n\r\n\t\t\tif (r) continue;\r\n\r\n\t\t\tif (reinsertedCount < fc) \r\n\t\t\t{\r\n\t\t\t\tthis._cache[failed[reinsertedCount]] = n;\r\n\t\t\t\treinsertedCount++;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis._destroyData(n.data);\r\n\t\t\t\tn.data = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (reinsertedCount > 0) \r\n\t\t\tthis._cache.sort(_MultiResCompareNodes);\r\n\t},\r\n\r\n\t\r\n\t_requestNodes : function() \r\n\t{\r\n\t\tvar cs = this._cache.length;\r\n\t\tvar lastItem = (cs > 0) ? (this._cache[cs-1]) : (null);\r\n\r\n\t\tthis._toRequest.sort(_MultiResCompareNodes);\r\n\t\tvar requestableCount = this._maxOngoingRequests - this._currentOngoingRequests;\r\n\r\n\t\tvar requested = 0;\r\n\t\tvar k = this._toRequest.length;\r\n\t\tvar n = null;\r\n\t\tvar canRequest = false;\r\n\r\n\t\tfor (var i=0; ((i<k) && (requested<requestableCount)); ++i) \r\n\t\t{\r\n\t\t\tn = this._toRequest[i];\r\n\t\t\tif (n.req) continue; // ongoing;\r\n\r\n\t\t\tcanRequest = true;\r\n\t\t\tif ((lastItem != null) && (cs >= this._maxCacheSize)) \r\n\t\t\t\tcanRequest = (_MultiResCompareNodes(n, lastItem) < 0);\r\n\t\t\t\r\n\t\t\tif (canRequest)\r\n\t\t\t{\r\n\t\t\t\tthis._requestNode(n);\r\n\t\t\t\trequested++\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t\r\n\t_calculateNormalizedTreeTransform : function() \r\n\t{\r\n\t\tvar root = this._tree.root;\r\n\t\tif (!root) return sglIdentityM4();\r\n\r\n\t\tvar rbox = new SglBox3();\r\n\t\trbox.min = sglAddV3(sglMulV3(root.box.min, this._tree.scale), this._tree.offset);\r\n\t\trbox.max = sglAddV3(sglMulV3(root.box.max, this._tree.scale), this._tree.offset);\r\n\t\t//rbox = root.box;\r\n\r\n\t\tthis._treeTransform = sglMulM4(sglTranslationM4V(this._tree.offset), sglScalingM4V(this._tree.scale));\r\n\t\t//this._treeTransform = sglIdentityM4();\r\n\r\n\t\tvar bc = rbox.center;\r\n\t\tvar bs = rbox.size;\r\n\r\n\t\tvar maxDim = bs[0];\r\n\t\tif (maxDim < bs[1]) maxDim = bs[1];\r\n\t\tif (maxDim < bs[2]) maxDim = bs[2];\r\n\r\n\t\tvar scale = (maxDim > 0.0) ? (1.0 / maxDim) : (1.0);\r\n\r\n\t\tvar s = sglScalingM4C(scale, scale, scale);\r\n\t\tvar t = sglTranslationM4C(-bc[0], -bc[1], -bc[2]);\r\n\r\n\t\tvar xform = sglMulM4(s, t);\r\n\t\tthis._normalizedTreeTransform = xform;\r\n\t\t/*\r\n\t\t//var r  = sglRotationAngleAxisM4C(sglDegToRad(-90.0), 1.0, 0.0, 0.0);\r\n\t\tvar r  = sglIdentityM4();\r\n\t\tvar t1 = sglTranslationM4C(0.0, 0.0, bs[2] / 2.0 * scale);\r\n\t\tvar s  = sglScalingM4C(scale, scale, scale);\r\n\t\tvar t2 = sglTranslationM4C(-bc[0], -bc[1], -bc[2]);\r\n\t\tthis._normalizedTreeTransform = sglMulM4(r, sglMulM4(t1, sglMulM4(s, t2)));\r\n\t\t*/\r\n\t},\r\n\r\n\t_setupTree : function() \r\n\t{\r\n\t\tvar root = this._tree.root;\r\n\t\tif (!root) return;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tvar csize = ((this._tree.tileSize + 2) * (this._tree.tileSize + 2)) * this.ordlen * 3;\r\n\r\n\t\tthis._maxCacheSize = sglFloor(this._cacheSizeInBytes / (csize));\r\n\t\tif (this._maxCacheSize <= 0) this._maxCacheSize = 1;\r\n\r\n\t\tvar quadPositions = new Float32Array([\r\n\t\t\t-0.5,  0.5,\r\n\t\t\t-0.5, -0.5,\r\n\t\t\t 0.5,  0.5,\r\n\t\t\t 0.5, -0.5\r\n\t\t]);\r\n\r\n\t\tvar quadMesh = new SglMeshGL(gl);\r\n\t\tquadMesh.addVertexAttribute(\"position\", 2, quadPositions);\r\n\t\tquadMesh.addArrayPrimitives(\"tristrip\", gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n\t\tthis._tileFullMesh = quadMesh;\r\n\t\tthis._tileHalfMesh = quadMesh;\r\n\r\n\t\tthis._calculateNormalizedTreeTransform();\r\n\t},\r\n\r\n\t\r\n\trender : function(projectionMatrix, modelViewMatrix, viewport)\r\n\t{\r\n\t\tif (!this._tree.root) return;\r\n\r\n\t\tthis._doRender(projectionMatrix, modelViewMatrix, viewport);\r\n\t\tif (this.updateData)\r\n\t\t{\r\n\t\t\tthis._updateCache();\r\n\t\t\tthis._requestNodes();\r\n\t\t}\r\n\t},\r\n\r\n\t\r\n\tget normalizedTreeTransform() \r\n\t{\r\n\t\treturn this._normalizedTreeTransform;\r\n\t}\r\n};\r\n"]}