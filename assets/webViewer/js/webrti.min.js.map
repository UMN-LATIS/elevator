{"version":3,"sources":["spidergl.js","multires_min.js"],"names":["sglUnknown","Error","sglUnsupported","sglUnimplemented","sglInvalidParameter","sglInvalidCall","sglDefineConstant","ClassName","constantName","constantValue","sglInherit","DerivedClassName","BaseClassName","prototype","constructor","sglInitialize","sglFinalize","sglNodeText","domNodeID","node","document","getElementById","str","n","firstChild","nodeType","textContent","nextSibling","sglLoadFile","url","callback","async","req","XMLHttpRequest","onreadystatechange","readyState","responseText","open","send","ret","sglGetLines","text","allLines","split","length","lines","line","i","replace","push","SglRequest","onReadyCallback","this","_priority","_status","SGL_REQUEST_IDLE","_queue","_onReady","addOnReadyCallback","SglTextFileRequest","apply","Array","slice","call","arguments","_url","_req","Object","defineProperty","get","SglImageRequest","_img","SglRequestWatcher","reqs","_waitingReqs","_succeededReqs","_failedReqs","_reqs","t","cb","r","succeeded","failed","isReady","SglRequestQueue","maxOngoing","maxQueued","_maxOngoing","_maxQueued","_ongoing","_queued","_minPriorityReq","_priorityCompare","_dirty","sglAbs","x","Math","abs","sglFloor","floor","sglCeil","ceil","sglSqrt","sqrt","sglPow","y","pow","sglLog","log","sglExp","exp","sglSin","sin","sglAsin","asin","sglCos","cos","sglAcos","acos","sglTan","tan","sglAtan","atan","sglAtan2","atan2","sglDegToRad","SGL_PI","sglRadToDeg","sglMin","a","b","min","sglMax","max","sglClamp","sglRandom01","random","sglMapVN","vArray","size","f","param","first","count","stride","undefined","last","v","k","j","sglMapV2","v2Array","sglMapV3","v3Array","sglMapV4","v4Array","sglUndefV2","sglV2V","sglV2S","s","sglV2C","sglZeroV2","sglOneV2","sglV2","sglDupV2","sglNegV2","sglAddV2","u","sglAddV2S","sglAddSV2","sglSubV2","sglSubV2S","sglSubSV2","sglMulV2","sglMulV2S","sglMulSV2","sglDivV2","sglDivV2S","sglDivSV2","sglRcpV2","sglDotV2","sglCrossV2","sglSqLengthV2","sglLengthV2","sglNormalizedV2","sglSelfNegV2","sglSelfAddV2","sglSelfAddV2S","sglSelfAddSV2","sglSelfSubV2","sglSelfSubV2S","sglSelfSubSV2","sglSelfMulV2","sglSelfMulV2S","sglSelfMulSV2","sglSelfDivV2","sglSelfDivV2S","sglSelfDivSV2","sglSelfRcpV2","sglSelfNormalizeV2","sglMinV2","sglMaxV2","sglV2toV3","z","sglV3C","sglV2toV4","w","sglV4C","sglUndefV3","sglV3V","sglV3S","sglZeroV3","sglOneV3","sglV3","sglDupV3","sglNegV3","sglAddV3","sglAddV3S","sglAddSV3","sglSubV3","sglSubV3S","sglSubSV3","sglMulV3","sglMulV3S","sglMulSV3","sglDivV3","sglDivV3S","sglDivSV3","sglRcpV3","sglDotV3","sglCrossV3","sglSqLengthV3","sglLengthV3","sglNormalizedV3","sglSelfNegV3","sglSelfAddV3","sglSelfAddV3S","sglSelfAddSV3","sglSelfSubV3","sglSelfSubV3S","sglSelfSubSV3","sglSelfMulV3","sglSelfMulV3S","sglSelfMulSV3","sglSelfDivV3","sglSelfDivV3S","sglSelfDivSV3","sglSelfRcpV3","sglSelfCrossV3","sglSelfNormalizeV3","sglMinV3","sglMaxV3","sglV3toV2","sglV3toV4","sglUndefV4","sglV4V","sglV4S","sglZeroV4","sglOneV4","sglV4","sglDupV4","sglNegV4","sglAddV4","sglAddV4S","sglAddSV4","sglSubV4","sglSubV4S","sglSubSV4","sglMulV4","sglMulV4S","sglMulSV4","sglDivV4","sglDivV4S","sglDivSV4","sglRcpV4","sglDotV4","sglSqLengthV4","sglLengthV4","sglNormalizedV4","sglProjectV4","sglSelfNegV4","sglSelfAddV4","sglSelfAddV4S","sglSelfAddSV4","sglSelfSubV4","sglSelfSubV4S","sglSelfSubSV4","sglSelfMulV4","sglSelfMulV4S","sglSelfMulSV4","sglSelfDivV4","sglSelfDivV4S","sglSelfDivSV4","sglSelfRcpV4","sglSelfNormalizeV4","sglSelfProjectV4","sglMinV4","sglMaxV4","sglV4toV2","sglV4toV3","sglUndefM4","sglM4V","sglM4S","m","sglDiagM4V","d","sglDiagM4S","sglDiagM4C","m00","m11","m22","m33","sglZeroM4","sglOneM4","sglIdentityM4","sglM4","sglDupM4","sglGetElemM4","row","col","sglSetElemM4","value","sglGetRowM4","sglSetRowM4V","sglSetRowM4S","sglSetRowM4C","sglGetColM4","c","sglSetColM4V","sglSetColM4S","sglSetColM4C","sglM4toM3","sglIsIdentityM4","sglNegM4","sglAddM4","sglAddM4S","sglAddSM4","sglSubM4","sglSubM4S","sglSubSM4","sglMulM4","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","a11","a12","a13","a14","a15","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15","sglMulM4S","sglMulSM4","sglMulM4V3","sglMulM4V4","sglDivM4S","sglDivSM4","sglRcpM4","sglCompMulM4","sglCompDivM4","sglTransposeM4","sglDeterminantM4","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m12","m13","m14","m15","sglInverseM4","sglTraceM4","sglTranslationM4V","sglTranslationM4C","sglTranslationM4S","sglRotationAngleAxisM4V","angleRad","axis","xx","yy","zz","xy","yz","zx","xs","ys","zs","ax","q","sglRotationAngleAxisM4C","ay","az","sglScalingM4V","sglScalingM4C","sglScalingM4S","sglLookAtM4V","position","target","up","sglLookAtM4C","positionX","positionY","positionZ","targetX","targetY","targetZ","upX","upY","upZ","sglOrthoM4V","omin","omax","sum","dif","sglOrthoM4C","left","right","bottom","top","zNear","zFar","sglFrustumM4V","fmin","fmax","sglFrustumM4C","sglPerspectiveM4","fovYRad","aspectRatio","pmin","pmax","sglUndefQuat","sglQuatV","sglIdentityQuat","sglAngleAxisQuat","halfAngle","fsin","sglM4Quat","trace","root","sglGetQuatAngleAxis","sqLen","invLen","aglAcos","sglGetQuatRotationM4","tx","ty","tz","twx","twy","twz","txx","txy","txz","tyy","tyz","tzz","sglNormalizedQuat","sglMulQuat","q1","q2","p","SglVec2","setVec","setScalar","setZero","SglVec3","SglVec4","SglPlane3","normal","offset","normalize","_normal","_offset","setup","SglBox3","_min","_max","SglSphere3","center","radius","_center","_radius","SglMatrixStack","_s","_n","SglTransformStack","_ms","_vs","_ps","_SglFrustumPlane","testVertex","SglFrustum","projectionMatrix","modelViewMatrix","viewport","_mvpMatrix","_viewport","_vp","_billboardMatrix","_planes","sglBoxVisibility","modelViewProjectionMatrix","boxMin","boxMax","fc","boxVisibility","_sglConsolidateOptions","fullOptions","usedOptions","attr","sglGetBufferOptions","gl","options","opt","usage","STATIC_DRAW","SglBufferInfo","handle","valid","sglBufferFromData","values","buff","createBuffer","bindBuffer","bufferData","obj","sizeInBytes","sglVertexBufferFromData","ARRAY_BUFFER","sglIndexBufferFromData","ELEMENT_ARRAY_BUFFER","SglShaderInfo","type","sglShaderFromSource","src","shd","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","sglVertexShaderFromSource","VERTEX_SHADER","sglFragmentShaderFromSource","FRAGMENT_SHADER","SglProgramAttributeInfo","name","nativeType","location","SglProgramUniformInfo","SglProgramSamplerInfo","SglProgramInfo","shaders","attributes","uniforms","samplers","sglProgramFromShaders","prg","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","loc","attribs_count","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","unif","uniforms_count","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","SAMPLER_2D","SAMPLER_CUBE","sglSetDefaultProgramBindings","sglProgramFromSources","vertexSources","fragmentSources","programInfo","index","vattr","bindAttribLocation","useProgram","unit","smp","uniform1i","sglProgramSynchronize","sglGetTextureOptions","minFilter","LINEAR","magFilter","wrapS","CLAMP_TO_EDGE","wrapT","isDepth","depthMode","LUMINANCE","depthCompareMode","COMPARE_R_TO_TEXTURE","depthCompareFunc","LEQUAL","generateMipmap","flipY","premultiplyAlpha","onload","SglTextureInfo","format","width","height","sglTexture2DFromData","internalFormat","sourceFormat","sourceType","texels","FLOAT","Float32Array","Uint8Array","tex","createTexture","bindTexture","TEXTURE_2D","flipYEnabled","getParameter","UNPACK_FLIP_Y_WEBGL","flipYRequired","pixelStorei","texImage2D","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","DEPTH_TEXTURE_MODE","TEXTURE_COMPARE_MODE","TEXTURE_COMPARE_FUNC","sglTexture2DFromImage","image","RGBA","UNSIGNED_BYTE","sglTexture2DFromUrl","img","Image","crossOrigin","texInfo","sglTextureCubeFromData","facesTexels","TEXTURE_CUBE_MAP","TEXTURE_CUBE_MAP_POSITIVE_X","sglTextureCubeFromImages","images","sglTextureCubeFromUrls","urls","remaining","watcher","SglRenderbufferInfo","sglRenderbufferFromFormat","rb","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","sglGetFramebufferOptions","colorsAsRenderbuffer","depthAsRenderbuffer","stencilAsRenderbuffer","generateColorsMipmap","generateDepthMipmap","generateStencilMipmap","SglFramebufferInfo","colorTargets","depthTarget","stencilTarget","status","sglFramebufferFromTargets","fb","createFramebuffer","bindFramebuffer","FRAMEBUFFER","NONE","framebufferTexture2D","DEPTH_ATTACHMENT","framebufferRenderbuffer","STENCIL_ATTACHMENT","cts","drawBuffers","att","COLOR_ATTACHMENT0","ct","fbStatus","checkFramebufferStatus","trg","FRAMEBUFFER_COMPLETE","sglFramebufferFromFormats","colorFormats","depthFormat","stencilFormat","cc","DEPTH_COMPONENT","STENCIL_COMPONENT","SglVertexBuffer","_info","SglIndexBuffer","SglProgramAttribute","program","info","_prog","SglProgramUniform","_func","BOOL","BOOL_VEC2","uniform2iv","BOOL_VEC3","uniform3iv","BOOL_VEC4","uniform4iv","INT","INT_VEC2","INT_VEC3","INT_VEC4","uniform1f","FLOAT_VEC2","uniform2fv","FLOAT_VEC3","uniform3fv","FLOAT_VEC4","uniform4fv","FLOAT_MAT2","uniformMatrix2fv","FALSE","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","SglProgramSampler","_unit","SglProgram","_attributes","_uniforms","_samplers","SglTexture2D","SglTextureCube","SglRenderbuffer","SglFramebuffer","_colorTargets","_depthTarget","_stencilTarget","SglAttributeStreamJS","byCopy","_name","_size","_buff","SglVertexStreamJS","_attribs","_length","SglPrimitiveStreamJS","mode","_mode","_first","SglArrayPrimitiveStreamJS","SGL_ARRAY_PRIMITIVE_STREAM","SglIndexedPrimitiveStreamJS","indices","SGL_INDEXED_PRIMITIVE_STREAM","SglConnectivityJS","_prims","SglMeshJS","_valid","_vert","_conn","sglMeshJSImportOBJFromString","mesh","positionsArray","texcoordsArray","normalsArray","indicesArray","positions","texcoords","normals","facemap","pos","nor","tokens","hasPos","hasTex","hasNor","lineIndex","parseFloat","parseInt","addVertexAttribute","addIndexedPrimitives","SGL_TRIANGLES_LIST","sglMeshJSImportOBJFromURL","asynch","isValid","txt","_sglFindVertexAttributeJSON","vertices","_sglFindConnectivityJSON","connectivity","sglMeshJSImportJSONFromString","JSON","parse","mapping","stdMapping","vm","source","normalized","semantic","conn","primitives","sglMeshJSImportJSONFromURL","sglGLTypeSize","BYTE","SHORT","UNSIGNED_SHORT","UNSIGNED_INT","sglGLTypeFromWebGLArray","wglArray","Int8Array","Int16Array","Uint16Array","Int32Array","Uint32Array","SglAttributeStreamGL","_type","_norm","_stride","SglVertexStreamGL","SglPrimitiveStreamGL","SglArrayPrimitiveStreamGL","SglIndexedPrimitiveStreamGL","_idxType","SglPackedIndexedPrimitiveStreamGL","blockStartingIndices","blockStartingVertices","_blockStartingVertices","_blockStartingIndices","_blockIndicesCount","start","sIdx","SGL_PACKED_INDEXED_PRIMITIVE_STREAM","SglConnectivityGL","SglMeshGL","SglMeshGLRenderer","doSynchronize","_mapping","_meshAttrMap","_mesh","_primStream","_phase","_updateEnabledVB","synchronizeProgram","setStreamMapping","sglRenderMeshGLPrimitives","streamMapping","renderer","begin","setUniforms","setSamplers","renderMeshPrimitives","sglMeshJSCalculateBBox","meshJS","attribName","attrn","posAttrib","posSize","posBuffer","buffer","bbox","val","sglGLPrimitiveType","primType","SGL_POINTS_LIST","POINTS","SGL_LINES_LIST","LINES","SGL_LINE_STRIP","LINE_STRIP","SGL_LINE_LOOP","LINE_LOOP","TRIANGLES","SGL_TRIANGLE_STRIP","TRIANGLE_STRIP","SGL_TRIANGLE_FAN","TRIANGLE_FAN","sglMeshJStoGL","meshGL","prim","ptype","addArrayPrimitives","sglPackMeshJStoGL","maxVertexIndex","primName","maxInd","pmode","ariety","srcIndices","startVertex","startIndex","startVertices","startIndices","newIndices","newAttribs","indicesMap","dstIndices","vtxCount","triIndices","newVerticesCount","srcIdx","dstIdx","idxCount","srcAttr","dstAttr","asize","dstBase","newArr","concat","srcBuff","dstBuff","addPackedIndexedPrimitives","SglTrackball","_matrix","_pts","_action","SGL_TRACKBALL_NO_ACTION","reset","SglFirstPersonCamera","_position","_angles","lookAt","sglGetCanvasContext","canvasID","canvas","contextNames","getContext","TRUE","SglCanvasUI","manager","handler","_manager","_handler","_canvas","_timerID","_updRate","_ignoreKeyRepeat","loadEvent","unloadEvent","keyDownEvent","keyUpEvent","keyPressEvent","mouseDownEvent","mouseUpEvent","mouseMoveEvent","mouseWheelEvent","clickEvent","dblClickEvent","resizeEvent","updateEvent","drawEvent","keysDown","mouseButtonsDown","mousePos","mousePrevPos","mouseDeltaPos","timeNow","Date","now","timePrev","timeDelta","_SglCanvasManager","updateRate","contentEditable","PACK_ALIGNMENT","UNPACK_ALIGNMENT","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_COLORSPACE_CONVERSION_WEBGL","ui","mgr","_drawPending","rendering","_drawFunc","draw","addEventListener","e","load","unload","keyDown","keyUp","keyPress","mouseDown","mouseUp","mouseMove","click","dblClick","resize","mouseWheel","blur","mouseOut","mouseOver","touchStart","touchEnd","touchMove","_sglManageCanvas","_SGL_RegisteredCanvas","_sglUnmanageCanvas","_sglManageCanvasOnLoad","window","_sglUnmanageCanvasOnLoad","sglRegisterCanvas","sglRegisterLoadedCanvas","SGL_VERSION_MAJOR","SGL_VERSION_MINOR","SGL_VERSION_REVISION","SGL_VERSION_STRING","SGL_REQUEST_FAILED","SGL_REQUEST_SUCCEEDED","SGL_REQUEST_ONGOING","SGL_REQUEST_ABORTED","SGL_REQUEST_QUEUED","SGL_REQUEST_REJECTED","SGL_REQUEST_CANCELLED","_createOnReadyCallback","ok","_requestReady","priority","_updateRequest","removeOnReadyCallback","splice","queue","_send","cancel","_removeQueuedRequest","abort","_removeOngoingRequest","_abort","complete","onerror","requests","onReady","_sort","sort","_updateMinPriority","comparePriorities","_removeFromArray","arr","elem","_execute","sendable","pop","priorityCompare","victims","result","overflow","toKill","PI","clone","copy","set","setOne","at","squaredLength","dot","neg","minComp","maxComp","argMin","argMax","add","sub","mul","div","rcp","cross","o","slize","nomalize","isNull","isEmpty","squaredDiagonal","diagonal","facesAreas","surfaceArea","facesArea","volume","halfDelta","corner","transformed","matrix","addPoint","addBox","_redius","ss","topRef","multiply","loadIdentity","translate","rotate","scale","ortho","frustum","perspective","model","view","projection","modelMatrix","modelMatrixRef","modelMatrixTranspose","modelMatrixInverse","modelMatrixInverseTranspose","viewMatrix","viewMatrixRef","viewMatrixTranspose","viewMatrixInverse","viewMatrixInverseTranspose","projectionMatrixRef","projectionMatrixTranspose","projectionMatrixInverse","projectionMatrixInverseTranspose","modelViewMatrixTranspose","modelViewMatrixInverse","modelViewMatrixInverseTranspose","viewProjectionMatrix","viewProjectionMatrixTranspose","viewProjectionMatrixInverse","viewProjectionMatrixInverseTranspose","modelViewProjectionMatrixTranspose","modelViewProjectionMatrixInverse","modelViewProjectionMatrixInverseTranspose","worldSpaceNormalMatrix","viewSpaceNormalMatrix","modelSpaceViewerPosition","modelSpaceViewDirection","worldSpaceViewerPosition","worldSpaceViewDirection","ssglNegV3","nx","ny","nz","off","SGL_OUTSIDE_FRUSTUM","SGL_INTERSECT_FRUSTUM","SGL_INSIDE_FRUSTUM","rot","sc","scRcp","sMat","sMatInv","rMatInv","bminmax","fp","projectedSegmentSize","hs","p0","p1","p2","sz","destroy","deleteBuffer","bind","unbind","getUniform","deleteProgram","deleteShader","setDefaultBindings","synchronize","setAttributes","link","deleteTexture","activeTexture","TEXTURE0","deleteRenderbuffer","deleteFramebuffer","targets","setViewport","vp","bindColor","unbindColor","bindDepth","unbindDepth","bindStencil","unbindStencil","colors","depth","stencil","attachColorTarget","detachColorTarget","addAttribute","removeAttribute","removePrimitives","removeVertexAttribute","parseOBJ","importOBJ","parseJSON","importJSON","isNormalized","baseVertex","vertexAttribPointer","doDestroy","_clampRange","end","vEnd","_render","_destroy","render","range","drawArrays","drawElements","_clampBlockRange","block","blockRanges","firstBlock","lastBlock","ranges","renderBlock","SGL_DefaultStreamMappingPrefix","_bindVertexBuffers","_unbindVertexBuffers","prog","doLink","getStreamMappingFromPrefix","prefix","substr","meshAttrName","progAttrName","progAttr","setStreamMappingFromPrefix","textures","disableVertexAttribArray","beginMesh","endMesh","beginPrimitives","endPrimitives","vIndex","enableVertexAttribArray","isPacked","blocksCount","blocks","calculateBoundingBox","toMeshGL","toPackedMeshGL","SGL_TRACKBALL_ROTATE","SGL_TRACKBALL_PAN","SGL_TRACKBALL_DOLLY","SGL_TRACKBALL_SCALE","_projectOnSphere","_transform","_transformOnSphere","_translate","invMat","trMat","action","track","pan","dolly","mInv","v0","v1","angle","rotMat","dz","scaleMat","roll","viewDir","xOffset","yOffset","zOffset","pitchMat","yawMat","rollMat","rotOffset","translateOnPlane","pitchOffset","yawOffset","rollOffset","posMat","res","ignoreKeyRepeat","updR","clearInterval","ms","setInterval","update","requestDraw","_getMouseClientPos","rct","getBoundingClientRect","clientX","clientY","setTimeout","doDraw","button","key","keyString","String","fromCharCode","keyCode","toLowerCase","toUpperCase","charCode","preventDefault","focus","delta","event","wheelDelta","opera","detail","touches","changedTouches","flush","createRtiViewer","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","style","screen","$","h","label","icons","primary","exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen","l","css","createElement","id","margin","append","g","href","appendChild","cssFloat","_","setAttribute","visibility","innerHTML","color","backgroundColor","display","startZoomIn","startZoomOut","setMode","show","removeClass","msFullscreenElement","mozFullScreen","webkitIsFullScreen","hide","MultiRes","setImageUrl","setOnLoadImageCallback","stepAnimation","idTimer","flipAngles","onDrawCallback","animating","moveToCenter","imageUrl","OnLoadImageCallback","currentSpeed","maxStep","animationStack","isMoving","MultiResNode","parentIndex","childrenIndices","projectedSize","zScale","box","timestamp","error","Number","MAX_VALUE","data","isLeaf","MultiResTree","ready","nodesCount","rootIndex","nodes","tileSize","forma","imgW","imgH","_MultiResAssert","alert","_MultiResCompareNodes","MultiResRenderer","lg","_tree","_timestamp","_frustum","_maxError","_cache","_cacheSizeInBytes","_maxCacheSize","_maxOngoingRequests","_currentOngoingRequests","_toRequest","_toRenderFullRes","_toRenderHalfRes","_readyItems","renderData","renderBoxes","_boxMesh","_tileFullMesh","_tileHalfMesh","_program","_boxProgram","_boxRenderer","_treeTransform","_normalizedTreeTransform","updateData","texProg","lgMesh","lgtex","_createLg","enumType","HSH_RTI","LRGB_PTM","RGB_PTM","IMAGE","_setLightDir","lightPos","lweights","computeLightingFunction","resetViewpoint","translation","mat","flipMatrix","xform","loadImage","leftBottom","imgWidth","imgHeight","rightTop","maxScale","viewerdx","viewerdy","stopRendering","setOnDrawCallback","_startZoom","moveInterval","zoomInterval","_zoomAnimation","_moveAnimation","computeModelMatrix","currentPoint","_updateMoveStack","returnModelMatrix","lenght","sendMouseDown","endAnimation","_adjustTranslation","normalizedTreeTransform","offsetHeight","getError","CONTEXT_LOST_WEBGL","console","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","_load","M","S","I","T","R","F","L","C","P","onLoad","parent","child","responseXML","getElementsByTagName","getAttribute","isNaN","ordlen","numLayers","childNodes","nodeValue","gmax","gmin","_destroyData","_renderer","leftTex","rightTex","bottomTex","topTex","_setupTree","save","beginPath","moveTo","lineTo","closePath","clip","strokeStyle","lineCap","lineJoin","miterLimit","restore","transform","createRadialGradient","addColorStop","fillStyle","lineWidth","arc","fill","stroke","createLinearGradient","toDataURL","NEAREST","_createData","_requestNode","_collectNodesRec","needed","usable","children","_collectNodes","_renderNodeFullRes","u_world_box_min","u_world_box_max","_renderNodesFullRes","u_model_view_projection_matrix","u_scale_bias","u_texcoord_scale_bias","_renderNodeHalfRes","_renderNodesHalfRes","_renderNodes","_renderNodeFullResBox","u_color","_renderNodesFullResBoxes","_renderNodeHalfResBox","_renderNodesHalfResBoxes","_renderNodesBoxes","depthFunc","LESS","_doRender","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","u_mvp","s_texture","disable","_updateCache","_requestNodes","_calculateNormalizedTreeTransform"],"mappings":"AAuCA,QAASA,cACR,KAAM,IAAIC,OAAM,sBAGjB,QAASC,kBACR,KAAM,IAAID,OAAM,0BAGjB,QAASE,oBACR,KAAM,IAAIF,OAAM,4BAGjB,QAASG,uBACR,KAAM,IAAIH,OAAM,gCAGjB,QAASI,kBACR,KAAM,IAAIJ,OAAM,2BAiBjB,QAASK,mBAAkBC,EAAWC,EAAcC,GACnDF,EAAUC,GAAgBC,EAG3B,QAASC,YAAWC,EAAkBC,GACrCD,EAAiBE,UAAY,GAAID,GACjCD,EAAiBE,UAAUC,YAAcH,EAO1C,QAASI,kBAIT,QAASC,gBAuCT,QAASC,aAAYC,GACpB,GAAIC,GAAOC,SAASC,eAAeH,EACnC,KAAKC,EAAM,MAAO,KAIlB,KAFA,GAAIG,GAAM,GACNC,EAAMJ,EAAKK,WACRD,GACY,GAAdA,EAAEE,WACLH,GAAOC,EAAEG,aAEVH,EAAIA,EAAEI,WAEP,OAAOL,GAGR,QAASM,aAAYC,EAAKC,GACzB,GAAIC,GAAQ,GAAa,GAAS,EAC9BC,EAAM,GAAIC,eAEVF,KACHC,EAAIE,mBAAqB,WACF,GAAlBF,EAAIG,YACHL,GACHA,EAASE,EAAII,gBAMjBJ,EAAIK,KAAK,MAAOR,EAAKE,GACrBC,EAAIM,KAAK,KAET,IAAIC,GAAM,IAKV,OAJKR,KACJQ,EAAMP,EAAII,cAGJG,EAGR,QAASC,aAAYC,GAMpB,IAAK,GAJDC,GAAWD,EAAKE,MAAM,MACtBpB,EAAImB,EAASE,OACbC,KACAC,EAAO,KACFC,EAAE,EAAKxB,EAAFwB,IAAOA,EACpBD,EAAOJ,EAASK,GAAGC,QAAQ,UAAW,KAAKA,QAAQ,SAAU,IACzDF,EAAKF,OAAS,GACjBC,EAAMI,KAAKH,EAGb,OAAOD,GAoBR,QAASK,YAAWC,GACnBC,KAAKC,UAAY,KACjBD,KAAKE,QAAYC,iBACjBH,KAAKI,OAAY,KACjBJ,KAAKK,YACDN,GACHC,KAAKM,mBAAmBP,GAyH1B,QAASQ,oBAAmB9B,EAAKsB,GAChCD,WAAWU,MAAMR,KAAMS,MAAMhD,UAAUiD,MAAMC,KAAKC,UAAW,IAC7DZ,KAAKa,KAAOpC,EACZuB,KAAKc,KAAO,KACZC,OAAOC,eAAehB,KAAM,OAAQiB,IAAK,WAAW,MAAOjB,MAAKa,QAChEE,OAAOC,eAAehB,KAAM,QAASiB,IAAK,WAAW,MAAOjB,MAAKc,KAAK9B,gBA6CvE,QAASkC,iBAAgBzC,EAAKsB,GAC7BD,WAAWU,MAAMR,KAAMS,MAAMhD,UAAUiD,MAAMC,KAAKC,UAAW,IAC7DZ,KAAKa,KAAOpC,EACZuB,KAAKmB,KAAO,KACZJ,OAAOC,eAAehB,KAAM,OAAQiB,IAAK,WAAW,MAAOjB,MAAKa,QAChEE,OAAOC,eAAehB,KAAM,SAAUiB,IAAK,WAAW,MAAOjB,MAAKmB,QAmCnE,QAASC,mBAAkBC,EAAMtB,GAChC,GAAI5B,GAAIkD,EAAK7B,MAEbQ,MAAKK,SAAiB,EAAoB,EAAoB,KAC9DL,KAAKsB,aAAiBnD,EACtB6B,KAAKuB,eAAiB,EACtBvB,KAAKwB,YAAiB,EACtBxB,KAAKyB,MAAiBJ,EAAKX,OAkB3B,KAAK,GAhBDgB,GAAK1B,KACL2B,EAAK,SAASC,GACbA,EAAEC,UACLH,EAAEH,iBAEMK,EAAEE,QACVJ,EAAEF,cAEHE,EAAEJ,eACEI,EAAEK,SACDL,EAAErB,UACLqB,EAAErB,SAASqB,IAKL/B,EAAE,EAAKxB,EAAFwB,IAAOA,EAChB0B,EAAK1B,GAAGkC,WACX7B,KAAKuB,iBACLvB,KAAKsB,gBAEGD,EAAK1B,GAAGmC,QAChB9B,KAAKwB,cACLxB,KAAKsB,gBAGLD,EAAK1B,GAAGW,mBAAmBqB,EAIzB3B,MAAKsB,cAAgB,GACpBtB,KAAKK,UACRL,KAAKK,SAASL,MAkEjB,QAASgC,iBAAgBC,EAAYC,EAAWnC,GAC/CC,KAAKmC,YAAeF,EAAa,EAAK,EAAe,EACrDjC,KAAKoC,WAAeF,EAAa,EAAK,EAAe,EAErDlC,KAAKqC,YACLrC,KAAKsC,WACLtC,KAAKK,SAAW,KAChBL,KAAKuC,gBAAkB,KACvBvC,KAAKwC,iBAAmB,KACxBxC,KAAKyC,QAAS,EA+Mf,QAASC,QAAOC,GACf,MAAOC,MAAKC,IAAIF,GAGjB,QAASG,UAASH,GACjB,MAAOC,MAAKG,MAAMJ,GAGnB,QAASK,SAAQL,GAChB,MAAOC,MAAKK,KAAKN,GAGlB,QAASO,SAAQP,GAChB,MAAOC,MAAKO,KAAKR,GAGlB,QAASS,QAAOT,EAAGU,GAClB,MAAOT,MAAKU,IAAIX,EAAGU,GAGpB,QAASE,QAAOZ,GACf,MAAOC,MAAKY,IAAIb,GAGjB,QAASc,QAAOd,GACf,MAAOC,MAAKc,IAAIf,GAGjB,QAASgB,QAAOhB,GACf,MAAOC,MAAKgB,IAAIjB,GAGjB,QAASkB,SAAQlB,GAChB,MAAOC,MAAKkB,KAAKnB,GAGlB,QAASoB,QAAOpB,GACf,MAAOC,MAAKoB,IAAIrB,GAGjB,QAASsB,SAAQtB,GAChB,MAAOC,MAAKsB,KAAKvB,GAGlB,QAASwB,QAAOxB,GACf,MAAOC,MAAKwB,IAAIzB,GAGjB,QAAS0B,SAAQ1B,GAChB,MAAOC,MAAK0B,KAAK3B,GAGlB,QAAS4B,UAASlB,EAAGV,GACpB,MAAOC,MAAK4B,MAAMnB,EAAGV,GAGtB,QAAS8B,aAAY9B,GACpB,MAAQA,IAAK+B,OAAS,KAGvB,QAASC,aAAYhC,GACpB,MAAQA,IAAK,IAAQ+B,QAGtB,QAASE,QAAOC,EAAGC,GAClB,MAAOlC,MAAKmC,IAAIF,EAAGC,GAGpB,QAASE,QAAOH,EAAGC,GAClB,MAAOlC,MAAKqC,IAAIJ,EAAGC,GAGpB,QAASI,UAASvC,EAAGoC,EAAKE,GACzB,MAAcF,IAALpC,EAAY,EAAUA,GAAKsC,EAAO,EAAQ,EAGpD,QAASE,eACR,MAAOvC,MAAKwC,SAGb,QAASC,UAASC,EAAQC,EAAMC,EAAGC,EAAOC,EAAOC,EAAOC,GACvDF,EAAoBG,QAAVH,EAAuBA,EAAS,EAC1CE,EAAoBC,QAAVD,EAAuBA,EAASL,EAC1CI,EAAoBE,QAAVF,EAAuBA,GAAWL,EAAO9F,OAASkG,GAASE,CAOrE,KAAK,GALDE,GAAOJ,EAAQC,EAAQC,EACvBG,EAAO,GAAItF,OAAMtC,GAEjB6H,EAAI,EACJC,EAAI,EACCtG,EAAE+F,EAASI,EAAFnG,EAAQA,GAAGiG,EAAQ,CACpC,IAAKK,EAAE,EAAGA,EAAE9H,IAAK8H,EAChBF,EAAEE,GAAKX,EAAO3F,EAAEsG,EAGjB,KADAT,EAAEO,EAAGN,EAAOO,KACPC,EAAE,EAAGA,EAAE9H,IAAK8H,EAChBX,EAAO3F,EAAEsG,GAAKF,EAAEE,IAKnB,QAASC,UAASC,EAASX,EAAGC,EAAOC,EAAOC,EAAOC,GAClDP,SAASc,EAAS,EAAGX,EAAGC,EAAOC,EAAOC,EAAOC,GAG9C,QAASQ,UAASC,EAASb,EAAGC,EAAOC,EAAOC,EAAOC,GAClDP,SAASgB,EAAS,EAAGb,EAAGC,EAAOC,EAAOC,EAAOC,GAG9C,QAASU,UAASC,EAASf,EAAGC,EAAOC,EAAOC,EAAOC,GAClDP,SAASkB,EAAS,EAAGf,EAAGC,EAAOC,EAAOC,EAAOC,GAmC9C,QAASY,YAAWT,GACnB,MAAO,IAAItF,OAAM,GAGlB,QAASgG,QAAOV,GACf,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAASgG,QAAOC,GACf,OAASA,EAAGA,GAGb,QAASC,QAAOjE,EAAGU,GAClB,OAASV,EAAGU,GAGb,QAASwD,aACR,MAAOH,QAAO,GAGf,QAASI,YACR,MAAOJ,QAAO,GAGf,QAASK,SACR,GAAI5I,GAAIyC,UAAUpB,MAElB,QAAQrB,GACP,IAAK,GACJ,MAAIyC,WAAU,YAAcH,OACpBgG,OAAO7F,UAAU,IAElB8F,OAAO9F,UAAU,GAGzB,KAAK,GACJ,MAAO6F,QAAO7F,UAGf,SACC,MAAOiG,aAGT,MAAO,MAGR,QAASG,UAASjB,GACjB,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAASuG,UAASlB,GACjB,MAAOa,SAAQb,EAAE,IAAKA,EAAE,IAGzB,QAASmB,UAASC,EAAGpB,GACpB,MAAOa,QAAOO,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAGjC,QAASqB,WAAUrB,EAAGY,GACrB,MAAOC,QAAOb,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAG5B,QAASU,WAAUV,EAAGZ,GACrB,MAAOqB,WAAUrB,EAAGY,GAGrB,QAASW,UAASH,EAAGpB,GACpB,MAAOa,QAAOO,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAGjC,QAASwB,WAAUxB,EAAGY,GACrB,MAAOC,QAAOb,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAG5B,QAASa,WAAUzB,EAAGY,GACrB,MAAOC,QAAOD,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,IAG3B,QAAS0B,UAASN,EAAGpB,GACpB,MAAOa,QAAOO,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAGjC,QAAS2B,WAAU3B,EAAGY,GACrB,MAAOC,QAAOb,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAG5B,QAASgB,WAAUhB,EAAGZ,GACrB,MAAO2B,WAAU3B,EAAGY,GAGrB,QAASiB,UAAST,EAAGpB,GACpB,MAAOa,QAAOO,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAGjC,QAAS8B,WAAU9B,EAAGY,GACrB,MAAOC,QAAOb,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAG5B,QAASmB,WAAUnB,EAAGZ,GACrB,MAAOa,QAAOD,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,IAG3B,QAASgC,UAAShC,GACjB,MAAO+B,WAAU,EAAK/B,GAGvB,QAASiC,UAASb,EAAGpB,GACpB,MAAQoB,GAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAG5B,QAASkC,YAAWd,EAAGpB,GACtB,MAAQoB,GAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAG5B,QAASmC,eAAcnC,GACtB,MAAOiC,UAASjC,EAAGA,GAGpB,QAASoC,aAAYpC,GACpB,MAAO7C,SAAQgF,cAAcnC,IAG9B,QAASqC,iBAAgBrC,GACxB,GAAIP,GAAI,EAAM2C,YAAYpC,EAC1B,OAAO2B,WAAU3B,EAAGP,GAGrB,QAAS6C,cAAatC,GAGrB,MAFAA,GAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACHA,EAGR,QAASuC,cAAanB,EAAGpB,GAGxB,MAFAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAASoB,eAAcxC,EAAGY,GAGzB,MAFAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAASyC,eAAc7B,EAAGZ,GAGzB,MAFAA,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS0C,cAAatB,EAAGpB,GAGxB,MAFAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAASuB,eAAc3C,EAAGY,GAGzB,MAFAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS4C,eAAc5C,EAAGY,GAGzB,MAFAZ,GAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACNA,EAGR,QAAS6C,cAAazB,EAAGpB,GAGxB,MAFAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAAS0B,eAAc9C,EAAGY,GAGzB,MAFAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS+C,eAAcnC,EAAGZ,GAGzB,MAFAA,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAASgD,cAAa5B,EAAGpB,GAGxB,MAFAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAAS6B,eAAcjD,EAAGY,GAGzB,MAFAQ,GAAE,IAAMR,EACRQ,EAAE,IAAMR,EACDQ,EAGR,QAAS8B,eAActC,EAAGZ,GAGzB,MAFAA,GAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACNA,EAGR,QAASmD,cAAanD,GACrB,MAAOkD,eAAc,EAAKlD,GAG3B,QAASoD,oBAAmBpD,GAC3B,GAAIP,GAAI,EAAM2C,YAAYpC,EAC1B,OAAO8C,eAAc9C,EAAGP,GAGzB,QAAS4D,UAASjC,EAAGpB,GACpB,OACGoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,IAI/B,QAASsD,UAASlC,EAAGpB,GACpB,OACGoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,IAI/B,QAASuD,WAAUvD,EAAGwD,GACrB,MAAOC,QAAOzD,EAAE,GAAIA,EAAE,GAAIwD,GAG3B,QAASE,WAAU1D,EAAGwD,EAAGG,GACxB,MAAOC,QAAO5D,EAAE,GAAIA,EAAE,GAAIwD,EAAGG,GAO9B,QAASE,YAAW7D,GACnB,MAAO,IAAItF,OAAM,GAGlB,QAASoJ,QAAO9D,GACf,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAASoJ,QAAOnD,GACf,OAASA,EAAGA,EAAGA,GAGhB,QAAS6C,QAAO7G,EAAGU,EAAGkG,GACrB,OAAS5G,EAAGU,EAAGkG,GAGhB,QAASQ,aACR,MAAOD,QAAO,GAGf,QAASE,YACR,MAAOF,QAAO,GAGf,QAASG,SACR,GAAI9L,GAAIyC,UAAUpB,MAElB,QAAQrB,GACP,IAAK,GACJ,MAAIyC,WAAU,YAAcH,OACpBoJ,OAAOjJ,UAAU,IAElBkJ,OAAOlJ,UAAU,GAGzB,KAAK,GACJ,MAAOiJ,QAAOjJ,UAGf,SACC,MAAOmJ,aAGT,MAAO,MAGR,QAASG,UAASnE,GACjB,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAASyJ,UAASpE,GACjB,MAAOyD,SAAQzD,EAAE,IAAKA,EAAE,IAAKA,EAAE,IAGhC,QAASqE,UAASjD,EAAGpB,GACpB,MAAOyD,QAAOrC,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAG5C,QAASsE,WAAUtE,EAAGY,GACrB,MAAO6C,QAAOzD,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAGpC,QAAS2D,WAAU3D,EAAGZ,GACrB,MAAOsE,WAAUtE,EAAGY,GAGrB,QAAS4D,UAASpD,EAAGpB,GACpB,MAAOyD,QAAOrC,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAG5C,QAASyE,WAAUzE,EAAGY,GACrB,MAAO6C,QAAOzD,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAGpC,QAAS8D,WAAU1E,EAAGY,GACrB,MAAO6C,QAAO7C,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,IAGnC,QAAS2E,UAASvD,EAAGpB,GACpB,MAAOyD,QAAOrC,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAG5C,QAAS4E,WAAU5E,EAAGY,GACrB,MAAO6C,QAAOzD,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAGpC,QAASiE,WAAUjE,EAAGZ,GACrB,MAAO4E,WAAU5E,EAAGY,GAGrB,QAASkE,UAAS1D,EAAGpB,GACpB,MAAOyD,QAAOrC,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAG5C,QAAS+E,WAAU/E,EAAGY,GACrB,MAAO6C,QAAOzD,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAGpC,QAASoE,WAAUpE,EAAGZ,GACrB,MAAOyD,QAAO7C,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,IAGnC,QAASiF,UAASjF,GACjB,MAAOgF,WAAU,EAAKhF,GAGvB,QAASkF,UAAS9D,EAAGpB,GACpB,MAAQoB,GAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAGxC,QAASmF,YAAW/D,EAAGpB,GACtB,MAAOyD,QAAOrC,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,IAGhF,QAASoF,eAAcpF,GACtB,MAAOkF,UAASlF,EAAGA,GAGpB,QAASqF,aAAYrF,GACpB,MAAO7C,SAAQiI,cAAcpF,IAG9B,QAASsF,iBAAgBtF,GACxB,GAAIP,GAAI,EAAM4F,YAAYrF,EAC1B,OAAO4E,WAAU5E,EAAGP,GAGrB,QAAS8F,cAAavF,GAIrB,MAHAA,GAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACHA,EAGR,QAASwF,cAAapE,EAAGpB,GAIxB,MAHAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAASqE,eAAczF,EAAGY,GAIzB,MAHAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS0F,eAAc9E,EAAGZ,GAIzB,MAHAA,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS2F,cAAavE,EAAGpB,GAIxB,MAHAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAASwE,eAAc5F,EAAGY,GAIzB,MAHAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS6F,eAAc7F,EAAGY,GAIzB,MAHAZ,GAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACNA,EAGR,QAAS8F,cAAa1E,EAAGpB,GAIxB,MAHAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAAS2E,eAAc/F,EAAGY,GAIzB,MAHAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAASgG,eAAcpF,EAAGZ,GAIzB,MAHAA,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAASiG,cAAa7E,EAAGpB,GAIxB,MAHAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAAS8E,eAAclG,EAAGY,GAIzB,MAHAQ,GAAE,IAAMR,EACRQ,EAAE,IAAMR,EACRQ,EAAE,IAAMR,EACDQ,EAGR,QAAS+E,eAAcvF,EAAGZ,GAIzB,MAHAA,GAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACNA,EAGR,QAASoG,cAAapG,GACrB,MAAOmG,eAAc,EAAKnG,GAG3B,QAASqG,gBAAejF,EAAGpB,GAC1B,GAAIrE,GAAI8H,OAAOrC,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAIhF,OAHAoB,GAAE,GAAKzF,EAAE,GACTyF,EAAE,GAAKzF,EAAE,GACTyF,EAAE,GAAKzF,EAAE,GACFyF,EAGR,QAASkF,oBAAmBtG,GAC3B,GAAIP,GAAI,EAAM4F,YAAYrF,EAC1B,OAAO+F,eAAc/F,EAAGP,GAGzB,QAAS8G,UAASnF,EAAGpB,GACpB,OACGoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,IAI/B,QAASwG,UAASpF,EAAGpB,GACpB,OACGoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,IAI/B,QAASyG,WAAUzG,GAClB,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAAS+L,WAAU1G,EAAG2D,GACrB,MAAOC,QAAO5D,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAI2D,GAOjC,QAASgD,YAAW3G,GACnB,MAAO,IAAItF,OAAM,GAGlB,QAASkM,QAAO5G,GACf,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAASkM,QAAOjG,GACf,OAASA,EAAGA,EAAGA,EAAGA,GAGnB,QAASgD,QAAOhH,EAAGU,EAAGkG,EAAGG,GACxB,OAAS/G,EAAGU,EAAGkG,EAAGG,GAGnB,QAASmD,aACR,MAAOD,QAAO,GAGf,QAASE,YACR,MAAOF,QAAO,GAGf,QAASG,SACR,GAAI5O,GAAIyC,UAAUpB,MAElB,QAAQrB,GACP,IAAK,GACJ,MAAIyC,WAAU,YAAcH,OACpBkM,OAAO/L,UAAU,IAElBgM,OAAOhM,UAAU,GAGzB,KAAK,GACJ,MAAO+L,QAAO/L,UAGf,SACC,MAAOiM,aAGT,MAAO,MAGR,QAASG,UAASjH,GACjB,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAASuM,UAASlH,GACjB,MAAO4D,SAAQ5D,EAAE,IAAKA,EAAE,IAAKA,EAAE,IAAKA,EAAE,IAGvC,QAASmH,UAAS/F,EAAGpB,GACpB,MAAO4D,QAAOxC,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAGvD,QAASoH,WAAUpH,EAAGY,GACrB,MAAOgD,QAAO5D,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAG5C,QAASyG,WAAUzG,EAAGZ,GACrB,MAAOoH,WAAUpH,EAAGY,GAGrB,QAAS0G,UAASlG,EAAGpB,GACpB,MAAO4D,QAAOxC,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAGvD,QAASuH,WAAUvH,EAAGY,GACrB,MAAOgD,QAAO5D,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAG5C,QAAS4G,WAAUxH,EAAGY,GACrB,MAAOgD,QAAOhD,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,IAG3C,QAASyH,UAASrG,EAAGpB,GACpB,MAAO4D,QAAOxC,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAGvD,QAAS0H,WAAU1H,EAAGY,GACrB,MAAOgD,QAAO5D,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAG5C,QAAS+G,WAAU/G,EAAGZ,GACrB,MAAO0H,WAAU1H,EAAGY,GAGrB,QAASgH,UAASxG,EAAGpB,GACpB,MAAO4D,QAAOxC,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,GAAIoB,EAAE,GAAGpB,EAAE,IAGvD,QAAS6H,WAAU7H,EAAGY,GACrB,MAAOgD,QAAO5D,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,EAAGZ,EAAE,GAAGY,GAG5C,QAASkH,WAAUlH,EAAGZ,GACrB,MAAO4D,QAAOhD,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,GAAIY,EAAEZ,EAAE,IAG3C,QAAS+H,UAAS/H,GACjB,MAAO8H,WAAU,EAAK9H,GAGvB,QAASgI,UAAS5G,EAAGpB,GACpB,MAAQoB,GAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAAKoB,EAAE,GAAGpB,EAAE,GAGpD,QAASiI,eAAcjI,GACtB,MAAOgI,UAAShI,EAAGA,GAGpB,QAASkI,aAAYlI,GACpB,MAAO7C,SAAQ8K,cAAcjI,IAG9B,QAASmI,iBAAgBnI,GACxB,GAAIP,GAAI,EAAMyI,YAAYlI,EAC1B,OAAO0H,WAAU1H,EAAGP,GAGrB,QAAS2I,cAAapI,GACrB,GAAIP,GAAI,EAAMO,EAAE,EAChB,OAAO4D,QAAO5D,EAAE,GAAGP,EAAGO,EAAE,GAAGP,EAAGO,EAAE,GAAGP,EAAG,GAGvC,QAAS4I,cAAarI,GAKrB,MAJAA,GAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACVA,EAAE,IAAMA,EAAE,GACHA,EAGR,QAASsI,cAAalH,EAAGpB,GAKxB,MAJAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAASmH,eAAcvI,EAAGY,GAKzB,MAJAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAASwI,eAAc5H,EAAGZ,GAKzB,MAJAA,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAASyI,cAAarH,EAAGpB,GAKxB,MAJAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAASsH,eAAc1I,EAAGY,GAKzB,MAJAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS2I,eAAc3I,EAAGY,GAKzB,MAJAZ,GAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACNA,EAGR,QAAS4I,cAAaxH,EAAGpB,GAKxB,MAJAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAASyH,eAAc7I,EAAGY,GAKzB,MAJAZ,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS8I,eAAclI,EAAGZ,GAKzB,MAJAA,GAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACRZ,EAAE,IAAMY,EACDZ,EAGR,QAAS+I,cAAa3H,EAAGpB,GAKxB,MAJAoB,GAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACVoB,EAAE,IAAMpB,EAAE,GACHoB,EAGR,QAAS4H,eAAchJ,EAAGY,GAKzB,MAJAQ,GAAE,IAAMR,EACRQ,EAAE,IAAMR,EACRQ,EAAE,IAAMR,EACRQ,EAAE,IAAMR,EACDQ,EAGR,QAAS6H,eAAcrI,EAAGZ,GAKzB,MAJAA,GAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACbA,EAAE,GAAKY,EAAIZ,EAAE,GACNA,EAGR,QAASkJ,cAAalJ,GACrB,MAAOiJ,eAAc,EAAKjJ,GAG3B,QAASmJ,oBAAmBnJ,GAC3B,GAAIP,GAAI,EAAMyI,YAAYlI,EAC1B,OAAO6I,eAAc7I,EAAGP,GAGzB,QAAS2J,kBAAiBpJ,GACzB,GAAIP,GAAI,EAAMO,EAAE,EAKhB,OAJAA,GAAE,IAAMP,EACRO,EAAE,IAAMP,EACRO,EAAE,IAAMP,EACRO,EAAE,GAAM,EACDA,EAGR,QAASqJ,UAASjI,EAAGpB,GACpB,OACGoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,IAI/B,QAASsJ,UAASlI,EAAGpB,GACpB,OACGoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,GAC3BoB,EAAE,GAAKpB,EAAE,GAAOoB,EAAE,GAAOpB,EAAE,IAI/B,QAASuJ,WAAUvJ,GAClB,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAAS6O,WAAUxJ,GAClB,MAAOA,GAAErF,MAAM,EAAG,GAOnB,QAAS8O,cACR,MAAO,IAAI/O,OAAM,IAGlB,QAASgP,QAAO1J,GACf,MAAOA,GAAErF,MAAM,EAAG,IAGnB,QAASgP,QAAO/I,GAEf,IAAK,GADDgJ,GAAIH,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBgQ,EAAEhQ,GAAKgH,CAER,OAAOgJ,GAGR,QAASC,YAAWC,GACnB,GAAIF,GAAID,OAAO,EAKf,OAJAC,GAAG,GAAKE,EAAE,GACVF,EAAG,GAAKE,EAAE,GACVF,EAAE,IAAME,EAAE,GACVF,EAAE,IAAME,EAAE,GACHF,EAGR,QAASG,YAAWnJ,GACnB,GAAIgJ,GAAID,OAAO,EAKf,OAJAC,GAAG,GAAKhJ,EACRgJ,EAAG,GAAKhJ,EACRgJ,EAAE,IAAMhJ,EACRgJ,EAAE,IAAMhJ,EACDgJ,EAGR,QAASI,YAAWC,EAAKC,EAAKC,EAAKC,GAClC,MAAOP,YAAWhP,WAGnB,QAASwP,aACR,MAAOV,QAAO,GAGf,QAASW,YACR,MAAOX,QAAO,GAGf,QAASY,iBACR,MAAOR,YAAW,GAGnB,QAASS,SACR,GAAIpS,GAAIyC,UAAUpB,MAClB,QAAQrB,GACP,IAAK,GACJ,GAAIyC,UAAU,YAAcH,OAC3B,OAAQG,UAAU,GAAGpB,QACpB,IAAK,GACJ,MAAOsQ,YAAWlP,UAAU,GAE7B,KAAK,GACJ,MAAOgP,YAAWhP,UAAU,GAE7B,KAAK,IACJ,MAAO6O,QAAO7O,UAAU,GAEzB,SACC,MAAO0P,iBAIV,MAAOZ,QAAO9O,UAAU,GAGzB,KAAK,GACJ,MAAOgP,YAAWhP,UAGnB,KAAK,IACJ,MAAO6O,QAAO7O,UAGf,SACC,MAAO0P,iBAGT,MAAO,MAGR,QAASE,UAASb,GACjB,GAAI/N,GAAI4N,YAsBR,OApBA5N,GAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GAEX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GAEX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAE,IAAM+N,EAAE,IACV/N,EAAE,IAAM+N,EAAE,IAEV/N,EAAE,IAAM+N,EAAE,IACV/N,EAAE,IAAM+N,EAAE,IACV/N,EAAE,IAAM+N,EAAE,IACV/N,EAAE,IAAM+N,EAAE,IAEH/N,EAMR,QAAS6O,cAAad,EAAGe,EAAKC,GAC7B,MAAOhB,GAAEe,EAAQ,EAAJC,GAGd,QAASC,cAAajB,EAAGe,EAAKC,EAAKE,GAClClB,EAAEe,EAAQ,EAAJC,GAASE,EAGhB,QAASC,aAAYnB,EAAG/N,GACvB,MAAO+H,QAAOgG,EAAE/N,EAAE,GAAI+N,EAAE/N,EAAE,GAAI+N,EAAE/N,EAAE,GAAI+N,EAAE/N,EAAE,KAG3C,QAASmP,cAAapB,EAAG/N,EAAGmE,GAC3B4J,EAAE/N,EAAG,GAAKmE,EAAE,GACZ4J,EAAE/N,EAAG,GAAKmE,EAAE,GACZ4J,EAAE/N,EAAG,GAAKmE,EAAE,GACZ4J,EAAE/N,EAAE,IAAMmE,EAAE,GAGb,QAASiL,cAAarB,EAAG/N,EAAG+E,GAC3BgJ,EAAE/N,EAAG,GAAK+E,EACVgJ,EAAE/N,EAAG,GAAK+E,EACVgJ,EAAE/N,EAAG,GAAK+E,EACVgJ,EAAE/N,EAAE,IAAM+E,EAGX,QAASsK,cAAatB,EAAG/N,EAAGe,EAAGU,EAAGkG,EAAGG,GACpCiG,EAAE/N,EAAG,GAAKe,EACVgN,EAAE/N,EAAG,GAAKyB,EACVsM,EAAE/N,EAAG,GAAK2H,EACVoG,EAAE/N,EAAE,IAAM8H,EAGX,QAASwH,aAAYvB,EAAGwB,GACvB,GAAIxR,GAAQ,EAAJwR,CACR,OAAOxH,QAAOgG,EAAEhQ,EAAE,GAAIgQ,EAAEhQ,EAAE,GAAIgQ,EAAEhQ,EAAE,GAAIgQ,EAAEhQ,EAAE,IAG3C,QAASyR,cAAazB,EAAGwB,EAAGpL,GAC3B,GAAIpG,GAAQ,EAAJwR,CACRxB,GAAEhQ,EAAE,GAAKoG,EAAE,GACX4J,EAAEhQ,EAAE,GAAKoG,EAAE,GACX4J,EAAEhQ,EAAE,GAAKoG,EAAE,GACX4J,EAAEhQ,EAAE,GAAKoG,EAAE,GAGZ,QAASsL,cAAa1B,EAAGwB,EAAGxK,GAC3B,GAAIhH,GAAQ,EAAJwR,CACRxB,GAAEhQ,EAAE,GAAKgH,EACTgJ,EAAEhQ,EAAE,GAAKgH,EACTgJ,EAAEhQ,EAAE,GAAKgH,EACTgJ,EAAEhQ,EAAE,GAAKgH,EAGV,QAAS2K,cAAa3B,EAAGwB,EAAGxO,EAAGU,EAAGkG,EAAGG,GACpC,GAAI/J,GAAQ,EAAJwR,CACRxB,GAAEhQ,EAAE,GAAKgD,EACTgN,EAAEhQ,EAAE,GAAK0D,EACTsM,EAAEhQ,EAAE,GAAK4J,EACToG,EAAEhQ,EAAE,GAAK+J,EAGV,QAAS6H,WAAU5B,GAClB,OACCA,EAAG,GAAIA,EAAG,GAAIA,EAAG,GACjBA,EAAG,GAAIA,EAAG,GAAIA,EAAG,GACjBA,EAAG,GAAIA,EAAG,GAAIA,EAAE,KAIlB,QAAS6B,iBAAgB7B,GACxB,GAAIhQ,GAAI,EACJsG,EAAI,EACJU,EAAI,CACR,KAAKhH,EAAE,EAAK,EAAFA,IAAOA,EAChB,IAAKsG,EAAE,EAAK,EAAFA,IAAOA,EAEhB,GADAU,EAAIgJ,EAAEhQ,EAAI,EAAFsG,GACHtG,GAAKsG,GACT,GAAS,GAALU,EACH,OAAO,MAIR,IAAS,GAALA,EACH,OAAO,CAKX,QAAO,EAGR,QAAS8K,UAAS9B,GAEjB,IAAK,GADD/N,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,IAAMgQ,EAAEhQ,EAEX,OAAOiC,GAGR,QAAS8P,UAAS7M,EAAGC,GAEpB,IAAK,GADDlD,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKkF,EAAElF,GAAKmF,EAAEnF,EAEjB,OAAOiC,GAGR,QAAS+P,WAAUhC,EAAGhJ,GAGrB,IAAK,GADD/E,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKgQ,EAAEhQ,GAAKgH,CAEf,OAAO/E,GAGR,QAASgQ,WAAUjL,EAAGgJ,GACrB,MAAOgC,WAAUhC,EAAGhJ,GAGrB,QAASkL,UAAShN,EAAGC,GAEpB,IAAK,GADDlD,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKkF,EAAElF,GAAKmF,EAAEnF,EAEjB,OAAOiC,GAGR,QAASkQ,WAAUnC,EAAGhJ,GAErB,IAAK,GADD/E,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKgQ,EAAEhQ,GAAKgH,CAEf,OAAO/E,GAGR,QAASmQ,WAAUpL,EAAGgJ,GAErB,IAAK,GADD/N,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKgH,EAAIgJ,EAAEhQ,EAEd,OAAOiC,GAGR,QAASoQ,UAASnN,EAAGC,GACpB,GAAImN,GAAMpN,EAAG,GAAIqN,EAAMrN,EAAG,GAAKsN,EAAKtN,EAAG,GAAIuN,EAAMvN,EAAG,GAChDwN,EAAMxN,EAAG,GAAIyN,EAAMzN,EAAG,GAAK0N,EAAK1N,EAAG,GAAI2N,EAAM3N,EAAG,GAChD4N,EAAM5N,EAAG,GAAI6N,EAAM7N,EAAG,GAAI8N,EAAM9N,EAAE,IAAK+N,EAAM/N,EAAE,IAC/CgO,EAAMhO,EAAE,IAAKiO,EAAMjO,EAAE,IAAKkO,EAAMlO,EAAE,IAAKmO,EAAMnO,EAAE,IAE/CoO,EAAMnO,EAAG,GAAIoO,EAAMpO,EAAG,GAAIqO,EAAMrO,EAAG,GAAIsO,EAAMtO,EAAG,GAChDuO,EAAMvO,EAAG,GAAIwO,EAAMxO,EAAG,GAAIyO,EAAMzO,EAAG,GAAI0O,EAAM1O,EAAG,GAChD2O,EAAM3O,EAAG,GAAI4O,EAAM5O,EAAG,GAAI6O,EAAM7O,EAAE,IAAK8O,EAAM9O,EAAE,IAC/C+O,EAAM/O,EAAE,IAAKgP,EAAMhP,EAAE,IAAKiP,EAAMjP,EAAE,IAAKkP,EAAMlP,EAAE,IAE/ClD,EAAI4N,YA4CR,OA1CA5N,GAAG,GAAKqQ,EAAGgB,EAAKZ,EAAGa,EAAKT,EAAGU,EAAMN,EAAIO,EACrCxR,EAAG,GAAKsQ,EAAGe,EAAKX,EAAGY,EAAKR,EAAGS,EAAML,EAAIM,EACrCxR,EAAG,GAAKuQ,EAAGc,EAAKV,EAAGW,EAAKP,EAAIQ,EAAKJ,EAAIK,EACrCxR,EAAG,GAAKwQ,EAAGa,EAAKT,EAAGU,EAAKN,EAAIO,EAAKH,EAAII,EAErCxR,EAAG,GAAKqQ,EAAGoB,EAAKhB,EAAGiB,EAAKb,EAAGc,EAAMV,EAAIW,EACrC5R,EAAG,GAAKsQ,EAAGmB,EAAKf,EAAGgB,EAAKZ,EAAGa,EAAMT,EAAIU,EACrC5R,EAAG,GAAKuQ,EAAGkB,EAAKd,EAAGe,EAAKX,EAAIY,EAAKR,EAAIS,EACrC5R,EAAG,GAAKwQ,EAAGiB,EAAKb,EAAGc,EAAKV,EAAIW,EAAKP,EAAIQ,EAErC5R,EAAG,GAAKqQ,EAAGwB,EAAKpB,EAAGqB,EAAKjB,EAAGkB,EAAOd,EAAIe,EACtChS,EAAG,GAAKsQ,EAAGuB,EAAKnB,EAAGoB,EAAKhB,EAAGiB,EAAOb,EAAIc,EACtChS,EAAE,IAAMuQ,EAAGsB,EAAKlB,EAAGmB,EAAKf,EAAIgB,EAAMZ,EAAIa,EACtChS,EAAE,IAAMwQ,EAAGqB,EAAKjB,EAAGkB,EAAKd,EAAIe,EAAMX,EAAIY,EAEtChS,EAAE,IAAMqQ,EAAG4B,EAAMxB,EAAGyB,EAAMrB,EAAGsB,EAAOlB,EAAImB,EACxCpS,EAAE,IAAMsQ,EAAG2B,EAAMvB,EAAGwB,EAAMpB,EAAGqB,EAAOjB,EAAIkB,EACxCpS,EAAE,IAAMuQ,EAAG0B,EAAMtB,EAAGuB,EAAMnB,EAAIoB,EAAMhB,EAAIiB,EACxCpS,EAAE,IAAMwQ,EAAGyB,EAAMrB,EAAGsB,EAAMlB,EAAImB,EAAMf,EAAIgB,EAwBjCpS,EA6BR,QAASqS,WAAUtE,EAAGhJ,GAErB,IAAK,GADD/E,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKgQ,EAAEhQ,GAAKgH,CAEf,OAAO/E,GAGR,QAASsS,WAAUvN,EAAGgJ,GACrB,MAAOsE,WAAUtE,EAAGhJ,GAGrB,QAASwN,YAAWxE,EAAG5J,EAAG2D,GACzB,OACCiG,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAE,IAAMjG,EACrDiG,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAE,IAAMjG,EACrDiG,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAE,IAAM5J,EAAE,GAAK4J,EAAE,IAAMjG,GAKvD,QAAS0K,YAAWzE,EAAG5J,GACtB,OACC4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAE,IAAM5J,EAAE,GACvD4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAE,IAAM5J,EAAE,GACvD4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAE,IAAM5J,EAAE,GAAK4J,EAAE,IAAM5J,EAAE,GACvD4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAG,GAAK5J,EAAE,GAAK4J,EAAE,IAAM5J,EAAE,GAAK4J,EAAE,IAAM5J,EAAE,IAIzD,QAASsO,WAAU1E,EAAGhJ,GAErB,IAAK,GADD/E,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKgQ,EAAEhQ,GAAKgH,CAEf,OAAO/E,GAGR,QAAS0S,WAAU3N,EAAGgJ,GAErB,IAAK,GADD/N,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKgH,EAAIgJ,EAAEhQ,EAEd,OAAOiC,GAGR,QAAS2S,UAAS5E,GACjB,MAAO2E,WAAU,EAAK3E,GAGvB,QAAS6E,cAAa3P,EAAGC,GAExB,IAAK,GADDlD,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKkF,EAAElF,GAAKmF,EAAEnF,EAEjB,OAAOiC,GAGR,QAAS6S,cAAa5P,EAAGC,GAExB,IAAK,GADDlD,GAAI4N,aACC7P,EAAE,EAAK,GAAFA,IAAQA,EACrBiC,EAAEjC,GAAKkF,EAAElF,GAAKmF,EAAEnF,EAEjB,OAAOiC,GAGR,QAAS8S,gBAAe/E,GACvB,GAAI/N,GAAI4N,YAsBR,OApBA5N,GAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAE,IAEV/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAE,IAEV/N,EAAG,GAAK+N,EAAG,GACX/N,EAAG,GAAK+N,EAAG,GACX/N,EAAE,IAAM+N,EAAE,IACV/N,EAAE,IAAM+N,EAAE,IAEV/N,EAAE,IAAM+N,EAAG,GACX/N,EAAE,IAAM+N,EAAG,GACX/N,EAAE,IAAM+N,EAAE,IACV/N,EAAE,IAAM+N,EAAE,IAEH/N,EAGR,QAAS+S,kBAAiBhF,GACzB,GAAIiF,GAAMjF,EAAG,GAAIkF,EAAMlF,EAAG,GAAImF,EAAMnF,EAAG,GAAIoF,EAAMpF,EAAG,GAChDqF,EAAMrF,EAAG,GAAIsF,EAAMtF,EAAG,GAAIuF,EAAMvF,EAAG,GAAIwF,EAAMxF,EAAG,GAChDyF,EAAMzF,EAAG,GAAI0F,EAAM1F,EAAG,GAAI2F,EAAM3F,EAAE,IAAKM,EAAMN,EAAE,IAC/C4F,EAAM5F,EAAE,IAAK6F,EAAM7F,EAAE,IAAK8F,EAAM9F,EAAE,IAAK+F,EAAM/F,EAAE,GAEnD,OACC4F,GAAMF,EAAKH,EAAKH,EAAKK,EAAKI,EAAMN,EAAKH,EAAKQ,EAAMN,EAAKK,EAAMP,EAAKC,EAAKQ,EAAMF,EAAMP,EACjFK,EAAKH,EAAKQ,EAAMV,EAAKC,EAAKK,EAAKI,EAAMV,EAAKQ,EAAMF,EAAKP,EAAKK,EAAKC,EAAKI,EAAMV,EAAKK,EAC/EI,EAAMV,EAAKS,EAAMH,EAAKP,EAAKY,EAAMF,EAAMH,EAAKC,EAAKP,EAAKY,EAAMN,EAAKP,EAAKS,EAAKI,EAAMN,EACjFI,EAAMN,EAAKH,EAAK7E,EAAM+E,EAAKQ,EAAMV,EAAK7E,EAAMsF,EAAMV,EAAKK,EAAKjF,EAAM2E,EAAKY,EAAMN,EAAKjF,EAClF+E,EAAKH,EAAKY,EAAMxF,EAAM2E,EAAKK,EAAKQ,EAAMxF,EAAMmF,EAAKH,EAAKH,EAAKY,EAAMV,EAAKK,EAAKP,EAAKY,EAChFN,EAAKP,EAAKK,EAAKQ,EAAMd,EAAKS,EAAKH,EAAKQ,EAAMV,EAAKH,EAAKS,EAAMI,EAAMd,EAAKK,EAAKK,EAAMI,EAIlF,QAASC,cAAahG,GACrB,GAAIiF,GAAMjF,EAAG,GAAIkF,EAAMlF,EAAG,GAAImF,EAAMnF,EAAG,GAAIoF,EAAMpF,EAAG,GAChDqF,EAAMrF,EAAG,GAAIsF,EAAMtF,EAAG,GAAIuF,EAAMvF,EAAG,GAAIwF,EAAMxF,EAAG,GAChDyF,EAAMzF,EAAG,GAAI0F,EAAM1F,EAAG,GAAI2F,EAAM3F,EAAE,IAAKM,EAAMN,EAAE,IAC/C4F,EAAM5F,EAAE,IAAK6F,EAAM7F,EAAE,IAAK8F,EAAM9F,EAAE,IAAK+F,EAAM/F,EAAE,IAE/CjO,EAAI8N,YAER9N,GAAG,GAAM2T,EAAGI,EAAIN,EAAGK,EAAIF,EAAIH,EAAGK,EAAIN,EAAGjF,EAAIgF,EAAGQ,EAAIxF,EAAIoF,EAAGH,EAAGQ,EAAIT,EAAGK,EAAII,EACrEhU,EAAG,GAAM8T,EAAIF,EAAIP,EAAGM,EAAGI,EAAIV,EAAGS,EAAIV,EAAG7E,EAAI4E,EAAGY,EAAIxF,EAAIoF,EAAGP,EAAGY,EAAIb,EAAGS,EAAII,EACrEhU,EAAG,GAAMuT,EAAGQ,EAAIV,EAAGS,EAAIN,EAAGH,EAAGS,EAAIV,EAAGK,EAAGN,EAAGY,EAAIN,EAAGF,EAAGH,EAAGY,EAAIb,EAAGK,EAAGQ,EACjEhU,EAAG,GAAM2T,EAAGH,EAAGH,EAAGE,EAAGK,EAAIP,EAAGM,EAAGP,EAAGK,EAAGN,EAAGS,EAAIH,EAAGF,EAAGH,EAAG7E,EAAI4E,EAAGK,EAAGjF,EAE/DvO,EAAG,GAAM6T,EAAID,EAAIH,EAAGC,EAAGK,EAAIN,EAAGI,EAAIL,EAAGjF,EAAI+E,EAAGS,EAAIxF,EAAImF,EAAGF,EAAGQ,EAAIV,EAAGM,EAAII,EACrEhU,EAAG,GAAM0T,EAAGK,EAAIV,EAAGQ,EAAID,EAAIP,EAAGQ,EAAIT,EAAG7E,EAAI2E,EAAGa,EAAIxF,EAAImF,EAAGN,EAAGY,EAAId,EAAGU,EAAII,EACrEhU,EAAG,GAAM6T,EAAIL,EAAGH,EAAGC,EAAGS,EAAIV,EAAGQ,EAAIT,EAAGK,EAAGP,EAAGa,EAAIN,EAAGH,EAAGF,EAAGY,EAAId,EAAGM,EAAGQ,EACjEhU,EAAG,GAAMsT,EAAGM,EAAIP,EAAGK,EAAGF,EAAGH,EAAGK,EAAGN,EAAGK,EAAGP,EAAGU,EAAIH,EAAGH,EAAGF,EAAG7E,EAAI2E,EAAGM,EAAGjF,EAE/DvO,EAAG,GAAM0T,EAAGI,EAAIL,EAAGI,EAAIF,EAAGF,EAAGI,EAAIN,EAAGhF,EAAI+E,EAAGQ,EAAIvF,EAAImF,EAAGH,EAAGS,EAAIV,EAAGK,EAAGK,EACnEhU,EAAG,GAAM6T,EAAIF,EAAGN,EAAGK,EAAGI,EAAIT,EAAGQ,EAAIV,EAAG5E,EAAI2E,EAAGY,EAAIvF,EAAImF,EAAGP,EAAGa,EAAId,EAAGS,EAAGK,EACnEhU,EAAE,IAAOsT,EAAGQ,EAAIT,EAAGQ,EAAIN,EAAGF,EAAGQ,EAAIV,EAAGM,EAAGP,EAAGY,EAAIL,EAAGH,EAAGH,EAAGa,EAAId,EAAGK,EAAGS,EACjEhU,EAAE,IAAO0T,EAAGH,EAAGF,EAAGC,EAAGK,EAAGN,EAAGK,EAAGP,EAAGM,EAAGP,EAAGS,EAAGF,EAAGH,EAAGH,EAAG5E,EAAI2E,EAAGK,EAAGhF,EAE7DvO,EAAE,IAAO6T,EAAIF,EAAGH,EAAGE,EAAGI,EAAIN,EAAGK,EAAIN,EAAGK,EAAIN,EAAGQ,EAAIF,EAAIF,EAAGH,EAAGQ,EAAIT,EAAGK,EAAGI,EACnE/T,EAAE,IAAO0T,EAAGI,EAAIV,EAAGS,EAAIF,EAAGP,EAAGS,EAAIV,EAAGS,EAAIV,EAAGY,EAAIF,EAAIF,EAAGP,EAAGY,EAAIb,EAAGS,EAAGI,EACnE/T,EAAE,IAAO6T,EAAIN,EAAGH,EAAGE,EAAGQ,EAAIV,EAAGS,EAAIV,EAAGK,EAAGN,EAAGY,EAAIN,EAAGF,EAAGH,EAAGY,EAAIb,EAAGK,EAAGQ,EACjE/T,EAAE,IAAOsT,EAAGK,EAAGP,EAAGM,EAAGH,EAAGH,EAAGM,EAAGP,EAAGK,EAAGN,EAAGS,EAAGH,EAAGF,EAAGH,EAAGS,EAAIV,EAAGK,EAAGK,CAW7D,KAAK,GATD3O,GAAI,GACP4O,EAAMF,EAAKH,EAAKH,EAAKK,EAAKI,EAAMN,EAAKH,EAAKQ,EAAMN,EAAKK,EAAMP,EAAKC,EAAKQ,EAAMF,EAAMP,EACjFK,EAAKH,EAAKQ,EAAMV,EAAKC,EAAKK,EAAKI,EAAMV,EAAKQ,EAAMF,EAAKP,EAAKK,EAAKC,EAAKI,EAAMV,EAAKK,EAC/EI,EAAMV,EAAKS,EAAMH,EAAKP,EAAKY,EAAMF,EAAMH,EAAKC,EAAKP,EAAKY,EAAMN,EAAKP,EAAKS,EAAKI,EAAMN,EACjFI,EAAMN,EAAKH,EAAK7E,EAAM+E,EAAKQ,EAAMV,EAAK7E,EAAMsF,EAAMV,EAAKK,EAAKjF,EAAM2E,EAAKY,EAAMN,EAAKjF,EAClF+E,EAAKH,EAAKY,EAAMxF,EAAM2E,EAAKK,EAAKQ,EAAMxF,EAAMmF,EAAKH,EAAKH,EAAKY,EAAMV,EAAKK,EAAKP,EAAKY,EAChFN,EAAKP,EAAKK,EAAKQ,EAAMd,EAAKS,EAAKH,EAAKQ,EAAMV,EAAKH,EAAKS,EAAMI,EAAMd,EAAKK,EAAKK,EAAMI,GAGxE/V,EAAE,EAAK,GAAFA,IAAQA,EAAG+B,EAAE/B,IAAMgH,CAEjC,OAAOjF,GAGR,QAASkU,YAAWjG,GACnB,MAAQA,GAAE,GAAKA,EAAE,GAAKA,EAAE,IAAMA,EAAE,IAGjC,QAASkG,mBAAkB9P,GAC1B,GAAI4J,GAAIW,eAIR,OAHAX,GAAE,IAAM5J,EAAE,GACV4J,EAAE,IAAM5J,EAAE,GACV4J,EAAE,IAAM5J,EAAE,GACH4J,EAGR,QAASmG,mBAAkBnT,EAAGU,EAAGkG,GAChC,MAAOsM,oBAAmBlT,EAAGU,EAAGkG,IAGjC,QAASwM,mBAAkBpP,GAC1B,MAAOmP,mBAAkBnP,EAAGA,EAAGA,GAGhC,QAASqP,yBAAwBC,EAAUC,GAC1C,GASIC,GAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAThCC,EAAKvL,gBAAgB6K,GACrBvP,EAAKhD,OAAOsS,GACZ9E,EAAKpN,OAAOkS,GACZY,EAAM,EAAM1F,EAEZxO,EAAIiU,EAAG,GACPvT,EAAIuT,EAAG,GACPrN,EAAIqN,EAAG,EAIXT,GAAKxT,EAAIA,EACTyT,EAAK/S,EAAIA,EACTgT,EAAK9M,EAAIA,EACT+M,EAAK3T,EAAIU,EACTkT,EAAKlT,EAAIkG,EACTiN,EAAKjN,EAAI5G,EACT8T,EAAK9T,EAAIgE,EACT+P,EAAKrT,EAAIsD,EACTgQ,EAAKpN,EAAI5C,CAET,IAAIgJ,GAAIH,YAsBR,OApBAG,GAAG,GAAMkH,EAAIV,EAAMhF,EACnBxB,EAAG,GAAMkH,EAAIP,EAAMK,EACnBhH,EAAG,GAAMkH,EAAIL,EAAME,EACnB/G,EAAG,GAAK,EAERA,EAAG,GAAMkH,EAAIP,EAAMK,EACnBhH,EAAG,GAAMkH,EAAIT,EAAMjF,EACnBxB,EAAG,GAAMkH,EAAIN,EAAME,EACnB9G,EAAG,GAAK,EAERA,EAAG,GAAMkH,EAAIL,EAAME,EACnB/G,EAAG,GAAMkH,EAAIN,EAAME,EACnB9G,EAAE,IAAOkH,EAAIR,EAAMlF,EACnBxB,EAAE,IAAM,EAERA,EAAE,IAAM,EACRA,EAAE,IAAM,EACRA,EAAE,IAAM,EACRA,EAAE,IAAM,EAEDA,EAGR,QAASmH,yBAAwBb,EAAUW,EAAIG,EAAIC,GAClD,MAAOhB,yBAAwBC,GAAWW,EAAIG,EAAIC,IAGnD,QAASC,eAAclR,GACtB,GAAI4J,GAAIW,eAIR,OAHAX,GAAG,GAAK5J,EAAE,GACV4J,EAAG,GAAK5J,EAAE,GACV4J,EAAE,IAAM5J,EAAE,GACH4J,EAGR,QAASuH,eAAcvU,EAAGU,EAAGkG,GAC5B,MAAO0N,gBAAetU,EAAGU,EAAGkG,IAG7B,QAAS4N,eAAcxQ,GACtB,MAAOuQ,eAAcvQ,EAAGA,EAAGA,GAG5B,QAASyQ,cAAaC,EAAUC,EAAQC,GACvC,GAAIxR,GAAIsF,gBAAgBd,SAAS+M,EAAQD,IACrClQ,EAAIkE,gBAAgBkM,GACpB5Q,EAAI0E,gBAAgBH,WAAWnF,EAAGoB,GAEtCA,GAAIkE,gBAAgBH,WAAWvE,EAAGZ,GAElC,IAAI4J,GAAIH,YAwBR,OAtBAG,GAAG,GAAMhJ,EAAE,GACXgJ,EAAG,GAAMxI,EAAE,GACXwI,EAAG,IAAM5J,EAAE,GACX4J,EAAG,GAAO,EAEVA,EAAG,GAAMhJ,EAAE,GACXgJ,EAAG,GAAMxI,EAAE,GACXwI,EAAG,IAAM5J,EAAE,GACX4J,EAAG,GAAO,EAEVA,EAAG,GAAMhJ,EAAE,GACXgJ,EAAG,GAAMxI,EAAE,GACXwI,EAAE,KAAO5J,EAAE,GACX4J,EAAE,IAAQ,EAEVA,EAAE,IAAQ,EACVA,EAAE,IAAQ,EACVA,EAAE,IAAQ,EACVA,EAAE,IAAQ,EAEVA,EAAIqC,SAASrC,EAAGkG,kBAAkB1L,SAASkN,KAK5C,QAASG,cAAaC,EAAWC,EAAWC,EAAWC,EAASC,EAASC,EAASC,EAAKC,EAAKC,GAC3F,MAAOb,eAAcK,EAAWC,EAAWC,IAAaC,EAASC,EAASC,IAAWC,EAAKC,EAAKC,IAGhG,QAASC,aAAYC,EAAMC,GAC1B,GAAIC,GAAQjO,SAASgO,EAAMD,GACvBG,EAAQ/N,SAAS6N,EAAMD,GAEvBxI,EAAIH,YAsBR,OApBAG,GAAG,GAAU,EAAM2I,EAAI,GACvB3I,EAAG,GAAmB,EACtBA,EAAG,GAAmB,EACtBA,EAAG,GAAmB,EAEtBA,EAAG,GAAmB,EACtBA,EAAG,GAAU,EAAM2I,EAAI,GACvB3I,EAAG,GAAmB,EACtBA,EAAG,GAAmB,EAEtBA,EAAG,GAAmB,EACtBA,EAAG,GAAmB,EACtBA,EAAE,IAAU,GAAO2I,EAAI,GACvB3I,EAAE,IAAsB,EAExBA,EAAE,KAAQ0I,EAAI,GAAKC,EAAI,GACvB3I,EAAE,KAAQ0I,EAAI,GAAKC,EAAI,GACvB3I,EAAE,KAAQ0I,EAAI,GAAKC,EAAI,GACvB3I,EAAE,IAAoB,EAEfA,EAGR,QAAS4I,aAAYC,EAAMC,EAAOC,EAAQC,EAAKC,EAAOC,GACrD,MAAOX,cAAaM,EAAME,EAAQE,IAASH,EAAOE,EAAKE,IAGxD,QAASC,eAAcC,EAAMC,GAC5B,GAAIX,GAAQjO,SAAS4O,EAAMD,GACvBT,EAAQ/N,SAASyO,EAAMD,GACvBrX,EAAQ,EAAMqX,EAAK,GAEnBpJ,EAAIH,YAsBR,OApBAG,GAAG,GAAgBjO,EAAI4W,EAAI,GAC3B3I,EAAG,GAAuB,EAC1BA,EAAG,GAAuB,EAC1BA,EAAG,GAAuB,EAE1BA,EAAG,GAAuB,EAC1BA,EAAG,GAAgBjO,EAAI4W,EAAI,GAC3B3I,EAAG,GAAuB,EAC1BA,EAAG,GAAuB,EAE1BA,EAAG,GAAW0I,EAAI,GAAKC,EAAI,GAC3B3I,EAAG,GAAW0I,EAAI,GAAKC,EAAI,GAC3B3I,EAAE,KAAY0I,EAAI,GAAKC,EAAI,GAC3B3I,EAAE,IAAuB,GAEzBA,EAAE,IAAwB,EAC1BA,EAAE,IAAwB,EAC1BA,EAAE,KAAOjO,EAAIsX,EAAK,GAAKV,EAAI,GAC3B3I,EAAE,IAAwB,EAEnBA,EAGR,QAASsJ,eAAcT,EAAMC,EAAOC,EAAQC,EAAKC,EAAOC,GACvD,MAAOC,gBAAeN,EAAME,EAAQE,IAASH,EAAOE,EAAKE,IAG1D,QAASK,kBAAiBC,EAASC,EAAaR,EAAOC,GACtD,GAAIQ,GAAO3M,aACP4M,EAAO5M,YAWX,OATA2M,GAAK,GAAKT,EACVU,EAAK,GAAKT,EAEVS,EAAK,GAAKD,EAAK,GAAKlV,OAAOgV,EAAU,GACrCE,EAAK,IAAMC,EAAK,GAEhBA,EAAK,GAAKA,EAAK,GAAKF,EACpBC,EAAK,IAAMC,EAAK,GAETR,cAAcO,EAAMC,GAO5B,QAASC,cAAaxT,GACrB,MAAO,IAAItF,OAAM,GAGlB,QAAS+Y,UAASzT,GACjB,MAAOA,GAAErF,MAAM,EAAG,GAGnB,QAAS+Y,mBACR,OAAS,EAAK,EAAK,EAAK,GAGzB,QAASC,kBAAiBzD,EAAUC,GACnC,GAAIyD,GAAY1D,EAAW,EACvB2D,EAAOjW,OAAOgW,EAClB,QACCC,EAAO1D,EAAK,GACZ0D,EAAO1D,EAAK,GACZ0D,EAAO1D,EAAK,GACZnS,OAAO4V,IAIT,QAASE,WAAUlK,GAClB,GAAImK,GAAQrJ,aAAad,EAAG,EAAG,GAAKc,aAAad,EAAG,EAAG,GAAKc,aAAad,EAAG,EAAG,GAC3EoK,EAAO,KACPlD,EAAI0C,cAER,IAAIO,EAAQ,EACXC,EAAO7W,QAAQ4W,EAAQ,GACvBjD,EAAE,GAAKkD,EAAO,EACdA,EAAO,GAAMA,EACblD,EAAE,IAAMpG,aAAad,EAAG,EAAG,GAAKc,aAAad,EAAG,EAAG,IAAMoK,EACzDlD,EAAE,IAAMpG,aAAad,EAAG,EAAG,GAAKc,aAAad,EAAG,EAAG,IAAMoK,EACzDlD,EAAE,IAAMpG,aAAad,EAAG,EAAG,GAAKc,aAAad,EAAG,EAAG,IAAMoK,MAErD,CACJ,GAAIpa,GAAI,CAEJ8Q,cAAad,EAAG,EAAG,GAAKc,aAAad,EAAG,EAAG,KAAIhQ,EAAI,GACnD8Q,aAAad,EAAG,EAAG,GAAKc,aAAad,EAAGhQ,EAAGA,KAAIA,EAAI,EAEvD,IAAIsG,IAAKtG,EAAI,GAAK,EACdqG,GAAKC,EAAI,GAAK,CAElB8T,GAAO7W,QAAQuN,aAAad,EAAGhQ,EAAGA,GAAK8Q,aAAad,EAAG1J,EAAGA,GAAKwK,aAAad,EAAG3J,EAAGA,GAAK,GAEvF6Q,EAAElX,GAAKoa,EAAO,EACdA,EAAO,GAAMA,EACblD,EAAE,IAAMpG,aAAad,EAAG3J,EAAGC,GAAKwK,aAAad,EAAG1J,EAAGD,IAAM+T,EACzDlD,EAAE5Q,IAAMwK,aAAad,EAAG1J,EAAGtG,GAAK8Q,aAAad,EAAGhQ,EAAGsG,IAAM8T,EACzDlD,EAAE7Q,IAAMyK,aAAad,EAAG3J,EAAGrG,GAAK8Q,aAAad,EAAGhQ,EAAGqG,IAAM+T,EAE1D,MAAOlD,GAGR,QAASmD,qBAAoBnD,GAC5B,GAAI9Q,GAAI,GAAItF,OAAM,GAEdwZ,EAAQjM,cAAc6I,EAG1B,IAAIoD,EAAQ,EAAK,CAChB,GAAIC,GAAS,EAAMhX,QAAQ+W,EAC3BlU,GAAE,GAAK8Q,EAAE,GAAKqD,EACdnU,EAAE,GAAK8Q,EAAE,GAAKqD,EACdnU,EAAE,GAAK8Q,EAAE,GAAKqD,EACdnU,EAAE,GAAK,EAAMoU,QAAQtD,EAAE,QAIvB9Q,GAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,EACPA,EAAE,GAAK,CAGR,OAAOA,GAGR,QAASqU,sBAAqBvD,GAC7B,GAAIwD,GAAM,EAAMxD,EAAE,GACdyD,EAAM,EAAMzD,EAAE,GACd0D,EAAM,EAAM1D,EAAE,GACd2D,EAAMH,EAAKxD,EAAE,GACb4D,EAAMH,EAAKzD,EAAE,GACb6D,EAAMH,EAAK1D,EAAE,GACb8D,EAAMN,EAAKxD,EAAE,GACb+D,EAAMN,EAAKzD,EAAE,GACbgE,EAAMN,EAAK1D,EAAE,GACbiE,EAAMR,EAAKzD,EAAE,GACbkE,EAAMR,EAAK1D,EAAE,GACbmE,EAAMT,EAAK1D,EAAE,GAEblH,EAAIW,eAYR,OAVAM,cAAajB,EAAG,EAAG,EAAG,GAAOmL,EAAME,IACnCpK,aAAajB,EAAG,EAAG,EAAGiL,EAAMF,GAC5B9J,aAAajB,EAAG,EAAG,EAAGkL,EAAMJ,GAC5B7J,aAAajB,EAAG,EAAG,EAAGiL,EAAMF,GAC5B9J,aAAajB,EAAG,EAAG,EAAG,GAAOgL,EAAMK,IACnCpK,aAAajB,EAAG,EAAG,EAAGoL,EAAMP,GAC5B5J,aAAajB,EAAG,EAAG,EAAGkL,EAAMJ,GAC5B7J,aAAajB,EAAG,EAAG,EAAGoL,EAAMP,GAC5B5J,aAAajB,EAAG,EAAG,EAAG,GAAOgL,EAAMG,IAE5BnL,EAGR,QAASsL,mBAAkBpE,GAC1B,MAAO3I,iBAAgB2I,GAGxB,QAASqE,YAAWC,EAAIC,GACvB,GAAIxZ,GAAI2X,cAER3X,GAAE,GAAKyZ,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAC1DjV,EAAE,GAAKyZ,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAC1DjV,EAAE,GAAKyZ,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAC1DjV,EAAE,GAAKyZ,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAAKwE,EAAE,GAAKxE,EAAE,GAuC3D,QAASyE,WACRtb,KAAK+F,EAAI,GAAItF,OAAM,EACnB,IAAItC,GAAIyC,UAAUpB,MAClB,QAAQrB,GACP,IAAK,GACAyC,UAAU,YAAcH,OAC3BT,KAAKub,OAAO3a,UAAU,IAEdA,UAAU,YAAc0a,SAChCtb,KAAKub,OAAO3a,UAAU,GAAGmF,GAGzB/F,KAAKwb,UAAU5a,UAAU,GAE3B,MACA,KAAK,GACJZ,KAAKub,OAAO3a,UACb,MACA,SACCZ,KAAKyb,WA8IR,QAASC,WACR1b,KAAK+F,EAAI,GAAItF,OAAM,EACnB,IAAItC,GAAIyC,UAAUpB,MAClB,QAAQrB,GACP,IAAK,GACAyC,UAAU,YAAcH,OAC3BT,KAAKub,OAAO3a,UAAU,IAEdA,UAAU,YAAc8a,SAChC1b,KAAKub,OAAO3a,UAAU,GAAGmF,GAGzB/F,KAAKwb,UAAU5a,UAAU,GAE3B,MACA,KAAK,GACJZ,KAAKub,OAAO3a,UACb,MACA,SACCZ,KAAKyb,WAsJR,QAASE,WACR3b,KAAK+F,EAAI,GAAItF,OAAM,EACnB,IAAItC,GAAIyC,UAAUpB,MAClB,QAAQrB,GACP,IAAK,GACAyC,UAAU,YAAcH,OAC3BT,KAAKub,OAAO3a,UAAU,IAEdA,UAAU,YAAc+a,SAChC3b,KAAKub,OAAO3a,UAAU,GAAGmF,GAGzB/F,KAAKwb,UAAU5a,UAAU,GAE3B,MACA,KAAK,GACJZ,KAAKub,OAAO3a,UACb,MACA,SACCZ,KAAKyb,WA4LR,QAASG,WAAUC,EAAQC,EAAQC,GAClC/b,KAAKgc,SAAY,EAAK,EAAK,GAC3Bhc,KAAKic,QAAU,EAEXJ,GAAUC,GACb9b,KAAKkc,MAAML,EAAQC,EAAQC,GA6C7B,QAASI,SAAQpX,EAAKE,GACrBjF,KAAKoc,MAAU,EAAM,EAAM,GAC3Bpc,KAAKqc,MAAS,GAAM,GAAM,IAEtBtX,GAAOE,GACVjF,KAAKkc,MAAMnX,EAAKE,GA0IlB,QAASqX,YAAWC,EAAQC,GAC3Bxc,KAAKyc,SAAY,EAAK,EAAK,GAC3Bzc,KAAK0c,QAAU,GAEXH,GAAUC,GACbxc,KAAKkc,MAAMK,EAAQC,GAgFrB,QAASG,kBACR3c,KAAK4c,MACL5c,KAAK4c,GAAG/c,KAAKyQ,iBACbtQ,KAAK6c,GAAK,EAsGX,QAASC,qBACR9c,KAAK+c,IAAM,GAAIJ,gBACf3c,KAAKgd,IAAM,GAAIL,gBACf3c,KAAKid,IAAM,GAAIN,gBA4KhB,QAASO,oBACRld,KAAK6b,QAAe,EAAK,EAAK,GAC9B7b,KAAK8b,OAAa,EAClB9b,KAAKmd,YAAe,EAAG,EAAG,GA+B3B,QAASC,YAAWC,EAAkBC,EAAiBC,GACtDvd,KAAKwd,WAAmBlN,gBACxBtQ,KAAKyd,WAAqB,EAAG,EAAG,EAAG,GACnCzd,KAAK0d,KAAqB,EAAG,EAAG,EAAG,GACnC1d,KAAK2d,iBAAmBrN,gBAExBtQ,KAAK4d,QAAU,GAAInd,OAAM,EACzB,KAAK,GAAId,GAAE,EAAK,EAAFA,IAAOA,EACpBK,KAAK4d,QAAQje,GAAK,GAAIud,iBAGnBG,IAAoBC,GAAmBC,GAC1Cvd,KAAKkc,MAAMmB,EAAkBC,EAAiBC,GAmHhD,QAASM,kBAAiBC,EAA2BC,EAAQC,GAC5D,GAAIC,GAAK,GAAIb,YAAWU,EACxB,OAAOG,GAAGC,cAAcH,EAAQC,GAmCjC,QAASG,wBAAuBC,EAAaC,GAE5C,GAAIA,EACH,IAAK,GAAIC,KAAQD,GAChBD,EAAYE,GAAQD,EAAYC,EAGlC,OAAOF,GAOR,QAASG,qBAAoBC,EAAIC,GAChC,GAAIC,IACHC,MAAQH,EAAGI,YAEZ,OAAOT,wBAAuBO,EAAKD,GAOpC,QAASI,iBACR7e,KAAK8e,OAAS,KACd9e,KAAK+e,OAAS,EACd/e,KAAKsX,OAAS,EACdtX,KAAKuF,KAAS,EACdvF,KAAK2e,MAAS,EAGf,QAASK,mBAAkBR,EAAIlH,EAAQ2H,EAAQR,GAC9C,GAAIC,GAAMH,oBAAoBC,EAAIC,GAC9BS,EAAOV,EAAGW,cACdX,GAAGY,WAAW9H,EAAQ4H,GACtBV,EAAGa,WAAW/H,EAAQ2H,EAAQP,EAAIC,OAClCH,EAAGY,WAAW9H,EAAQ,KAEtB,IAAIgI,GAAM,GAAIT,cAOd,OANAS,GAAIR,OAASI,EACbI,EAAIP,OAAS,EACbO,EAAIhI,OAASA,EACbgI,EAAI/Z,KAAS0Z,EAAOM,YACpBD,EAAIX,MAASD,EAAIC,MAEVW,EAGR,QAASE,yBAAwBhB,EAAIS,EAAQN,GAC5C,MAAOK,mBAAkBR,EAAIA,EAAGiB,aAAcR,EAAQN,GAGvD,QAASe,wBAAuBlB,EAAIS,EAAQN,GAC3C,MAAOK,mBAAkBR,EAAIA,EAAGmB,qBAAsBV,EAAQN,GAW/D,QAASiB,iBACR5f,KAAK8e,OAAS,KACd9e,KAAK+e,OAAS,EACd/e,KAAK6f,KAAS,EACd7f,KAAKwD,IAAS,GAGf,QAASsc,qBAAoBtB,EAAIqB,EAAME,GACtC,GAAIvc,GAAM,EACVA,IAAO,0BAEP,IAAIwc,GAAOxB,EAAGyB,aAAaJ,EAC3BrB,GAAG0B,aAAaF,EAAKD,GACrBvB,EAAG2B,cAAcH,GAEjBxc,GAAO,gBACP,IAAIub,IAAQ,CACyC,IAAjDP,EAAG4B,mBAAmBJ,EAAKxB,EAAG6B,gBACjC7c,GAAO,cAGPub,GAAQ,EACRvb,GAAO,WAERA,GAAOgb,EAAG8B,iBAAiBN,GAC3Bxc,GAAO,KACPA,GAAO,0BAEP,IAAI8b,GAAM,GAAIM,cAMd,OALAN,GAAIR,OAASkB,EACbV,EAAIP,MAASA,EACbO,EAAIO,KAASA,EACbP,EAAI9b,IAASA,EAEN8b,EAGR,QAASiB,2BAA0B/B,EAAIuB,GACtC,MAAOD,qBAAoBtB,EAAIA,EAAGgC,cAAeT,GAGlD,QAASU,6BAA4BjC,EAAIuB,GACxC,MAAOD,qBAAoBtB,EAAIA,EAAGkC,gBAAiBX,GAWpD,QAASY,2BACR3gB,KAAK4gB,KAAa,GAClB5gB,KAAK6gB,WAAa,EAGlB7gB,KAAKuF,KAAa,EAClBvF,KAAK8gB,SAAa,GAWnB,QAASC,yBACR/gB,KAAK4gB,KAAa,GAClB5gB,KAAK6gB,WAAa,EAGlB7gB,KAAKuF,KAAa,EAClBvF,KAAK8gB,SAAa,GAWnB,QAASE,yBACRhhB,KAAK4gB,KAAa,GAClB5gB,KAAK6gB,WAAa,EAGlB7gB,KAAKuF,KAAa,EAClBvF,KAAK8gB,SAAa,GAWnB,QAASG,kBACRjhB,KAAK8e,OAAa,KAClB9e,KAAK+e,OAAa,EAClB/e,KAAKkhB,WACLlhB,KAAKmhB,WAAa,GAAIpgB,QACtBf,KAAKohB,SAAa,GAAIrgB,QACtBf,KAAKqhB,SAAa,GAAItgB,QACtBf,KAAKwD,IAAa,GAGnB,QAAS8d,uBAAsB9C,EAAI0C,GAClC,GAAI1d,GAAM,EACVA,IAAO,0BAEP,IAAI+d,GAAM/C,EAAGgD,eACb,KAAK,GAAI7a,KAAKua,GAAS,CACtB,GAAIlB,GAAMkB,EAAQva,EAEjB6X,GAAGiD,aAAaF,EAAKvB,EAAIlB,QAG3BN,EAAGkD,YAAYH,EAEf,IAAIxC,IAAQ,CACZA,GAAQA,GAA6D,GAAnDP,EAAGmD,oBAAoBJ,EAAK/C,EAAGoD,aAMjDpe,GAAO,kBAENA,GADGub,EACI,aAGA,UAERvb,GAAOgb,EAAGqD,kBAAkBN,GAC5B/d,GAAO,KACPA,GAAO,0BAEP,IAAI8b,GAAM,GAAI2B,eACd3B,GAAIR,OAASyC,EACbjC,EAAIP,MAASA,CACb,KAAK,GAAIpY,KAAKua,GAAS,CACtB,GAAIlB,GAAMkB,EAAQva,EAEjB2Y,GAAI4B,QAAQrhB,KAAKmgB,GAGnBV,EAAI9b,IAAMA,CAIV,KAAK,GADD8a,GAAMwD,EAAKjd,EADXkd,EAAgBvD,EAAGmD,oBAAoBJ,EAAK/C,EAAGwD,mBAE1CriB,EAAE,EAAKoiB,EAAFpiB,IAAmBA,EAChC2e,EAAOE,EAAGyD,gBAAgBV,EAAK5hB,GAC1B2e,IACLzZ,EAAO,GAAI8b,yBACX9b,EAAE+b,KAAOtC,EAAKsC,KACd/b,EAAEgc,WAAavC,EAAKuB,KACpBhb,EAAEU,KAAO+Y,EAAK/Y,KACdV,EAAEic,SAAWtC,EAAG0D,kBAAkBX,EAAKjD,EAAKsC,MAC5CtB,EAAI6B,WAAWtc,EAAE+b,MAAQ/b,EAK1B,KAAK,GADDsd,GAAML,EAAK3a,EADXib,EAAiB5D,EAAGmD,oBAAoBJ,EAAK/C,EAAG6D,iBAE3C1iB,EAAE,EAAKyiB,EAAFziB,IAAoBA,EACjCwiB,EAAO3D,EAAG8D,iBAAiBf,EAAK5hB,GAC3BwiB,IACLL,EAAOtD,EAAG+D,mBAAmBhB,EAAKY,EAAKvB,MAClCuB,EAAKtC,MAAQrB,EAAGgE,YAAgBL,EAAKtC,MAAQrB,EAAGiE,cAA+B,OAAbN,EAAKtC,MAC3ElZ,EAAI,GAAIqa,uBACRra,EAAEia,KAAOuB,EAAKvB,KACdja,EAAEka,WAAasB,EAAKtC,KACpBlZ,EAAEpB,KAAO4c,EAAK5c,KACdoB,EAAEma,SAAWgB,EACbxC,EAAI+B,SAAS1a,EAAEia,MAAQja,IAGvBQ,EAAI,GAAI4Z,uBACR5Z,EAAEyZ,KAAOuB,EAAKvB,KACdzZ,EAAE0Z,WAAasB,EAAKtC,KACpB1Y,EAAE5B,KAAO4c,EAAK5c,KACd4B,EAAE2Z,SAAWgB,EACbxC,EAAI8B,SAASja,EAAEyZ,MAAQzZ,GAMzB,OAFAub,8BAA6BlE,EAAIc,GAE1BA,EAGR,QAASqD,uBAAsBnE,EAAIoE,EAAeC,GACjD,GAAI7C,GAAM,KACNkB,IACJ,KAAK,GAAIva,KAAKic,GAAe,CAC5B,GAAI7C,GAAM6C,EAAcjc,EACxBqZ,GAAMO,0BAA0B/B,EAAIuB,GACpCmB,EAAQrhB,KAAKmgB,GAEd,IAAK,GAAIrZ,KAAKkc,GAAiB,CAC9B,GAAI9C,GAAM8C,EAAgBlc,EAC1BqZ,GAAMS,4BAA4BjC,EAAIuB,GACtCmB,EAAQrhB,KAAKmgB,GAEd,MAAOsB,uBAAsB9C,EAAI0C,GAGlC,QAASwB,8BAA6BlE,EAAIsE,GACzC,GAAIvB,GAAMuB,EAAYhE,OAGlBiE,EAAQ,CACZ,KAAK,GAAIhd,KAAK+c,GAAY3B,WAAY,CACrC,GAAI6B,GAAQF,EAAY3B,WAAWpb,EACnCyY,GAAGyE,mBAAmB1B,EAAKwB,EAAOC,EAAMpC,MACxCoC,EAAMlC,SAAWiC,EACjBA,IAGDvE,EAAGkD,YAAYH,EAGf,KAAK,GAAIpa,KAAK2b,GAAY1B,SAAU,CACnC,GAAIe,GAAOW,EAAY1B,SAASja,EAChCgb,GAAKrB,SAAWtC,EAAG+D,mBAAmBhB,EAAKY,EAAKvB,MAGjDpC,EAAG0E,WAAWJ,EAAYhE,OAE1B,IAAIqE,GAAO,CACX,KAAK,GAAIxc,KAAKmc,GAAYzB,SAAU,CACnC,GAAI+B,GAAMN,EAAYzB,SAAS1a,EAC/Byc,GAAItC,SAAWtC,EAAG+D,mBAAmBhB,EAAK6B,EAAIxC,MAC9CpC,EAAG6E,UAAUD,EAAItC,SAAUqC,GAC3BA,KAKF,QAASG,uBAAsB9E,EAAIsE,GAClC,GAAIvB,GAAMuB,EAAYhE,MAEtB,KAAK,GAAI/Y,KAAK+c,GAAY3B,WAAY,CACrC,GAAI6B,GAAQF,EAAY3B,WAAWpb,EACnCid,GAAMlC,SAAWtC,EAAG0D,kBAAkBX,EAAKyB,EAAMpC,MAGlD,IAAK,GAAIzZ,KAAK2b,GAAY1B,SAAU,CACnC,GAAIe,GAAOW,EAAY1B,SAASja,EAChCgb,GAAKrB,SAAWtC,EAAG+D,mBAAmBhB,EAAKY,EAAKvB,MAGjD,IAAK,GAAIja,KAAKmc,GAAYzB,SAAU,CACnC,GAAI+B,GAAMN,EAAYzB,SAAS1a,EAC/Byc,GAAItC,SAAWtC,EAAG+D,mBAAmBhB,EAAK6B,EAAIxC,OAQhD,QAAS2C,sBAAqB/E,EAAIC,GACjC,GAAIC,IACH8E,UAAmBhF,EAAGiF,OACtBC,UAAmBlF,EAAGiF,OACtBE,MAAmBnF,EAAGoF,cACtBC,MAAmBrF,EAAGoF,cACtBE,SAAmB,EACnBC,UAAmBvF,EAAGwF,UACtBC,iBAAmBzF,EAAG0F,qBACtBC,iBAAmB3F,EAAG4F,OACtBC,gBAAmB,EACnBC,OAAmB,EACnBC,kBAAmB,EACnBC,OAAmB,KAEpB,OAAOrG,wBAAuBO,EAAKD,GAOpC,QAASgG,kBACRzkB,KAAK8e,OAAmB,KACxB9e,KAAK+e,OAAmB,EACxB/e,KAAKsX,OAAmB,EACxBtX,KAAK0kB,OAAmB,EACxB1kB,KAAK2kB,MAAmB,EACxB3kB,KAAK4kB,OAAmB,EACxB5kB,KAAKwjB,UAAmB,EACxBxjB,KAAK0jB,UAAmB,EACxB1jB,KAAK2jB,MAAmB,EACxB3jB,KAAK6jB,MAAmB,EACxB7jB,KAAK8jB,SAAmB,EACxB9jB,KAAK+jB,UAAmB,EACxB/jB,KAAKikB,iBAAmB,EACxBjkB,KAAKmkB,iBAAmB,EAGzB,QAASU,sBAAqBrG,EAAIsG,EAAgBH,EAAOC,EAAQG,EAAcC,EAAYC,EAAQxG,GAClG,GAAIC,GAAM6E,qBAAqB/E,EAAIC,EAG9BwG,KAEHA,EADGD,GAAcxG,EAAG0G,MACX,GAAIC,cAAaR,EAAQC,EAAS,GAGlC,GAAIQ,YAAWT,EAAQC,EAAS,GAI3C,IAAIS,GAAM7G,EAAG8G,eACb9G,GAAG+G,YAAY/G,EAAGgH,WAAYH,EAE9B,IAAII,GAAgBjH,EAAGkH,aAAalH,EAAGmH,qBACnCC,EAAiBlH,EAAI4F,SAAU,CAC/BmB,IAAgBG,GACnBpH,EAAGqH,YAAYrH,EAAGmH,oBAAsB,EAAkB,EAAM,GAEjEnH,EAAGsH,WAAWtH,EAAGgH,WAAY,EAAGV,EAAgBH,EAAOC,EAAQ,EAAGG,EAAcC,EAAYC,GACxFQ,GAAgBG,GACnBpH,EAAGqH,YAAYrH,EAAGmH,oBAAsB,EAAiB,EAAM,GAGhEnH,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAGwH,mBAAoBtH,EAAI8E,WAC3DhF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAGyH,mBAAoBvH,EAAIgF,WAC3DlF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAG0H,eAAoBxH,EAAIiF,OAC3DnF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAG2H,eAAoBzH,EAAImF,OACvDnF,EAAIoF,UACPtF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAG4H,mBAAsB1H,EAAIqF,WAC7DvF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAG6H,qBAAsB3H,EAAIuF,kBAC7DzF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAG8H,qBAAsB5H,EAAIyF,mBAE1DzF,EAAI2F,gBACP7F,EAAG6F,eAAe7F,EAAGgH,YAEtBhH,EAAG+G,YAAY/G,EAAGgH,WAAY,KAE9B,IAAIlG,GAAM,GAAImF,eAgBd,OAfAnF,GAAIR,OAAmBuG,EACvB/F,EAAIP,OAAmB,EACvBO,EAAIhI,OAAmBkH,EAAGgH,WAC1BlG,EAAIoF,OAAmBI,EACvBxF,EAAIqF,MAAmBA,EACvBrF,EAAIsF,OAAmBA,EACvBtF,EAAIkE,UAAmB9E,EAAI8E,UAC3BlE,EAAIoE,UAAmBhF,EAAIgF,UAC3BpE,EAAIqE,MAAmBjF,EAAIiF,MAC3BrE,EAAIuE,MAAmBnF,EAAImF,MAC3BvE,EAAIwE,QAAmBpF,EAAIoF,QAC3BxE,EAAIyE,UAAmBrF,EAAIqF,UAC3BzE,EAAI2E,iBAAmBvF,EAAIuF,iBAC3B3E,EAAI6E,iBAAmBzF,EAAIyF,iBAEpB7E,EAGR,QAASiH,uBAAsB/H,EAAIgI,EAAO/H,GACzC,GAAIC,GAAM6E,qBAAqB/E,EAAIC,GAE/B4G,EAAM7G,EAAG8G,eACb9G,GAAG+G,YAAY/G,EAAGgH,WAAYH,EAE9B,IAAII,GAAgBjH,EAAGkH,aAAalH,EAAGmH,qBACnCC,EAAiBlH,EAAI4F,SAAU,CAC/BmB,IAAgBG,GACnBpH,EAAGqH,YAAYrH,EAAGmH,oBAAsB,EAAkB,EAAM,GAEjEnH,EAAGsH,WAAWtH,EAAGgH,WAAY,EAAGhH,EAAGiI,KAAMjI,EAAGiI,KAAMjI,EAAGkI,cAAeF,GAChEf,GAAgBG,GACnBpH,EAAGqH,YAAYrH,EAAGmH,oBAAsB,EAAiB,EAAM,GAGhEnH,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAGwH,mBAAoBtH,EAAI8E,WAC3DhF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAGyH,mBAAoBvH,EAAIgF,WAC3DlF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAG0H,eAAoBxH,EAAIiF,OAC3DnF,EAAGuH,cAAcvH,EAAGgH,WAAYhH,EAAG2H,eAAoBzH,EAAImF,OACvDnF,EAAI2F,gBACP7F,EAAG6F,eAAe7F,EAAGgH,YAEtBhH,EAAG+G,YAAY/G,EAAGgH,WAAY,KAE9B,IAAIlG,GAAM,GAAImF,eAgBd,OAfAnF,GAAIR,OAAmBuG,EACvB/F,EAAIP,OAAmB,EACvBO,EAAIhI,OAAmBkH,EAAGgH,WAC1BlG,EAAIoF,OAAmBlG,EAAGiI,KAC1BnH,EAAIqF,MAAmB6B,EAAM7B,MAC7BrF,EAAIsF,OAAmB4B,EAAM5B,OAC7BtF,EAAIkE,UAAmB9E,EAAI8E,UAC3BlE,EAAIoE,UAAmBhF,EAAIgF,UAC3BpE,EAAIqE,MAAmBjF,EAAIiF,MAC3BrE,EAAIuE,MAAmBnF,EAAImF,MAC3BvE,EAAIwE,SAAmB,EACvBxE,EAAIyE,UAAmB,EACvBzE,EAAI2E,iBAAmB,EACvB3E,EAAI6E,iBAAmB,EAEhB7E,EAGR,QAASqH,qBAAoBnI,EAAI/f,EAAKggB,GACrC,GAAIC,GAAM6E,qBAAqB/E,EAAIC,GAC/Ba,EAAM,GAAImF,gBAEVmC,EAAM,GAAIC,MAad,OAZAD,GAAIE,YAAc,GAClBF,EAAIpC,OAAS,WACZ,GAAIuC,GAAUR,sBAAsB/H,EAAIoI,EAAKlI,EAC7C,KAAK,GAAI7Z,KAAKkiB,GACbzH,EAAIza,GAAKkiB,EAAQliB,EAEd6Z,GAAI8F,QACP9F,EAAI8F,OAAOhG,EAAIc,EAAK7gB,IAGtBmoB,EAAI7G,IAAMthB,EAEH6gB,EAMR,QAAS0H,wBAAuBxI,EAAIsG,EAAgBH,EAAOC,EAAQG,EAAcC,EAAYiC,EAAaxI,GACzG,GAAIC,GAAM6E,qBAAqB/E,EAAIC,EAGnC,KAAKwI,EAAa,CACjB,GAAI5M,GAAK,IAERA,GADG2K,GAAcxG,EAAG0G,MACf,GAAIC,cAAaR,EAAQC,EAAS,GAGlC,GAAIQ,YAAWT,EAAQC,EAAS,GAEtCqC,EAAc,GAAIxmB,OAAM,EACxB,KAAK,GAAId,GAAE,EAAK,EAAFA,IAAOA,EACpBsnB,EAAYtnB,GAAK0a,EAInB,GAAIgL,GAAM7G,EAAG8G,eACb9G,GAAG+G,YAAY/G,EAAG0I,iBAAkB7B,EAEpC,IAAII,GAAgBjH,EAAGkH,aAAalH,EAAGmH,qBACnCC,EAAiBlH,EAAI4F,SAAU,CAC/BmB,IAAgBG,GACnBpH,EAAGqH,YAAYrH,EAAGmH,oBAAsB,EAAkB,EAAM,EAEjE,KAAK,GAAIhmB,GAAE,EAAK,EAAFA,IAAOA,EACpB6e,EAAGsH,WAAWtH,EAAG2I,4BAA8BxnB,EAAG,EAAGmlB,EAAgBH,EAAOC,EAAQ,EAAGG,EAAcC,EAAYiC,EAAYtnB,GAE1H8lB,IAAgBG,GACnBpH,EAAGqH,YAAYrH,EAAGmH,oBAAsB,EAAiB,EAAM,GAGhEnH,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAGwH,mBAAoBtH,EAAI8E,WACjEhF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAGyH,mBAAoBvH,EAAIgF,WACjElF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAG0H,eAAoBxH,EAAIiF,OACjEnF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAG2H,eAAoBzH,EAAImF,OAC7DnF,EAAIoF,UACPtF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAG4H,mBAAsB1H,EAAIqF,WACnEvF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAG6H,qBAAsB3H,EAAIuF,kBACnEzF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAG8H,qBAAsB5H,EAAIyF,mBAEhEzF,EAAI2F,gBACP7F,EAAG6F,eAAe7F,EAAG0I,kBAEtB1I,EAAG+G,YAAY/G,EAAG0I,iBAAkB,KAEpC,IAAI5H,GAAM,GAAImF,eAgBd,OAfAnF,GAAIR,OAAmBuG,EACvB/F,EAAIP,OAAmB,EACvBO,EAAIhI,OAAmBkH,EAAG0I,iBAC1B5H,EAAIoF,OAAmBI,EACvBxF,EAAIqF,MAAmBA,EACvBrF,EAAIsF,OAAmBA,EACvBtF,EAAIkE,UAAmB9E,EAAI8E,UAC3BlE,EAAIoE,UAAmBhF,EAAIgF;AAC3BpE,EAAIqE,MAAmBjF,EAAIiF,MAC3BrE,EAAIuE,MAAmBnF,EAAImF,MAC3BvE,EAAIwE,QAAmBpF,EAAIoF,QAC3BxE,EAAIyE,UAAmBrF,EAAIqF,UAC3BzE,EAAI2E,iBAAmBvF,EAAIuF,iBAC3B3E,EAAI6E,iBAAmBzF,EAAIyF,iBAEpB7E,EAGR,QAAS8H,0BAAyB5I,EAAI6I,EAAQ5I,GAC7C,GAAIC,GAAM6E,qBAAqB/E,EAAIC,GAE/B4G,EAAM7G,EAAG8G,eACb9G,GAAG+G,YAAY/G,EAAG0I,iBAAkB7B,EAEpC,IAAII,GAAgBjH,EAAGkH,aAAalH,EAAGmH,qBACnCC,EAAiBlH,EAAI4F,SAAU,CAC/BmB,IAAgBG,GACnBpH,EAAGqH,YAAYrH,EAAGmH,oBAAsB,EAAkB,EAAM,EAEjE,KAAK,GAAIhmB,GAAE,EAAK,EAAFA,IAAOA,EACpB6e,EAAGsH,WAAWtH,EAAG2I,4BAA8BxnB,EAAG,EAAG6e,EAAGiI,KAAMjI,EAAGiI,KAAMjI,EAAGkI,cAAeW,EAAO1nB,GAE7F8lB,IAAgBG,GACnBpH,EAAGqH,YAAYrH,EAAGmH,oBAAsB,EAAiB,EAAM,GAEhEnH,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAGwH,mBAAoBtH,EAAI8E,WACjEhF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAGyH,mBAAoBvH,EAAIgF,WACjElF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAG0H,eAAoBxH,EAAIiF,OACjEnF,EAAGuH,cAAcvH,EAAG0I,iBAAkB1I,EAAG2H,eAAoBzH,EAAImF,OAC7DnF,EAAI2F,gBACP7F,EAAG6F,eAAe7F,EAAG0I,kBAEtB1I,EAAG+G,YAAY/G,EAAG0I,iBAAkB,KAEpC,IAAI5H,GAAM,GAAImF,eAgBd,OAfAnF,GAAIR,OAAmBuG,EACvB/F,EAAIP,OAAmB,EACvBO,EAAIhI,OAAmBkH,EAAG0I,iBAC1B5H,EAAIoF,OAAmBlG,EAAGiI,KAC1BnH,EAAIqF,MAAmB0C,EAAO,GAAG1C,MACjCrF,EAAIsF,OAAmByC,EAAO,GAAGzC,OACjCtF,EAAIkE,UAAmB9E,EAAI8E,UAC3BlE,EAAIoE,UAAmBhF,EAAIgF,UAC3BpE,EAAIqE,MAAmBjF,EAAIiF,MAC3BrE,EAAIuE,MAAmBnF,EAAImF,MAC3BvE,EAAIwE,SAAmB,EACvBxE,EAAIyE,UAAmB,EACvBzE,EAAI2E,iBAAmB,EACvB3E,EAAI6E,iBAAmB,EAEhB7E,EAGR,QAASgI,wBAAuB9I,EAAI+I,EAAM9I,GAMzC,IAAK,GALDC,GAAM6E,qBAAqB/E,EAAIC,GAC/Ba,EAAM,GAAImF,gBAEV+C,EAAY,EACZH,EAAS,GAAI5mB,OAAM,GACdd,EAAE,EAAK,EAAFA,IAAOA,EACpB0nB,EAAO1nB,GAAK,GAAIknB,OAChBQ,EAAO1nB,GAAGmnB,YAAc,EAczB,KAAK,GAZDW,GAAU,WAEb,GADAD,IACiB,GAAbA,EAAgB,CACnB,GAAIT,GAAUK,yBAAyB5I,EAAI6I,EAAQ3I,EACnD,KAAK,GAAI7Z,KAAKkiB,GACbzH,EAAIza,GAAKkiB,EAAQliB,EAEd6Z,GAAI8F,QACP9F,EAAI8F,OAAOhG,EAAIc,EAAKiI,KAId5nB,EAAE,EAAK,EAAFA,IAAOA,EACpB0nB,EAAO1nB,GAAG6kB,OAASiD,EACnBJ,EAAO1nB,GAAGogB,IAASwH,EAAK5nB,EAGzB,OAAO2f,GAWR,QAASoI,uBACR1nB,KAAK8e,OAAY,KACjB9e,KAAK+e,OAAY,EACjB/e,KAAKsX,OAAY,EACjBtX,KAAK0kB,OAAY,EACjB1kB,KAAK2kB,MAAY,EACjB3kB,KAAK4kB,OAAY,EAGlB,QAAS+C,2BAA0BnJ,EAAIkG,EAAQC,EAAOC,GACrD,GAAIgD,GAAKpJ,EAAGqJ,oBACZrJ,GAAGsJ,iBAAiBtJ,EAAGuJ,aAAcH,GACrCpJ,EAAGwJ,oBAAoBxJ,EAAGuJ,aAAcrD,EAAQC,EAAOC,GACvDpG,EAAGsJ,iBAAiBtJ,EAAGuJ,aAAc,KAErC,IAAIzI,GAAM,GAAIoI,oBAQd,OAPApI,GAAIR,OAAS8I,EACbtI,EAAIP,OAAS,EACbO,EAAIhI,OAASkH,EAAGuJ,aAChBzI,EAAIoF,OAASA,EACbpF,EAAIqF,MAASA,EACbrF,EAAIsF,OAASA,EAENtF,EAOR,QAAS2I,0BAAyBzJ,EAAIC,GACrC,GAAIC,IACH8E,UAAwBhF,EAAGiF,OAC3BC,UAAwBlF,EAAGiF,OAC3BE,MAAwBnF,EAAGoF,cAC3BC,MAAwBrF,EAAGoF,cAC3BE,SAAwB,EACxBC,UAAwBvF,EAAGwF,UAC3BC,iBAAwBzF,EAAG0F,qBAC3BC,iBAAwB3F,EAAG4F,OAC3B8D,sBAAwB,EACxBC,qBAAwB,EACxBC,uBAAwB,EACxBC,sBAAwB,EACxBC,qBAAwB,EACxBC,uBAAwB,EAEzB,OAAOpK,wBAAuBO,EAAKD,GAOpC,QAAS+J,sBACRxoB,KAAK8e,OAAgB,KACrB9e,KAAK+e,OAAgB,EACrB/e,KAAK2kB,MAAgB,EACrB3kB,KAAK4kB,OAAgB,EACrB5kB,KAAKyoB,gBACLzoB,KAAK0oB,YAAgB,KACrB1oB,KAAK2oB,cAAgB,KACrB3oB,KAAK4oB,OAAgB,EAGtB,QAASC,2BAA0BrK,EAAIiK,EAAcC,EAAaC,EAAelK,GAChF,GAEIqK,IAFMb,yBAAyBzJ,EAAIC,GAE9BD,EAAGuK,oBACZvK,GAAGwK,gBAAgBxK,EAAGyK,YAAaH,GAEfjjB,QAAf6iB,GAA6C,MAAfA,GAAyBA,GAAelK,EAAG0K,OACzER,EAAYpR,QAAUkH,EAAGgH,WAC5BhH,EAAG2K,qBAAqB3K,EAAGyK,YAAazK,EAAG4K,iBAAkB5K,EAAGgH,WAAYkD,EAAY5J,OAAQ,GAExF4J,EAAYpR,QAAUkH,EAAGuJ,cACjCvJ,EAAG6K,wBAAwB7K,EAAGyK,YAAazK,EAAG4K,iBAAkB5K,EAAGuJ,aAAcW,EAAY5J,SAIzEjZ,QAAjB8iB,GAAiD,MAAjBA,GAA2BA,GAAiBnK,EAAG0K,OAC/EP,EAAcrR,QAAUkH,EAAGgH,WAC9BhH,EAAG2K,qBAAqB3K,EAAGyK,YAAazK,EAAG8K,mBAAoB9K,EAAGgH,WAAYmD,EAAc7J,OAAQ,GAE5F6J,EAAcrR,QAAUkH,EAAGuJ,cACnCvJ,EAAG6K,wBAAwB7K,EAAGyK,YAAazK,EAAG8K,mBAAoB9K,EAAGuJ,aAAcY,EAAc7J,QAInG,IAAIyK,MACAC,IACJ,IAAqB3jB,QAAhB4iB,GAA+C,MAAhBA,EAAuB,CAC1D,GAAItqB,GAAIsqB,EAAajpB,MACrB,IAAS,GAALrB,EACHqrB,EAAY3pB,KAAK2e,EAAG0K,UAGhB,CACJ,GAAIO,GAAMjL,EAAGkL,iBACb,KAAK,GAAIvY,KAAKsX,GAAc,CAC3B,GAAIkB,GAAKlB,EAAatX,EAClBwY,GAAGrS,QAAUkH,EAAGgH,WACnBhH,EAAG2K,qBAAqB3K,EAAGyK,YAAaQ,EAAKjL,EAAGgH,WAAYmE,EAAG7K,OAAQ,GAE/D6K,EAAGrS,QAAUkH,EAAGuJ,cACxBvJ,EAAG6K,wBAAwB7K,EAAGyK,YAAaQ,EAAKjL,EAAGuJ,aAAc4B,EAAG7K,QAErE0K,EAAY3pB,KAAK4pB,GACjBF,EAAI1pB,KAAK8pB,GACTF,MAKH,GAAIG,GAAWpL,EAAGqL,uBAAuBrL,EAAGyK,YAE5CzK,GAAGwK,gBAAgBxK,EAAGyK,YAAa,KAEnC,IAAIa,GAAM,IACNP,GAAI/pB,OAAS,EAChBsqB,EAAMP,EAAI,GAEFb,EACRoB,EAAMpB,EAEEC,IACRmB,EAAMnB,EAGP,IAAIhE,GAAS,EACTC,EAAS,CACTkF,KACHnF,EAASmF,EAAInF,MACbC,EAASkF,EAAIlF,OAGd,IAAItF,GAAM,GAAIkJ,mBAUd,OATAlJ,GAAIR,OAAgBgK,EACpBxJ,EAAIP,MAAiB6K,GAAYpL,EAAGuL,qBACpCzK,EAAIqF,MAAgBA,EACpBrF,EAAIsF,OAAgBA,EACpBtF,EAAImJ,aAAgBc,EACpBjK,EAAIoJ,YAAgB,EAAkB,EAAkB,KACxDpJ,EAAIqJ,cAAgB,EAAkB,EAAkB,KACxDrJ,EAAIsJ,OAAgBgB,EAEbtK,EAGR,QAAS0K,2BAA0BxL,EAAImG,EAAOC,EAAQqF,EAAcC,EAAaC,EAAe1L,GAC/F,GAAIC,GAAMuJ,yBAAyBzJ,EAAIC,GAEnCgK,EAAe,IACnB,IAAIwB,EAAc,CACjBvL,EAAIoF,SAAU,EACd2E,IACA,IAAIkB,GAAK,IACT,IAAIjL,EAAIwJ,qBACP,IAAK,GAAI/W,KAAK8Y,GAAc,CAC3B,GAAIG,GAAKH,EAAa9Y,EACtBwY,GAAKhC,0BAA0BnJ,EAAI4L,EAAIzF,EAAOC,GAC9C6D,EAAa5oB,KAAK8pB,OAGf,CACJjL,EAAI2F,eAAiB3F,EAAI2J,oBACzB,KAAK,GAAIlX,KAAK8Y,GAAc,CAC3B,GAAIG,GAAKH,EAAa9Y,EACtBwY,GAAK9E,qBAAqBrG,EAAI4L,EAAIzF,EAAOC,EAAQpG,EAAGiI,KAAMjI,EAAGkI,cAAe,KAAMhI,GAClF+J,EAAa5oB,KAAK8pB,KAKrB,GAAIjB,GAAc,IACdwB,KACHxL,EAAIoF,SAAU,EACVpF,EAAIyJ,oBACPO,EAAcf,0BAA0BnJ,EAAI0L,EAAavF,EAAOC,IAGhElG,EAAI2F,eAAiB3F,EAAI4J,oBACzBI,EAAc7D,qBAAqBrG,EAAI0L,EAAavF,EAAOC,EAAQpG,EAAG6L,gBAAiB7L,EAAG0G,MAAO,KAAMxG,IAIzG,IAAIiK,GAAgB,IAYpB,OAXIwB,KACHzL,EAAIoF,SAAU,EACVpF,EAAI0J,sBACPO,EAAgBhB,0BAA0BnJ,EAAI2L,EAAexF,EAAOC,IAGpElG,EAAI2F,eAAiB3F,EAAI6J,sBACzBI,EAAgB9D,qBAAqBrG,EAAI2L,EAAexF,EAAOC,EAAQpG,EAAG8L,kBAAmB9L,EAAGkI,cAAe,KAAMhI,KAIhHmK,0BAA0BrK,EAAIiK,EAAcC,EAAaC,EAAejK,GAyChF,QAAS6L,mBACRvqB,KAAKwe,GAAQ5d,UAAU,GACvBZ,KAAKwqB,MAAQ,KACT5pB,UAAU,YAAcie,eAC3B7e,KAAKwqB,MAAQ5pB,UAAU,GAGvBZ,KAAKwqB,MAAQhL,wBAAwBxf,KAAKwe,GAAI5d,UAAU,GAAIA,UAAU,IAyCxE,QAAS6pB,kBACRzqB,KAAKwe,GAAQ5d,UAAU,GACvBZ,KAAKwqB,MAAQ,KACT5pB,UAAU,YAAcie,eAC3B7e,KAAKwqB,MAAQ5pB,UAAU,GAGvBZ,KAAKwqB,MAAQ9K,uBAAuB1f,KAAKwe,GAAI5d,UAAU,GAAIA,UAAU,IAuCvE,QAAS8pB,qBAAoBC,EAASC,GACrC5qB,KAAK6qB,MAAQF,EACb3qB,KAAKwqB,MAAQI,EAsBd,QAASE,mBAAkBH,EAASC,GACnC5qB,KAAK6qB,MAAQF,EACb3qB,KAAKwqB,MAAQI,EACb5qB,KAAK+qB,MAAQ,IAEb,IAAIvM,GAAOxe,KAAK6qB,MAAMrM,GAClBqB,EAAO7f,KAAKwqB,MAAM3J,UAElBhB,IAAQrB,EAAGwM,KACdhrB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG6E,UAAUrjB,KAAKwqB,MAAM1J,SAAU/a,IAEjE8Z,GAAQrB,EAAGyM,UACnBjrB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG0M,WAAWlrB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAG2M,UACnBnrB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG4M,WAAWprB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAG6M,UACnBrrB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG8M,WAAWtrB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAG+M,IACnBvrB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG6E,UAAUrjB,KAAKwqB,MAAM1J,SAAU/a,IAEjE8Z,GAAQrB,EAAGgN,SACnBxrB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG0M,WAAWlrB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAGiN,SACnBzrB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG4M,WAAWprB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAGkN,SACnB1rB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG8M,WAAWtrB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAG0G,MACnBllB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAGmN,UAAU3rB,KAAKwqB,MAAM1J,SAAU/a,IAEjE8Z,GAAQrB,EAAGoN,WACnB5rB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAGqN,WAAW7rB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAGsN,WACnB9rB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAGuN,WAAW/rB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAGwN,WACnBhsB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAGyN,WAAWjsB,KAAKwqB,MAAM1J,SAAU/a,IAElE8Z,GAAQrB,EAAG0N,WACnBlsB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG2N,iBAAiBnsB,KAAKwqB,MAAM1J,SAAU9gB,KAAK6qB,MAAMrM,GAAG4N,MAAOrmB,IAE7F8Z,GAAQrB,EAAG6N,WACnBrsB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAG8N,iBAAiBtsB,KAAKwqB,MAAM1J,SAAU9gB,KAAK6qB,MAAMrM,GAAG4N,MAAOrmB,IAE7F8Z,GAAQrB,EAAG+N,WACnBvsB,KAAK+qB,MAAQ,SAAUhlB,GAAK/F,KAAK6qB,MAAMrM,GAAGgO,iBAAiBxsB,KAAKwqB,MAAM1J,SAAU9gB,KAAK6qB,MAAMrM,GAAG4N,MAAOrmB,IAGrGnJ,aAsBF,QAAS6vB,mBAAkB9B,EAASC,GACnC5qB,KAAK6qB,MAAQF,EACb3qB,KAAKwqB,MAAQI,EACb5qB,KAAK0sB,MAAQ,EAEb,IAAIlO,GAAOxe,KAAK6qB,MAAMrM,GAClBqB,EAAO7f,KAAKwqB,MAAM3J,UAElBhB,IAAQrB,EAAGgE,YAGN3C,GAAQrB,EAAGiE,cAGH,OAAR5C,GAIRjjB,aA0BF,QAAS+vB,cACR3sB,KAAKwe,GAAQ5d,UAAU,GACvBZ,KAAKwqB,MAAQ,KAET5pB,UAAU,YAAcqgB,gBAC3BjhB,KAAKwqB,MAAQ5pB,UAAU,GAGvBZ,KAAKwqB,MAAQ7H,sBAAsB3iB,KAAKwe,GAAI5d,UAAU,GAAIA,UAAU,IAGrEZ,KAAK4sB,YAAc,GAAI7rB,OACvB,KAAK,GAAI8D,KAAK7E,MAAKwqB,MAAMrJ,WACxBnhB,KAAK4sB,YAAY/nB,GAAK,GAAI6lB,qBAAoB1qB,KAAMA,KAAKwqB,MAAMrJ,WAAWtc,GAG3E7E,MAAK6sB,UAAY,GAAI9rB,OACrB,KAAK,GAAIoG,KAAKnH,MAAKwqB,MAAMpJ,SACxBphB,KAAK6sB,UAAU1lB,GAAK,GAAI2jB,mBAAkB9qB,KAAMA,KAAKwqB,MAAMpJ,SAASja,GAGrE,IAAIgc,GAAO,CACXnjB,MAAK8sB,UAAY,GAAI/rB,OACrB,KAAK,GAAI4F,KAAK3G,MAAKwqB,MAAMnJ,SACxBrhB,KAAK8sB,UAAUnmB,GAAK,GAAI8lB,mBAAkBzsB,KAAMA,KAAKwqB,MAAMnJ,SAAS1a,IACpE3G,KAAK8sB,UAAUnmB,GAAG+lB,MAAQvJ,EAC1BA,IA4GF,QAAS4J,gBACR/sB,KAAKwe,GAAQ5d,UAAU,GACvBZ,KAAKwqB,MAAQ,IAEb,IAAIhM,GAAKxe,KAAKwe,GAEVrgB,EAAIyC,UAAUpB,MACR,IAALrB,GAAiB,GAALA,EACZyC,UAAU,YAAcimB,OAC3B7mB,KAAKwqB,MAAQjE,sBAAsB/H,EAAI5d,UAAU,GAAIA,UAAU,IAG/B,gBAAjBA,WAAU,GACzBZ,KAAKwqB,MAAQ7D,oBAAoBnI,EAAI5d,UAAU,GAAIA,UAAU,IAG7DZ,KAAKwqB,MAAQ5pB,UAAU,GAIxBZ,KAAKwqB,MAAQ3F,qBAAqBrG,EAAI5d,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,IAgDtI,QAASosB,kBACRhtB,KAAKwe,GAAQ5d,UAAU,GACvBZ,KAAKwqB,MAAQ,IAEb,IAAIhM,GAAKxe,KAAKwe,GAEVrgB,EAAIyC,UAAUpB,MACR,IAALrB,GAAiB,GAALA,EACZyC,UAAU,YAAcH,OACvBG,UAAU,GAAG,YAAcimB,OAC9B7mB,KAAKwqB,MAAQpD,yBAAyB5I,EAAI5d,UAAU,GAAIA,UAAU,IAG/B,gBAApBA,WAAU,GAAG,KAC5BZ,KAAKwqB,MAAQlD,uBAAuB9I,EAAI5d,UAAU,GAAIA,UAAU,KAIjEZ,KAAKwqB,MAAQ5pB,UAAU,GAIxBZ,KAAKwqB,MAAQxD,uBAAuBxI,EAAI5d,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,IA8CxI,QAASqsB,mBACRjtB,KAAKwe,GAAQ5d,UAAU,GACvBZ,KAAKwqB,MAAQ,IAEb,IAAIhM,GAAKxe,KAAKwe,GAEVrgB,EAAIyC,UAAUpB,MACT,IAALrB,EACH6B,KAAKwqB,MAAQ5pB,UAAU,GAGvBZ,KAAKwqB,MAAQ7C,0BAA0BnJ,EAAI5d,UAAU,GAAIA,UAAU,GAAIA,UAAU,IAwCnF,QAASssB,kBACRltB,KAAKwe,GAAQ5d,UAAU,GACvBZ,KAAKwqB,MAAQ,IAEb,IAAIhM,GAAKxe,KAAKwe,GAEVrgB,EAAIyC,UAAUpB,MACT,IAALrB,EACH6B,KAAKwqB,MAAQ5pB,UAAU,GAGvBZ,KAAKwqB,MAAQR,0BAA0BxL,EAAI5d,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAAIA,UAAU,GAG5H,IAAI+F,GAAI,KACJjF,EAAI,IAER1B,MAAKmtB,gBACL,KAAK,GAAIhc,KAAKnR,MAAKwqB,MAAM/B,aACxB9hB,EAAI3G,KAAKwqB,MAAM/B,aAAatX,GAC5BzP,EAAI,KACAiF,EAAE2Q,QAAUkH,EAAGgH,WAClB9jB,EAAI,GAAIqrB,cAAavO,EAAI7X,GAEjBA,EAAE2Q,QAAUkH,EAAGuJ,eACvBrmB,EAAI,GAAIurB,iBAAgBzO,EAAI7X,IAE7B3G,KAAKmtB,cAActtB,KAAK6B,EAGzB1B,MAAKotB,aAAe,KAChBptB,KAAKwqB,MAAM9B,cACd/hB,EAAI3G,KAAKwqB,MAAM9B,YACfhnB,EAAI,KACAiF,EAAE2Q,QAAUkH,EAAGgH,WAClB9jB,EAAI,GAAIqrB,cAAavO,EAAI7X,GAEjBA,EAAE2Q,QAAUkH,EAAGuJ,eACvBrmB,EAAI,GAAIurB,iBAAgBzO,EAAI7X,IAE7B3G,KAAKotB,aAAe1rB,GAGrB1B,KAAKqtB,eAAiB,KAClBrtB,KAAKwqB,MAAM7B,gBACdhiB,EAAI3G,KAAKwqB,MAAM7B,cACfjnB,EAAI,KACAiF,EAAE2Q,QAAUkH,EAAGgH,WAClB9jB,EAAI,GAAIqrB,cAAavO,EAAI7X,GAEjBA,EAAE2Q,QAAUkH,EAAGuJ,eACvBrmB,EAAI,GAAIurB,iBAAgBzO,EAAI7X,IAE7B3G,KAAKqtB,eAAiB3rB,GAuMxB,QAAS4rB,sBAAqB1M,EAAMrb,EAAM0Z,EAAQsO,GACjDvtB,KAAKwtB,MAAQ5M,EACb5gB,KAAKytB,MAAQloB,EACbvF,KAAK0tB,MAAQ,EAAY,EAAYzO,EAAOve,QAAW,KAAU,EA8BlE,QAASitB,qBACR3tB,KAAK4tB,YACL5tB,KAAK6tB,QAAW,EA+CjB,QAASC,sBAAqBlN,EAAMmN,EAAMroB,EAAOlG,GAChDQ,KAAKwtB,MAAQ5M,EACb5gB,KAAKguB,MAAQD,EACb/tB,KAAKiuB,OAAU,EAAW,EAAW,EACrCjuB,KAAK6tB,QAAU,EAAW,EAAW,EAmBtC,QAASK,2BAA0BtN,EAAMmN,EAAMroB,EAAOC,GACrDmoB,qBAAqBntB,KAAKX,KAAM4gB,EAAMmN,EAAMroB,EAAOC,GACnD5E,OAAOC,eAAehB,KAAM,QAASiB,IAAK,WAAW,MAAOktB,+BAgB7D,QAASC,6BAA4BxN,EAAMmN,EAAMM,EAASd,GACzDO,qBAAqBntB,KAAKX,KAAM4gB,EAAMmN,EAAM,EAAGM,EAAQ7uB,QAEvDQ,KAAK0tB,MAAQ,EAAY,EAAaW,EAAQ3tB,QAAW,KAAU,EAEnEK,OAAOC,eAAehB,KAAM,QAASiB,IAAK,WAAW,MAAOqtB,iCAC5DvtB,OAAOC,eAAehB,KAAM,UAAWiB,IAAK,WAAW,MAAOjB,MAAK0tB,SACnE3sB,OAAOC,eAAehB,KAAM,UAAWiB,IAAK,WAAW,MAAOjB,MAAK0tB,MAAMluB,UAyB1E,QAAS+uB,qBACRvuB,KAAKwuB,UA8BN,QAASC,aACRzuB,KAAK0uB,QAAS,EACd1uB,KAAK2uB,MAAS,GAAIhB,mBAClB3tB,KAAK4uB,MAAS,GAAIL,mBA+DnB,QAASM,8BAA6BC,EAAMzvB,GAC3C,GAAI0vB,MACAC,KACAC,KACAC,KAEAC,KACAC,KACAC,KACAC,KACAvM,EAAY,EAEZrjB,EAAO,KACP8F,EAAM,KACN+pB,EAAM,EACNlK,EAAM,EACNmK,EAAM,EACN7sB,EAAM,EACNU,EAAM,EACNkG,EAAM,EACNkmB,EAAS,KAETC,GAAS,EACTC,GAAS,EACTC,GAAS,EAETnwB,EAAQJ,EAAKE,MAAM,KACvB,KAAK,GAAIswB,KAAapwB,GAGrB,GAFAC,EAAOD,EAAMowB,GAAWjwB,QAAQ,UAAW,KAAKA,QAAQ,SAAU,IAEnD,KAAXF,EAAK,GAGT,GADA+vB,EAAS/vB,EAAKH,MAAM,KACH,KAAbkwB,EAAO,GACVN,EAAUtvB,KAAKiwB,WAAWL,EAAO,KACjCN,EAAUtvB,KAAKiwB,WAAWL,EAAO,KACjCN,EAAUtvB,KAAKiwB,WAAWL,EAAO,SAE7B,IAAiB,MAAbA,EAAO,GACfL,EAAUvvB,KAAKiwB,WAAWL,EAAO,KACjCL,EAAUvvB,KAAKiwB,WAAWL,EAAO,SAE7B,IAAiB,MAAbA,EAAO,GACfJ,EAAQxvB,KAAKiwB,WAAWL,EAAO,KAC/BJ,EAAQxvB,KAAKiwB,WAAWL,EAAO,KAC/BJ,EAAQxvB,KAAKiwB,WAAWL,EAAO,SAE3B,IAAiB,KAAbA,EAAO,GAAW,CAC1B,GAAqB,GAAjBA,EAAOjwB,OAAa,QAExB,KAAK,GAAIG,GAAE,EAAK,EAAFA,IAAOA,EAAG,CACvB,KAAM8vB,EAAO9vB,IAAM2vB,IAAU,CAG5B,GAFA9pB,EAAIiqB,EAAO9vB,GAAGJ,MAAM,KAEJ,GAAZiG,EAAEhG,OACL+vB,EAAMQ,SAASvqB,EAAE,IAAM,EACvB6f,EAAMkK,EACNC,EAAMD,MAEF,CAAA,GAAgB,GAAZ/pB,EAAEhG,OAMV,OAAO,CALP+vB,GAAMQ,SAASvqB,EAAE,IAAM,EACvB6f,EAAM0K,SAASvqB,EAAE,IAAM,EACvBgqB,EAAMO,SAASvqB,EAAE,IAAM,EAMxB7C,EAAI,EACJU,EAAI,EACJkG,EAAI,EACO,EAANgmB,EAAU,EAAKJ,EAAU3vB,SAC7BkwB,GAAS,EACT/sB,EAAIwsB,EAAc,EAAJI,EAAM,GACpBlsB,EAAI8rB,EAAc,EAAJI,EAAM,GACpBhmB,EAAI4lB,EAAc,EAAJI,EAAM,IAErBR,EAAelvB,KAAK8C,GACpBosB,EAAelvB,KAAKwD,GACpB0rB,EAAelvB,KAAK0J,GAEpB5G,EAAI,EACJU,EAAI,EACO,EAANgiB,EAAU,EAAK+J,EAAU5vB,SAC7BmwB,GAAS,EACThtB,EAAIysB,EAAc,EAAJ/J,EAAM,GACpBhiB,EAAI+rB,EAAc,EAAJ/J,EAAM,IAErB2J,EAAenvB,KAAK8C,GACpBqsB,EAAenvB,KAAKwD,GAEpBV,EAAI,EACJU,EAAI,EACJkG,EAAI,EACO,EAANimB,EAAU,EAAKH,EAAQ7vB,SAC3BowB,GAAS,EACTjtB,EAAI0sB,EAAY,EAAJG,EAAM,GAClBnsB,EAAIgsB,EAAY,EAAJG,EAAM,GAClBjmB,EAAI8lB,EAAY,EAAJG,EAAM,IAEnBP,EAAapvB,KAAK8C,GAClBssB,EAAapvB,KAAKwD,GAClB4rB,EAAapvB,KAAK0J,GAElB+lB,EAAQG,EAAO9vB,IAAMojB,IAGtBmM,EAAarvB,KAAKyvB,EAAQG,EAAO9vB,MAmBpC,MAdI+vB,IACHZ,EAAKkB,mBAAmB,WAAY,EAAGjB,GAAgB,GAEpDa,GACHd,EAAKkB,mBAAmB,SAAU,EAAGf,GAAc,GAEhDU,GACHb,EAAKkB,mBAAmB,WAAY,EAAGhB,GAAgB,GAGpDE,EAAa1vB,OAAS,GACzBsvB,EAAKmB,qBAAqB,YAAaC,mBAAoBhB,GAAc,IAGnE,EAGR,QAASiB,2BAA0BrB,EAAMrwB,EAAK2xB,EAAQ1xB,GAGrD,GAFAowB,EAAKuB,SAAU,GAEVD,EAAQ,CACZ,GAAIE,GAAM9xB,YAAYC,EAKtB,OAJAqwB,GAAKuB,QAAUxB,6BAA6BC,EAAMwB,GAC9C5xB,GACHA,EAASowB,EAAMrwB,GAETqwB,EAAKuB,QAUb,MAPA7xB,aAAYC,EAAK,SAAS6xB,GACzBxB,EAAKuB,QAAUxB,6BAA6BC,EAAMwB,GAC9C5xB,GACHA,EAASowB,EAAMrwB,MAIV,EAYR,QAAS8xB,6BAA4B5gB,EAAGiR,GACvC,IAAK,GAAI/b,KAAK8K,GAAE6gB,SACf,GAAI7gB,EAAE6gB,SAAS3rB,GAAG+b,OAASA,EAC1B,MAAOjR,GAAE6gB,SAAS3rB,EAGpB,OAAO,MAGR,QAAS4rB,0BAAyB9gB,EAAGiR,GACpC,IAAK,GAAI/b,KAAK8K,GAAE+gB,aACf,GAAI/gB,EAAE+gB,aAAa7rB,GAAG+b,OAASA,EAC9B,MAAOjR,GAAE+gB,aAAa7rB,EAGxB,OAAO,MAGR,QAAS8rB,+BAA8B7B,EAAMzvB,GAC5C,GAAIsQ,GAAIihB,KAAKC,MAAMxxB,EACnB,KAAKsQ,EAAG,OAAO,CAEf,IAAImhB,GAAUnhB,EAAEmhB,QACZC,EAAa,IACjB,KAAK,GAAIhrB,KAAK+qB,GACb,GAAwB,aAApBA,EAAQ/qB,GAAG6a,KAAqB,CACnCmQ,EAAaD,EAAQ/qB,EACrB,OAGF,IAAKgrB,EAAY,OAAO,CAExB,KAAK,GAAIlsB,KAAKksB,GAAW5P,WAAY,CACpC,GAAI6P,GAAKD,EAAW5P,WAAWtc,GAC3Bme,EAAQuN,4BAA4B5gB,EAAGqhB,EAAGC,OAC9C,IAAKjO,EAAL,CACA,GAAIA,EAAMkO,WACT,IAAK,GAAIvxB,GAAE,EAAGxB,EAAE6kB,EAAM/D,OAAOzf,OAAUrB,EAAFwB,IAAOA,EAC3CqjB,EAAM/D,OAAOtf,IAAM,GAGrBmvB,GAAKkB,mBAAmBgB,EAAGG,SAAUnO,EAAMzd,KAAMyd,EAAM/D,QAAQ,IAGhE,GAAImS,GAAOX,yBAAyB9gB,EAAGohB,EAAWM,WAClD,OAAKD,IACLtC,EAAKmB,qBAAqBmB,EAAKxQ,KAAMsP,mBAAoBkB,EAAK/C,SAAS,IAEhE,IAHW,EAMnB,QAASiD,4BAA2BxC,EAAMrwB,EAAK2xB,EAAQ1xB,GAGtD,GAFAowB,EAAKuB,SAAU,GAEVD,EAAQ,CACZ,GAAIE,GAAM9xB,YAAYC,EAKtB,OAJAqwB,GAAKuB,QAAUM,8BAA8B7B,EAAMwB,GAC/C5xB,GACHA,EAASowB,EAAMrwB,GAETqwB,EAAKuB,QAUb,MAPA7xB,aAAYC,EAAK,SAAS6xB,GACzBxB,EAAKuB,QAAUM,8BAA8B7B,EAAMwB,GAC/C5xB,GACHA,EAASowB,EAAMrwB,MAIV,EA4CR,QAAS8yB,eAAc/S,EAAIqB,GAC1B,MAAIA,IAAQrB,EAAGgT,KAAuB,EAClC3R,GAAQrB,EAAGkI,cAAuB,EAClC7G,GAAQrB,EAAGiT,MAAuB,EAClC5R,GAAQrB,EAAGkT,eAAuB,EAClC7R,GAAQrB,EAAG+M,IAAuB,EAClC1L,GAAQrB,EAAGmT,aAAuB,EAClC9R,GAAQrB,EAAG0G,MAAuB,EAC/B,KAGR,QAAS0M,yBAAwBpT,EAAIqT,GACpC,MAAIA,aAAoBC,WAAqBtT,EAAGgT,KAC5CK,YAAoBzM,YAAqB5G,EAAGkI,cAC5CmL,YAAoBE,YAAqBvT,EAAGiT,MAC5CI,YAAoBG,aAAqBxT,EAAGkT,eAC5CG,YAAoBI,YAAqBzT,EAAG+M,IAC5CsG,YAAoBK,aAAqB1T,EAAGmT,aAC5CE,YAAoB1M,cAAqB3G,EAAG0G,MACzC,KAWR,QAASiN,sBAAqB3T,EAAIoC,EAAMrb,EAAM0Z,EAAQiS,GACrD,GAAIrR,GAAS+R,wBAAwBpT,EAAIS,GACrCrZ,EAAS2rB,cAAc/S,EAAIqB,GAAQta,CAEvCvF,MAAKwe,GAAUA,EACfxe,KAAKwtB,MAAU5M,EACf5gB,KAAKytB,MAAUloB,EACfvF,KAAKoyB,MAAUvS,EACf7f,KAAKqyB,MAAU,GAAe,GAAS,EACvCryB,KAAKsyB,QAAU1sB,EACf5F,KAAKic,QAAU,EACfjc,KAAK6tB,QAAU5O,EAAOzf,OAAS+F,EAC/BvF,KAAK0tB,MAAU,GAAInD,iBAAgB/L,EAAIS,GAAUN,MAAQH,EAAGI,cAoC7D,QAAS2T,mBAAkB/T,GAC1Bxe,KAAKwe,GAAWA,EAChBxe,KAAK4tB,SAAW,GAAI7sB,QACpBf,KAAK6tB,QAAW,EAgEjB,QAAS2E,sBAAqBhU,EAAIoC,EAAMmN,EAAMroB,EAAOlG,GACpDQ,KAAKwe,GAAUA,EACfxe,KAAKwtB,MAAU5M,EACf5gB,KAAKguB,MAAUD,EACf/tB,KAAKiuB,OAAU,EAAW,EAAW,EACrCjuB,KAAK6tB,QAAU,EAAW,EAAW,EAuDtC,QAAS4E,2BAA0BjU,EAAIoC,EAAMmN,EAAMroB,EAAOC,GACzD6sB,qBAAqB7xB,KAAKX,KAAMwe,EAAIoC,EAAMmN,EAAMroB,EAAOC,GACvD5E,OAAOC,eAAehB,KAAM,QAASiB,IAAK,WAAW,MAAOktB,+BAuB7D,QAASuE,6BAA4BlU,EAAIoC,EAAMmN,EAAMM,GACpDmE,qBAAqB7xB,KAAKX,KAAMwe,EAAIoC,EAAMmN,EAAM,EAAGM,EAAQ7uB,OAE3D,IAAIqgB,GAAS+R,wBAAwBpT,EAAI6P,GACrCzoB,EAAS2rB,cAAc/S,EAAIqB,EAE/B7f,MAAK2yB,SAAW9S,EAChB7f,KAAKsyB,QAAW1sB,EAChB5F,KAAK0tB,MAAW,GAAIjD,gBAAejM,EAAI6P,GAAW1P,MAAQH,EAAGI,cAE7D7d,OAAOC,eAAehB,KAAM,aAAciB,IAAK,WAAW,MAAOjB,MAAK2yB,YACtE5xB,OAAOC,eAAehB,KAAM,UAAWiB,IAAK,WAAW,MAAOjB,MAAKsyB,WACnEvxB,OAAOC,eAAehB,KAAM,QAASiB,IAAK,WAAW,MAAOqtB,iCA8C7D,QAASsE,mCAAkCpU,EAAIoC,EAAMmN,EAAMM,EAASwE,EAAsBC,GACrFD,EAAqBrzB,QAAUszB,EAAsBtzB,QACxDxC,sBAGDw1B,qBAAqB7xB,KAAKX,KAAMwe,EAAIoC,EAAMmN,EAAM,EAAGM,EAAQ7uB,OAE3D,IAAIqgB,GAAS+R,wBAAwBpT,EAAI6P,GACrCzoB,EAAS2rB,cAAc/S,EAAIqB,EAE/B7f,MAAK2yB,SAAW9S,EAChB7f,KAAKsyB,QAAW1sB,EAChB5F,KAAK0tB,MAAW,GAAIjD,gBAAejM,EAAI6P,GAAW1P,MAAQH,EAAGI,cAG7D5e,KAAK+yB,uBAAyBD,EAAsBpyB,OACpD,IAAIvC,GAAI6B,KAAK+yB,uBAAuBvzB,MAEpCQ,MAAKgzB,sBAAwBH,EAAqBnyB,QAClDV,KAAKizB,mBAAwB,GAAIxyB,OAAMtC,EAGvC,KAAK,GADD+0B,GAAQlzB,KAAKgzB,sBAAsB,GAC9BrzB,EAAE,EAAMxB,EAAE,EAALwB,IAAWA,EAAG,CAC3B,GAAIwzB,GAAOnzB,KAAKgzB,sBAAsBrzB,EAAE,EACxCK,MAAKizB,mBAAmBtzB,GAAKwzB,EAAOD,EACpCA,EAAQC,EAETnzB,KAAKizB,mBAAmB90B,EAAE,GAAKkwB,EAAQ7uB,OAAS0zB,EAEhDnyB,OAAOC,eAAehB,KAAM,YAAaiB,IAAK,WAAW,OAAO,KAChEF,OAAOC,eAAehB,KAAM,aAAciB,IAAK,WAAW,MAAOjB,MAAK2yB,YACtE5xB,OAAOC,eAAehB,KAAM,UAAWiB,IAAK,WAAW,MAAOjB,MAAKsyB,WACnEvxB,OAAOC,eAAehB,KAAM,QAASiB,IAAK,WAAW,MAAOmyB,wCAC5DryB,OAAOC,eAAehB,KAAM,eAAgBiB,IAAK,WAAW,MAAOjB,MAAKgzB,sBAAsBxzB,UAC9FuB,OAAOC,eAAehB,KAAM,yBAA0BiB,IAAK,WAAW,MAAOjB,MAAK+yB,0BAClFhyB,OAAOC,eAAehB,KAAM,qBAAsBiB,IAAK,WAAW,MAAOjB,MAAKizB,sBA8E/E,QAASI,mBAAkB7U,GAC1Bxe,KAAKwe,GAASA,EACdxe,KAAKwuB,OAAS,GAAIztB,QA8CnB,QAASuyB,WAAU9U,GAClBxe,KAAKwe,GAAQA,EACbxe,KAAK2uB,MAAQ,GAAI4D,mBAAkBvyB,KAAKwe,IACxCxe,KAAK4uB,MAAQ,GAAIyE,mBAAkBrzB,KAAKwe,IA+CzC,QAAS+U,mBAAkB5I,EAAS6I,GACnCxzB,KAAK6qB,MAAeF,EACpB3qB,KAAKyzB,SAAe,KACpBzzB,KAAK0zB,aAAe,KACpB1zB,KAAK2zB,MAAe,KACpB3zB,KAAK4zB,YAAe,KACpB5zB,KAAK6zB,OAAe,EAEpB7zB,KAAK8zB,kBAAmB,EAEpBN,GACHxzB,KAAK+zB,qBAGN/zB,KAAKg0B,mBA0NN,QAASC,2BAA0BnF,EAAMlO,EAAM+J,EAASuJ,EAAe9S,EAAUC,EAAU3b,EAAOC,GACjG,GAAIwuB,GAAW,GAAIZ,mBAAkB5I,EAKrC,IAJAwJ,EAASC,QACLF,GAAeC,EAASH,iBAAkBE,GAC1C9S,GAAe+S,EAASE,YAAkBjT,GAC1CC,GAAe8S,EAASG,YAAkBjT,GAC1CT,EACHuT,EAASI,qBAAqBzF,EAAMlO,EAAMlb,EAAOC,OAE7C,CACJ,GAAI0rB,GAAavC,EAAK4B,aAAaW,UACnC,KAAK,GAAIhW,KAAKgW,GACb8C,EAASI,qBAAqBzF,EAAMzT,EAAG3V,EAAOC,IAqCjD,QAAS6uB,wBAAuBC,EAAQC,GACvC,GAAIC,GAAYD,GAAc,WAE1BE,EAAYH,EAAOjE,SAASrP,WAAWwT,GACvCE,EAAYD,EAAUrvB,KACtBuvB,EAAYF,EAAUG,OAEtBC,EAAO,GAAI7Y,QACf,IAAe,GAAX0Y,EAAc,MAAOG,EAEzB,IAAI72B,GAAI22B,EAAUt1B,OAASq1B,CAC3B,IAAS,GAAL12B,EAAQ,MAAO62B,EAEnB72B,IAAK02B,CAEL,KAAK,GAAI5uB,GAAE,EAAK4uB,EAAF5uB,IAAaA,EAC1B+uB,EAAKjwB,IAAIkB,GAAK6uB,EAAU7uB,GACxB+uB,EAAK/vB,IAAIgB,GAAK6uB,EAAU7uB,EAIzB,KAAK,GADDgvB,GAAM,EACDt1B,EAAEk1B,EAAW12B,EAAFwB,EAAKA,GAAGk1B,EAC3B,IAAK,GAAI5uB,GAAE,EAAK4uB,EAAF5uB,IAAaA,EAC1BgvB,EAAMH,EAAUn1B,EAAEsG,GACd+uB,EAAKjwB,IAAIkB,GAAKgvB,IAAKD,EAAKjwB,IAAIkB,GAAKgvB,GACjCD,EAAK/vB,IAAIgB,GAAKgvB,IAAKD,EAAK/vB,IAAIgB,GAAKgvB,EAIvC,OAAOD,GAOR,QAASE,oBAAmB1W,EAAI2W,GAC/B,OAAQA,GACP,IAAKC,iBAAqB,MAAO5W,GAAG6W,MACpC,KAAKC,gBAAqB,MAAO9W,GAAG+W,KACpC,KAAKC,gBAAqB,MAAOhX,GAAGiX,UACpC,KAAKC,eAAqB,MAAOlX,GAAGmX,SACpC,KAAKzF,oBAAqB,MAAO1R,GAAGoX,SACpC,KAAKC,oBAAqB,MAAOrX,GAAGsX,cACpC,KAAKC,kBAAqB,MAAOvX,GAAGwX,YACpC,SAA0B,QAK5B,QAASC,eAAczX,EAAIiW,GAC1B,GAAIyB,GAAS,GAAI5C,WAAU9U,EAE3B,KAAK3Z,IAAK4vB,GAAOjE,SAASrP,WAAY,CACrC,GAAI7C,GAAOmW,EAAOjE,SAASrP,WAAWtc,EACtCqxB,GAAOlG,mBAAmB1R,EAAKsC,KAAMtC,EAAK/Y,KAAM,GAAI4f,cAAa7G,EAAKyW,SAGvE,IAAK1Z,IAAKoZ,GAAO/D,aAAaW,WAAY,CACzC,GAAI8E,GAAO1B,EAAO/D,aAAaW,WAAWhW,GACtC+a,EAAQlB,mBAAmBgB,EAAO1X,GAAI2X,EAAKpI,KAC/C,IAAaloB,QAATuwB,EAEJ,OAAQD,EAAKtW,MACZ,IAAKsO,4BACJ+H,EAAOG,mBAAmBF,EAAKvV,KAAMwV,EAAOD,EAAKzwB,MAAOywB,EAAK32B,OAC9D,MACA,KAAK8uB,8BACJ4H,EAAOjG,qBAAqBkG,EAAKvV,KAAMwV,EAAO,GAAIpE,aAAYmE,EAAKpB,UAOtE,MAAOmB,GAOR,QAASI,mBAAkB9X,EAAIsQ,EAAMuC,EAAYkF,GAChD,GAAIC,GAAWnF,GAAkB,YAC7BoF,EAAWF,GAAkB,KAE7BJ,EAAOrH,EAAK4B,aAAaW,WAAWmF,EAExC,KAAKL,EAAM,MAAO,KAClB,IAAIA,EAAKtW,MAAQyO,6BAA8B,MAAO,KAEtD,IAAIoI,GAAQxB,mBAAmB1W,EAAI2X,EAAKpI,KACxC,IAAaloB,QAAT6wB,EAAoB,MAAO,KAE/B,IAAIC,GAAW,CACf,IAAID,IAAUlY,EAAGoX,UAChBe,EAAS,MAEL,IAAID,IAAUlY,EAAG+W,MACrBoB,EAAS,MAEL,CAAA,GAAID,IAAUlY,EAAG6W,OAIrB,MAAO,KAHPsB,GAAS,EAMV,GAEIC,GAAaT,EAAKpB,OAClB52B,EAAay4B,EAAWp3B,MAC5BrB,IAAMA,EAAIw4B,CAEV,IAAIzD,GAAQ,EAER2D,EAAc,EACdC,EAAc,EACdC,KACAC,KAEAC,KACAC,IACJ,KAAK,GAAIryB,KAAKiqB,GAAK0B,SAASrP,WAAY,CACvC,GAAI7C,GAAQwQ,EAAK0B,SAASrP,WAAWtc,EACrCqyB,GAAWryB,IACV+b,KAAStC,EAAKsC,KACdrb,KAAS+Y,EAAK/Y,KACdwvB,WAIF,KAAe52B,EAAR+0B,GAAW,CAOjB,IAAK,GANDiE,MACAC,KACAC,EAAW,EAEXF,KACAE,EAAa,EACR13B,EAAEuzB,EAAS/0B,EAAFwB,EAAKA,GAAGg3B,EAAQ,CAGjC,IAAK,GAFDW,MACAC,EAAmB,EACdtxB,EAAE,EAAK0wB,EAAF1wB,IAAYA,EAAG,CAC5B,GAAIuxB,GAASZ,EAAWj3B,EAAEsG,EACAJ,SAAtByxB,EAAWE,KACdF,EAAWE,IAAU,EACK3xB,QAAtBsxB,EAAWK,IACdD,KAKH,KAAqCd,GAAhCY,EAAWE,GAcf,KAbA,KAAK,GAAItxB,GAAE,EAAK0wB,EAAF1wB,IAAYA,EAAG,CAC5B,GAAIuxB,GAASZ,EAAWj3B,EAAEsG,GACtBwxB,EAASN,EAAWK,EACV3xB,SAAV4xB,IACHN,EAAWK,GAAUH,EACrBI,EAASJ,EACTA,KAEDD,EAAWv3B,KAAK43B,GAEjBvE,GAASyD,EAOX,GAAgB,GAAZU,EAAe,KAEnB,IAAIK,GAAWN,EAAW53B,MAE1B,KAAK,GAAIqF,KAAKiqB,GAAK0B,SAASrP,WAAY,CACvC,GAAIwW,GAAW7I,EAAK0B,SAASrP,WAAWtc,GACpC+yB,EAAWV,EAAWryB,GACtBgzB,EAAWF,EAAQpyB,KACnBuyB,EAAWF,EAAQ7C,OAAOv1B,OAC1Bu4B,EAAW,GAAIt3B,OAAM42B,EAAWQ,EACpCD,GAAQ7C,OAAS6C,EAAQ7C,OAAOiD,OAAOD,EAEvC,IAAIE,GAAUN,EAAQ5C,OAClBmD,EAAUN,EAAQ7C,MACtB,KAAK,GAAIp1B,KAAKw3B,GAEb,IAAK,GADDM,GAASN,EAAWx3B,GACfwR,EAAE,EAAK0mB,EAAF1mB,IAAWA,EACxB+mB,EAAQJ,GAAWL,EAAOI,EAAM1mB,IAAM8mB,EAAQt4B,EAAEk4B,EAAM1mB,GAKzD8lB,EAAaA,EAAWe,OAAOZ,GAE/BL,EAAcl3B,KAAKg3B,GACnBG,EAAan3B,KAAKi3B,GAElBD,GAAeQ,EACfP,GAAeY,EAGhB,GAAI/nB,GAAI,GAAI2jB,WAAU9U,EAEtB,KAAK,GAAI3Z,KAAKqyB,GAAY,CACzB,GAAI5Y,GAAO4Y,EAAWryB,EACtB8K,GAAEqgB,mBAAmB1R,EAAKsC,KAAMtC,EAAK/Y,KAAM,GAAI4f,cAAa7G,EAAKyW,SAUlE,MAP4B,IAAxBgC,EAAcv3B,OACjBmQ,EAAEsgB,qBAAqBuG,EAAUE,EAAO,GAAI1E,aAAYiF,IAGxDtnB,EAAEwoB,2BAA2B3B,EAAUE,EAAO,GAAI1E,aAAYiF,GAAaD,EAAcD,GAGnFpnB,EAiDR,QAASyoB,gBACRp4B,KAAKq4B,QAAU/nB,gBACftQ,KAAKs4B,OAAa,EAAK,IAAO,EAAK,IACnCt4B,KAAKu4B,QAAUC,wBAEfx4B,KAAKy4B,QA2HN,QAASC,wBACR14B,KAAK24B,UAAY5uB,YACjB/J,KAAK44B,QAAY7uB,YAEjB/J,KAAK64B,OAAO,EAAK,EAAK,EAAK,EAAK,EAAK,GAAM,GA2J5C,QAASC,qBAAoBC,GAC5B,GAAIC,GAASh7B,SAASC,eAAe86B,EACrC,KAAKC,EAAQ,MAAO,KAKpB,KAAI,GAHAC,IAAgB,QAAQ,qBAAqB,YAAY,aAEzDza,EAAK,KACD7e,EAAI,EAAGA,EAAIs5B,EAAaz5B,OAAQG,IACxC,CACC,IAEC6e,EAAKwa,EAAOE,WAAWD,EAAat5B,IAErC,MAAOgD,GAAK6b,EAAK,KACX,GAAIA,EAAI,MAGf,MAAU,OAANA,EAAmB,MAEP3Y,QAAZ2Y,EAAG4N,QAAoB5N,EAAG4N,MAAQ,GACtBvmB,QAAZ2Y,EAAG2a,OAAoB3a,EAAG2a,KAAQ,GAE/B3a,GAWR,QAAS4a,aAAYC,EAASC,EAASN,EAAQxa,GAC9Cxe,KAAKu5B,SAAWF,EAChBr5B,KAAKw5B,SAAWF,EAChBt5B,KAAKy5B,QAAWT,EAEhBh5B,KAAK05B,SAAW,KAChB15B,KAAK25B,SAAW,EAChB35B,KAAK45B,kBAAmB,EAExB55B,KAAKwe,GAAKA,EAEVxe,KAAK65B,UAAmB,KACxB75B,KAAK85B,YAAmB,KACxB95B,KAAK+5B,aAAmB,KACxB/5B,KAAKg6B,WAAmB,KACxBh6B,KAAKi6B,cAAmB,KACxBj6B,KAAKk6B,eAAmB,KACxBl6B,KAAKm6B,aAAmB,KACxBn6B,KAAKo6B,eAAmB,KACxBp6B,KAAKq6B,gBAAmB,KACxBr6B,KAAKs6B,WAAmB,KACxBt6B,KAAKu6B,cAAmB,KACxBv6B,KAAKw6B,YAAmB,KACxBx6B,KAAKy6B,YAAmB,KACxBz6B,KAAK06B,UAAmB,KAExB16B,KAAK26B,SAAmB,GAAI55B,QAE5Bf,KAAK46B,iBAAmB,GAAI75B,QAC5Bf,KAAK66B,UAAqBl4B,EAAE,EAAGU,EAAE,GACjCrD,KAAK86B,cAAqBn4B,EAAE,EAAGU,EAAE,GACjCrD,KAAK+6B,eAAqBp4B,EAAE,EAAGU,EAAE,GAEjCrD,KAAKg7B,QAAYC,KAAKC,MAAQ,IAC9Bl7B,KAAKm7B,SAAYn7B,KAAKg7B,QACtBh7B,KAAKo7B,UAAY,EAmElB,QAASC,mBAAkBtC,EAAUO,EAASgC,GAC7C,GAAItC,GAASh7B,SAASC,eAAe86B,EACrC,KAAKC,EAAQ,KAAM,IAAIn8B,OAAM,8BAE7Bm8B,GAAOuC,iBAAkB,CAEzB,IAAI/c,GAAKsa,oBAAoBC,EAC7B,KAAKva,EAAI,KAAM,IAAI3hB,OAAM,sCAEzB2hB,GAAGqH,YAAYrH,EAAGgd,eAAoC,GACtDhd,EAAGqH,YAAYrH,EAAGid,iBAAoC,GACtDjd,EAAGqH,YAAYrH,EAAGmH,qBAAoC,GACtDnH,EAAGqH,YAAYrH,EAAGkd,gCAAoC,GACtDld,EAAGqH,YAAYrH,EAAGmd,mCAAoCnd,EAAG0K,MAKzD1K,EAAGwK,gBAAgBxK,EAAGyK,YAAa,KAEnC,IAAI2S,GAAM,GAAIxC,aAAYp5B,KAAMs5B,EAASN,EAAQxa,EACjDxe,MAAK47B,GAAKA,CAEV,IAAIC,GAAM77B,IAEVA,MAAKwe,GAAUA,EACfxe,KAAKg5B,OAAUA,EACfh5B,KAAKs5B,QAAUA,EAGft5B,KAAKs5B,QAAQsC,GAAKA,EAElB57B,KAAK87B,cAAe,EACpB97B,KAAK+7B,WAAY,EACjB/7B,KAAKg8B,UAAY,WAChBH,EAAII,QAILj8B,KAAKg5B,OAAOkD,iBAAiB,OAAmB,SAASC,GAAKN,EAAIO,KAAaD,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,SAAmB,SAASC,GAAKN,EAAIQ,OAAaF,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,UAAmB,SAASC,GAAKN,EAAIS,QAAaH,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,QAAmB,SAASC,GAAKN,EAAIU,MAAaJ,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,WAAmB,SAASC,GAAKN,EAAIW,SAAaL,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,YAAmB,SAASC,GAAKN,EAAIY,UAAaN,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,UAAmB,SAASC,GAAKN,EAAIa,QAAaP,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,YAAmB,SAASC,GAAKN,EAAIc,UAAaR,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,QAAmB,SAASC,GAAKN,EAAIe,MAAaT,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,WAAmB,SAASC,GAAKN,EAAIgB,SAAaV,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,SAAmB,SAASC,GAAKN,EAAIiB,OAAaX,KAAO,GAEtFn8B,KAAKg5B,OAAOkD,iBAAiB,aAAmB,SAASC,GAAKN,EAAIkB,WAAaZ,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,iBAAmB,SAASC,GAAKN,EAAIkB,WAAaZ,KAAO,GAEtFn8B,KAAKg5B,OAAOkD,iBAAiB,OAAmB,SAASC,GAAKN,EAAImB,KAAab,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,WAAmB,SAASC,GAAKN,EAAIoB,SAAad,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,YAAmB,SAASC,GAAKN,EAAIqB,UAAcf,KAAO,GAEvFn8B,KAAKg5B,OAAOkD,iBAAiB,aAAmB,SAASC,GAAKN,EAAIsB,WAAahB,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,WAAmB,SAASC,GAAKN,EAAIuB,SAAajB,KAAO,GACtFn8B,KAAKg5B,OAAOkD,iBAAiB,YAAmB,SAASC,GAAKN,EAAIwB,UAAalB,KAAO,GAEtFn8B,KAAKo8B,OAEDd,IACHt7B,KAAK47B,GAAGN,WAAaA,GAsZvB,QAASgC,kBAAiBvE,EAAUO,EAASgC,GAC5C,GAAIjC,GAAU,GAAIgC,mBAAkBtC,EAAUO,EAASgC,EACvDiC,uBAAsBxE,GAAYM,EAGnC,QAASmE,oBAAmBzE,GACvBwE,sBAAsBxE,KACzBwE,sBAAsBxE,GAAY,WAC3BwE,uBAAsBxE,IAI/B,QAAS0E,wBAAuB1E,EAAUO,EAASgC,GAClDoC,OAAOxB,iBAAiB,OAAQ,WAAaoB,iBAAiBvE,EAAUO,EAASgC,KAAgB,GAGlG,QAASqC,0BAAyB5E,GACjC2E,OAAOxB,iBAAiB,SAAU,WAAasB,mBAAmBzE,KAAc,GAGjF,QAAS6E,mBAAkB7E,EAAUO,EAASgC,GAC7CmC,uBAAuB1E,EAAUO,EAASgC,GAC1CqC,yBAAyB5E,GAG1B,QAAS8E,yBAAwB9E,EAAUO,EAASgC,GACnDgC,iBAAiBvE,EAAUO,EAASgC,GACpCqC,yBAAyB5E,GAnzP1B,GAAI+E,mBAAyB,EACzBC,kBAAyB,EACzBC,qBAAyB,EACzBC,mBAAyBH,kBAAoB,IAAMC,kBAAoB,IAAMC,oBA6DjFN,QAAOxB,iBAAiB,OAAU,WAAav+B,kBAAoB,GACnE+/B,OAAOxB,iBAAiB,SAAU,WAAat+B,gBAAoB,EA6FnE,IAAIsgC,oBAAyB,EACzBC,sBAAyB,EACzBh+B,iBAAyB,EACzBi+B,oBAAyB,EACzBC,oBAAyB,EACzBC,mBAAyB,EACzBC,qBAAyB,EACzBC,sBAAyB,CAgB7B1+B,YAAWrC,WACVghC,uBAAyB,WACxB,GAAI/8B,GAAK1B,KACL2B,EAAK,SAAS+8B,GACjBh9B,EAAExB,QAAU,EAAO,sBAA0B,mBACzCwB,EAAEtB,SACLsB,EAAEtB,OAAOu+B,cAAcj9B,GACvB1B,KAAKI,OAAU,KAGhB,KAAK,GADDjC,GAAIuD,EAAErB,SAASb,OACVG,EAAE,EAAKxB,EAAFwB,IAAOA,EACpB+B,EAAErB,SAASV,GAAG+B,GAGhB,OAAOC,IAGRinB,GAAIA,UACH,MAAO5oB,MAAKE,SAGb0+B,GAAIA,YACH,MAAO5+B,MAAKC,WAGb2+B,GAAIA,UAASvjB,GACZrb,KAAKC,UAAYob,EACbrb,KAAKI,QACRJ,KAAKI,OAAOy+B,eAAe7+B,OAI7B6B,GAAIA,aACH,MAAQ7B,MAAKE,SAAWi+B,uBAGzBr8B,GAAIA,UACH,MAAQ9B,MAAKE,SAAWg+B,oBAGzB59B,mBAAqB,SAASkF,GACzBA,IACHxF,KAAKK,SAASR,KAAK2F,GACfxF,KAAK+B,SACRyD,EAAExF,QAKL8+B,sBAAwB,SAASt5B,GAGhC,IAAK,GAFDud,GAAQ,GACR5kB,EAAI6B,KAAKK,SAASb,OACbG,EAAE,EAAKxB,EAAFwB,IAAOA,EACpB,GAAIK,KAAKK,SAASV,IAAM6F,EAAG,CAC1Bud,EAAQpjB,CACR,OAGU,EAARojB,GACJ/iB,KAAKK,SAAS0+B,OAAOhc,EAAO,IAG7BhhB,GAAIA,WACH,MAAQ/B,MAAK8B,QAAU9B,KAAK6B,WAG7Bm9B,GAAIA,SACH,MAAOh/B,MAAKI,QAGblB,KAAO,WACN,IAAKc,KAAKi/B,MAAO,OAAO,CACxB,IAAIr9B,GAAI5B,KAAKi/B,OACb,IAAIr9B,EACH5B,KAAKE,QAAUk+B,wBAEX,CACJp+B,KAAKE,QAAUg+B,kBACf,IAAIv8B,GAAK3B,KAAKy+B,wBACd98B,IAAG,GAEJ,MAAOC,IAGRs9B,OAAS,WACJl/B,KAAKE,SAAWo+B,qBACft+B,KAAKI,SACRJ,KAAKI,OAAO++B,qBAAqBn/B,MACjCA,KAAKI,OAAU,MAEhBJ,KAAKE,QAAUs+B,wBAIjBY,MAAQ,WACPp/B,KAAKk/B,SACDl/B,KAAKE,SAAWk+B,sBACfp+B,KAAKI,SACRJ,KAAKI,OAAOi/B,sBAAsBr/B,MAClCA,KAAKI,OAAU,MAEZJ,KAAKs/B,QACRt/B,KAAKs/B,SAENt/B,KAAKE,QAAUm+B,uBAqBlB/gC,WAAWiD,mBAAoBT,YAU/BS,mBAAmB9C,UAAUwhC,MAAQ,WACpC,IAAKj/B,KAAKa,KAAM,OAAO,CAEvB,IAAIjC,GAAM,GAAIC,eACdmB,MAAKc,KAAOlC,CAEZ,IAAI+C,GAAK3B,KAAKy+B,wBAUd,OATA7/B,GAAIE,mBAAqB,WACxB,GAAsB,GAAlBF,EAAIG,WAAiB,CACxB,GAAI2/B,GAAM9/B,EAAU,OAAmB,KAAdA,EAAIgqB,QAAiB,CAC9CjnB,GAAG+8B,KAGL9/B,EAAIK,KAAK,MAAOe,KAAKa,MAAM,GAC3BjC,EAAIM,QAEG,GAGRqB,mBAAmB9C,UAAU6hC,OAAS,WAChCt/B,KAAKc,MACVd,KAAKc,KAAKs+B,SAmBX9hC,WAAW4D,gBAAiBpB,YAE5BoB,gBAAgBzD,UAAUwhC,MAAQ,WACjC,IAAKj/B,KAAKa,KAAM,OAAO,CAEvB,IAAI+lB,GAAM,GAAIC,MACd7mB,MAAKmB,KAAOylB,EACZA,EAAIE,YAAc,EAClB,IAAInlB,GAAK3B,KAAKy+B,wBASd,OARA7X,GAAIpC,OAAS,WACZ7iB,EAAGilB,EAAI2Y,WAER3Y,EAAI4Y,QAAU,WACb79B,GAAG,IAEJilB,EAAI7G,IAAM/f,KAAKa,MAER,GAGRK,gBAAgBzD,UAAU6hC,OAAS,aA0DnCl+B,kBAAkB3D,WACjBgiC,GAAIA,YACH,MAAOz/B,MAAKyB,OAGbI,GAAIA,aACH,MAAQ7B,MAAKuB,gBAAkBvB,KAAKyB,MAAMjC,QAG3CsC,GAAIA,UACH,MAAK9B,MAAKuB,eAAiBvB,KAAKwB,YAAexB,KAAKyB,MAAMjC,QAAe,EACjEQ,KAAKuB,eAAiBvB,KAAKyB,MAAMjC,QAG1CkgC,GAAIA,WACH,MAAO1/B,MAAKK,UAGbq/B,GAAIA,SAAQl6B,GACXxF,KAAKK,SAAWmF,EACZxF,KAAK+B,SACJ/B,KAAKK,UACRL,KAAKK,SAASqB,IAKjBK,GAAIA,WACH,MAAS/B,MAAKuB,eAAiBvB,KAAKwB,aAAgBxB,KAAKyB,MAAMjC,QAGhEN,KAAO,WAEN,IAAK,GADDf,GAAI6B,KAAKyB,MAAMjC,OACVG,EAAE,EAAKxB,EAAFwB,IAAOA,EACpBK,KAAKyB,MAAM9B,GAAGT,QAIhBggC,OAAS,WAER,IAAK,GADD/gC,GAAI6B,KAAKyB,MAAMjC,OACVG,EAAE,EAAKxB,EAAFwB,IAAOA,EACpBK,KAAKyB,MAAM9B,GAAGu/B,UAIhBE,MAAQ,WAEP,IAAK,GADDjhC,GAAI6B,KAAKyB,MAAMjC,OACVG,EAAE,EAAKxB,EAAFwB,IAAOA,EACpBK,KAAKyB,MAAM9B,GAAGy/B,UAyBjBp9B,gBAAgBvE,WACfkiC,MAAQ,WACF3/B,KAAKyC,SAEVzC,KAAKyC,QAAS,EACdzC,KAAKuC,gBAAkB,KACnBvC,KAAKsC,QAAQ9C,QAAU,IAEvBQ,KAAKwC,iBACRxC,KAAKsC,QAAQs9B,KAAK5/B,KAAKwC,kBAGvBxC,KAAKsC,QAAQs9B,OAEV5/B,KAAKsC,QAAQ9C,OAAS,IACzBQ,KAAKuC,gBAAkBvC,KAAKsC,QAAQ,OAItCu9B,mBAAqB,WACpB7/B,KAAKuC,gBAAkB,IACvB,IAAIpE,GAAI6B,KAAKsC,QAAQ9C,MACrB,MAAS,GAALrB,KAEJ6B,KAAKuC,gBAAkBvC,KAAKsC,QAAQ,GAC/BtC,KAAKyC,QAEV,IAAK,GAAI9C,GAAE,EAAKxB,EAAFwB,IAAOA,EAChBK,KAAK8/B,kBAAkB9/B,KAAKsC,QAAQ3C,GAAGi/B,SAAU5+B,KAAKuC,gBAAgBq8B,WAAa,IACtF5+B,KAAKuC,gBAAkBvC,KAAKsC,QAAQ3C,KAKvCogC,iBAAmB,SAASC,EAAKC,GAGhC,IAAK,GAFDld,GAAQ,GACR5kB,EAAI6hC,EAAIxgC,OACHG,EAAE,EAAKxB,EAAFwB,IAAOA,EACpB,GAAIqgC,EAAIrgC,IAAMsgC,EAAM,CACnBld,EAAQpjB,CACR,OAGU,EAARojB,GACJid,EAAIjB,OAAOhc,EAAO,IAGnBoc,qBAAuB,SAASv9B,GAC/B5B,KAAK+/B,iBAAiB//B,KAAKsC,QAASV,GAChC5B,KAAKsC,QAAQ9C,QAAU,EAC1BQ,KAAKuC,gBAAkB,KAEfX,GAAK5B,KAAKuC,iBAClBvC,KAAK6/B,sBAIPR,sBAAwB,SAASz9B,GAChC5B,KAAK+/B,iBAAiB//B,KAAKqC,SAAUT,GACrC5B,KAAKkgC,YAGNrB,eAAiB,SAASj9B,GACrB5B,KAAK8/B,kBAAkBl+B,EAAEg9B,SAAU5+B,KAAKuC,gBAAgBq8B,WAAa,IACxE5+B,KAAKuC,gBAAkBX,GAExB5B,KAAKyC,QAAS,GAGfk8B,cAAgB,SAAS/8B,GACxB5B,KAAKq/B,sBAAsBz9B,GACvB5B,KAAKK,UACRL,KAAKK,SAASuB,GAEf5B,KAAKkgC,YAGNA,SAAW,WACV,GAAI/hC,GAAI6B,KAAKsC,QAAQ9C,MACrB,MAAS,GAALrB,GAAJ,CACA,GAAIgiC,GAAYngC,KAAKmC,YAAc,EAAMnC,KAAKmC,YAAcnC,KAAKqC,SAAS7C,OAAU,CACpF,MAAgB,GAAZ2gC,GAAJ,CACIA,EAAWhiC,IAAGgiC,EAAWhiC,GAC7B6B,KAAK2/B,OAEL,KAAK,GADD/9B,GAAI,KACCjC,EAAE,EAAKwgC,EAAFxgC,IAAcA,EAC3BiC,EAAI5B,KAAKsC,QAAQ89B,MACjBx+B,EAAE1C,MAECc,MAAKsC,QAAQ9C,OAAS,IACzBQ,KAAKuC,gBAAkBvC,KAAKsC,QAAQ,OAItCw9B,kBAAoB,SAASj7B,EAAGC,GAC/B,MAAI9E,MAAKwC,iBACDxC,KAAKwC,iBAAiBqC,EAAGC,GAEzBD,EAAIC,GAGbu7B,GAAIA,mBACH,MAAOrgC,MAAKwC,kBAGb69B,GAAIA,iBAAgB76B,GACnBxF,KAAKwC,iBAAmBgD,EACxBxF,KAAK6/B,sBAGNH,GAAIA,WACH,MAAO1/B,MAAKK,UAGbq/B,GAAIA,SAAQl6B,GACXxF,KAAKK,SAAWmF,GAGjB3F,KAAO,SAAS+B,GACf,GAAIzC,IACHmhC,QAAU,KACVC,QAAU,EAGX,IAAI3+B,EAAEo9B,MAAO,MAAO7/B,EACpB,IAAIhB,GAAI6B,KAAKsC,QAAQ9C,OACjBghC,EAAaxgC,KAAKoC,WAAa,GAAOjE,GAAK6B,KAAKoC,UAEpD,IAAKo+B,GACAxgC,KAAK8/B,kBAAkBl+B,EAAEg9B,SAAU5+B,KAAKuC,gBAAgBq8B,WAAa,EAExE,MADAh9B,GAAE1B,QAAUq+B,qBACLp/B,CAITa,MAAKsC,QAAQzC,KAAK+B,GAClBA,EAAExB,OAAUJ,KACZ4B,EAAE1B,QAAUo+B,mBACZngC,IAEAgB,EAAIohC,QAAS,CAEb,IAAIE,GAAUzgC,KAAKoC,WAAa,EAAMjE,EAAI6B,KAAKoC,WAAc,CAC7D,IAAc,GAAVq+B,EACyB,MAAxBzgC,KAAKuC,gBACJvC,KAAK8/B,kBAAkBl+B,EAAEg9B,SAAU5+B,KAAKuC,gBAAgBq8B,WAAa,IACxE5+B,KAAKuC,gBAAkBX,GAIxB5B,KAAKuC,gBAAkBX,EAExB5B,KAAKyC,QAAS,MAEV,CACJzC,KAAK2/B,QACLxgC,EAAImhC,QAAUtgC,KAAKsC,QAAQ5B,MAAM,EAAG+/B,GACpCzgC,KAAKsC,QAAQy8B,OAAO,EAAG0B,EACvB,KAAK,GAAI9gC,GAAE,EAAK8gC,EAAF9gC,IAAYA,EACzBR,EAAImhC,QAAQ3gC,GAAGO,QAAUq+B,qBACzBp/B,EAAImhC,QAAQ3gC,GAAGS,OAAU,KAM3B,MAFAJ,MAAKkgC,WAEE/gC,GAoCT,IAAIuF,QAAS9B,KAAK89B,EA4xDlBplB,SAAQ7d,WACPkjC,MAAQ,WACP,MAAO,IAAIrlB,SAAQtb,OAGpB4gC,GAAIA,QACH,MAAO5gC,MAAK2gC,SAGbh+B,GAAIA,KAAO,MAAO3C,MAAK+F,EAAE,IACzBpD,GAAIA,GAAExE,GAAK6B,KAAK+F,EAAE,GAAK5H,GACvBkF,GAAIA,KAAO,MAAOrD,MAAK+F,EAAE,IACzB1C,GAAIA,GAAElF,GAAK6B,KAAK+F,EAAE,GAAK5H,GAEvB0iC,IAAM,SAASl+B,EAAGU,GAGjB,MAFArD,MAAK+F,EAAE,GAAKpD,EACZ3C,KAAK+F,EAAE,GAAK1C,EACLrD,MAGRub,OAAS,SAASxV,GACjB,MAAO/F,MAAK6gC,IAAI96B,EAAE,GAAIA,EAAE,KAGzByV,UAAY,SAAS7U,GACpB,MAAO3G,MAAK6gC,IAAIl6B,EAAGA,IAGpB8U,QAAU,WACT,MAAOzb,MAAKwb,UAAU,IAGvBslB,OAAS,WACR,MAAO9gC,MAAKwb,UAAU,IAGvBulB,GAAK,SAASphC,GACb,MAAOK,MAAK+F,EAAEpG,IAGfqhC,GAAIA,iBACH,MAAOhhC,MAAKihC,IAAIjhC,OAGjBR,GAAIA,UACH,MAAO0D,SAAQlD,KAAKghC,gBAGrBjlB,UAAY,WACX,GAAIvW,GAAIxF,KAAKR,MAIb,OAHIgG,GAAI,IAAKA,EAAI,EAAMA,GACvBxF,KAAK+F,EAAE,IAAMP,EACbxF,KAAK+F,EAAE,IAAMP,EACNxF,MAGRkxB,GAAIA,cACH,MAAOlxB,MAAK2gC,QAAQ5kB,aAGrBmlB,GAAIA,OACH,MAAO,IAAI5lB,UAAUtb,KAAK+F,EAAE,IAAO/F,KAAK+F,EAAE,KAG3ClD,GAAIA,OACH,MAAO,IAAIyY,SAAQ5Y,OAAO1C,KAAK+F,EAAE,IAAKrD,OAAO1C,KAAK+F,EAAE,MAGrDo7B,GAAIA,WACH,GAAIxxB,GAAI3P,KAAK+F,EAAE,EAEf,OADI4J,GAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IACvB4J,GAGRyxB,GAAIA,WACH,GAAIzxB,GAAI3P,KAAK+F,EAAE,EAEf,OADI4J,GAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IACvB4J,GAGR0xB,GAAIA,UACH,GAAIx8B,GAAI,CAER,OADI7E,MAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GACxBA,GAGRy8B,GAAIA,UACH,GAAIz8B,GAAI,CAER,OADI7E,MAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GACxBA,GAGR08B,IAAM,SAASx7B,GACd,MAAO,IAAIuV,SAAQtb,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAGxDy7B,IAAM,SAASz7B,GACd,MAAO,IAAIuV,SAAQtb,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAGxD07B,IAAM,SAAS17B,GACd,MAAO,IAAIuV,SAAQtb,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAGxD27B,IAAM,SAAS37B,GACd,MAAO,IAAIuV,SAAQtb,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAGxD47B,GAAIA,OACH,MAAO,IAAIrmB,SAAQ,EAAMtb,KAAK+F,EAAE,GAAI,EAAM/F,KAAK+F,EAAE,KAGlDk7B,IAAM,SAASl7B,GACd,MAAQ/F,MAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,IAG9C67B,MAAQ,SAAS77B,GAChB,MAAQ/F,MAAK+F,EAAE,GAAGA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAGA,EAAEA,EAAE,IAG1ChB,IAAM,SAASgB,GACd,MAAO,IAAIuV,SAAQ1W,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKnB,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,MAGrEd,IAAM,SAASc,GACd,MAAO,IAAIuV,SAAQtW,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKf,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,OAoCtE2V,QAAQje,WACPkjC,MAAQ,WACP,MAAO,IAAIjlB,SAAQ1b,OAGpB4gC,GAAIA,QACH,MAAO5gC,MAAK2gC,SAGbh+B,GAAIA,KAAO,MAAO3C,MAAK+F,EAAE,IACzBpD,GAAIA,GAAExE,GAAK6B,KAAK+F,EAAE,GAAK5H,GACvBkF,GAAIA,KAAO,MAAOrD,MAAK+F,EAAE,IACzB1C,GAAIA,GAAElF,GAAK6B,KAAK+F,EAAE,GAAK5H,GACvBoL,GAAIA,KAAO,MAAOvJ,MAAK+F,EAAE,IACzBwD,GAAIA,GAAEpL,GAAK6B,KAAK+F,EAAE,GAAK5H,GAEvB0iC,IAAM,SAASl+B,EAAGU,EAAGkG,GAIpB,MAHAvJ,MAAK+F,EAAE,GAAKpD,EACZ3C,KAAK+F,EAAE,GAAK1C,EACZrD,KAAK+F,EAAE,GAAKwD,EACLvJ,MAGRub,OAAS,SAASxV,GACjB,MAAO/F,MAAK6gC,IAAI96B,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAG/ByV,UAAY,SAAS7U,GACpB,MAAO3G,MAAK6gC,IAAIl6B,EAAGA,EAAGA,IAGvB8U,QAAU,WACT,MAAOzb,MAAKwb,UAAU,IAGvBslB,OAAS,WACR,MAAO9gC,MAAKwb,UAAU,IAGvBulB,GAAK,SAASphC,GACb,MAAOK,MAAK+F,EAAEpG,IAGfqhC,GAAIA,iBACH,MAAOhhC,MAAKihC,IAAIjhC,OAGjBR,GAAIA,UACH,MAAO0D,SAAQlD,KAAKghC,gBAGrBjlB,UAAY,WACX,GAAIvW,GAAIxF,KAAKR,MAKb,OAJIgG,GAAI,IAAKA,EAAI,EAAMA,GACvBxF,KAAK+F,EAAE,IAAMP,EACbxF,KAAK+F,EAAE,IAAMP,EACbxF,KAAK+F,EAAE,IAAMP,EACNxF,MAGRkxB,GAAIA,cACH,MAAOlxB,MAAK2gC,QAAQ5kB,aAGrBmlB,GAAIA,OACH,MAAO,IAAIxlB,UAAU1b,KAAK+F,EAAE,IAAO/F,KAAK+F,EAAE,IAAO/F,KAAK+F,EAAE,KAGzDlD,GAAIA,OACH,MAAO,IAAI6Y,SAAQhZ,OAAO1C,KAAK+F,EAAE,IAAKrD,OAAO1C,KAAK+F,EAAE,IAAKrD,OAAO1C,KAAK+F,EAAE,MAGxEo7B,GAAIA,WACH,GAAIxxB,GAAI3P,KAAK+F,EAAE,EAGf,OAFI4J,GAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IAC1B4J,EAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IACvB4J,GAGRyxB,GAAIA,WACH,GAAIzxB,GAAI3P,KAAK+F,EAAE,EAGf,OAFI4J,GAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IAC1B4J,EAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IACvB4J,GAGR0xB,GAAIA,UACH,GAAIx8B,GAAI,CAGR,OAFI7E,MAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GAC3B7E,KAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GACxBA,GAGRy8B,GAAIA,UACH,GAAIz8B,GAAI,CAGR,OAFI7E,MAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GAC3B7E,KAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GACxBA,GAGR08B,IAAM,SAASx7B,GACd,MAAO,IAAI2V,SAAQ1b,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAG5Ey7B,IAAM,SAASz7B,GACd,MAAO,IAAI2V,SAAQ1b,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAG5E07B,IAAM,SAAS17B,GACd,MAAO,IAAI2V,SAAQ1b,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAG5E27B,IAAM,SAAS37B,GACd,MAAO,IAAI2V,SAAQ1b,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAG5E47B,GAAIA,OACH,MAAO,IAAIjmB,SAAQ,EAAM1b,KAAK+F,EAAE,GAAI,EAAM/F,KAAK+F,EAAE,GAAI,EAAM/F,KAAK+F,EAAE,KAGnEk7B,IAAM,SAASl7B,GACd,MAAQ/F,MAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,IAGnE67B,MAAQ,SAAS77B,GAChB,MAAO,IAAI2V,SAAQ1b,KAAK+F,EAAE,GAAGA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAGA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAGA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAGA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAGA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAGA,EAAEA,EAAE;EAG/HhB,IAAM,SAASgB,GACd,MAAO,IAAI2V,SAAQ9W,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKnB,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKnB,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,MAGhGd,IAAM,SAASc,GACd,MAAO,IAAI2V,SAAQ1W,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKf,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKf,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,OAoCjG4V,QAAQle,WACPkjC,MAAQ,WACP,MAAO,IAAIhlB,SAAQ3b,OAGpB4gC,GAAIA,QACH,MAAO5gC,MAAK2gC,SAGbh+B,GAAIA,KAAO,MAAO3C,MAAK+F,EAAE,IACzBpD,GAAIA,GAAExE,GAAK6B,KAAK+F,EAAE,GAAK5H,GACvBkF,GAAIA,KAAO,MAAOrD,MAAK+F,EAAE,IACzB1C,GAAIA,GAAElF,GAAK6B,KAAK+F,EAAE,GAAK5H,GACvBoL,GAAIA,KAAO,MAAOvJ,MAAK+F,EAAE,IACzBwD,GAAIA,GAAEpL,GAAK6B,KAAK+F,EAAE,GAAK5H,GACvBuL,GAAIA,KAAO,MAAO1J,MAAK+F,EAAE,IACzB2D,GAAIA,GAAEvL,GAAK6B,KAAK+F,EAAE,GAAK5H,GAEvB0iC,IAAM,SAASl+B,EAAGU,EAAGkG,EAAGG,GAKvB,MAJA1J,MAAK+F,EAAE,GAAKpD,EACZ3C,KAAK+F,EAAE,GAAK1C,EACZrD,KAAK+F,EAAE,GAAKwD,EACZvJ,KAAK+F,EAAE,GAAK2D,EACL1J,MAGRub,OAAS,SAASxV,GACjB,MAAO/F,MAAK6gC,IAAI96B,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAGrCyV,UAAY,SAAS7U,GACpB,MAAO3G,MAAK6gC,IAAIl6B,EAAGA,EAAGA,EAAGA,IAG1B8U,QAAU,WACT,MAAOzb,MAAKwb,UAAU,IAGvBslB,OAAS,WACR,MAAO9gC,MAAKwb,UAAU,IAGvBulB,GAAK,SAASphC,GACb,MAAOK,MAAK+F,EAAEpG,IAGfqhC,GAAIA,iBACH,MAAOhhC,MAAKihC,IAAIjhC,OAGjBR,GAAIA,UACH,MAAO0D,SAAQlD,KAAKghC,gBAGrBjlB,UAAY,WACX,GAAIvW,GAAIxF,KAAKR,MAMb,OALIgG,GAAI,IAAKA,EAAI,EAAMA,GACvBxF,KAAK+F,EAAE,IAAMP,EACbxF,KAAK+F,EAAE,IAAMP,EACbxF,KAAK+F,EAAE,IAAMP,EACbxF,KAAK+F,EAAE,IAAMP,EACNxF,MAGRkxB,GAAIA,cACH,MAAOlxB,MAAK2gC,QAAQ5kB,aAGrBmlB,GAAIA,OACH,MAAO,IAAIvlB,UAAU3b,KAAK+F,EAAE,IAAO/F,KAAK+F,EAAE,IAAO/F,KAAK+F,EAAE,IAAO/F,KAAK+F,EAAE,KAGvElD,GAAIA,OACH,MAAO,IAAI8Y,SAAQjZ,OAAO1C,KAAK+F,EAAE,IAAKrD,OAAO1C,KAAK+F,EAAE,IAAKrD,OAAO1C,KAAK+F,EAAE,IAAKrD,OAAO1C,KAAK+F,EAAE,MAG3Fo7B,GAAIA,WACH,GAAIxxB,GAAI3P,KAAK+F,EAAE,EAIf,OAHI4J,GAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IAC1B4J,EAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IAC1B4J,EAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IACvB4J,GAGRyxB,GAAIA,WACH,GAAIzxB,GAAI3P,KAAK+F,EAAE,EAIf,OAHI4J,GAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IAC1B4J,EAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IAC1B4J,EAAI3P,KAAK+F,EAAE,KAAI4J,EAAI3P,KAAK+F,EAAE,IACvB4J,GAGR0xB,GAAIA,UACH,GAAIx8B,GAAI,CAIR,OAHI7E,MAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GAC3B7E,KAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GAC3B7E,KAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GACxBA,GAGRy8B,GAAIA,UACH,GAAIz8B,GAAI,CAIR,OAHI7E,MAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GAC3B7E,KAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GAC3B7E,KAAK+F,EAAElB,GAAK7E,KAAK+F,EAAE,KAAIlB,EAAI,GACxBA,GAGR08B,IAAM,SAASx7B,GACd,MAAO,IAAI4V,SAAQ3b,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAGhGy7B,IAAM,SAASz7B,GACd,MAAO,IAAI4V,SAAQ3b,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAGhG07B,IAAM,SAAS17B,GACd,MAAO,IAAI4V,SAAQ3b,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAGhG27B,IAAM,SAAS37B,GACd,MAAO,IAAI4V,SAAQ3b,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAI/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,KAGhG47B,GAAIA,OACH,MAAO,IAAIhmB,SAAQ,EAAM3b,KAAK+F,EAAE,GAAI,EAAM/F,KAAK+F,EAAE,GAAI,EAAM/F,KAAK+F,EAAE,GAAI,EAAM/F,KAAK+F,EAAE,KAGpFk7B,IAAM,SAASl7B,GACd,MAAQ/F,MAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,GAAK/F,KAAK+F,EAAE,GAAKA,EAAEA,EAAE,IASxFhB,IAAM,SAASgB,GACd,MAAO,IAAI4V,SAAQ/W,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKnB,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKnB,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKnB,OAAO5E,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,MAG3Hd,IAAM,SAASc,GACd,MAAO,IAAI4V,SAAQ3W,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKf,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKf,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,IAAKf,OAAOhF,KAAK+F,EAAE,GAAIA,EAAEA,EAAE,OAiD5H6V,UAAUne,WACToe,GAAIA,UAAY,MAAO7b,MAAKgc,SAC5BH,GAAIA,QAAO1d,GAAK6B,KAAKgc,QAAU7d,EAAEuC,MAAM,EAAG,IAE1Cob,GAAIA,UAAY,MAAO9b,MAAKic,SAC5BH,GAAIA,QAAO+lB,GAAK7hC,KAAKic,QAAU4lB,EAAEC,MAAM,EAAG,IAE1CnB,MAAQ,WACP,MAAO,IAAI/kB,WAAU5b,KAAKgc,QAAShc,KAAKic,SAAS,IAGlD2kB,GAAIA,QACH,MAAO5gC,MAAK2gC,SAGbzkB,MAAQ,SAASL,EAAQC,EAAQimB,GAMhC,GALA/hC,KAAKgc,QAAQ,GAAKH,EAAO,GACzB7b,KAAKgc,QAAQ,GAAKH,EAAO,GACzB7b,KAAKgc,QAAQ,GAAKH,EAAO,GACzB7b,KAAKic,QAAaH,EAEdC,UAAW,CACd,GAAIpV,GAAIzD,QAAQ+H,SAASjL,KAAKgc,SAE1BrV,GAAI,IACPA,EAAI,EAAMA,EACVmF,cAAc9L,KAAKgc,QAASrV,GAC5B3G,KAAKic,SAActV,MAuBvBwV,QAAQ1e,WACPsH,GAAIA,OAAS,MAAO/E,MAAKoc,MACzBrX,GAAIA,KAAI4K,GAAK3P,KAAKoc,KAAOzM,EAAEjP,MAAM,EAAG,IAEpCuE,GAAIA,OAAS,MAAOjF,MAAKqc,MACzBpX,GAAIA,KAAI0K,GAAK3P,KAAKqc,KAAO1M,EAAEjP,MAAM,EAAG,IAEpCigC,MAAQ,WACP,MAAO,IAAIxkB,SAAQnc,KAAKoc,KAAMpc,KAAKqc,OAGpCukB,GAAIA,QACH,MAAO5gC,MAAK2gC,SAGbzkB,MAAQ,SAASnX,EAAKE,GACrB,IAAK,GAAItF,GAAE,EAAK,EAAFA,IAAOA,EACpBK,KAAKoc,KAAKzc,GAAKoF,EAAIpF,GACnBK,KAAKqc,KAAK1c,GAAKsF,EAAItF,EAEpB,OAAOK,OAGRgiC,GAAIA,UACH,MAAQhiC,MAAKoc,KAAK,GAAKpc,KAAKqc,KAAK,IAGlC4lB,GAAIA,WACH,MACKjiC,MAAKoc,KAAK,IAAMpc,KAAKqc,KAAK,IAC1Brc,KAAKoc,KAAK,IAAMpc,KAAKqc,KAAK,IAC1Brc,KAAKoc,KAAK,IAAMpc,KAAKqc,KAAK,IAIhCE,GAAIA,UACH,MAAOzQ,eAAc1B,SAASpK,KAAKoc,KAAMpc,KAAKqc,MAAO,KAGtD9W,GAAIA,QACH,MAAOgF,UAASvK,KAAKqc,KAAMrc,KAAKoc,OAGjC8lB,GAAIA,mBACH,GAAIv7B,GAAI3G,KAAKuF,IACb,OAAO0F,UAAStE,EAAGA,IAGpBw7B,GAAIA,YACH,MAAOj/B,SAAQlD,KAAKkiC,kBAGrBE,GAAIA,cACH,GAAIz7B,GAAI3G,KAAKuF,IACb,QACEoB,EAAE,GAAKA,EAAE,GACTA,EAAE,GAAKA,EAAE,GACTA,EAAE,GAAKA,EAAE,KAIZ07B,GAAIA,eACH,GAAIx9B,GAAI7E,KAAKsiC,SACb,OAA+B,IAAtBz9B,EAAE,GAAKA,EAAE,GAAKA,EAAE,KAG1B09B,GAAIA,UACH,GAAI57B,GAAI3G,KAAKuF,IACb,OAAQoB,GAAE,GAAKA,EAAE,GAAKA,EAAE,IAGzBmV,OAAS,SAAS0mB,GAGjB,MAFA72B,eAAc3L,KAAKoc,KAAKzc,GAAI6iC,GAC5Bh3B,cAAcxL,KAAKqc,KAAK1c,GAAI6iC,GACrBxiC,MAGRyiC,OAAS,SAAS1f,GACjB,GAAIpc,GAAI3G,KAAKuF,IACb,QACCvF,KAAKoc,KAAK,IAAQ2G,EAAQ,GAAY,EAAS,EAAQ,GAASpc,EAAE,GAClE3G,KAAKoc,KAAK,IAAS2G,EAAQ,EAAK,GAAM,EAAS,EAAQ,GAASpc,EAAE,GAClE3G,KAAKoc,KAAK,IAAQ2G,EAAQ,GAAY,EAAS,EAAQ,GAASpc,EAAE,KAIpE+7B,YAAc,SAASC,GACtB,GAAI79B,GAAI,GAAIqX,SACRd,EAAIlH,WAAWwuB,EAAQ3iC,KAAKyiC,OAAO,GAAI,EAC3C39B,GAAEC,IAAMsW,EACRvW,EAAEG,IAAMoW,CACR,KAAK,GAAI1b,GAAE,EAAK,EAAFA,IAAOA,EACpB0b,EAAIlH,WAAWwuB,EAAQ3iC,KAAKyiC,OAAO9iC,GAAI,GACvCmF,EAAEC,IAAMuH,SAASxH,EAAEC,IAAKsW,GACxBvW,EAAEG,IAAMsH,SAASzH,EAAEG,IAAKoW,EAEzB,OAAOvW,IAGR89B,SAAW,SAASvnB,GASnB,MARIrb,MAAKgiC,QACRhiC,KAAK+E,IAAMsW,EACXrb,KAAKiF,IAAMoW,IAGXrb,KAAK+E,IAAMuH,SAAStM,KAAK+E,IAAKsW,GAC9Brb,KAAKiF,IAAMsH,SAASvM,KAAK+E,IAAKsW,IAExBrb,MAGR6iC,OAAS,SAAS/9B,GAWjB,MAVKA,GAAEk9B,SACFhiC,KAAKgiC,QACRhiC,KAAK+E,IAAMD,EAAEC,IACb/E,KAAKiF,IAAMH,EAAEG,MAGbjF,KAAK+E,IAAMuH,SAAStM,KAAK+E,IAAKD,EAAEC,KAChC/E,KAAKiF,IAAMsH,SAASvM,KAAKiF,IAAKH,EAAEG,OAG3BjF,OAqBTsc,WAAW7e,WACV8e,GAAIA,UAAY,MAAOvc,MAAKyc,SAC5BF,GAAIA,QAAOpL,GAAKnR,KAAKyc,QAAUtL,EAAEzQ,MAAM,EAAG,IAE1C8b,GAAIA,UAAY,MAAOxc,MAAK8iC,SAC5BtmB,GAAIA,QAAO5a,GAAK5B,KAAK0c,QAAU9a,GAE/B++B,MAAQ,WACP,MAAO,IAAIrkB,YAAWtc,KAAKyc,QAASzc,KAAK0c,UAG1CkkB,GAAIA,QACH,MAAO5gC,MAAK2gC,SAGbzkB,MAAQ,SAASK,EAAQC,GAKxB,MAJAxc,MAAKyc,QAAQ,GAAKF,EAAO,GACzBvc,KAAKyc,QAAQ,GAAKF,EAAO,GACzBvc,KAAKyc,QAAQ,GAAKF,EAAO,GACzBvc,KAAK0c,QAAaF,EACXxc,MAGRgiC,GAAIA,UACH,MAAQhiC,MAAK0c,QAAU,GAGxBulB,GAAIA,WACH,MAAwB,IAAhBjiC,KAAK0c,SAGd2lB,GAAIA,eACH,MAAQ,GAAM39B,OAAS1E,KAAK0c,QAAU1c,KAAK0c,SAG5C6lB,GAAIA,UACH,MAAS,GAAM,EAAO79B,OAAS1E,KAAK0c,QAAU1c,KAAK0c,QAAU1c,KAAK0c,UA8CpEC,eAAelf,WACdkjC,MAAQ,WACP,GAAIoC,GAAK,GAAIpmB,eACbomB,GAAGp8B,IACH,KAAK,GAAIhH,GAAE,EAAGA,EAAGK,KAAK6c,GAAG,IAAMld,EAC9BojC,EAAGnmB,GAAG/c,KAAK2Q,SAASxQ,KAAK4c,GAAGjd,IAE7B,OAAOojC,IAGRnC,GAAIA,QACH,MAAO5gC,MAAK2gC,SAGblI,MAAQ,WAIP,MAHAz4B,MAAK4c,MACL5c,KAAK4c,GAAG/c,KAAKyQ,iBACbtQ,KAAK6c,GAAK,EACH7c,MAGRuF,GAAIA,QACH,MAAQvF,MAAK6c,GAAK,GAGnBlE,GAAIA,OACH,MAAOnI,UAASxQ,KAAK4c,GAAG5c,KAAK6c,MAG9BmmB,GAAIA,UACH,MAAOhjC,MAAK4c,GAAG5c,KAAK6c,KAGrBhd,KAAO,WAGN,MAFAG,MAAK4c,GAAG/c,KAAK2Q,SAASxQ,KAAK4c,GAAG5c,KAAK6c,MACnC7c,KAAK6c,KACE7c,MAGRogC,IAAM,WAKL,MAJIpgC,MAAK6c,GAAK,IACb7c,KAAK4c,GAAGwjB,MACRpgC,KAAK6c,MAEC7c,MAGRo8B,KAAO,SAASzsB,GAEf,MADA3P,MAAK4c,GAAG5c,KAAK6c,IAAMrM,SAASb,GACrB3P,MAGRijC,SAAW,SAAStzB,GAEnB,MADA3P,MAAK4c,GAAG5c,KAAK6c,IAAM7K,SAAShS,KAAK4c,GAAG5c,KAAK6c,IAAKlN,GACvC3P,MAGRkjC,aAAe,WAEd,MADAljC,MAAK4c,GAAG5c,KAAK6c,IAAMvM,gBACZtQ,MAGRmjC,UAAY,SAASxgC,EAAGU,EAAGkG,GAC1B,MAAOvJ,MAAKijC,SAASntB,kBAAkBnT,EAAGU,EAAGkG,KAG9C65B,OAAS,SAASntB,EAAUtT,EAAGU,EAAGkG,GACjC,MAAOvJ,MAAKijC,SAASnsB,wBAAwBb,EAAUtT,EAAGU,EAAGkG,KAG9D85B,MAAQ,SAAS1gC,EAAGU,EAAGkG,GACtB,MAAOvJ,MAAKijC,SAAS/rB,cAAcvU,EAAGU,EAAGkG,KAG1CsvB,OAAS,SAASphB,EAAWC,EAAWC,EAAWC,EAASC,EAASC,EAASC,EAAKC,EAAKC,GACvF,MAAOjY,MAAKijC,SAASzrB,aAAaC,EAAWC,EAAWC,EAAWC,EAASC,EAASC,EAASC,EAAKC,EAAKC,KAGzGqrB,MAAQ,SAAS9qB,EAAMC,EAAOC,EAAQC,EAAKC,EAAOC,GACjD,MAAO7Y,MAAKijC,SAAS1qB,YAAYC,EAAMC,EAAOC,EAAQC,EAAKC,EAAOC,KAGnE0qB,QAAU,SAAS/qB,EAAMC,EAAOC,EAAQC,EAAKC,EAAOC,GACnD,MAAO7Y,MAAKijC,SAAShqB,cAAcT,EAAMC,EAAOC,EAAQC,EAAKC,EAAOC,KAGrE2qB,YAAc,SAASrqB,EAASC,EAAaR,EAAOC,GACnD,MAAO7Y,MAAKijC,SAAS/pB,iBAAiBC,EAASC,EAAaR,EAAOC,MAkBrEiE,kBAAkBrf,WACjBkjC,MAAQ,WACP,GAAIlqB,GAAK,GAAIqG,kBAIb,OAHArG,GAAGsG,IAAM/c,KAAK+c,IAAI4jB,QAClBlqB,EAAGuG,IAAMhd,KAAKgd,IAAI2jB,QAClBlqB,EAAGwG,IAAMjd,KAAKid,IAAI0jB,QACXlqB,GAGRmqB,GAAIA,QACH,MAAO5gC,MAAK2gC,SAGblI,MAAQ,WAIP,MAHAz4B,MAAK+c,IAAI0b,QACTz4B,KAAKgd,IAAIyb,QACTz4B,KAAKid,IAAIwb,QACFz4B,MAGRyjC,GAAIA,SACH,MAAOzjC,MAAK+c,KAGb2mB,GAAIA,QACH,MAAO1jC,MAAKgd,KAGb2mB,GAAIA,cACH,MAAO3jC,MAAKid,KAGb2mB,GAAIA,eACH,MAAO5jC,MAAKyjC,MAAM9qB,KAGnBkrB,GAAIA,kBACH,MAAO7jC,MAAKyjC,MAAMT,QAGnBc,GAAIA,wBACH,MAAOpvB,gBAAe1U,KAAK6jC,iBAG5BE,GAAIA,sBACH,MAAOpuB,cAAa3V,KAAK6jC,iBAG1BG,GAAIA,+BACH,MAAOtvB,gBAAe1U,KAAK+jC,qBAG5BE,GAAIA,cACH,MAAOjkC,MAAK0jC,KAAK/qB,KAGlBurB,GAAIA,iBACH,MAAOlkC,MAAK0jC,KAAKV,QAGlBmB,GAAIA,uBACH,MAAOzvB,gBAAe1U,KAAKkkC,gBAG5BE,GAAIA,qBACH,MAAOzuB,cAAa3V,KAAKkkC,gBAG1BG,GAAIA,8BACH,MAAO3vB,gBAAe1U,KAAKokC,oBAG5B/mB,GAAIA,oBACH,MAAOrd,MAAK2jC,WAAWhrB,KAGxB2rB,GAAIA,uBACH,MAAOtkC,MAAK2jC,WAAWX,QAGxBuB,GAAIA,6BACH,MAAO7vB,gBAAe1U,KAAKskC,sBAG5BE,GAAIA,2BACH,MAAO7uB,cAAa3V,KAAKskC,sBAG1BG,GAAIA,oCACH,MAAO/vB,gBAAe1U,KAAKwkC,0BAG5BlnB,GAAIA,mBACH,MAAOtL,UAAShS,KAAKkkC,cAAelkC,KAAK6jC,iBAG1Ca,GAAIA,4BACH,MAAOhwB,gBAAe1U,KAAKsd,kBAG5BqnB,GAAIA,0BACH,MAAOhvB,cAAa3V,KAAKsd,kBAG1BsnB,GAAIA,mCACH,MAAOlwB,gBAAe1U,KAAK2kC,yBAG5BE,GAAIA,wBACH,MAAO7yB,UAAShS,KAAKskC,oBAAqBtkC,KAAKkkC,gBAGhDY,GAAIA,iCACH,MAAOpwB,gBAAe1U,KAAK6kC,uBAG5BE,GAAIA,+BACH,MAAOpvB,cAAa3V,KAAK6kC,uBAG1BG,GAAIA,wCACH,MAAOtwB,gBAAe1U,KAAK+kC,8BAG5BjnB,GAAIA,6BACH,MAAO9L,UAAShS,KAAKskC,oBAAqBtyB,SAAShS,KAAKkkC,cAAelkC,KAAK6jC,kBAG7EoB,GAAIA,sCACH,MAAOvwB,gBAAe1U,KAAK8d,4BAG5BonB,GAAIA,oCACH,MAAOvvB,cAAa3V,KAAK8d,4BAG1BqnB,GAAIA,6CACH,MAAOzwB,gBAAe1U,KAAKklC,mCAG5BE,GAAIA,0BACH,MAAO7zB,WAAUvR,KAAKgkC,8BAGvBqB,GAAIA,yBACH,MAAO9zB,WAAUvR,KAAK4kC,kCAGvBU,GAAIA,4BACH,MAAO/1B,WAAU2B,YAAYlR,KAAK2kC,uBAAwB,KAG3DY,GAAIA,2BACH,MAAOp7B,UAASoF,UAAUuB,YAAY9Q,KAAKsd,gBAAiB,MAG7DkoB,GAAIA,4BACH,MAAOj2B,WAAU2B,YAAYlR,KAAKokC,kBAAmB,KAGtDqB,GAAIA,2BACH,MAAOC,WAAUn2B,UAAUuB,YAAY9Q,KAAKkkC,cAAe,OAc7DhnB,iBAAiBzf,WAChBye,MAAQ,SAASypB,EAAIC,EAAIC,EAAIC,GAC5B,GAAIn/B,GAAI,EAAMzD,QAAQyiC,EAAGA,EAAKC,EAAGA,EAAKC,EAAGA,EAEzC7lC,MAAK6b,OAAO,GAAK8pB,EAAKh/B,EACtB3G,KAAK6b,OAAO,GAAK+pB,EAAKj/B,EACtB3G,KAAK6b,OAAO,GAAKgqB,EAAKl/B,EAEtB3G,KAAK8b,OAASgqB,EAAMn/B,EAEpB3G,KAAKmd,WAAW,GAAMnd,KAAK6b,OAAO,IAAM,EAAO,EAAM,EACrD7b,KAAKmd,WAAW,GAAMnd,KAAK6b,OAAO,IAAM,EAAO,EAAM,EACrD7b,KAAKmd,WAAW,GAAMnd,KAAK6b,OAAO,IAAM,EAAO,EAAM,GAQvD,IAAIkqB,qBAAwB,EACxBC,sBAAwB,EACxBC,mBAAwB,CAsB5B7oB,YAAW3f,WACVye,MAAQ,SAAUmB,EAAkBC,EAAiBC,GACpD,GAAI2oB,IACHh1B,YAAYoM,EAAiB,GAC7BpM,YAAYoM,EAAiB,GAC7BpM,YAAYoM,EAAiB,IAG1B6oB,GACHl4B,YAAYi4B,EAAI,IAChBj4B,YAAYi4B,EAAI,IAChBj4B,YAAYi4B,EAAI,KAGbE,EAAQp7B,SAASm7B,GAEjBE,EAAUpvB,cAAckvB,GACxBG,EAAUrvB,cAAcmvB,EAE5BF,GAAI,GAAKz4B,UAAUy4B,EAAI,GAAIE,EAAM,IACjCF,EAAI,GAAKz4B,UAAUy4B,EAAI,GAAIE,EAAM,IACjCF,EAAI,GAAKz4B,UAAUy4B,EAAI,GAAIE,EAAM,GAEjC,IAAIG,GAAUj2B,eACdS,cAAaw1B,EAAS,EAAGL,EAAI,IAC7Bn1B,aAAaw1B,EAAS,EAAGL,EAAI,IAC7Bn1B,aAAaw1B,EAAS,EAAGL,EAAI,IAE7BlmC,KAAKwd,WAAmBxL,SAASqL,EAAkBC,GACnDtd,KAAK2d,iBAAmB3L,SAASs0B,EAASt0B,SAASu0B,EAASF,IAC5DrmC,KAAKyd,UAAmBF,EAAS7c,MAAM,EAAG,GAE1CV,KAAK0d,IAAI,GAAyB,GAApB1d,KAAKyd,UAAU,GAC7Bzd,KAAK0d,IAAI,GAAK1d,KAAKyd,UAAU,GAAyB,GAApBzd,KAAKyd,UAAU,GACjDzd,KAAK0d,IAAI,GAAyB,GAApB1d,KAAKyd,UAAU,GAC7Bzd,KAAK0d,IAAI,GAAK1d,KAAKyd,UAAU,GAAyB,GAApBzd,KAAKyd,UAAU,EAGjD,IAAI9N,GAAI3P,KAAKwd,WACT3G,GAAMlH,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAExB3P,MAAK4d,QAAQ,GAAG1B,MAAMrF,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIA,EAAE,IAAMA,EAAE,KAC7E3P,KAAK4d,QAAQ,GAAG1B,MAAMrF,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIA,EAAE,IAAMA,EAAE,KAC7E3P,KAAK4d,QAAQ,GAAG1B,MAAMrF,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIA,EAAE,IAAMA,EAAE,KAC7E3P,KAAK4d,QAAQ,GAAG1B,MAAMrF,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIA,EAAE,IAAMA,EAAE,KAC7E3P,KAAK4d,QAAQ,GAAG1B,MAAMrF,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAE,IAAKA,EAAE,IAAMA,EAAE,KAC7E3P,KAAK4d,QAAQ,GAAG1B,MAAMrF,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAG,GAAIkH,EAAG,GAAKlH,EAAE,IAAKA,EAAE,IAAMA,EAAE,MAG9EuO,cAAgB,SAASH,EAAQC,GAMhC,IAAK,GALD7e,GAAM8mC,mBAENO,GAAYzoB,EAAQC,GAEpByoB,EAAK,KACA9mC,EAAE,EAAK,EAAFA,IAAOA,EAAG,CAEvB,GADA8mC,EAAKzmC,KAAK4d,QAAQje,GAEf8mC,EAAG5qB,OAAO,GAAK2qB,EAAQC,EAAGtpB,WAAW,IAAI,GACzCspB,EAAG5qB,OAAO,GAAK2qB,EAAQC,EAAGtpB,WAAW,IAAI,GACzCspB,EAAG5qB,OAAO,GAAK2qB,EAAQC,EAAGtpB,WAAW,IAAI,GACzCspB,EAAS,OAAK,EAEhB,MAAOV,oBAILU,GAAG5qB,OAAO,GAAK2qB,EAAQ,EAAIC,EAAGtpB,WAAW,IAAI,GAC7CspB,EAAG5qB,OAAO,GAAK2qB,EAAQ,EAAIC,EAAGtpB,WAAW,IAAI,GAC7CspB,EAAG5qB,OAAO,GAAK2qB,EAAQ,EAAIC,EAAGtpB,WAAW,IAAI,GAC7CspB,EAAS,OAAK,IAEhBtnC,EAAM6mC,uBAIR,MAAO7mC,IAGRunC,qBAAuB,SAASnqB,EAAQhX,GACvC,GAAIohC,GAAY,GAAPphC,EAELqhC,EAAKn6B,UAAU8P,EAAQ,GACvBsqB,IAAQF,EAAI,EAAK,EAAK,GACtBG,GAAQH,EAAI,EAAK,EAAK,EAE1BE,GAAKzyB,WAAWpU,KAAK2d,iBAAkBkpB,GACvCA,EAAK35B,SAAS25B,EAAID,GAClBC,EAAK14B,aAAaiG,WAAWpU,KAAKwd,WAAYqpB,IAE9CC,EAAK1yB,WAAWpU,KAAK2d,iBAAkBmpB,GACvCA,EAAK55B,SAAS45B,EAAIF,GAClBE,EAAK34B,aAAaiG,WAAWpU,KAAKwd,WAAYspB,GAa9C,IAAIC,GAAK/mC,KAAK0d,IAAI,GAAKhb,OAAOokC,EAAG,GAAKD,EAAG,GAEzC,OAAOE,KA46BTxc,gBAAgB9sB,WACfmtB,GAAIA,QAAS,MAAO5qB,MAAKwqB,OAEzBwc,QAAU,WACLhnC,KAAKwqB,MAAMzL,OACd/e,KAAKwe,GAAGyoB,aAAajnC,KAAKwqB,MAAM1L,QAEjC9e,KAAKwqB,MAAQ,MAGd1L,GAAIA,UACH,MAAO9e,MAAKwqB,MAAM1L,QAGnBuR,GAAIA,WACH,MAAOrwB,MAAKwqB,MAAMzL,OAGnBmoB,KAAO,WACNlnC,KAAKwe,GAAGY,WAAWpf,KAAKwe,GAAGiB,aAAczf,KAAKwqB,MAAM1L,SAGrDqoB,OAAS,WACRnnC,KAAKwe,GAAGY,WAAWpf,KAAKwe,GAAGiB,aAAc,QAyB3CgL,eAAehtB,WACdmtB,GAAIA,QAAS,MAAO5qB,MAAKwqB,OAEzBwc,QAAU,WACLhnC,KAAKwqB,MAAMzL,OACd/e,KAAKwe,GAAGyoB,aAAajnC,KAAKwqB,MAAM1L,QAEjC9e,KAAKwqB,MAAQ,MAGd1L,GAAIA,UACH,MAAO9e,MAAKwqB,MAAM1L,QAGnBuR,GAAIA,WACH,MAAOrwB,MAAKwqB,MAAMzL,OAGnBmoB,KAAO,WACNlnC,KAAKwe,GAAGY,WAAWpf,KAAKwe,GAAGmB,qBAAsB3f,KAAKwqB,MAAM1L,SAG7DqoB,OAAS,WACRnnC,KAAKwe,GAAGY,WAAWpf,KAAKwe,GAAGmB,qBAAsB,QAiBnD+K,oBAAoBjtB,WACnBslB,GAAIA,OAAM5kB,GACT6B,KAAK6qB,MAAMrM,GAAGyE,mBAAmBjjB,KAAK6qB,MAAML,MAAM1L,OAAQ3gB,EAAG6B,KAAKwqB,MAAM5J,MACxE5gB,KAAKwqB,MAAM1J,SAAW3iB,GAGvB4kB,GAAIA,SACH,MAAO/iB,MAAKwqB,MAAM1J,WAsEpBgK,kBAAkBrtB,WACjBoT,GAAIA,OAAM9K,GACT/F,KAAK+qB,MAAMhlB,IAGZ8K,GAAIA,SACH,MAAO7Q,MAAK6qB,MAAMrM,GAAG4oB,WAAWpnC,KAAK6qB,MAAML,MAAM1L,OAAQ9e,KAAKwqB,MAAM1J,YAkCtE2L,kBAAkBhvB,WACjB0lB,GAAIA,MAAKhlB,GACR6B,KAAK6qB,MAAMrM,GAAG6E,UAAUrjB,KAAKwqB,MAAM1J,SAAU3iB,GAC7C6B,KAAK0sB,MAAQvuB,GAGdglB,GAAIA,QAEH,MAAOnjB,MAAK0sB,QA4CdC,WAAWlvB,WAEVmtB,GAAIA,QAAe,MAAO5qB,MAAKwqB,OAC/BrJ,GAAIA,cAAe,MAAOnhB,MAAK4sB,aAC/BxL,GAAIA,YAAe,MAAOphB,MAAK6sB,WAC/BxL,GAAIA,YAAe,MAAOrhB,MAAK8sB,WAE/Bka,QAAU,WACT,GAAwB,MAApBhnC,KAAKwqB,MAAMzL,MAAf,CAEA,GAAIP,GAAKxe,KAAKwe,EAEdA,GAAG6oB,cAAcrnC,KAAKwqB,MAAM1L,OAC5B,KAAK,GAAInY,KAAK3G,MAAKwqB,MAAMtJ,QACxB1C,EAAG8oB,aAAatnC,KAAKwqB,MAAMtJ,QAAQva,GAAGmY,OAGvC9e,MAAK4sB,YAAc,KACnB5sB,KAAK6sB,UAAc,KACnB7sB,KAAK8sB,UAAc,KAEnB9sB,KAAKwqB,MAAQ,OAGd1L,GAAIA,UACH,MAAO9e,MAAKwqB,MAAM1L,QAGnBuR,GAAIA,WACH,MAAOrwB,MAAKwqB,MAAMzL,OAGnBvb,GAAIA,OACH,GAAIA,GAAM,EACVA,IAAO,yCACP,KAAK,GAAImD,KAAK3G,MAAKwqB,MAAMtJ,QACxB1d,GAAOxD,KAAKwqB,MAAMtJ,QAAQva,GAAGnD,GAK9B,OAHAA,IAAOxD,KAAKwqB,MAAMhnB,IAClBA,GAAO,0CACPA,GAAO,MAIR+jC,mBAAqB,WACpB7kB,6BAA6B1iB,KAAKwe,GAAIxe,KAAKwqB,QAG5Cgd,YAAc,WACblkB,sBAAsBtjB,KAAKwe,GAAIxe,KAAKwqB,QAGrC0c,KAAO,WACNlnC,KAAKwe,GAAG0E,WAAWljB,KAAKwqB,MAAM1L,SAG/BqoB,OAAS,aAITM,cAAgB,SAAS3W,GACxB,GAAIxS,GAAO,IACX,KAAK,GAAIzZ,KAAKisB,GACbxS,EAAOte,KAAK4sB,YAAY/nB,GACpByZ,IACHA,EAAKyE,MAAQ+N,EAAQjsB,GAGvB7E,MAAK0nC,QAGNrT,YAAc,SAASvD,GACtB,GAAI3O,GAAO,IACX,KAAK,GAAIhb,KAAK2pB,GACb3O,EAAOniB,KAAK6sB,UAAU1lB,GAClBgb,IACHA,EAAKtR,MAAQigB,EAAQ3pB,KAKxBmtB,YAAc,SAASxD,GACtB,GAAI1N,GAAM,IACV,KAAK,GAAIzc,KAAKmqB,GACb1N,EAAMpjB,KAAK8sB,UAAUnmB,GACVd,QAAPud,IACHA,EAAID,KAAO2N,EAAQnqB,MA0CvBomB,aAAatvB,WACZmtB,GAAIA,QAAS,MAAO5qB,MAAKwqB,OAEzBwc,QAAU,WACgB,MAArBhnC,KAAKwqB,MAAM1L,SACf9e,KAAKwe,GAAGmpB,cAAc3nC,KAAKwqB,MAAM1L,QACjC9e,KAAKwqB,MAAQ,OAGd1L,GAAIA,UACH,MAAO9e,MAAKwqB,MAAM1L,QAGnBuR,GAAIA,WACH,MAAOrwB,MAAKwqB,MAAMzL,OAGnBmoB,KAAO,SAAS/jB,GACfnjB,KAAKwe,GAAGopB,cAAc5nC,KAAKwe,GAAGqpB,SAAW1kB,GACzCnjB,KAAKwe,GAAG+G,YAAYvlB,KAAKwqB,MAAMlT,OAAQtX,KAAKwqB,MAAM1L,SAGnDqoB,OAAS,SAAShkB,GACjBnjB,KAAKwe,GAAGopB,cAAc5nC,KAAKwe,GAAGqpB,SAAW1kB,GACzCnjB,KAAKwe,GAAG+G,YAAYvlB,KAAKwqB,MAAMlT,OAAQ,OAGxC+M,eAAiB,WAChBrkB,KAAKwe,GAAG6F,eAAerkB,KAAKwqB,MAAMlT,UA0CpC0V,eAAevvB,WACdmtB,GAAIA,QAAS,MAAO5qB,MAAKwqB,OAEzBwc,QAAU,WACgB,MAArBhnC,KAAKwqB,MAAM1L,SACf9e,KAAKwe,GAAGmpB,cAAc3nC,KAAKwqB,MAAM1L,QACjC9e,KAAKwqB,MAAQ,OAGd1L,GAAIA,UACH,MAAO9e,MAAKwqB,MAAM1L,QAGnBuR,GAAIA,WACH,MAAOrwB,MAAKwqB,MAAMzL,OAGnBmoB,KAAO,SAAS/jB,GACfnjB,KAAKwe,GAAGopB,cAAc5nC,KAAKwe,GAAGqpB,SAAW1kB,GACzCnjB,KAAKwe,GAAG+G,YAAYvlB,KAAKwqB,MAAMlT,OAAQtX,KAAKwqB,MAAM1L,SAGnDqoB,OAAS,SAAShkB,GACjBnjB,KAAKwe,GAAGopB,cAAc5nC,KAAKwe,GAAGqpB,SAAW1kB,GACzCnjB,KAAKwe,GAAG+G,YAAYvlB,KAAKwqB,MAAMlT,OAAQ,OAGxC+M,eAAiB,WAChBrkB,KAAKwe,GAAG6F,eAAerkB,KAAKwqB,MAAMlT,UA6BpC2V,gBAAgBxvB,WACfmtB,GAAIA,QAAS,MAAO5qB,MAAKwqB,OAEzBwc,QAAU,WACgB,MAArBhnC,KAAKwqB,MAAM1L,SACf9e,KAAKwe,GAAGspB,mBAAmB9nC,KAAKwqB,MAAM1L,QACtC9e,KAAKwqB,MAAQ,OAGd1L,GAAIA,UACH,MAAO9e,MAAKwqB,MAAM1L,QAGnBuR,GAAIA,WACH,MAAOrwB,MAAKwqB,MAAMzL,OAGnBmoB,KAAO,WACNlnC,KAAKwe,GAAGsJ,iBAAiB9nB,KAAKwe,GAAGuJ,aAAc/nB,KAAKwqB,MAAM1L,SAG3DqoB,OAAS,WACRnnC,KAAKwe,GAAGsJ,iBAAiB9nB,KAAKwe,GAAGuJ,aAAc,QAuEjDmF,eAAezvB,WACdmtB,GAAIA,QAAkB,MAAO5qB,MAAKwqB,OAClC/B,GAAIA,gBAAkB,MAAOzoB,MAAKmtB,eAClCzE,GAAIA,eAAkB,MAAO1oB,MAAKotB,cAClCzE,GAAIA,iBAAkB,MAAO3oB,MAAKqtB,gBAElC2Z,QAAU,WACT,GAAyB,MAArBhnC,KAAKwqB,MAAM1L,OAAf,CACA9e,KAAKwe,GAAGupB,kBAAkB/nC,KAAKwqB,MAAM1L,OACrC,KAAK,GAAIpd,KAAK1B,MAAKmtB,cAAe,CACjC,GAAIxD,GAAK3pB,KAAKmtB,cAAczrB,EACxBioB,IACH3pB,KAAKmtB,cAAczrB,GAAGslC,UAGpBhnC,KAAKotB,cACRptB,KAAKotB,aAAa4Z,UAEfhnC,KAAKqtB,gBACRrtB,KAAKqtB,eAAe2Z,UAErBhnC,KAAKwqB,MAAU,KACfxqB,KAAKgoC,QAAU,OAGhBlpB,GAAIA,UACH,MAAO9e,MAAKwqB,MAAM1L,QAGnBuR,GAAIA,WACH,MAAOrwB,MAAKwqB,MAAMzL,OAGnB4F,GAAIA,SACH,MAAO3kB,MAAKwqB,MAAM7F,OAGnBC,GAAIA,UACH,MAAO5kB,MAAKwqB,MAAM5F,QAGnBsiB,KAAO,SAASe,GACf,GAAIC,IAAK,CACUriC,SAAfoiC,IAA0BC,EAAKD,GAE/BC,GACHloC,KAAKwe,GAAGjB,SAAS,EAAG,EAAGvd,KAAKwqB,MAAM7F,MAAO3kB,KAAKwqB,MAAM5F,QAGrD5kB,KAAKwe,GAAGwK,gBAAgBhpB,KAAKwe,GAAGyK,YAAajpB,KAAKwqB,MAAM1L,SAGzDqoB,OAAS,WACRnnC,KAAKwe,GAAGwK,gBAAgBhpB,KAAKwe,GAAGyK,YAAa,OAG9Ckf,UAAY,SAASplB,EAAOI,GAC3BnjB,KAAKmtB,cAAcpK,GAAOmkB,KAAK/jB,IAGhCilB,YAAc,SAASrlB,EAAOI,GAC7BnjB,KAAKmtB,cAAcpK,GAAOokB,OAAOhkB,IAGlCklB,UAAY,SAASllB,GACpBnjB,KAAKotB,aAAa8Z,KAAK/jB,IAGxBmlB,YAAc,SAASnlB,GACtBnjB,KAAKotB,aAAa+Z,OAAOhkB,IAG1BolB,YAAc,SAASplB,GACtBnjB,KAAKqtB,eAAe6Z,KAAK/jB,IAG1BqlB,cAAgB,SAASrlB,GACxBnjB,KAAKqtB,eAAe8Z,OAAOhkB,IAG5BkB,eAAiB,SAASokB,EAAQC,EAAOC,GACxC,GAAIjnC,GAAI,IAER,IAAI+mC,EACH,IAAK,GAAIt3B,KAAKnR,MAAKmtB,cAClBzrB,EAAI1B,KAAKmtB,cAAchc,GAClBzP,GACDA,EAAEkpB,KAAKtT,QAAUtX,KAAKwe,GAAGgH,aAC5B9jB,EAAEwlC,KAAK,GACPxlC,EAAE2iB,iBACF3iB,EAAEylC,OAAO,GAKRuB,KACHhnC,EAAI1B,KAAKotB,aACL1rB,GACCA,EAAEkpB,KAAKtT,QAAUtX,KAAKwe,GAAGgH,aAC5B9jB,EAAEwlC,KAAK,GACPxlC,EAAE2iB,iBACF3iB,EAAEylC,OAAO,KAKRwB,IACHjnC,EAAI1B,KAAKqtB,eACL3rB,GACCA,EAAEkpB,KAAKtT,QAAUtX,KAAKwe,GAAGgH,aAC5B9jB,EAAEwlC,KAAK,GACPxlC,EAAE2iB,iBACF3iB,EAAEylC,OAAO,MAMbyB,kBAAoB,SAAS7lB,EAAOrhB,GACnC,IAAKA,EAAG,OAAO,CACf,IAAa,EAARqhB,GAAeA,GAAS/iB,KAAKmtB,cAAc3tB,OAAS,OAAO,CAChE,IAAKkC,EAAEijB,OAAS3kB,KAAK2kB,OAAWjjB,EAAEkjB,QAAU5kB,KAAK4kB,OAAS,OAAO,CAEjE,IAAIpG,GAAKxe,KAAKwe,GAEViL,EAAMzpB,KAAKwe,GAAGkL,kBAAoB3G,CAUtC,OATIrhB,GAAE4V,QAAUkH,EAAGgH,WAClBhH,EAAG2K,qBAAqB3K,EAAGyK,YAAaQ,EAAKjL,EAAGgH,WAAY9jB,EAAEod,OAAQ,GAE9Dpd,EAAE4V,QAAUkH,EAAGuJ,cACvBvJ,EAAG6K,wBAAwB7K,EAAGyK,YAAaQ,EAAKjL,EAAGuJ,aAAcrmB,EAAEod,QAGpE9e,KAAKmtB,cAAcpK,GAASrhB,GAErB,GAGRmnC,kBAAoB,SAAS9lB,GAC5B,GAAa,EAARA,GAAeA,GAAS/iB,KAAKmtB,cAAc3tB,OAAS,OAAO,CAEhE,IAAIkC,GAAI1B,KAAKmtB,cAAcpK,EAC3B,KAAKrhB,EAAG,OAAO,CAEf,IAAI8c,GAAKxe,KAAKwe,EAWd,OATI9c,GAAE4V,QAAUkH,EAAGgH,WAClBhH,EAAG2K,qBAAqB3K,EAAGyK,YAAaQ,IAAKjL,EAAGgH,WAAY,KAAM,GAE1D9jB,EAAE4V,QAAUkH,EAAGuJ,cACvBvJ,EAAG6K,wBAAwB7K,EAAGyK,YAAaQ,IAAKjL,EAAGuJ,aAAc,MAGlE/nB,KAAKmtB,cAAcpK,GAAS,MAErB,IA8CTuK,qBAAqB7vB,WACpBmjB,GAAIA,QAAe,MAAO5gB,MAAKwtB,OAC/BjoB,GAAIA,QAAe,MAAOvF,MAAKytB,OAC/BsH,GAAIA,UAAe,MAAO/0B,MAAK0tB,OAC/BluB,GAAIA,UAAe,MAAOQ,MAAK0tB,MAAMluB,QAErCyB,IAAM,SAAS8hB,GACd,MAAO/iB,MAAK0tB,MAAMhtB,MAAMqiB,EAAQ/iB,KAAKytB,MAAOztB,KAAKytB,QAGlDoT,IAAM,SAAS9d,EAAOlS,GAErB,IAAK,GADD7K,GAAI+c,EAAQ/iB,KAAKytB,MACZ9tB,EAAE,EAAGA,EAAEK,KAAKytB,QAAS9tB,EAC7BK,KAAK0tB,MAAM1nB,KAAO6K,EAAMlR,EAEzB,OAAOiC,KAiBT+rB,kBAAkBlwB,WACjB0jB,GAAIA,cAAe,MAAOnhB,MAAK4tB,UAC/BpuB,GAAIA,UAAe,MAAOQ,MAAK6tB,SAE/Bib,aAAe,SAASloB,EAAMrb,EAAM0Z,EAAQsO,GAC3C,GAAIjP,GAAO,GAAIgP,sBAAqB1M,EAAMrb,EAAM0Z,EAAQsO,EACxDvtB,MAAK4tB,SAAShN,GAAQtC,EACtBte,KAAK6tB,QAAUvP,EAAK9e,QAGrBupC,gBAAkB,SAASnoB,GAC1B,GAAK5gB,KAAK4tB,SAAShN,GAAnB,OAEO5gB,MAAK4tB,SAAShN,GAErB5gB,KAAK6tB,QAAU,CACf,KAAK,GAAIhpB,KAAK7E,MAAK4tB,SAAU,CAC5B5tB,KAAK6tB,QAAU7tB,KAAK4tB,SAAS/oB,GAAGrF,MAChC,UAOH,IAAI2uB,4BAAsC,EACtCG,6BAAsC,EACtC8E,oCAAsC,EAEtCgC,gBAAqB,EACrBE,eAAqB,EACrBE,eAAqB,EACrBE,cAAqB,EACrBxF,mBAAqB,EACrB2F,mBAAqB,EACrBE,iBAAqB,CAgBzBjI,sBAAqBrwB,WACpBoiB,GAAIA,UACJe,GAAIA,QAAW,MAAO5gB,MAAKwtB,OAC3BO,GAAIA,QAAW,MAAO/tB,MAAKguB,OAC3BtoB,GAAIA,SAAW,MAAO1F,MAAKiuB,QAC3BzuB,GAAIA,UAAW,MAAOQ,MAAK6tB,UAgB5BvwB,WAAW4wB,0BAA2BJ,sBAwBtCxwB,WAAW8wB,4BAA6BN,sBAyBxCS,kBAAkB9wB,WACjB4zB,GAAIA,cAAe,MAAOrxB,MAAKwuB,QAE/B6H,mBAAqB,SAASzV,EAAMmN,EAAMroB,EAAOC,GAChD,GAAIwwB,GAAO,GAAIjI,2BAA0BtN,EAAMmN,EAAMroB,EAAOC,EAC5D3F,MAAKwuB,OAAO5N,GAAQuV,GAGrBlG,qBAAuB,SAASrP,EAAMmN,EAAMM,EAASd,GACpD,GAAI4I,GAAO,GAAI/H,6BAA4BxN,EAAMmN,EAAMM,EAASd,EAChEvtB,MAAKwuB,OAAO5N,GAAQuV,GAGrB6S,iBAAmB,SAASpoB,GACtB5gB,KAAKwuB,OAAO5N,UACV5gB,MAAKwuB,OAAO5N,KAkBrB6N,UAAUhxB,WACT4yB,GAAIA,WAAiB,MAAOrwB,MAAK0uB,QACjC2B,GAAIA,SAAQxf,GAAS7Q,KAAK0uB,OAAS7d,GAEnC2f,GAAIA,YAAiB,MAAOxwB,MAAK2uB,OACjC+B,GAAIA,gBAAiB,MAAO1wB,MAAK4uB,OAEjCoB,mBAAqB,SAASpP,EAAMrb,EAAM0Z,EAAQsO,GACjDvtB,KAAK2uB,MAAMma,aAAaloB,EAAMrb,EAAM0Z,EAAQsO,IAG7C0b,sBAAwB,SAASroB,GAChC5gB,KAAK2uB,MAAMoa,gBAAgBnoB,IAG5ByV,mBAAqB,SAASzV,EAAMmN,EAAMroB,EAAOC,GAChD3F,KAAK4uB,MAAMyH,mBAAmBzV,EAAMmN,EAAMroB,EAAOC,IAGlDsqB,qBAAuB,SAASrP,EAAMmN,EAAMM,EAASd,GACpDvtB,KAAK4uB,MAAMqB,qBAAqBrP,EAAMmN,EAAMM,EAASd,IAGtDyb,iBAAmB,SAASpoB,GAC3B5gB,KAAK4uB,MAAMoa,iBAAiBpoB,KA2L9B6N,UAAUhxB,UAAUyrC,SAAW,SAAS5Y,GAEvC,MADAtwB,MAAKqwB,QAAUxB,6BAA6B7uB,KAAMswB,GAC3CtwB,KAAKqwB,SAGb5B,UAAUhxB,UAAU0rC,UAAY,SAAS1qC,EAAK2xB,EAAQ1xB,GACrD,MAAOyxB,2BAA0BnwB,KAAMvB,EAAK2xB,EAAQ1xB,IA4ErD+vB,UAAUhxB,UAAU2rC,UAAY,SAAS9Y,GAExC,MADAtwB,MAAKqwB,QAAUM,8BAA8B3wB,KAAMswB,GAC5CtwB,KAAKqwB,SAGb5B,UAAUhxB,UAAU4rC,WAAa,SAAS5qC,EAAK2xB,EAAQ1xB,GACtD,MAAO4yB,4BAA2BtxB,KAAMvB,EAAK2xB,EAAQ1xB,IAgFtDyzB,qBAAqB10B,WACpBmjB,GAAIA,QAAiB,MAAO5gB,MAAKwtB,OACjCjoB,GAAIA,QAAiB,MAAOvF,MAAKytB,OACjC5N,GAAIA,QAAiB,MAAO7f,MAAKoyB,OACjCkX,GAAIA,gBAAiB,MAAOtpC,MAAKqyB,OACjCzsB,GAAIA,UAAiB,MAAO5F,MAAKsyB,SACjCxW,GAAIA,UAAiB,MAAO9b,MAAKic,SACjC8Y,GAAIA,UAAiB,MAAO/0B,MAAK0tB,OACjCluB,GAAIA,UAAiB,MAAOQ,MAAK6tB,SAEjCmZ,QAAU,WACThnC,KAAK0tB,MAAMsZ,WAGZE,KAAO,SAASnkB,EAAOwmB,GACtB,GAAIzD,IAAO,EAAe,EAAe,GAAO9lC,KAAKsyB,OACrDtyB,MAAK0tB,MAAMwZ,OACXlnC,KAAKwe,GAAGgrB,oBAAoBzmB,EAAO/iB,KAAKytB,MAAOztB,KAAKoyB,MAAOpyB,KAAKqyB,MAAOryB,KAAKsyB,QAAStyB,KAAKic,QAAU6pB,IAGrGqB,OAAS,SAASpkB,GACjB/iB,KAAK0tB,MAAMyZ,WAkBb5U,kBAAkB90B,WACjB0jB,GAAIA,cAAe,MAAOnhB,MAAK4tB,UAC/BpuB,GAAIA,UAAe,MAAOQ,MAAK6tB,SAE/BmZ,QAAU,WACT,IAAK,GAAI1oB,KAAQte,MAAK4tB,SACrB5tB,KAAK4tB,SAAStP,GAAM0oB,WAItB8B,aAAe,SAASloB,EAAMrb,EAAM2rB,EAAYjS,GAC/C,GAAIX,GAAO,GAAI6T,sBAAqBnyB,KAAKwe,GAAIoC,EAAMrb,EAAM2rB,EAAYjS,EACrEjf,MAAK4tB,SAAShN,GAAQtC,EACtBte,KAAK6tB,QAAUvP,EAAK9e,QAGrBupC,gBAAkB,SAASnoB,EAAM6oB,GAChC,GAAKzpC,KAAK4tB,SAAShN,GAAnB,CAEI6oB,GACHzpC,KAAK4tB,SAAShN,GAAMomB,gBAGdhnC,MAAK4tB,SAAShN,GAErB5gB,KAAK6tB,QAAU,CACf,KAAK,GAAIhpB,KAAK7E,MAAK4tB,SAAU,CAC5B5tB,KAAK6tB,QAAU7tB,KAAK4tB,SAAS/oB,GAAGrF,MAChC,UAIF0nC,KAAO,SAASpW,EAASyY,GACxB,GAAIvY,GAAK,IACT,KAAK,GAAIrhB,KAAKmhB,GACbE,EAAKhxB,KAAK4tB,SAASje,GACfqhB,GACHA,EAAGkW,KAAKpW,EAAQnhB,GAAI45B,IAKvBpC,OAAS,SAASrW,GACjB,GAAIE,GAAK,IACT,KAAK,GAAIrhB,KAAKmhB,GACbE,EAAKhxB,KAAK4tB,SAASje,GACfqhB,GACHA,EAAGmW,OAAOrW,EAAQnhB,MAsBtB6iB,qBAAqB/0B,WACpBisC,YAAc,SAAShkC,EAAOC,GAC7B,GAAIgkC,GAAM3pC,KAAKiuB,OAASjuB,KAAK6tB,QAEzBroB,EAAIxF,KAAKiuB,QAAWvoB,GAAS,EAAK,EAAU,EAChD,IAAIF,GAAKmkC,EAAK,MAAO,KAErB,IAAIx4B,GAAKxL,GAAS,EAAK,EAAW3F,KAAY,QAC1C4pC,EAAQpkC,EAAI2L,CAGhB,OAFIy4B,GAAOD,IAAKx4B,GAAKy4B,EAAOD,IAEpBnkC,EAAG2L,IAGZ04B,QAAU,SAASnkC,EAAOC,KAI1Bka,GAAIA,UACJe,GAAIA,QAAW,MAAO5gB,MAAKwtB,OAC3BO,GAAIA,QAAW,MAAO/tB,MAAKguB,OAC3BtoB,GAAIA,SAAW,MAAO1F,MAAKiuB,QAC3BzuB,GAAIA,UAAW,MAAOQ,MAAK6tB,SAE3BmZ,QAAU,WACLhnC,KAAK8pC,UACR9pC,KAAK8pC,YAIP5C,KAAO,aAIPC,OAAS,aAIT4C,OAAS,SAASrkC,EAAOC,GACxB,GAAIqkC,GAAQhqC,KAAK0pC,YAAYhkC,EAAOC,EACpC3F,MAAK6pC,QAAQG,EAAM,GAAIA,EAAM,MAiB/B1sC,WAAWm1B,0BAA2BD,sBAQtCC,0BAA0Bh1B,UAAUosC,QAAU,SAASnkC,EAAOC,GAC7D3F,KAAKwe,GAAGyrB,WAAWjqC,KAAKguB,MAAOtoB,EAAOC,IA2BvCrI,WAAWo1B,4BAA6BF,sBAcxCE,4BAA4Bj1B,UAAUqsC,SAAW,WAChD9pC,KAAK0tB,MAAMsZ,UACXhnC,KAAK0tB,MAAQ,MAGdgF,4BAA4Bj1B,UAAUypC,KAAO,WAC5ClnC,KAAK0tB,MAAMwZ,QAGZxU,4BAA4Bj1B,UAAU0pC,OAAS,WAC9CnnC,KAAK0tB,MAAMyZ,UAGZzU,4BAA4Bj1B,UAAUosC,QAAU,SAASnkC,EAAOC,GAC/D3F,KAAKwe,GAAG0rB,aAAalqC,KAAKguB,MAAOroB,EAAO3F,KAAK2yB,SAAUjtB,EAAQ1F,KAAKsyB,UAoDrEh1B,WAAWs1B,kCAAmCJ,sBAG9CI,kCAAkCn1B,UAAUqsC,SAAW,WACtD9pC,KAAK0tB,MAAMsZ,UACXhnC,KAAK0tB,MAAQ,MAGdkF,kCAAkCn1B,UAAUypC,KAAO,WAClDlnC,KAAK0tB,MAAMwZ,QAGZtU,kCAAkCn1B,UAAU0pC,OAAS,WACpDnnC,KAAK0tB,MAAMyZ,UAGZvU,kCAAkCn1B,UAAU0sC,iBAAmB,SAASC,EAAO1kC,EAAOC,GACrF,GAAIgkC,GAAM3pC,KAAKgzB,sBAAsBoX,GAASpqC,KAAKizB,mBAAmBmX,GAElE5kC,EAAIxF,KAAKgzB,sBAAsBoX,IAAW1kC,GAAS,EAAK,EAAU,EACtE,IAAIF,GAAKmkC,EAAK,MAAO,KAErB,IAAIx4B,GAAKxL,GAAS,EAAK,EAAW3F,KAAKizB,mBAAmBmX,GACtDR,EAAQpkC,EAAI2L,CAGhB,OAFIy4B,GAAOD,IAAKx4B,GAAKy4B,EAAOD,IAEpBnkC,EAAG2L,IAGZyhB,kCAAkCn1B,UAAU4sC,YAAc,SAAS3kC,EAAOC,GAKzE,IAJA,GAAIqkC,GAAQhqC,KAAK0pC,YAAYhkC,EAAOC,GAChCxH,EAAQ6B,KAAKgzB,sBAAsBxzB,OAEnC8qC,EAAa,EACInsC,EAAbmsC,GAAoBN,EAAM,GAAKhqC,KAAKgzB,sBAAsBsX,IACjEA,GAED,IAAIA,GAAcnsC,EAAG,MAAO,KAI5B,KAFA,GAAI2H,GAAOkkC,EAAM,GAAKA,EAAM,GAAK,EAC7BO,EAAYD,EACInsC,EAAZosC,GAAmBzkC,GAAS9F,KAAKgzB,sBAAsBuX,GAAavqC,KAAKizB,mBAAmBsX,IACnGA,GAEGA,IAAapsC,IAAGosC,EAAYpsC,EAAI,EAEpC,IAAIqsC,MACAhlC,EAAIwkC,EAAM,GAAKhqC,KAAKgzB,sBAAsBsX,GAC1Cn5B,EAAI64B,EAAM,GACV7N,EAAI32B,EAAIwkC,EAAM,EACd7N,GAAIn8B,KAAKizB,mBAAmBqX,KAAan5B,EAAInR,KAAKizB,mBAAmBqX,GAActqC,KAAKgzB,sBAAsBsX,IAClHE,EAAO3qC,MAAMyqC,EAAY9kC,EAAG2L,EAAGnR,KAAK+yB,uBAAuBuX,IAC3D,KAAK,GAAI3qC,GAAE2qC,EAAW,EAAKC,EAAF5qC,IAAeA,EACvC6qC,EAAO3qC,MAAMF,EAAG,EAAGK,KAAKizB,mBAAmBtzB,GAAIK,KAAK+yB,uBAAuBpzB,IAM5E,OAJI4qC,GAAYD,GACfE,EAAO3qC,MAAMF,EAAG,EAAGqqC,EAAM,GAAKA,EAAM,GAAKhqC,KAAKgzB,sBAAsBuX,GAAYvqC,KAAK+yB,uBAAuBwX,KAGtGC,GAGR5X,kCAAkCn1B,UAAUgtC,YAAc,SAASL,EAAO1kC,EAAOC,GAChF,GAAIqkC,GAAQhqC,KAAKmqC,iBAAiBC,EAAO1kC,EAAOC,EAChD3F,MAAKwe,GAAG0rB,aAAalqC,KAAKguB,MAAOgc,EAAM,GAAIhqC,KAAK2yB,SAAUqX,EAAM,GAAKhqC,KAAKsyB,UAgB3Ee,kBAAkB51B,WACjB4zB,GAAIA,cAAe,MAAOrxB,MAAKwuB,QAE/BwY,QAAU,WACT,IAAK,GAAI7Q,KAAQn2B,MAAKwuB,OACrBxuB,KAAKwuB,OAAO2H,GAAM6Q,WAIpB3Q,mBAAoB,SAASzV,EAAMmN,EAAMroB,EAAOC,GAC/C,GAAIwwB,GAAO,GAAI1D,2BAA0BzyB,KAAKwe,GAAIoC,EAAMmN,EAAMroB,EAAOC,EACrE3F,MAAKwuB,OAAO5N,GAAQuV,GAGrBlG,qBAAuB,SAASrP,EAAMmN,EAAMM,GAC3C,GAAI8H,GAAO,GAAIzD,6BAA4B1yB,KAAKwe,GAAIoC,EAAMmN,EAAMM,EAChEruB,MAAKwuB,OAAO5N,GAAQuV,GAGrBgC,2BAA6B,SAASvX,EAAMmN,EAAMM,EAASwE,EAAsBC,GAChF,GAAIqD,GAAO,GAAIvD,mCAAkC5yB,KAAKwe,GAAIoC,EAAMmN,EAAMM,EAASwE,EAAsBC,EACrG9yB,MAAKwuB,OAAO5N,GAAQuV,GAGrB6S,iBAAmB,SAASpoB,EAAM6oB,GAC5BzpC,KAAKwuB,OAAO5N,KAEb6oB,GACHzpC,KAAKwuB,OAAO5N,GAAMomB,gBAGZhnC,MAAKwuB,OAAO5N,MAkBrB0S,UAAU71B,WACT+yB,GAAIA,YAAiB,MAAOxwB,MAAK2uB,OACjC+B,GAAIA,gBAAiB,MAAO1wB,MAAK4uB,OAEjCoY,QAAU,WACThnC,KAAK2uB,MAAMqY,UACXhnC,KAAK4uB,MAAMoY,WAGZhX,mBAAqB,SAASpP,EAAMrb,EAAM0Z,EAAQiS,GACjDlxB,KAAK2uB,MAAMma,aAAaloB,EAAMrb,EAAM0Z,EAAQiS,IAG7C+X,sBAAwB,SAASroB,EAAM6oB,GACtCzpC,KAAK2uB,MAAMoa,gBAAgBnoB,EAAM6oB,IAGlCpT,mBAAqB,SAASzV,EAAMmN,EAAMroB,EAAOC,GAChD3F,KAAK4uB,MAAMyH,mBAAmBzV,EAAMmN,EAAMroB,EAAOC,IAGlDsqB,qBAAuB,SAASrP,EAAMmN,EAAMM,GAC3CruB,KAAK4uB,MAAMqB,qBAAqBrP,EAAMmN,EAAMM,IAG7C8J,2BAA6B,SAASvX,EAAMmN,EAAMM,EAASwE,EAAsBC,GAChF9yB,KAAK4uB,MAAMuJ,2BAA2BvX,EAAMmN,EAAMM,EAASwE,EAAsBC,IAGlFkW,iBAAmB,SAASpoB,EAAM6oB,GACjCzpC,KAAK4uB,MAAMoa,iBAAiBpoB,EAAM6oB,IAQpC,IAAIiB,gCAAiC,IAuBrCnX,mBAAkB91B,WACjBktC,mBAAqB,SAASpB,GAC7BvpC,KAAK2zB,MAAMnD,SAAS0W,KAAKlnC,KAAK0zB,aAAc6V,IAG7CqB,qBAAuB,WACtB5qC,KAAK2zB,MAAMnD,SAAS2W,OAAOnnC,KAAK0zB,eAGjC/I,GAAIA,WAAY,MAAO3qB,MAAK6qC,MAE5B9W,mBAAqB,WACpB/zB,KAAK6qB,MAAM2c,aAEX,IAAIsD,IAAS,EACT/nB,EAAQ,EACRzE,EAAO,IACX,KAAK,GAAIzZ,KAAK7E,MAAK6qB,MAAM1J,WACxB7C,EAAOte,KAAK6qB,MAAM1J,WAAWtc,GACzByZ,EAAKyE,OAASA,IACjBzE,EAAKyE,MAAQA,EACb+nB,GAAS,GAEV/nB,GAEG+nB,IACH9qC,KAAK6qB,MAAM6c,MAGZ,IAAIvkB,GAAO,EACPC,EAAM,IACV,KAAK,GAAIzc,KAAK3G,MAAK6qB,MAAMxJ,SACxB+B,EAAMpjB,KAAK6qB,MAAMxJ,SAAS1a,GAC1Byc,EAAID,KAAOA,EACXA,KAIF4nB,2BAA6B,SAASC,GACrC,GAAI7sC,GAAI6sC,EAAOxrC,OACXsxB,EAAU,GAAI/vB,QACdgf,EAAM,IACV,KAAK,GAAIzB,KAAQte,MAAK6qB,MAAM1J,WACvB7C,EAAK2sB,OAAO,EAAG9sC,IAAM6sC,IACxBjrB,EAAMzB,EAAK2sB,OAAO9sC,GACd4hB,EAAIvgB,OAAS,IAChBsxB,EAAQxS,GAAQyB,GAInB,OAAO+Q,IAGRkD,iBAAmB,SAASlD,GAG3B9wB,KAAK8zB,kBAAmB,CAExB,IAAIoX,GAAe,IAEnBlrC,MAAKyzB,SAAWzzB,KAAK+qC,2BAA2BL,+BAChD,KAAK,GAAIS,KAAgBra,GACxBoa,EAAepa,EAAQsa,GACnBprC,KAAK6qB,MAAM1J,WAAWgqB,KACzBnrC,KAAKyzB,SAAS0X,GAAgBD,EAIhClrC,MAAK0zB,eACL,IAAI0X,GAAW,IACf,KAAK,GAAID,KAAgBnrC,MAAKyzB,SAC7ByX,EAAelrC,KAAKyzB,SAAS0X,GAC7BC,EAAeprC,KAAK6qB,MAAM1J,WAAWgqB,GACrCnrC,KAAK0zB,aAAawX,GAAgBE,EAASroB,KAGxC/iB,MAAK2zB,OACR3zB,KAAK2qC,mBAAmB,IAI1BU,2BAA6B,SAASL,GAChCA,IAAQA,EAASN,+BACtB,IAAI5Z,GAAU9wB,KAAK+qC,2BAA2BC,EAC9ChrC,MAAKg0B,iBAAiBlD,IAGvBuD,YAAc,SAASvD,GACH,GAAf9wB,KAAK6zB,QACT7zB,KAAK6qB,MAAMwJ,YAAYvD,IAGxBwD,YAAc,SAASxD,GACtB,GAAmB,GAAf9wB,KAAK6zB,OAAT,CAEA,GAAIxS,MACAiqB,KAEA5pC,EAAI,IACR,KAAK,GAAIiF,KAAKmqB,GACbpvB,EAAIovB,EAAQnqB,GACK,gBAAP,GACT0a,EAAS1a,GAAKjF,EAGd4pC,EAAS3kC,GAAKjF,CAIhB1B,MAAK6qB,MAAMyJ,YAAYjT,EAEvB,IAAI+B,GAAM,IACV,KAAK,GAAIzc,KAAK2kC,GACbloB,EAAMpjB,KAAK6qB,MAAMxJ,SAAS1a,GACtByc,GACHkoB,EAAS3kC,GAAGugC,KAAK9jB,EAAID,QAKxBiR,MAAQ,WACY,GAAfp0B,KAAK6zB,SAOT7zB,KAAK6qB,MAAMqc,OACXlnC,KAAK6zB,OAAS,IAGf8V,IAAM,WACL,GAAmB,GAAf3pC,KAAK6zB,OAAT,CACA7zB,KAAK6qB,MAAMsc,QACX,IAAI3oB,GAAKxe,KAAK6qB,MAAMrM,EACpB,KAAK,GAAI3Z,KAAK7E,MAAK6qB,MAAM1J,WACxB3C,EAAG+sB,yBAAyBvrC,KAAK6qB,MAAM1J,WAAWtc,GAAGke,MAEtD/iB,MAAK6zB,OAAS,IAGf2X,UAAY,SAAS1c,GACD,GAAf9uB,KAAK6zB,SACT7zB,KAAK8zB,kBAAmB,EACxB9zB,KAAK2zB,MAAQ7E,EACb9uB,KAAK2qC,mBAAmB,GACxB3qC,KAAK6zB,OAAS,IAGf4X,QAAU,WACU,GAAfzrC,KAAK6zB,SACT7zB,KAAK4qC,uBACL5qC,KAAK6qB,MAAMrM,GAAGY,WAAWpf,KAAK6qB,MAAMrM,GAAGiB,aAAc,MACrDzf,KAAK2zB,MAAQ,KACb3zB,KAAK6zB,OAAS,IAGf6X,gBAAkB,SAAS9qB,GACP,GAAf5gB,KAAK6zB,SACT7zB,KAAK4zB,YAAc5zB,KAAK2zB,MAAMjD,aAAaW,WAAWzQ,GACtD5gB,KAAK4zB,YAAYsT,OACjBlnC,KAAK6zB,OAAS,IAGf8X,cAAgB,WACI,GAAf3rC,KAAK6zB,SACT7zB,KAAK4zB,YAAYuT,SACjBnnC,KAAK4zB,YAAc,KACnB5zB,KAAK6zB,OAAS,IAGfkW,OAAS,SAASrkC,EAAOC,GACxB,GAAmB,GAAf3F,KAAK6zB,OAAT,CAEA,GAAIrV,GAAKxe,KAAK6qB,MAAMrM,GAChBotB,EAAS,CAEb,IAAI5rC,KAAK8zB,iBAAkB,CAC1B9zB,KAAK8zB,kBAAmB,CACxB,KAAK,GAAIsX,KAAYprC,MAAKyzB,SACzBmY,EAAS5rC,KAAK6qB,MAAM1J,WAAWiqB,GAAUroB,MACrC/iB,KAAK2zB,MAAMnD,SAASrP,WAAWnhB,KAAKyzB,SAAS2X,IAChD5sB,EAAGqtB,wBAAwBD,GAG3BptB,EAAG+sB,yBAAyBK,GAK/B,GAAI5rC,KAAK4zB,YAAYkY,UACpB,GAAI9rC,KAAK4zB,YAAYmY,YAAc,EAGlC,IAAK,GAFDC,GAAShsC,KAAK4zB,YAAYyW,YAAY3kC,EAAOC,GAC7CxH,EAAI6tC,EAAOxsC,OACNG,EAAE,EAAKxB,EAAFwB,IAAOA,EACpBK,KAAK2qC,mBAAmBqB,EAAOrsC,GAAG,IAClCK,KAAK4zB,YAAY6W,YAAYuB,EAAOrsC,GAAG,GAAIqsC,EAAOrsC,GAAG,GAAIqsC,EAAOrsC,GAAG,QAKrEK,MAAK4zB,YAAYmW,OAAOrkC,EAAOC,KAIjC4uB,qBAAuB,SAASzF,EAAMlO,EAAMlb,EAAOC,GAClD3F,KAAKwrC,UAAU1c,GACd9uB,KAAK0rC,gBAAgB9qB,GACpB5gB,KAAK+pC,OAAOrkC,EAAOC,GACpB3F,KAAK2rC,gBACN3rC,KAAKyrC,YAqFPhd,UAAUhxB,UAAUwuC,qBAAuB,SAASvX,GACnD,MAAOF,wBAAuBx0B,KAAM00B,IA6CrCjG,UAAUhxB,UAAUyuC,SAAW,SAAS1tB,GACvC,MAAOyX,eAAczX,EAAIxe,OA2I1ByuB,UAAUhxB,UAAU0uC,eAAiB,SAAS3tB,EAAI6S,EAAYkF,GAC7D,MAAOD,mBAAkB9X,EAAIxe,KAAMqxB,EAAYkF,GAmChD,IAAIiC,yBAA0B,EAC1B4T,qBAA0B,EAC1BC,kBAA0B,EAC1BC,oBAA0B,EAC1BC,oBAA0B,CAc9BnU,cAAa36B,WACZ+uC,iBAAmB,SAAS7pC,EAAGU,GAC9B,GAAIzB,GAAI,EAEJ2H,EAAI,EACJsG,EAAI3M,QAAQP,EAAEA,EAAIU,EAAEA,EAUxB,OATa,kBAAJzB,EAALiO,EAEHtG,EAAIrG,QAAQtB,EAAEA,EAAIiO,EAAEA,IAIpBnO,EAAIE,EAAI,mBACR2H,EAAI7H,EAAEA,EAAImO,GAEJtG,GAGRkjC,WAAa,SAAS98B,EAAGhN,EAAGU,EAAGkG,GAC9B,MAAO6K,YAAWzE,EAAGhG,OAAOhH,EAAGU,EAAGkG,EAAG,KAGtCmjC,mBAAqB,SAAS/8B,EAAGhN,EAAGU,GACnC,GAAIkG,GAAIvJ,KAAKwsC,iBAAiB7pC,EAAGU,EACjC,OAAOrD,MAAKysC,WAAW98B,EAAGhN,EAAGU,EAAGkG,IAGjCojC,WAAa,SAAS7wB,EAAQtW,GAC7B,GAAIonC,GAASj3B,aAAa3V,KAAKq4B,SAC3B32B,EAAI+K,UAAUqP,EAAQ,EAC1Bpa,GAAI0S,WAAWw4B,EAAQlrC,GACvBA,EAAIgM,UAAUlI,EAAG9D,EACjB,IAAImrC,GAAQh3B,kBAAkBnU,EAC9B1B,MAAKq4B,QAAUrmB,SAAShS,KAAKq4B,QAASwU,IAGvCC,GAAIA,UAAY,MAAO9sC,MAAKu4B,SAC5BuU,GAAIA,QAAOjoC,GAAK7E,KAAKu4B,QAAU1zB,GAE/B89B,GAAIA,UAAW,MAAO3iC,MAAKq4B,SAE3BI,MAAQ,WACPz4B,KAAKq4B,QAAU/nB,gBACftQ,KAAKs4B,OAAa,EAAK,IAAO,EAAK,IACnCt4B,KAAKu4B,QAAUC,yBAGhBuU,MAAQ,SAASp9B,EAAGhN,EAAGU,EAAGkG,GAMzB,OALAvJ,KAAKs4B,KAAK,GAAG,GAAKt4B,KAAKs4B,KAAK,GAAG,GAC/Bt4B,KAAKs4B,KAAK,GAAG,GAAKt4B,KAAKs4B,KAAK,GAAG,GAC/Bt4B,KAAKs4B,KAAK,GAAG,GAAK31B,EAClB3C,KAAKs4B,KAAK,GAAG,GAAKj1B,EAEVrD,KAAKu4B,SACZ,IAAK6T,sBACJpsC,KAAKojC,OAAOzzB,EACb,MAEA,KAAK08B,mBACJrsC,KAAKgtC,IAAIr9B,EACV,MAEA,KAAK28B,qBACJtsC,KAAKitC,MAAMt9B,EAAGpG,EACf,MAEA,KAAKgjC,qBACJvsC,KAAKqjC,MAAM1zB,EAAGpG,KAQjB65B,OAAS,SAASzzB,GACjB,GAAK3P,KAAKs4B,KAAK,GAAG,IAAMt4B,KAAKs4B,KAAK,GAAG,IAAQt4B,KAAKs4B,KAAK,GAAG,IAAMt4B,KAAKs4B,KAAK,GAAG,GAA7E,CAEA,GAAI4U,GAAOv3B,aAAahG,GAEpBw9B,EAAKntC,KAAK0sC,mBAAmBQ,EAAMltC,KAAKs4B,KAAK,GAAG,GAAIt4B,KAAKs4B,KAAK,GAAG,IACjE8U,EAAKptC,KAAK0sC,mBAAmBQ,EAAMltC,KAAKs4B,KAAK,GAAG,GAAIt4B,KAAKs4B,KAAK,GAAG,IAEjEpiB,EAAShL,WAAWiiC,EAAIC,GACxBC,EAASjiC,YAAY8K,GACrBo3B,EAASt3B,wBAAwBq3B,EAAOn3B,EAE5ClW,MAAKq4B,QAAUrmB,SAASs7B,EAAQttC,KAAKq4B,WAGtC2U,IAAM,SAASr9B,GACd,GAAIu9B,GAAOv3B,aAAahG,GACpBw9B,EAAKntC,KAAKysC,WAAWS,EAAMltC,KAAKs4B,KAAK,GAAG,GAAIt4B,KAAKs4B,KAAK,GAAG,GAAI,IAC7D8U,EAAKptC,KAAKysC,WAAWS,EAAMltC,KAAKs4B,KAAK,GAAG,GAAIt4B,KAAKs4B,KAAK,GAAG,GAAI,IAC7Dxc,EAASvR,SAAS6iC,EAAID,EAC1BntC,MAAK2sC,WAAW7wB,EAAQ,IAGzBmxB,MAAQ,SAASt9B,EAAG49B,GACnB,GAAIL,GAAOv3B,aAAahG,GACpBmM,EAAS9b,KAAKysC,WAAWS,EAAM,EAAK,EAAKK,EAC7CvtC,MAAK2sC,WAAW7wB,EAAQ,IAGzBunB,MAAQ,SAAS1zB,EAAGhJ,GACnB,GAAI6mC,GAAWt2B,cAAcvQ,EAAGA,EAAGA,EACnC3G,MAAKq4B,QAAUrmB,SAAShS,KAAKq4B,QAASmV,KAqBxC9U,qBAAqBj7B,WAMpBkjC,MAAQ,WACP,GAAI/+B,GAAI,GAAI82B,qBAGZ,OAFA92B,GAAE+2B,UAAY34B,KAAK24B,UAAUj4B,QAC7BkB,EAAEg3B,QAAY54B,KAAK44B,QAAQl4B,QACpBkB,GAWRg/B,GAAIA,QACH,MAAO5gC,MAAK2gC,SAcb9H,OAAS,SAASphB,EAAWC,EAAWC,EAAWC,EAASC,EAASC,EAAS21B,GAC7EztC,KAAK24B,UAAYnvB,OAAOiO,EAAWC,EAAWC,EAE9C,IAAI+1B,GAAUnjC,UAAWqN,EAASC,EAASC,GAAW9X,KAAK24B,UAM3D,OAJA34B,MAAK44B,QAAQ,GAAKr0B,SAAUmpC,EAAQ,IAAKA,EAAQ,IACjD1tC,KAAK44B,QAAQ,GAAKr0B,UAAUmpC,EAAQ,IAAKA,EAAQ,IACjD1tC,KAAK44B,QAAQ,GAAK,EAAS,EAAS,EAE7B54B,MAURmjC,UAAY,SAASwK,EAASC,EAASC,GACtC,GAAIC,GAAYh3B,wBAAwB9W,KAAK44B,QAAQ,GAAI,EAAK,EAAK,GAC/DmV,EAAYj3B,wBAAwB9W,KAAK44B,QAAQ,GAAI,EAAK,EAAK,GAC/DoV,EAAYl3B,wBAAwB9W,KAAK44B,QAAQ,GAAI,EAAK,EAAK,GAC/D0U,EAAYt7B,SAASg8B,EAASh8B,SAAS+7B,EAAQD,IAC/CG,EAAY75B,WAAWk5B,GAAUK,EAASC,EAASC,EAAS,GAMhE,OAJA7tC,MAAK24B,UAAU,IAAMsV,EAAU,GAC/BjuC,KAAK24B,UAAU,IAAMsV,EAAU,GAC/BjuC,KAAK24B,UAAU,IAAMsV,EAAU,GAExBjuC,MAURkuC,iBAAmB,SAASP,EAASC,EAASC,GAC7C,GAAIP,GAAYx2B,wBAAwB9W,KAAK44B,QAAQ,GAAI,EAAK,EAAK,GAC/DqV,EAAY75B,WAAWk5B,GAAUK,EAASC,EAASC,EAAS,GAMhE,OAJA7tC,MAAK24B,UAAU,IAAMsV,EAAU,GAC/BjuC,KAAK24B,UAAU,IAAMsV,EAAU,GAC/BjuC,KAAK24B,UAAU,IAAMsV,EAAU,GAExBjuC,MAURojC,OAAS,SAAS+K,EAAaC,EAAWC,GAKzC,MAJAruC,MAAK44B,QAAQ,IAAMuV,EACnBnuC,KAAK44B,QAAQ,IAAMwV,EACnBpuC,KAAK44B,QAAQ,IAAMyV,EAEZruC,MAUR2iC,GAAIA,UACH,GAAImL,GAAYh3B,yBAAyB9W,KAAK44B,QAAQ,GAAI,EAAK,EAAK,GAChEmV,EAAYj3B,yBAAyB9W,KAAK44B,QAAQ,GAAI,EAAK,EAAK,GAChEoV,EAAYl3B,yBAAyB9W,KAAK44B,QAAQ,GAAI,EAAK,EAAK,GAChE0V,EAAYz4B,kBAAkB1L,SAASnK,KAAK24B,YAC5C4V,EAAYv8B,SAASg8B,EAASh8B,SAAS87B,EAAU97B,SAAS+7B,EAAQO,IAEtE,OAAOC,KA2GTnV,YAAY37B,WACXu7B,GAAIA,UACH,MAAOh5B,MAAKy5B,SAGb9U,GAAIA,SACH,MAAO3kB,MAAKy5B,QAAQ9U,OAGrBC,GAAIA,UACH,MAAO5kB,MAAKy5B,QAAQ7U,QAGrB4pB,GAAIA,mBACH,MAAOxuC,MAAK45B,kBAGb4U,GAAIA,iBAAgBzoC;AACnB/F,KAAK45B,iBAAmB7zB,GAGzBu1B,GAAIA,cACH,MAAIt7B,MAAK25B,UAAY,EAAY,EAC1B35B,KAAK25B,UAGb2B,GAAIA,YAAW15B,GACd,GAAI6sC,GAAO7sC,CAGX,IAFW,EAAP6sC,IAAYA,EAAO,GACnBA,EAAO,MAAQA,EAAO,KACtBzuC,KAAK25B,UAAY8U,IAErBzuC,KAAK25B,SAAW8U,EAEK,MAAjBzuC,KAAK05B,WAERgV,cAAc1uC,KAAK05B,UACnB15B,KAAK05B,SAAW,MAGb15B,KAAK25B,SAAW,GACpB,CACC,GAAIgV,GAAM,IAAS3uC,KAAK25B,QACf,GAALgV,IAAUA,EAAK,EACnB,IAAI9S,GAAM77B,KAAKu5B,QAEfv5B,MAAKg7B,QAAYC,KAAKC,MAAQ,IAC9Bl7B,KAAKm7B,SAAYn7B,KAAKg7B,QACtBh7B,KAAKo7B,UAAY,EAEjBp7B,KAAK05B,SAAWkV,YAAY,WAAa/S,EAAIgT,UAAaF,KAI5DG,GAAIA,eACH,GAAIptC,GAAI1B,IACR,OAAO,YAAc0B,EAAE63B,SAASuV,iBA6ElCzT,kBAAkB59B,WACjBsxC,mBAAqB,SAAS5S,GAC7B,GAAI6S,GAAMhvC,KAAKg5B,OAAOiW,uBACtB,QACCtsC,EAAKw5B,EAAE+S,QAAUF,EAAIx2B,KACrBnV,EAAK84B,EAAEgT,QAAUH,EAAIr2B,MAIvBm2B,YAAc,WACT9uC,KAAK+7B,YAEH/7B,KAAK87B,eACT97B,KAAK87B,cAAe,EACpBsT,WAAWpvC,KAAKg8B,UAAW,MAK9BgB,KAAO,SAASb,GACf,GAAIkT,IAAS,CACb,KAAK,GAAIC,KAAUtvC,MAAK47B,GAAGhB,iBACtB56B,KAAK47B,GAAGhB,iBAAiB0U,KAC5BtvC,KAAK47B,GAAGhB,iBAAiB0U,IAAU,EAC/BtvC,KAAKs5B,QAAQoD,SACqE,GAAjF18B,KAAKs5B,QAAQoD,QAAQ18B,KAAKwe,GAAI8wB,EAAQtvC,KAAK47B,GAAGf,SAASl4B,EAAG3C,KAAK47B,GAAGf,SAASx3B,KAC9EgsC,GAAS,GAMb,KAAK,GAAIE,KAAOvvC,MAAK47B,GAAGjB,SACnB36B,KAAK47B,GAAGjB,SAAS4U,KACpBvvC,KAAK47B,GAAGjB,SAAS4U,IAAO,EACpBvvC,KAAKs5B,QAAQiD,OAE2B,GAAvCv8B,KAAKs5B,QAAQiD,MAAMv8B,KAAKwe,GAAI,EAAG+wB,KAClCF,GAAS,GAMTA,IACHrvC,KAAK8uC,eAIP7R,SAAU,SAASd,GAClB,GAAIkT,IAAS,CACb,KAAK,GAAIC,KAAUtvC,MAAK47B,GAAGhB,iBACtB56B,KAAK47B,GAAGhB,iBAAiB0U,KAC5BtvC,KAAK47B,GAAGhB,iBAAiB0U,IAAU,EAC/BtvC,KAAKs5B,QAAQ2D,UAC8D,GAA1Ej9B,KAAKs5B,QAAQ2D,SAASj9B,KAAKwe,GAAIxe,KAAK47B,GAAGf,SAASl4B,EAAG3C,KAAK47B,GAAGf,SAASx3B,KACvEgsC,GAAS,GAMTA,IACHrvC,KAAK8uC,eAIP5R,UAAW,SAASf,KAIpBC,KAAO,WACNp8B,KAAK47B,GAAG/B,UAAY,KAChB75B,KAAKs5B,QAAQ8C,MACkB,GAA9Bp8B,KAAKs5B,QAAQ8C,KAAKp8B,KAAKwe,IAI5Bxe,KAAK8uC,eAGNzS,OAAS,WAERr8B,KAAK47B,GAAG9B,YAAc,KACtB95B,KAAK47B,GAAGN,WAAa,EACjBt7B,KAAKs5B,QAAQ+C,QAChBr8B,KAAKs5B,QAAQ+C,OAAOr8B,KAAKwe,IAE1Bxe,KAAKs5B,QAAQsC,GAAK,KAClB57B,KAAKs5B,QAAa,KAClBt5B,KAAK47B,GAAa,MAGnBU,QAAU,SAASH,GAClBn8B,KAAK47B,GAAG7B,aAAeoC,CACvB,IAAIqT,GAAYC,OAAOC,aAAavT,EAAEwT,QACtC3vC,MAAK47B,GAAGjB,SAAS6U,EAAUI,gBAAiB,EAC5C5vC,KAAK47B,GAAGjB,SAAS6U,EAAUK,gBAAiB,EACvC7vC,KAAK47B,GAAGjB,SAASwB,EAAEwT,UAAa3vC,KAAK47B,GAAG4S,kBAC5CxuC,KAAK47B,GAAGjB,SAASwB,EAAEwT,UAAW,EAC1B3vC,KAAKs5B,QAAQgD,SAC2C,GAAvDt8B,KAAKs5B,QAAQgD,QAAQt8B,KAAKwe,GAAI2d,EAAEwT,QAASH,IAC5CxvC,KAAK8uC,gBAWTvS,MAAQ,SAASJ,GAChBn8B,KAAK47B,GAAG5B,WAAamC,CACrB,IAAIqT,GAAYC,OAAOC,aAAavT,EAAEwT,QACtC3vC,MAAK47B,GAAGjB,SAAS6U,EAAUI,gBAAiB,EAC5C5vC,KAAK47B,GAAGjB,SAAS6U,EAAUK,gBAAiB,EAC5C7vC,KAAK47B,GAAGjB,SAASwB,EAAEwT,UAAW,EAC1B3vC,KAAKs5B,QAAQiD,OACyC,GAArDv8B,KAAKs5B,QAAQiD,MAAMv8B,KAAKwe,GAAI2d,EAAEwT,QAASH,IAC1CxvC,KAAK8uC,eAURtS,SAAW,SAASL,GACnBn8B,KAAK47B,GAAG3B,cAAgBkC,CACxB,IAAIqT,GAAYC,OAAOC,aAAavT,EAAE2T,SAClC9vC,MAAKs5B,QAAQkD,UAC6C,GAAzDx8B,KAAKs5B,QAAQkD,SAASx8B,KAAKwe,GAAI2d,EAAE2T,SAAUN,IAC9CxvC,KAAK8uC,cAGH3S,EAAE4T,gBACL5T,EAAE4T,kBAIJtT,UAAY,SAASN,GACpBn8B,KAAK47B,GAAG1B,eAAiBiC,CACzB,IAAI7lB,GAAKtW,KAAK+uC,mBAAmB5S,GAC7Bx5B,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CACpCrD,MAAK47B,GAAGd,aAAan4B,EAAIA,EACzB3C,KAAK47B,GAAGd,aAAaz3B,EAAIA,EACzBrD,KAAK47B,GAAGf,SAASl4B,EAAIA,EACrB3C,KAAK47B,GAAGf,SAASx3B,EAAIA,EACrBrD,KAAK47B,GAAGb,cAAcp4B,EAAI,EAC1B3C,KAAK47B,GAAGb,cAAc13B,EAAI,EAC1BrD,KAAK47B,GAAGhB,iBAAiBuB,EAAEmT,SAAU,EACjCtvC,KAAKs5B,QAAQmD,WACuC,GAAnDz8B,KAAKs5B,QAAQmD,UAAUz8B,KAAKwe,GAAI2d,EAAEmT,OAAQ3sC,EAAGU,IAChDrD,KAAK8uC,cAGP9uC,KAAKg5B,OAAOgX,QACR7T,EAAE4T,gBACL5T,EAAE4T,kBAIJrT,QAAU,SAASP,GAClBn8B,KAAK47B,GAAGzB,aAAegC,CACvB,IAAI7lB,GAAKtW,KAAK+uC,mBAAmB5S,GAC7Bx5B,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CACpCrD,MAAK47B,GAAGd,aAAan4B,EAAIA,EACzB3C,KAAK47B,GAAGd,aAAaz3B,EAAIA,EACzBrD,KAAK47B,GAAGf,SAASl4B,EAAIA,EACrB3C,KAAK47B,GAAGf,SAASx3B,EAAIA,EACrBrD,KAAK47B,GAAGb,cAAcp4B,EAAI,EAC1B3C,KAAK47B,GAAGb,cAAc13B,EAAI,EAC1BrD,KAAK47B,GAAGhB,iBAAiBuB,EAAEmT,SAAU,EACjCtvC,KAAKs5B,QAAQoD,SACqC,GAAjD18B,KAAKs5B,QAAQoD,QAAQ18B,KAAKwe,GAAI2d,EAAEmT,OAAQ3sC,EAAGU,IAC9CrD,KAAK8uC,cAGH3S,EAAE4T,gBACL5T,EAAE4T,kBAIJpT,UAAY,SAASR,GACpBn8B,KAAK47B,GAAGxB,eAAiB+B,CACzB,IAAI7lB,GAAKtW,KAAK+uC,mBAAmB5S,GAC7Bx5B,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CACpCrD,MAAK47B,GAAGd,aAAan4B,EAAI3C,KAAK47B,GAAGf,SAASl4B,EAC1C3C,KAAK47B,GAAGd,aAAaz3B,EAAIrD,KAAK47B,GAAGf,SAASx3B,EAC1CrD,KAAK47B,GAAGf,SAASl4B,EAAIA,EACrB3C,KAAK47B,GAAGf,SAASx3B,EAAIA,EACrBrD,KAAK47B,GAAGb,cAAcp4B,EAAI3C,KAAK47B,GAAGf,SAASl4B,EAAI3C,KAAK47B,GAAGd,aAAan4B,EACpE3C,KAAK47B,GAAGb,cAAc13B,EAAIrD,KAAK47B,GAAGf,SAASx3B,EAAIrD,KAAK47B,GAAGd,aAAaz3B,EAChErD,KAAKs5B,QAAQqD,WAC6B,GAAzC38B,KAAKs5B,QAAQqD,UAAU38B,KAAKwe,GAAI7b,EAAGU,IACtCrD,KAAK8uC,cAGH3S,EAAE4T,gBACL5T,EAAE4T,kBAIJhT,WAAa,SAASZ,GACrBn8B,KAAK47B,GAAGvB,gBAAkB8B,CAC1B,IAAI7lB,GAAKtW,KAAK+uC,mBAAmB5S,GAC7Bx5B,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CAOpC,IANArD,KAAK47B,GAAGd,aAAan4B,EAAIA,EACzB3C,KAAK47B,GAAGd,aAAaz3B,EAAIA,EACzBrD,KAAK47B,GAAGf,SAASl4B,EAAIA,EACrB3C,KAAK47B,GAAGf,SAASx3B,EAAIA,EACrBrD,KAAK47B,GAAGb,cAAcp4B,EAAI,EAC1B3C,KAAK47B,GAAGb,cAAc13B,EAAI,EACtBrD,KAAKs5B,QAAQyD,WAAY,CAC5B,GAAIkT,GAAQ,CACP9T,KACJA,EAAIuB,OAAOwS,OAER/T,EAAEgU,YACLF,EAAQ9T,EAAEgU,WAAa,IAGnBzS,OAAO0S,QACVH,GAASA,IAGF9T,EAAEkU,SAIVJ,GAAS9T,EAAEkU,OAAS,GAMjBJ,GACkD,GAAjDjwC,KAAKs5B,QAAQyD,WAAW/8B,KAAKwe,GAAIyxB,EAAOttC,EAAGU,IAC9CrD,KAAK8uC,cASJ3S,EAAE4T,gBACL5T,EAAE4T,kBAKJ5S,WAAa,SAAShB,GACrBn8B,KAAK47B,GAAG1B,eAAiBiC,EAAEmU,QAAQ,EACnC,IAAIh6B,GAAKtW,KAAK+uC,mBAAmB5S,EAAEmU,QAAQ,IACvC3tC,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CACpCrD,MAAK47B,GAAGd,aAAan4B,EAAIA,EACzB3C,KAAK47B,GAAGd,aAAaz3B,EAAIA,EACzBrD,KAAK47B,GAAGf,SAASl4B,EAAIA,EACrB3C,KAAK47B,GAAGf,SAASx3B,EAAIA,EACrBrD,KAAK47B,GAAGb,cAAcp4B,EAAI,EAC1B3C,KAAK47B,GAAGb,cAAc13B,EAAI,EAC1BrD,KAAK47B,GAAGhB,iBAAiB,IAAK,EAC1B56B,KAAKs5B,QAAQmD,WACgC,GAA5Cz8B,KAAKs5B,QAAQmD,UAAUz8B,KAAKwe,GAAI,EAAG7b,EAAGU,IACzCrD,KAAK8uC,cAGP9uC,KAAKg5B,OAAOgX,QACR7T,EAAE4T,gBACL5T,EAAE4T,kBAIJ3S,SAAW,SAASjB,GACnBn8B,KAAK47B,GAAGzB,aAAegC,EAAEoU,eAAe,EACxC,IAAIj6B,GAAKtW,KAAK+uC,mBAAmB5S,EAAEoU,eAAe,IAC9C5tC,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CACpCrD,MAAK47B,GAAGd,aAAan4B,EAAIA,EACzB3C,KAAK47B,GAAGd,aAAaz3B,EAAIA,EACzBrD,KAAK47B,GAAGf,SAASl4B,EAAIA,EACrB3C,KAAK47B,GAAGf,SAASx3B,EAAIA,EACrBrD,KAAK47B,GAAGb,cAAcp4B,EAAI,EAC1B3C,KAAK47B,GAAGb,cAAc13B,EAAI,EAC1BrD,KAAK47B,GAAGhB,iBAAiB,IAAK,EAC1B56B,KAAKs5B,QAAQoD,SAC8B,GAA1C18B,KAAKs5B,QAAQoD,QAAQ18B,KAAKwe,GAAI,EAAG7b,EAAGU,IACvCrD,KAAK8uC,cAGH3S,EAAE4T,gBACL5T,EAAE4T,kBAIJ1S,UAAY,SAASlB,GACpBn8B,KAAK47B,GAAGxB,eAAiB+B,EAAEoU,eAAe,EAC1C,IAAIj6B,GAAKtW,KAAK+uC,mBAAmB5S,EAAEoU,eAAe,IAC9C5tC,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CACpCrD,MAAK47B,GAAGd,aAAan4B,EAAI3C,KAAK47B,GAAGf,SAASl4B,EAC1C3C,KAAK47B,GAAGd,aAAaz3B,EAAIrD,KAAK47B,GAAGf,SAASx3B,EAC1CrD,KAAK47B,GAAGf,SAASl4B,EAAIA,EACrB3C,KAAK47B,GAAGf,SAASx3B,EAAIA,EACrBrD,KAAK47B,GAAGb,cAAcp4B,EAAI3C,KAAK47B,GAAGf,SAASl4B,EAAI3C,KAAK47B,GAAGd,aAAan4B,EACpE3C,KAAK47B,GAAGb,cAAc13B,EAAIrD,KAAK47B,GAAGf,SAASx3B,EAAIrD,KAAK47B,GAAGd,aAAaz3B,EAChErD,KAAKs5B,QAAQqD,WAC6B,GAAzC38B,KAAKs5B,QAAQqD,UAAU38B,KAAKwe,GAAI7b,EAAGU,IACtCrD,KAAK8uC,cAGH3S,EAAE4T,gBACL5T,EAAE4T,kBAIJnT,MAAQ,SAAST,GAChBn8B,KAAK47B,GAAGtB,WAAa6B,CACrB,IAAI7lB,GAAKtW,KAAK+uC,mBAAmB5S,GAC7Bx5B,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CAChCrD,MAAKs5B,QAAQsD,OACmC,GAA/C58B,KAAKs5B,QAAQsD,MAAM58B,KAAKwe,GAAI2d,EAAEmT,OAAQ3sC,EAAGU,IAC5CrD,KAAK8uC,eAURjS,SAAW,SAASV,GACnBn8B,KAAK47B,GAAGrB,cAAgB4B,CACxB,IAAI7lB,GAAKtW,KAAK+uC,mBAAmB5S,GAC7Bx5B,EAAI2T,EAAG3T,EACPU,EAAIrD,KAAKg5B,OAAOpU,OAAS,EAAItO,EAAGjT,CAChCrD,MAAKs5B,QAAQuD,UACsC,GAAlD78B,KAAKs5B,QAAQuD,SAAS78B,KAAKwe,GAAI2d,EAAEmT,OAAQ3sC,EAAGU,IAC/CrD,KAAK8uC,cAGH3S,EAAE4T,gBACL5T,EAAE4T,kBAIJjT,OAAS,SAASX,GACjBn8B,KAAK47B,GAAGpB,YAAc2B,EAClBn8B,KAAKs5B,QAAQwD,QAC2D,GAAvE98B,KAAKs5B,QAAQwD,OAAO98B,KAAKwe,GAAIxe,KAAKg5B,OAAOrU,MAAO3kB,KAAKg5B,OAAOpU,SAC/D5kB,KAAK8uC,cAGH3S,EAAE4T,gBACL5T,EAAE4T,kBAIJlB,OAAS,WACR7uC,KAAK47B,GAAGnB,YAAc,IACtB,IAAIS,GAAMD,KAAKC,MAAQ,GACvBl7B,MAAK47B,GAAGT,SAAYn7B,KAAK47B,GAAGZ,QAC5Bh7B,KAAK47B,GAAGZ,QAAYE,EACpBl7B,KAAK47B,GAAGR,UAAap7B,KAAK47B,GAAGZ,QAAUh7B,KAAK47B,GAAGT,QAC/C,IAAIkU,IAAS,CACTrvC,MAAKs5B,QAAQuV,SAChBQ,EAA6D,GAAnDrvC,KAAKs5B,QAAQuV,OAAO7uC,KAAKwe,GAAIxe,KAAK47B,GAAGR,YAE5CiU,GACHrvC,KAAK8uC,eAIP7S,KAAO,WACNj8B,KAAK47B,GAAGlB,UAAY,KAChB16B,KAAKs5B,QAAQ2C,MAChBj8B,KAAKs5B,QAAQ2C,KAAKj8B,KAAKwe,IAExBxe,KAAKwe,GAAGgyB,QACRxwC,KAAK87B,cAAe,GAQtB,IAAIyB,uBAAwB,GAAIx8B;ACxxPhC,QAAS0vC,iBAAgBtU,EAAEz6B,EAAE/B,EAAEiC,GAAG,QAAS+E,KAAI,GAAIjF,GAAE1D,SAASC,eAAek+B,EAAE,OAAQz6B,GAAEgvC,kBAAkBhvC,EAAEgvC,oBAAoBhvC,EAAEivC,wBAAwBjvC,EAAEivC,0BAA0BjvC,EAAEkvC,qBAAqBlvC,EAAEkvC,uBAAuBlvC,EAAEmvC,qBAAqBnvC,EAAEmvC,sBAAsBnvC,EAAEovC,MAAMlsB,OAAOmsB,OAAOnsB,OAAO,KAAKljB,EAAEovC,MAAMnsB,MAAMosB,OAAOpsB,MAAM,IAAK,IAAIhlB,GAAEqxC,EAAE,IAAI7U,EAAE,SAAUx8B,GAAEilB,OAAOmsB,OAAOnsB,QAAQjlB,EAAEglB,MAAMosB,OAAOpsB,OAAOhlB,EAAE2e,KAAK,QAAQyyB,OAAOpsB,OAAOhlB,EAAE2e,KAAK,SAASyyB,OAAOnsB,QAAQ9f,EAAEg4B,SAASmU,GAAE,CAAG,IAAIrvC,IAAGsvC,MAAM,kBAAkBC,OAAOC,QAAQ,0BAA2BJ,GAAE,IAAI7U,EAAE,oBAAoBmT,OAAO,SAAS1tC,GAAG,QAASzD,KAAI,GAAIuD,GAAE1D,SAASC,eAAek+B,EAAE,OAAQn+B,UAASqzC,eAAerzC,SAASqzC,iBAAiBrzC,SAASszC,qBAAqBtzC,SAASszC,uBAAuBtzC,SAASuzC,oBAAoBvzC,SAASuzC,sBAAsBvzC,SAASwzC,kBAAkBxzC,SAASwzC,mBAAmB9vC,EAAEovC,MAAMlsB,OAAOid,EAAE,KAAKngC,EAAEovC,MAAMnsB,MAAM8sB,EAAE,IAAK,IAAI9xC,GAAEqxC,EAAE,IAAI7U,EAAE,SAAUx8B,GAAEilB,OAAOid,GAAGliC,EAAEglB,MAAM8sB,GAAG9xC,EAAE2e,KAAK,QAAQmzB,GAAG9xC,EAAE2e,KAAK,SAASujB,GAAG/8B,EAAEg4B,SAASmU,GAAE,CAAG,IAAIrvC,IAAGsvC,MAAM,oBAAoBC,OAAOC,QAAQ,wBAAyBJ,GAAE,IAAI7U,EAAE,oBAAoBmT,OAAO,SAAS1tC,GAAG,QAASiD,GAAEnD,GAAG,SAASA,GAAGsvC,EAAE,IAAI7U,EAAE,eAAeuV,IAAI,UAAU,QAAQV,EAAE,YAAYU,IAAI,aAAa,WAAW,GAAI7P,GAAEjgC,EAAE6vC,EAAE9xC,EAAEsxC,GAAE,EAAGphC,EAAEmhC,EAAEA,EAAE,IAAI7U,GAAG,IAAIh1B,EAAEnJ,SAAS2zC,cAAc,MAAOxqC,GAAEyqC,GAAGzV,EAAE,OAAOh1B,EAAE2pC,MAAMlsB,OAAOhjB,EAAE,KAAKuF,EAAE2pC,MAAMnsB,MAAMhlB,EAAE,KAAKwH,EAAE2pC,MAAMe,OAAO,OAAO1qC,EAAE2pC,MAAMz5B,SAAS,WAAWxH,EAAEiiC,OAAO3qC,EAAG,IAAIgK,GAAE6/B,EAAEA,EAAE,IAAI7U,EAAE,QAAQ,IAAIxsB,EAAEwsB,EAAE,SAAS4V,EAAE/zC,SAAS2zC,cAAc,SAAUI,GAAEH,GAAGjiC,EAAEoiC,EAAEptB,MAAMhlB,EAAEoyC,EAAEntB,OAAOhjB,EAAEuP,EAAE2gC,OAAOC,EAAG,IAAIvsC,GAAExH,SAAS2zC,cAAc,IAAKnsC,GAAEwsC,KAAK,2CAA2CxsC,EAAE8R,OAAO,QAAS,IAAI+D,GAAErd,SAAS2zC,cAAc,MAAOt2B,GAAEy1B,MAAMnsB,MAAM,OAAOtJ,EAAEy1B,MAAMlsB,OAAO,OAAOpf,EAAEysC,YAAY52B,GAAG7V,EAAEsrC,MAAMz5B,SAAS,WAAW7R,EAAEsrC,MAAMp4B,OAAO,MAAMlT,EAAEsrC,MAAMt4B,KAAK,MAAMhT,EAAEsrC,MAAMoB,SAAS,OAAO/gC,EAAE2gC,OAAOtsC,EAAG,IAAI2sC,GAAEn0C,SAAS2zC,cAAc,MAAOQ,GAAEC,aAAa,QAAQ,WAAWD,EAAErB,MAAMz5B,SAAS,WAAW86B,EAAErB,MAAMn4B,IAAI,OAAOw5B,EAAErB,MAAMt4B,KAAK,OAAO25B,EAAErB,MAAMoB,SAAS,OAAOC,EAAErB,MAAMnsB,MAAM,OAAOwtB,EAAErB,MAAMlsB,OAAO,QAAQutB,EAAErB,MAAMuB,WAAW,SAASF,EAAEG,UAAU,wRAAwRnhC,EAAE2gC,OAAOK,EAAG,IAAIpsC,GAAE/H,SAAS2zC,cAAc,MAAO5rC,GAAE6rC,GAAGzV,EAAE,SAASp2B,EAAE+qC,MAAMnsB,MAAM,OAAO5e,EAAE+qC,MAAMlsB,OAAO,OAAO7e,EAAE+qC,MAAMz5B,SAAS,WAAWtR,EAAE+qC,MAAMt4B,KAAK,MAAMzS,EAAE+qC,MAAMn4B,IAAI,MAAM5S,EAAE+qC,MAAMyB,MAAM,UAAUxsC,EAAE+qC,MAAM0B,gBAAgB,qBAAqBzsC,EAAEusC,UAAU,m6BAAm6BvsC,EAAE+qC,MAAM2B,QAAQ,OAAOthC,EAAE2gC,OAAO/rC,GAAGirC,EAAE,IAAI7U,EAAE,gBAAgBmT,QAAQ6B,OAAOC,QAAQ,0BAA0B/xC,MAAK,EAAG6xC,MAAM,YAAYtU,MAAM,WAAW93B,EAAE4tC,gBAAgB1B,EAAE,IAAI7U,EAAE,iBAAiBmT,QAAQ6B,OAAOC,QAAQ,2BAA2B/xC,MAAK,EAAG6xC,MAAM,aAAatU,MAAM,WAAW93B,EAAE6tC,iBAAiB3B,EAAE,IAAI7U,EAAE,eAAemT,QAAQ6B,OAAOC,QAAQ,yBAAyB/xC,MAAK,EAAG6xC,MAAM,cAActU,MAAM,WAAW,GAAIT,EAAE,cAAa6U,EAAEhxC,MAAMX,QAAQ88B,GAAG+U,MAAM,WAAWC,OAAOC,QAAQ,4BAA4BtsC,EAAE8tC,QAAQ,KAAKzW,GAAG+U,MAAM,YAAYC,OAAOC,QAAQ,0BAA0BtsC,EAAE8tC,QAAQ,IAAI5B,EAAEhxC,MAAMsvC,OAAO,SAASnT,KAAK6U,EAAE,IAAI7U,EAAE,cAAcmT,QAAQ6B,OAAOC,QAAQ,wBAAwB/xC,MAAK,EAAG6xC,MAAM,SAAStU,MAAM,WAAWoU,EAAE,IAAI7U,EAAE,UAAU0W,SAAS7B,EAAE,IAAI7U,EAAE,oBAAoBmT,QAAQ6B,OAAOC,QAAQ,wBAAwB/xC,MAAK,EAAG6xC,MAAM,sBAAsBtU,MAAM,WAAWqU,EAAE9yC,IAAIwI,IAAIqqC,EAAE,IAAI7U,EAAE,oBAAoB2W,YAAY,oBAAoB90C,SAASk+B,iBAAiB,qBAAqB,WAAWl+B,SAAS+0C,qBAAqB50C,MAAK,GAAIH,SAASk+B,iBAAiB,sBAAsB,WAAWl+B,SAASg1C,eAAe70C,MAAK,GAAIH,SAASk+B,iBAAiB,yBAAyB,WAAWl+B,SAASi1C,oBAAoB90C,MAAK,GAAI6yC,EAAE,IAAI7U,EAAE,UAAUS,MAAM,WAAWoU,EAAE,IAAI7U,EAAE,UAAU+W,QAAS,IAAIvwC,GAAE3E,SAAS2zC,cAAc,MAAO,IAAGhvC,EAAEivC,GAAGzV,EAAE,SAASx5B,EAAEmuC,MAAMnsB,MAAM,OAAOhiB,EAAEmuC,MAAMlsB,OAAO,OAAOjiB,EAAEmuC,MAAMz5B,SAAS,WAAW1U,EAAEmuC,MAAMt4B,KAAK,MAAM7V,EAAEmuC,MAAMn4B,IAAI,MAAMhW,EAAEmuC,MAAMyB,MAAM,UAAU5vC,EAAEmuC,MAAM0B,gBAAgB,qBAAqB7vC,EAAE2vC,UAAU,wFAAwF3vC,EAAEmuC,MAAM2B,QAAQ,OAAOthC,EAAE2gC,OAAOnvC,GAAG,MAAMm2B,oBAAoB,cAAcn2B,EAAEmuC,MAAM2B,QAAQ,QAAQ9vC,EAAE2vC,UAAU,0xDAA0xD,CAAC3vC,EAAE2vC,UAAU,EAAG,IAAIxtC,GAAE,GAAIquC,UAASxjC,EAAG7K,GAAEsuC,YAAY1xC,GAAGoD,EAAEuuC,uBAAuBxuC,GAAG+4B,kBAAkBjuB,EAAE7K,EAAE,KAAK,QAAStB,QAAO,QAAS2vC,UAAShX,GAAGn8B,KAAK+tB,KAAK,EAAE/tB,KAAKszC,cAAc,EAAEtzC,KAAKuzC,QAAQvzC,KAAKwzC,cAAcxzC,KAAKwzC,WAAW,GAAG,EAAExzC,KAAKg5B,OAAOmD,EAAEn8B,KAAK+7B,WAAU,EAAG/7B,KAAKyzC,eAAe,KAAKzzC,KAAK0zC,WAAU,EAAG1zC,KAAK2zC,cAAa,EAAG3zC,KAAK4zC,SAAS,GAAG5zC,KAAK6zC,oBAAoB,KAAK7zC,KAAK8zC,aAAa,EAAE9zC,KAAK+zC,QAAQ,EAAE/zC,KAAKg0C,kBAAkBh0C,KAAKi0C,UAAS,CAAG,KAAI,GAAIvyC,GAAE,EAAE,GAAGA,EAAEA,IAAI1B,KAAKwzC,WAAW9xC,GAAGgD,OAAO,EAAE9B,KAAKgB,IAAIlC,EAAE,GAAGgD,QAAQ,QAASwvC,gBAAel0C,KAAK4xC,GAAG,EAAE5xC,KAAKm0C,YAAY,GAAGn0C,KAAKo0C,iBAAiB,GAAG,GAAG,GAAG,IAAIp0C,KAAKq0C,cAAc,EAAEr0C,KAAKs0C,OAAO,EAAEt0C,KAAKu0C,IAAI,GAAIp4B,SAAQnc,KAAK4+B,UAAU4V,UAAU,GAAGC,MAAMC,OAAOC,WAAW30C,KAAKpB,IAAI,KAAKoB,KAAK40C,KAAK,KAAK50C,KAAK60C,QAAO,EAAG,QAASC,cAAa3Y,EAAEz6B,GAAG1B,KAAK+0C,OAAM,EAAG/0C,KAAKg1C,WAAW,EAAEh1C,KAAKi1C,UAAU,GAAGj1C,KAAKk1C,MAAM,KAAKl1C,KAAKvB,IAAI,KAAKuB,KAAKm1C,SAAS,EAAEn1C,KAAKqjC,OAAO,EAAE,EAAE,GAAGrjC,KAAK8b,QAAQ,EAAE,EAAE,GAAG9b,KAAKo1C,MAAM,GAAGjZ,GAAGn8B,KAAKo8B,KAAKD,EAAEkZ,KAAKC,KAAK5zC,GAAG,QAAS6zC,iBAAgBpZ,GAAGA,GAAGqZ,MAAM,2BAA2BrZ,GAAG,QAASsZ,uBAAsBtZ,EAAEz6B,GAAG,MAAOy6B,GAAEyC,SAAS4V,WAAW9yC,EAAEk9B,SAAS4V,UAAU9yC,EAAEk9B,SAAS4V,UAAUrY,EAAEyC,SAAS4V,UAAUrY,EAAEyC,SAAS6V,OAAO/yC,EAAEk9B,SAAS6V,MAAM/yC,EAAEk9B,SAAS6V,MAAMtY,EAAEyC,SAAS6V,MAAMtY,EAAEyV,GAAGlwC,EAAEkwC,GAAG,QAAS8D,kBAAiBvZ,EAAEz6B,GAAG1B,KAAK21C,IAAG,EAAG31C,KAAKwe,GAAG2d,EAAEn8B,KAAK41C,MAAM,GAAId,cAAa90C,KAAK61C,WAAW,EAAE71C,KAAK81C,SAAS,GAAI14B,YAAWpd,KAAK+1C,UAAU,EAAE/1C,KAAKg2C,UAAUh2C,KAAKi2C,kBAAkBv0C,EAAE1B,KAAKk2C,cAAc,EAAEl2C,KAAKm2C,oBAAoB,EAAEn2C,KAAKo2C,wBAAwB,EAAEp2C,KAAKq2C,cAAcr2C,KAAKs2C,oBAAoBt2C,KAAKu2C,oBAAoBv2C,KAAKw2C,eAAex2C,KAAKy2C,YAAW,EAAGz2C,KAAK02C,aAAY,CAAG,IAAI/2C,GAAE,GAAIwlB,gBAAe,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,IAAI,KAAKvjB,EAAE,GAAIowB,cAAa,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAIrrB,EAAE,GAAIqrB,cAAa,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI7zB,EAAE,GAAIm1B,WAAU6I,EAAGh+B,GAAE6xB,mBAAmB,WAAW,EAAErwB,GAAGxB,EAAE8xB,qBAAqB,YAAYkM,EAAEvG,UAAUh0B,GAAGzD,EAAE8xB,qBAAqB,QAAQkM,EAAE5G,MAAM5uB,GAAG3G,KAAK22C,SAASx4C,EAAE6B,KAAK42C,cAAc,KAAK52C,KAAK62C,cAAc,KAAK72C,KAAK82C,SAAS,IAAK,IAAIjyC,GAAErG,YAAY,uBAAuBqjC,EAAErjC,YAAY,uBAAuBizC,EAAE,GAAI9kB,YAAWwP,GAAGt3B,IAAIg9B,GAAIr+B,KAAIiuC,EAAEjuC,KAAKxD,KAAK+2C,YAAYtF,EAAEzxC,KAAKg3C,aAAa,GAAIzjB,mBAAkBvzB,KAAK+2C,aAAa/2C,KAAKi3C,eAAe3mC,gBAAgBtQ,KAAKk3C,yBAAyB5mC,gBAAgBtQ,KAAKm3C,YAAW,CAAG,IAAIlG,GAAE,6PAA6PphC,EAAE,+QAAgR7P,MAAKo3C,QAAQ,GAAIzqB,YAAW3sB,KAAKwe,IAAIyyB,IAAIphC,IAAIrM,IAAIxD,KAAKo3C,QAAQ5zC,IAAK,IAAI2D,GAAE,GAAIge,eAAc,EAAE,EAAE,GAAG,EAAE,EAAE,GAAG,GAAG,KAAKhU,EAAE,GAAIgU,eAAc,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAI,IAAGnlB,KAAK21C,GAAG,CAAC,GAAIhmC,GAAE,GAAI2jB,WAAUtzB,KAAKwe,GAAI7O,GAAEqgB,mBAAmB,WAAW,EAAE7oB,GAAGwI,EAAEqgB,mBAAmB,WAAW,EAAE7e,GAAGxB,EAAE0mB,mBAAmB,WAAWr2B,KAAKwe,GAAGsX,eAAe,EAAE,GAAG91B,KAAKq3C,OAAO1nC,EAAE3P,KAAKs3C,MAAM,KAAKt3C,KAAKu3C,YAAYv3C,KAAKw3C,SAAS,GAAIz2C,QAAOf,KAAKw3C,SAASC,QAAQ,EAAEz3C,KAAKw3C,SAASE,SAAS,EAAE13C,KAAKw3C,SAASG,QAAQ,EAAE33C,KAAKw3C,SAASI,MAAM,EAAEzE,SAAS11C,WAAWm1C,QAAQ,SAASzW,GAAGn8B,KAAK+tB,KAAKoO,GAAG0b,aAAa,SAAS1b,EAAEz6B,GAAG,GAAI/B,GAAEw8B,EAAEn8B,KAAK47B,GAAGjX,MAAM,IAAI,IAAI/iB,EAAEF,EAAE1B,KAAK47B,GAAGhX,OAAO,IAAI,GAAIjlB,GAAEiD,KAAKmC,IAAI,EAAEnC,KAAKqC,IAAI,GAAGtF,IAAIiC,EAAEgB,KAAKmC,IAAI,EAAEnC,KAAKqC,IAAI,GAAGrD,GAAI,IAAI+E,GAAE/D,KAAKO,KAAKxD,EAAEA,EAAEiC,EAAEA,EAAG+E,GAAE,IAAIA,EAAE,EAAG,IAAIxI,GAAEyE,KAAK89B,GAAG,CAAE,IAAG/gC,IAAIxB,EAAEyE,KAAK4B,MAAM5C,EAAEjC,IAAIA,EAAEgH,EAAE/D,KAAKoB,IAAI7F,GAAGyD,EAAE+E,EAAE/D,KAAKgB,IAAIzF,EAAG,IAAI0G,KAAKA,GAAE,EAAE8B,GAAGhH,EAAEiC,EAAEgB,KAAKO,KAAK,EAAExD,EAAEA,EAAEiC,EAAEA,KAAKjC,EAAEiC,EAAE,GAAGiD,EAAEwG,gBAAgBxG,GAAG7E,KAAKm0B,SAAS2jB,SAASjzC,EAAEnE,MAAM,EAAE,GAAGV,KAAKm0B,SAAS4jB,SAAS/3C,KAAKm0B,SAAS6jB,wBAAwBnzC,IAAIozC,eAAe,WAAWj4C,KAAKk4C,YAAY,GAAG,EAAEl4C,KAAKk4C,YAAY,GAAG,EAAEl4C,KAAKm4C,IAAI7nC,gBAAgBtQ,KAAKo4C,WAAW9nC,iBAAiB8iC,YAAY,SAASjX,GAAGn8B,KAAK4zC,SAASzX,GAAGkX,uBAAuB,SAASlX,GAAGn8B,KAAK6zC,oBAAoB1X,GAAGC,KAAK,SAASD,GAAG34B,IAAI,sBAAsBy6B,mBAAmB,MAAMj+B,KAAKq4C,MAAM,GAAIv7B,mBAAkB9c,KAAKm0B,SAAS,GAAIuhB,kBAAiBvZ,EAAE,WAAWn8B,KAAKk4C,aAAa,EAAE,GAAGl4C,KAAKm4C,IAAI7nC,gBAAgBtQ,KAAKo4C,WAAW9nC,gBAAgB,IAAItQ,KAAK4zC,UAAU5zC,KAAKs4C,UAAUt4C,KAAK4zC,WAAW0E,UAAU,SAASnc,GAAGn8B,KAAKm0B,SAASmkB,UAAUnc,GAAGn8B,KAAK6zC,oBAAoB7zC,KAAKm0B,SAAStU,MAAM7f,KAAKq4C,MAAM,GAAIv7B,mBAAkB9c,KAAKk4C,aAAa,EAAE,GAAGl4C,KAAKm4C,IAAI7nC,gBAAgBtQ,KAAK+7B,WAAU,EAAG/7B,KAAKu4C,aAAav4C,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAGrjC,KAAKm0B,SAASqkB,UAAU,GAAGx4C,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAGrjC,KAAKm0B,SAASskB,WAAW,GAAGz4C,KAAK04C,UAAU14C,KAAKu4C,WAAW,GAAGv4C,KAAKm0B,SAASqkB,SAASx4C,KAAKu4C,WAAW,GAAGv4C,KAAKm0B,SAASskB,WAAWz4C,KAAKqjC,MAAM,CAAE,IAAI3hC,GAAE1B,KAAK47B,GAAGjX,MAAMhlB,EAAEK,KAAK47B,GAAGhX,OAAOhjB,EAAE5B,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAGrjC,KAAKm0B,SAASqkB,SAAS92C,EAAEiF,EAAE3G,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAGrjC,KAAKm0B,SAASskB,UAAU94C,CAAEK,MAAKqjC,MAAMzgC,KAAKmC,IAAInD,EAAE+E,GAAG3G,KAAK24C,SAAS,IAAI/1C,KAAKqC,IAAIjF,KAAKm0B,SAASqkB,SAAS92C,EAAE1B,KAAKm0B,SAASskB,UAAU94C,GAAGK,KAAK44C,SAAS,IAAI54C,KAAK64C,SAAS,KAAKC,cAAc,WAAW94C,KAAK+7B,WAAU,GAAIgd,kBAAkB,SAAS5c,GAAGA,IAAIn8B,KAAKyzC,eAAetX,IAAIG,QAAQ,SAASH,EAAEz6B,EAAE/B,GAAG,KAAKA,GAAGK,KAAKi4C,iBAAiB,KAAKt4C,IAAIK,KAAKm0B,SAASsiB,YAAYz2C,KAAKm0B,SAASsiB,YAAY,KAAK92C,IAAIK,KAAKm0B,SAASuiB,aAAa12C,KAAKm0B,SAASuiB,cAAc3Z,WAAW,SAASZ,EAAEz6B,EAAE/B,EAAEiC,GAAG,GAAG5B,KAAKi0C,SAAS,OAAM,CAAG,IAAIttC,GAAEhH,EAAEK,KAAKk4C,YAAY,GAAG/5C,EAAEyD,EAAE5B,KAAKk4C,YAAY,GAAGrzC,EAAEzB,OAAO,IAAI,GAAG1B,EAAG1B,MAAKg5C,WAAWn0C,EAAE8B,EAAExI,IAAIu0C,YAAY,WAAW,GAAG1yC,KAAKi0C,SAAS,OAAM,CAAG,IAAI9X,GAAEn8B,KAAK47B,GAAGjX,MAAM,EAAE3kB,KAAKk4C,YAAY,GAAGx2C,EAAE1B,KAAK47B,GAAGhX,OAAO,EAAE5kB,KAAKk4C,YAAY,GAAGv4C,EAAE,GAAIK,MAAKg5C,WAAWr5C,EAAEw8B,EAAEz6B,IAAIixC,aAAa,WAAW,GAAG3yC,KAAKi0C,SAAS,OAAM,CAAG,IAAI9X,GAAEn8B,KAAK47B,GAAGjX,MAAM,EAAE3kB,KAAKk4C,YAAY,GAAGx2C,EAAE1B,KAAK47B,GAAGhX,OAAO,EAAE5kB,KAAKk4C,YAAY,GAAGv4C,EAAE,EAAGK,MAAKg5C,WAAWr5C,EAAEw8B,EAAEz6B,IAAIs3C,WAAW,SAAS7c,EAAEz6B,EAAE/B,GAAG,GAAIiC,GAAE5B,KAAKm4C,IAAI,GAAGhc,CAAEv6B,GAAE5B,KAAK24C,WAAWxc,EAAEn8B,KAAK24C,SAAS34C,KAAKm4C,IAAI,IAAI,EAAEv2C,IAAIu6B,EAAE,EAAEn8B,KAAKm4C,IAAI,IAAI,YAAYv2C,IAAI5B,KAAK2zC,cAAa,EAAI,IAAIhtC,GAAEw1B,EAAEn8B,KAAKm4C,IAAI,GAAGn4C,KAAKm4C,IAAI,EAAG,IAAGxxC,EAAE,OAAO,KAAKA,EAAE,CAAC3G,KAAKg0C,iBAAkB,KAAI,GAAI71C,GAAE,EAAE6B,KAAK+zC,QAAQlvC,EAAE,EAAE8B,GAAGxI,EAAEA,EAAEA,GAAG0jC,EAAE,GAAG1jC,EAAE0G,EAAE4sC,EAAE5sC,EAAE1G,EAAEA,EAAE8yC,EAAEjxC,KAAKm4C,IAAI,GAAGtoC,EAAE,EAAE1R,EAAE0R,EAAEA,IAAI,CAAC,GAAI1I,GAAEtC,EAAEgL,EAAEhL,EAAE,EAAEg9B,EAAE,EAAE4P,CAAEA,IAAG5sC,GAAG,EAAEgL,EAAE,GAAGgyB,CAAE,IAAI1wB,GAAE,EAAEhK,EAAE8pC,CAAEA,IAAG9pC,EAAEnH,KAAKg0C,eAAen0C,MAAMsR,EAAEzP,EAAE/B,IAAIK,KAAK0zC,UAAU1zC,KAAK2zC,YAAa,IAAIhkC,GAAE3P,IAAK0uC,eAAc1uC,KAAKi5C,cAAcvK,cAAc1uC,KAAKk5C,cAAcl5C,KAAKk5C,aAAatK,YAAY,WAAWj/B,EAAEwpC,kBAAkB,IAAIn5C,KAAKm0B,SAASgjB,YAAW,EAAGn3C,KAAKi0C,SAASj0C,KAAK2zC,iBAAkB,IAAG3zC,KAAK2zC,aAAa,CAAC3zC,KAAK0zC,WAAU,EAAG1zC,KAAKi0C,UAAS,CAAG,IAAItkC,GAAE3P,IAAKA,MAAKg0C,kBAAkBtF,cAAc1uC,KAAKi5C,cAAcvK,cAAc1uC,KAAKk5C,cAAcl5C,KAAKk5C,aAAatK,YAAY,WAAWj/B,EAAEwpC,kBAAkB,IAAIn5C,KAAKm0B,SAASgjB,YAAW,EAAG,OAAM,GAAIgC,eAAe,WAAW,GAAG,GAAGn5C,KAAKg0C,eAAex0C,OAAO,CAAC,GAAGkvC,cAAc1uC,KAAKk5C,cAAcl5C,KAAK2zC,aAAa,CAAC,GAAIxX,GAAEn8B,IAAK0uC,eAAc1uC,KAAKi5C,cAAcj5C,KAAKi5C,aAAarK,YAAY,WAAWzS,EAAEid,kBAAkB,IAAIp5C,KAAKm0B,SAASgjB,YAAW,EAAGn3C,KAAKi0C,UAAS,EAAGj0C,KAAKq5C,oBAAqB,IAAI33C,GAAE1B,KAAKq4C,MAAM5U,MAAM9qB,IAAIhZ,GAAGK,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAG,EAAErjC,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAG,GAAGzhC,GAAG5B,KAAK47B,GAAGjX,MAAM,EAAE3kB,KAAK47B,GAAGhX,OAAO,GAAGje,EAAEyN,WAAW1S,EAAEiI,OAAOhK,EAAE,GAAGA,EAAE,GAAG,EAAE,IAAIe,MAAM,EAAE,GAAGvC,EAAEyD,EAAE,GAAG+E,EAAE,GAAG9B,EAAEjD,EAAE,GAAG+E,EAAE,EAAG3G,MAAK8zC,aAAa,EAAE9zC,KAAKs5C,aAAa3yC,EAAE3G,KAAKu5C,iBAAiB5yC,EAAE/E,EAAEgF,OAAOzI,EAAE0G,QAAS7E,MAAKm0B,SAASgjB,YAAW,CAAG,aAAYn3C,KAAK0zC,WAAU,GAAI,GAAI7R,GAAE7hC,KAAKg0C,eAAejV,OAAO,EAAE,GAAG,GAAG0S,EAAE5P,EAAE,EAAGxnB,IAAGwnB,EAAE,GAAGvnB,GAAGunB,EAAE,EAAG,IAAIoP,GAAEj/B,SAAS8D,kBAAkBuE,GAAGC,GAAG,GAAGtI,SAASkF,cAAcu6B,EAAEA,EAAE,GAAGz/B,SAAS8D,mBAAmBuE,IAAIC,GAAG,GAAGta,KAAKm4C,OAAOtoC,EAAE7P,KAAKw5C,kBAAkBx5C,KAAKk4C,YAAYjH,GAAG9pC,EAAEiN,WAAWvE,EAAElG,OAAO3J,KAAKu4C,WAAW,GAAGv4C,KAAKu4C,WAAW,GAAG,EAAE,IAAI73C,MAAM,EAAE,GAAGyQ,EAAEiD,WAAWvE,EAAElG,OAAO3J,KAAK04C,SAAS,GAAG14C,KAAK04C,SAAS,GAAG,EAAE,IAAIh4C,MAAM,EAAE,EAAGyG,GAAE,IAAInH,KAAK44C,SAASzxC,EAAE,IAAInH,KAAK64C,SAAS1nC,EAAE,IAAInR,KAAK44C,SAASznC,EAAE,IAAInR,KAAK64C,QAAS,IAAIlpC,GAAEwB,EAAE,GAAGhK,EAAE,GAAG4qC,EAAE5gC,EAAE,GAAGhK,EAAE,GAAGhJ,EAAE,EAAE0G,EAAE,CAAE,IAAG8K,EAAE3P,KAAK47B,GAAGjX,OAAOotB,EAAE/xC,KAAK47B,GAAGhX,OAAOzT,EAAE,GAAGnR,KAAK47B,GAAGjX,MAAMxmB,GAAG6B,KAAK47B,GAAGjX,MAAMxT,EAAE,GAAGhK,EAAE,GAAG,IAAIhJ,GAAGgJ,EAAE,IAAIgK,EAAE,GAAGnR,KAAK47B,GAAGhX,OAAO/f,GAAG7E,KAAK47B,GAAGhX,OAAOzT,EAAE,GAAGhK,EAAE,GAAG,IAAItC,GAAGsC,EAAE,QAAS,IAAGwI,EAAE3P,KAAK47B,GAAGjX,MAAMrK,GAAGta,KAAK47B,GAAGhX,OAAO,EAAE5kB,KAAKk4C,YAAY,GAAG/mC,EAAE,GAAGnR,KAAK47B,GAAGjX,MAAMxmB,GAAG6B,KAAK47B,GAAGjX,MAAMxT,EAAE,GAAGhK,EAAE,GAAG,IAAIhJ,GAAGgJ,EAAE,QAAQ,CAAC,KAAK4qC,EAAE/xC,KAAK47B,GAAGhX,QAAQ,MAAOvK,IAAGra,KAAK47B,GAAGjX,MAAM,EAAErK,GAAGta,KAAK47B,GAAGhX,OAAO,EAAE5kB,KAAKi4C,sBAAsB,GAAGj4C,KAAKg0C,eAAeyF,SAAS/K,cAAc1uC,KAAKk5C,cAAcl5C,KAAKm0B,SAASgjB,YAAW,GAAK98B,IAAGra,KAAK47B,GAAGjX,MAAM,EAAE3kB,KAAKk4C,YAAY,GAAG/mC,EAAE,GAAGnR,KAAK47B,GAAGhX,OAAO/f,GAAG7E,KAAK47B,GAAGhX,OAAOzT,EAAE,GAAGhK,EAAE,GAAG,IAAItC,GAAGsC,EAAE,IAAInH,KAAKm4C,IAAInmC,SAAS8D,kBAAkBuE,GAAGC,GAAG,GAAGtI,SAASkF,cAAcu6B,EAAEA,EAAE,GAAGz/B,SAAS8D,mBAAmBuE,IAAIC,GAAG,GAAGta,KAAKm4C,OAAOn4C,KAAKk4C,YAAY,IAAI/5C,EAAE6B,KAAKk4C,YAAY,IAAIrzC,EAAE04B,sBAAsBv9B,KAAKg5B,QAAQ8V,eAAe4K,cAAc,SAASvd,GAAGoB,sBAAsBv9B,KAAKg5B,QAAQyD,UAAUN,IAAIM,UAAU,SAASN,EAAEz6B,EAAE/B,EAAEiC,GAAG,GAAG5B,KAAK0zC,UAAU,OAAM,CAAG,IAAG,GAAGhyC,EAAE,CAAC,GAAG1B,KAAK47B,GAAGjB,SAAS,IAAI,MAAO36B,MAAK63C,aAAal4C,EAAEiC,IAAG,CAAG,IAAG,GAAG5B,KAAK+tB,KAAK,CAAC/tB,KAAK25C,cAAa,EAAG35C,KAAKs5C,cAAc35C,EAAEiC,GAAG5B,KAAKg0C,iBAAkB,IAAIrtC,GAAE3G,IAAK,OAAO0uC,eAAc1uC,KAAKk5C,cAAcxK,cAAc1uC,KAAKi5C,cAAcj5C,KAAKi5C,aAAarK,YAAY,WAAWjoC,EAAEyyC,kBAAkB,IAAIp5C,KAAKm0B,SAASgjB,YAAW,EAAGn3C,KAAKi0C,UAAS,GAAG,EAAG,MAAO,IAAGj0C,KAAK+tB,MAAM/tB,KAAK63C,aAAal4C,EAAEiC,IAAG,IAAKw3C,eAAe,WAAW,IAAIp5C,KAAK2zC,cAAc3zC,KAAK25C,eAAe,GAAG35C,KAAKg0C,eAAex0C,OAAO,MAAOkvC,eAAc1uC,KAAKi5C,cAAcj5C,KAAKm0B,SAASgjB,YAAW,EAAGn3C,KAAKi0C,UAAS,EAAGj0C,KAAK0zC,WAAU,OAAQ1zC,KAAK2zC,cAAa,EAAI,IAAG,GAAG3zC,KAAKg0C,eAAex0C,OAAO,YAAYQ,KAAK8zC,aAAa,EAAG,IAAI3X,GAAEn8B,KAAKg0C,eAAejV,OAAO,EAAE,GAAG,GAAGr9B,EAAEy6B,EAAE,GAAGn8B,KAAKs5C,aAAa,GAAG35C,EAAEw8B,EAAE,GAAGn8B,KAAKs5C,aAAa,EAAGt5C,MAAK8zC,aAAa3X,EAAE,GAAGn8B,KAAKk4C,YAAY,IAAIx2C,EAAE1B,KAAKk4C,YAAY,IAAIv4C,EAAEK,KAAKs5C,aAAa,GAAGnd,EAAE,GAAGn8B,KAAKs5C,aAAa,GAAGnd,EAAE,GAAGoB,sBAAsBv9B,KAAKg5B,QAAQ8V,eAAepS,QAAQ,SAASP,EAAEz6B,GAAG,MAAO,IAAGA,GAAG,GAAG1B,KAAK+tB,OAAO/tB,KAAK25C,cAAa,EAAG35C,KAAKm0B,SAASgjB,YAAW,EAAGn3C,KAAKi0C,UAAS,IAAI,GAAIhX,SAAS,WAAWj9B,KAAK25C,cAAa,EAAG35C,KAAKi0C,UAAS,GAAItX,UAAU,SAASR,EAAEz6B,EAAE/B,GAAG,GAAGK,KAAK0zC,UAAU,OAAM,CAAG,IAAG1zC,KAAK47B,GAAGhB,iBAAiB,GAAG,CAAC,GAAG,GAAG56B,KAAK+tB,KAAK,CAAC,GAAG/tB,KAAK47B,GAAGjB,SAAS,IAAI,MAAO36B,MAAK63C,aAAan2C,EAAE/B,IAAG,CAAG,IAAIiC,IAAGF,EAAE/B,GAAGgH,EAAE/E,EAAE,GAAG5B,KAAKs5C,aAAa,GAAGn7C,EAAEyD,EAAE,GAAG5B,KAAKs5C,aAAa,GAAGz0C,EAAE7E,KAAK45C,mBAAmBjzC,EAAExI,EAAG,OAAOyD,IAAG5B,KAAKs5C,aAAa,GAAGz0C,EAAE,GAAG7E,KAAKs5C,aAAa,GAAGz0C,EAAE,IAAI7E,KAAKu5C,iBAAiBv5C,KAAKs5C,aAAa13C,EAAEiD,IAAG,EAAG,MAAO7E,MAAK63C,aAAan2C,EAAE/B,IAAG,EAAG,OAAM,GAAI45C,iBAAiB,SAASpd,EAAEz6B,EAAE/B,GAAG,GAAIiC,GAAEuG,YAAYxI,EAAG,IAAGiC,EAAE,GAAG,CAAC5B,KAAKg0C,eAAejV,OAAO,EAAE/+B,KAAKg0C,eAAex0C,OAAQ,IAAImH,GAAEyB,gBAAgBzI,GAAGxB,EAAE,GAAGyD,EAAE,EAAE5B,KAAK8zC,aAAa9zC,KAAK+zC,UAAU/zC,KAAK+zC,QAAQ/zC,KAAK+zC,SAASlvC,EAAE7E,KAAK8zC,aAAajS,GAAG1F,EAAE,GAAGA,EAAE,IAAIsV,EAAE,EAAER,EAAEjxC,KAAK+zC,QAAQlkC,EAAE,EAAE1I,EAAE,CAAE,IAAGhJ,EAAE,EAAE,CAAC,IAAI,GAAIgT,GAAE,EAAEA,EAAEnR,KAAK+zC,QAAQ5iC,IAAI,CAAC,GAAIxB,GAAExR,EAAE,EAAE0G,CAAEA,IAAG1G,EAAEszC,GAAG9hC,CAAE,IAAIoiC,GAAEprC,EAAE,GAAGgJ,EAAEnK,EAAEmB,EAAE,GAAGgJ,CAAEkyB,GAAE,IAAIkQ,EAAElQ,EAAE,IAAIr8B,EAAExF,KAAKg0C,eAAen0C,MAAMgiC,EAAE,GAAGA,EAAE,GAAGh9B,EAAE1G,IAAI8yC,EAAE,EAAErvC,GAAG,EAAEiD,GAAGsC,EAAE,EAAEtC,EAAEA,EAAEA,GAAG,EAAEjD,EAAEA,GAAGiO,EAAE,GAAGhL,EAAEA,GAAG,EAAEjD,OAAQqvC,GAAE,EAAErvC,GAAG,EAAEiD,GAAGsC,EAAEtC,EAAEA,EAAEA,GAAG,EAAEjD,EAAEA,GAAGiO,EAAE,GAAGhL,EAAEA,GAAG,EAAEjD,EAAG,KAAI,GAAIuP,GAAE,EAAE8/B,EAAE9/B,EAAEA,IAAI,CAAC,GAAIxB,GAAExI,EAAEgK,EAAEhK,EAAE,EAAE0I,EAAE,EAAEhL,CAAEA,IAAGsC,GAAG,EAAEgK,EAAE,GAAGtB,CAAE,IAAIkiC,GAAEprC,EAAE,GAAGgJ,EAAEnK,EAAEmB,EAAE,GAAGgJ,CAAEkyB,GAAE,IAAIkQ,EAAElQ,EAAE,IAAIr8B,EAAExF,KAAKg0C,eAAen0C,MAAMgiC,EAAE,GAAGA,EAAE,GAAGh9B,EAAEsC,IAAInH,KAAKg0C,eAAen0C,MAAM6B,EAAE,GAAGA,EAAE,GAAG,EAAE,MAAMk4C,mBAAmB,SAASzd,EAAEz6B,GAAG,GAAI/B,GAAEgK,OAAO3J,KAAKk4C,YAAY,GAAG/b,EAAEn8B,KAAKk4C,YAAY,GAAGx2C,EAAE,EAAE,GAAGE,EAAE5B,KAAKw5C,kBAAkB75C,EAAEK,KAAKm4C,KAAKxxC,EAAEyN,WAAWxS,EAAE+H,OAAO3J,KAAKu4C,WAAW,GAAGv4C,KAAKu4C,WAAW,GAAG,EAAE,IAAI73C,MAAM,EAAE,GAAGvC,EAAEiW,WAAWxS,EAAE+H,OAAO3J,KAAK04C,SAAS,GAAG14C,KAAK04C,SAAS,GAAG,EAAE,IAAIh4C,MAAM,EAAE,EAAGiG,GAAE,IAAI3G,KAAK44C,SAASjyC,EAAE,IAAI3G,KAAK64C,SAAS16C,EAAE,IAAI6B,KAAK44C,SAASz6C,EAAE,IAAI6B,KAAK64C,QAAS,IAAIh0C,GAAE1G,EAAE,GAAGwI,EAAE,GAAGk7B,EAAE1jC,EAAE,GAAGwI,EAAE,GAAG8qC,EAAEtV,EAAE8U,EAAEvvC,CAAE,OAAOmD,GAAE7E,KAAK47B,GAAGjX,OAAOkd,EAAE7hC,KAAK47B,GAAGhX,QAAQzmB,EAAE,GAAG6B,KAAK47B,GAAGjX,MAAM8sB,GAAGzxC,KAAK47B,GAAGjX,MAAMxmB,EAAE,GAAGwI,EAAE,GAAG,IAAI8qC,GAAG9qC,EAAE,IAAIxI,EAAE,GAAG6B,KAAK47B,GAAGhX,OAAOqsB,GAAGjxC,KAAK47B,GAAGhX,OAAOzmB,EAAE,GAAGwI,EAAE,GAAG,IAAIsqC,GAAGtqC,EAAE,KAAK9B,EAAE7E,KAAK47B,GAAGjX,OAAOxmB,EAAE,GAAG6B,KAAK47B,GAAGjX,MAAM8sB,GAAGzxC,KAAK47B,GAAGjX,MAAMxmB,EAAE,GAAGwI,EAAE,GAAG,IAAI8qC,GAAG9qC,EAAE,IAAIsqC,EAAE,GAAGpP,EAAE7hC,KAAK47B,GAAGhX,QAAQzmB,EAAE,GAAG6B,KAAK47B,GAAGhX,OAAOqsB,GAAGjxC,KAAK47B,GAAGhX,OAAOzmB,EAAE,GAAGwI,EAAE,GAAG,IAAIsqC,GAAGtqC,EAAE,IAAI8qC,EAAE,IAAIA,EAAE,EAAER,EAAE,GAAGrqC,OAAO6qC,EAAER,IAAIpC,OAAO,aAAa2K,kBAAkB,SAASrd,EAAEz6B,GAAG,GAAI/B,GAAEqS,SAAS8D,kBAAkBqmB,EAAE,GAAGA,EAAE,GAAG,GAAGz6B,EAAG/B,GAAEqS,SAAShS,KAAKo4C,WAAWz4C,GAAGK,KAAKq4C,MAAM5U,MAAMrH,KAAKz8B,EAAG,IAAIiC,GAAEkU,kBAAkB9V,KAAK47B,GAAGjX,MAAM,EAAE3kB,KAAK47B,GAAGhX,OAAO,EAAE,EAAG,OAAO5kB,MAAKq4C,MAAM5U,MAAMR,SAASrhC,GAAG5B,KAAKq4C,MAAM5U,MAAMJ,MAAMrjC,KAAKqjC,MAAMrjC,KAAKqjC,MAAM,GAAGrjC,KAAKq4C,MAAM5U,MAAMR,SAASjjC,KAAKm0B,SAAS0lB,yBAAyB75C,KAAKq4C,MAAM5U,MAAM9qB,KAAK0gC,mBAAmB,WAAW,GAAIld,GAAEnqB,SAAS8D,kBAAkB9V,KAAKk4C,YAAY,GAAGl4C,KAAKk4C,YAAY,GAAG,GAAGl4C,KAAKm4C,IAAKhc,GAAEnqB,SAAShS,KAAKo4C,WAAWjc,GAAGn8B,KAAKq4C,MAAM5U,MAAMrH,KAAKD,EAAG,IAAIz6B,GAAEoU,kBAAkB9V,KAAK47B,GAAGjX,MAAM,EAAE3kB,KAAK47B,GAAGhX,OAAO,EAAE,EAAG5kB,MAAKq4C,MAAM5U,MAAMR,SAASvhC,GAAG1B,KAAKq4C,MAAM5U,MAAMJ,MAAMrjC,KAAKqjC,MAAMrjC,KAAKqjC,MAAM,GAAGrjC,KAAKq4C,MAAM5U,MAAMR,SAASjjC,KAAKm0B,SAAS0lB,0BAA0B/c,OAAO,WAAW98B,KAAKq4C,MAAM,GAAIv7B,mBAAkB9c,KAAKk4C,aAAa,EAAE,GAAGl4C,KAAKm4C,IAAI7nC,gBAAgBtQ,KAAK+7B,WAAU,EAAG/7B,KAAKu4C,aAAav4C,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAGrjC,KAAKm0B,SAASqkB,UAAU,GAAGx4C,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAGrjC,KAAKm0B,SAASskB,WAAW,GAAGz4C,KAAK04C,UAAU14C,KAAKu4C,WAAW,GAAGv4C,KAAKm0B,SAASqkB,SAASx4C,KAAKu4C,WAAW,GAAGv4C,KAAKm0B,SAASskB,WAAWz4C,KAAKqjC,MAAM,CAAE,IAAIlH,GAAEn8B,KAAK47B,GAAGjX,KAAM3kB,MAAK85C,aAAa,CAAE,IAAIp4C,GAAE1B,KAAK47B,GAAGhX,OAAO5kB,KAAK85C,YAAa95C,MAAKqjC,MAAMzgC,KAAKmC,IAAI/E,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAGrjC,KAAKm0B,SAASqkB,SAASrc,EAAEn8B,KAAKm0B,SAASyhB,MAAMvS,MAAM,GAAGrjC,KAAKm0B,SAASskB,UAAU/2C,GAAG1B,KAAK24C,SAAS,EAAE/1C,KAAKqC,IAAIjF,KAAKm0B,SAASqkB,SAASrc,EAAEn8B,KAAKm0B,SAASskB,UAAU/2C,GAAG1B,KAAK44C,SAAS54C,KAAK47B,GAAGjX,MAAM,EAAE,GAAG3kB,KAAK64C,SAAS74C,KAAK47B,GAAGhX,OAAO,EAAE,IAAIqX,KAAK,SAASE,GAAG,GAAIz6B,GAAEy6B,EAAE4d,UAAW,IAAGr4C,GAAGy6B,EAAE6d,oBAAoBC,QAAQz2C,IAAI,sBAAsB24B,EAAE+d,WAAW,EAAE,EAAE,EAAE,GAAG/d,EAAEge,MAAMhe,EAAEie,iBAAiBje,EAAEke,iBAAiBle,EAAEme,oBAAoB,GAAGt6C,KAAK+7B,UAAU,CAAC,GAAIp8B,GAAEK,KAAK47B,GAAGjX,MAAM/iB,EAAE5B,KAAK47B,GAAGhX,MAAOuX,GAAE5e,SAAS,EAAE,EAAE5d,EAAEiC,GAAG5B,KAAKq4C,MAAM1U,WAAWT,eAAeljC,KAAKq4C,MAAM1U,WAAWL,MAAM,EAAE3jC,EAAE,EAAEiC,EAAE,MAAM,MAAM5B,KAAKq4C,MAAM3U,KAAKR,eAAeljC,KAAKq4C,MAAM3U,KAAK7K,OAAO,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG74B,KAAKq5C,oBAAqB,IAAI1yC,GAAE3G,KAAKq4C,MAAM5U,MAAM9qB,GAAI3Y,MAAKyzC,gBAAgBzzC,KAAKyzC,eAAe9sC,GAAG3G,KAAKm0B,SAAS4V,OAAO/pC,KAAKq4C,MAAMh7B,iBAAiBrd,KAAKq4C,MAAM/6B,iBAAiB,EAAE,EAAE3d,EAAEiC,OAAOkzC,aAAar3C,WAAW88C,MAAM,SAASpe,EAAEz6B,EAAE/B,GAAGK,KAAK+0C,OAAM,CAAG,IAAInzC,GAAExC,YAAY+8B,GAAGx1B,EAAE/E,EAAEpC,OAAOrB,EAAE,KAAK0G,EAAE,CAAE,MAAKA,GAAG8B,IAAIxI,EAAEyD,EAAEiD,KAAKtF,MAAM,KAAKpB,EAAEqB,OAAO,IAAI,CAAC,GAAIqiC,GAAE9R,SAAS5xB,EAAE,GAAI,MAAK,GAAG0jC,GAAG,CAAC,GAAI4P,GAAE1hB,SAAS5xB,EAAE,GAAI,MAAK,EAAEszC,GAAGA,GAAG5P,GAAGh9B,GAAG8B,IAAIxI,EAAEyD,EAAEiD,KAAKtF,MAAM,KAAKpB,EAAEqB,OAAO,IAAI,CAAC,GAAIyxC,GAAElhB,SAAS5xB,EAAE,GAAI,MAAK,GAAG8yC,GAAGpsC,GAAG8B,IAAIxI,EAAEyD,EAAEiD,KAAKtF,MAAM,KAAKpB,EAAEqB,OAAO,IAAI,CAAC,GAAIqQ,IAAG,EAAE,EAAE,EAAG,IAAGA,EAAE,GAAGigB,WAAW3xB,EAAE,IAAI0R,EAAE,GAAGigB,WAAW3xB,EAAE,IAAI0R,EAAE,GAAGigB,WAAW3xB,EAAE,MAAM0G,GAAG8B,IAAIxI,EAAEyD,EAAEiD,KAAKtF,MAAM,KAAKpB,EAAEqB,OAAO,IAAI,CAAC,GAAI2H,IAAG,EAAE,EAAE,EAAGA,GAAE,GAAG2oB,WAAW3xB,EAAE,IAAIgJ,EAAE,GAAG2oB,WAAW3xB,EAAE,IAAIgJ,EAAE,GAAG2oB,WAAW3xB,EAAE,GAAI,IAAIgT,GAAE,GAAI1Q,OAAMohC,EAAG,IAAGl7B,EAAE9B,EAAE,IAAI,GAAI8K,GAAE,EAAEkyB,EAAElyB,IAAIA,EAAE,CAAC,GAAIoiC,GAAE,GAAImC,aAAa,IAAGrvC,GAAG8B,EAAE,MAAO,IAAGxI,EAAEyD,EAAEiD,KAAKtF,MAAM,KAAKpB,EAAEqB,OAAO,GAAG,MAAO,IAAGuyC,EAAEH,GAAG7hB,SAAS5xB,EAAE,IAAI4zC,EAAEH,IAAI,EAAE,MAAO,IAAGG,EAAEoC,YAAYpkB,SAAS5xB,EAAE,IAAI4zC,EAAEoC,YAAY,IAAIpC,EAAEoC,aAAatS,EAAE,MAAO,KAAI,GAAIr8B,GAAE,EAAE,EAAEA,IAAIA,EAAE,GAAGusC,EAAEqC,gBAAgB5uC,GAAGuqB,SAAS5xB,EAAEqH,EAAE,IAAIusC,EAAEqC,gBAAgB5uC,GAAG,IAAIusC,EAAEqC,gBAAgB5uC,IAAIq8B,EAAE,MAAOkQ,GAAEsC,cAAcvkB,WAAW3xB,EAAE,IAAI4zC,EAAEuC,OAAOxkB,WAAW3xB,EAAE,IAAI4zC,EAAEwC,IAAIxvC,IAAI,GAAG+qB,WAAW3xB,EAAE,IAAI4zC,EAAEwC,IAAIxvC,IAAI,GAAG+qB,WAAW3xB,EAAE,IAAI4zC,EAAEwC,IAAIxvC,IAAI,GAAG+qB,WAAW3xB,EAAE,KAAK4zC,EAAEwC,IAAItvC,IAAI,GAAG6qB,WAAW3xB,EAAE,KAAK4zC,EAAEwC,IAAItvC,IAAI,GAAG6qB,WAAW3xB,EAAE,KAAK4zC,EAAEwC,IAAItvC,IAAI,GAAG6qB,WAAW3xB,EAAE,KAAK4zC,EAAE8C,QAAO,CAAG,KAAI,GAAIx5B,GAAE,EAAE,EAAEA,IAAIA,EAAE,GAAG02B,EAAEqC,gBAAgB/4B,IAAI,EAAE,CAAC02B,EAAE8C,QAAO,CAAG,OAAM1jC,EAAExB,GAAGoiC,MAAM,CAAC,IAAI,GAAII,GAAE,EAAEpsC,EAAE8J,EAAE,GAAGlN,EAAE,EAAEoD,EAAEkrC,GAAGtuC,IAAIoD,GAAG,CAAE,KAAI,GAAIjB,IAAG+K,EAAE,GAAGnO,GAAG,EAAEmO,EAAE,GAAG2qC,GAAG3qC,EAAE,GAAGlQ,GAAG,EAAEkQ,EAAE,GAAGxM,EAAE,GAAI8Y,UAASrX,EAAE01C,EAAE,IAAI11C,EAAEpD,EAAEmO,EAAE,GAAG2qC,EAAE76C,EAAEkQ,EAAE,GAAG,IAAInG,EAAErG,EAAEkC,KAAKk1C,EAAEp3C,EAAEkZ,OAAO1X,EAAE,EAAElC,EAAEkC,EAAEA,IAAI,IAAI,GAAI61C,GAAE93C,KAAKU,IAAI,EAAEuB,GAAGwW,EAAE,EAAEq/B,EAAEr/B,EAAEA,IAAI,CAAC,GAAI02B,GAAE,GAAImC,aAAanC,GAAEH,GAAGO,EAAE,EAAEJ,EAAEoC,YAAYhC,EAAE,EAAEvvC,KAAKK,KAAKkvC,EAAE,GAAG,EAAE,GAAGxvC,EAAE,EAAEkC,IAAIktC,EAAE8C,QAAO,EAAI,KAAI,GAAIrvC,GAAE,EAAE,EAAEA,IAAIA,EAAEusC,EAAEqC,gBAAgB5uC,GAAGX,GAAGlC,EAAE,EAAE,GAAG,EAAEwvC,EAAE,GAAG3sC,EAAE,GAAG,CAAE,IAAGusC,EAAEsC,cAAcpD,EAAEkB,EAAE,EAAE,CAAC,GAAIwI,GAAExI,EAAE,EAAEyI,EAAEzpC,EAAE4gC,EAAEoC,aAAa0G,EAAED,EAAErG,IAAIxvC,IAAI,IAAI61C,EAAErG,IAAItvC,IAAI,GAAG21C,EAAErG,IAAIxvC,IAAI,IAAI,EAAE+1C,EAAEF,EAAErG,IAAIxvC,IAAI,IAAI61C,EAAErG,IAAItvC,IAAI,GAAG21C,EAAErG,IAAIxvC,IAAI,IAAI,CAAE,IAAG41C,EAAE5I,EAAEwC,IAAI,GAAIp4B,UAASy+B,EAAErG,IAAIxvC,IAAI,GAAG+1C,EAAE,IAAID,EAAED,EAAErG,IAAItvC,IAAI,GAAG,IAAI,GAAG01C,EAAE5I,EAAEwC,IAAI,GAAIp4B,UAAS0+B,EAAEC,EAAE,GAAGF,EAAErG,IAAItvC,KAAK,GAAG01C,EAAE5I,EAAEwC,IAAI,GAAIp4B,SAAQy+B,EAAErG,IAAIxvC,KAAK81C,EAAEC,EAAE,IAAI,GAAGH,IAAI5I,EAAEwC,IAAI,GAAIp4B,UAAS0+B,EAAED,EAAErG,IAAIxvC,IAAI,GAAG,IAAI61C,EAAErG,IAAItvC,IAAI,GAAG61C,EAAE,IAAK,IAAIC,GAAEhJ,EAAEwC,IAAIh4B,OAAOvW,EAAE+rC,EAAEwC,IAAIhvC,KAAKgE,EAAEuC,cAAc1B,SAASV,EAAE1D,GAAG,IAAIg1C,EAAEzwC,SAASkwC,EAAEM,EAAGhJ,GAAEuC,OAAO1xC,KAAKC,IAAIm4C,EAAE,KAAKzxC,EAAE,IAAI3G,KAAKC,IAAIm4C,EAAE,KAAKzxC,EAAE,IAAI3G,KAAKC,IAAIm4C,EAAE,KAAKzxC,EAAE,GAAG,EAAE,MAAOwoC,GAAEwC,IAAI,GAAIp4B,UAAS,EAAE,EAAE,IAAI,EAAE,EAAE,IAAI41B,EAAEuC,OAAO,CAAEnjC,GAAEghC,GAAGJ,EAAEI,KAAKnyC,KAAKg1C,WAAWnT,EAAE7hC,KAAKi1C,UAAUxD,EAAEzxC,KAAKm1C,SAASlE,EAAEjxC,KAAKqjC,MAAMxzB,EAAE7P,KAAK8b,OAAO3U,EAAEnH,KAAKk1C,MAAM/jC,QAAQ61B,QAAQ,SAAS7K,GAAG,GAAIz6B,GAAE,IAAK,KAAI,GAAI/B,KAAKK,MAAKk1C,MAAMxzC,EAAE1B,KAAKk1C,MAAMv1C,GAAG+B,EAAE9C,MAAM8C,EAAE9C,IAAIq8C,OAAO,KAAKv5C,EAAE9C,IAAI,MAAM8C,EAAEkzC,OAAOzY,EAAEz6B,EAAEkzC,MAAMlzC,EAAEkzC,KAAK,KAAM50C,MAAK+0C,OAAM,EAAG/0C,KAAKg1C,WAAW,EAAEh1C,KAAKi1C,UAAU,GAAGj1C,KAAKk1C,MAAM,KAAKl1C,KAAKvB,IAAI,KAAKuB,KAAKm1C,SAAS,EAAEn1C,KAAKqjC,OAAO,EAAE,EAAE,IAAIjH,KAAK,SAASD,EAAEz6B,EAAE/B,GAAG,MAAOw8B,OAAOn8B,MAAKu6C,MAAMpe,EAAEz6B,EAAE/B,IAAG,GAAIsiC,GAAIA,WAAU,MAAOjiC,MAAKg1C,YAAY,GAAGj7B,GAAIA,QAAO,GAAIoiB,GAAEn8B,KAAKi1C,SAAU,OAAO,GAAE9Y,EAAE,KAAKn8B,KAAKk1C,MAAM/Y,IAAI+e,OAAO,SAAS/e,GAAG,GAAIz6B,GAAEy6B,EAAEgY,WAAY,OAAO,GAAEzyC,EAAE,KAAK1B,KAAKk1C,MAAMxzC,IAAIy5C,MAAM,SAAShf,EAAEz6B,GAAG,GAAI/B,GAAEw8B,EAAEiY,gBAAgB1yC,EAAG,OAAO,GAAE/B,EAAE,KAAKK,KAAKk1C,MAAMv1C,KAAK+1C,iBAAiBj4C,WAAWu6C,wBAAwB,SAAS7b,GAAG,OAAOn8B,KAAKw3C,SAASx3C,KAAK6f,OAAO,IAAK,GAAE,GAAIne,GAAEkB,KAAK4B,MAAM23B,EAAE,GAAGA,EAAE,GAAI,GAAEz6B,IAAIA,EAAE,EAAEkB,KAAK89B,GAAGh/B,EAAG,IAAI/B,GAAEiD,KAAKmC,IAAInC,KAAKsB,KAAKi4B,EAAE,IAAIv5B,KAAK89B,GAAG,EAAE,KAAK9+B,EAAEgB,KAAKoB,IAAItC,GAAGiF,EAAE/D,KAAKoB,IAAIrE,GAAGxB,EAAEwI,EAAEA,EAAE9B,EAAE,GAAIpE,OAAM,EAAG,OAAOoE,GAAE,GAAG,EAAEjC,KAAKO,KAAK,EAAEP,KAAK89B,IAAI77B,EAAE,GAAGjC,KAAKO,KAAK,EAAEP,KAAK89B,IAAI9+B,EAAEgB,KAAKO,KAAKwD,EAAExI,GAAG0G,EAAE,GAAGjC,KAAKO,KAAK,GAAG,EAAEP,KAAK89B,MAAM,GAAG,EAAE/5B,GAAG9B,EAAE,GAAGjC,KAAKO,KAAK,EAAEP,KAAK89B,IAAI99B,KAAKO,KAAKwD,EAAExI,GAAGyE,KAAKgB,IAAIlC,GAAGmD,EAAE,GAAGjC,KAAKO,KAAK,GAAGP,KAAK89B,IAAI99B,KAAKoB,IAAI,EAAEtC,KAAKiF,EAAExI,GAAG0G,EAAE,GAAGjC,KAAKO,KAAK,GAAGP,KAAK89B,IAAI9+B,GAAG,GAAG,EAAE+E,GAAG/D,KAAKO,KAAKwD,EAAExI,GAAG0G,EAAE,GAAGjC,KAAKO,KAAK,GAAG,EAAEP,KAAK89B,MAAM,EAAE,EAAE/5B,EAAE,EAAExI,GAAG0G,EAAE,GAAGjC,KAAKO,KAAK,GAAGP,KAAK89B,KAAK,GAAG,EAAE/5B,GAAG/D,KAAKO,KAAKwD,EAAExI,GAAGyE,KAAKgB,IAAIlC,GAAGmD,EAAE,GAAGjC,KAAKO,KAAK,GAAGP,KAAK89B,MAAM/5B,EAAExI,GAAGyE,KAAKgB,IAAI,EAAElC,GAAGmD,CAAE,KAAK,GAAE,IAAK,GAAE,GAAIA,GAAE,GAAIpE,OAAM,EAAG,OAAOoE,GAAE,GAAGs3B,EAAE,GAAGA,EAAE,GAAGt3B,EAAE,GAAGs3B,EAAE,GAAGA,EAAE,GAAGt3B,EAAE,GAAGs3B,EAAE,GAAGA,EAAE,GAAGt3B,EAAE,GAAGs3B,EAAE,GAAGt3B,EAAE,GAAGs3B,EAAE,GAAGt3B,EAAE,GAAG,EAAEA,EAAE,UAAUyzC,UAAU,SAASnc,GAAG,GAAIz6B,GAAE,GAAI7C,eAAe6C,GAAEzC,KAAK,MAAMk9B,EAAE,aAAY,GAAIz6B,EAAExC,MAAO,IAAIS,GAAE+B,EAAE05C,WAAYp7C,MAAK0kB,OAAO,KAAM,IAAI9iB,GAAEmuB,SAASpwB,EAAE07C,qBAAqB,YAAY,GAAGC,aAAa,UAAWC,OAAM35C,IAAI,GAAGA,IAAI5B,KAAK0kB,OAAO,MAAO,IAAI/d,GAAEhH,EAAE07C,qBAAqB,WAAW,EAAG,IAAGr7C,KAAK6f,KAAKlZ,EAAE20C,aAAa,UAAUt7C,KAAK6f,OAAQ7f,MAAKw3C,UAAU,OAAM,CAAG,IAAIr5C,GAAE,IAAK,QAAO6B,KAAKw3C,SAASx3C,KAAK6f,OAAO,IAAK,GAAE,IAAK,GAAE,IAAK,GAAE,GAAIhb,GAAElF,EAAE07C,qBAAqB,QAAQ,GAAGxZ,EAAEliC,EAAE07C,qBAAqB,SAAS,GAAG5J,EAAE9xC,EAAE07C,qBAAqB,QAAQ,EAAG,IAAGl9C,EAAEwB,EAAE07C,qBAAqB,QAAQ,GAAGr7C,KAAKw4C,SAASzoB,SAASlrB,EAAEy2C,aAAa,UAAUt7C,KAAKy4C,UAAU1oB,SAASlrB,EAAEy2C,aAAa,WAAWt7C,KAAKw7C,OAAOzrB,SAASlrB,EAAEy2C,aAAa,iBAAiBt7C,KAAKy7C,UAAUz7C,KAAKw7C,OAAO,GAAGx7C,KAAKw3C,SAASx3C,KAAK6f,QAAQ7f,KAAKy7C,UAAU,GAAGhsB,OAAOoS,EAAE6Z,WAAW,GAAGC,UAAUp8C,MAAM,KAAKkwB,OAAOjwB,OAAOQ,KAAKw7C,OAAO,MAAOx7C,MAAK47C,OAAQ,KAAI,GAAI3K,GAAE,EAAEA,EAAEjxC,KAAKw7C,OAAOvK,IAAIjxC,KAAK47C,KAAK3K,GAAGnhB,WAAWL,OAAOwhB,GAAI,IAAGxhB,OAAOgiB,EAAEiK,WAAW,GAAGC,UAAUp8C,MAAM,KAAKkwB,OAAOjwB,OAAOQ,KAAKw7C,OAAO,MAAOx7C,MAAK67C,OAAQ,KAAI,GAAI5K,GAAE,EAAEA,EAAEjxC,KAAKw7C,OAAOvK,IAAIjxC,KAAK67C,KAAK5K,GAAGnhB,WAAWL,OAAOwhB,GAAI,MAAM,KAAK,GAAE,GAAIpsC,GAAElF,EAAE07C,qBAAqB,QAAQ,EAAGl9C,GAAEwB,EAAE07C,qBAAqB,QAAQ,GAAGr7C,KAAKw4C,SAASzoB,SAASlrB,EAAEy2C,aAAa,UAAUt7C,KAAKy4C,UAAU1oB,SAASlrB,EAAEy2C,aAAa,WAAWt7C,KAAKw7C,OAAOzrB,SAASlrB,EAAEy2C,aAAa,iBAAiBt7C,KAAKy7C,UAAUz7C,KAAKw7C,MAAO,MAAM,SAAQ,OAAO,OAAOx7C,KAAK41C,OAAO51C,KAAK41C,MAAM5O,QAAQhnC,KAAK87C,cAAc97C,KAAK41C,MAAMxZ,KAAKj+B,EAAEG,YAAY0B,KAAKw4C,SAASx4C,KAAKy4C,WAAWz4C,KAAKa,KAAKs7B,EAAEn8B,KAAK61C,WAAW,EAAE71C,KAAK81C,SAAS,GAAI14B,YAAWpd,KAAK+1C,UAAU,EAAE/1C,KAAKg2C,UAAUh2C,KAAKq2C,cAAcr2C,KAAKs2C,oBAAoBt2C,KAAKu2C,oBAAoBv2C,KAAKw2C,eAAex2C,KAAKy2C,YAAW,EAAGz2C,KAAK02C,aAAY,EAAG12C,KAAK83C,UAAU,EAAE,EAAE,GAAG93C,KAAK+3C,YAAY/3C,KAAK+3C,SAAS/3C,KAAKg4C,wBAAwBh4C,KAAK83C,UAAU,MAAM93C,KAAK82C,UAAU92C,KAAK82C,SAAS9P,UAAUhnC,KAAKw3C,SAASx3C,KAAK6f,OAAO,IAAK,GAAE,GAAIhQ,GAAErR,YAAY,yBAAyB2I,EAAE3I,YAAY,uBAAuB2S,EAAE,GAAIwb,YAAW3sB,KAAKwe,IAAI3O,IAAI1I,GAAI3D,KAAI2N,EAAE3N,KAAKxD,KAAK82C,SAAS3lC,CAAE,MAAM,KAAK,GAAE,GAAItB,GAAErR,YAAY,yBAAyB2I,EAAE3I,YAAY,2BAA2B2S,EAAE,GAAIwb,YAAW3sB,KAAKwe,IAAI3O,IAAI1I,GAAI3D,KAAI2N,EAAE3N,KAAKxD,KAAK82C,SAAS3lC,CAAE,MAAM,KAAK,GAAE,GAAItB,GAAErR,YAAY,yBAAyB2I,EAAE3I,YAAY,0BAA0B2S,EAAE,GAAIwb,YAAW3sB,KAAKwe,IAAI3O,IAAI1I,GAAI3D,KAAI2N,EAAE3N,KAAKxD,KAAK82C,SAAS3lC,CAAE,MAAM,KAAK,GAAE,GAAItB,GAAErR,YAAY,yBAAyB2I,EAAE3I,YAAY,yBAAyB2S,EAAE,GAAIwb,YAAW3sB,KAAKwe,IAAI3O,IAAI1I,GAAI3D,KAAI2N,EAAE3N,KAAKxD,KAAK82C,SAAS3lC,CAAE,MAAM,SAAQnR,KAAK82C,SAAS,GAAInqB,YAAW3sB,KAAK+7C,UAAU,GAAIxoB,mBAAkBvzB,KAAK82C,UAAU92C,KAAKi3C,eAAe3mC,gBAAgBtQ,KAAKk3C,yBAAyB5mC,gBAAgBtQ,KAAKg8C,SAASh8C,KAAK41C,MAAMvS,MAAM,GAAGrjC,KAAKw4C,UAAU,EAAEx4C,KAAKi8C,SAASj8C,KAAKg8C,QAAQh8C,KAAKw4C,SAASx4C,KAAKk8C,WAAWl8C,KAAK41C,MAAMvS,MAAM,GAAGrjC,KAAKy4C,WAAW,EAAEz4C,KAAKm8C,OAAOn8C,KAAKk8C,UAAUl8C,KAAKy4C,UAAUz4C,KAAKg8C,SAASh8C,KAAK41C,MAAMvS,MAAM,GAAGrjC,KAAKi8C,UAAUj8C,KAAK41C,MAAMvS,MAAM,GAAGrjC,KAAKk8C,WAAWl8C,KAAK41C,MAAMvS,MAAM,GAAGrjC,KAAKm8C,QAAQn8C,KAAK41C,MAAMvS,MAAM,GAAGrjC,KAAK41C,MAAMb,OAAO/0C,KAAKo8C,cAAc7E,UAAU,WAAW,GAAIpb,GAAEn+B,SAAS2zC,cAAc,SAAUxV,GAAEvX,OAAO,GAAGuX,EAAExX,MAAM,EAAG,IAAIjjB,GAAEy6B,EAAEjD,WAAW,KAAMx3B,GAAE26C,OAAO36C,EAAE46C,YAAY56C,EAAE66C,OAAO,EAAE,GAAG76C,EAAE86C,OAAO,GAAG,GAAG96C,EAAE86C,OAAO,GAAG,IAAI96C,EAAE86C,OAAO,EAAE,IAAI96C,EAAE+6C,YAAY/6C,EAAEg7C,OAAOh7C,EAAEi7C,YAAY,gBAAgBj7C,EAAEk7C,QAAQ,OAAOl7C,EAAEm7C,SAAS,QAAQn7C,EAAEo7C,WAAW,EAAEp7C,EAAE26C,OAAO36C,EAAEq7C,UAAUr7C,EAAE26C,OAAO36C,EAAEq7C,UAAUr7C,EAAE26C,OAAO36C,EAAEs7C,UAAU,UAAU,EAAE,EAAE,UAAU,WAAW,YAAYt7C,EAAE26C,OAAO36C,EAAEyhC,UAAU,UAAU,IAAIzhC,EAAE26C,OAAOtK,EAAErwC,EAAEu7C,qBAAqB,UAAU,mBAAmB,EAAE,UAAU,mBAAmB,WAAWlL,EAAEmL,aAAa,EAAE,0BAA0BnL,EAAEmL,aAAa,EAAE,0BAA0Bx7C,EAAEy7C,UAAUpL,EAAErwC,EAAEi7C,YAAY,UAAUj7C,EAAE07C,UAAU,mBAAmB17C,EAAEk7C,QAAQ,QAAQl7C,EAAEm7C,SAAS,QAAQn7C,EAAEo7C,WAAW,EAAEp7C,EAAEs7C,UAAU,UAAU,EAAE,EAAE,UAAU,WAAW,YAAYt7C,EAAE46C,YAAY56C,EAAE66C,OAAO,UAAU,WAAW76C,EAAEyhC,UAAU,IAAI,oBAAoBzhC,EAAE0hC,OAAO,GAAG1hC,EAAE2hC,MAAM,kBAAkB,GAAG3hC,EAAE27C,IAAI,EAAE,EAAE,UAAU,sBAAsB,mBAAmB,GAAG37C,EAAE2hC,MAAM,kBAAkB,GAAG3hC,EAAE0hC,OAAO,GAAG1hC,EAAEyhC,UAAU,KAAK,qBAAqBzhC,EAAEyhC,UAAU,IAAI,oBAAoBzhC,EAAE0hC,OAAO,GAAG1hC,EAAE2hC,MAAM,kBAAkB,GAAG3hC,EAAE27C,IAAI,EAAE,EAAE,SAAS,kBAAkB,mBAAmB,GAAG37C,EAAE2hC,MAAM,kBAAkB,GAAG3hC,EAAE0hC,OAAO,GAAG1hC,EAAEyhC,UAAU,KAAK,qBAAqBzhC,EAAE+6C,YAAY/6C,EAAE47C,OAAO57C,EAAE67C,SAAS77C,EAAEq7C,UAAUr7C,EAAE26C,OAAO36C,EAAEy7C,UAAU,UAAUz7C,EAAEi7C,YAAY,UAAUj7C,EAAE07C,UAAU,kBAAkB17C,EAAEk7C,QAAQ,OAAOl7C,EAAEm7C,SAAS,QAAQn7C,EAAEo7C,WAAW,EAAEp7C,EAAE46C,YAAY56C,EAAE66C,OAAO,UAAU,WAAW76C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE+6C,YAAY/6C,EAAE47C,OAAO57C,EAAE67C,SAAS77C,EAAEq7C,UAAUr7C,EAAE26C,OAAO36C,EAAEy7C,UAAU,UAAUz7C,EAAEi7C,YAAY,UAAUj7C,EAAE07C,UAAU,kBAAkB17C,EAAEk7C,QAAQ,OAAOl7C,EAAEm7C,SAAS,QAAQn7C,EAAEo7C,WAAW,EAAEp7C,EAAE46C,YAAY56C,EAAE66C,OAAO,UAAU,WAAW76C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE+6C,YAAY/6C,EAAE47C,OAAO57C,EAAE67C,SAAS77C,EAAEq7C,UAAUr7C,EAAE26C,OAAO36C,EAAEy7C,UAAU,UAAUz7C,EAAEi7C,YAAY,UAAUj7C,EAAE07C,UAAU,kBAAkB17C,EAAEk7C,QAAQ,OAAOl7C,EAAEm7C,SAAS,QAAQn7C,EAAEo7C,WAAW,EAAEp7C,EAAE46C,YAAY56C,EAAE66C,OAAO,UAAU,WAAW76C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE86C,OAAO,UAAU,WAAW96C,EAAE+6C,YAAY/6C,EAAE47C,OAAO57C,EAAE67C,SAAS77C,EAAEq7C,UAAUr7C,EAAE26C,OAAOtK,EAAErwC,EAAE87C,qBAAqB,UAAU,UAAU,SAAS,WAAWzL,EAAEmL,aAAa,EAAE,0BAA0BnL,EAAEmL,aAAa,EAAE,0BAA0Bx7C,EAAEy7C,UAAUpL,EAAErwC,EAAEi7C,YAAY,UAAUj7C,EAAE07C,UAAU,mBAAmB17C,EAAEk7C,QAAQ,QAAQl7C,EAAEm7C,SAAS,QAAQn7C,EAAEo7C,WAAW,EAAEp7C,EAAEs7C,UAAU,UAAU,EAAE,EAAE,UAAU,WAAW,WAAWt7C,EAAE46C,YAAY56C,EAAE66C,OAAO,UAAU,WAAW76C,EAAEyhC,UAAU,IAAI,oBAAoBzhC,EAAE0hC,OAAO,GAAG1hC,EAAE2hC,MAAM,kBAAkB,GAAG3hC,EAAE27C,IAAI,EAAE,EAAE,UAAU,sBAAsB,mBAAmB,GAAG37C,EAAE2hC,MAAM,kBAAkB,GAAG3hC,EAAE0hC,OAAO,GAAG1hC,EAAEyhC,UAAU,KAAK,qBAAqBzhC,EAAEyhC,UAAU,IAAI,oBAAoBzhC,EAAE0hC,OAAO,GAAG1hC,EAAE2hC,MAAM,kBAAkB,GAAG3hC,EAAE27C,IAAI,EAAE,EAAE,SAAS,kBAAkB,mBAAmB,GAAG37C,EAAE2hC,MAAM,kBAAkB,GAAG3hC,EAAE0hC,OAAO,GAAG1hC,EAAEyhC,UAAU,KAAK,qBAAqBzhC,EAAE+6C,YAAY/6C,EAAE47C,OAAO57C,EAAE67C,SAAS77C,EAAEq7C,UAAUr7C,EAAEq7C,UAAUr7C,EAAEq7C,UAAUr7C,EAAEq7C,SAAU,IAAIp9C,GAAE,GAAIknB,OAAMjlB,EAAEu6B,EAAEshB,UAAU,YAAa99C,GAAEogB,IAAIne,CAAE,IAAI+E,GAAE3G,IAAKL,GAAE6kB,OAAO,WAAW,GAAI2X,IAAG9X,gBAAe,EAAGb,UAAU7c,EAAE6X,GAAGk/B,QAAQh6B,UAAU/c,EAAE6X,GAAGk/B,QAAS/2C,GAAE2wC,MAAM,GAAIvqB,cAAapmB,EAAE6X,GAAG7e,EAAEw8B,GAAI,IAAIh+B,GAAE6B,KAAKwe,GAAGu7B,UAAWE,SAAQz2C,IAAIrF,IAAIw/C,YAAY,SAASxhB,GAAG,IAAI,GAAIz6B,IAAG8hB,UAAUxjB,KAAKwe,GAAGiF,OAAOC,UAAU1jB,KAAKwe,GAAGiF,OAAOY,gBAAe,GAAI1kB,EAAE,GAAIc,OAAM07B,EAAE38B,QAAQoC,EAAE,EAAEA,EAAEu6B,EAAE38B,SAASoC,EAAEjC,EAAEiC,GAAG,GAAImrB,cAAa/sB,KAAKwe,GAAG2d,EAAEv6B,GAAGF,EAAG,IAAIiF,IAAG2kC,SAAS3rC,EAAG,OAAOgH,IAAGm1C,aAAa,SAAS3f,GAAG,GAAGA,EAAE,CAAC,IAAI,GAAIz6B,GAAE,EAAEA,EAAEy6B,EAAEmP,SAAS9rC,SAASkC,EAAEy6B,EAAEmP,SAAS5pC,GAAGslC,SAAU7K,GAAEmP,SAAS,OAAOsS,aAAa,SAASzhB,GAAG,IAAIA,EAAEv9B,IAAI,CAAC,IAAI,GAAI8C,GAAE1B,KAAKL,EAAEK,KAAKa,KAAK,IAAIs7B,EAAEyV,GAAGhwC,EAAE,GAAInB,OAAMkG,EAAE,EAAEA,GAAG3G,KAAKy7C,UAAU90C,IAAI/E,EAAE/B,KAAK,GAAIqB,iBAAgBvB,EAAE,IAAIgH,EAAE,IAAI3G,KAAK0kB,QAAS,IAAIvmB,GAAE,GAAIiD,mBAAkBQ,EAAE,WAAWF,EAAE00C,0BAA0B10C,EAAE80C,YAAY32C,KAAKs8B,IAAKA,GAAEv9B,IAAIT,EAAEA,EAAEe,SAAS2+C,iBAAiB,SAAS1hB,EAAEz6B,GAAG,GAAI/B,IAAGm+C,QAAO,EAAGC,OAAO5hB,EAAEyY,MAAK,GAAG,EAAI,IAAG,GAAGzY,EAAEmY,OAAO,MAAO30C,EAAE,KAAI+B,EAAE,CAAC,GAAIE,GAAE5B,KAAK81C,SAAS53B,cAAcie,EAAEoY,IAAIxvC,IAAIo3B,EAAEoY,IAAItvC,IAAK,IAAGrD,GAAGmkC,oBAAoB,MAAOpmC;AAC5w+B+B,EAAEE,GAAGqkC,mBAAmBtmC,EAAEm+C,QAAO,CAAG,IAAIn3C,GAAE3G,KAAK81C,SAASpP,qBAAqBvK,EAAEoY,IAAIh4B,OAAO4f,EAAEoY,IAAIhvC,KAAK,IAAIpH,EAAEwI,EAAEw1B,EAAEkY,aAAc,IAAGlY,EAAEyC,SAAS4V,UAAUx0C,KAAK61C,WAAW1Z,EAAEyC,SAAS6V,MAAMt2C,GAAGwB,EAAEo+C,OAAO,MAAO5hB,GAAEv9B,KAAKoB,KAAKq2C,WAAWx2C,KAAKs8B,GAAGx8B,CAAE,IAAGxB,EAAE6B,KAAK+1C,WAAW5Z,EAAE0Y,OAAO,MAAO70C,MAAKs2C,iBAAiBz2C,KAAKs8B,GAAGx8B,CAAE,KAAI,GAAIkF,GAAE,KAAKg9B,EAAE,EAAE4P,EAAE,EAAER,EAAE,KAAKphC,KAAK1I,EAAE,EAAE,EAAEA,IAAIA,EAAEtC,EAAE7E,KAAK41C,MAAMuF,MAAMhf,EAAEh1B,GAAGtC,IAAIosC,EAAEjxC,KAAK69C,iBAAiBh5C,EAAEnD,GAAGuvC,EAAE8M,QAAQtM,IAAIR,EAAE6M,SAASjc,IAAIoP,EAAE8M,QAAQluC,EAAEhQ,KAAKsH,IAAK,OAAO06B,GAAE,IAAI,GAAG4P,EAAEzxC,KAAKs2C,iBAAiBz2C,KAAKs8B,GAAGtsB,EAAErQ,OAAO,GAAGQ,KAAKu2C,iBAAiB12C,MAAM1B,EAAEg+B,EAAE6hB,SAASnuC,KAAKlQ,GAAGs+C,cAAc,WAAWj+C,KAAKq2C,cAAcr2C,KAAKs2C,oBAAoBt2C,KAAKu2C,mBAAoB,IAAIpa,GAAEn8B,KAAK41C,MAAM77B,IAAKoiB,IAAGn8B,KAAK69C,iBAAiB1hB,GAAE,IAAK+hB,mBAAmB,SAAS/hB,GAAG,IAAI,GAAIz6B,IAAGy8C,gBAAgBhiB,EAAEoY,IAAIxvC,IAAIq5C,gBAAgBjiB,EAAEoY,IAAItvC,KAAKtF,KAAKiC,EAAE,EAAEA,EAAE5B,KAAKy7C,UAAU75C,IAAIjC,EAAE,QAAQiC,GAAGu6B,EAAEyY,KAAKtJ,SAAS1pC,EAAG5B,MAAK+7C,UAAU1nB,YAAY3yB,GAAG1B,KAAK+7C,UAAUznB,YAAY30B,GAAGK,KAAK+7C,UAAUhS,UAAUsU,oBAAoB,SAASliB,GAAG,GAAIz6B,GAAE,KAAK/B,EAAE,IAAK+B,GAAE1B,KAAK42C,cAAcj3C,EAAE,UAAW,IAAIiC,IAAG08C,+BAA+BniB,EAAEoiB,cAAc,EAAE,EAAE,EAAE,GAAGC,uBAAuBx+C,KAAK41C,MAAMT,UAAUn1C,KAAK41C,MAAMT,SAAS,GAAG,GAAGn1C,KAAK41C,MAAMT,SAAS,IAAIqG,OAAOx7C,KAAKw7C,OAAOQ,QAAQh8C,KAAKg8C,QAAQC,SAASj8C,KAAKi8C,SAASC,UAAUl8C,KAAKk8C,UAAUC,OAAOn8C,KAAKm8C,OAAQ,IAAG,GAAGn8C,KAAKw3C,SAASx3C,KAAK6f,MAAM,IAAI,GAAIlZ,GAAE,EAAEA,EAAE3G,KAAKw7C,OAAO70C,IAAI/E,EAAE,OAAO+E,GAAG3G,KAAK47C,KAAKj1C,GAAG/E,EAAE,OAAO+E,GAAG3G,KAAK67C,KAAKl1C,GAAG/E,EAAE,UAAU+E,GAAG3G,KAAK+3C,SAASpxC,EAAG3G,MAAK+7C,UAAU3nB,QAAQp0B,KAAK+7C,UAAU1nB,YAAYzyB,GAAG5B,KAAK+7C,UAAUvQ,UAAU9pC,GAAG1B,KAAK+7C,UAAUrQ,gBAAgB/rC,EAAG,IAAIxB,GAAE,IAAK,KAAI,GAAIwI,KAAK3G,MAAKs2C,iBAAiBn4C,EAAE6B,KAAKs2C,iBAAiB3vC,GAAG3G,KAAKk+C,mBAAmB//C,EAAG6B,MAAK+7C,UAAUpQ,gBAAgB3rC,KAAK+7C,UAAUtQ,UAAUzrC,KAAK+7C,UAAUpS,OAAO8U,mBAAmB,SAAStiB,EAAEz6B,GAAG,IAAI,GAAI/B,IAAGw+C,gBAAgB,KAAKC,gBAAgB,KAAKG,aAAa,MAAM38C,KAAK+E,EAAE,EAAEA,EAAE3G,KAAKy7C,UAAU90C,IAAI/E,EAAE,QAAQ+E,GAAGw1B,EAAEyY,KAAKtJ,SAAS3kC,EAAG3G,MAAK+7C,UAAUznB,YAAY1yB,EAAG,IAAIzD,KAAI,GAAG,GAAG,EAAE,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,EAAE,KAAK,GAAG,GAAG,GAAG,KAAK0G,EAAE,IAAK,KAAI,GAAI8B,KAAKjF,GAAEmD,EAAE7E,KAAK41C,MAAMuF,MAAMhf,EAAEz6B,EAAEiF,IAAIhH,EAAEw+C,gBAAgBt5C,EAAE0vC,IAAIxvC,IAAIpF,EAAEy+C,gBAAgBv5C,EAAE0vC,IAAItvC,IAAItF,EAAE4+C,aAAapgD,EAAEuD,EAAEiF,IAAI3G,KAAK+7C,UAAU1nB,YAAY10B,GAAGK,KAAK+7C,UAAUhS,UAAU2U,oBAAoB,SAASviB,GAAG,GAAIz6B,GAAE,KAAK/B,EAAE,IAAK+B,GAAE1B,KAAK62C,cAAcl3C,EAAE,UAAW,IAAIiC,IAAG08C,+BAA+BniB,EAAEqiB,uBAAuBx+C,KAAK41C,MAAMT,UAAUn1C,KAAK41C,MAAMT,SAAS,GAAG,GAAGn1C,KAAK41C,MAAMT,SAAS,IAAIqG,OAAOx7C,KAAKw7C,OAAOQ,QAAQh8C,KAAKg8C,QAAQC,SAASj8C,KAAKi8C,SAASC,UAAUl8C,KAAKk8C,UAAUC,OAAOn8C,KAAKm8C,OAAQ,IAAG,GAAGn8C,KAAKw3C,SAASx3C,KAAK6f,MAAM,IAAI,GAAIlZ,GAAE,EAAEA,EAAE3G,KAAKw7C,OAAO70C,IAAI/E,EAAE,OAAO+E,GAAG3G,KAAK47C,KAAKj1C,GAAG/E,EAAE,OAAO+E,GAAG3G,KAAK67C,KAAKl1C,GAAG/E,EAAE,UAAU+E,GAAG3G,KAAK+3C,SAASpxC,EAAG3G,MAAK+7C,UAAU3nB,QAAQp0B,KAAK+7C,UAAU1nB,YAAYzyB,GAAG5B,KAAK+7C,UAAUvQ,UAAU9pC,GAAG1B,KAAK+7C,UAAUrQ,gBAAgB/rC,EAAG,IAAIxB,GAAE,IAAK,KAAI,GAAIwI,KAAK3G,MAAKu2C,iBAAiBp4C,EAAE6B,KAAKu2C,iBAAiB5vC,GAAG3G,KAAKy+C,mBAAmBtgD,EAAEA,EAAEA,EAAE6/C,SAAUh+C,MAAK+7C,UAAUpQ,gBAAgB3rC,KAAK+7C,UAAUtQ,UAAUzrC,KAAK+7C,UAAUpS,OAAOgV,aAAa,SAASxiB,GAAGn8B,KAAKq+C,oBAAoBliB,GAAGn8B,KAAK0+C,oBAAoBviB,IAAIyiB,sBAAsB,SAASziB,GAAG,GAAIz6B,GAAEy6B,EAAEoY,IAAIhvC,KAAK5F,GAAGw+C,gBAAgB9zC,UAAU8xB,EAAEoY,IAAIxvC,IAAI,IAAIrD,EAAE,IAAI08C,gBAAgB5zC,UAAU2xB,EAAEoY,IAAItvC,IAAI,IAAIvD,EAAE,IAAIm9C,QAAQ1iB,EAAE0Y,QAAQ,EAAE,EAAE,IAAI,EAAE,EAAE,GAAI70C,MAAKg3C,aAAa3iB,YAAY10B,GAAGK,KAAKg3C,aAAajN,UAAU+U,yBAAyB,SAAS3iB,GAAG,GAAIz6B,IAAG48C,+BAA+BniB,EAAGn8B,MAAKg3C,aAAa5iB,QAAQp0B,KAAKg3C,aAAa3iB,YAAY3yB,GAAG1B,KAAKg3C,aAAaxL,UAAUxrC,KAAK22C,UAAU32C,KAAKg3C,aAAatL,gBAAgB,QAAS,IAAI/rC,GAAE,IAAK,KAAI,GAAIiC,KAAK5B,MAAKs2C,iBAAiB32C,EAAEK,KAAKs2C,iBAAiB10C,GAAG5B,KAAK4+C,sBAAsBj/C,EAAGK,MAAKg3C,aAAarL,gBAAgB3rC,KAAKg3C,aAAavL,UAAUzrC,KAAKg3C,aAAarN,OAAOoV,sBAAsB,SAAS5iB,EAAEz6B,GAAG,GAAI/B,IAAGw+C,gBAAgB,KAAKC,gBAAgB,KAAKS,QAAQ,MAAMj9C,EAAE,IAAK,KAAI,GAAI+E,KAAKjF,GAAEE,EAAE5B,KAAK41C,MAAMuF,MAAMhf,EAAEz6B,EAAEiF,IAAIogC,GAAGnlC,EAAE2yC,IAAIhvC,KAAK5F,EAAEw+C,gBAAgB9zC,UAAUzI,EAAE2yC,IAAIxvC,IAAI,IAAIgiC,GAAG,IAAIpnC,EAAEy+C,gBAAgB5zC,UAAU5I,EAAE2yC,IAAItvC,IAAI,IAAI8hC,GAAG,IAAIpnC,EAAEk/C,QAAQj9C,EAAEizC,QAAQ,EAAE,EAAE,IAAI,EAAE,EAAE,GAAG70C,KAAKg3C,aAAa3iB,YAAY10B,GAAGK,KAAKg3C,aAAajN,UAAUiV,yBAAyB,SAAS7iB,GAAG,GAAIz6B,IAAG48C,+BAA+BniB,EAAGn8B,MAAKg3C,aAAa5iB,QAAQp0B,KAAKg3C,aAAa3iB,YAAY3yB,GAAG1B,KAAKg3C,aAAaxL,UAAUxrC,KAAK22C,UAAU32C,KAAKg3C,aAAatL,gBAAgB,QAAS,IAAI/rC,GAAE,IAAK,KAAI,GAAIiC,KAAK5B,MAAKu2C,iBAAiB52C,EAAEK,KAAKu2C,iBAAiB30C,GAAG5B,KAAK++C,sBAAsBp/C,EAAExB,EAAEwB,EAAEq+C,SAAUh+C,MAAKg3C,aAAarL,gBAAgB3rC,KAAKg3C,aAAavL,UAAUzrC,KAAKg3C,aAAarN,OAAOsV,kBAAkB,SAAS9iB,GAAGn8B,KAAKwe,GAAG4+B,UAAU,GAAGp9C,KAAKwe,GAAG0gC,UAAUl/C,KAAKwe,GAAG4F,QAAQpkB,KAAK8+C,yBAAyB3iB,GAAGn8B,KAAKg/C,yBAAyB7iB,GAAGn8B,KAAKwe,GAAG0gC,UAAUl/C,KAAKwe,GAAG2gC,MAAMn/C,KAAKwe,GAAG4+B,UAAU,IAAIgC,UAAU,SAASjjB,EAAEz6B,EAAE/B,GAAG,GAAIiC,GAAEoQ,SAAStQ,EAAE1B,KAAKi3C,eAAgBj3C,MAAK61C,aAAa71C,KAAK81C,SAAS55B,MAAMigB,EAAEv6B,EAAEjC,GAAGK,KAAKi+C,eAAgB,IAAIt3C,GAAEqL,SAASmqB,EAAEv6B,EAAG,IAAG5B,KAAKy2C,YAAYz2C,KAAK2+C,aAAah4C,GAAG3G,KAAK02C,aAAa12C,KAAKi/C,kBAAkBt4C,GAAG3G,KAAK21C,IAAI,MAAM31C,KAAKs3C,MAAM,CAACt3C,KAAKwe,GAAG6gC,OAAOr/C,KAAKwe,GAAG8gC,OAAOt/C,KAAKwe,GAAG+gC,UAAUv/C,KAAKwe,GAAGghC,UAAUx/C,KAAKwe,GAAGihC,oBAAqB,IAAIthD,GAAE6T,SAASmqB,EAAEjlB,cAAc,EAAE,EAAE,IAAIrS,GAAG66C,MAAMvhD,GAAG0jC,GAAG8d,UAAU3/C,KAAKs3C,MAAOrjB,2BAA0Bj0B,KAAKq3C,OAAO,WAAWr3C,KAAKo3C,QAAQ,KAAKvyC,EAAEg9B,GAAG7hC,KAAKwe,GAAGohC,QAAQ5/C,KAAKwe,GAAG8gC,SAASO,aAAa,WAAW,GAAI1jB,GAAE,EAAEz6B,EAAE1B,KAAKw2C,YAAY91C,MAAM,EAAEy7B,EAAGn8B,MAAKw2C,YAAYzX,OAAO,EAAE5C,EAAG,IAAIx8B,GAAEK,KAAKg2C,OAAOhe,OAAOt2B,EAAG/B,GAAEigC,KAAK6V,sBAAuB,IAAI7zC,GAAEjC,EAAEH,OAAOmH,EAAE3G,KAAKk2C,cAAct0C,EAAE5B,KAAKk2C,cAAct0C,CAAE5B,MAAKg2C,OAAOr2C,EAAEo/B,OAAO,EAAEp4B,EAAG,KAAI,GAAIxI,GAAEwB,EAAEkF,EAAE,KAAKg9B,EAAE,KAAK4P,KAAKR,EAAE,EAAEtqC,EAAEsqC,IAAIA,EAAE,GAAGpsC,EAAE7E,KAAKg2C,OAAO/E,GAAGpP,EAAEh9B,EAAEjG,IAAIiG,EAAEjG,IAAI,KAAKijC,EAAE,GAAGA,EAAEhgC,UAAU,CAAC,IAAI,GAAIgO,GAAE,GAAIpP,OAAMohC,EAAEpC,SAASjgC,QAAQyxC,EAAE,EAAEA,EAAEphC,EAAErQ,SAASyxC,EAAEphC,EAAEohC,GAAGpP,EAAEpC,SAASwR,GAAGzqB,KAAM3hB,GAAE+vC,MAAM50C,KAAK87C,aAAaj3C,EAAE+vC,MAAM/vC,EAAE+vC,KAAK50C,KAAK29C,YAAY9tC,OAAQ4hC,GAAE5xC,KAAKoxC,EAAG,IAAI9pC,GAAEsqC,EAAEjyC,OAAO2R,EAAE,CAAExK,GAAExI,EAAEqB,MAAO,KAAI,GAAIyxC,GAAE,EAAEtqC,EAAEsqC,IAAIA,EAAEpsC,EAAE1G,EAAE8yC,GAAGpP,EAAEh9B,EAAEjG,IAAIiG,EAAEjG,IAAI,KAAKijC,IAAI16B,EAAEgK,GAAGnR,KAAKg2C,OAAOvE,EAAEtgC,IAAItM,EAAEsM,MAAMnR,KAAK87C,aAAaj3C,EAAE+vC,MAAM/vC,EAAE+vC,KAAK,MAAOzjC,GAAE,GAAGnR,KAAKg2C,OAAOpW,KAAK6V,wBAAwBqK,cAAc,WAAW,GAAI3jB,GAAEn8B,KAAKg2C,OAAOx2C,OAAOkC,EAAEy6B,EAAE,EAAEn8B,KAAKg2C,OAAO7Z,EAAE,GAAG,IAAKn8B,MAAKq2C,WAAWzW,KAAK6V,sBAAuB,KAAI,GAAI91C,GAAEK,KAAKm2C,oBAAoBn2C,KAAKo2C,wBAAwBx0C,EAAE,EAAE+E,EAAE3G,KAAKq2C,WAAW72C,OAAOrB,EAAE,KAAK0G,GAAE,EAAGg9B,EAAE,EAAEl7B,EAAEk7B,GAAGliC,EAAEiC,IAAIigC,EAAE1jC,EAAE6B,KAAKq2C,WAAWxU,GAAG1jC,EAAES,MAAMiG,GAAE,EAAG,MAAMnD,GAAGy6B,GAAGn8B,KAAKk2C,gBAAgBrxC,EAAE4wC,sBAAsBt3C,EAAEuD,GAAG,GAAGmD,IAAI7E,KAAK49C,aAAaz/C,GAAGyD,OAAOm+C,kCAAkC,WAAW,GAAI5jB,GAAEn8B,KAAK41C,MAAM77B,IAAK,KAAIoiB,EAAE,MAAO7rB,gBAAgB,IAAI5O,GAAE,GAAIya,QAAQza,GAAEqD,IAAIqF,SAASM,SAASyxB,EAAEoY,IAAIxvC,IAAI/E,KAAK41C,MAAMvS,OAAOrjC,KAAK41C,MAAM95B,QAAQpa,EAAEuD,IAAImF,SAASM,SAASyxB,EAAEoY,IAAItvC,IAAIjF,KAAK41C,MAAMvS,OAAOrjC,KAAK41C,MAAM95B,QAAQ9b,KAAKi3C,eAAejlC,SAAS6D,kBAAkB7V,KAAK41C,MAAM95B,QAAQ7E,cAAcjX,KAAK41C,MAAMvS,OAAQ,IAAI1jC,GAAE+B,EAAE6a,OAAO3a,EAAEF,EAAE6D,KAAKoB,EAAE/E,EAAE,EAAG+E,GAAE/E,EAAE,KAAK+E,EAAE/E,EAAE,IAAI+E,EAAE/E,EAAE,KAAK+E,EAAE/E,EAAE,GAAI,IAAIzD,GAAEwI,EAAE,EAAE,EAAEA,EAAE,EAAE9B,EAAEqS,cAAc/Y,EAAEA,EAAEA,GAAG0jC,EAAE/rB,mBAAmBnW,EAAE,IAAIA,EAAE,IAAIA,EAAE,IAAI8xC,EAAEz/B,SAASnN,EAAEg9B,EAAG7hC,MAAKk3C,yBAAyBzF,GAAG2K,WAAW,WAAW,GAAIjgB,GAAEn8B,KAAK41C,MAAM77B,IAAK,IAAGoiB,EAAE,CAAC,GAAIz6B,GAAE1B,KAAKwe,GAAG7e,GAAGK,KAAK41C,MAAMT,SAAS,IAAIn1C,KAAK41C,MAAMT,SAAS,GAAGn1C,KAAKw7C,OAAO,CAAEx7C,MAAKk2C,cAAcpzC,SAAS9C,KAAKi2C,kBAAkBt2C,GAAGK,KAAKk2C,eAAe,IAAIl2C,KAAKk2C,cAAc,EAAG,IAAIt0C,GAAE,GAAIujB,gBAAe,GAAG,IAAI,IAAI,GAAG,GAAG,GAAG,IAAI,KAAKxe,EAAE,GAAI2sB,WAAU5xB,EAAGiF,GAAEqpB,mBAAmB,WAAW,EAAEpuB,GAAG+E,EAAE0vB,mBAAmB,WAAW30B,EAAEo0B,eAAe,EAAE,GAAG91B,KAAK42C,cAAcjwC,EAAE3G,KAAK62C,cAAclwC,EAAE3G,KAAK+/C,sCAAsChW,OAAO,SAAS5N,EAAEz6B,EAAE/B,GAAGK,KAAK41C,MAAM77B,OAAO/Z,KAAKo/C,UAAUjjB,EAAEz6B,EAAE/B,GAAGK,KAAKm3C,aAAan3C,KAAK6/C,eAAe7/C,KAAK8/C,mBAAmBjG,GAAIA,2BAA0B,MAAO75C,MAAKk3C","file":"webrti.min.js","sourcesContent":["/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// version\r\n/***********************************************************************/\r\nvar SGL_VERSION_MAJOR      = 0;\r\nvar SGL_VERSION_MINOR      = 1;\r\nvar SGL_VERSION_REVISION   = 1;\r\nvar SGL_VERSION_STRING     = SGL_VERSION_MAJOR + \".\" + SGL_VERSION_MINOR + \".\" + SGL_VERSION_REVISION;\r\n/***********************************************************************/\r\n\r\n\r\n// exceptions\r\n/***********************************************************************/\r\nfunction sglUnknown() {\r\n\tthrow new Error(\"SpiderGL : UNKNOWN\");\r\n}\r\n\r\nfunction sglUnsupported() {\r\n\tthrow new Error(\"SpiderGL : UNSUPPORTED\");\r\n}\r\n\r\nfunction sglUnimplemented() {\r\n\tthrow new Error(\"SpiderGL : UNIMPLEMENTED\");\r\n}\r\n\r\nfunction sglInvalidParameter() {\r\n\tthrow new Error(\"SpiderGL : INVALID_PARAMETER\");\r\n}\r\n\r\nfunction sglInvalidCall() {\r\n\tthrow new Error(\"SpiderGL : INVALID_CALL\");\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// utilities\r\n/***********************************************************************/\r\n/*function sglDefineGetter(ClassName, getterName, getterFunc, obj) {\r\n\tClassName.defineProperty(obj, getterName, {get: getterFunc});\r\n\t//ClassName.prototype.__defineGetter__(getterName, getterFunc);\r\n}\r\n\r\nfunction sglDefineSetter(ClassName, setterName, setterFunc, obj) {\r\n\tClassName.defineProperty(obj, setterName, {set: setterFunc});\r\n\t//ClassName.prototype.__defineSetter__(setterName, setterFunc);\r\n}*/\r\n\r\nfunction sglDefineConstant(ClassName, constantName, constantValue) {\r\n\tClassName[constantName] = constantValue;\r\n}\r\n\r\nfunction sglInherit(DerivedClassName, BaseClassName) {\r\n\tDerivedClassName.prototype = new BaseClassName();\r\n\tDerivedClassName.prototype.constructor = DerivedClassName;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// initialization - finalization\r\n/***********************************************************************/\r\nfunction sglInitialize() {\r\n\t;\r\n}\r\n\r\nfunction sglFinalize() {\r\n\t;\r\n}\r\n\r\nwindow.addEventListener(\"load\",   function() { sglInitialize(); }, false);\r\nwindow.addEventListener(\"unload\", function() { sglFinalize();   }, false);\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// DOM utilities\r\n/*********************************************************/\r\nfunction sglNodeText(domNodeID) {\r\n\tvar node = document.getElementById(domNodeID);\r\n\tif (!node) return null;\r\n\r\n\tvar str = \"\";\r\n\tvar n   = node.firstChild;\r\n\twhile (n) {\r\n\t\tif (n.nodeType == 3) {\r\n\t\t\tstr += n.textContent;\r\n\t\t}\r\n\t\tn = n.nextSibling;\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nfunction sglLoadFile(url, callback) {\r\n\tvar async = (callback) ? (true) : (false);\r\n\tvar req = new XMLHttpRequest();\r\n\r\n\tif (async) {\r\n\t\treq.onreadystatechange = function() {\r\n\t\t\tif (req.readyState == 4) {\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(req.responseText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\treq.open(\"GET\", url, async);\r\n\treq.send(null);\r\n\r\n\tvar ret = null;\r\n\tif (!async) {\r\n\t\tret = req.responseText;\r\n\t}\r\n\r\n\treturn ret;\r\n}\r\n\r\nfunction sglGetLines(text)\r\n{\r\n\tvar allLines = text.split(\"\\n\");\r\n\tvar n = allLines.length;\r\n\tvar lines = [ ];\r\n\tvar line = null;\r\n\tfor (var i=0; i<n; ++i) {\r\n\t\tline = allLines[i].replace(/[ \\t]+/g, \" \").replace(/\\s\\s*$/, \"\");\r\n\t\tif (line.length > 0) {\r\n\t\t\tlines.push(line);\r\n\t\t}\r\n\t}\r\n\treturn lines;\r\n}\r\n/*********************************************************/\r\n\r\n\r\n// SglRequest\r\n/*********************************************************/\r\nvar SGL_REQUEST_FAILED     = 0;\r\nvar SGL_REQUEST_SUCCEEDED  = 1;\r\nvar SGL_REQUEST_IDLE       = 2;\r\nvar SGL_REQUEST_ONGOING    = 3;\r\nvar SGL_REQUEST_ABORTED    = 4;\r\nvar SGL_REQUEST_QUEUED     = 5;\r\nvar SGL_REQUEST_REJECTED   = 6;\r\nvar SGL_REQUEST_CANCELLED  = 7;\r\n\r\n/**\r\n * Constructs a SglRequest.\r\n * @class Base class for an asynchronous request.\r\n */\r\nfunction SglRequest(onReadyCallback) {\r\n\tthis._priority = null;\r\n\tthis._status   = SGL_REQUEST_IDLE;\r\n\tthis._queue    = null;\r\n\tthis._onReady  = [ ];\r\n\tif (onReadyCallback) {\r\n\t\tthis.addOnReadyCallback(onReadyCallback);\r\n\t}\r\n}\r\n\r\nSglRequest.prototype = {\r\n\t_createOnReadyCallback : function() {\r\n\t\tvar t  = this;\r\n\t\tvar cb = function(ok) {\r\n\t\t\tt._status = (ok) ? (SGL_REQUEST_SUCCEEDED) : (SGL_REQUEST_FAILED);\r\n\t\t\tif (t._queue) {\r\n\t\t\t\tt._queue._requestReady(t);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tvar n = t._onReady.length;\r\n\t\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\t\tt._onReady[i](t);\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn cb;\r\n\t},\r\n\r\n\tget status() {\r\n\t\treturn this._status;\r\n\t},\r\n\r\n\tget priority() {\r\n\t\treturn this._priority;\r\n\t},\r\n\r\n\tset priority(p) {\r\n\t\tthis._priority = p;\r\n\t\tif (this._queue) {\r\n\t\t\tthis._queue._updateRequest(this);\r\n\t\t}\r\n\t},\r\n\r\n\tget succeeded() {\r\n\t\treturn (this._status == SGL_REQUEST_SUCCEEDED);\r\n\t},\r\n\r\n\tget failed() {\r\n\t\treturn (this._status == SGL_REQUEST_FAILED);\r\n\t},\r\n\r\n\taddOnReadyCallback : function(f) {\r\n\t\tif (f) {\r\n\t\t\tthis._onReady.push(f);\r\n\t\t\tif (this.isReady) {\r\n\t\t\t\tf(this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tremoveOnReadyCallback : function(f) {\r\n\t\tvar index = -1;\r\n\t\tvar n = this._onReady.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tif (this._onReady[i] == f) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (index < 0) return;\r\n\t\tthis._onReady.splice(index, 1);\r\n\t},\r\n\r\n\tget isReady() {\r\n\t\treturn (this.failed || this.succeeded);\r\n\t},\r\n\r\n\tget queue() {\r\n\t\treturn this._queue;\r\n\t},\r\n\r\n\tsend : function() {\r\n\t\tif (!this._send) return false;\r\n\t\tvar r = this._send();\r\n\t\tif (r) {\r\n\t\t\tthis._status = SGL_REQUEST_ONGOING;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._status = SGL_REQUEST_FAILED;\r\n\t\t\tvar cb = this._createOnReadyCallback();\r\n\t\t\tcb(false);\r\n\t\t}\r\n\t\treturn r;\r\n\t},\r\n\r\n\tcancel : function() {\r\n\t\tif (this._status == SGL_REQUEST_QUEUED) {\r\n\t\t\tif (this._queue) {\r\n\t\t\t\tthis._queue._removeQueuedRequest(this);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tthis._status = SGL_REQUEST_CANCELLED;\r\n\t\t}\r\n\t},\r\n\r\n\tabort : function() {\r\n\t\tthis.cancel();\r\n\t\tif (this._status == SGL_REQUEST_ONGOING) {\r\n\t\t\tif (this._queue) {\r\n\t\t\t\tthis._queue._removeOngoingRequest(this);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tif (this._abort) {\r\n\t\t\t\tthis._abort();\r\n\t\t\t}\r\n\t\t\tthis._status = SGL_REQUEST_ABORTED;\r\n\t\t}\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglTextFileRequest\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglTextFileRequest.\r\n * @class Asynchronous text file request.\r\n */\r\nfunction SglTextFileRequest(url, onReadyCallback) {\r\n\tSglRequest.apply(this, Array.prototype.slice.call(arguments, 1));\r\n\tthis._url = url;\r\n\tthis._req = null;\r\n\tObject.defineProperty(this, \"url\", {get: function(){return this._url;}});\r\n\tObject.defineProperty(this, \"text\", {get: function(){return this._req.responseText;}});\r\n}\r\n\r\nsglInherit(SglTextFileRequest, SglRequest);\r\n\r\n/*sglDefineGetter(SglTextFileRequest, \"url\", function() {\r\n\treturn this._url;\r\n});\r\n\r\nsglDefineGetter(SglTextFileRequest, \"text\", function() {\r\n\treturn this._req.responseText;\r\n});*/\r\n\r\nSglTextFileRequest.prototype._send = function() {\r\n\tif (!this._url) return false;\r\n\r\n\tvar req = new XMLHttpRequest();\r\n\tthis._req = req;\r\n\r\n\tvar cb = this._createOnReadyCallback();\r\n\treq.onreadystatechange = function() {\r\n\t\tif (req.readyState == 4) {\r\n\t\t\tvar ok = (req.status) ? (req.status == 200) : (true);\r\n\t\t\tcb(ok);\r\n\t\t}\r\n\t};\r\n\treq.open(\"GET\", this._url, true);\r\n\treq.send();\r\n\r\n\treturn true;\r\n};\r\n\r\nSglTextFileRequest.prototype._abort = function() {\r\n\tif (!this._req) return;\r\n\tthis._req.abort();\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglImageRequest\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglImageRequest.\r\n * @class Asynchronous image request.\r\n */\r\nfunction SglImageRequest(url, onReadyCallback) {\r\n\tSglRequest.apply(this, Array.prototype.slice.call(arguments, 1));\r\n\tthis._url = url;\r\n\tthis._img = null;\r\n\tObject.defineProperty(this, \"url\", {get: function(){return this._url;}});\r\n\tObject.defineProperty(this, \"image\", {get: function(){return this._img;}});\r\n}\r\n\r\nsglInherit(SglImageRequest, SglRequest);\r\n\r\nSglImageRequest.prototype._send = function() {\r\n\tif (!this._url) return false;\r\n\r\n\tvar img = new Image();\r\n\tthis._img = img;\r\n\timg.crossOrigin = '';\r\n\tvar cb = this._createOnReadyCallback();\r\n\timg.onload = function() {\r\n\t\tcb(img.complete);\r\n\t};\r\n\timg.onerror = function() {\r\n\t\tcb(false);\r\n\t};\r\n\timg.src = this._url;\r\n\r\n\treturn true;\r\n};\r\n\r\nSglImageRequest.prototype._abort = function() {\r\n\t;\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglRequestWatcher\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglRequestWatcher.\r\n * @class Watches for requests completion.\r\n */\r\nfunction SglRequestWatcher(reqs, onReadyCallback) {\r\n\tvar n = reqs.length;\r\n\r\n\tthis._onReady       = (onReadyCallback) ? (onReadyCallback) : (null);\r\n\tthis._waitingReqs   = n;\r\n\tthis._succeededReqs = 0;\r\n\tthis._failedReqs    = 0;\r\n\tthis._reqs          = reqs.slice();\r\n\r\n\tvar t  = this;\r\n\tvar cb = function(r) {\r\n\t\tif (r.succeeded) {\r\n\t\t\tt._succeededReqs++;\r\n\t\t}\r\n\t\telse if (r.failed) {\r\n\t\t\tt._failedReqs++;\r\n\t\t}\r\n\t\tt._waitingReqs--;\r\n\t\tif (t.isReady) {\r\n\t\t\tif (t._onReady) {\r\n\t\t\t\tt._onReady(t);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor (var i=0; i<n; ++i) {\r\n\t\tif (reqs[i].succeeded) {\r\n\t\t\tthis._succeededReqs++;\r\n\t\t\tthis._waitingReqs--;\r\n\t\t}\r\n\t\telse if (reqs[i].failed) {\r\n\t\t\tthis._failedReqs++;\r\n\t\t\tthis._waitingReqs--;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treqs[i].addOnReadyCallback(cb);\r\n\t\t}\r\n\t}\r\n\r\n\tif (this._waitingReqs <= 0) {\r\n\t\tif (this._onReady) {\r\n\t\t\tthis._onReady(this);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nSglRequestWatcher.prototype = {\r\n\tget requests() {\r\n\t\treturn this._reqs;\r\n\t},\r\n\r\n\tget succeeded() {\r\n\t\treturn (this._succeededReqs == this._reqs.length);\r\n\t},\r\n\r\n\tget failed() {\r\n\t\tif ((this._succeededReqs + this._failedReqs) < this._reqs.length) return false;\r\n\t\treturn (this._succeededReqs < this._reqs.length);\r\n\t},\r\n\r\n\tget onReady() {\r\n\t\treturn this._onReady;\r\n\t},\r\n\r\n\tset onReady(f) {\r\n\t\tthis._onReady = f;\r\n\t\tif (this.isReady) {\r\n\t\t\tif (this._onReady) {\r\n\t\t\t\tthis._onReady(t);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tget isReady() {\r\n\t\treturn ((this._succeededReqs + this._failedReqs) == this._reqs.length);\r\n\t},\r\n\r\n\tsend : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].send();\r\n\t\t}\r\n\t},\r\n\r\n\tcancel : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].cancel();\r\n\t\t}\r\n\t},\r\n\r\n\tabort : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].abort();\r\n\t\t}\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglRequestQueue\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglRequestQueue.\r\n * @class Asynchronous requests scheduler.\r\n */\r\nfunction SglRequestQueue(maxOngoing, maxQueued, onReadyCallback) {\r\n\tthis._maxOngoing = (maxOngoing > 0) ? (maxOngoing) : (0);\r\n\tthis._maxQueued  = (maxQueued  > 0) ? (maxQueued ) : (0);\r\n\r\n\tthis._ongoing = [ ];\r\n\tthis._queued  = [ ];\r\n\tthis._onReady = null;\r\n\tthis._minPriorityReq = null;\r\n\tthis._priorityCompare = null;\r\n\tthis._dirty = true;\r\n}\r\n\r\nSglRequestQueue.prototype = {\r\n\t_sort : function() {\r\n\t\tif (!this._dirty) return;\r\n\r\n\t\tthis._dirty = false;\r\n\t\tthis._minPriorityReq = null;\r\n\t\tif (this._queued.length <= 0) return;\r\n\r\n\t\tif (this._priorityCompare) {\r\n\t\t\tthis._queued.sort(this._priorityCompare);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._queued.sort();\r\n\t\t}\r\n\t\tif (this._queued.length > 0) {\r\n\t\t\tthis._minPriorityReq = this._queued[0];\r\n\t\t}\r\n\t},\r\n\r\n\t_updateMinPriority : function() {\r\n\t\tthis._minPriorityReq = null;\r\n\t\tvar n = this._queued.length;\r\n\t\tif (n <= 0) return;\r\n\r\n\t\tthis._minPriorityReq = this._queued[0];\r\n\t\tif (!this._dirty) return;\r\n\r\n\t\tfor (var i=1; i<n; ++i) {\r\n\t\t\tif (this.comparePriorities(this._queued[i].priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\tthis._minPriorityReq = this._queued[i];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_removeFromArray : function(arr, elem) {\r\n\t\tvar index = -1;\r\n\t\tvar n = arr.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tif (arr[i] == elem) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (index < 0) return;\r\n\t\tarr.splice(index, 1);\r\n\t},\r\n\r\n\t_removeQueuedRequest : function(r) {\r\n\t\tthis._removeFromArray(this._queued, r);\r\n\t\tif (this._queued.length <= 0) {\r\n\t\t\tthis._minPriorityReq = null;\r\n\t\t}\r\n\t\telse if (r == this._minPriorityReq) {\r\n\t\t\tthis._updateMinPriority();\r\n\t\t}\r\n\t},\r\n\r\n\t_removeOngoingRequest : function(r) {\r\n\t\tthis._removeFromArray(this._ongoing, r);\r\n\t\tthis._execute();\r\n\t},\r\n\r\n\t_updateRequest : function(r) {\r\n\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\tthis._minPriorityReq = r;\r\n\t\t}\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\t_requestReady : function(r) {\r\n\t\tthis._removeOngoingRequest(r);\r\n\t\tif (this._onReady) {\r\n\t\t\tthis._onReady(r);\r\n\t\t}\r\n\t\tthis._execute();\r\n\t},\r\n\r\n\t_execute : function() {\r\n\t\tvar n = this._queued.length;\r\n\t\tif (n <= 0) return;\r\n\t\tvar sendable = (this._maxOngoing > 0) ? (this._maxOngoing - this._ongoing.length) : (n)\r\n\t\tif (sendable <= 0) return;\r\n\t\tif (sendable > n) sendable = n;\r\n\t\tthis._sort();\r\n\t\tvar r = null;\r\n\t\tfor (var i=0; i<sendable; ++i) {\r\n\t\t\tr = this._queued.pop();\r\n\t\t\tr.send();\r\n\t\t}\r\n\t\tif (this._queued.length > 0) {\r\n\t\t\tthis._minPriorityReq = this._queued[0];\r\n\t\t}\r\n\t},\r\n\r\n\tcomparePriorities : function(a, b) {\r\n\t\tif (this._priorityCompare) {\r\n\t\t\treturn this._priorityCompare(a, b);\r\n\t\t}\r\n\t\treturn (a - b);\r\n\t},\r\n\r\n\tget priorityCompare() {\r\n\t\treturn this._priorityCompare;\r\n\t},\r\n\r\n\tset priorityCompare(f) {\r\n\t\tthis._priorityCompare = f;\r\n\t\tthis._updateMinPriority();\r\n\t},\r\n\r\n\tget onReady() {\r\n\t\treturn this._onReady;\r\n\t},\r\n\r\n\tset onReady(f) {\r\n\t\tthis._onReady = f;\r\n\t},\r\n\r\n\tpush : function(r) {\r\n\t\tvar ret = {\r\n\t\t\tvictims : null,\r\n\t\t\tresult  : false\r\n\t\t};\r\n\t\t\r\n\t\tif (r.queue) return ret;\r\n\t\tvar n = this._queued.length;\r\n\t\tvar overflow = ((this._maxQueued > 0) && (n >= this._maxQueued));\r\n\r\n\t\tif  (overflow) {\r\n\t\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\tr._status = SGL_REQUEST_REJECTED;\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._queued.push(r);\r\n\t\tr._queue  = this;\r\n\t\tr._status = SGL_REQUEST_QUEUED;\r\n\t\tn++;\r\n\r\n\t\tret.result = true;\r\n\t\r\n\t\tvar toKill = (this._maxQueued > 0) ? (n - this._maxQueued) : (0);\r\n\t\tif (toKill <= 0) {\r\n\t\t\tif (this._minPriorityReq != null) {\r\n\t\t\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\t\tthis._minPriorityReq = r;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._minPriorityReq = r;\r\n\t\t\t}\r\n\t\t\tthis._dirty = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._sort();\r\n\t\t\tret.victims = this._queued.slice(0, toKill);\r\n\t\t\tthis._queued.splice(0, toKill);\r\n\t\t\tfor (var i=0; i<toKill; ++i) {\r\n\t\t\t\tret.victims[i]._status = SGL_REQUEST_REJECTED;\r\n\t\t\t\tret.victims[i]._queue  = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._execute();\r\n\r\n\t\treturn ret;\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// math utilities\r\n/***********************************************************************/\r\nvar SGL_PI = Math.PI;\r\n\r\nfunction sglAbs(x) {\r\n\treturn Math.abs(x);\r\n}\r\n\r\nfunction sglFloor(x) {\r\n\treturn Math.floor(x);\r\n}\r\n\r\nfunction sglCeil(x) {\r\n\treturn Math.ceil(x);\r\n}\r\n\r\nfunction sglSqrt(x) {\r\n\treturn Math.sqrt(x);\r\n}\r\n\r\nfunction sglPow(x, y) {\r\n\treturn Math.pow(x, y);\r\n}\r\n\r\nfunction sglLog(x) {\r\n\treturn Math.log(x);\r\n}\r\n\r\nfunction sglExp(x) {\r\n\treturn Math.exp(x);\r\n}\r\n\r\nfunction sglSin(x) {\r\n\treturn Math.sin(x);\r\n}\r\n\r\nfunction sglAsin(x) {\r\n\treturn Math.asin(x);\r\n}\r\n\r\nfunction sglCos(x) {\r\n\treturn Math.cos(x);\r\n}\r\n\r\nfunction sglAcos(x) {\r\n\treturn Math.acos(x);\r\n}\r\n\r\nfunction sglTan(x) {\r\n\treturn Math.tan(x);\r\n}\r\n\r\nfunction sglAtan(x) {\r\n\treturn Math.atan(x);\r\n}\r\n\r\nfunction sglAtan2(y, x) {\r\n\treturn Math.atan2(y, x);\r\n}\r\n\r\nfunction sglDegToRad(x) {\r\n\treturn (x * (SGL_PI / 180.0));\r\n}\r\n\r\nfunction sglRadToDeg(x) {\r\n\treturn (x * (180.0 / SGL_PI));\r\n}\r\n\r\nfunction sglMin(a, b) {\r\n\treturn Math.min(a, b);\r\n}\r\n\r\nfunction sglMax(a, b) {\r\n\treturn Math.max(a, b);\r\n}\r\n\r\nfunction sglClamp(x, min, max) {\r\n\treturn ((x <= min) ? (min) : ((x >= max) ? (max) : (x)));\r\n}\r\n\r\nfunction sglRandom01() {\r\n\treturn Math.random();\r\n}\r\n\r\nfunction sglMapVN(vArray, size, f, param, first, count, stride) {\r\n\tfirst  = (first  != undefined) ? first  : 0;\r\n\tstride = (stride != undefined) ? stride : size;\r\n\tcount  = (count  != undefined) ? count  : ((vArray.length - first) / stride);\r\n\r\n\tvar last = first + count * stride;\r\n\tvar v    = new Array(n);\r\n\r\n\tvar k = 0;\r\n\tvar j = 0;\r\n\tfor (var i=first; i<last; i+=stride) {\r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\tv[j] = vArray[i+j];\r\n\t\t}\r\n\t\tf(v, param, k++);\r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\tvArray[i+j] = v[j];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction sglMapV2(v2Array, f, param, first, count, stride) {\r\n\tsglMapVN(v2Array, 2, f, param, first, count, stride);\r\n}\r\n\r\nfunction sglMapV3(v3Array, f, param, first, count, stride) {\r\n\tsglMapVN(v3Array, 3, f, param, first, count, stride);\r\n}\r\n\r\nfunction sglMapV4(v4Array, f, param, first, count, stride) {\r\n\tsglMapVN(v4Array, 4, f, param, first, count, stride);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// 2-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV2(v) {\r\n\treturn new Array(2);\r\n}\r\n\r\nfunction sglV2V(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV2S(s) {\r\n\treturn [ s, s ];\r\n}\r\n\r\nfunction sglV2C(x, y) {\r\n\treturn [ x, y ];\r\n}\r\n\r\nfunction sglZeroV2() {\r\n\treturn sglV2S(0.0);\r\n}\r\n\r\nfunction sglOneV2() {\r\n\treturn sglV2S(1.0);\r\n}\r\n\r\nfunction sglV2() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV2V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV2S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 2:\r\n\t\t\treturn sglV2V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV2();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglNegV2(v) {\r\n\treturn sglV2C(-v[0], -v[1]);\r\n}\r\n\r\nfunction sglAddV2(u, v) {\r\n\treturn sglV2C(u[0]+v[0], u[1]+v[1]);\r\n}\r\n\r\nfunction sglAddV2S(v, s) {\r\n\treturn sglV2C(v[0]+s, v[1]+s);\r\n}\r\n\r\nfunction sglAddSV2(s, v) {\r\n\treturn sglAddV2S(v, s)\r\n}\r\n\r\nfunction sglSubV2(u, v) {\r\n\treturn sglV2C(u[0]-v[0], u[1]-v[1]);\r\n}\r\n\r\nfunction sglSubV2S(v, s) {\r\n\treturn sglV2C(v[0]-s, v[1]-s);\r\n}\r\n\r\nfunction sglSubSV2(v, s) {\r\n\treturn sglV2C(s-v[0], s-v[1]);\r\n}\r\n\r\nfunction sglMulV2(u, v) {\r\n\treturn sglV2C(u[0]*v[0], u[1]*v[1]);\r\n}\r\n\r\nfunction sglMulV2S(v, s) {\r\n\treturn sglV2C(v[0]*s, v[1]*s);\r\n}\r\n\r\nfunction sglMulSV2(s, v) {\r\n\treturn sglMulV2S(v, s);\r\n}\r\n\r\nfunction sglDivV2(u, v) {\r\n\treturn sglV2C(u[0]/v[0], u[1]/v[1]);\r\n}\r\n\r\nfunction sglDivV2S(v, s) {\r\n\treturn sglV2C(v[0]/s, v[1]/s);\r\n}\r\n\r\nfunction sglDivSV2(s, v) {\r\n\treturn sglV2C(s/v[0], s/v[1]);\r\n}\r\n\r\nfunction sglRcpV2(v) {\r\n\treturn sglDivSV2(1.0, v);\r\n}\r\n\r\nfunction sglDotV2(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1]);\r\n}\r\n\r\nfunction sglCrossV2(u, v) {\r\n\treturn (u[0]*v[1] - u[1]*v[0]);\r\n}\r\n\r\nfunction sglSqLengthV2(v) {\r\n\treturn sglDotV2(v, v);\r\n}\r\n\r\nfunction sglLengthV2(v) {\r\n\treturn sglSqrt(sglSqLengthV2(v));\r\n}\r\n\r\nfunction sglNormalizedV2(v) {\r\n\tvar f = 1.0 / sglLengthV2(v);\r\n\treturn sglMulV2S(v, f);\r\n}\r\n\r\nfunction sglSelfNegV2(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV2(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV2S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV2(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV2(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV2S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV2(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV2(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV2S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV2(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV2(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV2S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV2(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV2(v) {\r\n\treturn sglSelfDivSV2(1.0, v);\r\n}\r\n\r\nfunction sglSelfNormalizeV2(v) {\r\n\tvar f = 1.0 / sglLengthV2(v);\r\n\treturn sglSelfMulV2S(v, f);\r\n}\r\n\r\nfunction sglMinV2(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV2(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1]))\r\n\t];\r\n}\r\n\r\nfunction sglV2toV3(v, z) {\r\n\treturn sglV3C(v[0], v[1], z);\r\n}\r\n\r\nfunction sglV2toV4(v, z, w) {\r\n\treturn sglV4C(v[0], v[1], z, w);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 3-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV3(v) {\r\n\treturn new Array(3);\r\n}\r\n\r\nfunction sglV3V(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n\r\nfunction sglV3S(s) {\r\n\treturn [ s, s, s ];\r\n}\r\n\r\nfunction sglV3C(x, y, z) {\r\n\treturn [ x, y, z ];\r\n}\r\n\r\nfunction sglZeroV3() {\r\n\treturn sglV3S(0.0);\r\n}\r\n\r\nfunction sglOneV3() {\r\n\treturn sglV3S(1.0);\r\n}\r\n\r\nfunction sglV3() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV3V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV3S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 3:\r\n\t\t\treturn sglV3V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV3();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV3(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n\r\nfunction sglNegV3(v) {\r\n\treturn sglV3C(-v[0], -v[1], -v[2]);\r\n}\r\n\r\nfunction sglAddV3(u, v) {\r\n\treturn sglV3C(u[0]+v[0], u[1]+v[1], u[2]+v[2]);\r\n}\r\n\r\nfunction sglAddV3S(v, s) {\r\n\treturn sglV3C(v[0]+s, v[1]+s, v[2]+s);\r\n}\r\n\r\nfunction sglAddSV3(s, v) {\r\n\treturn sglAddV3S(v, s)\r\n}\r\n\r\nfunction sglSubV3(u, v) {\r\n\treturn sglV3C(u[0]-v[0], u[1]-v[1], u[2]-v[2]);\r\n}\r\n\r\nfunction sglSubV3S(v, s) {\r\n\treturn sglV3C(v[0]-s, v[1]-s, v[2]-s);\r\n}\r\n\r\nfunction sglSubSV3(v, s) {\r\n\treturn sglV3C(s-v[0], s-v[1], s-v[2]);\r\n}\r\n\r\nfunction sglMulV3(u, v) {\r\n\treturn sglV3C(u[0]*v[0], u[1]*v[1], u[2]*v[2]);\r\n}\r\n\r\nfunction sglMulV3S(v, s) {\r\n\treturn sglV3C(v[0]*s, v[1]*s, v[2]*s);\r\n}\r\n\r\nfunction sglMulSV3(s, v) {\r\n\treturn sglMulV3S(v, s);\r\n}\r\n\r\nfunction sglDivV3(u, v) {\r\n\treturn sglV3C(u[0]/v[0], u[1]/v[1], u[2]/v[2]);\r\n}\r\n\r\nfunction sglDivV3S(v, s) {\r\n\treturn sglV3C(v[0]/s, v[1]/s, v[2]/s);\r\n}\r\n\r\nfunction sglDivSV3(s, v) {\r\n\treturn sglV3C(s/v[0], s/v[1], s/v[2]);\r\n}\r\n\r\nfunction sglRcpV3(v) {\r\n\treturn sglDivSV3(1.0, v);\r\n}\r\n\r\nfunction sglDotV3(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1] + u[2]*v[2]);\r\n}\r\n\r\nfunction sglCrossV3(u, v) {\r\n\treturn sglV3C(u[1]*v[2] - u[2]*v[1], u[2]*v[0] - u[0]*v[2], u[0]*v[1] - u[1]*v[0]);\r\n}\r\n\r\nfunction sglSqLengthV3(v) {\r\n\treturn sglDotV3(v, v);\r\n}\r\n\r\nfunction sglLengthV3(v) {\r\n\treturn sglSqrt(sglSqLengthV3(v));\r\n}\r\n\r\nfunction sglNormalizedV3(v) {\r\n\tvar f = 1.0 / sglLengthV3(v);\r\n\treturn sglMulV3S(v, f);\r\n}\r\n\r\nfunction sglSelfNegV3(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\tv[2] = -v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV3(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\tu[2] += v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV3S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV3(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV3(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\tu[2] -= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV3S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\tv[2] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV3(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\tv[2] = s - v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV3(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\tu[2] *= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV3S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV3(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV3(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\tu[2] /= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV3S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\tu[2] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV3(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\tv[2] = s / v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV3(v) {\r\n\treturn sglSelfDivSV3(1.0, v);\r\n}\r\n\r\nfunction sglSelfCrossV3(u, v) {\r\n\tvar t = sglV3C(u[1]*v[2] - u[2]*v[1], u[2]*v[0] - u[0]*v[2], u[0]*v[1] - u[1]*v[0]);\r\n\tu[0] = t[0];\r\n\tu[1] = t[1];\r\n\tu[2] = t[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfNormalizeV3(v) {\r\n\tvar f = 1.0 / sglLengthV3(v);\r\n\treturn sglSelfMulV3S(v, f);\r\n}\r\n\r\nfunction sglMinV3(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] < v[2]) ? (u[2]) : (v[2]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV3(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] > v[2]) ? (u[2]) : (v[2]))\r\n\t];\r\n}\r\n\r\nfunction sglV3toV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV3toV4(v, w) {\r\n\treturn sglV4C(v[0], v[1], v[2], w);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 4-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV4(v) {\r\n\treturn new Array(4);\r\n}\r\n\r\nfunction sglV4V(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglV4S(s) {\r\n\treturn [ s, s, s, s ];\r\n}\r\n\r\nfunction sglV4C(x, y, z, w) {\r\n\treturn [ x, y, z, w ];\r\n}\r\n\r\nfunction sglZeroV4() {\r\n\treturn sglV4S(0.0);\r\n}\r\n\r\nfunction sglOneV4() {\r\n\treturn sglV4S(1.0);\r\n}\r\n\r\nfunction sglV4() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV4V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV4S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 4:\r\n\t\t\treturn sglV4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV4();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV4(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglNegV4(v) {\r\n\treturn sglV4C(-v[0], -v[1], -v[2], -v[3]);\r\n}\r\n\r\nfunction sglAddV4(u, v) {\r\n\treturn sglV4C(u[0]+v[0], u[1]+v[1], u[2]+v[2], u[3]+v[3]);\r\n}\r\n\r\nfunction sglAddV4S(v, s) {\r\n\treturn sglV4C(v[0]+s, v[1]+s, v[2]+s, v[3]+s);\r\n}\r\n\r\nfunction sglAddSV4(s, v) {\r\n\treturn sglAddV4S(v, s)\r\n}\r\n\r\nfunction sglSubV4(u, v) {\r\n\treturn sglV4C(u[0]-v[0], u[1]-v[1], u[2]-v[2], u[3]-v[3]);\r\n}\r\n\r\nfunction sglSubV4S(v, s) {\r\n\treturn sglV4C(v[0]-s, v[1]-s, v[2]-s, v[3]-s);\r\n}\r\n\r\nfunction sglSubSV4(v, s) {\r\n\treturn sglV4C(s-v[0], s-v[1], s-v[2], s-v[3]);\r\n}\r\n\r\nfunction sglMulV4(u, v) {\r\n\treturn sglV4C(u[0]*v[0], u[1]*v[1], u[2]*v[2], u[3]*v[3]);\r\n}\r\n\r\nfunction sglMulV4S(v, s) {\r\n\treturn sglV4C(v[0]*s, v[1]*s, v[2]*s, v[3]*s);\r\n}\r\n\r\nfunction sglMulSV4(s, v) {\r\n\treturn sglMulV4S(v, s);\r\n}\r\n\r\nfunction sglDivV4(u, v) {\r\n\treturn sglV4C(u[0]/v[0], u[1]/v[1], u[2]/v[2], u[3]/v[3]);\r\n}\r\n\r\nfunction sglDivV4S(v, s) {\r\n\treturn sglV4C(v[0]/s, v[1]/s, v[2]/s, v[3]/s);\r\n}\r\n\r\nfunction sglDivSV4(s, v) {\r\n\treturn sglV4C(s/v[0], s/v[1], s/v[2], s/v[3]);\r\n}\r\n\r\nfunction sglRcpV4(v) {\r\n\treturn sglDivSV4(1.0, v);\r\n}\r\n\r\nfunction sglDotV4(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1] + u[2]*v[2] + u[3]*v[3]);\r\n}\r\n\r\nfunction sglSqLengthV4(v) {\r\n\treturn sglDotV4(v, v);\r\n}\r\n\r\nfunction sglLengthV4(v) {\r\n\treturn sglSqrt(sglSqLengthV4(v));\r\n}\r\n\r\nfunction sglNormalizedV4(v) {\r\n\tvar f = 1.0 / sglLengthV4(v);\r\n\treturn sglMulV4S(v, f);\r\n}\r\n\r\nfunction sglProjectV4(v) {\r\n\tvar f = 1.0 / v[3];\r\n\treturn sglV4C(v[0]*f, v[1]*f, v[2]*f, 1.0);\r\n}\r\n\r\nfunction sglSelfNegV4(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\tv[2] = -v[2];\r\n\tv[3] = -v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV4(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\tu[2] += v[2];\r\n\tu[3] += v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV4S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\tv[3] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV4(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\tv[3] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV4(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\tu[2] -= v[2];\r\n\tu[3] -= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV4S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\tv[2] -= s;\r\n\tv[3] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV4(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\tv[2] = s - v[2];\r\n\tv[3] = s - v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV4(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\tu[2] *= v[2];\r\n\tu[3] *= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV4S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\tv[3] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV4(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\tv[3] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV4(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\tu[2] /= v[2];\r\n\tu[3] /= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV4S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\tu[2] /= s;\r\n\tu[3] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV4(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\tv[2] = s / v[2];\r\n\tv[3] = s / v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV4(v) {\r\n\treturn sglSelfDivSV4(1.0, v);\r\n}\r\n\r\nfunction sglSelfNormalizeV4(v) {\r\n\tvar f = 1.0 / sglLengthV4(v);\r\n\treturn sglSelfMulV4S(v, f);\r\n}\r\n\r\nfunction sglSelfProjectV4(v) {\r\n\tvar f = 1.0 / v[3];\r\n\tv[0] *= f;\r\n\tv[1] *= f;\r\n\tv[2] *= f;\r\n\tv[3]  = 1.0;\r\n\treturn v;\r\n}\r\n\r\nfunction sglMinV4(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] < v[2]) ? (u[2]) : (v[2])),\r\n\t\t((u[3] < v[3]) ? (u[3]) : (v[3]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV4(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] > v[2]) ? (u[2]) : (v[2])),\r\n\t\t((u[3] > v[3]) ? (u[3]) : (v[3]))\r\n\t];\r\n}\r\n\r\nfunction sglV4toV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV4toV3(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 4x4 matrix\r\n/***********************************************************************/\r\nfunction sglUndefM4() {\r\n\treturn new Array(16);\r\n}\r\n\r\nfunction sglM4V(v) {\r\n\treturn v.slice(0, 16);\r\n}\r\n\r\nfunction sglM4S(s) {\r\n\tvar m = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tm[i] = s;\r\n\t}\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4V(d) {\r\n\tvar m = sglM4S(0.0);\r\n\tm[ 0] = d[0];\r\n\tm[ 5] = d[1];\r\n\tm[10] = d[2];\r\n\tm[15] = d[3];\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4S(s) {\r\n\tvar m = sglM4S(0.0);\r\n\tm[ 0] = s;\r\n\tm[ 5] = s;\r\n\tm[10] = s;\r\n\tm[15] = s;\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4C(m00, m11, m22, m33) {\r\n\treturn sglDiagM4V(arguments);\r\n}\r\n\r\nfunction sglZeroM4() {\r\n\treturn sglM4S(0.0);\r\n}\r\n\r\nfunction sglOneM4() {\r\n\treturn sglM4S(1.0);\r\n}\r\n\r\nfunction sglIdentityM4() {\r\n\treturn sglDiagM4S(1.0);\r\n}\r\n\r\nfunction sglM4() {\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tswitch (arguments[0].length) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\treturn sglDiagM4S(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\treturn sglDiagM4V(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 16:\r\n\t\t\t\t\t\treturn sglM4V(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn sglIdentityM4();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn sglM4S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 4:\r\n\t\t\treturn sglDiagM4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tcase 16:\r\n\t\t\treturn sglM4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglIdentityM4();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupM4(m) {\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = m[ 0];\r\n\tr[ 1] = m[ 1];\r\n\tr[ 2] = m[ 2];\r\n\tr[ 3] = m[ 3];\r\n\r\n\tr[ 4] = m[ 4];\r\n\tr[ 5] = m[ 5];\r\n\tr[ 6] = m[ 6];\r\n\tr[ 7] = m[ 7];\r\n\r\n\tr[ 8] = m[ 8];\r\n\tr[ 9] = m[ 9];\r\n\tr[10] = m[10];\r\n\tr[11] = m[11];\r\n\r\n\tr[12] = m[12];\r\n\tr[13] = m[13];\r\n\tr[14] = m[14];\r\n\tr[15] = m[15];\r\n\r\n\treturn r;\r\n\r\n\t//return m.slice(0, 16);\r\n\t//return m.slice();\r\n}\r\n\r\nfunction sglGetElemM4(m, row, col) {\r\n\treturn m[row+col*4];\r\n}\r\n\r\nfunction sglSetElemM4(m, row, col, value) {\r\n\tm[row+col*4] = value;\r\n}\r\n\r\nfunction sglGetRowM4(m, r) {\r\n\treturn sglV4C(m[r+0], m[r+4], m[r+8], m[r+12]);\r\n}\r\n\r\nfunction sglSetRowM4V(m, r, v) {\r\n\tm[r+ 0] = v[0];\r\n\tm[r+ 4] = v[1];\r\n\tm[r+ 8] = v[2];\r\n\tm[r+12] = v[3];\r\n}\r\n\r\nfunction sglSetRowM4S(m, r, s) {\r\n\tm[r+ 0] = s;\r\n\tm[r+ 4] = s;\r\n\tm[r+ 8] = s;\r\n\tm[r+12] = s;\r\n}\r\n\r\nfunction sglSetRowM4C(m, r, x, y, z, w) {\r\n\tm[r+ 0] = x;\r\n\tm[r+ 4] = y;\r\n\tm[r+ 8] = z;\r\n\tm[r+12] = w;\r\n}\r\n\r\nfunction sglGetColM4(m, c) {\r\n\tvar i = c * 4;\r\n\treturn sglV4C(m[i+0], m[i+1], m[i+2], m[i+3]);\r\n}\r\n\r\nfunction sglSetColM4V(m, c, v) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = v[0];\r\n\tm[i+1] = v[1];\r\n\tm[i+2] = v[2];\r\n\tm[i+3] = v[3];\r\n}\r\n\r\nfunction sglSetColM4S(m, c, s) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = s;\r\n\tm[i+1] = s;\r\n\tm[i+2] = s;\r\n\tm[i+3] = s;\r\n}\r\n\r\nfunction sglSetColM4C(m, c, x, y, z, w) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = x;\r\n\tm[i+1] = y;\r\n\tm[i+2] = z;\r\n\tm[i+3] = w;\r\n}\r\n\r\nfunction sglM4toM3(m) {\r\n\treturn [\r\n\t\tm[ 0], m[ 1], m[ 2],\r\n\t\tm[ 4], m[ 5], m[ 6],\r\n\t\tm[ 8], m[ 9], m[10]\r\n\t];\r\n}\r\n\r\nfunction sglIsIdentityM4(m) {\r\n\tvar i = 0;\r\n\tvar j = 0;\r\n\tvar s = 0.0;\r\n\tfor (i=0; i<4; ++i) {\r\n\t\tfor (j=0; j<4; ++j) {\r\n\t\t\ts = m[i+j*4];\r\n\t\t\tif ((i == j)) {\r\n\t\t\t\tif (s != 1.0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (s != 0.0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction sglNegM4(m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = -m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] + b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddM4S(m, s)\r\n{\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] + s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddSM4(s, m) {\r\n\treturn sglAddM4S(m, s);\r\n}\r\n\r\nfunction sglSubM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] - b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglSubM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] - s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglSubSM4(s, m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = s - m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglMulM4(a, b) {\r\n\tvar a0  = a[ 0], a1  = a[ 1],  a2 = a[ 2], a3  = a[ 3],\r\n\t    a4  = a[ 4], a5  = a[ 5],  a6 = a[ 6], a7  = a[ 7],\r\n\t    a8  = a[ 8], a9  = a[ 9], a10 = a[10], a11 = a[11],\r\n\t    a12 = a[12], a13 = a[13], a14 = a[14], a15 = a[15],\r\n\r\n\t    b0  = b[ 0], b1  = b[ 1], b2  = b[ 2], b3  = b[ 3],\r\n\t    b4  = b[ 4], b5  = b[ 5], b6  = b[ 6], b7  = b[ 7],\r\n\t    b8  = b[ 8], b9  = b[ 9], b10 = b[10], b11 = b[11],\r\n\t    b12 = b[12], b13 = b[13], b14 = b[14], b15 = b[15];\r\n\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = a0*b0 + a4*b1 + a8*b2  + a12*b3;\r\n\tr[ 1] = a1*b0 + a5*b1 + a9*b2  + a13*b3;\r\n\tr[ 2] = a2*b0 + a6*b1 + a10*b2 + a14*b3;\r\n\tr[ 3] = a3*b0 + a7*b1 + a11*b2 + a15*b3;\r\n\r\n\tr[ 4] = a0*b4 + a4*b5 + a8*b6  + a12*b7;\r\n\tr[ 5] = a1*b4 + a5*b5 + a9*b6  + a13*b7;\r\n\tr[ 6] = a2*b4 + a6*b5 + a10*b6 + a14*b7;\r\n\tr[ 7] = a3*b4 + a7*b5 + a11*b6 + a15*b7;\r\n\r\n\tr[ 8] = a0*b8 + a4*b9 + a8*b10  + a12*b11;\r\n\tr[ 9] = a1*b8 + a5*b9 + a9*b10  + a13*b11;\r\n\tr[10] = a2*b8 + a6*b9 + a10*b10 + a14*b11;\r\n\tr[11] = a3*b8 + a7*b9 + a11*b10 + a15*b11;\r\n\r\n\tr[12] = a0*b12 + a4*b13 + a8*b14  + a12*b15;\r\n\tr[13] = a1*b12 + a5*b13 + a9*b14  + a13*b15;\r\n\tr[14] = a2*b12 + a6*b13 + a10*b14 + a14*b15;\r\n\tr[15] = a3*b12 + a7*b13 + a11*b14 + a15*b15;\r\n\r\n\t/*\r\n\tr[ 0] = a[ 0]*b[ 0] + a[ 4]*b[ 1] + a[ 8]*b[ 2] + a[12]*b[ 3];\r\n\tr[ 1] = a[ 1]*b[ 0] + a[ 5]*b[ 1] + a[ 9]*b[ 2] + a[13]*b[ 3];\r\n\tr[ 2] = a[ 2]*b[ 0] + a[ 6]*b[ 1] + a[10]*b[ 2] + a[14]*b[ 3];\r\n\tr[ 3] = a[ 3]*b[ 0] + a[ 7]*b[ 1] + a[11]*b[ 2] + a[15]*b[ 3];\r\n\r\n\tr[ 4] = a[ 0]*b[ 4] + a[ 4]*b[ 5] + a[ 8]*b[ 6] + a[12]*b[ 7];\r\n\tr[ 5] = a[ 1]*b[ 4] + a[ 5]*b[ 5] + a[ 9]*b[ 6] + a[13]*b[ 7];\r\n\tr[ 6] = a[ 2]*b[ 4] + a[ 6]*b[ 5] + a[10]*b[ 6] + a[14]*b[ 7];\r\n\tr[ 7] = a[ 3]*b[ 4] + a[ 7]*b[ 5] + a[11]*b[ 6] + a[15]*b[ 7];\r\n\r\n\tr[ 8] = a[ 0]*b[ 8] + a[ 4]*b[ 9] + a[ 8]*b[10] + a[12]*b[11];\r\n\tr[ 9] = a[ 1]*b[ 8] + a[ 5]*b[ 9] + a[ 9]*b[10] + a[13]*b[11];\r\n\tr[10] = a[ 2]*b[ 8] + a[ 6]*b[ 9] + a[10]*b[10] + a[14]*b[11];\r\n\tr[11] = a[ 3]*b[ 8] + a[ 7]*b[ 9] + a[11]*b[10] + a[15]*b[11];\r\n\r\n\tr[12] = a[ 0]*b[12] + a[ 4]*b[13] + a[ 8]*b[14] + a[12]*b[15];\r\n\tr[13] = a[ 1]*b[12] + a[ 5]*b[13] + a[ 9]*b[14] + a[13]*b[15];\r\n\tr[14] = a[ 2]*b[12] + a[ 6]*b[13] + a[10]*b[14] + a[14]*b[15];\r\n\tr[15] = a[ 3]*b[12] + a[ 7]*b[13] + a[11]*b[14] + a[15]*b[15];\r\n\t*/\r\n\r\n\treturn r;\r\n\r\n\t/*\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = a[ 0]*b[ 0] + a[ 4]*b[ 1] + a[ 8]*b[ 2] + a[12]*b[ 3];\r\n\tr[ 1] = a[ 1]*b[ 0] + a[ 5]*b[ 1] + a[ 9]*b[ 2] + a[13]*b[ 3];\r\n\tr[ 2] = a[ 2]*b[ 0] + a[ 6]*b[ 1] + a[10]*b[ 2] + a[14]*b[ 3];\r\n\tr[ 3] = a[ 3]*b[ 0] + a[ 7]*b[ 1] + a[11]*b[ 2] + a[15]*b[ 3];\r\n\r\n\tr[ 4] = a[ 0]*b[ 4] + a[ 4]*b[ 5] + a[ 8]*b[ 6] + a[12]*b[ 7];\r\n\tr[ 5] = a[ 1]*b[ 4] + a[ 5]*b[ 5] + a[ 9]*b[ 6] + a[13]*b[ 7];\r\n\tr[ 6] = a[ 2]*b[ 4] + a[ 6]*b[ 5] + a[10]*b[ 6] + a[14]*b[ 7];\r\n\tr[ 7] = a[ 3]*b[ 4] + a[ 7]*b[ 5] + a[11]*b[ 6] + a[15]*b[ 7];\r\n\r\n\tr[ 8] = a[ 0]*b[ 8] + a[ 4]*b[ 9] + a[ 8]*b[10] + a[12]*b[11];\r\n\tr[ 9] = a[ 1]*b[ 8] + a[ 5]*b[ 9] + a[ 9]*b[10] + a[13]*b[11];\r\n\tr[10] = a[ 2]*b[ 8] + a[ 6]*b[ 9] + a[10]*b[10] + a[14]*b[11];\r\n\tr[11] = a[ 3]*b[ 8] + a[ 7]*b[ 9] + a[11]*b[10] + a[15]*b[11];\r\n\r\n\tr[12] = a[ 0]*b[12] + a[ 4]*b[13] + a[ 8]*b[14] + a[12]*b[15];\r\n\tr[13] = a[ 1]*b[12] + a[ 5]*b[13] + a[ 9]*b[14] + a[13]*b[15];\r\n\tr[14] = a[ 2]*b[12] + a[ 6]*b[13] + a[10]*b[14] + a[14]*b[15];\r\n\tr[15] = a[ 3]*b[12] + a[ 7]*b[13] + a[11]*b[14] + a[15]*b[15];\r\n\r\n\treturn r;\r\n\t*/\r\n}\r\n\r\nfunction sglMulM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] * s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglMulSM4(s, m) {\r\n\treturn sglMulM4S(m, s);\r\n}\r\n\r\nfunction sglMulM4V3(m, v, w) {\r\n\treturn [\r\n\t\tm[ 0] * v[0] + m[ 4] * v[1] + m[ 8] * v[2] + m[12] * w,\r\n\t\tm[ 1] * v[0] + m[ 5] * v[1] + m[ 9] * v[2] + m[13] * w,\r\n\t\tm[ 2] * v[0] + m[ 6] * v[1] + m[10] * v[2] + m[14] * w /* ,\r\n\t\tm[ 3] * v[0] + m[ 7] * v[1] + m[11] * v[2] + m[15] * w*/\r\n\t];\r\n}\r\n\r\nfunction sglMulM4V4(m, v) {\r\n\treturn [\r\n\t\tm[ 0] * v[0] + m[ 4] * v[1] + m[ 8] * v[2] + m[12] * v[3],\r\n\t\tm[ 1] * v[0] + m[ 5] * v[1] + m[ 9] * v[2] + m[13] * v[3],\r\n\t\tm[ 2] * v[0] + m[ 6] * v[1] + m[10] * v[2] + m[14] * v[3],\r\n\t\tm[ 3] * v[0] + m[ 7] * v[1] + m[11] * v[2] + m[15] * v[3]\r\n\t];\r\n}\r\n\r\nfunction sglDivM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] / s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglDivSM4(s, m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = s / m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglRcpM4(m) {\r\n\treturn sglDivSM4(1.0, m);\r\n}\r\n\r\nfunction sglCompMulM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] * b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglCompDivM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] / b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglTransposeM4(m) {\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = m[ 0];\r\n\tr[ 1] = m[ 4];\r\n\tr[ 2] = m[ 8];\r\n\tr[ 3] = m[12];\r\n\t\r\n\tr[ 4] = m[ 1];\r\n\tr[ 5] = m[ 5];\r\n\tr[ 6] = m[ 9];\r\n\tr[ 7] = m[13];\r\n\t\r\n\tr[ 8] = m[ 2];\r\n\tr[ 9] = m[ 6];\r\n\tr[10] = m[10];\r\n\tr[11] = m[14];\r\n\t\r\n\tr[12] = m[ 3];\r\n\tr[13] = m[ 7];\r\n\tr[14] = m[11];\r\n\tr[15] = m[15];\r\n\t\r\n\treturn r;\r\n}\r\n\r\nfunction sglDeterminantM4(m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15]\r\n\r\n\treturn (\r\n\t\tm12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t\tm8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t\tm12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t\tm12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t\tm4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t\tm8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15\r\n\t);\r\n}\r\n\r\nfunction sglInverseM4(m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15]\r\n\r\n\tvar t = sglUndefM4();\r\n\r\n\tt[ 0] = (m9*m14*m7-m13*m10*m7+m13*m6*m11-m5*m14*m11-m9*m6*m15+m5*m10*m15);\r\n\tt[ 1] = (m13*m10*m3-m9*m14*m3-m13*m2*m11+m1*m14*m11+m9*m2*m15-m1*m10*m15);\r\n\tt[ 2] = (m5*m14*m3-m13*m6*m3+m13*m2*m7-m1*m14*m7-m5*m2*m15+m1*m6*m15);\r\n\tt[ 3] = (m9*m6*m3-m5*m10*m3-m9*m2*m7+m1*m10*m7+m5*m2*m11-m1*m6*m11);\r\n\r\n\tt[ 4] = (m12*m10*m7-m8*m14*m7-m12*m6*m11+m4*m14*m11+m8*m6*m15-m4*m10*m15);\r\n\tt[ 5] = (m8*m14*m3-m12*m10*m3+m12*m2*m11-m0*m14*m11-m8*m2*m15+m0*m10*m15);\r\n\tt[ 6] = (m12*m6*m3-m4*m14*m3-m12*m2*m7+m0*m14*m7+m4*m2*m15-m0*m6*m15);\r\n\tt[ 7] = (m4*m10*m3-m8*m6*m3+m8*m2*m7-m0*m10*m7-m4*m2*m11+m0*m6*m11);\r\n\r\n\tt[ 8] = (m8*m13*m7-m12*m9*m7+m12*m5*m11-m4*m13*m11-m8*m5*m15+m4*m9*m15);\r\n\tt[ 9] = (m12*m9*m3-m8*m13*m3-m12*m1*m11+m0*m13*m11+m8*m1*m15-m0*m9*m15);\r\n\tt[10] = (m4*m13*m3-m12*m5*m3+m12*m1*m7-m0*m13*m7-m4*m1*m15+m0*m5*m15);\r\n\tt[11] = (m8*m5*m3-m4*m9*m3-m8*m1*m7+m0*m9*m7+m4*m1*m11-m0*m5*m11);\r\n\r\n\tt[12] = (m12*m9*m6-m8*m13*m6-m12*m5*m10+m4*m13*m10+m8*m5*m14-m4*m9*m14);\r\n\tt[13] = (m8*m13*m2-m12*m9*m2+m12*m1*m10-m0*m13*m10-m8*m1*m14+m0*m9*m14);\r\n\tt[14] = (m12*m5*m2-m4*m13*m2-m12*m1*m6+m0*m13*m6+m4*m1*m14-m0*m5*m14);\r\n\tt[15] = (m4*m9*m2-m8*m5*m2+m8*m1*m6-m0*m9*m6-m4*m1*m10+m0*m5*m10);\r\n\r\n\tvar s = 1.0 / (\r\n\t\tm12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t\tm8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t\tm12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t\tm12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t\tm4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t\tm8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15\r\n\t);\r\n\r\n\tfor (var i=0; i<16; ++i) t[i] *= s;\r\n\r\n\treturn t;\r\n}\r\n\r\nfunction sglTraceM4(m) {\r\n\treturn (m[0] + m[5] + m[10] + m[15]);\r\n}\r\n\r\nfunction sglTranslationM4V(v) {\r\n\tvar m = sglIdentityM4();\r\n\tm[12] = v[0];\r\n\tm[13] = v[1];\r\n\tm[14] = v[2];\r\n\treturn m;\r\n}\r\n\r\nfunction sglTranslationM4C(x, y, z) {\r\n\treturn sglTranslationM4V([x, y, z]);\r\n}\r\n\r\nfunction sglTranslationM4S(s) {\r\n\treturn sglTranslationM4C(s, s, s);\r\n}\r\n\r\nfunction sglRotationAngleAxisM4V(angleRad, axis) {\r\n\tvar ax = sglNormalizedV3(axis);\r\n\tvar s  = sglSin(angleRad);\r\n\tvar c  = sglCos(angleRad);\r\n\tvar q   = 1.0 - c;\r\n\r\n\tvar x = ax[0];\r\n\tvar y = ax[1];\r\n\tvar z = ax[2];\r\n\r\n\tvar xx, yy, zz, xy, yz, zx, xs, ys, zs;\r\n\r\n\txx = x * x;\r\n\tyy = y * y;\r\n\tzz = z * z;\r\n\txy = x * y;\r\n\tyz = y * z;\r\n\tzx = z * x;\r\n\txs = x * s;\r\n\tys = y * s;\r\n\tzs = z * s;\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] = (q * xx) + c;\r\n\tm[ 1] = (q * xy) + zs;\r\n\tm[ 2] = (q * zx) - ys;\r\n\tm[ 3] = 0.0;\r\n\r\n\tm[ 4] = (q * xy) - zs;\r\n\tm[ 5] = (q * yy) + c;\r\n\tm[ 6] = (q * yz) + xs;\r\n\tm[ 7] = 0.0;\r\n\r\n\tm[ 8] = (q * zx) + ys;\r\n\tm[ 9] = (q * yz) - xs;\r\n\tm[10] = (q * zz) + c;\r\n\tm[11] = 0.0;\r\n\r\n\tm[12] = 0.0;\r\n\tm[13] = 0.0;\r\n\tm[14] = 0.0;\r\n\tm[15] = 1.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglRotationAngleAxisM4C(angleRad, ax, ay, az) {\r\n\treturn sglRotationAngleAxisM4V(angleRad, [ax, ay, az]);\r\n}\r\n\r\nfunction sglScalingM4V(v) {\r\n\tvar m = sglIdentityM4();\r\n\tm[ 0] = v[0];\r\n\tm[ 5] = v[1];\r\n\tm[10] = v[2];\r\n\treturn m;\r\n}\r\n\r\nfunction sglScalingM4C(x, y, z) {\r\n\treturn sglScalingM4V([x, y, z]);\r\n}\r\n\r\nfunction sglScalingM4S(s) {\r\n\treturn sglScalingM4C(s, s, s);\r\n}\r\n\r\nfunction sglLookAtM4V(position, target, up) {\r\n\tvar v = sglNormalizedV3(sglSubV3(target, position));\r\n\tvar u = sglNormalizedV3(up);\r\n\tvar s = sglNormalizedV3(sglCrossV3(v, u));\r\n\r\n\tu = sglNormalizedV3(sglCrossV3(s, v));\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] =  s[0];\r\n\tm[ 1] =  u[0];\r\n\tm[ 2] = -v[0];\r\n\tm[ 3] =   0.0;\r\n\r\n\tm[ 4] =  s[1];\r\n\tm[ 5] =  u[1];\r\n\tm[ 6] = -v[1];\r\n\tm[ 7] =   0.0;\r\n\r\n\tm[ 8] =  s[2];\r\n\tm[ 9] =  u[2];\r\n\tm[10] = -v[2];\r\n\tm[11] =   0.0;\r\n\r\n\tm[12] =   0.0;\r\n\tm[13] =   0.0;\r\n\tm[14] =   0.0;\r\n\tm[15] =   1.0;\r\n\r\n\tm = sglMulM4(m, sglTranslationM4V(sglNegV3(position)));\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglLookAtM4C(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ) {\r\n\treturn sglLookAtM4V([positionX, positionY, positionZ], [targetX, targetY, targetZ], [upX, upY, upZ]);\r\n}\r\n\r\nfunction sglOrthoM4V(omin, omax) {\r\n\tvar sum   = sglAddV3(omax, omin);\r\n\tvar dif   = sglSubV3(omax, omin);\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] =      2.0 / dif[0];\r\n\tm[ 1] =               0.0;\r\n\tm[ 2] =               0.0;\r\n\tm[ 3] =               0.0;\r\n\r\n\tm[ 4] =               0.0;\r\n\tm[ 5] =      2.0 / dif[1];\r\n\tm[ 6] =               0.0;\r\n\tm[ 7] =               0.0;\r\n\r\n\tm[ 8] =               0.0;\r\n\tm[ 9] =               0.0;\r\n\tm[10] =     -2.0 / dif[2];\r\n\tm[11] =                 0.0;\r\n\r\n\tm[12] =  -sum[0] / dif[0];\r\n\tm[13] =  -sum[1] / dif[1];\r\n\tm[14] =  -sum[2] / dif[2];\r\n\tm[15] =               1.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglOrthoM4C(left, right, bottom, top, zNear, zFar) {\r\n\treturn sglOrthoM4V([left, bottom, zNear], [right, top, zFar]);\r\n}\r\n\r\nfunction sglFrustumM4V(fmin, fmax) {\r\n\tvar sum   = sglAddV3(fmax, fmin);\r\n\tvar dif   = sglSubV3(fmax, fmin);\r\n\tvar t     = 2.0 * fmin[2];\r\n\r\n\tvar m = sglUndefM4();\r\n\t\r\n\tm[ 0] =            t / dif[0];\r\n\tm[ 1] =                   0.0;\r\n\tm[ 2] =                   0.0;\r\n\tm[ 3] =                   0.0;\r\n\r\n\tm[ 4] =                   0.0;\r\n\tm[ 5] =            t / dif[1];\r\n\tm[ 6] =                   0.0;\r\n\tm[ 7] =                   0.0;\r\n\r\n\tm[ 8] =       sum[0] / dif[0];\r\n\tm[ 9] =       sum[1] / dif[1];\r\n\tm[10] =      -sum[2] / dif[2];\r\n\tm[11] =                  -1.0;\r\n\r\n\tm[12] =                   0.0;\r\n\tm[13] =                   0.0;\r\n\tm[14] = -t * fmax[2] / dif[2];\r\n\tm[15] =                   0.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglFrustumM4C(left, right, bottom, top, zNear, zFar) {\r\n\treturn sglFrustumM4V([left, bottom, zNear], [right, top, zFar]);\r\n}\r\n\r\nfunction sglPerspectiveM4(fovYRad, aspectRatio, zNear, zFar) {\r\n\tvar pmin = sglUndefV4();\r\n\tvar pmax = sglUndefV4();\r\n\r\n\tpmin[2] = zNear;\r\n\tpmax[2] = zFar;\r\n\r\n\tpmax[1] = pmin[2] * sglTan(fovYRad / 2.0);\r\n\tpmin[1] = -pmax[1];\r\n\r\n\tpmax[0] = pmax[1] * aspectRatio;\r\n\tpmin[0] = -pmax[0];\r\n\r\n\treturn sglFrustumM4V(pmin, pmax);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// quaternion\r\n/***********************************************************************/\r\nfunction sglUndefQuat(v) {\r\n\treturn new Array(4);\r\n}\r\n\r\nfunction sglQuatV(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglIdentityQuat() {\r\n\treturn [ 0.0, 0.0, 0.0, 1.0 ];\r\n}\r\n\r\nfunction sglAngleAxisQuat(angleRad, axis) {\r\n\tvar halfAngle = angleRad / 2.0;\r\n\tvar fsin = sglSin(halfAngle);\r\n\treturn [\r\n\t\tfsin * axis[0],\r\n\t\tfsin * axis[1],\r\n\t\tfsin * axis[2],\r\n\t\tsglCos(halfAngle)\r\n\t];\r\n}\r\n\r\nfunction sglM4Quat(m) {\r\n\tvar trace = sglGetElemM4(m, 0, 0) + sglGetElemM4(m, 1, 1) + sglGetElemM4(m, 2, 2);\r\n\tvar root = null;\r\n\tvar q = sglUndefQuat();\r\n\r\n\tif (trace > 0.0) {\r\n\t\troot = sglSqrt(trace + 1.0);\r\n\t\tq[3] = root / 2.0;\r\n\t\troot = 0.5 / root;\r\n\t\tq[0] = (sglGetElemM4(m, 2, 1) - sglGetElemM4(m, 1, 2)) * root;\r\n\t\tq[1] = (sglGetElemM4(m, 0, 2) - sglGetElemM4(m, 2, 0)) * root;\r\n\t\tq[2] = (sglGetElemM4(m, 1, 0) - sglGetElemM4(m, 0, 1)) * root;\r\n\t}\r\n\telse {\r\n\t\tvar i = 0;\r\n\r\n\t\tif (sglGetElemM4(m, 1, 1) > sglGetElemM4(m, 0, 0)) i = 1;\r\n\t\tif (sglGetElemM4(m, 2, 2) > sglGetElemM4(m, i, i)) i = 2;\r\n\r\n\t\tvar j = (i + 1) % 3;\r\n\t\tvar k = (j + 1) % 3;\r\n\r\n\t\troot = sglSqrt(sglGetElemM4(m, i, i) - sglGetElemM4(m, j, j) - sglGetElemM4(m, k, k) + 1.0);\r\n\r\n\t\tq[i] = root / 2.0;\r\n\t\troot = 0.5 / root;\r\n\t\tq[3] = (sglGetElemM4(m, k, j) - sglGetElemM4(m, j, k)) * root;\r\n\t\tq[j] = (sglGetElemM4(m, j, i) + sglGetElemM4(m, i, j)) * root;\r\n\t\tq[k] = (sglGetElemM4(m, k, i) + sglGetElemM4(m, i, k)) * root;\r\n\t}\r\n\treturn q;\r\n}\r\n\r\nfunction sglGetQuatAngleAxis(q) {\r\n\tvar v = new Array(4);\r\n\r\n\tvar sqLen = sglSqLengthV4(q);\r\n\tvar angle = null;\r\n\r\n\tif (sqLen > 0.0) {\r\n\t\tvar invLen = 1.0 / sglSqrt(sqLen);\r\n\t\tv[0] = q[0] * invLen;\r\n\t\tv[1] = q[1] * invLen;\r\n\t\tv[2] = q[2] * invLen;\r\n\t\tv[3] = 2.0 * aglAcos(q[3]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tv[0] = 0.0;\r\n\t\tv[1] = 0.0;\r\n\t\tv[2] = 1.0;\r\n\t\tv[3] = 0.0;\r\n\t}\r\n\r\n\treturn v;\r\n}\r\n\r\nfunction sglGetQuatRotationM4(q) {\r\n\tvar tx  = 2.0 * q[0];\r\n\tvar ty  = 2.0 * q[1];\r\n\tvar tz  = 2.0 * q[2];\r\n\tvar twx = tx * q[3];\r\n\tvar twy = ty * q[3];\r\n\tvar twz = tz * q[3];\r\n\tvar txx = tx * q[0];\r\n\tvar txy = ty * q[0];\r\n\tvar txz = tz * q[0];\r\n\tvar tyy = ty * q[1];\r\n\tvar tyz = tz * q[1];\r\n\tvar tzz = tz * q[2];\r\n\r\n\tvar m = sglIdentityM4();\r\n\r\n\tsglSetElemM4(m, 0, 0, 1.0 - (tyy + tzz));\r\n\tsglSetElemM4(m, 0, 1, txy - twz);\r\n\tsglSetElemM4(m, 0, 2, txz + twy);\r\n\tsglSetElemM4(m, 1, 0, txy + twz);\r\n\tsglSetElemM4(m, 1, 1, 1.0 - (txx + tzz));\r\n\tsglSetElemM4(m, 1, 2, tyz - twx);\r\n\tsglSetElemM4(m, 2, 0, txz - twy);\r\n\tsglSetElemM4(m, 2, 1, tyz + twx);\r\n\tsglSetElemM4(m, 2, 2, 1.0 - (txx + tyy));\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglNormalizedQuat(q) {\r\n\treturn sglNormalizedV4(q);\r\n}\r\n\r\nfunction sglMulQuat(q1, q2) {\r\n\tvar r = sglUndefQuat();\r\n\r\n\tr[0] = p[3] * q[0] + p[0] * q[3] + p[1] * q[2] - p[2] * q[1];\r\n\tr[1] = p[3] * q[1] + p[1] * q[3] + p[2] * q[0] - p[0] * q[2];\r\n\tr[2] = p[3] * q[2] + p[2] * q[3] + p[0] * q[1] - p[1] * q[0];\r\n\tr[3] = p[3] * q[3] - p[0] * q[0] - p[1] * q[1] - p[2] * q[2];\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglVec2\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec2.\r\n * @class 2-dimensional vector.\r\n */\r\nfunction SglVec2() {\r\n\tthis.v = new Array(2);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec2) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 2:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec2.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec2(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\r\n\tset : function(x, y) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec2(-(this.v[0]), -(this.v[1]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec2(sglAbs(this.v[0]), sglAbs(this.v[1]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec2(this.v[0] + v.v[0], this.v[1] + v.v[1]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec2(this.v[0] - v.v[0], this.v[1] - v.v[1]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec2(this.v[0] * v.v[0], this.v[1] * v.v[1]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec2(this.v[0] / v.v[0], this.v[1] / v.v[1]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec2(1.0 / this.v[0], 1.0 / this.v[1]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1]);\r\n\t},\r\n\r\n\tcross : function(v) {\r\n\t\treturn (this.v[0]*v.v[1] - this.v[1]*v.v[0]);\r\n\t},\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec2(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec2(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglVec3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec3.\r\n * @class 3-dimensional vector.\r\n */\r\nfunction SglVec3() {\r\n\tthis.v = new Array(3);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec3) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 3:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec3.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec3(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\tget z( ) { return this.v[2]; },\r\n\tset z(n) { this.v[2] = n;    },\r\n\r\n\tset : function(x, y, z) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\tthis.v[2] = z;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1], v[2]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\tthis.v[2] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec3(-(this.v[0]), -(this.v[1]), -(this.v[2]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec3(sglAbs(this.v[0]), sglAbs(this.v[1]), sglAbs(this.v[2]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\tif (m > this.v[2]) m = this.v[2];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\tif (m < this.v[2]) m = this.v[2];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec3(this.v[0] + v.v[0], this.v[1] + v.v[1], this.v[2] + v.v[2]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec3(this.v[0] - v.v[0], this.v[1] - v.v[1], this.v[2] - v.v[2]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec3(this.v[0] * v.v[0], this.v[1] * v.v[1], this.v[2] * v.v[2]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec3(this.v[0] / v.v[0], this.v[1] / v.v[1], this.v[2] / v.v[2]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec3(1.0 / this.v[0], 1.0 / this.v[1], 1.0 / this.v[2]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1] + this.v[2] * v.v[2]);\r\n\t},\r\n\r\n\tcross : function(v) {\r\n\t\treturn new SglVec3(this.v[1]*v.v[2] - this.v[2]*v.v[1], this.v[2]*v.v[0] - this.v[0]*v.v[2], this.v[0]*v.v[1] - this.v[1]*v.v[0]);\r\n\t},\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec3(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]), sglMin(this.v[2], v.v[2]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec3(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]), sglMax(this.v[2], v.v[2]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglVec4\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec3.\r\n * @class 4-dimensional vector.\r\n */\r\nfunction SglVec4() {\r\n\tthis.v = new Array(4);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec4) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 4:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec4.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec4(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\tget z( ) { return this.v[2]; },\r\n\tset z(n) { this.v[2] = n;    },\r\n\tget w( ) { return this.v[3]; },\r\n\tset w(n) { this.v[3] = n;    },\r\n\r\n\tset : function(x, y, z, w) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\tthis.v[2] = z;\r\n\t\tthis.v[3] = w;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1], v[2], v[3]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s, s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\tthis.v[2] *= f;\r\n\t\tthis.v[3] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec4(-(this.v[0]), -(this.v[1]), -(this.v[2]), -(this.v[3]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec4(sglAbs(this.v[0]), sglAbs(this.v[1]), sglAbs(this.v[2]), sglAbs(this.v[3]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\tif (m > this.v[2]) m = this.v[2];\r\n\t\tif (m > this.v[3]) m = this.v[3];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\tif (m < this.v[2]) m = this.v[2];\r\n\t\tif (m < this.v[3]) m = this.v[3];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\tif (this.v[a] > this.v[3]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\tif (this.v[a] > this.v[3]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec4(this.v[0] + v.v[0], this.v[1] + v.v[1], this.v[2] + v.v[2], this.v[3] + v.v[3]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec4(this.v[0] - v.v[0], this.v[1] - v.v[1], this.v[2] - v.v[2], this.v[3] - v.v[3]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec4(this.v[0] * v.v[0], this.v[1] * v.v[1], this.v[2] * v.v[2], this.v[3] * v.v[3]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec4(this.v[0] / v.v[0], this.v[1] / v.v[1], this.v[2] / v.v[2], this.v[3] / v.v[3]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec4(1.0 / this.v[0], 1.0 / this.v[1], 1.0 / this.v[2], 1.0 / this.v[3]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1] + this.v[2] * v.v[2] + this.v[3] * v.v[3]);\r\n\t},\r\n\r\n\t/*\r\n\tcross : function(u, v, w) {\r\n\t\treturn null;\r\n\t},\r\n\t*/\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec4(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]), sglMin(this.v[2], v.v[2]), sglMin(this.v[3], v.v[3]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec4(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]), sglMax(this.v[2], v.v[2]), sglMax(this.v[3], v.v[3]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglPlane3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglPlane3.\r\n * @class Represents a plane in space.\r\n */\r\nfunction SglPlane3(normal, offset, normalize) {\r\n\tthis._normal = [ 0.0, 0.0, 1.0 ];\r\n\tthis._offset = 0.0;\r\n\r\n\tif (normal && offset) {\r\n\t\tthis.setup(normal, offset, normalize);\r\n\t}\r\n}\r\n\r\nSglPlane3.prototype = {\r\n\tget normal()  { return this._normal;          },\r\n\tset normal(n) { this._normal = n.slice(0, 3); },\r\n\r\n\tget offset()  { return this._offset;          },\r\n\tset offset(o) { this._offset = o.slize(0, 3); },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglPlane3(this._normal, this._offset, false);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(normal, offset, nomalize) {\r\n\t\tthis._normal[0] = normal[0];\r\n\t\tthis._normal[1] = normal[1];\r\n\t\tthis._normal[2] = normal[2];\r\n\t\tthis._offset    = offset;\r\n\r\n\t\tif (normalize) {\r\n\t\t\tvar s = sglSqrt(sglDotV3(this._normal));\r\n\r\n\t\t\tif (s > 0.0) {\r\n\t\t\t\ts = 1.0 / s;\r\n\t\t\t\tsglSelfMulV3S(this._normal, s);\r\n\t\t\t\tthis._offset    *= s;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglBox3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglBox3.\r\n * @class Represents an axis-aligned box in space.\r\n */\r\nfunction SglBox3(min, max) {\r\n\tthis._min = [  1.0,  1.0,  1.0 ];\r\n\tthis._max = [ -1.0, -1.0, -1.0 ];\r\n\r\n\tif (min && max) {\r\n\t\tthis.setup(min, max);\r\n\t}\r\n}\r\n\r\nSglBox3.prototype = {\r\n\tget min()  { return this._min;          },\r\n\tset min(m) { this._min = m.slice(0, 3); },\r\n\r\n\tget max()  { return this._max;          },\r\n\tset max(m) { this._max = m.slice(0, 3); },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglBox3(this._min, this._max);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(min, max) {\r\n\t\tfor (var i=0; i<3; ++i) {\r\n\t\t\tthis._min[i] = min[i];\r\n\t\t\tthis._max[i] = max[i];\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget isNull() {\r\n\t\treturn (this._min[0] > this._max[0]);\r\n\t},\r\n\r\n\tget isEmpty() {\r\n\t\treturn (\r\n\t\t\t   (this._min[0] == this._max[0])\r\n\t\t\t&& (this._min[1] == this._max[1])\r\n\t\t\t&& (this._min[2] == this._max[2])\r\n\t\t);\r\n\t},\r\n\r\n\tget center() {\r\n\t\treturn sglSelfMulV3S(sglAddV3(this._min, this._max), 0.5);\r\n\t},\r\n\r\n\tget size() {\r\n\t\treturn sglSubV3(this._max, this._min);\r\n\t},\r\n\r\n\tget squaredDiagonal() {\r\n\t\tvar s = this.size;\r\n\t\treturn sglDotV3(s, s);\r\n\t},\r\n\r\n\tget diagonal() {\r\n\t\treturn sglSqrt(this.squaredDiagonal);\r\n\t},\r\n\r\n\tget facesAreas() {\r\n\t\tvar s = this.size;\r\n\t\treturn [\r\n\t\t\t(s[1] * s[2]),\r\n\t\t\t(s[0] * s[2]),\r\n\t\t\t(s[0] * s[1])\r\n\t\t];\r\n\t},\r\n\r\n\tget surfaceArea() {\r\n\t\tvar a = this.facesArea;\r\n\t\treturn ((a[0] + a[1] + a[2]) * 2.0);\r\n\t},\r\n\r\n\tget volume() {\r\n\t\tvar s = this.size;\r\n\t\treturn (s[0] * s[1] * s[2]);\r\n\t},\r\n\r\n\toffset : function(halfDelta) {\r\n\t\tsglSelfSubV3S(this._min[i], halfDelta);\r\n\t\tsglSelfAddV3S(this._max[i], halfDelta);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tcorner : function(index) {\r\n\t\tvar s = this.size;\r\n\t\treturn [\r\n\t\t\tthis._min[0] + (((index % 2)       != (0.0)) ? (1.0) : (0.0)) * s[0],\r\n\t\t\tthis._min[1] + ((((index / 2) % 2) != (0.0)) ? (1.0) : (0.0)) * s[1],\r\n\t\t\tthis._min[2] + (((index > 3)       != (0.0)) ? (1.0) : (0.0)) * s[2]\r\n\t\t];\r\n\t},\r\n\r\n\ttransformed : function(matrix) {\r\n\t\tvar b = new SglBox3();\r\n\t\tvar p = sglMulM4V3(matrix, this.corner(0), 1.0);\r\n\t\tb.min = p;\r\n\t\tb.max = p;\r\n\t\tfor (var i=1; i<8; ++i) {\r\n\t\t\tp = sglMulM4V3(matrix, this.corner(i), 1.0);\r\n\t\t\tb.min = sglMinV3(b.min, p);\r\n\t\t\tb.max = sglMaxV3(b.max, p);\r\n\t\t}\r\n\t\treturn b;\r\n\t},\r\n\r\n\taddPoint : function(p) {\r\n\t\tif (this.isNull) {\r\n\t\t\tthis.min = p;\r\n\t\t\tthis.max = p;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.min = sglMinV3(this.min, p);\r\n\t\t\tthis.max = sglMaxV3(this.min, p);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddBox : function(b) {\r\n\t\tif (!b.isNull) {\r\n\t\t\tif (this.isNull) {\r\n\t\t\t\tthis.min = b.min;\r\n\t\t\t\tthis.max = b.max;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.min = sglMinV3(this.min, b.min);\r\n\t\t\t\tthis.max = sglMaxV3(this.max, b.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglSphere3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglSphere3.\r\n * @class Represents a sphere in space.\r\n */\r\nfunction SglSphere3(center, radius) {\r\n\tthis._center = [ 0.0, 0.0, 0.0 ];\r\n\tthis._radius = -1.0;\r\n\r\n\tif (center && radius) {\r\n\t\tthis.setup(center, radius);\r\n\t}\r\n}\r\n\r\nSglSphere3.prototype = {\r\n\tget center()  { return this._center;          },\r\n\tset center(c) { this._center = c.slice(0, 3); },\r\n\r\n\tget radius()  { return this._redius;          },\r\n\tset radius(r) { this._radius = r;             },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglSphere3(this._center, this._radius);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(center, radius) {\r\n\t\tthis._center[0] = center[0];\r\n\t\tthis._center[1] = center[1];\r\n\t\tthis._center[2] = center[2];\r\n\t\tthis._radius    = radius;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget isNull() {\r\n\t\treturn (this._radius < 0.0);\r\n\t},\r\n\r\n\tget isEmpty() {\r\n\t\treturn (this._radius == 0.0);\r\n\t},\r\n\r\n\tget surfaceArea() {\r\n\t\treturn (4.0 * SGL_PI * this._radius * this._radius);\r\n\t},\r\n\r\n\tget volume() {\r\n\t\treturn ((4.0 / 3.0) * SGL_PI * this._radius * this._radius * this._radius);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglMatrixStack\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglMatrixStack.\r\n * @class Represents a stack of 4x4 matrices.\r\n */\r\nfunction SglMatrixStack() {\r\n\tthis._s = [ ];\r\n\tthis._s.push(sglIdentityM4());\r\n\tthis._n = 0;\r\n}\r\n\r\nSglMatrixStack.prototype = {\r\n\tclone : function() {\r\n\t\tvar ss = new SglMatrixStack();\r\n\t\tss.s = [ ];\r\n\t\tfor (var i=0; i<(this._n+1); ++i) {\r\n\t\t\tss._s.push(sglDupM4(this._s[i]));\r\n\t\t}\r\n\t\treturn ss;\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\treset : function() {\r\n\t\tthis._s = [ ];\r\n\t\tthis._s.push(sglIdentityM4());\r\n\t\tthis._n = 0;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget size() {\r\n\t\treturn (this._n + 1);\r\n\t},\r\n\r\n\tget top() {\r\n\t\treturn sglDupM4(this._s[this._n]);\r\n\t},\r\n\r\n\tget topRef() {\r\n\t\treturn this._s[this._n];\r\n\t},\r\n\r\n\tpush : function() {\r\n\t\tthis._s.push(sglDupM4(this._s[this._n]));\r\n\t\tthis._n++;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tpop : function() {\r\n\t\tif (this._n > 0) {\r\n\t\t\tthis._s.pop();\r\n\t\t\tthis._n--;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tload : function(m) {\r\n\t\tthis._s[this._n] = sglDupM4(m);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmultiply : function(m) {\r\n\t\tthis._s[this._n] = sglMulM4(this._s[this._n], m);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tloadIdentity : function() {\r\n\t\tthis._s[this._n] = sglIdentityM4();\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttranslate : function(x, y, z) {\r\n\t\treturn this.multiply(sglTranslationM4C(x, y, z));\r\n\t},\r\n\r\n\trotate : function(angleRad, x, y, z) {\r\n\t\treturn this.multiply(sglRotationAngleAxisM4C(angleRad, x, y, z));\r\n\t},\r\n\r\n\tscale : function(x, y, z) {\r\n\t\treturn this.multiply(sglScalingM4C(x, y, z));\r\n\t},\r\n\r\n\tlookAt : function(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ) {\r\n\t\treturn this.multiply(sglLookAtM4C(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ));\r\n\t},\r\n\r\n\tortho : function(left, right, bottom, top, zNear, zFar) {\r\n\t\treturn this.multiply(sglOrthoM4C(left, right, bottom, top, zNear, zFar));\r\n\t},\r\n\r\n\tfrustum : function(left, right, bottom, top, zNear, zFar) {\r\n\t\treturn this.multiply(sglFrustumM4C(left, right, bottom, top, zNear, zFar));\r\n\t},\r\n\r\n\tperspective : function(fovYRad, aspectRatio, zNear, zFar) {\r\n\t\treturn this.multiply(sglPerspectiveM4(fovYRad, aspectRatio, zNear, zFar));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTransformStack\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglTransformStack.\r\n * @class Holds model, view and projection matrix stacks.\r\n */\r\nfunction SglTransformStack() {\r\n\tthis._ms = new SglMatrixStack();\r\n\tthis._vs = new SglMatrixStack();\r\n\tthis._ps = new SglMatrixStack();\r\n}\r\n\r\nSglTransformStack.prototype = {\r\n\tclone : function() {\r\n\t\tvar xs = new SglTransformStack();\r\n\t\txs._ms = this._ms.clone();\r\n\t\txs._vs = this._vs.clone();\r\n\t\txs._ps = this._ps.clone();\r\n\t\treturn xs;\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\treset : function() {\r\n\t\tthis._ms.reset();\r\n\t\tthis._vs.reset();\r\n\t\tthis._ps.reset();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget model() {\r\n\t\treturn this._ms;\r\n\t},\r\n\r\n\tget view() {\r\n\t\treturn this._vs;\r\n\t},\r\n\r\n\tget projection() {\r\n\t\treturn this._ps;\r\n\t},\r\n\r\n\tget modelMatrix() {\r\n\t\treturn this.model.top;\r\n\t},\r\n\r\n\tget modelMatrixRef() {\r\n\t\treturn this.model.topRef;\r\n\t},\r\n\r\n\tget modelMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelMatrixInverse);\r\n\t},\r\n\r\n\tget viewMatrix() {\r\n\t\treturn this.view.top;\r\n\t},\r\n\r\n\tget viewMatrixRef() {\r\n\t\treturn this.view.topRef;\r\n\t},\r\n\r\n\tget viewMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewMatrixInverse() {\r\n\t\treturn sglInverseM4(this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.viewMatrixInverse);\r\n\t},\r\n\r\n\tget projectionMatrix() {\r\n\t\treturn this.projection.top;\r\n\t},\r\n\r\n\tget projectionMatrixRef() {\r\n\t\treturn this.projection.topRef;\r\n\t},\r\n\r\n\tget projectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.projectionMatrixRef);\r\n\t},\r\n\r\n\tget projectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.projectionMatrixRef);\r\n\t},\r\n\r\n\tget projectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.projectionMatrixInverse);\r\n\t},\r\n\r\n\tget modelViewMatrix() {\r\n\t\treturn sglMulM4(this.viewMatrixRef, this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelViewMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewMatrix);\r\n\t},\r\n\r\n\tget modelViewMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelViewMatrix);\r\n\t},\r\n\r\n\tget modelViewMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewMatrixInverse);\r\n\t},\r\n\r\n\tget viewProjectionMatrix() {\r\n\t\treturn sglMulM4(this.projectionMatrixRef, this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewProjectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.viewProjectionMatrix);\r\n\t},\r\n\r\n\tget viewProjectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.viewProjectionMatrix);\r\n\t},\r\n\r\n\tget viewProjectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.viewProjectionMatrixInverse);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrix() {\r\n\t\treturn sglMulM4(this.projectionMatrixRef, sglMulM4(this.viewMatrixRef, this.modelMatrixRef));\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewProjectionMatrix);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelViewProjectionMatrix);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewProjectionMatrixInverse);\r\n\t},\r\n\r\n\tget worldSpaceNormalMatrix() {\r\n\t\treturn sglM4toM3(this.modelMatrixInverseTranspose);\r\n\t},\r\n\r\n\tget viewSpaceNormalMatrix() {\r\n\t\treturn sglM4toM3(this.modelViewMatrixInverseTranspose);\r\n\t},\r\n\r\n\tget modelSpaceViewerPosition() {\r\n\t\treturn sglV4toV3(sglGetColM4(this.modelViewMatrixInverse, 3));\r\n\t},\r\n\r\n\tget modelSpaceViewDirection() {\r\n\t\treturn sglNegV3(sglV4toV3(sglGetRowM4(this.modelViewMatrix, 2)));\r\n\t},\r\n\r\n\tget worldSpaceViewerPosition() {\r\n\t\treturn sglV4toV3(sglGetColM4(this.viewMatrixInverse, 3));\r\n\t},\r\n\r\n\tget worldSpaceViewDirection() {\r\n\t\treturn ssglNegV3(sglV4toV3(sglGetRowM4(this.viewMatrixRef, 2)));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// _SglFrustumPlane\r\n/**********************************************************/\r\nfunction _SglFrustumPlane() {\r\n\tthis.normal     = [ 0.0, 0.0, 1.0 ];\r\n\tthis.offset     = 0.0;\r\n\tthis.testVertex = [ 0, 0, 0 ];\r\n}\r\n\r\n_SglFrustumPlane.prototype = {\r\n\tsetup : function(nx, ny, nz, off) {\r\n\t\tvar s = 1.0 / sglSqrt(nx*nx + ny*ny + nz*nz);\r\n\r\n\t\tthis.normal[0] = nx * s;\r\n\t\tthis.normal[1] = ny * s;\r\n\t\tthis.normal[2] = nz * s;\r\n\r\n\t\tthis.offset = off * s;\r\n\r\n\t\tthis.testVertex[0] = (this.normal[0] >= 0.0) ? (1) : (0);\r\n\t\tthis.testVertex[1] = (this.normal[1] >= 0.0) ? (1) : (0);\r\n\t\tthis.testVertex[2] = (this.normal[2] >= 0.0) ? (1) : (0);\r\n\t}\r\n};\r\n/**********************************************************/\r\n\r\n\r\n// SglFrustum\r\n/**********************************************************/\r\nvar SGL_OUTSIDE_FRUSTUM   = 0;\r\nvar SGL_INTERSECT_FRUSTUM = 1;\r\nvar SGL_INSIDE_FRUSTUM    = 2;\r\n\r\n/**\r\n * Constructs a SglFrustum.\r\n * @class Holds frustum information for operations such as visibility culling.\r\n */\r\nfunction SglFrustum(projectionMatrix, modelViewMatrix, viewport) {\r\n\tthis._mvpMatrix       = sglIdentityM4();\r\n\tthis._viewport        = [ 0, 0, 1, 1 ];\r\n\tthis._vp              = [ 0, 0, 1, 1 ];\r\n\tthis._billboardMatrix = sglIdentityM4();\r\n\r\n\tthis._planes = new Array(6);\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tthis._planes[i] = new _SglFrustumPlane();\r\n\t}\r\n\r\n\tif (projectionMatrix && modelViewMatrix && viewport) {\r\n\t\tthis.setup(projectionMatrix, modelViewMatrix, viewport);\r\n\t}\r\n}\r\n\r\nSglFrustum.prototype = {\r\n\tsetup : function (projectionMatrix, modelViewMatrix, viewport) {\r\n\t\tvar rot = [\r\n\t\t\tsglGetColM4(modelViewMatrix, 0),\r\n\t\t\tsglGetColM4(modelViewMatrix, 1),\r\n\t\t\tsglGetColM4(modelViewMatrix, 2)\r\n\t\t];\r\n\r\n\t\tvar sc = [\r\n\t\t\tsglLengthV4(rot[0]),\r\n\t\t\tsglLengthV4(rot[1]),\r\n\t\t\tsglLengthV4(rot[2])\r\n\t\t];\r\n\r\n\t\tvar scRcp = sglRcpV3(sc);\r\n\r\n\t\tvar sMat    = sglScalingM4V(sc);\r\n\t\tvar sMatInv = sglScalingM4V(scRcp);\r\n\r\n\t\trot[0] = sglMulV4S(rot[0], scRcp[0]);\r\n\t\trot[1] = sglMulV4S(rot[1], scRcp[1]);\r\n\t\trot[2] = sglMulV4S(rot[2], scRcp[2]);\r\n\r\n\t\tvar rMatInv = sglIdentityM4();\r\n\t\tsglSetRowM4V(rMatInv, 0, rot[0]);\r\n\t\tsglSetRowM4V(rMatInv, 1, rot[1]);\r\n\t\tsglSetRowM4V(rMatInv, 2, rot[2]);\r\n\r\n\t\tthis._mvpMatrix       = sglMulM4(projectionMatrix, modelViewMatrix);\r\n\t\tthis._billboardMatrix = sglMulM4(sMatInv, sglMulM4(rMatInv, sMat));\r\n\t\tthis._viewport        = viewport.slice(0, 4);\r\n\r\n\t\tthis._vp[0] = this._viewport[2] * 0.5;\r\n\t\tthis._vp[1] = this._viewport[0] + this._viewport[2] * 0.5;\r\n\t\tthis._vp[2] = this._viewport[3] * 0.5;\r\n\t\tthis._vp[3] = this._viewport[1] + this._viewport[3] * 0.5;\r\n\r\n\r\n\t\tvar m = this._mvpMatrix;\r\n\t\tvar q = [ m[3], m[7], m[11] ];\r\n\r\n\t\tthis._planes[0].setup(q[ 0] - m[ 0], q[ 1] - m[ 4], q[ 2] - m[ 8], m[15] - m[12]);\r\n\t\tthis._planes[1].setup(q[ 0] + m[ 0], q[ 1] + m[ 4], q[ 2] + m[ 8], m[15] + m[12]);\r\n\t\tthis._planes[2].setup(q[ 0] - m[ 1], q[ 1] - m[ 5], q[ 2] - m[ 9], m[15] - m[13]);\r\n\t\tthis._planes[3].setup(q[ 0] + m[ 1], q[ 1] + m[ 5], q[ 2] + m[ 9], m[15] + m[13]);\r\n\t\tthis._planes[4].setup(q[ 0] - m[ 2], q[ 1] - m[ 6], q[ 2] - m[10], m[15] - m[14]);\r\n\t\tthis._planes[5].setup(q[ 0] + m[ 2], q[ 1] + m[ 6], q[ 2] + m[10], m[15] + m[14]);\r\n\t},\r\n\r\n\tboxVisibility : function(boxMin, boxMax) {\r\n\t\tvar ret = SGL_INSIDE_FRUSTUM;\r\n\r\n\t\tvar bminmax = [ boxMin, boxMax ];\r\n\r\n\t\tvar fp = null;\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\tfp = this._planes[i];\r\n\t\t\tif (\r\n\t\t\t\t((fp.normal[0] * bminmax[fp.testVertex[0]][0]) +\r\n\t\t\t\t (fp.normal[1] * bminmax[fp.testVertex[1]][1]) +\r\n\t\t\t\t (fp.normal[2] * bminmax[fp.testVertex[2]][2]) +\r\n\t\t\t\t (fp.offset)) < 0.0\r\n\t\t\t) {\r\n\t\t\t\treturn SGL_OUTSIDE_FRUSTUM;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\t((fp.normal[0] * bminmax[1 - fp.testVertex[0]][0]) +\r\n\t\t\t\t (fp.normal[1] * bminmax[1 - fp.testVertex[1]][1]) +\r\n\t\t\t\t (fp.normal[2] * bminmax[1 - fp.testVertex[2]][2]) +\r\n\t\t\t\t (fp.offset)) < 0.0\r\n\t\t\t) {\r\n\t\t\t\tret = SGL_INTERSECT_FRUSTUM;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t},\r\n\r\n\tprojectedSegmentSize : function(center, size) {\r\n\t\tvar hs = size * 0.5;\r\n\r\n\t\tvar p0 = sglV3toV4(center, 0.0);\r\n\t\tvar p1 = [ -hs, 0.0, 0.0, 1.0 ];\r\n\t\tvar p2 = [  hs, 0.0, 0.0, 1.0 ];\r\n\r\n\t\tp1 = sglMulM4V4(this._billboardMatrix, p1);\r\n\t\tp1 = sglAddV4(p1, p0);\r\n\t\tp1 = sglProjectV4(sglMulM4V4(this._mvpMatrix, p1));\r\n\r\n\t\tp2 = sglMulM4V4(this._billboardMatrix, p2);\r\n\t\tp2 = sglAddV4(p2, p0);\r\n\t\tp2 = sglProjectV4(sglMulM4V4(this._mvpMatrix, p2));\r\n\r\n\t\t/*\r\n\t\tp1[0] = this._vp[0] * p1[0] + this._vp[1];\r\n\t\tp2[0] = this._vp[0] * p2[0] + this._vp[1];\r\n\t\t//p1[1] = this.viewport[3] * 0.5 * p1[1] + this.viewport[1] + this.viewport[3] * 0.5;\r\n\r\n\t\tp2[0] = this.viewport[2] * 0.5 * p2[0] + this.viewport[0] + this.viewport[2] * 0.5;\r\n\t\t//p2[1] = this.viewport[3] * 0.5 * p2[1] + this.viewport[1] + this.viewport[3] * 0.5;\r\n\r\n\t\tvar size = aglAbs(p2[0] - p1[0]);\r\n\t\t*/\r\n\r\n\t\tvar sz = this._vp[0] * sglAbs(p2[0] - p1[0]);\r\n\r\n\t\treturn sz;\r\n\t}\r\n};\r\n\r\nfunction sglBoxVisibility(modelViewProjectionMatrix, boxMin, boxMax) {\r\n\tvar fc = new SglFrustum(modelViewProjectionMatrix);\r\n\treturn fc.boxVisibility(boxMin, boxMax);\r\n}\r\n/**********************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// GL utilities\r\n/***********************************************************************/\r\nfunction _sglConsolidateOptions(fullOptions, usedOptions)\r\n{\r\n\tif (usedOptions) {\r\n\t\tfor (var attr in usedOptions) {\r\n\t\t\tfullOptions[attr] = usedOptions[attr];\r\n\t\t}\r\n\t}\r\n\treturn fullOptions;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglBufferInfo\r\n/***********************************************************************/\r\nfunction sglGetBufferOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tusage : gl.STATIC_DRAW\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglBufferInfo.\r\n * @class Holds information about a WebGL buffer object.\r\n */\r\nfunction SglBufferInfo() {\r\n\tthis.handle = null;\r\n\tthis.valid  = false;\r\n\tthis.target = 0;\r\n\tthis.size   = 0;\r\n\tthis.usage  = 0;\r\n}\r\n\r\nfunction sglBufferFromData(gl, target, values, options) {\r\n\tvar opt = sglGetBufferOptions(gl, options);\r\n\tvar buff = gl.createBuffer();\r\n\tgl.bindBuffer(target, buff);\r\n\tgl.bufferData(target, values, opt.usage);\r\n\tgl.bindBuffer(target, null);\r\n\r\n\tvar obj = new SglBufferInfo();\r\n\tobj.handle = buff;\r\n\tobj.valid  = true;\r\n\tobj.target = target;\r\n\tobj.size   = values.sizeInBytes;\r\n\tobj.usage  = opt.usage;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglVertexBufferFromData(gl, values, usage) {\r\n\treturn sglBufferFromData(gl, gl.ARRAY_BUFFER, values, usage);\r\n}\r\n\r\nfunction sglIndexBufferFromData(gl, values, usage) {\r\n\treturn sglBufferFromData(gl, gl.ELEMENT_ARRAY_BUFFER, values, usage);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglShaderInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglShaderInfo.\r\n * @class Holds information about a WebGL shader object.\r\n */\r\nfunction SglShaderInfo() {\r\n\tthis.handle = null;\r\n\tthis.valid  = false;\r\n\tthis.type   = 0;\r\n\tthis.log    = \"\";\r\n}\r\n\r\nfunction sglShaderFromSource(gl, type, src) {\r\n\tvar log = \"\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar shd  = gl.createShader(type);\r\n\tgl.shaderSource(shd, src);\r\n\tgl.compileShader(shd);\r\n\r\n\tlog += \"[SHADER LOG]\\n\";\r\n\tvar valid = true;\r\n\tif (gl.getShaderParameter(shd, gl.COMPILE_STATUS) != 0) {\r\n\t\tlog += \"SUCCESS:\\n\";\r\n\t}\r\n\telse {\r\n\t\tvalid = false;\r\n\t\tlog += \"FAIL:\\n\";\r\n\t}\r\n\tlog += gl.getShaderInfoLog(shd);\r\n\tlog += \"\\n\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar obj = new SglShaderInfo();\r\n\tobj.handle = shd;\r\n\tobj.valid  = valid;\r\n\tobj.type   = type;\r\n\tobj.log    = log;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglVertexShaderFromSource(gl, src) {\r\n\treturn sglShaderFromSource(gl, gl.VERTEX_SHADER, src);\r\n}\r\n\r\nfunction sglFragmentShaderFromSource(gl, src) {\r\n\treturn sglShaderFromSource(gl, gl.FRAGMENT_SHADER, src);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramAttributeInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttributeInfo.\r\n * @class Holds information about a WebGL program active attribute.\r\n */\r\nfunction SglProgramAttributeInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramUniformInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttributeInfo.\r\n * @class Holds information about a WebGL program active uniform.\r\n */\r\nfunction SglProgramUniformInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramSamplerInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramSamplerInfo.\r\n * @class Holds information about a WebGL program active sampler.\r\n */\r\nfunction SglProgramSamplerInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramInfo.\r\n * @class Holds information about a WebGL program object.\r\n */\r\nfunction SglProgramInfo() {\r\n\tthis.handle     = null;\r\n\tthis.valid      = false;\r\n\tthis.shaders    = [ ];\r\n\tthis.attributes = new Object();\r\n\tthis.uniforms   = new Object();\r\n\tthis.samplers   = new Object();\r\n\tthis.log        = \"\";\r\n}\r\n\r\nfunction sglProgramFromShaders(gl, shaders) {\r\n\tvar log = \"\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar prg = gl.createProgram();\r\n\tfor (var s in shaders) {\r\n\t\tvar shd = shaders[s];\r\n\t\t//if (shd.valid) {\r\n\t\t\tgl.attachShader(prg, shd.handle);\r\n\t\t//}\r\n\t}\r\n\tgl.linkProgram(prg);\r\n\r\n\tvar valid = true;\r\n\tvalid = valid && (gl.getProgramParameter(prg, gl.LINK_STATUS)     != 0);\r\n\r\n\t// validation is needed when uniforms are set, so skip this.\r\n\t//gl.validateProgram(prg);\r\n\t//valid = valid && (gl.getProgramParameter(prg, gl.VALIDATE_STATUS) != 0);\r\n\r\n\tlog += \"[PROGRAM LOG]\\n\";\r\n\tif (valid) {\r\n\t\tlog += \"SUCCESS:\\n\";\r\n\t}\r\n\telse {\r\n\t\tlog += \"FAIL:\\n\";\r\n\t}\r\n\tlog += gl.getProgramInfoLog(prg);\r\n\tlog += \"\\n\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar obj = new SglProgramInfo();\r\n\tobj.handle = prg;\r\n\tobj.valid  = valid;\r\n\tfor (var s in shaders) {\r\n\t\tvar shd = shaders[s]\r\n\t\t//if (shd.valid) {\r\n\t\t\tobj.shaders.push(shd);\r\n\t\t//}\r\n\t}\r\n\tobj.log = log;\r\n\r\n\tvar attribs_count = gl.getProgramParameter(prg, gl.ACTIVE_ATTRIBUTES);\r\n\tvar attr, loc, a;\r\n\tfor (var i=0; i<attribs_count; ++i) {\r\n\t\tattr = gl.getActiveAttrib(prg, i);\r\n\t\tif (!attr) continue;\r\n\t\ta    = new SglProgramAttributeInfo();\r\n\t\ta.name = attr.name;\r\n\t\ta.nativeType = attr.type;\r\n\t\ta.size = attr.size;\r\n\t\ta.location = gl.getAttribLocation(prg, attr.name);\r\n\t\tobj.attributes[a.name] = a;\r\n\t}\r\n\r\n\tvar uniforms_count = gl.getProgramParameter(prg, gl.ACTIVE_UNIFORMS);\r\n\tvar unif, loc, u;\r\n\tfor (var i=0; i<uniforms_count; ++i) {\r\n\t\tunif = gl.getActiveUniform(prg, i);\r\n\t\tif (!unif) continue;\r\n\t\tloc  = gl.getUniformLocation(prg, unif.name);\r\n\t\tif ((unif.type == gl.SAMPLER_2D) || (unif.type == gl.SAMPLER_CUBE) || (unif.type == 35682)) {\r\n\t\t\ts = new SglProgramSamplerInfo();\r\n\t\t\ts.name = unif.name;\r\n\t\t\ts.nativeType = unif.type;\r\n\t\t\ts.size = unif.size;\r\n\t\t\ts.location = loc;\r\n\t\t\tobj.samplers[s.name] = s;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tu = new SglProgramUniformInfo();\r\n\t\t\tu.name = unif.name;\r\n\t\t\tu.nativeType = unif.type;\r\n\t\t\tu.size = unif.size;\r\n\t\t\tu.location = loc;\r\n\t\t\tobj.uniforms[u.name] = u;\r\n\t\t}\r\n\t}\r\n\r\n\tsglSetDefaultProgramBindings(gl, obj);\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglProgramFromSources(gl, vertexSources, fragmentSources) {\r\n\tvar shd = null;\r\n\tvar shaders = [ ];\r\n\tfor (var s in vertexSources) {\r\n\t\tvar src = vertexSources[s];\r\n\t\tshd = sglVertexShaderFromSource(gl, src);\r\n\t\tshaders.push(shd);\r\n\t}\r\n\tfor (var s in fragmentSources) {\r\n\t\tvar src = fragmentSources[s];\r\n\t\tshd = sglFragmentShaderFromSource(gl, src);\r\n\t\tshaders.push(shd);\r\n\t}\r\n\treturn sglProgramFromShaders(gl, shaders);\r\n}\r\n\r\nfunction sglSetDefaultProgramBindings(gl, programInfo) {\r\n\tvar prg = programInfo.handle;\r\n\r\n\t// ensure index is sequential in \"for (attr in programInfo.attributes)\" loops\r\n\tvar index = 0;\r\n\tfor (var v in programInfo.attributes) {\r\n\t\tvar vattr = programInfo.attributes[v];\r\n\t\tgl.bindAttribLocation(prg, index, vattr.name);\r\n\t\tvattr.location = index;\r\n\t\tindex++;\r\n\t}\r\n\t// must relink after attributes binding\r\n\tgl.linkProgram(prg);\r\n\r\n\t// uniform locations could change after program linking, so update them\r\n\tfor (var u in programInfo.uniforms) {\r\n\t\tvar unif = programInfo.uniforms[u];\r\n\t\tunif.location = gl.getUniformLocation(prg, unif.name);\r\n\t}\r\n\r\n\tgl.useProgram(programInfo.handle);\r\n\t// ensure texture unit is sequential in \"for (attr in programInfo.samplers)\" loops\r\n\tvar unit = 0;\r\n\tfor (var s in programInfo.samplers) {\r\n\t\tvar smp = programInfo.samplers[s];\r\n\t\tsmp.location = gl.getUniformLocation(prg, smp.name);\r\n\t\tgl.uniform1i(smp.location, unit);\r\n\t\tunit++;\r\n\t}\r\n\t//gl.useProgram(null);\r\n}\r\n\r\nfunction sglProgramSynchronize(gl, programInfo) {\r\n\tvar prg = programInfo.handle;\r\n\r\n\tfor (var v in programInfo.attributes) {\r\n\t\tvar vattr = programInfo.attributes[v];\r\n\t\tvattr.location = gl.getAttribLocation(prg, vattr.name);\r\n\t}\r\n\r\n\tfor (var u in programInfo.uniforms) {\r\n\t\tvar unif = programInfo.uniforms[u];\r\n\t\tunif.location = gl.getUniformLocation(prg, unif.name);\r\n\t}\r\n\r\n\tfor (var s in programInfo.samplers) {\r\n\t\tvar smp = programInfo.samplers[s];\r\n\t\tsmp.location = gl.getUniformLocation(prg, smp.name);\r\n\t}\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglTextureInfo\r\n/***********************************************************************/\r\nfunction sglGetTextureOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tminFilter        : gl.LINEAR,\r\n\t\tmagFilter        : gl.LINEAR,\r\n\t\twrapS            : gl.CLAMP_TO_EDGE,\r\n\t\twrapT            : gl.CLAMP_TO_EDGE,\r\n\t\tisDepth          : false,\r\n\t\tdepthMode        : gl.LUMINANCE,\r\n\t\tdepthCompareMode : gl.COMPARE_R_TO_TEXTURE,\r\n\t\tdepthCompareFunc : gl.LEQUAL,\r\n\t\tgenerateMipmap   : false,\r\n\t\tflipY            : true,\r\n\t\tpremultiplyAlpha : false,\r\n\t\tonload           : null\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglTextureInfo.\r\n * @class Holds information about a WebGL texture object.\r\n */\r\nfunction SglTextureInfo() {\r\n\tthis.handle           = null;\r\n\tthis.valid            = false;\r\n\tthis.target           = 0;\r\n\tthis.format           = 0;\r\n\tthis.width            = 0;\r\n\tthis.height           = 0;\r\n\tthis.minFilter        = 0;\r\n\tthis.magFilter        = 0;\r\n\tthis.wrapS            = 0;\r\n\tthis.wrapT            = 0;\r\n\tthis.isDepth          = false;\r\n\tthis.depthMode        = 0;\r\n\tthis.depthCompareMode = 0;\r\n\tthis.depthCompareFunc = 0;\r\n}\r\n\r\nfunction sglTexture2DFromData(gl, internalFormat, width, height, sourceFormat, sourceType, texels, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\t// Chrome does not like texels == null\r\n\tif (!texels) {\r\n\t\tif (sourceType == gl.FLOAT) {\r\n\t\t\ttexels = new Float32Array(width * height * 4);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttexels = new Uint8Array(width * height * 4);\r\n\t\t}\r\n\t}\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tgl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, width, height, 0, sourceFormat, sourceType, texels);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.isDepth) {\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.DEPTH_TEXTURE_MODE,   opt.depthMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, opt.depthCompareMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, opt.depthCompareFunc);\r\n\t}\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_2D);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_2D;\r\n\tobj.format           = internalFormat;\r\n\tobj.width            = width;\r\n\tobj.height           = height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = opt.isDepth;\r\n\tobj.depthMode        = opt.depthMode;\r\n\tobj.depthCompareMode = opt.depthCompareMode;\r\n\tobj.depthCompareFunc = opt.depthCompareFunc;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTexture2DFromImage(gl, image, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_2D);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_2D;\r\n\tobj.format           = gl.RGBA;\r\n\tobj.width            = image.width;\r\n\tobj.height           = image.height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = false;\r\n\tobj.depthMode        = 0;\r\n\tobj.depthCompareMode = 0;\r\n\tobj.depthCompareFunc = 0;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTexture2DFromUrl(gl, url, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\tvar obj = new SglTextureInfo();\r\n\r\n\tvar img = new Image();\r\n\timg.crossOrigin = '';\r\n\timg.onload = function() {\r\n\t\tvar texInfo = sglTexture2DFromImage(gl, img, opt);\r\n\t\tfor (var a in texInfo) {\r\n\t\t\tobj[a] = texInfo[a];\r\n\t\t}\r\n\t\tif (opt.onload) {\r\n\t\t\topt.onload(gl, obj, url);\r\n\t\t}\r\n\t};\r\n\timg.src = url;\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/***********************************************************************/\r\nfunction sglTextureCubeFromData(gl, internalFormat, width, height, sourceFormat, sourceType, facesTexels, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\t// Chrome does not like texels == null\r\n\tif (!facesTexels) {\r\n\t\tvar tx = null;\r\n\t\tif (sourceType == gl.FLOAT) {\r\n\t\t\ttx = new Float32Array(width * height * 4);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttx = new Uint8Array(width * height * 4);\r\n\t\t}\r\n\t\tfacesTexels = new Array(6);\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\tfacesTexels[i] = tx;\r\n\t\t}\r\n\t}\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tgl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, internalFormat, width, height, 0, sourceFormat, sourceType, facesTexels[i]);\r\n\t}\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.isDepth) {\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.DEPTH_TEXTURE_MODE,   opt.depthMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_MODE, opt.depthCompareMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_FUNC, opt.depthCompareFunc);\r\n\t}\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_CUBE_MAP;\r\n\tobj.format           = internalFormat;\r\n\tobj.width            = width;\r\n\tobj.height           = height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = opt.isDepth;\r\n\tobj.depthMode        = opt.depthMode;\r\n\tobj.depthCompareMode = opt.depthCompareMode;\r\n\tobj.depthCompareFunc = opt.depthCompareFunc;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTextureCubeFromImages(gl, images, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tgl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, images[i]);\r\n\t}\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_CUBE_MAP;\r\n\tobj.format           = gl.RGBA;\r\n\tobj.width            = images[0].width;\r\n\tobj.height           = images[0].height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = false;\r\n\tobj.depthMode        = 0;\r\n\tobj.depthCompareMode = 0;\r\n\tobj.depthCompareFunc = 0;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTextureCubeFromUrls(gl, urls, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\tvar obj = new SglTextureInfo();\r\n\r\n\tvar remaining = 6;\r\n\tvar images = new Array(6);\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\timages[i] = new Image();\r\n\t\timages[i].crossOrigin = '';\r\n\t}\r\n\tvar watcher = function() {\r\n\t\tremaining--;\r\n\t\tif (remaining == 0) {\r\n\t\t\tvar texInfo = sglTextureCubeFromImages(gl, images, opt);\r\n\t\t\tfor (var a in texInfo) {\r\n\t\t\t\tobj[a] = texInfo[a];\r\n\t\t\t}\r\n\t\t\tif (opt.onload) {\r\n\t\t\t\topt.onload(gl, obj, urls);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\timages[i].onload = watcher;\r\n\t\timages[i].src    = urls[i];\r\n\t}\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglRenderbufferInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglRenderbufferInfo.\r\n * @class Holds information about a WebGL renderbuffer object.\r\n */\r\nfunction SglRenderbufferInfo() {\r\n\tthis.handle    = null;\r\n\tthis.valid     = false;\r\n\tthis.target    = 0;\r\n\tthis.format    = 0;\r\n\tthis.width     = 0;\r\n\tthis.height    = 0;\r\n}\r\n\r\nfunction sglRenderbufferFromFormat(gl, format, width, height) {\r\n\tvar rb = gl.createRenderbuffer();\r\n\tgl.bindRenderbuffer(gl.RENDERBUFFER, rb);\r\n\tgl.renderbufferStorage(gl.RENDERBUFFER, format, width, height);\r\n\tgl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n\r\n\tvar obj = new SglRenderbufferInfo();\r\n\tobj.handle = rb;\r\n\tobj.valid  = true;\r\n\tobj.target = gl.RENDERBUFFER;\r\n\tobj.format = format;\r\n\tobj.width  = width;\r\n\tobj.height = height;\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglFramebufferInfo\r\n/***********************************************************************/\r\nfunction sglGetFramebufferOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tminFilter             : gl.LINEAR,\r\n\t\tmagFilter             : gl.LINEAR,\r\n\t\twrapS                 : gl.CLAMP_TO_EDGE,\r\n\t\twrapT                 : gl.CLAMP_TO_EDGE,\r\n\t\tisDepth               : false,\r\n\t\tdepthMode             : gl.LUMINANCE,\r\n\t\tdepthCompareMode      : gl.COMPARE_R_TO_TEXTURE,\r\n\t\tdepthCompareFunc      : gl.LEQUAL,\r\n\t\tcolorsAsRenderbuffer  : false,\r\n\t\tdepthAsRenderbuffer   : false,\r\n\t\tstencilAsRenderbuffer : false,\r\n\t\tgenerateColorsMipmap  : false,\r\n\t\tgenerateDepthMipmap   : false,\r\n\t\tgenerateStencilMipmap : false\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglFramebufferInfo.\r\n * @class Holds information about a WebGL framebuffer object.\r\n */\r\nfunction SglFramebufferInfo() {\r\n\tthis.handle        = null;\r\n\tthis.valid         = false;\r\n\tthis.width         = 0;\r\n\tthis.height        = 0;\r\n\tthis.colorTargets  = [ ];\r\n\tthis.depthTarget   = null;\r\n\tthis.stencilTarget = null;\r\n\tthis.status        = 0;\r\n}\r\n\r\nfunction sglFramebufferFromTargets(gl, colorTargets, depthTarget, stencilTarget, options) {\r\n\tvar opt = sglGetFramebufferOptions(gl, options);\r\n\r\n\tvar fb = gl.createFramebuffer();\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, fb);\r\n\r\n\tif ((depthTarget != undefined) && (depthTarget != null) && (depthTarget != gl.NONE)) {\r\n\t\tif (depthTarget.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, depthTarget.handle, 0);\r\n\t\t}\r\n\t\telse if (depthTarget.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthTarget.handle);\r\n\t\t}\r\n\t}\r\n\r\n\tif ((stencilTarget != undefined) && (stencilTarget != null) && (stencilTarget != gl.NONE)) {\r\n\t\tif (stencilTarget.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.TEXTURE_2D, stencilTarget.handle, 0);\r\n\t\t}\r\n\t\telse if (stencilTarget.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.RENDERBUFFER, stencilTarget.handle);\r\n\t\t}\r\n\t}\r\n\r\n\tvar cts = [ ];\r\n\tvar drawBuffers = [ ];\r\n\tif ((colorTargets != undefined) && (colorTargets != null)) {\r\n\t\tvar n = colorTargets.length;\r\n\t\tif (n == 0) {\r\n\t\t\tdrawBuffers.push(gl.NONE);\r\n\t\t\t//gl.readBuffer(gl.NONE);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar att = gl.COLOR_ATTACHMENT0;\r\n\t\t\tfor (var c in colorTargets) {\r\n\t\t\t\tvar ct = colorTargets[c];\r\n\t\t\t\tif (ct.target == gl.TEXTURE_2D) {\r\n\t\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, ct.handle, 0);\r\n\t\t\t\t}\r\n\t\t\t\telse if (ct.target == gl.RENDERBUFFER) {\r\n\t\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, ct.handle);\r\n\t\t\t\t}\r\n\t\t\t\tdrawBuffers.push(att);\r\n\t\t\t\tcts.push(ct);\r\n\t\t\t\tatt++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//gl.drawBuffers(drawBuffers);\r\n\tvar fbStatus = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n\tvar trg = null;\r\n\tif (cts.length > 0) {\r\n\t\ttrg = cts[0];\r\n\t}\r\n\telse if (depthTarget) {\r\n\t\ttrg = depthTarget;\r\n\t}\r\n\telse if (stencilTarget) {\r\n\t\ttrg = stencilTarget;\r\n\t}\r\n\r\n\tvar width  = 0;\r\n\tvar height = 0;\r\n\tif (trg) {\r\n\t\twidth  = trg.width;\r\n\t\theight = trg.height;\r\n\t}\r\n\r\n\tvar obj = new SglFramebufferInfo()\r\n\tobj.handle        = fb;\r\n\tobj.valid         = (fbStatus == gl.FRAMEBUFFER_COMPLETE);\r\n\tobj.width         = width;\r\n\tobj.height        = height;\r\n\tobj.colorTargets  = cts;\r\n\tobj.depthTarget   = (depthTarget  ) ? (depthTarget  ) : (null);\r\n\tobj.stencilTarget = (stencilTarget) ? (stencilTarget) : (null);\r\n\tobj.status        = fbStatus;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglFramebufferFromFormats(gl, width, height, colorFormats, depthFormat, stencilFormat, options) {\r\n\tvar opt = sglGetFramebufferOptions(gl, options);\r\n\r\n\tvar colorTargets = null;\r\n\tif (colorFormats) {\r\n\t\topt.isDepth = false;\r\n\t\tcolorTargets = [ ];\r\n\t\tvar ct = null;\r\n\t\tif (opt.colorsAsRenderbuffer) {\r\n\t\t\tfor (var c in colorFormats) {\r\n\t\t\t\tvar cc = colorFormats[c];\r\n\t\t\t\tct = sglRenderbufferFromFormat(gl, cc, width, height);\r\n\t\t\t\tcolorTargets.push(ct);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateColorsMipmap;\r\n\t\t\tfor (var c in colorFormats) {\r\n\t\t\t\tvar cc = colorFormats[c];\r\n\t\t\t\tct = sglTexture2DFromData(gl, cc, width, height, gl.RGBA, gl.UNSIGNED_BYTE, null, opt);\r\n\t\t\t\tcolorTargets.push(ct);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar depthTarget = null;\r\n\tif (depthFormat) {\r\n\t\topt.isDepth = true;\r\n\t\tif (opt.depthAsRenderbuffer) {\r\n\t\t\tdepthTarget = sglRenderbufferFromFormat(gl, depthFormat, width, height);\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateDepthMipmap;\r\n\t\t\tdepthTarget = sglTexture2DFromData(gl, depthFormat, width, height, gl.DEPTH_COMPONENT, gl.FLOAT, null, opt);\r\n\t\t}\r\n\t}\r\n\r\n\tvar stencilTarget = null;\r\n\tif (stencilFormat) {\r\n\t\topt.isDepth = false;\r\n\t\tif (opt.stencilAsRenderbuffer) {\r\n\t\t\tstencilTarget = sglRenderbufferFromFormat(gl, stencilFormat, width, height);\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateStencilMipmap;\r\n\t\t\tstencilTarget = sglTexture2DFromData(gl, stencilFormat, width, height, gl.STENCIL_COMPONENT, gl.UNSIGNED_BYTE, null, opt);\r\n\t\t}\r\n\t}\r\n\r\n\treturn sglFramebufferFromTargets(gl, colorTargets, depthTarget, stencilTarget, opt);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglVertexBuffer\r\n/***********************************************************************/\r\n// SglVertexBuffer(gl, info)\r\n// SglVertexBuffer(gl, values, usage)\r\n/**\r\n * Constructs a SglVertexBuffer.\r\n * @class Manages a WebGL vertex buffer object.\r\n */\r\nfunction SglVertexBuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\tif (arguments[1] instanceof SglBufferInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglVertexBufferFromData(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n}\r\n\r\nSglVertexBuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid) {\r\n\t\t\tthis.gl.deleteBuffer(this._info.handle);\r\n\t\t}\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglIndexBuffer\r\n/***********************************************************************/\r\n// SglIndexBuffer(gl, info)\r\n// SglIndexBuffer(gl, values, usage)\r\n/**\r\n * Constructs a SglIndexBuffer.\r\n * @class Manages a WebGL index buffer object.\r\n */\r\nfunction SglIndexBuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\tif (arguments[1] instanceof SglBufferInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglIndexBufferFromData(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n}\r\n\r\nSglIndexBuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid) {\r\n\t\t\tthis.gl.deleteBuffer(this._info.handle);\r\n\t\t}\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramAttribute\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttribute.\r\n * @class Manages a program attribute.\r\n */\r\nfunction SglProgramAttribute(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n}\r\n\r\nSglProgramAttribute.prototype = {\r\n\tset index(n) {\r\n\t\tthis._prog.gl.bindAttribLocation(this._prog._info.handle, n, this._info.name)\r\n\t\tthis._info.location = n;\r\n\t},\r\n\r\n\tget index () {\r\n\t\treturn this._info.location;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramUniform\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramUniform.\r\n * @class Manages a program uniform.\r\n */\r\nfunction SglProgramUniform(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n\tthis._func = null;\r\n\r\n\tvar gl   = this._prog.gl;\r\n\tvar type = this._info.nativeType;\r\n\r\n\tif (type == gl.BOOL) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1i(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1i(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1f(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix2fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix3fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix4fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse {\r\n\t\tsglUnknown();\r\n\t}\r\n}\r\n\r\nSglProgramUniform.prototype = {\r\n\tset value(v) {\r\n\t\tthis._func(v);\r\n\t},\r\n\r\n\tget value() {\r\n\t\treturn this._prog.gl.getUniform(this._prog._info.handle, this._info.location);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramSampler\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramSampler.\r\n * @class Manages a program sampler.\r\n */\r\nfunction SglProgramSampler(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n\tthis._unit = -1;\r\n\r\n\tvar gl   = this._prog.gl;\r\n\tvar type = this._info.nativeType;\r\n\r\n\tif (type == gl.SAMPLER_2D) {\r\n\t\t;\r\n\t}\r\n\telse if (type == gl.SAMPLER_CUBE) {\r\n\t\t;\r\n\t}\r\n\telse if (type == 35682) {\r\n\t\t;\r\n\t}\r\n\telse {\r\n\t\tsglUnknown();\r\n\t}\r\n}\r\n\r\nSglProgramSampler.prototype = {\r\n\tset unit(n) {\r\n\t\tthis._prog.gl.uniform1i(this._info.location, n);\r\n\t\tthis._unit = n;\r\n\t},\r\n\r\n\tget unit() {\r\n\t\t//return this._prog.gl.getUniform(this._prog._info.handle, this._info.location);\r\n\t\treturn this._unit;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgram\r\n/***********************************************************************/\r\n// SglProgram(gl, info)\r\n// SglProgram(gl, [vertexSources], [fragmentSources])\r\n/**\r\n * Constructs a SglProgram.\r\n * @class Manages a WebGL program object.\r\n */\r\nfunction SglProgram() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tif (arguments[1] instanceof SglProgramInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglProgramFromSources(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n\r\n\tthis._attributes = new Object();\r\n\tfor (var a in this._info.attributes) {\r\n\t\tthis._attributes[a] = new SglProgramAttribute(this, this._info.attributes[a]);\r\n\t}\r\n\r\n\tthis._uniforms = new Object();\r\n\tfor (var u in this._info.uniforms) {\r\n\t\tthis._uniforms[u] = new SglProgramUniform(this, this._info.uniforms[u]);\r\n\t}\r\n\r\n\tvar unit = 0;\r\n\tthis._samplers = new Object();\r\n\tfor (var s in this._info.samplers) {\r\n\t\tthis._samplers[s] = new SglProgramSampler(this, this._info.samplers[s]);\r\n\t\tthis._samplers[s]._unit = unit;\r\n\t\tunit++;\r\n\t}\r\n}\r\n\r\nSglProgram.prototype =\r\n{\r\n\tget info()       { return this._info;        },\r\n\tget attributes() { return this._attributes;  },\r\n\tget uniforms()   { return this._uniforms;    },\r\n\tget samplers()   { return this._samplers;    },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid == null) return;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tgl.deleteProgram(this._info.handle);\r\n\t\tfor (var s in this._info.shaders) {\r\n\t\t\tgl.deleteShader(this._info.shaders[s].handle);\r\n\t\t}\r\n\r\n\t\tthis._attributes = null;\r\n\t\tthis._uniforms   = null;\r\n\t\tthis._samplers   = null;\r\n\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tget log() {\r\n\t\tvar log = \"\";\r\n\t\tlog += \"-------------------------------------\\n\";\r\n\t\tfor (var s in this._info.shaders) {\r\n\t\t\tlog += this._info.shaders[s].log;\r\n\t\t}\r\n\t\tlog += this._info.log;\r\n\t\tlog += \"-------------------------------------\\n\";\r\n\t\tlog += \"\\n\";\r\n\t\treturn log;\r\n\t},\r\n\r\n\tsetDefaultBindings : function() {\r\n\t\tsglSetDefaultProgramBindings(this.gl, this._info);\r\n\t},\r\n\r\n\tsynchronize : function() {\r\n\t\tsglProgramSynchronize(this.gl, this._info);\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.useProgram(this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\t//this.gl.useProgram(null);\r\n\t},\r\n\r\n\tsetAttributes : function(mapping) {\r\n\t\tvar attr = null;\r\n\t\tfor (var a in mapping) {\r\n\t\t\tattr = this._attributes[a];\r\n\t\t\tif (attr) {\r\n\t\t\t\tattr.index = mapping[a];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.link();\r\n\t},\r\n\r\n\tsetUniforms : function(mapping) {\r\n\t\tvar unif = null;\r\n\t\tfor (var u in mapping) {\r\n\t\t\tunif = this._uniforms[u];\r\n\t\t\tif (unif) {\r\n\t\t\t\tunif.value = mapping[u];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetSamplers : function(mapping) {\r\n\t\tvar smp = null;\r\n\t\tfor (var s in mapping) {\r\n\t\t\tsmp = this._samplers[s];\r\n\t\t\tif (smp != undefined) {\r\n\t\t\t\tsmp.unit = mapping[s];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTexture2D\r\n/***********************************************************************/\r\n// SglTexture2D(gl, info)\r\n// SglTexture2D(gl, internalFormat, width, height, sourceFormat, sourceType, texels, options)\r\n// SglTexture2D(gl, image, options)\r\n// SglTexture2D(gl, url, options)\r\n/**\r\n * Constructs a SglTexture2D.\r\n * @class Manages a WebGL 2D texture object.\r\n */\r\nfunction SglTexture2D() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif ((n == 2) || (n == 3)) {\r\n\t\tif (arguments[1] instanceof Image) {\r\n\t\t\tthis._info = sglTexture2DFromImage(gl, arguments[1], arguments[2]);\r\n\t\t}\r\n\t\t//else if (arguments[1] instanceof String) {\r\n\t\telse if (typeof(arguments[1]) == \"string\") {\r\n\t\t\tthis._info = sglTexture2DFromUrl(gl, arguments[1], arguments[2]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._info = arguments[1];\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglTexture2DFromData(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7]);\r\n\t}\r\n}\r\n\r\nSglTexture2D.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteTexture(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, null);\r\n\t},\r\n\r\n\tgenerateMipmap : function() {\r\n\t\tthis.gl.generateMipmap(this._info.target);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTextureCube\r\n/***********************************************************************/\r\n// SglTextureCube(gl, info)\r\n// SglTextureCube(gl, internalFormat, width, height, sourceFormat, sourceType, facesTexels, options)\r\n// SglTextureCube(gl, images, options)\r\n// SglTextureCube(gl, urls, options)\r\n/**\r\n * Constructs a SglTextureCube.\r\n * @class Manages a WebGL cube texture object.\r\n */\r\nfunction SglTextureCube() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif ((n == 2) || (n == 3)) {\r\n\t\tif (arguments[1] instanceof Array) {\r\n\t\t\tif (arguments[1][0] instanceof Image) {\r\n\t\t\t\tthis._info = sglTextureCubeFromImages(gl, arguments[1], arguments[2]);\r\n\t\t\t}\r\n\t\t\t//else if (arguments[1] instanceof String) {\r\n\t\t\telse if (typeof(arguments[1][0]) == \"string\") {\r\n\t\t\t\tthis._info = sglTextureCubeFromUrls(gl, arguments[1], arguments[2]);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._info = arguments[1];\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglTextureCubeFromData(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7]);\r\n\t}\r\n}\r\n\r\nSglTextureCube.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteTexture(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, null);\r\n\t},\r\n\r\n\tgenerateMipmap : function() {\r\n\t\tthis.gl.generateMipmap(this._info.target);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglRenderbuffer\r\n/***********************************************************************/\r\n// SglRenderbuffer(gl, info)\r\n// SglRenderbuffer(gl, format, width, height)\r\n/**\r\n * Constructs a SglRenderbuffer.\r\n * @class Manages a WebGL renderbuffer object.\r\n */\r\nfunction SglRenderbuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif (n == 2) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglRenderbufferFromFormat(gl, arguments[1], arguments[2], arguments[3]);\r\n\t}\r\n}\r\n\r\nSglRenderbuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteRenderbuffer(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindRenderbuffer(this.gl.RENDERBUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindRenderbuffer(this.gl.RENDERBUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglFramebuffer\r\n/***********************************************************************/\r\n// SglFramebuffer(gl, info)\r\n// SglFramebuffer(gl, width, height, colorFormats, depthFormat, stencilFormat, options)\r\n/**\r\n * Constructs a SglFramebuffer.\r\n * @class Manages a WebGL framebuffer object.\r\n */\r\nfunction SglFramebuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif (n == 2) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglFramebufferFromFormats(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6]);\r\n\t}\r\n\r\n\tvar s = null;\r\n\tvar t = null;\r\n\r\n\tthis._colorTargets = [ ];\r\n\tfor (var c in this._info.colorTargets) {\r\n\t\ts = this._info.colorTargets[c];\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._colorTargets.push(t);\r\n\t}\r\n\r\n\tthis._depthTarget = null;\r\n\tif (this._info.depthTarget) {\r\n\t\ts = this._info.depthTarget;\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._depthTarget = t;\r\n\t}\r\n\r\n\tthis._stencilTarget = null;\r\n\tif (this._info.stencilTarget) {\r\n\t\ts = this._info.stencilTarget;\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._stencilTarget = t;\r\n\t}\r\n}\r\n\r\nSglFramebuffer.prototype = {\r\n\tget info()          { return this._info;          },\r\n\tget colorTargets()  { return this._colorTargets;  },\r\n\tget depthTarget()   { return this._depthTarget;   },\r\n\tget stencilTarget() { return this._stencilTarget; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteFramebuffer(this._info.handle);\r\n\t\tfor (var t in this._colorTargets) {\r\n\t\t\tvar ct = this._colorTargets[t];\r\n\t\t\tif (ct) {\r\n\t\t\t\tthis._colorTargets[t].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._depthTarget) {\r\n\t\t\tthis._depthTarget.destroy();\r\n\t\t}\r\n\t\tif (this._stencilTarget) {\r\n\t\t\tthis._stencilTarget.destroy();\r\n\t\t}\r\n\t\tthis._info   = null;\r\n\t\tthis.targets = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tget width() {\r\n\t\treturn this._info.width;\r\n\t},\r\n\r\n\tget height() {\r\n\t\treturn this._info.height;\r\n\t},\r\n\r\n\tbind : function(setViewport) {\r\n\t\tvar vp = true;\r\n\t\tif (setViewport != undefined) vp = setViewport;\r\n\r\n\t\tif (vp) {\r\n\t\t\tthis.gl.viewport(0, 0, this._info.width, this._info.height);\r\n\t\t}\r\n\r\n\t\tthis.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\r\n\t},\r\n\r\n\tbindColor : function(index, unit) {\r\n\t\tthis._colorTargets[index].bind(unit);\r\n\t},\r\n\r\n\tunbindColor : function(index, unit) {\r\n\t\tthis._colorTargets[index].unbind(unit);\r\n\t},\r\n\r\n\tbindDepth : function(unit) {\r\n\t\tthis._depthTarget.bind(unit);\r\n\t},\r\n\r\n\tunbindDepth : function(unit) {\r\n\t\tthis._depthTarget.unbind(unit);\r\n\t},\r\n\r\n\tbindStencil : function(unit) {\r\n\t\tthis._stencilTarget.bind(unit);\r\n\t},\r\n\r\n\tunbindStencil : function(unit) {\r\n\t\tthis._stencilTarget.unbind(unit);\r\n\t},\r\n\r\n\tgenerateMipmap : function(colors, depth, stencil) {\r\n\t\tvar t = null;\r\n\r\n\t\tif (colors) {\r\n\t\t\tfor (var c in this._colorTargets) {\r\n\t\t\t\tt = this._colorTargets[c];\r\n\t\t\t\tif (!t) continue;\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (depth) {\r\n\t\t\tt = this._depthTarget;\r\n\t\t\tif (t) {\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (stencil) {\r\n\t\t\tt = this._stencilTarget;\r\n\t\t\tif (t) {\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tattachColorTarget : function(index, t) {\r\n\t\tif (!t) return false;\r\n\t\tif ((index < 0) || (index >= this._colorTargets.length)) return false;\r\n\t\tif ((t.width != this.width) || (t.height != this.height)) return false;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tvar att = this.gl.COLOR_ATTACHMENT0 + index;\r\n\t\tif (t.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, t.handle, 0);\r\n\t\t}\r\n\t\telse if (t.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, t.handle);\r\n\t\t}\r\n\r\n\t\tthis._colorTargets[index] = t;\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tdetachColorTarget : function(index) {\r\n\t\tif ((index < 0) || (index >= this._colorTargets.length)) return false;\r\n\r\n\t\tvar t = this._colorTargets[index]\r\n\t\tif (!t) return false;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tif (t.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, null, 0);\r\n\t\t}\r\n\t\telse if (t.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, null);\r\n\t\t}\r\n\r\n\t\tthis._colorTargets[index] = null;\r\n\r\n\t\treturn true;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglAttributeStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglAttributeStreamJS.\r\n * @class Holds the properties and the storage array of a vertex attribute stream.\r\n */\r\nfunction SglAttributeStreamJS(name, size, values, byCopy) {\r\n\tthis._name = name;\r\n\tthis._size = size;\r\n\tthis._buff = (byCopy) ? ((values) ? (values.slice()) : (null)) : (values);\r\n}\r\n\r\nSglAttributeStreamJS.prototype = {\r\n\tget name()       { return this._name; },\r\n\tget size()       { return this._size; },\r\n\tget buffer()     { return this._buff; },\r\n\tget length()     { return this._buff.length; },\r\n\r\n\tget : function(index) {\r\n\t\treturn this._buff.slice(index * this._size, this._size);\r\n\t},\r\n\r\n\tset : function(index, value) {\r\n\t\tvar k = index * this._size;\r\n\t\tfor (var i=0; i<this._size; ++i) {\r\n\t\t\tthis._buff[k++] = value[i];\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglVertexStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglVertexStreamJS.\r\n * @class Container of vertex attribute streams.\r\n */\r\nfunction SglVertexStreamJS() {\r\n\tthis._attribs = { };\r\n\tthis._length  = 0;\r\n}\r\n\r\nSglVertexStreamJS.prototype = {\r\n\tget attributes() { return this._attribs; },\r\n\tget length()     { return this._length;  },\r\n\r\n\taddAttribute : function(name, size, values, byCopy) {\r\n\t\tvar attr = new SglAttributeStreamJS(name, size, values, byCopy);\r\n\t\tthis._attribs[name] = attr;\r\n\t\tthis._length = attr.length;\r\n\t},\r\n\r\n\tremoveAttribute : function(name) {\r\n\t\tif (!this._attribs[name]) return;\r\n\r\n\t\tdelete this._attribs[name];\r\n\r\n\t\tthis._length = 0;\r\n\t\tfor (var a in this._attribs) {\r\n\t\t\tthis._length = this._attribs[a].length;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\nvar SGL_ARRAY_PRIMITIVE_STREAM          = 1;\r\nvar SGL_INDEXED_PRIMITIVE_STREAM        = 2;\r\nvar SGL_PACKED_INDEXED_PRIMITIVE_STREAM = 3;\r\n\r\nvar SGL_POINTS_LIST    = 1;\r\nvar SGL_LINES_LIST     = 2;\r\nvar SGL_LINE_STRIP     = 3;\r\nvar SGL_LINE_LOOP      = 4;\r\nvar SGL_TRIANGLES_LIST = 5;\r\nvar SGL_TRIANGLE_STRIP = 6;\r\nvar SGL_TRIANGLE_FAN   = 7;\r\n\r\n\r\n// SglPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPrimitiveStreamJS.\r\n * @class Holds the primitives stream information and storage (if any).\r\n */\r\nfunction SglPrimitiveStreamJS(name, mode, first, length) {\r\n\tthis._name = name;\r\n\tthis._mode = mode;\r\n\tthis._first  = (first)  ? (first)  : (0);\r\n\tthis._length = (length) ? (length) : (0);\r\n}\r\n\r\nSglPrimitiveStreamJS.prototype = {\r\n\tget type()   { return undefined;    },\r\n\tget name()   { return this._name;   },\r\n\tget mode()   { return this._mode;   },\r\n\tget first()  { return this._first;  },\r\n\tget length() { return this._length; }\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglArrayPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglArrayPrimitiveStreamJS.\r\n * @class Holds the array primitive stream information.\r\n */\r\nfunction SglArrayPrimitiveStreamJS(name, mode, first, count) {\r\n\tSglPrimitiveStreamJS.call(this, name, mode, first, count);\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_ARRAY_PRIMITIVE_STREAM;}});\r\n}\r\n\r\nsglInherit(SglArrayPrimitiveStreamJS, SglPrimitiveStreamJS);\r\n/*sglDefineGetter(SglArrayPrimitiveStreamJS, \"type\", function() {\r\n\treturn SGL_ARRAY_PRIMITIVE_STREAM;\r\n});*/\r\n/***************************************************************/\r\n\r\n\r\n// SglIndexedPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglIndexedPrimitiveStreamJS.\r\n * @class Holds the indexed primitive stream information and storage.\r\n */\r\nfunction SglIndexedPrimitiveStreamJS(name, mode, indices, byCopy) {\r\n\tSglPrimitiveStreamJS.call(this, name, mode, 0, indices.length);\r\n\r\n\tthis._buff = (byCopy) ? ((indices) ? (indices.slice()) : (null)) : (indices);\r\n\t\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_INDEXED_PRIMITIVE_STREAM;}});\r\n\tObject.defineProperty(this, \"buffer\", {get: function(){return this._buff;}});\r\n\tObject.defineProperty(this, \"length\", {get: function(){return this._buff.length;}});\r\n}\r\n\r\n\r\nsglInherit(SglIndexedPrimitiveStreamJS, SglPrimitiveStreamJS);\r\n/*sglDefineGetter(SglIndexedPrimitiveStreamJS, \"type\", function() {\r\n\treturn SGL_INDEXED_PRIMITIVE_STREAM;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamJS, \"buffer\", function() {\r\n\treturn this._buff;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamJS, \"length\", function() {\r\n\treturn this._buff.length;\r\n});*/\r\n/***************************************************************/\r\n\r\n\r\n// SglConnectivityJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglConnectivityJS.\r\n * @class Container for primitive streams.\r\n */\r\nfunction SglConnectivityJS() {\r\n\tthis._prims = { };\r\n}\r\n\r\nSglConnectivityJS.prototype = {\r\n\tget primitives() { return this._prims; },\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tvar prim = new SglArrayPrimitiveStreamJS(name, mode, first, count)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices, byCopy) {\r\n\t\tvar prim = new SglIndexedPrimitiveStreamJS(name, mode, indices, byCopy)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\tremovePrimitives : function(name) {\r\n\t\tif (!this._prims[name]) return;\r\n\t\tdelete this._prims[name];\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglMeshJS.\r\n * @class Mesh definition with vertex stream and primitive stream.\r\n */\r\nfunction SglMeshJS() {\r\n\tthis._valid = false;\r\n\tthis._vert  = new SglVertexStreamJS();\r\n\tthis._conn  = new SglConnectivityJS();\r\n}\r\n\r\nSglMeshJS.prototype = {\r\n\tget isValid()      { return this._valid;  },\r\n\tset isValid(value) { this._valid = value; },\r\n\r\n\tget vertices()     { return this._vert; },\r\n\tget connectivity() { return this._conn; },\r\n\r\n\taddVertexAttribute : function(name, size, values, byCopy) {\r\n\t\tthis._vert.addAttribute(name, size, values, byCopy);\r\n\t},\r\n\r\n\tremoveVertexAttribute : function(name) {\r\n\t\tthis._vert.removeAttribute(name);\r\n\t},\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tthis._conn.addArrayPrimitives(name, mode, first, count);\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices, byCopy) {\r\n\t\tthis._conn.addIndexedPrimitives(name, mode, indices, byCopy);\r\n\t},\r\n\r\n\tremovePrimitives : function(name) {\r\n\t\tthis._conn.removePrimitives(name);\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// importers\r\n/***********************************************************************/\r\nfunction sglMeshJSImportOBJFromString(mesh, text) {\r\n\tvar positionsArray = [ ];\r\n\tvar texcoordsArray = [ ];\r\n\tvar normalsArray   = [ ];\r\n\tvar indicesArray   = [ ];\r\n\r\n\tvar positions = [ ];\r\n\tvar texcoords = [ ];\r\n\tvar normals   = [ ];\r\n\tvar facemap   = { };\r\n\tvar index     = 0;\r\n\r\n\tvar line = null;\r\n\tvar f   = null;\r\n\tvar pos = 0;\r\n\tvar tex = 0;\r\n\tvar nor = 0;\r\n\tvar x   = 0.0;\r\n\tvar y   = 0.0;\r\n\tvar z   = 0.0;\r\n\tvar tokens = null;\r\n\r\n\tvar hasPos = false;\r\n\tvar hasTex = false;\r\n\tvar hasNor = false;\r\n\r\n\tvar lines = text.split(\"\\n\");\r\n\tfor (var lineIndex in lines) {\r\n\t\tline = lines[lineIndex].replace(/[ \\t]+/g, \" \").replace(/\\s\\s*$/, \"\");\r\n\r\n\t\tif (line[0] == \"#\") continue;\r\n\r\n\t\ttokens = line.split(\" \");\r\n\t\tif (tokens[0] == \"v\") {\r\n\t\t\tpositions.push(parseFloat(tokens[1]));\r\n\t\t\tpositions.push(parseFloat(tokens[2]));\r\n\t\t\tpositions.push(parseFloat(tokens[3]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"vt\") {\r\n\t\t\ttexcoords.push(parseFloat(tokens[1]));\r\n\t\t\ttexcoords.push(parseFloat(tokens[2]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"vn\") {\r\n\t\t\tnormals.push(parseFloat(tokens[1]));\r\n\t\t\tnormals.push(parseFloat(tokens[2]));\r\n\t\t\tnormals.push(parseFloat(tokens[3]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"f\") {\r\n\t\t\tif (tokens.length != 4) continue;\r\n\r\n\t\t\tfor (var i=1; i<4; ++i) {\r\n\t\t\t\tif (!(tokens[i] in facemap)) {\r\n\t\t\t\t\tf = tokens[i].split(\"/\");\r\n\r\n\t\t\t\t\tif (f.length == 1) {\r\n\t\t\t\t\t\tpos = parseInt(f[0]) - 1;\r\n\t\t\t\t\t\ttex = pos;\r\n\t\t\t\t\t\tnor = pos;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (f.length == 3) {\r\n\t\t\t\t\t\tpos = parseInt(f[0]) - 1;\r\n\t\t\t\t\t\ttex = parseInt(f[1]) - 1;\r\n\t\t\t\t\t\tnor = parseInt(f[2]) - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tz = 0.0;\r\n\t\t\t\t\tif ((pos * 3 + 2) < positions.length) {\r\n\t\t\t\t\t\thasPos = true;\r\n\t\t\t\t\t\tx = positions[pos*3+0];\r\n\t\t\t\t\t\ty = positions[pos*3+1];\r\n\t\t\t\t\t\tz = positions[pos*3+2];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpositionsArray.push(x);\r\n\t\t\t\t\tpositionsArray.push(y);\r\n\t\t\t\t\tpositionsArray.push(z);\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tif ((tex * 2 + 1) < texcoords.length) {\r\n\t\t\t\t\t\thasTex = true;\r\n\t\t\t\t\t\tx = texcoords[tex*2+0];\r\n\t\t\t\t\t\ty = texcoords[tex*2+1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttexcoordsArray.push(x);\r\n\t\t\t\t\ttexcoordsArray.push(y);\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tz = 1.0;\r\n\t\t\t\t\tif ((nor * 3 + 2) < normals.length) {\r\n\t\t\t\t\t\thasNor = true;\r\n\t\t\t\t\t\tx = normals[nor*3+0];\r\n\t\t\t\t\t\ty = normals[nor*3+1];\r\n\t\t\t\t\t\tz = normals[nor*3+2];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnormalsArray.push(x);\r\n\t\t\t\t\tnormalsArray.push(y);\r\n\t\t\t\t\tnormalsArray.push(z);\r\n\r\n\t\t\t\t\tfacemap[tokens[i]] = index++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tindicesArray.push(facemap[tokens[i]]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (hasPos) {\r\n\t\tmesh.addVertexAttribute(\"position\", 3, positionsArray, false);\r\n\t}\r\n\tif (hasNor) {\r\n\t\tmesh.addVertexAttribute(\"normal\", 3, normalsArray, false);\r\n\t}\r\n\tif (hasTex) {\r\n\t\tmesh.addVertexAttribute(\"texcoord\", 2, texcoordsArray, false);\r\n\t}\r\n\r\n\tif (indicesArray.length > 0) {\r\n\t\tmesh.addIndexedPrimitives(\"triangles\", SGL_TRIANGLES_LIST, indicesArray, false);\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction sglMeshJSImportOBJFromURL(mesh, url, asynch, callback) {\r\n\tmesh.isValid = false;\r\n\r\n\tif (!asynch) {\r\n\t\tvar txt = sglLoadFile(url);\r\n\t\tmesh.isValid = sglMeshJSImportOBJFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t\treturn mesh.isValid;\r\n\t}\r\n\r\n\tsglLoadFile(url, function(txt) {\r\n\t\tmesh.isValid = sglMeshJSImportOBJFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t});\r\n\r\n\treturn true;\r\n}\r\n\r\nSglMeshJS.prototype.parseOBJ = function(txt) {\r\n\tthis.isValid = sglMeshJSImportOBJFromString(this, txt);\r\n\treturn this.isValid;\r\n};\r\n\r\nSglMeshJS.prototype.importOBJ = function(url, asynch, callback) {\r\n\treturn sglMeshJSImportOBJFromURL(this, url, asynch, callback);\r\n};\r\n\r\nfunction _sglFindVertexAttributeJSON(m, name) {\r\n\tfor (var a in m.vertices) {\r\n\t\tif (m.vertices[a].name === name) {\r\n\t\t\treturn m.vertices[a];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction _sglFindConnectivityJSON(m, name) {\r\n\tfor (var a in m.connectivity) {\r\n\t\tif (m.connectivity[a].name === name) {\r\n\t\t\treturn m.connectivity[a];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglMeshJSImportJSONFromString(mesh, text) {\r\n\tvar m = JSON.parse(text);\r\n\tif (!m) return false;\r\n\r\n\tvar mapping = m.mapping;\r\n\tvar stdMapping = null;\r\n\tfor (var v in mapping) {\r\n\t\tif (mapping[v].name === \"standard\") {\r\n\t\t\tstdMapping = mapping[v];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (!stdMapping) return false;\r\n\r\n\tfor (var a in stdMapping.attributes) {\r\n\t\tvar vm = stdMapping.attributes[a];\r\n\t\tvar vattr = _sglFindVertexAttributeJSON(m, vm.source);\r\n\t\tif (!vattr) continue;\r\n\t\tif (vattr.normalized) {\r\n\t\t\tfor (var i=0, n=vattr.values.length; i<n; ++i) {\r\n\t\t\t\tvattr.values[i] /= 255.0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmesh.addVertexAttribute(vm.semantic, vattr.size, vattr.values, false);\r\n\t}\r\n\r\n\tvar conn = _sglFindConnectivityJSON(m, stdMapping.primitives);\r\n\tif (!conn) return false;\r\n\tmesh.addIndexedPrimitives(conn.name, SGL_TRIANGLES_LIST, conn.indices, false);\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction sglMeshJSImportJSONFromURL(mesh, url, asynch, callback) {\r\n\tmesh.isValid = false;\r\n\r\n\tif (!asynch) {\r\n\t\tvar txt = sglLoadFile(url);\r\n\t\tmesh.isValid = sglMeshJSImportJSONFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t\treturn mesh.isValid;\r\n\t}\r\n\r\n\tsglLoadFile(url, function(txt) {\r\n\t\tmesh.isValid = sglMeshJSImportJSONFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t});\r\n\r\n\treturn true;\r\n}\r\n\r\nSglMeshJS.prototype.parseJSON = function(txt) {\r\n\tthis.isValid = sglMeshJSImportJSONFromString(this, txt);\r\n\treturn this.isValid;\r\n};\r\n\r\nSglMeshJS.prototype.importJSON = function(url, asynch, callback) {\r\n\treturn sglMeshJSImportJSONFromURL(this, url, asynch, callback);\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// utilities\r\n/***************************************************************/\r\nfunction sglGLTypeSize(gl, type) {\r\n\tif (type == gl.BYTE)           return 1;\r\n\tif (type == gl.UNSIGNED_BYTE)  return 1;\r\n\tif (type == gl.SHORT)          return 2;\r\n\tif (type == gl.UNSIGNED_SHORT) return 2;\r\n\tif (type == gl.INT)            return 4;\r\n\tif (type == gl.UNSIGNED_INT)   return 4;\r\n\tif (type == gl.FLOAT)          return 4;\r\n\treturn null;\r\n}\r\n\r\nfunction sglGLTypeFromWebGLArray(gl, wglArray) {\r\n\tif (wglArray instanceof Int8Array   ) return gl.BYTE;\r\n\tif (wglArray instanceof Uint8Array  ) return gl.UNSIGNED_BYTE;\r\n\tif (wglArray instanceof Int16Array  ) return gl.SHORT;\r\n\tif (wglArray instanceof Uint16Array ) return gl.UNSIGNED_SHORT;\r\n\tif (wglArray instanceof Int32Array  ) return gl.INT;\r\n\tif (wglArray instanceof Uint32Array ) return gl.UNSIGNED_INT;\r\n\tif (wglArray instanceof Float32Array) return gl.FLOAT;\r\n\treturn null;\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglAttributeStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglAttributeStreamGL.\r\n * @class Holds the properties and the storage buffer of a vertex attribute stream.\r\n */\r\nfunction SglAttributeStreamGL(gl, name, size, values, normalized) {\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, values);\r\n\tvar stride = sglGLTypeSize(gl, type) * size;\r\n\r\n\tthis.gl      = gl;\r\n\tthis._name   = name;\r\n\tthis._size   = size;\r\n\tthis._type   = type;\r\n\tthis._norm   = (normalized) ? (true) : (false);\r\n\tthis._stride = stride;\r\n\tthis._offset = 0;\r\n\tthis._length = values.length / size;\r\n\tthis._buff   = new SglVertexBuffer(gl, values, { usage : gl.STATIC_DRAW });\r\n}\r\n\r\nSglAttributeStreamGL.prototype = {\r\n\tget name()         { return this._name;   },\r\n\tget size()         { return this._size;   },\r\n\tget type()         { return this._type;   },\r\n\tget isNormalized() { return this._norm;   },\r\n\tget stride()       { return this._stride; },\r\n\tget offset()       { return this._offset; },\r\n\tget buffer()       { return this._buff;   },\r\n\tget length()       { return this._length; },\r\n\r\n\tdestroy : function() {\r\n\t\tthis._buff.destroy();\r\n\t},\r\n\r\n\tbind : function(index, baseVertex) {\r\n\t\tvar off = ((baseVertex) ? (baseVertex) : (0)) * this._stride;\r\n\t\tthis._buff.bind();\r\n\t\tthis.gl.vertexAttribPointer(index, this._size, this._type, this._norm, this._stride, this._offset + off);\r\n\t},\r\n\r\n\tunbind : function(index) {\r\n\t\tthis._buff.unbind();\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglVertexStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglVertexStreamGL.\r\n * @class Container of vertex attribute streams.\r\n */\r\nfunction SglVertexStreamGL(gl) {\r\n\tthis.gl       = gl;\r\n\tthis._attribs = new Object();\r\n\tthis._length  = 0;\r\n}\r\n\r\nSglVertexStreamGL.prototype = {\r\n\tget attributes() { return this._attribs; },\r\n\tget length()     { return this._length;  },\r\n\r\n\tdestroy : function() {\r\n\t\tfor (var attr in this._attribs) {\r\n\t\t\tthis._attribs[attr].destroy();\r\n\t\t}\r\n\t},\r\n\r\n\taddAttribute : function(name, size, normalized, values) {\r\n\t\tvar attr = new SglAttributeStreamGL(this.gl, name, size, normalized, values)\r\n\t\tthis._attribs[name] = attr;\r\n\t\tthis._length = attr.length;\r\n\t},\r\n\r\n\tremoveAttribute : function(name, doDestroy) {\r\n\t\tif (!this._attribs[name]) return;\r\n\r\n\t\tif (doDestroy) {\r\n\t\t\tthis._attribs[name].destroy();\r\n\t\t}\r\n\r\n\t\tdelete this._attribs[name];\r\n\r\n\t\tthis._length = 0;\r\n\t\tfor (var a in this._attribs) {\r\n\t\t\tthis._length = this._attribs[a].length;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\tbind : function(mapping, baseVertex) {\r\n\t\tvar vm = null;\r\n\t\tfor (var m in mapping) {\r\n\t\t\tvm = this._attribs[m];\r\n\t\t\tif (vm) {\r\n\t\t\t\tvm.bind(mapping[m], baseVertex)\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tunbind : function(mapping) {\r\n\t\tvar vm = null;\r\n\t\tfor (var m in mapping) {\r\n\t\t\tvm = this._attribs[m];\r\n\t\t\tif (vm) {\r\n\t\t\t\tvm.unbind(mapping[m])\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPrimitiveStreamGL.\r\n * @class Holds the primitives stream information and storage (if any).\r\n */\r\nfunction SglPrimitiveStreamGL(gl, name, mode, first, length) {\r\n\tthis.gl      = gl;\r\n\tthis._name   = name;\r\n\tthis._mode   = mode;\r\n\tthis._first  = (first)  ? (first)  : (0);\r\n\tthis._length = (length) ? (length) : (0);\r\n}\r\n\r\nSglPrimitiveStreamGL.prototype = {\r\n\t_clampRange : function(first, count) {\r\n\t\tvar end = this._first + this._length;\r\n\r\n\t\tvar f = this._first + ((first >= 0) ? (first) : (0));\r\n\t\tif (f >= end) return null;\r\n\r\n\t\tvar c = (count >= 0) ? (count) : (this._length);\r\n\t\tvar vEnd = (f + c);\r\n\t\tif (vEnd > end) c -= vEnd - end;\r\n\r\n\t\treturn [f, c];\r\n\t},\r\n\r\n\t_render : function(first, count) {\r\n\t\t;\r\n\t},\r\n\r\n\tget type()   { return undefined;    },\r\n\tget name()   { return this._name;   },\r\n\tget mode()   { return this._mode;   },\r\n\tget first()  { return this._first;  },\r\n\tget length() { return this._length; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._destroy) {\r\n\t\t\tthis._destroy();\r\n\t\t}\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\t;\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\t;\r\n\t},\r\n\r\n\trender : function(first, count) {\r\n\t\tvar range = this._clampRange(first, count);\r\n\t\tthis._render(range[0], range[1]);\r\n\t}\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglArrayPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglArrayPrimitiveStreamGL.\r\n * @class Holds the array primitive stream information.\r\n */\r\nfunction SglArrayPrimitiveStreamGL(gl, name, mode, first, count) {\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, first, count);\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_ARRAY_PRIMITIVE_STREAM;}});\r\n}\r\n\r\nsglInherit(SglArrayPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n/*sglDefineGetter(SglArrayPrimitiveStreamGL, \"type\", function() {\r\n\treturn SGL_ARRAY_PRIMITIVE_STREAM;\r\n});*/\r\n\r\n\r\n\r\nSglArrayPrimitiveStreamGL.prototype._render = function(first, count) {\r\n\tthis.gl.drawArrays(this._mode, first, count);\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglIndexedPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglIndexedPrimitiveStreamGL.\r\n * @class Holds the indexed primitive stream information and storage.\r\n */\r\nfunction SglIndexedPrimitiveStreamGL(gl, name, mode, indices) {\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, 0, indices.length);\r\n\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, indices);\r\n\tvar stride = sglGLTypeSize(gl, type);\r\n\r\n\tthis._idxType = type;\r\n\tthis._stride  = stride;\r\n\tthis._buff    = new SglIndexBuffer(gl, indices, { usage : gl.STATIC_DRAW });\r\n\t\r\n\tObject.defineProperty(this, \"indexType\", {get: function(){return this._idxType;}});\r\n\tObject.defineProperty(this, \"stride\", {get: function(){return this._stride;}});\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_INDEXED_PRIMITIVE_STREAM;}});\r\n}\r\n\r\n\r\nsglInherit(SglIndexedPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n/*sglDefineGetter(SglIndexedPrimitiveStreamGL, \"indexType\", function() {\r\n\treturn this._idxType;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamGL, \"stride\", function() {\r\n\treturn this._stride;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamGL, \"type\", function() {\r\n\treturn SGL_INDEXED_PRIMITIVE_STREAM;\r\n});*/\r\n\r\nSglIndexedPrimitiveStreamGL.prototype._destroy = function() {\r\n\tthis._buff.destroy();\r\n\tthis._buff = null;\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype.bind = function() {\r\n\tthis._buff.bind();\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype.unbind = function() {\r\n\tthis._buff.unbind();\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype._render = function(first, count) {\r\n\tthis.gl.drawElements(this._mode, count, this._idxType, first * this._stride);\r\n}\r\n\r\n\r\n\r\n/***************************************************************/\r\n\r\n\r\n// SglPackedIndexedPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPackedIndexedPrimitiveStream.\r\n * @class Holds the packed indexed primitive stream information and storage.\r\n */\r\nfunction SglPackedIndexedPrimitiveStreamGL(gl, name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\tif (blockStartingIndices.length != blockStartingVertices.length) {\r\n\t\tsglInvalidParameter();\r\n\t}\r\n\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, 0, indices.length);\r\n\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, indices);\r\n\tvar stride = sglGLTypeSize(gl, type);\r\n\r\n\tthis._idxType = type;\r\n\tthis._stride  = stride;\r\n\tthis._buff    = new SglIndexBuffer(gl, indices, { usage : gl.STATIC_DRAW });\r\n\r\n\r\n\tthis._blockStartingVertices = blockStartingVertices.slice();\r\n\tvar n = this._blockStartingVertices.length;\r\n\r\n\tthis._blockStartingIndices = blockStartingIndices.slice();\r\n\tthis._blockIndicesCount    = new Array(n);\r\n\r\n\tvar start = this._blockStartingIndices[0];\r\n\tfor (var i=0; i<(n-1); ++i) {\r\n\t\tvar sIdx = this._blockStartingIndices[i+1];\r\n\t\tthis._blockIndicesCount[i] = sIdx - start;\r\n\t\tstart = sIdx;\r\n\t}\r\n\tthis._blockIndicesCount[n-1] = indices.length - start;\r\n\t\r\n\tObject.defineProperty(this, \"isPacked\", {get: function(){return true;}});\r\n\tObject.defineProperty(this, \"indexType\", {get: function(){return this._idxType;}});\r\n\tObject.defineProperty(this, \"stride\", {get: function(){return this._stride;}});\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_PACKED_INDEXED_PRIMITIVE_STREAM;}});\r\n\tObject.defineProperty(this, \"blocksCount\", {get: function(){return this._blockStartingIndices.length;}});\r\n\tObject.defineProperty(this, \"blockStartingVertices\", {get: function(){return this._blockStartingVertices;}});\r\n\tObject.defineProperty(this, \"blockIndicesCount\", {get: function(){return this._blockIndicesCount;}});\r\n}\r\n\r\nsglInherit(SglPackedIndexedPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype._destroy = function() {\r\n\tthis._buff.destroy();\r\n\tthis._buff = null;\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.bind = function() {\r\n\tthis._buff.bind();\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.unbind = function() {\r\n\tthis._buff.unbind();\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype._clampBlockRange = function(block, first, count) {\r\n\tvar end = this._blockStartingIndices[block] + this._blockIndicesCount[block];\r\n\r\n\tvar f = this._blockStartingIndices[block] + ((first >= 0) ? (first) : (0));\r\n\tif (f >= end) return null;\r\n\r\n\tvar c = (count >= 0) ? (count) : (this._blockIndicesCount[block]);\r\n\tvar vEnd = (f + c);\r\n\tif (vEnd > end) c -= vEnd - end;\r\n\r\n\treturn [f, c];\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.blockRanges = function(first, count) {\r\n\tvar range = this._clampRange(first, count);\r\n\tvar n     = this._blockStartingIndices.length;\r\n\r\n\tvar firstBlock = 0;\r\n\twhile ((firstBlock < n) && (range[0] < this._blockStartingIndices[firstBlock])) {\r\n\t\tfirstBlock++;\r\n\t}\r\n\tif (firstBlock >= n) return null;\r\n\r\n\tvar last = range[0] + range[1] - 1;\r\n\tvar lastBlock = firstBlock;\r\n\twhile ((lastBlock < n) && (last >= (this._blockStartingIndices[lastBlock] + this._blockIndicesCount[lastBlock]))) {\r\n\t\tlastBlock++;\r\n\t}\r\n\tif (lastBlock >= n) lastBlock = n - 1;\r\n\r\n\tvar ranges = [ ];\r\n\tvar f = range[0] - this._blockStartingIndices[firstBlock];\r\n\tvar c = range[1];\r\n\tvar e = f + range[1];\r\n\tif (e > this._blockIndicesCount[firstBlock]) c = this._blockIndicesCount[firstBlock] - this._blockStartingIndices[firstBlock];\r\n\tranges.push([firstBlock, f, c, this._blockStartingVertices[firstBlock]]);\r\n\tfor (var i=firstBlock+1; i<lastBlock; ++i) {\r\n\t\tranges.push([i, 0, this._blockIndicesCount[i], this._blockStartingVertices[i]]);\r\n\t}\r\n\tif (lastBlock > firstBlock) {\r\n\t\tranges.push([i, 0, range[0] + range[1] - this._blockStartingIndices[lastBlock], this._blockStartingVertices[lastBlock]]);\r\n\t}\r\n\r\n\treturn ranges;\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.renderBlock = function(block, first, count) {\r\n\tvar range = this._clampBlockRange(block, first, count);\r\n\tthis.gl.drawElements(this._mode, range[1], this._idxType, range[0] * this._stride);\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglConnectivityGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglConnectivityGL.\r\n * @class Container of primitive streams.\r\n */\r\nfunction SglConnectivityGL(gl) {\r\n\tthis.gl     = gl;\r\n\tthis._prims = new Object();\r\n}\r\n\r\nSglConnectivityGL.prototype = {\r\n\tget primitives() { return this._prims; },\r\n\r\n\tdestroy : function() {\r\n\t\tfor (var prim in this._prims) {\r\n\t\t\tthis._prims[prim].destroy();\r\n\t\t}\r\n\t},\r\n\r\n\taddArrayPrimitives: function(name, mode, first, count) {\r\n\t\tvar prim = new SglArrayPrimitiveStreamGL(this.gl, name, mode, first, count)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices) {\r\n\t\tvar prim = new SglIndexedPrimitiveStreamGL(this.gl, name, mode, indices)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddPackedIndexedPrimitives : function(name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\t\tvar prim = new SglPackedIndexedPrimitiveStreamGL(this.gl, name, mode, indices, blockStartingIndices, blockStartingVertices)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\tremovePrimitives : function(name, doDestroy) {\r\n\t\tif (!this._prims[name]) return;\r\n\r\n\t\tif (doDestroy) {\r\n\t\t\tthis._prims[name].destroy();\r\n\t\t}\r\n\r\n\t\tdelete this._prims[name];\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglMeshGL.\r\n * @class Mesh definition with vertex stream and primitive stream.\r\n */\r\nfunction SglMeshGL(gl) {\r\n\tthis.gl    = gl;\r\n\tthis._vert = new SglVertexStreamGL(this.gl);\r\n\tthis._conn = new SglConnectivityGL(this.gl);\r\n}\r\n\r\nSglMeshGL.prototype = {\r\n\tget vertices()     { return this._vert; },\r\n\tget connectivity() { return this._conn; },\r\n\r\n\tdestroy : function() {\r\n\t\tthis._vert.destroy();\r\n\t\tthis._conn.destroy();\r\n\t},\r\n\r\n\taddVertexAttribute : function(name, size, values, normalized) {\r\n\t\tthis._vert.addAttribute(name, size, values, normalized);\r\n\t},\r\n\r\n\tremoveVertexAttribute : function(name, doDestroy) {\r\n\t\tthis._vert.removeAttribute(name, doDestroy);\r\n\t},\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tthis._conn.addArrayPrimitives(name, mode, first, count);\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices) {\r\n\t\tthis._conn.addIndexedPrimitives(name, mode, indices);\r\n\t},\r\n\r\n\taddPackedIndexedPrimitives : function(name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\t\tthis._conn.addPackedIndexedPrimitives(name, mode, indices, blockStartingIndices, blockStartingVertices);\r\n\t},\r\n\r\n\tremovePrimitives : function(name, doDestroy) {\r\n\t\tthis._conn.removePrimitives(name, doDestroy);\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshRenderer\r\n/***************************************************************/\r\nvar SGL_DefaultStreamMappingPrefix = \"a_\";\r\n\r\n/**\r\n * Constructs a SglMeshGLRenderer.\r\n * @class Takes charge of mesh rendering, including program attributes, uniforms and samplers bindings.\r\n */\r\nfunction SglMeshGLRenderer(program, doSynchronize) {\r\n\tthis._prog        = program;\r\n\tthis._mapping     = null;\r\n\tthis._meshAttrMap = null;\r\n\tthis._mesh        = null;\r\n\tthis._primStream  = null;\r\n\tthis._phase       = 0;\r\n\r\n\tthis._updateEnabledVB = false;\r\n\r\n\tif (doSynchronize) {\r\n\t\tthis.synchronizeProgram();\r\n\t}\r\n\r\n\tthis.setStreamMapping();\r\n}\r\n\r\nSglMeshGLRenderer.prototype = {\r\n\t_bindVertexBuffers : function(baseVertex) {\r\n\t\tthis._mesh.vertices.bind(this._meshAttrMap, baseVertex);\r\n\t},\r\n\r\n\t_unbindVertexBuffers : function() {\r\n\t\tthis._mesh.vertices.unbind(this._meshAttrMap);\r\n\t},\r\n\r\n\tget program() { return this.prog; },\r\n\r\n\tsynchronizeProgram : function() {\r\n\t\tthis._prog.synchronize();\r\n\r\n\t\tvar doLink = false;\r\n\t\tvar index = 0;\r\n\t\tvar attr = null;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tattr = this._prog.attributes[a];\r\n\t\t\tif (attr.index != index) {\r\n\t\t\t\tattr.index = index;\r\n\t\t\t\tdoLink = true;\r\n\t\t\t}\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\tif (doLink) {\r\n\t\t\tthis._prog.link();\r\n\t\t}\r\n\r\n\t\tvar unit = 0;\r\n\t\tvar smp = null;\r\n\t\tfor (var s in this._prog.samplers) {\r\n\t\t\tsmp = this._prog.samplers[s];\r\n\t\t\tsmp.unit = unit;\r\n\t\t\tunit++;\r\n\t\t}\r\n\t},\r\n\r\n\tgetStreamMappingFromPrefix : function(prefix) {\r\n\t\tvar n = prefix.length;\r\n\t\tvar mapping = new Object();\r\n\t\tvar src = null;\r\n\t\tfor (var attr in this._prog.attributes) {\r\n\t\t\tif (attr.substr(0, n) == prefix) {\r\n\t\t\t\tsrc = attr.substr(n);\r\n\t\t\t\tif (src.length > 0) {\r\n\t\t\t\t\tmapping[attr] = src;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn mapping;\r\n\t},\r\n\r\n\tsetStreamMapping : function(mapping) {\r\n\t\t//if ((this._phase != 0) && (this._phase != 1)) return;\r\n\r\n\t\tthis._updateEnabledVB = true;\r\n\r\n\t\tvar meshAttrName = null;\r\n\r\n\t\tthis._mapping = this.getStreamMappingFromPrefix(SGL_DefaultStreamMappingPrefix);\r\n\t\tfor (var progAttrName in mapping) {\r\n\t\t\tmeshAttrName = mapping[progAttr];\r\n\t\t\tif (this._prog.attributes[progAttrName]) {\r\n\t\t\t\tthis._mapping[progAttrName] = meshAttrName;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._meshAttrMap = { };\r\n\t\tvar progAttr = null;\r\n\t\tfor (var progAttrName in this._mapping) {\r\n\t\t\tmeshAttrName = this._mapping[progAttrName];\r\n\t\t\tprogAttr     = this._prog.attributes[progAttrName];\r\n\t\t\tthis._meshAttrMap[meshAttrName] = progAttr.index;\r\n\t\t}\r\n\r\n\t\tif (this._mesh) {\r\n\t\t\tthis._bindVertexBuffers(0);\r\n\t\t}\r\n\t},\r\n\r\n\tsetStreamMappingFromPrefix : function(prefix) {\r\n\t\tif (!prefix) prefix = SGL_DefaultStreamMappingPrefix;\r\n\t\tvar mapping = this.getStreamMappingFromPrefix(prefix);\r\n\t\tthis.setStreamMapping(mapping);\r\n\t},\r\n\r\n\tsetUniforms : function(mapping) {\r\n\t\tif (this._phase == 0) return;\r\n\t\tthis._prog.setUniforms(mapping);\r\n\t},\r\n\r\n\tsetSamplers : function(mapping) {\r\n\t\tif (this._phase == 0) return;\r\n\r\n\t\tvar samplers = { };\r\n\t\tvar textures = { };\r\n\r\n\t\tvar t = null;\r\n\t\tfor (var s in mapping) {\r\n\t\t\tt = mapping[s];\r\n\t\t\tif (typeof(t) == \"number\") {\r\n\t\t\t\tsamplers[s] = t;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttextures[s] = t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._prog.setSamplers(samplers);\r\n\r\n\t\tvar smp = null;\r\n\t\tfor (var s in textures) {\r\n\t\t\tsmp = this._prog.samplers[s];\r\n\t\t\tif (smp) {\r\n\t\t\t\ttextures[s].bind(smp.unit);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tbegin : function() {\r\n\t\tif (this._phase != 0) return;\r\n\t\t/*\r\n\t\tvar gl = this._prog.gl;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tgl.enableVertexAttribArray(this._prog.attributes[a].index);\r\n\t\t}\r\n\t\t*/\r\n\t\tthis._prog.bind();\r\n\t\tthis._phase = 1;\r\n\t},\r\n\r\n\tend : function() {\r\n\t\tif (this._phase != 1) return;\r\n\t\tthis._prog.unbind();\r\n\t\tvar gl = this._prog.gl;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tgl.disableVertexAttribArray(this._prog.attributes[a].index);\r\n\t\t}\r\n\t\tthis._phase = 0;\r\n\t},\r\n\r\n\tbeginMesh : function(mesh) {\r\n\t\tif (this._phase != 1) return;\r\n\t\tthis._updateEnabledVB = true;\r\n\t\tthis._mesh = mesh;\r\n\t\tthis._bindVertexBuffers(0);\r\n\t\tthis._phase = 2;\r\n\t},\r\n\r\n\tendMesh : function() {\r\n\t\tif (this._phase != 2) return;\r\n\t\tthis._unbindVertexBuffers();\r\n\t\tthis._prog.gl.bindBuffer(this._prog.gl.ARRAY_BUFFER, null);\r\n\t\tthis._mesh = null;\r\n\t\tthis._phase = 1;\r\n\t},\r\n\r\n\tbeginPrimitives : function(name) {\r\n\t\tif (this._phase != 2) return;\r\n\t\tthis._primStream = this._mesh.connectivity.primitives[name];\r\n\t\tthis._primStream.bind();\r\n\t\tthis._phase = 3;\r\n\t},\r\n\r\n\tendPrimitives : function() {\r\n\t\tif (this._phase != 3) return;\r\n\t\tthis._primStream.unbind();\r\n\t\tthis._primStream = null;\r\n\t\tthis._phase = 2;\r\n\t},\r\n\r\n\trender : function(first, count) {\r\n\t\tif (this._phase != 3) return;\r\n\r\n\t\tvar gl = this._prog.gl;\r\n\t\tvar vIndex = 0;\r\n\r\n\t\tif (this._updateEnabledVB) {\r\n\t\t\tthis._updateEnabledVB = false;\r\n\t\t\tfor (var progAttr in this._mapping) {\r\n\t\t\t\tvIndex = this._prog.attributes[progAttr].index;\r\n\t\t\t\tif (this._mesh.vertices.attributes[this._mapping[progAttr]]) {\r\n\t\t\t\t\tgl.enableVertexAttribArray(vIndex);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tgl.disableVertexAttribArray(vIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._primStream.isPacked) {\r\n\t\t\tif (this._primStream.blocksCount > 0) {\r\n\t\t\t\tvar blocks = this._primStream.blockRanges(first, count);\r\n\t\t\t\tvar n = blocks.length;\r\n\t\t\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\t\t\tthis._bindVertexBuffers(blocks[i][3]);\r\n\t\t\t\t\tthis._primStream.renderBlock(blocks[i][0], blocks[i][1], blocks[i][2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._primStream.render(first, count);\r\n\t\t}\r\n\t},\r\n\r\n\trenderMeshPrimitives : function(mesh, name, first, count) {\r\n\t\tthis.beginMesh(mesh);\r\n\t\t\tthis.beginPrimitives(name);\r\n\t\t\t\tthis.render(first, count);\r\n\t\t\tthis.endPrimitives();\r\n\t\tthis.endMesh();\r\n\t}\r\n};\r\n\r\nfunction sglRenderMeshGLPrimitives(mesh, name, program, streamMapping, uniforms, samplers, first, count) {\r\n\tvar renderer = new SglMeshGLRenderer(program);\r\n\trenderer.begin();\r\n\tif (streamMapping) renderer.setStreamMapping (streamMapping);\r\n\tif (uniforms     ) renderer.setUniforms      (uniforms     );\r\n\tif (samplers     ) renderer.setSamplers      (samplers     );\r\n\tif (name) {\r\n\t\trenderer.renderMeshPrimitives(mesh, name, first, count);\r\n\t}\r\n\telse {\r\n\t\tvar primitives = mesh.connectivity.primitives;\r\n\t\tfor (var p in primitives) {\r\n\t\t\trenderer.renderMeshPrimitives(mesh, p, first, count);\r\n\t\t}\r\n\t}\r\n}\r\n/***************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// utilities\r\n/***********************************************************************/\r\nfunction sglMeshJSCalculateBBox(meshJS, attribName) {\r\n\tvar attrn     = attribName || \"position\";\r\n\r\n\tvar posAttrib = meshJS.vertices.attributes[attrn];\r\n\tvar posSize   = posAttrib.size;\r\n\tvar posBuffer = posAttrib.buffer;\r\n\r\n\tvar bbox = new SglBox3();\r\n\tif (posSize != 3) return bbox;\r\n\r\n\tvar n = posBuffer.length / posSize;\r\n\tif (n <= 0) return bbox;\r\n\r\n\tn *= posSize;\r\n\r\n\tfor (var j=0; j<posSize; ++j) {\r\n\t\tbbox.min[j] = posBuffer[j];\r\n\t\tbbox.max[j] = posBuffer[j];\r\n\t}\r\n\r\n\tvar val = 0.0;\r\n\tfor (var i=posSize; i<n; i+=posSize) {\r\n\t\tfor (var j=0; j<posSize; ++j) {\r\n\t\t\tval = posBuffer[i+j];\r\n\t\t\tif (bbox.min[j] > val) bbox.min[j] = val;\r\n\t\t\tif (bbox.max[j] < val) bbox.max[j] = val;\r\n\t\t}\r\n\t}\r\n\r\n\treturn bbox;\r\n}\r\n\r\nSglMeshJS.prototype.calculateBoundingBox = function(attribName) {\r\n\treturn sglMeshJSCalculateBBox(this, attribName);\r\n};\r\n\r\nfunction sglGLPrimitiveType(gl, primType) {\r\n\tswitch (primType) {\r\n\t\tcase SGL_POINTS_LIST    : return gl.POINTS;         break;\r\n\t\tcase SGL_LINES_LIST     : return gl.LINES;          break;\r\n\t\tcase SGL_LINE_STRIP     : return gl.LINE_STRIP;     break;\r\n\t\tcase SGL_LINE_LOOP      : return gl.LINE_LOOP;      break;\r\n\t\tcase SGL_TRIANGLES_LIST : return gl.TRIANGLES;      break;\r\n\t\tcase SGL_TRIANGLE_STRIP : return gl.TRIANGLE_STRIP; break;\r\n\t\tcase SGL_TRIANGLE_FAN   : return gl.TRIANGLE_FAN;   break;\r\n\t\tdefault                 : return undefined;         break;\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\nfunction sglMeshJStoGL(gl, meshJS) {\r\n\tvar meshGL = new SglMeshGL(gl);\r\n\r\n\tfor (a in meshJS.vertices.attributes) {\r\n\t\tvar attr = meshJS.vertices.attributes[a];\r\n\t\tmeshGL.addVertexAttribute(attr.name, attr.size, new Float32Array(attr.buffer));\r\n\t}\r\n\r\n\tfor (p in meshJS.connectivity.primitives) {\r\n\t\tvar prim = meshJS.connectivity.primitives[p];\r\n\t\tvar ptype = sglGLPrimitiveType(meshGL.gl, prim.mode);\r\n\t\tif (ptype == undefined) continue;\r\n\r\n\t\tswitch (prim.type) {\r\n\t\t\tcase SGL_ARRAY_PRIMITIVE_STREAM :\r\n\t\t\t\tmeshGL.addArrayPrimitives(prim.name, ptype, prim.first, prim.length);\r\n\t\t\tbreak;\r\n\t\t\tcase SGL_INDEXED_PRIMITIVE_STREAM :\r\n\t\t\t\tmeshGL.addIndexedPrimitives(prim.name, ptype, new Uint16Array(prim.buffer));\r\n\t\t\tbreak;\r\n\t\t\tdefault :\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn meshGL;\r\n}\r\n\r\nSglMeshJS.prototype.toMeshGL = function(gl) {\r\n\treturn sglMeshJStoGL(gl, this);\r\n};\r\n\r\nfunction sglPackMeshJStoGL(gl, mesh, primitives, maxVertexIndex) {\r\n\tvar primName = primitives     || \"triangles\";\r\n\tvar maxInd   = maxVertexIndex || 65000;\r\n\r\n\tvar prim = mesh.connectivity.primitives[primName];\r\n\r\n\tif (!prim) return null;\r\n\tif (prim.type != SGL_INDEXED_PRIMITIVE_STREAM) return null;\r\n\r\n\tvar pmode = sglGLPrimitiveType(gl, prim.mode);\r\n\tif (pmode == undefined) return null;\r\n\r\n\tvar ariety   = 0;\r\n\tif (pmode === gl.TRIANGLES) {\r\n\t\tariety = 3;\r\n\t}\r\n\telse if (pmode === gl.LINES) {\r\n\t\tariety = 2;\r\n\t}\r\n\telse if (pmode === gl.POINTS) {\r\n\t\tariety = 1;\r\n\t}\r\n\telse {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar res   = [ ];\r\n\r\n\tvar srcIndices = prim.buffer;\r\n\tvar n          = srcIndices.length;\r\n\tn -= (n % ariety);\r\n\r\n\tvar start = 0;\r\n\r\n\tvar startVertex = 0;\r\n\tvar startIndex  = 0;\r\n\tvar startVertices = [ ];\r\n\tvar startIndices  = [ ];\r\n\r\n\tvar newIndices = [ ];\r\n\tvar newAttribs = { };\r\n\tfor (var a in mesh.vertices.attributes) {\r\n\t\tvar attr  = mesh.vertices.attributes[a];\r\n\t\tnewAttribs[a] = {\r\n\t\t\tname   : attr.name,\r\n\t\t\tsize   : attr.size,\r\n\t\t\tbuffer : [ ]\r\n\t\t};\r\n\t}\r\n\r\n\twhile (start < n) {\r\n\t\tvar indicesMap = { };\r\n\t\tvar dstIndices = [ ];\r\n\t\tvar vtxCount = 0;\r\n\r\n\t\tvar indicesMap = { };\r\n\t\tvar vtxCount   = 0;\r\n\t\tfor (var i=start; i<n; i+=ariety) {\r\n\t\t\tvar triIndices       = { };\r\n\t\t\tvar newVerticesCount = 0;\r\n\t\t\tfor (var j=0; j<ariety; ++j) {\r\n\t\t\t\tvar srcIdx = srcIndices[i+j];\r\n\t\t\t\tif (triIndices[srcIdx] == undefined) {\r\n\t\t\t\t\ttriIndices[srcIdx] = true;\r\n\t\t\t\t\tif (indicesMap[srcIdx] == undefined) {\r\n\t\t\t\t\t\tnewVerticesCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ((vtxCount + newVerticesCount) <= maxInd) {\r\n\t\t\t\tfor (var j=0; j<ariety; ++j) {\r\n\t\t\t\t\tvar srcIdx = srcIndices[i+j];\r\n\t\t\t\t\tvar dstIdx = indicesMap[srcIdx];\r\n\t\t\t\t\tif (dstIdx == undefined) {\r\n\t\t\t\t\t\tindicesMap[srcIdx] = vtxCount;\r\n\t\t\t\t\t\tdstIdx = vtxCount;\r\n\t\t\t\t\t\tvtxCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdstIndices.push(dstIdx);\r\n\t\t\t\t}\r\n\t\t\t\tstart += ariety;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (vtxCount <= 0) break;\r\n\r\n\t\tvar idxCount = dstIndices.length;\r\n\r\n\t\tfor (var a in mesh.vertices.attributes) {\r\n\t\t\tvar srcAttr  = mesh.vertices.attributes[a];\r\n\t\t\tvar dstAttr  = newAttribs[a];\r\n\t\t\tvar asize    = srcAttr.size;\r\n\t\t\tvar dstBase  = dstAttr.buffer.length;\r\n\t\t\tvar newArr   = new Array(vtxCount * asize);\r\n\t\t\tdstAttr.buffer = dstAttr.buffer.concat(newArr);\r\n\r\n\t\t\tvar srcBuff = srcAttr.buffer;\r\n\t\t\tvar dstBuff = dstAttr.buffer;\r\n\t\t\tfor (var i in indicesMap) {\r\n\t\t\t\tvar dstIdx = indicesMap[i];\r\n\t\t\t\tfor (var c=0; c<asize; ++c) {\r\n\t\t\t\t\tdstBuff[dstBase + (dstIdx*asize+c)] = srcBuff[i*asize+c];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tnewIndices = newIndices.concat(dstIndices);\r\n\r\n\t\tstartVertices.push(startVertex);\r\n\t\tstartIndices.push(startIndex);\r\n\r\n\t\tstartVertex += vtxCount;\r\n\t\tstartIndex  += idxCount;\r\n\t}\r\n\r\n\tvar m = new SglMeshGL(gl);\r\n\r\n\tfor (var a in newAttribs) {\r\n\t\tvar attr = newAttribs[a];\r\n\t\tm.addVertexAttribute(attr.name, attr.size, new Float32Array(attr.buffer));\r\n\t}\r\n\r\n\tif (startVertices.length == 1) {\r\n\t\tm.addIndexedPrimitives(primName, pmode, new Uint16Array(newIndices));\r\n\t}\r\n\telse {\r\n\t\tm.addPackedIndexedPrimitives(primName, pmode, new Uint16Array(newIndices), startIndices, startVertices);\r\n\t}\r\n\r\n\treturn m;\r\n}\r\n\r\nSglMeshJS.prototype.toPackedMeshGL = function(gl, primitives, maxVertexIndex) {\r\n\treturn sglPackMeshJStoGL(gl, this, primitives, maxVertexIndex);\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglTrackball\r\n/***********************************************************************/\r\nvar SGL_TRACKBALL_NO_ACTION = 0;\r\nvar SGL_TRACKBALL_ROTATE    = 1;\r\nvar SGL_TRACKBALL_PAN       = 2;\r\nvar SGL_TRACKBALL_DOLLY     = 3;\r\nvar SGL_TRACKBALL_SCALE     = 4;\r\n\r\n/**\r\n * Constructs a SglTrackball object.\r\n * @class Interactor which implements a typical trackball controller.\r\n */\r\nfunction SglTrackball() {\r\n\tthis._matrix = sglIdentityM4();\r\n\tthis._pts    = [ [0.0, 0.0], [0.0, 0.0] ];\r\n\tthis._action = SGL_TRACKBALL_NO_ACTION;\r\n\r\n\tthis.reset();\r\n}\r\n\r\nSglTrackball.prototype = {\r\n\t_projectOnSphere : function(x, y) {\r\n\t\tvar r = 1.0;\r\n\r\n\t\tvar z = 0.0;\r\n\t\tvar d = sglSqrt(x*x + y*y);\r\n\t\tif (d < (r * 0.70710678118654752440)) {\r\n\t\t\t/* Inside sphere */\r\n\t\t\tz = sglSqrt(r*r - d*d);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t/* On hyperbola */\r\n\t\t\tt = r / 1.41421356237309504880;\r\n\t\t\tz = t*t / d;\r\n\t\t}\r\n\t\treturn z;\r\n\t},\r\n\r\n\t_transform : function(m, x, y, z) {\r\n\t\treturn sglMulM4V4(m, sglV4C(x, y, z, 0.0));\r\n\t},\r\n\r\n\t_transformOnSphere : function(m, x, y) {\r\n\t\tvar z = this._projectOnSphere(x, y);\r\n\t\treturn this._transform(m, x, y, z);\r\n\t},\r\n\r\n\t_translate : function(offset, f) {\r\n\t\tvar invMat = sglInverseM4(this._matrix);\r\n\t\tvar t = sglV3toV4(offset, 0.0);\r\n\t\tt = sglMulM4V4(invMat, t);\r\n\t\tt = sglMulSV4(f, t);\r\n\t\tvar trMat = sglTranslationM4V(t);\r\n\t\tthis._matrix = sglMulM4(this._matrix, trMat);\r\n\t},\r\n\r\n\tget action()  { return this._action; },\r\n\tset action(a) { this._action = a     },\r\n\r\n\tget matrix() { return this._matrix; },\r\n\r\n\treset : function () {\r\n\t\tthis._matrix = sglIdentityM4();\r\n\t\tthis._pts    = [ [0.0, 0.0], [0.0, 0.0] ];\r\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION\r\n\t},\r\n\r\n\ttrack : function(m, x, y, z) {\r\n\t\tthis._pts[0][0] = this._pts[1][0];\r\n\t\tthis._pts[0][1] = this._pts[1][1];\r\n\t\tthis._pts[1][0] = x;\r\n\t\tthis._pts[1][1] = y;\r\n\r\n\t\tswitch (this._action) {\r\n\t\t\tcase SGL_TRACKBALL_ROTATE:\r\n\t\t\t\tthis.rotate(m);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_PAN:\r\n\t\t\t\tthis.pan(m);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_DOLLY:\r\n\t\t\t\tthis.dolly(m, z);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_SCALE:\r\n\t\t\t\tthis.scale(m, z);\r\n\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\trotate : function(m) {\r\n\t\tif ((this._pts[0][0] == this._pts[1][0]) && (this._pts[0][1] == this._pts[1][1])) return;\r\n\r\n\t\tvar mInv = sglInverseM4(m);\r\n\r\n\t\tvar v0 = this._transformOnSphere(mInv, this._pts[0][0], this._pts[0][1]);\r\n\t\tvar v1 = this._transformOnSphere(mInv, this._pts[1][0], this._pts[1][1]);\r\n\r\n\t\tvar axis   = sglCrossV3(v0, v1);\r\n\t\tvar angle  = sglLengthV3(axis);\r\n\t\tvar rotMat = sglRotationAngleAxisM4V(angle, axis);\r\n\r\n\t\tthis._matrix = sglMulM4(rotMat, this._matrix);\r\n\t},\r\n\r\n\tpan : function(m) {\r\n\t\tvar mInv = sglInverseM4(m);\r\n\t\tvar v0 = this._transform(mInv, this._pts[0][0], this._pts[0][1], -1.0);\r\n\t\tvar v1 = this._transform(mInv, this._pts[1][0], this._pts[1][1], -1.0);\r\n\t\tvar offset = sglSubV3(v1, v0);\r\n\t\tthis._translate(offset, 2.0);\r\n\t},\r\n\r\n\tdolly : function(m, dz) {\r\n\t\tvar mInv = sglInverseM4(m);\r\n\t\tvar offset = this._transform(mInv, 0.0, 0.0, dz);\r\n\t\tthis._translate(offset, 1.0);\r\n\t},\r\n\r\n\tscale : function(m, s) {\r\n\t\tvar scaleMat = sglScalingM4C(s, s, s);\r\n\t\tthis._matrix = sglMulM4(this._matrix, scaleMat);\r\n\t}\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglFirstPersonCamera\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglFirstPersonCamera object.\r\n * The default pose is positioned at the origin, looking towards the -Z axis with 0 degrees roll.\r\n * The camera moves on the XZ plane, having +Y as upward axis.\r\n * @class Interactor which implements typical First-Person camera movements.\r\n */\r\nfunction SglFirstPersonCamera() {\r\n\tthis._position = sglZeroV3();\r\n\tthis._angles   = sglZeroV3();\r\n\r\n\tthis.lookAt(0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0);\r\n}\r\n\r\nSglFirstPersonCamera.prototype = {\r\n\t/**\r\n\t * Clones the object.\r\n\t * @return {SglFirstPersonCamera} A clone of the object.\r\n\t * @see SglFirstPersonCamera#get:copy\r\n\t */\r\n\tclone : function() {\r\n\t\tvar r = new SglFirstPersonCamera();\r\n\t\tr._position = this._position.slice();\r\n\t\tr._angles   = this._angles.slice();\r\n\t\treturn r;\r\n\t},\r\n\r\n\t/**\r\n\t * Getter for the whole object clone.\r\n\t * It returns a clone of the object.\r\n\t * @name SglFirstPersonCamera#get:copy\r\n\t * @function.\r\n\t * @return {SglFirstPersonCamera}\r\n\t * @see SglFirstPersonCamera#clone\r\n\t */\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets camera pose.\r\n\t * @param {number} positionX The X coordinate of the camera position.\r\n\t * @param {number} positionY The Y coordinate of the camera position.\r\n\t * @param {number} positionZ The Z coordinate of the camera position.\r\n\t * @param {number} targetX   The X coordinate of the point the camera will be looking at.\r\n\t * @param {number} targetY   The Y coordinate of the point the camera will be looking at.\r\n\t * @param {number} targetZ   The Z coordinate of the point the camera will be looking at.\r\n\t * @param {number} roll      The angle (in radians) of rotation around the view direction (upward vector is kepth at Y axis).\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\tlookAt : function(positionX, positionY, positionZ, targetX, targetY, targetZ, roll) {\r\n\t\tthis._position = sglV3C(positionX, positionY, positionZ);\r\n\r\n\t\tvar viewDir = sglSubV3([ targetX, targetY, targetZ ], this._position);\r\n\r\n\t\tthis._angles[0] = sglAtan2( viewDir[1], -viewDir[2]);\r\n\t\tthis._angles[1] = sglAtan2(-viewDir[0], -viewDir[2]);\r\n\t\tthis._angles[2] = (roll) ? (roll) : (0.0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Translates the camera position in its frame of reference.\r\n\t * @param {number} xOffset The amount of translation along the X axis.\r\n\t * @param {number} yOffset The amount of translation along the Y axis.\r\n\t * @param {number} zOffset The amount of translation along the Z axis.\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\ttranslate : function(xOffset, yOffset, zOffset) {\r\n\t\tvar pitchMat  = sglRotationAngleAxisM4C(this._angles[0], 1.0, 0.0, 0.0);\r\n\t\tvar yawMat    = sglRotationAngleAxisM4C(this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rollMat   = sglRotationAngleAxisM4C(this._angles[2], 0.0, 0.0, 1.0);\r\n\t\tvar rotMat    = sglMulM4(rollMat, sglMulM4(yawMat, pitchMat));\r\n\t\tvar rotOffset = sglMulM4V4(rotMat, [ xOffset, yOffset, zOffset, 0.0 ]);\r\n\r\n\t\tthis._position[0] += rotOffset[0];\r\n\t\tthis._position[1] += rotOffset[1];\r\n\t\tthis._position[2] += rotOffset[2];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Translates the camera position in its frame of reference, while preserving the Y coordinate (i.e. altitude).\r\n\t * @param {number} xOffset The amount of translation along the X axis.\r\n\t * @param {number} yOffset The amount of translation along the Y axis.\r\n\t * @param {number} zOffset The amount of translation along the Z axis.\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\ttranslateOnPlane : function(xOffset, yOffset, zOffset) {\r\n\t\tvar rotMat    = sglRotationAngleAxisM4C(this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rotOffset = sglMulM4V4(rotMat, [ xOffset, yOffset, zOffset, 0.0 ]);\r\n\r\n\t\tthis._position[0] += rotOffset[0];\r\n\t\tthis._position[1] += rotOffset[1];\r\n\t\tthis._position[2] += rotOffset[2];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Rotate the camera in its pitch-yaw-roll reference frame.\r\n\t * @param {number} pitchOffset The amount of rotation around the X axis (in radians).\r\n\t * @param {number} yawOffset   The amount of rotation around the Y axis (in radians).\r\n\t * @param {number} rollOffset  The amount of rotation around the view direction (in radians).\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\trotate : function(pitchOffset, yawOffset, rollOffset) {\r\n\t\tthis._angles[0] += pitchOffset;\r\n\t\tthis._angles[1] += yawOffset;\r\n\t\tthis._angles[2] += rollOffset;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Getter for the camera pose matrix.\r\n\t * The camera pose is returned as a 16-element array representing a 4x4 column major transofrmation matrix.\r\n\t * @name SglFirstPersonCamera#get:matrix\r\n\t * @function.\r\n\t * @return {Array}\r\n\t */\r\n\tget matrix() {\r\n\t\tvar pitchMat  = sglRotationAngleAxisM4C(-this._angles[0], 1.0, 0.0, 0.0);\r\n\t\tvar yawMat    = sglRotationAngleAxisM4C(-this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rollMat   = sglRotationAngleAxisM4C(-this._angles[2], 0.0, 0.0, 1.0);\r\n\t\tvar posMat    = sglTranslationM4V(sglNegV3(this._position));\r\n\t\tvar res       = sglMulM4(rollMat, sglMulM4(pitchMat, sglMulM4(yawMat, posMat)));\r\n\r\n\t\treturn res;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// canvas utilities\r\n/***********************************************************************/\r\nfunction sglGetCanvasContext(canvasID) {\r\n\tvar canvas = document.getElementById(canvasID);\r\n\tif (!canvas) return null;\r\n\r\n\tvar contextNames = ['webgl','experimental-webgl','moz-webgl','webkit-3d'];\r\n\t\r\n\tvar gl = null\r\n\tfor(var i = 0; i < contextNames.length; i++)\r\n\t{\r\n\t\ttry \r\n\t\t{\r\n\t\t\tgl = canvas.getContext(contextNames[i]);\r\n\t\t}\r\n\t\tcatch (x) { gl = null; }\r\n        if (gl) break;\r\n\t}\r\n\t\t\r\n\tif (gl == null) return null;\r\n\r\n\tif (gl.FALSE == undefined) gl.FALSE = 0;\r\n\tif (gl.TRUE  == undefined) gl.TRUE  = 1;\r\n\r\n\treturn gl;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglCanvasUI\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglCanvasUI.\r\n * @class Holds current information about the canvas object and input devices state.\r\n */\r\nfunction SglCanvasUI(manager, handler, canvas, gl) {\r\n\tthis._manager = manager;\r\n\tthis._handler = handler;\r\n\tthis._canvas  = canvas;\r\n\r\n\tthis._timerID = null;\r\n\tthis._updRate = 0.0;\r\n\tthis._ignoreKeyRepeat = true;\r\n\r\n\tthis.gl = gl;\r\n\r\n\tthis.loadEvent        = null;\r\n\tthis.unloadEvent      = null;\r\n\tthis.keyDownEvent     = null;\r\n\tthis.keyUpEvent       = null;\r\n\tthis.keyPressEvent    = null;\r\n\tthis.mouseDownEvent   = null;\r\n\tthis.mouseUpEvent     = null;\r\n\tthis.mouseMoveEvent   = null;\r\n\tthis.mouseWheelEvent  = null;\r\n\tthis.clickEvent       = null;\r\n\tthis.dblClickEvent    = null;\r\n\tthis.resizeEvent      = null;\r\n\tthis.updateEvent      = null;\r\n\tthis.drawEvent        = null;\r\n\r\n\tthis.keysDown         = new Object();\r\n\r\n\tthis.mouseButtonsDown = new Object();\r\n\tthis.mousePos         = { x:0, y:0 };\r\n\tthis.mousePrevPos     = { x:0, y:0 };\r\n\tthis.mouseDeltaPos    = { x:0, y:0 };\r\n\r\n\tthis.timeNow   = Date.now() / 1000.0;\r\n\tthis.timePrev  = this.timeNow;\r\n\tthis.timeDelta = 0.0;\r\n}\r\n\r\nSglCanvasUI.prototype = {\r\n\tget canvas() {\r\n\t\treturn this._canvas;\r\n\t},\r\n\r\n\tget width() {\r\n\t\treturn this._canvas.width;\r\n\t},\r\n\r\n\tget height() {\r\n\t\treturn this._canvas.height;\r\n\t},\r\n\r\n\tget ignoreKeyRepeat() {\r\n\t\treturn this._ignoreKeyRepeat;\r\n\t},\r\n\r\n\tset ignoreKeyRepeat(v) {\r\n\t\tthis._ignoreKeyRepeat = v;\r\n\t},\r\n\r\n\tget updateRate() {\r\n\t\tif (this._updRate <= 0.0) return 0.0;\r\n\t\treturn this._updRate;\r\n\t},\r\n\r\n\tset updateRate(r) {\r\n\t\tvar updR = r;\r\n\t\tif (updR < 0.0) updR = 0.0;\r\n\t\tif (updR > 1000.0) updR = 1000.0;\r\n\t\tif (this._updRate == updR) return;\r\n\r\n\t\tthis._updRate = updR;\r\n\r\n\t\tif (this._timerID != null)\r\n\t\t{\r\n\t\t\tclearInterval(this._timerID);\r\n\t\t\tthis._timerID = null;\r\n\t\t}\r\n\r\n\t\tif (this._updRate > 0.0)\r\n\t\t{\r\n\t\t\tvar ms  = 1000.0 / this._updRate;\r\n\t\t\tif (ms < 1.0) ms = 1.0;\r\n\t\t\tvar mgr = this._manager;\r\n\r\n\t\t\tthis.timeNow   = Date.now() / 1000.0;\r\n\t\t\tthis.timePrev  = this.timeNow;\r\n\t\t\tthis.timeDelta = 0.0;\r\n\r\n\t\t\tthis._timerID = setInterval(function() { mgr.update(); }, ms);\r\n\t\t}\r\n\t},\r\n\r\n\tget requestDraw() {\r\n\t\tvar t = this;\r\n\t\treturn (function() { t._manager.requestDraw(); });\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// _SglCanvasManager\r\n/***********************************************************************/\r\nfunction _SglCanvasManager(canvasID, handler, updateRate) {\r\n\tvar canvas = document.getElementById(canvasID);\r\n\tif (!canvas) throw new Error(\"SpiderGL : Canvas not found\");\r\n\r\n\tcanvas.contentEditable = true;\r\n\r\n\tvar gl = sglGetCanvasContext(canvasID);\r\n\tif (!gl) throw new Error(\"SpiderGL : Cannot get WebGL context\");\r\n\r\n\tgl.pixelStorei(gl.PACK_ALIGNMENT,                     1);\r\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT,                   1);\r\n\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,                true);\r\n\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,     false);\r\n\tgl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, gl.NONE);\r\n\r\n\t// for some strange reason, this is a workaround\r\n\t// to have Chrome work properly...\r\n\t// (anyway it should be harmless...)\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n\tvar ui  = new SglCanvasUI(this, handler, canvas, gl);\r\n\tthis.ui = ui;\r\n\r\n\tvar mgr = this;\r\n\r\n\tthis.gl      = gl;\r\n\tthis.canvas  = canvas;\r\n\tthis.handler = handler;\r\n\t//this.handler.prototype.ui = get function() { return ui };\r\n\t//this.handler.ui = get function() { return ui };\r\n\tthis.handler.ui = ui;\r\n\r\n\tthis._drawPending = false;\r\n\tthis.rendering = true;\r\n\tthis._drawFunc = function() {\r\n\t\tmgr.draw();\r\n\t};\r\n\r\n\r\n\tthis.canvas.addEventListener(\"load\",            function(e) { mgr.load        (e); }, false);\r\n\tthis.canvas.addEventListener(\"unload\",          function(e) { mgr.unload      (e); }, false);\r\n\tthis.canvas.addEventListener(\"keydown\",         function(e) { mgr.keyDown     (e); }, false);\r\n\tthis.canvas.addEventListener(\"keyup\",           function(e) { mgr.keyUp       (e); }, false);\r\n\tthis.canvas.addEventListener(\"keypress\",        function(e) { mgr.keyPress    (e); }, false);\r\n\tthis.canvas.addEventListener(\"mousedown\",       function(e) { mgr.mouseDown   (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseup\",         function(e) { mgr.mouseUp     (e); }, false);\r\n\tthis.canvas.addEventListener(\"mousemove\",       function(e) { mgr.mouseMove   (e); }, false);\r\n\tthis.canvas.addEventListener(\"click\",           function(e) { mgr.click       (e); }, false);\r\n\tthis.canvas.addEventListener(\"dblclick\",        function(e) { mgr.dblClick    (e); }, false);\r\n\tthis.canvas.addEventListener(\"resize\",          function(e) { mgr.resize      (e); }, false);\r\n\r\n\tthis.canvas.addEventListener(\"mousewheel\",      function(e) { mgr.mouseWheel  (e); }, false);\r\n\tthis.canvas.addEventListener(\"DOMMouseScroll\",  function(e) { mgr.mouseWheel  (e); }, false);\r\n\r\n\tthis.canvas.addEventListener(\"blur\",            function(e) { mgr.blur        (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseout\",        function(e) { mgr.mouseOut    (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseover\",       function(e) { mgr.mouseOver    (e); }, false);\r\n\t\r\n\tthis.canvas.addEventListener(\"touchstart\",      function(e) { mgr.touchStart  (e); }, false);\r\n\tthis.canvas.addEventListener(\"touchend\",        function(e) { mgr.touchEnd    (e); }, false);\r\n\tthis.canvas.addEventListener(\"touchmove\",       function(e) { mgr.touchMove   (e); }, false);\r\n\t\r\n\tthis.load();\r\n\r\n\tif (updateRate) {\r\n\t\tthis.ui.updateRate = updateRate;\r\n\t}\r\n}\r\n\r\n_SglCanvasManager.prototype = {\r\n\t_getMouseClientPos : function(e) {\r\n\t\tvar rct = this.canvas.getBoundingClientRect();\r\n\t\treturn {\r\n\t\t\tx : (e.clientX - rct.left),\r\n\t\t\ty : (e.clientY - rct.top )\r\n\t\t};\r\n\t},\r\n\r\n\trequestDraw : function() {\r\n\t\tif (this.rendering)\r\n\t\t{\r\n\t\t\tif (!this._drawPending) {\r\n\t\t\t\tthis._drawPending = true;\r\n\t\t\t\tsetTimeout(this._drawFunc, 0);\r\n\t\t\t}\r\n\t\t}\t\r\n\t},\r\n\r\n\tblur : function(e) {\r\n\t\tvar doDraw = false;\r\n\t\tfor (var button in this.ui.mouseButtonsDown) {\r\n\t\t\tif (this.ui.mouseButtonsDown[button]) {\r\n\t\t\t\tthis.ui.mouseButtonsDown[button] = false;\r\n\t\t\t\tif (this.handler.mouseUp) {\r\n\t\t\t\t\tif (this.handler.mouseUp(this.gl, button, this.ui.mousePos.x, this.ui.mousePos.y) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var key in this.ui.keysDown) {\r\n\t\t\tif (this.ui.keysDown[key]) {\r\n\t\t\t\tthis.ui.keysDown[key] = false;\r\n\t\t\t\tif (this.handler.keyUp) {\r\n\t\t\t\t\t// WARNING : passing 0 as keyCode\r\n\t\t\t\t\tif (this.handler.keyUp(this.gl, 0, key) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseOut: function(e) {\r\n\t\tvar doDraw = false;\r\n\t\tfor (var button in this.ui.mouseButtonsDown) {\r\n\t\t\tif (this.ui.mouseButtonsDown[button]) {\r\n\t\t\t\tthis.ui.mouseButtonsDown[button] = false;\r\n\t\t\t\tif (this.handler.mouseOut) {\r\n\t\t\t\t\tif (this.handler.mouseOut(this.gl, this.ui.mousePos.x, this.ui.mousePos.y) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\t\r\n\tmouseOver: function(e) {\r\n\t\r\n\t},\r\n\r\n\tload : function() {\r\n\t\tthis.ui.loadEvent = null;\r\n\t\tif (this.handler.load) {\r\n\t\t\tif (this.handler.load(this.gl) != false) {\r\n\t\t\t\t;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.requestDraw();\r\n\t},\r\n\r\n\tunload : function()\r\n\t{\r\n\t\tthis.ui.unloadEvent = null;\r\n\t\tthis.ui.updateRate = 0.0;\r\n\t\tif (this.handler.unload) {\r\n\t\t\tthis.handler.unload(this.gl);\r\n\t\t}\r\n\t\tthis.handler.ui = null;\r\n\t\tthis.handler    = null;\r\n\t\tthis.ui         = null;\r\n\t},\r\n\r\n\tkeyDown : function(e) {\r\n\t\tthis.ui.keyDownEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.keyCode);\r\n\t\tthis.ui.keysDown[keyString.toLowerCase()] = true;\r\n\t\tthis.ui.keysDown[keyString.toUpperCase()] = true;\r\n\t\tif (!this.ui.keysDown[e.keyCode] || !this.ui.ignoreKeyRepeat) {\r\n\t\t\tthis.ui.keysDown[e.keyCode] = true;\r\n\t\t\tif (this.handler.keyDown) {\r\n\t\t\t\tif (this.handler.keyDown(this.gl, e.keyCode, keyString) != false) {\r\n\t\t\t\t\tthis.requestDraw();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tkeyUp : function(e) {\r\n\t\tthis.ui.keyUpEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.keyCode);\r\n\t\tthis.ui.keysDown[keyString.toLowerCase()] = false;\r\n\t\tthis.ui.keysDown[keyString.toUpperCase()] = false;\r\n\t\tthis.ui.keysDown[e.keyCode] = false;\r\n\t\tif (this.handler.keyUp) {\r\n\t\t\tif (this.handler.keyUp(this.gl, e.keyCode, keyString) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tkeyPress : function(e) {\r\n\t\tthis.ui.keyPressEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.charCode);\r\n\t\tif (this.handler.keyPress) {\r\n\t\t\tif (this.handler.keyPress(this.gl, e.charCode, keyString) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseDown : function(e) {\r\n\t\tthis.ui.mouseDownEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[e.button] = true;\r\n\t\tif (this.handler.mouseDown) {\r\n\t\t\tif (this.handler.mouseDown(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.canvas.focus();\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseUp : function(e) {\r\n\t\tthis.ui.mouseUpEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[e.button] = false;\r\n\t\tif (this.handler.mouseUp) {\r\n\t\t\tif (this.handler.mouseUp(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseMove : function(e) {\r\n\t\tthis.ui.mouseMoveEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = this.ui.mousePos.x;\r\n\t\tthis.ui.mousePrevPos.y = this.ui.mousePos.y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = this.ui.mousePos.x - this.ui.mousePrevPos.x;\r\n\t\tthis.ui.mouseDeltaPos.y = this.ui.mousePos.y - this.ui.mousePrevPos.y;\r\n\t\tif (this.handler.mouseMove) {\r\n\t\t\tif (this.handler.mouseMove(this.gl, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseWheel : function(e) {\r\n\t\tthis.ui.mouseWheelEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tif (this.handler.mouseWheel) {\r\n\t\t\tvar delta = 0;\r\n\t\t\tif (!e) /* For IE. */ {\r\n\t\t\t\te = window.event;\r\n\t\t\t}\r\n\t\t\tif (e.wheelDelta) /* IE/Opera. */ {\r\n\t\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t\t\t/* In Opera 9, delta differs in sign as compared to IE.\r\n\t\t\t\t */\r\n\t\t\t\tif (window.opera) {\r\n\t\t\t\t\tdelta = -delta;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (e.detail) /** Mozilla case. */ {\r\n\t\t\t\t/** In Mozilla, sign of delta is different than in IE.\r\n\t\t\t\t * Also, delta is multiple of 3.\r\n\t\t\t\t */\r\n\t\t\t\tdelta = -e.detail / 3;\r\n\t\t\t}\r\n\t\t\t/* If delta is nonzero, handle it.\r\n\t\t\t * Basically, delta is now positive if wheel was scrolled up,\r\n\t\t\t * and negative, if wheel was scrolled down.\r\n\t\t\t */\r\n\t\t\tif (delta) {\r\n\t\t\t\tif (this.handler.mouseWheel(this.gl, delta, x, y) != false) {\r\n\t\t\t\t\tthis.requestDraw();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* Prevent default actions caused by mouse wheel.\r\n\t\t * That might be ugly, but we handle scrolls somehow\r\n\t\t * anyway, so don't bother here..\r\n\t\t */\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t//e.returnValue = false;\r\n\t},\r\n\r\n\ttouchStart : function(e) {\r\n\t\tthis.ui.mouseDownEvent = e.touches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.touches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[0] = true;\r\n\t\tif (this.handler.mouseDown) {\r\n\t\t\tif (this.handler.mouseDown(this.gl, 0, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.canvas.focus();\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\ttouchEnd : function(e) {\r\n\t\tthis.ui.mouseUpEvent = e.changedTouches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.changedTouches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[0] = false;\r\n\t\tif (this.handler.mouseUp) {\r\n\t\t\tif (this.handler.mouseUp(this.gl, 0, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\ttouchMove : function(e) {\r\n\t\tthis.ui.mouseMoveEvent = e.changedTouches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.changedTouches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = this.ui.mousePos.x;\r\n\t\tthis.ui.mousePrevPos.y = this.ui.mousePos.y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = this.ui.mousePos.x - this.ui.mousePrevPos.x;\r\n\t\tthis.ui.mouseDeltaPos.y = this.ui.mousePos.y - this.ui.mousePrevPos.y;\r\n\t\tif (this.handler.mouseMove) {\r\n\t\t\tif (this.handler.mouseMove(this.gl, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\t\r\n\tclick : function(e) {\r\n\t\tthis.ui.clickEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tif (this.handler.click) {\r\n\t\t\tif (this.handler.click(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tdblClick : function(e) {\r\n\t\tthis.ui.dblClickEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tif (this.handler.dblClick) {\r\n\t\t\tif (this.handler.dblClick(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tresize : function(e) {\r\n\t\tthis.ui.resizeEvent = e;\r\n\t\tif (this.handler.resize) {\r\n\t\t\tif (this.handler.resize(this.gl, this.canvas.width, this.canvas.height) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tupdate : function() {\r\n\t\tthis.ui.updateEvent = null;\r\n\t\tvar now = Date.now() / 1000.0;\r\n\t\tthis.ui.timePrev  = this.ui.timeNow;\r\n\t\tthis.ui.timeNow   = now;\r\n\t\tthis.ui.timeDelta = (this.ui.timeNow - this.ui.timePrev);\r\n\t\tvar doDraw = true;\r\n\t\tif (this.handler.update) {\r\n\t\t\tdoDraw = (this.handler.update(this.gl, this.ui.timeDelta) != false);\r\n\t\t}\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\r\n\tdraw : function() {\r\n\t\tthis.ui.drawEvent = null;\r\n\t\tif (this.handler.draw) {\r\n\t\t\tthis.handler.draw(this.gl);\r\n\t\t}\r\n\t\tthis.gl.flush();\r\n\t\tthis._drawPending = false;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// canvas registration\r\n/***********************************************************************/\r\nvar _SGL_RegisteredCanvas = new Object();\r\n\r\nfunction _sglManageCanvas(canvasID, handler, updateRate) {\r\n\tvar manager = new _SglCanvasManager(canvasID, handler, updateRate);\r\n\t_SGL_RegisteredCanvas[canvasID] = manager;\r\n}\r\n\r\nfunction _sglUnmanageCanvas(canvasID) {\r\n\tif (_SGL_RegisteredCanvas[canvasID]) {\r\n\t\t_SGL_RegisteredCanvas[canvasID] = null;\r\n\t\tdelete _SGL_RegisteredCanvas[canvasID];\r\n\t}\r\n}\r\n\r\nfunction _sglManageCanvasOnLoad(canvasID, handler, updateRate) {\r\n\twindow.addEventListener(\"load\", function() { _sglManageCanvas(canvasID, handler, updateRate); }, false);\r\n}\r\n\r\nfunction _sglUnmanageCanvasOnLoad(canvasID) {\r\n\twindow.addEventListener(\"unload\", function() { _sglUnmanageCanvas(canvasID); }, false);\r\n}\r\n\r\nfunction sglRegisterCanvas(canvasID, handler, updateRate) {\r\n\t_sglManageCanvasOnLoad(canvasID, handler, updateRate);\r\n\t_sglUnmanageCanvasOnLoad(canvasID);\r\n}\r\n\r\nfunction sglRegisterLoadedCanvas(canvasID, handler, updateRate) {\r\n\t_sglManageCanvas(canvasID, handler, updateRate);\r\n\t_sglUnmanageCanvasOnLoad(canvasID);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n","/*************************************************************************/\r\n/*                                                                       */\r\n/*  WebMultiRes                                                          */\r\n/*  JavaScript 3D Graphics Library on top of SpiderGL for web            */\r\n/*  visualization of high resolution RTI images                          */\r\n/*                                                                       */\r\n/*  Copyright (C) 2013-2015                                              */\r\n/*  Gianpaolo Palma                                                      */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it/rti/webviewer.php                             */\r\n/*  mailto: gianpaolo[DOT]palma[AT]isti[DOT]cnr[DOT]it                   */\r\n/*                                                                       */\r\n/*                                                                       */\r\n/*  This program is free software: you can redistribute it and/or modify */\r\n/*  it under the terms of the GNU General Public License as published by */\r\n/*  the Free Software Foundation, either version 3 of the License, or    */\r\n/*  (at your option) any later version.                                  */\r\n/*                                                                       */\r\n/*  This program is distributed in the hope that it will be useful,      */\r\n/*  but WITHOUT ANY WARRANTY; without even the implied warranty of       */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        */\r\n/*  GNU General Public License for more details.                         */\r\n/*                                                                       */ \r\n/*  You should have received a copy of the GNU General Public License    */\r\n/*  along with this program.  If not, see <http://www.gnu.org/licenses/> */\r\n/*************************************************************************/\r\n\r\nfunction createRtiViewer(e,t,i,r){function s(){var t=document.getElementById(e+\"_div\");t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen(),t.style.height=screen.height+\"px\",t.style.width=screen.width+\"px\";var i=$(\"#\"+e+\"_webgl\");i.height(screen.height),i.width(screen.width),i.attr(\"width\",screen.width),i.attr(\"height\",screen.height),b.resize(),h=!0;var r={label:\"Exit Fullscreen\",icons:{primary:\"fullOnIcon toolbarIcon\"}};$(\"#\"+e+\"_div #fullscreen\").button(\"option\",r)}function n(){var t=document.getElementById(e+\"_div\");document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),t.style.height=o+\"px\",t.style.width=l+\"px\";var i=$(\"#\"+e+\"_webgl\");i.height(o),i.width(l),i.attr(\"width\",l),i.attr(\"height\",o),b.resize(),h=!1;var r={label:\"Active Fullscreen\",icons:{primary:\"fullIcon toolbarIcon\"}};$(\"#\"+e+\"_div #fullscreen\").button(\"option\",r)}function a(t){\"IMAGE\"==t&&$(\"#\"+e+\"_div #light\").css(\"display\",\"none\"),$(\".toolbar\").css(\"visibility\",\"visible\")}var o=r,l=i,h=!1,d=$($(\"#\"+e)[0]),u=document.createElement(\"div\");u.id=e+\"_div\",u.style.height=r+\"px\",u.style.width=i+\"px\",u.style.margin=\"auto\",u.style.position=\"relative\",d.append(u);var c=$($(\"#\"+e+\"_div\")[0]),m=e+\"_webgl\",g=document.createElement(\"canvas\");g.id=m,g.width=i,g.height=r,c.append(g);var f=document.createElement(\"a\");f.href=\"http://vcg.isti.cnr.it/rti/webviewer.php\",f.target=\"_blank\";var p=document.createElement(\"div\");p.style.width=\"80px\",p.style.height=\"50px\",f.appendChild(p),f.style.position=\"absolute\",f.style.bottom=\"0px\",f.style.left=\"0px\",f.style.cssFloat=\"left\",c.append(f);var _=document.createElement(\"div\");_.setAttribute(\"class\",\"toolbar\"),_.style.position=\"absolute\",_.style.top=\"10px\",_.style.left=\"10px\",_.style.cssFloat=\"left\",_.style.width=\"40px\",_.style.height=\"200px\",_.style.visibility=\"hidden\",_.innerHTML='<button class = \"toolbarButton\" id = \"zoomIn\"></button><button class = \"toolbarButton\" id = \"zoomOut\"></button><button class = \"toolbarButton\" id = \"light\"></button><button class = \"toolbarButton\" id = \"fullscreen\"></button><button class = \"toolbarButton\" id = \"help\"></button>',c.append(_);var v=document.createElement(\"div\");v.id=e+\"_guide\",v.style.width=\"100%\",v.style.height=\"100%\",v.style.position=\"absolute\",v.style.left=\"0px\",v.style.top=\"0px\",v.style.color=\"#FFFFFF\",v.style.backgroundColor=\"rgba(0, 0, 0, 0.9)\",v.innerHTML='<div id = \"guideTable\"><div id = \"guideCell\"> <div id = \"guideList\"><h3>WebRTIViewer<br/></h3><ul><li>Pan: LeftMouseButton + MouseMove.</li><li>Zoom in: MouseWhell or press the button <span><img src = \"css/icons/zoomin.png\" alt=\"\"/></span></li><li>Zoom out: MouseWheel or press the button <span><img src = \"css/icons/zoomout.png\" alt=\"\"/></span></li><li>To change the light direction: activate the light with the button <span><img src = \"css/icons/light.png\" alt=\"\"/></span> and press LeftMouseButton + MouseMove or Ctrl + LeftMouseButton + MouseMove.</li><li>Fullscreen: press the button <span><img src = \"css/icons/full.png\" alt=\"\"/></span> to active the fullscreen mode and the button <span><img src = \"css/icons/full_on.png\" alt=\"\"/></span> to exit</li><li>To reset the viewpoint: press R.</li></ul><a href=\"http://vcg.isti.cnr.it/rti/webviewer.php\" target = \"_black\">Visual Computing Lab ISTI CNR Pisa</a></div></div></div>',v.style.display=\"none\",c.append(v),$(\"#\"+e+\"_div #zoomIn\").button({icons:{primary:\"zoomInIcon toolbarIcon\"},text:!1,label:\"Zoom In\"}).click(function(){b.startZoomIn()}),$(\"#\"+e+\"_div #zoomOut\").button({icons:{primary:\"zoomOutIcon toolbarIcon\"},text:!1,label:\"Zoom Out\"}).click(function(){b.startZoomOut()}),$(\"#\"+e+\"_div #light\").button({icons:{primary:\"lightIcon toolbarIcon\"},text:!1,label:\"Light Off\"}).click(function(){var e;\"Light Off\"==$(this).text()?(e={label:\"Light On\",icons:{primary:\"lightOnIcon toolbarIcon\"}},b.setMode(1)):(e={label:\"Light Off\",icons:{primary:\"lightIcon toolbarIcon\"}},b.setMode(0)),$(this).button(\"option\",e)}),$(\"#\"+e+\"_div #help\").button({icons:{primary:\"helpIcon toolbarIcon\"},text:!1,label:\"Help\"}).click(function(){$(\"#\"+e+\"_guide\").show()}),$(\"#\"+e+\"_div #fullscreen\").button({icons:{primary:\"fullIcon toolbarIcon\"},text:!1,label:\"Active Fullscreen\"}).click(function(){h?n():s(),$(\"#\"+e+\"_div #fullscreen\").removeClass(\"ui-state-hover\")}),document.addEventListener(\"MSFullscreenChange\",function(){document.msFullscreenElement||n()},!1),document.addEventListener(\"mozfullscreenchange\",function(){document.mozFullScreen||n()},!1),document.addEventListener(\"webkitfullscreenchange\",function(){document.webkitIsFullScreen||n()},!1),$(\"#\"+e+\"_guide\").click(function(){$(\"#\"+e+\"_guide\").hide()});var x=document.createElement(\"div\");if(x.id=e+\"_error\",x.style.width=\"100%\",x.style.height=\"100%\",x.style.position=\"absolute\",x.style.left=\"0px\",x.style.top=\"0px\",x.style.color=\"#FFFFFF\",x.style.backgroundColor=\"rgba(0, 0, 0, 1.0)\",x.innerHTML='<canvas id = \"testCanvas\" width= \"800\" height= \"600\" contenteditable=\"true\"></canvas>',x.style.display=\"none\",c.append(x),null==sglGetCanvasContext(\"testCanvas\"))x.style.display=\"block\",x.innerHTML='<div id = \"contentError\" style = \"width: 90%; height: 100%; text-align:left; padding:0% 5% 0% 5%; font-family:  Verdana,sans-serif; overflow-y: scroll;\"><h3>WebGL is not available or not enabled.</h3><p><a href=\"http://en.wikipedia.org/wiki/WebGL\">WebGL</a> is the technology we use to display the RTI images. It is currently supported, but sometimes not enabled by default, by recent versions of <a href=\"http://www.mozilla.org/firefox\">Firefox</a>, <a href=\"http://www.google.com/chrome\">Chrome</a> and <a href=\"http://www.apple.com/safari\">Safari</a>. An external plugins is available for <a href=\"http://microsoft.com/ie\">Internet  Explorer</a>.<br/> It also requires a moderately recent and capable hardware and up to date drivers.</p><p><b>Chrome</b><br/>Type \"chrome://flags\" in the address bar.<br/>Disable (yes, it is a confusing double negation!) the WebGL entry.<br/>Click the <em>relaunch now</em> button at the bottom.</p><p><b>Firefox</b><br/>Type \"about:config\" in the address bar<br/>Type \"webgl\" in the <em>Filter</em>.<br/>Doubleclick the entry <b>webgl.force-enable</b>, and restart Firefox.</p><p><b>Safari</b><br/>Open the Safari menu and select Preferences.<br/>Then, click the Advanced tab in the Preferences window.<br/>Then, at the bottom of the window, check the Show Develop menu in menu bar checkbox.<br/>Then, open the Develop menu in the menu bar and select Enable WebGL.</p><p><b>Internet Explorer (from version 9.0)</b><br/>Install the <a href=\"http://www.google.com/chromeframe\">Chrome Frame</a> <br/>Open the Tools menu and select Manage add-ons.<br/>Then, enable the ChromeFrame BHO plugins and restart Internet Explorer.<br/></p><p><b>Installing updated drivers</b><br/>If the visualization of the RTI image fails you must update the drivers of your graphics cards.</p></div>';else{x.innerHTML=\"\";var b=new MultiRes(m);b.setImageUrl(t),b.setOnLoadImageCallback(a),sglRegisterCanvas(m,b,10)}}function log(){}function MultiRes(e){this.mode=0,this.stepAnimation=0,this.idTimer,this.flipAngles=[],this.flipAngles[0]=0,this.canvas=e,this.rendering=!1,this.onDrawCallback=null,this.animating=!1,this.moveToCenter=!1,this.imageUrl=\"\",this.OnLoadImageCallback=null,this.currentSpeed=0,this.maxStep=7,this.animationStack=[],this.isMoving=!1;for(var t=1;21>t;t++)this.flipAngles[t]=SGL_PI/2*Math.sin(t/40*SGL_PI)}function MultiResNode(){this.id=0,this.parentIndex=-1,this.childrenIndices=[-1,-1,-1,-1],this.projectedSize=1,this.zScale=1,this.box=new SglBox3,this.priority={timestamp:-1,error:Number.MAX_VALUE},this.req=null,this.data=null,this.isLeaf=!0}function MultiResTree(e,t){this.ready=!0,this.nodesCount=0,this.rootIndex=-1,this.nodes=null,this.url=null,this.tileSize=0,this.scale=[1,1,1],this.offset=[0,0,0],this.forma=\"\",e&&this.load(e,imgW,imgH,t)}function _MultiResAssert(e){e||alert(\"MultiResAssert FAILED : \"+e)}function _MultiResCompareNodes(e,t){return e.priority.timestamp!=t.priority.timestamp?t.priority.timestamp-e.priority.timestamp:e.priority.error!=t.priority.error?t.priority.error-e.priority.error:e.id-t.id}function MultiResRenderer(e,t){this.lg=!0,this.gl=e,this._tree=new MultiResTree,this._timestamp=0,this._frustum=new SglFrustum,this._maxError=1,this._cache=[],this._cacheSizeInBytes=t,this._maxCacheSize=1,this._maxOngoingRequests=2,this._currentOngoingRequests=0,this._toRequest=[],this._toRenderFullRes=[],this._toRenderHalfRes=[],this._readyItems=[],this.renderData=!0,this.renderBoxes=!1;var i=new Float32Array([-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5]),r=new Uint16Array([0,1,2,2,1,3,5,4,7,7,4,6,4,0,6,6,0,2,1,5,3,3,5,7,2,3,6,6,3,7,4,5,0,0,5,1]),s=new Uint16Array([0,1,1,3,3,2,2,0,5,4,4,6,6,7,7,5,0,4,1,5,3,7,2,6]),n=new SglMeshGL(e);n.addVertexAttribute(\"position\",3,i),n.addIndexedPrimitives(\"triangles\",e.TRIANGLES,r),n.addIndexedPrimitives(\"edges\",e.LINES,s),this._boxMesh=n,this._tileFullMesh=null,this._tileHalfMesh=null,this._program=null;var a=sglLoadFile(\"spidergl/box.v.glsl\"),o=sglLoadFile(\"spidergl/box.f.glsl\"),l=new SglProgram(e,[a],[o]);log(l.log),this._boxProgram=l,this._boxRenderer=new SglMeshGLRenderer(this._boxProgram),this._treeTransform=sglIdentityM4(),this._normalizedTreeTransform=sglIdentityM4(),this.updateData=!0;var h=\"#ifdef GL_ES\\nprecision highp float;\\n#endif\\nuniform   mat4 u_mvp;\\nattribute vec2 a_position;\\nattribute vec2 a_texcoord;\\nvarying   vec2 v_texcoord;\\nvoid main(void){\\nv_texcoord  = a_texcoord;\\ngl_Position = u_mvp * vec4(a_position, 0.0, 1.0);\\n}\",d=\"#ifdef GL_ES\\nprecision highp float;\\n#endif\\nuniform sampler2D s_texture;\\nvarying vec2     v_texcoord;\\nvoid main(void){vec4 color = texture2D(s_texture, v_texcoord).xyzw;\\nif (color.w > 0.7)\\ngl_FragData[0] = vec4(color.rgb, 1.0);\\nelse\\ngl_FragData[0] = vec4(0.0);}\";this.texProg=new SglProgram(this.gl,[h],[d]),log(this.texProg.log);var u=new Float32Array([0,0,80,0,0,50,80,50]),c=new Float32Array([0,0,1,0,0,1,1,1]);if(this.lg){var m=new SglMeshGL(this.gl);m.addVertexAttribute(\"position\",2,u),m.addVertexAttribute(\"texcoord\",2,c),m.addArrayPrimitives(\"tristrip\",this.gl.TRIANGLE_STRIP,0,4),this.lgMesh=m,this.lgtex=null,this._createLg()}this.enumType=new Object,this.enumType.HSH_RTI=1,this.enumType.LRGB_PTM=2,this.enumType.RGB_PTM=3,this.enumType.IMAGE=4}MultiRes.prototype={setMode:function(e){this.mode=e},_setLightDir:function(e,t){var i=e/this.ui.width*2.2-1.1,r=t/this.ui.height*2.2-1.1;i=Math.min(1,Math.max(-1,i)),r=Math.min(1,Math.max(-1,r));var s=Math.sqrt(i*i+r*r);s>1&&(s=1);var n=Math.PI/2;0!=i&&(n=Math.atan2(r,i)),i=s*Math.cos(n),r=s*Math.sin(n);var a=[];a=1>s?[i,r,Math.sqrt(1-i*i-r*r)]:[i,r,0],a=sglNormalizedV3(a),this.renderer.lightPos=a.slice(0,3),this.renderer.lweights=this.renderer.computeLightingFunction(a)},resetViewpoint:function(){this.translation[0]=0,this.translation[1]=0,this.mat=sglIdentityM4(),this.flipMatrix=sglIdentityM4()},setImageUrl:function(e){this.imageUrl=e},setOnLoadImageCallback:function(e){this.OnLoadImageCallback=e},load:function(e){log(\"SpiderGL Version : \"+SGL_VERSION_STRING+\"\\n\"),this.xform=new SglTransformStack,this.renderer=new MultiResRenderer(e,268435456),this.translation=[0,0],this.mat=sglIdentityM4(),this.flipMatrix=sglIdentityM4(),\"\"!=this.imageUrl&&this.loadImage(this.imageUrl)},loadImage:function(e){this.renderer.loadImage(e),this.OnLoadImageCallback(this.renderer.type),this.xform=new SglTransformStack,this.translation=[0,0],this.mat=sglIdentityM4(),this.rendering=!0,this.leftBottom=[(this.renderer._tree.scale[0]-this.renderer.imgWidth)/2,(this.renderer._tree.scale[1]-this.renderer.imgHeight)/2],this.rightTop=[this.leftBottom[0]+this.renderer.imgWidth,this.leftBottom[1]+this.renderer.imgHeight],this.scale=0;var t=this.ui.width,i=this.ui.height,r=this.renderer._tree.scale[0]/this.renderer.imgWidth*t,s=this.renderer._tree.scale[1]/this.renderer.imgHeight*i;this.scale=Math.min(r,s),this.maxScale=2.5*Math.max(this.renderer.imgWidth/t,this.renderer.imgHeight/i),this.viewerdx=100,this.viewerdy=100},stopRendering:function(){this.rendering=!1},setOnDrawCallback:function(e){e&&(this.onDrawCallback=e)},keyDown:function(e,t,i){\"R\"==i&&this.resetViewpoint(),\"1\"==i&&(this.renderer.renderData=!this.renderer.renderData),\"2\"==i&&(this.renderer.renderBoxes=!this.renderer.renderBoxes)},mouseWheel:function(e,t,i,r){if(this.isMoving)return!1;var s=i-this.translation[0],n=r-this.translation[1],a=sglPow(.98,10*t);this._startZoom(a,s,n)},startZoomIn:function(){if(this.isMoving)return!1;var e=this.ui.width/2-this.translation[0],t=this.ui.height/2-this.translation[1],i=1.2;this._startZoom(i,e,t)},startZoomOut:function(){if(this.isMoving)return!1;var e=this.ui.width/2-this.translation[0],t=this.ui.height/2-this.translation[1],i=.8;this._startZoom(i,e,t)},_startZoom:function(e,t,i){var r=this.mat[0]*e;r>this.maxScale&&(e=this.maxScale/this.mat[0]),1>r&&(e=1/this.mat[0]),1.00000001>=r&&(this.moveToCenter=!0);var s=e*this.mat[0]-this.mat[0];if(s>1e-4||-1e-4>s){this.animationStack=[];for(var n=2*this.maxStep,a=3*s/(n*n*n),o=-2*n*a,l=a*n*n,h=this.mat[0],d=0;n>d;d++){var u=a*d+a/3+o/2+l;l+=a*(2*d+1)+o;var c=1+u/h;h+=u,this.animationStack.push([c,t,i])}this.animating=this.moveToCenter;var m=this;clearInterval(this.moveInterval),clearInterval(this.zoomInterval),this.zoomInterval=setInterval(function(){m._zoomAnimation()},35),this.renderer.updateData=!1,this.isMoving=this.moveToCenter}else if(this.moveToCenter){this.animating=!0,this.isMoving=!0;var m=this;this.animationStack=[],clearInterval(this.moveInterval),clearInterval(this.zoomInterval),this.zoomInterval=setInterval(function(){m._zoomAnimation()},35),this.renderer.updateData=!1}return!1},_zoomAnimation:function(){if(0==this.animationStack.length){if(clearInterval(this.zoomInterval),this.moveToCenter){var e=this;clearInterval(this.moveInterval),this.moveInterval=setInterval(function(){e._moveAnimation()},35),this.renderer.updateData=!1,this.isMoving=!0,this.computeModelMatrix();var t=this.xform.model.top,i=[this.renderer._tree.scale[0]/2,this.renderer._tree.scale[1]/2],r=[this.ui.width/2,this.ui.height/2],s=sglMulM4V4(t,sglV4C(i[0],i[1],0,1)).slice(0,2),n=r[0]-s[0],a=r[1]-s[1];this.currentSpeed=0,this.currentPoint=s,this._updateMoveStack(s,r,sglV2C(n,a))}else this.renderer.updateData=!0;return void(this.animating=!1)}var o=this.animationStack.splice(0,1)[0],l=o[0];tx=o[1],ty=o[2];var h=sglMulM4(sglTranslationM4C(tx,ty,0),sglMulM4(sglScalingM4C(l,l,1),sglMulM4(sglTranslationM4C(-tx,-ty,0),this.mat))),d=this.returnModelMatrix(this.translation,h),u=sglMulM4V4(d,sglV4C(this.leftBottom[0],this.leftBottom[1],0,1)).slice(0,2),c=sglMulM4V4(d,sglV4C(this.rightTop[0],this.rightTop[1],0,1)).slice(0,2);u[0]-=this.viewerdx,u[1]-=this.viewerdy,c[0]+=this.viewerdx,c[1]+=this.viewerdy;var m=c[0]-u[0],g=c[1]-u[1],n=0,a=0;if(m>this.ui.width&&g>this.ui.height)c[0]<this.ui.width?n+=this.ui.width-c[0]:u[0]>0&&(n-=u[0]),c[1]<this.ui.height?a+=this.ui.height-c[1]:u[1]>0&&(a-=u[1]);else if(m>this.ui.width)ty=this.ui.height/2-this.translation[1],c[0]<this.ui.width?n+=this.ui.width-c[0]:u[0]>0&&(n-=u[0]);else{if(!(g>this.ui.height))return tx=this.ui.width/2,ty=this.ui.height/2,this.resetViewpoint(),void(0==this.animationStack.lenght&&(clearInterval(this.zoomInterval),this.renderer.updateData=!0));tx=this.ui.width/2-this.translation[0],c[1]<this.ui.height?a+=this.ui.height-c[1]:u[1]>0&&(a-=u[1])}this.mat=sglMulM4(sglTranslationM4C(tx,ty,0),sglMulM4(sglScalingM4C(l,l,1),sglMulM4(sglTranslationM4C(-tx,-ty,0),this.mat))),this.translation[0]+=n,this.translation[1]+=a,_SGL_RegisteredCanvas[this.canvas].requestDraw()},sendMouseDown:function(e){_SGL_RegisteredCanvas[this.canvas].mouseDown(e)},mouseDown:function(e,t,i,r){if(this.animating)return!1;if(0==t){if(this.ui.keysDown[17])return this._setLightDir(i,r),!0;if(0==this.mode){this.endAnimation=!1,this.currentPoint=[i,r],this.animationStack=[];var s=this;return clearInterval(this.zoomInterval),clearInterval(this.moveInterval),this.moveInterval=setInterval(function(){s._moveAnimation()},35),this.renderer.updateData=!1,this.isMoving=!0,!1}return 1==this.mode&&this._setLightDir(i,r),!0}},_moveAnimation:function(){if((this.moveToCenter||this.endAnimation)&&0==this.animationStack.length)return clearInterval(this.moveInterval),this.renderer.updateData=!0,this.isMoving=!1,this.animating=!1,void(this.moveToCenter=!1);if(0==this.animationStack.length)return void(this.currentSpeed=0);var e=this.animationStack.splice(0,1)[0],t=e[0]-this.currentPoint[0],i=e[1]-this.currentPoint[1];this.currentSpeed=e[2],this.translation[0]+=t,this.translation[1]+=i,this.currentPoint[0]=e[0],this.currentPoint[1]=e[1],_SGL_RegisteredCanvas[this.canvas].requestDraw()},mouseUp:function(e,t){return 0==t&&0==this.mode&&(this.endAnimation=!0,this.renderer.updateData=!0,this.isMoving=!1),!1},mouseOut:function(){this.endAnimation=!0,this.isMoving=!1},mouseMove:function(e,t,i){if(this.animating)return!1;if(this.ui.mouseButtonsDown[0]){if(0==this.mode){if(this.ui.keysDown[17])return this._setLightDir(t,i),!0;var r=[t,i],s=r[0]-this.currentPoint[0],n=r[1]-this.currentPoint[1],a=this._adjustTranslation(s,n);return r=[this.currentPoint[0]+a[0],this.currentPoint[1]+a[1]],this._updateMoveStack(this.currentPoint,r,a),!1}return this._setLightDir(t,i),!0}return!1},_updateMoveStack:function(e,t,i){var r=sglLengthV2(i);if(r>.1){this.animationStack.splice(0,this.animationStack.length);var s=sglNormalizedV2(i),n=2*(r/2-this.currentSpeed*this.maxStep)/(this.maxStep*this.maxStep),a=this.currentSpeed,o=[e[0],e[1]],l=0,h=this.maxStep,d=0,u=0;if(n>0){for(var c=0;c<this.maxStep;c++){var m=n/2+a;a+=n,l+=m;var g=s[0]*m,f=s[1]*m;o[0]+=g,o[1]+=f,this.animationStack.push([o[0],o[1],a,n])}h=3*r/(2*a),u=4*a*a*a/(9*r*r),d=-4*a*a/(3*r)}else h=6*r/(2*a),u=a*a*a/(9*r*r),d=-2*a*a/(3*r);for(var c=0;h>c;c++){var m=u*c+u/3+d/2+a;a+=u*(2*c+1)+d;var g=s[0]*m,f=s[1]*m;o[0]+=g,o[1]+=f,this.animationStack.push([o[0],o[1],a,u])}this.animationStack.push([t[0],t[1],0,0])}},_adjustTranslation:function(e,t){var i=sglV4C(this.translation[0]+e,this.translation[1]+t,0,1),r=this.returnModelMatrix(i,this.mat),s=sglMulM4V4(r,sglV4C(this.leftBottom[0],this.leftBottom[1],0,1)).slice(0,2),n=sglMulM4V4(r,sglV4C(this.rightTop[0],this.rightTop[1],0,1)).slice(0,2);s[0]-=this.viewerdx,s[1]-=this.viewerdy,n[0]+=this.viewerdx,n[1]+=this.viewerdy;var a=n[0]-s[0],o=n[1]-s[1],l=e,h=t;return a>this.ui.width&&o>this.ui.height?(n[0]<this.ui.width?l+=this.ui.width-n[0]:s[0]>0&&(l-=s[0]),n[1]<this.ui.height?h+=this.ui.height-n[1]:s[1]>0&&(h-=s[1])):a>this.ui.width?(n[0]<this.ui.width?l+=this.ui.width-n[0]:s[0]>0&&(l-=s[0]),h=0):o>this.ui.height?(n[1]<this.ui.height?h+=this.ui.height-n[1]:s[1]>0&&(h-=s[1]),l=0):(l=0,h=0),sglV2C(l,h)},update:function(){},returnModelMatrix:function(e,t){var i=sglMulM4(sglTranslationM4C(e[0],e[1],1),t);i=sglMulM4(this.flipMatrix,i),this.xform.model.load(i);var r=sglTranslationM4C(this.ui.width/2,this.ui.height/2,0);return this.xform.model.multiply(r),this.xform.model.scale(this.scale,this.scale,1),this.xform.model.multiply(this.renderer.normalizedTreeTransform),this.xform.model.top},computeModelMatrix:function(){var e=sglMulM4(sglTranslationM4C(this.translation[0],this.translation[1],1),this.mat);e=sglMulM4(this.flipMatrix,e),this.xform.model.load(e);var t=sglTranslationM4C(this.ui.width/2,this.ui.height/2,0);this.xform.model.multiply(t),this.xform.model.scale(this.scale,this.scale,1),this.xform.model.multiply(this.renderer.normalizedTreeTransform)},resize:function(){this.xform=new SglTransformStack,this.translation=[0,0],this.mat=sglIdentityM4(),this.rendering=!0,this.leftBottom=[(this.renderer._tree.scale[0]-this.renderer.imgWidth)/2,(this.renderer._tree.scale[1]-this.renderer.imgHeight)/2],this.rightTop=[this.leftBottom[0]+this.renderer.imgWidth,this.leftBottom[1]+this.renderer.imgHeight],this.scale=0;var e=this.ui.width;this.offsetHeight=0;var t=this.ui.height+this.offsetHeight;this.scale=Math.min(this.renderer._tree.scale[0]/this.renderer.imgWidth*e,this.renderer._tree.scale[1]/this.renderer.imgHeight*t),this.maxScale=3*Math.max(this.renderer.imgWidth/e,this.renderer.imgHeight/t),this.viewerdx=this.ui.width/2-10,this.viewerdy=this.ui.height/2-10},draw:function(e){var t=e.getError();if(t==e.CONTEXT_LOST_WEBGL&&console.log(\"WebGL Context lost\"),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),1==this.rendering){var i=this.ui.width,r=this.ui.height;e.viewport(0,0,i,r),this.xform.projection.loadIdentity(),this.xform.projection.ortho(0,i,0,r,-4096,4096),this.xform.view.loadIdentity(),this.xform.view.lookAt(0,0,2,0,0,0,0,1,0),this.computeModelMatrix();var s=this.xform.model.top;this.onDrawCallback&&this.onDrawCallback(s),this.renderer.render(this.xform.projectionMatrix,this.xform.modelViewMatrix,[0,0,i,r])}}},MultiResTree.prototype={_load:function(e,t,i){this.ready=!0;var r=sglGetLines(e),s=r.length,n=null,a=0;if(!(a>=s||(n=r[a++].split(\" \"),n.length<2))){var o=parseInt(n[0]);if(!(0>=o)){var l=parseInt(n[1]);if(!(0>l||l>=o||a>=s||(n=r[a++].split(\" \"),n.length<1))){var h=parseInt(n[0]);if(!(0>=h||a>=s||(n=r[a++].split(\" \"),n.length<3))){var d=[1,1,1];if(d[0]=parseFloat(n[0]),d[1]=parseFloat(n[1]),d[2]=parseFloat(n[2]),!(a>=s||(n=r[a++].split(\" \"),n.length<3))){var u=[0,0,0];u[0]=parseFloat(n[0]),u[1]=parseFloat(n[1]),u[2]=parseFloat(n[2]);var c=new Array(o);if(s>a)for(var m=0;o>m;++m){var g=new MultiResNode;if(a>=s)return;if(n=r[a++].split(\" \"),n.length<14)return;if(g.id=parseInt(n[0]),g.id<=0)return;if(g.parentIndex=parseInt(n[1]),g.parentIndex<-1||g.parentIndex>=o)return;for(var f=0;4>f;++f)if(g.childrenIndices[f]=parseInt(n[f+2]),g.childrenIndices[f]<-1||g.childrenIndices[f]>=o)return;g.projectedSize=parseFloat(n[6]),g.zScale=parseFloat(n[7]),g.box.min[0]=parseFloat(n[8]),g.box.min[1]=parseFloat(n[9]),g.box.min[2]=parseFloat(n[10]),g.box.max[0]=parseFloat(n[11]),g.box.max[1]=parseFloat(n[12]),g.box.max[2]=parseFloat(n[13]),g.isLeaf=!0;for(var p=0;4>p;++p)if(g.childrenIndices[p]>=0){g.isLeaf=!1;break}c[m]=g}else{for(var _=0,v=d[0],x=1;v>h;)x++,v/=2;for(var b=(d[0]-t)/2/d[0],M=(d[1]-i)/2/d[1],y=new SglBox3([b,M,0],[b+t/d[0],M+i/d[1],1]),w=y.size,S=y.center,a=0;x>a;a++)for(var I=Math.pow(4,a),p=0;I>p;p++){var g=new MultiResNode;g.id=_+1,g.parentIndex=_>0?Math.ceil(_/4)-1:-1,x-1>a&&(g.isLeaf=!1);for(var f=0;4>f;++f)g.childrenIndices[f]=a==x-1?-1:4*_+1+(f+2)%4;if(g.projectedSize=h,_>0){var T=_%4,R=c[g.parentIndex],F=R.box.min[0]+(R.box.max[0]-R.box.min[0])/2,L=R.box.min[1]+(R.box.max[1]-R.box.min[1])/2;1==T?g.box=new SglBox3([R.box.min[0],L,0],[F,R.box.max[1],1]):2==T?g.box=new SglBox3([F,L,0],R.box.max):3==T?g.box=new SglBox3(R.box.min,[F,L,1]):0==T&&(g.box=new SglBox3([F,R.box.min[1],0],[R.box.max[0],L,1]));var C=g.box.center,k=g.box.size,z=sglSelfMulV3S(sglAddV3(w,k),.5),P=sglSubV3(S,C);g.zScale=Math.abs(P[0])<=z[0]&&Math.abs(P[1])<=z[1]&&Math.abs(P[2])<=z[2]?1:0}else g.box=new SglBox3([0,0,0],[1,1,1]),g.zScale=1;c[_]=g,_++}}this.nodesCount=o,this.rootIndex=l,this.tileSize=h,this.scale=d,this.offset=u,this.nodes=c}}}}}},destroy:function(e){var t=null;for(var i in this.nodes)t=this.nodes[i],t.req&&(t.req.onLoad=null,t.req=null),t.data&&(e(t.data),t.data=null);this.ready=!0,this.nodesCount=0,this.rootIndex=-1,this.nodes=null,this.url=null,this.tileSize=0,this.scale=[1,1,1]},load:function(e,t,i){return e?void this._load(e,t,i):!1},get isEmpty(){return this.nodesCount<=0},get root(){var e=this.rootIndex;return 0>e?null:this.nodes[e]},parent:function(e){var t=e.parentIndex;return 0>t?null:this.nodes[t]},child:function(e,t){var i=e.childrenIndices[t];return 0>i?null:this.nodes[i]}},MultiResRenderer.prototype={computeLightingFunction:function(e){switch(this.enumType[this.type]){case 1:var t=Math.atan2(e[1],e[0]);0>t&&(t=2*Math.PI+t);var i=Math.min(Math.acos(e[2]),Math.PI/2-.15),r=Math.cos(t),s=Math.cos(i),n=s*s,a=new Array(9);return a[0]=1/Math.sqrt(2*Math.PI),a[1]=Math.sqrt(6/Math.PI)*r*Math.sqrt(s-n),a[2]=Math.sqrt(3/(2*Math.PI))*(-1+2*s),a[3]=Math.sqrt(6/Math.PI)*Math.sqrt(s-n)*Math.sin(t),a[4]=Math.sqrt(30/Math.PI)*Math.cos(2*t)*(-s+n),a[5]=Math.sqrt(30/Math.PI)*r*(-1+2*s)*Math.sqrt(s-n),a[6]=Math.sqrt(5/(2*Math.PI))*(1-6*s+6*n),a[7]=Math.sqrt(30/Math.PI)*(-1+2*s)*Math.sqrt(s-n)*Math.sin(t),a[8]=Math.sqrt(30/Math.PI)*(-s+n)*Math.sin(2*t),a;case 2:case 3:var a=new Array(6);return a[0]=e[0]*e[0],a[1]=e[1]*e[1],a[2]=e[0]*e[1],a[3]=e[0],a[4]=e[1],a[5]=1,a}return[]},loadImage:function(e){var t=new XMLHttpRequest;t.open(\"GET\",e+\"/info.xml\",!1),t.send();var i=t.responseXML;this.format=\"jpg\";var r=parseInt(i.getElementsByTagName(\"MultiRes\")[0].getAttribute(\"format\"));isNaN(r)||1==r&&(this.format=\"png\");var s=i.getElementsByTagName(\"Content\")[0];if(this.type=s.getAttribute(\"type\"),!(this.type in this.enumType))return!1;var n=null;switch(this.enumType[this.type]){case 1:case 2:case 3:var a=i.getElementsByTagName(\"Size\")[0],o=i.getElementsByTagName(\"Scale\")[0],l=i.getElementsByTagName(\"Bias\")[0];if(n=i.getElementsByTagName(\"Tree\")[0],this.imgWidth=parseInt(a.getAttribute(\"width\")),this.imgHeight=parseInt(a.getAttribute(\"height\")),this.ordlen=parseInt(a.getAttribute(\"coefficients\")),this.numLayers=this.ordlen,2==this.enumType[this.type]&&(this.numLayers=3),tokens=o.childNodes[0].nodeValue.split(\" \"),tokens.length<this.ordlen)return;this.gmax=[];for(var h=0;h<this.ordlen;h++)this.gmax[h]=parseFloat(tokens[h]);if(tokens=l.childNodes[0].nodeValue.split(\" \"),tokens.length<this.ordlen)return;this.gmin=[];for(var h=0;h<this.ordlen;h++)this.gmin[h]=parseFloat(tokens[h]);break;case 4:var a=i.getElementsByTagName(\"Size\")[0];n=i.getElementsByTagName(\"Tree\")[0],this.imgWidth=parseInt(a.getAttribute(\"width\")),this.imgHeight=parseInt(a.getAttribute(\"height\")),this.ordlen=parseInt(a.getAttribute(\"coefficients\")),this.numLayers=this.ordlen;break;default:return}switch(this._tree&&this._tree.destroy(this._destroyData),this._tree.load(n.textContent,this.imgWidth,this.imgHeight),this._url=e,this._timestamp=0,this._frustum=new SglFrustum,this._maxError=1,this._cache=[],this._toRequest=[],this._toRenderFullRes=[],this._toRenderHalfRes=[],this._readyItems=[],this.renderData=!0,this.renderBoxes=!1,this.lightPos=[0,0,1],this.lweights=[],this.lweights=this.computeLightingFunction(this.lightPos),null!=this._program&&this._program.destroy(),this.enumType[this.type]){case 1:var d=sglLoadFile(\"spidergl/multi.v.glsl\"),u=sglLoadFile(\"spidergl/hsh.f.glsl\"),c=new SglProgram(this.gl,[d],[u]);log(c.log),this._program=c;break;case 2:var d=sglLoadFile(\"spidergl/multi.v.glsl\"),u=sglLoadFile(\"spidergl/lrgbptm.f.glsl\"),c=new SglProgram(this.gl,[d],[u]);log(c.log),this._program=c;break;case 3:var d=sglLoadFile(\"spidergl/multi.v.glsl\"),u=sglLoadFile(\"spidergl/rgbptm.f.glsl\"),c=new SglProgram(this.gl,[d],[u]);log(c.log),this._program=c;break;case 4:var d=sglLoadFile(\"spidergl/multi.v.glsl\"),u=sglLoadFile(\"spidergl/image.f.glsl\"),c=new SglProgram(this.gl,[d],[u]);log(c.log),this._program=c;break;default:this._program=new SglProgram}this._renderer=new SglMeshGLRenderer(this._program),this._treeTransform=sglIdentityM4(),this._normalizedTreeTransform=sglIdentityM4(),this.leftTex=(this._tree.scale[0]-this.imgWidth)/2,this.rightTex=this.leftTex+this.imgWidth,this.bottomTex=(this._tree.scale[1]-this.imgHeight)/2,this.topTex=this.bottomTex+this.imgHeight,this.leftTex/=this._tree.scale[0],this.rightTex/=this._tree.scale[0],this.bottomTex/=this._tree.scale[1],this.topTex/=this._tree.scale[1],this._tree.ready&&this._setupTree()},_createLg:function(){var e=document.createElement(\"canvas\");e.height=50,e.width=80;var t=e.getContext(\"2d\");t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(80,0),t.lineTo(80,50),t.lineTo(0,50),t.closePath(),t.clip(),t.strokeStyle=\"rgba(0,0,0,0)\",t.lineCap=\"butt\",t.lineJoin=\"miter\",t.miterLimit=4,t.save(),t.restore(),t.save(),t.restore(),t.save(),t.transform(.21814175,0,0,.21573678,-3.3721339,-3.3665838),t.save(),t.translate(14.071762,20),t.save(),g=t.createRadialGradient(239.50893,204.66128888494003,0,239.50893,204.66128888494003,31.820419),g.addColorStop(0,\"rgba(255, 255, 255, 1)\"),g.addColorStop(1,\"rgba(151, 151, 151, 1)\"),t.fillStyle=g,t.strokeStyle=\"#000000\",t.lineWidth=2.4923694133758545,t.lineCap=\"round\",t.lineJoin=\"round\",t.miterLimit=4,t.transform(2.1234583,0,0,1.6108995,-256.37574,-264.34719),t.beginPath(),t.moveTo(271.42857,233.79076),t.translate(240,233.80553976769053),t.rotate(0),t.scale(.7586207296076113,1),t.arc(0,0,41.42857,-.00035675303306008355,3.1419494066230014,0),t.scale(1.318181748760332,1),t.rotate(0),t.translate(-240,-233.80553976769053),t.translate(240,233.77598023230948),t.rotate(0),t.scale(.7586207296076113,1),t.arc(0,0,41.42857,3.141235900556733,6.2835420602127945,0),t.scale(1.318181748760332,1),t.rotate(0),t.translate(-240,-233.77598023230948),t.closePath(),t.fill(),t.stroke(),t.restore(),t.save(),t.fillStyle=\"#ececec\",t.strokeStyle=\"#000000\",t.lineWidth=4.609655857086182,t.lineCap=\"butt\",t.lineJoin=\"round\",t.miterLimit=4,t.beginPath(),t.moveTo(49.495605,44.507569),t.lineTo(129.49561,79.507569),t.lineTo(209.49561,44.507569),t.lineTo(49.495605,44.507569),t.closePath(),t.fill(),t.stroke(),t.restore(),t.save(),t.fillStyle=\"#999999\",t.strokeStyle=\"#000000\",t.lineWidth=4.609655857086182,t.lineCap=\"butt\",t.lineJoin=\"round\",t.miterLimit=4,t.beginPath(),t.moveTo(129.49561,174.50757),t.lineTo(129.49561,79.507572),t.lineTo(209.49561,44.507572),t.lineTo(129.49561,174.50757),t.closePath(),t.fill(),t.stroke(),t.restore(),t.save(),t.fillStyle=\"#b3b3b3\",t.strokeStyle=\"#000000\",t.lineWidth=4.609655857086182,t.lineCap=\"butt\",t.lineJoin=\"round\",t.miterLimit=4,t.beginPath(),t.moveTo(129.49561,174.50757),t.lineTo(129.49561,79.507569),t.lineTo(49.495605,44.507569),t.lineTo(129.49561,174.50757),t.closePath(),t.fill(),t.stroke(),t.restore(),t.save(),g=t.createLinearGradient(236.58487,196.44904,257.4877,320.66739),g.addColorStop(0,\"rgba(255, 255, 255, 1)\"),g.addColorStop(1,\"rgba(151, 151, 151, 1)\"),t.fillStyle=g,t.strokeStyle=\"#000000\",t.lineWidth=3.3579113483428955,t.lineCap=\"round\",t.lineJoin=\"round\",t.miterLimit=4,t.transform(1.4965962,0,0,1.2591977,-86.218969,-182.0266),t.beginPath(),t.moveTo(271.42857,233.79076),t.translate(240,233.80553976769053),t.rotate(0),t.scale(.7586207296076113,1),t.arc(0,0,41.42857,-.00035675303306008355,3.1419494066230014,0),t.scale(1.318181748760332,1),t.rotate(0),t.translate(-240,-233.80553976769053),t.translate(240,233.77598023230948),t.rotate(0),t.scale(.7586207296076113,1),t.arc(0,0,41.42857,3.141235900556733,6.2835420602127945,0),t.scale(1.318181748760332,1),t.rotate(0),t.translate(-240,-233.77598023230948),t.closePath(),t.fill(),t.stroke(),t.restore(),t.restore(),t.restore(),t.restore();var i=new Image,r=e.toDataURL(\"image/png\");i.src=r;var s=this;i.onload=function(){var e={generateMipmap:!1,minFilter:s.gl.NEAREST,magFilter:s.gl.NEAREST};s.lgtex=new SglTexture2D(s.gl,i,e)};var n=this.gl.getError();console.log(n)},_createData:function(e){for(var t={minFilter:this.gl.LINEAR,magFilter:this.gl.LINEAR,generateMipmap:!1},i=new Array(e.length),r=0;r<e.length;++r)i[r]=new SglTexture2D(this.gl,e[r],t);var s={textures:i};return s},_destroyData:function(e){if(e){for(var t=0;t<e.textures.length;++t)e.textures[t].destroy();e.textures=null}},_requestNode:function(e){if(!e.req){for(var t=this,i=this._url+\"/\"+e.id,r=new Array,s=1;s<=this.numLayers;s++)r.push(new SglImageRequest(i+\"_\"+s+\".\"+this.format));var n=new SglRequestWatcher(r,function(){t._currentOngoingRequests--,t._readyItems.push(e)});e.req=n,n.send()}},_collectNodesRec:function(e,t){var i={needed:!1,usable:e.data?!0:!1};if(0==e.zScale)return i;if(!t){var r=this._frustum.boxVisibility(e.box.min,e.box.max);if(r==SGL_OUTSIDE_FRUSTUM)return i;\r\nt=r==SGL_INSIDE_FRUSTUM}i.needed=!0;var s=this._frustum.projectedSegmentSize(e.box.center,e.box.size[0]),n=s/e.projectedSize;if(e.priority.timestamp=this._timestamp,e.priority.error=n,!i.usable)return e.req||this._toRequest.push(e),i;if(n<this._maxError||e.isLeaf)return this._toRenderFullRes.push(e),i;for(var a=null,o=0,l=0,h=null,d=[],u=0;4>u;++u)a=this._tree.child(e,u),a&&(h=this._collectNodesRec(a,t),h.usable&&l++,h.needed&&(o++,h.usable||d.push(u)));return o>0&&(0>=l?this._toRenderFullRes.push(e):d.length>0&&this._toRenderHalfRes.push({n:e,children:d})),i},_collectNodes:function(){this._toRequest=[],this._toRenderFullRes=[],this._toRenderHalfRes=[];var e=this._tree.root;e&&this._collectNodesRec(e,!1)},_renderNodeFullRes:function(e){for(var t={u_world_box_min:e.box.min,u_world_box_max:e.box.max},i=[],r=0;r<this.numLayers;r++)i[\"coeff\"+r]=e.data.textures[r];this._renderer.setUniforms(t),this._renderer.setSamplers(i),this._renderer.render()},_renderNodesFullRes:function(e){var t=null,i=null;t=this._tileFullMesh,i=\"tristrip\";var r={u_model_view_projection_matrix:e,u_scale_bias:[1,1,0,0],u_texcoord_scale_bias:[this._tree.tileSize/(this._tree.tileSize+2),1/(this._tree.tileSize+2)],ordlen:this.ordlen,leftTex:this.leftTex,rightTex:this.rightTex,bottomTex:this.bottomTex,topTex:this.topTex};if(4!=this.enumType[this.type])for(var s=0;s<this.ordlen;s++)r[\"gmax\"+s]=this.gmax[s],r[\"gmin\"+s]=this.gmin[s],r[\"lweight\"+s]=this.lweights[s];this._renderer.begin(),this._renderer.setUniforms(r),this._renderer.beginMesh(t),this._renderer.beginPrimitives(i);var n=null;for(var s in this._toRenderFullRes)n=this._toRenderFullRes[s],this._renderNodeFullRes(n);this._renderer.endPrimitives(),this._renderer.endMesh(),this._renderer.end()},_renderNodeHalfRes:function(e,t){for(var i={u_world_box_min:null,u_world_box_max:null,u_scale_bias:null},r=[],s=0;s<this.numLayers;s++)r[\"coeff\"+s]=e.data.textures[s];this._renderer.setSamplers(r);var n=[[.5,.5,0,0],[.5,.5,.5,0],[.5,.5,0,.5],[.5,.5,.5,.5]],a=null;for(var s in t)a=this._tree.child(e,t[s]),i.u_world_box_min=a.box.min,i.u_world_box_max=a.box.max,i.u_scale_bias=n[t[s]],this._renderer.setUniforms(i),this._renderer.render()},_renderNodesHalfRes:function(e){var t=null,i=null;t=this._tileHalfMesh,i=\"tristrip\";var r={u_model_view_projection_matrix:e,u_texcoord_scale_bias:[this._tree.tileSize/(this._tree.tileSize+2),1/(this._tree.tileSize+2)],ordlen:this.ordlen,leftTex:this.leftTex,rightTex:this.rightTex,bottomTex:this.bottomTex,topTex:this.topTex};if(4!=this.enumType[this.type])for(var s=0;s<this.ordlen;s++)r[\"gmax\"+s]=this.gmax[s],r[\"gmin\"+s]=this.gmin[s],r[\"lweight\"+s]=this.lweights[s];this._renderer.begin(),this._renderer.setUniforms(r),this._renderer.beginMesh(t),this._renderer.beginPrimitives(i);var n=null;for(var s in this._toRenderHalfRes)n=this._toRenderHalfRes[s],this._renderNodeHalfRes(n.n,n.children);this._renderer.endPrimitives(),this._renderer.endMesh(),this._renderer.end()},_renderNodes:function(e){this._renderNodesFullRes(e),this._renderNodesHalfRes(e)},_renderNodeFullResBox:function(e){var t=e.box.size,i={u_world_box_min:sglAddV3S(e.box.min,.05*t[0]),u_world_box_max:sglSubV3S(e.box.max,.05*t[0]),u_color:e.isLeaf?[1,0,1]:[0,1,0]};this._boxRenderer.setUniforms(i),this._boxRenderer.render()},_renderNodesFullResBoxes:function(e){var t={u_model_view_projection_matrix:e};this._boxRenderer.begin(),this._boxRenderer.setUniforms(t),this._boxRenderer.beginMesh(this._boxMesh),this._boxRenderer.beginPrimitives(\"edges\");var i=null;for(var r in this._toRenderFullRes)i=this._toRenderFullRes[r],this._renderNodeFullResBox(i);this._boxRenderer.endPrimitives(),this._boxRenderer.endMesh(),this._boxRenderer.end()},_renderNodeHalfResBox:function(e,t){var i={u_world_box_min:null,u_world_box_max:null,u_color:null},r=null;for(var s in t)r=this._tree.child(e,t[s]),sz=r.box.size,i.u_world_box_min=sglAddV3S(r.box.min,.05*sz[0]),i.u_world_box_max=sglSubV3S(r.box.max,.05*sz[0]),i.u_color=r.isLeaf?[1,1,0]:[1,1,1],this._boxRenderer.setUniforms(i),this._boxRenderer.render()},_renderNodesHalfResBoxes:function(e){var t={u_model_view_projection_matrix:e};this._boxRenderer.begin(),this._boxRenderer.setUniforms(t),this._boxRenderer.beginMesh(this._boxMesh),this._boxRenderer.beginPrimitives(\"edges\");var i=null;for(var r in this._toRenderHalfRes)i=this._toRenderHalfRes[r],this._renderNodeHalfResBox(i.n,i.children);this._boxRenderer.endPrimitives(),this._boxRenderer.endMesh(),this._boxRenderer.end()},_renderNodesBoxes:function(e){this.gl.lineWidth(2),this.gl.depthFunc(this.gl.LEQUAL),this._renderNodesFullResBoxes(e),this._renderNodesHalfResBoxes(e),this.gl.depthFunc(this.gl.LESS),this.gl.lineWidth(1)},_doRender:function(e,t,i){var r=sglMulM4(t,this._treeTransform);this._timestamp++,this._frustum.setup(e,r,i),this._collectNodes();var s=sglMulM4(e,r);if(this.renderData&&this._renderNodes(s),this.renderBoxes&&this._renderNodesBoxes(s),this.lg&&null!=this.lgtex){this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);var n=sglMulM4(e,sglScalingM4C(1,1,1)),a={u_mvp:n},o={s_texture:this.lgtex};sglRenderMeshGLPrimitives(this.lgMesh,\"tristrip\",this.texProg,null,a,o),this.gl.disable(this.gl.BLEND)}},_updateCache:function(){var e=1,t=this._readyItems.slice(0,e);this._readyItems.splice(0,e);var i=this._cache.concat(t);i.sort(_MultiResCompareNodes);var r=i.length,s=this._maxCacheSize<r?this._maxCacheSize:r;this._cache=i.splice(0,s);for(var n=i,a=null,o=null,l=[],h=0;s>h;++h)if(a=this._cache[h],o=a.req,a.req=null,o)if(o.succeeded){for(var d=new Array(o.requests.length),h=0;h<d.length;++h)d[h]=o.requests[h].image;a.data&&this._destroyData(a.data),a.data=this._createData(d)}else l.push(h);var u=l.length,c=0;s=n.length;for(var h=0;s>h;++h)a=n[h],o=a.req,a.req=null,o||(u>c?(this._cache[l[c]]=a,c++):(this._destroyData(a.data),a.data=null));c>0&&this._cache.sort(_MultiResCompareNodes)},_requestNodes:function(){var e=this._cache.length,t=e>0?this._cache[e-1]:null;this._toRequest.sort(_MultiResCompareNodes);for(var i=this._maxOngoingRequests-this._currentOngoingRequests,r=0,s=this._toRequest.length,n=null,a=!1,o=0;s>o&&i>r;++o)n=this._toRequest[o],n.req||(a=!0,null!=t&&e>=this._maxCacheSize&&(a=_MultiResCompareNodes(n,t)<0),a&&(this._requestNode(n),r++))},_calculateNormalizedTreeTransform:function(){var e=this._tree.root;if(!e)return sglIdentityM4();var t=new SglBox3;t.min=sglAddV3(sglMulV3(e.box.min,this._tree.scale),this._tree.offset),t.max=sglAddV3(sglMulV3(e.box.max,this._tree.scale),this._tree.offset),this._treeTransform=sglMulM4(sglTranslationM4V(this._tree.offset),sglScalingM4V(this._tree.scale));var i=t.center,r=t.size,s=r[0];s<r[1]&&(s=r[1]),s<r[2]&&(s=r[2]);var n=s>0?1/s:1,a=sglScalingM4C(n,n,n),o=sglTranslationM4C(-i[0],-i[1],-i[2]),l=sglMulM4(a,o);this._normalizedTreeTransform=l},_setupTree:function(){var e=this._tree.root;if(e){var t=this.gl,i=(this._tree.tileSize+2)*(this._tree.tileSize+2)*this.ordlen*3;this._maxCacheSize=sglFloor(this._cacheSizeInBytes/i),this._maxCacheSize<=0&&(this._maxCacheSize=1);var r=new Float32Array([-.5,.5,-.5,-.5,.5,.5,.5,-.5]),s=new SglMeshGL(t);s.addVertexAttribute(\"position\",2,r),s.addArrayPrimitives(\"tristrip\",t.TRIANGLE_STRIP,0,4),this._tileFullMesh=s,this._tileHalfMesh=s,this._calculateNormalizedTreeTransform()}},render:function(e,t,i){this._tree.root&&(this._doRender(e,t,i),this.updateData&&(this._updateCache(),this._requestNodes()))},get normalizedTreeTransform(){return this._normalizedTreeTransform}};"],"sourceRoot":"/source/"}