{"version":3,"sources":["spidergl.js","multires.js"],"names":["SGL_VERSION_MAJOR","SGL_VERSION_MINOR","SGL_VERSION_REVISION","SGL_VERSION_STRING","sglUnknown","Error","sglUnsupported","sglUnimplemented","sglInvalidParameter","sglInvalidCall","sglDefineConstant","ClassName","constantName","constantValue","sglInherit","DerivedClassName","BaseClassName","prototype","constructor","sglInitialize","sglFinalize","sglNodeText","domNodeID","node","document","getElementById","str","n","firstChild","nodeType","textContent","nextSibling","sglLoadFile","url","callback","async","req","XMLHttpRequest","ret","onreadystatechange","readyState","responseText","open","send","sglGetLines","text","line","allLines","split","length","lines","i","replace","push","window","addEventListener","SGL_REQUEST_FAILED","SGL_REQUEST_SUCCEEDED","SGL_REQUEST_IDLE","SGL_REQUEST_ONGOING","SGL_REQUEST_ABORTED","SGL_REQUEST_QUEUED","SGL_REQUEST_REJECTED","SGL_REQUEST_CANCELLED","SglRequest","onReadyCallback","this","_priority","_status","_queue","_onReady","addOnReadyCallback","SglTextFileRequest","apply","Array","slice","call","arguments","_url","_req","Object","defineProperty","get","SglImageRequest","_img","SglRequestWatcher","reqs","t","_waitingReqs","_succeededReqs","_failedReqs","_reqs","cb","r","succeeded","failed","isReady","SglRequestQueue","maxOngoing","maxQueued","_maxOngoing","_maxQueued","_ongoing","_queued","_minPriorityReq","_priorityCompare","_dirty","_createOnReadyCallback","ok","_requestReady","status","priority","p","_updateRequest","f","removeOnReadyCallback","index","splice","queue","_send","cancel","_removeQueuedRequest","abort","_removeOngoingRequest","_abort","img","Image","crossOrigin","onload","complete","onerror","src","requests","onReady","_sort","sort","_updateMinPriority","comparePriorities","_removeFromArray","arr","elem","_execute","sendable","pop","a","b","priorityCompare","victims","result","overflow","toKill","SGL_PI","Math","PI","sglAbs","x","abs","sglFloor","floor","sglCeil","ceil","sglSqrt","sqrt","sglPow","y","pow","sglLog","log","sglExp","exp","sglSin","sin","sglAsin","asin","sglCos","cos","sglAcos","acos","sglTan","tan","sglAtan","atan","sglAtan2","atan2","sglDegToRad","sglRadToDeg","sglMin","min","sglMax","max","sglClamp","sglRandom01","random","sglMapVN","vArray","size","param","first","count","stride","undefined","last","v","k","j","sglMapV2","v2Array","sglMapV3","v3Array","sglMapV4","v4Array","sglUndefV2","sglV2V","sglV2S","s","sglV2C","sglZeroV2","sglOneV2","sglV2","sglDupV2","sglNegV2","sglAddV2","u","sglAddV2S","sglAddSV2","sglSubV2","sglSubV2S","sglSubSV2","sglMulV2","sglMulV2S","sglMulSV2","sglDivV2","sglDivV2S","sglDivSV2","sglRcpV2","sglDotV2","sglCrossV2","sglSqLengthV2","sglLengthV2","sglNormalizedV2","sglSelfNegV2","sglSelfAddV2","sglSelfAddV2S","sglSelfAddSV2","sglSelfSubV2","sglSelfSubV2S","sglSelfSubSV2","sglSelfMulV2","sglSelfMulV2S","sglSelfMulSV2","sglSelfDivV2","sglSelfDivV2S","sglSelfDivSV2","sglSelfRcpV2","sglSelfNormalizeV2","sglMinV2","sglMaxV2","sglV2toV3","z","sglV3C","sglV2toV4","w","sglV4C","sglUndefV3","sglV3V","sglV3S","sglZeroV3","sglOneV3","sglV3","sglDupV3","sglNegV3","sglAddV3","sglAddV3S","sglAddSV3","sglSubV3","sglSubV3S","sglSubSV3","sglMulV3","sglMulV3S","sglMulSV3","sglDivV3","sglDivV3S","sglDivSV3","sglRcpV3","sglDotV3","sglCrossV3","sglSqLengthV3","sglLengthV3","sglNormalizedV3","sglSelfNegV3","sglSelfAddV3","sglSelfAddV3S","sglSelfAddSV3","sglSelfSubV3","sglSelfSubV3S","sglSelfSubSV3","sglSelfMulV3","sglSelfMulV3S","sglSelfMulSV3","sglSelfDivV3","sglSelfDivV3S","sglSelfDivSV3","sglSelfRcpV3","sglSelfCrossV3","sglSelfNormalizeV3","sglMinV3","sglMaxV3","sglV3toV2","sglV3toV4","sglUndefV4","sglV4V","sglV4S","sglZeroV4","sglOneV4","sglV4","sglDupV4","sglNegV4","sglAddV4","sglAddV4S","sglAddSV4","sglSubV4","sglSubV4S","sglSubSV4","sglMulV4","sglMulV4S","sglMulSV4","sglDivV4","sglDivV4S","sglDivSV4","sglRcpV4","sglDotV4","sglSqLengthV4","sglLengthV4","sglNormalizedV4","sglProjectV4","sglSelfNegV4","sglSelfAddV4","sglSelfAddV4S","sglSelfAddSV4","sglSelfSubV4","sglSelfSubV4S","sglSelfSubSV4","sglSelfMulV4","sglSelfMulV4S","sglSelfMulSV4","sglSelfDivV4","sglSelfDivV4S","sglSelfDivSV4","sglSelfRcpV4","sglSelfNormalizeV4","sglSelfProjectV4","sglMinV4","sglMaxV4","sglV4toV2","sglV4toV3","sglUndefM4","sglM4V","sglM4S","m","sglDiagM4V","d","sglDiagM4S","sglDiagM4C","m00","m11","m22","m33","sglZeroM4","sglOneM4","sglIdentityM4","sglM4","sglDupM4","sglGetElemM4","row","col","sglSetElemM4","value","sglGetRowM4","sglSetRowM4V","sglSetRowM4S","sglSetRowM4C","sglGetColM4","c","sglSetColM4V","sglSetColM4S","sglSetColM4C","sglM4toM3","sglIsIdentityM4","sglNegM4","sglAddM4","sglAddM4S","sglAddSM4","sglSubM4","sglSubM4S","sglSubSM4","sglMulM4","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","a11","a12","a13","a14","a15","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15","sglMulM4S","sglMulSM4","sglMulM4V3","sglMulM4V4","sglDivM4S","sglDivSM4","sglRcpM4","sglCompMulM4","sglCompDivM4","sglTransposeM4","sglDeterminantM4","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m12","m13","m14","m15","sglInverseM4","sglTraceM4","sglTranslationM4V","sglTranslationM4C","sglTranslationM4S","sglRotationAngleAxisM4V","angleRad","axis","ax","q","xx","yy","zz","xy","yz","zx","xs","ys","zs","sglRotationAngleAxisM4C","ay","az","sglScalingM4V","sglScalingM4C","sglScalingM4S","sglLookAtM4V","position","target","up","sglLookAtM4C","positionX","positionY","positionZ","targetX","targetY","targetZ","upX","upY","upZ","sglOrthoM4V","omin","omax","sum","dif","sglOrthoM4C","left","right","bottom","top","zNear","zFar","sglFrustumM4V","fmin","fmax","sglFrustumM4C","sglPerspectiveM4","fovYRad","aspectRatio","pmin","pmax","sglUndefQuat","sglQuatV","sglIdentityQuat","sglAngleAxisQuat","halfAngle","fsin","sglM4Quat","trace","root","sglGetQuatAngleAxis","sqLen","invLen","aglAcos","sglGetQuatRotationM4","tx","ty","tz","twx","twy","twz","txx","txy","txz","tyy","tyz","tzz","sglNormalizedQuat","sglMulQuat","q1","q2","SglVec2","setVec","setScalar","setZero","SglVec3","SglVec4","SglPlane3","normal","offset","normalize","_normal","_offset","setup","SglBox3","_min","_max","SglSphere3","center","radius","_center","_radius","SglMatrixStack","_s","_n","SglTransformStack","_ms","_vs","_ps","_SglFrustumPlane","testVertex","clone","copy","set","setOne","at","squaredLength","dot","normalized","neg","minComp","maxComp","argMin","argMax","add","sub","mul","div","rcp","cross","o","slize","nomalize","isNull","isEmpty","squaredDiagonal","diagonal","facesAreas","surfaceArea","facesArea","volume","halfDelta","corner","transformed","matrix","addPoint","addBox","_redius","ss","reset","topRef","load","multiply","loadIdentity","translate","rotate","scale","lookAt","ortho","frustum","perspective","model","view","projection","modelMatrix","modelMatrixRef","modelMatrixTranspose","modelMatrixInverse","modelMatrixInverseTranspose","viewMatrix","viewMatrixRef","viewMatrixTranspose","viewMatrixInverse","viewMatrixInverseTranspose","projectionMatrix","projectionMatrixRef","projectionMatrixTranspose","projectionMatrixInverse","projectionMatrixInverseTranspose","modelViewMatrix","modelViewMatrixTranspose","modelViewMatrixInverse","modelViewMatrixInverseTranspose","viewProjectionMatrix","viewProjectionMatrixTranspose","viewProjectionMatrixInverse","viewProjectionMatrixInverseTranspose","modelViewProjectionMatrix","modelViewProjectionMatrixTranspose","modelViewProjectionMatrixInverse","modelViewProjectionMatrixInverseTranspose","worldSpaceNormalMatrix","viewSpaceNormalMatrix","modelSpaceViewerPosition","modelSpaceViewDirection","worldSpaceViewerPosition","worldSpaceViewDirection","ssglNegV3","nx","ny","nz","off","SGL_OUTSIDE_FRUSTUM","SGL_INTERSECT_FRUSTUM","SGL_INSIDE_FRUSTUM","SglFrustum","viewport","_mvpMatrix","_viewport","_vp","_billboardMatrix","_planes","sglBoxVisibility","boxMin","boxMax","boxVisibility","_sglConsolidateOptions","fullOptions","usedOptions","attr","sglGetBufferOptions","gl","options","usage","STATIC_DRAW","SglBufferInfo","handle","valid","sglBufferFromData","values","opt","buff","createBuffer","obj","bindBuffer","bufferData","sizeInBytes","sglVertexBufferFromData","ARRAY_BUFFER","sglIndexBufferFromData","ELEMENT_ARRAY_BUFFER","SglShaderInfo","type","sglShaderFromSource","shd","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","sglVertexShaderFromSource","VERTEX_SHADER","sglFragmentShaderFromSource","FRAGMENT_SHADER","SglProgramAttributeInfo","name","nativeType","location","SglProgramUniformInfo","SglProgramSamplerInfo","SglProgramInfo","shaders","attributes","uniforms","samplers","sglProgramFromShaders","prg","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attribs_count","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","unif","loc","uniforms_count","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","SAMPLER_2D","SAMPLER_CUBE","sglSetDefaultProgramBindings","sglProgramFromSources","vertexSources","fragmentSources","programInfo","vattr","bindAttribLocation","useProgram","unit","smp","uniform1i","sglProgramSynchronize","sglGetTextureOptions","minFilter","LINEAR","magFilter","wrapS","CLAMP_TO_EDGE","wrapT","isDepth","depthMode","LUMINANCE","depthCompareMode","COMPARE_R_TO_TEXTURE","depthCompareFunc","LEQUAL","generateMipmap","flipY","premultiplyAlpha","SglTextureInfo","format","width","height","sglTexture2DFromData","internalFormat","sourceFormat","sourceType","texels","tex","FLOAT","Float32Array","Uint8Array","createTexture","flipYEnabled","bindTexture","TEXTURE_2D","getParameter","UNPACK_FLIP_Y_WEBGL","flipYRequired","pixelStorei","texImage2D","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","DEPTH_TEXTURE_MODE","TEXTURE_COMPARE_MODE","TEXTURE_COMPARE_FUNC","sglTexture2DFromImage","image","RGBA","UNSIGNED_BYTE","sglTexture2DFromUrl","texInfo","sglTextureCubeFromData","facesTexels","TEXTURE_CUBE_MAP","TEXTURE_CUBE_MAP_POSITIVE_X","sglTextureCubeFromImages","images","sglTextureCubeFromUrls","urls","remaining","watcher","SglRenderbufferInfo","sglRenderbufferFromFormat","rb","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","sglGetFramebufferOptions","colorsAsRenderbuffer","depthAsRenderbuffer","stencilAsRenderbuffer","generateColorsMipmap","generateDepthMipmap","generateStencilMipmap","SglFramebufferInfo","colorTargets","depthTarget","stencilTarget","sglFramebufferFromTargets","fb","createFramebuffer","cts","bindFramebuffer","FRAMEBUFFER","NONE","framebufferTexture2D","DEPTH_ATTACHMENT","framebufferRenderbuffer","STENCIL_ATTACHMENT","drawBuffers","att","COLOR_ATTACHMENT0","ct","fbStatus","checkFramebufferStatus","trg","FRAMEBUFFER_COMPLETE","sglFramebufferFromFormats","colorFormats","depthFormat","stencilFormat","DEPTH_COMPONENT","STENCIL_COMPONENT","SglVertexBuffer","_info","SglIndexBuffer","SglProgramAttribute","program","info","_prog","SglProgramUniform","_func","BOOL","BOOL_VEC2","uniform2iv","BOOL_VEC3","uniform3iv","BOOL_VEC4","uniform4iv","INT","INT_VEC2","INT_VEC3","INT_VEC4","uniform1f","FLOAT_VEC2","uniform2fv","FLOAT_VEC3","uniform3fv","FLOAT_VEC4","uniform4fv","FLOAT_MAT2","uniformMatrix2fv","FALSE","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","SglProgramSampler","_unit","SglProgram","_attributes","_uniforms","_samplers","SglTexture2D","SglTextureCube","SglRenderbuffer","SglFramebuffer","_colorTargets","_depthTarget","_stencilTarget","SglAttributeStreamJS","byCopy","_name","_size","_buff","SglVertexStreamJS","_attribs","_length","rot","sc","scRcp","sMat","sMatInv","rMatInv","fp","bminmax","projectedSegmentSize","hs","p0","p2","p1","destroy","deleteBuffer","isValid","bind","unbind","getUniform","deleteProgram","deleteShader","setDefaultBindings","synchronize","setAttributes","mapping","link","setUniforms","setSamplers","deleteTexture","activeTexture","TEXTURE0","deleteRenderbuffer","deleteFramebuffer","targets","setViewport","bindColor","unbindColor","bindDepth","unbindDepth","bindStencil","unbindStencil","colors","depth","stencil","attachColorTarget","detachColorTarget","buffer","addAttribute","removeAttribute","SGL_ARRAY_PRIMITIVE_STREAM","SGL_INDEXED_PRIMITIVE_STREAM","SGL_PACKED_INDEXED_PRIMITIVE_STREAM","SGL_POINTS_LIST","SGL_LINES_LIST","SGL_LINE_STRIP","SGL_LINE_LOOP","SGL_TRIANGLES_LIST","SGL_TRIANGLE_STRIP","SGL_TRIANGLE_FAN","SglPrimitiveStreamJS","mode","_mode","_first","SglArrayPrimitiveStreamJS","SglIndexedPrimitiveStreamJS","indices","SglConnectivityJS","_prims","SglMeshJS","_valid","_vert","_conn","sglMeshJSImportOBJFromString","mesh","lineIndex","positionsArray","texcoordsArray","normalsArray","indicesArray","positions","texcoords","normals","facemap","pos","nor","tokens","hasPos","hasTex","hasNor","parseFloat","parseInt","addVertexAttribute","addIndexedPrimitives","sglMeshJSImportOBJFromURL","asynch","txt","_sglFindVertexAttributeJSON","vertices","_sglFindConnectivityJSON","connectivity","sglMeshJSImportJSONFromString","JSON","parse","stdMapping","vm","source","semantic","conn","primitives","sglMeshJSImportJSONFromURL","sglGLTypeSize","BYTE","SHORT","UNSIGNED_SHORT","UNSIGNED_INT","sglGLTypeFromWebGLArray","wglArray","Int8Array","Int16Array","Uint16Array","Int32Array","Uint32Array","SglAttributeStreamGL","_type","_norm","_stride","SglVertexStreamGL","SglPrimitiveStreamGL","SglArrayPrimitiveStreamGL","SglIndexedPrimitiveStreamGL","_idxType","SglPackedIndexedPrimitiveStreamGL","blockStartingIndices","blockStartingVertices","_blockStartingVertices","start","_blockStartingIndices","_blockIndicesCount","sIdx","SglConnectivityGL","SglMeshGL","addArrayPrimitives","prim","removePrimitives","removeVertexAttribute","parseOBJ","importOBJ","parseJSON","importJSON","isNormalized","baseVertex","vertexAttribPointer","doDestroy","_clampRange","vEnd","end","_render","_destroy","render","range","drawArrays","drawElements","_clampBlockRange","block","blockRanges","firstBlock","lastBlock","ranges","renderBlock","addPackedIndexedPrimitives","SGL_DefaultStreamMappingPrefix","SglMeshGLRenderer","doSynchronize","_mapping","_meshAttrMap","_mesh","_primStream","_phase","_updateEnabledVB","synchronizeProgram","setStreamMapping","sglRenderMeshGLPrimitives","streamMapping","renderer","begin","renderMeshPrimitives","sglMeshJSCalculateBBox","meshJS","attribName","posAttrib","posSize","posBuffer","bbox","val","sglGLPrimitiveType","primType","POINTS","LINES","LINE_STRIP","LINE_LOOP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","sglMeshJStoGL","meshGL","ptype","sglPackMeshJStoGL","maxVertexIndex","primName","maxInd","pmode","ariety","srcIndices","startVertex","startIndex","startVertices","startIndices","newIndices","newAttribs","indicesMap","dstIndices","vtxCount","triIndices","newVerticesCount","srcIdx","dstIdx","idxCount","srcAttr","dstAttr","asize","dstBase","newArr","srcBuff","concat","dstBuff","_bindVertexBuffers","_unbindVertexBuffers","prog","doLink","getStreamMappingFromPrefix","prefix","substr","meshAttrName","progAttrName","progAttr","setStreamMappingFromPrefix","textures","disableVertexAttribArray","beginMesh","endMesh","beginPrimitives","endPrimitives","vIndex","enableVertexAttribArray","isPacked","blocksCount","blocks","calculateBoundingBox","toMeshGL","toPackedMeshGL","SGL_TRACKBALL_NO_ACTION","SGL_TRACKBALL_ROTATE","SGL_TRACKBALL_PAN","SGL_TRACKBALL_DOLLY","SGL_TRACKBALL_SCALE","SglTrackball","_matrix","_pts","_action","SglFirstPersonCamera","_position","_angles","sglGetCanvasContext","canvasID","canvas","contextNames","getContext","TRUE","SglCanvasUI","manager","handler","_manager","_handler","_canvas","_timerID","_updRate","_ignoreKeyRepeat","loadEvent","unloadEvent","keyDownEvent","keyUpEvent","keyPressEvent","mouseDownEvent","mouseUpEvent","mouseMoveEvent","mouseWheelEvent","clickEvent","dblClickEvent","resizeEvent","updateEvent","drawEvent","keysDown","mouseButtonsDown","mousePos","mousePrevPos","mouseDeltaPos","timeNow","Date","now","timePrev","timeDelta","_SglCanvasManager","updateRate","contentEditable","PACK_ALIGNMENT","UNPACK_ALIGNMENT","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_COLORSPACE_CONVERSION_WEBGL","ui","mgr","_drawPending","rendering","_drawFunc","draw","e","unload","keyDown","keyUp","keyPress","mouseDown","mouseUp","mouseMove","click","dblClick","resize","mouseWheel","blur","mouseOut","mouseOver","touchStart","touchEnd","touchMove","_projectOnSphere","_transform","_transformOnSphere","_translate","trMat","action","track","pan","dolly","mInv","rotMat","v0","dz","scaleMat","roll","viewDir","xOffset","yOffset","zOffset","pitchMat","yawMat","rotOffset","translateOnPlane","pitchOffset","yawOffset","rollOffset","ignoreKeyRepeat","updR","clearInterval","ms","setInterval","update","requestDraw","_getMouseClientPos","rct","getBoundingClientRect","clientX","clientY","setTimeout","button","key","doDraw","keyString","String","fromCharCode","keyCode","toLowerCase","toUpperCase","charCode","preventDefault","focus","delta","event","wheelDelta","opera","detail","touches","changedTouches","flush","_SGL_RegisteredCanvas","_sglManageCanvas","_sglUnmanageCanvas","_sglManageCanvasOnLoad","_sglUnmanageCanvasOnLoad","sglRegisterCanvas","sglRegisterLoadedCanvas","createRtiViewer","idDiv","imageUrlOrFunction","canvasHeight","canvasWidth","fullscreen","canvasContainer","$","canvasDiv","createElement","canvasNode","id","style","margin","append","canvasName","aNode","aNodeDiv","href","toolbar","appendChild","cssFloat","divHelp","setAttribute","visibility","innerHTML","fullScreenOff","exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen","multiResRTI","label","icons","primary","color","backgroundColor","display","startZoomIn","startZoomOut","trim","setMode","show","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","screen","removeClass","msFullscreenElement","mozFullScreen","webkitIsFullScreen","hide","divError","MultiRes","setImageUrl","setImageFunction","setOnLoadImageCallback","css","msg","stepAnimation","idTimer","flipAngles","onDrawCallback","animating","moveToCenter","imageUrl","imageFunction","OnLoadImageCallback","currentSpeed","maxStep","animationStack","isMoving","MultiResNode","parentIndex","childrenIndices","projectedSize","zScale","box","timestamp","error","Number","MAX_VALUE","data","isLeaf","MultiResTree","onloadCallback","ready","nodesCount","rootIndex","nodes","tileSize","forma","imgW","imgH","_MultiResAssert","cond","alert","_MultiResCompareNodes","MultiResRenderer","cacheSizeInBytes","onLoad","lg","_tree","_timestamp","_frustum","_maxError","_cache","_cacheSizeInBytes","_maxCacheSize","_maxOngoingRequests","_currentOngoingRequests","_toRequest","_toRenderFullRes","_toRenderHalfRes","_readyItems","renderData","renderBoxes","boxPositions","trianglesIndices","edgesIndices","bvs","_boxMesh","_tileFullMesh","_tileHalfMesh","_program","bfs","bprg","lgPositions","_boxProgram","_boxRenderer","_treeTransform","_normalizedTreeTransform","updateData","texProg","lgTexcoords","tmp","lgMesh","lgtex","_createLg","enumType","_setLightDir","lx","ly","norm","alpha","lpos","lightPos","lweights","computeLightingFunction","resetViewpoint","translation","mat","flipMatrix","xform","loadImage","leftBottom","imgWidth","imgHeight","rightTop","h","scale1","scale2","maxScale","viewerdx","viewerdy","stopRendering","setOnDrawCallback","onDraw","_startZoom","deltaPos","speed","tmpScale","deltaScale","that","moveInterval","zoomInterval","_zoomAnimation","_moveAnimation","computeModelMatrix","tempPos","endPoint","deltaX","deltaY","currentPoint","_updateMoveStack","step","tmpMat","returnModelMatrix","lb","rt","realwidth","realheight","lenght","sendMouseDown","endAnimation","tmpVector","_adjustTranslation","startPoint","deltaVect","movementVector","acceleration","tmpPoint","translVector","realDeltaX","realDeltaY","dt","translVect","scaleMatrix","normalizedTreeTransform","offsetHeight","getError","CONTEXT_LOST_WEBGL","console","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","_load","temp","nLevel","woffset","hoffset","imgBox","imgSize","imgCenter","halfSize","diff","halfW","parentNode","halfH","destroyData","idx","parent","child","phi","theta","cosPhi","cosTheta","cosTheta2","xhttp","targetURL","doc","overrideMimeType","responseXML","getElementsByTagName","getAttribute","content","isNaN","tree","bias","ordlen","numLayers","childNodes","nodeValue","gmax","gmin","_destroyData","vs","fs","_renderer","leftTex","rightTex","bottomTex","topTex","_setupTree","ctx","save","beginPath","moveTo","lineTo","closePath","clip","strokeStyle","lineCap","lineJoin","miterLimit","restore","transform","g","createRadialGradient","addColorStop","fillStyle","lineWidth","arc","fill","stroke","createLinearGradient","dataURL","toDataURL","texOpt","NEAREST","_createData","colorImgs","colorTexOpts","dataTextures","_requestNode","_collectNodesRec","parentFullyVisible","needed","usable","visStatus","cr","neededCount","usableCount","missingChildren","children","_collectNodes","_renderNodeFullRes","u_world_box_min","u_world_box_max","_renderNodesFullRes","mvp","u_model_view_projection_matrix","u_scale_bias","u_texcoord_scale_bias","_renderNodeHalfRes","scaleBias","_renderNodesHalfRes","nc","_renderNodes","_renderNodeFullResBox","sz","u_color","_renderNodesFullResBoxes","_renderNodeHalfResBox","_renderNodesHalfResBoxes","_renderNodesBoxes","depthFunc","LESS","_doRender","mv","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","mvp2","quadSamplers","s_texture","u_mvp","disable","_updateCache","readyItems","combined","cl","outOfCache","cimgs","fc","reinsertedCount","_requestNodes","cs","lastItem","requestableCount","requested","canRequest","_calculateNormalizedTreeTransform","rbox","bc","bs","maxDim","quadPositions","quadMesh","csize"],"mappings":"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","file":"webrti.min.js","sourcesContent":["/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// version\r\n/***********************************************************************/\r\nvar SGL_VERSION_MAJOR      = 0;\r\nvar SGL_VERSION_MINOR      = 1;\r\nvar SGL_VERSION_REVISION   = 1;\r\nvar SGL_VERSION_STRING     = SGL_VERSION_MAJOR + \".\" + SGL_VERSION_MINOR + \".\" + SGL_VERSION_REVISION;\r\n/***********************************************************************/\r\n\r\n\r\n// exceptions\r\n/***********************************************************************/\r\nfunction sglUnknown() {\r\n\tthrow new Error(\"SpiderGL : UNKNOWN\");\r\n}\r\n\r\nfunction sglUnsupported() {\r\n\tthrow new Error(\"SpiderGL : UNSUPPORTED\");\r\n}\r\n\r\nfunction sglUnimplemented() {\r\n\tthrow new Error(\"SpiderGL : UNIMPLEMENTED\");\r\n}\r\n\r\nfunction sglInvalidParameter() {\r\n\tthrow new Error(\"SpiderGL : INVALID_PARAMETER\");\r\n}\r\n\r\nfunction sglInvalidCall() {\r\n\tthrow new Error(\"SpiderGL : INVALID_CALL\");\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// utilities\r\n/***********************************************************************/\r\n/*function sglDefineGetter(ClassName, getterName, getterFunc, obj) {\r\n\tClassName.defineProperty(obj, getterName, {get: getterFunc});\r\n\t//ClassName.prototype.__defineGetter__(getterName, getterFunc);\r\n}\r\n\r\nfunction sglDefineSetter(ClassName, setterName, setterFunc, obj) {\r\n\tClassName.defineProperty(obj, setterName, {set: setterFunc});\r\n\t//ClassName.prototype.__defineSetter__(setterName, setterFunc);\r\n}*/\r\n\r\nfunction sglDefineConstant(ClassName, constantName, constantValue) {\r\n\tClassName[constantName] = constantValue;\r\n}\r\n\r\nfunction sglInherit(DerivedClassName, BaseClassName) {\r\n\tDerivedClassName.prototype = new BaseClassName();\r\n\tDerivedClassName.prototype.constructor = DerivedClassName;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// initialization - finalization\r\n/***********************************************************************/\r\nfunction sglInitialize() {\r\n\t;\r\n}\r\n\r\nfunction sglFinalize() {\r\n\t;\r\n}\r\n\r\nwindow.addEventListener(\"load\",   function() { sglInitialize(); }, false);\r\nwindow.addEventListener(\"unload\", function() { sglFinalize();   }, false);\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// DOM utilities\r\n/*********************************************************/\r\nfunction sglNodeText(domNodeID) {\r\n\tvar node = document.getElementById(domNodeID);\r\n\tif (!node) return null;\r\n\r\n\tvar str = \"\";\r\n\tvar n   = node.firstChild;\r\n\twhile (n) {\r\n\t\tif (n.nodeType == 3) {\r\n\t\t\tstr += n.textContent;\r\n\t\t}\r\n\t\tn = n.nextSibling;\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nfunction sglLoadFile(url, callback) {\r\n\tvar async = (callback) ? (true) : (false);\r\n\tvar req = new XMLHttpRequest();\r\n\r\n\tif (async) {\r\n\t\treq.onreadystatechange = function() {\r\n\t\t\tif (req.readyState == 4) {\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(req.responseText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\treq.open(\"GET\", url, async);\r\n\treq.send(null);\r\n\r\n\tvar ret = null;\r\n\tif (!async) {\r\n\t\tret = req.responseText;\r\n\t}\r\n\r\n\treturn ret;\r\n}\r\n\r\nfunction sglGetLines(text)\r\n{\r\n\tvar allLines = text.split(\"\\n\");\r\n\tvar n = allLines.length;\r\n\tvar lines = [ ];\r\n\tvar line = null;\r\n\tfor (var i=0; i<n; ++i) {\r\n\t\tline = allLines[i].replace(/[ \\t]+/g, \" \").replace(/\\s\\s*$/, \"\");\r\n\t\tif (line.length > 0) {\r\n\t\t\tlines.push(line);\r\n\t\t}\r\n\t}\r\n\treturn lines;\r\n}\r\n/*********************************************************/\r\n\r\n\r\n// SglRequest\r\n/*********************************************************/\r\nvar SGL_REQUEST_FAILED     = 0;\r\nvar SGL_REQUEST_SUCCEEDED  = 1;\r\nvar SGL_REQUEST_IDLE       = 2;\r\nvar SGL_REQUEST_ONGOING    = 3;\r\nvar SGL_REQUEST_ABORTED    = 4;\r\nvar SGL_REQUEST_QUEUED     = 5;\r\nvar SGL_REQUEST_REJECTED   = 6;\r\nvar SGL_REQUEST_CANCELLED  = 7;\r\n\r\n/**\r\n * Constructs a SglRequest.\r\n * @class Base class for an asynchronous request.\r\n */\r\nfunction SglRequest(onReadyCallback) {\r\n\tthis._priority = null;\r\n\tthis._status   = SGL_REQUEST_IDLE;\r\n\tthis._queue    = null;\r\n\tthis._onReady  = [ ];\r\n\tif (onReadyCallback) {\r\n\t\tthis.addOnReadyCallback(onReadyCallback);\r\n\t}\r\n}\r\n\r\nSglRequest.prototype = {\r\n\t_createOnReadyCallback : function() {\r\n\t\tvar t  = this;\r\n\t\tvar cb = function(ok) {\r\n\t\t\tt._status = (ok) ? (SGL_REQUEST_SUCCEEDED) : (SGL_REQUEST_FAILED);\r\n\t\t\tif (t._queue) {\r\n\t\t\t\tt._queue._requestReady(t);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tvar n = t._onReady.length;\r\n\t\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\t\tt._onReady[i](t);\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn cb;\r\n\t},\r\n\r\n\tget status() {\r\n\t\treturn this._status;\r\n\t},\r\n\r\n\tget priority() {\r\n\t\treturn this._priority;\r\n\t},\r\n\r\n\tset priority(p) {\r\n\t\tthis._priority = p;\r\n\t\tif (this._queue) {\r\n\t\t\tthis._queue._updateRequest(this);\r\n\t\t}\r\n\t},\r\n\r\n\tget succeeded() {\r\n\t\treturn (this._status == SGL_REQUEST_SUCCEEDED);\r\n\t},\r\n\r\n\tget failed() {\r\n\t\treturn (this._status == SGL_REQUEST_FAILED);\r\n\t},\r\n\r\n\taddOnReadyCallback : function(f) {\r\n\t\tif (f) {\r\n\t\t\tthis._onReady.push(f);\r\n\t\t\tif (this.isReady) {\r\n\t\t\t\tf(this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tremoveOnReadyCallback : function(f) {\r\n\t\tvar index = -1;\r\n\t\tvar n = this._onReady.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tif (this._onReady[i] == f) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (index < 0) return;\r\n\t\tthis._onReady.splice(index, 1);\r\n\t},\r\n\r\n\tget isReady() {\r\n\t\treturn (this.failed || this.succeeded);\r\n\t},\r\n\r\n\tget queue() {\r\n\t\treturn this._queue;\r\n\t},\r\n\r\n\tsend : function() {\r\n\t\tif (!this._send) return false;\r\n\t\tvar r = this._send();\r\n\t\tif (r) {\r\n\t\t\tthis._status = SGL_REQUEST_ONGOING;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._status = SGL_REQUEST_FAILED;\r\n\t\t\tvar cb = this._createOnReadyCallback();\r\n\t\t\tcb(false);\r\n\t\t}\r\n\t\treturn r;\r\n\t},\r\n\r\n\tcancel : function() {\r\n\t\tif (this._status == SGL_REQUEST_QUEUED) {\r\n\t\t\tif (this._queue) {\r\n\t\t\t\tthis._queue._removeQueuedRequest(this);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tthis._status = SGL_REQUEST_CANCELLED;\r\n\t\t}\r\n\t},\r\n\r\n\tabort : function() {\r\n\t\tthis.cancel();\r\n\t\tif (this._status == SGL_REQUEST_ONGOING) {\r\n\t\t\tif (this._queue) {\r\n\t\t\t\tthis._queue._removeOngoingRequest(this);\r\n\t\t\t\tthis._queue  = null;\r\n\t\t\t}\r\n\t\t\tif (this._abort) {\r\n\t\t\t\tthis._abort();\r\n\t\t\t}\r\n\t\t\tthis._status = SGL_REQUEST_ABORTED;\r\n\t\t}\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglTextFileRequest\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglTextFileRequest.\r\n * @class Asynchronous text file request.\r\n */\r\nfunction SglTextFileRequest(url, onReadyCallback) {\r\n\tSglRequest.apply(this, Array.prototype.slice.call(arguments, 1));\r\n\tthis._url = url;\r\n\tthis._req = null;\r\n\tObject.defineProperty(this, \"url\", {get: function(){return this._url;}});\r\n\tObject.defineProperty(this, \"text\", {get: function(){return this._req.responseText;}});\r\n}\r\n\r\nsglInherit(SglTextFileRequest, SglRequest);\r\n\r\n/*sglDefineGetter(SglTextFileRequest, \"url\", function() {\r\n\treturn this._url;\r\n});\r\n\r\nsglDefineGetter(SglTextFileRequest, \"text\", function() {\r\n\treturn this._req.responseText;\r\n});*/\r\n\r\nSglTextFileRequest.prototype._send = function() {\r\n\tif (!this._url) return false;\r\n\r\n\tvar req = new XMLHttpRequest();\r\n\tthis._req = req;\r\n\r\n\tvar cb = this._createOnReadyCallback();\r\n\treq.onreadystatechange = function() {\r\n\t\tif (req.readyState == 4) {\r\n\t\t\tvar ok = (req.status) ? (req.status == 200) : (true);\r\n\t\t\tcb(ok);\r\n\t\t}\r\n\t};\r\n\treq.open(\"GET\", this._url, true);\r\n\treq.send();\r\n\r\n\treturn true;\r\n};\r\n\r\nSglTextFileRequest.prototype._abort = function() {\r\n\tif (!this._req) return;\r\n\tthis._req.abort();\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglImageRequest\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglImageRequest.\r\n * @class Asynchronous image request.\r\n */\r\nfunction SglImageRequest(url, onReadyCallback) {\r\n\tSglRequest.apply(this, Array.prototype.slice.call(arguments, 1));\r\n\tthis._url = url;\r\n\tthis._img = null;\r\n\tObject.defineProperty(this, \"url\", {get: function(){return this._url;}});\r\n\tObject.defineProperty(this, \"image\", {get: function(){return this._img;}});\r\n}\r\n\r\nsglInherit(SglImageRequest, SglRequest);\r\n\r\nSglImageRequest.prototype._send = function() {\r\n\tif (!this._url) return false;\r\n\r\n\tvar img = new Image();\r\n\tthis._img = img;\r\n\timg.crossOrigin = '';\r\n\tvar cb = this._createOnReadyCallback();\r\n\timg.onload = function() {\r\n\t\tcb(img.complete);\r\n\t};\r\n\timg.onerror = function() {\r\n\t\tcb(false);\r\n\t};\r\n\timg.src = this._url;\r\n\r\n\treturn true;\r\n};\r\n\r\nSglImageRequest.prototype._abort = function() {\r\n\t;\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglRequestWatcher\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglRequestWatcher.\r\n * @class Watches for requests completion.\r\n */\r\nfunction SglRequestWatcher(reqs, onReadyCallback) {\r\n\tvar n = reqs.length;\r\n\r\n\tthis._onReady       = (onReadyCallback) ? (onReadyCallback) : (null);\r\n\tthis._waitingReqs   = n;\r\n\tthis._succeededReqs = 0;\r\n\tthis._failedReqs    = 0;\r\n\tthis._reqs          = reqs.slice();\r\n\r\n\tvar t  = this;\r\n\tvar cb = function(r) {\r\n\t\tif (r.succeeded) {\r\n\t\t\tt._succeededReqs++;\r\n\t\t}\r\n\t\telse if (r.failed) {\r\n\t\t\tt._failedReqs++;\r\n\t\t}\r\n\t\tt._waitingReqs--;\r\n\t\tif (t.isReady) {\r\n\t\t\tif (t._onReady) {\r\n\t\t\t\tt._onReady(t);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor (var i=0; i<n; ++i) {\r\n\t\tif (reqs[i].succeeded) {\r\n\t\t\tthis._succeededReqs++;\r\n\t\t\tthis._waitingReqs--;\r\n\t\t}\r\n\t\telse if (reqs[i].failed) {\r\n\t\t\tthis._failedReqs++;\r\n\t\t\tthis._waitingReqs--;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treqs[i].addOnReadyCallback(cb);\r\n\t\t}\r\n\t}\r\n\r\n\tif (this._waitingReqs <= 0) {\r\n\t\tif (this._onReady) {\r\n\t\t\tthis._onReady(this);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nSglRequestWatcher.prototype = {\r\n\tget requests() {\r\n\t\treturn this._reqs;\r\n\t},\r\n\r\n\tget succeeded() {\r\n\t\treturn (this._succeededReqs == this._reqs.length);\r\n\t},\r\n\r\n\tget failed() {\r\n\t\tif ((this._succeededReqs + this._failedReqs) < this._reqs.length) return false;\r\n\t\treturn (this._succeededReqs < this._reqs.length);\r\n\t},\r\n\r\n\tget onReady() {\r\n\t\treturn this._onReady;\r\n\t},\r\n\r\n\tset onReady(f) {\r\n\t\tthis._onReady = f;\r\n\t\tif (this.isReady) {\r\n\t\t\tif (this._onReady) {\r\n\t\t\t\tthis._onReady(t);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tget isReady() {\r\n\t\treturn ((this._succeededReqs + this._failedReqs) == this._reqs.length);\r\n\t},\r\n\r\n\tsend : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].send();\r\n\t\t}\r\n\t},\r\n\r\n\tcancel : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].cancel();\r\n\t\t}\r\n\t},\r\n\r\n\tabort : function() {\r\n\t\tvar n = this._reqs.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tthis._reqs[i].abort();\r\n\t\t}\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n// SglRequestQueue\r\n/*********************************************************/\r\n/**\r\n * Constructs a SglRequestQueue.\r\n * @class Asynchronous requests scheduler.\r\n */\r\nfunction SglRequestQueue(maxOngoing, maxQueued, onReadyCallback) {\r\n\tthis._maxOngoing = (maxOngoing > 0) ? (maxOngoing) : (0);\r\n\tthis._maxQueued  = (maxQueued  > 0) ? (maxQueued ) : (0);\r\n\r\n\tthis._ongoing = [ ];\r\n\tthis._queued  = [ ];\r\n\tthis._onReady = null;\r\n\tthis._minPriorityReq = null;\r\n\tthis._priorityCompare = null;\r\n\tthis._dirty = true;\r\n}\r\n\r\nSglRequestQueue.prototype = {\r\n\t_sort : function() {\r\n\t\tif (!this._dirty) return;\r\n\r\n\t\tthis._dirty = false;\r\n\t\tthis._minPriorityReq = null;\r\n\t\tif (this._queued.length <= 0) return;\r\n\r\n\t\tif (this._priorityCompare) {\r\n\t\t\tthis._queued.sort(this._priorityCompare);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._queued.sort();\r\n\t\t}\r\n\t\tif (this._queued.length > 0) {\r\n\t\t\tthis._minPriorityReq = this._queued[0];\r\n\t\t}\r\n\t},\r\n\r\n\t_updateMinPriority : function() {\r\n\t\tthis._minPriorityReq = null;\r\n\t\tvar n = this._queued.length;\r\n\t\tif (n <= 0) return;\r\n\r\n\t\tthis._minPriorityReq = this._queued[0];\r\n\t\tif (!this._dirty) return;\r\n\r\n\t\tfor (var i=1; i<n; ++i) {\r\n\t\t\tif (this.comparePriorities(this._queued[i].priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\tthis._minPriorityReq = this._queued[i];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_removeFromArray : function(arr, elem) {\r\n\t\tvar index = -1;\r\n\t\tvar n = arr.length;\r\n\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\tif (arr[i] == elem) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (index < 0) return;\r\n\t\tarr.splice(index, 1);\r\n\t},\r\n\r\n\t_removeQueuedRequest : function(r) {\r\n\t\tthis._removeFromArray(this._queued, r);\r\n\t\tif (this._queued.length <= 0) {\r\n\t\t\tthis._minPriorityReq = null;\r\n\t\t}\r\n\t\telse if (r == this._minPriorityReq) {\r\n\t\t\tthis._updateMinPriority();\r\n\t\t}\r\n\t},\r\n\r\n\t_removeOngoingRequest : function(r) {\r\n\t\tthis._removeFromArray(this._ongoing, r);\r\n\t\tthis._execute();\r\n\t},\r\n\r\n\t_updateRequest : function(r) {\r\n\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\tthis._minPriorityReq = r;\r\n\t\t}\r\n\t\tthis._dirty = true;\r\n\t},\r\n\r\n\t_requestReady : function(r) {\r\n\t\tthis._removeOngoingRequest(r);\r\n\t\tif (this._onReady) {\r\n\t\t\tthis._onReady(r);\r\n\t\t}\r\n\t\tthis._execute();\r\n\t},\r\n\r\n\t_execute : function() {\r\n\t\tvar n = this._queued.length;\r\n\t\tif (n <= 0) return;\r\n\t\tvar sendable = (this._maxOngoing > 0) ? (this._maxOngoing - this._ongoing.length) : (n)\r\n\t\tif (sendable <= 0) return;\r\n\t\tif (sendable > n) sendable = n;\r\n\t\tthis._sort();\r\n\t\tvar r = null;\r\n\t\tfor (var i=0; i<sendable; ++i) {\r\n\t\t\tr = this._queued.pop();\r\n\t\t\tr.send();\r\n\t\t}\r\n\t\tif (this._queued.length > 0) {\r\n\t\t\tthis._minPriorityReq = this._queued[0];\r\n\t\t}\r\n\t},\r\n\r\n\tcomparePriorities : function(a, b) {\r\n\t\tif (this._priorityCompare) {\r\n\t\t\treturn this._priorityCompare(a, b);\r\n\t\t}\r\n\t\treturn (a - b);\r\n\t},\r\n\r\n\tget priorityCompare() {\r\n\t\treturn this._priorityCompare;\r\n\t},\r\n\r\n\tset priorityCompare(f) {\r\n\t\tthis._priorityCompare = f;\r\n\t\tthis._updateMinPriority();\r\n\t},\r\n\r\n\tget onReady() {\r\n\t\treturn this._onReady;\r\n\t},\r\n\r\n\tset onReady(f) {\r\n\t\tthis._onReady = f;\r\n\t},\r\n\r\n\tpush : function(r) {\r\n\t\tvar ret = {\r\n\t\t\tvictims : null,\r\n\t\t\tresult  : false\r\n\t\t};\r\n\t\t\r\n\t\tif (r.queue) return ret;\r\n\t\tvar n = this._queued.length;\r\n\t\tvar overflow = ((this._maxQueued > 0) && (n >= this._maxQueued));\r\n\r\n\t\tif  (overflow) {\r\n\t\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\tr._status = SGL_REQUEST_REJECTED;\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._queued.push(r);\r\n\t\tr._queue  = this;\r\n\t\tr._status = SGL_REQUEST_QUEUED;\r\n\t\tn++;\r\n\r\n\t\tret.result = true;\r\n\t\r\n\t\tvar toKill = (this._maxQueued > 0) ? (n - this._maxQueued) : (0);\r\n\t\tif (toKill <= 0) {\r\n\t\t\tif (this._minPriorityReq != null) {\r\n\t\t\t\tif (this.comparePriorities(r.priority, this._minPriorityReq.priority) <= 0) {\r\n\t\t\t\t\tthis._minPriorityReq = r;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._minPriorityReq = r;\r\n\t\t\t}\r\n\t\t\tthis._dirty = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._sort();\r\n\t\t\tret.victims = this._queued.slice(0, toKill);\r\n\t\t\tthis._queued.splice(0, toKill);\r\n\t\t\tfor (var i=0; i<toKill; ++i) {\r\n\t\t\t\tret.victims[i]._status = SGL_REQUEST_REJECTED;\r\n\t\t\t\tret.victims[i]._queue  = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._execute();\r\n\r\n\t\treturn ret;\r\n\t}\r\n};\r\n/*********************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// math utilities\r\n/***********************************************************************/\r\nvar SGL_PI = Math.PI;\r\n\r\nfunction sglAbs(x) {\r\n\treturn Math.abs(x);\r\n}\r\n\r\nfunction sglFloor(x) {\r\n\treturn Math.floor(x);\r\n}\r\n\r\nfunction sglCeil(x) {\r\n\treturn Math.ceil(x);\r\n}\r\n\r\nfunction sglSqrt(x) {\r\n\treturn Math.sqrt(x);\r\n}\r\n\r\nfunction sglPow(x, y) {\r\n\treturn Math.pow(x, y);\r\n}\r\n\r\nfunction sglLog(x) {\r\n\treturn Math.log(x);\r\n}\r\n\r\nfunction sglExp(x) {\r\n\treturn Math.exp(x);\r\n}\r\n\r\nfunction sglSin(x) {\r\n\treturn Math.sin(x);\r\n}\r\n\r\nfunction sglAsin(x) {\r\n\treturn Math.asin(x);\r\n}\r\n\r\nfunction sglCos(x) {\r\n\treturn Math.cos(x);\r\n}\r\n\r\nfunction sglAcos(x) {\r\n\treturn Math.acos(x);\r\n}\r\n\r\nfunction sglTan(x) {\r\n\treturn Math.tan(x);\r\n}\r\n\r\nfunction sglAtan(x) {\r\n\treturn Math.atan(x);\r\n}\r\n\r\nfunction sglAtan2(y, x) {\r\n\treturn Math.atan2(y, x);\r\n}\r\n\r\nfunction sglDegToRad(x) {\r\n\treturn (x * (SGL_PI / 180.0));\r\n}\r\n\r\nfunction sglRadToDeg(x) {\r\n\treturn (x * (180.0 / SGL_PI));\r\n}\r\n\r\nfunction sglMin(a, b) {\r\n\treturn Math.min(a, b);\r\n}\r\n\r\nfunction sglMax(a, b) {\r\n\treturn Math.max(a, b);\r\n}\r\n\r\nfunction sglClamp(x, min, max) {\r\n\treturn ((x <= min) ? (min) : ((x >= max) ? (max) : (x)));\r\n}\r\n\r\nfunction sglRandom01() {\r\n\treturn Math.random();\r\n}\r\n\r\nfunction sglMapVN(vArray, size, f, param, first, count, stride) {\r\n\tfirst  = (first  != undefined) ? first  : 0;\r\n\tstride = (stride != undefined) ? stride : size;\r\n\tcount  = (count  != undefined) ? count  : ((vArray.length - first) / stride);\r\n\r\n\tvar last = first + count * stride;\r\n\tvar v    = new Array(n);\r\n\r\n\tvar k = 0;\r\n\tvar j = 0;\r\n\tfor (var i=first; i<last; i+=stride) {\r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\tv[j] = vArray[i+j];\r\n\t\t}\r\n\t\tf(v, param, k++);\r\n\t\tfor (j=0; j<n; ++j) {\r\n\t\t\tvArray[i+j] = v[j];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction sglMapV2(v2Array, f, param, first, count, stride) {\r\n\tsglMapVN(v2Array, 2, f, param, first, count, stride);\r\n}\r\n\r\nfunction sglMapV3(v3Array, f, param, first, count, stride) {\r\n\tsglMapVN(v3Array, 3, f, param, first, count, stride);\r\n}\r\n\r\nfunction sglMapV4(v4Array, f, param, first, count, stride) {\r\n\tsglMapVN(v4Array, 4, f, param, first, count, stride);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// 2-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV2(v) {\r\n\treturn new Array(2);\r\n}\r\n\r\nfunction sglV2V(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV2S(s) {\r\n\treturn [ s, s ];\r\n}\r\n\r\nfunction sglV2C(x, y) {\r\n\treturn [ x, y ];\r\n}\r\n\r\nfunction sglZeroV2() {\r\n\treturn sglV2S(0.0);\r\n}\r\n\r\nfunction sglOneV2() {\r\n\treturn sglV2S(1.0);\r\n}\r\n\r\nfunction sglV2() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV2V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV2S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 2:\r\n\t\t\treturn sglV2V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV2();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglNegV2(v) {\r\n\treturn sglV2C(-v[0], -v[1]);\r\n}\r\n\r\nfunction sglAddV2(u, v) {\r\n\treturn sglV2C(u[0]+v[0], u[1]+v[1]);\r\n}\r\n\r\nfunction sglAddV2S(v, s) {\r\n\treturn sglV2C(v[0]+s, v[1]+s);\r\n}\r\n\r\nfunction sglAddSV2(s, v) {\r\n\treturn sglAddV2S(v, s)\r\n}\r\n\r\nfunction sglSubV2(u, v) {\r\n\treturn sglV2C(u[0]-v[0], u[1]-v[1]);\r\n}\r\n\r\nfunction sglSubV2S(v, s) {\r\n\treturn sglV2C(v[0]-s, v[1]-s);\r\n}\r\n\r\nfunction sglSubSV2(v, s) {\r\n\treturn sglV2C(s-v[0], s-v[1]);\r\n}\r\n\r\nfunction sglMulV2(u, v) {\r\n\treturn sglV2C(u[0]*v[0], u[1]*v[1]);\r\n}\r\n\r\nfunction sglMulV2S(v, s) {\r\n\treturn sglV2C(v[0]*s, v[1]*s);\r\n}\r\n\r\nfunction sglMulSV2(s, v) {\r\n\treturn sglMulV2S(v, s);\r\n}\r\n\r\nfunction sglDivV2(u, v) {\r\n\treturn sglV2C(u[0]/v[0], u[1]/v[1]);\r\n}\r\n\r\nfunction sglDivV2S(v, s) {\r\n\treturn sglV2C(v[0]/s, v[1]/s);\r\n}\r\n\r\nfunction sglDivSV2(s, v) {\r\n\treturn sglV2C(s/v[0], s/v[1]);\r\n}\r\n\r\nfunction sglRcpV2(v) {\r\n\treturn sglDivSV2(1.0, v);\r\n}\r\n\r\nfunction sglDotV2(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1]);\r\n}\r\n\r\nfunction sglCrossV2(u, v) {\r\n\treturn (u[0]*v[1] - u[1]*v[0]);\r\n}\r\n\r\nfunction sglSqLengthV2(v) {\r\n\treturn sglDotV2(v, v);\r\n}\r\n\r\nfunction sglLengthV2(v) {\r\n\treturn sglSqrt(sglSqLengthV2(v));\r\n}\r\n\r\nfunction sglNormalizedV2(v) {\r\n\tvar f = 1.0 / sglLengthV2(v);\r\n\treturn sglMulV2S(v, f);\r\n}\r\n\r\nfunction sglSelfNegV2(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV2(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV2S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV2(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV2(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV2S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV2(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV2(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV2S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV2(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV2(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV2S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV2(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV2(v) {\r\n\treturn sglSelfDivSV2(1.0, v);\r\n}\r\n\r\nfunction sglSelfNormalizeV2(v) {\r\n\tvar f = 1.0 / sglLengthV2(v);\r\n\treturn sglSelfMulV2S(v, f);\r\n}\r\n\r\nfunction sglMinV2(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV2(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1]))\r\n\t];\r\n}\r\n\r\nfunction sglV2toV3(v, z) {\r\n\treturn sglV3C(v[0], v[1], z);\r\n}\r\n\r\nfunction sglV2toV4(v, z, w) {\r\n\treturn sglV4C(v[0], v[1], z, w);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 3-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV3(v) {\r\n\treturn new Array(3);\r\n}\r\n\r\nfunction sglV3V(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n\r\nfunction sglV3S(s) {\r\n\treturn [ s, s, s ];\r\n}\r\n\r\nfunction sglV3C(x, y, z) {\r\n\treturn [ x, y, z ];\r\n}\r\n\r\nfunction sglZeroV3() {\r\n\treturn sglV3S(0.0);\r\n}\r\n\r\nfunction sglOneV3() {\r\n\treturn sglV3S(1.0);\r\n}\r\n\r\nfunction sglV3() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV3V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV3S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 3:\r\n\t\t\treturn sglV3V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV3();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV3(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n\r\nfunction sglNegV3(v) {\r\n\treturn sglV3C(-v[0], -v[1], -v[2]);\r\n}\r\n\r\nfunction sglAddV3(u, v) {\r\n\treturn sglV3C(u[0]+v[0], u[1]+v[1], u[2]+v[2]);\r\n}\r\n\r\nfunction sglAddV3S(v, s) {\r\n\treturn sglV3C(v[0]+s, v[1]+s, v[2]+s);\r\n}\r\n\r\nfunction sglAddSV3(s, v) {\r\n\treturn sglAddV3S(v, s)\r\n}\r\n\r\nfunction sglSubV3(u, v) {\r\n\treturn sglV3C(u[0]-v[0], u[1]-v[1], u[2]-v[2]);\r\n}\r\n\r\nfunction sglSubV3S(v, s) {\r\n\treturn sglV3C(v[0]-s, v[1]-s, v[2]-s);\r\n}\r\n\r\nfunction sglSubSV3(v, s) {\r\n\treturn sglV3C(s-v[0], s-v[1], s-v[2]);\r\n}\r\n\r\nfunction sglMulV3(u, v) {\r\n\treturn sglV3C(u[0]*v[0], u[1]*v[1], u[2]*v[2]);\r\n}\r\n\r\nfunction sglMulV3S(v, s) {\r\n\treturn sglV3C(v[0]*s, v[1]*s, v[2]*s);\r\n}\r\n\r\nfunction sglMulSV3(s, v) {\r\n\treturn sglMulV3S(v, s);\r\n}\r\n\r\nfunction sglDivV3(u, v) {\r\n\treturn sglV3C(u[0]/v[0], u[1]/v[1], u[2]/v[2]);\r\n}\r\n\r\nfunction sglDivV3S(v, s) {\r\n\treturn sglV3C(v[0]/s, v[1]/s, v[2]/s);\r\n}\r\n\r\nfunction sglDivSV3(s, v) {\r\n\treturn sglV3C(s/v[0], s/v[1], s/v[2]);\r\n}\r\n\r\nfunction sglRcpV3(v) {\r\n\treturn sglDivSV3(1.0, v);\r\n}\r\n\r\nfunction sglDotV3(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1] + u[2]*v[2]);\r\n}\r\n\r\nfunction sglCrossV3(u, v) {\r\n\treturn sglV3C(u[1]*v[2] - u[2]*v[1], u[2]*v[0] - u[0]*v[2], u[0]*v[1] - u[1]*v[0]);\r\n}\r\n\r\nfunction sglSqLengthV3(v) {\r\n\treturn sglDotV3(v, v);\r\n}\r\n\r\nfunction sglLengthV3(v) {\r\n\treturn sglSqrt(sglSqLengthV3(v));\r\n}\r\n\r\nfunction sglNormalizedV3(v) {\r\n\tvar f = 1.0 / sglLengthV3(v);\r\n\treturn sglMulV3S(v, f);\r\n}\r\n\r\nfunction sglSelfNegV3(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\tv[2] = -v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV3(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\tu[2] += v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV3S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV3(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV3(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\tu[2] -= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV3S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\tv[2] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV3(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\tv[2] = s - v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV3(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\tu[2] *= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV3S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV3(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV3(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\tu[2] /= v[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV3S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\tu[2] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV3(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\tv[2] = s / v[2];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV3(v) {\r\n\treturn sglSelfDivSV3(1.0, v);\r\n}\r\n\r\nfunction sglSelfCrossV3(u, v) {\r\n\tvar t = sglV3C(u[1]*v[2] - u[2]*v[1], u[2]*v[0] - u[0]*v[2], u[0]*v[1] - u[1]*v[0]);\r\n\tu[0] = t[0];\r\n\tu[1] = t[1];\r\n\tu[2] = t[2];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfNormalizeV3(v) {\r\n\tvar f = 1.0 / sglLengthV3(v);\r\n\treturn sglSelfMulV3S(v, f);\r\n}\r\n\r\nfunction sglMinV3(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] < v[2]) ? (u[2]) : (v[2]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV3(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] > v[2]) ? (u[2]) : (v[2]))\r\n\t];\r\n}\r\n\r\nfunction sglV3toV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV3toV4(v, w) {\r\n\treturn sglV4C(v[0], v[1], v[2], w);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 4-dimensional vector\r\n/***********************************************************************/\r\nfunction sglUndefV4(v) {\r\n\treturn new Array(4);\r\n}\r\n\r\nfunction sglV4V(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglV4S(s) {\r\n\treturn [ s, s, s, s ];\r\n}\r\n\r\nfunction sglV4C(x, y, z, w) {\r\n\treturn [ x, y, z, w ];\r\n}\r\n\r\nfunction sglZeroV4() {\r\n\treturn sglV4S(0.0);\r\n}\r\n\r\nfunction sglOneV4() {\r\n\treturn sglV4S(1.0);\r\n}\r\n\r\nfunction sglV4() {\r\n\tvar n = arguments.length;\r\n\tvar s;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\treturn sglV4V(arguments[0]);\r\n\t\t\t}\r\n\t\t\treturn sglV4S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 4:\r\n\t\t\treturn sglV4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglZeroV4();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupV4(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglNegV4(v) {\r\n\treturn sglV4C(-v[0], -v[1], -v[2], -v[3]);\r\n}\r\n\r\nfunction sglAddV4(u, v) {\r\n\treturn sglV4C(u[0]+v[0], u[1]+v[1], u[2]+v[2], u[3]+v[3]);\r\n}\r\n\r\nfunction sglAddV4S(v, s) {\r\n\treturn sglV4C(v[0]+s, v[1]+s, v[2]+s, v[3]+s);\r\n}\r\n\r\nfunction sglAddSV4(s, v) {\r\n\treturn sglAddV4S(v, s)\r\n}\r\n\r\nfunction sglSubV4(u, v) {\r\n\treturn sglV4C(u[0]-v[0], u[1]-v[1], u[2]-v[2], u[3]-v[3]);\r\n}\r\n\r\nfunction sglSubV4S(v, s) {\r\n\treturn sglV4C(v[0]-s, v[1]-s, v[2]-s, v[3]-s);\r\n}\r\n\r\nfunction sglSubSV4(v, s) {\r\n\treturn sglV4C(s-v[0], s-v[1], s-v[2], s-v[3]);\r\n}\r\n\r\nfunction sglMulV4(u, v) {\r\n\treturn sglV4C(u[0]*v[0], u[1]*v[1], u[2]*v[2], u[3]*v[3]);\r\n}\r\n\r\nfunction sglMulV4S(v, s) {\r\n\treturn sglV4C(v[0]*s, v[1]*s, v[2]*s, v[3]*s);\r\n}\r\n\r\nfunction sglMulSV4(s, v) {\r\n\treturn sglMulV4S(v, s);\r\n}\r\n\r\nfunction sglDivV4(u, v) {\r\n\treturn sglV4C(u[0]/v[0], u[1]/v[1], u[2]/v[2], u[3]/v[3]);\r\n}\r\n\r\nfunction sglDivV4S(v, s) {\r\n\treturn sglV4C(v[0]/s, v[1]/s, v[2]/s, v[3]/s);\r\n}\r\n\r\nfunction sglDivSV4(s, v) {\r\n\treturn sglV4C(s/v[0], s/v[1], s/v[2], s/v[3]);\r\n}\r\n\r\nfunction sglRcpV4(v) {\r\n\treturn sglDivSV4(1.0, v);\r\n}\r\n\r\nfunction sglDotV4(u, v) {\r\n\treturn (u[0]*v[0] + u[1]*v[1] + u[2]*v[2] + u[3]*v[3]);\r\n}\r\n\r\nfunction sglSqLengthV4(v) {\r\n\treturn sglDotV4(v, v);\r\n}\r\n\r\nfunction sglLengthV4(v) {\r\n\treturn sglSqrt(sglSqLengthV4(v));\r\n}\r\n\r\nfunction sglNormalizedV4(v) {\r\n\tvar f = 1.0 / sglLengthV4(v);\r\n\treturn sglMulV4S(v, f);\r\n}\r\n\r\nfunction sglProjectV4(v) {\r\n\tvar f = 1.0 / v[3];\r\n\treturn sglV4C(v[0]*f, v[1]*f, v[2]*f, 1.0);\r\n}\r\n\r\nfunction sglSelfNegV4(v) {\r\n\tv[0] = -v[0];\r\n\tv[1] = -v[1];\r\n\tv[2] = -v[2];\r\n\tv[3] = -v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddV4(u, v) {\r\n\tu[0] += v[0];\r\n\tu[1] += v[1];\r\n\tu[2] += v[2];\r\n\tu[3] += v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfAddV4S(v, s) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\tv[3] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfAddSV4(s, v) {\r\n\tv[0] += s;\r\n\tv[1] += s;\r\n\tv[2] += s;\r\n\tv[3] += s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubV4(u, v) {\r\n\tu[0] -= v[0];\r\n\tu[1] -= v[1];\r\n\tu[2] -= v[2];\r\n\tu[3] -= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfSubV4S(v, s) {\r\n\tv[0] -= s;\r\n\tv[1] -= s;\r\n\tv[2] -= s;\r\n\tv[3] -= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfSubSV4(v, s) {\r\n\tv[0] = s - v[0];\r\n\tv[1] = s - v[1];\r\n\tv[2] = s - v[2];\r\n\tv[3] = s - v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulV4(u, v) {\r\n\tu[0] *= v[0];\r\n\tu[1] *= v[1];\r\n\tu[2] *= v[2];\r\n\tu[3] *= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfMulV4S(v, s) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\tv[3] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfMulSV4(s, v) {\r\n\tv[0] *= s;\r\n\tv[1] *= s;\r\n\tv[2] *= s;\r\n\tv[3] *= s;\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfDivV4(u, v) {\r\n\tu[0] /= v[0];\r\n\tu[1] /= v[1];\r\n\tu[2] /= v[2];\r\n\tu[3] /= v[3];\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivV4S(v, s) {\r\n\tu[0] /= s;\r\n\tu[1] /= s;\r\n\tu[2] /= s;\r\n\tu[3] /= s;\r\n\treturn u;\r\n}\r\n\r\nfunction sglSelfDivSV4(s, v) {\r\n\tv[0] = s / v[0];\r\n\tv[1] = s / v[1];\r\n\tv[2] = s / v[2];\r\n\tv[3] = s / v[3];\r\n\treturn v;\r\n}\r\n\r\nfunction sglSelfRcpV4(v) {\r\n\treturn sglSelfDivSV4(1.0, v);\r\n}\r\n\r\nfunction sglSelfNormalizeV4(v) {\r\n\tvar f = 1.0 / sglLengthV4(v);\r\n\treturn sglSelfMulV4S(v, f);\r\n}\r\n\r\nfunction sglSelfProjectV4(v) {\r\n\tvar f = 1.0 / v[3];\r\n\tv[0] *= f;\r\n\tv[1] *= f;\r\n\tv[2] *= f;\r\n\tv[3]  = 1.0;\r\n\treturn v;\r\n}\r\n\r\nfunction sglMinV4(u, v) {\r\n\treturn [\r\n\t\t((u[0] < v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] < v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] < v[2]) ? (u[2]) : (v[2])),\r\n\t\t((u[3] < v[3]) ? (u[3]) : (v[3]))\r\n\t];\r\n}\r\n\r\nfunction sglMaxV4(u, v) {\r\n\treturn [\r\n\t\t((u[0] > v[0]) ? (u[0]) : (v[0])),\r\n\t\t((u[1] > v[1]) ? (u[1]) : (v[1])),\r\n\t\t((u[2] > v[2]) ? (u[2]) : (v[2])),\r\n\t\t((u[3] > v[3]) ? (u[3]) : (v[3]))\r\n\t];\r\n}\r\n\r\nfunction sglV4toV2(v) {\r\n\treturn v.slice(0, 2);\r\n}\r\n\r\nfunction sglV4toV3(v) {\r\n\treturn v.slice(0, 3);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// 4x4 matrix\r\n/***********************************************************************/\r\nfunction sglUndefM4() {\r\n\treturn new Array(16);\r\n}\r\n\r\nfunction sglM4V(v) {\r\n\treturn v.slice(0, 16);\r\n}\r\n\r\nfunction sglM4S(s) {\r\n\tvar m = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tm[i] = s;\r\n\t}\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4V(d) {\r\n\tvar m = sglM4S(0.0);\r\n\tm[ 0] = d[0];\r\n\tm[ 5] = d[1];\r\n\tm[10] = d[2];\r\n\tm[15] = d[3];\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4S(s) {\r\n\tvar m = sglM4S(0.0);\r\n\tm[ 0] = s;\r\n\tm[ 5] = s;\r\n\tm[10] = s;\r\n\tm[15] = s;\r\n\treturn m;\r\n}\r\n\r\nfunction sglDiagM4C(m00, m11, m22, m33) {\r\n\treturn sglDiagM4V(arguments);\r\n}\r\n\r\nfunction sglZeroM4() {\r\n\treturn sglM4S(0.0);\r\n}\r\n\r\nfunction sglOneM4() {\r\n\treturn sglM4S(1.0);\r\n}\r\n\r\nfunction sglIdentityM4() {\r\n\treturn sglDiagM4S(1.0);\r\n}\r\n\r\nfunction sglM4() {\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tswitch (arguments[0].length) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\treturn sglDiagM4S(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\treturn sglDiagM4V(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 16:\r\n\t\t\t\t\t\treturn sglM4V(arguments[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn sglIdentityM4();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn sglM4S(arguments[0]);\r\n\t\tbreak;\r\n\r\n\t\tcase 4:\r\n\t\t\treturn sglDiagM4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tcase 16:\r\n\t\t\treturn sglM4V(arguments);\r\n\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treturn sglIdentityM4();\r\n\t\tbreak;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglDupM4(m) {\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = m[ 0];\r\n\tr[ 1] = m[ 1];\r\n\tr[ 2] = m[ 2];\r\n\tr[ 3] = m[ 3];\r\n\r\n\tr[ 4] = m[ 4];\r\n\tr[ 5] = m[ 5];\r\n\tr[ 6] = m[ 6];\r\n\tr[ 7] = m[ 7];\r\n\r\n\tr[ 8] = m[ 8];\r\n\tr[ 9] = m[ 9];\r\n\tr[10] = m[10];\r\n\tr[11] = m[11];\r\n\r\n\tr[12] = m[12];\r\n\tr[13] = m[13];\r\n\tr[14] = m[14];\r\n\tr[15] = m[15];\r\n\r\n\treturn r;\r\n\r\n\t//return m.slice(0, 16);\r\n\t//return m.slice();\r\n}\r\n\r\nfunction sglGetElemM4(m, row, col) {\r\n\treturn m[row+col*4];\r\n}\r\n\r\nfunction sglSetElemM4(m, row, col, value) {\r\n\tm[row+col*4] = value;\r\n}\r\n\r\nfunction sglGetRowM4(m, r) {\r\n\treturn sglV4C(m[r+0], m[r+4], m[r+8], m[r+12]);\r\n}\r\n\r\nfunction sglSetRowM4V(m, r, v) {\r\n\tm[r+ 0] = v[0];\r\n\tm[r+ 4] = v[1];\r\n\tm[r+ 8] = v[2];\r\n\tm[r+12] = v[3];\r\n}\r\n\r\nfunction sglSetRowM4S(m, r, s) {\r\n\tm[r+ 0] = s;\r\n\tm[r+ 4] = s;\r\n\tm[r+ 8] = s;\r\n\tm[r+12] = s;\r\n}\r\n\r\nfunction sglSetRowM4C(m, r, x, y, z, w) {\r\n\tm[r+ 0] = x;\r\n\tm[r+ 4] = y;\r\n\tm[r+ 8] = z;\r\n\tm[r+12] = w;\r\n}\r\n\r\nfunction sglGetColM4(m, c) {\r\n\tvar i = c * 4;\r\n\treturn sglV4C(m[i+0], m[i+1], m[i+2], m[i+3]);\r\n}\r\n\r\nfunction sglSetColM4V(m, c, v) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = v[0];\r\n\tm[i+1] = v[1];\r\n\tm[i+2] = v[2];\r\n\tm[i+3] = v[3];\r\n}\r\n\r\nfunction sglSetColM4S(m, c, s) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = s;\r\n\tm[i+1] = s;\r\n\tm[i+2] = s;\r\n\tm[i+3] = s;\r\n}\r\n\r\nfunction sglSetColM4C(m, c, x, y, z, w) {\r\n\tvar i = c * 4;\r\n\tm[i+0] = x;\r\n\tm[i+1] = y;\r\n\tm[i+2] = z;\r\n\tm[i+3] = w;\r\n}\r\n\r\nfunction sglM4toM3(m) {\r\n\treturn [\r\n\t\tm[ 0], m[ 1], m[ 2],\r\n\t\tm[ 4], m[ 5], m[ 6],\r\n\t\tm[ 8], m[ 9], m[10]\r\n\t];\r\n}\r\n\r\nfunction sglIsIdentityM4(m) {\r\n\tvar i = 0;\r\n\tvar j = 0;\r\n\tvar s = 0.0;\r\n\tfor (i=0; i<4; ++i) {\r\n\t\tfor (j=0; j<4; ++j) {\r\n\t\t\ts = m[i+j*4];\r\n\t\t\tif ((i == j)) {\r\n\t\t\t\tif (s != 1.0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (s != 0.0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction sglNegM4(m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = -m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] + b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddM4S(m, s)\r\n{\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] + s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglAddSM4(s, m) {\r\n\treturn sglAddM4S(m, s);\r\n}\r\n\r\nfunction sglSubM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] - b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglSubM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] - s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglSubSM4(s, m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = s - m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglMulM4(a, b) {\r\n\tvar a0  = a[ 0], a1  = a[ 1],  a2 = a[ 2], a3  = a[ 3],\r\n\t    a4  = a[ 4], a5  = a[ 5],  a6 = a[ 6], a7  = a[ 7],\r\n\t    a8  = a[ 8], a9  = a[ 9], a10 = a[10], a11 = a[11],\r\n\t    a12 = a[12], a13 = a[13], a14 = a[14], a15 = a[15],\r\n\r\n\t    b0  = b[ 0], b1  = b[ 1], b2  = b[ 2], b3  = b[ 3],\r\n\t    b4  = b[ 4], b5  = b[ 5], b6  = b[ 6], b7  = b[ 7],\r\n\t    b8  = b[ 8], b9  = b[ 9], b10 = b[10], b11 = b[11],\r\n\t    b12 = b[12], b13 = b[13], b14 = b[14], b15 = b[15];\r\n\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = a0*b0 + a4*b1 + a8*b2  + a12*b3;\r\n\tr[ 1] = a1*b0 + a5*b1 + a9*b2  + a13*b3;\r\n\tr[ 2] = a2*b0 + a6*b1 + a10*b2 + a14*b3;\r\n\tr[ 3] = a3*b0 + a7*b1 + a11*b2 + a15*b3;\r\n\r\n\tr[ 4] = a0*b4 + a4*b5 + a8*b6  + a12*b7;\r\n\tr[ 5] = a1*b4 + a5*b5 + a9*b6  + a13*b7;\r\n\tr[ 6] = a2*b4 + a6*b5 + a10*b6 + a14*b7;\r\n\tr[ 7] = a3*b4 + a7*b5 + a11*b6 + a15*b7;\r\n\r\n\tr[ 8] = a0*b8 + a4*b9 + a8*b10  + a12*b11;\r\n\tr[ 9] = a1*b8 + a5*b9 + a9*b10  + a13*b11;\r\n\tr[10] = a2*b8 + a6*b9 + a10*b10 + a14*b11;\r\n\tr[11] = a3*b8 + a7*b9 + a11*b10 + a15*b11;\r\n\r\n\tr[12] = a0*b12 + a4*b13 + a8*b14  + a12*b15;\r\n\tr[13] = a1*b12 + a5*b13 + a9*b14  + a13*b15;\r\n\tr[14] = a2*b12 + a6*b13 + a10*b14 + a14*b15;\r\n\tr[15] = a3*b12 + a7*b13 + a11*b14 + a15*b15;\r\n\r\n\t/*\r\n\tr[ 0] = a[ 0]*b[ 0] + a[ 4]*b[ 1] + a[ 8]*b[ 2] + a[12]*b[ 3];\r\n\tr[ 1] = a[ 1]*b[ 0] + a[ 5]*b[ 1] + a[ 9]*b[ 2] + a[13]*b[ 3];\r\n\tr[ 2] = a[ 2]*b[ 0] + a[ 6]*b[ 1] + a[10]*b[ 2] + a[14]*b[ 3];\r\n\tr[ 3] = a[ 3]*b[ 0] + a[ 7]*b[ 1] + a[11]*b[ 2] + a[15]*b[ 3];\r\n\r\n\tr[ 4] = a[ 0]*b[ 4] + a[ 4]*b[ 5] + a[ 8]*b[ 6] + a[12]*b[ 7];\r\n\tr[ 5] = a[ 1]*b[ 4] + a[ 5]*b[ 5] + a[ 9]*b[ 6] + a[13]*b[ 7];\r\n\tr[ 6] = a[ 2]*b[ 4] + a[ 6]*b[ 5] + a[10]*b[ 6] + a[14]*b[ 7];\r\n\tr[ 7] = a[ 3]*b[ 4] + a[ 7]*b[ 5] + a[11]*b[ 6] + a[15]*b[ 7];\r\n\r\n\tr[ 8] = a[ 0]*b[ 8] + a[ 4]*b[ 9] + a[ 8]*b[10] + a[12]*b[11];\r\n\tr[ 9] = a[ 1]*b[ 8] + a[ 5]*b[ 9] + a[ 9]*b[10] + a[13]*b[11];\r\n\tr[10] = a[ 2]*b[ 8] + a[ 6]*b[ 9] + a[10]*b[10] + a[14]*b[11];\r\n\tr[11] = a[ 3]*b[ 8] + a[ 7]*b[ 9] + a[11]*b[10] + a[15]*b[11];\r\n\r\n\tr[12] = a[ 0]*b[12] + a[ 4]*b[13] + a[ 8]*b[14] + a[12]*b[15];\r\n\tr[13] = a[ 1]*b[12] + a[ 5]*b[13] + a[ 9]*b[14] + a[13]*b[15];\r\n\tr[14] = a[ 2]*b[12] + a[ 6]*b[13] + a[10]*b[14] + a[14]*b[15];\r\n\tr[15] = a[ 3]*b[12] + a[ 7]*b[13] + a[11]*b[14] + a[15]*b[15];\r\n\t*/\r\n\r\n\treturn r;\r\n\r\n\t/*\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = a[ 0]*b[ 0] + a[ 4]*b[ 1] + a[ 8]*b[ 2] + a[12]*b[ 3];\r\n\tr[ 1] = a[ 1]*b[ 0] + a[ 5]*b[ 1] + a[ 9]*b[ 2] + a[13]*b[ 3];\r\n\tr[ 2] = a[ 2]*b[ 0] + a[ 6]*b[ 1] + a[10]*b[ 2] + a[14]*b[ 3];\r\n\tr[ 3] = a[ 3]*b[ 0] + a[ 7]*b[ 1] + a[11]*b[ 2] + a[15]*b[ 3];\r\n\r\n\tr[ 4] = a[ 0]*b[ 4] + a[ 4]*b[ 5] + a[ 8]*b[ 6] + a[12]*b[ 7];\r\n\tr[ 5] = a[ 1]*b[ 4] + a[ 5]*b[ 5] + a[ 9]*b[ 6] + a[13]*b[ 7];\r\n\tr[ 6] = a[ 2]*b[ 4] + a[ 6]*b[ 5] + a[10]*b[ 6] + a[14]*b[ 7];\r\n\tr[ 7] = a[ 3]*b[ 4] + a[ 7]*b[ 5] + a[11]*b[ 6] + a[15]*b[ 7];\r\n\r\n\tr[ 8] = a[ 0]*b[ 8] + a[ 4]*b[ 9] + a[ 8]*b[10] + a[12]*b[11];\r\n\tr[ 9] = a[ 1]*b[ 8] + a[ 5]*b[ 9] + a[ 9]*b[10] + a[13]*b[11];\r\n\tr[10] = a[ 2]*b[ 8] + a[ 6]*b[ 9] + a[10]*b[10] + a[14]*b[11];\r\n\tr[11] = a[ 3]*b[ 8] + a[ 7]*b[ 9] + a[11]*b[10] + a[15]*b[11];\r\n\r\n\tr[12] = a[ 0]*b[12] + a[ 4]*b[13] + a[ 8]*b[14] + a[12]*b[15];\r\n\tr[13] = a[ 1]*b[12] + a[ 5]*b[13] + a[ 9]*b[14] + a[13]*b[15];\r\n\tr[14] = a[ 2]*b[12] + a[ 6]*b[13] + a[10]*b[14] + a[14]*b[15];\r\n\tr[15] = a[ 3]*b[12] + a[ 7]*b[13] + a[11]*b[14] + a[15]*b[15];\r\n\r\n\treturn r;\r\n\t*/\r\n}\r\n\r\nfunction sglMulM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] * s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglMulSM4(s, m) {\r\n\treturn sglMulM4S(m, s);\r\n}\r\n\r\nfunction sglMulM4V3(m, v, w) {\r\n\treturn [\r\n\t\tm[ 0] * v[0] + m[ 4] * v[1] + m[ 8] * v[2] + m[12] * w,\r\n\t\tm[ 1] * v[0] + m[ 5] * v[1] + m[ 9] * v[2] + m[13] * w,\r\n\t\tm[ 2] * v[0] + m[ 6] * v[1] + m[10] * v[2] + m[14] * w /* ,\r\n\t\tm[ 3] * v[0] + m[ 7] * v[1] + m[11] * v[2] + m[15] * w*/\r\n\t];\r\n}\r\n\r\nfunction sglMulM4V4(m, v) {\r\n\treturn [\r\n\t\tm[ 0] * v[0] + m[ 4] * v[1] + m[ 8] * v[2] + m[12] * v[3],\r\n\t\tm[ 1] * v[0] + m[ 5] * v[1] + m[ 9] * v[2] + m[13] * v[3],\r\n\t\tm[ 2] * v[0] + m[ 6] * v[1] + m[10] * v[2] + m[14] * v[3],\r\n\t\tm[ 3] * v[0] + m[ 7] * v[1] + m[11] * v[2] + m[15] * v[3]\r\n\t];\r\n}\r\n\r\nfunction sglDivM4S(m, s) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = m[i] / s;\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglDivSM4(s, m) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = s / m[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglRcpM4(m) {\r\n\treturn sglDivSM4(1.0, m);\r\n}\r\n\r\nfunction sglCompMulM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] * b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglCompDivM4(a, b) {\r\n\tvar r = sglUndefM4();\r\n\tfor (var i=0; i<16; ++i) {\r\n\t\tr[i] = a[i] / b[i];\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nfunction sglTransposeM4(m) {\r\n\tvar r = sglUndefM4();\r\n\r\n\tr[ 0] = m[ 0];\r\n\tr[ 1] = m[ 4];\r\n\tr[ 2] = m[ 8];\r\n\tr[ 3] = m[12];\r\n\t\r\n\tr[ 4] = m[ 1];\r\n\tr[ 5] = m[ 5];\r\n\tr[ 6] = m[ 9];\r\n\tr[ 7] = m[13];\r\n\t\r\n\tr[ 8] = m[ 2];\r\n\tr[ 9] = m[ 6];\r\n\tr[10] = m[10];\r\n\tr[11] = m[14];\r\n\t\r\n\tr[12] = m[ 3];\r\n\tr[13] = m[ 7];\r\n\tr[14] = m[11];\r\n\tr[15] = m[15];\r\n\t\r\n\treturn r;\r\n}\r\n\r\nfunction sglDeterminantM4(m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15]\r\n\r\n\treturn (\r\n\t\tm12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t\tm8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t\tm12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t\tm12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t\tm4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t\tm8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15\r\n\t);\r\n}\r\n\r\nfunction sglInverseM4(m) {\r\n\tvar m0  = m[ 0], m1  = m[ 1], m2  = m[ 2], m3  = m[ 3],\r\n\t    m4  = m[ 4], m5  = m[ 5], m6  = m[ 6], m7  = m[ 7],\r\n\t    m8  = m[ 8], m9  = m[ 9], m10 = m[10], m11 = m[11],\r\n\t    m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15]\r\n\r\n\tvar t = sglUndefM4();\r\n\r\n\tt[ 0] = (m9*m14*m7-m13*m10*m7+m13*m6*m11-m5*m14*m11-m9*m6*m15+m5*m10*m15);\r\n\tt[ 1] = (m13*m10*m3-m9*m14*m3-m13*m2*m11+m1*m14*m11+m9*m2*m15-m1*m10*m15);\r\n\tt[ 2] = (m5*m14*m3-m13*m6*m3+m13*m2*m7-m1*m14*m7-m5*m2*m15+m1*m6*m15);\r\n\tt[ 3] = (m9*m6*m3-m5*m10*m3-m9*m2*m7+m1*m10*m7+m5*m2*m11-m1*m6*m11);\r\n\r\n\tt[ 4] = (m12*m10*m7-m8*m14*m7-m12*m6*m11+m4*m14*m11+m8*m6*m15-m4*m10*m15);\r\n\tt[ 5] = (m8*m14*m3-m12*m10*m3+m12*m2*m11-m0*m14*m11-m8*m2*m15+m0*m10*m15);\r\n\tt[ 6] = (m12*m6*m3-m4*m14*m3-m12*m2*m7+m0*m14*m7+m4*m2*m15-m0*m6*m15);\r\n\tt[ 7] = (m4*m10*m3-m8*m6*m3+m8*m2*m7-m0*m10*m7-m4*m2*m11+m0*m6*m11);\r\n\r\n\tt[ 8] = (m8*m13*m7-m12*m9*m7+m12*m5*m11-m4*m13*m11-m8*m5*m15+m4*m9*m15);\r\n\tt[ 9] = (m12*m9*m3-m8*m13*m3-m12*m1*m11+m0*m13*m11+m8*m1*m15-m0*m9*m15);\r\n\tt[10] = (m4*m13*m3-m12*m5*m3+m12*m1*m7-m0*m13*m7-m4*m1*m15+m0*m5*m15);\r\n\tt[11] = (m8*m5*m3-m4*m9*m3-m8*m1*m7+m0*m9*m7+m4*m1*m11-m0*m5*m11);\r\n\r\n\tt[12] = (m12*m9*m6-m8*m13*m6-m12*m5*m10+m4*m13*m10+m8*m5*m14-m4*m9*m14);\r\n\tt[13] = (m8*m13*m2-m12*m9*m2+m12*m1*m10-m0*m13*m10-m8*m1*m14+m0*m9*m14);\r\n\tt[14] = (m12*m5*m2-m4*m13*m2-m12*m1*m6+m0*m13*m6+m4*m1*m14-m0*m5*m14);\r\n\tt[15] = (m4*m9*m2-m8*m5*m2+m8*m1*m6-m0*m9*m6-m4*m1*m10+m0*m5*m10);\r\n\r\n\tvar s = 1.0 / (\r\n\t\tm12 * m9 * m6 * m3 - m8 * m13 * m6 * m3 - m12 * m5 * m10 * m3 + m4 * m13 * m10 * m3 +\r\n\t\tm8 * m5 * m14 * m3 - m4 * m9 * m14 * m3 - m12 * m9 * m2 * m7 + m8 * m13 * m2 * m7 +\r\n\t\tm12 * m1 * m10 * m7 - m0 * m13 * m10 * m7 - m8 * m1 * m14 * m7 + m0 * m9 * m14 * m7 +\r\n\t\tm12 * m5 * m2 * m11 - m4 * m13 * m2 * m11 - m12 * m1 * m6 * m11 + m0 * m13 * m6 * m11 +\r\n\t\tm4 * m1 * m14 * m11 - m0 * m5 * m14 * m11 - m8 * m5 * m2 * m15 + m4 * m9 * m2 * m15 +\r\n\t\tm8 * m1 * m6 * m15 - m0 * m9 * m6 * m15 - m4 * m1 * m10 * m15 + m0 * m5 * m10 * m15\r\n\t);\r\n\r\n\tfor (var i=0; i<16; ++i) t[i] *= s;\r\n\r\n\treturn t;\r\n}\r\n\r\nfunction sglTraceM4(m) {\r\n\treturn (m[0] + m[5] + m[10] + m[15]);\r\n}\r\n\r\nfunction sglTranslationM4V(v) {\r\n\tvar m = sglIdentityM4();\r\n\tm[12] = v[0];\r\n\tm[13] = v[1];\r\n\tm[14] = v[2];\r\n\treturn m;\r\n}\r\n\r\nfunction sglTranslationM4C(x, y, z) {\r\n\treturn sglTranslationM4V([x, y, z]);\r\n}\r\n\r\nfunction sglTranslationM4S(s) {\r\n\treturn sglTranslationM4C(s, s, s);\r\n}\r\n\r\nfunction sglRotationAngleAxisM4V(angleRad, axis) {\r\n\tvar ax = sglNormalizedV3(axis);\r\n\tvar s  = sglSin(angleRad);\r\n\tvar c  = sglCos(angleRad);\r\n\tvar q   = 1.0 - c;\r\n\r\n\tvar x = ax[0];\r\n\tvar y = ax[1];\r\n\tvar z = ax[2];\r\n\r\n\tvar xx, yy, zz, xy, yz, zx, xs, ys, zs;\r\n\r\n\txx = x * x;\r\n\tyy = y * y;\r\n\tzz = z * z;\r\n\txy = x * y;\r\n\tyz = y * z;\r\n\tzx = z * x;\r\n\txs = x * s;\r\n\tys = y * s;\r\n\tzs = z * s;\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] = (q * xx) + c;\r\n\tm[ 1] = (q * xy) + zs;\r\n\tm[ 2] = (q * zx) - ys;\r\n\tm[ 3] = 0.0;\r\n\r\n\tm[ 4] = (q * xy) - zs;\r\n\tm[ 5] = (q * yy) + c;\r\n\tm[ 6] = (q * yz) + xs;\r\n\tm[ 7] = 0.0;\r\n\r\n\tm[ 8] = (q * zx) + ys;\r\n\tm[ 9] = (q * yz) - xs;\r\n\tm[10] = (q * zz) + c;\r\n\tm[11] = 0.0;\r\n\r\n\tm[12] = 0.0;\r\n\tm[13] = 0.0;\r\n\tm[14] = 0.0;\r\n\tm[15] = 1.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglRotationAngleAxisM4C(angleRad, ax, ay, az) {\r\n\treturn sglRotationAngleAxisM4V(angleRad, [ax, ay, az]);\r\n}\r\n\r\nfunction sglScalingM4V(v) {\r\n\tvar m = sglIdentityM4();\r\n\tm[ 0] = v[0];\r\n\tm[ 5] = v[1];\r\n\tm[10] = v[2];\r\n\treturn m;\r\n}\r\n\r\nfunction sglScalingM4C(x, y, z) {\r\n\treturn sglScalingM4V([x, y, z]);\r\n}\r\n\r\nfunction sglScalingM4S(s) {\r\n\treturn sglScalingM4C(s, s, s);\r\n}\r\n\r\nfunction sglLookAtM4V(position, target, up) {\r\n\tvar v = sglNormalizedV3(sglSubV3(target, position));\r\n\tvar u = sglNormalizedV3(up);\r\n\tvar s = sglNormalizedV3(sglCrossV3(v, u));\r\n\r\n\tu = sglNormalizedV3(sglCrossV3(s, v));\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] =  s[0];\r\n\tm[ 1] =  u[0];\r\n\tm[ 2] = -v[0];\r\n\tm[ 3] =   0.0;\r\n\r\n\tm[ 4] =  s[1];\r\n\tm[ 5] =  u[1];\r\n\tm[ 6] = -v[1];\r\n\tm[ 7] =   0.0;\r\n\r\n\tm[ 8] =  s[2];\r\n\tm[ 9] =  u[2];\r\n\tm[10] = -v[2];\r\n\tm[11] =   0.0;\r\n\r\n\tm[12] =   0.0;\r\n\tm[13] =   0.0;\r\n\tm[14] =   0.0;\r\n\tm[15] =   1.0;\r\n\r\n\tm = sglMulM4(m, sglTranslationM4V(sglNegV3(position)));\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglLookAtM4C(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ) {\r\n\treturn sglLookAtM4V([positionX, positionY, positionZ], [targetX, targetY, targetZ], [upX, upY, upZ]);\r\n}\r\n\r\nfunction sglOrthoM4V(omin, omax) {\r\n\tvar sum   = sglAddV3(omax, omin);\r\n\tvar dif   = sglSubV3(omax, omin);\r\n\r\n\tvar m = sglUndefM4();\r\n\r\n\tm[ 0] =      2.0 / dif[0];\r\n\tm[ 1] =               0.0;\r\n\tm[ 2] =               0.0;\r\n\tm[ 3] =               0.0;\r\n\r\n\tm[ 4] =               0.0;\r\n\tm[ 5] =      2.0 / dif[1];\r\n\tm[ 6] =               0.0;\r\n\tm[ 7] =               0.0;\r\n\r\n\tm[ 8] =               0.0;\r\n\tm[ 9] =               0.0;\r\n\tm[10] =     -2.0 / dif[2];\r\n\tm[11] =                 0.0;\r\n\r\n\tm[12] =  -sum[0] / dif[0];\r\n\tm[13] =  -sum[1] / dif[1];\r\n\tm[14] =  -sum[2] / dif[2];\r\n\tm[15] =               1.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglOrthoM4C(left, right, bottom, top, zNear, zFar) {\r\n\treturn sglOrthoM4V([left, bottom, zNear], [right, top, zFar]);\r\n}\r\n\r\nfunction sglFrustumM4V(fmin, fmax) {\r\n\tvar sum   = sglAddV3(fmax, fmin);\r\n\tvar dif   = sglSubV3(fmax, fmin);\r\n\tvar t     = 2.0 * fmin[2];\r\n\r\n\tvar m = sglUndefM4();\r\n\t\r\n\tm[ 0] =            t / dif[0];\r\n\tm[ 1] =                   0.0;\r\n\tm[ 2] =                   0.0;\r\n\tm[ 3] =                   0.0;\r\n\r\n\tm[ 4] =                   0.0;\r\n\tm[ 5] =            t / dif[1];\r\n\tm[ 6] =                   0.0;\r\n\tm[ 7] =                   0.0;\r\n\r\n\tm[ 8] =       sum[0] / dif[0];\r\n\tm[ 9] =       sum[1] / dif[1];\r\n\tm[10] =      -sum[2] / dif[2];\r\n\tm[11] =                  -1.0;\r\n\r\n\tm[12] =                   0.0;\r\n\tm[13] =                   0.0;\r\n\tm[14] = -t * fmax[2] / dif[2];\r\n\tm[15] =                   0.0;\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglFrustumM4C(left, right, bottom, top, zNear, zFar) {\r\n\treturn sglFrustumM4V([left, bottom, zNear], [right, top, zFar]);\r\n}\r\n\r\nfunction sglPerspectiveM4(fovYRad, aspectRatio, zNear, zFar) {\r\n\tvar pmin = sglUndefV4();\r\n\tvar pmax = sglUndefV4();\r\n\r\n\tpmin[2] = zNear;\r\n\tpmax[2] = zFar;\r\n\r\n\tpmax[1] = pmin[2] * sglTan(fovYRad / 2.0);\r\n\tpmin[1] = -pmax[1];\r\n\r\n\tpmax[0] = pmax[1] * aspectRatio;\r\n\tpmin[0] = -pmax[0];\r\n\r\n\treturn sglFrustumM4V(pmin, pmax);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// quaternion\r\n/***********************************************************************/\r\nfunction sglUndefQuat(v) {\r\n\treturn new Array(4);\r\n}\r\n\r\nfunction sglQuatV(v) {\r\n\treturn v.slice(0, 4);\r\n}\r\n\r\nfunction sglIdentityQuat() {\r\n\treturn [ 0.0, 0.0, 0.0, 1.0 ];\r\n}\r\n\r\nfunction sglAngleAxisQuat(angleRad, axis) {\r\n\tvar halfAngle = angleRad / 2.0;\r\n\tvar fsin = sglSin(halfAngle);\r\n\treturn [\r\n\t\tfsin * axis[0],\r\n\t\tfsin * axis[1],\r\n\t\tfsin * axis[2],\r\n\t\tsglCos(halfAngle)\r\n\t];\r\n}\r\n\r\nfunction sglM4Quat(m) {\r\n\tvar trace = sglGetElemM4(m, 0, 0) + sglGetElemM4(m, 1, 1) + sglGetElemM4(m, 2, 2);\r\n\tvar root = null;\r\n\tvar q = sglUndefQuat();\r\n\r\n\tif (trace > 0.0) {\r\n\t\troot = sglSqrt(trace + 1.0);\r\n\t\tq[3] = root / 2.0;\r\n\t\troot = 0.5 / root;\r\n\t\tq[0] = (sglGetElemM4(m, 2, 1) - sglGetElemM4(m, 1, 2)) * root;\r\n\t\tq[1] = (sglGetElemM4(m, 0, 2) - sglGetElemM4(m, 2, 0)) * root;\r\n\t\tq[2] = (sglGetElemM4(m, 1, 0) - sglGetElemM4(m, 0, 1)) * root;\r\n\t}\r\n\telse {\r\n\t\tvar i = 0;\r\n\r\n\t\tif (sglGetElemM4(m, 1, 1) > sglGetElemM4(m, 0, 0)) i = 1;\r\n\t\tif (sglGetElemM4(m, 2, 2) > sglGetElemM4(m, i, i)) i = 2;\r\n\r\n\t\tvar j = (i + 1) % 3;\r\n\t\tvar k = (j + 1) % 3;\r\n\r\n\t\troot = sglSqrt(sglGetElemM4(m, i, i) - sglGetElemM4(m, j, j) - sglGetElemM4(m, k, k) + 1.0);\r\n\r\n\t\tq[i] = root / 2.0;\r\n\t\troot = 0.5 / root;\r\n\t\tq[3] = (sglGetElemM4(m, k, j) - sglGetElemM4(m, j, k)) * root;\r\n\t\tq[j] = (sglGetElemM4(m, j, i) + sglGetElemM4(m, i, j)) * root;\r\n\t\tq[k] = (sglGetElemM4(m, k, i) + sglGetElemM4(m, i, k)) * root;\r\n\t}\r\n\treturn q;\r\n}\r\n\r\nfunction sglGetQuatAngleAxis(q) {\r\n\tvar v = new Array(4);\r\n\r\n\tvar sqLen = sglSqLengthV4(q);\r\n\tvar angle = null;\r\n\r\n\tif (sqLen > 0.0) {\r\n\t\tvar invLen = 1.0 / sglSqrt(sqLen);\r\n\t\tv[0] = q[0] * invLen;\r\n\t\tv[1] = q[1] * invLen;\r\n\t\tv[2] = q[2] * invLen;\r\n\t\tv[3] = 2.0 * aglAcos(q[3]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tv[0] = 0.0;\r\n\t\tv[1] = 0.0;\r\n\t\tv[2] = 1.0;\r\n\t\tv[3] = 0.0;\r\n\t}\r\n\r\n\treturn v;\r\n}\r\n\r\nfunction sglGetQuatRotationM4(q) {\r\n\tvar tx  = 2.0 * q[0];\r\n\tvar ty  = 2.0 * q[1];\r\n\tvar tz  = 2.0 * q[2];\r\n\tvar twx = tx * q[3];\r\n\tvar twy = ty * q[3];\r\n\tvar twz = tz * q[3];\r\n\tvar txx = tx * q[0];\r\n\tvar txy = ty * q[0];\r\n\tvar txz = tz * q[0];\r\n\tvar tyy = ty * q[1];\r\n\tvar tyz = tz * q[1];\r\n\tvar tzz = tz * q[2];\r\n\r\n\tvar m = sglIdentityM4();\r\n\r\n\tsglSetElemM4(m, 0, 0, 1.0 - (tyy + tzz));\r\n\tsglSetElemM4(m, 0, 1, txy - twz);\r\n\tsglSetElemM4(m, 0, 2, txz + twy);\r\n\tsglSetElemM4(m, 1, 0, txy + twz);\r\n\tsglSetElemM4(m, 1, 1, 1.0 - (txx + tzz));\r\n\tsglSetElemM4(m, 1, 2, tyz - twx);\r\n\tsglSetElemM4(m, 2, 0, txz - twy);\r\n\tsglSetElemM4(m, 2, 1, tyz + twx);\r\n\tsglSetElemM4(m, 2, 2, 1.0 - (txx + tyy));\r\n\r\n\treturn m;\r\n}\r\n\r\nfunction sglNormalizedQuat(q) {\r\n\treturn sglNormalizedV4(q);\r\n}\r\n\r\nfunction sglMulQuat(q1, q2) {\r\n\tvar r = sglUndefQuat();\r\n\r\n\tr[0] = p[3] * q[0] + p[0] * q[3] + p[1] * q[2] - p[2] * q[1];\r\n\tr[1] = p[3] * q[1] + p[1] * q[3] + p[2] * q[0] - p[0] * q[2];\r\n\tr[2] = p[3] * q[2] + p[2] * q[3] + p[0] * q[1] - p[1] * q[0];\r\n\tr[3] = p[3] * q[3] - p[0] * q[0] - p[1] * q[1] - p[2] * q[2];\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglVec2\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec2.\r\n * @class 2-dimensional vector.\r\n */\r\nfunction SglVec2() {\r\n\tthis.v = new Array(2);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec2) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 2:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec2.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec2(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\r\n\tset : function(x, y) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec2(-(this.v[0]), -(this.v[1]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec2(sglAbs(this.v[0]), sglAbs(this.v[1]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec2(this.v[0] + v.v[0], this.v[1] + v.v[1]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec2(this.v[0] - v.v[0], this.v[1] - v.v[1]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec2(this.v[0] * v.v[0], this.v[1] * v.v[1]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec2(this.v[0] / v.v[0], this.v[1] / v.v[1]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec2(1.0 / this.v[0], 1.0 / this.v[1]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1]);\r\n\t},\r\n\r\n\tcross : function(v) {\r\n\t\treturn (this.v[0]*v.v[1] - this.v[1]*v.v[0]);\r\n\t},\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec2(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec2(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglVec3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec3.\r\n * @class 3-dimensional vector.\r\n */\r\nfunction SglVec3() {\r\n\tthis.v = new Array(3);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec3) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 3:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec3.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec3(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\tget z( ) { return this.v[2]; },\r\n\tset z(n) { this.v[2] = n;    },\r\n\r\n\tset : function(x, y, z) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\tthis.v[2] = z;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1], v[2]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\tthis.v[2] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec3(-(this.v[0]), -(this.v[1]), -(this.v[2]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec3(sglAbs(this.v[0]), sglAbs(this.v[1]), sglAbs(this.v[2]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\tif (m > this.v[2]) m = this.v[2];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\tif (m < this.v[2]) m = this.v[2];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec3(this.v[0] + v.v[0], this.v[1] + v.v[1], this.v[2] + v.v[2]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec3(this.v[0] - v.v[0], this.v[1] - v.v[1], this.v[2] - v.v[2]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec3(this.v[0] * v.v[0], this.v[1] * v.v[1], this.v[2] * v.v[2]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec3(this.v[0] / v.v[0], this.v[1] / v.v[1], this.v[2] / v.v[2]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec3(1.0 / this.v[0], 1.0 / this.v[1], 1.0 / this.v[2]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1] + this.v[2] * v.v[2]);\r\n\t},\r\n\r\n\tcross : function(v) {\r\n\t\treturn new SglVec3(this.v[1]*v.v[2] - this.v[2]*v.v[1], this.v[2]*v.v[0] - this.v[0]*v.v[2], this.v[0]*v.v[1] - this.v[1]*v.v[0]);\r\n\t},\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec3(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]), sglMin(this.v[2], v.v[2]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec3(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]), sglMax(this.v[2], v.v[2]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglVec4\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglVec3.\r\n * @class 4-dimensional vector.\r\n */\r\nfunction SglVec4() {\r\n\tthis.v = new Array(4);\r\n\tvar n = arguments.length;\r\n\tswitch (n) {\r\n\t\tcase 1:\r\n\t\t\tif (arguments[0] instanceof Array) {\r\n\t\t\t\tthis.setVec(arguments[0]);\r\n\t\t\t}\r\n\t\t\telse if (arguments[0] instanceof SglVec4) {\r\n\t\t\t\tthis.setVec(arguments[0].v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setScalar(arguments[0]);\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase 4:\r\n\t\t\tthis.setVec(arguments);\r\n\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.setZero();\r\n\t\tbreak;\r\n\t}\r\n}\r\n\r\nSglVec4.prototype = {\r\n\tclone : function() {\r\n\t\treturn new SglVec4(this);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tget x( ) { return this.v[0]; },\r\n\tset x(n) { this.v[0] = n;    },\r\n\tget y( ) { return this.v[1]; },\r\n\tset y(n) { this.v[1] = n;    },\r\n\tget z( ) { return this.v[2]; },\r\n\tset z(n) { this.v[2] = n;    },\r\n\tget w( ) { return this.v[3]; },\r\n\tset w(n) { this.v[3] = n;    },\r\n\r\n\tset : function(x, y, z, w) {\r\n\t\tthis.v[0] = x;\r\n\t\tthis.v[1] = y;\r\n\t\tthis.v[2] = z;\r\n\t\tthis.v[3] = w;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetVec : function(v) {\r\n\t\treturn this.set(v[0], v[1], v[2], v[3]);\r\n\t},\r\n\r\n\tsetScalar : function(s) {\r\n\t\treturn this.set(s, s, s, s);\r\n\t},\r\n\r\n\tsetZero : function() {\r\n\t\treturn this.setScalar(0.0);\r\n\t},\r\n\r\n\tsetOne : function() {\r\n\t\treturn this.setScalar(1.0);\r\n\t},\r\n\r\n\tat : function(i) {\r\n\t\treturn this.v[i];\r\n\t},\r\n\r\n\tget squaredLength() {\r\n\t\treturn this.dot(this);\r\n\t},\r\n\r\n\tget length() {\r\n\t\treturn sglSqrt(this.squaredLength);\r\n\t},\r\n\r\n\tnormalize : function() {\r\n\t\tvar f = this.length;\r\n\t\tif (f > 0.0) f = 1.0 / f;\r\n\t\tthis.v[0] *= f;\r\n\t\tthis.v[1] *= f;\r\n\t\tthis.v[2] *= f;\r\n\t\tthis.v[3] *= f;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget normalized() {\r\n\t\treturn this.clone().normalize();\r\n\t},\r\n\r\n\tget neg() {\r\n\t\treturn new SglVec4(-(this.v[0]), -(this.v[1]), -(this.v[2]), -(this.v[3]));\r\n\t},\r\n\r\n\tget abs() {\r\n\t\treturn new SglVec4(sglAbs(this.v[0]), sglAbs(this.v[1]), sglAbs(this.v[2]), sglAbs(this.v[3]));\r\n\t},\r\n\r\n\tget minComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m > this.v[1]) m = this.v[1];\r\n\t\tif (m > this.v[2]) m = this.v[2];\r\n\t\tif (m > this.v[3]) m = this.v[3];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget maxComp() {\r\n\t\tvar m = this.v[0];\r\n\t\tif (m < this.v[1]) m = this.v[1];\r\n\t\tif (m < this.v[2]) m = this.v[2];\r\n\t\tif (m < this.v[3]) m = this.v[3];\r\n\t\treturn m;\r\n\t},\r\n\r\n\tget argMin() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\tif (this.v[a] > this.v[3]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tget argMax() {\r\n\t\tvar a = 0;\r\n\t\tif (this.v[a] > this.v[1]) a = 1;\r\n\t\tif (this.v[a] > this.v[2]) a = 2;\r\n\t\tif (this.v[a] > this.v[3]) a = 2;\r\n\t\treturn a;\r\n\t},\r\n\r\n\tadd : function(v) {\r\n\t\treturn new SglVec4(this.v[0] + v.v[0], this.v[1] + v.v[1], this.v[2] + v.v[2], this.v[3] + v.v[3]);\r\n\t},\r\n\r\n\tsub : function(v) {\r\n\t\treturn new SglVec4(this.v[0] - v.v[0], this.v[1] - v.v[1], this.v[2] - v.v[2], this.v[3] - v.v[3]);\r\n\t},\r\n\r\n\tmul : function(v) {\r\n\t\treturn new SglVec4(this.v[0] * v.v[0], this.v[1] * v.v[1], this.v[2] * v.v[2], this.v[3] * v.v[3]);\r\n\t},\r\n\r\n\tdiv : function(v) {\r\n\t\treturn new SglVec4(this.v[0] / v.v[0], this.v[1] / v.v[1], this.v[2] / v.v[2], this.v[3] / v.v[3]);\r\n\t},\r\n\r\n\tget rcp() {\r\n\t\treturn new SglVec4(1.0 / this.v[0], 1.0 / this.v[1], 1.0 / this.v[2], 1.0 / this.v[3]);\r\n\t},\r\n\r\n\tdot : function(v) {\r\n\t\treturn (this.v[0] * v.v[0] + this.v[1] * v.v[1] + this.v[2] * v.v[2] + this.v[3] * v.v[3]);\r\n\t},\r\n\r\n\t/*\r\n\tcross : function(u, v, w) {\r\n\t\treturn null;\r\n\t},\r\n\t*/\r\n\r\n\tmin : function(v) {\r\n\t\treturn new SglVec4(sglMin(this.v[0], v.v[0]), sglMin(this.v[1], v.v[1]), sglMin(this.v[2], v.v[2]), sglMin(this.v[3], v.v[3]));\r\n\t},\r\n\r\n\tmax : function(v) {\r\n\t\treturn new SglVec4(sglMax(this.v[0], v.v[0]), sglMax(this.v[1], v.v[1]), sglMax(this.v[2], v.v[2]), sglMax(this.v[3], v.v[3]));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglPlane3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglPlane3.\r\n * @class Represents a plane in space.\r\n */\r\nfunction SglPlane3(normal, offset, normalize) {\r\n\tthis._normal = [ 0.0, 0.0, 1.0 ];\r\n\tthis._offset = 0.0;\r\n\r\n\tif (normal && offset) {\r\n\t\tthis.setup(normal, offset, normalize);\r\n\t}\r\n}\r\n\r\nSglPlane3.prototype = {\r\n\tget normal()  { return this._normal;          },\r\n\tset normal(n) { this._normal = n.slice(0, 3); },\r\n\r\n\tget offset()  { return this._offset;          },\r\n\tset offset(o) { this._offset = o.slize(0, 3); },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglPlane3(this._normal, this._offset, false);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(normal, offset, nomalize) {\r\n\t\tthis._normal[0] = normal[0];\r\n\t\tthis._normal[1] = normal[1];\r\n\t\tthis._normal[2] = normal[2];\r\n\t\tthis._offset    = offset;\r\n\r\n\t\tif (normalize) {\r\n\t\t\tvar s = sglSqrt(sglDotV3(this._normal));\r\n\r\n\t\t\tif (s > 0.0) {\r\n\t\t\t\ts = 1.0 / s;\r\n\t\t\t\tsglSelfMulV3S(this._normal, s);\r\n\t\t\t\tthis._offset    *= s;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglBox3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglBox3.\r\n * @class Represents an axis-aligned box in space.\r\n */\r\nfunction SglBox3(min, max) {\r\n\tthis._min = [  1.0,  1.0,  1.0 ];\r\n\tthis._max = [ -1.0, -1.0, -1.0 ];\r\n\r\n\tif (min && max) {\r\n\t\tthis.setup(min, max);\r\n\t}\r\n}\r\n\r\nSglBox3.prototype = {\r\n\tget min()  { return this._min;          },\r\n\tset min(m) { this._min = m.slice(0, 3); },\r\n\r\n\tget max()  { return this._max;          },\r\n\tset max(m) { this._max = m.slice(0, 3); },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglBox3(this._min, this._max);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(min, max) {\r\n\t\tfor (var i=0; i<3; ++i) {\r\n\t\t\tthis._min[i] = min[i];\r\n\t\t\tthis._max[i] = max[i];\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget isNull() {\r\n\t\treturn (this._min[0] > this._max[0]);\r\n\t},\r\n\r\n\tget isEmpty() {\r\n\t\treturn (\r\n\t\t\t   (this._min[0] == this._max[0])\r\n\t\t\t&& (this._min[1] == this._max[1])\r\n\t\t\t&& (this._min[2] == this._max[2])\r\n\t\t);\r\n\t},\r\n\r\n\tget center() {\r\n\t\treturn sglSelfMulV3S(sglAddV3(this._min, this._max), 0.5);\r\n\t},\r\n\r\n\tget size() {\r\n\t\treturn sglSubV3(this._max, this._min);\r\n\t},\r\n\r\n\tget squaredDiagonal() {\r\n\t\tvar s = this.size;\r\n\t\treturn sglDotV3(s, s);\r\n\t},\r\n\r\n\tget diagonal() {\r\n\t\treturn sglSqrt(this.squaredDiagonal);\r\n\t},\r\n\r\n\tget facesAreas() {\r\n\t\tvar s = this.size;\r\n\t\treturn [\r\n\t\t\t(s[1] * s[2]),\r\n\t\t\t(s[0] * s[2]),\r\n\t\t\t(s[0] * s[1])\r\n\t\t];\r\n\t},\r\n\r\n\tget surfaceArea() {\r\n\t\tvar a = this.facesArea;\r\n\t\treturn ((a[0] + a[1] + a[2]) * 2.0);\r\n\t},\r\n\r\n\tget volume() {\r\n\t\tvar s = this.size;\r\n\t\treturn (s[0] * s[1] * s[2]);\r\n\t},\r\n\r\n\toffset : function(halfDelta) {\r\n\t\tsglSelfSubV3S(this._min[i], halfDelta);\r\n\t\tsglSelfAddV3S(this._max[i], halfDelta);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tcorner : function(index) {\r\n\t\tvar s = this.size;\r\n\t\treturn [\r\n\t\t\tthis._min[0] + (((index % 2)       != (0.0)) ? (1.0) : (0.0)) * s[0],\r\n\t\t\tthis._min[1] + ((((index / 2) % 2) != (0.0)) ? (1.0) : (0.0)) * s[1],\r\n\t\t\tthis._min[2] + (((index > 3)       != (0.0)) ? (1.0) : (0.0)) * s[2]\r\n\t\t];\r\n\t},\r\n\r\n\ttransformed : function(matrix) {\r\n\t\tvar b = new SglBox3();\r\n\t\tvar p = sglMulM4V3(matrix, this.corner(0), 1.0);\r\n\t\tb.min = p;\r\n\t\tb.max = p;\r\n\t\tfor (var i=1; i<8; ++i) {\r\n\t\t\tp = sglMulM4V3(matrix, this.corner(i), 1.0);\r\n\t\t\tb.min = sglMinV3(b.min, p);\r\n\t\t\tb.max = sglMaxV3(b.max, p);\r\n\t\t}\r\n\t\treturn b;\r\n\t},\r\n\r\n\taddPoint : function(p) {\r\n\t\tif (this.isNull) {\r\n\t\t\tthis.min = p;\r\n\t\t\tthis.max = p;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.min = sglMinV3(this.min, p);\r\n\t\t\tthis.max = sglMaxV3(this.min, p);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddBox : function(b) {\r\n\t\tif (!b.isNull) {\r\n\t\t\tif (this.isNull) {\r\n\t\t\t\tthis.min = b.min;\r\n\t\t\t\tthis.max = b.max;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.min = sglMinV3(this.min, b.min);\r\n\t\t\t\tthis.max = sglMaxV3(this.max, b.max);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglSphere3\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglSphere3.\r\n * @class Represents a sphere in space.\r\n */\r\nfunction SglSphere3(center, radius) {\r\n\tthis._center = [ 0.0, 0.0, 0.0 ];\r\n\tthis._radius = -1.0;\r\n\r\n\tif (center && radius) {\r\n\t\tthis.setup(center, radius);\r\n\t}\r\n}\r\n\r\nSglSphere3.prototype = {\r\n\tget center()  { return this._center;          },\r\n\tset center(c) { this._center = c.slice(0, 3); },\r\n\r\n\tget radius()  { return this._redius;          },\r\n\tset radius(r) { this._radius = r;             },\r\n\r\n\tclone : function() {\r\n\t\treturn new SglSphere3(this._center, this._radius);\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\tsetup : function(center, radius) {\r\n\t\tthis._center[0] = center[0];\r\n\t\tthis._center[1] = center[1];\r\n\t\tthis._center[2] = center[2];\r\n\t\tthis._radius    = radius;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget isNull() {\r\n\t\treturn (this._radius < 0.0);\r\n\t},\r\n\r\n\tget isEmpty() {\r\n\t\treturn (this._radius == 0.0);\r\n\t},\r\n\r\n\tget surfaceArea() {\r\n\t\treturn (4.0 * SGL_PI * this._radius * this._radius);\r\n\t},\r\n\r\n\tget volume() {\r\n\t\treturn ((4.0 / 3.0) * SGL_PI * this._radius * this._radius * this._radius);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglMatrixStack\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglMatrixStack.\r\n * @class Represents a stack of 4x4 matrices.\r\n */\r\nfunction SglMatrixStack() {\r\n\tthis._s = [ ];\r\n\tthis._s.push(sglIdentityM4());\r\n\tthis._n = 0;\r\n}\r\n\r\nSglMatrixStack.prototype = {\r\n\tclone : function() {\r\n\t\tvar ss = new SglMatrixStack();\r\n\t\tss.s = [ ];\r\n\t\tfor (var i=0; i<(this._n+1); ++i) {\r\n\t\t\tss._s.push(sglDupM4(this._s[i]));\r\n\t\t}\r\n\t\treturn ss;\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\treset : function() {\r\n\t\tthis._s = [ ];\r\n\t\tthis._s.push(sglIdentityM4());\r\n\t\tthis._n = 0;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget size() {\r\n\t\treturn (this._n + 1);\r\n\t},\r\n\r\n\tget top() {\r\n\t\treturn sglDupM4(this._s[this._n]);\r\n\t},\r\n\r\n\tget topRef() {\r\n\t\treturn this._s[this._n];\r\n\t},\r\n\r\n\tpush : function() {\r\n\t\tthis._s.push(sglDupM4(this._s[this._n]));\r\n\t\tthis._n++;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tpop : function() {\r\n\t\tif (this._n > 0) {\r\n\t\t\tthis._s.pop();\r\n\t\t\tthis._n--;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tload : function(m) {\r\n\t\tthis._s[this._n] = sglDupM4(m);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmultiply : function(m) {\r\n\t\tthis._s[this._n] = sglMulM4(this._s[this._n], m);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tloadIdentity : function() {\r\n\t\tthis._s[this._n] = sglIdentityM4();\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttranslate : function(x, y, z) {\r\n\t\treturn this.multiply(sglTranslationM4C(x, y, z));\r\n\t},\r\n\r\n\trotate : function(angleRad, x, y, z) {\r\n\t\treturn this.multiply(sglRotationAngleAxisM4C(angleRad, x, y, z));\r\n\t},\r\n\r\n\tscale : function(x, y, z) {\r\n\t\treturn this.multiply(sglScalingM4C(x, y, z));\r\n\t},\r\n\r\n\tlookAt : function(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ) {\r\n\t\treturn this.multiply(sglLookAtM4C(positionX, positionY, positionZ, targetX, targetY, targetZ, upX, upY, upZ));\r\n\t},\r\n\r\n\tortho : function(left, right, bottom, top, zNear, zFar) {\r\n\t\treturn this.multiply(sglOrthoM4C(left, right, bottom, top, zNear, zFar));\r\n\t},\r\n\r\n\tfrustum : function(left, right, bottom, top, zNear, zFar) {\r\n\t\treturn this.multiply(sglFrustumM4C(left, right, bottom, top, zNear, zFar));\r\n\t},\r\n\r\n\tperspective : function(fovYRad, aspectRatio, zNear, zFar) {\r\n\t\treturn this.multiply(sglPerspectiveM4(fovYRad, aspectRatio, zNear, zFar));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTransformStack\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglTransformStack.\r\n * @class Holds model, view and projection matrix stacks.\r\n */\r\nfunction SglTransformStack() {\r\n\tthis._ms = new SglMatrixStack();\r\n\tthis._vs = new SglMatrixStack();\r\n\tthis._ps = new SglMatrixStack();\r\n}\r\n\r\nSglTransformStack.prototype = {\r\n\tclone : function() {\r\n\t\tvar xs = new SglTransformStack();\r\n\t\txs._ms = this._ms.clone();\r\n\t\txs._vs = this._vs.clone();\r\n\t\txs._ps = this._ps.clone();\r\n\t\treturn xs;\r\n\t},\r\n\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\treset : function() {\r\n\t\tthis._ms.reset();\r\n\t\tthis._vs.reset();\r\n\t\tthis._ps.reset();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tget model() {\r\n\t\treturn this._ms;\r\n\t},\r\n\r\n\tget view() {\r\n\t\treturn this._vs;\r\n\t},\r\n\r\n\tget projection() {\r\n\t\treturn this._ps;\r\n\t},\r\n\r\n\tget modelMatrix() {\r\n\t\treturn this.model.top;\r\n\t},\r\n\r\n\tget modelMatrixRef() {\r\n\t\treturn this.model.topRef;\r\n\t},\r\n\r\n\tget modelMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelMatrixInverse);\r\n\t},\r\n\r\n\tget viewMatrix() {\r\n\t\treturn this.view.top;\r\n\t},\r\n\r\n\tget viewMatrixRef() {\r\n\t\treturn this.view.topRef;\r\n\t},\r\n\r\n\tget viewMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewMatrixInverse() {\r\n\t\treturn sglInverseM4(this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.viewMatrixInverse);\r\n\t},\r\n\r\n\tget projectionMatrix() {\r\n\t\treturn this.projection.top;\r\n\t},\r\n\r\n\tget projectionMatrixRef() {\r\n\t\treturn this.projection.topRef;\r\n\t},\r\n\r\n\tget projectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.projectionMatrixRef);\r\n\t},\r\n\r\n\tget projectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.projectionMatrixRef);\r\n\t},\r\n\r\n\tget projectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.projectionMatrixInverse);\r\n\t},\r\n\r\n\tget modelViewMatrix() {\r\n\t\treturn sglMulM4(this.viewMatrixRef, this.modelMatrixRef);\r\n\t},\r\n\r\n\tget modelViewMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewMatrix);\r\n\t},\r\n\r\n\tget modelViewMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelViewMatrix);\r\n\t},\r\n\r\n\tget modelViewMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewMatrixInverse);\r\n\t},\r\n\r\n\tget viewProjectionMatrix() {\r\n\t\treturn sglMulM4(this.projectionMatrixRef, this.viewMatrixRef);\r\n\t},\r\n\r\n\tget viewProjectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.viewProjectionMatrix);\r\n\t},\r\n\r\n\tget viewProjectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.viewProjectionMatrix);\r\n\t},\r\n\r\n\tget viewProjectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.viewProjectionMatrixInverse);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrix() {\r\n\t\treturn sglMulM4(this.projectionMatrixRef, sglMulM4(this.viewMatrixRef, this.modelMatrixRef));\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewProjectionMatrix);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixInverse() {\r\n\t\treturn sglInverseM4(this.modelViewProjectionMatrix);\r\n\t},\r\n\r\n\tget modelViewProjectionMatrixInverseTranspose() {\r\n\t\treturn sglTransposeM4(this.modelViewProjectionMatrixInverse);\r\n\t},\r\n\r\n\tget worldSpaceNormalMatrix() {\r\n\t\treturn sglM4toM3(this.modelMatrixInverseTranspose);\r\n\t},\r\n\r\n\tget viewSpaceNormalMatrix() {\r\n\t\treturn sglM4toM3(this.modelViewMatrixInverseTranspose);\r\n\t},\r\n\r\n\tget modelSpaceViewerPosition() {\r\n\t\treturn sglV4toV3(sglGetColM4(this.modelViewMatrixInverse, 3));\r\n\t},\r\n\r\n\tget modelSpaceViewDirection() {\r\n\t\treturn sglNegV3(sglV4toV3(sglGetRowM4(this.modelViewMatrix, 2)));\r\n\t},\r\n\r\n\tget worldSpaceViewerPosition() {\r\n\t\treturn sglV4toV3(sglGetColM4(this.viewMatrixInverse, 3));\r\n\t},\r\n\r\n\tget worldSpaceViewDirection() {\r\n\t\treturn ssglNegV3(sglV4toV3(sglGetRowM4(this.viewMatrixRef, 2)));\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// _SglFrustumPlane\r\n/**********************************************************/\r\nfunction _SglFrustumPlane() {\r\n\tthis.normal     = [ 0.0, 0.0, 1.0 ];\r\n\tthis.offset     = 0.0;\r\n\tthis.testVertex = [ 0, 0, 0 ];\r\n}\r\n\r\n_SglFrustumPlane.prototype = {\r\n\tsetup : function(nx, ny, nz, off) {\r\n\t\tvar s = 1.0 / sglSqrt(nx*nx + ny*ny + nz*nz);\r\n\r\n\t\tthis.normal[0] = nx * s;\r\n\t\tthis.normal[1] = ny * s;\r\n\t\tthis.normal[2] = nz * s;\r\n\r\n\t\tthis.offset = off * s;\r\n\r\n\t\tthis.testVertex[0] = (this.normal[0] >= 0.0) ? (1) : (0);\r\n\t\tthis.testVertex[1] = (this.normal[1] >= 0.0) ? (1) : (0);\r\n\t\tthis.testVertex[2] = (this.normal[2] >= 0.0) ? (1) : (0);\r\n\t}\r\n};\r\n/**********************************************************/\r\n\r\n\r\n// SglFrustum\r\n/**********************************************************/\r\nvar SGL_OUTSIDE_FRUSTUM   = 0;\r\nvar SGL_INTERSECT_FRUSTUM = 1;\r\nvar SGL_INSIDE_FRUSTUM    = 2;\r\n\r\n/**\r\n * Constructs a SglFrustum.\r\n * @class Holds frustum information for operations such as visibility culling.\r\n */\r\nfunction SglFrustum(projectionMatrix, modelViewMatrix, viewport) {\r\n\tthis._mvpMatrix       = sglIdentityM4();\r\n\tthis._viewport        = [ 0, 0, 1, 1 ];\r\n\tthis._vp              = [ 0, 0, 1, 1 ];\r\n\tthis._billboardMatrix = sglIdentityM4();\r\n\r\n\tthis._planes = new Array(6);\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tthis._planes[i] = new _SglFrustumPlane();\r\n\t}\r\n\r\n\tif (projectionMatrix && modelViewMatrix && viewport) {\r\n\t\tthis.setup(projectionMatrix, modelViewMatrix, viewport);\r\n\t}\r\n}\r\n\r\nSglFrustum.prototype = {\r\n\tsetup : function (projectionMatrix, modelViewMatrix, viewport) {\r\n\t\tvar rot = [\r\n\t\t\tsglGetColM4(modelViewMatrix, 0),\r\n\t\t\tsglGetColM4(modelViewMatrix, 1),\r\n\t\t\tsglGetColM4(modelViewMatrix, 2)\r\n\t\t];\r\n\r\n\t\tvar sc = [\r\n\t\t\tsglLengthV4(rot[0]),\r\n\t\t\tsglLengthV4(rot[1]),\r\n\t\t\tsglLengthV4(rot[2])\r\n\t\t];\r\n\r\n\t\tvar scRcp = sglRcpV3(sc);\r\n\r\n\t\tvar sMat    = sglScalingM4V(sc);\r\n\t\tvar sMatInv = sglScalingM4V(scRcp);\r\n\r\n\t\trot[0] = sglMulV4S(rot[0], scRcp[0]);\r\n\t\trot[1] = sglMulV4S(rot[1], scRcp[1]);\r\n\t\trot[2] = sglMulV4S(rot[2], scRcp[2]);\r\n\r\n\t\tvar rMatInv = sglIdentityM4();\r\n\t\tsglSetRowM4V(rMatInv, 0, rot[0]);\r\n\t\tsglSetRowM4V(rMatInv, 1, rot[1]);\r\n\t\tsglSetRowM4V(rMatInv, 2, rot[2]);\r\n\r\n\t\tthis._mvpMatrix       = sglMulM4(projectionMatrix, modelViewMatrix);\r\n\t\tthis._billboardMatrix = sglMulM4(sMatInv, sglMulM4(rMatInv, sMat));\r\n\t\tthis._viewport        = viewport.slice(0, 4);\r\n\r\n\t\tthis._vp[0] = this._viewport[2] * 0.5;\r\n\t\tthis._vp[1] = this._viewport[0] + this._viewport[2] * 0.5;\r\n\t\tthis._vp[2] = this._viewport[3] * 0.5;\r\n\t\tthis._vp[3] = this._viewport[1] + this._viewport[3] * 0.5;\r\n\r\n\r\n\t\tvar m = this._mvpMatrix;\r\n\t\tvar q = [ m[3], m[7], m[11] ];\r\n\r\n\t\tthis._planes[0].setup(q[ 0] - m[ 0], q[ 1] - m[ 4], q[ 2] - m[ 8], m[15] - m[12]);\r\n\t\tthis._planes[1].setup(q[ 0] + m[ 0], q[ 1] + m[ 4], q[ 2] + m[ 8], m[15] + m[12]);\r\n\t\tthis._planes[2].setup(q[ 0] - m[ 1], q[ 1] - m[ 5], q[ 2] - m[ 9], m[15] - m[13]);\r\n\t\tthis._planes[3].setup(q[ 0] + m[ 1], q[ 1] + m[ 5], q[ 2] + m[ 9], m[15] + m[13]);\r\n\t\tthis._planes[4].setup(q[ 0] - m[ 2], q[ 1] - m[ 6], q[ 2] - m[10], m[15] - m[14]);\r\n\t\tthis._planes[5].setup(q[ 0] + m[ 2], q[ 1] + m[ 6], q[ 2] + m[10], m[15] + m[14]);\r\n\t},\r\n\r\n\tboxVisibility : function(boxMin, boxMax) {\r\n\t\tvar ret = SGL_INSIDE_FRUSTUM;\r\n\r\n\t\tvar bminmax = [ boxMin, boxMax ];\r\n\r\n\t\tvar fp = null;\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\tfp = this._planes[i];\r\n\t\t\tif (\r\n\t\t\t\t((fp.normal[0] * bminmax[fp.testVertex[0]][0]) +\r\n\t\t\t\t (fp.normal[1] * bminmax[fp.testVertex[1]][1]) +\r\n\t\t\t\t (fp.normal[2] * bminmax[fp.testVertex[2]][2]) +\r\n\t\t\t\t (fp.offset)) < 0.0\r\n\t\t\t) {\r\n\t\t\t\treturn SGL_OUTSIDE_FRUSTUM;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\t((fp.normal[0] * bminmax[1 - fp.testVertex[0]][0]) +\r\n\t\t\t\t (fp.normal[1] * bminmax[1 - fp.testVertex[1]][1]) +\r\n\t\t\t\t (fp.normal[2] * bminmax[1 - fp.testVertex[2]][2]) +\r\n\t\t\t\t (fp.offset)) < 0.0\r\n\t\t\t) {\r\n\t\t\t\tret = SGL_INTERSECT_FRUSTUM;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t},\r\n\r\n\tprojectedSegmentSize : function(center, size) {\r\n\t\tvar hs = size * 0.5;\r\n\r\n\t\tvar p0 = sglV3toV4(center, 0.0);\r\n\t\tvar p1 = [ -hs, 0.0, 0.0, 1.0 ];\r\n\t\tvar p2 = [  hs, 0.0, 0.0, 1.0 ];\r\n\r\n\t\tp1 = sglMulM4V4(this._billboardMatrix, p1);\r\n\t\tp1 = sglAddV4(p1, p0);\r\n\t\tp1 = sglProjectV4(sglMulM4V4(this._mvpMatrix, p1));\r\n\r\n\t\tp2 = sglMulM4V4(this._billboardMatrix, p2);\r\n\t\tp2 = sglAddV4(p2, p0);\r\n\t\tp2 = sglProjectV4(sglMulM4V4(this._mvpMatrix, p2));\r\n\r\n\t\t/*\r\n\t\tp1[0] = this._vp[0] * p1[0] + this._vp[1];\r\n\t\tp2[0] = this._vp[0] * p2[0] + this._vp[1];\r\n\t\t//p1[1] = this.viewport[3] * 0.5 * p1[1] + this.viewport[1] + this.viewport[3] * 0.5;\r\n\r\n\t\tp2[0] = this.viewport[2] * 0.5 * p2[0] + this.viewport[0] + this.viewport[2] * 0.5;\r\n\t\t//p2[1] = this.viewport[3] * 0.5 * p2[1] + this.viewport[1] + this.viewport[3] * 0.5;\r\n\r\n\t\tvar size = aglAbs(p2[0] - p1[0]);\r\n\t\t*/\r\n\r\n\t\tvar sz = this._vp[0] * sglAbs(p2[0] - p1[0]);\r\n\r\n\t\treturn sz;\r\n\t}\r\n};\r\n\r\nfunction sglBoxVisibility(modelViewProjectionMatrix, boxMin, boxMax) {\r\n\tvar fc = new SglFrustum(modelViewProjectionMatrix);\r\n\treturn fc.boxVisibility(boxMin, boxMax);\r\n}\r\n/**********************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// GL utilities\r\n/***********************************************************************/\r\nfunction _sglConsolidateOptions(fullOptions, usedOptions)\r\n{\r\n\tif (usedOptions) {\r\n\t\tfor (var attr in usedOptions) {\r\n\t\t\tfullOptions[attr] = usedOptions[attr];\r\n\t\t}\r\n\t}\r\n\treturn fullOptions;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglBufferInfo\r\n/***********************************************************************/\r\nfunction sglGetBufferOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tusage : gl.STATIC_DRAW\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglBufferInfo.\r\n * @class Holds information about a WebGL buffer object.\r\n */\r\nfunction SglBufferInfo() {\r\n\tthis.handle = null;\r\n\tthis.valid  = false;\r\n\tthis.target = 0;\r\n\tthis.size   = 0;\r\n\tthis.usage  = 0;\r\n}\r\n\r\nfunction sglBufferFromData(gl, target, values, options) {\r\n\tvar opt = sglGetBufferOptions(gl, options);\r\n\tvar buff = gl.createBuffer();\r\n\tgl.bindBuffer(target, buff);\r\n\tgl.bufferData(target, values, opt.usage);\r\n\tgl.bindBuffer(target, null);\r\n\r\n\tvar obj = new SglBufferInfo();\r\n\tobj.handle = buff;\r\n\tobj.valid  = true;\r\n\tobj.target = target;\r\n\tobj.size   = values.sizeInBytes;\r\n\tobj.usage  = opt.usage;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglVertexBufferFromData(gl, values, usage) {\r\n\treturn sglBufferFromData(gl, gl.ARRAY_BUFFER, values, usage);\r\n}\r\n\r\nfunction sglIndexBufferFromData(gl, values, usage) {\r\n\treturn sglBufferFromData(gl, gl.ELEMENT_ARRAY_BUFFER, values, usage);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglShaderInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglShaderInfo.\r\n * @class Holds information about a WebGL shader object.\r\n */\r\nfunction SglShaderInfo() {\r\n\tthis.handle = null;\r\n\tthis.valid  = false;\r\n\tthis.type   = 0;\r\n\tthis.log    = \"\";\r\n}\r\n\r\nfunction sglShaderFromSource(gl, type, src) {\r\n\tvar log = \"\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar shd  = gl.createShader(type);\r\n\tgl.shaderSource(shd, src);\r\n\tgl.compileShader(shd);\r\n\r\n\tlog += \"[SHADER LOG]\\n\";\r\n\tvar valid = true;\r\n\tif (gl.getShaderParameter(shd, gl.COMPILE_STATUS) != 0) {\r\n\t\tlog += \"SUCCESS:\\n\";\r\n\t}\r\n\telse {\r\n\t\tvalid = false;\r\n\t\tlog += \"FAIL:\\n\";\r\n\t}\r\n\tlog += gl.getShaderInfoLog(shd);\r\n\tlog += \"\\n\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar obj = new SglShaderInfo();\r\n\tobj.handle = shd;\r\n\tobj.valid  = valid;\r\n\tobj.type   = type;\r\n\tobj.log    = log;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglVertexShaderFromSource(gl, src) {\r\n\treturn sglShaderFromSource(gl, gl.VERTEX_SHADER, src);\r\n}\r\n\r\nfunction sglFragmentShaderFromSource(gl, src) {\r\n\treturn sglShaderFromSource(gl, gl.FRAGMENT_SHADER, src);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramAttributeInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttributeInfo.\r\n * @class Holds information about a WebGL program active attribute.\r\n */\r\nfunction SglProgramAttributeInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramUniformInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttributeInfo.\r\n * @class Holds information about a WebGL program active uniform.\r\n */\r\nfunction SglProgramUniformInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramSamplerInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramSamplerInfo.\r\n * @class Holds information about a WebGL program active sampler.\r\n */\r\nfunction SglProgramSamplerInfo() {\r\n\tthis.name       = \"\";\r\n\tthis.nativeType = 0;\r\n\t//this.scalarType = 0;\r\n\t//this.dimensions = 0;\r\n\tthis.size       = 0;\r\n\tthis.location   = -1;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramInfo.\r\n * @class Holds information about a WebGL program object.\r\n */\r\nfunction SglProgramInfo() {\r\n\tthis.handle     = null;\r\n\tthis.valid      = false;\r\n\tthis.shaders    = [ ];\r\n\tthis.attributes = new Object();\r\n\tthis.uniforms   = new Object();\r\n\tthis.samplers   = new Object();\r\n\tthis.log        = \"\";\r\n}\r\n\r\nfunction sglProgramFromShaders(gl, shaders) {\r\n\tvar log = \"\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar prg = gl.createProgram();\r\n\tfor (var s in shaders) {\r\n\t\tvar shd = shaders[s];\r\n\t\t//if (shd.valid) {\r\n\t\t\tgl.attachShader(prg, shd.handle);\r\n\t\t//}\r\n\t}\r\n\tgl.linkProgram(prg);\r\n\r\n\tvar valid = true;\r\n\tvalid = valid && (gl.getProgramParameter(prg, gl.LINK_STATUS)     != 0);\r\n\r\n\t// validation is needed when uniforms are set, so skip this.\r\n\t//gl.validateProgram(prg);\r\n\t//valid = valid && (gl.getProgramParameter(prg, gl.VALIDATE_STATUS) != 0);\r\n\r\n\tlog += \"[PROGRAM LOG]\\n\";\r\n\tif (valid) {\r\n\t\tlog += \"SUCCESS:\\n\";\r\n\t}\r\n\telse {\r\n\t\tlog += \"FAIL:\\n\";\r\n\t}\r\n\tlog += gl.getProgramInfoLog(prg);\r\n\tlog += \"\\n\";\r\n\tlog += \"----------------------\\n\";\r\n\r\n\tvar obj = new SglProgramInfo();\r\n\tobj.handle = prg;\r\n\tobj.valid  = valid;\r\n\tfor (var s in shaders) {\r\n\t\tvar shd = shaders[s]\r\n\t\t//if (shd.valid) {\r\n\t\t\tobj.shaders.push(shd);\r\n\t\t//}\r\n\t}\r\n\tobj.log = log;\r\n\r\n\tvar attribs_count = gl.getProgramParameter(prg, gl.ACTIVE_ATTRIBUTES);\r\n\tvar attr, loc, a;\r\n\tfor (var i=0; i<attribs_count; ++i) {\r\n\t\tattr = gl.getActiveAttrib(prg, i);\r\n\t\tif (!attr) continue;\r\n\t\ta    = new SglProgramAttributeInfo();\r\n\t\ta.name = attr.name;\r\n\t\ta.nativeType = attr.type;\r\n\t\ta.size = attr.size;\r\n\t\ta.location = gl.getAttribLocation(prg, attr.name);\r\n\t\tobj.attributes[a.name] = a;\r\n\t}\r\n\r\n\tvar uniforms_count = gl.getProgramParameter(prg, gl.ACTIVE_UNIFORMS);\r\n\tvar unif, loc, u;\r\n\tfor (var i=0; i<uniforms_count; ++i) {\r\n\t\tunif = gl.getActiveUniform(prg, i);\r\n\t\tif (!unif) continue;\r\n\t\tloc  = gl.getUniformLocation(prg, unif.name);\r\n\t\tif ((unif.type == gl.SAMPLER_2D) || (unif.type == gl.SAMPLER_CUBE) || (unif.type == 35682)) {\r\n\t\t\ts = new SglProgramSamplerInfo();\r\n\t\t\ts.name = unif.name;\r\n\t\t\ts.nativeType = unif.type;\r\n\t\t\ts.size = unif.size;\r\n\t\t\ts.location = loc;\r\n\t\t\tobj.samplers[s.name] = s;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tu = new SglProgramUniformInfo();\r\n\t\t\tu.name = unif.name;\r\n\t\t\tu.nativeType = unif.type;\r\n\t\t\tu.size = unif.size;\r\n\t\t\tu.location = loc;\r\n\t\t\tobj.uniforms[u.name] = u;\r\n\t\t}\r\n\t}\r\n\r\n\tsglSetDefaultProgramBindings(gl, obj);\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglProgramFromSources(gl, vertexSources, fragmentSources) {\r\n\tvar shd = null;\r\n\tvar shaders = [ ];\r\n\tfor (var s in vertexSources) {\r\n\t\tvar src = vertexSources[s];\r\n\t\tshd = sglVertexShaderFromSource(gl, src);\r\n\t\tshaders.push(shd);\r\n\t}\r\n\tfor (var s in fragmentSources) {\r\n\t\tvar src = fragmentSources[s];\r\n\t\tshd = sglFragmentShaderFromSource(gl, src);\r\n\t\tshaders.push(shd);\r\n\t}\r\n\treturn sglProgramFromShaders(gl, shaders);\r\n}\r\n\r\nfunction sglSetDefaultProgramBindings(gl, programInfo) {\r\n\tvar prg = programInfo.handle;\r\n\r\n\t// ensure index is sequential in \"for (attr in programInfo.attributes)\" loops\r\n\tvar index = 0;\r\n\tfor (var v in programInfo.attributes) {\r\n\t\tvar vattr = programInfo.attributes[v];\r\n\t\tgl.bindAttribLocation(prg, index, vattr.name);\r\n\t\tvattr.location = index;\r\n\t\tindex++;\r\n\t}\r\n\t// must relink after attributes binding\r\n\tgl.linkProgram(prg);\r\n\r\n\t// uniform locations could change after program linking, so update them\r\n\tfor (var u in programInfo.uniforms) {\r\n\t\tvar unif = programInfo.uniforms[u];\r\n\t\tunif.location = gl.getUniformLocation(prg, unif.name);\r\n\t}\r\n\r\n\tgl.useProgram(programInfo.handle);\r\n\t// ensure texture unit is sequential in \"for (attr in programInfo.samplers)\" loops\r\n\tvar unit = 0;\r\n\tfor (var s in programInfo.samplers) {\r\n\t\tvar smp = programInfo.samplers[s];\r\n\t\tsmp.location = gl.getUniformLocation(prg, smp.name);\r\n\t\tgl.uniform1i(smp.location, unit);\r\n\t\tunit++;\r\n\t}\r\n\t//gl.useProgram(null);\r\n}\r\n\r\nfunction sglProgramSynchronize(gl, programInfo) {\r\n\tvar prg = programInfo.handle;\r\n\r\n\tfor (var v in programInfo.attributes) {\r\n\t\tvar vattr = programInfo.attributes[v];\r\n\t\tvattr.location = gl.getAttribLocation(prg, vattr.name);\r\n\t}\r\n\r\n\tfor (var u in programInfo.uniforms) {\r\n\t\tvar unif = programInfo.uniforms[u];\r\n\t\tunif.location = gl.getUniformLocation(prg, unif.name);\r\n\t}\r\n\r\n\tfor (var s in programInfo.samplers) {\r\n\t\tvar smp = programInfo.samplers[s];\r\n\t\tsmp.location = gl.getUniformLocation(prg, smp.name);\r\n\t}\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglTextureInfo\r\n/***********************************************************************/\r\nfunction sglGetTextureOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tminFilter        : gl.LINEAR,\r\n\t\tmagFilter        : gl.LINEAR,\r\n\t\twrapS            : gl.CLAMP_TO_EDGE,\r\n\t\twrapT            : gl.CLAMP_TO_EDGE,\r\n\t\tisDepth          : false,\r\n\t\tdepthMode        : gl.LUMINANCE,\r\n\t\tdepthCompareMode : gl.COMPARE_R_TO_TEXTURE,\r\n\t\tdepthCompareFunc : gl.LEQUAL,\r\n\t\tgenerateMipmap   : false,\r\n\t\tflipY            : true,\r\n\t\tpremultiplyAlpha : false,\r\n\t\tonload           : null\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglTextureInfo.\r\n * @class Holds information about a WebGL texture object.\r\n */\r\nfunction SglTextureInfo() {\r\n\tthis.handle           = null;\r\n\tthis.valid            = false;\r\n\tthis.target           = 0;\r\n\tthis.format           = 0;\r\n\tthis.width            = 0;\r\n\tthis.height           = 0;\r\n\tthis.minFilter        = 0;\r\n\tthis.magFilter        = 0;\r\n\tthis.wrapS            = 0;\r\n\tthis.wrapT            = 0;\r\n\tthis.isDepth          = false;\r\n\tthis.depthMode        = 0;\r\n\tthis.depthCompareMode = 0;\r\n\tthis.depthCompareFunc = 0;\r\n}\r\n\r\nfunction sglTexture2DFromData(gl, internalFormat, width, height, sourceFormat, sourceType, texels, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\t// Chrome does not like texels == null\r\n\tif (!texels) {\r\n\t\tif (sourceType == gl.FLOAT) {\r\n\t\t\ttexels = new Float32Array(width * height * 4);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttexels = new Uint8Array(width * height * 4);\r\n\t\t}\r\n\t}\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tgl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, width, height, 0, sourceFormat, sourceType, texels);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.isDepth) {\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.DEPTH_TEXTURE_MODE,   opt.depthMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, opt.depthCompareMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, opt.depthCompareFunc);\r\n\t}\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_2D);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_2D;\r\n\tobj.format           = internalFormat;\r\n\tobj.width            = width;\r\n\tobj.height           = height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = opt.isDepth;\r\n\tobj.depthMode        = opt.depthMode;\r\n\tobj.depthCompareMode = opt.depthCompareMode;\r\n\tobj.depthCompareFunc = opt.depthCompareFunc;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTexture2DFromImage(gl, image, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_2D);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_2D;\r\n\tobj.format           = gl.RGBA;\r\n\tobj.width            = image.width;\r\n\tobj.height           = image.height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = false;\r\n\tobj.depthMode        = 0;\r\n\tobj.depthCompareMode = 0;\r\n\tobj.depthCompareFunc = 0;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTexture2DFromUrl(gl, url, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\tvar obj = new SglTextureInfo();\r\n\r\n\tvar img = new Image();\r\n\timg.crossOrigin = '';\r\n\timg.onload = function() {\r\n\t\tvar texInfo = sglTexture2DFromImage(gl, img, opt);\r\n\t\tfor (var a in texInfo) {\r\n\t\t\tobj[a] = texInfo[a];\r\n\t\t}\r\n\t\tif (opt.onload) {\r\n\t\t\topt.onload(gl, obj, url);\r\n\t\t}\r\n\t};\r\n\timg.src = url;\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/***********************************************************************/\r\nfunction sglTextureCubeFromData(gl, internalFormat, width, height, sourceFormat, sourceType, facesTexels, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\t// Chrome does not like texels == null\r\n\tif (!facesTexels) {\r\n\t\tvar tx = null;\r\n\t\tif (sourceType == gl.FLOAT) {\r\n\t\t\ttx = new Float32Array(width * height * 4);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttx = new Uint8Array(width * height * 4);\r\n\t\t}\r\n\t\tfacesTexels = new Array(6);\r\n\t\tfor (var i=0; i<6; ++i) {\r\n\t\t\tfacesTexels[i] = tx;\r\n\t\t}\r\n\t}\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tgl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, internalFormat, width, height, 0, sourceFormat, sourceType, facesTexels[i]);\r\n\t}\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.isDepth) {\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.DEPTH_TEXTURE_MODE,   opt.depthMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_MODE, opt.depthCompareMode);\r\n\t\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_COMPARE_FUNC, opt.depthCompareFunc);\r\n\t}\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_CUBE_MAP;\r\n\tobj.format           = internalFormat;\r\n\tobj.width            = width;\r\n\tobj.height           = height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = opt.isDepth;\r\n\tobj.depthMode        = opt.depthMode;\r\n\tobj.depthCompareMode = opt.depthCompareMode;\r\n\tobj.depthCompareFunc = opt.depthCompareFunc;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTextureCubeFromImages(gl, images, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\r\n\tvar tex = gl.createTexture();\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, tex);\r\n\r\n\tvar flipYEnabled  = gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);\r\n\tvar flipYRequired = (opt.flipY === true);\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYRequired) ? (1) : (0)));\r\n\t}\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\tgl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, images[i]);\r\n\t}\r\n\tif (flipYEnabled != flipYRequired) {\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, ((flipYEnabled) ? (1) : (0)));\r\n\t}\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, opt.minFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, opt.magFilter);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S,     opt.wrapS    );\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T,     opt.wrapT    );\r\n\tif (opt.generateMipmap) {\r\n\t\tgl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n\t}\r\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\r\n\r\n\tvar obj = new SglTextureInfo();\r\n\tobj.handle           = tex;\r\n\tobj.valid            = true;\r\n\tobj.target           = gl.TEXTURE_CUBE_MAP;\r\n\tobj.format           = gl.RGBA;\r\n\tobj.width            = images[0].width;\r\n\tobj.height           = images[0].height;\r\n\tobj.minFilter        = opt.minFilter;\r\n\tobj.magFilter        = opt.magFilter;\r\n\tobj.wrapS            = opt.wrapS;\r\n\tobj.wrapT            = opt.wrapT;\r\n\tobj.isDepth          = false;\r\n\tobj.depthMode        = 0;\r\n\tobj.depthCompareMode = 0;\r\n\tobj.depthCompareFunc = 0;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglTextureCubeFromUrls(gl, urls, options) {\r\n\tvar opt = sglGetTextureOptions(gl, options);\r\n\tvar obj = new SglTextureInfo();\r\n\r\n\tvar remaining = 6;\r\n\tvar images = new Array(6);\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\timages[i] = new Image();\r\n\t\timages[i].crossOrigin = '';\r\n\t}\r\n\tvar watcher = function() {\r\n\t\tremaining--;\r\n\t\tif (remaining == 0) {\r\n\t\t\tvar texInfo = sglTextureCubeFromImages(gl, images, opt);\r\n\t\t\tfor (var a in texInfo) {\r\n\t\t\t\tobj[a] = texInfo[a];\r\n\t\t\t}\r\n\t\t\tif (opt.onload) {\r\n\t\t\t\topt.onload(gl, obj, urls);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tfor (var i=0; i<6; ++i) {\r\n\t\timages[i].onload = watcher;\r\n\t\timages[i].src    = urls[i];\r\n\t}\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglRenderbufferInfo\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglRenderbufferInfo.\r\n * @class Holds information about a WebGL renderbuffer object.\r\n */\r\nfunction SglRenderbufferInfo() {\r\n\tthis.handle    = null;\r\n\tthis.valid     = false;\r\n\tthis.target    = 0;\r\n\tthis.format    = 0;\r\n\tthis.width     = 0;\r\n\tthis.height    = 0;\r\n}\r\n\r\nfunction sglRenderbufferFromFormat(gl, format, width, height) {\r\n\tvar rb = gl.createRenderbuffer();\r\n\tgl.bindRenderbuffer(gl.RENDERBUFFER, rb);\r\n\tgl.renderbufferStorage(gl.RENDERBUFFER, format, width, height);\r\n\tgl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n\r\n\tvar obj = new SglRenderbufferInfo();\r\n\tobj.handle = rb;\r\n\tobj.valid  = true;\r\n\tobj.target = gl.RENDERBUFFER;\r\n\tobj.format = format;\r\n\tobj.width  = width;\r\n\tobj.height = height;\r\n\r\n\treturn obj;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglFramebufferInfo\r\n/***********************************************************************/\r\nfunction sglGetFramebufferOptions(gl, options) {\r\n\tvar opt = {\r\n\t\tminFilter             : gl.LINEAR,\r\n\t\tmagFilter             : gl.LINEAR,\r\n\t\twrapS                 : gl.CLAMP_TO_EDGE,\r\n\t\twrapT                 : gl.CLAMP_TO_EDGE,\r\n\t\tisDepth               : false,\r\n\t\tdepthMode             : gl.LUMINANCE,\r\n\t\tdepthCompareMode      : gl.COMPARE_R_TO_TEXTURE,\r\n\t\tdepthCompareFunc      : gl.LEQUAL,\r\n\t\tcolorsAsRenderbuffer  : false,\r\n\t\tdepthAsRenderbuffer   : false,\r\n\t\tstencilAsRenderbuffer : false,\r\n\t\tgenerateColorsMipmap  : false,\r\n\t\tgenerateDepthMipmap   : false,\r\n\t\tgenerateStencilMipmap : false\r\n\t};\r\n\treturn _sglConsolidateOptions(opt, options);\r\n}\r\n\r\n/**\r\n * Constructs a SglFramebufferInfo.\r\n * @class Holds information about a WebGL framebuffer object.\r\n */\r\nfunction SglFramebufferInfo() {\r\n\tthis.handle        = null;\r\n\tthis.valid         = false;\r\n\tthis.width         = 0;\r\n\tthis.height        = 0;\r\n\tthis.colorTargets  = [ ];\r\n\tthis.depthTarget   = null;\r\n\tthis.stencilTarget = null;\r\n\tthis.status        = 0;\r\n}\r\n\r\nfunction sglFramebufferFromTargets(gl, colorTargets, depthTarget, stencilTarget, options) {\r\n\tvar opt = sglGetFramebufferOptions(gl, options);\r\n\r\n\tvar fb = gl.createFramebuffer();\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, fb);\r\n\r\n\tif ((depthTarget != undefined) && (depthTarget != null) && (depthTarget != gl.NONE)) {\r\n\t\tif (depthTarget.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, depthTarget.handle, 0);\r\n\t\t}\r\n\t\telse if (depthTarget.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthTarget.handle);\r\n\t\t}\r\n\t}\r\n\r\n\tif ((stencilTarget != undefined) && (stencilTarget != null) && (stencilTarget != gl.NONE)) {\r\n\t\tif (stencilTarget.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.TEXTURE_2D, stencilTarget.handle, 0);\r\n\t\t}\r\n\t\telse if (stencilTarget.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.RENDERBUFFER, stencilTarget.handle);\r\n\t\t}\r\n\t}\r\n\r\n\tvar cts = [ ];\r\n\tvar drawBuffers = [ ];\r\n\tif ((colorTargets != undefined) && (colorTargets != null)) {\r\n\t\tvar n = colorTargets.length;\r\n\t\tif (n == 0) {\r\n\t\t\tdrawBuffers.push(gl.NONE);\r\n\t\t\t//gl.readBuffer(gl.NONE);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar att = gl.COLOR_ATTACHMENT0;\r\n\t\t\tfor (var c in colorTargets) {\r\n\t\t\t\tvar ct = colorTargets[c];\r\n\t\t\t\tif (ct.target == gl.TEXTURE_2D) {\r\n\t\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, ct.handle, 0);\r\n\t\t\t\t}\r\n\t\t\t\telse if (ct.target == gl.RENDERBUFFER) {\r\n\t\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, ct.handle);\r\n\t\t\t\t}\r\n\t\t\t\tdrawBuffers.push(att);\r\n\t\t\t\tcts.push(ct);\r\n\t\t\t\tatt++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//gl.drawBuffers(drawBuffers);\r\n\tvar fbStatus = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n\tvar trg = null;\r\n\tif (cts.length > 0) {\r\n\t\ttrg = cts[0];\r\n\t}\r\n\telse if (depthTarget) {\r\n\t\ttrg = depthTarget;\r\n\t}\r\n\telse if (stencilTarget) {\r\n\t\ttrg = stencilTarget;\r\n\t}\r\n\r\n\tvar width  = 0;\r\n\tvar height = 0;\r\n\tif (trg) {\r\n\t\twidth  = trg.width;\r\n\t\theight = trg.height;\r\n\t}\r\n\r\n\tvar obj = new SglFramebufferInfo()\r\n\tobj.handle        = fb;\r\n\tobj.valid         = (fbStatus == gl.FRAMEBUFFER_COMPLETE);\r\n\tobj.width         = width;\r\n\tobj.height        = height;\r\n\tobj.colorTargets  = cts;\r\n\tobj.depthTarget   = (depthTarget  ) ? (depthTarget  ) : (null);\r\n\tobj.stencilTarget = (stencilTarget) ? (stencilTarget) : (null);\r\n\tobj.status        = fbStatus;\r\n\r\n\treturn obj;\r\n}\r\n\r\nfunction sglFramebufferFromFormats(gl, width, height, colorFormats, depthFormat, stencilFormat, options) {\r\n\tvar opt = sglGetFramebufferOptions(gl, options);\r\n\r\n\tvar colorTargets = null;\r\n\tif (colorFormats) {\r\n\t\topt.isDepth = false;\r\n\t\tcolorTargets = [ ];\r\n\t\tvar ct = null;\r\n\t\tif (opt.colorsAsRenderbuffer) {\r\n\t\t\tfor (var c in colorFormats) {\r\n\t\t\t\tvar cc = colorFormats[c];\r\n\t\t\t\tct = sglRenderbufferFromFormat(gl, cc, width, height);\r\n\t\t\t\tcolorTargets.push(ct);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateColorsMipmap;\r\n\t\t\tfor (var c in colorFormats) {\r\n\t\t\t\tvar cc = colorFormats[c];\r\n\t\t\t\tct = sglTexture2DFromData(gl, cc, width, height, gl.RGBA, gl.UNSIGNED_BYTE, null, opt);\r\n\t\t\t\tcolorTargets.push(ct);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar depthTarget = null;\r\n\tif (depthFormat) {\r\n\t\topt.isDepth = true;\r\n\t\tif (opt.depthAsRenderbuffer) {\r\n\t\t\tdepthTarget = sglRenderbufferFromFormat(gl, depthFormat, width, height);\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateDepthMipmap;\r\n\t\t\tdepthTarget = sglTexture2DFromData(gl, depthFormat, width, height, gl.DEPTH_COMPONENT, gl.FLOAT, null, opt);\r\n\t\t}\r\n\t}\r\n\r\n\tvar stencilTarget = null;\r\n\tif (stencilFormat) {\r\n\t\topt.isDepth = false;\r\n\t\tif (opt.stencilAsRenderbuffer) {\r\n\t\t\tstencilTarget = sglRenderbufferFromFormat(gl, stencilFormat, width, height);\r\n\t\t}\r\n\t\telse {\r\n\t\t\topt.generateMipmap = opt.generateStencilMipmap;\r\n\t\t\tstencilTarget = sglTexture2DFromData(gl, stencilFormat, width, height, gl.STENCIL_COMPONENT, gl.UNSIGNED_BYTE, null, opt);\r\n\t\t}\r\n\t}\r\n\r\n\treturn sglFramebufferFromTargets(gl, colorTargets, depthTarget, stencilTarget, opt);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglVertexBuffer\r\n/***********************************************************************/\r\n// SglVertexBuffer(gl, info)\r\n// SglVertexBuffer(gl, values, usage)\r\n/**\r\n * Constructs a SglVertexBuffer.\r\n * @class Manages a WebGL vertex buffer object.\r\n */\r\nfunction SglVertexBuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\tif (arguments[1] instanceof SglBufferInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglVertexBufferFromData(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n}\r\n\r\nSglVertexBuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid) {\r\n\t\t\tthis.gl.deleteBuffer(this._info.handle);\r\n\t\t}\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglIndexBuffer\r\n/***********************************************************************/\r\n// SglIndexBuffer(gl, info)\r\n// SglIndexBuffer(gl, values, usage)\r\n/**\r\n * Constructs a SglIndexBuffer.\r\n * @class Manages a WebGL index buffer object.\r\n */\r\nfunction SglIndexBuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\tif (arguments[1] instanceof SglBufferInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglIndexBufferFromData(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n}\r\n\r\nSglIndexBuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid) {\r\n\t\t\tthis.gl.deleteBuffer(this._info.handle);\r\n\t\t}\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramAttribute\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramAttribute.\r\n * @class Manages a program attribute.\r\n */\r\nfunction SglProgramAttribute(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n}\r\n\r\nSglProgramAttribute.prototype = {\r\n\tset index(n) {\r\n\t\tthis._prog.gl.bindAttribLocation(this._prog._info.handle, n, this._info.name)\r\n\t\tthis._info.location = n;\r\n\t},\r\n\r\n\tget index () {\r\n\t\treturn this._info.location;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramUniform\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramUniform.\r\n * @class Manages a program uniform.\r\n */\r\nfunction SglProgramUniform(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n\tthis._func = null;\r\n\r\n\tvar gl   = this._prog.gl;\r\n\tvar type = this._info.nativeType;\r\n\r\n\tif (type == gl.BOOL) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1i(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.BOOL_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1i(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.INT_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4iv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform1f(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform2fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform3fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_VEC4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniform4fv(this._info.location, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT2) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix2fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT3) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix3fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse if (type == gl.FLOAT_MAT4) {\r\n\t\tthis._func = function (v) { this._prog.gl.uniformMatrix4fv(this._info.location, this._prog.gl.FALSE, v); };\r\n\t}\r\n\telse {\r\n\t\tsglUnknown();\r\n\t}\r\n}\r\n\r\nSglProgramUniform.prototype = {\r\n\tset value(v) {\r\n\t\tthis._func(v);\r\n\t},\r\n\r\n\tget value() {\r\n\t\treturn this._prog.gl.getUniform(this._prog._info.handle, this._info.location);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgramSampler\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglProgramSampler.\r\n * @class Manages a program sampler.\r\n */\r\nfunction SglProgramSampler(program, info) {\r\n\tthis._prog = program;\r\n\tthis._info = info;\r\n\tthis._unit = -1;\r\n\r\n\tvar gl   = this._prog.gl;\r\n\tvar type = this._info.nativeType;\r\n\r\n\tif (type == gl.SAMPLER_2D) {\r\n\t\t;\r\n\t}\r\n\telse if (type == gl.SAMPLER_CUBE) {\r\n\t\t;\r\n\t}\r\n\telse if (type == 35682) {\r\n\t\t;\r\n\t}\r\n\telse {\r\n\t\tsglUnknown();\r\n\t}\r\n}\r\n\r\nSglProgramSampler.prototype = {\r\n\tset unit(n) {\r\n\t\tthis._prog.gl.uniform1i(this._info.location, n);\r\n\t\tthis._unit = n;\r\n\t},\r\n\r\n\tget unit() {\r\n\t\t//return this._prog.gl.getUniform(this._prog._info.handle, this._info.location);\r\n\t\treturn this._unit;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglProgram\r\n/***********************************************************************/\r\n// SglProgram(gl, info)\r\n// SglProgram(gl, [vertexSources], [fragmentSources])\r\n/**\r\n * Constructs a SglProgram.\r\n * @class Manages a WebGL program object.\r\n */\r\nfunction SglProgram() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tif (arguments[1] instanceof SglProgramInfo) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglProgramFromSources(this.gl, arguments[1], arguments[2]);\r\n\t}\r\n\r\n\tthis._attributes = new Object();\r\n\tfor (var a in this._info.attributes) {\r\n\t\tthis._attributes[a] = new SglProgramAttribute(this, this._info.attributes[a]);\r\n\t}\r\n\r\n\tthis._uniforms = new Object();\r\n\tfor (var u in this._info.uniforms) {\r\n\t\tthis._uniforms[u] = new SglProgramUniform(this, this._info.uniforms[u]);\r\n\t}\r\n\r\n\tvar unit = 0;\r\n\tthis._samplers = new Object();\r\n\tfor (var s in this._info.samplers) {\r\n\t\tthis._samplers[s] = new SglProgramSampler(this, this._info.samplers[s]);\r\n\t\tthis._samplers[s]._unit = unit;\r\n\t\tunit++;\r\n\t}\r\n}\r\n\r\nSglProgram.prototype =\r\n{\r\n\tget info()       { return this._info;        },\r\n\tget attributes() { return this._attributes;  },\r\n\tget uniforms()   { return this._uniforms;    },\r\n\tget samplers()   { return this._samplers;    },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.valid == null) return;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tgl.deleteProgram(this._info.handle);\r\n\t\tfor (var s in this._info.shaders) {\r\n\t\t\tgl.deleteShader(this._info.shaders[s].handle);\r\n\t\t}\r\n\r\n\t\tthis._attributes = null;\r\n\t\tthis._uniforms   = null;\r\n\t\tthis._samplers   = null;\r\n\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tget log() {\r\n\t\tvar log = \"\";\r\n\t\tlog += \"-------------------------------------\\n\";\r\n\t\tfor (var s in this._info.shaders) {\r\n\t\t\tlog += this._info.shaders[s].log;\r\n\t\t}\r\n\t\tlog += this._info.log;\r\n\t\tlog += \"-------------------------------------\\n\";\r\n\t\tlog += \"\\n\";\r\n\t\treturn log;\r\n\t},\r\n\r\n\tsetDefaultBindings : function() {\r\n\t\tsglSetDefaultProgramBindings(this.gl, this._info);\r\n\t},\r\n\r\n\tsynchronize : function() {\r\n\t\tsglProgramSynchronize(this.gl, this._info);\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.useProgram(this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\t//this.gl.useProgram(null);\r\n\t},\r\n\r\n\tsetAttributes : function(mapping) {\r\n\t\tvar attr = null;\r\n\t\tfor (var a in mapping) {\r\n\t\t\tattr = this._attributes[a];\r\n\t\t\tif (attr) {\r\n\t\t\t\tattr.index = mapping[a];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.link();\r\n\t},\r\n\r\n\tsetUniforms : function(mapping) {\r\n\t\tvar unif = null;\r\n\t\tfor (var u in mapping) {\r\n\t\t\tunif = this._uniforms[u];\r\n\t\t\tif (unif) {\r\n\t\t\t\tunif.value = mapping[u];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetSamplers : function(mapping) {\r\n\t\tvar smp = null;\r\n\t\tfor (var s in mapping) {\r\n\t\t\tsmp = this._samplers[s];\r\n\t\t\tif (smp != undefined) {\r\n\t\t\t\tsmp.unit = mapping[s];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTexture2D\r\n/***********************************************************************/\r\n// SglTexture2D(gl, info)\r\n// SglTexture2D(gl, internalFormat, width, height, sourceFormat, sourceType, texels, options)\r\n// SglTexture2D(gl, image, options)\r\n// SglTexture2D(gl, url, options)\r\n/**\r\n * Constructs a SglTexture2D.\r\n * @class Manages a WebGL 2D texture object.\r\n */\r\nfunction SglTexture2D() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif ((n == 2) || (n == 3)) {\r\n\t\tif (arguments[1] instanceof Image) {\r\n\t\t\tthis._info = sglTexture2DFromImage(gl, arguments[1], arguments[2]);\r\n\t\t}\r\n\t\t//else if (arguments[1] instanceof String) {\r\n\t\telse if (typeof(arguments[1]) == \"string\") {\r\n\t\t\tthis._info = sglTexture2DFromUrl(gl, arguments[1], arguments[2]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._info = arguments[1];\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglTexture2DFromData(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7]);\r\n\t}\r\n}\r\n\r\nSglTexture2D.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteTexture(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, null);\r\n\t},\r\n\r\n\tgenerateMipmap : function() {\r\n\t\tthis.gl.generateMipmap(this._info.target);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglTextureCube\r\n/***********************************************************************/\r\n// SglTextureCube(gl, info)\r\n// SglTextureCube(gl, internalFormat, width, height, sourceFormat, sourceType, facesTexels, options)\r\n// SglTextureCube(gl, images, options)\r\n// SglTextureCube(gl, urls, options)\r\n/**\r\n * Constructs a SglTextureCube.\r\n * @class Manages a WebGL cube texture object.\r\n */\r\nfunction SglTextureCube() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif ((n == 2) || (n == 3)) {\r\n\t\tif (arguments[1] instanceof Array) {\r\n\t\t\tif (arguments[1][0] instanceof Image) {\r\n\t\t\t\tthis._info = sglTextureCubeFromImages(gl, arguments[1], arguments[2]);\r\n\t\t\t}\r\n\t\t\t//else if (arguments[1] instanceof String) {\r\n\t\t\telse if (typeof(arguments[1][0]) == \"string\") {\r\n\t\t\t\tthis._info = sglTextureCubeFromUrls(gl, arguments[1], arguments[2]);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._info = arguments[1];\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglTextureCubeFromData(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7]);\r\n\t}\r\n}\r\n\r\nSglTextureCube.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteTexture(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function(unit) {\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unit);\r\n\t\tthis.gl.bindTexture(this._info.target, null);\r\n\t},\r\n\r\n\tgenerateMipmap : function() {\r\n\t\tthis.gl.generateMipmap(this._info.target);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglRenderbuffer\r\n/***********************************************************************/\r\n// SglRenderbuffer(gl, info)\r\n// SglRenderbuffer(gl, format, width, height)\r\n/**\r\n * Constructs a SglRenderbuffer.\r\n * @class Manages a WebGL renderbuffer object.\r\n */\r\nfunction SglRenderbuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif (n == 2) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglRenderbufferFromFormat(gl, arguments[1], arguments[2], arguments[3]);\r\n\t}\r\n}\r\n\r\nSglRenderbuffer.prototype = {\r\n\tget info() { return this._info; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteRenderbuffer(this._info.handle);\r\n\t\tthis._info = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\tthis.gl.bindRenderbuffer(this.gl.RENDERBUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindRenderbuffer(this.gl.RENDERBUFFER, null);\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// SglFramebuffer\r\n/***********************************************************************/\r\n// SglFramebuffer(gl, info)\r\n// SglFramebuffer(gl, width, height, colorFormats, depthFormat, stencilFormat, options)\r\n/**\r\n * Constructs a SglFramebuffer.\r\n * @class Manages a WebGL framebuffer object.\r\n */\r\nfunction SglFramebuffer() {\r\n\tthis.gl    = arguments[0];\r\n\tthis._info = null;\r\n\r\n\tvar gl = this.gl;\r\n\r\n\tvar n = arguments.length;\r\n\tif (n == 2) {\r\n\t\tthis._info = arguments[1];\r\n\t}\r\n\telse {\r\n\t\tthis._info = sglFramebufferFromFormats(gl, arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6]);\r\n\t}\r\n\r\n\tvar s = null;\r\n\tvar t = null;\r\n\r\n\tthis._colorTargets = [ ];\r\n\tfor (var c in this._info.colorTargets) {\r\n\t\ts = this._info.colorTargets[c];\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._colorTargets.push(t);\r\n\t}\r\n\r\n\tthis._depthTarget = null;\r\n\tif (this._info.depthTarget) {\r\n\t\ts = this._info.depthTarget;\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._depthTarget = t;\r\n\t}\r\n\r\n\tthis._stencilTarget = null;\r\n\tif (this._info.stencilTarget) {\r\n\t\ts = this._info.stencilTarget;\r\n\t\tt = null;\r\n\t\tif (s.target == gl.TEXTURE_2D) {\r\n\t\t\tt = new SglTexture2D(gl, s);\r\n\t\t}\r\n\t\telse if (s.target == gl.RENDERBUFFER) {\r\n\t\t\tt = new SglRenderbuffer(gl, s);\r\n\t\t}\r\n\t\tthis._stencilTarget = t;\r\n\t}\r\n}\r\n\r\nSglFramebuffer.prototype = {\r\n\tget info()          { return this._info;          },\r\n\tget colorTargets()  { return this._colorTargets;  },\r\n\tget depthTarget()   { return this._depthTarget;   },\r\n\tget stencilTarget() { return this._stencilTarget; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._info.handle == null) return;\r\n\t\tthis.gl.deleteFramebuffer(this._info.handle);\r\n\t\tfor (var t in this._colorTargets) {\r\n\t\t\tvar ct = this._colorTargets[t];\r\n\t\t\tif (ct) {\r\n\t\t\t\tthis._colorTargets[t].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._depthTarget) {\r\n\t\t\tthis._depthTarget.destroy();\r\n\t\t}\r\n\t\tif (this._stencilTarget) {\r\n\t\t\tthis._stencilTarget.destroy();\r\n\t\t}\r\n\t\tthis._info   = null;\r\n\t\tthis.targets = null;\r\n\t},\r\n\r\n\tget handle() {\r\n\t\treturn this._info.handle;\r\n\t},\r\n\r\n\tget isValid() {\r\n\t\treturn this._info.valid;\r\n\t},\r\n\r\n\tget width() {\r\n\t\treturn this._info.width;\r\n\t},\r\n\r\n\tget height() {\r\n\t\treturn this._info.height;\r\n\t},\r\n\r\n\tbind : function(setViewport) {\r\n\t\tvar vp = true;\r\n\t\tif (setViewport != undefined) vp = setViewport;\r\n\r\n\t\tif (vp) {\r\n\t\t\tthis.gl.viewport(0, 0, this._info.width, this._info.height);\r\n\t\t}\r\n\r\n\t\tthis.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this._info.handle);\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\tthis.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\r\n\t},\r\n\r\n\tbindColor : function(index, unit) {\r\n\t\tthis._colorTargets[index].bind(unit);\r\n\t},\r\n\r\n\tunbindColor : function(index, unit) {\r\n\t\tthis._colorTargets[index].unbind(unit);\r\n\t},\r\n\r\n\tbindDepth : function(unit) {\r\n\t\tthis._depthTarget.bind(unit);\r\n\t},\r\n\r\n\tunbindDepth : function(unit) {\r\n\t\tthis._depthTarget.unbind(unit);\r\n\t},\r\n\r\n\tbindStencil : function(unit) {\r\n\t\tthis._stencilTarget.bind(unit);\r\n\t},\r\n\r\n\tunbindStencil : function(unit) {\r\n\t\tthis._stencilTarget.unbind(unit);\r\n\t},\r\n\r\n\tgenerateMipmap : function(colors, depth, stencil) {\r\n\t\tvar t = null;\r\n\r\n\t\tif (colors) {\r\n\t\t\tfor (var c in this._colorTargets) {\r\n\t\t\t\tt = this._colorTargets[c];\r\n\t\t\t\tif (!t) continue;\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (depth) {\r\n\t\t\tt = this._depthTarget;\r\n\t\t\tif (t) {\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (stencil) {\r\n\t\t\tt = this._stencilTarget;\r\n\t\t\tif (t) {\r\n\t\t\t\tif (t.info.target == this.gl.TEXTURE_2D) {\r\n\t\t\t\t\tt.bind(0);\r\n\t\t\t\t\tt.generateMipmap();\r\n\t\t\t\t\tt.unbind(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tattachColorTarget : function(index, t) {\r\n\t\tif (!t) return false;\r\n\t\tif ((index < 0) || (index >= this._colorTargets.length)) return false;\r\n\t\tif ((t.width != this.width) || (t.height != this.height)) return false;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tvar att = this.gl.COLOR_ATTACHMENT0 + index;\r\n\t\tif (t.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, t.handle, 0);\r\n\t\t}\r\n\t\telse if (t.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, t.handle);\r\n\t\t}\r\n\r\n\t\tthis._colorTargets[index] = t;\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tdetachColorTarget : function(index) {\r\n\t\tif ((index < 0) || (index >= this._colorTargets.length)) return false;\r\n\r\n\t\tvar t = this._colorTargets[index]\r\n\t\tif (!t) return false;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tif (t.target == gl.TEXTURE_2D) {\r\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, att, gl.TEXTURE_2D, null, 0);\r\n\t\t}\r\n\t\telse if (t.target == gl.RENDERBUFFER) {\r\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, att, gl.RENDERBUFFER, null);\r\n\t\t}\r\n\r\n\t\tthis._colorTargets[index] = null;\r\n\r\n\t\treturn true;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglAttributeStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglAttributeStreamJS.\r\n * @class Holds the properties and the storage array of a vertex attribute stream.\r\n */\r\nfunction SglAttributeStreamJS(name, size, values, byCopy) {\r\n\tthis._name = name;\r\n\tthis._size = size;\r\n\tthis._buff = (byCopy) ? ((values) ? (values.slice()) : (null)) : (values);\r\n}\r\n\r\nSglAttributeStreamJS.prototype = {\r\n\tget name()       { return this._name; },\r\n\tget size()       { return this._size; },\r\n\tget buffer()     { return this._buff; },\r\n\tget length()     { return this._buff.length; },\r\n\r\n\tget : function(index) {\r\n\t\treturn this._buff.slice(index * this._size, this._size);\r\n\t},\r\n\r\n\tset : function(index, value) {\r\n\t\tvar k = index * this._size;\r\n\t\tfor (var i=0; i<this._size; ++i) {\r\n\t\t\tthis._buff[k++] = value[i];\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglVertexStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglVertexStreamJS.\r\n * @class Container of vertex attribute streams.\r\n */\r\nfunction SglVertexStreamJS() {\r\n\tthis._attribs = { };\r\n\tthis._length  = 0;\r\n}\r\n\r\nSglVertexStreamJS.prototype = {\r\n\tget attributes() { return this._attribs; },\r\n\tget length()     { return this._length;  },\r\n\r\n\taddAttribute : function(name, size, values, byCopy) {\r\n\t\tvar attr = new SglAttributeStreamJS(name, size, values, byCopy);\r\n\t\tthis._attribs[name] = attr;\r\n\t\tthis._length = attr.length;\r\n\t},\r\n\r\n\tremoveAttribute : function(name) {\r\n\t\tif (!this._attribs[name]) return;\r\n\r\n\t\tdelete this._attribs[name];\r\n\r\n\t\tthis._length = 0;\r\n\t\tfor (var a in this._attribs) {\r\n\t\t\tthis._length = this._attribs[a].length;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\nvar SGL_ARRAY_PRIMITIVE_STREAM          = 1;\r\nvar SGL_INDEXED_PRIMITIVE_STREAM        = 2;\r\nvar SGL_PACKED_INDEXED_PRIMITIVE_STREAM = 3;\r\n\r\nvar SGL_POINTS_LIST    = 1;\r\nvar SGL_LINES_LIST     = 2;\r\nvar SGL_LINE_STRIP     = 3;\r\nvar SGL_LINE_LOOP      = 4;\r\nvar SGL_TRIANGLES_LIST = 5;\r\nvar SGL_TRIANGLE_STRIP = 6;\r\nvar SGL_TRIANGLE_FAN   = 7;\r\n\r\n\r\n// SglPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPrimitiveStreamJS.\r\n * @class Holds the primitives stream information and storage (if any).\r\n */\r\nfunction SglPrimitiveStreamJS(name, mode, first, length) {\r\n\tthis._name = name;\r\n\tthis._mode = mode;\r\n\tthis._first  = (first)  ? (first)  : (0);\r\n\tthis._length = (length) ? (length) : (0);\r\n}\r\n\r\nSglPrimitiveStreamJS.prototype = {\r\n\tget type()   { return undefined;    },\r\n\tget name()   { return this._name;   },\r\n\tget mode()   { return this._mode;   },\r\n\tget first()  { return this._first;  },\r\n\tget length() { return this._length; }\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglArrayPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglArrayPrimitiveStreamJS.\r\n * @class Holds the array primitive stream information.\r\n */\r\nfunction SglArrayPrimitiveStreamJS(name, mode, first, count) {\r\n\tSglPrimitiveStreamJS.call(this, name, mode, first, count);\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_ARRAY_PRIMITIVE_STREAM;}});\r\n}\r\n\r\nsglInherit(SglArrayPrimitiveStreamJS, SglPrimitiveStreamJS);\r\n/*sglDefineGetter(SglArrayPrimitiveStreamJS, \"type\", function() {\r\n\treturn SGL_ARRAY_PRIMITIVE_STREAM;\r\n});*/\r\n/***************************************************************/\r\n\r\n\r\n// SglIndexedPrimitiveStreamJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglIndexedPrimitiveStreamJS.\r\n * @class Holds the indexed primitive stream information and storage.\r\n */\r\nfunction SglIndexedPrimitiveStreamJS(name, mode, indices, byCopy) {\r\n\tSglPrimitiveStreamJS.call(this, name, mode, 0, indices.length);\r\n\r\n\tthis._buff = (byCopy) ? ((indices) ? (indices.slice()) : (null)) : (indices);\r\n\t\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_INDEXED_PRIMITIVE_STREAM;}});\r\n\tObject.defineProperty(this, \"buffer\", {get: function(){return this._buff;}});\r\n\tObject.defineProperty(this, \"length\", {get: function(){return this._buff.length;}});\r\n}\r\n\r\n\r\nsglInherit(SglIndexedPrimitiveStreamJS, SglPrimitiveStreamJS);\r\n/*sglDefineGetter(SglIndexedPrimitiveStreamJS, \"type\", function() {\r\n\treturn SGL_INDEXED_PRIMITIVE_STREAM;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamJS, \"buffer\", function() {\r\n\treturn this._buff;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamJS, \"length\", function() {\r\n\treturn this._buff.length;\r\n});*/\r\n/***************************************************************/\r\n\r\n\r\n// SglConnectivityJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglConnectivityJS.\r\n * @class Container for primitive streams.\r\n */\r\nfunction SglConnectivityJS() {\r\n\tthis._prims = { };\r\n}\r\n\r\nSglConnectivityJS.prototype = {\r\n\tget primitives() { return this._prims; },\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tvar prim = new SglArrayPrimitiveStreamJS(name, mode, first, count)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices, byCopy) {\r\n\t\tvar prim = new SglIndexedPrimitiveStreamJS(name, mode, indices, byCopy)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\tremovePrimitives : function(name) {\r\n\t\tif (!this._prims[name]) return;\r\n\t\tdelete this._prims[name];\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshJS\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglMeshJS.\r\n * @class Mesh definition with vertex stream and primitive stream.\r\n */\r\nfunction SglMeshJS() {\r\n\tthis._valid = false;\r\n\tthis._vert  = new SglVertexStreamJS();\r\n\tthis._conn  = new SglConnectivityJS();\r\n}\r\n\r\nSglMeshJS.prototype = {\r\n\tget isValid()      { return this._valid;  },\r\n\tset isValid(value) { this._valid = value; },\r\n\r\n\tget vertices()     { return this._vert; },\r\n\tget connectivity() { return this._conn; },\r\n\r\n\taddVertexAttribute : function(name, size, values, byCopy) {\r\n\t\tthis._vert.addAttribute(name, size, values, byCopy);\r\n\t},\r\n\r\n\tremoveVertexAttribute : function(name) {\r\n\t\tthis._vert.removeAttribute(name);\r\n\t},\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tthis._conn.addArrayPrimitives(name, mode, first, count);\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices, byCopy) {\r\n\t\tthis._conn.addIndexedPrimitives(name, mode, indices, byCopy);\r\n\t},\r\n\r\n\tremovePrimitives : function(name) {\r\n\t\tthis._conn.removePrimitives(name);\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// importers\r\n/***********************************************************************/\r\nfunction sglMeshJSImportOBJFromString(mesh, text) {\r\n\tvar positionsArray = [ ];\r\n\tvar texcoordsArray = [ ];\r\n\tvar normalsArray   = [ ];\r\n\tvar indicesArray   = [ ];\r\n\r\n\tvar positions = [ ];\r\n\tvar texcoords = [ ];\r\n\tvar normals   = [ ];\r\n\tvar facemap   = { };\r\n\tvar index     = 0;\r\n\r\n\tvar line = null;\r\n\tvar f   = null;\r\n\tvar pos = 0;\r\n\tvar tex = 0;\r\n\tvar nor = 0;\r\n\tvar x   = 0.0;\r\n\tvar y   = 0.0;\r\n\tvar z   = 0.0;\r\n\tvar tokens = null;\r\n\r\n\tvar hasPos = false;\r\n\tvar hasTex = false;\r\n\tvar hasNor = false;\r\n\r\n\tvar lines = text.split(\"\\n\");\r\n\tfor (var lineIndex in lines) {\r\n\t\tline = lines[lineIndex].replace(/[ \\t]+/g, \" \").replace(/\\s\\s*$/, \"\");\r\n\r\n\t\tif (line[0] == \"#\") continue;\r\n\r\n\t\ttokens = line.split(\" \");\r\n\t\tif (tokens[0] == \"v\") {\r\n\t\t\tpositions.push(parseFloat(tokens[1]));\r\n\t\t\tpositions.push(parseFloat(tokens[2]));\r\n\t\t\tpositions.push(parseFloat(tokens[3]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"vt\") {\r\n\t\t\ttexcoords.push(parseFloat(tokens[1]));\r\n\t\t\ttexcoords.push(parseFloat(tokens[2]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"vn\") {\r\n\t\t\tnormals.push(parseFloat(tokens[1]));\r\n\t\t\tnormals.push(parseFloat(tokens[2]));\r\n\t\t\tnormals.push(parseFloat(tokens[3]));\r\n\t\t}\r\n\t\telse if (tokens[0] == \"f\") {\r\n\t\t\tif (tokens.length != 4) continue;\r\n\r\n\t\t\tfor (var i=1; i<4; ++i) {\r\n\t\t\t\tif (!(tokens[i] in facemap)) {\r\n\t\t\t\t\tf = tokens[i].split(\"/\");\r\n\r\n\t\t\t\t\tif (f.length == 1) {\r\n\t\t\t\t\t\tpos = parseInt(f[0]) - 1;\r\n\t\t\t\t\t\ttex = pos;\r\n\t\t\t\t\t\tnor = pos;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (f.length == 3) {\r\n\t\t\t\t\t\tpos = parseInt(f[0]) - 1;\r\n\t\t\t\t\t\ttex = parseInt(f[1]) - 1;\r\n\t\t\t\t\t\tnor = parseInt(f[2]) - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tz = 0.0;\r\n\t\t\t\t\tif ((pos * 3 + 2) < positions.length) {\r\n\t\t\t\t\t\thasPos = true;\r\n\t\t\t\t\t\tx = positions[pos*3+0];\r\n\t\t\t\t\t\ty = positions[pos*3+1];\r\n\t\t\t\t\t\tz = positions[pos*3+2];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpositionsArray.push(x);\r\n\t\t\t\t\tpositionsArray.push(y);\r\n\t\t\t\t\tpositionsArray.push(z);\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tif ((tex * 2 + 1) < texcoords.length) {\r\n\t\t\t\t\t\thasTex = true;\r\n\t\t\t\t\t\tx = texcoords[tex*2+0];\r\n\t\t\t\t\t\ty = texcoords[tex*2+1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttexcoordsArray.push(x);\r\n\t\t\t\t\ttexcoordsArray.push(y);\r\n\r\n\t\t\t\t\tx = 0.0;\r\n\t\t\t\t\ty = 0.0;\r\n\t\t\t\t\tz = 1.0;\r\n\t\t\t\t\tif ((nor * 3 + 2) < normals.length) {\r\n\t\t\t\t\t\thasNor = true;\r\n\t\t\t\t\t\tx = normals[nor*3+0];\r\n\t\t\t\t\t\ty = normals[nor*3+1];\r\n\t\t\t\t\t\tz = normals[nor*3+2];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnormalsArray.push(x);\r\n\t\t\t\t\tnormalsArray.push(y);\r\n\t\t\t\t\tnormalsArray.push(z);\r\n\r\n\t\t\t\t\tfacemap[tokens[i]] = index++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tindicesArray.push(facemap[tokens[i]]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (hasPos) {\r\n\t\tmesh.addVertexAttribute(\"position\", 3, positionsArray, false);\r\n\t}\r\n\tif (hasNor) {\r\n\t\tmesh.addVertexAttribute(\"normal\", 3, normalsArray, false);\r\n\t}\r\n\tif (hasTex) {\r\n\t\tmesh.addVertexAttribute(\"texcoord\", 2, texcoordsArray, false);\r\n\t}\r\n\r\n\tif (indicesArray.length > 0) {\r\n\t\tmesh.addIndexedPrimitives(\"triangles\", SGL_TRIANGLES_LIST, indicesArray, false);\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction sglMeshJSImportOBJFromURL(mesh, url, asynch, callback) {\r\n\tmesh.isValid = false;\r\n\r\n\tif (!asynch) {\r\n\t\tvar txt = sglLoadFile(url);\r\n\t\tmesh.isValid = sglMeshJSImportOBJFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t\treturn mesh.isValid;\r\n\t}\r\n\r\n\tsglLoadFile(url, function(txt) {\r\n\t\tmesh.isValid = sglMeshJSImportOBJFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t});\r\n\r\n\treturn true;\r\n}\r\n\r\nSglMeshJS.prototype.parseOBJ = function(txt) {\r\n\tthis.isValid = sglMeshJSImportOBJFromString(this, txt);\r\n\treturn this.isValid;\r\n};\r\n\r\nSglMeshJS.prototype.importOBJ = function(url, asynch, callback) {\r\n\treturn sglMeshJSImportOBJFromURL(this, url, asynch, callback);\r\n};\r\n\r\nfunction _sglFindVertexAttributeJSON(m, name) {\r\n\tfor (var a in m.vertices) {\r\n\t\tif (m.vertices[a].name === name) {\r\n\t\t\treturn m.vertices[a];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction _sglFindConnectivityJSON(m, name) {\r\n\tfor (var a in m.connectivity) {\r\n\t\tif (m.connectivity[a].name === name) {\r\n\t\t\treturn m.connectivity[a];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction sglMeshJSImportJSONFromString(mesh, text) {\r\n\tvar m = JSON.parse(text);\r\n\tif (!m) return false;\r\n\r\n\tvar mapping = m.mapping;\r\n\tvar stdMapping = null;\r\n\tfor (var v in mapping) {\r\n\t\tif (mapping[v].name === \"standard\") {\r\n\t\t\tstdMapping = mapping[v];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (!stdMapping) return false;\r\n\r\n\tfor (var a in stdMapping.attributes) {\r\n\t\tvar vm = stdMapping.attributes[a];\r\n\t\tvar vattr = _sglFindVertexAttributeJSON(m, vm.source);\r\n\t\tif (!vattr) continue;\r\n\t\tif (vattr.normalized) {\r\n\t\t\tfor (var i=0, n=vattr.values.length; i<n; ++i) {\r\n\t\t\t\tvattr.values[i] /= 255.0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmesh.addVertexAttribute(vm.semantic, vattr.size, vattr.values, false);\r\n\t}\r\n\r\n\tvar conn = _sglFindConnectivityJSON(m, stdMapping.primitives);\r\n\tif (!conn) return false;\r\n\tmesh.addIndexedPrimitives(conn.name, SGL_TRIANGLES_LIST, conn.indices, false);\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction sglMeshJSImportJSONFromURL(mesh, url, asynch, callback) {\r\n\tmesh.isValid = false;\r\n\r\n\tif (!asynch) {\r\n\t\tvar txt = sglLoadFile(url);\r\n\t\tmesh.isValid = sglMeshJSImportJSONFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t\treturn mesh.isValid;\r\n\t}\r\n\r\n\tsglLoadFile(url, function(txt) {\r\n\t\tmesh.isValid = sglMeshJSImportJSONFromString(mesh, txt);\r\n\t\tif (callback) {\r\n\t\t\tcallback(mesh, url);\r\n\t\t}\r\n\t});\r\n\r\n\treturn true;\r\n}\r\n\r\nSglMeshJS.prototype.parseJSON = function(txt) {\r\n\tthis.isValid = sglMeshJSImportJSONFromString(this, txt);\r\n\treturn this.isValid;\r\n};\r\n\r\nSglMeshJS.prototype.importJSON = function(url, asynch, callback) {\r\n\treturn sglMeshJSImportJSONFromURL(this, url, asynch, callback);\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// utilities\r\n/***************************************************************/\r\nfunction sglGLTypeSize(gl, type) {\r\n\tif (type == gl.BYTE)           return 1;\r\n\tif (type == gl.UNSIGNED_BYTE)  return 1;\r\n\tif (type == gl.SHORT)          return 2;\r\n\tif (type == gl.UNSIGNED_SHORT) return 2;\r\n\tif (type == gl.INT)            return 4;\r\n\tif (type == gl.UNSIGNED_INT)   return 4;\r\n\tif (type == gl.FLOAT)          return 4;\r\n\treturn null;\r\n}\r\n\r\nfunction sglGLTypeFromWebGLArray(gl, wglArray) {\r\n\tif (wglArray instanceof Int8Array   ) return gl.BYTE;\r\n\tif (wglArray instanceof Uint8Array  ) return gl.UNSIGNED_BYTE;\r\n\tif (wglArray instanceof Int16Array  ) return gl.SHORT;\r\n\tif (wglArray instanceof Uint16Array ) return gl.UNSIGNED_SHORT;\r\n\tif (wglArray instanceof Int32Array  ) return gl.INT;\r\n\tif (wglArray instanceof Uint32Array ) return gl.UNSIGNED_INT;\r\n\tif (wglArray instanceof Float32Array) return gl.FLOAT;\r\n\treturn null;\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglAttributeStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglAttributeStreamGL.\r\n * @class Holds the properties and the storage buffer of a vertex attribute stream.\r\n */\r\nfunction SglAttributeStreamGL(gl, name, size, values, normalized) {\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, values);\r\n\tvar stride = sglGLTypeSize(gl, type) * size;\r\n\r\n\tthis.gl      = gl;\r\n\tthis._name   = name;\r\n\tthis._size   = size;\r\n\tthis._type   = type;\r\n\tthis._norm   = (normalized) ? (true) : (false);\r\n\tthis._stride = stride;\r\n\tthis._offset = 0;\r\n\tthis._length = values.length / size;\r\n\tthis._buff   = new SglVertexBuffer(gl, values, { usage : gl.STATIC_DRAW });\r\n}\r\n\r\nSglAttributeStreamGL.prototype = {\r\n\tget name()         { return this._name;   },\r\n\tget size()         { return this._size;   },\r\n\tget type()         { return this._type;   },\r\n\tget isNormalized() { return this._norm;   },\r\n\tget stride()       { return this._stride; },\r\n\tget offset()       { return this._offset; },\r\n\tget buffer()       { return this._buff;   },\r\n\tget length()       { return this._length; },\r\n\r\n\tdestroy : function() {\r\n\t\tthis._buff.destroy();\r\n\t},\r\n\r\n\tbind : function(index, baseVertex) {\r\n\t\tvar off = ((baseVertex) ? (baseVertex) : (0)) * this._stride;\r\n\t\tthis._buff.bind();\r\n\t\tthis.gl.vertexAttribPointer(index, this._size, this._type, this._norm, this._stride, this._offset + off);\r\n\t},\r\n\r\n\tunbind : function(index) {\r\n\t\tthis._buff.unbind();\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglVertexStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglVertexStreamGL.\r\n * @class Container of vertex attribute streams.\r\n */\r\nfunction SglVertexStreamGL(gl) {\r\n\tthis.gl       = gl;\r\n\tthis._attribs = new Object();\r\n\tthis._length  = 0;\r\n}\r\n\r\nSglVertexStreamGL.prototype = {\r\n\tget attributes() { return this._attribs; },\r\n\tget length()     { return this._length;  },\r\n\r\n\tdestroy : function() {\r\n\t\tfor (var attr in this._attribs) {\r\n\t\t\tthis._attribs[attr].destroy();\r\n\t\t}\r\n\t},\r\n\r\n\taddAttribute : function(name, size, normalized, values) {\r\n\t\tvar attr = new SglAttributeStreamGL(this.gl, name, size, normalized, values)\r\n\t\tthis._attribs[name] = attr;\r\n\t\tthis._length = attr.length;\r\n\t},\r\n\r\n\tremoveAttribute : function(name, doDestroy) {\r\n\t\tif (!this._attribs[name]) return;\r\n\r\n\t\tif (doDestroy) {\r\n\t\t\tthis._attribs[name].destroy();\r\n\t\t}\r\n\r\n\t\tdelete this._attribs[name];\r\n\r\n\t\tthis._length = 0;\r\n\t\tfor (var a in this._attribs) {\r\n\t\t\tthis._length = this._attribs[a].length;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\tbind : function(mapping, baseVertex) {\r\n\t\tvar vm = null;\r\n\t\tfor (var m in mapping) {\r\n\t\t\tvm = this._attribs[m];\r\n\t\t\tif (vm) {\r\n\t\t\t\tvm.bind(mapping[m], baseVertex)\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tunbind : function(mapping) {\r\n\t\tvar vm = null;\r\n\t\tfor (var m in mapping) {\r\n\t\t\tvm = this._attribs[m];\r\n\t\t\tif (vm) {\r\n\t\t\t\tvm.unbind(mapping[m])\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPrimitiveStreamGL.\r\n * @class Holds the primitives stream information and storage (if any).\r\n */\r\nfunction SglPrimitiveStreamGL(gl, name, mode, first, length) {\r\n\tthis.gl      = gl;\r\n\tthis._name   = name;\r\n\tthis._mode   = mode;\r\n\tthis._first  = (first)  ? (first)  : (0);\r\n\tthis._length = (length) ? (length) : (0);\r\n}\r\n\r\nSglPrimitiveStreamGL.prototype = {\r\n\t_clampRange : function(first, count) {\r\n\t\tvar end = this._first + this._length;\r\n\r\n\t\tvar f = this._first + ((first >= 0) ? (first) : (0));\r\n\t\tif (f >= end) return null;\r\n\r\n\t\tvar c = (count >= 0) ? (count) : (this._length);\r\n\t\tvar vEnd = (f + c);\r\n\t\tif (vEnd > end) c -= vEnd - end;\r\n\r\n\t\treturn [f, c];\r\n\t},\r\n\r\n\t_render : function(first, count) {\r\n\t\t;\r\n\t},\r\n\r\n\tget type()   { return undefined;    },\r\n\tget name()   { return this._name;   },\r\n\tget mode()   { return this._mode;   },\r\n\tget first()  { return this._first;  },\r\n\tget length() { return this._length; },\r\n\r\n\tdestroy : function() {\r\n\t\tif (this._destroy) {\r\n\t\t\tthis._destroy();\r\n\t\t}\r\n\t},\r\n\r\n\tbind : function() {\r\n\t\t;\r\n\t},\r\n\r\n\tunbind : function() {\r\n\t\t;\r\n\t},\r\n\r\n\trender : function(first, count) {\r\n\t\tvar range = this._clampRange(first, count);\r\n\t\tthis._render(range[0], range[1]);\r\n\t}\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglArrayPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglArrayPrimitiveStreamGL.\r\n * @class Holds the array primitive stream information.\r\n */\r\nfunction SglArrayPrimitiveStreamGL(gl, name, mode, first, count) {\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, first, count);\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_ARRAY_PRIMITIVE_STREAM;}});\r\n}\r\n\r\nsglInherit(SglArrayPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n/*sglDefineGetter(SglArrayPrimitiveStreamGL, \"type\", function() {\r\n\treturn SGL_ARRAY_PRIMITIVE_STREAM;\r\n});*/\r\n\r\n\r\n\r\nSglArrayPrimitiveStreamGL.prototype._render = function(first, count) {\r\n\tthis.gl.drawArrays(this._mode, first, count);\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglIndexedPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglIndexedPrimitiveStreamGL.\r\n * @class Holds the indexed primitive stream information and storage.\r\n */\r\nfunction SglIndexedPrimitiveStreamGL(gl, name, mode, indices) {\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, 0, indices.length);\r\n\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, indices);\r\n\tvar stride = sglGLTypeSize(gl, type);\r\n\r\n\tthis._idxType = type;\r\n\tthis._stride  = stride;\r\n\tthis._buff    = new SglIndexBuffer(gl, indices, { usage : gl.STATIC_DRAW });\r\n\t\r\n\tObject.defineProperty(this, \"indexType\", {get: function(){return this._idxType;}});\r\n\tObject.defineProperty(this, \"stride\", {get: function(){return this._stride;}});\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_INDEXED_PRIMITIVE_STREAM;}});\r\n}\r\n\r\n\r\nsglInherit(SglIndexedPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n/*sglDefineGetter(SglIndexedPrimitiveStreamGL, \"indexType\", function() {\r\n\treturn this._idxType;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamGL, \"stride\", function() {\r\n\treturn this._stride;\r\n});\r\n\r\nsglDefineGetter(SglIndexedPrimitiveStreamGL, \"type\", function() {\r\n\treturn SGL_INDEXED_PRIMITIVE_STREAM;\r\n});*/\r\n\r\nSglIndexedPrimitiveStreamGL.prototype._destroy = function() {\r\n\tthis._buff.destroy();\r\n\tthis._buff = null;\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype.bind = function() {\r\n\tthis._buff.bind();\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype.unbind = function() {\r\n\tthis._buff.unbind();\r\n}\r\n\r\nSglIndexedPrimitiveStreamGL.prototype._render = function(first, count) {\r\n\tthis.gl.drawElements(this._mode, count, this._idxType, first * this._stride);\r\n}\r\n\r\n\r\n\r\n/***************************************************************/\r\n\r\n\r\n// SglPackedIndexedPrimitiveStreamGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglPackedIndexedPrimitiveStream.\r\n * @class Holds the packed indexed primitive stream information and storage.\r\n */\r\nfunction SglPackedIndexedPrimitiveStreamGL(gl, name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\tif (blockStartingIndices.length != blockStartingVertices.length) {\r\n\t\tsglInvalidParameter();\r\n\t}\r\n\r\n\tSglPrimitiveStreamGL.call(this, gl, name, mode, 0, indices.length);\r\n\r\n\tvar type   = sglGLTypeFromWebGLArray(gl, indices);\r\n\tvar stride = sglGLTypeSize(gl, type);\r\n\r\n\tthis._idxType = type;\r\n\tthis._stride  = stride;\r\n\tthis._buff    = new SglIndexBuffer(gl, indices, { usage : gl.STATIC_DRAW });\r\n\r\n\r\n\tthis._blockStartingVertices = blockStartingVertices.slice();\r\n\tvar n = this._blockStartingVertices.length;\r\n\r\n\tthis._blockStartingIndices = blockStartingIndices.slice();\r\n\tthis._blockIndicesCount    = new Array(n);\r\n\r\n\tvar start = this._blockStartingIndices[0];\r\n\tfor (var i=0; i<(n-1); ++i) {\r\n\t\tvar sIdx = this._blockStartingIndices[i+1];\r\n\t\tthis._blockIndicesCount[i] = sIdx - start;\r\n\t\tstart = sIdx;\r\n\t}\r\n\tthis._blockIndicesCount[n-1] = indices.length - start;\r\n\t\r\n\tObject.defineProperty(this, \"isPacked\", {get: function(){return true;}});\r\n\tObject.defineProperty(this, \"indexType\", {get: function(){return this._idxType;}});\r\n\tObject.defineProperty(this, \"stride\", {get: function(){return this._stride;}});\r\n\tObject.defineProperty(this, \"type\", {get: function(){return SGL_PACKED_INDEXED_PRIMITIVE_STREAM;}});\r\n\tObject.defineProperty(this, \"blocksCount\", {get: function(){return this._blockStartingIndices.length;}});\r\n\tObject.defineProperty(this, \"blockStartingVertices\", {get: function(){return this._blockStartingVertices;}});\r\n\tObject.defineProperty(this, \"blockIndicesCount\", {get: function(){return this._blockIndicesCount;}});\r\n}\r\n\r\nsglInherit(SglPackedIndexedPrimitiveStreamGL, SglPrimitiveStreamGL);\r\n\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype._destroy = function() {\r\n\tthis._buff.destroy();\r\n\tthis._buff = null;\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.bind = function() {\r\n\tthis._buff.bind();\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.unbind = function() {\r\n\tthis._buff.unbind();\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype._clampBlockRange = function(block, first, count) {\r\n\tvar end = this._blockStartingIndices[block] + this._blockIndicesCount[block];\r\n\r\n\tvar f = this._blockStartingIndices[block] + ((first >= 0) ? (first) : (0));\r\n\tif (f >= end) return null;\r\n\r\n\tvar c = (count >= 0) ? (count) : (this._blockIndicesCount[block]);\r\n\tvar vEnd = (f + c);\r\n\tif (vEnd > end) c -= vEnd - end;\r\n\r\n\treturn [f, c];\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.blockRanges = function(first, count) {\r\n\tvar range = this._clampRange(first, count);\r\n\tvar n     = this._blockStartingIndices.length;\r\n\r\n\tvar firstBlock = 0;\r\n\twhile ((firstBlock < n) && (range[0] < this._blockStartingIndices[firstBlock])) {\r\n\t\tfirstBlock++;\r\n\t}\r\n\tif (firstBlock >= n) return null;\r\n\r\n\tvar last = range[0] + range[1] - 1;\r\n\tvar lastBlock = firstBlock;\r\n\twhile ((lastBlock < n) && (last >= (this._blockStartingIndices[lastBlock] + this._blockIndicesCount[lastBlock]))) {\r\n\t\tlastBlock++;\r\n\t}\r\n\tif (lastBlock >= n) lastBlock = n - 1;\r\n\r\n\tvar ranges = [ ];\r\n\tvar f = range[0] - this._blockStartingIndices[firstBlock];\r\n\tvar c = range[1];\r\n\tvar e = f + range[1];\r\n\tif (e > this._blockIndicesCount[firstBlock]) c = this._blockIndicesCount[firstBlock] - this._blockStartingIndices[firstBlock];\r\n\tranges.push([firstBlock, f, c, this._blockStartingVertices[firstBlock]]);\r\n\tfor (var i=firstBlock+1; i<lastBlock; ++i) {\r\n\t\tranges.push([i, 0, this._blockIndicesCount[i], this._blockStartingVertices[i]]);\r\n\t}\r\n\tif (lastBlock > firstBlock) {\r\n\t\tranges.push([i, 0, range[0] + range[1] - this._blockStartingIndices[lastBlock], this._blockStartingVertices[lastBlock]]);\r\n\t}\r\n\r\n\treturn ranges;\r\n}\r\n\r\nSglPackedIndexedPrimitiveStreamGL.prototype.renderBlock = function(block, first, count) {\r\n\tvar range = this._clampBlockRange(block, first, count);\r\n\tthis.gl.drawElements(this._mode, range[1], this._idxType, range[0] * this._stride);\r\n}\r\n/***************************************************************/\r\n\r\n\r\n// SglConnectivityGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglConnectivityGL.\r\n * @class Container of primitive streams.\r\n */\r\nfunction SglConnectivityGL(gl) {\r\n\tthis.gl     = gl;\r\n\tthis._prims = new Object();\r\n}\r\n\r\nSglConnectivityGL.prototype = {\r\n\tget primitives() { return this._prims; },\r\n\r\n\tdestroy : function() {\r\n\t\tfor (var prim in this._prims) {\r\n\t\t\tthis._prims[prim].destroy();\r\n\t\t}\r\n\t},\r\n\r\n\taddArrayPrimitives: function(name, mode, first, count) {\r\n\t\tvar prim = new SglArrayPrimitiveStreamGL(this.gl, name, mode, first, count)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices) {\r\n\t\tvar prim = new SglIndexedPrimitiveStreamGL(this.gl, name, mode, indices)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\taddPackedIndexedPrimitives : function(name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\t\tvar prim = new SglPackedIndexedPrimitiveStreamGL(this.gl, name, mode, indices, blockStartingIndices, blockStartingVertices)\r\n\t\tthis._prims[name] = prim;\r\n\t},\r\n\r\n\tremovePrimitives : function(name, doDestroy) {\r\n\t\tif (!this._prims[name]) return;\r\n\r\n\t\tif (doDestroy) {\r\n\t\t\tthis._prims[name].destroy();\r\n\t\t}\r\n\r\n\t\tdelete this._prims[name];\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshGL\r\n/***************************************************************/\r\n/**\r\n * Constructs a SglMeshGL.\r\n * @class Mesh definition with vertex stream and primitive stream.\r\n */\r\nfunction SglMeshGL(gl) {\r\n\tthis.gl    = gl;\r\n\tthis._vert = new SglVertexStreamGL(this.gl);\r\n\tthis._conn = new SglConnectivityGL(this.gl);\r\n}\r\n\r\nSglMeshGL.prototype = {\r\n\tget vertices()     { return this._vert; },\r\n\tget connectivity() { return this._conn; },\r\n\r\n\tdestroy : function() {\r\n\t\tthis._vert.destroy();\r\n\t\tthis._conn.destroy();\r\n\t},\r\n\r\n\taddVertexAttribute : function(name, size, values, normalized) {\r\n\t\tthis._vert.addAttribute(name, size, values, normalized);\r\n\t},\r\n\r\n\tremoveVertexAttribute : function(name, doDestroy) {\r\n\t\tthis._vert.removeAttribute(name, doDestroy);\r\n\t},\r\n\r\n\taddArrayPrimitives : function(name, mode, first, count) {\r\n\t\tthis._conn.addArrayPrimitives(name, mode, first, count);\r\n\t},\r\n\r\n\taddIndexedPrimitives : function(name, mode, indices) {\r\n\t\tthis._conn.addIndexedPrimitives(name, mode, indices);\r\n\t},\r\n\r\n\taddPackedIndexedPrimitives : function(name, mode, indices, blockStartingIndices, blockStartingVertices) {\r\n\t\tthis._conn.addPackedIndexedPrimitives(name, mode, indices, blockStartingIndices, blockStartingVertices);\r\n\t},\r\n\r\n\tremovePrimitives : function(name, doDestroy) {\r\n\t\tthis._conn.removePrimitives(name, doDestroy);\r\n\t}\r\n};\r\n/***************************************************************/\r\n\r\n\r\n// SglMeshRenderer\r\n/***************************************************************/\r\nvar SGL_DefaultStreamMappingPrefix = \"a_\";\r\n\r\n/**\r\n * Constructs a SglMeshGLRenderer.\r\n * @class Takes charge of mesh rendering, including program attributes, uniforms and samplers bindings.\r\n */\r\nfunction SglMeshGLRenderer(program, doSynchronize) {\r\n\tthis._prog        = program;\r\n\tthis._mapping     = null;\r\n\tthis._meshAttrMap = null;\r\n\tthis._mesh        = null;\r\n\tthis._primStream  = null;\r\n\tthis._phase       = 0;\r\n\r\n\tthis._updateEnabledVB = false;\r\n\r\n\tif (doSynchronize) {\r\n\t\tthis.synchronizeProgram();\r\n\t}\r\n\r\n\tthis.setStreamMapping();\r\n}\r\n\r\nSglMeshGLRenderer.prototype = {\r\n\t_bindVertexBuffers : function(baseVertex) {\r\n\t\tthis._mesh.vertices.bind(this._meshAttrMap, baseVertex);\r\n\t},\r\n\r\n\t_unbindVertexBuffers : function() {\r\n\t\tthis._mesh.vertices.unbind(this._meshAttrMap);\r\n\t},\r\n\r\n\tget program() { return this.prog; },\r\n\r\n\tsynchronizeProgram : function() {\r\n\t\tthis._prog.synchronize();\r\n\r\n\t\tvar doLink = false;\r\n\t\tvar index = 0;\r\n\t\tvar attr = null;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tattr = this._prog.attributes[a];\r\n\t\t\tif (attr.index != index) {\r\n\t\t\t\tattr.index = index;\r\n\t\t\t\tdoLink = true;\r\n\t\t\t}\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\tif (doLink) {\r\n\t\t\tthis._prog.link();\r\n\t\t}\r\n\r\n\t\tvar unit = 0;\r\n\t\tvar smp = null;\r\n\t\tfor (var s in this._prog.samplers) {\r\n\t\t\tsmp = this._prog.samplers[s];\r\n\t\t\tsmp.unit = unit;\r\n\t\t\tunit++;\r\n\t\t}\r\n\t},\r\n\r\n\tgetStreamMappingFromPrefix : function(prefix) {\r\n\t\tvar n = prefix.length;\r\n\t\tvar mapping = new Object();\r\n\t\tvar src = null;\r\n\t\tfor (var attr in this._prog.attributes) {\r\n\t\t\tif (attr.substr(0, n) == prefix) {\r\n\t\t\t\tsrc = attr.substr(n);\r\n\t\t\t\tif (src.length > 0) {\r\n\t\t\t\t\tmapping[attr] = src;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn mapping;\r\n\t},\r\n\r\n\tsetStreamMapping : function(mapping) {\r\n\t\t//if ((this._phase != 0) && (this._phase != 1)) return;\r\n\r\n\t\tthis._updateEnabledVB = true;\r\n\r\n\t\tvar meshAttrName = null;\r\n\r\n\t\tthis._mapping = this.getStreamMappingFromPrefix(SGL_DefaultStreamMappingPrefix);\r\n\t\tfor (var progAttrName in mapping) {\r\n\t\t\tmeshAttrName = mapping[progAttr];\r\n\t\t\tif (this._prog.attributes[progAttrName]) {\r\n\t\t\t\tthis._mapping[progAttrName] = meshAttrName;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._meshAttrMap = { };\r\n\t\tvar progAttr = null;\r\n\t\tfor (var progAttrName in this._mapping) {\r\n\t\t\tmeshAttrName = this._mapping[progAttrName];\r\n\t\t\tprogAttr     = this._prog.attributes[progAttrName];\r\n\t\t\tthis._meshAttrMap[meshAttrName] = progAttr.index;\r\n\t\t}\r\n\r\n\t\tif (this._mesh) {\r\n\t\t\tthis._bindVertexBuffers(0);\r\n\t\t}\r\n\t},\r\n\r\n\tsetStreamMappingFromPrefix : function(prefix) {\r\n\t\tif (!prefix) prefix = SGL_DefaultStreamMappingPrefix;\r\n\t\tvar mapping = this.getStreamMappingFromPrefix(prefix);\r\n\t\tthis.setStreamMapping(mapping);\r\n\t},\r\n\r\n\tsetUniforms : function(mapping) {\r\n\t\tif (this._phase == 0) return;\r\n\t\tthis._prog.setUniforms(mapping);\r\n\t},\r\n\r\n\tsetSamplers : function(mapping) {\r\n\t\tif (this._phase == 0) return;\r\n\r\n\t\tvar samplers = { };\r\n\t\tvar textures = { };\r\n\r\n\t\tvar t = null;\r\n\t\tfor (var s in mapping) {\r\n\t\t\tt = mapping[s];\r\n\t\t\tif (typeof(t) == \"number\") {\r\n\t\t\t\tsamplers[s] = t;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttextures[s] = t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._prog.setSamplers(samplers);\r\n\r\n\t\tvar smp = null;\r\n\t\tfor (var s in textures) {\r\n\t\t\tsmp = this._prog.samplers[s];\r\n\t\t\tif (smp) {\r\n\t\t\t\ttextures[s].bind(smp.unit);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tbegin : function() {\r\n\t\tif (this._phase != 0) return;\r\n\t\t/*\r\n\t\tvar gl = this._prog.gl;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tgl.enableVertexAttribArray(this._prog.attributes[a].index);\r\n\t\t}\r\n\t\t*/\r\n\t\tthis._prog.bind();\r\n\t\tthis._phase = 1;\r\n\t},\r\n\r\n\tend : function() {\r\n\t\tif (this._phase != 1) return;\r\n\t\tthis._prog.unbind();\r\n\t\tvar gl = this._prog.gl;\r\n\t\tfor (var a in this._prog.attributes) {\r\n\t\t\tgl.disableVertexAttribArray(this._prog.attributes[a].index);\r\n\t\t}\r\n\t\tthis._phase = 0;\r\n\t},\r\n\r\n\tbeginMesh : function(mesh) {\r\n\t\tif (this._phase != 1) return;\r\n\t\tthis._updateEnabledVB = true;\r\n\t\tthis._mesh = mesh;\r\n\t\tthis._bindVertexBuffers(0);\r\n\t\tthis._phase = 2;\r\n\t},\r\n\r\n\tendMesh : function() {\r\n\t\tif (this._phase != 2) return;\r\n\t\tthis._unbindVertexBuffers();\r\n\t\tthis._prog.gl.bindBuffer(this._prog.gl.ARRAY_BUFFER, null);\r\n\t\tthis._mesh = null;\r\n\t\tthis._phase = 1;\r\n\t},\r\n\r\n\tbeginPrimitives : function(name) {\r\n\t\tif (this._phase != 2) return;\r\n\t\tthis._primStream = this._mesh.connectivity.primitives[name];\r\n\t\tthis._primStream.bind();\r\n\t\tthis._phase = 3;\r\n\t},\r\n\r\n\tendPrimitives : function() {\r\n\t\tif (this._phase != 3) return;\r\n\t\tthis._primStream.unbind();\r\n\t\tthis._primStream = null;\r\n\t\tthis._phase = 2;\r\n\t},\r\n\r\n\trender : function(first, count) {\r\n\t\tif (this._phase != 3) return;\r\n\r\n\t\tvar gl = this._prog.gl;\r\n\t\tvar vIndex = 0;\r\n\r\n\t\tif (this._updateEnabledVB) {\r\n\t\t\tthis._updateEnabledVB = false;\r\n\t\t\tfor (var progAttr in this._mapping) {\r\n\t\t\t\tvIndex = this._prog.attributes[progAttr].index;\r\n\t\t\t\tif (this._mesh.vertices.attributes[this._mapping[progAttr]]) {\r\n\t\t\t\t\tgl.enableVertexAttribArray(vIndex);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tgl.disableVertexAttribArray(vIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._primStream.isPacked) {\r\n\t\t\tif (this._primStream.blocksCount > 0) {\r\n\t\t\t\tvar blocks = this._primStream.blockRanges(first, count);\r\n\t\t\t\tvar n = blocks.length;\r\n\t\t\t\tfor (var i=0; i<n; ++i) {\r\n\t\t\t\t\tthis._bindVertexBuffers(blocks[i][3]);\r\n\t\t\t\t\tthis._primStream.renderBlock(blocks[i][0], blocks[i][1], blocks[i][2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._primStream.render(first, count);\r\n\t\t}\r\n\t},\r\n\r\n\trenderMeshPrimitives : function(mesh, name, first, count) {\r\n\t\tthis.beginMesh(mesh);\r\n\t\t\tthis.beginPrimitives(name);\r\n\t\t\t\tthis.render(first, count);\r\n\t\t\tthis.endPrimitives();\r\n\t\tthis.endMesh();\r\n\t}\r\n};\r\n\r\nfunction sglRenderMeshGLPrimitives(mesh, name, program, streamMapping, uniforms, samplers, first, count) {\r\n\tvar renderer = new SglMeshGLRenderer(program);\r\n\trenderer.begin();\r\n\tif (streamMapping) renderer.setStreamMapping (streamMapping);\r\n\tif (uniforms     ) renderer.setUniforms      (uniforms     );\r\n\tif (samplers     ) renderer.setSamplers      (samplers     );\r\n\tif (name) {\r\n\t\trenderer.renderMeshPrimitives(mesh, name, first, count);\r\n\t}\r\n\telse {\r\n\t\tvar primitives = mesh.connectivity.primitives;\r\n\t\tfor (var p in primitives) {\r\n\t\t\trenderer.renderMeshPrimitives(mesh, p, first, count);\r\n\t\t}\r\n\t}\r\n}\r\n/***************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// utilities\r\n/***********************************************************************/\r\nfunction sglMeshJSCalculateBBox(meshJS, attribName) {\r\n\tvar attrn     = attribName || \"position\";\r\n\r\n\tvar posAttrib = meshJS.vertices.attributes[attrn];\r\n\tvar posSize   = posAttrib.size;\r\n\tvar posBuffer = posAttrib.buffer;\r\n\r\n\tvar bbox = new SglBox3();\r\n\tif (posSize != 3) return bbox;\r\n\r\n\tvar n = posBuffer.length / posSize;\r\n\tif (n <= 0) return bbox;\r\n\r\n\tn *= posSize;\r\n\r\n\tfor (var j=0; j<posSize; ++j) {\r\n\t\tbbox.min[j] = posBuffer[j];\r\n\t\tbbox.max[j] = posBuffer[j];\r\n\t}\r\n\r\n\tvar val = 0.0;\r\n\tfor (var i=posSize; i<n; i+=posSize) {\r\n\t\tfor (var j=0; j<posSize; ++j) {\r\n\t\t\tval = posBuffer[i+j];\r\n\t\t\tif (bbox.min[j] > val) bbox.min[j] = val;\r\n\t\t\tif (bbox.max[j] < val) bbox.max[j] = val;\r\n\t\t}\r\n\t}\r\n\r\n\treturn bbox;\r\n}\r\n\r\nSglMeshJS.prototype.calculateBoundingBox = function(attribName) {\r\n\treturn sglMeshJSCalculateBBox(this, attribName);\r\n};\r\n\r\nfunction sglGLPrimitiveType(gl, primType) {\r\n\tswitch (primType) {\r\n\t\tcase SGL_POINTS_LIST    : return gl.POINTS;         break;\r\n\t\tcase SGL_LINES_LIST     : return gl.LINES;          break;\r\n\t\tcase SGL_LINE_STRIP     : return gl.LINE_STRIP;     break;\r\n\t\tcase SGL_LINE_LOOP      : return gl.LINE_LOOP;      break;\r\n\t\tcase SGL_TRIANGLES_LIST : return gl.TRIANGLES;      break;\r\n\t\tcase SGL_TRIANGLE_STRIP : return gl.TRIANGLE_STRIP; break;\r\n\t\tcase SGL_TRIANGLE_FAN   : return gl.TRIANGLE_FAN;   break;\r\n\t\tdefault                 : return undefined;         break;\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\nfunction sglMeshJStoGL(gl, meshJS) {\r\n\tvar meshGL = new SglMeshGL(gl);\r\n\r\n\tfor (a in meshJS.vertices.attributes) {\r\n\t\tvar attr = meshJS.vertices.attributes[a];\r\n\t\tmeshGL.addVertexAttribute(attr.name, attr.size, new Float32Array(attr.buffer));\r\n\t}\r\n\r\n\tfor (p in meshJS.connectivity.primitives) {\r\n\t\tvar prim = meshJS.connectivity.primitives[p];\r\n\t\tvar ptype = sglGLPrimitiveType(meshGL.gl, prim.mode);\r\n\t\tif (ptype == undefined) continue;\r\n\r\n\t\tswitch (prim.type) {\r\n\t\t\tcase SGL_ARRAY_PRIMITIVE_STREAM :\r\n\t\t\t\tmeshGL.addArrayPrimitives(prim.name, ptype, prim.first, prim.length);\r\n\t\t\tbreak;\r\n\t\t\tcase SGL_INDEXED_PRIMITIVE_STREAM :\r\n\t\t\t\tmeshGL.addIndexedPrimitives(prim.name, ptype, new Uint16Array(prim.buffer));\r\n\t\t\tbreak;\r\n\t\t\tdefault :\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn meshGL;\r\n}\r\n\r\nSglMeshJS.prototype.toMeshGL = function(gl) {\r\n\treturn sglMeshJStoGL(gl, this);\r\n};\r\n\r\nfunction sglPackMeshJStoGL(gl, mesh, primitives, maxVertexIndex) {\r\n\tvar primName = primitives     || \"triangles\";\r\n\tvar maxInd   = maxVertexIndex || 65000;\r\n\r\n\tvar prim = mesh.connectivity.primitives[primName];\r\n\r\n\tif (!prim) return null;\r\n\tif (prim.type != SGL_INDEXED_PRIMITIVE_STREAM) return null;\r\n\r\n\tvar pmode = sglGLPrimitiveType(gl, prim.mode);\r\n\tif (pmode == undefined) return null;\r\n\r\n\tvar ariety   = 0;\r\n\tif (pmode === gl.TRIANGLES) {\r\n\t\tariety = 3;\r\n\t}\r\n\telse if (pmode === gl.LINES) {\r\n\t\tariety = 2;\r\n\t}\r\n\telse if (pmode === gl.POINTS) {\r\n\t\tariety = 1;\r\n\t}\r\n\telse {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar res   = [ ];\r\n\r\n\tvar srcIndices = prim.buffer;\r\n\tvar n          = srcIndices.length;\r\n\tn -= (n % ariety);\r\n\r\n\tvar start = 0;\r\n\r\n\tvar startVertex = 0;\r\n\tvar startIndex  = 0;\r\n\tvar startVertices = [ ];\r\n\tvar startIndices  = [ ];\r\n\r\n\tvar newIndices = [ ];\r\n\tvar newAttribs = { };\r\n\tfor (var a in mesh.vertices.attributes) {\r\n\t\tvar attr  = mesh.vertices.attributes[a];\r\n\t\tnewAttribs[a] = {\r\n\t\t\tname   : attr.name,\r\n\t\t\tsize   : attr.size,\r\n\t\t\tbuffer : [ ]\r\n\t\t};\r\n\t}\r\n\r\n\twhile (start < n) {\r\n\t\tvar indicesMap = { };\r\n\t\tvar dstIndices = [ ];\r\n\t\tvar vtxCount = 0;\r\n\r\n\t\tvar indicesMap = { };\r\n\t\tvar vtxCount   = 0;\r\n\t\tfor (var i=start; i<n; i+=ariety) {\r\n\t\t\tvar triIndices       = { };\r\n\t\t\tvar newVerticesCount = 0;\r\n\t\t\tfor (var j=0; j<ariety; ++j) {\r\n\t\t\t\tvar srcIdx = srcIndices[i+j];\r\n\t\t\t\tif (triIndices[srcIdx] == undefined) {\r\n\t\t\t\t\ttriIndices[srcIdx] = true;\r\n\t\t\t\t\tif (indicesMap[srcIdx] == undefined) {\r\n\t\t\t\t\t\tnewVerticesCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ((vtxCount + newVerticesCount) <= maxInd) {\r\n\t\t\t\tfor (var j=0; j<ariety; ++j) {\r\n\t\t\t\t\tvar srcIdx = srcIndices[i+j];\r\n\t\t\t\t\tvar dstIdx = indicesMap[srcIdx];\r\n\t\t\t\t\tif (dstIdx == undefined) {\r\n\t\t\t\t\t\tindicesMap[srcIdx] = vtxCount;\r\n\t\t\t\t\t\tdstIdx = vtxCount;\r\n\t\t\t\t\t\tvtxCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdstIndices.push(dstIdx);\r\n\t\t\t\t}\r\n\t\t\t\tstart += ariety;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (vtxCount <= 0) break;\r\n\r\n\t\tvar idxCount = dstIndices.length;\r\n\r\n\t\tfor (var a in mesh.vertices.attributes) {\r\n\t\t\tvar srcAttr  = mesh.vertices.attributes[a];\r\n\t\t\tvar dstAttr  = newAttribs[a];\r\n\t\t\tvar asize    = srcAttr.size;\r\n\t\t\tvar dstBase  = dstAttr.buffer.length;\r\n\t\t\tvar newArr   = new Array(vtxCount * asize);\r\n\t\t\tdstAttr.buffer = dstAttr.buffer.concat(newArr);\r\n\r\n\t\t\tvar srcBuff = srcAttr.buffer;\r\n\t\t\tvar dstBuff = dstAttr.buffer;\r\n\t\t\tfor (var i in indicesMap) {\r\n\t\t\t\tvar dstIdx = indicesMap[i];\r\n\t\t\t\tfor (var c=0; c<asize; ++c) {\r\n\t\t\t\t\tdstBuff[dstBase + (dstIdx*asize+c)] = srcBuff[i*asize+c];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tnewIndices = newIndices.concat(dstIndices);\r\n\r\n\t\tstartVertices.push(startVertex);\r\n\t\tstartIndices.push(startIndex);\r\n\r\n\t\tstartVertex += vtxCount;\r\n\t\tstartIndex  += idxCount;\r\n\t}\r\n\r\n\tvar m = new SglMeshGL(gl);\r\n\r\n\tfor (var a in newAttribs) {\r\n\t\tvar attr = newAttribs[a];\r\n\t\tm.addVertexAttribute(attr.name, attr.size, new Float32Array(attr.buffer));\r\n\t}\r\n\r\n\tif (startVertices.length == 1) {\r\n\t\tm.addIndexedPrimitives(primName, pmode, new Uint16Array(newIndices));\r\n\t}\r\n\telse {\r\n\t\tm.addPackedIndexedPrimitives(primName, pmode, new Uint16Array(newIndices), startIndices, startVertices);\r\n\t}\r\n\r\n\treturn m;\r\n}\r\n\r\nSglMeshJS.prototype.toPackedMeshGL = function(gl, primitives, maxVertexIndex) {\r\n\treturn sglPackMeshJStoGL(gl, this, primitives, maxVertexIndex);\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// SglTrackball\r\n/***********************************************************************/\r\nvar SGL_TRACKBALL_NO_ACTION = 0;\r\nvar SGL_TRACKBALL_ROTATE    = 1;\r\nvar SGL_TRACKBALL_PAN       = 2;\r\nvar SGL_TRACKBALL_DOLLY     = 3;\r\nvar SGL_TRACKBALL_SCALE     = 4;\r\n\r\n/**\r\n * Constructs a SglTrackball object.\r\n * @class Interactor which implements a typical trackball controller.\r\n */\r\nfunction SglTrackball() {\r\n\tthis._matrix = sglIdentityM4();\r\n\tthis._pts    = [ [0.0, 0.0], [0.0, 0.0] ];\r\n\tthis._action = SGL_TRACKBALL_NO_ACTION;\r\n\r\n\tthis.reset();\r\n}\r\n\r\nSglTrackball.prototype = {\r\n\t_projectOnSphere : function(x, y) {\r\n\t\tvar r = 1.0;\r\n\r\n\t\tvar z = 0.0;\r\n\t\tvar d = sglSqrt(x*x + y*y);\r\n\t\tif (d < (r * 0.70710678118654752440)) {\r\n\t\t\t/* Inside sphere */\r\n\t\t\tz = sglSqrt(r*r - d*d);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t/* On hyperbola */\r\n\t\t\tt = r / 1.41421356237309504880;\r\n\t\t\tz = t*t / d;\r\n\t\t}\r\n\t\treturn z;\r\n\t},\r\n\r\n\t_transform : function(m, x, y, z) {\r\n\t\treturn sglMulM4V4(m, sglV4C(x, y, z, 0.0));\r\n\t},\r\n\r\n\t_transformOnSphere : function(m, x, y) {\r\n\t\tvar z = this._projectOnSphere(x, y);\r\n\t\treturn this._transform(m, x, y, z);\r\n\t},\r\n\r\n\t_translate : function(offset, f) {\r\n\t\tvar invMat = sglInverseM4(this._matrix);\r\n\t\tvar t = sglV3toV4(offset, 0.0);\r\n\t\tt = sglMulM4V4(invMat, t);\r\n\t\tt = sglMulSV4(f, t);\r\n\t\tvar trMat = sglTranslationM4V(t);\r\n\t\tthis._matrix = sglMulM4(this._matrix, trMat);\r\n\t},\r\n\r\n\tget action()  { return this._action; },\r\n\tset action(a) { this._action = a     },\r\n\r\n\tget matrix() { return this._matrix; },\r\n\r\n\treset : function () {\r\n\t\tthis._matrix = sglIdentityM4();\r\n\t\tthis._pts    = [ [0.0, 0.0], [0.0, 0.0] ];\r\n\t\tthis._action = SGL_TRACKBALL_NO_ACTION\r\n\t},\r\n\r\n\ttrack : function(m, x, y, z) {\r\n\t\tthis._pts[0][0] = this._pts[1][0];\r\n\t\tthis._pts[0][1] = this._pts[1][1];\r\n\t\tthis._pts[1][0] = x;\r\n\t\tthis._pts[1][1] = y;\r\n\r\n\t\tswitch (this._action) {\r\n\t\t\tcase SGL_TRACKBALL_ROTATE:\r\n\t\t\t\tthis.rotate(m);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_PAN:\r\n\t\t\t\tthis.pan(m);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_DOLLY:\r\n\t\t\t\tthis.dolly(m, z);\r\n\t\t\tbreak;\r\n\r\n\t\t\tcase SGL_TRACKBALL_SCALE:\r\n\t\t\t\tthis.scale(m, z);\r\n\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\r\n\trotate : function(m) {\r\n\t\tif ((this._pts[0][0] == this._pts[1][0]) && (this._pts[0][1] == this._pts[1][1])) return;\r\n\r\n\t\tvar mInv = sglInverseM4(m);\r\n\r\n\t\tvar v0 = this._transformOnSphere(mInv, this._pts[0][0], this._pts[0][1]);\r\n\t\tvar v1 = this._transformOnSphere(mInv, this._pts[1][0], this._pts[1][1]);\r\n\r\n\t\tvar axis   = sglCrossV3(v0, v1);\r\n\t\tvar angle  = sglLengthV3(axis);\r\n\t\tvar rotMat = sglRotationAngleAxisM4V(angle, axis);\r\n\r\n\t\tthis._matrix = sglMulM4(rotMat, this._matrix);\r\n\t},\r\n\r\n\tpan : function(m) {\r\n\t\tvar mInv = sglInverseM4(m);\r\n\t\tvar v0 = this._transform(mInv, this._pts[0][0], this._pts[0][1], -1.0);\r\n\t\tvar v1 = this._transform(mInv, this._pts[1][0], this._pts[1][1], -1.0);\r\n\t\tvar offset = sglSubV3(v1, v0);\r\n\t\tthis._translate(offset, 2.0);\r\n\t},\r\n\r\n\tdolly : function(m, dz) {\r\n\t\tvar mInv = sglInverseM4(m);\r\n\t\tvar offset = this._transform(mInv, 0.0, 0.0, dz);\r\n\t\tthis._translate(offset, 1.0);\r\n\t},\r\n\r\n\tscale : function(m, s) {\r\n\t\tvar scaleMat = sglScalingM4C(s, s, s);\r\n\t\tthis._matrix = sglMulM4(this._matrix, scaleMat);\r\n\t}\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglFirstPersonCamera\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglFirstPersonCamera object.\r\n * The default pose is positioned at the origin, looking towards the -Z axis with 0 degrees roll.\r\n * The camera moves on the XZ plane, having +Y as upward axis.\r\n * @class Interactor which implements typical First-Person camera movements.\r\n */\r\nfunction SglFirstPersonCamera() {\r\n\tthis._position = sglZeroV3();\r\n\tthis._angles   = sglZeroV3();\r\n\r\n\tthis.lookAt(0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0);\r\n}\r\n\r\nSglFirstPersonCamera.prototype = {\r\n\t/**\r\n\t * Clones the object.\r\n\t * @return {SglFirstPersonCamera} A clone of the object.\r\n\t * @see SglFirstPersonCamera#get:copy\r\n\t */\r\n\tclone : function() {\r\n\t\tvar r = new SglFirstPersonCamera();\r\n\t\tr._position = this._position.slice();\r\n\t\tr._angles   = this._angles.slice();\r\n\t\treturn r;\r\n\t},\r\n\r\n\t/**\r\n\t * Getter for the whole object clone.\r\n\t * It returns a clone of the object.\r\n\t * @name SglFirstPersonCamera#get:copy\r\n\t * @function.\r\n\t * @return {SglFirstPersonCamera}\r\n\t * @see SglFirstPersonCamera#clone\r\n\t */\r\n\tget copy() {\r\n\t\treturn this.clone();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets camera pose.\r\n\t * @param {number} positionX The X coordinate of the camera position.\r\n\t * @param {number} positionY The Y coordinate of the camera position.\r\n\t * @param {number} positionZ The Z coordinate of the camera position.\r\n\t * @param {number} targetX   The X coordinate of the point the camera will be looking at.\r\n\t * @param {number} targetY   The Y coordinate of the point the camera will be looking at.\r\n\t * @param {number} targetZ   The Z coordinate of the point the camera will be looking at.\r\n\t * @param {number} roll      The angle (in radians) of rotation around the view direction (upward vector is kepth at Y axis).\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\tlookAt : function(positionX, positionY, positionZ, targetX, targetY, targetZ, roll) {\r\n\t\tthis._position = sglV3C(positionX, positionY, positionZ);\r\n\r\n\t\tvar viewDir = sglSubV3([ targetX, targetY, targetZ ], this._position);\r\n\r\n\t\tthis._angles[0] = sglAtan2( viewDir[1], -viewDir[2]);\r\n\t\tthis._angles[1] = sglAtan2(-viewDir[0], -viewDir[2]);\r\n\t\tthis._angles[2] = (roll) ? (roll) : (0.0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Translates the camera position in its frame of reference.\r\n\t * @param {number} xOffset The amount of translation along the X axis.\r\n\t * @param {number} yOffset The amount of translation along the Y axis.\r\n\t * @param {number} zOffset The amount of translation along the Z axis.\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\ttranslate : function(xOffset, yOffset, zOffset) {\r\n\t\tvar pitchMat  = sglRotationAngleAxisM4C(this._angles[0], 1.0, 0.0, 0.0);\r\n\t\tvar yawMat    = sglRotationAngleAxisM4C(this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rollMat   = sglRotationAngleAxisM4C(this._angles[2], 0.0, 0.0, 1.0);\r\n\t\tvar rotMat    = sglMulM4(rollMat, sglMulM4(yawMat, pitchMat));\r\n\t\tvar rotOffset = sglMulM4V4(rotMat, [ xOffset, yOffset, zOffset, 0.0 ]);\r\n\r\n\t\tthis._position[0] += rotOffset[0];\r\n\t\tthis._position[1] += rotOffset[1];\r\n\t\tthis._position[2] += rotOffset[2];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Translates the camera position in its frame of reference, while preserving the Y coordinate (i.e. altitude).\r\n\t * @param {number} xOffset The amount of translation along the X axis.\r\n\t * @param {number} yOffset The amount of translation along the Y axis.\r\n\t * @param {number} zOffset The amount of translation along the Z axis.\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\ttranslateOnPlane : function(xOffset, yOffset, zOffset) {\r\n\t\tvar rotMat    = sglRotationAngleAxisM4C(this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rotOffset = sglMulM4V4(rotMat, [ xOffset, yOffset, zOffset, 0.0 ]);\r\n\r\n\t\tthis._position[0] += rotOffset[0];\r\n\t\tthis._position[1] += rotOffset[1];\r\n\t\tthis._position[2] += rotOffset[2];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Rotate the camera in its pitch-yaw-roll reference frame.\r\n\t * @param {number} pitchOffset The amount of rotation around the X axis (in radians).\r\n\t * @param {number} yawOffset   The amount of rotation around the Y axis (in radians).\r\n\t * @param {number} rollOffset  The amount of rotation around the view direction (in radians).\r\n\t * @return {SglFirstPersonCamera} A self reference.\r\n\t */\r\n\trotate : function(pitchOffset, yawOffset, rollOffset) {\r\n\t\tthis._angles[0] += pitchOffset;\r\n\t\tthis._angles[1] += yawOffset;\r\n\t\tthis._angles[2] += rollOffset;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Getter for the camera pose matrix.\r\n\t * The camera pose is returned as a 16-element array representing a 4x4 column major transofrmation matrix.\r\n\t * @name SglFirstPersonCamera#get:matrix\r\n\t * @function.\r\n\t * @return {Array}\r\n\t */\r\n\tget matrix() {\r\n\t\tvar pitchMat  = sglRotationAngleAxisM4C(-this._angles[0], 1.0, 0.0, 0.0);\r\n\t\tvar yawMat    = sglRotationAngleAxisM4C(-this._angles[1], 0.0, 1.0, 0.0);\r\n\t\tvar rollMat   = sglRotationAngleAxisM4C(-this._angles[2], 0.0, 0.0, 1.0);\r\n\t\tvar posMat    = sglTranslationM4V(sglNegV3(this._position));\r\n\t\tvar res       = sglMulM4(rollMat, sglMulM4(pitchMat, sglMulM4(yawMat, posMat)));\r\n\r\n\t\treturn res;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n/*************************************************************************/\r\n/*                                                                       */\r\n/*  SpiderGL                                                             */\r\n/*  JavaScript 3D Graphics Library on top of WebGL                       */\r\n/*                                                                       */\r\n/*  Copyright (C) 2010                                                   */\r\n/*  Marco Di Benedetto                                                   */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it                                               */\r\n/*  mailto: marco[DOT]dibenedetto[AT]isti[DOT]cnr[DOT]it                 */\r\n/*                                                                       */\r\n/*  This file is part of SpiderGL.                                       */\r\n/*                                                                       */\r\n/*  SpiderGL is free software; you can redistribute it and/or modify     */\r\n/*  under the terms of the GNU Lesser General Public License as          */\r\n/*  published by the Free Software Foundation; either version 2.1 of     */\r\n/*  the License, or (at your option) any later version.                  */\r\n/*                                                                       */\r\n/*  SpiderGL is distributed in the hope that it will be useful, but      */\r\n/*  WITHOUT ANY WARRANTY; without even the implied warranty of           */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                 */\r\n/*  See the GNU Lesser General Public License                            */\r\n/*  (http://www.fsf.org/licensing/licenses/lgpl.html) for more details.  */\r\n/*                                                                       */\r\n/*************************************************************************/\r\n\r\n\r\n// canvas utilities\r\n/***********************************************************************/\r\nfunction sglGetCanvasContext(canvasID) {\r\n\tvar canvas = document.getElementById(canvasID);\r\n\tif (!canvas) return null;\r\n\r\n\tvar contextNames = ['webgl','experimental-webgl','moz-webgl','webkit-3d'];\r\n\t\r\n\tvar gl = null\r\n\tfor(var i = 0; i < contextNames.length; i++)\r\n\t{\r\n\t\ttry \r\n\t\t{\r\n\t\t\tgl = canvas.getContext(contextNames[i]);\r\n\t\t}\r\n\t\tcatch (x) { gl = null; }\r\n        if (gl) break;\r\n\t}\r\n\t\t\r\n\tif (gl == null) return null;\r\n\r\n\tif (gl.FALSE == undefined) gl.FALSE = 0;\r\n\tif (gl.TRUE  == undefined) gl.TRUE  = 1;\r\n\r\n\treturn gl;\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n// SglCanvasUI\r\n/***********************************************************************/\r\n/**\r\n * Constructs a SglCanvasUI.\r\n * @class Holds current information about the canvas object and input devices state.\r\n */\r\nfunction SglCanvasUI(manager, handler, canvas, gl) {\r\n\tthis._manager = manager;\r\n\tthis._handler = handler;\r\n\tthis._canvas  = canvas;\r\n\r\n\tthis._timerID = null;\r\n\tthis._updRate = 0.0;\r\n\tthis._ignoreKeyRepeat = true;\r\n\r\n\tthis.gl = gl;\r\n\r\n\tthis.loadEvent        = null;\r\n\tthis.unloadEvent      = null;\r\n\tthis.keyDownEvent     = null;\r\n\tthis.keyUpEvent       = null;\r\n\tthis.keyPressEvent    = null;\r\n\tthis.mouseDownEvent   = null;\r\n\tthis.mouseUpEvent     = null;\r\n\tthis.mouseMoveEvent   = null;\r\n\tthis.mouseWheelEvent  = null;\r\n\tthis.clickEvent       = null;\r\n\tthis.dblClickEvent    = null;\r\n\tthis.resizeEvent      = null;\r\n\tthis.updateEvent      = null;\r\n\tthis.drawEvent        = null;\r\n\r\n\tthis.keysDown         = new Object();\r\n\r\n\tthis.mouseButtonsDown = new Object();\r\n\tthis.mousePos         = { x:0, y:0 };\r\n\tthis.mousePrevPos     = { x:0, y:0 };\r\n\tthis.mouseDeltaPos    = { x:0, y:0 };\r\n\r\n\tthis.timeNow   = Date.now() / 1000.0;\r\n\tthis.timePrev  = this.timeNow;\r\n\tthis.timeDelta = 0.0;\r\n}\r\n\r\nSglCanvasUI.prototype = {\r\n\tget canvas() {\r\n\t\treturn this._canvas;\r\n\t},\r\n\r\n\tget width() {\r\n\t\treturn this._canvas.width;\r\n\t},\r\n\r\n\tget height() {\r\n\t\treturn this._canvas.height;\r\n\t},\r\n\r\n\tget ignoreKeyRepeat() {\r\n\t\treturn this._ignoreKeyRepeat;\r\n\t},\r\n\r\n\tset ignoreKeyRepeat(v) {\r\n\t\tthis._ignoreKeyRepeat = v;\r\n\t},\r\n\r\n\tget updateRate() {\r\n\t\tif (this._updRate <= 0.0) return 0.0;\r\n\t\treturn this._updRate;\r\n\t},\r\n\r\n\tset updateRate(r) {\r\n\t\tvar updR = r;\r\n\t\tif (updR < 0.0) updR = 0.0;\r\n\t\tif (updR > 1000.0) updR = 1000.0;\r\n\t\tif (this._updRate == updR) return;\r\n\r\n\t\tthis._updRate = updR;\r\n\r\n\t\tif (this._timerID != null)\r\n\t\t{\r\n\t\t\tclearInterval(this._timerID);\r\n\t\t\tthis._timerID = null;\r\n\t\t}\r\n\r\n\t\tif (this._updRate > 0.0)\r\n\t\t{\r\n\t\t\tvar ms  = 1000.0 / this._updRate;\r\n\t\t\tif (ms < 1.0) ms = 1.0;\r\n\t\t\tvar mgr = this._manager;\r\n\r\n\t\t\tthis.timeNow   = Date.now() / 1000.0;\r\n\t\t\tthis.timePrev  = this.timeNow;\r\n\t\t\tthis.timeDelta = 0.0;\r\n\r\n\t\t\tthis._timerID = setInterval(function() { mgr.update(); }, ms);\r\n\t\t}\r\n\t},\r\n\r\n\tget requestDraw() {\r\n\t\tvar t = this;\r\n\t\treturn (function() { t._manager.requestDraw(); });\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// _SglCanvasManager\r\n/***********************************************************************/\r\nfunction _SglCanvasManager(canvasID, handler, updateRate) {\r\n\tvar canvas = document.getElementById(canvasID);\r\n\tif (!canvas) throw new Error(\"SpiderGL : Canvas not found\");\r\n\r\n\tcanvas.contentEditable = true;\r\n\r\n\tvar gl = sglGetCanvasContext(canvasID);\r\n\tif (!gl) throw new Error(\"SpiderGL : Cannot get WebGL context\");\r\n\r\n\tgl.pixelStorei(gl.PACK_ALIGNMENT,                     1);\r\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT,                   1);\r\n\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,                true);\r\n\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,     false);\r\n\tgl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, gl.NONE);\r\n\r\n\t// for some strange reason, this is a workaround\r\n\t// to have Chrome work properly...\r\n\t// (anyway it should be harmless...)\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n\tvar ui  = new SglCanvasUI(this, handler, canvas, gl);\r\n\tthis.ui = ui;\r\n\r\n\tvar mgr = this;\r\n\r\n\tthis.gl      = gl;\r\n\tthis.canvas  = canvas;\r\n\tthis.handler = handler;\r\n\t//this.handler.prototype.ui = get function() { return ui };\r\n\t//this.handler.ui = get function() { return ui };\r\n\tthis.handler.ui = ui;\r\n\r\n\tthis._drawPending = false;\r\n\tthis.rendering = true;\r\n\tthis._drawFunc = function() {\r\n\t\tmgr.draw();\r\n\t};\r\n\r\n\r\n\tthis.canvas.addEventListener(\"load\",            function(e) { mgr.load        (e); }, false);\r\n\tthis.canvas.addEventListener(\"unload\",          function(e) { mgr.unload      (e); }, false);\r\n\tthis.canvas.addEventListener(\"keydown\",         function(e) { mgr.keyDown     (e); }, false);\r\n\tthis.canvas.addEventListener(\"keyup\",           function(e) { mgr.keyUp       (e); }, false);\r\n\tthis.canvas.addEventListener(\"keypress\",        function(e) { mgr.keyPress    (e); }, false);\r\n\tthis.canvas.addEventListener(\"mousedown\",       function(e) { mgr.mouseDown   (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseup\",         function(e) { mgr.mouseUp     (e); }, false);\r\n\tthis.canvas.addEventListener(\"mousemove\",       function(e) { mgr.mouseMove   (e); }, false);\r\n\tthis.canvas.addEventListener(\"click\",           function(e) { mgr.click       (e); }, false);\r\n\tthis.canvas.addEventListener(\"dblclick\",        function(e) { mgr.dblClick    (e); }, false);\r\n\tthis.canvas.addEventListener(\"resize\",          function(e) { mgr.resize      (e); }, false);\r\n\r\n\tthis.canvas.addEventListener(\"mousewheel\",      function(e) { mgr.mouseWheel  (e); }, false);\r\n\tthis.canvas.addEventListener(\"DOMMouseScroll\",  function(e) { mgr.mouseWheel  (e); }, false);\r\n\r\n\tthis.canvas.addEventListener(\"blur\",            function(e) { mgr.blur        (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseout\",        function(e) { mgr.mouseOut    (e); }, false);\r\n\tthis.canvas.addEventListener(\"mouseover\",       function(e) { mgr.mouseOver    (e); }, false);\r\n\t\r\n\tthis.canvas.addEventListener(\"touchstart\",      function(e) { mgr.touchStart  (e); }, false);\r\n\tthis.canvas.addEventListener(\"touchend\",        function(e) { mgr.touchEnd    (e); }, false);\r\n\tthis.canvas.addEventListener(\"touchmove\",       function(e) { mgr.touchMove   (e); }, false);\r\n\t\r\n\tthis.load();\r\n\r\n\tif (updateRate) {\r\n\t\tthis.ui.updateRate = updateRate;\r\n\t}\r\n}\r\n\r\n_SglCanvasManager.prototype = {\r\n\t_getMouseClientPos : function(e) {\r\n\t\tvar rct = this.canvas.getBoundingClientRect();\r\n\t\treturn {\r\n\t\t\tx : (e.clientX - rct.left),\r\n\t\t\ty : (e.clientY - rct.top )\r\n\t\t};\r\n\t},\r\n\r\n\trequestDraw : function() {\r\n\t\tif (this.rendering)\r\n\t\t{\r\n\t\t\tif (!this._drawPending) {\r\n\t\t\t\tthis._drawPending = true;\r\n\t\t\t\tsetTimeout(this._drawFunc, 0);\r\n\t\t\t}\r\n\t\t}\t\r\n\t},\r\n\r\n\tblur : function(e) {\r\n\t\tvar doDraw = false;\r\n\t\tfor (var button in this.ui.mouseButtonsDown) {\r\n\t\t\tif (this.ui.mouseButtonsDown[button]) {\r\n\t\t\t\tthis.ui.mouseButtonsDown[button] = false;\r\n\t\t\t\tif (this.handler.mouseUp) {\r\n\t\t\t\t\tif (this.handler.mouseUp(this.gl, button, this.ui.mousePos.x, this.ui.mousePos.y) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var key in this.ui.keysDown) {\r\n\t\t\tif (this.ui.keysDown[key]) {\r\n\t\t\t\tthis.ui.keysDown[key] = false;\r\n\t\t\t\tif (this.handler.keyUp) {\r\n\t\t\t\t\t// WARNING : passing 0 as keyCode\r\n\t\t\t\t\tif (this.handler.keyUp(this.gl, 0, key) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseOut: function(e) {\r\n\t\tvar doDraw = false;\r\n\t\tfor (var button in this.ui.mouseButtonsDown) {\r\n\t\t\tif (this.ui.mouseButtonsDown[button]) {\r\n\t\t\t\tthis.ui.mouseButtonsDown[button] = false;\r\n\t\t\t\tif (this.handler.mouseOut) {\r\n\t\t\t\t\tif (this.handler.mouseOut(this.gl, this.ui.mousePos.x, this.ui.mousePos.y) != false) {\r\n\t\t\t\t\t\tdoDraw = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\t\r\n\tmouseOver: function(e) {\r\n\t\r\n\t},\r\n\r\n\tload : function() {\r\n\t\tthis.ui.loadEvent = null;\r\n\t\tif (this.handler.load) {\r\n\t\t\tif (this.handler.load(this.gl) != false) {\r\n\t\t\t\t;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.requestDraw();\r\n\t},\r\n\r\n\tunload : function()\r\n\t{\r\n\t\tthis.ui.unloadEvent = null;\r\n\t\tthis.ui.updateRate = 0.0;\r\n\t\tif (this.handler.unload) {\r\n\t\t\tthis.handler.unload(this.gl);\r\n\t\t}\r\n\t\tthis.handler.ui = null;\r\n\t\tthis.handler    = null;\r\n\t\tthis.ui         = null;\r\n\t},\r\n\r\n\tkeyDown : function(e) {\r\n\t\tthis.ui.keyDownEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.keyCode);\r\n\t\tthis.ui.keysDown[keyString.toLowerCase()] = true;\r\n\t\tthis.ui.keysDown[keyString.toUpperCase()] = true;\r\n\t\tif (!this.ui.keysDown[e.keyCode] || !this.ui.ignoreKeyRepeat) {\r\n\t\t\tthis.ui.keysDown[e.keyCode] = true;\r\n\t\t\tif (this.handler.keyDown) {\r\n\t\t\t\tif (this.handler.keyDown(this.gl, e.keyCode, keyString) != false) {\r\n\t\t\t\t\tthis.requestDraw();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tkeyUp : function(e) {\r\n\t\tthis.ui.keyUpEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.keyCode);\r\n\t\tthis.ui.keysDown[keyString.toLowerCase()] = false;\r\n\t\tthis.ui.keysDown[keyString.toUpperCase()] = false;\r\n\t\tthis.ui.keysDown[e.keyCode] = false;\r\n\t\tif (this.handler.keyUp) {\r\n\t\t\tif (this.handler.keyUp(this.gl, e.keyCode, keyString) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tkeyPress : function(e) {\r\n\t\tthis.ui.keyPressEvent = e;\r\n\t\tvar keyString = String.fromCharCode(e.charCode);\r\n\t\tif (this.handler.keyPress) {\r\n\t\t\tif (this.handler.keyPress(this.gl, e.charCode, keyString) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseDown : function(e) {\r\n\t\tthis.ui.mouseDownEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[e.button] = true;\r\n\t\tif (this.handler.mouseDown) {\r\n\t\t\tif (this.handler.mouseDown(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.canvas.focus();\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseUp : function(e) {\r\n\t\tthis.ui.mouseUpEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[e.button] = false;\r\n\t\tif (this.handler.mouseUp) {\r\n\t\t\tif (this.handler.mouseUp(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseMove : function(e) {\r\n\t\tthis.ui.mouseMoveEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = this.ui.mousePos.x;\r\n\t\tthis.ui.mousePrevPos.y = this.ui.mousePos.y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = this.ui.mousePos.x - this.ui.mousePrevPos.x;\r\n\t\tthis.ui.mouseDeltaPos.y = this.ui.mousePos.y - this.ui.mousePrevPos.y;\r\n\t\tif (this.handler.mouseMove) {\r\n\t\t\tif (this.handler.mouseMove(this.gl, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tmouseWheel : function(e) {\r\n\t\tthis.ui.mouseWheelEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tif (this.handler.mouseWheel) {\r\n\t\t\tvar delta = 0;\r\n\t\t\tif (!e) /* For IE. */ {\r\n\t\t\t\te = window.event;\r\n\t\t\t}\r\n\t\t\tif (e.wheelDelta) /* IE/Opera. */ {\r\n\t\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t\t\t/* In Opera 9, delta differs in sign as compared to IE.\r\n\t\t\t\t */\r\n\t\t\t\tif (window.opera) {\r\n\t\t\t\t\tdelta = -delta;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (e.detail) /** Mozilla case. */ {\r\n\t\t\t\t/** In Mozilla, sign of delta is different than in IE.\r\n\t\t\t\t * Also, delta is multiple of 3.\r\n\t\t\t\t */\r\n\t\t\t\tdelta = -e.detail / 3;\r\n\t\t\t}\r\n\t\t\t/* If delta is nonzero, handle it.\r\n\t\t\t * Basically, delta is now positive if wheel was scrolled up,\r\n\t\t\t * and negative, if wheel was scrolled down.\r\n\t\t\t */\r\n\t\t\tif (delta) {\r\n\t\t\t\tif (this.handler.mouseWheel(this.gl, delta, x, y) != false) {\r\n\t\t\t\t\tthis.requestDraw();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* Prevent default actions caused by mouse wheel.\r\n\t\t * That might be ugly, but we handle scrolls somehow\r\n\t\t * anyway, so don't bother here..\r\n\t\t */\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t//e.returnValue = false;\r\n\t},\r\n\r\n\ttouchStart : function(e) {\r\n\t\tthis.ui.mouseDownEvent = e.touches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.touches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[0] = true;\r\n\t\tif (this.handler.mouseDown) {\r\n\t\t\tif (this.handler.mouseDown(this.gl, 0, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.canvas.focus();\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\ttouchEnd : function(e) {\r\n\t\tthis.ui.mouseUpEvent = e.changedTouches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.changedTouches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = x;\r\n\t\tthis.ui.mousePrevPos.y = y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = 0;\r\n\t\tthis.ui.mouseDeltaPos.y = 0;\r\n\t\tthis.ui.mouseButtonsDown[0] = false;\r\n\t\tif (this.handler.mouseUp) {\r\n\t\t\tif (this.handler.mouseUp(this.gl, 0, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\ttouchMove : function(e) {\r\n\t\tthis.ui.mouseMoveEvent = e.changedTouches[0];\r\n\t\tvar xy = this._getMouseClientPos(e.changedTouches[0]);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tthis.ui.mousePrevPos.x = this.ui.mousePos.x;\r\n\t\tthis.ui.mousePrevPos.y = this.ui.mousePos.y;\r\n\t\tthis.ui.mousePos.x = x;\r\n\t\tthis.ui.mousePos.y = y;\r\n\t\tthis.ui.mouseDeltaPos.x = this.ui.mousePos.x - this.ui.mousePrevPos.x;\r\n\t\tthis.ui.mouseDeltaPos.y = this.ui.mousePos.y - this.ui.mousePrevPos.y;\r\n\t\tif (this.handler.mouseMove) {\r\n\t\t\tif (this.handler.mouseMove(this.gl, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\t\r\n\tclick : function(e) {\r\n\t\tthis.ui.clickEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tif (this.handler.click) {\r\n\t\t\tif (this.handler.click(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\t*/\r\n\t},\r\n\r\n\tdblClick : function(e) {\r\n\t\tthis.ui.dblClickEvent = e;\r\n\t\tvar xy = this._getMouseClientPos(e);\r\n\t\tvar x = xy.x;\r\n\t\tvar y = this.canvas.height - 1 - xy.y;\r\n\t\tif (this.handler.dblClick) {\r\n\t\t\tif (this.handler.dblClick(this.gl, e.button, x, y) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tresize : function(e) {\r\n\t\tthis.ui.resizeEvent = e;\r\n\t\tif (this.handler.resize) {\r\n\t\t\tif (this.handler.resize(this.gl, this.canvas.width, this.canvas.height) != false) {\r\n\t\t\t\tthis.requestDraw();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\r\n\tupdate : function() {\r\n\t\tthis.ui.updateEvent = null;\r\n\t\tvar now = Date.now() / 1000.0;\r\n\t\tthis.ui.timePrev  = this.ui.timeNow;\r\n\t\tthis.ui.timeNow   = now;\r\n\t\tthis.ui.timeDelta = (this.ui.timeNow - this.ui.timePrev);\r\n\t\tvar doDraw = true;\r\n\t\tif (this.handler.update) {\r\n\t\t\tdoDraw = (this.handler.update(this.gl, this.ui.timeDelta) != false);\r\n\t\t}\r\n\t\tif (doDraw) {\r\n\t\t\tthis.requestDraw();\r\n\t\t}\r\n\t},\r\n\r\n\tdraw : function() {\r\n\t\tthis.ui.drawEvent = null;\r\n\t\tif (this.handler.draw) {\r\n\t\t\tthis.handler.draw(this.gl);\r\n\t\t}\r\n\t\tthis.gl.flush();\r\n\t\tthis._drawPending = false;\r\n\t}\r\n};\r\n/***********************************************************************/\r\n\r\n\r\n// canvas registration\r\n/***********************************************************************/\r\nvar _SGL_RegisteredCanvas = new Object();\r\n\r\nfunction _sglManageCanvas(canvasID, handler, updateRate) {\r\n\tvar manager = new _SglCanvasManager(canvasID, handler, updateRate);\r\n\t_SGL_RegisteredCanvas[canvasID] = manager;\r\n}\r\n\r\nfunction _sglUnmanageCanvas(canvasID) {\r\n\tif (_SGL_RegisteredCanvas[canvasID]) {\r\n\t\t_SGL_RegisteredCanvas[canvasID] = null;\r\n\t\tdelete _SGL_RegisteredCanvas[canvasID];\r\n\t}\r\n}\r\n\r\nfunction _sglManageCanvasOnLoad(canvasID, handler, updateRate) {\r\n\twindow.addEventListener(\"load\", function() { _sglManageCanvas(canvasID, handler, updateRate); }, false);\r\n}\r\n\r\nfunction _sglUnmanageCanvasOnLoad(canvasID) {\r\n\twindow.addEventListener(\"unload\", function() { _sglUnmanageCanvas(canvasID); }, false);\r\n}\r\n\r\nfunction sglRegisterCanvas(canvasID, handler, updateRate) {\r\n\t_sglManageCanvasOnLoad(canvasID, handler, updateRate);\r\n\t_sglUnmanageCanvasOnLoad(canvasID);\r\n}\r\n\r\nfunction sglRegisterLoadedCanvas(canvasID, handler, updateRate) {\r\n\t_sglManageCanvas(canvasID, handler, updateRate);\r\n\t_sglUnmanageCanvasOnLoad(canvasID);\r\n}\r\n/***********************************************************************/\r\n\r\n\r\n","/*************************************************************************/\r\n/*                                                                       */\r\n/*  WebMultiRes                                                          */\r\n/*  JavaScript 3D Graphics Library on top of SpiderGL for web            */\r\n/*  visualization of high resolution RTI images                          */\r\n/*                                                                       */\r\n/*  Copyright (C) 2013-2015                                              */\r\n/*  Gianpaolo Palma                                                      */\r\n/*  Visual Computing Laboratory                                          */\r\n/*  ISTI - Italian National Research Council (CNR)                       */\r\n/*  http://vcg.isti.cnr.it/rti/webviewer.php                             */\r\n/*  mailto: gianpaolo[DOT]palma[AT]isti[DOT]cnr[DOT]it                   */\r\n/*                                                                       */\r\n/*                                                                       */\r\n/*  This program is free software: you can redistribute it and/or modify */\r\n/*  it under the terms of the GNU General Public License as published by */\r\n/*  the Free Software Foundation, either version 3 of the License, or    */\r\n/*  (at your option) any later version.                                  */\r\n/*                                                                       */\r\n/*  This program is distributed in the hope that it will be useful,      */\r\n/*  but WITHOUT ANY WARRANTY; without even the implied warranty of       */\r\n/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        */\r\n/*  GNU General Public License for more details.                         */\r\n/*                                                                       */ \r\n/*  You should have received a copy of the GNU General Public License    */\r\n/*  along with this program.  If not, see <http://www.gnu.org/licenses/> */\r\n/*************************************************************************/\r\n\r\nfunction createRtiViewer(idDiv, imageUrlOrFunction, width, height)\r\n{\r\n\tvar canvasHeight = height;\r\n\tvar canvasWidth = width;\r\n\tvar fullscreen = false;\r\n\tvar canvasContainer = $($(\"#\"+idDiv)[0]);\r\n\tvar canvasDiv = document.createElement(\"div\");\r\n\tcanvasDiv.id = idDiv + \"_div\";\r\n\tcanvasDiv.style.height = height + \"px\";\r\n\tcanvasDiv.style.width = width + \"px\";\r\n\tcanvasDiv.style.margin = \"auto\";\r\n\tcanvasDiv.style.position = \"relative\";\r\n\tcanvasContainer.append(canvasDiv);\r\n\t\r\n\tvar canvasNode = $($(\"#\"+idDiv + \"_div\")[0]);\r\n\tvar canvasName = idDiv + \"_webgl\";\r\n\tvar canvas = document.createElement(\"canvas\");\r\n\tcanvas.id = canvasName;\r\n\tcanvas.width = width;\r\n\tcanvas.height = height;\r\n\tcanvasNode.append(canvas);\r\n\t\r\n\tvar aNode = document.createElement(\"a\");\r\n\taNode.href = \"http://vcg.isti.cnr.it/rti/webviewer.php\";\r\n\taNode.target =\"_blank\";\r\n\t\r\n\tvar aNodeDiv = document.createElement(\"div\");\r\n\taNodeDiv.style.width = 80 + \"px\";\r\n\taNodeDiv.style.height = 50 + \"px\";\r\n\t\r\n\taNode.appendChild(aNodeDiv);\r\n\taNode.style.position = \"absolute\";\r\n\taNode.style.bottom = \"0px\";\r\n\taNode.style.left = \"0px\";\r\n\taNode.style.cssFloat = \"left\";\r\n\tcanvasNode.append(aNode);\r\n\t\t\r\n\tvar toolbar = document.createElement(\"div\");\r\n\ttoolbar.setAttribute(\"class\", \"toolbar\");\r\n\ttoolbar.style.position = \"absolute\";\r\n\ttoolbar.style.top = \"10px\";\r\n\ttoolbar.style.left = \"10px\";\r\n\ttoolbar.style.cssFloat = \"left\";\r\n\ttoolbar.style.width = \"40px\";\r\n\ttoolbar.style.height = \"200px\";\r\n\ttoolbar.style.visibility = \"hidden\";\r\n\ttoolbar.innerHTML = '<button class = \"toolbarButton\" id = \"zoomIn\"></button><button class = \"toolbarButton\" id = \"zoomOut\"></button><button class = \"toolbarButton\" id = \"light\"></button><button class = \"toolbarButton\" id = \"fullscreen\"></button><button class = \"toolbarButton\" id = \"help\"></button>'\r\n\tcanvasNode.append(toolbar);\r\n\t\r\n\tvar divHelp = document.createElement(\"div\");\r\n\tdivHelp.id = idDiv + \"_guide\";\r\n\tdivHelp.style.width = \"100%\";\r\n\tdivHelp.style.height = \"100%\";\r\n\tdivHelp.style.position = \"absolute\";\r\n\tdivHelp.style.left = \"0px\";\r\n\tdivHelp.style.top = \"0px\";\r\n\tdivHelp.style.color = \"#FFFFFF\";\r\n\tdivHelp.style.backgroundColor=\"rgba(0, 0, 0, 0.9)\";\r\n\t\r\n\tdivHelp.innerHTML = '<div id = \"guideTable\"><div id = \"guideCell\"> <div id = \"guideList\"><h3>WebRTIViewer<br/></h3><ul><li>Pan: LeftMouseButton + MouseMove.</li><li>Zoom in: MouseWhell or press the button <span><img src = \"/assets/webViewer/css/icons/zoomin.png\" alt=\"\"/></span></li><li>Zoom out: MouseWheel or press the button <span><img src = \"/assets/webViewer/css/icons/zoomout.png\" alt=\"\"/></span></li><li>To change the light direction: activate the light with the button <span><img src = \"/assets/webViewer/css/icons/light.png\" alt=\"\"/></span> and press LeftMouseButton + MouseMove or Ctrl + LeftMouseButton + MouseMove.</li><li>Fullscreen: press the button <span><img src = \"/assets/webViewer/css/icons/full.png\" alt=\"\"/></span> to active the fullscreen mode and the button <span><img src = \"/assets/webViewer/css/icons/full_on.png\" alt=\"\"/></span> to exit</li><li>To reset the viewpoint: press R.</li></ul><a href=\"http://vcg.isti.cnr.it/rti/webviewer.php\" target = \"_black\">Visual Computing Lab ISTI CNR Pisa</a></div></div></div>'\r\n\tdivHelp.style.display = \"none\";\r\n\tcanvasNode.append(divHelp);\r\n\t\r\n\t$( \"#\"+idDiv + \"_div #zoomIn\" ).button({\r\n      icons: {\r\n        primary: \"zoomInIcon toolbarIcon\"\r\n      },\r\n\t  text: false,\r\n      label: \"Zoom In\"\r\n    }).click(function(){multiResRTI.startZoomIn();});\r\n\t\r\n\t$( \"#\"+idDiv + \"_div #zoomOut\" ).button({\r\n      icons: {\r\n        primary: \"zoomOutIcon toolbarIcon\"\r\n      },\r\n\t  text: false,\r\n      label: \"Zoom Out\"\r\n    }).click(function(){multiResRTI.startZoomOut();});\r\n\r\n\t$( \"#\"+idDiv + \"_div #light\" ).button({\r\n      icons: {\r\n        primary: \"lightIcon toolbarIcon\"\r\n      },\r\n      text: false,\r\n\t  label: \"Light Off\"\r\n    }).click(function(){\r\n\t\tvar options;\r\n\t\tif ( $.trim($( this ).text()) == \"Light Off\" ) \r\n\t\t{\r\n\t\t\toptions = {\r\n\t\t\t\tlabel: \"Light On\",\r\n\t\t\t\ticons: {\r\n\t\t\t\t\tprimary: \"lightOnIcon toolbarIcon\"\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tmultiResRTI.setMode(1);\r\n\t\t} else {\r\n\t\t\toptions = {\r\n\t\t\t\tlabel: \"Light Off\",\r\n\t\t\t\ticons: {\r\n\t\t\t\t\tprimary: \"lightIcon toolbarIcon\"\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tmultiResRTI.setMode(0);\r\n\t\t}\r\n\t\t$( this ).button( \"option\", options );\r\n\t});\r\n\t\r\n\t$( \"#\"+idDiv + \"_div #help\" ).button({\r\n      icons: {\r\n        primary: \"helpIcon toolbarIcon\"\r\n      },\r\n\t  text: false,\r\n      label: \"Help\"\r\n    }).click(function(){$( \"#\"+idDiv + \"_guide\" ).show();});\r\n\t\r\n\t\r\n\tfunction fullScreenOn(){\r\n\t\tvar i = document.getElementById(idDiv + \"_div\");\r\n\t\tif (i.requestFullscreen) {\r\n\t\t\ti.requestFullscreen();\r\n\t\t} else if (i.webkitRequestFullscreen) {\r\n\t\t\ti.webkitRequestFullscreen();\r\n\t\t} else if (i.mozRequestFullScreen) {\r\n\t\t\ti.mozRequestFullScreen();\r\n\t\t} else if (i.msRequestFullscreen) {\r\n\t\t\ti.msRequestFullscreen();\r\n\t\t}\r\n\t\t\r\n\t\ti.style.height = screen.height + \"px\";\r\n\t\ti.style.width = screen.width + \"px\";\r\n\t\tvar canvas = $(\"#\" + idDiv + \"_webgl\");\r\n\t\tcanvas.height(screen.height);\r\n\t\tcanvas.width(screen.width);\r\n\t\tcanvas.attr(\"width\", screen.width);\r\n\t\tcanvas.attr(\"height\", screen.height);\r\n\t\tmultiResRTI.resize();\r\n\t\tfullscreen = true\r\n\t\tvar options = {\r\n\t\t\t\t\tlabel: \"Exit Fullscreen\",\r\n\t\t\t\t\ticons: {\r\n\t\t\t\t\t\tprimary: \"fullOnIcon toolbarIcon\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t$( \"#\"+idDiv + \"_div #fullscreen\").button( \"option\", options );\r\n\t};\r\n\t\r\n\tfunction fullScreenOff(){\r\n\t\tvar i = document.getElementById(idDiv + \"_div\");\r\n\t\tif (document.exitFullscreen) {\r\n\t\t\tdocument.exitFullscreen();\r\n\t\t} else if (document.webkitExitFullscreen) {\r\n\t\t\tdocument.webkitExitFullscreen();\r\n\t\t} else if (document.mozCancelFullScreen) {\r\n\t\t\tdocument.mozCancelFullScreen();\r\n\t\t} else if (document.msExitFullscreen) {\r\n\t\t\tdocument.msExitFullscreen();\r\n\t\t}\r\n\t\ti.style.height = canvasHeight + \"px\";\r\n\t\ti.style.width = canvasWidth + \"px\";\r\n\t\tvar canvas = $(\"#\" + idDiv + \"_webgl\");\r\n\t\tcanvas.height(canvasHeight);\r\n\t\tcanvas.width(canvasWidth);\r\n\t\tcanvas.attr(\"width\", canvasWidth);\r\n\t\tcanvas.attr(\"height\", canvasHeight);\r\n\t\tmultiResRTI.resize();\r\n\t\tfullscreen = false;\r\n\t\tvar options = {\r\n\t\t\t\t\tlabel: \"Active Fullscreen\",\r\n\t\t\t\t\ticons: {\r\n\t\t\t\t\t\tprimary: \"fullIcon toolbarIcon\"\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t$( \"#\"+idDiv + \"_div #fullscreen\").button( \"option\", options );\r\n\t};\r\n\t\r\n\t$( \"#\"+idDiv + \"_div #fullscreen\" ).button({\r\n      icons: {\r\n        primary: \"fullIcon toolbarIcon\"\r\n      },\r\n\t  text: false,\r\n      label: \"Active Fullscreen\"\r\n    }).click(\r\n\tfunction(){\r\n\t\t\tvar options;\r\n\t\t\tif (!fullscreen)\r\n\t\t\t\tfullScreenOn();\r\n\t\t\telse\r\n\t\t\t\tfullScreenOff();\r\n\t\t\t$(\"#\"+idDiv + \"_div #fullscreen\").removeClass(\"ui-state-hover\");\r\n\t\t}\r\n\t);\r\n\t\r\n\tdocument.addEventListener(\"MSFullscreenChange\", function () {\r\n    if(!document.msFullscreenElement) fullScreenOff();\r\n\t}, false);\r\n\tdocument.addEventListener(\"mozfullscreenchange\", function () {\r\n\t\tif(!document.mozFullScreen) fullScreenOff();\r\n\t}, false);\r\n\tdocument.addEventListener(\"webkitfullscreenchange\", function () {\r\n\t\tif(!document.webkitIsFullScreen) fullScreenOff();\r\n\t}, false);\r\n\t\t\r\n\t$( \"#\"+idDiv + \"_guide\" ).click(function(){$( \"#\"+idDiv + \"_guide\" ).hide();});\r\n\t\r\n\t\r\n\tvar divError = document.createElement(\"div\");\r\n\tdivError.id = idDiv + \"_error\";\r\n\tdivError.style.width = \"100%\";\r\n\tdivError.style.height = \"100%\";\r\n\tdivError.style.position = \"absolute\";\r\n\tdivError.style.left = \"0px\";\r\n\tdivError.style.top = \"0px\";\r\n\tdivError.style.color = \"#FFFFFF\";\r\n\tdivError.style.backgroundColor=\"rgba(0, 0, 0, 1.0)\";\r\n\t\r\n\tdivError.innerHTML = '<canvas id = \"testCanvas\" width= \"800\" height= \"600\" contenteditable=\"true\"></canvas>';\r\n\tdivError.style.display = \"none\";\r\n\tcanvasNode.append(divError);\r\n\tif (sglGetCanvasContext(\"testCanvas\") == null)\r\n\t{\r\n\t\tdivError.style.display = \"block\";\r\n\t\tdivError.innerHTML = '<div id = \"contentError\" style = \"width: 90%; height: 100%; text-align:left; padding:0% 5% 0% 5%; font-family:  Verdana,sans-serif; overflow-y: scroll;\"><h3>WebGL is not available or not enabled.</h3><p><a href=\"http://en.wikipedia.org/wiki/WebGL\">WebGL</a> is the technology we use to display the RTI images. It is currently supported, but sometimes not enabled by default, by recent versions of <a href=\"http://www.mozilla.org/firefox\">Firefox</a>, <a href=\"http://www.google.com/chrome\">Chrome</a> and <a href=\"http://www.apple.com/safari\">Safari</a>. An external plugins is available for <a href=\"http://microsoft.com/ie\">Internet  Explorer</a>.<br/> It also requires a moderately recent and capable hardware and up to date drivers.</p><p><b>Chrome</b><br/>Type \"chrome://flags\" in the address bar.<br/>Disable (yes, it is a confusing double negation!) the WebGL entry.<br/>Click the <em>relaunch now</em> button at the bottom.</p><p><b>Firefox</b><br/>Type \"about:config\" in the address bar<br/>Type \"webgl\" in the <em>Filter</em>.<br/>Doubleclick the entry <b>webgl.force-enable</b>, and restart Firefox.</p><p><b>Safari</b><br/>Open the Safari menu and select Preferences.<br/>Then, click the Advanced tab in the Preferences window.<br/>Then, at the bottom of the window, check the Show Develop menu in menu bar checkbox.<br/>Then, open the Develop menu in the menu bar and select Enable WebGL.</p><p><b>Internet Explorer (from version 9.0)</b><br/>Install the <a href=\"http://www.google.com/chromeframe\">Chrome Frame</a> <br/>Open the Tools menu and select Manage add-ons.<br/>Then, enable the ChromeFrame BHO plugins and restart Internet Explorer.<br/></p><p><b>Installing updated drivers</b><br/>If the visualization of the RTI image fails you must update the drivers of your graphics cards.</p></div>'\r\n\t}\r\n\telse\r\n\t{\r\n\t\tdivError.innerHTML = '';\r\n\t\tvar multiResRTI = new MultiRes(canvasName);\r\n\t\tif($.type(imageUrlOrFunction) === \"string\") {\r\n\t\t\tmultiResRTI.setImageUrl(imageUrlOrFunction);\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmultiResRTI.setImageFunction(imageUrlOrFunction);\r\n\t\t}\r\n\t\t\r\n\t\tfunction isRelitable(type){\r\n\t\t\tif (type ==  \"IMAGE\")\r\n\t\t\t{\r\n\t\t\t\t$( \"#\"+idDiv + \"_div #light\" ).css(\"display\", \"none\");\r\n\t\t\t}\r\n\t\t\t$( \".toolbar\").css(\"visibility\", \"visible\");\r\n\t\t};\r\n\t\tmultiResRTI.setOnLoadImageCallback(isRelitable);\r\n\t\tsglRegisterCanvas(canvasName, multiResRTI, 10.0);\r\n\t}\r\n}\r\n\r\n\r\n\r\nfunction log(msg) \r\n{\r\n\t//console.log(msg);\r\n}\r\n\r\nfunction MultiRes(canvas)\r\n{\r\n\tthis.mode = 0;\r\n\tthis.stepAnimation = 0;\r\n\tthis.idTimer;\r\n\tthis.flipAngles = [];\r\n\tthis.flipAngles[0] = 0.0;\r\n\tthis.canvas = canvas;\r\n\tthis.rendering = false;\r\n\tthis.onDrawCallback = null;\r\n\tthis.animating = false;\r\n\tthis.moveToCenter = false;\r\n\tthis.imageUrl = \"\";\r\n\tthis.imageFunction = null;\r\n\tthis.OnLoadImageCallback = null;\r\n\t\r\n\tthis.currentSpeed = 0.0;\r\n\tthis.maxStep = 7;\r\n\tthis.animationStack = [];\r\n\tthis.isMoving = false;\r\n\tfor (var  i = 1; i < 21; i++)\r\n\t\tthis.flipAngles[i] = SGL_PI / 2.0 * (Math.sin(i / 40.0 * SGL_PI));\r\n}\r\n\r\nMultiRes.prototype = {\r\n\r\n\tsetMode: function(x)\r\n\t{\r\n\t\tthis.mode = x;\r\n\t},\t\t\t\r\n\r\n\t\r\n\t_setLightDir : function(x, y) \r\n\t{\r\n\t\tvar lx = ((x / this.ui.width) * 2.2 - 1.1);\r\n\t\tvar ly = ((y / this.ui.height) * 2.2 - 1.1);\r\n\t\tlx = Math.min(1.0, Math.max(-1.0, lx));\r\n\t\tly = Math.min(1.0, Math.max(-1.0, ly));\r\n\t\tvar norm = Math.sqrt(lx*lx + ly*ly);\r\n\t\tif (norm > 1.0)\r\n\t\t\tnorm = 1.0;\r\n\t\tvar alpha = Math.PI / 2;\r\n\t\tif (lx != 0.0)\r\n\t\t\talpha = Math.atan2(ly, lx);\r\n\t\tlx = norm * Math.cos(alpha);\r\n\t\tly = norm * Math.sin(alpha);\r\n\t\tvar lpos = []\r\n\t\tif (norm < 1.0)\r\n\t\t\tlpos = [lx, ly, Math.sqrt(1.0 - lx*lx - ly*ly)];\r\n\t\telse\r\n\t\t\tlpos = [lx, ly, 0.0];\r\n\t\tlpos = sglNormalizedV3(lpos);\r\n\t\tthis.renderer.lightPos = lpos.slice(0, 3);\r\n\t\tthis.renderer.lweights = this.renderer.computeLightingFunction(lpos);\r\n\t},\r\n\r\n\tresetViewpoint : function()\r\n\t{\r\n\t\tthis.translation[0] = 0.0;\r\n\t\tthis.translation[1] = 0.0;\r\n\t\tthis.mat = sglIdentityM4();\r\n\t\tthis.flipMatrix = sglIdentityM4();\r\n\t},\r\n\t\r\n\t\r\n\tsetImageUrl: function(url)\r\n\t{\r\n\t\tthis.imageUrl = url;\r\n\t},\r\n\tsetImageFunction: function(imageFunction)\r\n\t{\r\n\t\tthis.imageFunction = imageFunction;\r\n\t},\r\n\t\r\n\tsetOnLoadImageCallback: function(callback)\r\n\t{\r\n\t\tthis.OnLoadImageCallback = callback;\r\n\t},\r\n\r\n\tload : function(gl)\r\n\t{\r\n\t\tlog(\"SpiderGL Version : \" + SGL_VERSION_STRING + \"\\n\");\r\n\t\t/*************************************************************/\r\n\t\tthis.xform  = new SglTransformStack();\r\n\t\t/*************************************************************/\r\n\r\n\t\tthis.renderer = new MultiResRenderer(gl, 256 * 1024 * 1024);\r\n\t\t\r\n\t\tthis.translation = [ 0.0, 0.0 ];\r\n\t\tthis.mat = sglIdentityM4();\r\n\t\tthis.flipMatrix = sglIdentityM4();\r\n\t\tif (this.imageUrl != \"\")\r\n\t\t\tthis.loadImage(this.imageUrl);\r\n\t\telse if(this.imageFunction !== null)\r\n\t\t\tthis.loadImage(this.imageFunction);\r\n\t},\r\n\t\r\n\t\r\n\tloadImage : function(url)\r\n\t{\r\n\t\tthis.renderer.loadImage(url);\r\n\t\tthis.OnLoadImageCallback(this.renderer.type);\r\n\t\tthis.xform  = new SglTransformStack();\r\n\t\tthis.translation = [ 0.0, 0.0 ];\r\n\t\tthis.mat = sglIdentityM4();\r\n\t\tthis.rendering = true;\r\n\t\t\r\n\t\tthis.leftBottom = [(this.renderer._tree.scale[0] - this.renderer.imgWidth) / 2.0, (this.renderer._tree.scale[1] - this.renderer.imgHeight) / 2.0];\r\n\t\tthis.rightTop = [this.leftBottom[0] + this.renderer.imgWidth, this.leftBottom[1] + this.renderer.imgHeight];\r\n\t\t\r\n\t\tthis.scale = 0;\r\n\t\tvar w = this.ui.width;\r\n\t\tvar h = this.ui.height;\r\n\t\tvar scale1 = this.renderer._tree.scale[0] / this.renderer.imgWidth * w;\r\n\t\tvar scale2 = this.renderer._tree.scale[1] / this.renderer.imgHeight * h;\r\n\t\tthis.scale = Math.min(scale1, scale2);\r\n\t\tthis.maxScale = Math.max(this.renderer.imgWidth / w, this.renderer.imgHeight / h) * 2.5;\r\n\t\tthis.viewerdx = 100;\r\n\t\tthis.viewerdy = 100;\r\n\t},\t\t\t\r\n\t\r\n\t\r\n\tstopRendering: function()\r\n\t{\r\n\t\tthis.rendering = false;\r\n\t},\r\n\t\r\n\tsetOnDrawCallback: function(onDraw)\r\n\t{\r\n\t\tif (onDraw)\r\n\t\t\tthis.onDrawCallback = onDraw;\r\n\t},\r\n\r\n\tkeyDown : function(gl, keyCode, keyString)\r\n\t{\r\n\t\tif (keyString == \"R\") this.resetViewpoint();\r\n\t\tif (keyString == \"1\") this.renderer.renderData = !this.renderer.renderData;\r\n\t\tif (keyString == \"2\") this.renderer.renderBoxes = !this.renderer.renderBoxes;\r\n\t},\r\n \r\n\tmouseWheel : function(gl, delta, x, y)\r\n\t{\r\n\t\tif (this.isMoving)\r\n\t\t\treturn false;\r\n\t\tvar tx = x - this.translation[0];\r\n\t\tvar ty = y - this.translation[1];\r\n\t\tvar s = sglPow(0.98, 10 * delta);\r\n\t\tthis._startZoom(s, tx, ty);\r\n\t},\r\n\t\r\n\t\r\n\tstartZoomIn: function()\r\n\t{\r\n\t\tif (this.isMoving)\r\n\t\t\treturn false;\r\n\t\tvar tx = this.ui.width / 2.0 - this.translation[0];\r\n\t\tvar ty = this.ui.height / 2.0 - this.translation[1];\r\n\t\tvar s = 1.2;\r\n\t\tthis._startZoom(s, tx, ty);\r\n\t},\r\n\t\r\n\t\r\n\tstartZoomOut: function()\r\n\t{\r\n\t\tif (this.isMoving)\r\n\t\t\treturn false;\r\n\t\tvar tx = this.ui.width / 2.0 - this.translation[0];\r\n\t\tvar ty = this.ui.height / 2.0 - this.translation[1];\r\n\t\tvar s = 0.8;\r\n\t\tthis._startZoom(s, tx, ty);\r\n\t},\r\n\t\r\n\t\r\n\t_startZoom: function(s, tx, ty)\r\n\t{\r\n\t\tvar tmp = this.mat[0] * s;\r\n\t\tif (tmp  > this.maxScale)\r\n\t\t\ts = this.maxScale / this.mat[0];\r\n\t\tif (tmp < 1.0 )\r\n\t\t\ts = 1.0 / this.mat[0];\r\n\t\tif (tmp <= 1.00000001)\r\n\t\t\tthis.moveToCenter = true;\r\n\t\tvar deltaPos = s*this.mat[0] - this.mat[0];\r\n\t\tif (deltaPos > 0.0001 || deltaPos < -0.0001)\r\n\t\t{\r\n\t\t\tthis.animationStack = [];\r\n\t\t\tvar t = this.maxStep * 2; \r\n\t\t\tvar d = 3 * deltaPos /(t * t * t);\r\n\t\t\tvar b = -2 * t * d;\r\n\t\t\tvar speed = d * t * t;\r\n\t\t\tvar tmpScale = this.mat[0];\r\n\t\t\tfor (var i = 0; i < t; i++)\r\n\t\t\t{\r\n\t\t\t\tvar delta = d * i + d / 3.0 + b / 2.0 + speed;\r\n\t\t\t\tspeed += d * (2*i + 1) + b;\r\n\t\t\t\tvar deltaScale = 1 + delta / tmpScale;\r\n\t\t\t\ttmpScale += delta;\r\n\t\t\t\tthis.animationStack.push([deltaScale, tx, ty]);\r\n\t\t\t}\r\n\t\t\tthis.animating = this.moveToCenter;\r\n\t\t\tvar that = this;\r\n\t\t\tclearInterval(this.moveInterval);\r\n\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\tthis.zoomInterval = setInterval(function(){that._zoomAnimation();}, 35);\r\n\t\t\tthis.renderer.updateData = false;\r\n\t\t\tthis.isMoving = this.moveToCenter;\r\n\t\t}\r\n\t\telse if (this.moveToCenter)\r\n\t\t{\r\n\t\t\tthis.animating = true;\r\n\t\t\tthis.isMoving = true;\r\n\t\t\tvar that = this;\r\n\t\t\tthis.animationStack = [];\r\n\t\t\tclearInterval(this.moveInterval);\r\n\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\tthis.zoomInterval = setInterval(function(){that._zoomAnimation();}, 35);\r\n\t\t\tthis.renderer.updateData = false;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t_zoomAnimation: function()\r\n\t{\r\n\t\tif (this.animationStack.length == 0)\r\n\t\t{\r\n\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\tif (this.moveToCenter)\r\n\t\t\t{\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tclearInterval(this.moveInterval);\r\n\t\t\t\tthis.moveInterval = setInterval(function(){that._moveAnimation();}, 35);\r\n\t\t\t\tthis.renderer.updateData = false;\r\n\t\t\t\tthis.isMoving = true;\r\n\t\t\t\t\r\n\t\t\t\tthis.computeModelMatrix();\t\t\t\t\r\n\t\t\t\tvar matrix = this.xform.model.top;\r\n\t\t\t\tvar tempPos = [this.renderer._tree.scale[0] / 2.0, this.renderer._tree.scale[1] / 2.0 ];\r\n\t\t\t\tvar endPoint = [this.ui.width/2.0, this.ui.height/2.0];\r\n\t\t\t\tvar pos = sglMulM4V4(matrix, sglV4C(tempPos[0], tempPos[1], 0.0, 1.0)).slice(0,2);\r\n\t\t\t\tvar deltaX = endPoint[0] - pos[0];\r\n\t\t\t\tvar deltaY = endPoint[1] - pos[1];\r\n\t\t\t\tthis.currentSpeed = 0;\r\n\t\t\t\tthis.currentPoint = pos;\t\t\t\t\r\n\t\t\t\tthis._updateMoveStack(pos, endPoint, sglV2C(deltaX, deltaY));\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis.renderer.updateData = true;\r\n\t\t\tthis.animating = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar step = this.animationStack.splice(0, 1)[0];\r\n\t\tvar s = step[0];\r\n\t\ttx = step[1];\r\n\t\tty = step[2];\r\n\r\n\t\tvar tmpMat = sglMulM4(sglTranslationM4C(tx, ty, 0.0), sglMulM4(sglScalingM4C(s, s, 1.0), sglMulM4(sglTranslationM4C(-tx, -ty, 0.0), this.mat)));\r\n\t\tvar m = this.returnModelMatrix(this.translation, tmpMat);\r\n\t\tvar lb = sglMulM4V4(m, sglV4C(this.leftBottom[0], this.leftBottom[1], 0.0, 1.0)).slice(0,2);\r\n\t\tvar rt = sglMulM4V4(m, sglV4C(this.rightTop[0], this.rightTop[1], 0.0, 1.0)).slice(0,2);\r\n\t\tlb[0] -= this.viewerdx;\r\n\t\tlb[1] -= this.viewerdy;\r\n\t\trt[0] += this.viewerdx;\r\n\t\trt[1] += this.viewerdy;\r\n\t\tvar realwidth = rt[0] - lb[0];\r\n\t\tvar realheight = rt[1] - lb[1];\r\n\t\tvar deltaX = 0;\r\n\t\tvar deltaY = 0;\r\n\t\tif (realwidth > this.ui.width && realheight > this.ui.height)\r\n\t\t{\r\n\t\t\tif (rt[0] < this.ui.width)\r\n\t\t\t\tdeltaX += this.ui.width - rt[0];\r\n\t\t\telse if (lb[0] > 0)\r\n\t\t\t\tdeltaX -= lb[0];\r\n\t\t\tif (rt[1] < this.ui.height)\r\n\t\t\t\tdeltaY += this.ui.height - rt[1];\r\n\t\t\telse if (lb[1] > 0)\r\n\t\t\t\tdeltaY -= lb[1];\r\n\t\t}\r\n\t\telse if (realwidth > this.ui.width)\r\n\t\t{\r\n\t\t\tty = this.ui.height / 2.0 - this.translation[1];\r\n\t\t\tif (rt[0] < this.ui.width)\r\n\t\t\t\tdeltaX += this.ui.width - rt[0];\r\n\t\t\telse if (lb[0] > 0)\r\n\t\t\t\tdeltaX -= lb[0];\r\n\t\t}\r\n\t\telse if (realheight > this.ui.height)\r\n\t\t{\r\n\t\t\ttx = this.ui.width / 2.0 - this.translation[0];\r\n\t\t\tif (rt[1] < this.ui.height)\r\n\t\t\t\tdeltaY += this.ui.height - rt[1];\r\n\t\t\telse if (lb[1] > 0)\r\n\t\t\t\tdeltaY -= lb[1];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttx = this.ui.width / 2.0;\r\n\t\t\tty = this.ui.height / 2.0;\r\n\t\t\tthis.resetViewpoint();\r\n\t\t\tif (this.animationStack.lenght == 0)\r\n\t\t\t{\r\n\t\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\t\tthis.renderer.updateData = true;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.mat = sglMulM4(sglTranslationM4C(tx, ty, 0.0), sglMulM4(sglScalingM4C(s, s, 1.0), sglMulM4(sglTranslationM4C(-tx, -ty, 0.0), this.mat)));\r\n\t\t\r\n\t\tthis.translation[0] += deltaX;\r\n\t\tthis.translation[1] += deltaY;\r\n\t\t\r\n\t\t_SGL_RegisteredCanvas[this.canvas].requestDraw();\r\n\t\treturn;\t\r\n\t},\r\n\t\r\n\tsendMouseDown : function(e)\r\n\t{\r\n\t\t_SGL_RegisteredCanvas[this.canvas].mouseDown(e);\r\n\t},\r\n \r\n\tmouseDown : function(gl, button, x, y)\r\n\t{\r\n\t\tif (this.animating)\r\n\t\t\treturn false;\r\n\t\tif (button == 0)\r\n\t\t{\r\n\t\t\tif (this.ui.keysDown[17])\r\n\t\t\t{\r\n\t\t\t\tthis._setLightDir(x, y);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (this.mode == 0)\r\n\t\t\t{\r\n\t\t\t\tthis.endAnimation = false;\r\n\t\t\t\tthis.currentPoint = [x, y];\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tthis.animationStack = [];\r\n\t\t\t\t\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tclearInterval(this.zoomInterval);\r\n\t\t\t\tclearInterval(this.moveInterval);\r\n\t\t\t\tthis.moveInterval = setInterval(function(){that._moveAnimation();}, 35);\r\n\t\t\t\tthis.renderer.updateData = false;\r\n\t\t\t\tthis.isMoving = true;\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse if (this.mode == 1) \r\n\t\t\t\tthis._setLightDir(x, y);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_moveAnimation: function()\r\n\t{\r\n\t\tif ((this.moveToCenter ||this.endAnimation) && this.animationStack.length == 0)\r\n\t\t{\r\n\t\t\tclearInterval(this.moveInterval);\r\n\t\t\tthis.renderer.updateData = true;\r\n\t\t\tthis.isMoving = false;\r\n\t\t\tthis.animating = false;\r\n\t\t\tthis.moveToCenter = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (this.animationStack.length == 0)\r\n\t\t{\r\n\t\t\tthis.currentSpeed = 0;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar step = this.animationStack.splice(0, 1)[0];\r\n\t\t\r\n\t\tvar deltaX = step[0] - this.currentPoint[0];\r\n\t\tvar deltaY = step[1] - this.currentPoint[1];\r\n\t\tthis.currentSpeed = step[2];\r\n\t\t\r\n\t\tthis.translation[0] += deltaX;\r\n\t\tthis.translation[1] += deltaY;\r\n\t\t\r\n\t\tthis.currentPoint[0] = step[0];\r\n\t\tthis.currentPoint[1] = step[1];\r\n\t\t\r\n\t\t_SGL_RegisteredCanvas[this.canvas].requestDraw();\r\n\t\treturn;\r\n\t},\r\n\t\r\n\t\r\n\tmouseUp : function(gl, button, x, y)\r\n\t{\r\n\t\tif (button == 0)\r\n\t\t{\r\n\t\t\tif (this.mode == 0) \r\n\t\t\t{\r\n\t\t\t\tthis.endAnimation = true;\r\n\t\t\t\tthis.renderer.updateData = true;\r\n\t\t\t\tthis.isMoving = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\tmouseOut:function(gl, button, x, y)\r\n\t{\r\n\t\tthis.endAnimation = true;\r\n\t\tthis.isMoving = false;\r\n\t},\r\n\r\n\tmouseMove: function(gl, x, y)\r\n\t{\r\n\t\tif (this.animating)\r\n\t\t\treturn false;\r\n\t\tif (this.ui.mouseButtonsDown[0])\r\n\t\t{\r\n\t\t\tif (this.mode == 0)\r\n\t\t\t{\r\n\t\t\t\tif (this.ui.keysDown[17])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._setLightDir(x, y);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tvar endPoint = [x, y];\r\n\t\t\t\tvar deltaX = endPoint[0] - this.currentPoint[0];\r\n\t\t\t\tvar deltaY = endPoint[1] - this.currentPoint[1];\r\n\t\t\t\t\r\n\t\t\t\tvar tmpVector = this._adjustTranslation(deltaX, deltaY);\r\n\t\t\t\tendPoint = [this.currentPoint[0] + tmpVector[0], this.currentPoint[1] + tmpVector[1]];\r\n\t\t\t\tthis._updateMoveStack(this.currentPoint, endPoint, tmpVector);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis._setLightDir(x, y);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t\r\n\t_updateMoveStack: function(startPoint, endPoint, deltaVect)\r\n\t{\r\n\t\tvar deltaPos = sglLengthV2(deltaVect);\r\n\t\tif (deltaPos > 0.1)\r\n\t\t{\r\n\t\t\tthis.animationStack.splice(0, this.animationStack.length);\r\n\t\t\tvar movementVector = sglNormalizedV2(deltaVect);\r\n\t\t\tvar acceleration = (deltaPos / 2.0 - this.currentSpeed * this.maxStep) * 2.0 / (this.maxStep*this.maxStep);\r\n\t\t\tvar speed = this.currentSpeed;\r\n\t\t\tvar tmpPoint = [startPoint[0], startPoint[1]];\r\n\t\t\tvar totDelta = 0;\r\n\t\t\tvar t = this.maxStep;\r\n\t\t\tvar b = 0;\r\n\t\t\tvar d = 0;\r\n\t\t\tif (acceleration > 0)\r\n\t\t\t{\r\n\t\t\t\tfor (var i = 0 ; i < this.maxStep; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar delta = acceleration / 2.0  + speed;\r\n\t\t\t\t\tspeed += acceleration;\r\n\t\t\t\t\ttotDelta += delta;\r\n\t\t\t\t\tvar x = movementVector[0] * delta;\r\n\t\t\t\t\tvar y = movementVector[1] * delta;\r\n\t\t\t\t\ttmpPoint[0] += x;\r\n\t\t\t\t\ttmpPoint[1] += y;\r\n\t\t\t\t\tthis.animationStack.push([tmpPoint[0], tmpPoint[1], speed, acceleration]);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tt = 3 * deltaPos / (2 * speed);\r\n\t\t\t\td = 4 * speed * speed * speed / (9 * deltaPos * deltaPos);\r\n\t\t\t\tb = - 4 * speed * speed / (3 * deltaPos);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tt = 6 * deltaPos / (2 * speed);\r\n\t\t\t\td = speed * speed * speed / (9 * deltaPos * deltaPos);\r\n\t\t\t\tb = - 2 * speed * speed / (3 * deltaPos);\r\n\t\t\t}\t\t\t\t\t\r\n\t\t\t\r\n\t\t\tfor (var i = 0 ; i < t; i++)\r\n\t\t\t{\r\n\t\t\t\tvar delta = d * i + d / 3.0 + b / 2.0 + speed;\r\n\t\t\t\tspeed += d * (2*i + 1) + b;\r\n\t\t\t\tvar acc = d * (i + 1) + b; \r\n\t\t\t\tvar x = movementVector[0] * delta;\r\n\t\t\t\tvar y = movementVector[1] * delta;\r\n\t\t\t\ttmpPoint[0] += x;\r\n\t\t\t\ttmpPoint[1] += y;\r\n\t\t\t\tthis.animationStack.push([tmpPoint[0], tmpPoint[1], speed, d]);\r\n\t\t\t}\r\n\t\t\tthis.animationStack.push([endPoint[0], endPoint[1], 0, 0]);\t\r\n\t\t}\r\n\t},\r\n\t\r\n\t_adjustTranslation: function(deltaX, deltaY)\r\n\t{\r\n\t\tvar translVector = sglV4C(this.translation[0] + deltaX, this.translation[1] + deltaY, 0, 1.0);\r\n\t\tvar m = this.returnModelMatrix(translVector, this.mat);\r\n\t\t\r\n\t\tvar lb = sglMulM4V4(m, sglV4C(this.leftBottom[0], this.leftBottom[1], 0.0, 1.0)).slice(0,2);\r\n\t\tvar rt = sglMulM4V4(m, sglV4C(this.rightTop[0], this.rightTop[1], 0.0, 1.0)).slice(0,2);\r\n\t\tlb[0] -= this.viewerdx;\r\n\t\tlb[1] -= this.viewerdy;\r\n\t\trt[0] += this.viewerdx;\r\n\t\trt[1] += this.viewerdy;\r\n\t\tvar realwidth = rt[0] - lb[0];\r\n\t\tvar realheight = rt[1] - lb[1];\r\n\t\tvar realDeltaX = deltaX;\r\n\t\tvar realDeltaY = deltaY;\r\n\t\tif (realwidth > this.ui.width && realheight > this.ui.height)\r\n\t\t{\r\n\t\t\tif (rt[0] < this.ui.width)\r\n\t\t\t\trealDeltaX += this.ui.width - rt[0];\r\n\t\t\telse if (lb[0] > 0)\r\n\t\t\t\trealDeltaX -= lb[0];\r\n\t\t\tif (rt[1] < this.ui.height)\r\n\t\t\t\trealDeltaY += this.ui.height - rt[1];\r\n\t\t\telse if (lb[1] > 0)\r\n\t\t\t\trealDeltaY -= lb[1];\r\n\t\t}\r\n\t\telse if (realwidth > this.ui.width)\r\n\t\t{\r\n\t\t\tif (rt[0] < this.ui.width)\r\n\t\t\t\trealDeltaX += this.ui.width - rt[0];\r\n\t\t\telse if (lb[0] > 0)\r\n\t\t\t\trealDeltaX -= lb[0];\r\n\t\t\trealDeltaY = 0;\r\n\t\t}\r\n\t\telse if (realheight > this.ui.height)\r\n\t\t{\r\n\t\t\tif (rt[1] < this.ui.height)\r\n\t\t\t\trealDeltaY += this.ui.height - rt[1];\r\n\t\t\telse if (lb[1] > 0)\r\n\t\t\t\trealDeltaY -= lb[1];\r\n\t\t\trealDeltaX = 0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\trealDeltaX = 0;\r\n\t\t\trealDeltaY = 0;\r\n\t\t}\r\n\t\treturn sglV2C(realDeltaX, realDeltaY);\t\r\n\t},\r\n\t\r\n\tupdate : function(gl, dt)\r\n\t{\r\n\t\t;\r\n\t},\r\n\t\r\n\t\r\n\treturnModelMatrix: function(translVect, scaleMatrix)\r\n\t{\r\n\t\tvar m = (sglMulM4(sglTranslationM4C(translVect[0], translVect[1], 1.0), scaleMatrix));\r\n\t\tm = sglMulM4(this.flipMatrix, m);\r\n\t\tthis.xform.model.load(m);\r\n\t\r\n\t\tvar t = sglTranslationM4C(this.ui.width / 2.0, this.ui.height / 2.0, 0.0);\r\n\t\t\r\n\t\tthis.xform.model.multiply(t);\r\n\t\tthis.xform.model.scale(this.scale, this.scale, 1.0);\r\n\t\tthis.xform.model.multiply(this.renderer.normalizedTreeTransform);\r\n\t\treturn this.xform.model.top;\r\n\t},\r\n\t\r\n\t\r\n\tcomputeModelMatrix: function()\r\n\t{\r\n\t\tvar m = (sglMulM4(sglTranslationM4C(this.translation[0], this.translation[1], 1.0), this.mat));\r\n\t\tm = sglMulM4(this.flipMatrix, m);\r\n\t\tthis.xform.model.load(m);\r\n\t\r\n\t\tvar t = sglTranslationM4C(this.ui.width / 2.0, this.ui.height / 2.0, 0.0);\r\n\t\t\r\n\t\tthis.xform.model.multiply(t);\r\n\t\tthis.xform.model.scale(this.scale, this.scale, 1.0);\r\n\t\tthis.xform.model.multiply(this.renderer.normalizedTreeTransform);\r\n\t},\r\n\t\r\n\t\r\n\tresize : function()\r\n\t{\r\n\t\tthis.xform  = new SglTransformStack();\r\n\t\tthis.translation = [ 0.0, 0.0 ];\r\n\t\tthis.mat = sglIdentityM4();\r\n\t\tthis.rendering = true;\r\n\t\t\r\n\t\tthis.leftBottom = [(this.renderer._tree.scale[0] - this.renderer.imgWidth) / 2.0, (this.renderer._tree.scale[1] - this.renderer.imgHeight) / 2.0];\r\n\t\tthis.rightTop = [this.leftBottom[0] + this.renderer.imgWidth, this.leftBottom[1] + this.renderer.imgHeight];\r\n\t\t\r\n\t\tthis.scale = 0;\r\n\t\tvar w = this.ui.width;\r\n\t\tthis.offsetHeight = 0;\r\n\t\tvar h = this.ui.height + this.offsetHeight;\r\n\t\t\r\n\t\tthis.scale = Math.min(this.renderer._tree.scale[0] / this.renderer.imgWidth * w, this.renderer._tree.scale[1] / this.renderer.imgHeight * h);\r\n\t\tthis.maxScale = Math.max(this.renderer.imgWidth / w, this.renderer.imgHeight / h) * 3;\r\n\t\t\r\n\t\tthis.viewerdx = this.ui.width / 2.0 - 10;\r\n\t\tthis.viewerdy = this.ui.height / 2.0 - 10;\r\n\t},\r\n\t\r\n\r\n\tdraw : function(gl)\r\n\t{\r\n\t\tvar error = gl.getError();\r\n\t\tif (error == gl.CONTEXT_LOST_WEBGL)\r\n\t\t\tconsole.log(\"WebGL Context lost\");\r\n\t\tgl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\r\n\t\tif (this.rendering == true)\r\n\t\t{\r\n\t\t\tvar w = this.ui.width;\r\n\t\t\tvar h = this.ui.height;\r\n\r\n\t\t\tgl.viewport(0, 0, w, h);\r\n\r\n\t\t\tthis.xform.projection.loadIdentity();\r\n\t\t\tthis.xform.projection.ortho(0.0, w, 0.0, h, -4096.0, 4096.0);\r\n\r\n\t\t\tthis.xform.view.loadIdentity();\r\n\t\t\tthis.xform.view.lookAt(0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0);\r\n\r\n\t\t\tthis.computeModelMatrix();\r\n\t\t\t\t\t\r\n\t\t\tvar m = this.xform.model.top;\r\n\t\t\tif (this.onDrawCallback)\r\n\t\t\t\tthis.onDrawCallback(m);\r\n\t\t\t\r\n\t\t\tthis.renderer.render(this.xform.projectionMatrix, this.xform.modelViewMatrix, [ 0, 0, w, h ]);\r\n\t\t}\r\n\t},\r\n};\r\n\r\n\r\n\r\n\r\nfunction MultiResNode()\r\n{\r\n\tthis.id              = 0;\r\n\tthis.parentIndex     = -1;\r\n\tthis.childrenIndices = [ -1, -1, -1, -1 ];\r\n\tthis.projectedSize   = 1.0;\r\n\tthis.zScale          = 1.0;\r\n\tthis.box             = new SglBox3();\r\n\tthis.priority        = { timestamp: -1, error: Number.MAX_VALUE };\r\n\tthis.req             = null;\r\n\tthis.data            = null;\r\n\tthis.isLeaf          = true;\r\n}\r\n\r\n\r\n\r\nfunction MultiResTree(url, onloadCallback)\r\n{\r\n\tthis.ready      = true;\r\n\tthis.nodesCount = 0;\r\n\tthis.rootIndex  = -1;\r\n\tthis.nodes      = null;\r\n\tthis.url        = null;\r\n\tthis.tileSize   = 0;\r\n\tthis.scale      = [ 1.0, 1.0, 1.0 ];\r\n\tthis.offset     = [ 0.0, 0.0, 0.0 ];\r\n\tthis.forma\t\t= \"\";\r\n\r\n\tif (url)\r\n\t\tthis.load(url, imgW, imgH, onloadCallback);\r\n}\r\n\r\nMultiResTree.prototype = {\r\n\r\n\t_load : function(text, imgW, imgH)\r\n\t{\r\n\t\tthis.ready = true;\r\n\r\n\t\tvar lines = sglGetLines(text);\r\n\t\tvar n = lines.length;\r\n\t\tvar tokens = null;\r\n\t\tvar i = 0;\r\n\r\n\t\tif (n <= i) return;\r\n\t\ttokens = lines[i++].split(\" \");\r\n\t\tif (tokens.length < 2) return;\r\n\t\tvar nodesCount = parseInt(tokens[0]);\r\n\t\tif (nodesCount <= 0) return;\r\n\t\tvar rootIndex = parseInt(tokens[1]);\r\n\t\tif ((rootIndex < 0) || (rootIndex >= nodesCount)) return;\r\n\r\n\t\tif (n <= i) return;\r\n\t\ttokens = lines[i++].split(\" \");\r\n\t\tif (tokens.length < 1) return;\r\n\t\tvar tileSize = parseInt(tokens[0]);\r\n\t\tif (tileSize <= 0) return;\r\n\r\n\t\tif (n <= i) return;\r\n\t\ttokens = lines[i++].split(\" \");\r\n\t\tif (tokens.length < 3) return;\r\n\t\tvar scale = [ 1.0, 1.0, 1.0 ];\r\n\t\tscale[0] = parseFloat(tokens[0]);\r\n\t\tscale[1] = parseFloat(tokens[1]);\r\n\t\tscale[2] = parseFloat(tokens[2]);\r\n\r\n\t\tif (n <= i) return;\r\n\t\ttokens = lines[i++].split(\" \");\r\n\t\tif (tokens.length < 3) return;\r\n\t\tvar offset = [ 0.0, 0.0, 0.0 ];\r\n\t\toffset[0] = parseFloat(tokens[0]);\r\n\t\toffset[1] = parseFloat(tokens[1]);\r\n\t\toffset[2] = parseFloat(tokens[2]);\r\n\r\n\t\tvar nodes = new Array(nodesCount);\r\n\t\tif ( n > i )\r\n\t\t{\r\n\t\t\tfor (var k=0; k<nodesCount; ++k)\r\n\t\t\t{\r\n\t\t\t\tvar node = new MultiResNode();\r\n\r\n\t\t\t\tif (n <= i) return;\r\n\t\t\t\ttokens = lines[i++].split(\" \");\r\n\t\t\t\tif (tokens.length < 14) return;\r\n\r\n\t\t\t\tnode.id = parseInt(tokens[0]);\r\n\t\t\t\tif (node.id <= 0) return;\r\n\r\n\t\t\t\tnode.parentIndex = parseInt(tokens[1]);\r\n\t\t\t\tif ((node.parentIndex < -1) || (node.parentIndex >= nodesCount)) return;\r\n\r\n\t\t\t\tfor (var c=0; c<4; ++c) \r\n\t\t\t\t{\r\n\t\t\t\t\tnode.childrenIndices[c] = parseInt(tokens[c+2]);\r\n\t\t\t\t\tif ((node.childrenIndices[c] < -1) || (node.childrenIndices[c] >= nodesCount)) return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode.projectedSize = parseFloat(tokens[6]);\r\n\r\n\t\t\t\tnode.zScale = parseFloat(tokens[7]);\r\n\r\n\t\t\t\tnode.box.min[0] = parseFloat(tokens[ 8]);\r\n\t\t\t\tnode.box.min[1] = parseFloat(tokens[ 9]);\r\n\t\t\t\tnode.box.min[2] = parseFloat(tokens[10]);\r\n\t\t\t\tnode.box.max[0] = parseFloat(tokens[11]);\r\n\t\t\t\tnode.box.max[1] = parseFloat(tokens[12]);\r\n\t\t\t\tnode.box.max[2] = parseFloat(tokens[13]);\r\n\r\n\t\t\t\tnode.isLeaf = true;\r\n\t\t\t\tfor (var j=0; j<4; ++j) \r\n\t\t\t\t{\r\n\t\t\t\t\tif (node.childrenIndices[j] >= 0) \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnode.isLeaf = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnodes[k] = node;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar index = 0;\r\n\t\t\tvar temp = scale[0];\r\n\t\t\tvar nLevel = 1;\r\n\t\t\twhile (temp > tileSize)\r\n\t\t\t{\r\n\t\t\t\tnLevel++;\r\n\t\t\t\ttemp /= 2;\r\n\t\t\t}\r\n\t\t\tvar woffset = ((scale[0] - imgW) / 2.0) / scale[0];\r\n\t\t\tvar hoffset = ((scale[1] - imgH) / 2.0) / scale[1];\r\n\t\t\tvar imgBox = new SglBox3([woffset, hoffset, 0], [woffset + imgW / scale[0] , hoffset + imgH / scale[1], 1.0]);\r\n\t\t\tvar imgSize = imgBox.size;\r\n\t\t\tvar imgCenter = imgBox.center;\r\n\t\t\tfor (var i = 0; i < nLevel; i++)\r\n\t\t\t{\r\n\t\t\t\tvar count = Math.pow(4, i);\r\n\t\t\t\tfor (var j = 0; j < count; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar node = new MultiResNode();\r\n\t\t\t\t\tnode.id = index + 1;\r\n\t\t\t\t\tif (index > 0)\r\n\t\t\t\t\t\tnode.parentIndex = Math.ceil(index / 4) - 1;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tnode.parentIndex = -1;\r\n\t\t\t\t\tif (i < nLevel - 1)\r\n\t\t\t\t\t\tnode.isLeaf = false;\r\n\t\t\t\t\tfor (var c=0; c<4; ++c) \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (i == nLevel - 1)\r\n\t\t\t\t\t\t\tnode.childrenIndices[c] = -1;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tnode.childrenIndices[c] = index * 4 + 1 + (c + 2) % 4;\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\tnode.projectedSize = tileSize;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tif (index > 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar t = index % 4;\r\n\t\t\t\t\t\tvar parentNode = nodes[node.parentIndex];\r\n\t\t\t\t\t\tvar halfW = parentNode.box.min[0] + (parentNode.box.max[0] -  parentNode.box.min[0]) / 2.0;\r\n\t\t\t\t\t\tvar halfH = parentNode.box.min[1] + (parentNode.box.max[1] -  parentNode.box.min[1]) / 2.0;\r\n\t\t\t\t\t\tif (t == 1)\r\n\t\t\t\t\t\t\tnode.box = new SglBox3([parentNode.box.min[0], halfH, 0.0], [halfW, parentNode.box.max[1], 1.0]);\r\n\t\t\t\t\t\telse if (t == 2)\r\n\t\t\t\t\t\t\tnode.box = new SglBox3([halfW, halfH, 0.0], parentNode.box.max);\r\n\t\t\t\t\t\telse if (t == 3)\r\n\t\t\t\t\t\t\tnode.box = new SglBox3(parentNode.box.min, [halfW, halfH, 1.0]);\r\n\t\t\t\t\t\telse if (t == 0)\r\n\t\t\t\t\t\t\tnode.box = new SglBox3([halfW, parentNode.box.min[1], 0.0], [parentNode.box.max[0], halfH, 1.0]);\r\n\t\t\t\t\t\tvar center = node.box.center;\r\n\t\t\t\t\t\tvar size = node.box.size;\r\n\t\t\t\t\t\tvar halfSize = sglSelfMulV3S(sglAddV3(imgSize, size), 0.5);\r\n\t\t\t\t\t\tvar diff = sglSubV3(imgCenter, center);\r\n\t\t\t\t\t\tif (Math.abs(diff[0]) <= halfSize[0] && Math.abs(diff[1]) <= halfSize[1] && Math.abs(diff[2]) <= halfSize[2])\r\n\t\t\t\t\t\t\tnode.zScale = 1;\r\n\t\t\t\t\t\telse \r\n\t\t\t\t\t\t\tnode.zScale = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnode.box = new SglBox3([0.0, 0.0, 0.0], [1.0, 1.0, 1.0]);\r\n\t\t\t\t\t\tnode.zScale = 1;\r\n\t\t\t\t\t}\t\r\n\t\t\t\t\tnodes[index] = node;\r\n\t\t\t\t\tindex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.nodesCount = nodesCount;\r\n\t\tthis.rootIndex  = rootIndex;\r\n\t\tthis.tileSize   = tileSize;\r\n\t\tthis.scale      = scale;\r\n\t\tthis.offset     = offset;\r\n\t\tthis.nodes      = nodes;\r\n\t},\r\n\r\n\tdestroy : function(destroyData)\r\n\t{\r\n\t\tvar n = null;\r\n\t\tfor (var i in this.nodes) \r\n\t\t{\r\n\t\t\tn = this.nodes[i];\r\n\t\t\tif (n.req) \r\n\t\t\t{\r\n\t\t\t\tn.req.onLoad = null;\r\n\t\t\t\tn.req = null;\r\n\t\t\t}\r\n\t\t\tif (n.data) \r\n\t\t\t{\r\n\t\t\t\tdestroyData(n.data);\r\n\t\t\t\tn.data = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.ready      = true;\r\n\t\tthis.nodesCount = 0;\r\n\t\tthis.rootIndex  = -1;\r\n\t\tthis.nodes      = null\r\n\t\tthis.url        = null;\r\n\t\tthis.tileSize   = 0;\r\n\t\tthis.scale      = [ 1.0, 1.0, 1.0 ];\r\n\t},\r\n\r\n\tload : function(url, imgW, imgH, onloadCallback)\r\n\t{\r\n\t\tif (!url) return false;\r\n\t\tthis._load(url, imgW, imgH);\r\n\t},\r\n\r\n\tget isEmpty() \r\n\t{\r\n\t\treturn (this.nodesCount <= 0);\r\n\t},\r\n\r\n\tget root() \r\n\t{\r\n\t\tvar idx = this.rootIndex;\r\n\t\tif (idx < 0) return null;\r\n\t\treturn this.nodes[idx];\r\n\t},\r\n\r\n\tparent : function(n)\r\n\t{\r\n\t\tvar idx = n.parentIndex;\r\n\t\tif (idx < 0) return null;\r\n\t\treturn this.nodes[idx];\r\n\t},\r\n\r\n\tchild: function(n, i)\r\n\t{\r\n\t\tvar idx = n.childrenIndices[i];\r\n\t\tif (idx < 0) return null;\r\n\t\treturn this.nodes[idx];\r\n\t}\r\n};\r\n\r\nfunction _MultiResAssert(cond) \r\n{\r\n\tif (cond) return;\r\n\talert(\"MultiResAssert FAILED : \" + cond);\r\n}\r\n\r\nfunction _MultiResCompareNodes(a, b)\r\n{\r\n\t// higher timestamp first\r\n\tif (a.priority.timestamp != b.priority.timestamp)\r\n\t\treturn (b.priority.timestamp - a.priority.timestamp);\r\n\t\r\n\t// higher error first\r\n\tif (a.priority.error != b.priority.error)\r\n\t\treturn (b.priority.error - a.priority.error);\r\n\r\n\t// lower id first\r\n\treturn (a.id - b.id);\r\n};\r\n\r\nfunction MultiResRenderer(gl, cacheSizeInBytes, onLoad)\r\n {\r\n\tthis.lg = true;\r\n\tthis.gl = gl;\r\n\tthis._tree = new MultiResTree();\r\n\tthis._timestamp = 0;\r\n\tthis._frustum = new SglFrustum();\r\n\tthis._maxError = 1.0;\r\n\tthis._cache = [ ];\r\n\tthis._cacheSizeInBytes = cacheSizeInBytes;\r\n\tthis._maxCacheSize = 1;\r\n\tthis._maxOngoingRequests = 2;\r\n\tthis._currentOngoingRequests = 0;\r\n\tthis._toRequest = [ ];\r\n\tthis._toRenderFullRes = [ ];\r\n\tthis._toRenderHalfRes = [ ];\r\n\tthis._readyItems = [ ];\r\n\r\n\tthis.renderData  = true;\r\n\tthis.renderBoxes = false;\r\n\t//this.lightPos    = [ 0.0, 0.0, 1.0 ];\r\n\t//this.lweights \t = this.computeLightingFunction(this.lightPos);\r\n\r\n\t// box mesh\r\n\t/******************************************************/\r\n\tvar boxPositions = new Float32Array([\r\n\t\t-0.5, -0.5,  0.5,\r\n\t\t 0.5, -0.5,  0.5,\r\n\t\t-0.5,  0.5,  0.5,\r\n\t\t 0.5,  0.5,  0.5,\r\n\t\t-0.5, -0.5, -0.5,\r\n\t\t 0.5, -0.5, -0.5,\r\n\t\t-0.5,  0.5, -0.5,\r\n\t\t 0.5,  0.5, -0.5\r\n\t ]);\r\n\r\n\tvar trianglesIndices = new Uint16Array([\r\n\t\t0, 1, 2,  2, 1, 3,  // front\r\n\t\t5, 4, 7,  7, 4, 6,  // back\r\n\t\t4, 0, 6,  6, 0, 2,  // left\r\n\t\t1, 5, 3,  3, 5, 7,  // right\r\n\t\t2, 3, 6,  6, 3, 7,  // top\r\n\t\t4, 5, 0,  0, 5, 1   // bottom\r\n\t]);\r\n\r\n\tvar edgesIndices = new Uint16Array([\r\n\t\t0, 1, 1, 3, 3, 2, 2, 0,  // front\r\n\t\t5, 4, 4, 6, 6, 7, 7, 5,  // back\r\n\t\t0, 4, 1, 5, 3, 7, 2, 6   // middle\r\n\t]);\r\n\r\n\tvar box = new SglMeshGL(gl);\r\n\r\n\tbox.addVertexAttribute(\"position\", 3, boxPositions);\r\n\tbox.addIndexedPrimitives(\"triangles\", gl.TRIANGLES, trianglesIndices);\r\n\tbox.addIndexedPrimitives(\"edges\",     gl.LINES,     edgesIndices);\r\n\r\n\tthis._boxMesh = box;\r\n\t/******************************************************/\r\n\r\n\t/******************************************************/\r\n\tthis._tileFullMesh = null;\r\n\tthis._tileHalfMesh = null;\r\n\t/******************************************************/\r\n\r\n\t// image rendering\r\n\t/******************************************************/\r\n\tthis._program = null;\r\n\t/******************************************************/\r\n\r\n\t// box rendering\r\n\t/******************************************************/\r\n\tvar bvs = sglLoadFile(\"/assets/webViewer/spidergl/box.v.glsl\");\r\n\tvar bfs = sglLoadFile(\"/assets/webViewer/spidergl/box.f.glsl\");\r\n\tvar bprg = new SglProgram(gl, [bvs], [bfs]);\r\n\tlog(bprg.log);\r\n\r\n\tthis._boxProgram  = bprg;\r\n\tthis._boxRenderer = new SglMeshGLRenderer(this._boxProgram);\r\n\t/******************************************************/\r\n\r\n\tthis._treeTransform = sglIdentityM4();\r\n\tthis._normalizedTreeTransform = sglIdentityM4();\r\n\r\n\tthis.updateData = true;\r\n\r\n\tvar texVsrc = \"#ifdef GL_ES\\n\" + \"precision highp float;\\n\" + \"#endif\\n\" + \"uniform   mat4 u_mvp;\\n\" + \"attribute vec2 a_position;\\n\" + \"attribute vec2 a_texcoord;\\n\" + \"varying   vec2 v_texcoord;\\n\" + \"void main(void){\\n\" +\"v_texcoord  = a_texcoord;\\n\" + \"gl_Position = u_mvp * vec4(a_position, 0.0, 1.0);\\n}\";\r\n\tvar texFsrc = \"#ifdef GL_ES\\n\" + \"precision highp float;\\n\" + \"#endif\\n\" + \"uniform sampler2D s_texture;\\n\" + \"varying vec2     v_texcoord;\\n\" + \"void main(void){\" + \"vec4 color = texture2D(s_texture, v_texcoord).xyzw;\\n\" + \"if (color.w > 0.7)\\n\" + \"gl_FragData[0] = vec4(color.rgb, 1.0);\\n\" + \"else\\n\" +\r\n\t\"gl_FragData[0] = vec4(0.0);}\";\t\r\n\tthis.texProg = new SglProgram(this.gl, [texVsrc], [texFsrc]);\r\n\tlog(this.texProg.log);\r\n\t\t\r\n\tvar lgPositions = new Float32Array\r\n\t([\r\n\t\t 0, 0,\r\n\t\t 80,  0,\r\n\t\t 0,  50,\r\n\t\t 80,  50,\r\n\t]);\r\n\r\n\tvar lgTexcoords = new Float32Array\r\n\t([\r\n\t\t0.0, 0.0,\r\n\t\t1.0, 0.0,\r\n\t\t0.0, 1.0,\r\n\t\t1.0, 1.0\r\n\t]);\r\n\r\n\tif (this.lg)\r\n\t{\r\n\t\tvar tmp = new SglMeshGL(this.gl);\r\n\t\ttmp.addVertexAttribute(\"position\", 2, lgPositions);\r\n\t\ttmp.addVertexAttribute(\"texcoord\", 2, lgTexcoords);\r\n\t\ttmp.addArrayPrimitives(\"tristrip\", this.gl.TRIANGLE_STRIP, 0, 4);\r\n\t\tthis.lgMesh = tmp;\r\n\t\tthis.lgtex = null;\r\n\t\tthis._createLg();\r\n\t}\r\n\t\r\n\tthis.enumType = new Object();\r\n\tthis.enumType[\"HSH_RTI\"] = 1;\r\n\tthis.enumType[\"LRGB_PTM\"] = 2;\r\n\tthis.enumType[\"RGB_PTM\"] = 3;\r\n\tthis.enumType[\"IMAGE\"] = 4;\r\n}\r\n\r\n\r\nMultiResRenderer.prototype = {\r\n\r\n\tcomputeLightingFunction: function(lpos)\r\n\t{\r\n\t\tswitch (this.enumType[this.type])\r\n\t\t{\r\n\t\t\tcase 1:\r\n\t\t\t\tvar phi = Math.atan2(lpos[1], lpos[0]);\r\n\t\t\t\tif (phi < 0) \r\n\t\t\t\t\tphi = 2 * Math.PI + phi;\r\n\t\t\t\tvar theta = Math.min(Math.acos(lpos[2]), Math.PI / 2 - 0.15);\r\n\t\t\t\t\t\r\n\t\t\t\tvar cosPhi = Math.cos(phi);\r\n\t\t\t\tvar cosTheta = Math.cos(theta);\r\n\t\t\t\tvar cosTheta2 = cosTheta * cosTheta;\r\n\t\t\t\t\r\n\t\t\t\tvar lweights = new Array(9);\r\n\t\t\t\tlweights[0] = 1.0 / Math.sqrt(2.0 * Math.PI);\r\n\t\t\t\tlweights[1] = Math.sqrt(6.0 / Math.PI) * (cosPhi * Math.sqrt(cosTheta-cosTheta2));\r\n\t\t\t\tlweights[2] = Math.sqrt(3.0 / (2.0 * Math.PI)) * (-1.0 + 2.0*cosTheta);\r\n\t\t\t\tlweights[3] = Math.sqrt(6.0 / Math.PI) * (Math.sqrt(cosTheta - cosTheta2) * Math.sin(phi));\r\n\t\t\t\t\r\n\t\t\t\tlweights[4] = Math.sqrt(30.0 / Math.PI) * (Math.cos(2.0 * phi) * (-cosTheta + cosTheta2));\r\n\t\t\t\tlweights[5] = Math.sqrt(30.0 / Math.PI) * (cosPhi*(-1.0 + 2.0 * cosTheta) * Math.sqrt(cosTheta - cosTheta2));\r\n\t\t\t\tlweights[6] = Math.sqrt(5.0 / (2.0 * Math.PI)) * (1.0 - 6.0 * cosTheta + 6.0 * cosTheta2);\r\n\t\t\t\tlweights[7] = Math.sqrt(30.0 / Math.PI) * ((-1.0 + 2.0 * cosTheta) * Math.sqrt(cosTheta - cosTheta2) * Math.sin(phi));\r\n\t\t\t\tlweights[8] = Math.sqrt(30.0 / Math.PI) * ((-cosTheta + cosTheta2) * Math.sin(2.*phi));\r\n\t\t\t\treturn lweights;\r\n\t\t\tcase 2:\r\n\t\t\tcase 3:\r\n\t\t\t\tvar lweights = new Array(6);\r\n\t\t\t\tlweights[0] = lpos[0] * lpos[0];\r\n\t\t\t\tlweights[1] = lpos[1] * lpos[1];\r\n\t\t\t\tlweights[2] = lpos[0] * lpos[1];\r\n\t\t\t\tlweights[3] = lpos[0];\r\n\t\t\t\tlweights[4] = lpos[1];\r\n\t\t\t\tlweights[5] = 1.0;\r\n\t\t\t\treturn lweights;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t\treturn [];\r\n\t},\r\n\t\r\n\t\r\n\tloadImage: function(url)\r\n\t{\r\n\t\tvar xhttp=new XMLHttpRequest();\r\n\t\tvar targetURL = null;\r\n\t\tif(typeof url === \"string\") {\r\n\t\t\ttargetURL = url + \"/info.xml\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttargetURL = url(\"/info.xml\");\r\n\t\t}\r\n\t\txhttp.overrideMimeType('text/xml');\r\n\t\txhttp.open(\"GET\", targetURL, false);\r\n\t\txhttp.send();\r\n\r\n\t\tvar doc = xhttp.responseXML;\r\n\t\tthis.format = \"jpg\";\r\n\t\tvar val = parseInt(doc.getElementsByTagName(\"MultiRes\")[0].getAttribute(\"format\"));\r\n\t\tif (!isNaN(val))\r\n\t\t\tif (val == 1)\r\n\t\t\t\tthis.format = \"png\";\r\n\t\tvar content = doc.getElementsByTagName(\"Content\")[0];\r\n\t\tthis.type = content.getAttribute(\"type\");\r\n\t\tif (!(this.type in this.enumType))\r\n\t\t\treturn false;\r\n\t\tvar tree = null;\r\n\t\tswitch (this.enumType[this.type])\r\n\t\t{\r\n\t\t\tcase 1:\r\n\t\t\tcase 2:\r\n\t\t\tcase 3:\r\n\t\t\t\tvar size = doc.getElementsByTagName(\"Size\")[0];\r\n\t\t\t\tvar scale = doc.getElementsByTagName(\"Scale\")[0];\r\n\t\t\t\tvar bias = doc.getElementsByTagName(\"Bias\")[0];\r\n\t\t\t\ttree = doc.getElementsByTagName(\"Tree\")[0];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tthis.imgWidth = parseInt(size.getAttribute(\"width\"));\r\n\t\t\t\tthis.imgHeight = parseInt(size.getAttribute(\"height\"));\r\n\t\t\t\tthis.ordlen = parseInt(size.getAttribute(\"coefficients\"));\r\n\t\t\t\tthis.numLayers = this.ordlen;\r\n\t\t\t\tif (this.enumType[this.type] == 2)\r\n\t\t\t\t\tthis.numLayers = 3;\r\n\t\t\t\ttokens = scale.childNodes[0].nodeValue.split(\" \");\r\n\t\t\t\tif (tokens.length < this.ordlen) return;\r\n\t\t\t\tthis.gmax = [];\r\n\t\t\t\tfor (var j = 0; j < this.ordlen; j++ )\r\n\t\t\t\t\tthis.gmax[j] = parseFloat(tokens[j]);\r\n\t\t\t\t\t\t\r\n\t\t\t\ttokens = bias.childNodes[0].nodeValue.split(\" \");\r\n\t\t\t\tif (tokens.length < this.ordlen) return;\r\n\t\t\t\tthis.gmin = [];\r\n\t\t\t\tfor (var j = 0; j < this.ordlen; j++ )\r\n\t\t\t\t\tthis.gmin[j] = parseFloat(tokens[j]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tvar size = doc.getElementsByTagName(\"Size\")[0];\r\n\t\t\t\ttree = doc.getElementsByTagName(\"Tree\")[0];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tthis.imgWidth = parseInt(size.getAttribute(\"width\"));\r\n\t\t\t\tthis.imgHeight = parseInt(size.getAttribute(\"height\"));\r\n\t\t\t\tthis.ordlen = parseInt(size.getAttribute(\"coefficients\"));\r\n\t\t\t\tthis.numLayers = this.ordlen;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn;\t\t\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tif (this._tree)\r\n\t\t\tthis._tree.destroy(this._destroyData);\r\n\t\t\r\n\t\tthis._tree.load(tree.textContent, this.imgWidth, this.imgHeight);\r\n\t\t\r\n\t\tthis._url  = url;\r\n\t\tthis._timestamp = 0;\r\n\t\tthis._frustum = new SglFrustum();\r\n\t\tthis._maxError = 1.0;\r\n\t\tthis._cache = [ ];\r\n\t\tthis._toRequest = [ ];\r\n\t\tthis._toRenderFullRes = [ ];\r\n\t\tthis._toRenderHalfRes = [ ];\r\n\t\tthis._readyItems = [ ];\r\n\r\n\t\tthis.renderData  = true;\r\n\t\tthis.renderBoxes = false;\r\n\t\t\r\n\t\t//var lpos = [0.241844, 0.241844, 0.939692]\r\n\t\t//lpos = sglNormalizedV3(lpos);\r\n\t\t//this.lightPos = lpos.slice(0, 3);\r\n\t\tthis.lightPos    = [ 0.0, 0.0, 1.0 ];\r\n\t\tthis.lweights \t = [];\r\n\t\tthis.lweights \t = this.computeLightingFunction(this.lightPos);\r\n\t\tif (this._program != null)\r\n\t\t\tthis._program.destroy();\r\n\t\tswitch (this.enumType[this.type])\r\n\t\t{\r\n\t\t\tcase 1:\r\n\t\t\t\tvar vs = sglLoadFile(\"/assets/webViewer/spidergl/multi.v.glsl\");\r\n\t\t\t\tvar fs = sglLoadFile(\"/assets/webViewer/spidergl/hsh.f.glsl\");\r\n\t\t\t\tvar prg = new SglProgram(this.gl, [vs], [fs]);\r\n\t\t\t\tlog(prg.log);\r\n\t\t\t\tthis._program  = prg;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tvar vs = sglLoadFile(\"/assets/webViewer/spidergl/multi.v.glsl\");\r\n\t\t\t\tvar fs = sglLoadFile(\"/assets/webViewer/spidergl/lrgbptm.f.glsl\");\r\n\t\t\t\tvar prg = new SglProgram(this.gl, [vs], [fs]);\r\n\t\t\t\tlog(prg.log);\r\n\t\t\t\tthis._program  = prg;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tvar vs = sglLoadFile(\"/assets/webViewer/spidergl/multi.v.glsl\");\r\n\t\t\t\tvar fs = sglLoadFile(\"/assets/webViewer/spidergl/rgbptm.f.glsl\");\r\n\t\t\t\tvar prg = new SglProgram(this.gl, [vs], [fs]);\r\n\t\t\t\tlog(prg.log);\r\n\t\t\t\tthis._program  = prg;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tvar vs = sglLoadFile(\"/assets/webViewer/spidergl/multi.v.glsl\");\r\n\t\t\t\tvar fs = sglLoadFile(\"/assets/webViewer/spidergl/image.f.glsl\");\r\n\t\t\t\tvar prg = new SglProgram(this.gl, [vs], [fs]);\r\n\t\t\t\tlog(prg.log);\r\n\t\t\t\tthis._program  = prg;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis._program = new SglProgram();\r\n\t\t}\r\n\t\tthis._renderer = new SglMeshGLRenderer(this._program);\r\n\t\tthis._treeTransform = sglIdentityM4();\r\n\t\tthis._normalizedTreeTransform = sglIdentityM4();\r\n\t\t\r\n\t\tthis.leftTex = (this._tree.scale[0] - this.imgWidth) / 2.0; \r\n\t\tthis.rightTex = this.leftTex + this.imgWidth; \r\n\t\t\r\n\t\tthis.bottomTex = (this._tree.scale[1] - this.imgHeight) / 2.0; \r\n\t\tthis.topTex = this.bottomTex + this.imgHeight;\r\n\t\tthis.leftTex /= this._tree.scale[0];\r\n\t\tthis.rightTex /= this._tree.scale[0];\r\n\t\t\r\n\t\tthis.bottomTex /= this._tree.scale[1];\r\n\t\tthis.topTex /= this._tree.scale[1];\r\n\t\t\r\n\t\tif (this._tree.ready) \r\n\t\t\tthis._setupTree();\r\n\t},\r\n\r\n\r\n\t_createLg: function()\r\n\t{\r\n\t\tvar canvas=document.createElement(\"canvas\");\r\n\t\tcanvas.height = 50;\r\n\t\tcanvas.width = 80;\r\n\t\tvar ctx = canvas.getContext(\"2d\");\r\n\t\tctx.save();\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(0,0);\r\n\t\tctx.lineTo(80,0);\r\n\t\tctx.lineTo(80,50);\r\n\t\tctx.lineTo(0,50);\r\n\t\tctx.closePath();\r\n\t\tctx.clip();\r\n\t\tctx.strokeStyle = 'rgba(0,0,0,0)';\r\n\t\tctx.lineCap = 'butt';\r\n\t\tctx.lineJoin = 'miter';\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.save();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.transform(0.21814175,0,0,0.21573678,-3.3721339,-3.3665838);\r\n\t\tctx.save();\r\n\t\tctx.translate(14.071762,20);\r\n\t\tctx.save();\r\n\t\tg=ctx.createRadialGradient(239.50893,204.66128888494003,0,239.50893,204.66128888494003,31.820419);\r\n\t\tg.addColorStop(0,\"rgba(255, 255, 255, 1)\");\r\n\t\tg.addColorStop(1,\"rgba(151, 151, 151, 1)\");\r\n\t\tctx.fillStyle = g;\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 2.4923694133758545;\r\n\t\tctx.lineCap = \"round\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.transform(2.1234583,0,0,1.6108995,-256.37574,-264.34719);\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(271.42857,233.79076);\r\n\t\tctx.translate(240,233.80553976769053);\r\n\t\tctx.rotate(0);\r\n\t\tctx.scale(0.7586207296076113,1);\r\n\t\tctx.arc(0,0,41.42857,-0.00035675303306008355,3.1419494066230014,0);\r\n\t\tctx.scale(1.318181748760332,1);\r\n\t\tctx.rotate(0);\r\n\t\tctx.translate(-240,-233.80553976769053);\r\n\t\tctx.translate(240,233.77598023230948);\r\n\t\tctx.rotate(0);\r\n\t\tctx.scale(0.7586207296076113,1);\r\n\t\tctx.arc(0,0,41.42857,3.141235900556733,6.2835420602127945,0);\r\n\t\tctx.scale(1.318181748760332,1);\r\n\t\tctx.rotate(0);\r\n\t\tctx.translate(-240,-233.77598023230948);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.fillStyle = \"#ececec\";\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 4.609655857086182;\r\n\t\tctx.lineCap = \"butt\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(49.495605,44.507569);\r\n\t\tctx.lineTo(129.49561,79.507569);\r\n\t\tctx.lineTo(209.49561,44.507569);\r\n\t\tctx.lineTo(49.495605,44.507569);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.fillStyle = \"#999999\";\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 4.609655857086182;\r\n\t\tctx.lineCap = \"butt\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(129.49561,174.50757);\r\n\t\tctx.lineTo(129.49561,79.507572);\r\n\t\tctx.lineTo(209.49561,44.507572);\r\n\t\tctx.lineTo(129.49561,174.50757);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tctx.fillStyle = \"#b3b3b3\";\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 4.609655857086182;\r\n\t\tctx.lineCap = \"butt\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(129.49561,174.50757);\r\n\t\tctx.lineTo(129.49561,79.507569);\r\n\t\tctx.lineTo(49.495605,44.507569);\r\n\t\tctx.lineTo(129.49561,174.50757);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.save();\r\n\t\tg=ctx.createLinearGradient(236.58487,196.44904,257.4877,320.66739);\r\n\t\tg.addColorStop(0,\"rgba(255, 255, 255, 1)\");\r\n\t\tg.addColorStop(1,\"rgba(151, 151, 151, 1)\");\r\n\t\tctx.fillStyle = g;\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.lineWidth = 3.3579113483428955;\r\n\t\tctx.lineCap = \"round\";\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.miterLimit = 4;\r\n\t\tctx.transform(1.4965962,0,0,1.2591977,-86.218969,-182.0266);\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(271.42857,233.79076);\r\n\t\tctx.translate(240,233.80553976769053);\r\n\t\tctx.rotate(0);\r\n\t\tctx.scale(0.7586207296076113,1);\r\n\t\tctx.arc(0,0,41.42857,-0.00035675303306008355,3.1419494066230014,0);\r\n\t\tctx.scale(1.318181748760332,1);\r\n\t\tctx.rotate(0);\r\n\t\tctx.translate(-240,-233.80553976769053);\r\n\t\tctx.translate(240,233.77598023230948);\r\n\t\tctx.rotate(0);\r\n\t\tctx.scale(0.7586207296076113,1);\r\n\t\tctx.arc(0,0,41.42857,3.141235900556733,6.2835420602127945,0);\r\n\t\tctx.scale(1.318181748760332,1);\r\n\t\tctx.rotate(0);\r\n\t\tctx.translate(-240,-233.77598023230948);\r\n\t\tctx.closePath();\r\n\t\tctx.fill();\r\n\t\tctx.stroke();\r\n\t\tctx.restore();\r\n\t\tctx.restore();\r\n\t\tctx.restore();\r\n\t\tctx.restore();\r\n\t\tvar image = new Image();\r\n\t\tvar dataURL = canvas.toDataURL(\"image/png\");\r\n\t\t// image.crossOrigin = '';\r\n\t\timage.src = dataURL;\r\n\r\n\t\tvar that = this;\r\n\t\timage.onload = function() \r\n\t\t\t\t\t\t{ \r\n\t\t\t\t\t\t\tvar texOpt =\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tgenerateMipmap  : false,\r\n\t\t\t\t\t\t\t\tminFilter       : that.gl.NEAREST,\r\n\t\t\t\t\t\t\t\tmagFilter \t\t: that.gl.NEAREST,\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tthat.lgtex = new SglTexture2D(that.gl, image, texOpt);\r\n\t\t\t\t\t\t}\r\n\t\t\r\n\t\t\r\n\t\tvar error = this.gl.getError();\r\n\t\tconsole.log(error);\r\n\t},\r\n\r\n\r\n\t_createData : function(colorImgs)\r\n\t{\r\n\t\tvar colorTexOpts = {\r\n\t\t\tminFilter : this.gl.LINEAR,\r\n\t\t\tmagFilter : this.gl.LINEAR,\r\n\t\t\tgenerateMipmap : false\r\n\t\t};\r\n\r\n\t\tvar dataTextures = new Array(colorImgs.length);\r\n\t\tfor (var i=0; i < colorImgs.length; ++i) \r\n\t\t\tdataTextures[i] = new SglTexture2D(this.gl, colorImgs[i], colorTexOpts);\r\n\r\n\t\tvar data = {\r\n\t\t\ttextures : dataTextures\r\n\t\t};\r\n\r\n\t\treturn data;\r\n\t},\r\n\r\n\t\r\n\t_destroyData : function(data) \r\n\t{\r\n\t\tif (!data) return;\r\n\t\tfor (var i = 0; i < data.textures.length; ++i) \r\n\t\t\tdata.textures[i].destroy();\r\n\t\t\r\n\t\tdata.textures = null;\r\n\t},\r\n\r\n\t\r\n\t_requestNode : function(n)\r\n\t{\r\n\t\tif (n.req) return;\r\n\r\n\t\tvar that  = this;\r\n\t\tif(typeof this._url === \"string\") {\r\n\t\t\tvar url   = this._url + \"/\" + n.id;\t\r\n\t\t}\r\n\t\t\r\n\r\n\t\tvar requests = new Array();\r\n\r\n\t\tfor (var i = 1; i <= this.numLayers; i++) {\r\n\t\t\tif(typeof this._url === \"string\") {\r\n\t\t\t\tvar targetURL   = url + \"_\" + i + \".\" + this.format;\t\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar targetURL = this._url(\"/\" + n.id + \"_\" + i + \".\" + this.format)\r\n\t\t\t}\r\n\t\t\r\n\t\t\trequests.push(new SglImageRequest(targetURL));\r\n\t\t}\r\n\r\n\t\tvar watcher = new SglRequestWatcher(requests, function(w) {\r\n\t\t\tthat._currentOngoingRequests--;\r\n\t\t\tthat._readyItems.push(n);\r\n\t\t});\r\n\t\tn.req = watcher;\r\n\t\twatcher.send();\r\n\t},\r\n\r\n\t\r\n\t_collectNodesRec : function(n, parentFullyVisible)\r\n\t{\r\n\t\tvar result = {\r\n\t\t\tneeded : false,\r\n\t\t\tusable : ((n.data) ? (true) : (false))\r\n\t\t};\r\n\r\n\t\tif (n.zScale == 0)\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// test visibility only if parent is not completely inside frustum\r\n\t\tif (!parentFullyVisible) \r\n\t\t{\r\n\t\t\tvar visStatus = this._frustum.boxVisibility(n.box.min, n.box.max);\r\n\t\t\tif (visStatus == SGL_OUTSIDE_FRUSTUM) return result;\r\n\t\t\tparentFullyVisible = (visStatus == SGL_INSIDE_FRUSTUM);\r\n\t\t}\r\n\r\n\t\t// node is visible and thus needed\r\n\t\tresult.needed = true;\r\n\r\n\t\t// calculate error\r\n\t\tvar prjSize = this._frustum.projectedSegmentSize(n.box.center, n.box.size[0]);\r\n\t\tvar error   = prjSize / n.projectedSize;\r\n\r\n\t\tn.priority.timestamp = this._timestamp;\r\n\t\tn.priority.error     = error;\r\n\r\n\t\t// if node data is not available, request node and return\r\n\t\tif (!result.usable) \r\n\t\t{\r\n\t\t\tif (!n.req)\r\n\t\t\t{\r\n\t\t\t\tthis._toRequest.push(n);\r\n\t\t\t\t//this._toRequest[n.id] = n;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// if node is below error, render it in full resolution and return\r\n\t\tif ((error < this._maxError) || n.isLeaf)\r\n\t\t{\r\n\t\t\tthis._toRenderFullRes.push(n);\r\n\t\t\t//this._toRenderFullRes[n.id] = n;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// recurse down to children\r\n\t\tvar c = null;\r\n\t\tvar neededCount = 0;\r\n\t\tvar usableCount = 0;\r\n\t\tvar cr = null;\r\n\t\tvar missingChildren = [ ];\r\n\r\n\t\tfor (var i = 0; i < 4; ++i)\r\n\t\t{\r\n\t\t\tc = this._tree.child(n, i);\r\n\t\t\tif (!c) continue;\r\n\t\t\tcr = this._collectNodesRec(c, parentFullyVisible);\r\n\t\t\tif (cr.usable) usableCount++;\r\n\t\t\tif (cr.needed)\r\n\t\t\t{\r\n\t\t\t\tneededCount++;\r\n\t\t\t\tif (!cr.usable)\r\n\t\t\t\t{\r\n\t\t\t\t\tmissingChildren.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//_MultiResAssert(neededCount > 0);\r\n\r\n\t\tif (neededCount > 0) \r\n\t\t{\r\n\t\t\tif (usableCount <= 0)\r\n\t\t\t{\r\n\t\t\t\t// no needed child is available, render node in full resolution\r\n\t\t\t\tthis._toRenderFullRes.push(n);\r\n\t\t\t\t//this._toRenderFullRes[n.id] = n;\r\n\t\t\t}\r\n\t\t\telse if (missingChildren.length > 0)\r\n\t\t\t{\r\n\t\t\t\t// some child is needed but not usable, render their sectors in half resolution (wrt this node)\r\n\t\t\t\tthis._toRenderHalfRes.push({ n: n, children: missingChildren });\r\n\t\t\t\t//this._toRenderHalfRes[n.id] = { n: n, missingChildren: missingChildren };\r\n\t\t\t}\r\n\t\t\t// else all needed children can be rendered\r\n\t\t}\r\n\r\n\t\t// the node is needed and available\r\n\t\treturn result;\r\n\t},\r\n\r\n\t\r\n\t_collectNodes : function() \r\n\t{\r\n\t\tthis._toRequest = [ ];\r\n\t\tthis._toRenderFullRes = [ ];\r\n\t\tthis._toRenderHalfRes = [ ];\r\n\r\n\t\tvar root = this._tree.root;\r\n\t\tif (!root) return;\r\n\r\n\t\tthis._collectNodesRec(root, false);\r\n\t},\r\n\r\n\t\r\n\t_renderNodeFullRes : function(n)\r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_world_box_min : n.box.min,\r\n\t\t\tu_world_box_max : n.box.max\r\n\t\t};\r\n\r\n\t\tvar samplers = [];\r\n\t\tfor (var i = 0; i < this.numLayers; i++)\r\n\t\t\tsamplers['coeff' + i] = n.data.textures[i];\r\n\t\t\r\n\t\tthis._renderer.setUniforms(uniforms);\r\n\t\tthis._renderer.setSamplers(samplers);\r\n\t\tthis._renderer.render();\r\n\t},\r\n\r\n\t_renderNodesFullRes : function(mvp)\r\n\t{\r\n\t\tvar mesh = null;\r\n\t\tvar primitives = null;\r\n\r\n\t\tmesh = this._tileFullMesh;\r\n\t\tprimitives = \"tristrip\";\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tu_model_view_projection_matrix : mvp,\r\n\t\t\tu_scale_bias                   : [ 1.0, 1.0, 0.0, 0.0 ],\r\n\t\t\tu_texcoord_scale_bias          : [ (this._tree.tileSize / (this._tree.tileSize + 2.0)), (1.0 / (this._tree.tileSize + 2.0)) ],\r\n\t\t\tordlen\t\t\t\t\t\t   : this.ordlen,\r\n\t\t\tleftTex                        : this.leftTex,\r\n\t\t\trightTex                       : this.rightTex,\r\n\t\t\tbottomTex                      : this.bottomTex,\r\n\t\t\ttopTex                         : this.topTex\r\n\t\t}\r\n\t\t\r\n\t\tif (this.enumType[this.type] != 4)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < this.ordlen; i++)\r\n\t\t\t{\r\n\t\t\t\tuniforms['gmax' + i] = this.gmax[i];\r\n\t\t\t\tuniforms['gmin' + i] = this.gmin[i];\r\n\t\t\t\tuniforms['lweight' + i] = this.lweights[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis._renderer.begin();\r\n\t\t\tthis._renderer.setUniforms(uniforms);\r\n\t\t\tthis._renderer.beginMesh(mesh);\r\n\t\t\t\tthis._renderer.beginPrimitives(primitives);\r\n\t\t\t\tvar n = null;\r\n\t\t\t\tfor (var i in this._toRenderFullRes)\r\n\t\t\t\t{\r\n\t\t\t\t\tn = this._toRenderFullRes[i];\r\n\t\t\t\t\tthis._renderNodeFullRes(n);\r\n\t\t\t\t}\r\n\t\t\t\tthis._renderer.endPrimitives();\r\n\t\t\tthis._renderer.endMesh();\r\n\t\tthis._renderer.end();\r\n\t},\r\n\r\n\t_renderNodeHalfRes : function(n, children)\r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_world_box_min : null,\r\n\t\t\tu_world_box_max : null,\r\n\t\t\tu_scale_bias    : null\r\n\t\t};\r\n\r\n\t\tvar samplers = [];\r\n\t\tfor (var i = 0; i < this.numLayers; i++)\r\n\t\t\tsamplers['coeff' + i] = n.data.textures[i];\r\n\t\t\r\n\t\tthis._renderer.setSamplers(samplers);\r\n\r\n\t\tvar scaleBias = [\r\n\t\t\t[ 0.5, 0.5, 0.0, 0.0 ],\r\n\t\t\t[ 0.5, 0.5, 0.5, 0.0 ],\r\n\t\t\t[ 0.5, 0.5, 0.0, 0.5 ],\r\n\t\t\t[ 0.5, 0.5, 0.5, 0.5 ]\r\n\t\t];\r\n\r\n\t\tvar c = null;\r\n\t\tfor (var i in children)\r\n\t\t{\r\n\t\t\tc = this._tree.child(n, children[i]);\r\n\t\t\tuniforms.u_world_box_min = c.box.min;\r\n\t\t\tuniforms.u_world_box_max = c.box.max;\r\n\t\t\tuniforms.u_scale_bias    = scaleBias[children[i]];\r\n\t\t\tthis._renderer.setUniforms(uniforms);\r\n\t\t\tthis._renderer.render();\r\n\t\t}\r\n\t},\r\n\r\n\t_renderNodesHalfRes : function(mvp)\r\n\t{\r\n\t\tvar mesh = null;\r\n\t\tvar primitives = null;\r\n\r\n\t\tmesh = this._tileHalfMesh;\r\n\t\tprimitives = \"tristrip\";\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tu_model_view_projection_matrix : mvp,\r\n\t\t\tu_texcoord_scale_bias          : [ (this._tree.tileSize / (this._tree.tileSize + 2.0)), (1.0 / (this._tree.tileSize + 2.0)) ],\r\n\t\t\tordlen\t\t\t\t\t\t   : this.ordlen,\r\n\t\t\tleftTex                        : this.leftTex,\r\n\t\t\trightTex                       : this.rightTex,\r\n\t\t\tbottomTex                      : this.bottomTex,\r\n\t\t\ttopTex                         : this.topTex\r\n\t\t}\r\n\t\t\r\n\t\tif (this.enumType[this.type] != 4)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < this.ordlen; i++)\r\n\t\t\t{\r\n\t\t\t\tuniforms['gmax' + i] = this.gmax[i];\r\n\t\t\t\tuniforms['gmin' + i] = this.gmin[i];\r\n\t\t\t\tuniforms['lweight' + i] = this.lweights[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis._renderer.begin();\r\n\t\t\tthis._renderer.setUniforms(uniforms);\r\n\t\t\tthis._renderer.beginMesh(mesh);\r\n\t\t\t\tthis._renderer.beginPrimitives(primitives);\r\n\t\t\t\tvar nc = null;\r\n\t\t\t\tfor (var i in this._toRenderHalfRes)\r\n\t\t\t\t{\r\n\t\t\t\t\tnc = this._toRenderHalfRes[i];\r\n\t\t\t\t\tthis._renderNodeHalfRes(nc.n, nc.children);\r\n\t\t\t\t}\r\n\t\t\t\tthis._renderer.endPrimitives();\r\n\t\t\tthis._renderer.endMesh();\r\n\t\tthis._renderer.end();\r\n\t},\r\n\r\n\t_renderNodes : function(mvp)\r\n\t{\r\n\t\tthis._renderNodesFullRes(mvp);\r\n\t\tthis._renderNodesHalfRes(mvp);\r\n\t},\r\n\r\n\t_renderNodeFullResBox : function(n) \r\n\t{\r\n\t\tvar sz = n.box.size;\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tu_world_box_min : sglAddV3S(n.box.min, sz[0] * 0.05),\r\n\t\t\tu_world_box_max : sglSubV3S(n.box.max, sz[0] * 0.05),\r\n\t\t\tu_color         : ((n.isLeaf) ? ([1.0, 0.0, 1.0]) : ([0.0, 1.0, 0.0]))\r\n\t\t};\r\n\r\n\t\tthis._boxRenderer.setUniforms(uniforms);\r\n\t\tthis._boxRenderer.render();\r\n\t},\r\n\r\n\t_renderNodesFullResBoxes : function(mvp) \r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_model_view_projection_matrix : mvp\r\n\t\t};\r\n\r\n\t\tthis._boxRenderer.begin();\r\n\t\t\tthis._boxRenderer.setUniforms(uniforms);\r\n\t\t\tthis._boxRenderer.beginMesh(this._boxMesh);\r\n\t\t\t\tthis._boxRenderer.beginPrimitives(\"edges\");\r\n\t\t\t\tvar n = null;\r\n\t\t\t\tfor (var i in this._toRenderFullRes)\r\n\t\t\t\t{\r\n\t\t\t\t\tn = this._toRenderFullRes[i];\r\n\t\t\t\t\tthis._renderNodeFullResBox(n);\r\n\t\t\t\t}\r\n\t\t\t\tthis._boxRenderer.endPrimitives();\r\n\t\t\tthis._boxRenderer.endMesh();\r\n\t\tthis._boxRenderer.end();\r\n\t},\r\n\r\n\t_renderNodeHalfResBox : function(n, children) \r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_world_box_min : null,\r\n\t\t\tu_world_box_max : null,\r\n\t\t\tu_color         : null\r\n\t\t};\r\n\r\n\t\tvar c  = null;\r\n\t\tvar sx = null;\r\n\t\tfor (var i in children)\r\n\t\t{\r\n\t\t\tc = this._tree.child(n, children[i]);\r\n\t\t\tsz = c.box.size;\r\n\t\t\tuniforms.u_world_box_min = sglAddV3S(c.box.min, sz[0] * 0.05);\r\n\t\t\tuniforms.u_world_box_max = sglSubV3S(c.box.max, sz[0] * 0.05);\r\n\t\t\tuniforms.u_color         = ((c.isLeaf) ? ([1.0, 1.0, 0.0]) : ([1.0, 1.0, 1.0]));\r\n\t\t\tthis._boxRenderer.setUniforms(uniforms);\r\n\t\t\tthis._boxRenderer.render();\r\n\t\t}\r\n\t},\r\n\r\n\t_renderNodesHalfResBoxes : function(mvp)\r\n\t{\r\n\t\tvar uniforms = {\r\n\t\t\tu_model_view_projection_matrix : mvp\r\n\t\t};\r\n\r\n\t\tthis._boxRenderer.begin();\r\n\t\t\tthis._boxRenderer.setUniforms(uniforms);\r\n\t\t\tthis._boxRenderer.beginMesh(this._boxMesh);\r\n\t\t\t\tthis._boxRenderer.beginPrimitives(\"edges\");\r\n\t\t\t\tvar nc = null;\r\n\t\t\t\tfor (var i in this._toRenderHalfRes)\r\n\t\t\t\t{\r\n\t\t\t\t\tnc = this._toRenderHalfRes[i];\r\n\t\t\t\t\tthis._renderNodeHalfResBox(nc.n, nc.children);\r\n\t\t\t\t}\r\n\t\t\t\tthis._boxRenderer.endPrimitives();\r\n\t\t\tthis._boxRenderer.endMesh();\r\n\t\tthis._boxRenderer.end();\r\n\t},\r\n\r\n\t_renderNodesBoxes : function(mvp)\r\n\t{\r\n\t\tthis.gl.lineWidth(2.0);\r\n\t\tthis.gl.depthFunc(this.gl.LEQUAL);\r\n\t\tthis._renderNodesFullResBoxes(mvp);\r\n\t\tthis._renderNodesHalfResBoxes(mvp);\r\n\t\tthis.gl.depthFunc(this.gl.LESS);\r\n\t\tthis.gl.lineWidth(1.0);\r\n\t},\r\n\r\n\t_doRender : function(projectionMatrix, modelViewMatrix, viewport)\r\n\t{\r\n\t\tvar mv = sglMulM4(modelViewMatrix, this._treeTransform);\r\n\t\t//var mv = modelViewMatrix;\r\n\r\n\t\tthis._timestamp++;\r\n\t\tthis._frustum.setup(projectionMatrix, mv, viewport);\r\n\r\n\t\tthis._collectNodes();\r\n\t\tvar mvp = sglMulM4(projectionMatrix, mv);\r\n\r\n\t\tif (this.renderData)\r\n\t\t\tthis._renderNodes(mvp);\r\n\r\n\t\tif (this.renderBoxes) \r\n\t\t\tthis._renderNodesBoxes(mvp);\r\n\t\t\r\n\t\tif (this.lg && this.lgtex != null)\r\n\t\t{\r\n\t\t\tthis.gl.enable(this.gl.BLEND);\r\n\t\t\tthis.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\r\n\t\t\tvar mvp2 = sglMulM4(projectionMatrix, sglScalingM4C(1.0, 1.0, 1.0));\r\n\t\t\tvar quadUniforms = { u_mvp : mvp2 };\r\n\t\t\tvar quadSamplers = { s_texture : this.lgtex };\r\n\t\t\tsglRenderMeshGLPrimitives(this.lgMesh, \"tristrip\", this.texProg, null, quadUniforms, quadSamplers);\r\n\t\t\tthis.gl.disable(this.gl.BLEND);\r\n\t\t}\r\n\t\t//this.gl.finish();\r\n\t},\r\n\r\n\t_updateCache : function()\r\n\t{\r\n\t\tvar maxUpdatesPerFrame = 1;\r\n\t\tvar readyItems = this._readyItems.slice(0, maxUpdatesPerFrame);\r\n\t\tthis._readyItems.splice(0, maxUpdatesPerFrame);\r\n\r\n\t\tvar combined = this._cache.concat(readyItems);\r\n\t\tcombined.sort(_MultiResCompareNodes);\r\n\r\n\t\tvar cl = combined.length;\r\n\t\tvar k  = (this._maxCacheSize < cl) ? (this._maxCacheSize) : (cl);\r\n\r\n\t\tthis._cache = combined.splice(0, k);\r\n\t\tvar outOfCache = combined;\r\n\r\n\t\tvar n = null;\r\n\t\tvar r = null;\r\n\t\tvar failed = [ ];\r\n\r\n\t\tfor (var i=0; i<k; ++i) \r\n\t\t{\r\n\t\t\tn = this._cache[i];\r\n\t\t\tr = n.req;\r\n\t\t\tn.req = null;\r\n\r\n\t\t\tif (!r) continue;\r\n\t\t\tif (!r.succeeded)\r\n\t\t\t{\r\n\t\t\t\tfailed.push(i);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar cimgs = new Array(r.requests.length);\r\n\t\t\tfor (var i=0; i<cimgs.length; ++i)\r\n\t\t\t\tcimgs[i] = r.requests[i].image;\r\n\t\t\t\t\r\n\t\t\tif (n.data)\r\n\t\t\t\tthis._destroyData(n.data);\r\n\t\t\t\r\n\t\t\tn.data = this._createData(cimgs);\r\n\t\t}\r\n\r\n\t\tvar fc = failed.length;\r\n\t\tvar reinsertedCount = 0;\r\n\r\n\t\tk = outOfCache.length;\r\n\t\tfor (var i=0; i<k; ++i)\r\n\t\t{\r\n\t\t\tn = outOfCache[i];\r\n\t\t\tr = n.req;\r\n\t\t\tn.req = null;\r\n\r\n\t\t\tif (r) continue;\r\n\r\n\t\t\tif (reinsertedCount < fc) \r\n\t\t\t{\r\n\t\t\t\tthis._cache[failed[reinsertedCount]] = n;\r\n\t\t\t\treinsertedCount++;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis._destroyData(n.data);\r\n\t\t\t\tn.data = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (reinsertedCount > 0) \r\n\t\t\tthis._cache.sort(_MultiResCompareNodes);\r\n\t},\r\n\r\n\t\r\n\t_requestNodes : function() \r\n\t{\r\n\t\tvar cs = this._cache.length;\r\n\t\tvar lastItem = (cs > 0) ? (this._cache[cs-1]) : (null);\r\n\r\n\t\tthis._toRequest.sort(_MultiResCompareNodes);\r\n\t\tvar requestableCount = this._maxOngoingRequests - this._currentOngoingRequests;\r\n\r\n\t\tvar requested = 0;\r\n\t\tvar k = this._toRequest.length;\r\n\t\tvar n = null;\r\n\t\tvar canRequest = false;\r\n\r\n\t\tfor (var i=0; ((i<k) && (requested<requestableCount)); ++i) \r\n\t\t{\r\n\t\t\tn = this._toRequest[i];\r\n\t\t\tif (n.req) continue; // ongoing;\r\n\r\n\t\t\tcanRequest = true;\r\n\t\t\tif ((lastItem != null) && (cs >= this._maxCacheSize)) \r\n\t\t\t\tcanRequest = (_MultiResCompareNodes(n, lastItem) < 0);\r\n\t\t\t\r\n\t\t\tif (canRequest)\r\n\t\t\t{\r\n\t\t\t\tthis._requestNode(n);\r\n\t\t\t\trequested++\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t\r\n\t_calculateNormalizedTreeTransform : function() \r\n\t{\r\n\t\tvar root = this._tree.root;\r\n\t\tif (!root) return sglIdentityM4();\r\n\r\n\t\tvar rbox = new SglBox3();\r\n\t\trbox.min = sglAddV3(sglMulV3(root.box.min, this._tree.scale), this._tree.offset);\r\n\t\trbox.max = sglAddV3(sglMulV3(root.box.max, this._tree.scale), this._tree.offset);\r\n\t\t//rbox = root.box;\r\n\r\n\t\tthis._treeTransform = sglMulM4(sglTranslationM4V(this._tree.offset), sglScalingM4V(this._tree.scale));\r\n\t\t//this._treeTransform = sglIdentityM4();\r\n\r\n\t\tvar bc = rbox.center;\r\n\t\tvar bs = rbox.size;\r\n\r\n\t\tvar maxDim = bs[0];\r\n\t\tif (maxDim < bs[1]) maxDim = bs[1];\r\n\t\tif (maxDim < bs[2]) maxDim = bs[2];\r\n\r\n\t\tvar scale = (maxDim > 0.0) ? (1.0 / maxDim) : (1.0);\r\n\r\n\t\tvar s = sglScalingM4C(scale, scale, scale);\r\n\t\tvar t = sglTranslationM4C(-bc[0], -bc[1], -bc[2]);\r\n\r\n\t\tvar xform = sglMulM4(s, t);\r\n\t\tthis._normalizedTreeTransform = xform;\r\n\t\t/*\r\n\t\t//var r  = sglRotationAngleAxisM4C(sglDegToRad(-90.0), 1.0, 0.0, 0.0);\r\n\t\tvar r  = sglIdentityM4();\r\n\t\tvar t1 = sglTranslationM4C(0.0, 0.0, bs[2] / 2.0 * scale);\r\n\t\tvar s  = sglScalingM4C(scale, scale, scale);\r\n\t\tvar t2 = sglTranslationM4C(-bc[0], -bc[1], -bc[2]);\r\n\t\tthis._normalizedTreeTransform = sglMulM4(r, sglMulM4(t1, sglMulM4(s, t2)));\r\n\t\t*/\r\n\t},\r\n\r\n\t_setupTree : function() \r\n\t{\r\n\t\tvar root = this._tree.root;\r\n\t\tif (!root) return;\r\n\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tvar csize = ((this._tree.tileSize + 2) * (this._tree.tileSize + 2)) * this.ordlen * 3;\r\n\r\n\t\tthis._maxCacheSize = sglFloor(this._cacheSizeInBytes / (csize));\r\n\t\tif (this._maxCacheSize <= 0) this._maxCacheSize = 1;\r\n\r\n\t\tvar quadPositions = new Float32Array([\r\n\t\t\t-0.5,  0.5,\r\n\t\t\t-0.5, -0.5,\r\n\t\t\t 0.5,  0.5,\r\n\t\t\t 0.5, -0.5\r\n\t\t]);\r\n\r\n\t\tvar quadMesh = new SglMeshGL(gl);\r\n\t\tquadMesh.addVertexAttribute(\"position\", 2, quadPositions);\r\n\t\tquadMesh.addArrayPrimitives(\"tristrip\", gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n\t\tthis._tileFullMesh = quadMesh;\r\n\t\tthis._tileHalfMesh = quadMesh;\r\n\r\n\t\tthis._calculateNormalizedTreeTransform();\r\n\t},\r\n\r\n\t\r\n\trender : function(projectionMatrix, modelViewMatrix, viewport)\r\n\t{\r\n\t\tif (!this._tree.root) return;\r\n\r\n\t\tthis._doRender(projectionMatrix, modelViewMatrix, viewport);\r\n\t\tif (this.updateData)\r\n\t\t{\r\n\t\t\tthis._updateCache();\r\n\t\t\tthis._requestNodes();\r\n\t\t}\r\n\t},\r\n\r\n\t\r\n\tget normalizedTreeTransform() \r\n\t{\r\n\t\treturn this._normalizedTreeTransform;\r\n\t}\r\n};\r\n"]}