<!DOCTYPE htmml>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1">
	<title>Tree Rings</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="node_modules/font-awesome-4.7.0/css/font-awesome.css">

    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap-theme.min.css" >

    <link rel="stylesheet" href="node_modules/leaflet/dist/leaflet.css">
    <link rel="stylesheet" href="node_modules/leaflet-fullscreen/dist/leaflet.fullscreen.css">
    <link rel="stylesheet" href="node_modules/leaflet-minimap/dist/Control.MiniMap.min.css" />
    <link rel="stylesheet" href="node_modules/leaflet-easybutton/src/easy-button.css" />
    <link rel="stylesheet" href="node_modules/leaflet-dialog/Leaflet.Dialog.css">

    <link rel="stylesheet" href="style.css">

    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/jszip/dist/jszip.min.js"></script>
    <script src="node_modules/file-saver/FileSaver.min.js"></script>

    <script src="node_modules/leaflet/dist/leaflet.js"></script>
    <script src="node_modules/leaflet-fullscreen/dist/Leaflet.fullscreen.js"></script>
    <script src="node_modules/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
    <script src="node_modules/leaflet-easybutton/src/easy-button.js"></script>
    <script src="node_modules/leaflet-dialog/Leaflet.Dialog.js"></script>
    
    <script src="Leaflet.elevator.js"></script>
</head>

<body>
    <!--<div id="button_area">
        <a href="#" id="save-local" download="data.json"><i class="material-icons md-18">save</i></a>
        <div id="admin-save"></div>
        <div class="file-upload">
            <label for="file">
                <i id="upload_button" class="material-icons md-18">file_upload</i>
            </label>

            <input type="file" id="file" onchange="treering.loadFile()"/>
        </div>
    </div>-->
    <div id="map_container"><div id="map"></div></div>    

</body>
</html>
<script type="application/javascript" src="leaflet-treering.js"></script>

<script>
    var src;
    var map = L.map('map', {
        fullscreenControl: true,
        zoomSnap: 0,
        crs: L.CRS.Simple,
        drawControl: true,
        layers: [],
        doubleClickZoom: false,
        zoomControl: false
    }).setView([0, 0], 0);

    var layer = L.tileLayer.elevator(function(coords, tile, done) {
        var error;
        //var params = {Bucket: 'elevator-assets', Key: "testasset5/tiledBase_files/" + coords.z + "/" + coords.x + "_" + coords.y + ".jpeg"};
        var params = {Bucket: 'elevator-assets', Key: "pmc14b_files/" + coords.z + "/" + coords.x + "_" + coords.y + ".jpeg"};
        tile.onload = (function(done, error, tile) {
            return function() {
                done(error, tile);
            }
        })(done, error, tile);
        //tile.src = "https://s3.amazonaws.com/" + params.Bucket + "/" + params.Key;
        tile.src = params.Key;
        src = tile.src;
        return tile.src;
    },
    {
        //width: 231782,
        //height: 4042,
        width: 200521,
        height: 4196,
        tileSize :254,
        maxZoom: 19 - 1,
        overlap: 1,
        pixelsPerMillimeter: 468, //(NEW)
        lineColor: 'blue'
    }).addTo(map);

    //minimap
    var miniLayer = new L.tileLayer.elevator(function(coords, tile, done) {
        var error;
        //var params = {Bucket: 'elevator-assets', Key: "testasset5/tiledBase_files/" + coords.z + "/" + coords.x + "_" + coords.y + ".jpeg"};
        var params = {Bucket: 'elevator-assets', Key: "pmc14b_files/" + coords.z + "/" + coords.x + "_" + coords.y + ".jpeg"};
        tile.onload = (function(done, error, tile) {
            return function() {
                done(error, tile)
            }
        })(done, error, tile);
        //tile.src = "https://s3.amazonaws.com/" + params.Bucket + "/" + params.Key;
        tile.src = params.Key;
        src = tile.src;
        return tile.src;
    },
    {
        //width: 231782,
        //height: 4042,
        width: 200521,
        height: 4196,
        tileSize: 254,
        maxZoom: 13,
        overlap: 1,
    });

    //map, basePath, saveURL, savePermission, {initialData: json, assetName: string, datingInner: int, hasLatewood: bool}
    var treering = new leafletTreering(map, "", "", true, {'initialData': {'saveDate': {'day': 2, 'month': 10, 'year': 2017}, 'saveTime': {'hour': 11, 'minute': 48, 'am_pm': " AM"}}, 'assetName': "ABC00X", 'datingInner': 1234, 'hasLatewood': true});
    treering.loadInterface();
    //treering.addSaveButton();
</script>
